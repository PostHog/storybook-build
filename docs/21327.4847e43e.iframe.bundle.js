(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[21327],{"../../frontend/src/scenes/actions/NewActionButton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{O:()=>NewActionButton});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.27.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.6_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_components_AuthorizedUrlList_AuthorizedUrlList__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),lib_components_AuthorizedUrlList_authorizedUrlListLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/urls.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function NewActionButton(_ref){let{onSelectOption}=_ref,[visible,setVisible]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(!1),[appUrlsVisible,setAppUrlsVisible]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"primary",onClick:()=>setVisible(!0),"data-attr":"create-action",children:"New action"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.fQ,{isOpen:visible,onClose:()=>{setVisible(!1),setAppUrlsVisible(!1)},title:"Create new action",footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.Fragment,{children:[appUrlsVisible&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"secondary",onClick:()=>setAppUrlsVisible(!1),children:"Back"},"back-button"),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"secondary",onClick:()=>{setVisible(!1),setAppUrlsVisible(!1)},children:"Cancel"},"cancel-button")]}),children:appUrlsVisible?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("div",{className:"max-w-160",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_components_AuthorizedUrlList_AuthorizedUrlList__WEBPACK_IMPORTED_MODULE_3__.t,{type:lib_components_AuthorizedUrlList_authorizedUrlListLogic__WEBPACK_IMPORTED_MODULE_4__.uw.TOOLBAR_URLS})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconSearch,{}),onClick:()=>setAppUrlsVisible(!0),size:"large",fullWidth:!0,center:!0,"data-attr":"new-action-inspect",children:"Inspect element on your site"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconPencil,{}),onClick:()=>{onSelectOption?.(),kea_router__WEBPACK_IMPORTED_MODULE_2__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.createAction())},size:"large",fullWidth:!0,center:!0,"data-attr":"new-action-pageview",children:"From event or pageview"})]})})]})}},"../../frontend/src/scenes/web-analytics/pageReportsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{z:()=>pageReportsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.6_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.6_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),_queries_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/queries/utils.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_common__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/web-analytics/common.ts"),_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/web-analytics/webAnalyticsLogic.tsx");function createUrlPropertyFilter(url,stripQueryParams){return{key:"$current_url",value:stripQueryParams?`^${url.split("?")[0]}(\\?.*)?$`:url,operator:stripQueryParams?_types__WEBPACK_IMPORTED_MODULE_5__.WV.Regex:_types__WEBPACK_IMPORTED_MODULE_5__.WV.Exact,type:_types__WEBPACK_IMPORTED_MODULE_5__.FT.Event}}let pageReportsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)({path:["scenes","web-analytics","pageReportsLogic"],connect:{values:[_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_7__.W,["tiles as webAnalyticsTiles","shouldFilterTestAccounts","dateFilter"]],actions:[_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_7__.W,["setDates"]]},actions:()=>({setPageUrl:url=>({url}),setPageUrlSearchTerm:searchTerm=>({searchTerm}),loadPages:function(){let searchTerm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{searchTerm}},toggleStripQueryParams:()=>({}),setTileVisualization:(tileId,visualization)=>({tileId,visualization})}),reducers:()=>({pageUrl:[null,{persist:!0},{setPageUrl:(_state,_ref)=>{let{url}=_ref;return Array.isArray(url)?url.length>0?url[0]:null:url}}],pageUrlSearchTerm:["",{setPageUrlSearchTerm:(_state,_ref2)=>{let{searchTerm}=_ref2;return searchTerm}}],isInitialLoad:[!0,{loadPagesSuccess:()=>!1}],stripQueryParams:[!0,{persist:!0},{toggleStripQueryParams:state=>!state}],tileVisualizations:[{},{persist:!0},{setTileVisualization:(state,_ref3)=>{let{tileId,visualization}=_ref3;return{...state,[tileId]:visualization}}}]}),loaders:_ref4=>{let{values}=_ref4;return{pagesUrls:[[],{loadPagesUrls:async _ref5=>{let{searchTerm}=_ref5;try{return(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.query((0,_queries_utils__WEBPACK_IMPORTED_MODULE_4__.xg)({kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.WebPageURLSearchQuery,searchTerm:searchTerm,stripQueryParams:values.stripQueryParams,dateRange:{date_from:values.dateFilter.dateFrom,date_to:values.dateFilter.dateTo},properties:[]}))).results}catch(error){return console.error("Error loading pages:",error),[]}}}]}},selectors:{hasPageUrl:[selectors=>[selectors.pageUrl],pageUrl=>!!pageUrl],isLoading:[selectors=>[selectors.pagesUrlsLoading,selectors.isInitialLoad],(pagesUrlsLoading,isInitialLoad)=>pagesUrlsLoading||isInitialLoad],queries:[s=>[s.webAnalyticsTiles,s.pageUrl,s.stripQueryParams,s.dateFilter,s.shouldFilterTestAccounts],(webAnalyticsTiles,pageUrl,stripQueryParams,dateFilter,shouldFilterTestAccounts)=>{if(!pageUrl)return{entryPathsQuery:void 0,exitPathsQuery:void 0,outboundClicksQuery:void 0,channelsQuery:void 0,referrersQuery:void 0,deviceTypeQuery:void 0,browserQuery:void 0,osQuery:void 0,countriesQuery:void 0,regionsQuery:void 0,citiesQuery:void 0,timezonesQuery:void 0,languagesQuery:void 0,topEventsQuery:void 0};let getQuery=(tileId,tabId)=>{let tile=webAnalyticsTiles?.find(t=>t.tileId===tileId),query=tile?.tabs.find(tab=>tab.id===tabId)?.query;if(query&&"source"in query&&query.source){let modifiedQuery=JSON.parse(JSON.stringify(query));return modifiedQuery.source.properties&&(modifiedQuery.source.properties=[createUrlPropertyFilter(pageUrl,stripQueryParams)]),modifiedQuery}return query};return{entryPathsQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PATHS,_common__WEBPACK_IMPORTED_MODULE_6__.wT.INITIAL_PATH),exitPathsQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PATHS,_common__WEBPACK_IMPORTED_MODULE_6__.wT.END_PATH),outboundClicksQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PATHS,_common__WEBPACK_IMPORTED_MODULE_6__.wT.EXIT_CLICK),channelsQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.SOURCES,_common__WEBPACK_IMPORTED_MODULE_6__.VL.CHANNEL),referrersQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.SOURCES,_common__WEBPACK_IMPORTED_MODULE_6__.VL.REFERRING_DOMAIN),deviceTypeQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.DEVICES,_common__WEBPACK_IMPORTED_MODULE_6__.tL.DEVICE_TYPE),browserQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.DEVICES,_common__WEBPACK_IMPORTED_MODULE_6__.tL.BROWSER),osQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.DEVICES,_common__WEBPACK_IMPORTED_MODULE_6__.tL.OS),countriesQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_common__WEBPACK_IMPORTED_MODULE_6__.QX.COUNTRIES),regionsQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_common__WEBPACK_IMPORTED_MODULE_6__.QX.REGIONS),citiesQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_common__WEBPACK_IMPORTED_MODULE_6__.QX.CITIES),timezonesQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_common__WEBPACK_IMPORTED_MODULE_6__.QX.TIMEZONES),languagesQuery:getQuery(_common__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_common__WEBPACK_IMPORTED_MODULE_6__.QX.LANGUAGES),topEventsQuery:{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.InsightVizNode,source:{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.TrendsQuery,series:[{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.EventsNode,event:null,name:"All events",math:_types__WEBPACK_IMPORTED_MODULE_5__.vN.TotalCount}],trendsFilter:{},breakdownFilter:{breakdowns:[{property:"event",type:"event_metadata"}]},properties:[...pageUrl?[createUrlPropertyFilter(pageUrl,stripQueryParams)]:[],{key:"event",value:["$pageview","$pageleave"],operator:_types__WEBPACK_IMPORTED_MODULE_5__.WV.IsNot,type:_types__WEBPACK_IMPORTED_MODULE_5__.FT.EventMetadata}],filterTestAccounts:shouldFilterTestAccounts,dateRange:{date_from:dateFilter.dateFrom,date_to:dateFilter.dateTo},tags:_common__WEBPACK_IMPORTED_MODULE_6__.Zt},embedded:!0,hidePersonsModal:!0}}}],createInsightProps:[()=>[],()=>(tileId,tabId)=>({dashboardItemId:`new-${tileId}${tabId?`-${tabId}`:""}`,loadPriority:0,dataNodeCollectionId:_common__WEBPACK_IMPORTED_MODULE_6__.p2})],combinedMetricsQuery:[s=>[s.pageUrl,s.stripQueryParams,s.shouldFilterTestAccounts],(pageUrl,stripQueryParams,shouldFilterTestAccounts)=>dateFilter=>({kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.InsightVizNode,source:{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.TrendsQuery,series:[{event:"$pageview",kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.EventsNode,math:_types__WEBPACK_IMPORTED_MODULE_5__.vN.UniqueUsers,name:"$pageview",custom_name:"Unique visitors"},{event:"$pageview",kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.EventsNode,math:_types__WEBPACK_IMPORTED_MODULE_5__.vN.TotalCount,name:"$pageview",custom_name:"Page views"},{event:"$pageview",kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.EventsNode,math:_types__WEBPACK_IMPORTED_MODULE_5__.vN.UniqueSessions,name:"$pageview",custom_name:"Sessions"}],interval:dateFilter.interval,dateRange:{date_from:dateFilter.dateFrom,date_to:dateFilter.dateTo},trendsFilter:{display:_types__WEBPACK_IMPORTED_MODULE_5__.Qb.ActionsLineGraph,showLegend:!0},filterTestAccounts:shouldFilterTestAccounts,properties:pageUrl?[createUrlPropertyFilter(pageUrl,stripQueryParams)]:[],tags:_common__WEBPACK_IMPORTED_MODULE_6__.Zt},hidePersonsModal:!0,embedded:!0})],tiles:[s=>[s.queries,s.pageUrl,s.createInsightProps,s.combinedMetricsQuery,s.dateFilter],(queries,pageUrl,createInsightProps,combinedMetricsQuery,dateFilter)=>{if(!pageUrl)return[];let createQueryTile=(tileId,title,description,query,layout)=>query?{kind:"query",tileId,title,query,showIntervalSelect:!1,insightProps:createInsightProps(tileId),layout:null!=layout?layout:{className:"flex flex-col h-full min-h-[400px]"},docs:{title,description},canOpenModal:!0}:null;return[{kind:"section",tileId:_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_COMBINED_METRICS_CHART,tiles:[{kind:"query",tileId:_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_COMBINED_METRICS_CHART,title:"Trends over time",query:combinedMetricsQuery(dateFilter),showIntervalSelect:!0,insightProps:createInsightProps(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_COMBINED_METRICS_CHART,"combined"),layout:{className:"w-full min-h-[350px]"},docs:{title:"Trends over time",description:"Key metrics for this page over time"}}],layout:{className:"w-full"}},{kind:"section",tileId:_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_PATHS_SECTION,layout:{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},tiles:[createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_ENTRY_PATHS,"Entry Paths","How users arrive at this page",queries.entryPathsQuery,{className:"flex flex-col h-full min-h-[400px]"}),createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_EXIT_PATHS,"Exit Paths","Where users go after viewing this page",queries.exitPathsQuery,{className:"flex flex-col h-full min-h-[400px]"}),createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_OUTBOUND_CLICKS,"Outbound Clicks","External links users click on this page",queries.outboundClicksQuery)].filter(Boolean)},{kind:"section",tileId:_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_TRAFFIC_SECTION,layout:{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"},tiles:[createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_CHANNELS,"Channels","Marketing channels bringing users to this page",queries.channelsQuery),createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_REFERRERS,"Referrers","Websites referring traffic to this page",queries.referrersQuery)].filter(Boolean)},{kind:"section",tileId:_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_DEVICE_INFORMATION_SECTION,layout:{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},tiles:[createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_DEVICE_TYPES,"Device Types","Types of devices used to access this page",queries.deviceTypeQuery),createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_BROWSERS,"Browsers","Browsers used to access this page",queries.browserQuery),createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_OPERATING_SYSTEMS,"Operating Systems","Operating systems used to access this page",queries.osQuery)].filter(Boolean)},{kind:"section",tileId:_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_GEOGRAPHY_SECTION,layout:{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},tiles:[createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_COUNTRIES,"Countries","Countries where users access this page from",queries.countriesQuery),createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_REGIONS,"Regions","Regions where users access this page from",queries.regionsQuery),createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_CITIES,"Cities","Cities where users access this page from",queries.citiesQuery),createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_TIMEZONES,"Timezones","Timezones where users access this page from",queries.timezonesQuery),createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_LANGUAGES,"Languages","Languages of users accessing this page",queries.languagesQuery)].filter(Boolean)},{kind:"section",tileId:_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_TOP_EVENTS_SECTION,title:"",layout:{className:"grid-cols-1 gap-2"},tiles:[createQueryTile(_common__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_TOP_EVENTS,"Top Events","Most common events triggered by users on this page, broken down by event type",queries.topEventsQuery,{className:"w-full min-h-[300px]"})].filter(Boolean)}]}]},listeners:_ref6=>{let{actions,values}=_ref6;return{setPageUrlSearchTerm:_ref7=>{let{searchTerm}=_ref7;actions.loadPages(searchTerm)},setPageUrl:_ref8=>{let{url}=_ref8;kea_router__WEBPACK_IMPORTED_MODULE_1__.router.actions.replace("/web/page-reports",url?{pageURL:url}:{},kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.hashParams)},toggleStripQueryParams:()=>{actions.loadPages(values.pageUrlSearchTerm)},loadPages:_ref9=>{let{searchTerm}=_ref9;actions.loadPagesUrls({searchTerm})}}},afterMount:_ref10=>{let{actions}=_ref10;actions.loadPages("")},urlToAction:_ref11=>{let{actions,values}=_ref11;return{"/web/page-reports":(_,searchParams)=>{searchParams.pageURL&&searchParams.pageURL!==values.pageUrl&&actions.setPageUrl(searchParams.pageURL),"stripQueryParams"in searchParams&&!!searchParams.stripQueryParams!==values.stripQueryParams&&actions.toggleStripQueryParams()}}},actionToUrl:_ref12=>{let{values}=_ref12;return{setPageUrl:()=>{let searchParams={...kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.searchParams};return values.pageUrl?searchParams.pageURL=values.pageUrl:delete searchParams.pageURL,!!kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.searchParams.stripQueryParams!==values.stripQueryParams&&(searchParams.stripQueryParams=values.stripQueryParams),["/web/page-reports",searchParams,kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.hashParams,{replace:!0}]},toggleStripQueryParams:()=>{let searchParams={...kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.searchParams};return searchParams.stripQueryParams=values.stripQueryParams,["/web/page-reports",searchParams,kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.hashParams,{replace:!0}]}}}})},"../../frontend/src/scenes/web-analytics/tiles/WebAnalyticsTile.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{bP:()=>WebQuery,FM:()=>webAnalyticsDataTableQueryContext});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.27.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.6_react@18.2.0/node_modules/kea/lib/index.esm.js"),colors=__webpack_require__("../../frontend/src/lib/colors.ts"),IntervalFilter=__webpack_require__("../../frontend/src/lib/components/IntervalFilter/index.ts"),PathCleanFilterItem=__webpack_require__("../../frontend/src/lib/components/PathCleanFilters/PathCleanFilterItem.tsx"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),PropertyIcon=__webpack_require__("../../frontend/src/lib/components/PropertyIcon/PropertyIcon.tsx"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonSwitch=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSwitch/index.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),country=__webpack_require__("../../frontend/src/lib/utils/geography/country.ts"),product_intents=__webpack_require__("../../frontend/src/lib/utils/product-intents.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),NewActionButton=__webpack_require__("../../frontend/src/scenes/actions/NewActionButton.tsx"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),common=__webpack_require__("../../frontend/src/scenes/web-analytics/common.ts"),webAnalyticsLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/webAnalyticsLogic.tsx"),actionsModel=__webpack_require__("../../frontend/src/models/actionsModel.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),types=__webpack_require__("../../frontend/src/types.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ErrorTrackingButton=_ref=>{let{breakdownBy,value}=_ref;return(breakdownBy===schema_general.GI.FrustrationMetrics||breakdownBy===schema_general.GI.Page)&&value&&""!==value?(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.errorTracking({filterGroup:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:"$current_url",value:[value],operator:types.WV.Exact,type:types.FT.Event}]}]}}),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{}),type:"tertiary",size:"xsmall",tooltip:"View errors for this page",className:"no-underline",targetBlank:!0,onClick:e=>{e.stopPropagation(),(0,product_intents.uX)({from:types.Md.WEB_ANALYTICS,to:types.Md.ERROR_TRACKING,intent_context:product_intents.kp.WEB_ANALYTICS_FRUSTRATING_PAGES})}}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})};var authorizedUrlListLogic=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts");let VALID_BREAKDOWN_VALUES=new Set([schema_general.GI.Page,schema_general.GI.InitialPage,schema_general.GI.ExitPage,schema_general.GI.ExitClick,schema_general.GI.FrustrationMetrics]),HeatmapButton=_ref=>{let{breakdownBy,value}=_ref,{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{domainFilter:webAnalyticsSelectedDomain}=(0,index_esm.useValues)(webAnalyticsLogic.W);if(""===value||!VALID_BREAKDOWN_VALUES.has(breakdownBy))return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});if(!webAnalyticsSelectedDomain||"all"===webAnalyticsSelectedDomain)return(0,jsx_runtime.jsx)(src.Jp,{disabledReason:"Select a domain to view heatmaps",icon:(0,jsx_runtime.jsx)(icons.X,{}),type:"tertiary",size:"xsmall",tooltip:"View heatmap for this page",className:"no-underline"});let domain=webAnalyticsSelectedDomain.endsWith("/")?webAnalyticsSelectedDomain.slice(0,-1):webAnalyticsSelectedDomain,path=value.startsWith("/")?value.slice(1):value,url=`${domain}/${path}`,to=featureFlags[constants.y8.HEATMAPS_UI]?urls.j.heatmaps(`pageURL=${url}`):(0,authorizedUrlListLogic.Kc)(url,{userIntent:"heatmaps"});return(0,jsx_runtime.jsx)(src.Jp,{to:to,icon:(0,jsx_runtime.jsx)(icons.X,{}),type:"tertiary",size:"xsmall",tooltip:"View heatmap for this page",className:"no-underline",targetBlank:!0,onClick:e=>{e.stopPropagation(),(0,product_intents.uX)({from:types.Md.WEB_ANALYTICS,to:types.Md.HEATMAPS,intent_context:product_intents.kp.WEB_ANALYTICS_INSIGHT})}})},BREAKDOWN_TYPE_MAP={[schema_general.GI.DeviceType]:types.FT.Event,[schema_general.GI.InitialPage]:types.FT.Session,[schema_general.GI.ExitPage]:types.FT.Session,[schema_general.GI.Page]:types.FT.Event,[schema_general.GI.Browser]:types.FT.Event,[schema_general.GI.OS]:types.FT.Event,[schema_general.GI.InitialChannelType]:types.FT.Session,[schema_general.GI.InitialReferringDomain]:types.FT.Session,[schema_general.GI.InitialUTMSource]:types.FT.Session,[schema_general.GI.InitialUTMCampaign]:types.FT.Session,[schema_general.GI.InitialUTMMedium]:types.FT.Session,[schema_general.GI.InitialUTMContent]:types.FT.Session,[schema_general.GI.InitialUTMTerm]:types.FT.Session,[schema_general.GI.FrustrationMetrics]:types.FT.Event},BREAKDOWN_KEY_MAP={[schema_general.GI.DeviceType]:"$device_type",[schema_general.GI.InitialPage]:"$entry_pathname",[schema_general.GI.ExitPage]:"$end_pathname",[schema_general.GI.Page]:"$pathname",[schema_general.GI.Browser]:"$browser",[schema_general.GI.OS]:"$os",[schema_general.GI.InitialChannelType]:"$channel_type",[schema_general.GI.InitialReferringDomain]:"$entry_referring_domain",[schema_general.GI.InitialUTMSource]:"$entry_utm_source",[schema_general.GI.InitialUTMCampaign]:"$entry_utm_campaign",[schema_general.GI.InitialUTMMedium]:"$entry_utm_medium",[schema_general.GI.InitialUTMContent]:"$entry_utm_content",[schema_general.GI.InitialUTMTerm]:"$entry_utm_term",[schema_general.GI.FrustrationMetrics]:"$pathname"},ReplayButton=_ref=>{let{date_from,date_to,breakdownBy,value}=_ref,sharedButtonProps={icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconRewindPlay,{}),type:"tertiary",size:"xsmall",tooltip:"View recordings",className:"no-underline",targetBlank:!0,onClick:e=>{e.stopPropagation(),(0,product_intents.uX)({from:types.Md.WEB_ANALYTICS,to:types.Md.SESSION_REPLAY,intent_context:product_intents.kp.WEB_ANALYTICS_INSIGHT})}};if(""===value)return(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from,date_to})});if(breakdownBy===schema_general.GI.Viewport)return(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from:date_from,date_to:date_to,filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:"$viewport_width",type:types.FT.Event,value:[value[0]],operator:types.WV.Exact},{key:"$viewport_height",type:types.FT.Event,value:[value[1]],operator:types.WV.Exact}]}]}})});if(breakdownBy===schema_general.GI.InitialUTMSourceMediumCampaign){let values=value.split(" / ");return(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from:date_from,date_to:date_to,filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:"$entry_utm_source",type:types.FT.Session,value:[values[0]||""],operator:types.WV.Exact},{key:"$entry_utm_medium",type:types.FT.Session,value:[values[1]||""],operator:types.WV.Exact},{key:"$entry_utm_campaign",type:types.FT.Session,value:[values[2]||""],operator:types.WV.Exact}]}]}})})}let type=BREAKDOWN_TYPE_MAP[breakdownBy]||types.FT.Person,key=BREAKDOWN_KEY_MAP[breakdownBy];return key&&type?(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from:date_from,date_to:date_to,filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:key,type:type,value:[value],operator:types.WV.Exact}]}]}})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})};var pageReportsLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/pageReportsLogic.ts"),DataTable=__webpack_require__("../../frontend/src/queries/nodes/DataTable/DataTable.tsx"),marketingAnalyticsLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/logic/marketingAnalyticsLogic.ts"),ConversionGoalDropdown=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/components/common/ConversionGoalDropdown.tsx"),settings_constants=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/components/settings/constants.ts"),marketingAnalyticsSettingsLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/logic/marketingAnalyticsSettingsLogic.ts");let DraftConversionGoalControls=()=>{let{setDraftConversionGoal,setConversionGoalInput,resetConversionGoalInput,saveDraftConversionGoal}=(0,index_esm.useActions)(marketingAnalyticsLogic.O),{draftConversionGoal,conversionGoalInput,uniqueConversionGoalName}=(0,index_esm.useValues)(marketingAnalyticsLogic.O),{addOrUpdateConversionGoal}=(0,index_esm.useActions)(marketingAnalyticsSettingsLogic.E),[isExpanded,setIsExpanded]=(0,react.useState)(!1),handleConversionGoalChange=(0,react.useCallback)(filter=>{setConversionGoalInput({...filter,conversion_goal_name:conversionGoalInput?.conversion_goal_name||filter.custom_name||filter.name||"No name"})},[conversionGoalInput?.conversion_goal_name]),handleApplyConversionGoal=(0,react.useCallback)(()=>{conversionGoalInput&&(setDraftConversionGoal({...conversionGoalInput,conversion_goal_name:uniqueConversionGoalName}),setConversionGoalInput({...conversionGoalInput,conversion_goal_name:uniqueConversionGoalName}))},[conversionGoalInput,setDraftConversionGoal,setConversionGoalInput,uniqueConversionGoalName]),handleSaveConversionGoal=(0,react.useCallback)(()=>{addOrUpdateConversionGoal({...conversionGoalInput,conversion_goal_name:uniqueConversionGoalName}),saveDraftConversionGoal()},[conversionGoalInput,addOrUpdateConversionGoal,saveDraftConversionGoal,uniqueConversionGoalName]),hasEvent=conversionGoalInput?.name!==settings_constants.d.name,hasChanges=conversionGoalInput&&!(0,utils.h0)(conversionGoalInput,draftConversionGoal)&&hasEvent,hasAppliedGoal=!!draftConversionGoal;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsx)(LemonButton.J,{type:"tertiary",size:"small",icon:isExpanded?(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronDown,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronRight,{}),onClick:()=>setIsExpanded(!isExpanded),className:"justify-start",children:"Explore conversion goals"}),isExpanded&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,jsx_runtime.jsx)(src.DF,{className:"w-full",value:conversionGoalInput?.conversion_goal_name||"",onChange:value=>{setConversionGoalInput({...conversionGoalInput,conversion_goal_name:value})},placeholder:"Conversion goal name, e.g. purchase, sign up, download"}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",size:"small",onClick:handleApplyConversionGoal,disabledReason:hasChanges?void 0:"No changes to apply",children:"Apply"}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",onClick:resetConversionGoalInput,disabledReason:hasAppliedGoal?void 0:"No active goal to clear",children:"Clear"}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",size:"small",onClick:handleSaveConversionGoal,disabledReason:hasAppliedGoal?void 0:"You need to apply a conversion goal first",children:"Save"})]})}),(0,jsx_runtime.jsx)(ConversionGoalDropdown.T,{value:conversionGoalInput||settings_constants.d,onChange:handleConversionGoalChange,typeKey:"dynamic-conversion-goal"})]})]})};var marketingAnalyticsTableLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/logic/marketingAnalyticsTableLogic.ts"),logic_utils=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/logic/utils.ts");let directionOptions=[{label:"No direction",value:null},{label:"Ascending",value:"ASC",icon:(0,jsx_runtime.jsx)(icons.Cz,{})},{label:"Descending",value:"DESC",icon:(0,jsx_runtime.jsx)(icons.BD,{})}];function MarketingAnalyticsColumnConfigModal(_ref){let{query:rawQuery}=_ref,{columnConfigModalVisible}=(0,index_esm.useValues)(marketingAnalyticsLogic.O),{hideColumnConfigModal}=(0,index_esm.useActions)(marketingAnalyticsLogic.O),{sortedColumns}=(0,index_esm.useValues)(marketingAnalyticsTableLogic.r),{setQuery}=(0,index_esm.useActions)(marketingAnalyticsTableLogic.r),staticSortedColumns=(0,react.useRef)(sortedColumns),marketingQuery=(0,react.useMemo)(()=>rawQuery?.source,[rawQuery]),[currentSortColumn,currentSortDirection]=(0,react.useMemo)(()=>marketingQuery?.orderBy?.[0]||[],[marketingQuery?.orderBy]),hiddenColumns=(0,react.useMemo)(()=>marketingQuery?.select?sortedColumns.filter(column=>!marketingQuery?.select?.includes(column)):[],[marketingQuery?.select,sortedColumns]),sortOptions=(0,react.useMemo)(()=>[{label:"No sorting",value:null},...sortedColumns.filter(column=>!hiddenColumns.includes(column)).map(column=>({label:column,value:column}))],[hiddenColumns,sortedColumns]),pinnedColumns=(0,react.useMemo)(()=>rawQuery?.pinnedColumns||[],[rawQuery]),clearMarketingAnalyticsOrderBy=(0,react.useCallback)(()=>{rawQuery&&setQuery({...rawQuery,source:{...rawQuery.source,orderBy:void 0}})},[rawQuery,setQuery]),setMarketingAnalyticsOrderBy=(0,react.useCallback)((columnName,direction)=>{let newSelect=[];if(hiddenColumns.includes(columnName))for(let column of sortedColumns)column!==columnName&&hiddenColumns.includes(column)||newSelect.push(column);else newSelect=marketingQuery?.select||[];rawQuery&&marketingQuery&&setQuery({...rawQuery,source:{...marketingQuery,select:newSelect,orderBy:(0,logic_utils.kp)(columnName,direction)}})},[hiddenColumns,marketingQuery,rawQuery,setQuery,sortedColumns]),handleSortToggle=(0,react.useCallback)((columnName,direction)=>{currentSortColumn===columnName&&currentSortDirection===direction?clearMarketingAnalyticsOrderBy():setMarketingAnalyticsOrderBy(columnName,direction)},[currentSortColumn,currentSortDirection,clearMarketingAnalyticsOrderBy,setMarketingAnalyticsOrderBy]),toggleColumnVisibility=(0,react.useCallback)(columnName=>{let isCurrentlyHidden=hiddenColumns.includes(columnName),newSelect=[],newOrderBy=marketingQuery?.orderBy||[],newPinnedColumns=[...pinnedColumns];if(isCurrentlyHidden)for(let column of sortedColumns)column!==columnName&&hiddenColumns.includes(column)||newSelect.push(column);else{for(let column of sortedColumns)column===columnName||hiddenColumns.includes(column)||newSelect.push(column);marketingQuery?.orderBy?.[0]?.[0]===columnName&&(newOrderBy=[]);let pinnedIndex=newPinnedColumns.indexOf(columnName);pinnedIndex>-1&&newPinnedColumns.splice(pinnedIndex,1)}setQuery({...rawQuery,source:{...marketingQuery,select:newSelect,orderBy:newOrderBy},pinnedColumns:newPinnedColumns})},[hiddenColumns,marketingQuery,rawQuery,setQuery,sortedColumns,pinnedColumns]),toggleColumnPinning=(0,react.useCallback)(columnName=>{let newPinnedColumns=[...pinnedColumns],isCurrentlyPinned=newPinnedColumns.includes(columnName);isCurrentlyPinned?newPinnedColumns.splice(newPinnedColumns.indexOf(columnName),1):newPinnedColumns.push(columnName);let newSelect=marketingQuery?.select||[];if(!isCurrentlyPinned&&hiddenColumns.includes(columnName))for(let column of(newSelect=[],sortedColumns))column!==columnName&&hiddenColumns.includes(column)||newSelect.push(column);setQuery({...rawQuery,source:{...marketingQuery,select:newSelect},pinnedColumns:newPinnedColumns})},[pinnedColumns,rawQuery,setQuery,marketingQuery,hiddenColumns,sortedColumns]),resetColumnConfigToDefaults=(0,react.useCallback)(()=>{setQuery({...rawQuery,source:{...marketingQuery,select:sortedColumns,orderBy:void 0},pinnedColumns:[]})},[marketingQuery,rawQuery,setQuery,sortedColumns]);return(0,jsx_runtime.jsx)(src.fQ,{isOpen:columnConfigModalVisible,onClose:hideColumnConfigModal,title:"Configure columns",width:600,footer:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:resetColumnConfigToDefaults,disabledReason:0!==pinnedColumns.length||marketingQuery?.orderBy||0!==hiddenColumns.length||marketingQuery?.select?.length!==sortedColumns.length?void 0:"No changes to revert",children:"Reset to defaults"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-1",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:hideColumnConfigModal,children:"Close"})})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsxs)("div",{className:"p-4 bg-bg-light border rounded",children:[(0,jsx_runtime.jsx)("h5",{className:"font-medium mb-3 text-sm uppercase tracking-wide text-muted",children:"Active filters"}),(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[marketingQuery?.orderBy?(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,jsx_runtime.jsx)(icons.Cz,{className:"text-xs text-primary"}),(0,jsx_runtime.jsxs)("span",{className:"text-muted",children:["Sorted by: ",(0,jsx_runtime.jsx)("span",{className:"font-medium text-primary",children:currentSortColumn})," (",currentSortDirection,")"]})]}):(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted italic",children:"No sorting applied"}),hiddenColumns.length>0?(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconHide,{className:"text-xs text-muted"}),(0,jsx_runtime.jsxs)("span",{className:"text-muted",children:["Hidden: ",(0,jsx_runtime.jsx)("span",{className:"font-medium",children:hiddenColumns.join(", ")})]})]}):(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted italic",children:"No hidden columns"}),pinnedColumns.length>0?(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconPinFilled,{className:"text-xs text-primary"}),(0,jsx_runtime.jsxs)("span",{className:"text-muted",children:["Pinned: ",(0,jsx_runtime.jsx)("span",{className:"font-medium text-primary",children:pinnedColumns.join(", ")})]})]}):(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted italic",children:"No pinned columns"})]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold mb-3",children:"Sorting"}),(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("label",{className:"text-sm font-medium text-muted min-w-20",children:"Sort by:"}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(src.Yv,{value:currentSortColumn,onChange:value=>{null===value?clearMarketingAnalyticsOrderBy():currentSortDirection?setMarketingAnalyticsOrderBy(value,currentSortDirection):setMarketingAnalyticsOrderBy(value,"ASC")},options:sortOptions,placeholder:"Select column...",fullWidth:!0,size:"small"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("label",{className:"text-sm font-medium text-muted min-w-20",children:"Direction:"}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(src.Yv,{value:currentSortDirection,onChange:value=>{null===value?clearMarketingAnalyticsOrderBy():currentSortColumn&&setMarketingAnalyticsOrderBy(currentSortColumn,value)},options:directionOptions,placeholder:"Select direction...",fullWidth:!0,size:"small",disabled:!currentSortColumn})})]})]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold mb-3",children:"Column visibility and pinning"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted mb-2",children:"Hide columns you don't need or pin important ones to keep them always visible."}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:staticSortedColumns.current.map(columnName=>{let isHidden=hiddenColumns.includes(columnName),isPinned=pinnedColumns.includes(columnName),isSortedByThisColumn=currentSortColumn===columnName,isAscending="ASC"===currentSortDirection;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between p-1 border rounded hover:bg-bg-light transition-colors",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:(0,jsx_runtime.jsx)(src.Hw,{checked:!isHidden,onChange:()=>toggleColumnVisibility(columnName),label:(0,jsx_runtime.jsx)("span",{className:"flex items-center gap-1",children:columnName}),className:"flex-1"})}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(icons.Cz,{}),onClick:()=>handleSortToggle(columnName,"ASC"),tooltip:isSortedByThisColumn&&isAscending?"Remove sort":"Sort ascending",type:isSortedByThisColumn&&isAscending?"primary":"secondary"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(icons.BD,{}),onClick:()=>handleSortToggle(columnName,"DESC"),tooltip:isSortedByThisColumn&&!isAscending?"Remove sort":"Sort descending",type:isSortedByThisColumn&&!isAscending?"primary":"secondary"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:isPinned?(0,jsx_runtime.jsx)(posthog_icons_es.IconPinFilled,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPin,{}),onClick:()=>toggleColumnPinning(columnName),tooltip:isPinned?"Unpin column":"Pin column",type:isPinned?"primary":"secondary"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:isHidden?(0,jsx_runtime.jsx)(posthog_icons_es.IconHide,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconEye,{}),onClick:()=>toggleColumnVisibility(columnName),tooltip:isHidden?"Show column":"Hide column",type:isHidden?"primary":"secondary"})]})]},columnName)})})]})]})})}var injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),MarketingAnalyticsTableStyleOverride=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/components/MarketingAnalyticsTable/MarketingAnalyticsTableStyleOverride.scss"),MarketingAnalyticsTableStyleOverride_default=__webpack_require__.n(MarketingAnalyticsTableStyleOverride),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(MarketingAnalyticsTableStyleOverride_default(),options),MarketingAnalyticsTableStyleOverride_default().locals;var Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/Tooltip.tsx");let DISPLAY_MODE_OPTIONS=[{value:types.Qb.ActionsLineGraph,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconLineGraph,{})},{value:types.Qb.ActionsAreaGraph,icon:(0,jsx_runtime.jsx)(icons.Ii,{})},{value:types.Qb.ActionsBar,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGraph,{})}],formatValue=(value,mode)=>{if(null==value)return"-";switch(mode){case"full":return(0,utils.Lc)(value,1);case"short":return(0,utils.d$)(value)}return value.toString()},getChangeDirectionIcon=(current,previous)=>current===previous?null:(null!=current?current:0)>(null!=previous?previous:0)?(0,jsx_runtime.jsx)(icons.Cz,{}):(0,jsx_runtime.jsx)(icons.BD,{}),createTooltipContent=(current,previous,changePerc)=>{let changeInfo;let currentValue=formatValue(current,"full"),previousValue=formatValue(previous,"full");if(null===previous)changeInfo=(0,jsx_runtime.jsx)("div",{children:"Change: No data"});else if(null===changePerc)changeInfo=(0,jsx_runtime.jsxs)("div",{children:["Change: ",current]});else{let icon=changePerc>0?(0,jsx_runtime.jsx)(icons.Cz,{}):(0,jsx_runtime.jsx)(icons.BD,{});changeInfo=(0,jsx_runtime.jsxs)("div",{children:["Change: ",changePerc.toFixed(2),"% ",icon]})}return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{children:["Current period: ",currentValue]}),(0,jsx_runtime.jsxs)("div",{children:["Previous period: ",previousValue]}),changeInfo]})},MarketingAnalyticsCell=_ref=>{let{value}=_ref;if(!value)return(0,jsx_runtime.jsx)("span",{children:"-"});if(!Array.isArray(value))return"number"==typeof value?(0,jsx_runtime.jsx)("span",{children:(0,utils.Lc)(value)}):(0,jsx_runtime.jsx)("span",{children:value});let[current,previous]=value;if("string"==typeof current&&current===previous)return(0,jsx_runtime.jsx)("span",{children:current});let currentFormatted=formatValue(current,"short"),changeIcon=getChangeDirectionIcon(current,previous),changePerc=0===previous?null:((null!=current?current:0)-previous)/previous*100,changePercFormatted=changePerc?`${changePerc.toFixed(2)}%`:null,tooltipContent=createTooltipContent(current,previous,changePerc);return(0,jsx_runtime.jsx)(Tooltip.u,{title:tooltipContent,delayMs:300,children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-2 hover:bg-accent-highlight-secondary min-w-0",children:[(0,jsx_runtime.jsxs)("div",{className:"min-w-0 overflow-hidden text-ellipsis whitespace-nowrap",children:[currentFormatted," ",changeIcon]}),(0,jsx_runtime.jsx)("div",{className:"w-full text-muted",children:changePercFormatted})]})})},MarketingAnalyticsTable=_ref=>{let{query,insightProps}=_ref,{setQuery}=(0,index_esm.useActions)(marketingAnalyticsTableLogic.r),{showColumnConfigModal}=(0,index_esm.useActions)(marketingAnalyticsLogic.O),marketingAnalyticsContext={...webAnalyticsDataTableQueryContext,insightProps,columnFeatures:[DataTable.U.canSort,DataTable.U.canRemove,DataTable.U.canPin],columns:query.source.select?.reduce((acc,column)=>(acc[column]={title:column,render:MarketingAnalyticsCell},acc),{})};return(0,jsx_runtime.jsxs)("div",{className:"bg-surface-primary",children:[(0,jsx_runtime.jsx)("div",{className:"p-4 border-b border-border bg-bg-light",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(DraftConversionGoalControls,{})}),(0,jsx_runtime.jsx)("div",{className:"self-start",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:showColumnConfigModal,children:"Configure columns"})})]})}),(0,jsx_runtime.jsx)("div",{className:"relative marketing-analytics-table-container",children:(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!1,context:marketingAnalyticsContext,setQuery:setQuery})}),(0,jsx_runtime.jsx)(MarketingAnalyticsColumnConfigModal,{query:query})]})},toUtcOffsetFormat=value=>{if(0===value)return"UTC";let integerPart=Math.abs(Math.trunc(value)),decimalPartAsMinutes=60*(Math.abs(value)-integerPart),formattedMinutes=decimalPartAsMinutes>0?`:${decimalPartAsMinutes}`:"";return`UTC${value>0?"+":"-"}${integerPart}${formattedMinutes}`},VariationCell=function(){let{isPercentage,reverseColors}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isPercentage:!1,reverseColors:!1},formatNumber=value=>{var _value$toLocaleString;return isPercentage?`${(100*value).toFixed(1)}%`:null!==(_value$toLocaleString=value?.toLocaleString())&&void 0!==_value$toLocaleString?_value$toLocaleString:"(empty)"};return function Cell(_ref){let{value}=_ref,{compareFilter}=(0,index_esm.useValues)(webAnalyticsLogic.W);if(!value)return null;if(!Array.isArray(value))return(0,jsx_runtime.jsx)("span",{children:String(value)});let[current,previous]=value,pctChangeFromPrevious=0===previous&&0===current?0:null!==current&&compareFilter&&!1!==compareFilter.compare?null===previous||0===previous?1/0:current/previous-1:null,trend=null===pctChangeFromPrevious?null:0===pctChangeFromPrevious?{Icon:icons.cs,color:(0,colors.cM)("muted")}:pctChangeFromPrevious>0?{Icon:posthog_icons_es.IconTrending,color:reverseColors?(0,colors.cM)("danger"):(0,colors.cM)("success")}:{Icon:icons.j4,color:reverseColors?(0,colors.cM)("success"):(0,colors.cM)("danger")},tooltip=null!==pctChangeFromPrevious?`${current>=previous?"Increased":"Decreased"} by ${(0,utils.e9)(Math.abs(pctChangeFromPrevious),0)} since last period (from ${formatNumber(previous)} to ${formatNumber(current)})`:null;return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)({"pr-4":!trend}),children:(0,jsx_runtime.jsx)(src.u,{title:tooltip,children:(0,jsx_runtime.jsxs)("span",{children:[formatNumber(current),"Â ",trend&&(0,jsx_runtime.jsx)("span",{style:{color:trend.color},children:(0,jsx_runtime.jsx)(trend.Icon,{color:trend.color,className:"ml-1"})})]})})})}},SortableCell=(name,orderByField)=>function SortableCell(){let{tablesOrderBy}=(0,index_esm.useValues)(webAnalyticsLogic.W),{setTablesOrderBy}=(0,index_esm.useActions)(webAnalyticsLogic.W),isSortedByMyField=tablesOrderBy?.[0]===orderByField,isAscending=tablesOrderBy?.[1]==="ASC",onClick=(0,react.useCallback)(()=>{!isSortedByMyField||isAscending?setTablesOrderBy(orderByField,"DESC"):setTablesOrderBy(orderByField,"ASC")},[isAscending,isSortedByMyField,setTablesOrderBy]);return(0,jsx_runtime.jsxs)("span",{onClick:onClick,className:"group cursor-pointer inline-flex items-center",children:[name,(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronDown,{fontSize:"20px",className:(0,clsx_m.default)("-mr-1 ml-1 text-muted-alt opacity-0 group-hover:opacity-100",{"text-primary opacity-100":isSortedByMyField,"rotate-180":isSortedByMyField&&isAscending})})]})},webAnalyticsDataTableQueryContext={columns:{breakdown_value:{renderTitle:props=>{let{query}=props,{source}=query;if(source.kind!==schema_general.OH.WebStatsTableQuery)return null;let{breakdownBy}=source;switch(breakdownBy){case schema_general.GI.Page:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Path"});case schema_general.GI.InitialPage:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Initial Path"});case schema_general.GI.ExitPage:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"End Path"});case schema_general.GI.ExitClick:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Exit Click"});case schema_general.GI.ScreenName:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Screen Name"});case schema_general.GI.InitialChannelType:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Channel Type"});case schema_general.GI.InitialReferringDomain:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Referring Domain"});case schema_general.GI.InitialUTMSource:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Source"});case schema_general.GI.InitialUTMCampaign:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Campaign"});case schema_general.GI.InitialUTMMedium:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Medium"});case schema_general.GI.InitialUTMTerm:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Term"});case schema_general.GI.InitialUTMContent:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Content"});case schema_general.GI.Browser:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Browser"});case schema_general.GI.OS:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"OS"});case schema_general.GI.Viewport:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Viewport"});case schema_general.GI.DeviceType:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Device Type"});case schema_general.GI.Country:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Country"});case schema_general.GI.Region:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Region"});case schema_general.GI.City:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"City"});case schema_general.GI.Timezone:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Timezone"});case schema_general.GI.Language:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Language"});case schema_general.GI.FrustrationMetrics:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"URL"});case schema_general.GI.InitialUTMSourceMediumCampaign:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Source / Medium / Campaign"});default:throw new utils.q0(breakdownBy)}},render:props=>{let{value,query}=props,{source}=query;if(source.kind!==schema_general.OH.WebStatsTableQuery)return null;let{breakdownBy}=source;switch(breakdownBy){case schema_general.GI.ExitPage:case schema_general.GI.InitialPage:case schema_general.GI.Page:case schema_general.GI.FrustrationMetrics:{if("string"!=typeof value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value});let decoded=(0,utils.fB)(value);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:source.doPathCleaning?(0,PathCleanFilterItem.Z)(decoded):decoded})}case schema_general.GI.Viewport:if(Array.isArray(value)){let[width,height]=value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[width,"x",height]})}break;case schema_general.GI.Country:if("string"==typeof value)return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,country.q9)(value)," ",country.BL[value]||value]});break;case schema_general.GI.Region:if(Array.isArray(value)){let[countryCode,regionCode,regionName]=value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,country.q9)(countryCode)," ",country.BL[countryCode]||countryCode," -"," ",regionName||regionCode]})}break;case schema_general.GI.City:if(Array.isArray(value)){let[countryCode,cityName]=value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,country.q9)(countryCode)," ",country.BL[countryCode]||countryCode," -"," ",cityName]})}break;case schema_general.GI.Timezone:if("number"==typeof value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:toUtcOffsetFormat(value)});break;case schema_general.GI.Language:if("string"==typeof value){var _countryCode$match$,_countryCodeToFlag;let[languageCode,countryCode]=value.split("-"),parsedCountryCode=null!==(_countryCode$match$=countryCode?.match(/([A-Z]{2})/)?.[0])&&void 0!==_countryCode$match$?_countryCode$match$:"";return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[null!==(_countryCodeToFlag=(0,country.q9)(parsedCountryCode))&&void 0!==_countryCodeToFlag?_countryCodeToFlag:(0,country.RD)(languageCode),"Â ",country.WL[languageCode]||languageCode]})}break;case schema_general.GI.DeviceType:if("string"==typeof value)return(0,jsx_runtime.jsx)(PropertyIcon.V.WithLabel,{property:"$device_type",value:value});break;case schema_general.GI.Browser:if("string"==typeof value)return(0,jsx_runtime.jsx)(PropertyIcon.V.WithLabel,{property:"$browser",value:value});break;case schema_general.GI.OS:if("string"==typeof value)return(0,jsx_runtime.jsx)(PropertyIcon.V.WithLabel,{property:"$os",value:value})}return"string"==typeof value?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value}):null}},bounce_rate:{renderTitle:SortableCell("Bounce Rate",schema_general.nV.BounceRate),render:VariationCell({isPercentage:!0,reverseColors:!0}),align:"right"},views:{renderTitle:SortableCell("Views",schema_general.nV.Views),render:VariationCell(),align:"right"},clicks:{renderTitle:SortableCell("Clicks",schema_general.nV.Clicks),render:VariationCell(),align:"right"},visitors:{renderTitle:SortableCell("Visitors",schema_general.nV.Visitors),render:VariationCell(),align:"right"},average_scroll_percentage:{renderTitle:SortableCell("Average Scroll",schema_general.nV.AverageScrollPercentage),render:VariationCell({isPercentage:!0}),align:"right"},scroll_gt80_percentage:{renderTitle:SortableCell("Deep Scroll Rate",schema_general.nV.ScrollGt80Percentage),render:VariationCell({isPercentage:!0}),align:"right"},total_conversions:{renderTitle:SortableCell("Conversions",schema_general.nV.TotalConversions),render:VariationCell(),align:"right"},unique_conversions:{renderTitle:SortableCell("Uniques",schema_general.nV.UniqueConversions),render:VariationCell(),align:"right"},conversion_rate:{renderTitle:SortableCell("CR",schema_general.nV.ConversionRate),render:VariationCell({isPercentage:!0}),align:"right"},rage_clicks:{renderTitle:SortableCell("Rage Clicks",schema_general.nV.RageClicks),render:VariationCell(),align:"right"},dead_clicks:{renderTitle:SortableCell("Dead Clicks",schema_general.nV.DeadClicks),render:VariationCell(),align:"right"},errors:{renderTitle:SortableCell("Errors",schema_general.nV.Errors),render:VariationCell(),align:"right"},converting_users:{renderTitle:SortableCell("Converting Users",schema_general.nV.ConvertingUsers),render:VariationCell(),align:"right"},action_name:{title:"Action"},cross_sell:{title:" ",render:_ref2=>{var _record$;let{record,query}=_ref2,dateRange=query.source?.dateRange,breakdownBy=query.source?.breakdownBy,value=null!==(_record$=record[0])&&void 0!==_record$?_record$:"";return(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center justify-end",children:[(0,jsx_runtime.jsx)(ReplayButton,{date_from:dateRange?.date_from,date_to:dateRange?.date_to,breakdownBy:breakdownBy,value:value}),(0,jsx_runtime.jsx)(HeatmapButton,{breakdownBy:breakdownBy,value:value}),(0,jsx_runtime.jsx)(ErrorTrackingButton,{breakdownBy:breakdownBy,value:value})]})},align:"right"},ui_fill_fraction:{hidden:!0,isRowFillFraction:!0}}},WebStatsTrendTile=_ref3=>{let{query,showIntervalTile,insightProps}=_ref3,{togglePropertyFilter,setInterval}=(0,index_esm.useActions)(webAnalyticsLogic.W),{hasCountryFilter,dateFilter:{interval}}=(0,index_esm.useValues)(webAnalyticsLogic.W),worldMapPropertyName=common.ZB(schema_general.GI.Country)?.key,onWorldMapClick=(0,react.useCallback)(breakdownValue=>{worldMapPropertyName&&togglePropertyFilter(types.FT.Event,worldMapPropertyName,breakdownValue,{geographyTab:hasCountryFilter?void 0:common.QX.REGIONS})},[togglePropertyFilter,worldMapPropertyName,hasCountryFilter]),context=(0,react.useMemo)(()=>({...webAnalyticsDataTableQueryContext,onDataPointClick(_ref4,data){let{breakdown}=_ref4;"string"===breakdown&&data&&(data.count>0||data.aggregated_value>0)&&onWorldMapClick(breakdown)},insightProps:{...insightProps,query}}),[onWorldMapClick,insightProps,query]);return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[showIntervalTile&&(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center",children:[(0,jsx_runtime.jsx)("span",{className:"mr-2",children:"Group by"}),(0,jsx_runtime.jsx)(IntervalFilter.T,{interval:interval,onIntervalChange:setInterval})]})}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})]})},MarketingAnalyticsTrendTile=_ref5=>{let{query,showIntervalTile,insightProps}=_ref5,{setInterval,setChartDisplayType}=(0,index_esm.useActions)(marketingAnalyticsLogic.O),{dateFilter,chartDisplayType}=(0,index_esm.useValues)(marketingAnalyticsLogic.O);return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[showIntervalTile&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center mr-4",children:[(0,jsx_runtime.jsx)("span",{className:"mr-2",children:"Group by"}),(0,jsx_runtime.jsx)(IntervalFilter.T,{interval:dateFilter.interval,onIntervalChange:setInterval})]}),(0,jsx_runtime.jsx)(src.P4,{value:chartDisplayType,onChange:setChartDisplayType,options:DISPLAY_MODE_OPTIONS,size:"small"})]}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{insightProps:{...insightProps,query}}})]})},WebStatsTableTile=_ref6=>{let{query,breakdownBy,insightProps,control}=_ref6,{togglePropertyFilter}=(0,index_esm.useActions)(webAnalyticsLogic.W),{productTab}=(0,index_esm.useValues)(webAnalyticsLogic.W),{key,type}=(0,common.ZB)(breakdownBy)||{},onClick=(0,react.useCallback)(breakdownValue=>{if(key&&type){if(productTab===common.lZ.PAGE_REPORTS){LemonToast.UJ.info("Filters are not yet supported in this tile");return}togglePropertyFilter(type,key,breakdownValue)}},[togglePropertyFilter,type,key,productTab]),context=(0,react.useMemo)(()=>({...webAnalyticsDataTableQueryContext,insightProps,rowProps:record=>{if(!key||!type||breakdownBy===schema_general.GI.Language||breakdownBy===schema_general.GI.Timezone)return{};let breakdownValue=getBreakdownValue(record,breakdownBy);return void 0===breakdownValue?{}:{onClick:()=>onClick(breakdownValue)}}}),[onClick,insightProps,breakdownBy,key,type]);return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[null!=control&&(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:control}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})]})},getBreakdownValue=(record,breakdownBy)=>{if("object"!=typeof record||!record||!("result"in record))return;let result=record.result;if(!Array.isArray(result))return;let breakdownValue=result[0];switch(breakdownBy){case schema_general.GI.Country:if(Array.isArray(breakdownValue))return breakdownValue[0];break;case schema_general.GI.Region:case schema_general.GI.City:if(Array.isArray(breakdownValue))return breakdownValue[1];break;case schema_general.GI.FrustrationMetrics:if("string"==typeof breakdownValue)return breakdownValue}return null===breakdownValue?null:"string"==typeof breakdownValue?breakdownValue:void 0},WebGoalsTile=_ref7=>{let{query,insightProps}=_ref7,{actions,actionsLoading}=(0,index_esm.useValues)(actionsModel.D),{updateHasSeenProductIntroFor}=(0,index_esm.useActions)(userLogic.userLogic),{addProductIntentForCrossSell}=(0,index_esm.useActions)(teamLogic.teamLogic);return actionsLoading?null:actions.length?(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row-reverse p-2",children:(0,jsx_runtime.jsx)(LemonButton.J,{to:urls.j.actions(),onClick:()=>{addProductIntentForCrossSell({from:types.Md.WEB_ANALYTICS,to:types.Md.ACTIONS,intent_context:product_intents.kp.WEB_ANALYTICS_INSIGHT})},sideIcon:(0,jsx_runtime.jsx)(icons.pF,{}),type:"secondary",size:"small",children:"Manage actions"})}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})]}):(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Actions",productKey:types.Md.ACTIONS,thingName:"action",isEmpty:!0,description:"Use actions to combine events that you want to have tracked together or to make detailed Autocapture events easier to reuse.",docsURL:"https://posthog.com/docs/data/actions",actionElementOverride:(0,jsx_runtime.jsx)(NewActionButton.O,{onSelectOption:()=>updateHasSeenProductIntroFor(types.Md.ACTIONS,!0)})})},WebExternalClicksTile=_ref8=>{let{query,insightProps}=_ref8,{productTab,shouldStripQueryParams}=(0,index_esm.useValues)(webAnalyticsLogic.W),{setShouldStripQueryParams}=(0,index_esm.useActions)(webAnalyticsLogic.W),isPageReportsPage=productTab===common.lZ.PAGE_REPORTS;return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[!isPageReportsPage&&(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center deprecated-space-x-2",children:(0,jsx_runtime.jsx)(LemonSwitch.f,{label:"Strip query parameters",checked:shouldStripQueryParams,onChange:setShouldStripQueryParams,className:"h-full"})})}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})]})},WebVitalsPathBreakdownTile=_ref9=>{let{query,insightProps}=_ref9,{isPathCleaningEnabled}=(0,index_esm.useValues)(webAnalyticsLogic.W),{setIsPathCleaningEnabled}=(0,index_esm.useActions)(webAnalyticsLogic.W);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center gap-1 m-2",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold",children:"Path Breakdown"}),!isPathCleaningEnabled&&(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("span",{children:["Path Breakdown is more useful when path cleaning is turned on."," ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>setIsPathCleaningEnabled(!0),children:"Enable it."})]}),interactive:!0,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{className:"mb-2",fontSize:"18"})})]}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})]})},WebQuery=_ref10=>{let{query,showIntervalSelect,control,insightProps,tileId}=_ref10,{productTab,shouldStripQueryParams:stripQueryParamsDashboard}=(0,index_esm.useValues)(webAnalyticsLogic.W),{stripQueryParams:stripQueryParamsPageReports}=(0,index_esm.useValues)(pageReportsLogic.z);if(query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.WebStatsTableQuery)return query.source.breakdownBy===schema_general.GI.FrustrationMetrics?(0,jsx_runtime.jsx)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col py-2 px-1",children:(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})}):(0,jsx_runtime.jsx)(WebStatsTableTile,{query:query,breakdownBy:query.source.breakdownBy,insightProps:insightProps,control:control,tileId:tileId});if(query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.WebExternalClicksTableQuery){let effectiveStripQueryParams=productTab===common.lZ.PAGE_REPORTS?stripQueryParamsPageReports:stripQueryParamsDashboard,adjustedQuery={...query,source:{...query.source,stripQueryParams:effectiveStripQueryParams}};return(0,jsx_runtime.jsx)(WebExternalClicksTile,{query:adjustedQuery,insightProps:insightProps})}return query.kind===schema_general.OH.InsightVizNode&&tileId===common.nM.MARKETING?(0,jsx_runtime.jsx)(MarketingAnalyticsTrendTile,{query:query,showIntervalTile:showIntervalSelect,insightProps:insightProps}):query.kind===schema_general.OH.InsightVizNode?(0,jsx_runtime.jsx)(WebStatsTrendTile,{query:query,showIntervalTile:showIntervalSelect,insightProps:insightProps}):query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.WebGoalsQuery?(0,jsx_runtime.jsx)(WebGoalsTile,{query:query,insightProps:insightProps}):query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.MarketingAnalyticsTableQuery?(0,jsx_runtime.jsx)(MarketingAnalyticsTable,{query:query,insightProps:insightProps}):query.kind===schema_general.OH.WebVitalsPathBreakdownQuery?(0,jsx_runtime.jsx)(WebVitalsPathBreakdownTile,{query:query,insightProps:insightProps}):(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})}},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/components/MarketingAnalyticsTable/MarketingAnalyticsTableStyleOverride.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".marketing-analytics-table-container .DataTable__second-row{padding:1rem 1rem 0}",""]),module.exports=exports}}]);