(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{"./frontend/src/scenes/experiments/Experiment.tsx":function(Me,X,i){"use strict";i.r(X),i.d(X,"scene",function(){return ur}),i.d(X,"Experiment_",function(){return Oe}),i.d(X,"CodeLanguageSelect",function(){return It});var De=i("./node_modules/core-js/modules/es.symbol.js"),Rt=i("./node_modules/core-js/modules/es.symbol.description.js"),lt=i("./node_modules/core-js/modules/es.array.concat.js"),At=i("./node_modules/core-js/modules/es.array.filter.js"),ot=i("./node_modules/core-js/modules/es.array.map.js"),kt=i("./node_modules/core-js/modules/es.array.reduce.js"),ct=i("./node_modules/core-js/modules/es.function.name.js"),_t=i("./node_modules/core-js/modules/es.number.constructor.js"),mt=i("./node_modules/core-js/modules/es.number.to-fixed.js"),Yt=i("./node_modules/core-js/modules/es.object.keys.js"),dt=i("./node_modules/core-js/modules/es.object.to-string.js"),Ut=i("./node_modules/core-js/modules/es.regexp.to-string.js"),ze=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),fe=i.n(ze),Ke=i("./node_modules/@babel/runtime/helpers/slicedToArray.js"),W=i.n(Ke),Y=i("./node_modules/antd/es/form/index.js"),f=i("./node_modules/antd/es/row/index.js"),v=i("./node_modules/antd/es/col/index.js"),te=i("./node_modules/antd/es/input/index.js"),ve=i("./node_modules/antd/es/tooltip/index.js"),Q=i("./node_modules/antd/es/button/index.js"),A=i("./node_modules/antd/es/select/index.js"),J=i("./node_modules/antd/es/card/index.js"),oe=i("./node_modules/antd/es/tag/index.js"),Ce=i("./node_modules/antd/es/collapse/index.js"),Fe=i("./node_modules/antd/es/progress/index.js"),Pe=i("./node_modules/antd/es/skeleton/index.js"),D=i("./node_modules/kea/lib/index.esm.js"),ce=i("./frontend/src/lib/components/PageHeader.tsx"),Z=i("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),he=i("./frontend/src/lib/components/PropertyFilters/utils.ts"),O=i("./frontend/src/lib/components/TaxonomicFilter/types.ts"),L=i("./node_modules/react/index.js"),e=i.n(L),G=i("./frontend/src/scenes/funnels/funnelLogic.ts"),k=i("./frontend/src/scenes/insights/ActionFilter/ActionFilter.tsx"),_=i("./frontend/src/scenes/insights/insightLogic.ts"),d=i("./frontend/src/types.ts"),ge=i("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Vt=i.n(ge),Bt=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss"),ut=i.n(Bt),We={};We.insert="head",We.singleton=!1;var Vr=Vt()(ut.a,We),Br=ut.a.locals||{},$r=i("./node_modules/core-js/modules/es.array.fill.js"),zr=i("./node_modules/core-js/modules/es.array.find.js"),Kr=i("./node_modules/core-js/modules/es.array.find-index.js"),Wr=i("./node_modules/core-js/modules/es.array.iterator.js"),Gr=i("./node_modules/core-js/modules/es.array.splice.js"),Hr=i("./node_modules/core-js/modules/es.number.epsilon.js"),Jr=i("./node_modules/core-js/modules/es.object.values.js"),Xr=i("./node_modules/core-js/modules/web.dom-collections.iterator.js"),$t=i("./node_modules/@babel/runtime/regenerator/index.js"),S=i.n($t),Qr=i("./node_modules/regenerator-runtime/runtime.js"),zt=i("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),V=i.n(zt),Kt=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),re=i.n(Kt),me=i("./frontend/src/lib/api.ts"),T=i("./frontend/src/lib/dayjs.ts"),M=i("./frontend/src/lib/utils.tsx"),Wt=["furry","amusing","charming","tame","swift","clever","pleasant","tiny","wild","herbivorous","admirable","adorable","agile","beautiful","bossy","candid","cold","colorful","cuddly","curious","cute","energetic","fast","feisty","fierce","fluffy","friendly","fuzzy","grumpy","hairy","heavy","large","lazy","loud","lovable","loving","enchanted","maternal","sweet","messy","nocturnal","noisy","nosy","picky","playful","quick","sassy","scaly","short","shy","slow","small","smart","soft","strong","tall","tenacious","glorious","warm","cheerful","gracious"],Gt=["aardvark","albatross","alligator","alpaca","ant","anteater","antelope","ape","armadillo","donkey","baboon","badger","barracuda","bat","bear","beaver","bee","bison","boar","buffalo","butterfly","camel","capybara","caribou","cassowary","cat","caterpillar","cattle","chamois","cheetah","chicken","chimpanzee","chinchilla","chough","clam","cobra","cockroach","cod","cormorant","coyote","crab","crane","crocodile","crow","curlew","deer","dinosaur","dog","dogfish","dolphin","dotterel","dove","dragonfly","duck","dugong","dunlin","eagle","echidna","eel","eland","elephant","elk","emu","falcon","ferret","finch","firefox","fish","flamingo","fly","fox","frog","gaur","gazelle","gerbil","giraffe","gnat","gnu","goat","goldfinch","goldfish","goose","gorilla","goshawk","grasshopper","grouse","guanaco","gull","hamster","hare","hawk","hedgehog","heron","herring","hippopotamus","hornet","horse","human","hummingbird","hyena","ibex","ibis","jackal","jaguar","jay","jellyfish","kangaroo","kingfisher","koala","kookabura","kouprey","kudu","lapwing","lark","lemur","leopard","lion","llama","lobster","locust","loris","louse","lyrebird","magpie","mallard","manatee","mandrill","mantis","marten","meerkat","mink","mole","mongoose","monkey","moose","mosquito","mouse","mule","narwhal","newt","nightingale","octopus","okapi","opossum","oryx","ostrich","otter","owl","oyster","panther","parrot","partridge","peafowl","pelican","penguin","pheasant","pig","pigeon","pony","porcupine","porpoise","quail","quelea","quetzal","rabbit","raccoon","rail","ram","rat","raven","reindeer","rhinoceros","rook","salamander","salmon","sandpiper","sardine","scorpion","seahorse","seal","shark","sheep","shrew","skunk","snail","snake","sparrow","spider","spoonbill","squid","squirrel","starling","stingray","stinkbug","stork","swallow","swan","tapir","tarsier","termite","tiger","toad","trout","turkey","turtle","viper","vulture","wallaby","walrus","wasp","weasel","whale","wildcat","wolf","wolverine","wombat","woodcock","woodpecker","worm","wren","yak","zebra"];function pt(){return"".concat(Object(M.j)(Object(M.ub)(Wt))," ").concat(Object(M.j)(Object(M.ub)(Gt)))}var Le=i("./frontend/src/scenes/insights/utils/cleanFilters.ts"),Ge=i("./frontend/src/scenes/teamLogic.ts"),ae=i("./frontend/src/scenes/urls.ts"),Ee=i("./node_modules/kea-router/lib/index.js"),Ht=i("./frontend/src/scenes/experiments/experimentsLogic.ts"),de=i("./frontend/src/lib/constants.tsx"),He=i("./frontend/src/scenes/trends/trendsLogic.ts"),xe=i("./frontend/src/lib/utils/eventUsageLogic.ts"),Jt=i("./frontend/src/scenes/userLogic.ts"),ft=i("./frontend/src/lib/components/Tooltip.tsx"),ye=i("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),Xt=i("./frontend/src/models/groupsModel.ts"),Re=i("./frontend/src/lib/components/lemonToast.tsx");function vt(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),a.push.apply(a,n)}return a}function x(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?vt(Object(a),!0).forEach(function(n){fe()(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):vt(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}var be=14,we=Object(D.kea)({props:{},key:function(r){return r.experimentId||"new"},path:function(r){return["scenes","experiment","experimentLogic",r]},connect:{values:[Ge.a,["currentTeamId"],Jt.a,["hasAvailableFeature"],Xt.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]],actions:[Ht.a,["updateExperiments","addToExperiments"]]},actions:{setExperiment:function(r){return{experiment:r}},createExperiment:function(r,a,n){return{draft:r,runningTime:a,sampleSize:n}},setExperimentInsightId:function(r){return{shortId:r}},createNewExperimentInsight:function(r){return{filters:r}},setFilters:function(r){return{filters:r}},setNewExperimentData:function(r){return{experimentData:r}},updateExperimentGroup:function(r,a){return{variant:r,idx:a}},removeExperimentGroup:function(r){return{idx:r}},setExperimentInsightType:function(r){return{insightType:r}},setEditExperiment:function(r){return{editing:r}},setSecondaryMetrics:function(r){return{secondaryMetrics:r}},resetNewExperiment:!0,launchExperiment:!0,endExperiment:!0,addExperimentGroup:!0,archiveExperiment:!0},reducers:{newExperimentData:[null,{setNewExperimentData:function(r,a){var n=a.experimentData;if(n.filters){var c=x(x({},r==null?void 0:r.filters),n.filters);return x(x(x({},r),n),{},{filters:c})}if(n.parameters){var u=x(x({},r==null?void 0:r.parameters),n.parameters);return x(x(x({},r),n),{},{parameters:u})}return x(x({},r),n)},updateExperimentGroup:function(r,a){var n,c=a.variant,u=a.idx,m=re()((r==null||(n=r.parameters)===null||n===void 0?void 0:n.feature_flag_variants)||[]);return m[u]=x(x({},m[u]),c),x(x({},r),{},{parameters:x(x({},r==null?void 0:r.parameters),{},{feature_flag_variants:m})})},addExperimentGroup:function(r){var a;if(!(r==null||(a=r.parameters)===null||a===void 0)&&a.feature_flag_variants){var n=gt(r.parameters.feature_flag_variants.length+1),c=r.parameters.feature_flag_variants.map(function(u,m){return x(x({},u),{},{rollout_percentage:n[m]})});return x(x({},r),{},{parameters:x(x({},r.parameters),{},{feature_flag_variants:[].concat(re()(c),[{key:"test_group_".concat(r.parameters.feature_flag_variants.length),rollout_percentage:n[n.length-1]}])})})}return r},removeExperimentGroup:function(r,a){var n,c,u=a.idx;if(!r)return r;var m=re()(((n=r.parameters)===null||n===void 0?void 0:n.feature_flag_variants)||[]);m.splice(u,1);var s=gt(((r==null||(c=r.parameters)===null||c===void 0?void 0:c.feature_flag_variants)||[]).length-1),p=m.map(function(l,w){return x(x({},l),{},{rollout_percentage:s[w]})});return x(x({},r),{},{parameters:x(x({},r.parameters),{},{feature_flag_variants:p})})},setSecondaryMetrics:function(r,a){var n=a.secondaryMetrics,c=n.map(function(u){return u});return x(x({},r),{},{secondary_metrics:c})},resetNewExperiment:function(){return{parameters:{feature_flag_variants:[{key:"control",rollout_percentage:50},{key:"test",rollout_percentage:50}]}}}}],experimentInsightType:[d.s.TRENDS,{setExperimentInsightType:function(r,a){var n=a.insightType;return n}}],experimentInsightId:[null,{setExperimentInsightId:function(r,a){var n=a.shortId;return n}}],editingExistingExperiment:[!1,{setEditExperiment:function(r,a){var n=a.editing;return n}}]},listeners:function(r){var a=r.values,n=r.props,c=r.actions;return{createExperiment:function(){var u=V()(S.a.mark(function s(p){var l,w,I,j,g,E,o,B,H,q;return S.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(w=p.draft,I=p.runningTime,j=p.sampleSize,g=null,E=!!n.experimentId&&n.experimentId!=="new",h.prev=3,!E){h.next=14;break}return h.next=7,me.a.update("api/projects/".concat(a.currentTeamId,"/experiments/").concat(n.experimentId),x(x({},a.newExperimentData),{},{parameters:x(x({},(o=a.newExperimentData)===null||o===void 0?void 0:o.parameters),{},{recommended_running_time:I,recommended_sample_size:j})},!w&&{start_date:Object(T.a)()}));case 7:if(g=h.sent,!(!((B=g)===null||B===void 0)&&B.id)){h.next=12;break}return c.updateExperiments(g),Ee.router.actions.push(ae.a.experiment(g.id)),h.abrupt("return");case 12:h.next=18;break;case 14:return h.next=16,me.a.create("api/projects/".concat(a.currentTeamId,"/experiments"),x(x({},a.newExperimentData),{},{parameters:x(x({},(H=a.newExperimentData)===null||H===void 0?void 0:H.parameters),{},{recommended_running_time:I,recommended_sample_size:j})},!w&&{start_date:Object(T.a)()}));case 16:g=h.sent,g&&xe.f.actions.reportExperimentCreated(g);case 18:h.next=24;break;case 20:return h.prev=20,h.t0=h.catch(3),Re.a.error(h.t0.detail||"Failed to create experiment"),h.abrupt("return");case 24:!((l=g)===null||l===void 0)&&l.id&&(q=g.id,Ee.router.actions.push(ae.a.experiment(q)),c.addToExperiments(g),Re.a.success("Experiment ".concat(E?"updated":"created"),{button:{label:"View it",action:function(){Ee.router.actions.push(ae.a.experiment(q))}}}));case 25:case"end":return h.stop()}},s,null,[[3,20]])}));function m(s){return u.apply(this,arguments)}return m}(),createNewExperimentInsight:function(){var u=V()(S.a.mark(function s(p){var l,w,I,j;return S.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return l=p.filters,a.experimentInsightType===d.s.FUNNELS?w=Object(Le.a)(x({insight:d.s.FUNNELS,funnel_viz_type:d.o.Steps,display:d.d.FunnelViz,date_from:Object(T.a)().subtract(be,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:de.p.horizontal},l)):w=Object(Le.a)(x({insight:d.s.TRENDS,date_from:Object(T.a)().subtract(be,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},l)),I={name:pt(),description:"",tags:[],filters:w,result:null},E.next=5,me.a.create("api/projects/".concat(a.currentTeamId,"/insights"),I);case 5:j=E.sent,c.setExperimentInsightId(j.short_id),c.setNewExperimentData({filters:x({},I.filters)});case 8:case"end":return E.stop()}},s)}));function m(s){return u.apply(this,arguments)}return m}(),setFilters:function(m){var s=m.filters;if(a.experimentInsightType===d.s.FUNNELS){var p;(p=G.a.findMounted({dashboardItemId:a.experimentInsightId}))===null||p===void 0||p.actions.setFilters(s)}else{var l;(l=He.a.findMounted({dashboardItemId:a.experimentInsightId}))===null||l===void 0||l.actions.setFilters(s)}},loadExperimentSuccess:function(){var u=V()(S.a.mark(function s(p){var l;return S.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:l=p.experimentData,l&&xe.f.actions.reportExperimentViewed(l),c.setExperimentInsightType((l==null?void 0:l.filters.insight)||d.s.FUNNELS),l!=null&&l.start_date?(c.resetNewExperiment(),c.loadExperimentResults(),c.loadSecondaryMetricResults()):(c.setNewExperimentData(x({},l)),c.createNewExperimentInsight(l==null?void 0:l.filters));case 4:case"end":return I.stop()}},s)}));function m(s){return u.apply(this,arguments)}return m}(),launchExperiment:function(){var u=V()(S.a.mark(function s(){var p;return S.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:p=Object(T.a)(),c.updateExperiment({start_date:p.format("YYYY-MM-DDTHH:mm")}),a.experimentData&&xe.f.actions.reportExperimentLaunched(a.experimentData,p);case 3:case"end":return w.stop()}},s)}));function m(){return u.apply(this,arguments)}return m}(),endExperiment:function(){var u=V()(S.a.mark(function s(){var p,l,w;return S.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:l=Object(T.a)(),c.updateExperiment({end_date:l.format("YYYY-MM-DDTHH:mm")}),w=l.diff((p=a.experimentData)===null||p===void 0?void 0:p.start_date,"second"),a.experimentData&&xe.f.actions.reportExperimentCompleted(a.experimentData,l,w,a.areResultsSignificant);case 4:case"end":return j.stop()}},s)}));function m(){return u.apply(this,arguments)}return m}(),archiveExperiment:function(){var u=V()(S.a.mark(function s(){return S.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:c.updateExperiment({archived:!0}),a.experimentData&&xe.f.actions.reportExperimentArchived(a.experimentData);case 2:case"end":return l.stop()}},s)}));function m(){return u.apply(this,arguments)}return m}(),setExperimentInsightType:function(){if(n.experimentId==="new"||a.editingExistingExperiment)c.createNewExperimentInsight();else{var m;c.createNewExperimentInsight((m=a.experimentData)===null||m===void 0?void 0:m.filters)}},updateExperimentSuccess:function(){var u=V()(S.a.mark(function s(p){var l;return S.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:l=p.experimentData,c.updateExperiments(l);case 2:case"end":return I.stop()}},s)}));function m(s){return u.apply(this,arguments)}return m}()}},loaders:function(r){var a=r.values,n=r.props;return{experimentData:[null,{loadExperiment:function(){var c=V()(S.a.mark(function m(){var s;return S.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(n.experimentId&&n.experimentId!=="new")){l.next=16;break}return l.prev=1,l.next=4,me.a.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(n.experimentId));case 4:return s=l.sent,l.abrupt("return",s);case 8:if(l.prev=8,l.t0=l.catch(1),l.t0.status!==404){l.next=14;break}Ee.router.actions.push(ae.a.experiments()),l.next=16;break;case 14:throw Re.a.error("Failed to load experiment ".concat(n.experimentId)),new Error("Failed to load experiment ".concat(n.experimentId));case 16:return l.abrupt("return",null);case 17:case"end":return l.stop()}},m,null,[[1,8]])}));function u(){return c.apply(this,arguments)}return u}(),updateExperiment:function(){var c=V()(S.a.mark(function m(s){var p;return S.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,me.a.update("api/projects/".concat(a.currentTeamId,"/experiments/").concat(n.experimentId),s);case 2:return p=w.sent,w.abrupt("return",p);case 4:case"end":return w.stop()}},m)}));function u(m){return c.apply(this,arguments)}return u}()}],experimentResults:[null,{loadExperimentResults:function(){var c=V()(S.a.mark(function m(){var s;return S.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,l.next=3,me.a.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(n.experimentId,"/results"));case 3:return s=l.sent,l.abrupt("return",x(x({},s),{},{itemID:Math.random().toString(36).substring(2,15)}));case 7:if(l.prev=7,l.t0=l.catch(0),l.t0.code!=="no_data"){l.next=11;break}return l.abrupt("return",null);case 11:return Re.a.error(l.t0.detail||"Failed to load experiment results"),l.abrupt("return",null);case 13:case"end":return l.stop()}},m,null,[[0,7]])}));function u(){return c.apply(this,arguments)}return u}()}],secondaryMetricResults:[null,{loadSecondaryMetricResults:function(){var c=V()(S.a.mark(function m(){var s,p,l,w;return S.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:s=[],p=0;case 2:if(!(p<(((l=a.experimentData)===null||l===void 0?void 0:l.secondary_metrics.length)||0))){j.next=10;break}return j.next=5,me.a.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(n.experimentId,"/secondary_results?id=").concat(p));case 5:w=j.sent,s.push(w.result);case 7:p++,j.next=2;break;case 10:return j.abrupt("return",s);case 11:case"end":return j.stop()}},m)}));function u(){return c.apply(this,arguments)}return u}()}]}},selectors:{breadcrumbs:[function(t){return[t.experimentData,function(r,a){return a.experimentId}]},function(t,r){return[{name:"Experiments",path:ae.a.experiments()},{name:(t==null?void 0:t.name)||"New Experiment",path:ae.a.experiment(r||"new")}]}],variants:[function(t){return[t.newExperimentData,t.experimentData]},function(t,r){var a,n;if(r!=null&&r.start_date){var c;return(r==null||(c=r.parameters)===null||c===void 0?void 0:c.feature_flag_variants)||[]}return(t==null||(a=t.parameters)===null||a===void 0?void 0:a.feature_flag_variants)||(r==null||(n=r.parameters)===null||n===void 0?void 0:n.feature_flag_variants)||[]}],taxonomicGroupTypesForSelection:[function(t){return[t.newExperimentData,t.groupsTaxonomicTypes]},function(t,r){var a;return(t==null||(a=t.filters)===null||a===void 0?void 0:a.aggregation_group_type_index)!=null&&r.length>0?[r[t.filters.aggregation_group_type_index]]:[O.a.PersonProperties,O.a.Cohorts]}],parsedSecondaryMetrics:[function(t){return[t.newExperimentData,t.experimentData]},function(t,r){var a=(t==null?void 0:t.secondary_metrics)||(r==null?void 0:r.secondary_metrics)||[];return a}],minimumDetectableChange:[function(t){return[t.newExperimentData]},function(t){var r;return(t==null||(r=t.parameters)===null||r===void 0?void 0:r.minimum_detectable_effect)||5}],minimumSampleSizePerVariant:[function(t){return[t.minimumDetectableChange]},function(t){return function(r){return Math.ceil(1600*r*(1-r/100)/(t*t))}}],areResultsSignificant:[function(t){return[t.experimentResults]},function(t){return(t==null?void 0:t.significant)||!1}],significanceBannerDetails:[function(t){return[t.experimentResults]},function(t){if((t==null?void 0:t.significance_code)===d.E.HighLoss){var r;return e.a.createElement(e.a.Fragment,null,"This is because the expected loss in conversion is greater than 1%",e.a.createElement(ft.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(r=((t==null?void 0:t.expected_loss)||0)*100)===null||r===void 0?void 0:r.toFixed(2),"%")},e.a.createElement(ye.a,{style:{padding:"4px 2px"}})),".")}if((t==null?void 0:t.significance_code)===d.E.HighPValue){var a;return e.a.createElement(e.a.Fragment,null,"This is because the p value is greater than 0.05",e.a.createElement(ft.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(t==null||(a=t.p_value)===null||a===void 0?void 0:a.toFixed(3))||1,".")},e.a.createElement(ye.a,{style:{padding:"4px 2px"}})),".")}return(t==null?void 0:t.significance_code)===d.E.LowWinProbability?"This is because the win probability of all test variants combined is less than 90%.":(t==null?void 0:t.significance_code)===d.E.NotEnoughExposure?"This is because we need at least 100 people per variant to declare significance.":""}],recommendedExposureForCountData:[function(t){return[t.minimumDetectableChange]},function(t){return function(r){var a=r*t/100,n=r,c=a+r;return parseFloat((4/Math.pow(Math.sqrt(n/be)-Math.sqrt(c/be),2)).toFixed(1))}}],expectedRunningTime:[function(){return[]},function(){return function(t,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:be;return parseFloat((r/(t/a)).toFixed(1))}}],conversionRateForVariant:[function(t){return[t.experimentResults]},function(t){return function(r){var a="Can't find variant";if(!t)return a;var n=(t==null?void 0:t.insight).find(function(c){var u,m;return((u=c[0])===null||u===void 0||(m=u.breakdown_value)===null||m===void 0?void 0:m[0])===r});return n?(n[n.length-1].count/n[0].count*100).toFixed(1):a}}],getIndexForVariant:[function(t){return[t.experimentResults]},function(t){return function(r,a){if(!t)return 0;var n=-1;return a===d.s.FUNNELS?n=re()(t==null?void 0:t.insight).sort(function(c,u){var m,s;return((m=u[0])===null||m===void 0?void 0:m.count)-((s=c[0])===null||s===void 0?void 0:s.count)}).findIndex(function(c){var u,m;return((u=c[0])===null||u===void 0||(m=u.breakdown_value)===null||m===void 0?void 0:m[0])===r}):n=(t==null?void 0:t.insight).findIndex(function(c){return c.breakdown_value===r}),n===-1?0:n}}],countDataForVariant:[function(t){return[t.experimentResults]},function(t){return function(r){var a="Can't find variant";if(!t)return a;var n=(t==null?void 0:t.insight).find(function(c){return c.breakdown_value===r});return n?n.count.toString():a}}],highestProbabilityVariant:[function(t){return[t.experimentResults]},function(t){if(t){var r=Math.max.apply(Math,re()(Object.values(t.probability)));return Object.keys(t.probability).find(function(a){return Math.abs(t.probability[a]-r)<Number.EPSILON})}}],areTrendResultsConfusing:[function(t){return[t.experimentResults,t.highestProbabilityVariant]},function(t,r){if(!t)return!1;var a=(t==null?void 0:t.insight).reduce(function(n,c){return c.count>n.count?c:n},{count:0,breakdown_value:""});return a.count?a.breakdown_value!==r:!1}]},urlToAction:function(r){var a=r.actions,n=r.values,c=r.props;return{"/experiments/:id":function(m){var s=m.id;if(!n.hasAvailableFeature(d.c.EXPERIMENTATION)){Ee.router.actions.push("/experiments");return}if(s){var p=s==="new"?"new":parseInt(s);p==="new"&&(a.createNewExperimentInsight(),a.resetNewExperiment(),a.setSecondaryMetrics([])),a.setEditExperiment(!1),p!=="new"&&p===c.experimentId&&a.loadExperiment()}}}}});function gt(t){var r=Math.round(100/t),a=r*t,n=a-100,c=new Array(t).fill(r);return c[t-1]=r-n,c}var Je=i("./frontend/src/scenes/insights/InsightContainer.tsx"),ne=i("./frontend/src/lib/components/icons.tsx"),Qt=i("./node_modules/@ant-design/icons/es/icons/ExclamationCircleFilled.js"),Zt=i("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),Ae=i("./node_modules/@ant-design/icons/es/icons/CaretDownOutlined.js"),Et=i("./node_modules/@ant-design/icons/es/icons/CloseOutlined.js"),qt=i("./frontend/src/lib/components/CopyToClipboard.tsx"),ht=i("./frontend/src/scenes/funnels/funnelUtils.ts"),er=i("./node_modules/antd/es/modal/index.js"),tr=i("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),xt=i("./frontend/src/lib/api.mock.ts");function yt(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),a.push.apply(a,n)}return a}function ue(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?yt(Object(a),!0).forEach(function(n){fe()(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):yt(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}var bt=14,Xe={name:"",filters:{insight:d.s.TRENDS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}]}},rr={name:"",filters:{insight:d.s.FUNNELS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}],layout:de.p.horizontal}},ar=Object(D.kea)({props:{},path:["scenes","experiment","secondaryMetricsLogic"],connect:{values:[Ge.a,["currentTeamId"]]},actions:{setSecondaryMetrics:function(r){return{secondaryMetrics:r}},createNewMetric:!0,addNewMetric:function(r){return{metric:r}},updateMetricFilters:function(r){return{filters:r}},setFilters:function(r){return{filters:r}},setPreviewInsightId:function(r){return{shortId:r}},createPreviewInsight:function(r){return{filters:r}},showModal:!0,hideModal:!1,changeInsightType:function(r){return{type:r}},setCurrentMetricName:function(r){return{name:r}},deleteMetric:function(r){return{metricId:r}}},loaders:function(r){var a=r.values;return{experiments:[[],{loadExperiments:function(){var n=V()(S.a.mark(function u(){var m;return S.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,xt.c.get("api/projects/".concat(a.currentTeamId,"/experiments"));case 2:return m=p.sent,p.abrupt("return",m.results);case 4:case"end":return p.stop()}},u)}));function c(){return n.apply(this,arguments)}return c}()}]}},reducers:function(r){var a=r.props;return{previewInsightId:[null,{setPreviewInsightId:function(c,u){var m=u.shortId;return m}}],metrics:[a.initialMetrics,{addNewMetric:function(c,u){var m=u.metric;return[].concat(re()(c),[ue({},m)])},deleteMetric:function(c,u){var m=u.metricId;return c.filter(function(s,p){return p!==m})}}],modalVisible:[!1,{showModal:function(){return!0},hideModal:function(){return!1}}],currentMetricName:["",{setCurrentMetricName:function(c,u){var m=u.name;return m}}],currentMetric:[Xe,{changeInsightType:function(c,u){var m=u.type;return m===d.s.TRENDS?Xe:c.filters.insight===d.s.TRENDS?rr:Xe},updateMetricFilters:function(c,u){var m=u.filters;return ue(ue({},c),{},{filters:m})}}]}},listeners:function(r){var a=r.actions,n=r.values,c=r.props;return{createPreviewInsight:function(){var u=V()(S.a.mark(function s(p){var l,w,I,j;return S.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return l=p.filters,(l==null?void 0:l.insight)===d.s.FUNNELS?w=Object(Le.a)(ue({insight:d.s.FUNNELS,funnel_viz_type:d.o.Steps,display:d.d.FunnelViz,date_from:Object(T.a)().subtract(bt,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:de.p.horizontal},l)):w=Object(Le.a)(ue({insight:d.s.TRENDS,date_from:Object(T.a)().subtract(bt,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},l)),I={name:pt(),description:"",tags:[],filters:w,result:null},E.next=5,xt.c.create("api/projects/".concat(Ge.a.values.currentTeamId,"/insights"),I);case 5:j=E.sent,a.setPreviewInsightId(j.short_id);case 7:case"end":return E.stop()}},s)}));function m(s){return u.apply(this,arguments)}return m}(),setFilters:function(m){var s=m.filters;if(s.insight===d.s.FUNNELS){var p;(p=G.a.findMounted({dashboardItemId:n.previewInsightId}))===null||p===void 0||p.actions.setFilters(s)}else{var l;(l=He.a.findMounted({dashboardItemId:n.previewInsightId}))===null||l===void 0||l.actions.setFilters(s)}},createNewMetric:function(){a.addNewMetric(ue(ue({},n.currentMetric),{},{name:n.currentMetricName})),c.onMetricsChange(n.metrics),a.changeInsightType(d.s.TRENDS),a.setCurrentMetricName("")},deleteMetric:function(){c.onMetricsChange(n.metrics)},changeInsightType:function(){return a.createPreviewInsight(n.currentMetric.filters)}}},events:function(r){var a=r.actions;return{afterMount:function(){a.createPreviewInsight()}}}});function wt(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),a.push.apply(a,n)}return a}function ie(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?wt(Object(a),!0).forEach(function(n){fe()(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):wt(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}function ke(t){var r=t.onMetricsChange,a=t.initialMetrics,n=ar({onMetricsChange:r,initialMetrics:a}),c=Object(D.useValues)(n),u=c.previewInsightId,m=c.metrics,s=c.modalVisible,p=c.currentMetric,l=Object(D.useActions)(n),w=l.createNewMetric,I=l.updateMetricFilters,j=l.setFilters,g=l.showModal,E=l.hideModal,o=l.changeInsightType,B=l.setCurrentMetricName,H=l.deleteMetric,q=Object(D.useValues)(Object(_.b)({dashboardItemId:u,syncWithUrl:!1})),pe=q.insightProps,h=Object(D.useValues)(Object(G.a)(pe)),se=h.isStepsEmpty,le=h.filterSteps;return e.a.createElement(e.a.Fragment,null,e.a.createElement(er.a,{title:"Add secondary metric",visible:s,destroyOnClose:!0,onCancel:E,onOk:function(){w(),E()},okText:"Save",style:{minWidth:600}},e.a.createElement(Y.a,{layout:"vertical",initialValues:{name:"",type:d.s.TRENDS},onValuesChange:function(C){C.name&&B(C.name)}},e.a.createElement(Y.a.Item,{name:"name",label:"Name"},e.a.createElement(te.a,null)),e.a.createElement(Y.a.Item,{name:"type",label:"Type"},e.a.createElement(A.a,{style:{display:"flex"},value:p.filters.insight,onChange:function(){o()},suffixIcon:e.a.createElement(Ae.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(A.a.Option,{value:d.s.TRENDS},e.a.createElement(v.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(A.a.Option,{value:d.s.FUNNELS},e.a.createElement(v.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel")))))),e.a.createElement(Y.a.Item,{name:"query",label:"Query"},e.a.createElement(J.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},p.filters.insight===d.s.FUNNELS&&e.a.createElement(k.a,{filters:p.filters,setFilters:function(C){var $=ie(ie({},p.filters),{},{insight:d.s.FUNNELS},C);I($),j($)},typeKey:"funnel-preview-metric",hideMathSelector:!0,hideDeleteBtn:le.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!se,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[O.a.EventProperties,O.a.PersonProperties,O.a.Cohorts,O.a.Elements],rowClassName:"action-filters-bordered"}),p.filters.insight===d.s.TRENDS&&e.a.createElement(k.a,{entitiesLimit:1,horizontalUI:!0,filters:p.filters,setFilters:function(C){var $=ie(ie({},p.filters),{},{insight:d.s.TRENDS},C);I($),j($)},typeKey:"trend-preview-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[O.a.EventProperties,O.a.PersonProperties,O.a.Cohorts,O.a.Elements]}))),e.a.createElement(Y.a.Item,{name:"metric-preview",label:"Metric preview"},e.a.createElement(D.BindLogic,{logic:_.b,props:pe},e.a.createElement(Je.a,{disableHeader:!0,disableTable:!0}))))),e.a.createElement(f.a,null,e.a.createElement(v.a,null,m.map(function(N,C){return e.a.createElement(f.a,{key:C,className:"mt"},e.a.createElement(f.a,{align:"middle",className:"full-width border-all",style:{padding:8}},e.a.createElement("div",{style:{fontWeight:500}},"Name")," ",e.a.createElement("div",{className:"metric-name"},N.name?N.name:"".concat(N.filters.insight," metric")),e.a.createElement(tr.a,{className:"text-danger",style:{padding:8},onClick:function(){return H(C)}})),e.a.createElement(J.a,{className:"full-width",style:{borderTop:"none"},bodyStyle:{padding:0}},N.filters.insight===d.s.FUNNELS&&e.a.createElement(k.a,{filters:N.filters,setFilters:function(ee){var U=ie(ie({},N.filters),{},{insight:d.s.FUNNELS},ee);I(U),j(U)},typeKey:"funnel-preview-".concat(C),hideMathSelector:!0,hideDeleteBtn:le.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!se,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[O.a.EventProperties,O.a.PersonProperties,O.a.Cohorts,O.a.Elements],rowClassName:"action-filters-bordered",readOnly:!0}),N.filters.insight===d.s.TRENDS&&e.a.createElement(k.a,{horizontalUI:!0,filters:N.filters,setFilters:function(ee){var U=ie(ie({},N.filters),{},{insight:d.s.TRENDS},ee);I(U),j(U)},typeKey:"trend-preview-".concat(C),buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[O.a.EventProperties,O.a.PersonProperties,O.a.Cohorts,O.a.Elements],readOnly:!0})))}),m&&!(m.length>2)&&e.a.createElement(v.a,null,e.a.createElement("div",{className:"mb-05 mt"},e.a.createElement(Q.a,{style:{color:"var(--primary)",minWidth:240},onClick:g},"Add metric"))))))}try{ke.displayName="SecondaryMetrics",ke.__docgenInfo={description:"",displayName:"SecondaryMetrics",props:{onMetricsChange:{defaultValue:null,description:"",name:"onMetricsChange",required:!0,type:{name:"(metrics: SecondaryExperimentMetric[]) => void"}},initialMetrics:{defaultValue:null,description:"",name:"initialMetrics",required:!0,type:{name:"SecondaryExperimentMetric[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"]={docgenInfo:ke.__docgenInfo,name:"SecondaryMetrics",path:"frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"})}catch(t){}var Nt=i("./frontend/src/lib/colors.ts"),nr=i("./frontend/src/lib/components/EntityFilterInfo.tsx"),ir=i("./frontend/src/lib/components/EditableField/EditableField.tsx"),sr=i("./frontend/src/lib/components/Link.tsx"),lr=i("./frontend/src/lib/logic/featureFlagLogic.ts"),or=i("./node_modules/antd/es/slider/index.js"),cr=i("./node_modules/antd/es/input-number/index.js"),mr=i("./frontend/src/lib/components/InsightLabel/index.tsx"),jt=i("./frontend/src/lib/components/PropertyFilters/components/PropertyFilterButton.tsx");function dr(){var t=Object(L.useState)(!1),r=W()(t,2),a=r[0],n=r[1],c=Object(L.useState)(!1),u=W()(c,2),m=u[0],s=u[1];return e.a.createElement(J.a,{className:"experiment-workflow",title:e.a.createElement("span",{className:"card-secondary"},"Experiment workflow")},e.a.createElement(f.a,null,e.a.createElement(v.a,{className:"exp-workflow-step step-completed full-width"},e.a.createElement(f.a,{align:"middle"},e.a.createElement(ne.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}),e.a.createElement("b",{className:"ml-05"},"Create experiment")),e.a.createElement("div",{className:"ml-2"},"Set variants, select participants, and add secondary metrics"))),e.a.createElement(f.a,null,e.a.createElement(v.a,{className:"full-width exp-workflow-step ".concat(a?"step-completed":""),onClick:function(){return n(!a)}},e.a.createElement(f.a,{align:"middle"},a?e.a.createElement(ne.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(ne.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-05"},"Validate experiment")),e.a.createElement("div",{className:"ml-2"},"Once you've written your code, it's a good idea to test that each variant behaves as you'd expect."))),e.a.createElement(f.a,null,e.a.createElement(v.a,{className:"full-width exp-workflow-step ".concat(m?"step-completed":""),onClick:function(){return s(!m)}},e.a.createElement(f.a,{align:"middle"},m?e.a.createElement(ne.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(ne.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-05"},"Launch experiment")),e.a.createElement("div",{className:"ml-2"},"Run your experiment, monitor results, and decide when to terminate your experiment."))))}function Ne(t){var r,a,n,c,u,m,s=t.experiment,p=t.trendCount,l=t.funnelConversionRate,w=t.trendExposure,I=t.funnelSampleSize,j=t.funnelEntrants,g=(s==null?void 0:s.id)||"new",E=Object(D.useValues)(we({experimentId:g})),o=E.experimentInsightType,B=E.editingExistingExperiment,H=E.minimumDetectableChange,q=E.expectedRunningTime,pe=E.aggregationLabel,h=Object(D.useActions)(we({experimentId:g})),se=h.setNewExperimentData,le=o===d.s.FUNNELS&&100-l<50?100-l:50,N=Object(T.a)().diff(Object(T.a)(s==null?void 0:s.start_date),"hour"),C=0;s!=null&&s.start_date?C=q(j||1,I||0,N):C=q(j||1,I||0);var $=Object(T.a)(s==null?void 0:s.start_date).add(C,"hour"),ee=!(s!=null&&s.end_date)&&N>=24&&j&&I,U=Object(M.s)(s==null||(r=s.filters)===null||r===void 0?void 0:r.properties);return e.a.createElement(f.a,null,e.a.createElement(v.a,{span:!(s!=null&&s.start_date)&&g!=="new"&&!B?12:24},g==="new"&&e.a.createElement(f.a,{className:"experiment-preview-row"},e.a.createElement("div",null,e.a.createElement("div",null,e.a.createElement("b",null,"Experiment preview")),e.a.createElement("div",{className:"text-muted"},"Here are the baseline metrics for your experiment. Adjust your minimum detectible threshold to adjust for the smallest conversion value you\u2019ll accept, and the experiment duration."," "))),(g==="new"||B)&&e.a.createElement(f.a,{className:"mb"},e.a.createElement(v.a,{span:24},e.a.createElement("div",null,e.a.createElement("b",null,"Minimum acceptable improvement"),e.a.createElement(ve.a,{title:"Minimum acceptable improvement is a calculation that estimates the smallest significant improvement you are willing to accept."},e.a.createElement(ye.a,{style:{marginLeft:4}}))),e.a.createElement(f.a,{className:"mde-slider"},e.a.createElement(v.a,{span:8},e.a.createElement(or.a,{defaultValue:5,value:H,min:1,max:le,trackStyle:{background:"var(--primary)"},handleStyle:{background:"var(--primary)"},onChange:function(R){se({parameters:{minimum_detectable_effect:R}})},tipFormatter:function(R){return"".concat(R,"%")}})),e.a.createElement(cr.a,{min:1,max:le,defaultValue:5,formatter:function(R){return"".concat(R,"%")},style:{margin:"0 16px"},value:H,onChange:function(R){se({parameters:{minimum_detectable_effect:R}})}})))),e.a.createElement(f.a,{className:"experiment-preview-row ".concat(s!=null&&s.start_date?"mr":"")},o===d.s.TRENDS?e.a.createElement(e.a.Fragment,null,!(s!=null&&s.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(v.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Baseline Count"),e.a.createElement("div",{className:"l4"},Object(M.O)(p||0))),e.a.createElement(v.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Count"),e.a.createElement("div",{className:"l4"},Object(M.O)(p+Math.ceil(p*(H/100))||0)))),e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",Object(M.O)(w||0))," days"))):e.a.createElement(e.a.Fragment,null,!(s!=null&&s.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Baseline Conversion Rate"),e.a.createElement("div",{className:"l4"},l.toFixed(1),"%")),e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Conversion Rate"),e.a.createElement("div",{className:"l4"},(l+H).toFixed(1),"%"))),e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended Sample Size"),e.a.createElement("div",{className:"pb"},e.a.createElement("span",{className:"l4"},"~",Object(M.O)(I||0))," persons")),!(s!=null&&s.start_date)&&e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",Object(M.O)(C||0))," days"))),e.a.createElement(f.a,{className:"full-width mt"},e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Experiment variants"),e.a.createElement("ul",{className:"variants-list"},s==null||(a=s.parameters)===null||a===void 0||(n=a.feature_flag_variants)===null||n===void 0?void 0:n.map(function(F,R){return e.a.createElement("li",{key:R},F.key)}))),e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Participants"),e.a.createElement("div",null,U!=null&&U.length?e.a.createElement("div",null,U==null?void 0:U.map(function(F){return e.a.createElement(jt.c,{key:F.key,item:F,style:{margin:2,cursor:"default"}})})):e.a.createElement(e.a.Fragment,null,"100% of"," ",(s==null||(c=s.filters)===null||c===void 0?void 0:c.aggregation_group_type_index)!=null?Object(M.j)(pe(s.filters.aggregation_group_type_index).plural):"users")))),e.a.createElement(f.a,{className:"full-width"},g!=="new"&&!B&&e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary mt"},"Start date"),s!=null&&s.start_date?e.a.createElement("span",null,Object(T.a)(s==null?void 0:s.start_date).format("D MMM YYYY")):e.a.createElement("span",{className:"description"},"Not started yet")),o===d.s.FUNNELS&&ee?e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary mt"},"Expected end date"),e.a.createElement("span",null,$.isAfter(Object(T.a)())?$.format("D MMM YYYY"):Object(T.a)().format("D MMM YYYY"))):null,(s==null?void 0:s.end_date)&&e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"card-secondary mt"},"Completed date"),e.a.createElement("span",null,Object(T.a)(s==null?void 0:s.end_date).format("D MMM YYYY"))))),g!=="new"&&!B&&e.a.createElement(f.a,{className:"experiment-preview-row"},e.a.createElement(v.a,null,e.a.createElement("div",{className:"card-secondary mb-05"},o===d.s.FUNNELS?"Conversion goal steps":"Trend goal"),[].concat(re()((s==null||(u=s.filters)===null||u===void 0?void 0:u.events)||[]),re()((s==null||(m=s.filters)===null||m===void 0?void 0:m.actions)||[])).sort(function(F,R){return(F.order||0)-(R.order||0)}).map(function(F,R){var Ie;return e.a.createElement(v.a,{key:R,className:"mb-05"},e.a.createElement(f.a,{style:{marginBottom:4}},e.a.createElement("div",{className:"preview-conversion-goal-num"},o===d.s.FUNNELS?(F.order||0)+1:R+1),e.a.createElement("b",null,e.a.createElement(mr.b,{action:F,showCountedByTag:o===d.s.TRENDS,hideIcon:!0}))),(Ie=F.properties)===null||Ie===void 0?void 0:Ie.map(function(Ve){return e.a.createElement(jt.c,{key:Ve.key,item:Ve})}))})))),g!=="new"&&!B&&!(s!=null&&s.start_date)&&e.a.createElement(v.a,{span:12,className:"pl"},e.a.createElement(dr,null)))}try{Ne.displayName="ExperimentPreview",Ne.__docgenInfo={description:"",displayName:"ExperimentPreview",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}},trendCount:{defaultValue:null,description:"",name:"trendCount",required:!0,type:{name:"number"}},trendExposure:{defaultValue:null,description:"",name:"trendExposure",required:!1,type:{name:"number"}},funnelSampleSize:{defaultValue:null,description:"",name:"funnelSampleSize",required:!1,type:{name:"number"}},funnelConversionRate:{defaultValue:null,description:"",name:"funnelConversionRate",required:!0,type:{name:"number"}},funnelEntrants:{defaultValue:null,description:"",name:"funnelEntrants",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"]={docgenInfo:Ne.__docgenInfo,name:"ExperimentPreview",path:"frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"})}catch(t){}var _e=i("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx");function je(t){var r,a,n,c=t.experiment,u=Object(L.useState)("control"),m=W()(u,2),s=m[0],p=m[1];return e.a.createElement(J.a,{title:e.a.createElement("span",{className:"card-secondary"},"Feature flag usage and implementation"),className:"experiment-implementation-details"},e.a.createElement(f.a,{justify:"space-between",className:"mb-05"},e.a.createElement("div",null,e.a.createElement("span",{className:"mr-05"},"Variant group"),e.a.createElement(A.a,{onChange:p,defaultValue:"control",suffixIcon:e.a.createElement(Ae.a,null)},c==null||(r=c.parameters)===null||r===void 0||(a=r.feature_flag_variants)===null||a===void 0?void 0:a.map(function(l,w){return e.a.createElement(A.a.Option,{key:w,value:l.key},l.key)}))),e.a.createElement("div",null,e.a.createElement(It,null))),e.a.createElement("b",null,"Implement your experiment in code"),e.a.createElement(_e.a,{language:_e.b.JavaScript,wrap:!0},"if (posthog.getFeatureFlag('".concat((n=c==null?void 0:c.feature_flag_key)!==null&&n!==void 0?n:"","') === '").concat(s,`') {
    // where '`).concat(s,`' is the variant, run your code here
}`)),e.a.createElement("b",null,"Test that it works"),e.a.createElement(_e.a,{language:_e.b.JavaScript},"posthog.feature_flags.override({'".concat(c==null?void 0:c.feature_flag_key,"': '").concat(s,"'})")),e.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://posthog.com/docs/user-guides/feature-flags"},e.a.createElement(f.a,{align:"middle"},"Experiment implementation guide",e.a.createElement(ne.IconOpenInNew,{className:"ml-05"}))))}try{je.displayName="ExperimentImplementationDetails",je.__docgenInfo={description:"",displayName:"ExperimentImplementationDetails",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"]={docgenInfo:je.__docgenInfo,name:"ExperimentImplementationDetails",path:"frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"})}catch(t){}var Ye=i("./frontend/src/lib/components/LemonButton/index.ts");function Ot(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),a.push.apply(a,n)}return a}function Ue(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?Ot(Object(a),!0).forEach(function(n){fe()(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Ot(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}var ur={component:Oe,logic:we,paramsToProps:function(r){var a=r.params.id;return{experimentId:a==="new"?"new":parseInt(a)}}};function Oe(){var t,r,a,n,c,u,m,s,p,l,w,I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=I.id,g=Object(D.useValues)(we({experimentId:j})),E=g.newExperimentData,o=g.experimentData,B=g.experimentInsightId,H=g.minimumSampleSizePerVariant,q=g.recommendedExposureForCountData,pe=g.variants,h=g.experimentResults,se=g.countDataForVariant,le=g.editingExistingExperiment,N=g.experimentInsightType,C=g.experimentResultsLoading,$=g.parsedSecondaryMetrics,ee=g.areResultsSignificant,U=g.conversionRateForVariant,F=g.getIndexForVariant,R=g.significanceBannerDetails,Ie=g.areTrendResultsConfusing,Ve=g.taxonomicGroupTypesForSelection,pr=g.groupTypes,fr=g.aggregationLabel,Qe=g.secondaryMetricResults,vr=g.experimentDataLoading,z=Object(D.useActions)(we({experimentId:j})),Se=z.setNewExperimentData,gr=z.createExperiment,Er=z.launchExperiment,Be=z.setFilters,hr=z.setEditExperiment,xr=z.endExperiment,yr=z.addExperimentGroup,br=z.updateExperiment,wr=z.updateExperimentGroup,Nr=z.removeExperimentGroup,jr=z.setSecondaryMetrics,Or=z.setExperimentInsightType,Ir=z.archiveExperiment,Sr=Object(D.useValues)(lr.a),Ze=Sr.featureFlags,Tr=Y.a.useForm(),Mr=W()(Tr,1),Dr=Mr[0],Cr=Object(L.useState)(!0),St=W()(Cr,2),qe=St[0],et=St[1],Fr=Object(D.useValues)(Object(_.b)({dashboardItemId:B})),tt=Fr.insightProps,Te=Object(D.useValues)(Object(G.a)(tt)),Pr=Te.isStepsEmpty,Lr=Te.filterSteps,Tt=Te.filters,rt=Te.results,Rr=Te.conversionMetrics,Mt=Object(D.useValues)(Object(He.a)(tt)),at=Mt.filters,Ar=Mt.results,nt=Rr.totalRate*100,kr=H(nt),Dt=kr*pe.length,it=(t=Ar[0])===null||t===void 0?void 0:t.count,Ct=rt==null||(r=rt[0])===null||r===void 0?void 0:r.count,Ft=q(it),$e=N===d.s.FUNNELS&&(h==null?void 0:h.insight)?h.insight.reduce(function(y,b){var P;return((P=b[0])===null||P===void 0?void 0:P.count)+y},0):0,_r=N===d.s.FUNNELS?($e||0)/((o==null||(a=o.parameters)===null||a===void 0?void 0:a.recommended_sample_size)||1)*100:Object(T.a)().diff(o==null?void 0:o.start_date,"day")/((o==null||(n=o.parameters)===null||n===void 0?void 0:n.recommended_running_time)||1)*100,Yr={running:"green",draft:"default",complete:"purple"},Pt=function(){if(o!=null&&o.start_date){if(!(o!=null&&o.end_date))return"running"}else return"draft";return"complete"},Ur=[{background:"#35416b",color:"#fff"},{background:"#C278CE66",color:"#35416B"},{background:"#FFE6AE",color:"#35416B"},{background:"#8DA9E74D",color:"#35416B"}];return e.a.createElement(e.a.Fragment,null,j==="new"||le?e.a.createElement(e.a.Fragment,null,e.a.createElement(f.a,{align:"middle",justify:"space-between",style:{borderBottom:"1px solid var(--border)",marginBottom:"1rem",paddingBottom:8}},e.a.createElement(ce.a,{title:"New experiment"}),e.a.createElement(f.a,null,e.a.createElement(Ye.a,{type:"secondary",className:"mr-05",onClick:function(){return Ee.router.actions.push(ae.a.experiments())}},"Cancel"),e.a.createElement(Ye.a,{type:"primary",htmlType:"submit",form:"new-experiment"},"Save"))),e.a.createElement(Y.a,{name:"new-experiment",layout:"vertical",className:"experiment-form",form:Dr,onValuesChange:function(b){return Se(b)},initialValues:{name:E==null?void 0:E.name,feature_flag_key:E==null?void 0:E.feature_flag_key,description:E==null?void 0:E.description},onFinish:function(){return gr(!0,Ft,Dt)},requiredMark:!1,scrollToFirstError:!0},e.a.createElement("div",null,e.a.createElement(D.BindLogic,{logic:_.b,props:tt},e.a.createElement(f.a,null,e.a.createElement(v.a,{span:12,style:{paddingRight:24}},e.a.createElement(f.a,{className:"full-width"},e.a.createElement(Y.a.Item,{label:"Name",name:"name",rules:[{required:!0,message:"You have to enter a name."}]},e.a.createElement(te.a,{"data-attr":"experiment-name",className:"ph-ignore-input"})),e.a.createElement(Y.a.Item,{style:{paddingLeft:16},label:e.a.createElement("div",null,"Feature flag key"," ",e.a.createElement(ve.a,{title:"Enter a unique key. This will create a new feature flag which will be associated with this experiment."},e.a.createElement(ye.a,null))),name:"feature_flag_key",rules:[{required:!0,message:"You have to enter a feature flag key name."}]},e.a.createElement(te.a,{"data-attr":"experiment-feature-flag-key",disabled:le}))),e.a.createElement(Y.a.Item,{label:e.a.createElement("div",null,"Description ",e.a.createElement("span",{className:"text-muted"},"(optional)")),name:"description"},e.a.createElement(te.a.TextArea,{"data-attr":"experiment-description",className:"ph-ignore-input",placeholder:"Adding a helpful description can ensure others know what this experiment is about."})),(E==null||(c=E.parameters)===null||c===void 0?void 0:c.feature_flag_variants)&&e.a.createElement(v.a,null,e.a.createElement("label",null,e.a.createElement("b",null,"Experiment variants")),e.a.createElement("div",{className:"text-muted"},"Participants are divided into variant groups evenly. All experiments must consist of a control group and at least one test group. Experiments may have at most 3 test groups. Variant names can only contain letters, numbers, hyphens, and underscores."),e.a.createElement(v.a,{className:"variants"},E.parameters.feature_flag_variants.map(function(y,b){return e.a.createElement(Y.a,{key:"".concat(y,"-").concat(b),initialValues:{key:y.key},onValuesChange:function(K){wr(K,b)}},e.a.createElement(f.a,{key:"".concat(y,"-").concat(b),className:"feature-flag-variant ".concat(b===0?"border-top":b>=3?"border-bottom":"")},e.a.createElement("div",{className:"variant-label",style:Ue({},Ur[b])},b===0?"Control":"Test"),e.a.createElement(Y.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{required:!0,pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:e.a.createElement(e.a.Fragment,null,e.a.createElement(Qt.a,{style:{color:"#F96132"}})," ","Variant names can only contain letters, numbers, hyphens, and underscores.")}],style:{display:"contents"}},e.a.createElement(te.a,{disabled:b===0,"data-attr":"feature-flag-variant-key","data-key-index":b.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(b+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),e.a.createElement("div",{className:"float-right"},!(b===0||b===1)&&e.a.createElement(ve.a,{title:"Delete this variant",placement:"bottomLeft"},e.a.createElement(Ye.a,{type:"primary-alt",compact:!0,icon:e.a.createElement(ne.IconDelete,null),onClick:function(){return Nr(b)}})))))}),E.parameters.feature_flag_variants.length<4&&e.a.createElement("div",{className:"feature-flag-variant border-bottom"},e.a.createElement(Q.a,{style:{color:"var(--primary)",border:"none",boxShadow:"none",paddingLeft:0},icon:e.a.createElement(Zt.a,null),onClick:function(){return yr()}},"Add test variant")))),e.a.createElement(f.a,{className:"person-selection"},e.a.createElement("div",{className:"mb-05"},e.a.createElement("strong",null,"Select participants")),e.a.createElement(v.a,null,e.a.createElement("div",{className:"text-muted"},"Select the entities who will participate in this experiment. If no filters are set, 100% of participants will be targeted."),e.a.createElement("div",{className:"mt mb-05"},e.a.createElement("strong",null,"Participant type")),e.a.createElement(A.a,{value:(E==null||(u=E.filters)===null||u===void 0?void 0:u.aggregation_group_type_index)!=null?E.filters.aggregation_group_type_index:-1,onChange:function(b){var P,K=b!==-1?b:void 0;K!=(E==null||(P=E.filters)===null||P===void 0?void 0:P.aggregation_group_type_index)&&(Be({properties:[],aggregation_group_type_index:K}),Se({filters:{aggregation_group_type_index:K,properties:[]}}))},"data-attr":"participant-aggregation-filter",dropdownMatchSelectWidth:!1},e.a.createElement(A.a.Option,{key:-1,value:-1},"Persons"),pr.map(function(y){return e.a.createElement(A.a.Option,{key:y.group_type_index,value:y.group_type_index},Object(M.j)(fr(y.group_type_index).plural))})),e.a.createElement("div",{className:"mt"},e.a.createElement("strong",null,"Filters")),e.a.createElement(Z.a,{pageKey:"experiment-participants-property",propertyFilters:N===d.s.FUNNELS?Object(M.s)(Tt.properties):Object(M.s)(at.properties),onChange:function(b){Se({filters:{properties:b}}),Be({properties:b.filter(he.b)})},taxonomicGroupTypes:Ve})))),e.a.createElement(f.a,{className:"metrics-selection"},e.a.createElement(v.a,{span:12},e.a.createElement("div",{className:"mb-05"},e.a.createElement("b",null,"Goal type"),e.a.createElement("div",{className:"text-muted"},N===d.s.TRENDS?"Track counts of a specific event or action":"Track how many persons complete a sequence of actions and or events")),e.a.createElement(A.a,{style:{display:"flex"},value:N,onChange:Or,suffixIcon:e.a.createElement(Ae.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(A.a.Option,{value:d.s.TRENDS},e.a.createElement(v.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(A.a.Option,{value:d.s.FUNNELS},e.a.createElement(v.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel"))))),e.a.createElement("div",{className:"mb mt"},e.a.createElement("b",null,"Experiment goal"),N===d.s.TRENDS&&e.a.createElement("div",{className:"text-muted"},"Trend-based experiments can have at most one graph series. This metric is used to track the progress of your experiment.")),e.a.createElement(f.a,null,e.a.createElement(J.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},N===d.s.FUNNELS&&e.a.createElement(k.a,{filters:Tt,setFilters:function(b){Se({filters:b}),Be(b)},typeKey:"EditFunnel-action",hideMathSelector:!0,hideDeleteBtn:Lr.length===1,buttonCopy:"Add funnel step",buttonType:"link",showSeriesIndicator:!Pr,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[O.a.EventProperties,O.a.PersonProperties,O.a.Cohorts,O.a.Elements],rowClassName:"action-filters-bordered"}),N===d.s.TRENDS&&e.a.createElement(k.a,{horizontalUI:!0,filters:at,setFilters:function(b){Se({filters:b}),Be(b)},typeKey:"experiment-trends",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[O.a.EventProperties,O.a.PersonProperties,O.a.Cohorts,O.a.Elements],customRowPrefix:at.insight===d.s.LIFECYCLE?e.a.createElement(e.a.Fragment,null,"Showing ",e.a.createElement("b",null,"Unique users")," who did"):void 0}))),Ze[de.n.EXPERIMENTS_SECONDARY_METRICS]&&e.a.createElement(v.a,{className:"secondary-metrics"},e.a.createElement("div",null,e.a.createElement("b",null,"Secondary metrics"),e.a.createElement("span",{className:"text-muted ml-05"},"(optional)")),e.a.createElement("div",{className:"text-muted",style:{marginTop:4}},"Use secondary metrics to monitor metrics related to your experiment goal. You can add up to three secondary metrics."," "),e.a.createElement(ke,{onMetricsChange:function(b){return jr(b)},initialMetrics:$}))),e.a.createElement(v.a,{span:12,className:"pl"},e.a.createElement("div",{className:"card-secondary mb"},"Goal preview"),e.a.createElement(Je.a,{disableHeader:N===d.s.TRENDS,disableTable:!0})))),e.a.createElement(f.a,null,e.a.createElement(J.a,{className:"experiment-preview"},e.a.createElement(Ne,{experiment:E,trendCount:it,trendExposure:Ft,funnelSampleSize:Dt,funnelEntrants:Ct,funnelConversionRate:nt}))))),e.a.createElement(Ye.a,{className:"float-right",type:"primary",htmlType:"submit"},"Save"))):!vr&&o?e.a.createElement("div",{className:"view-experiment"},e.a.createElement(f.a,{className:"draft-header"},e.a.createElement(f.a,{justify:"space-between",align:"middle",className:"full-width pb"},e.a.createElement(v.a,null,e.a.createElement(f.a,null,e.a.createElement(ce.a,{style:{paddingRight:8},title:"".concat(o==null?void 0:o.name),buttons:e.a.createElement(e.a.Fragment,null,e.a.createElement(qt.a,{explicitValue:o.feature_flag_key,iconStyle:{color:"var(--text-muted-alt)"}},e.a.createElement("span",{className:"text-muted"},o.feature_flag_key)),e.a.createElement(oe.a,{style:{alignSelf:"center"},color:Yr[Pt()]},e.a.createElement("b",{className:"uppercase"},Pt())),h&&o.end_date&&e.a.createElement(oe.a,{style:{alignSelf:"center"},color:ee?"green":"geekblue"},e.a.createElement("b",{className:"uppercase"},ee?"Significant Results":"Results not significant")))})),e.a.createElement("span",{className:"exp-description"},o.start_date?e.a.createElement(ir.a,{multiline:!0,name:"description",value:o.description||"",placeholder:"Description (optional)",onSave:function(b){return br({description:b})},maxLength:400,"data-attr":"experiment-description",compactButtons:!0}):e.a.createElement(e.a.Fragment,null,o.description||"There is no description for this experiment."))),o&&!o.start_date&&e.a.createElement("div",null,e.a.createElement(Q.a,{className:"mr-05",onClick:function(){return hr(!0)}},"Edit"),e.a.createElement(Q.a,{type:"primary",onClick:function(){return Er()}},"Launch")),o&&o.start_date&&!o.end_date&&e.a.createElement(Q.a,{className:"stop-experiment",onClick:function(){return xr()}},"Stop experiment"),(o==null?void 0:o.end_date)&&Object(T.a)().isSameOrAfter(Object(T.a)(o.end_date),"day")&&!o.archived&&e.a.createElement(Q.a,{className:"archive-experiment",onClick:function(){return Ir()}},e.a.createElement("b",null,"Archive experiment")))),e.a.createElement(f.a,null,qe&&h&&ee&&!o.end_date&&e.a.createElement(f.a,{align:"middle",className:"significant-results"},e.a.createElement(v.a,{span:19,style:{color:"#497342"}},"Your results are ",e.a.createElement("b",null,"statistically significant"),"."," ",o.end_date?"":"You can end this experiment now or let it run to completion."),e.a.createElement(v.a,{span:5},e.a.createElement(Q.a,{style:{color:"#497342"},onClick:function(){return et(!1)}},"Dismiss"))),qe&&h&&!ee&&!o.end_date&&e.a.createElement(f.a,{align:"middle",className:"not-significant-results"},e.a.createElement(v.a,{span:23,style:{color:"#2D2D2D"}},e.a.createElement("b",null,"Your results are not statistically significant"),". ",R," ",o!=null&&o.end_date?"":"We don't recommend ending this experiment yet."," ","See our"," ",e.a.createElement("a",{href:"https://posthog.com/docs/user-guides/experimentation#funnel-experiment-calculations"}," ","experimentation guide"," "),"for more information."," "),e.a.createElement(v.a,{span:1},e.a.createElement(Et.a,{className:"close-button",onClick:function(){return et(!1)}}))),qe&&o.end_date&&e.a.createElement(f.a,{align:"middle",className:"feature-flag-mods"},e.a.createElement(v.a,{span:23},e.a.createElement("b",null,"Your experiment is complete.")," We recommend removing the feature flag from your code completely, instead of relying on this distribution:"," ",e.a.createElement(sr.a,{to:o.feature_flag?ae.a.featureFlag(o.feature_flag):void 0},e.a.createElement("b",null,"Adjust feature flag distribution."))),e.a.createElement(v.a,{span:1},e.a.createElement(Et.a,{className:"close-button",onClick:function(){return et(!1)}})))),e.a.createElement(f.a,null,e.a.createElement(Ce.a,{className:"full-width",defaultActiveKey:"experiment-details"},e.a.createElement(Ce.a.Panel,{header:e.a.createElement("b",null,"Experiment details"),key:"experiment-details"},e.a.createElement(f.a,null,e.a.createElement(v.a,{span:o!=null&&o.start_date?12:24},e.a.createElement(Ne,{experiment:o,trendCount:it,trendExposure:o==null?void 0:o.parameters.recommended_running_time,funnelSampleSize:o==null?void 0:o.parameters.recommended_sample_size,funnelConversionRate:nt,funnelEntrants:o!=null&&o.start_date?$e:Ct})),!h&&o.start_date&&e.a.createElement(v.a,{span:12},e.a.createElement(je,{experiment:o})),(h||((m=o.secondary_metrics)===null||m===void 0?void 0:m.length)>0)&&e.a.createElement(v.a,{className:"secondary-progress",span:o!=null&&o.start_date?12:24},Ze[de.n.EXPERIMENTS_SECONDARY_METRICS]&&!!(o!=null&&o.secondary_metrics.length)&&e.a.createElement(v.a,{className:"border-bottom"},e.a.createElement(f.a,{align:"middle",justify:"space-between",className:"mb-05"},e.a.createElement("div",{className:"card-secondary"},"Secondary metrics"),o==null||(s=o.parameters)===null||s===void 0||(p=s.feature_flag_variants)===null||p===void 0?void 0:p.map(function(y,b){return e.a.createElement("li",{key:b,style:{color:"".concat(N===d.s.FUNNELS?Object(ht.k)(F(y.key,d.s.FUNNELS)+1):Object(Nt.c)("white")[F(y.key,d.s.TRENDS)])},className:"pr"},e.a.createElement("span",{className:"text-default"},Object(M.j)(y.key)))})),Ze[de.n.EXPERIMENTS_SECONDARY_METRICS]&&(o.start_date?e.a.createElement(e.a.Fragment,null,o.secondary_metrics.map(function(y,b){var P,K;return e.a.createElement(f.a,{className:"border-top",key:b,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement("div",null,Object(M.j)(y.name)),o==null||(P=o.parameters)===null||P===void 0||(K=P.feature_flag_variants)===null||K===void 0?void 0:K.map(function(Lt,st){return e.a.createElement("div",{key:st},Qe==null?void 0:Qe[b][Lt.key])}))})):e.a.createElement(e.a.Fragment,null,o.secondary_metrics.map(function(y,b){var P,K;return e.a.createElement(f.a,{className:"border-top",key:b,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement("div",null,Object(M.j)(y.name)),o==null||(P=o.parameters)===null||P===void 0||(K=P.feature_flag_variants)===null||K===void 0?void 0:K.map(function(Lt,st){return e.a.createElement("div",{key:st},"--")}))})))),h&&e.a.createElement(v.a,{className:"mt"},e.a.createElement("div",{className:"mb-05"},e.a.createElement("b",null,"Experiment progress")),e.a.createElement(Fe.a,{strokeWidth:20,showInfo:!1,percent:_r,strokeColor:"var(--success)"}),N===d.s.TRENDS&&o.start_date&&e.a.createElement(f.a,{justify:"space-between",className:"mt-05"},o.end_date?e.a.createElement("div",null,"Ran for"," ",e.a.createElement("b",null,Object(T.a)(o.end_date).diff(o.start_date,"day"))," ","days"):e.a.createElement("div",null,e.a.createElement("b",null,Object(T.a)().diff(o.start_date,"day"))," ","days running"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,o==null||(l=o.parameters)===null||l===void 0?void 0:l.recommended_running_time)," ","days")),N===d.s.FUNNELS&&e.a.createElement(f.a,{justify:"space-between",className:"mt-05"},o.end_date?e.a.createElement("div",null,"Saw"," ",e.a.createElement("b",null,Object(M.O)($e))," ","participants"):e.a.createElement("div",null,e.a.createElement("b",null,Object(M.O)($e))," ","participants seen"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,Object(M.O)((o==null||(w=o.parameters)===null||w===void 0?void 0:w.recommended_sample_size)||0))," ","participants"))))))),!(o!=null&&o.start_date)&&e.a.createElement("div",{className:"mt full-width"},e.a.createElement(je,{experiment:o}))),e.a.createElement("div",{className:"experiment-result"},h?e.a.createElement(e.a.Fragment,null,e.a.createElement(f.a,{justify:"space-around",style:{flexFlow:"nowrap"}},Object.keys(h.probability).sort(function(y,b){return h.probability[b]-h.probability[y]}).map(function(y,b){return e.a.createElement(v.a,{key:b,className:"pr"},e.a.createElement("div",null,e.a.createElement("b",null,Object(M.j)(y))),N===d.s.TRENDS?e.a.createElement(f.a,null,e.a.createElement("b",{style:{paddingRight:4}},e.a.createElement(f.a,null,"action"in h.insight[0]&&e.a.createElement(nr.a,{filter:h.insight[0].action}),e.a.createElement("span",{style:{paddingLeft:4}},"count:")))," ",se(y)," ",Ie&&b===0&&e.a.createElement(ve.a,{placement:"right",title:"It might seem confusing that the best variant has lower absolute count, but this can happen when fewer people are exposed to this variant, so its relative count is higher."},e.a.createElement(ye.a,{style:{padding:"4px 2px"}}))):e.a.createElement(f.a,null,e.a.createElement("b",{style:{paddingRight:4}},"Conversion rate:")," ",U(y),"%"),e.a.createElement(Fe.a,{percent:Number((h.probability[y]*100).toFixed(1)),size:"small",showInfo:!1,strokeColor:N===d.s.FUNNELS?Object(ht.k)(F(y,d.s.FUNNELS)+1):Object(Nt.c)("white")[F(y,d.s.TRENDS)]}),e.a.createElement("div",null,"Probability that this variant is the best:"," ",e.a.createElement("b",null,(h.probability[y]*100).toFixed(1),"%")))}))):C&&e.a.createElement("div",{className:"text-center"},e.a.createElement(Pe.a,{active:!0})),h?e.a.createElement(D.BindLogic,{logic:_.b,props:{dashboardItemId:h.itemID,cachedInsight:{short_id:h.itemID,filters:Ue(Ue(Ue({},h.filters),{},{insight:N,display:o.filters.display},N===d.s.FUNNELS&&{layout:de.p.vertical,funnel_viz_type:d.o.Steps}),N===d.s.TRENDS&&{display:d.d.ActionsLineGraphCumulative}),result:h.insight},doNotLoad:!0}},e.a.createElement("div",{className:"mt"},e.a.createElement(Je.a,{disableHeader:N===d.s.TRENDS,disableTable:N===d.s.FUNNELS}))):o.start_date&&e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"no-experiment-results"},!C&&e.a.createElement("div",{className:"text-center"},e.a.createElement("b",null,"There are no results for this experiment yet."),e.a.createElement("div",{className:"text-default"},"Double check your feature flag implementation if you're still not seeing results.")))))):e.a.createElement(Pe.a,{active:!0}))}function It(){return e.a.createElement(A.a,{defaultValue:"JavaScript",suffixIcon:e.a.createElement(Ae.a,null)},e.a.createElement(A.a.Option,{value:"JavaScript"},e.a.createElement(f.a,{align:"middle"},e.a.createElement(ne.IconJavascript,{style:{marginRight:6}})," JavaScript")))}try{Oe.displayName="Experiment_",Oe.__docgenInfo={description:"",displayName:"Experiment_",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:'number | "new"'}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/Experiment.tsx#Experiment_"]={docgenInfo:Oe.__docgenInfo,name:"Experiment_",path:"frontend/src/scenes/experiments/Experiment.tsx#Experiment_"})}catch(t){}},"./frontend/src/scenes/experiments/experimentsLogic.ts":function(Me,X,i){"use strict";i.d(X,"a",function(){return Pe});var De=i("./node_modules/core-js/modules/es.array.concat.js"),Rt=i.n(De),lt=i("./node_modules/core-js/modules/es.array.filter.js"),At=i.n(lt),ot=i("./node_modules/core-js/modules/es.array.iterator.js"),kt=i.n(ot),ct=i("./node_modules/core-js/modules/es.array.map.js"),_t=i.n(ct),mt=i("./node_modules/core-js/modules/es.object.to-string.js"),Yt=i.n(mt),dt=i("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Ut=i.n(dt),ze=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),fe=i.n(ze),Ke=i("./node_modules/@babel/runtime/regenerator/index.js"),W=i.n(Ke),Y=i("./node_modules/regenerator-runtime/runtime.js"),f=i.n(Y),v=i("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),te=i.n(v),ve=i("./node_modules/kea/lib/index.esm.js"),Q=i("./frontend/src/lib/api.mock.ts"),A=i("./frontend/src/scenes/teamLogic.ts"),J=i("./frontend/src/types.ts"),oe=i("./frontend/src/lib/utils.tsx"),Ce=i("./frontend/src/scenes/userLogic.ts"),Fe=i("./frontend/src/lib/components/lemonToast.tsx"),Pe=Object(ve.kea)({path:["scenes","experiments","experimentsLogic"],connect:{values:[A.a,["currentTeamId"],Ce.a,["hasAvailableFeature"]]},actions:{},loaders:function(ce){var Z=ce.values,he=ce.actions;return{experiments:[[],{loadExperiments:function(){var O=te()(W.a.mark(function e(G){var k;return W.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(Z.hasAvailableFeature(J.c.EXPERIMENTATION)){d.next=2;break}return d.abrupt("return",[]);case 2:return d.next=4,Q.c.get("api/projects/".concat(Z.currentTeamId,"/experiments?").concat(G||""));case 4:return k=d.sent,d.abrupt("return",k.results);case 6:case"end":return d.stop()}},e)}));function L(e){return O.apply(this,arguments)}return L}(),deleteExperiment:function(){var O=te()(W.a.mark(function e(G){return W.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,Q.c.delete("api/projects/".concat(Z.currentTeamId,"/experiments/").concat(G));case 2:return Fe.a.info("Experiment removed"),_.abrupt("return",Z.experiments.filter(function(d){return d.id!==G}));case 4:case"end":return _.stop()}},e)}));function L(e){return O.apply(this,arguments)}return L}(),addToExperiments:function(L){return[].concat(fe()(Z.experiments),[L])},updateExperiments:function(L){return Z.experiments.map(function(e){return e.id===L.id?L:e})}}],tab:[J.h.All,{setExperimentsFilters:function(){var O=te()(W.a.mark(function e(G){var k,_;return W.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return k=G.tab,_=k===J.h.Yours?Object(oe.Bb)({user:!0}):Object(oe.Bb)({archived:!0}),k===J.h.All?he.loadExperiments(Object(oe.Bb)({all:!0})):he.loadExperiments(_),ge.abrupt("return",k);case 4:case"end":return ge.stop()}},e)}));function L(e){return O.apply(this,arguments)}return L}()}]}},events:function(ce){var Z=ce.actions;return{afterMount:function(){Z.loadExperiments(Object(oe.Bb)({all:!0}))}}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss":function(Me,X,i){var De=i("./node_modules/css-loader/dist/runtime/api.js");X=De(!1),X.push([Me.i,'.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.experiment-form .metrics-selection{border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;width:100%}.experiment-form .metrics-selection .action-filters-bordered .draggable-action-filter{border-bottom:1px solid rgba(0,0,0,.15);padding:1rem .25rem;margin-top:0}.experiment-form .metrics-selection .action-filters-bordered .row-action-btn{color:#35416b}.experiment-form .person-selection{width:100%;border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;align-items:center;justify-content:space-between}.experiment-form .insights-graph-container{margin-bottom:1rem;background-color:#fff}.experiment-form .insights-graph-container .ant-card-head{border-bottom:1px solid rgba(0,0,0,.15);min-height:unset;background-color:#fff;padding-left:1rem;padding-right:1rem}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title{padding:.5rem 0}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter{font-size:14px}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter:not(:last-child),.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter span.head-title-item{margin-right:.5rem}.experiment-form .insights-graph-container .display-config-inner{display:flex;align-items:center;justify-content:space-between;overflow-x:auto}.experiment-form .insights-graph-container .ant-card-body{padding:0}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left{width:100%}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right{width:100%;height:min(calc(90vh - 16rem),36rem);max-width:300px;padding:0 1rem 1rem 0;display:flex;align-items:center}.experiment-form .insights-graph-container .graph-container{width:calc(100% - 2rem);height:calc(100% - 3rem)}.experiment-form .insights-graph-header{margin-top:0!important;margin-bottom:0!important;padding-left:1rem;padding-right:1rem;min-height:48px}.experiment-form .experiment-preview{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.experiment-form .experiment-preview .mde-slider .ant-slider-handle{border:none}.experiment-form .experiment-preview .mde-slider .ant-slider-rail{background-color:#e5ebff}.experiment-form .variants{margin-top:.5rem;padding-bottom:1rem}.experiment-form .variants .ant-form-horizontal{min-height:32px}.experiment-form .variants .border-top{border-top-left-radius:4px;border-top-right-radius:4px}.experiment-form .variants .border-bottom{border-bottom-left-radius:4px;border-bottom-right-radius:4px}.experiment-form .variants .feature-flag-variant{flex-direction:row;align-items:baseline;padding:12px 8px;background:#fff;border-bottom-width:1px;border-bottom-color:rgba(0,0,0,.15);border-top:1px solid rgba(0,0,0,.15);border-left:1px solid rgba(0,0,0,.15);border-right:1px solid rgba(0,0,0,.15)}.experiment-form .variants .feature-flag-variant .ant-form-item-explain-error{margin-top:.5rem;color:#bf411a}.experiment-form .variants .feature-flag-variant .ant-form-item-label{padding:0}.experiment-form .variants .variant-label{display:flex;flex-direction:row;justify-content:center;align-items:center;border-radius:4px;color:#fff;min-width:52px;padding:2px 6px;margin-right:8px;font-size:12px;font-weight:500;letter-spacing:.01em}.experiment-form .secondary-metrics{margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(0,0,0,.15);margin-bottom:1rem}.experiment-form .ant-input-number-disabled,.experiment-form .ant-input[disabled]{color:#000}.view-experiment .draft-header{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.view-experiment .stop-experiment{background-color:#f96132;color:#fff}.view-experiment .archive-experiment{color:#f96132}.view-experiment .exp-description{font-style:italic;color:rgba(0,0,0,.5)}.view-experiment .participants{background-color:#fff}.view-experiment .participants .ant-collapse-header{padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem}.view-experiment .variants-list{list-style:none;margin:0;padding:0}.view-experiment .variants-list li{display:inline}.view-experiment .variants-list li:after{content:", "}.view-experiment .variants-list li:last-child:after{content:""}.view-experiment .experiment-result{padding-top:1rem}.view-experiment .significant-results{padding:.5rem;width:100%;background:rgba(119,185,108,.1);border-radius:4px;text-align:center;margin-bottom:1rem}.view-experiment .not-significant-results{padding:.5rem;width:100%;background:rgba(83,117,255,.1);border-radius:4px;margin-bottom:1rem}.view-experiment .feature-flag-mods{padding:.5rem;width:100%;background:#f6ebf8;border-radius:4px;margin-bottom:1rem}.view-experiment .ant-collapse-content-box{display:flex;flex-flow:column}.view-experiment .secondary-progress{margin-top:.5rem}.view-experiment .secondary-progress li:before{content:"\u2022";display:inline-block;font-weight:900;margin-right:4px}.view-experiment .secondary-progress .ant-progress-inner,.view-experiment .secondary-progress .ant-progress-inner .ant-progress-bg{border-radius:4px}.view-experiment .no-experiment-results{display:flex;justify-content:center;align-items:center;margin-top:1rem;background-color:#fafaf9;border:1px solid rgba(0,0,0,.15);width:100%;min-height:320px;font-size:24px}.preview-conversion-goal-num{height:24px;width:24px;text-align:center;background-color:#fafaf9;color:#35416b;font-weight:700;margin-right:.5rem}.experiment-preview-row{border-bottom:1px solid rgba(0,0,0,.15);padding-bottom:1rem;margin-bottom:1rem}.experiment-preview-row:last-child{border-bottom:none;padding-bottom:0;margin-bottom:0}.metric-name{border:1px solid rgba(0,0,0,.15);border-radius:4px;padding:8px 8px 8px 16px;margin-left:.5rem;flex:1}.experiment-implementation-details,.experiment-workflow{border-color:#d9d9d9}.experiment-implementation-details .ant-card-head,.experiment-workflow .ant-card-head{padding-left:1rem;padding-right:1rem;border:none}.experiment-implementation-details .ant-card-head-title,.experiment-workflow .ant-card-head-title{border-bottom:1px solid rgba(0,0,0,.15)}.experiment-implementation-details .exp-workflow-step,.experiment-workflow .exp-workflow-step{margin-bottom:.5rem;padding:.5rem;border-radius:4px}.experiment-implementation-details .exp-workflow-step:hover,.experiment-workflow .exp-workflow-step:hover{cursor:pointer}.experiment-implementation-details .step-completed,.experiment-workflow .step-completed{background-color:#e5ebff}',""]),Me.exports=X}}]);
