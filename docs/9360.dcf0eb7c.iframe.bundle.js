"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[9360],{"./frontend/src/scenes/onboarding/onboardingLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D6:()=>onboardingLogic,hQ:()=>getProductUri});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),scenes_urls__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/scenes/urls.ts"),scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/scenes/billing/billingLogic.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),kea_router__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts");let OnboardingStepKey=function(OnboardingStepKey){return OnboardingStepKey.PRODUCT_INTRO="product_intro",OnboardingStepKey.SDKS="sdks",OnboardingStepKey.BILLING="billing",OnboardingStepKey.OTHER_PRODUCTS="other_products",OnboardingStepKey.VERIFY="verify",OnboardingStepKey}({});const onboardingStepMap={[OnboardingStepKey.PRODUCT_INTRO]:"OnboardingProductIntro",[OnboardingStepKey.SDKS]:"SDKs",[OnboardingStepKey.BILLING]:"OnboardingBillingStep",[OnboardingStepKey.OTHER_PRODUCTS]:"OnboardingOtherProductsStep",[OnboardingStepKey.VERIFY]:"OnboardingVerificationStep"},getProductUri=productKey=>{switch(productKey){case"product_analytics":return(0,kea_router__WEBPACK_IMPORTED_MODULE_4__.combineUrl)(scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.events(),{onboarding_completed:!0}).url;case"session_replay":return scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.replay();case"feature_flags":return scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.featureFlags();default:return scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.default()}},onboardingLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)({props:{},path:["scenes","onboarding","onboardingLogic"],connect:{values:[scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_2__.kr,["billing"],scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic,["currentTeam"]],actions:[scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_2__.kr,["loadBillingSuccess"],scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic,["updateCurrentTeamSuccess"]]},actions:{setProduct:product=>({product}),setProductKey:productKey=>({productKey}),setCurrentOnboardingStepNumber:currentOnboardingStepNumber=>({currentOnboardingStepNumber}),completeOnboarding:nextProductKey=>({nextProductKey}),setAllOnboardingSteps:allOnboardingSteps=>({allOnboardingSteps}),setStepKey:stepKey=>({stepKey}),setSubscribedDuringOnboarding:subscribedDuringOnboarding=>({subscribedDuringOnboarding})},reducers:()=>({productKey:[null,{setProductKey:(_,_ref)=>{let{productKey}=_ref;return productKey}}],product:[null,{setProduct:(_,_ref2)=>{let{product}=_ref2;return product}}],currentOnboardingStepNumber:[1,{setCurrentOnboardingStepNumber:(_,_ref3)=>{let{currentOnboardingStepNumber}=_ref3;return currentOnboardingStepNumber}}],allOnboardingSteps:[[],{setAllOnboardingSteps:(_,_ref4)=>{let{allOnboardingSteps}=_ref4;return allOnboardingSteps}}],stepKey:["",{setStepKey:(_,_ref5)=>{let{stepKey}=_ref5;return stepKey}}],onCompleteOnbardingRedirectUrl:[scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.default(),{setProductKey:(_,_ref6)=>{let{productKey}=_ref6;return productKey?getProductUri(productKey):scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.default()}}],subscribedDuringOnboarding:[!1,{setSubscribedDuringOnboarding:(_,_ref7)=>{let{subscribedDuringOnboarding}=_ref7;return subscribedDuringOnboarding}}]}),selectors:{totalOnboardingSteps:[s=>[s.allOnboardingSteps],allOnboardingSteps=>allOnboardingSteps.length],shouldShowBillingStep:[s=>[s.product,s.subscribedDuringOnboarding],(product,subscribedDuringOnboarding)=>{const hasAllAddons=product?.addons?.every((addon=>addon.subscribed));return!product?.subscribed||!hasAllAddons||subscribedDuringOnboarding}],suggestedProducts:[s=>[s.billing,s.product,s.currentTeam],(billing,product,currentTeam)=>billing?.products?.filter((p=>p.type!==product?.type&&!p.contact_support&&!p.inclusion_only&&!currentTeam?.has_completed_onboarding_for?.[p.type]))||[]]},listeners:_ref8=>{let{actions,values}=_ref8;return{loadBillingSuccess:()=>{actions.setProduct(values.billing?.products.find((p=>p.type===values.productKey))||null)},setProduct:_ref9=>{let{product}=_ref9;product||(window.location.href=scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.default())},setProductKey:_ref10=>{let{productKey}=_ref10;productKey?values.billing?.products?.length&&actions.setProduct(values.billing?.products.find((p=>p.type===values.productKey))||null):window.location.href=scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.default()},setSubscribedDuringOnboarding:_ref11=>{let{subscribedDuringOnboarding}=_ref11;if(subscribedDuringOnboarding){const productKey=values.productKey||window.location.pathname.split("/")[2];lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_5__.vx.actions.reportSubscribedDuringOnboarding(productKey)}},completeOnboarding:_ref12=>{let{nextProductKey}=_ref12;if(values.productKey){const product=values.productKey;lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_5__.vx.actions.reportOnboardingCompleted(product),nextProductKey&&(actions.setProductKey(nextProductKey),kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.onboarding(nextProductKey))),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic.actions.updateCurrentTeam({has_completed_onboarding_for:{...values.currentTeam?.has_completed_onboarding_for,[product]:!0}})}},setAllOnboardingSteps:_ref13=>{let{allOnboardingSteps}=_ref13,stepKey=values.stepKey;if(values.stepKey){if(parseInt(values.stepKey)>0){const stepName=allOnboardingSteps[parseInt(values.stepKey)-1]?.type?.name,newStepKey=Object.keys(onboardingStepMap).find((key=>onboardingStepMap[key]===stepName));stepName&&stepKey&&(stepKey=newStepKey||stepKey,actions.setStepKey(stepKey))}if(stepKey in onboardingStepMap){const stepIndex=allOnboardingSteps.map((step=>step.type.name)).indexOf(onboardingStepMap[stepKey]);stepIndex>-1?actions.setCurrentOnboardingStepNumber(stepIndex+1):(actions.setStepKey(""),actions.setCurrentOnboardingStepNumber(1))}else parseInt(stepKey)>1&&allOnboardingSteps.length>0&&allOnboardingSteps[parseInt(stepKey)-1]&&actions.setCurrentOnboardingStepNumber(parseInt(stepKey))}},setStepKey:_ref14=>{let{stepKey}=_ref14;!(stepKey&&values.allOnboardingSteps.length>0)||values.allOnboardingSteps.find((step=>step.type.name===onboardingStepMap[stepKey]))&&values.allOnboardingSteps[parseInt(stepKey)-1]||actions.setStepKey("")}}},actionToUrl:_ref15=>{let{values}=_ref15;return{setCurrentOnboardingStepNumber:()=>{const stepName=values.allOnboardingSteps[values.currentOnboardingStepNumber-1]?.type?.name,stepKey=Object.keys(onboardingStepMap).find((key=>onboardingStepMap[key]===stepName))||values.currentOnboardingStepNumber.toString();return stepKey?[`/onboarding/${values.productKey}`,{step:stepKey}]:[`/onboarding/${values.productKey}`]},updateCurrentTeamSuccess(val){if(values.productKey&&val.payload?.has_completed_onboarding_for?.[values.productKey])return[values.onCompleteOnbardingRedirectUrl]}}},urlToAction:_ref16=>{let{actions,values}=_ref16;return{"/onboarding/:productKey":(_ref17,_ref18)=>{let{productKey}=_ref17,{success,upgraded,step}=_ref18;productKey?((success||upgraded)&&actions.setSubscribedDuringOnboarding(!0),productKey!==values.productKey&&actions.setProductKey(productKey),step&&(step in onboardingStepMap||parseInt(step)>0)?actions.setStepKey(step):actions.setCurrentOnboardingStepNumber(1)):window.location.href=scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.default()}}}});try{getProductUri.displayName="getProductUri",getProductUri.__docgenInfo={description:"",displayName:"getProductUri",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/onboarding/onboardingLogic.tsx#getProductUri"]={docgenInfo:getProductUri.__docgenInfo,name:"getProductUri",path:"frontend/src/scenes/onboarding/onboardingLogic.tsx#getProductUri"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/products/Products.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Products:()=>Products,scene:()=>scene});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),lib_constants__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/constants.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/urls.ts"),scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/billing/billingLogic.ts"),lib_lemon_ui_Spinner__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/index.ts"),lib_lemon_ui_LemonCard_LemonCard__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCard/LemonCard.tsx"),kea_router__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),scenes_onboarding_onboardingLogic__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/scenes/onboarding/onboardingLogic.tsx"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const scene={component:Products};function OnboardingCompletedButton(_ref){let{productUrl,onboardingUrl,productKey}=_ref;const{reportOnboardingProductSelected}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_13__.vx);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{type:"secondary",status:"muted",to:productUrl,children:"Go to product"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{type:"tertiary",status:"muted",onClick:()=>{reportOnboardingProductSelected(productKey),kea_router__WEBPACK_IMPORTED_MODULE_11__.router.actions.push(onboardingUrl)},children:"Set up again"})]})}function OnboardingNotCompletedButton(_ref2){let{url,productKey}=_ref2;const{reportOnboardingProductSelected}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_13__.vx);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{type:"primary",onClick:()=>{reportOnboardingProductSelected(productKey),kea_router__WEBPACK_IMPORTED_MODULE_11__.router.actions.push(url)},children:"Get started"})}function ProductCard(_ref3){let{product}=_ref3;const{currentTeam}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic),onboardingCompleted=currentTeam?.has_completed_onboarding_for?.[product.type];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(lib_lemon_ui_LemonCard_LemonCard__WEBPACK_IMPORTED_MODULE_10__.M,{className:"max-w-80 flex flex-col",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div",{className:"flex mb-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div",{className:"bg-mid rounded p-2 flex",children:product.image_url?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("img",{className:"w-6 h-6",alt:`Logo for PostHog ${product.name}`,src:product.image_url}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_1__.NZQ,{className:"w-6 h-6"})})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div",{className:"mb-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("h3",{className:"bold mb-0",children:product.name})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("p",{className:"grow",children:product.description}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div",{className:"flex gap-x-2",children:onboardingCompleted?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(OnboardingCompletedButton,{productUrl:(0,scenes_onboarding_onboardingLogic__WEBPACK_IMPORTED_MODULE_12__.hQ)(product.type),onboardingUrl:scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.onboarding(product.type),productKey:product.type}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(OnboardingNotCompletedButton,{url:scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.onboarding(product.type),productKey:product.type})})]},product.type)}function Products(){const{featureFlags}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_5__.h),{billing}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_8__.kr),{currentTeam}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic),{updateCurrentTeam}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic),isFirstProduct=0===Object.keys(currentTeam?.has_completed_onboarding_for||{}).length,products=billing?.products||[];return(0,react__WEBPACK_IMPORTED_MODULE_4__.useEffect)((()=>{"test"!==featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_6__.y8.PRODUCT_SPECIFIC_ONBOARDING]&&(location.href=scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.ingestion())}),[]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)("div",{className:"flex flex-col w-full h-full p-6 items-center justify-center bg-mid",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)("div",{className:"mb-8",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)("h1",{className:"text-center text-4xl",children:["Pick your ",isFirstProduct?"first":"next"," product."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)("p",{className:"text-center",children:["Pick your ",isFirstProduct?"first":"next"," product to get started with. You can set up any others you'd like later."]})]}),products.length>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div",{className:"flex w-full max-w-xl justify-center gap-6 flex-wrap",children:products.filter((product=>!product.contact_support&&!product.inclusion_only)).map((product=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(ProductCard,{product},product.type)))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div",{className:"mt-20",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{status:"muted",onClick:()=>{updateCurrentTeam({has_completed_onboarding_for:{...currentTeam?.has_completed_onboarding_for,skipped_onboarding:!0}}),kea_router__WEBPACK_IMPORTED_MODULE_11__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.default())},size:"small",children:"None of these"})})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_Spinner__WEBPACK_IMPORTED_MODULE_9__.$,{className:"text-3xl"})]})}}}]);