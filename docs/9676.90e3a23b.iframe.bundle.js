"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[9676],{"./frontend/src/scenes/data-warehouse/DataWarehousePageTabs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>DataWarehouseTab,v:()=>DataWarehousePageTabs});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_constants__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/constants.tsx"),lib_lemon_ui_LemonTabs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/urls.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let DataWarehouseTab=function(DataWarehouseTab){return DataWarehouseTab.Posthog="posthog",DataWarehouseTab.External="external",DataWarehouseTab.Views="views",DataWarehouseTab}({});const tabUrls={[DataWarehouseTab.External]:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.dataWarehouseExternal(),[DataWarehouseTab.Posthog]:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.dataWarehousePosthog(),[DataWarehouseTab.Views]:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.dataWarehouseSavedQueries()},dataWarehouseTabsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","warehouse","dataWarehouseTabsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setTab:tab=>({tab})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({tab:[DataWarehouseTab.External,{setTab:(_,_ref)=>{let{tab}=_ref;return tab}}]}),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.actionToUrl)((()=>({setTab:_ref2=>{let{tab}=_ref2;return tabUrls[tab]||scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.dataWarehousePosthog()}}))),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.urlToAction)((_ref3=>{let{actions,values}=_ref3;return Object.fromEntries(Object.entries(tabUrls).map((_ref4=>{let[key,url]=_ref4;return[url,()=>{values.tab!==key&&actions.setTab(key)}]})))}))]);function DataWarehousePageTabs(_ref5){let{tab}=_ref5;const{setTab}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(dataWarehouseTabsLogic),{featureFlags}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__.h);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonTabs__WEBPACK_IMPORTED_MODULE_3__.T,{activeKey:tab,onChange:t=>setTab(t),tabs:[{key:DataWarehouseTab.External,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{"data-attr":"data-warehouse-external-tab",children:"External"})},{key:DataWarehouseTab.Posthog,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{"data-attr":"data-warehouse-Posthog-tab",children:"PostHog"})},...featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_2__.y8.DATA_WAREHOUSE_VIEWS]?[{key:DataWarehouseTab.Views,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{"data-attr":"data-warehouse-views-tab",children:"Views"})}]:[]]})})}try{DataWarehousePageTabs.displayName="DataWarehousePageTabs",DataWarehousePageTabs.__docgenInfo={description:"",displayName:"DataWarehousePageTabs",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"posthog"'},{value:'"external"'},{value:'"views"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-warehouse/DataWarehousePageTabs.tsx#DataWarehousePageTabs"]={docgenInfo:DataWarehousePageTabs.__docgenInfo,name:"DataWarehousePageTabs",path:"frontend/src/scenes/data-warehouse/DataWarehousePageTabs.tsx#DataWarehousePageTabs"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/data-warehouse/external/DataWarehouseExternalScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DataWarehouseExternalScene:()=>DataWarehouseExternalScene,scene:()=>scene});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),ProductIntroduction=__webpack_require__("./frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),DataWarehousePageTabs=__webpack_require__("./frontend/src/scenes/data-warehouse/DataWarehousePageTabs.tsx"),dataWarehouseSceneLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/external/dataWarehouseSceneLogic.tsx"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),deleteWithUndo=__webpack_require__("./frontend/src/lib/utils/deleteWithUndo.tsx"),DatabaseTable=__webpack_require__("./frontend/src/scenes/data-management/database/DatabaseTable.tsx"),DatabaseTables=__webpack_require__("./frontend/src/scenes/data-management/database/DatabaseTables.tsx"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DataWarehouseTablesContainer(){const{tables,dataWarehouseLoading}=(0,index_esm.useValues)(dataWarehouseSceneLogic.M),{loadDataWarehouse}=(0,index_esm.useActions)(dataWarehouseSceneLogic.M),{currentTeamId}=(0,index_esm.useValues)(teamLogic.teamLogic);return(0,jsx_runtime.jsx)(DatabaseTables.b,{tables,loading:dataWarehouseLoading,renderRow:row=>(0,jsx_runtime.jsxs)("div",{className:"px-4 py-3",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[row.external_data_source?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:"card-secondary mt-2",children:"Files URL pattern"}),(0,jsx_runtime.jsx)("span",{children:row.url_pattern})]}),(0,jsx_runtime.jsx)("span",{className:"card-secondary mt-2",children:"File format"}),(0,jsx_runtime.jsx)("span",{children:row.format})]}),(0,jsx_runtime.jsxs)("div",{className:"mt-2",children:[(0,jsx_runtime.jsx)("span",{className:"card-secondary",children:"Columns"}),(0,jsx_runtime.jsx)(DatabaseTable.B,{table:row.name,tables})]})]}),extraColumns:[{width:0,render:function Render(_,warehouseTable){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.LemonButton,{status:"danger",onClick:()=>{(0,deleteWithUndo.S)({endpoint:`projects/${currentTeamId}/warehouse_tables`,object:{name:warehouseTable.name,id:warehouseTable.id},callback:loadDataWarehouse})},fullWidth:!0,children:"Delete table"})})})}}]})}var SourceModal=__webpack_require__("./frontend/src/scenes/data-warehouse/external/SourceModal.tsx");const scene={component:DataWarehouseExternalScene,logic:dataWarehouseSceneLogic.M};function DataWarehouseExternalScene(){const{shouldShowEmptyState,shouldShowProductIntroduction,isSourceModalOpen}=(0,index_esm.useValues)(dataWarehouseSceneLogic.M),{toggleSourceModal}=(0,index_esm.useActions)(dataWarehouseSceneLogic.M),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:["Data Warehouse",(0,jsx_runtime.jsx)(src.LemonTag,{type:"warning",className:"uppercase",children:"Beta"})]}),buttons:featureFlags[constants.y8.DATA_WAREHOUSE_EXTERNAL_LINK]?(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",sideAction:{icon:(0,jsx_runtime.jsx)(icons.iCC,{}),onClick:()=>lib.router.actions.push(urls.j.dataWarehouseSettings()),"data-attr":"saved-insights-new-insight-dropdown"},"data-attr":"new-data-warehouse-easy-link",onClick:()=>toggleSourceModal(),children:"Link Source"},"new-data-warehouse-easy-link"):shouldShowProductIntroduction||shouldShowEmptyState?void 0:(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",to:urls.j.dataWarehouseTable(),"data-attr":"new-data-warehouse-table",children:"New table"}),caption:(0,jsx_runtime.jsxs)("div",{children:["These are external data sources you can query under SQL insights with"," ",(0,jsx_runtime.jsx)(src.Link,{to:"https://posthog.com/manual/hogql",target:"_blank",children:"HogQL"}),". Connect your own tables from S3 to query data from outside PostHog."," ",(0,jsx_runtime.jsx)(src.Link,{to:"https://posthog.com/docs/data/data-warehouse",children:"Learn more"})]})}),(0,jsx_runtime.jsx)(DataWarehousePageTabs.v,{tab:DataWarehousePageTabs.O.External}),(shouldShowProductIntroduction||shouldShowEmptyState)&&(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Data Warehouse",thingName:"table",description:"Bring your production database, revenue data, CRM contacts or any other data into PostHog.",action:()=>featureFlags[constants.y8.DATA_WAREHOUSE_EXTERNAL_LINK]?toggleSourceModal():lib.router.actions.push(urls.j.dataWarehouseTable()),isEmpty:shouldShowEmptyState,docsURL:"https://posthog.com/docs/data/data-warehouse",productKey:types.Md.DATA_WAREHOUSE}),!shouldShowEmptyState&&(0,jsx_runtime.jsx)(DataWarehouseTablesContainer,{}),(0,jsx_runtime.jsx)(SourceModal.Z,{isOpen:isSourceModalOpen,onClose:()=>toggleSourceModal(!1)})]})}},"./frontend/src/scenes/data-warehouse/external/SourceModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>SourceModal});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx");const stripe_logo=__webpack_require__.p+"images/stripe-logo.b028b0fcb152afb51f2ab5c15b9c8331.svg";var DataWarehouseTableForm=__webpack_require__("./frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),dataWarehouseTableLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/new_table/dataWarehouseTableLogic.tsx"),dataWarehouseSettingsLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts"),dataWarehouseSceneLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/external/dataWarehouseSceneLogic.tsx");const CONNECTORS=[{name:"Stripe",fields:["accound_id","client_secret"],caption:"Enter your Stripe credentials to link your Stripe to PostHog",disabledReason:null}],sourceModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","external","sourceModalLogic"]),(0,index_esm.actions)({selectConnector:connector=>({connector}),toggleManualLinkFormVisible:visible=>({visible})}),(0,index_esm.connect)({values:[dataWarehouseTableLogic.U,["tableLoading"],dataWarehouseSettingsLogic.T,["dataWarehouseSources"]],actions:[dataWarehouseSceneLogic.M,["toggleSourceModal"],dataWarehouseTableLogic.U,["resetTable"],dataWarehouseSettingsLogic.T,["loadSources"]]}),(0,index_esm.reducers)({selectedConnector:[null,{selectConnector:(_,_ref)=>{let{connector}=_ref;return connector}}],isManualLinkFormVisible:[!1,{toggleManualLinkFormVisible:(_,_ref2)=>{let{visible}=_ref2;return visible}}]}),(0,index_esm.selectors)({showFooter:[s=>[s.selectedConnector,s.isManualLinkFormVisible],(selectedConnector,isManualLinkFormVisible)=>selectedConnector||isManualLinkFormVisible],connectors:[s=>[s.dataWarehouseSources],sources=>CONNECTORS.map((connector=>({...connector,disabledReason:sources&&sources.results.find((source=>source.source_type===connector.name))?"Already linked":null})))]}),(0,lib.forms)((()=>({externalDataSource:{defaults:{account_id:"",client_secret:"",prefix:"",source_type:"Stripe"},errors:_ref3=>{let{account_id,client_secret}=_ref3;return{account_id:!account_id&&"Please enter an account id.",client_secret:!client_secret&&"Please enter a client secret."}},submit:async payload=>await api.ZP.externalDataSources.create(payload)}}))),(0,index_esm.listeners)((_ref4=>{let{actions}=_ref4;return{submitExternalDataSourceSuccess:()=>{src.lemonToast.success("New Data Resource Created"),actions.toggleSourceModal(),actions.resetExternalDataSource(),actions.loadSources(),kea_router_lib.router.actions.push(urls.j.dataWarehouseSettings())},submitExternalDataSourceFailure:_ref5=>{let{error}=_ref5;src.lemonToast.error(error?.message||"Something went wrong")}}}))]);var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SourceModal(props){const{tableLoading,isExternalDataSourceSubmitting,selectedConnector,isManualLinkFormVisible,connectors}=(0,index_esm.useValues)(sourceModalLogic),{selectConnector,toggleManualLinkFormVisible,resetExternalDataSource,resetTable}=(0,index_esm.useActions)(sourceModalLogic),MenuButton=config=>(0,jsx_runtime.jsx)(src.LemonButton,{onClick:()=>{selectConnector(config)},className:"w-100",center:!0,type:"secondary",children:(0,jsx_runtime.jsx)("img",{src:stripe_logo,alt:"stripe logo",height:50})}),onClear=()=>{selectConnector(null),toggleManualLinkFormVisible(!1),resetExternalDataSource(),resetTable()},onManualLinkClick=()=>{toggleManualLinkFormVisible(!0)};return(0,jsx_runtime.jsx)(src.LemonModal,{...props,onAfterClose:()=>onClear(),title:"Data Sources",description:selectedConnector?selectedConnector.caption:null,children:selectedConnector?(0,jsx_runtime.jsxs)(lib.Form,{logic:sourceModalLogic,formKey:"externalDataSource",className:"space-y-4",enableFormOnSubmit:!0,children:[(0,jsx_runtime.jsx)(Field.g,{name:"prefix",label:"Table Prefix",children:(0,jsx_runtime.jsx)(src.LemonInput,{className:"ph-ignore-input",autoFocus:!0,"data-attr":"prefix",placeholder:"internal_"})}),(0,jsx_runtime.jsx)(Field.g,{name:"account_id",label:"Stripe Account ID",children:(0,jsx_runtime.jsx)(src.LemonInput,{className:"ph-ignore-input",autoFocus:!0,"data-attr":"account-id",placeholder:"acct_"})}),(0,jsx_runtime.jsx)(Field.g,{name:"client_secret",label:"Stripe Client Secret",children:(0,jsx_runtime.jsx)(src.LemonInput,{className:"ph-ignore-input",autoFocus:!0,"data-attr":"client-secret",placeholder:"sklive"})}),(0,jsx_runtime.jsx)(src.LemonDivider,{className:"mt-4"}),(0,jsx_runtime.jsxs)("div",{className:"mt-2 flex flex-row justify-end gap-2",children:[(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",center:!0,"data-attr":"source-modal-back-button",onClick:onClear,children:"Back"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",center:!0,htmlType:"submit","data-attr":"source-link",loading:isExternalDataSourceSubmitting,children:"Link"})]})]}):isManualLinkFormVisible?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(DataWarehouseTableForm.V,{footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonDivider,{className:"mt-4"}),(0,jsx_runtime.jsxs)("div",{className:"mt-2 flex flex-row justify-end gap-2",children:[(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",center:!0,"data-attr":"source-modal-back-button",onClick:onClear,children:"Back"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",center:!0,htmlType:"submit","data-attr":"source-link",loading:tableLoading,children:"Link"})]})]})})}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[connectors.map(((config,index)=>(0,jsx_runtime.jsx)(MenuButton,{...config},config.name+"_"+index))),(0,jsx_runtime.jsx)(src.LemonButton,{onClick:onManualLinkClick,className:"w-100",center:!0,type:"secondary",children:"Manual Link"})]})})}try{SourceModal.displayName="SourceModal",SourceModal.__docgenInfo={description:"",displayName:"SourceModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!1,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!1,type:{name:"(() => void)"}},onAfterClose:{defaultValue:null,description:"",name:"onAfterClose",required:!1,type:{name:"(() => void)"}},width:{defaultValue:null,description:"",name:"width",required:!1,type:{name:"string | number"}},inline:{defaultValue:null,description:"",name:"inline",required:!1,type:{name:"boolean"}},title:{defaultValue:null,description:"",name:"title",required:!1,type:{name:"ReactNode"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"ReactNode"}},footer:{defaultValue:null,description:"",name:"footer",required:!1,type:{name:"ReactNode"}},simple:{defaultValue:null,description:"When enabled, the modal content will only include children allowing greater customisation",name:"simple",required:!1,type:{name:"boolean"}},closable:{defaultValue:null,description:"",name:"closable",required:!1,type:{name:"boolean"}},hasUnsavedInput:{defaultValue:null,description:"If there is unsaved input that's not persisted, the modal can't be closed closed on overlay click.",name:"hasUnsavedInput",required:!1,type:{name:"boolean"}},fullScreen:{defaultValue:null,description:"Expands the modal to fill the entire screen",name:"fullScreen",required:!1,type:{name:"boolean"}},forceAbovePopovers:{defaultValue:null,description:"A modal launched from a popover can appear behind the popover. This allows you to force the modal to appear above the popover.",name:"forceAbovePopovers",required:!1,type:{name:"boolean"}},contentRef:{defaultValue:null,description:"",name:"contentRef",required:!1,type:{name:"((instance: HTMLDivElement | null) => void)"}},overlayRef:{defaultValue:null,description:"",name:"overlayRef",required:!1,type:{name:"((instance: HTMLDivElement | null) => void)"}},getPopupContainer:{defaultValue:null,description:"",name:"getPopupContainer",required:!1,type:{name:"(() => HTMLElement)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-warehouse/external/SourceModal.tsx#SourceModal"]={docgenInfo:SourceModal.__docgenInfo,name:"SourceModal",path:"frontend/src/scenes/data-warehouse/external/SourceModal.tsx#SourceModal"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/data-warehouse/external/dataWarehouseSceneLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M:()=>dataWarehouseSceneLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/types.ts");const dataWarehouseSceneLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","warehouse","dataWarehouseSceneLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)((()=>({values:[scenes_userLogic__WEBPACK_IMPORTED_MODULE_3__.userLogic,["user"]]}))),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({toggleSourceModal:isOpen=>({isOpen})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({isSourceModalOpen:[!1,{toggleSourceModal:(state,_ref)=>{let{isOpen}=_ref;return null!=isOpen?isOpen:!state}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({dataWarehouse:[null,{loadDataWarehouse:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.dataWarehouseTables.list()}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({tables:[s=>[s.dataWarehouse],warehouse=>warehouse?warehouse.results.map((table=>({id:table.id,name:table.name,columns:table.columns,url_pattern:table.url_pattern,format:table.format,external_data_source:table.external_data_source}))):[]],shouldShowEmptyState:[s=>[s.tables,s.dataWarehouseLoading],(tables,dataWarehouseLoading)=>0==tables?.length&&!dataWarehouseLoading],shouldShowProductIntroduction:[s=>[s.user],user=>!user?.has_seen_product_intro_for?.[_types__WEBPACK_IMPORTED_MODULE_4__.Md.DATA_WAREHOUSE]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref2=>{let{actions}=_ref2;actions.loadDataWarehouse()}))])},"./frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>DatawarehouseTableForm});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_forms_Field__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/data-warehouse/new_table/dataWarehouseTableLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DatawarehouseTableForm(_ref){let{footer}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(kea_forms__WEBPACK_IMPORTED_MODULE_1__.Form,{formKey:"table",logic:_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_3__.U,className:"space-y-4",enableFormOnSubmit:!0,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"flex flex-col gap-2 max-w-160",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_2__.g,{name:"name",label:"Table Name",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonInput,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"Examples: stripe_invoice, hubspot_contacts, users",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"text-muted text-xs mb-4",children:"This will be the table name used when writing queries"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_2__.g,{name:"url_pattern",label:"Files URL pattern",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonInput,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: https://your-org.s3.amazonaws.com/airbyte/stripe/invoices/*.pqt",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"text-muted text-xs mb-4",children:["You can use ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("strong",{children:"*"})," to select multiple files."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_2__.g,{name:"format",label:"File format",className:"w-max",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonSelect,{"data-attr":"table-format",options:[{label:"Parquet (recommended)",value:"Parquet"},{label:"CSV",value:"CSV"},{label:"JSON",value:"JSONEachRow"}]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_2__.g,{name:["credential","access_key"],label:"Access Key",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonInput,{"data-attr":"access-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: AKIAIOSFODNN7EXAMPLE",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_2__.g,{name:["credential","access_secret"],label:"Access Secret",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonInput,{"data-attr":"access-secret",className:"ph-ignore-input",autoFocus:!0,type:"password",placeholder:"eg: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})]}),footer]})}try{DatawarehouseTableForm.displayName="DatawarehouseTableForm",DatawarehouseTableForm.__docgenInfo={description:"",displayName:"DatawarehouseTableForm",props:{footer:{defaultValue:null,description:"",name:"footer",required:!1,type:{name:"Element"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx#DatawarehouseTableForm"]={docgenInfo:DatawarehouseTableForm.__docgenInfo,name:"DatawarehouseTableForm",path:"frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx#DatawarehouseTableForm"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/data-warehouse/new_table/dataWarehouseTableLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>dataWarehouseTableLogic});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/data-management/database/databaseTableListLogic.ts"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/urls.ts"),_external_dataWarehouseSceneLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/data-warehouse/external/dataWarehouseSceneLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const NEW_WAREHOUSE_TABLE={id:"",name:"",url_pattern:"",format:"Parquet",credential:{access_key:"",access_secret:""},columns:[]},dataWarehouseTableLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","data-warehouse","tableLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)((()=>({actions:[scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__.A,["loadDatabase"],_external_dataWarehouseSceneLogic__WEBPACK_IMPORTED_MODULE_9__.M,["loadDataWarehouse","toggleSourceModal"]]}))),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({editingTable:editing=>({editing}),updateTargetingFlagFilters:(index,properties)=>({index,properties}),addConditionSet:!0,removeConditionSet:index=>({index}),launchTable:!0,stopTable:!0,archiveTable:!0,setDataTableQuery:query=>({query})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_3__.loaders)((_ref=>{let{props}=_ref;return{table:{loadTable:async()=>props.id&&"new"!==props.id?await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.get(props.id):{...NEW_WAREHOUSE_TABLE},createTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.create({...tablePayload}),updateTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.update(props.id,tablePayload)}}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)((_ref2=>{let{actions}=_ref2;return{createTableSuccess:async _ref3=>{let{table}=_ref3;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:["Table ",table.name," created"]})),actions.loadDatabase(),actions.loadDataWarehouse(),actions.toggleSourceModal(!1),kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.dataWarehouse())},updateTableSuccess:async _ref4=>{let{table}=_ref4;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:["Table ",table.name," updated"]})),actions.editingTable(!1),kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.dataWarehouse())}}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)({isEditingTable:[!1,{editingTable:(_,_ref5)=>{let{editing}=_ref5;return editing}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref6)=>{let{query}=_ref6;return query}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.selectors)({breadcrumbs:[()=>[],()=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_7__.x.DataWarehouse,name:"Data warehouse",path:scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.dataWarehouseExternal()},{key:"new",name:"New"}]]}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_2__.forms)((_ref7=>{let{actions,props}=_ref7;return{table:{defaults:{...NEW_WAREHOUSE_TABLE},errors:_ref8=>{let{name,url_pattern,credential,format}=_ref8;return{name:!name&&"Please enter a name.",url_pattern:!url_pattern&&"Please enter a url pattern.",credential:{access_secret:!credential.access_secret&&"Please enter an access secret.",access_key:!credential.access_key&&"Please enter an access key."},format:!format&&"Please enter the format of your files."}},submit:async tablePayload=>{props.id&&"new"!==props.id?actions.updateTable(tablePayload):actions.createTable(tablePayload)}}}}))])},"./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>dataWarehouseSettingsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/urls.ts");const dataWarehouseSettingsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-warehouse","settings","dataWarehouseSettingsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({deleteSource:source=>({source}),reloadSource:source=>({source}),loadingFinished:source=>({source})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({dataWarehouseSources:[null,{loadSources:async()=>lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSources.list()}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({sourceReloadingById:[{},{reloadSource:(state,_ref)=>{let{source}=_ref;return{...state,[source.id]:!0}},deleteSource:(state,_ref2)=>{let{source}=_ref2;return{...state,[source.id]:!0}},loadingFinished:(state,_ref3)=>{let{source}=_ref3;return{...state,[source.id]:!1}}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.DataWarehouse,name:"Data Warehouse",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.dataWarehouseExternal()},{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.DataWarehouseSettings,name:"Data Warehouse Settings",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.dataWarehouseSettings()}]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((_ref4=>{let{actions,cache}=_ref4;return{loadSourcesSuccess:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout((()=>{actions.loadSources()}),5e3)},deleteSource:async _ref5=>{let{source}=_ref5;await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSources.delete(source.id),actions.loadSources(),actions.loadingFinished(source)},reloadSource:async _ref6=>{let{source}=_ref6;await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSources.reload(source.id),actions.loadSources(),actions.loadingFinished(source)}}})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref7=>{let{actions}=_ref7;actions.loadSources()}))])}}]);