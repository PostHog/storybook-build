"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[91005],{"../../frontend/src/lib/components/IframedToolbarBrowser/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{PJ:()=>heatmapDateOptions,TH:()=>PostHogAppToolbarEvent,_f:()=>DEFAULT_HEATMAP_FILTERS,f6:()=>calculateViewportRange});var lib_components_DateFilter_types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/lib/components/DateFilter/types.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/utils.tsx");let PostHogAppToolbarEvent=function(PostHogAppToolbarEvent){return PostHogAppToolbarEvent.PH_TOOLBAR_INIT="ph-toolbar-init",PostHogAppToolbarEvent.PH_TOOLBAR_READY="ph-toolbar-ready",PostHogAppToolbarEvent.PH_APP_INIT="ph-app-init",PostHogAppToolbarEvent.PH_ELEMENT_SELECTOR="ph-element-selector",PostHogAppToolbarEvent.PH_NEW_ACTION_NAME="ph-new-action-name",PostHogAppToolbarEvent.PH_NEW_ACTION_CREATED="ph-new-action-created",PostHogAppToolbarEvent.PH_TOOLBAR_NAVIGATED="ph-toolbar-navigated",PostHogAppToolbarEvent}({}),DEFAULT_HEATMAP_FILTERS={enabled:!0,type:"click",viewportAccuracy:.9,aggregation:"total_count"},calculateViewportRange=(heatmapFilters,windowWidth)=>{var _heatmapFilters$viewp;let extraPixels=windowWidth-windowWidth*(null!==(_heatmapFilters$viewp=heatmapFilters.viewportAccuracy)&&void 0!==_heatmapFilters$viewp?_heatmapFilters$viewp:.2);return{min:Math.round(Math.max(0,windowWidth-extraPixels)),max:Math.round(windowWidth+extraPixels)}},dateItemDenyList=["Last 180 days","This month","Previous month","Year to date","All time"],heatmapDateOptions=lib_utils__WEBPACK_IMPORTED_MODULE_1__.bE.filter(dm=>dm.key!==lib_components_DateFilter_types__WEBPACK_IMPORTED_MODULE_0__.Q2&&!dateItemDenyList.includes(dm.key))},"../../frontend/src/lib/components/heatmaps/heatmapDataLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>HEATMAP_COLOR_PALETTE_OPTIONS,y:()=>heatmapDataLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.7_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),kea_window_values__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/kea-window-values@3.0.1_kea@3.1.7_react@18.2.0_/node_modules/kea-window-values/lib/index.js"),lib_components_IframedToolbarBrowser_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/components/IframedToolbarBrowser/utils.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/utils.tsx"),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/toolbar/toolbarConfigLogic.ts");let HEATMAP_COLOR_PALETTE_OPTIONS=[{value:"default",label:"Default (multicolor)"},{value:"red",label:"Red (monocolor)"},{value:"green",label:"Green (monocolor)"},{value:"blue",label:"Blue (monocolor)"}],heatmapDataLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(key=>["lib","components","heatmap","heatmapDataLogic",key]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({context:"toolbar",exportToken:null}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.context),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadHeatmap:!0,setCommonFilters:filters=>({filters}),setHeatmapFilters:filters=>({filters}),patchHeatmapFilters:filters=>({filters}),setHeatmapFixedPositionMode:mode=>({mode}),setHeatmapColorPalette:Palette=>({Palette}),setHref:href=>({href}),setHrefMatchType:matchType=>({matchType}),setHeatmapScrollY:scrollY=>({scrollY}),setWindowWidthOverride:widthOverride=>({widthOverride}),setIsReady:isReady=>({isReady})}),(0,kea_window_values__WEBPACK_IMPORTED_MODULE_4__.windowValues)(()=>({windowWidth:window=>window.innerWidth,windowHeight:window=>window.innerHeight})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({hrefMatchType:["exact",{setHrefMatchType:(_,_ref)=>{let{matchType}=_ref;return matchType}}],commonFilters:[{date_from:"-7d"},{setCommonFilters:(_,_ref2)=>{let{filters}=_ref2;return filters}}],heatmapFilters:[lib_components_IframedToolbarBrowser_utils__WEBPACK_IMPORTED_MODULE_5__._f,{persist:!0},{setHeatmapFilters:(_,_ref3)=>{let{filters}=_ref3;return filters},patchHeatmapFilters:(state,_ref4)=>{let{filters}=_ref4;return{...state,...filters}}}],heatmapFixedPositionMode:["fixed",{setHeatmapFixedPositionMode:(_,_ref5)=>{let{mode}=_ref5;return mode}}],heatmapColorPalette:["default",{persist:!0},{setHeatmapColorPalette:(_,_ref6)=>{let{Palette}=_ref6;return Palette}}],href:[null,{setHref:(_,_ref7)=>{let{href}=_ref7;return href}}],heatmapScrollY:[0,{setHeatmapScrollY:(_,_ref8)=>{let{scrollY}=_ref8;return scrollY}}],windowWidthOverride:[null,{setWindowWidthOverride:(_,_ref9)=>{let{widthOverride}=_ref9;return widthOverride}}],isReady:[!1,{setIsReady:(_,_ref10)=>{let{isReady}=_ref10;return isReady}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref11=>{let{values,props,actions}=_ref11;return{rawHeatmap:[null,{resetHeatmapData:()=>({results:[]}),loadHeatmap:async(_,breakpoint)=>{if(await breakpoint(150),!values.href||!values.href.trim().length||!values.heatmapFilters.enabled)return null;actions.setIsReady(!1);let{date_from,date_to,filter_test_accounts}=values.commonFilters,{type,aggregation}=values.heatmapFilters,apiURL=`/api/heatmap/${(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.encodeParams)({type,date_from,date_to,url_exact:"exact"===values.hrefMatchType?values.href:void 0,url_pattern:"pattern"===values.hrefMatchType?values.href:void 0,viewport_width_min:values.viewportRange.min,viewport_width_max:values.viewportRange.max,aggregation,filter_test_accounts},"?")}`,response=await ("toolbar"===props.context?(0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_7__.O)(apiURL,"GET"):props.exportToken?fetch(apiURL,{headers:{Authorization:`Bearer ${props.exportToken}`}}):fetch(apiURL));if(breakpoint(),"toolbar"===props.context&&403===response.status&&_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_7__.W.actions.authenticate(),200!==response.status)throw Error("API error");let data=await response.json();return actions.setIsReady(!0),data}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({dateRange:[s=>[s.commonFilters],commonFilters=>(0,lib_utils__WEBPACK_IMPORTED_MODULE_6__.Kl)(commonFilters.date_from,commonFilters.date_to,"Last 7 days")],heatmapElements:[s=>[s.rawHeatmap],rawHeatmap=>{if(!rawHeatmap)return[];let elements=[];return rawHeatmap?.results.forEach(element=>{"scroll_depth_bucket"in element?elements.push({count:element.cumulative_count,xPercentage:0,targetFixed:!1,y:element.scroll_depth_bucket}):elements.push({count:element.count,xPercentage:element.pointer_relative_x,targetFixed:element.pointer_target_fixed,y:element.pointer_y})}),elements}],viewportRange:[s=>[s.heatmapFilters,s.windowWidth,s.windowWidthOverride],(heatmapFilters,windowWidth,windowWidthOverride)=>(0,lib_components_IframedToolbarBrowser_utils__WEBPACK_IMPORTED_MODULE_5__.f6)(heatmapFilters,null!=windowWidthOverride?windowWidthOverride:windowWidth)],heatmapTooltipLabel:[s=>[s.heatmapFilters],heatmapFilters=>"unique_visitors"===heatmapFilters.aggregation?"visitors":heatmapFilters.type+"s"],heatmapEmpty:[s=>[s.rawHeatmap,s.rawHeatmapLoading],(rawHeatmap,rawHeatmapLoading)=>rawHeatmap?.results.length===0&&!rawHeatmapLoading],heatmapJsData:[s=>[s.heatmapElements,s.heatmapScrollY,s.windowWidth,s.windowWidthOverride,s.heatmapFixedPositionMode],(heatmapElements,heatmapScrollY,windowWidth,windowWidthOverride,heatmapFixedPositionMode)=>{let width=null!=windowWidthOverride?windowWidthOverride:windowWidth,data=heatmapElements.reduce((acc,element)=>{if("hidden"===heatmapFixedPositionMode&&element.targetFixed)return acc;let y=Math.round(element.targetFixed&&"fixed"===heatmapFixedPositionMode?element.y:element.y-heatmapScrollY),x=Math.round(element.xPercentage*width);return acc.push({x,y,value:element.count}),acc},[]);return{min:0,max:data.reduce((max,_ref12)=>{let{value}=_ref12;return Math.max(max,value)},0),data}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref13=>{let{actions}=_ref13;return{setCommonFilters:()=>{actions.loadHeatmap()},setHeatmapFilters:()=>{actions.loadHeatmap()},patchHeatmapFilters:_ref14=>{let{filters}=_ref14;filters.type&&actions.resetHeatmapData(),actions.loadHeatmap()},setHeatmapFixedPositionMode:()=>{actions.loadHeatmap()},setHeatmapColorPalette:()=>{actions.loadHeatmap()},setHref:()=>{actions.loadHeatmap()},setWindowWidthOverride:()=>{actions.loadHeatmap()}}}),(0,kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__.Vt)(_ref15=>{let{actions}=_ref15;return{windowWidth:()=>{actions.loadHeatmap()},windowHeight:()=>{actions.loadHeatmap()}}})])},"../../frontend/src/scenes/heatmaps/components/HeatmapsForbiddenURL.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>HeatmapsForbiddenURL});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_components_AuthorizedUrlList_AuthorizedUrlList__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),lib_components_AuthorizedUrlList_authorizedUrlListLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),scenes_heatmaps_scenes_heatmap_heatmapLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/heatmaps/scenes/heatmap/heatmapLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function HeatmapsForbiddenURL(){let{dataUrl}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(scenes_heatmaps_scenes_heatmap_heatmapLogic__WEBPACK_IMPORTED_MODULE_4__.X);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex-1 gap-y-4 my-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Vp,{type:"error",children:[dataUrl," is not an authorized URL. Please add it to the list of authorized URLs to view heatmaps on this page."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("h4",{className:"my-4",children:"Authorized Toolbar URLs"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(lib_components_AuthorizedUrlList_AuthorizedUrlList__WEBPACK_IMPORTED_MODULE_2__.t,{type:lib_components_AuthorizedUrlList_authorizedUrlListLogic__WEBPACK_IMPORTED_MODULE_3__.uw.TOOLBAR_URLS})]})}},"../../frontend/src/scenes/heatmaps/scenes/heatmap/HeatmapNewScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HeatmapNewScene:()=>HeatmapNewScene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),index_module=__webpack_require__("../../node_modules/.pnpm/use-debounce@9.0.3_react@18.2.0/node_modules/use-debounce/dist/index.module.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonInput=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),LemonRadio=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonRadio/index.ts"),HeatmapsForbiddenURL=__webpack_require__("../../frontend/src/scenes/heatmaps/components/HeatmapsForbiddenURL.tsx");__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx");var heatmapLogic=__webpack_require__("../../frontend/src/scenes/heatmaps/scenes/heatmap/heatmapLogic.ts"),heatmapsBrowserLogic=__webpack_require__("../../frontend/src/scenes/heatmaps/components/heatmapsBrowserLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function HeatmapsUrlsList(){let{topUrls,topUrlsLoading,noPageviews}=(0,index_esm.useValues)(heatmapsBrowserLogic.p),{setDisplayUrl}=(0,index_esm.useActions)(heatmapLogic.X);return(0,jsx_runtime.jsx)("div",{className:"flex-1 flex items-center overflow-y-auto",children:(0,jsx_runtime.jsx)("div",{className:" w-full",children:(0,jsx_runtime.jsx)("div",{className:"gap-y-px p-2 border bg-surface-primary rounded",children:topUrlsLoading?(0,jsx_runtime.jsx)(src.yW,{className:"h-10",repeat:10}):noPageviews?(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:"No pageview events have been received yet. Once you have some data, you'll see the most viewed pages here."}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:"text-sm font-medium text-muted ml-2",children:"Most viewed pages:"}),topUrls?.map(_ref=>{let{url}=_ref;return jsx_runtime.jsx(src.Jp,{fullWidth:!0,onClick:()=>{setDisplayUrl(url)},children:url},url)})]})})})})}function HeatmapsInvalidURL(){return(0,jsx_runtime.jsx)("div",{className:"flex-1 py-4 gap-y-4 mb-2",children:(0,jsx_runtime.jsx)(src.Vp,{type:"error",children:"Not a valid URL. Can't load a heatmap for that \uD83D\uDE30"})})}var urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),SceneLayout=__webpack_require__("../../frontend/src/layout/scenes/SceneLayout.tsx"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneSection.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx");function HeatmapNewScene(){let logic=(0,heatmapLogic.X)({id:"new"}),{loading,displayUrl,isDisplayUrlValid,type,name,dataUrl,isBrowserUrlAuthorized}=(0,index_esm.useValues)(logic),{setDisplayUrl,setType,setName,createHeatmap,setDataUrl}=(0,index_esm.useActions)(logic),debouncedOnNameChange=(0,index_module.y1)(name=>{setName(name)},500);return loading?(0,jsx_runtime.jsx)(SceneContent._,{children:(0,jsx_runtime.jsx)(src.$j,{})}):(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:name,resourceType:{type:"heatmap"},description:null,canEdit:!0,forceEdit:!0,onNameChange:debouncedOnNameChange,forceBackTo:{name:"Heatmaps",path:urls.j.heatmaps(),key:"heatmaps"}}),(0,jsx_runtime.jsx)(SceneLayout.bI,{}),(0,jsx_runtime.jsxs)(SceneSection.S,{title:"Page URL",description:"URL to your website",children:[(0,jsx_runtime.jsx)(LemonInput.D,{value:displayUrl||"",onChange:setDisplayUrl,placeholder:"https://www.example.com"}),isDisplayUrlValid?null:(0,jsx_runtime.jsx)(HeatmapsInvalidURL,{}),""===displayUrl?(0,jsx_runtime.jsx)(HeatmapsUrlsList,{}):null]}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsxs)(SceneSection.S,{title:"Heatmap data URL",description:"An exact match or a pattern for heatmap data. For example, use a pattern if you have pages with dynamic IDs. E.g. https://www.example.com/users/* will aggregate data from all pages under /users/.",children:[(0,jsx_runtime.jsx)(LemonInput.D,{size:"small",placeholder:"https://www.example.com/*",value:null!=dataUrl?dataUrl:"",onChange:value=>{setDataUrl(value||null)},fullWidth:!0}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted mt-1",children:"Add * for wildcards to aggregate data from multiple pages"}),dataUrl&&!isBrowserUrlAuthorized?(0,jsx_runtime.jsx)(HeatmapsForbiddenURL.A,{}):null]}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(SceneSection.S,{title:"Capture method",description:"Choose how to display your page in the heatmap",children:(0,jsx_runtime.jsx)(LemonRadio._,{options:[{label:"Screenshot",value:"screenshot",description:"We will generate a full-page screenshot of your website"},{label:"Iframe",value:"iframe",description:"We will load your website in an iframe. Make sure you allow your website to be loaded in an iframe."}],value:type,onChange:value=>setType(value)})}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)("div",{className:"flex gap-2",children:(0,jsx_runtime.jsx)(LemonButton.J,{className:"w-fit",type:"primary","data-attr":"save-heatmap",onClick:createHeatmap,loading:!1,disabledReason:isDisplayUrlValid&&isBrowserUrlAuthorized?displayUrl?dataUrl?null:"Heatmap data URL is required":"URL is required":"Invalid URL or forbidden URL",children:"Save"})})]})}}}]);