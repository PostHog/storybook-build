"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[53625],{"../../products/messaging/frontend/Broadcasts.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Broadcasts:()=>Broadcasts,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.6_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),HogFunctionConfiguration=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/HogFunctionConfiguration.tsx"),HogFunctionLogs=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/logs/HogFunctionLogs.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts");let broadcastsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","broadcastsLogic"]),(0,index_esm.actions)({editBroadcast:id=>({id})}),(0,index_esm.reducers)({broadcastId:[null,{editBroadcast:(_,_ref)=>{let{id}=_ref;return id}}]}),(0,index_esm.selectors)({breadcrumbs:[s=>[s.broadcastId],broadcastId=>[{key:sceneTypes.x.MessagingBroadcasts,name:"Messaging",path:urls.j.messagingBroadcasts()},{key:"broadcasts",name:"Broadcasts",path:urls.j.messagingBroadcasts()},..."new"===broadcastId?[{key:"new-broadcast",name:"New broadcast",path:urls.j.messagingBroadcastNew()}]:broadcastId?[{key:"edit-broadcast",name:"Manage broadcast",path:urls.j.messagingBroadcast(broadcastId)}]:[]]],projectTreeRef:[s=>[s.broadcastId],id=>({type:"hog_function/broadcast",ref:String(id)})]}),(0,lib.urlToAction)(_ref2=>{let{actions}=_ref2;return{"/messaging/broadcasts/new":()=>{actions.editBroadcast("new")},"/messaging/broadcasts/:id":_ref3=>{let{id}=_ref3;actions.editBroadcast(null!=id?id:null)},"/messaging/broadcasts":()=>{actions.editBroadcast(null)}}})]),broadcastTabsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","broadcastTabsLogic"]),(0,index_esm.actions)({setTab:tab=>({tab})}),(0,index_esm.reducers)({currentTab:["configuration",{setTab:(_,_ref)=>{let{tab}=_ref;return tab}}]})]);var FunctionsTable=__webpack_require__("../../products/messaging/frontend/FunctionsTable.tsx"),MessagingTabs=__webpack_require__("../../products/messaging/frontend/MessagingTabs.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let Broadcast=_ref=>{let{broadcastId}=_ref,{currentTab}=(0,index_esm.useValues)(broadcastTabsLogic),{setTab}=(0,index_esm.useActions)(broadcastTabsLogic);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:["new"!==broadcastId&&(0,jsx_runtime.jsx)(src.TP,{activeKey:currentTab,onChange:tab=>setTab(tab),tabs:[{key:"configuration",label:"Configuration"},{key:"logs",label:"Logs"}]}),"configuration"===currentTab&&(0,jsx_runtime.jsx)(HogFunctionConfiguration.g,{id:"new"===broadcastId?null:broadcastId,templateId:"new"===broadcastId?"template-new-broadcast":"",displayOptions:{showStatus:!1,showEnabled:!1,canEditSource:!1}}),"logs"===currentTab&&(0,jsx_runtime.jsx)(HogFunctionLogs.x,{hogFunctionId:broadcastId})]})};function Broadcasts(){let{broadcastId}=(0,index_esm.useValues)(broadcastsLogic);return broadcastId?(0,jsx_runtime.jsx)(Broadcast,{broadcastId:broadcastId}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(MessagingTabs.J,{},"broadcasts-tabs"),(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Send one time communications to your users",buttons:(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"new-broadcast",to:urls.j.messagingBroadcastNew(),type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.iU,{}),children:"New broadcast"})}),(0,jsx_runtime.jsx)(FunctionsTable.c,{type:"broadcast"})]})}let scene={component:Broadcasts,logic:broadcastsLogic}},"../../products/messaging/frontend/FunctionsTable.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>FunctionsTable});var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonMenu=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/LemonMenu.tsx"),columnUtils=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),HogFunctionIcon=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/HogFunctionIcon.tsx"),HogFunctionStatusIndicator=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/HogFunctionStatusIndicator.tsx"),urls=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/urls.ts"),scenes_urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),fuse_esm=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),deleteWithUndo=__webpack_require__("../../frontend/src/lib/utils/deleteWithUndo.tsx"),projectLogic=__webpack_require__("../../frontend/src/scenes/projectLogic.ts");let functionsTableLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","functionsTableLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>{var _props$type;return null!==(_props$type=props.type)&&void 0!==_props$type?_props$type:"destination"}),(0,index_esm.connect)(()=>({values:[projectLogic.K,["currentProjectId"]]})),(0,index_esm.actions)({deleteHogFunction:hogFunction=>({hogFunction}),setFilters:filters=>({filters}),resetFilters:!0}),(0,index_esm.reducers)({filters:[{},{setFilters:(state,_ref)=>{let{filters}=_ref;return{...state,...filters}},resetFilters:()=>({})}]}),(0,lib.loaders)(_ref2=>{let{props,values,actions}=_ref2;return{hogFunctions:[[],{loadHogFunctions:async()=>{var _props$type2;return(await api.ZP.hogFunctions.list({types:[null!==(_props$type2=props.type)&&void 0!==_props$type2?_props$type2:"destination"],kinds:props.kind?[props.kind]:void 0})).results},deleteHogFunction:async _ref3=>{let{hogFunction}=_ref3;return await (0,deleteWithUndo.S)({endpoint:`projects/${values.currentProjectId}/hog_functions`,object:{id:hogFunction.id,name:hogFunction.name},callback:undo=>{undo&&actions.loadHogFunctions()}}),values.hogFunctions.filter(hf=>hf.id!==hogFunction.id)}}]}}),(0,index_esm.selectors)({loading:[s=>[s.hogFunctionsLoading],hogFunctionsLoading=>hogFunctionsLoading],hogFunctionsFuse:[s=>[s.hogFunctions],hogFunctions=>new fuse_esm.Z(hogFunctions||[],{keys:["name","description"],threshold:.3})],filteredHogFunctions:[s=>[s.filters,s.hogFunctions,s.hogFunctionsFuse],(filters,hogFunctions,hogFunctionsFuse)=>{let{search}=filters;return search?hogFunctionsFuse.search(search).map(x=>x.item):hogFunctions}]}),(0,index_esm.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadHogFunctions()})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function FunctionsTableFilters(){var _filters$search;let{filters}=(0,index_esm.useValues)(functionsTableLogic),{setFilters}=(0,index_esm.useActions)(functionsTableLogic);return(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-2",children:(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search...",value:null!==(_filters$search=filters.search)&&void 0!==_filters$search?_filters$search:"",onChange:e=>setFilters({search:e})})})})}function FunctionsTable(_ref){let{type,kind}=_ref,{hogFunctions,filteredHogFunctions,loading}=(0,index_esm.useValues)(functionsTableLogic({type,kind})),{deleteHogFunction,resetFilters}=(0,index_esm.useActions)(functionsTableLogic({type,kind}));return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:functionsTableLogic,props:{type,kind},children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(FunctionsTableFilters,{}),(0,jsx_runtime.jsx)(src.g3,{dataSource:filteredHogFunctions,size:"small",loading:loading,columns:[{title:"App",width:0,render:function RenderAppInfo(_,hogFucntion){return(0,jsx_runtime.jsx)(HogFunctionIcon._,{src:hogFucntion.icon_url,size:"small"})}},{title:"Name",sticky:!0,sorter:!0,key:"name",dataIndex:"name",render:function RenderPluginName(_,hogFunction){return(0,jsx_runtime.jsx)(LemonTableLink.i,{to:(0,urls.PS)(hogFunction.type,hogFunction.id,hogFunction.template?.id,hogFunction.kind),title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.u,{title:"Click to update configuration, view metrics, and more",children:(0,jsx_runtime.jsx)("span",{children:hogFunction.name})})}),description:hogFunction.description})}},(0,columnUtils.yI)(),{title:"Status",key:"enabled",sorter:a=>a.enabled?1:-1,width:0,render:function RenderStatus(_,hogFunction){return(0,jsx_runtime.jsx)(HogFunctionStatusIndicator.F,{hogFunction:hogFunction})}},{width:0,render:function Render(_,hogFunction){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(LemonMenu.iy,{items:[{label:"Create template",to:scenes_urls.j.messagingLibraryTemplateFromMessage(hogFunction.id)},{label:"Delete",status:"danger",onClick:()=>deleteHogFunction(hogFunction)}]})})}}],emptyState:0!==hogFunctions.length||loading?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Nothing matches filters. ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>resetFilters(),children:"Clear filters"})," "]}):"Nothing found"})]})})}},"../../products/messaging/frontend/MessagingTabs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{J:()=>MessagingTabs});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");let messagingTabsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","messagingTabsLogic"]),(0,index_esm.actions)({setTab:function(tab){let fromUrl=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{tab,fromUrl}}}),(0,index_esm.reducers)({currentTab:["broadcasts",{setTab:(_,_ref)=>{let{tab}=_ref;return tab}}]}),(0,lib.actionToUrl)(_ref2=>{let{values}=_ref2;return{setTab:_ref3=>{let{fromUrl}=_ref3;if(!fromUrl){var _campaigns$broadcasts;return null!==(_campaigns$broadcasts=({campaigns:urls.j.messagingCampaigns(),broadcasts:urls.j.messagingBroadcasts(),library:urls.j.messagingLibrary()})[values.currentTab])&&void 0!==_campaigns$broadcasts?_campaigns$broadcasts:urls.j.messagingBroadcasts()}}}}),(0,lib.urlToAction)(_ref4=>{let{actions,values}=_ref4;return{"/messaging/:tab":_ref5=>{let{tab}=_ref5;tab!==values.currentTab&&actions.setTab(tab,!0)},"/messaging/:tab/*":_ref6=>{let{tab}=_ref6;tab!==values.currentTab&&actions.setTab(tab,!0)}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function MessagingTabs(){let{currentTab}=(0,index_esm.useValues)(messagingTabsLogic),{setTab}=(0,index_esm.useActions)(messagingTabsLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),isAutomationEnabled=featureFlags[constants.y8.MESSAGING_AUTOMATION],isLibraryEnabled=featureFlags[constants.y8.MESSAGING_LIBRARY],tabs=[{key:"broadcasts",label:"Broadcasts"}];return isAutomationEnabled&&tabs.push({key:"campaigns",label:"Campaigns"}),isLibraryEnabled&&tabs.push({key:"library",label:"Templates"}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,onChange:tab=>setTab(tab),tabs:tabs})}}}]);