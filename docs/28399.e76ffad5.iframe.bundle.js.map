{"version":3,"file":"28399.e76ffad5.iframe.bundle.js","mappings":";AAwCA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AASA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AASA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://@posthog/storybook/../../products/endpoints/frontend/EndpointCodeExamples.tsx"],"sourcesContent":["import { useActions, useValues } from 'kea'\n\nimport { LemonSelect } from '@posthog/lemon-ui'\n\nimport { CodeSnippet, Language } from 'lib/components/CodeSnippet'\n\nimport { SceneSection } from '~/layout/scenes/components/SceneSection'\nimport { isInsightQueryNode } from '~/queries/utils'\n\nimport { CodeExampleTab, endpointLogic } from './endpointLogic'\n\ninterface EndpointCodeExamplesProps {\n    tabId: string\n}\n\nfunction generateVariablesJson(variables: Record<string, any>): string {\n    const entries = Object.entries(variables)\n    if (entries.length === 0) {\n        return '      // No variables defined'\n    }\n\n    return entries\n        .map(([_, value], index) => {\n            const isLast = index === entries.length - 1\n            const comma = isLast ? '' : ','\n            return `      \"${value.code_name}\": ${JSON.stringify(value.value)}${comma}`\n        })\n        .join('\\n')\n}\n\nfunction getEndpointUrl(endpointPath: string): string {\n    return `${window.location.origin}${endpointPath}`\n}\n\nfunction generateTerminalExample(\n    endpointPath: string,\n    variables: Record<string, any>,\n    selectedVersion: number | null,\n    currentVersion: number\n): string {\n    const versionParam =\n        selectedVersion !== null && selectedVersion !== currentVersion ? `,\\n    \"version\": ${selectedVersion}` : ''\n    return `curl -X POST ${getEndpointUrl(endpointPath)} \\\\\n  -H \"Authorization: Bearer $POSTHOG_PERSONAL_API_KEY\" \\\\\n  -H \"Content-Type: application/json\" \\\\\n  -d '{\n    \"variables_values\": {\n${generateVariablesJson(variables)}\n    }${versionParam}\n  }'`\n}\n\nfunction generatePythonExample(\n    endpointPath: string,\n    variables: Record<string, any>,\n    selectedVersion: number | null,\n    currentVersion: number\n): string {\n    const versionParam =\n        selectedVersion !== null && selectedVersion !== currentVersion ? `,\\n    \"version\": ${selectedVersion}` : ''\n    return `import requests\nimport json\n\nurl = \"${getEndpointUrl(endpointPath)}\"\n\nheaders = {\n    'Content-Type': 'application/json',\n    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'\n}\n\npayload = {\n    \"variables_values\": {\n${generateVariablesJson(variables)}\n    }${versionParam}\n}\n\nresponse = requests.post(url, headers=headers, data=json.dumps(payload))\nprint(response.json())`\n}\n\nfunction generateNodeExample(\n    endpointPath: string,\n    variables: Record<string, any>,\n    selectedVersion: number | null,\n    currentVersion: number\n): string {\n    const versionParam =\n        selectedVersion !== null && selectedVersion !== currentVersion ? `,\\n    \"version\": ${selectedVersion}` : ''\n    return `const fetch = require('node-fetch');\n\nconst url = '${getEndpointUrl(endpointPath)}';\n\nconst headers = {\n    'Content-Type': 'application/json',\n    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'\n};\n\nconst payload = {\n    \"variables_values\": {\n${generateVariablesJson(variables)}\n    }${versionParam}\n};\n\nfetch(url, {\n    method: 'POST',\n    headers: headers,\n    body: JSON.stringify(payload)\n})\n.then(response => response.json())\n.then(data => console.log(data))\n.catch(error => console.error('Error:', error));`\n}\n\nexport function EndpointCodeExamples({ tabId }: EndpointCodeExamplesProps): JSX.Element {\n    const { setActiveCodeExampleTab, setSelectedCodeExampleVersion } = useActions(endpointLogic({ tabId }))\n    const { activeCodeExampleTab, endpoint, selectedCodeExampleVersion } = useValues(endpointLogic({ tabId }))\n\n    if (!endpoint || isInsightQueryNode(endpoint.query)) {\n        return <></>\n    }\n\n    const variables = endpoint.query.variables || {}\n\n    const getCodeExample = (tab: CodeExampleTab): string => {\n        switch (tab) {\n            case 'terminal':\n                return generateTerminalExample(\n                    endpoint.endpoint_path,\n                    variables,\n                    selectedCodeExampleVersion,\n                    endpoint.current_version\n                )\n            case 'python':\n                return generatePythonExample(\n                    endpoint.endpoint_path,\n                    variables,\n                    selectedCodeExampleVersion,\n                    endpoint.current_version\n                )\n            case 'nodejs':\n                return generateNodeExample(\n                    endpoint.endpoint_path,\n                    variables,\n                    selectedCodeExampleVersion,\n                    endpoint.current_version\n                )\n            default:\n                return generateTerminalExample(\n                    endpoint.endpoint_path,\n                    variables,\n                    selectedCodeExampleVersion,\n                    endpoint.current_version\n                )\n        }\n    }\n\n    const getLanguage = (tab: CodeExampleTab): Language => {\n        switch (tab) {\n            case 'terminal':\n                return Language.Bash\n            case 'python':\n                return Language.Python\n            case 'nodejs':\n                return Language.JavaScript\n            default:\n                return Language.Bash\n        }\n    }\n\n    // Generate version options\n    const versionOptions = Array.from({ length: endpoint.current_version }, (_, i) => {\n        const version = i + 1\n        return {\n            value: version,\n            label: version === endpoint.current_version ? `v${version} (Current)` : `v${version}`,\n        }\n    })\n\n    return (\n        <SceneSection title=\"How to call this endpoint\">\n            <div className=\"flex flex-col gap-4\">\n                <div className=\"flex gap-2\">\n                    <LemonSelect\n                        options={versionOptions}\n                        onChange={setSelectedCodeExampleVersion}\n                        value={selectedCodeExampleVersion || endpoint.current_version}\n                        placeholder=\"Select version\"\n                    />\n                    <LemonSelect\n                        options={[\n                            { value: 'terminal', label: 'Terminal' },\n                            { value: 'python', label: 'Python' },\n                            { value: 'nodejs', label: 'Node.js' },\n                        ]}\n                        onChange={(val) => {\n                            if (val) {\n                                setActiveCodeExampleTab(val as CodeExampleTab)\n                            }\n                        }}\n                        value={activeCodeExampleTab}\n                    />\n                </div>\n                <div>\n                    <CodeSnippet language={getLanguage(activeCodeExampleTab)} wrap={true}>\n                        {getCodeExample(activeCodeExampleTab)}\n                    </CodeSnippet>\n                </div>\n            </div>\n        </SceneSection>\n    )\n}\n"],"names":[],"sourceRoot":""}