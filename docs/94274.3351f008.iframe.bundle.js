"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[94274],{"../../frontend/src/lib/components/CyclotronJob/CyclotronJobInputs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>CyclotronJobInputs});var core_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@dnd-kit/core/dist/core.esm.js"),sortable_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+sortable@7.0.2_@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0__react@18.2.0/node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),utilities_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+utilities@3.2.1_react@18.2.0/node_modules/@dnd-kit/utilities/dist/utilities.esm.js"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.28.1_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonMarkdown=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMarkdown/LemonMarkdown.tsx"),CodeEditorInline=__webpack_require__("../../frontend/src/lib/monaco/CodeEditorInline.tsx"),CodeEditorResizable=__webpack_require__("../../frontend/src/lib/monaco/CodeEditorResizable.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),copyToClipboard=__webpack_require__("../../frontend/src/lib/utils/copyToClipboard.tsx"),EmailTemplater=__webpack_require__("../../frontend/src/scenes/hog-functions/email-templater/EmailTemplater.tsx"),fuse_esm=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),dist_module=__webpack_require__("../hogvm/typescript/dist/module.js");let HOG_USAGE_EXAMPLES=[{key:"ternary",example:"$1 = true ? 'Yes' : 'No'",description:"Ternary operation (if this then that else other)"},{key:"default",example:"$1 ?? 'Default value'",description:"Default value (if this is null or undefined, use this)"}],HOG_STL_EXAMPLES=Object.entries(dist_module.iG).map(_ref=>{let[key,value]=_ref;return{key,example:value.example,description:value.description}}),cyclotronJobTemplateSuggestionsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref2=>{let{templating}=_ref2;return templating}),(0,index_esm.path)(key=>["components","cyclotron-jobs","cyclotronJobTemplateSuggestionsLogic",key]),(0,index_esm.actions)({setSearch:search=>({search})}),(0,index_esm.reducers)({search:["",{setSearch:(_,_ref3)=>{let{search}=_ref3;return search}}]}),(0,index_esm.selectors)({allOptions:[(_,p)=>[p.templating],templating=>"hog"===templating?[...HOG_USAGE_EXAMPLES,...HOG_STL_EXAMPLES]:[]],optionsFuse:[s=>[s.allOptions],allOptions=>new fuse_esm.Z(allOptions,{keys:["description","example"],threshold:.3})],optionsFiltered:[s=>[s.allOptions,s.optionsFuse,s.search],(allOptions,optionsFuse,search)=>search?optionsFuse.search(search).map(result=>result.item):allOptions]})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function CyclotronJobTemplateSuggestionsItem(_ref){let{option,onSelect}=_ref;return(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,role:"menuitem",size:"small",onClick:()=>onSelect(option),children:(0,jsx_runtime.jsxs)("div",{className:"flex-col flex-1",children:[(0,jsx_runtime.jsx)("code",{className:"text-sm font-semibold font-monospace",children:option.example}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-secondary",children:option.description})]})})}function CyclotronJobTemplateSuggestions(_ref2){let{templating,setTemplating,onOptionSelect}=_ref2,logic=cyclotronJobTemplateSuggestionsLogic({templating}),{search,optionsFiltered}=(0,index_esm.useValues)(logic),{setSearch}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex overflow-hidden flex-col flex-1 gap-1 max-w-100",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1 p-2 flex-0",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-1",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search templating options",autoFocus:!0,value:search,onChange:setSearch,fullWidth:!0}),setTemplating?(0,jsx_runtime.jsx)(src.Yv,{value:templating,onChange:setTemplating,options:[{label:"Hog",value:"hog"},{label:"Liquid",value:"liquid"}],tooltip:"Change the templating language"}):null]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-secondary",children:["Below are a list of available functions for templating your inputs using ",(0,jsx_runtime.jsx)("b",{children:templating}),"."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/cdp/destinations/customizing-destinations#customizing-payload",children:"Learn more"})]})]}),(0,jsx_runtime.jsxs)("ul",{className:"flex overflow-y-auto flex-col flex-1 gap-px p-2 border-t max-w-100",children:[optionsFiltered.map(value=>(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestionsItem,{option:value,onSelect:onOptionSelect})},value.key)),"liquid"===templating?(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",sideIcon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{}),to:"https://liquidjs.com/filters/overview.html",targetBlank:!0,children:"Liquid documentation"})}):null]})]})}function CyclotronJobTemplateSuggestionsButton(_ref3){let{onOptionSelect,...props}=_ref3,[showPopover,setShowPopover]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(src.Qw,{closeOnClickInside:!1,visible:showPopover,matchWidth:!1,actionable:!0,onVisibilityChange:visible=>setShowPopover(visible),overlay:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestions,{...props,onOptionSelect:option=>{onOptionSelect(option),setShowPopover(!1)}}),overflowHidden:!0,children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode,{}),tooltip:"Supports templating - click to see available options"})})}function formatJsonValue(value){return null==value?"{}":"string"!=typeof value?JSON.stringify(value,null,2):value}let cyclotronJobInputLogic=(0,index_esm.kea)({path:["lib","components","CyclotronJob","cyclotronJobInputLogic"],props:{},key:props=>`json_validation_${props.fieldKey}`,actions:{setJsonValue:value=>({value}),validateJson:value=>({value}),setError:error=>({error})},reducers:{jsonValue:["",{setJsonValue:(_state,_ref)=>{let{value}=_ref;return value}}],error:[null,{setError:(_state,_ref2)=>{let{error}=_ref2;return error}}]},selectors:{hasError:[s=>[s.error],error=>!!error]},listeners:_ref3=>{let{actions,props}=_ref3;return{setJsonValue:async(_ref4,breakpoint)=>{let{value}=_ref4;if(!value||""===value.trim()){actions.setError(null);return}props.onChange?.(value),await breakpoint(600);try{JSON.parse(value),actions.setError(null)}catch(e){let errorMessage=e.message||"Invalid JSON";errorMessage.includes("'u'")&&value.includes("undefined")&&(errorMessage="Error: 'undefined' is not allowed in JSON. Use null instead."),actions.setError(errorMessage)}}}},propsChanged(_ref5){let{actions,props}=_ref5;void 0!==props.initialValue&&actions.setJsonValue(formatJsonValue(props.initialValue))}});var IntegrationChoice=__webpack_require__("../../frontend/src/lib/components/CyclotronJob/integrations/IntegrationChoice.tsx");function CyclotronJobInputIntegration(_ref){let{schema,persistForUnload,...props}=_ref;return(0,jsx_runtime.jsx)(IntegrationChoice.a,{...props,schema:schema,integration:schema.integration,redirectUrl:`${window.location.pathname}?integration_target=${schema.key}`,beforeRedirect:()=>persistForUnload?.()})}var lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let clickupIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","clickupIntegrationLogic",key]),(0,index_esm.actions)({loadClickUpLists:spaceId=>({spaceId}),loadClickUpSpaces:workspaceId=>({workspaceId}),loadClickUpWorkspaces:!0}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{clickUpSpaces:[null,{loadClickUpSpaces:async _ref2=>{let{workspaceId}=_ref2;return(await api.ZP.integrations.clickUpSpaces(props.id,workspaceId)).spaces}}],clickUpLists:[null,{loadClickUpLists:async _ref3=>{let{spaceId}=_ref3;return(await api.ZP.integrations.clickUpLists(props.id,spaceId)).lists}}],clickUpWorkspaces:[null,{loadClickUpWorkspaces:async()=>(await api.ZP.integrations.clickUpWorkspaces(props.id)).workspaces}]}})]),getClickUpSpaceOptions=clickUpSpaces=>clickUpSpaces?clickUpSpaces.map(space=>({key:space.id,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[space.name," (",space.id,")"]}),label:`${space.name} (${space.id})`})):null,getClickUpWorkspaceOptions=clickUpWorkspaces=>clickUpWorkspaces?clickUpWorkspaces.map(workspace=>({key:workspace.id,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[workspace.name," (",workspace.id,")"]}),label:`${workspace.name} (${workspace.id})`})):null,getClickUpListOptions=clickUpLists=>clickUpLists?clickUpLists.map(_ref=>{let{id,name}=_ref;return{key:id,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[name," (",id,")"]}),label:`${name} (${id})`}}):null;function ClickUpSpacePicker(_ref2){let{onChange,value,requiresFieldValue,integration,disabled}=_ref2,{clickUpSpaces,clickUpSpacesLoading}=(0,index_esm.useValues)(clickupIntegrationLogic({id:integration.id})),{loadClickUpSpaces}=(0,index_esm.useActions)(clickupIntegrationLogic({id:integration.id})),clickUpSpaceOptions=(0,react.useMemo)(()=>getClickUpSpaceOptions(clickUpSpaces),[clickUpSpaces]);return(0,react.useEffect)(()=>{!disabled&&requiresFieldValue&&loadClickUpSpaces(requiresFieldValue.split("/")[0])},[loadClickUpSpaces,requiresFieldValue,disabled]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!clickUpSpaces&&!clickUpSpacesLoading&&requiresFieldValue&&loadClickUpSpaces(requiresFieldValue.split("/")[0]),disabled:disabled,mode:"single","data-attr":"select-click-up-space",placeholder:"Select a Space...",options:null!=clickUpSpaceOptions?clickUpSpaceOptions:value?[{key:value,label:value}]:[],loading:clickUpSpacesLoading})})}function ClickUpWorkspacePicker(_ref3){let{onChange,value,integration,disabled}=_ref3,{clickUpWorkspaces,clickUpWorkspacesLoading}=(0,index_esm.useValues)(clickupIntegrationLogic({id:integration.id})),{loadClickUpWorkspaces}=(0,index_esm.useActions)(clickupIntegrationLogic({id:integration.id})),clickUpWorkspaceOptions=(0,react.useMemo)(()=>getClickUpWorkspaceOptions(clickUpWorkspaces),[clickUpWorkspaces]);return(0,react.useEffect)(()=>{loadClickUpWorkspaces()},[loadClickUpWorkspaces]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$2;return onChange?.(null!==(_val$2=val[0])&&void 0!==_val$2?_val$2:null)},value:value?[value]:[],onFocus:()=>!clickUpWorkspaces&&!clickUpWorkspacesLoading&&loadClickUpWorkspaces(),disabled:disabled,mode:"single","data-attr":"select-click-up-workspace",placeholder:"Select a Workspace...",options:null!=clickUpWorkspaceOptions?clickUpWorkspaceOptions:value?[{key:value,label:value}]:[],loading:clickUpWorkspacesLoading})})}function ClickUpListPicker(_ref4){let{onChange,value,requiresFieldValue,integration,disabled}=_ref4,{clickUpLists,clickUpListsLoading}=(0,index_esm.useValues)(clickupIntegrationLogic({id:integration.id})),{loadClickUpLists}=(0,index_esm.useActions)(clickupIntegrationLogic({id:integration.id})),clickUpListOptions=(0,react.useMemo)(()=>getClickUpListOptions(clickUpLists),[clickUpLists]);return(0,react.useEffect)(()=>{!disabled&&requiresFieldValue&&loadClickUpLists(requiresFieldValue.split("/")[0])},[loadClickUpLists,disabled,requiresFieldValue]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$3;return onChange?.(null!==(_val$3=val[0])&&void 0!==_val$3?_val$3:null)},value:value?[value]:[],onFocus:()=>!clickUpLists&&!clickUpListsLoading&&requiresFieldValue&&loadClickUpLists(requiresFieldValue.split("/")[0]),disabled:disabled,mode:"single","data-attr":"select-click-up-list",placeholder:"Select a List...",options:null!=clickUpListOptions?clickUpListOptions:value?[{key:value,label:value}]:[],loading:clickUpListsLoading})})}let googleAdsIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","googleAdsIntegrationLogic",key]),(0,index_esm.actions)({loadGoogleAdsConversionActions:(customerId,parentId)=>({customerId,parentId}),loadGoogleAdsAccessibleAccounts:!0}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{googleAdsConversionActions:[null,{loadGoogleAdsConversionActions:async _ref2=>{let{customerId,parentId}=_ref2;return(await api.ZP.integrations.googleAdsConversionActions(props.id,{customerId,parentId})).conversionActions}}],googleAdsAccessibleAccounts:[null,{loadGoogleAdsAccessibleAccounts:async()=>(await api.ZP.integrations.googleAdsAccounts(props.id)).accessibleAccounts}]}})]),getGoogleAdsAccountOptions=googleAdsAccounts=>googleAdsAccounts?googleAdsAccounts.map(customer=>({key:`${customer.id}/${customer.parent_id}`,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[customer.name," (",customer.id.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3"),")"]}),label:`${customer.name} (${customer.id.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")})`})):null,getGoogleAdsConversionActionOptions=googleAdsConversionActions=>googleAdsConversionActions?googleAdsConversionActions.map(_ref=>{let{id,name}=_ref;return{key:id,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[name," (",id,")"]}),label:`${name} (${id})`}}):null;function GoogleAdsConversionActionPicker(_ref2){let{onChange,value,requiresFieldValue,integration,disabled}=_ref2,{googleAdsConversionActions,googleAdsConversionActionsLoading}=(0,index_esm.useValues)(googleAdsIntegrationLogic({id:integration.id})),{loadGoogleAdsConversionActions}=(0,index_esm.useActions)(googleAdsIntegrationLogic({id:integration.id})),googleAdsConversionActionOptions=(0,react.useMemo)(()=>getGoogleAdsConversionActionOptions(googleAdsConversionActions),[googleAdsConversionActions]);return(0,react.useEffect)(()=>{requiresFieldValue&&loadGoogleAdsConversionActions(requiresFieldValue.split("/")[0],requiresFieldValue.split("/")[1])},[loadGoogleAdsConversionActions,requiresFieldValue]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!googleAdsConversionActions&&!googleAdsConversionActionsLoading&&requiresFieldValue&&loadGoogleAdsConversionActions(requiresFieldValue.split("/")[0],requiresFieldValue.split("/")[1]),disabled:disabled,mode:"single","data-attr":"select-google-ads-conversion-action",placeholder:"Select a Conversion Action...",options:null!=googleAdsConversionActionOptions?googleAdsConversionActionOptions:value?[{key:value,label:value}]:[],loading:googleAdsConversionActionsLoading})})}function GoogleAdsCustomerIdPicker(_ref3){let{onChange,value,integration,disabled}=_ref3,{googleAdsAccessibleAccounts,googleAdsAccessibleAccountsLoading}=(0,index_esm.useValues)(googleAdsIntegrationLogic({id:integration.id})),{loadGoogleAdsAccessibleAccounts}=(0,index_esm.useActions)(googleAdsIntegrationLogic({id:integration.id})),googleAdsAccountOptions=(0,react.useMemo)(()=>getGoogleAdsAccountOptions(googleAdsAccessibleAccounts),[googleAdsAccessibleAccounts]);return(0,react.useEffect)(()=>{disabled||loadGoogleAdsAccessibleAccounts()},[loadGoogleAdsAccessibleAccounts,disabled]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$2;return onChange?.(null!==(_val$2=val[0])&&void 0!==_val$2?_val$2:null)},value:value?[value]:[],onFocus:()=>!googleAdsAccessibleAccounts&&!googleAdsAccessibleAccountsLoading&&loadGoogleAdsAccessibleAccounts(),disabled:disabled,mode:"single","data-attr":"select-google-ads-customer-id-channel",placeholder:"Select a Customer ID...",options:null!=googleAdsAccountOptions?googleAdsAccountOptions:value?[{key:value,label:value.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}]:[],loading:googleAdsAccessibleAccountsLoading})})}var LinearIntegrationHelpers=__webpack_require__("../../frontend/src/lib/integrations/LinearIntegrationHelpers.tsx"),useOnMountEffect=__webpack_require__("../../frontend/src/lib/hooks/useOnMountEffect.ts");let linkedInAdsIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","linkedInAdsIntegrationLogic",key]),(0,index_esm.actions)({loadLinkedInAdsConversionRules:accountId=>accountId,loadLinkedInAdsAccounts:!0}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{linkedInAdsConversionRules:[null,{loadLinkedInAdsConversionRules:async customerId=>(await api.ZP.integrations.linkedInAdsConversionRules(props.id,customerId)).conversionRules}],linkedInAdsAccounts:[null,{loadLinkedInAdsAccounts:async()=>(await api.ZP.integrations.linkedInAdsAccounts(props.id)).adAccounts}]}})]),getLinkedInAdsAccountOptions=linkedInAdsAccounts=>linkedInAdsAccounts?linkedInAdsAccounts.map(account=>({key:account.id.toString(),labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[account.name," (",account.id.toString(),")"]}),label:`${account.name}`})):null,getLinkedInAdsConversionRuleOptions=linkedInAdsConversionRules=>linkedInAdsConversionRules?linkedInAdsConversionRules.map(_ref=>{let{id,name}=_ref;return{key:id.toString(),labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[name," (",id,")"]}),label:`${name} (${id})`}}):null;function LinkedInAdsConversionRulePicker(_ref2){let{onChange,value,requiresFieldValue,integration,disabled}=_ref2,{linkedInAdsConversionRules,linkedInAdsConversionRulesLoading}=(0,index_esm.useValues)(linkedInAdsIntegrationLogic({id:integration.id})),{loadLinkedInAdsConversionRules}=(0,index_esm.useActions)(linkedInAdsIntegrationLogic({id:integration.id})),linkedInAdsConversionRuleOptions=(0,react.useMemo)(()=>getLinkedInAdsConversionRuleOptions(linkedInAdsConversionRules),[linkedInAdsConversionRules]);return(0,react.useEffect)(()=>{requiresFieldValue&&loadLinkedInAdsConversionRules(requiresFieldValue)},[loadLinkedInAdsConversionRules,requiresFieldValue]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!linkedInAdsConversionRules&&!linkedInAdsConversionRulesLoading&&requiresFieldValue&&loadLinkedInAdsConversionRules(requiresFieldValue),disabled:disabled,mode:"single","data-attr":"select-linkedin-ads-conversion-action",placeholder:"Select a Conversion Action...",options:null!=linkedInAdsConversionRuleOptions?linkedInAdsConversionRuleOptions:value?[{key:value,label:value}]:[],loading:linkedInAdsConversionRulesLoading})})}function LinkedInAdsAccountIdPicker(_ref3){let{onChange,value,integration,disabled}=_ref3,{linkedInAdsAccounts,linkedInAdsAccountsLoading}=(0,index_esm.useValues)(linkedInAdsIntegrationLogic({id:integration.id})),{loadLinkedInAdsAccounts}=(0,index_esm.useActions)(linkedInAdsIntegrationLogic({id:integration.id})),linkedInAdsAccountOptions=(0,react.useMemo)(()=>getLinkedInAdsAccountOptions(linkedInAdsAccounts),[linkedInAdsAccounts]);return(0,useOnMountEffect.x)(()=>{disabled||loadLinkedInAdsAccounts()}),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$2;return onChange?.(null!==(_val$2=val[0])&&void 0!==_val$2?_val$2:null)},value:value?[value]:[],onFocus:()=>!linkedInAdsAccounts&&!linkedInAdsAccountsLoading&&loadLinkedInAdsAccounts(),disabled:disabled,mode:"single","data-attr":"select-linkedin-ads-customer-id-channel",placeholder:"Select a Account ID...",options:null!=linkedInAdsAccountOptions?linkedInAdsAccountOptions:value?[{key:value,label:value.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}]:[],loading:linkedInAdsAccountsLoading})})}var SlackIntegrationHelpers=__webpack_require__("../../frontend/src/lib/integrations/SlackIntegrationHelpers.tsx"),usePeriodicRerender=__webpack_require__("../../frontend/src/lib/hooks/usePeriodicRerender.ts"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx");let twilioIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","twilioIntegrationLogic",key]),(0,index_esm.connect)(()=>({values:[preflightLogic.preflightLogic,["siteUrlMisconfigured","preflight"]]})),(0,index_esm.actions)({loadAllTwilioPhoneNumbers:function(){let forceRefresh=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{forceRefresh}}}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{allTwilioPhoneNumbers:[null,{loadAllTwilioPhoneNumbers:async _ref2=>{let{forceRefresh}=_ref2;return await api.ZP.integrations.twilioPhoneNumbers(props.id,forceRefresh)}}]}}),(0,index_esm.selectors)({twilioPhoneNumbers:[s=>[s.allTwilioPhoneNumbers],allTwilioPhoneNumbers=>{var _allTwilioPhoneNumber;return null!==(_allTwilioPhoneNumber=allTwilioPhoneNumbers?.phone_numbers)&&void 0!==_allTwilioPhoneNumber?_allTwilioPhoneNumber:[]}],getPhoneNumberRefreshButtonDisabledReason:[s=>[s.allTwilioPhoneNumbers],allTwilioPhoneNumbers=>()=>{let now=(0,dayjs.Bv)();if(allTwilioPhoneNumbers){let earliestRefresh=(0,dayjs.Bv)(allTwilioPhoneNumbers.lastRefreshedAt).add(5,"minutes");if(now.isBefore(earliestRefresh))return`You can refresh the phone numbers again ${earliestRefresh.from(now)}`}return""}]})]),getTwilioPhoneNumberOptions=twilioPhoneNumbers=>twilioPhoneNumbers?twilioPhoneNumbers.map(x=>{let displayLabel=`${x.friendly_name} (${x.sid})`;return{key:x.phone_number,labelComponent:(0,jsx_runtime.jsx)("span",{className:"flex items-center",children:(0,jsx_runtime.jsx)("span",{children:displayLabel})}),label:displayLabel}}):null;function TwilioPhoneNumberPicker(_ref){let{onChange,value,integration,disabled}=_ref,{twilioPhoneNumbers,allTwilioPhoneNumbersLoading,getPhoneNumberRefreshButtonDisabledReason}=(0,index_esm.useValues)(twilioIntegrationLogic({id:integration.id})),{loadAllTwilioPhoneNumbers}=(0,index_esm.useActions)(twilioIntegrationLogic({id:integration.id}));(0,usePeriodicRerender.o)(15e3);let twilioPhoneNumberOptions=(0,react.useMemo)(()=>getTwilioPhoneNumberOptions(twilioPhoneNumbers),[twilioPhoneNumbers]),modifiedValue=(0,react.useMemo)(()=>{let phoneNumber=twilioPhoneNumbers.find(x=>x.phone_number===value);return phoneNumber?`${phoneNumber.friendly_name} (${phoneNumber.sid})`:value},[value,twilioPhoneNumbers]);return(0,react.useEffect)(()=>{disabled||loadAllTwilioPhoneNumbers()},[loadAllTwilioPhoneNumbers,disabled]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!twilioPhoneNumbers.length&&!allTwilioPhoneNumbersLoading&&loadAllTwilioPhoneNumbers(),disabled:disabled,mode:"single","data-attr":"select-twilio-phone-number",placeholder:"Select a phone number...",action:{children:(0,jsx_runtime.jsx)("span",{className:"Link",children:"Refresh phone numbers"}),onClick:()=>loadAllTwilioPhoneNumbers(!0),disabledReason:getPhoneNumberRefreshButtonDisabledReason()},emptyStateComponent:(0,jsx_runtime.jsxs)("p",{className:"text-secondary italic p-1",children:["No phone numbers found. Make sure your Twilio account has phone numbers configured."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/cdp/destinations/twilio",target:"_blank",children:"See the docs for more information."})]}),options:null!=twilioPhoneNumberOptions?twilioPhoneNumberOptions:modifiedValue?[{key:null!=value?value:modifiedValue,label:modifiedValue}]:[],loading:allTwilioPhoneNumbersLoading})})}var integrationsLogic=__webpack_require__("../../frontend/src/lib/integrations/integrationsLogic.ts");function CyclotronJobInputIntegrationField(_ref){var _configuration$inputs,_parentConfiguration$;let requiresFieldValue;let{schema,value,onChange,configuration,parentConfiguration}=_ref,combinedInputs={...configuration?.inputs,...parentConfiguration?.inputs},combinedInputsSchema=[...null!==(_configuration$inputs=configuration?.inputs_schema)&&void 0!==_configuration$inputs?_configuration$inputs:[],...null!==(_parentConfiguration$=parentConfiguration?.inputs_schema)&&void 0!==_parentConfiguration$?_parentConfiguration$:[]],{integrationsLoading,integrations}=(0,index_esm.useValues)(integrationsLogic.a);if(integrationsLoading)return(0,jsx_runtime.jsx)(src.yW,{className:"h-10"});let relatedSchemaIntegration=combinedInputsSchema.find(input=>input.key===schema.integration_key);if(!relatedSchemaIntegration)return(0,jsx_runtime.jsxs)("div",{className:"text-danger",children:["Bad configuration: integration key ",schema.integration_key," not found in schema"]});let integrationId=combinedInputs[relatedSchemaIntegration.key]?.value,integration=integrations?.find(integration=>integration.id===integrationId);if(schema.requires_field){let requiresFieldSchema=combinedInputsSchema.find(input=>input.key===schema.requires_field);if(!requiresFieldSchema)return(0,jsx_runtime.jsxs)("div",{className:"text-danger",children:["Bad configuration: required key ",schema.requires_field," not found in schema"]});let requiresField=combinedInputs?.[requiresFieldSchema.key];if(!(requiresFieldValue=requiresField?.value))return(0,jsx_runtime.jsxs)("div",{className:"p-2 h-10 italic rounded border border-dashed text-secondary",children:["Configure ",requiresFieldSchema.label," to continue"]})}return integration?"slack_channel"===schema.integration_field?(0,jsx_runtime.jsx)(SlackIntegrationHelpers.a,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"google_ads_conversion_action"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(GoogleAdsConversionActionPicker,{value:value,requiresFieldValue:requiresFieldValue,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"google_ads_customer_id"===schema.integration_field?(0,jsx_runtime.jsx)(GoogleAdsCustomerIdPicker,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"linkedin_ads_conversion_rule_id"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(LinkedInAdsConversionRulePicker,{value:value,requiresFieldValue:requiresFieldValue,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"linkedin_ads_account_id"===schema.integration_field?(0,jsx_runtime.jsx)(LinkedInAdsAccountIdPicker,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"linear_team"===schema.integration_field?(0,jsx_runtime.jsx)(LinearIntegrationHelpers.Ul,{value:value,onChange:x=>onChange?.(x),integration:integration}):"twilio_phone_number"===schema.integration_field?(0,jsx_runtime.jsx)(TwilioPhoneNumberPicker,{value:value,onChange:x=>onChange?.(x),integration:integration}):"clickup_space_id"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(ClickUpSpacePicker,{value:value,onChange:x=>onChange?.(x),integration:integration,requiresFieldValue:requiresFieldValue}):"clickup_list_id"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(ClickUpListPicker,{value:value,onChange:x=>onChange?.(x),integration:integration,requiresFieldValue:requiresFieldValue}):"clickup_workspace_id"===schema.integration_field?(0,jsx_runtime.jsx)(ClickUpWorkspacePicker,{value:value,onChange:x=>onChange?.(x),integration:integration}):(0,jsx_runtime.jsx)("div",{className:"text-danger",children:(0,jsx_runtime.jsxs)("p",{children:["Unsupported integration type: ",schema.integration]})}):(0,jsx_runtime.jsxs)("div",{className:"p-2 h-10 italic rounded border border-dashed text-secondary",children:["Configure ",relatedSchemaIntegration.label," to continue"]})}let EXTEND_OBJECT_KEY="$$_extend_object",INPUT_TYPE_LIST=["string","number","boolean","dictionary","choice","json","integration","email","native_email"];function CyclotronJobInputs(_ref){let{configuration,parentConfiguration,onInputSchemaChange,onInputChange,showSource,sampleGlobalsWithInputs}=_ref;if(!configuration.inputs_schema?.length)return(0,jsx_runtime.jsx)("span",{className:"italic text-secondary",children:"This function does not require any input variables."});let inputSchemas=configuration.inputs_schema,inputSchemaIds=inputSchemas.map(schema=>schema.key);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(core_esm.LB,{collisionDetection:core_esm.pE,onDragEnd:_ref2=>{let{active,over}=_ref2;if(over&&active.id!==over.id){let oldIndex=inputSchemaIds.indexOf(active.id),newIndex=inputSchemaIds.indexOf(over.id);onInputSchemaChange?.(sortable_esm.Rp(inputSchemas,oldIndex,newIndex))}},children:(0,jsx_runtime.jsx)(sortable_esm.Fo,{disabled:!showSource,items:inputSchemaIds,strategy:sortable_esm.qw,children:configuration.inputs_schema?.filter(i=>!i.hidden).map(schema=>jsx_runtime.jsx(CyclotronJobInputWithSchema,{schema:schema,configuration:configuration,parentConfiguration:parentConfiguration,onInputSchemaChange:onInputSchemaChange,onInputChange:onInputChange,showSource:showSource,sampleGlobalsWithInputs:sampleGlobalsWithInputs},schema.key))})})})}function JsonConfigField(props){var _props$input$templati,_props$sampleGlobalsW;let key=(0,react.useMemo)(()=>`json_field_${(0,utils.Vj)()}`,[]),templatingKind=null!==(_props$input$templati=props.input.templating)&&void 0!==_props$input$templati?_props$input$templati:"hog",logic=cyclotronJobInputLogic({fieldKey:key,initialValue:props.input.value,onChange:value=>props.onChange?.({...props.input,value})}),{error,jsonValue}=(0,index_esm.useValues)(logic),{setJsonValue}=(0,index_esm.useActions)(logic),formattedValue=(0,react.useMemo)(()=>formatJsonValue(props.input.value),[props.input.value]),panels=[{key:1,header:"Click to edit",content:(0,jsx_runtime.jsx)(LemonField.D.Pure,{error:error,children:(0,jsx_runtime.jsxs)("span",{className:(0,clsx_m.default)("group relative",props.className),children:[(0,jsx_runtime.jsx)(CodeEditorResizable.Y,{language:props.templating?"hog"===templatingKind?"hogJson":"liquid":"json",value:formattedValue,embedded:!0,onChange:value=>setJsonValue(value||"{}"),options:{lineNumbers:"off",minimap:{enabled:!1},scrollbar:{vertical:"hidden",verticalScrollbarSize:0}},globals:props.templating&&null!==(_props$sampleGlobalsW=props.sampleGlobalsWithInputs)&&void 0!==_props$sampleGlobalsW?_props$sampleGlobalsW:void 0}),props.templating?(0,jsx_runtime.jsx)("span",{className:"absolute top-0 right-0 z-10 p-px opacity-0 transition-opacity group-hover:opacity-100",children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestionsButton,{templating:templatingKind,value:jsonValue,setTemplating:templating=>props.onChange?.({...props.input,templating}),onOptionSelect:option=>{(0,copyToClipboard.v)(`{${option.example}}`,"template code")}})}):null]})}),className:"p-0"}];return(0,jsx_runtime.jsx)(src.JL,{embedded:!1,panels:panels,size:"xsmall"})}function EmailTemplateField(_ref3){let{schema,value,onChange,sampleGlobalsWithInputs}=_ref3;return(0,jsx_runtime.jsx)(EmailTemplater.N,{type:schema.type,variables:null!=sampleGlobalsWithInputs?sampleGlobalsWithInputs:{},value:value,onChange:onChange})}function CyclotronJobTemplateInput(props){var _props$input$templati2,_props$input$value,_props$sampleGlobalsW2;let templating=null!==(_props$input$templati2=props.input.templating)&&void 0!==_props$input$templati2?_props$input$templati2:"hog";return props.templating?(0,jsx_runtime.jsxs)("span",{className:(0,clsx_m.default)("group relative",props.className),children:[(0,jsx_runtime.jsx)(CodeEditorInline.s,{minHeight:"37",value:null!==(_props$input$value=props.input.value)&&void 0!==_props$input$value?_props$input$value:"",onChange:val=>props.onChange?.({...props.input,value:null!=val?val:""}),language:"hog"===props.input.templating?"hogTemplate":"liquid",globals:null!==(_props$sampleGlobalsW2=props.sampleGlobalsWithInputs)&&void 0!==_props$sampleGlobalsW2?_props$sampleGlobalsW2:void 0}),(0,jsx_runtime.jsx)("span",{className:"absolute top-0 right-0 z-10 p-px opacity-0 transition-opacity group-hover:opacity-100",children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestionsButton,{templating:templating,value:props.input.value,setTemplating:templating=>props.onChange?.({...props.input,templating}),onOptionSelect:option=>{props.onChange?.({...props.input,value:`${props.input.value} {${option.example}}`})}})})]}):(0,jsx_runtime.jsx)(src.DF,{type:"text",value:props.input.value,onChange:val=>props.onChange?.({...props.input,value:val})})}function DictionaryField(_ref4){var _input$value;let{input,onChange,templating,sampleGlobalsWithInputs}=_ref4,value=null!==(_input$value=input.value)&&void 0!==_input$value?_input$value:{},[entries,setEntries]=(0,react.useState)(Object.entries(value)),prevFilteredEntriesRef=(0,react.useRef)(entries);return(0,react.useEffect)(()=>{let filteredEntries=entries.filter(_ref5=>{let[key,val]=_ref5;return""!==key.trim()||""!==val.trim()});if((0,utils.h0)(filteredEntries,prevFilteredEntriesRef.current))return;prevFilteredEntriesRef.current=filteredEntries;let val=Object.fromEntries(filteredEntries);onChange?.({...input,value:val})},[entries,onChange]),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[entries.some(_ref6=>{let[key]=_ref6;return key===EXTEND_OBJECT_KEY})?null:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),size:"small",type:"secondary",onClick:()=>{setEntries([[EXTEND_OBJECT_KEY,"{event.properties}"],...entries])},children:"Include properties from an entire object"}),entries.map((_ref7,index)=>{let[key,val]=_ref7;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.u,{title:EXTEND_OBJECT_KEY===key?"Include properties from an entire object":void 0,children:(0,jsx_runtime.jsx)(src.DF,{value:key===EXTEND_OBJECT_KEY?"INCLUDE ENTIRE OBJECT":key,disabled:key===EXTEND_OBJECT_KEY,className:"flex-1 min-w-60",onChange:key=>{let newEntries=[...entries];newEntries[index]=[key,newEntries[index][1]],setEntries(newEntries)},placeholder:"Key"})}),(0,jsx_runtime.jsx)(CyclotronJobTemplateInput,{className:"overflow-hidden flex-2",input:{...input,value:val},onChange:val=>{var _val$value;let newEntries=[...entries];newEntries[index]=[newEntries[index][0],null!==(_val$value=val.value)&&void 0!==_val$value?_val$value:""],val.templating&&onChange?.({...input,templating:val.templating}),setEntries(newEntries)},templating:templating,sampleGlobalsWithInputs:sampleGlobalsWithInputs}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),size:"small",onClick:()=>{let newEntries=[...entries];newEntries.splice(index,1),setEntries(newEntries)}})]},index)}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),size:"small",type:"secondary",onClick:()=>{setEntries([...entries,["",""]])},children:"Add entry"})]})}function CyclotronJobInputRenderer(_ref8){var _schema$templating,_schema$choices;let{onChange,onInputChange,schema,disabled,input,configuration,parentConfiguration,sampleGlobalsWithInputs}=_ref8,templating=null===(_schema$templating=schema.templating)||void 0===_schema$templating||_schema$templating,onValueChange=value=>onChange?.({...input,value});switch(schema.type){case"string":return(0,jsx_runtime.jsx)(CyclotronJobTemplateInput,{input:input,onChange:disabled?()=>{}:onChange,className:"ph-no-capture",templating:templating,sampleGlobalsWithInputs:sampleGlobalsWithInputs});case"number":return(0,jsx_runtime.jsx)(src.DF,{type:"number",value:input.value,onChange:onValueChange,className:"ph-no-capture"});case"json":return(0,jsx_runtime.jsx)(JsonConfigField,{input:input,onChange:onChange,className:"ph-no-capture",templating:templating,sampleGlobalsWithInputs:sampleGlobalsWithInputs});case"choice":return(0,jsx_runtime.jsx)(src.Yv,{fullWidth:!0,value:input.value,className:"ph-no-capture",onChange:onValueChange,options:null!==(_schema$choices=schema.choices)&&void 0!==_schema$choices?_schema$choices:[],disabled:disabled});case"dictionary":return(0,jsx_runtime.jsx)(DictionaryField,{input:input,onChange:onChange,templating:templating,sampleGlobalsWithInputs:sampleGlobalsWithInputs});case"boolean":return(0,jsx_runtime.jsx)(src.f4,{checked:input.value,onChange:checked=>onValueChange(checked),disabled:disabled});case"integration":return(0,jsx_runtime.jsx)(CyclotronJobInputIntegration,{schema:schema,value:input.value,onChange:newValue=>{onValueChange(newValue),configuration.inputs_schema&&onInputChange&&configuration.inputs_schema.filter(s=>"integration_field"===s.type).forEach(field=>{onInputChange(field.key,{value:null})})}});case"integration_field":return(0,jsx_runtime.jsx)(CyclotronJobInputIntegrationField,{schema:schema,value:input.value,onChange:onValueChange,parentConfiguration:parentConfiguration,configuration:configuration});case"email":case"native_email":return(0,jsx_runtime.jsx)(EmailTemplateField,{schema:schema,value:input.value,onChange:onValueChange,sampleGlobalsWithInputs:sampleGlobalsWithInputs});default:return(0,jsx_runtime.jsxs)("strong",{className:"text-danger",children:['Unknown field type "',(0,jsx_runtime.jsx)("code",{children:schema.type}),'".']})}}function CyclotronJobInputSchemaControls(_ref9){let{value,onChange,onDone,configuration,parentConfiguration,sampleGlobalsWithInputs}=_ref9,_onChange=data=>{if(data?.key?.length===0){setLocalVariableError("Input variable name cannot be empty");return}onChange(data?{...value,...data}:null)},[localVariableValue,setLocalVariableValue]=(0,react.useState)(value.key),[localVariableError,setLocalVariableError]=(0,react.useState)(null);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap flex-1 gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.Yv,{size:"small",options:INPUT_TYPE_LIST.map(type=>({label:(0,utils.fm)(type),value:type})),value:value.type,className:"w-30",onChange:type=>_onChange({type})}),(0,jsx_runtime.jsx)(src.Hw,{size:"small",checked:value.required,onChange:required=>_onChange({required}),label:"Required",bordered:!0}),(0,jsx_runtime.jsx)(src.Hw,{size:"small",checked:value.secret,onChange:secret=>_onChange({secret}),label:"Secret",bordered:!0}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(src.Jp,{status:"danger",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),size:"small",onClick:()=>onChange(null)}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>onDone(),children:"Done"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap flex-1 gap-2",children:[(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Display label",children:(0,jsx_runtime.jsx)(src.DF,{className:"min-w-60",size:"small",value:value.label,onChange:label=>_onChange({label}),placeholder:"Display label"})}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Input variable name",error:localVariableError,children:(0,jsx_runtime.jsx)(src.DF,{size:"small",value:localVariableValue,onChange:key=>setLocalVariableValue(key),onBlur:()=>_onChange({key:localVariableValue}),placeholder:"Variable name"})})]}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Description",children:(0,jsx_runtime.jsx)(src._V,{minRows:1,value:value.description,onChange:description=>_onChange({description}),placeholder:"Description"})}),"choice"===value.type&&(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Choices",children:(0,jsx_runtime.jsx)(src.nt,{mode:"multiple",allowCustomValues:!0,value:value.choices?.map(choice=>choice.value),onChange:choices=>_onChange({choices:choices.map(value=>({label:value,value}))}),placeholder:"Choices"})}),"integration"===value.type&&(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Integration kind",children:(0,jsx_runtime.jsx)(src.Yv,{value:value.integration,onChange:integration=>_onChange({integration}),options:[{label:"Slack",value:"slack"},{label:"Salesforce",value:"salesforce"},{label:"Hubspot",value:"hubspot"}],placeholder:"Choose kind"})}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Default value",children:(0,jsx_runtime.jsx)(CyclotronJobInputRenderer,{schema:value,input:{value:value.default},onChange:val=>_onChange({default:val.value}),configuration:configuration,parentConfiguration:parentConfiguration,sampleGlobalsWithInputs:sampleGlobalsWithInputs})})]})}function CyclotronJobInputWithSchema(_ref10){var _configuration$inputs;let{schema,configuration,parentConfiguration,onInputSchemaChange,onInputChange,showSource,sampleGlobalsWithInputs}=_ref10,{attributes,listeners,setNodeRef,transform,transition}=(0,sortable_esm.nB)({id:schema.key}),[editing,setEditing]=(0,react.useState)(!1),value=null!==(_configuration$inputs=configuration.inputs?.[schema.key])&&void 0!==_configuration$inputs?_configuration$inputs:{value:null};return(0,react.useEffect)(()=>{showSource||setEditing(!1)},[showSource]),(0,jsx_runtime.jsx)("div",{ref:setNodeRef,style:{transform:utilities_esm.ux.Transform.toString(transform),transition},children:editing?(0,jsx_runtime.jsx)("div",{className:"p-2 rounded border border-dashed deprecated-space-y-4",children:(0,jsx_runtime.jsx)(CyclotronJobInputSchemaControls,{value:schema,onChange:newSchema=>{let inputsSchema=configuration.inputs_schema||[];if(newSchema){let modifiedSchema={...schema,...newSchema};inputsSchema=inputsSchema.map(s=>s.key===schema.key?modifiedSchema:s)}else inputsSchema=inputsSchema.filter(s=>s.key!==schema.key);newSchema?.key&&onInputChange?.(newSchema.key,value),newSchema?.type&&newSchema.type!==schema.type&&onInputChange?.(schema.key,{value:null}),onInputSchemaChange?.(inputsSchema)},onDone:()=>setEditing(!1),configuration:configuration,parentConfiguration:parentConfiguration,sampleGlobalsWithInputs:sampleGlobalsWithInputs})}):(0,jsx_runtime.jsx)(LemonField.D,{name:`inputs.${schema.key}`,help:"string"==typeof schema.description?(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"max-w-[30rem]",lowKeyHeadings:!0,children:schema.description}):void 0,children:_ref11=>{let{value,onChange:_onChange}=_ref11,onChange=newValue=>{_onChange({...value,...newValue})};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsxs)(src.HQ,{className:showSource?"cursor-grab":"",showOptional:!schema.required,...attributes,...listeners,children:[schema.label||schema.key,schema.secret?(0,jsx_runtime.jsx)(src.u,{title:"This input is marked as secret. It will be encrypted and not visible after saving.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconLock,{})}):void 0]}),showSource&&(0,jsx_runtime.jsxs)(src.oe,{type:"muted",className:"font-mono",children:["inputs.",schema.key]}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),showSource&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",noPadding:!0,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>setEditing(!0)})]}),value?.secret?(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center p-1 rounded border border-dashed",children:[(0,jsx_runtime.jsx)("span",{className:"flex-1 p-1 italic text-secondary",children:"This value is secret and is not displayed here."}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{onChange({value:"",secret:!1})},size:"small",type:"secondary",children:"Edit"})]}):(0,jsx_runtime.jsx)(CyclotronJobInputRenderer,{schema:schema,input:null!=value?value:{value:""},onChange:onChange,onInputChange:onInputChange,configuration:configuration,parentConfiguration:parentConfiguration,sampleGlobalsWithInputs:sampleGlobalsWithInputs})]})}})})}},"../../frontend/src/lib/integrations/LinearIntegrationHelpers.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ul:()=>LinearTeamPicker,Af:()=>LinearTeamSelectField});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let linearIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","linearIntegrationLogic",key]),(0,index_esm.actions)({loadAllLinearTeams:()=>({})}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{linearTeams:[[],{loadAllLinearTeams:async()=>(await api.ZP.integrations.linearTeams(props.id)).teams}]}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function LinearTeamPicker(_ref){let{onChange,value,integration}=_ref,{options,loading}=useLinearTeams(integration.id);return(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],mode:"single","data-attr":"select-linear-team",placeholder:"Select a team...",options:options,loading:loading})}let LinearTeamSelectField=_ref2=>{let{integrationId}=_ref2,{options,loading}=useLinearTeams(integrationId);return(0,jsx_runtime.jsx)(LemonField.D,{name:"teamIds",label:"Team",children:(0,jsx_runtime.jsx)(src.nt,{mode:"single","data-attr":"select-linear-team",placeholder:"Select a team...",options:options,loading:loading})})};function useLinearTeams(integrationId){let logic=linearIntegrationLogic({id:integrationId}),{linearTeams,linearTeamsLoading}=(0,index_esm.useValues)(logic),{loadAllLinearTeams}=(0,index_esm.useActions)(logic),linearTeamOptions=(0,react.useMemo)(()=>linearTeams?linearTeams.map(x=>({key:x.id,label:x.name})):[],[linearTeams]);return(0,react.useEffect)(()=>{loadAllLinearTeams()},[loadAllLinearTeams]),{options:linearTeamOptions,loading:linearTeamsLoading}}},"../../frontend/src/scenes/hog-functions/configuration/hogFunctionConfigurationLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Af:()=>convertToHogFunctionInvocationGlobals,nM:()=>hogFunctionConfigurationLogic,r9:()=>sanitizeConfiguration,oT:()=>templateToConfiguration});var fast_deep_equal=__webpack_require__("../../node_modules/.pnpm/fast-deep-equal@3.1.3/node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),kea_subscriptions_lib=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.7_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.261.1_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),api=__webpack_require__("../../frontend/src/lib/api.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),deleteWithUndo=__webpack_require__("../../frontend/src/lib/utils/deleteWithUndo.tsx"),defineProperty=__webpack_require__("../../node_modules/.pnpm/@babel+runtime@7.24.0/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),liquid_browser=__webpack_require__("../../node_modules/.pnpm/liquidjs@10.21.1/node_modules/liquidjs/dist/liquid.browser.mjs");let LIQUID_REGEX=/\{\{(.*?)\}\}|{%(.*?)%}/g;class LiquidRenderer{static get liquid(){return this._liquid||(this._liquid=new liquid_browser.Kj({outputEscape:"escape"})),this._liquid}static parse(template){let decodedTemplate=template.replace(LIQUID_REGEX,match=>match.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&amp;/g,"&"));return this.liquid.parse(decodedTemplate)}}(0,defineProperty.Z)(LiquidRenderer,"_liquid",null);var person_utils=__webpack_require__("../../frontend/src/scenes/persons/person-utils.ts"),pipelineNodeLogic=__webpack_require__("../../frontend/src/scenes/pipeline/pipelineNodeLogic.tsx"),projectLogic=__webpack_require__("../../frontend/src/scenes/projectLogic.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),projectTreeLogic=__webpack_require__("../../frontend/src/layout/panel-layout/ProjectTree/projectTreeLogic.tsx"),groupsModel=__webpack_require__("../../frontend/src/models/groupsModel.ts"),DataTable_utils=__webpack_require__("../../frontend/src/queries/nodes/DataTable/utils.ts"),query=__webpack_require__("../../frontend/src/queries/query.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),queries_utils=__webpack_require__("../../frontend/src/queries/utils.ts"),types=__webpack_require__("../../frontend/src/types.ts"),sub_templates=__webpack_require__("../../frontend/src/scenes/hog-functions/sub-templates/sub-templates.ts");let VALIDATION_RULES={SITE_DESTINATION_REQUIRES_MAPPINGS:data=>"site_destination"!==data.type||data.mappings&&0!==data.mappings.length?void 0:"You must add at least one mapping",INTERNAL_DESTINATION_REQUIRES_FILTERS:data=>"internal_destination"===data.type&&data.filters?.events?.length===0?"You must choose a filter":void 0},NEW_FUNCTION_TEMPLATE={id:"new",free:!1,type:"destination",name:"",description:"",inputs_schema:[],code_language:"hog",code:"print('Hello, world!');",status:"stable"},TYPES_WITH_REAL_EVENTS=["destination","site_destination","transformation"],TYPES_WITH_VOLUME_WARNING=["destination","site_destination"];function sanitizeConfiguration(data){var _data$filters,_filters$source;function sanitizeInputs(data){let sanitizedInputs={};return data.inputs_schema?.forEach(inputSchema=>{var _inputSchema$templati,_input$templating;let templatingEnabled=null===(_inputSchema$templati=inputSchema.templating)||void 0===_inputSchema$templati||_inputSchema$templati,input=data.inputs?.[inputSchema.key],secret=input?.secret,value=input?.value;if(secret){sanitizedInputs[inputSchema.key]={value:"********",secret:!0};return}if("json"===inputSchema.type&&"string"==typeof value)try{value=JSON.parse(value)}catch{}sanitizedInputs[inputSchema.key]={value:value,templating:templatingEnabled?null!==(_input$templating=input?.templating)&&void 0!==_input$templating?_input$templating:"hog":void 0}}),sanitizedInputs}let filters=null!==(_data$filters=data.filters)&&void 0!==_data$filters?_data$filters:{};return filters.source=null!==(_filters$source=filters.source)&&void 0!==_filters$source?_filters$source:"events",("person-updates"===filters.source||Array.isArray(data?.mappings))&&(delete filters.actions,delete filters.events),{...data,filters:data.filters,mappings:data.mappings?.map(mapping=>({...mapping,inputs:sanitizeInputs(mapping)})),inputs:sanitizeInputs(data),masking:data.masking?.hash?data.masking:null,icon_url:data.icon_url}}let templateToConfiguration=template=>{var _template$type;let mappings;function getInputs(inputs_schema){let inputs={};return inputs_schema?.forEach(schema=>{void 0!==schema.default&&(inputs[schema.key]={value:schema.default})}),inputs}return template?.mapping_templates&&(mappings=template.mapping_templates.filter(t=>t.include_by_default).map(template=>({...template,inputs:template.inputs_schema?.reduce((acc,input)=>(acc[input.key]={value:input.default},acc),{})}))),{type:null!==(_template$type=template.type)&&void 0!==_template$type?_template$type:"destination",name:template.name,description:"string"==typeof template.description?template.description:"",inputs_schema:template.inputs_schema,filters:template.filters,mappings:mappings,hog:template.code,icon_url:template.icon_url,inputs:getInputs(template.inputs_schema),enabled:!0}};function convertToHogFunctionInvocationGlobals(event,person){var _team$id,_team$name,_event$uuid,_event$elements_chain,_event$uuid2,_person$uuid;let team=teamLogic.teamLogic.findMounted()?.values?.currentTeam,projectUrl=`${window.location.origin}/project/${team?.id}`;return{project:{id:null!==(_team$id=team?.id)&&void 0!==_team$id?_team$id:0,name:null!==(_team$name=team?.name)&&void 0!==_team$name?_team$name:"Default project",url:projectUrl},event:{uuid:null!==(_event$uuid=event.uuid)&&void 0!==_event$uuid?_event$uuid:"",event:event.event,distinct_id:event.distinct_id,elements_chain:null!==(_event$elements_chain=event.elements_chain)&&void 0!==_event$elements_chain?_event$elements_chain:"",properties:event.properties,timestamp:event.timestamp,url:`${projectUrl}/events/${encodeURIComponent(null!==(_event$uuid2=event.uuid)&&void 0!==_event$uuid2?_event$uuid2:"")}/${encodeURIComponent(event.timestamp)}`},person:{id:null!==(_person$uuid=person.uuid)&&void 0!==_person$uuid?_person$uuid:"",properties:person.properties,name:(0,person_utils.y)(person),url:`${projectUrl}/person/${encodeURIComponent(event.distinct_id)}`},groups:{}}}function mightDropEvents(code){let sanitizedCode=code.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,"").replace(/\s+/g," ").trim();if(!sanitizedCode)return!1;if(sanitizedCode.includes("return null")||sanitizedCode.includes("return undefined")||/\breturn\b\s*;/.test(sanitizedCode)||/\breturn\b\s*$/.test(sanitizedCode)||/\bif\s*\([^)]*\)\s*\{\s*\breturn\s+(null|undefined)\b/.test(sanitizedCode))return!0;let nullVarMatch=code.match(/\blet\s+(\w+)\s*:?=\s*(null|undefined)/g);if(nullVarMatch){for(let varName of nullVarMatch.map(match=>match.match(/\blet\s+(\w+)/)?.[1]).filter(Boolean))if(RegExp(`\\breturn\\s+${varName}\\b`).test(code))return!0}return!1}let hogFunctionConfigurationLogic=(0,index_esm.kea)([(0,index_esm.path)(id=>["scenes","pipeline","hogFunctionConfigurationLogic",id]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{var _ref2;let{id,templateId,logicKey}=_ref,baseKey=null!==(_ref2=null!=id?id:templateId)&&void 0!==_ref2?_ref2:"new";return logicKey?`${logicKey}_${baseKey}`:baseKey}),(0,index_esm.connect)(_ref3=>{let{id}=_ref3;return{values:[projectLogic.K,["currentProjectId","currentProject"],groupsModel.$,["groupTypes"],userLogic.userLogic,["hasAvailableFeature"],featureFlagLogic.featureFlagLogic,["featureFlags"]],actions:[(0,pipelineNodeLogic.y)({id:`hog-${id}`,stage:types.We.Destination}),["setBreadcrumbTitle"]]}}),(0,index_esm.actions)({setShowSource:showSource=>({showSource}),resetForm:!0,upsertHogFunction:configuration=>({configuration}),duplicate:!0,duplicateFromTemplate:!0,resetToTemplate:!0,deleteHogFunction:!0,sparklineQueryChanged:sparklineQuery=>({sparklineQuery}),loadSampleGlobals:payload=>({eventId:payload?.eventId}),setUnsavedConfiguration:configuration=>({configuration}),persistForUnload:!0,setSampleGlobalsError:error=>({error}),setSampleGlobals:sampleGlobals=>({sampleGlobals}),setShowEventsList:showEventsList=>({showEventsList}),setOldHogCode:oldHogCode=>({oldHogCode}),setNewHogCode:newHogCode=>({newHogCode}),clearHogCodeDiff:!0,reportAIHogFunctionPrompted:!0,reportAIHogFunctionAccepted:!0,reportAIHogFunctionRejected:!0,reportAIHogFunctionPromptOpen:!0,setOldFilters:oldFilters=>({oldFilters}),setNewFilters:newFilters=>({newFilters}),clearFiltersDiff:!0,reportAIFiltersPrompted:!0,reportAIFiltersAccepted:!0,reportAIFiltersRejected:!0,reportAIFiltersPromptOpen:!0,setOldInputs:oldInputs=>({oldInputs}),setNewInputs:newInputs=>({newInputs}),clearInputsDiff:!0,reportAIHogFunctionInputsPrompted:!0,reportAIHogFunctionInputsAccepted:!0,reportAIHogFunctionInputsRejected:!0,reportAIHogFunctionInputsPromptOpen:!0}),(0,index_esm.reducers)(_ref4=>{let{props}=_ref4;return{sampleGlobals:[null,{setSampleGlobals:(_,_ref5)=>{let{sampleGlobals}=_ref5;return sampleGlobals}}],showSource:[!!(!props.id&&props.templateId?.startsWith("template-blank-")),{setShowSource:(_,_ref6)=>{let{showSource}=_ref6;return showSource}}],hasHadSubmissionErrors:[!1,{upsertHogFunctionFailure:()=>!0}],unsavedConfiguration:[null,{persist:!0},{setUnsavedConfiguration:(_,_ref7)=>{let{configuration}=_ref7;return configuration?{timestamp:Date.now(),configuration}:null}}],sampleGlobalsError:[null,{loadSampleGlobals:()=>null,setSampleGlobalsError:(_,_ref8)=>{let{error}=_ref8;return error}}],showEventsList:[!1,{setShowEventsList:(_,_ref9)=>{let{showEventsList}=_ref9;return showEventsList}}],oldHogCode:[null,{setOldHogCode:(_,_ref10)=>{let{oldHogCode}=_ref10;return oldHogCode},clearHogCodeDiff:()=>null}],newHogCode:[null,{setNewHogCode:(_,_ref11)=>{let{newHogCode}=_ref11;return newHogCode},clearHogCodeDiff:()=>null}],oldFilters:[null,{setOldFilters:(_,_ref12)=>{let{oldFilters}=_ref12;return oldFilters},clearFiltersDiff:()=>null}],newFilters:[null,{setNewFilters:(_,_ref13)=>{let{newFilters}=_ref13;return newFilters},clearFiltersDiff:()=>null}],oldInputs:[null,{setOldInputs:(_,_ref14)=>{let{oldInputs}=_ref14;return oldInputs},clearInputsDiff:()=>null}],newInputs:[null,{setNewInputs:(_,_ref15)=>{let{newInputs}=_ref15;return newInputs},clearInputsDiff:()=>null}]}}),(0,kea_loaders_lib.loaders)(_ref16=>{let{actions,props,values}=_ref16;return{template:[null,{loadTemplate:async()=>{if(!props.templateId)return null;if("new"===props.templateId)return{...NEW_FUNCTION_TEMPLATE};let res=await api.ZP.hogFunctions.getTemplate(props.templateId);if(!res)throw Error("Template not found");return res}}],hogFunction:[null,{loadHogFunction:async()=>props.id&&"new"!==props.id?await api.ZP.hogFunctions.get(props.id):null,upsertHogFunction:async _ref17=>{let{configuration}=_ref17,res=props.id&&"new"!==props.id?await api.ZP.hogFunctions.update(props.id,configuration):await api.ZP.hogFunctions.create(configuration);return dist_module.ZP.capture("hog function saved",{id:res.id,template_id:res.template?.id,template_name:res.template?.name,type:res.type,enabled:res.enabled}),src.UJ.success("Configuration saved"),(0,projectTreeLogic.BI)("hog_function/",res.id),res}}],sparkline:[null,{sparklineQueryChanged:async(_ref18,breakpoint)=>{var _result$results$0$dat;let{sparklineQuery}=_ref18;if(!TYPES_WITH_REAL_EVENTS.includes(values.type))return null;null===values.sparkline?await breakpoint(100):await breakpoint(1e3);let result=await (0,query.jr)(sparklineQuery);breakpoint();let dataValues=null!==(_result$results$0$dat=result?.results?.[0]?.data)&&void 0!==_result$results$0$dat?_result$results$0$dat:[];if(TYPES_WITH_VOLUME_WARNING.includes(values.type)){let[underThreshold,overThreshold]=dataValues.reduce((acc,val)=>(acc[0].push(Math.min(val,1e3)),acc[1].push(Math.max(0,val-1e3)),acc),[[],[]]);return{data:[{name:"Low volume",values:underThreshold,color:"success"},{name:"High volume",values:overThreshold,color:"warning"}],count:result?.results?.[0]?.count,labels:result?.results?.[0]?.labels}}return{data:[{name:"Volume",values:dataValues,color:"success"}],count:result?.results?.[0]?.count,labels:result?.results?.[0]?.labels,warning:"transformation"===values.type?"Historical volume may not reflect future volume after transformation is applied.":void 0}}}],sampleGlobals:[null,{loadSampleGlobals:async(_ref19,breakpoint)=>{var _values$configuration,_e$message;let{eventId}=_ref19;if(!values.lastEventQuery)return values.sampleGlobals;let errorMessage="No events match these filters in the last 30 days. Showing an example $pageview event instead.";try{await breakpoint(null===values.sampleGlobals?10:1e3);let response=await (0,query.jr)({...values.lastEventQuery,properties:eventId?[{type:types.FT.HogQL,key:`uuid = '${eventId}'`}]:void 0});if(!response?.results?.[0]&&values.lastEventSecondQuery&&(response=await (0,query.jr)({...values.lastEventSecondQuery,properties:eventId?[{type:types.FT.HogQL,key:`uuid = '${eventId}'`}]:void 0})),!response?.results?.[0])throw Error(errorMessage);let event=response?.results?.[0]?.[0],person=response?.results?.[0]?.[1],globals=convertToHogFunctionInvocationGlobals(event,person);return globals.groups={},values.groupTypes.forEach((groupType,index)=>{let tuple=response?.results?.[0]?.[2+index];if(tuple&&Array.isArray(tuple)&&tuple[2]){let properties={};try{properties=JSON.parse(tuple[3])}catch{}globals.groups[groupType.group_type]={type:groupType.group_type,index:tuple[1],id:tuple[2],url:`${window.location.origin}/groups/${tuple[1]}/${encodeURIComponent(tuple[2])}`,properties}}}),globals.source={name:null!==(_values$configuration=values.configuration?.name)&&void 0!==_values$configuration?_values$configuration:"Unnamed",url:window.location.href.split("#")[0]},globals}catch(e){return(0,index_esm.isBreakpoint)(e)||actions.setSampleGlobalsError(null!==(_e$message=e.message)&&void 0!==_e$message?_e$message:errorMessage),values.exampleInvocationGlobals}}}]}}),(0,lib.forms)(_ref20=>{let{values,props,asyncActions}=_ref20;return{configuration:{defaults:{},alwaysShowErrors:!0,errors:data=>({name:data.name?void 0:"Name is required",mappings:VALIDATION_RULES.SITE_DESTINATION_REQUIRES_MAPPINGS(data),filters:VALIDATION_RULES.INTERNAL_DESTINATION_REQUIRES_FILTERS(data),...values.inputFormErrors}),submit:async data=>{if(data.hog&&new Blob([data.hog]).size>102400){src.UJ.error("Hog code exceeds maximum size of 100KB. Please simplify your code or contact support to increase the limit.");return}let payload=sanitizeConfiguration(data);if(payload.template_id=props.templateId||values.hogFunction?.template?.id,values.hasAddon||"transformation"===values.type||delete payload.hog,!props.id||"new"===props.id){let type=values.type;payload._create_in_folder=`Unfiled/${"site_app"===type?"Site apps":"transformation"===type?"Transformations":"source_webhook"===type?"Sources":"Destinations"}`}await asyncActions.upsertHogFunction(payload)}}}}),(0,index_esm.selectors)(()=>({logicProps:[()=>[(_,props)=>props],props=>props],type:[s=>[s.configuration,s.hogFunction],(configuration,hogFunction)=>{var _ref21,_configuration$type;return null!==(_ref21=null!==(_configuration$type=configuration?.type)&&void 0!==_configuration$type?_configuration$type:hogFunction?.type)&&void 0!==_ref21?_ref21:"loading"}],hasAddon:[s=>[s.hasAvailableFeature,s.featureFlags],(hasAvailableFeature,featureFlags)=>hasAvailableFeature(types.P$.DATA_PIPELINES)||!!featureFlags[constants.y8.CDP_NEW_PRICING]],hasGroupsAddon:[s=>[s.hasAvailableFeature],hasAvailableFeature=>hasAvailableFeature(types.P$.GROUP_ANALYTICS)],showPaygate:[s=>[s.template,s.hasAddon],(template,hasAddon)=>template&&!template.free&&!hasAddon],useMapping:[s=>[s.hogFunction,s.template],(hogFunction,template)=>Array.isArray(hogFunction?.mappings)||template?.mapping_templates?.length],defaultFormState:[s=>[s.template,s.hogFunction],(template,hogFunction)=>template?templateToConfiguration(template):null!=hogFunction?hogFunction:null],templateId:[s=>[s.template,s.hogFunction],(template,hogFunction)=>template?.id||hogFunction?.template?.id],loading:[s=>[s.hogFunctionLoading,s.templateLoading],(hogFunctionLoading,templateLoading)=>hogFunctionLoading||templateLoading],loaded:[s=>[s.hogFunction,s.template],(hogFunction,template)=>!!hogFunction||!!template],contextId:[s=>[s.configuration],configuration=>(0,sub_templates.Ud)(configuration.filters?.events?.[0]?.id)],inputFormErrors:[s=>[s.configuration],configuration=>{var _configuration$inputs;let inputs=null!==(_configuration$inputs=configuration.inputs)&&void 0!==_configuration$inputs?_configuration$inputs:{},inputErrors={};return configuration.inputs_schema?.forEach(inputSchema=>{var _input$templating2;let key=inputSchema.key,input=inputs[key],language=null!==(_input$templating2=input?.templating)&&void 0!==_input$templating2?_input$templating2:"hog",value=input?.value;if(input?.secret)return;let getTemplatingError=value=>{if("liquid"===language&&"string"==typeof value)try{LiquidRenderer.parse(value)}catch(e){return`Liquid template error: ${e.message}`}},addTemplatingError=value=>{let templatingError=getTemplatingError(value);templatingError&&(inputErrors[key]=templatingError)},missing=null==value||""===value;if(inputSchema.required&&missing&&(inputErrors[key]="This field is required"),"json"===inputSchema.type&&"string"==typeof value){try{JSON.parse(value)}catch{inputErrors[key]="Invalid JSON"}addTemplatingError(value)}if("email"===inputSchema.type&&value){let combinedErrors=Object.values({html:value.html?getTemplatingError(value.html):"HTML is required",subject:value.subject?getTemplatingError(value.subject):"Subject is required",from:value.from?getTemplatingError(value.from):"From is required",to:value.to?getTemplatingError(value.to):"To is required"}).filter(v=>!!v).join(", ");combinedErrors&&(inputErrors[key]=combinedErrors)}if("string"===inputSchema.type&&"string"==typeof value&&addTemplatingError(value),"dictionary"===inputSchema.type)for(let val of Object.values(null!=value?value:{}))"string"==typeof val&&addTemplatingError(val)}),Object.keys(inputErrors).length>0?{inputs:inputErrors}:null}],willReEnableOnSave:[s=>[s.configuration,s.hogFunction],(configuration,hogFunction)=>{var _hogFunction$status$s;let hogState=null!==(_hogFunction$status$s=hogFunction?.status?.state)&&void 0!==_hogFunction$status$s?_hogFunction$status$s:0;return configuration?.enabled&&hogState===types.si.disabled}],willChangeEnabledOnSave:[s=>[s.configuration,s.hogFunction],(configuration,hogFunction)=>{var _hogFunction$enabled;return configuration?.enabled!==(null!==(_hogFunction$enabled=hogFunction?.enabled)&&void 0!==_hogFunction$enabled&&_hogFunction$enabled)}],exampleInvocationGlobals:[s=>[s.configuration,s.currentProject,s.groupTypes,s.contextId],(configuration,currentProject,groupTypes,contextId)=>{var _configuration$name;let currentUrl=window.location.href.split("#")[0],eventId=(0,utils.Vj)(),personId=(0,utils.Vj)(),globals={event:{uuid:eventId,distinct_id:(0,utils.Vj)(),timestamp:(0,dayjs.Bv)().toISOString(),elements_chain:"",url:`${window.location.origin}/project/${currentProject?.id}/events/`,..."error-tracking"===contextId?{event:configuration?.filters?.events?.[0].id||"$error_tracking_issue_created",properties:{name:"Test issue",description:"This is the issue description"}}:"activity-log"===contextId?{event:"$activity_log_entry_created",properties:{activity:"created",scope:"Insight",item_id:"abcdef"}}:{event:"$pageview",properties:{$current_url:currentUrl,$browser:"Chrome",$ip:"89.160.20.129",this_is_an_example_event:!0}}},person:"error-tracking"!==contextId?{id:personId,properties:{email:"example@posthog.com"},name:"Example person",url:`${window.location.origin}/person/${personId}`}:void 0,groups:{},project:{id:currentProject?.id||0,name:currentProject?.name||"",url:`${window.location.origin}/project/${currentProject?.id}`},source:{name:null!==(_configuration$name=configuration?.name)&&void 0!==_configuration$name?_configuration$name:"Unnamed",url:currentUrl}};return"error-tracking"!==contextId&&groupTypes.forEach(groupType=>{let id=(0,utils.Vj)();globals.groups[groupType.group_type]={id:id,type:groupType.group_type,index:groupType.group_type_index,url:`${window.location.origin}/groups/${groupType.group_type_index}/${encodeURIComponent(id)}`,properties:{}}}),globals}],sampleGlobalsWithInputs:[s=>[s.sampleGlobals,s.exampleInvocationGlobals,s.configuration],(sampleGlobals,exampleInvocationGlobals,configuration)=>{let inputs={};for(let input of configuration?.inputs_schema||[])inputs[input.key]=input.type;return"source_webhook"===configuration.type?{request:{body:{},headers:{},ip:"127.0.0.1"},inputs}:{...null!=sampleGlobals?sampleGlobals:exampleInvocationGlobals,inputs}}],matchingFilters:[s=>[s.configuration,s.useMapping],(configuration,useMapping)=>{var _configuration$filter,_configuration$filter2,_configuration$filter3,_event$properties,_action$properties,_configuration$filter4;if(useMapping&&!configuration.mappings?.length)return{type:types.J2.And,values:[{type:types.J2.And,values:[{type:types.FT.HogQL,key:"false"}]}]};let seriesProperties={type:types.J2.Or,values:[]},properties={type:types.J2.And,values:[seriesProperties]},allPossibleEventFilters=null!==(_configuration$filter=configuration.filters?.events)&&void 0!==_configuration$filter?_configuration$filter:[],allPossibleActionFilters=null!==(_configuration$filter2=configuration.filters?.actions)&&void 0!==_configuration$filter2?_configuration$filter2:[];if(Array.isArray(configuration.mappings))for(let mapping of configuration.mappings)mapping.filters?.events&&allPossibleEventFilters.push(...mapping.filters.events),mapping.filters?.actions&&allPossibleActionFilters.push(...mapping.filters.actions);for(let event of allPossibleEventFilters){let eventProperties=[...null!==(_event$properties=event.properties)&&void 0!==_event$properties?_event$properties:[]];event.id&&eventProperties.push({type:types.FT.HogQL,key:(0,queries_utils.zP)`event = ${event.id}`}),0===eventProperties.length&&eventProperties.push({type:types.FT.HogQL,key:"true"}),seriesProperties.values.push({type:types.J2.And,values:eventProperties})}for(let action of allPossibleActionFilters){let actionProperties=[...null!==(_action$properties=action.properties)&&void 0!==_action$properties?_action$properties:[]];action.id&&actionProperties.push({type:types.FT.HogQL,key:(0,queries_utils.zP)`matchesAction(${parseInt(action.id)})`}),seriesProperties.values.push({type:types.J2.And,values:actionProperties})}if((null!==(_configuration$filter3=configuration.filters?.properties?.length)&&void 0!==_configuration$filter3?_configuration$filter3:0)>0){let globalProperties={type:types.J2.And,values:[]};for(let property of null!==(_configuration$filter4=configuration.filters?.properties)&&void 0!==_configuration$filter4?_configuration$filter4:[])globalProperties.values.push(property);properties.values.push(globalProperties)}return properties},{resultEqualityCheck:fast_deep_equal_default()}],filtersContainPersonProperties:[s=>[s.configuration],configuration=>{let filters=configuration.filters,containsPersonProperties=!1;return filters?.properties&&!containsPersonProperties&&(containsPersonProperties=filters.properties.some(p=>"person"===p.type)),filters?.actions&&!containsPersonProperties&&(containsPersonProperties=filters.actions.some(a=>a.properties?.some(p=>"person"===p.type))),filters?.events&&!containsPersonProperties&&(containsPersonProperties=filters.events.some(e=>e.properties?.some(p=>"person"===p.type))),containsPersonProperties}],sourceUsesEvents:[s=>[s.configuration,s.type],(configuration,type)=>{var _configuration$filter5;return TYPES_WITH_REAL_EVENTS.includes(type)&&(null!==(_configuration$filter5=configuration.filters?.source)&&void 0!==_configuration$filter5?_configuration$filter5:"events")==="events"}],sparklineQuery:[s=>[s.configuration,s.matchingFilters,s.sourceUsesEvents],(configuration,matchingFilters,sourceUsesEvents)=>sourceUsesEvents?(0,queries_utils.xg)({kind:schema_general.OH.TrendsQuery,filterTestAccounts:configuration.filters?.filter_test_accounts,series:[{kind:schema_general.OH.EventsNode,event:null,name:"All Events",math:types.vN.TotalCount}],properties:matchingFilters,interval:"day",dateRange:{date_from:"-7d"},trendsFilter:{display:types.Qb.ActionsBar},modifiers:{personsOnEventsMode:"person_id_no_override_properties_on_events"}}):null,{resultEqualityCheck:fast_deep_equal_default()}],baseEventsQuery:[s=>[s.configuration,s.matchingFilters,s.groupTypes,s.sourceUsesEvents],(configuration,matchingFilters,groupTypes,sourceUsesEvents)=>{if(!sourceUsesEvents)return null;let query={kind:schema_general.OH.EventsQuery,filterTestAccounts:configuration.filters?.filter_test_accounts,fixedProperties:[matchingFilters],select:["*","person"],after:"-7d",orderBy:["timestamp DESC"],modifiers:{personsOnEventsMode:"person_id_no_override_properties_on_events"}};return groupTypes.forEach(groupType=>{let name=(0,queries_utils.cM)(groupType.group_type);query.select.push(`tuple(${name}.created_at, ${name}.index, ${name}.key, ${name}.properties, ${name}.updated_at)`)}),(0,queries_utils.xg)(query)},{resultEqualityCheck:fast_deep_equal_default()}],eventsDataTableNode:[s=>[s.baseEventsQuery],baseEventsQuery=>baseEventsQuery?(0,queries_utils.xg)({kind:schema_general.OH.DataTableNode,source:{...baseEventsQuery,select:(0,DataTable_utils.Qi)(schema_general.OH.EventsQuery)}},{recursion:!1}):null],lastEventQuery:[s=>[s.baseEventsQuery],baseEventsQuery=>baseEventsQuery?{...baseEventsQuery,limit:1}:null,{resultEqualityCheck:fast_deep_equal_default()}],lastEventSecondQuery:[s=>[s.lastEventQuery],lastEventQuery=>lastEventQuery?{...lastEventQuery,after:"-30d"}:null],templateHasChanged:[s=>[s.hogFunction,s.configuration],(hogFunction,configuration)=>hogFunction?.template?.code&&hogFunction.template.code!==configuration.hog],mappingTemplates:[s=>[s.hogFunction,s.template],(hogFunction,template)=>{var _ref22,_template$mapping_tem;return null!==(_ref22=null!==(_template$mapping_tem=template?.mapping_templates)&&void 0!==_template$mapping_tem?_template$mapping_tem:hogFunction?.template?.mapping_templates)&&void 0!==_ref22?_ref22:[]}],usesGroups:[s=>[s.configuration],configuration=>{let configStr=JSON.stringify(configuration);return configStr.includes("groups.")||configStr.includes("{groups}")}],mightDropEvents:[s=>[s.configuration,s.type],(configuration,type)=>"transformation"===type&&mightDropEvents(configuration.hog||"")],currentHogCode:[s=>[s.newHogCode,s.configuration],(newHogCode,configuration)=>{var _ref23;return null!==(_ref23=null!=newHogCode?newHogCode:configuration.hog)&&void 0!==_ref23?_ref23:""}],currentInputs:[s=>[s.newInputs,s.configuration],(newInputs,configuration)=>{var _ref24;return null!==(_ref24=null!=newInputs?newInputs:configuration.inputs_schema)&&void 0!==_ref24?_ref24:[]}],inputsDiff:[s=>[s.oldInputs,s.newInputs],(oldInputs,newInputs)=>oldInputs&&newInputs?{oldInputs,newInputs}:null],canLoadSampleGlobals:[s=>[s.lastEventQuery],lastEventQuery=>!!lastEventQuery],showFilters:[s=>[s.type],type=>["destination","internal_destination","site_destination","transformation"].includes(type)],showExpectedVolume:[s=>[s.type,s.sourceUsesEvents],(type,sourceUsesEvents)=>sourceUsesEvents&&["destination","site_destination","transformation"].includes(type)],canEditSource:[s=>[s.type,s.template,s.hogFunction],(type,template,hogFunction)=>["site_destination","site_app","source_webhook","transformation"].includes(type)||"destination"===type&&"hog"===(template?.code_language||hogFunction?.template?.code_language)],showTesting:[s=>[s.type],type=>["destination","internal_destination","transformation"].includes(type)]})),(0,index_esm.listeners)(_ref25=>{let{actions,values,cache}=_ref25;return{reportAIHogFunctionPrompted:()=>{dist_module.ZP.capture("ai_hog_function_prompted",{type:values.type})},reportAIHogFunctionAccepted:()=>{dist_module.ZP.capture("ai_hog_function_accepted",{type:values.type})},reportAIHogFunctionRejected:()=>{dist_module.ZP.capture("ai_hog_function_rejected",{type:values.type})},reportAIHogFunctionPromptOpen:()=>{dist_module.ZP.capture("ai_hog_function_prompt_open",{type:values.type})},reportAIFiltersPrompted:()=>{dist_module.ZP.capture("ai_hog_function_filters_prompted",{type:values.type})},reportAIFiltersAccepted:()=>{dist_module.ZP.capture("ai_hog_function_filters_accepted",{type:values.type})},reportAIFiltersRejected:()=>{dist_module.ZP.capture("ai_hog_function_filters_rejected",{type:values.type})},reportAIFiltersPromptOpen:()=>{dist_module.ZP.capture("ai_hog_function_filters_prompt_open",{type:values.type})},reportAIHogFunctionInputsPrompted:()=>{dist_module.ZP.capture("ai_hog_function_inputs_prompted",{type:values.type})},reportAIHogFunctionInputsAccepted:()=>{dist_module.ZP.capture("ai_hog_function_inputs_accepted",{type:values.type})},reportAIHogFunctionInputsRejected:()=>{dist_module.ZP.capture("ai_hog_function_inputs_rejected",{type:values.type})},reportAIHogFunctionInputsPromptOpen:()=>{dist_module.ZP.capture("ai_hog_function_inputs_prompt_open",{type:values.type})},loadTemplateSuccess:()=>actions.resetForm(),loadHogFunctionSuccess:()=>{var _values$hogFunction$n;actions.resetForm(),actions.setBreadcrumbTitle(null!==(_values$hogFunction$n=values.hogFunction?.name)&&void 0!==_values$hogFunction$n?_values$hogFunction$n:"Unnamed")},upsertHogFunctionSuccess:()=>{var _values$hogFunction$n2;actions.resetForm(),actions.setBreadcrumbTitle(null!==(_values$hogFunction$n2=values.hogFunction?.name)&&void 0!==_values$hogFunction$n2?_values$hogFunction$n2:"Unnamed")},upsertHogFunctionFailure:_ref26=>{let{errorObject}=_ref26,maybeValidationError=errorObject.data;maybeValidationError?.type==="validation_error"?setTimeout(()=>{maybeValidationError.attr.includes("inputs__")?actions.setConfigurationManualErrors({inputs:{[maybeValidationError.attr.split("__")[1]]:maybeValidationError.detail}}):actions.setConfigurationManualErrors({[maybeValidationError.attr]:maybeValidationError.detail})},1):(console.error(errorObject),src.UJ.error("Error submitting configuration"))},resetForm:()=>{var _cache$paramsFromUrl,_values$unsavedConfig,_values$configuration2;let baseConfig=values.defaultFormState;if(!baseConfig)return;let config={...baseConfig,...cache.configFromUrl},paramsFromUrl=null!==(_cache$paramsFromUrl=cache.paramsFromUrl)&&void 0!==_cache$paramsFromUrl?_cache$paramsFromUrl:{},unsavedConfigurationToApply=(null!==(_values$unsavedConfig=values.unsavedConfiguration?.timestamp)&&void 0!==_values$unsavedConfig?_values$unsavedConfig:0)>Date.now()-3e5?values.unsavedConfiguration?.configuration:null;if(actions.resetConfiguration(config),unsavedConfigurationToApply&&actions.setConfigurationValues(unsavedConfigurationToApply),actions.setUnsavedConfiguration(null),paramsFromUrl.integration_target&&paramsFromUrl.integration_id){let inputs=null!==(_values$configuration2=values.configuration?.inputs)&&void 0!==_values$configuration2?_values$configuration2:{};inputs[paramsFromUrl.integration_target]={value:paramsFromUrl.integration_id},actions.setConfigurationValues({inputs})}},duplicate:async()=>{if(values.hogFunction){let newConfig={...values.configuration,name:`${values.configuration.name} (copy)`},originalTemplate=values.hogFunction.template;kea_router_lib.router.actions.push(urls.j.hogFunctionNew(originalTemplate.id),void 0,{configuration:newConfig})}},duplicateFromTemplate:async()=>{if(values.hogFunction?.template){let newConfig={...values.hogFunction.template};kea_router_lib.router.actions.push(urls.j.hogFunctionNew(values.hogFunction.template.id),void 0,{configuration:newConfig})}},resetToTemplate:async()=>{var _values$hogFunction$t,_config$inputs,_values$configuration3,_config$filters;let template=null!==(_values$hogFunction$t=values.hogFunction?.template)&&void 0!==_values$hogFunction$t?_values$hogFunction$t:values.template;if(template){let config=templateToConfiguration(template),inputs=null!==(_config$inputs=config.inputs)&&void 0!==_config$inputs?_config$inputs:{};Object.entries(null!==(_values$configuration3=values.configuration.inputs)&&void 0!==_values$configuration3?_values$configuration3:{}).forEach(_ref27=>{var _inputs$key;let[key,value]=_ref27;inputs[key]=null!==(_inputs$key=inputs[key])&&void 0!==_inputs$key?_inputs$key:value}),actions.setConfigurationValues({...config,enabled:values.configuration.enabled,filters:null!==(_config$filters=config.filters)&&void 0!==_config$filters?_config$filters:values.configuration.filters,mappings:values.configuration.mappings?.length?values.configuration.mappings:config.mappings,name:values.configuration.name,description:values.configuration.description}),src.UJ.success("Template updates applied but not saved.")}},setConfigurationValue:()=>{values.hasHadSubmissionErrors&&actions.setConfigurationManualErrors({})},deleteHogFunction:async()=>{let hogFunction=values.hogFunction;hogFunction&&(await (0,deleteWithUndo.S)({endpoint:`projects/${values.currentProjectId}/hog_functions`,object:{id:hogFunction.id,name:hogFunction.name},callback(undo){undo?(kea_router_lib.router.actions.replace(urls.j.hogFunction(hogFunction.id)),(0,projectTreeLogic.BI)("hog_function/",hogFunction.id)):(0,projectTreeLogic.qJ)("hog_function/",hogFunction.id)}}),kea_router_lib.router.actions.replace(urls.j.hogFunction(hogFunction.id)))},persistForUnload:()=>{actions.setUnsavedConfiguration(values.configuration)}}}),(0,index_esm.afterMount)(_ref28=>{let{props,actions,cache}=_ref28;if(cache.paramsFromUrl={integration_id:kea_router_lib.router.values.searchParams.integration_id,integration_target:kea_router_lib.router.values.searchParams.integration_target},props.templateId?(cache.configFromUrl=kea_router_lib.router.values.hashParams.configuration,actions.loadTemplate()):props.id&&"new"!==props.id&&actions.loadHogFunction(),kea_router_lib.router.values.searchParams.integration_target){let searchParams=kea_router_lib.router.values.searchParams;delete searchParams.integration_id,delete searchParams.integration_target,kea_router_lib.router.actions.replace(kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams)}}),(0,kea_subscriptions_lib.Vt)(_ref29=>{let{props,actions,cache}=_ref29;return{hogFunction:hogFunction=>{hogFunction&&props.templateId&&(cache.disabledBeforeUnload=!0,kea_router_lib.router.actions.replace(urls.j.hogFunction(hogFunction.id)))},sparklineQuery:async sparklineQuery=>{sparklineQuery&&actions.sparklineQueryChanged(sparklineQuery)}}}),(0,kea_router_lib.beforeUnload)(_ref30=>{let{values,cache}=_ref30;return{enabled:newLocation=>{if(cache.disabledBeforeUnload||values.unsavedConfiguration||!values.configurationChanged)return!1;let oldRoute=kea_router_lib.router.values.location.pathname.replace(/\/project\/\d+/,"").split("/"),newRoute=newLocation?.pathname.replace(/\/project\/\d+/,"").split("/");if(!newRoute||newRoute.length!==oldRoute.length)return!0;for(let i=0;i<oldRoute.length-1;i++)if(oldRoute[i]!==newRoute[i])return!0;let possibleMenuIds=[types.il.Configuration,types.il.Testing];return!(possibleMenuIds.includes(newRoute[newRoute.length-1])&&possibleMenuIds.includes(oldRoute[newRoute.length-1]))},message:"Changes you made will be discarded.",onConfirm:()=>{cache.disabledBeforeUnload=!0}}})])}}]);