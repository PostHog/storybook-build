"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[2094],{"./frontend/src/scenes/data-management/database/databaseSceneLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Y:()=>databaseSceneLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),_queries_query__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/queries/query.ts"),_queries_schema__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/queries/schema.ts");const databaseSceneLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-management","database","databaseSceneLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setSearchTerm:searchTerm=>({searchTerm})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({database:[null,{loadDatabase:async()=>await(0,_queries_query__WEBPACK_IMPORTED_MODULE_2__.IO)({kind:_queries_schema__WEBPACK_IMPORTED_MODULE_3__.OH.DatabaseSchemaQuery})}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({searchTerm:["",{setSearchTerm:(_,_ref)=>{let{searchTerm}=_ref;return searchTerm}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({filteredTables:[s=>[s.database,s.searchTerm],(database,searchTerm)=>database?Object.entries(database).map((_ref2=>{let[key,value]=_ref2;return{name:key,columns:value}})).filter((_ref3=>{let{name}=_ref3;return name.toLowerCase().includes(searchTerm.toLowerCase())})).sort(((a,b)=>a.name.localeCompare(b.name))):[]],tableOptions:[s=>[s.filteredTables],filteredTables=>filteredTables.map((row=>({value:row.name,label:row.name})))]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref4=>{let{actions}=_ref4;return actions.loadDatabase()}))])},"./frontend/src/scenes/data-warehouse/external/dataWarehouseSceneLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M:()=>dataWarehouseSceneLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/types.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/userLogic.ts");const dataWarehouseSceneLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","warehouse","dataWarehouseSceneLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)((()=>({values:[scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}))),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({toggleSourceModal:isOpen=>({isOpen})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({isSourceModalOpen:[!1,{toggleSourceModal:(state,_ref)=>{let{isOpen}=_ref;return null!=isOpen?isOpen:!state}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({dataWarehouse:[null,{loadDataWarehouse:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.dataWarehouseTables.list()}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({tables:[s=>[s.dataWarehouse],warehouse=>warehouse?warehouse.results.map((table=>({id:table.id,name:table.name,columns:table.columns,url_pattern:table.url_pattern,format:table.format}))):[]],shouldShowEmptyState:[s=>[s.tables,s.dataWarehouseLoading],(tables,dataWarehouseLoading)=>0==tables?.length&&!dataWarehouseLoading],shouldShowProductIntroduction:[s=>[s.user],user=>!user?.has_seen_product_intro_for?.[_types__WEBPACK_IMPORTED_MODULE_3__.Md.DATA_WAREHOUSE]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref2=>{let{actions}=_ref2;actions.loadDataWarehouse()}))])},"./frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>DatawarehouseTableForm});var _dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/scenes/data-warehouse/new_table/dataWarehouseTableLogic.tsx"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_forms_Field__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DatawarehouseTableForm(_ref){let{footer}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(kea_forms__WEBPACK_IMPORTED_MODULE_1__.Form,{formKey:"table",logic:_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_0__.U,className:"space-y-4",enableFormOnSubmit:!0,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"flex flex-col gap-2 max-w-160",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_3__.g,{name:"name",label:"Table Name",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.LemonInput,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"Examples: stripe_invoice, hubspot_contacts, users",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"text-muted text-xs mb-4",children:"This will be the table name used when writing queries"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_3__.g,{name:"url_pattern",label:"Files URL pattern",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.LemonInput,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: https://your-org.s3.amazonaws.com/airbyte/stripe/invoices/*.pqt",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"text-muted text-xs mb-4",children:["You can use ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("strong",{children:"*"})," to select multiple files."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_3__.g,{name:"format",label:"File format",className:"w-max",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.LemonSelect,{"data-attr":"table-format",options:[{label:"Parquet (recommended)",value:"Parquet"},{label:"CSV",value:"CSV"},{label:"JSON",value:"JSONEachRow"}]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_3__.g,{name:["credential","access_key"],label:"Access Key",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.LemonInput,{"data-attr":"access-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: AKIAIOSFODNN7EXAMPLE",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_3__.g,{name:["credential","access_secret"],label:"Access Secret",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.LemonInput,{"data-attr":"access-secret",className:"ph-ignore-input",autoFocus:!0,type:"password",placeholder:"eg: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})]}),footer]})}try{DatawarehouseTableForm.displayName="DatawarehouseTableForm",DatawarehouseTableForm.__docgenInfo={description:"",displayName:"DatawarehouseTableForm",props:{footer:{defaultValue:null,description:"",name:"footer",required:!1,type:{name:"Element"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx#DatawarehouseTableForm"]={docgenInfo:DatawarehouseTableForm.__docgenInfo,name:"DatawarehouseTableForm",path:"frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx#DatawarehouseTableForm"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DataWarehouseTable:()=>DataWarehouseTable,scene:()=>scene});var _dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/scenes/data-warehouse/new_table/dataWarehouseTableLogic.tsx"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),kea__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/urls.ts"),_DataWarehouseTableForm__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const scene={component:DataWarehouseTable,logic:_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_0__.U};function DataWarehouseTable(){const{isEditingTable,tableLoading,table}=(0,kea__WEBPACK_IMPORTED_MODULE_3__.useValues)(_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_0__.U),{editingTable,loadTable,createTable}=(0,kea__WEBPACK_IMPORTED_MODULE_3__.useActions)(_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_0__.U);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_2__.m,{title:"New table",buttons:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{className:"flex items-center gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonButton,{"data-attr":"cancel-table",type:"secondary",loading:tableLoading,onClick:()=>{isEditingTable?(editingTable(!1),loadTable()):kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.dataWarehouse())},children:"Cancel"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonButton,{type:"primary","data-attr":"save-data-warehouse-table",onClick:()=>{createTable(table)},loading:tableLoading,children:"Save"})]}),caption:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{children:["External tables are supported through object storage systems like S3."," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Link,{to:"https://posthog.com/docs/data/data-warehouse#step-1-creating-a-bucket-in-s3",target:"_blank",children:"Learn how to set up your data"})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_DataWarehouseTableForm__WEBPACK_IMPORTED_MODULE_6__.V,{})]})}},"./frontend/src/scenes/data-warehouse/new_table/dataWarehouseTableLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>dataWarehouseTableLogic});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/urls.ts"),scenes_data_management_database_databaseSceneLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/data-management/database/databaseSceneLogic.ts"),_external_dataWarehouseSceneLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/data-warehouse/external/dataWarehouseSceneLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const NEW_WAREHOUSE_TABLE={id:"",name:"",url_pattern:"",format:"Parquet",credential:{access_key:"",access_secret:""},columns:[]},dataWarehouseTableLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","data-warehouse","tableLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)((()=>({actions:[scenes_data_management_database_databaseSceneLogic__WEBPACK_IMPORTED_MODULE_7__.Y,["loadDatabase"],_external_dataWarehouseSceneLogic__WEBPACK_IMPORTED_MODULE_8__.M,["loadDataWarehouse","toggleSourceModal"]]}))),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({editingTable:editing=>({editing}),updateTargetingFlagFilters:(index,properties)=>({index,properties}),addConditionSet:!0,removeConditionSet:index=>({index}),launchTable:!0,stopTable:!0,archiveTable:!0,setDataTableQuery:query=>({query})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_3__.loaders)((_ref=>{let{props}=_ref;return{table:{loadTable:async()=>props.id&&"new"!==props.id?await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.get(props.id):{...NEW_WAREHOUSE_TABLE},createTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.create({...tablePayload}),updateTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.update(props.id,tablePayload)}}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)((_ref2=>{let{actions}=_ref2;return{createTableSuccess:async _ref3=>{let{table}=_ref3;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:["Table ",table.name," created"]})),actions.loadDatabase(),actions.loadDataWarehouse(),actions.toggleSourceModal(!1),kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.dataWarehouse())},updateTableSuccess:async _ref4=>{let{table}=_ref4;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:["Table ",table.name," updated"]})),actions.editingTable(!1),kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.dataWarehouse())}}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)({isEditingTable:[!1,{editingTable:(_,_ref5)=>{let{editing}=_ref5;return editing}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref6)=>{let{query}=_ref6;return query}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.selectors)({breadcrumbs:[()=>[],()=>[{name:"Data Warehouse",path:scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.dataWarehouseExternal()},{name:"New"}]]}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_2__.forms)((_ref7=>{let{actions,props}=_ref7;return{table:{defaults:{...NEW_WAREHOUSE_TABLE},errors:_ref8=>{let{name,url_pattern,credential,format}=_ref8;return{name:!name&&"Please enter a name.",url_pattern:!url_pattern&&"Please enter a url pattern.",credential:{access_secret:!credential.access_secret&&"Please enter an access secret.",access_key:!credential.access_key&&"Please enter an access key."},format:!format&&"Please enter the format of your files."}},submit:async tablePayload=>{props.id&&"new"!==props.id?actions.updateTable(tablePayload):actions.createTable(tablePayload)}}}}))])}}]);