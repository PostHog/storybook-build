(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{5722:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return personsLogic}));__webpack_require__(40),__webpack_require__(62),__webpack_require__(143),__webpack_require__(95),__webpack_require__(297),__webpack_require__(43),__webpack_require__(200),__webpack_require__(268),__webpack_require__(244),__webpack_require__(2615),__webpack_require__(110),__webpack_require__(37),__webpack_require__(115),__webpack_require__(46);var _babel_runtime_helpers_objectDestructuringEmpty__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(99),_babel_runtime_helpers_objectDestructuringEmpty__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_babel_runtime_helpers_objectDestructuringEmpty__WEBPACK_IMPORTED_MODULE_14__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(6),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15__),_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(90),_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18__=(__webpack_require__(66),__webpack_require__(13)),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18__),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(5),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19__),kea__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(2),kea_router__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(21),lib_api__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(20),react_toastify__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(58),_types__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(8),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(41),scenes_urls__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(32),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(64),lib_constants__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(19),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(27);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19___default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var FILTER_ALLOWLIST=["is_identified","search","cohort"],personsLogic=Object(kea__WEBPACK_IMPORTED_MODULE_20__.kea)({connect:{actions:[lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_25__.e,["reportPersonDetailViewed"]],values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_27__.a,["featureFlags"],scenes_teamLogic__WEBPACK_IMPORTED_MODULE_29__.a,["currentTeam"]]},actions:{setListFilters:function setListFilters(payload){return{payload:payload}},editProperty:function editProperty(key,newValue){return{key:key,newValue:newValue}},setHasNewKeys:!0,navigateToCohort:function navigateToCohort(cohort){return{cohort:cohort}},navigateToTab:function navigateToTab(tab){return{tab:tab}},setSplitMergeModalShown:function setSplitMergeModalShown(shown){return{shown:shown}}},reducers:{listFilters:[{},{setListFilters:function setListFilters(state,_ref){var payload=_ref.payload;return _objectSpread(_objectSpread({},state),payload)}}],hasNewKeys:[!1,{setHasNewKeys:function setHasNewKeys(){return!0}}],activeTab:[null,{navigateToTab:function navigateToTab(_,_ref2){return _ref2.tab}}],splitMergeModalShown:[!1,{setSplitMergeModalShown:function setSplitMergeModalShown(_,_ref3){return _ref3.shown}}]},selectors:{exampleEmail:[function(s){return[s.persons]},function(persons){var _match$properties,match=persons&&persons.results.find((function(person){var _person$properties;return null===(_person$properties=person.properties)||void 0===_person$properties?void 0:_person$properties.email}));return(null==match||null===(_match$properties=match.properties)||void 0===_match$properties?void 0:_match$properties.email)||"example@gmail.com"}],showSessionRecordings:[function(s){return[s.featureFlags,s.currentTeam]},function(featureFlags,currentTeam){return!!featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_28__.o.REMOVE_SESSIONS]&&(null==currentTeam?void 0:currentTeam.session_recording_opt_in)}],showTabs:[function(s){return[s.featureFlags,s.showSessionRecordings]},function(featureFlags,showSessionRecordings){return!featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_28__.o.REMOVE_SESSIONS]||showSessionRecordings}],currentTab:[function(s){return[s.activeTab,s.showSessionRecordings,s.featureFlags]},function(activeTab,showSessionRecordings,featureFlags){return!activeTab||activeTab===_types__WEBPACK_IMPORTED_MODULE_24__.q.SESSIONS&&featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_28__.o.REMOVE_SESSIONS]?showSessionRecordings?_types__WEBPACK_IMPORTED_MODULE_24__.q.SESSION_RECORDINGS:_types__WEBPACK_IMPORTED_MODULE_24__.q.EVENTS:activeTab!==_types__WEBPACK_IMPORTED_MODULE_24__.q.SESSION_RECORDINGS||showSessionRecordings?activeTab:featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_28__.o.REMOVE_SESSIONS]?_types__WEBPACK_IMPORTED_MODULE_24__.q.EVENTS:_types__WEBPACK_IMPORTED_MODULE_24__.q.SESSIONS}]},listeners:function listeners(_ref4){var _editProperty,actions=_ref4.actions,values=_ref4.values;return{deletePersonSuccess:function deletePersonSuccess(){Object(react_toastify__WEBPACK_IMPORTED_MODULE_23__.c)("Person deleted successfully"),actions.loadPersons(),kea_router__WEBPACK_IMPORTED_MODULE_21__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_26__.a.persons())},editProperty:(_editProperty=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee(_ref5){var key,newValue,person,parsedValue,action,oldPropertyType,newPropertyType,attemptedParsedNumber,lowercaseValue,response;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(key=_ref5.key,newValue=_ref5.newValue,!(person=values.person)){_context.next=17;break}return parsedValue=newValue,oldPropertyType=null===person.properties[key]?"null":_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16___default()(person.properties[key]),newPropertyType=_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16___default()(newValue),attemptedParsedNumber=Number(newValue),Number.isNaN(attemptedParsedNumber)||"boolean"==typeof newValue||(parsedValue=attemptedParsedNumber,newPropertyType="number"),"true"!==(lowercaseValue="string"==typeof parsedValue&&parsedValue.toLowerCase())&&"false"!==lowercaseValue&&"null"!==lowercaseValue||(newPropertyType=null!==(parsedValue="true"===lowercaseValue||"null"===lowercaseValue&&null)?"boolean":"null"),Object.keys(person.properties).includes(key)?(person.properties[key]=parsedValue,action=void 0!==parsedValue?"updated":"removed"):(actions.setHasNewKeys(),person.properties=_objectSpread(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19___default()({},key,parsedValue),person.properties),action="added"),actions.setPerson(person),_context.next=14,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.update("api/person/".concat(person.id),person);case 14:response=_context.sent,actions.setPerson(response),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_25__.e.actions.reportPersonPropertyUpdated(action,Object.keys(person.properties).length,oldPropertyType,newPropertyType);case 17:case"end":return _context.stop()}}),_callee)}))),function editProperty(_x){return _editProperty.apply(this,arguments)}),navigateToCohort:function navigateToCohort(_ref6){var cohort=_ref6.cohort;kea_router__WEBPACK_IMPORTED_MODULE_21__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_26__.a.cohort(cohort.id))}}},loaders:function loaders(_ref7){var _deletePerson,_loadCohorts,_loadPerson,_loadPersons,values=_ref7.values,actions=_ref7.actions;return{persons:[{next:null,previous:null,results:[]},{loadPersons:(_loadPersons=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee2(){var url,qs,_args2=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return(url=_args2.length>0&&void 0!==_args2[0]?_args2[0]:"")||(qs=Object.keys(values.listFilters).filter((function(key){var _url;return"is_identified"!==key?FILTER_ALLOWLIST.includes(key):!(null===(_url=url)||void 0===_url?void 0:_url.includes("is_identified"))})).reduce((function(result,key){var value=values.listFilters[key];return null!=value&&result.push("".concat(key,"=").concat(encodeURIComponent(value))),result}),[]),url="api/person/".concat(qs.length?"?"+qs.join("&"):"")),_context2.next=4,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.get(url);case 4:return _context2.abrupt("return",_context2.sent);case 5:case"end":return _context2.stop()}}),_callee2)}))),function loadPersons(){return _loadPersons.apply(this,arguments)})}],person:[null,{loadPerson:(_loadPerson=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee3(id){var response,person;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.get("api/person/?distinct_id=".concat(id));case 2:return(response=_context3.sent).results.length||kea_router__WEBPACK_IMPORTED_MODULE_21__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_26__.a.notFound()),(person=response.results[0])&&actions.reportPersonDetailViewed(person),_context3.abrupt("return",person);case 7:case"end":return _context3.stop()}}),_callee3)}))),function loadPerson(_x2){return _loadPerson.apply(this,arguments)}),setPerson:function setPerson(person){return person}}],cohorts:[null,{loadCohorts:(_loadCohorts=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee4(){var _values$person,response;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.get("api/person/cohorts/?person_id=".concat(null===(_values$person=values.person)||void 0===_values$person?void 0:_values$person.id));case 2:return response=_context4.sent,_context4.abrupt("return",response.results);case 4:case"end":return _context4.stop()}}),_callee4)}))),function loadCohorts(){return _loadCohorts.apply(this,arguments)})}],deletedPerson:[!1,{deletePerson:(_deletePerson=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee5(){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(values.person){_context5.next=2;break}return _context5.abrupt("return",!1);case 2:return _context5.next=4,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.delete("api/person/".concat(values.person.id));case 4:return _context5.abrupt("return",!0);case 5:case"end":return _context5.stop()}}),_callee5)}))),function deletePerson(){return _deletePerson.apply(this,arguments)})}]}},actionToUrl:function actionToUrl(_ref8){var values=_ref8.values,props=_ref8.props;return{setListFilters:function setListFilters(){if(props.updateURL&&kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.location.pathname.indexOf("/persons")>-1)return["/persons",values.listFilters,void 0,{replace:!0}]},navigateToTab:function navigateToTab(){if(kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.location.pathname.indexOf("/person")>-1)return[kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.location.pathname,kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.searchParams,_objectSpread(_objectSpread({},kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.hashParams),{},{activeTab:values.activeTab})]}}},urlToAction:function urlToAction(_ref9){var actions=_ref9.actions,values=_ref9.values;return{"/persons":function persons(_ref10,searchParams){_babel_runtime_helpers_objectDestructuringEmpty__WEBPACK_IMPORTED_MODULE_14___default()(_ref10),actions.setListFilters(searchParams),values.persons.results.length||values.personsLoading||actions.loadPersons()},"/person/*":function person(_ref11,_ref12,_ref13){var _person=_ref11._,sessionRecordingId=_ref12.sessionRecordingId,activeTab=_ref13.activeTab;sessionRecordingId?values.showSessionRecordings?actions.navigateToTab(_types__WEBPACK_IMPORTED_MODULE_24__.q.SESSION_RECORDINGS):actions.navigateToTab(_types__WEBPACK_IMPORTED_MODULE_24__.q.SESSIONS):activeTab&&values.activeTab!==activeTab&&actions.navigateToTab(activeTab),_person&&actions.loadPerson(_person)}}},path:function path(){return["scenes","persons","personsLogic"]}})},5786:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Persons",(function(){return Persons}));__webpack_require__(37),__webpack_require__(117);var react=__webpack_require__(0),react_default=__webpack_require__.n(react),index_esm=__webpack_require__(2),PersonsTable=__webpack_require__(1821),row=__webpack_require__(354),es_radio=__webpack_require__(1161),es_alert=__webpack_require__(705),es_button=__webpack_require__(109),ExportOutlined=__webpack_require__(5692),PlusOutlined=__webpack_require__(1788),PageHeader=__webpack_require__(322),personsLogic=__webpack_require__(5722),Link=__webpack_require__(60),LinkButton=__webpack_require__(285),ClockCircleFilled=__webpack_require__(5645),utils=__webpack_require__(12),slicedToArray=(__webpack_require__(86),__webpack_require__(296),__webpack_require__(15)),slicedToArray_default=__webpack_require__.n(slicedToArray),input=__webpack_require__(704),PersonsSearch_PersonsSearch=function PersonsSearch(_ref){var _ref$autoFocus=_ref.autoFocus,autoFocus=void 0===_ref$autoFocus||_ref$autoFocus,_useActions=Object(index_esm.useActions)(personsLogic.a),loadPersons=_useActions.loadPersons,setListFilters=_useActions.setListFilters,_useValues=Object(index_esm.useValues)(personsLogic.a),exampleEmail=_useValues.exampleEmail,listFilters=_useValues.listFilters,_useState=Object(react.useState)(""),_useState2=slicedToArray_default()(_useState,2),searchTerm=_useState2[0],setSearchTerm=_useState2[1];return Object(react.useEffect)((function(){setSearchTerm(listFilters.search)}),[]),react_default.a.createElement(input.a.Search,{"data-attr":"persons-search",placeholder:"search person by email, name or ID (e.g. ".concat(exampleEmail,")"),autoFocus:autoFocus,value:searchTerm,onChange:function onChange(e){setSearchTerm(e.target.value),e.target.value||(setListFilters({search:void 0}),loadPersons())},enterButton:!0,allowClear:!0,onSearch:function onSearch(){setListFilters({search:searchTerm||void 0}),loadPersons()},style:{width:"100%"}})};try{PersonsSearch_PersonsSearch.displayName="PersonsSearch",PersonsSearch_PersonsSearch.__docgenInfo={description:"",displayName:"PersonsSearch",props:{autoFocus:{defaultValue:{value:"true"},description:"",name:"autoFocus",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"]={docgenInfo:PersonsSearch_PersonsSearch.__docgenInfo,name:"PersonsSearch",path:"frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"})}catch(__react_docgen_typescript_loader_error){}var icons=__webpack_require__(70),scene={component:Persons,logic:personsLogic.a};function Persons(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},cohort=_ref.cohort,_useActions=Object(index_esm.useActions)(personsLogic.a),loadPersons=_useActions.loadPersons,setListFilters=_useActions.setListFilters,_useValues=Object(index_esm.useValues)(personsLogic.a),persons=_useValues.persons,listFilters=_useValues.listFilters,personsLoading=_useValues.personsLoading;return Object(react.useEffect)((function(){cohort&&(setListFilters({cohort:cohort.id}),loadPersons())}),[]),react_default.a.createElement("div",{className:"persons-list"},!cohort&&react_default.a.createElement(PageHeader.a,{title:"Persons"}),react_default.a.createElement(row.a,{style:{gap:"0.75rem"},className:"mb"},react_default.a.createElement("div",{style:{flexGrow:1,maxWidth:600}},react_default.a.createElement(PersonsSearch_PersonsSearch,{autoFocus:!cohort}),react_default.a.createElement("div",{className:"text-muted text-small"},"You can also filter persons that have a certain property set (e.g. ",react_default.a.createElement("code",null,"has:email")," or"," ",react_default.a.createElement("code",null,"has:name"),")")),react_default.a.createElement("div",null,react_default.a.createElement(es_radio.a.Group,{buttonStyle:"solid",onChange:function onChange(e){var key=e.target.value;setListFilters({is_identified:"all"===key?void 0:key}),loadPersons()},value:void 0!==listFilters.is_identified?listFilters.is_identified.toString():"all"},react_default.a.createElement(es_radio.a.Button,{"data-attr":"people-types-tab-all",value:"all"},"All persons"),react_default.a.createElement(es_radio.a.Button,{"data-attr":"people-types-tab-identified",value:"true"},"Identified"),react_default.a.createElement(es_radio.a.Button,{"data-attr":"people-types-tab-anonymous",value:"false"},"Unidentified")))),"false"===listFilters.is_identified&&react_default.a.createElement("div",{className:"mb"},react_default.a.createElement(es_alert.a,{type:"info",closable:!0,message:react_default.a.createElement(react_default.a.Fragment,null,"Unidentified persons are usually anonymous visitors to your app or website that have not been identified to you. To mark a person as identified, call"," ",react_default.a.createElement("code",null,"posthog.identify")," on your frontend."," ",react_default.a.createElement("a",{href:"https://posthog.com/docs/integrations/js-integration?utm_medium=in-product&utm_campaign=persons-unidentified#identifying-users",target:"_blank",style:{display:"inline-flex",alignItems:"center"}},react_default.a.createElement(icons.IconExternalLink,null)," Learn more")),showIcon:!0})),react_default.a.createElement("div",{className:"mb text-right"},cohort?react_default.a.createElement(LinkButton.a,{to:"/sessions?".concat(Object(utils.nb)({properties:[{key:"id",value:cohort.id,type:"cohort"}]})),target:"_blank"},react_default.a.createElement(ClockCircleFilled.a,null)," View sessions"):null,react_default.a.createElement(es_button.a,{type:"default",icon:react_default.a.createElement(ExportOutlined.a,null),href:"/api/person.csv"+(listFilters.cohort?"?cohort="+listFilters.cohort:""),style:{marginLeft:8}},"Export"),react_default.a.createElement(Link.a,{to:"/cohorts/new",style:{display:"none"},className:"ml"},react_default.a.createElement(es_button.a,{type:"default",icon:react_default.a.createElement(PlusOutlined.a,null)},"New Cohort"))),react_default.a.createElement("div",null,react_default.a.createElement(PersonsTable.a,{people:persons.results,loading:personsLoading,hasPrevious:!!persons.previous,hasNext:!!persons.next,loadPrevious:function loadPrevious(){return loadPersons(persons.previous)},loadNext:function loadNext(){return loadPersons(persons.next)},allColumns:!0,backTo:cohort?"Cohort":"Persons"})))}try{Persons.displayName="Persons",Persons.__docgenInfo={description:"",displayName:"Persons",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!1,type:{name:"CohortType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/Persons.tsx#Persons"]={docgenInfo:Persons.__docgenInfo,name:"Persons",path:"frontend/src/scenes/persons/Persons.tsx#Persons"})}catch(__react_docgen_typescript_loader_error){}}}]);