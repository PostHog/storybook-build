(window.webpackJsonp=window.webpackJsonp||[]).push([[286],{"./frontend/src/scenes/batch_exports/BatchExportScene.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"BatchExportScene",(function(){return BatchExportScene}));var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),batchExportLogic=__webpack_require__("./frontend/src/scenes/batch_exports/batchExportLogic.ts"),components=__webpack_require__("./frontend/src/scenes/batch_exports/components.tsx"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),LemonCalendarSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCalendar/LemonCalendarSelect.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function BatchExportBackfillModal(){const{batchExportConfig:batchExportConfig,isBackfillModalOpen:isBackfillModalOpen,isBackfillFormSubmitting:isBackfillFormSubmitting}=Object(index_esm.useValues)(batchExportLogic.a),{closeBackfillModal:closeBackfillModal}=Object(index_esm.useActions)(batchExportLogic.a);return Object(jsx_runtime.jsxs)(LemonModal.a,{title:"Create historic export",onClose:closeBackfillModal,isOpen:isBackfillModalOpen,width:"30rem",footer:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LemonButton.a,{type:"secondary","data-attr":"batch-export-backfill-cancel",disabledReason:isBackfillFormSubmitting?"Please wait...":void 0,onClick:closeBackfillModal,children:"Cancel"}),Object(jsx_runtime.jsx)(LemonButton.a,{form:"batch-export-backfill-form",htmlType:"submit",type:"primary","data-attr":"batch-export-backfill-submit",loading:isBackfillFormSubmitting,children:"Schedule runs"})]}),children:[Object(jsx_runtime.jsxs)("p",{children:["Triggering a historic export will create multiple runs, one after another for the range specified below. The runs will export data in ",Object(jsx_runtime.jsx)("b",{children:null==batchExportConfig?void 0:batchExportConfig.interval})," intervals, from the start date until the end date is reached."]}),Object(jsx_runtime.jsxs)(lib.Form,{logic:batchExportLogic.a,formKey:"backfillForm",id:"batch-export-backfill-form",enableFormOnSubmit:!0,className:"space-y-2",children:[Object(jsx_runtime.jsx)(Field.a,{name:"start_at",label:"Start Date",className:"flex-1",children:_ref=>{let{value:value,onChange:onChange}=_ref;return Object(jsx_runtime.jsx)(LemonCalendarSelect.b,{value:value,onChange:onChange,placeholder:"Select start date"})}}),Object(jsx_runtime.jsx)(Field.a,{name:"end_at",label:"End date",className:"flex-1",children:_ref2=>{let{value:value,onChange:onChange}=_ref2;return Object(jsx_runtime.jsx)(LemonCalendarSelect.b,{value:value,onChange:onChange,placeholder:"Select end date (optional)"})}})]})]})}var apps_common_src=__webpack_require__("./frontend/@posthog/apps-common/src/index.ts"),Popover=__webpack_require__("./frontend/src/lib/lemon-ui/Popover/index.ts"),LemonCalendarRange=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCalendarRange/LemonCalendarRange.tsx"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),LemonMenu=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMenu/index.ts"),LemonDialog=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDialog/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip.tsx");const scene={component:BatchExportScene,logic:batchExportLogic.a,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{id:null!=id?id:"missing"}}};function BatchExportScene(){var _batchExportConfig$na;const{batchExportRunsResponse:batchExportRunsResponse,batchExportConfig:batchExportConfig,batchExportConfigLoading:batchExportConfigLoading,groupedRuns:groupedRuns,batchExportRunsResponseLoading:batchExportRunsResponseLoading,runsDateRange:runsDateRange}=Object(index_esm.useValues)(batchExportLogic.a),{loadBatchExportConfig:loadBatchExportConfig,loadBatchExportRuns:loadBatchExportRuns,loadNextBatchExportRuns:loadNextBatchExportRuns,openBackfillModal:openBackfillModal,setRunsDateRange:setRunsDateRange,retryRun:retryRun,pause:pause,unpause:unpause,archive:archive}=Object(index_esm.useActions)(batchExportLogic.a),[dateRangeVisible,setDateRangeVisible]=Object(react.useState)(!1);return Object(react.useEffect)((()=>{loadBatchExportConfig(),loadBatchExportRuns()}),[]),batchExportConfig||batchExportConfigLoading?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:Object(jsx_runtime.jsx)("span",{className:"flex items-center gap-2",children:null!==(_batchExportConfig$na=null==batchExportConfig?void 0:batchExportConfig.name)&&void 0!==_batchExportConfig$na?_batchExportConfig$na:batchExportConfigLoading?"Loading...":"Missing"}),buttons:batchExportConfig?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LemonMenu.a,{items:[{label:batchExportConfig.paused?"Unpause":"Pause",onClick:()=>{batchExportConfig.paused?unpause():pause()},disabledReason:batchExportConfigLoading?"Loading...":void 0},{label:"Archive",status:"danger",onClick:()=>LemonDialog.a.open({title:"Archive Batch Export?",description:"Are you sure you want to archive this Batch Export? This will stop all future runs",primaryButton:{children:"Archive",status:"danger",onClick:()=>archive()},secondaryButton:{children:"Cancel"}}),disabledReason:batchExportConfigLoading?"Loading...":void 0}],children:Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)(icons.Y,{}),status:"stealth",size:"small"})}),Object(jsx_runtime.jsx)(src.LemonDivider,{vertical:!0}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:()=>openBackfillModal(),children:"Create historic export"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",to:urls.a.batchExportEdit(null==batchExportConfig?void 0:batchExportConfig.id),children:"Edit"})]}):void 0}),Object(jsx_runtime.jsx)("div",{children:batchExportConfig?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(components.b,{batchExportConfig:batchExportConfig}),Object(jsx_runtime.jsx)(src.LemonTag,{children:Object(utils.i)((interval=batchExportConfig.interval,{day:"daily",hour:"hourly"}[interval]))}),Object(jsx_runtime.jsx)(src.LemonTag,{children:batchExportConfig.end_at?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsxs)("span",{className:"flex gap-1",children:["Ends ",Object(jsx_runtime.jsx)(apps_common_src.TZLabel,{time:batchExportConfig.end_at})]})}):"Indefinite"}),Object(jsx_runtime.jsx)(Tooltip.a,{title:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsxs)("ul",{className:"mb-4",children:[Object(jsx_runtime.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[Object(jsx_runtime.jsx)("span",{children:"Destination:"}),Object(jsx_runtime.jsx)("span",{className:"font-semibold",children:batchExportConfig.destination.type})]}),Object.keys(batchExportConfig.destination.config).map((x=>Object(jsx_runtime.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[Object(jsx_runtime.jsxs)("span",{children:[Object(utils.U)(x),":"]}),Object(jsx_runtime.jsx)("span",{className:"font-semibold",children:batchExportConfig.destination.config[x]})]},x)))]})}),children:Object(jsx_runtime.jsx)(src.LemonTag,{children:(destination=batchExportConfig.destination,"S3"===destination.type?`s3://${destination.config.bucket_name}/${destination.config.prefix}`:"Snowflake"===destination.type?`snowflake:${destination.config.account}:${destination.config.database}:${destination.config.table_name}`:"Unknown")})})]})}):Object(jsx_runtime.jsx)(LemonSkeleton.a,{className:"w-10"})}),batchExportConfig?Object(jsx_runtime.jsx)("div",{className:"flex items-start mt-4 gap-8 flex-wrap",children:Object(jsx_runtime.jsxs)("div",{className:"flex-1 space-y-2",children:[Object(jsx_runtime.jsxs)("div",{className:"flex justify-between items-start",children:[Object(jsx_runtime.jsx)("h2",{className:"flex-1",children:"Latest Runs"}),Object(jsx_runtime.jsx)(Popover.a,{actionable:!0,onClickOutside:function noRefCheck(){setDateRangeVisible(!1)},visible:dateRangeVisible,overlay:Object(jsx_runtime.jsx)(LemonCalendarRange.a,{value:[runsDateRange.from,runsDateRange.to],onChange:_ref2=>{let[start,end]=_ref2;setRunsDateRange({from:start.startOf("day"),to:end.endOf("day")}),setDateRangeVisible(!1)},onClose:function noRefCheck(){setDateRangeVisible(!1)}}),children:Object(jsx_runtime.jsxs)(src.LemonButton,{onClick:function onClick(){setDateRangeVisible(!dateRangeVisible)},type:"secondary",status:"stealth",size:"small",children:[runsDateRange.from.format("MMMM D, YYYY")," -"," ",runsDateRange.to.format("MMMM D, YYYY")]})})]}),Object(jsx_runtime.jsx)(src.LemonTable,{dataSource:groupedRuns,loading:batchExportRunsResponseLoading,loadingSkeletonRows:5,footer:(null==batchExportRunsResponse?void 0:batchExportRunsResponse.next)&&Object(jsx_runtime.jsx)("div",{className:"flex items-center m-2",children:Object(jsx_runtime.jsx)(src.LemonButton,{center:!0,fullWidth:!0,onClick:loadNextBatchExportRuns,loading:batchExportRunsResponseLoading,children:"Load more button in the footer!"})}),expandable:{noIndent:!0,expandedRowRender:groupedRuns=>Object(jsx_runtime.jsx)(src.LemonTable,{dataSource:groupedRuns.runs,embedded:!0,size:"small",columns:[{title:"Status",key:"status",width:0,render:(_,run)=>Object(jsx_runtime.jsx)(components.a,{runs:[run],showLabel:!0})},{title:"ID",key:"runId",render:(_,run)=>run.id},{title:"Run start",key:"runStart",tooltip:"Date and time when this BatchExport run started",render:(_,run)=>Object(jsx_runtime.jsx)(apps_common_src.TZLabel,{time:run.created_at})}]})},columns:[{key:"icon",width:0,render:(_,groupedRun)=>Object(jsx_runtime.jsx)(components.a,{runs:groupedRun.runs})},{title:"Data interval start",key:"dataIntervalStart",tooltip:"Start of the time range to export",render:(_,run)=>Object(jsx_runtime.jsx)(apps_common_src.TZLabel,{time:run.data_interval_start,formatDate:"MMMM DD, YYYY",formatTime:"HH:mm:ss"})},{title:"Data interval end",key:"dataIntervalEnd",tooltip:"End of the time range to export",render:(_,run)=>Object(jsx_runtime.jsx)(apps_common_src.TZLabel,{time:run.data_interval_end,formatDate:"MMMM DD, YYYY",formatTime:"HH:mm:ss"})},{title:"Latest run start",key:"runStart",tooltip:"Date and time when this BatchExport run started",render:(_,groupedRun)=>Object(jsx_runtime.jsx)(apps_common_src.TZLabel,{time:groupedRun.last_run_at})},{key:"actions",width:0,render:function RenderName(_,groupedRun){return Object(jsx_runtime.jsx)("span",{className:"flex items-center gap-1",children:(run=groupedRun.runs[0],!["Running","Starting"].includes(run.status)&&Object(jsx_runtime.jsx)(src.LemonButton,{size:"small",type:"secondary",icon:Object(jsx_runtime.jsx)(icons.Cc,{}),onClick:()=>LemonDialog.a.open({title:"Retry export?",description:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("p",{children:"This will schedule a new run for the same interval. Any changes to the configuration will be applied to the new run."}),Object(jsx_runtime.jsxs)("p",{children:[Object(jsx_runtime.jsx)("b",{children:"Please note -"})," there may be a slight delay before the new run appears."]})]}),width:"20rem",primaryButton:{children:"Retry",onClick:()=>retryRun(groupedRun.runs[0])},secondaryButton:{children:"Cancel"}})}))});var run}}],emptyState:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["No runs yet. Your exporter runs every ",Object(jsx_runtime.jsx)("b",{children:batchExportConfig.interval}),".",Object(jsx_runtime.jsx)("br",{}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>openBackfillModal(),children:"Create historic export"})]})})]})}):null,Object(jsx_runtime.jsx)(BatchExportBackfillModal,{})]}):Object(jsx_runtime.jsx)(NotFound.a,{object:"Batch Export"});var destination,interval}},"./frontend/src/scenes/batch_exports/batchExportLogic.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return batchExportLogic}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea_forms__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_dayjs__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/dayjs.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/urls.ts"),kea_router__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js");const mergeRuns=(oldRuns,newRuns)=>{const runs=[...oldRuns];return newRuns.forEach((rawRun=>{const newRun=(run=rawRun,{...run,data_interval_start:Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_5__.a)(run.data_interval_start),data_interval_end:Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_5__.a)(run.data_interval_end),created_at:Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_5__.a)(run.created_at),last_updated_at:run.last_updated_at?Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_5__.a)(run.last_updated_at):void 0});var run;const index=runs.findIndex((run=>run.id===newRun.id));index>-1?runs[index]=newRun:runs.push(newRun)})),runs},batchExportLogic=Object(kea__WEBPACK_IMPORTED_MODULE_0__.kea)([Object(kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.key)((_ref=>{let{id:id}=_ref;return id})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.path)((key=>["scenes","batch_exports","batchExportLogic",key])),Object(kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadBatchExportRuns:!0,loadNextBatchExportRuns:!0,openBackfillModal:!0,closeBackfillModal:!0,retryRun:run=>({run:run}),setRunsDateRange:data=>data}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({runsDateRange:[{from:Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_5__.a)().subtract(7,"day").startOf("day"),to:Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_5__.a)().endOf("day")},{setRunsDateRange:(_,_ref2)=>{let{from:from,to:to}=_ref2;return{from:from,to:to}}}],isBackfillModalOpen:[!1,{openBackfillModal:()=>!0,closeBackfillModal:()=>!1}]}),Object(kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)((_ref3=>{let{props:props,values:values}=_ref3;return{batchExportConfig:[null,{loadBatchExportConfig:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.batchExports.get(props.id),pause:async()=>values.batchExportConfig?(await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.batchExports.pause(props.id),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.lemonToast.success("Batch export paused. No future runs will be scheduled"),{...values.batchExportConfig,paused:!0}):null,unpause:async()=>values.batchExportConfig?(await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.batchExports.unpause(props.id),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.lemonToast.success("Batch export unpaused. Future runs will be scheduled"),{...values.batchExportConfig,paused:!1}):null,archive:async()=>values.batchExportConfig?(await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.batchExports.delete(props.id),kea_router__WEBPACK_IMPORTED_MODULE_7__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_6__.a.batchExports()),null):null}],batchExportRunsResponse:[null,{loadBatchExportRuns:async()=>{var _values$batchExportRu,_values$batchExportRu2;const res=await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.batchExports.listRuns(props.id,{after:values.runsDateRange.from,before:values.runsDateRange.to.add(1,"day")});return res.results=mergeRuns(null!==(_values$batchExportRu=null===(_values$batchExportRu2=values.batchExportRunsResponse)||void 0===_values$batchExportRu2?void 0:_values$batchExportRu2.results)&&void 0!==_values$batchExportRu?_values$batchExportRu:[],res.results),res},loadNextBatchExportRuns:async()=>{var _values$batchExportRu3,_values$batchExportRu4,_values$batchExportRu5;const nextUrl=null===(_values$batchExportRu3=values.batchExportRunsResponse)||void 0===_values$batchExportRu3?void 0:_values$batchExportRu3.next;if(!nextUrl)return values.batchExportRunsResponse;const res=await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.get(nextUrl);return res.results=mergeRuns(null!==(_values$batchExportRu4=null===(_values$batchExportRu5=values.batchExportRunsResponse)||void 0===_values$batchExportRu5?void 0:_values$batchExportRu5.results)&&void 0!==_values$batchExportRu4?_values$batchExportRu4:[],res.results),res}}]}})),Object(kea_forms__WEBPACK_IMPORTED_MODULE_4__.forms)((_ref4=>{let{props:props,actions:actions}=_ref4;return{backfillForm:{defaults:{end_at:Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_5__.a)()},errors:_ref5=>{let{start_at:start_at,end_at:end_at}=_ref5;return{start_at:start_at?void 0:"Start date is required",end_at:end_at?void 0:"End date is required"}},submit:async _ref6=>{var _start_at$toISOString,_end_at$toISOString;let{start_at:start_at,end_at:end_at}=_ref6;await new Promise((resolve=>setTimeout(resolve,1e3))),await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.batchExports.createBackfill(props.id,{start_at:null!==(_start_at$toISOString=null==start_at?void 0:start_at.toISOString())&&void 0!==_start_at$toISOString?_start_at$toISOString:null,end_at:null!==(_end_at$toISOString=null==end_at?void 0:end_at.toISOString())&&void 0!==_end_at$toISOString?_end_at$toISOString:null}).catch((e=>{var _e$attr;e.detail?actions.setBackfillFormManualErrors({[null!==(_e$attr=e.attr)&&void 0!==_e$attr?_e$attr:"start_at"]:e.detail}):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.lemonToast.error("Unknown error occurred");throw e})),actions.closeBackfillModal(),actions.loadBatchExportRuns()}}}})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.selectors)((_ref7=>{let{}=_ref7;return{groupedRuns:[s=>[s.batchExportRuns],runs=>{const groupedRuns={};return runs.forEach((run=>{const key=`${run.data_interval_start}-${run.data_interval_end}`;groupedRuns[key]||(groupedRuns[key]={data_interval_start:run.data_interval_start,data_interval_end:run.data_interval_end,runs:[],last_run_at:run.created_at}),groupedRuns[key].runs.push(run),groupedRuns[key].runs.sort(((a,b)=>b.created_at.diff(a.created_at))),groupedRuns[key].last_run_at=groupedRuns[key].runs[0].created_at})),Object.values(groupedRuns).sort(((a,b)=>b.data_interval_end.diff(a.data_interval_end)))}],breadcrumbs:[s=>[s.batchExportConfig],config=>{var _config$name;return[{name:"Batch Exports",path:scenes_urls__WEBPACK_IMPORTED_MODULE_6__.a.batchExports()},{name:null!==(_config$name=null==config?void 0:config.name)&&void 0!==_config$name?_config$name:"Loading"}]}],batchExportRuns:[s=>[s.batchExportRunsResponse],batchExportRunsResponse=>{var _batchExportRunsRespo;return null!==(_batchExportRunsRespo=null==batchExportRunsResponse?void 0:batchExportRunsResponse.results)&&void 0!==_batchExportRunsRespo?_batchExportRunsRespo:[]}]}})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((_ref8=>{let{actions:actions,cache:cache,props:props}=_ref8;return{setRunsDateRange:()=>{actions.loadBatchExportRuns()},loadBatchExportRunsSuccess:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout((()=>{actions.loadBatchExportRuns()}),5e3)},retryRun:async _ref9=>{let{run:run}=_ref9;await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.batchExports.createBackfill(props.id,{start_at:run.data_interval_start.toISOString(),end_at:run.data_interval_end.toISOString()}),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.lemonToast.success("Retry has been scheduled."),clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout((()=>{actions.loadBatchExportRuns()}),2e3)}}})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.beforeUnmount)((_ref10=>{let{cache:cache}=_ref10;clearTimeout(cache.refreshTimeout)}))])},"./frontend/src/scenes/batch_exports/components.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return BatchExportTag})),__webpack_require__.d(__webpack_exports__,"a",(function(){return BatchExportRunIcon}));var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),BatchExports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/batch_exports/BatchExports.scss"),BatchExports_default=__webpack_require__.n(BatchExports),options={insert:"head",singleton:!1},jsx_runtime=(injectStylesIntoStyleTag_default()(BatchExports_default.a,options),BatchExports_default.a.locals,__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js"));function BatchExportTag(_ref){let{batchExportConfig:batchExportConfig}=_ref;return Object(jsx_runtime.jsx)(Tooltip.a,{title:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:batchExportConfig.paused?"This export is paused - no future export runs will be scheduled ":"This export is active - new runs will be triggered at the configured interval."}),children:Object(jsx_runtime.jsx)(src.LemonTag,{type:batchExportConfig.paused?"default":"primary",children:batchExportConfig.paused?"Paused":"Active"})})}const colorForStatus=status=>{switch(status){case"Completed":return"success";case"ContinuedAsNew":case"Running":case"Starting":return"primary";case"Cancelled":case"Terminated":case"TimedOut":return"warning";case"Failed":return"danger";default:return"default"}};function BatchExportRunIcon(_ref2){let{runs:runs,showLabel:showLabel=!1}=_ref2;const latestRun=runs[0],color=colorForStatus(latestRun.status);return Object(jsx_runtime.jsx)(Tooltip.a,{title:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Run status: ",latestRun.status,runs.length>1&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("br",{}),"Attempts: ",runs.length]})]}),children:Object(jsx_runtime.jsx)("span",{className:Object(clsx_m.default)(`h-6 p-2 border-2 flex items-center justify-center rounded-full font-semibold text-xs border-${color} text-${color}-dark select-none`,"primary"===color&&"BatchExportRunIcon--pulse",showLabel?"":"w-6"),children:showLabel?Object(jsx_runtime.jsx)("span",{className:"text-center",children:latestRun.status}):runs.length})})}try{BatchExportTag.displayName="BatchExportTag",BatchExportTag.__docgenInfo={description:"",displayName:"BatchExportTag",props:{batchExportConfig:{defaultValue:null,description:"",name:"batchExportConfig",required:!0,type:{name:"BatchExportConfiguration"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/batch_exports/components.tsx#BatchExportTag"]={docgenInfo:BatchExportTag.__docgenInfo,name:"BatchExportTag",path:"frontend/src/scenes/batch_exports/components.tsx#BatchExportTag"})}catch(__react_docgen_typescript_loader_error){}try{BatchExportRunIcon.displayName="BatchExportRunIcon",BatchExportRunIcon.__docgenInfo={description:"",displayName:"BatchExportRunIcon",props:{runs:{defaultValue:null,description:"",name:"runs",required:!0,type:{name:"BatchExportRun[]"}},showLabel:{defaultValue:{value:"false"},description:"",name:"showLabel",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/batch_exports/components.tsx#BatchExportRunIcon"]={docgenInfo:BatchExportRunIcon.__docgenInfo,name:"BatchExportRunIcon",path:"frontend/src/scenes/batch_exports/components.tsx#BatchExportRunIcon"})}catch(__react_docgen_typescript_loader_error){}try{colorForStatus.displayName="colorForStatus",colorForStatus.__docgenInfo={description:"",displayName:"colorForStatus",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/batch_exports/components.tsx#colorForStatus"]={docgenInfo:colorForStatus.__docgenInfo,name:"colorForStatus",path:"frontend/src/scenes/batch_exports/components.tsx#colorForStatus"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/batch_exports/BatchExports.scss":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,".BatchExportRunIcon--pulse{outline:2px solid transparent;outline-offset:0;animation:pulse 2s ease-out infinite}@keyframes pulse{0%{outline-offset:0;outline-color:var(--primary-light)}80%{outline-offset:20px;outline-color:transparent}to{outline-offset:20px;outline-color:transparent}}",""]),module.exports=exports}}]);