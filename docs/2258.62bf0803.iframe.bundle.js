(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[2258],{"./frontend/src/scenes/surveys/Survey.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SurveyComponent:function(){return SurveyComponent},SurveyForm:function(){return SurveyForm},SurveyReleaseSummary:function(){return SurveyReleaseSummary},scene:function(){return scene}});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),surveysLogic=__webpack_require__("./frontend/src/scenes/surveys/surveysLogic.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),pluginsLogic=__webpack_require__("./frontend/src/scenes/plugins/pluginsLogic.ts"),eventUsageLogic=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts"),featureFlagLogic=__webpack_require__("./frontend/src/scenes/feature-flags/featureFlagLogic.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const defaultSurveyAppearance={backgroundColor:"white",submitButtonColor:"#2C2C2C",textColor:"black",submitButtonText:"Submit",descriptionTextColor:"#4b4b52",whiteLabel:!1,displayThankYouMessage:!0,thankYouMessageHeader:"Thank you for your feedback!"},NEW_SURVEY={id:"new",name:"",description:"",questions:[{type:types.I9.Open,question:""}],type:types.d_.Popover,linked_flag_id:void 0,targeting_flag_filters:void 0,linked_flag:null,targeting_flag:null,start_date:null,end_date:null,conditions:null,archived:!1,appearance:defaultSurveyAppearance},getSurveyDataQuery=survey=>({kind:schema.O.DataTableNode,source:{kind:schema.O.EventsQuery,select:["*","properties.$survey_response","timestamp","person"],orderBy:["timestamp DESC"],where:[`event == 'survey sent' or event == '${survey.name} survey sent'`],after:survey.created_at,properties:[{type:types.FT.Event,key:"$survey_id",operator:types.WV.Exact,value:survey.id}]},propertiesViaUrl:!0,showExport:!0,showReload:!0,showEventFilter:!0,showPropertyFilter:!0}),getSurveyMetricsQueries=surveyId=>{const surveysShownHogqlQuery=`select count(distinct person.id) as 'survey shown' from events where event == 'survey shown' and properties.$survey_id == '${surveyId}'`,surveysDismissedHogqlQuery=`select count(distinct person.id) as 'survey dismissed' from events where event == 'survey dismissed' and properties.$survey_id == '${surveyId}'`;return{surveysShown:{kind:schema.O.DataTableNode,source:{kind:schema.O.HogQLQuery,query:surveysShownHogqlQuery}},surveysDismissed:{kind:schema.O.DataTableNode,source:{kind:schema.O.HogQLQuery,query:surveysDismissedHogqlQuery}}}},getSurveyDataVizQuery=survey=>({kind:schema.O.InsightVizNode,source:{kind:schema.O.TrendsQuery,dateRange:{date_from:(0,dayjs.Bv)(survey.created_at).format("YYYY-MM-DD"),date_to:(0,dayjs.Bv)().format("YYYY-MM-DD")},properties:[{type:types.FT.Event,key:"$survey_id",operator:types.WV.Exact,value:survey.id}],series:[{event:"survey sent",kind:schema.O.EventsNode}],trendsFilter:{display:types.Qb.ActionsBarValue},breakdown:{breakdown:"$survey_response",breakdown_type:"event"}},showTable:!0}),surveyLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","surveys","surveyLogic"]),(0,index_esm.props)({}),(0,index_esm.key)((_ref=>{let{id:id}=_ref;return id})),(0,index_esm.connect)((()=>({actions:[surveysLogic.k,["loadSurveys"],eventUsageLogic.vx,["reportSurveyCreated","reportSurveyLaunched","reportSurveyEdited","reportSurveyArchived","reportSurveyStopped","reportSurveyResumed","reportSurveyViewed"]],values:[pluginsLogic.C,["installedPlugins","loading as pluginsLoading","enabledPlugins"]]}))),(0,index_esm.actions)({editingSurvey:editing=>({editing:editing}),launchSurvey:!0,stopSurvey:!0,archiveSurvey:!0,resumeSurvey:!0,setDataTableQuery:query=>({query:query}),setSurveyMetricsQueries:surveyMetricsQueries=>({surveyMetricsQueries:surveyMetricsQueries}),setSurveyDataVizQuery:surveyDataVizQuery=>({surveyDataVizQuery:surveyDataVizQuery}),setHasTargetingFlag:hasTargetingFlag=>({hasTargetingFlag:hasTargetingFlag})}),(0,kea_loaders_lib.loaders)((_ref2=>{let{props:props,actions:actions}=_ref2;return{survey:{loadSurvey:async()=>{if(props.id&&"new"!==props.id){const survey=await api.ZP.surveys.get(props.id);return actions.reportSurveyViewed(survey),survey}return{...NEW_SURVEY}},createSurvey:async surveyPayload=>await api.ZP.surveys.create(surveyPayload),updateSurvey:async surveyPayload=>await api.ZP.surveys.update(props.id,surveyPayload),launchSurvey:async()=>{const startDate=(0,dayjs.Bv)();return await api.ZP.surveys.update(props.id,{start_date:startDate.toISOString()})},stopSurvey:async()=>await api.ZP.surveys.update(props.id,{end_date:(0,dayjs.Bv)().toISOString()}),resumeSurvey:async()=>await api.ZP.surveys.update(props.id,{end_date:null})}}})),(0,index_esm.listeners)((_ref3=>{let{actions:actions}=_ref3;return{loadSurveySuccess:_ref4=>{let{survey:survey}=_ref4;survey.start_date&&"new"!==survey.id&&(actions.setDataTableQuery(getSurveyDataQuery(survey)),actions.setSurveyMetricsQueries(getSurveyMetricsQueries(survey.id)),actions.setSurveyDataVizQuery(getSurveyDataVizQuery(survey))),survey.targeting_flag&&actions.setHasTargetingFlag(!0)},createSurveySuccess:_ref5=>{let{survey:survey}=_ref5;src.lemonToast.success((0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," created"]})),actions.loadSurveys(),kea_router_lib.router.actions.replace(urls.j.survey(survey.id)),actions.reportSurveyCreated(survey)},updateSurveySuccess:_ref6=>{let{survey:survey}=_ref6;src.lemonToast.success((0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," updated"]})),actions.editingSurvey(!1),actions.reportSurveyEdited(survey),actions.loadSurveys()},launchSurveySuccess:_ref7=>{let{survey:survey}=_ref7;src.lemonToast.success((0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," launched"]})),actions.setSurveyMetricsQueries(getSurveyMetricsQueries(survey.id)),actions.setDataTableQuery(getSurveyDataQuery(survey)),actions.loadSurveys(),actions.reportSurveyLaunched(survey)},stopSurveySuccess:_ref8=>{let{survey:survey}=_ref8;actions.loadSurveys(),actions.reportSurveyStopped(survey)},resumeSurveySuccess:_ref9=>{let{survey:survey}=_ref9;actions.loadSurveys(),actions.reportSurveyResumed(survey)},archiveSurvey:async()=>{actions.updateSurvey({archived:!0})}}})),(0,index_esm.reducers)({isEditingSurvey:[!1,{editingSurvey:(_,_ref10)=>{let{editing:editing}=_ref10;return editing}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref11)=>{let{query:query}=_ref11;return query}}],surveyMetricsQueries:[null,{setSurveyMetricsQueries:(_,_ref12)=>{let{surveyMetricsQueries:surveyMetricsQueries}=_ref12;return surveyMetricsQueries}}],surveyDataVizQuery:[null,{setSurveyDataVizQuery:(_,_ref13)=>{let{surveyDataVizQuery:surveyDataVizQuery}=_ref13;return surveyDataVizQuery}}],hasTargetingFlag:[!1,{setHasTargetingFlag:(_,_ref14)=>{let{hasTargetingFlag:hasTargetingFlag}=_ref14;return hasTargetingFlag}}]}),(0,index_esm.selectors)({isSurveyRunning:[s=>[s.survey],survey=>!(!survey.start_date||survey.end_date)],breadcrumbs:[s=>[s.survey],survey=>[{name:"Surveys",path:urls.j.surveys()},...survey?.name?[{name:survey.name}]:[]]],surveyPlugin:[s=>[s.installedPlugins],installedPlugins=>installedPlugins.find((plugin=>"Surveys app"===plugin.name))],showSurveyAppWarning:[s=>[s.survey,s.enabledPlugins,s.pluginsLoading],(survey,enabledPlugins,pluginsLoading)=>!(survey.type===types.d_.API||pluginsLoading||enabledPlugins.find((plugin=>"Surveys app"===plugin.name)))]}),(0,lib.forms)((_ref15=>{let{actions:actions,props:props,values:values}=_ref15;return{survey:{defaults:{...NEW_SURVEY},errors:_ref16=>{let{name:name,questions:questions}=_ref16;return{name:!name&&"Please enter a name.",questions:questions.map((question=>({question:!question.question&&"Please enter a question.",...question.type===types.I9.Link?{link:!question.link&&"Please enter a url for the link."}:{},...question.type===types.I9.Rating?{display:!question.display&&"Please choose a display type.",scale:!question.scale&&"Please choose a scale."}:{}})))}},submit:async surveyPayload=>{let surveyPayloadWithTargetingFlagFilters=surveyPayload;const flagLogic=(0,featureFlagLogic.h)({id:values.survey.targeting_flag?.id||"new"});if(values.hasTargetingFlag){const targetingFlag=flagLogic.values.featureFlag;surveyPayloadWithTargetingFlagFilters={...surveyPayload,targeting_flag_filters:targetingFlag.filters}}props.id&&"new"!==props.id?actions.updateSurvey(surveyPayloadWithTargetingFlagFilters):actions.createSurvey(surveyPayloadWithTargetingFlagFilters)}}}})),(0,kea_router_lib.urlToAction)((_ref17=>{var _props$id;let{actions:actions,props:props}=_ref17;return{[urls.j.survey(null!==(_props$id=props.id)&&void 0!==_props$id?_props$id:"new")]:(_,__,___,_ref18)=>{let{method:method}=_ref18;"PUSH"===method&&(props.id?actions.loadSurvey():actions.resetSurvey())}}})),(0,index_esm.afterMount)((async _ref19=>{let{props:props,actions:actions}=_ref19;"new"!==props.id&&await actions.loadSurvey(),"new"===props.id&&actions.resetSurvey()}))]);try{getSurveyDataQuery.displayName="getSurveyDataQuery",getSurveyDataQuery.__docgenInfo={description:"",displayName:"getSurveyDataQuery",props:{id:{defaultValue:null,description:"UUID",name:"id",required:!0,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"popover"'},{value:'"button"'},{value:'"full_screen"'},{value:'"email"'},{value:'"api"'}]}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"string"}},linked_flag_id:{defaultValue:null,description:"",name:"linked_flag_id",required:!0,type:{name:"number | null"}},linked_flag:{defaultValue:null,description:"",name:"linked_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag:{defaultValue:null,description:"",name:"targeting_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag_filters:{defaultValue:null,description:"",name:"targeting_flag_filters",required:!0,type:{name:'Pick<FeatureFlagFilters, "groups"> | undefined'}},conditions:{defaultValue:null,description:"",name:"conditions",required:!0,type:{name:"{ url: string; selector: string; is_headless?: boolean | undefined; } | null"}},appearance:{defaultValue:null,description:"",name:"appearance",required:!0,type:{name:"SurveyAppearance"}},questions:{defaultValue:null,description:"",name:"questions",required:!0,type:{name:"(BasicSurveyQuestion | LinkSurveyQuestion | RatingSurveyQuestion | MultipleSurveyQuestion)[]"}},created_at:{defaultValue:null,description:"",name:"created_at",required:!0,type:{name:"string"}},created_by:{defaultValue:null,description:"",name:"created_by",required:!0,type:{name:"UserBasicType | null"}},start_date:{defaultValue:null,description:"",name:"start_date",required:!0,type:{name:"string | null"}},end_date:{defaultValue:null,description:"",name:"end_date",required:!0,type:{name:"string | null"}},archived:{defaultValue:null,description:"",name:"archived",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyDataQuery"]={docgenInfo:getSurveyDataQuery.__docgenInfo,name:"getSurveyDataQuery",path:"frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyDataQuery"})}catch(__react_docgen_typescript_loader_error){}try{getSurveyMetricsQueries.displayName="getSurveyMetricsQueries",getSurveyMetricsQueries.__docgenInfo={description:"",displayName:"getSurveyMetricsQueries",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyMetricsQueries"]={docgenInfo:getSurveyMetricsQueries.__docgenInfo,name:"getSurveyMetricsQueries",path:"frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyMetricsQueries"})}catch(__react_docgen_typescript_loader_error){}try{getSurveyDataVizQuery.displayName="getSurveyDataVizQuery",getSurveyDataVizQuery.__docgenInfo={description:"",displayName:"getSurveyDataVizQuery",props:{id:{defaultValue:null,description:"UUID",name:"id",required:!0,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"popover"'},{value:'"button"'},{value:'"full_screen"'},{value:'"email"'},{value:'"api"'}]}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"string"}},linked_flag_id:{defaultValue:null,description:"",name:"linked_flag_id",required:!0,type:{name:"number | null"}},linked_flag:{defaultValue:null,description:"",name:"linked_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag:{defaultValue:null,description:"",name:"targeting_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag_filters:{defaultValue:null,description:"",name:"targeting_flag_filters",required:!0,type:{name:'Pick<FeatureFlagFilters, "groups"> | undefined'}},conditions:{defaultValue:null,description:"",name:"conditions",required:!0,type:{name:"{ url: string; selector: string; is_headless?: boolean | undefined; } | null"}},appearance:{defaultValue:null,description:"",name:"appearance",required:!0,type:{name:"SurveyAppearance"}},questions:{defaultValue:null,description:"",name:"questions",required:!0,type:{name:"(BasicSurveyQuestion | LinkSurveyQuestion | RatingSurveyQuestion | MultipleSurveyQuestion)[]"}},created_at:{defaultValue:null,description:"",name:"created_at",required:!0,type:{name:"string"}},created_by:{defaultValue:null,description:"",name:"created_by",required:!0,type:{name:"UserBasicType | null"}},start_date:{defaultValue:null,description:"",name:"start_date",required:!0,type:{name:"string | null"}},end_date:{defaultValue:null,description:"",name:"end_date",required:!0,type:{name:"string | null"}},archived:{defaultValue:null,description:"",name:"archived",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyDataVizQuery"]={docgenInfo:getSurveyDataVizQuery.__docgenInfo,name:"getSurveyDataVizQuery",path:"frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyDataVizQuery"})}catch(__react_docgen_typescript_loader_error){}var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),EarlyAccessFeature=__webpack_require__("./frontend/src/scenes/early-access-features/EarlyAccessFeature.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),apps_common_src=__webpack_require__("./frontend/@posthog/apps-common/src/index.ts"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),EditableField=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),SurveyAppearance=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/surveys/SurveyAppearance.scss"),SurveyAppearance_default=__webpack_require__.n(SurveyAppearance),options={insert:"head",singleton:!1};injectStylesIntoStyleTag_default()(SurveyAppearance_default(),options),SurveyAppearance_default().locals;const posthogLogoSVG=(0,jsx_runtime.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"12",viewBox:"0 0 50 30",fill:"none",children:[(0,jsx_runtime.jsx)("path",{d:"M10.8914 17.2057c-.3685.7371-1.42031.7371-1.78884 0L8.2212 15.443c-.14077-.2815-.14077-.6129 0-.8944l.88136-1.7627c.36853-.7371 1.42034-.7371 1.78884 0l.8814 1.7627c.1407.2815.1407.6129 0 .8944l-.8814 1.7627zM10.8914 27.2028c-.3685.737-1.42031.737-1.78884 0L8.2212 25.44c-.14077-.2815-.14077-.6129 0-.8944l.88136-1.7627c.36853-.7371 1.42034-.7371 1.78884 0l.8814 1.7627c.1407.2815.1407.6129 0 .8944l-.8814 1.7628z",fill:"##6A6B69"}),(0,jsx_runtime.jsx)("path",{d:"M0 23.4082c0-.8909 1.07714-1.3371 1.70711-.7071l4.58338 4.5834c.62997.63.1838 1.7071-.7071 1.7071H.999999c-.552284 0-.999999-.4477-.999999-1v-4.5834zm0-4.8278c0 .2652.105357.5196.292893.7071l9.411217 9.4112c.18753.1875.44189.2929.70709.2929h5.1692c.8909 0 1.3371-1.0771.7071-1.7071L1.70711 12.7041C1.07714 12.0741 0 12.5203 0 13.4112v5.1692zm0-9.99701c0 .26521.105357.51957.292893.7071L19.7011 28.6987c.1875.1875.4419.2929.7071.2929h5.1692c.8909 0 1.3371-1.0771.7071-1.7071L1.70711 2.70711C1.07715 2.07715 0 2.52331 0 3.41421v5.16918zm9.997 0c0 .26521.1054.51957.2929.7071l17.994 17.99401c.63.63 1.7071.1838 1.7071-.7071v-5.1692c0-.2652-.1054-.5196-.2929-.7071l-17.994-17.994c-.63-.62996-1.7071-.18379-1.7071.70711v5.16918zm11.7041-5.87628c-.63-.62997-1.7071-.1838-1.7071.7071v5.16918c0 .26521.1054.51957.2929.7071l7.997 7.99701c.63.63 1.7071.1838 1.7071-.7071v-5.1692c0-.2652-.1054-.5196-.2929-.7071l-7.997-7.99699z",fill:"#6A6B69"}),(0,jsx_runtime.jsx)("path",{d:"M42.5248 23.5308l-9.4127-9.4127c-.63-.63-1.7071-.1838-1.7071.7071v13.1664c0 .5523.4477 1 1 1h14.5806c.5523 0 1-.4477 1-1v-1.199c0-.5523-.4496-.9934-.9973-1.0647-1.6807-.2188-3.2528-.9864-4.4635-2.1971zm-6.3213 2.2618c-.8829 0-1.5995-.7166-1.5995-1.5996 0-.8829.7166-1.5995 1.5995-1.5995.883 0 1.5996.7166 1.5996 1.5995 0 .883-.7166 1.5996-1.5996 1.5996z",fill:"#6A6B69"}),(0,jsx_runtime.jsx)("path",{d:"M0 27.9916c0 .5523.447715 1 1 1h4.58339c.8909 0 1.33707-1.0771.70711-1.7071l-4.58339-4.5834C1.07714 22.0711 0 22.5173 0 23.4082v4.5834zM9.997 10.997L1.70711 2.70711C1.07714 2.07714 0 2.52331 0 3.41421v5.16918c0 .26521.105357.51957.292893.7071L9.997 18.9946V10.997zM1.70711 12.7041C1.07714 12.0741 0 12.5203 0 13.4112v5.1692c0 .2652.105357.5196.292893.7071L9.997 28.9916V20.994l-8.28989-8.2899z",fill:"#6A6B69"}),(0,jsx_runtime.jsx)("path",{d:"M19.994 11.4112c0-.2652-.1053-.5196-.2929-.7071l-7.997-7.99699c-.6299-.62997-1.70709-.1838-1.70709.7071v5.16918c0 .26521.10539.51957.29289.7071l9.7041 9.70411v-7.5834zM9.99701 28.9916h5.58339c.8909 0 1.3371-1.0771.7071-1.7071L9.99701 20.994v7.9976zM9.99701 10.997v7.5834c0 .2652.10539.5196.29289.7071l9.7041 9.7041v-7.5834c0-.2652-.1053-.5196-.2929-.7071L9.99701 10.997z",fill:"#6a6b69"})]}),satisfiedEmoji=(0,jsx_runtime.jsx)("svg",{className:"emoji-svg",xmlns:"http://www.w3.org/2000/svg",height:"48",viewBox:"0 -960 960 960",width:"48",children:(0,jsx_runtime.jsx)("path",{d:"M626-533q22.5 0 38.25-15.75T680-587q0-22.5-15.75-38.25T626-641q-22.5 0-38.25 15.75T572-587q0 22.5 15.75 38.25T626-533Zm-292 0q22.5 0 38.25-15.75T388-587q0-22.5-15.75-38.25T334-641q-22.5 0-38.25 15.75T280-587q0 22.5 15.75 38.25T334-533Zm146 272q66 0 121.5-35.5T682-393h-52q-23 40-63 61.5T480.5-310q-46.5 0-87-21T331-393h-53q26 61 81 96.5T480-261Zm0 181q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 340q142.375 0 241.188-98.812Q820-337.625 820-480t-98.812-241.188Q622.375-820 480-820t-241.188 98.812Q140-622.375 140-480t98.812 241.188Q337.625-140 480-140Z"})}),neutralEmoji=(0,jsx_runtime.jsx)("svg",{className:"emoji-svg",xmlns:"http://www.w3.org/2000/svg",height:"48",viewBox:"0 -960 960 960",width:"48",children:(0,jsx_runtime.jsx)("path",{d:"M626-533q22.5 0 38.25-15.75T680-587q0-22.5-15.75-38.25T626-641q-22.5 0-38.25 15.75T572-587q0 22.5 15.75 38.25T626-533Zm-292 0q22.5 0 38.25-15.75T388-587q0-22.5-15.75-38.25T334-641q-22.5 0-38.25 15.75T280-587q0 22.5 15.75 38.25T334-533Zm20 194h253v-49H354v49ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 340q142.375 0 241.188-98.812Q820-337.625 820-480t-98.812-241.188Q622.375-820 480-820t-241.188 98.812Q140-622.375 140-480t98.812 241.188Q337.625-140 480-140Z"})}),dissatisfiedEmoji=(0,jsx_runtime.jsx)("svg",{className:"emoji-svg",xmlns:"http://www.w3.org/2000/svg",height:"48",viewBox:"0 -960 960 960",width:"48",children:(0,jsx_runtime.jsx)("path",{d:"M626-533q22.5 0 38.25-15.75T680-587q0-22.5-15.75-38.25T626-641q-22.5 0-38.25 15.75T572-587q0 22.5 15.75 38.25T626-533Zm-292 0q22.5 0 38.25-15.75T388-587q0-22.5-15.75-38.25T334-641q-22.5 0-38.25 15.75T280-587q0 22.5 15.75 38.25T334-533Zm146.174 116Q413-417 358.5-379.5T278-280h53q22-42 62.173-65t87.5-23Q528-368 567.5-344.5T630-280h52q-25-63-79.826-100-54.826-37-122-37ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 340q142.375 0 241.188-98.812Q820-337.625 820-480t-98.812-241.188Q622.375-820 480-820t-241.188 98.812Q140-622.375 140-480t98.812 241.188Q337.625-140 480-140Z"})}),veryDissatisfiedEmoji=(0,jsx_runtime.jsx)("svg",{className:"emoji-svg",xmlns:"http://www.w3.org/2000/svg",height:"48",viewBox:"0 -960 960 960",width:"48",children:(0,jsx_runtime.jsx)("path",{d:"M480-417q-67 0-121.5 37.5T278-280h404q-25-63-80-100t-122-37Zm-183-72 50-45 45 45 31-36-45-45 45-45-31-36-45 45-50-45-31 36 45 45-45 45 31 36Zm272 0 44-45 51 45 31-36-45-45 45-45-31-36-51 45-44-45-31 36 44 45-44 45 31 36ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 340q142 0 241-99t99-241q0-142-99-241t-241-99q-142 0-241 99t-99 241q0 142 99 241t241 99Z"})}),verySatisfiedEmoji=(0,jsx_runtime.jsx)("svg",{className:"emoji-svg",xmlns:"http://www.w3.org/2000/svg",height:"48",viewBox:"0 -960 960 960",width:"48",children:(0,jsx_runtime.jsx)("path",{d:"M479.504-261Q537-261 585.5-287q48.5-26 78.5-72.4 6-11.6-.75-22.6-6.75-11-20.25-11H316.918Q303-393 296.5-382t-.5 22.6q30 46.4 78.5 72.4 48.5 26 105.004 26ZM347-578l27 27q7.636 8 17.818 8Q402-543 410-551q8-8 8-18t-8-18l-42-42q-8.8-9-20.9-9-12.1 0-21.1 9l-42 42q-8 7.636-8 17.818Q276-559 284-551q8 8 18 8t18-8l27-27Zm267 0 27 27q7.714 8 18 8t18-8q8-7.636 8-17.818Q685-579 677-587l-42-42q-8.8-9-20.9-9-12.1 0-21.1 9l-42 42q-8 7.714-8 18t8 18q7.636 8 17.818 8Q579-543 587-551l27-27ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 340q142.375 0 241.188-98.812Q820-337.625 820-480t-98.812-241.188Q622.375-820 480-820t-241.188 98.812Q140-622.375 140-480t98.812 241.188Q337.625-140 480-140Z"})});function SurveyAppearance_SurveyAppearance(_ref){let{type:type,question:question,appearance:appearance,surveyQuestionItem:surveyQuestionItem,description:description,link:link,readOnly:readOnly,onAppearanceChange:onAppearanceChange}=_ref;const{whitelabelAvailable:whitelabelAvailable}=(0,index_esm.useValues)(surveysLogic.k),[showThankYou,setShowThankYou]=(0,react.useState)(!1),[hideSubmittedSurvey,setHideSubmittedSurvey]=(0,react.useState)(!1);return(0,react.useEffect)((()=>{appearance.displayThankYouMessage&&showThankYou&&(setHideSubmittedSurvey(!0),setTimeout((()=>{setShowThankYou(!1),setHideSubmittedSurvey(!1)}),2e3))}),[showThankYou]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mb-4 text-center",children:"Preview"}),!hideSubmittedSurvey&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[type===types.I9.Rating&&(0,jsx_runtime.jsx)(SurveyRatingAppearance,{ratingSurveyQuestion:surveyQuestionItem,appearance:appearance,question:question,description:description,onSubmit:()=>appearance.displayThankYouMessage&&setShowThankYou(!0)}),(surveyQuestionItem.type===types.I9.SingleChoice||surveyQuestionItem.type===types.I9.MultipleChoice)&&(0,jsx_runtime.jsx)(SurveyMultipleChoiceAppearance,{multipleChoiceQuestion:surveyQuestionItem,appearance:appearance,question:question,description:description,onSubmit:()=>appearance.displayThankYouMessage&&setShowThankYou(!0)}),(surveyQuestionItem.type===types.I9.Open||surveyQuestionItem.type===types.I9.Link)&&(0,jsx_runtime.jsx)(BaseAppearance,{type:type,question:question,description:description,appearance:appearance,link:link,onSubmit:()=>appearance.displayThankYouMessage&&setShowThankYou(!0)})]}),showThankYou&&(0,jsx_runtime.jsx)(SurveyThankYou,{appearance:appearance}),!readOnly&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Background color"}),(0,jsx_runtime.jsx)(src.LemonInput,{value:appearance?.backgroundColor,onChange:backgroundColor=>onAppearanceChange({...appearance,backgroundColor:backgroundColor})}),(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Question text color"}),(0,jsx_runtime.jsx)(src.LemonInput,{value:appearance?.textColor,onChange:textColor=>onAppearanceChange({...appearance,textColor:textColor})}),(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Description text color"}),(0,jsx_runtime.jsx)(src.LemonInput,{value:appearance?.descriptionTextColor||defaultSurveyAppearance.descriptionTextColor,onChange:descriptionTextColor=>onAppearanceChange({...appearance,descriptionTextColor:descriptionTextColor})}),surveyQuestionItem.type===types.I9.Rating&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Rating button color"}),(0,jsx_runtime.jsx)(src.LemonInput,{value:appearance?.ratingButtonColor,onChange:ratingButtonColor=>onAppearanceChange({...appearance,ratingButtonColor:ratingButtonColor})}),"emoji"===surveyQuestionItem.display&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Rating button hover color"}),(0,jsx_runtime.jsx)(src.LemonInput,{value:appearance?.ratingButtonHoverColor,onChange:ratingButtonHoverColor=>onAppearanceChange({...appearance,ratingButtonHoverColor:ratingButtonHoverColor})})]})]}),(type===types.I9.Open||type===types.I9.Link)&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Button color"}),(0,jsx_runtime.jsx)(src.LemonInput,{value:appearance?.submitButtonColor,onChange:submitButtonColor=>onAppearanceChange({...appearance,submitButtonColor:submitButtonColor})}),(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Button text"}),(0,jsx_runtime.jsx)(src.LemonInput,{value:appearance?.submitButtonText||defaultSurveyAppearance.submitButtonText,onChange:submitButtonText=>onAppearanceChange({...appearance,submitButtonText:submitButtonText})})]}),(0,jsx_runtime.jsx)("div",{className:"mt-2",children:(0,jsx_runtime.jsx)(src.LemonCheckbox,{label:(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsx)("span",{children:"Hide PostHog branding"})}),onChange:checked=>onAppearanceChange({...appearance,whiteLabel:checked}),disabledReason:whitelabelAvailable?null:"Upgrade to any paid plan to hide PostHog branding"})})]})]})}function BaseAppearance(_ref2){let{type:type,question:question,appearance:appearance,onSubmit:onSubmit,description:description,link:link}=_ref2;return(0,jsx_runtime.jsx)("form",{className:"survey-form",style:{backgroundColor:appearance.backgroundColor},children:(0,jsx_runtime.jsxs)("div",{className:"survey-box",children:[(0,jsx_runtime.jsx)("div",{className:"cancel-btn-wrapper",children:(0,jsx_runtime.jsx)("button",{className:"form-cancel",type:"button",style:{backgroundColor:appearance.backgroundColor},children:(0,jsx_runtime.jsx)(icons.bMz,{})})}),(0,jsx_runtime.jsxs)("div",{className:"question-textarea-wrapper",children:[(0,jsx_runtime.jsx)("div",{className:"survey-question",style:{color:appearance.textColor},children:question}),description&&(0,jsx_runtime.jsx)("div",{className:"description",style:{color:appearance.descriptionTextColor},children:description}),type===types.I9.Open&&(0,jsx_runtime.jsx)("textarea",{className:"survey-textarea",name:"survey",rows:4})]}),(0,jsx_runtime.jsxs)("div",{className:"bottom-section",children:[(0,jsx_runtime.jsx)("div",{className:"buttons",children:(0,jsx_runtime.jsx)("button",{className:"form-submit",type:"button",onClick:()=>{link&&type===types.I9.Link&&window.open(link),onSubmit()},style:{backgroundColor:appearance.submitButtonColor},children:appearance.submitButtonText||"Submit"})}),(0,jsx_runtime.jsxs)("div",{className:"footer-branding",style:{display:appearance.whiteLabel?"none":""},children:["powered by ",posthogLogoSVG," PostHog"]})]})]})})}function SurveyRatingAppearance(_ref3){let{ratingSurveyQuestion:ratingSurveyQuestion,appearance:appearance,question:question,onSubmit:onSubmit,description:description}=_ref3;const threeEmojis=[dissatisfiedEmoji,neutralEmoji,satisfiedEmoji],fiveEmojis=[veryDissatisfiedEmoji,dissatisfiedEmoji,neutralEmoji,satisfiedEmoji,verySatisfiedEmoji];return(0,jsx_runtime.jsx)("form",{className:"survey-form",style:{backgroundColor:appearance.backgroundColor},children:(0,jsx_runtime.jsxs)("div",{className:"survey-box",children:[(0,jsx_runtime.jsx)("div",{className:"cancel-btn-wrapper",children:(0,jsx_runtime.jsx)("button",{className:"form-cancel",type:"button",style:{backgroundColor:appearance.backgroundColor},children:"X"})}),(0,jsx_runtime.jsx)("div",{className:"survey-question",style:{color:appearance.textColor},children:question}),description&&(0,jsx_runtime.jsx)("div",{className:"description",style:{color:appearance.descriptionTextColor},children:description}),(0,jsx_runtime.jsxs)("div",{className:"rating-section",children:[(0,jsx_runtime.jsxs)("div",{className:"rating-options",children:["emoji"===ratingSurveyQuestion.display&&(0,jsx_runtime.jsx)("div",{className:"rating-options-emoji",children:(3===ratingSurveyQuestion.scale?threeEmojis:fiveEmojis).map(((emoji,idx)=>(0,jsx_runtime.jsx)("button",{className:"ratings-emoji",type:"button",style:{fill:appearance.ratingButtonColor},onMouseEnter:val=>{val.currentTarget.style.fill=appearance.ratingButtonHoverColor||"coral"},onMouseLeave:val=>{val.currentTarget.style.fill=appearance.ratingButtonColor||"black"},onClick:()=>onSubmit(),children:emoji},idx)))})," ","number"===ratingSurveyQuestion.display&&(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("div",{className:"rating-options-buttons "+(5===ratingSurveyQuestion.scale?"":"max-numbers"),children:(5===ratingSurveyQuestion.scale?[1,2,3,4,5]:[1,2,3,4,5,6,7,8,9,10]).map(((num,idx)=>(0,jsx_runtime.jsx)("button",{className:"ratings-number",type:"button",onClick:()=>onSubmit(),style:{backgroundColor:appearance.ratingButtonColor},children:num},idx)))})})]}),(0,jsx_runtime.jsxs)("div",{className:"rating-text",children:[(0,jsx_runtime.jsx)("div",{children:ratingSurveyQuestion.lowerBoundLabel}),(0,jsx_runtime.jsx)("div",{children:ratingSurveyQuestion.upperBoundLabel})]}),(0,jsx_runtime.jsxs)("div",{className:"footer-branding",style:{display:appearance.whiteLabel?"none":""},children:["powered by ",posthogLogoSVG," PostHog"]})]})]})})}function SurveyMultipleChoiceAppearance(_ref4){let{multipleChoiceQuestion:multipleChoiceQuestion,appearance:appearance,question:question,onSubmit:onSubmit,description:description}=_ref4;const inputType=multipleChoiceQuestion.type===types.I9.SingleChoice?"radio":"checkbox";return(0,jsx_runtime.jsx)("form",{className:"survey-form",style:{backgroundColor:appearance.backgroundColor},children:(0,jsx_runtime.jsxs)("div",{className:"survey-box",children:[(0,jsx_runtime.jsx)("div",{className:"cancel-btn-wrapper",children:(0,jsx_runtime.jsx)("button",{className:"form-cancel",type:"button",style:{backgroundColor:appearance.backgroundColor},children:"X"})}),(0,jsx_runtime.jsx)("div",{className:"survey-question",style:{color:appearance.textColor},children:question}),description&&(0,jsx_runtime.jsx)("div",{className:"description",style:{color:appearance.descriptionTextColor},children:description}),(0,jsx_runtime.jsx)("div",{className:"multiple-choice-options",children:(multipleChoiceQuestion.choices||[]).map(((choice,idx)=>(0,jsx_runtime.jsxs)("div",{className:"choice-option",children:[(0,jsx_runtime.jsx)("input",{type:inputType,name:"choice",value:choice}),(0,jsx_runtime.jsx)("label",{children:choice})]},idx)))}),(0,jsx_runtime.jsxs)("div",{className:"bottom-section",children:[(0,jsx_runtime.jsx)("div",{className:"buttons",children:(0,jsx_runtime.jsx)("button",{className:"form-submit",type:"button",onClick:()=>onSubmit(),style:{backgroundColor:appearance.submitButtonColor},children:appearance.submitButtonText||"Submit"})}),(0,jsx_runtime.jsxs)("div",{className:"footer-branding",style:{display:appearance.whiteLabel?"none":""},children:["powered by ",posthogLogoSVG," PostHog"]})]})]})})}function SurveyThankYou(_ref5){let{appearance:appearance}=_ref5;return(0,jsx_runtime.jsx)("div",{className:"thank-you-message",children:(0,jsx_runtime.jsxs)("div",{className:"thank-you-message-container",style:{backgroundColor:appearance.backgroundColor},children:[(0,jsx_runtime.jsxs)("h3",{className:"thank-you-message-header",style:{color:appearance.textColor},children:[appearance.thankYouMessageHeader||"Thank you!"," "]}),(0,jsx_runtime.jsx)("div",{className:"thank-you-message-description",style:{color:appearance.descriptionTextColor},children:appearance.thankYouMessageDescription||""}),(0,jsx_runtime.jsxs)("div",{className:"footer-branding",style:{display:appearance.whiteLabel?"none":""},children:["powered by ",posthogLogoSVG," PostHog"]})]})})}try{SurveyAppearance_SurveyAppearance.displayName="SurveyAppearance",SurveyAppearance_SurveyAppearance.__docgenInfo={description:"",displayName:"SurveyAppearance",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"open"'},{value:'"multiple_choice"'},{value:'"single_choice"'},{value:'"nps"'},{value:'"rating"'},{value:'"link"'}]}},question:{defaultValue:null,description:"",name:"question",required:!0,type:{name:"string"}},appearance:{defaultValue:null,description:"",name:"appearance",required:!0,type:{name:"SurveyAppearance"}},surveyQuestionItem:{defaultValue:null,description:"",name:"surveyQuestionItem",required:!0,type:{name:"SurveyQuestion"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string | null"}},link:{defaultValue:null,description:"",name:"link",required:!1,type:{name:"string | null"}},readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}},onAppearanceChange:{defaultValue:null,description:"",name:"onAppearanceChange",required:!0,type:{name:"(appearance: SurveyAppearance) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/SurveyAppearance.tsx#SurveyAppearance"]={docgenInfo:SurveyAppearance_SurveyAppearance.__docgenInfo,name:"SurveyAppearance",path:"frontend/src/scenes/surveys/SurveyAppearance.tsx#SurveyAppearance"})}catch(__react_docgen_typescript_loader_error){}function SurveyAPIEditor(_ref){let{survey:survey}=_ref;const apiSurvey={id:survey.id,name:survey.name,description:survey.description,type:survey.type,linked_flag_key:survey.linked_flag?survey.linked_flag.key:null,targeting_flag_key:survey.targeting_flag?survey.targeting_flag.key:null,questions:survey.questions,conditions:survey.conditions,start_date:survey.start_date,end_date:survey.end_date};return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)("h4",{className:"text-center",children:"API survey response"}),(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JSON,children:JSON.stringify(apiSurvey,null,2)})]})}try{SurveyAPIEditor.displayName="SurveyAPIEditor",SurveyAPIEditor.__docgenInfo={description:"",displayName:"SurveyAPIEditor",props:{survey:{defaultValue:null,description:"",name:"survey",required:!0,type:{name:"Survey | NewSurvey"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/SurveyAPIEditor.tsx#SurveyAPIEditor"]={docgenInfo:SurveyAPIEditor.__docgenInfo,name:"SurveyAPIEditor",path:"frontend/src/scenes/surveys/SurveyAPIEditor.tsx#SurveyAPIEditor"})}catch(__react_docgen_typescript_loader_error){}var LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts");function SurveyView(_ref){let{id:id}=_ref;const{survey:survey,dataTableQuery:dataTableQuery,surveyLoading:surveyLoading,surveyPlugin:surveyPlugin,surveyMetricsQueries:surveyMetricsQueries,surveyDataVizQuery:surveyDataVizQuery,showSurveyAppWarning:showSurveyAppWarning}=(0,index_esm.useValues)(surveyLogic),{editingSurvey:editingSurvey,updateSurvey:updateSurvey,launchSurvey:launchSurvey,stopSurvey:stopSurvey,archiveSurvey:archiveSurvey,resumeSurvey:resumeSurvey}=(0,index_esm.useActions)(surveyLogic),{deleteSurvey:deleteSurvey}=(0,index_esm.useActions)(surveysLogic.k),{editPlugin:editPlugin}=(0,index_esm.useActions)(pluginsLogic.C),[tabKey,setTabKey]=(0,react.useState)(survey.start_date?"results":"overview");return(0,react.useEffect)((()=>{survey.start_date&&setTabKey("results")}),[survey.start_date]),(0,jsx_runtime.jsx)("div",{children:surveyLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:survey.name,buttons:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonButton,{"data-attr":"edit-survey",fullWidth:!0,onClick:()=>editingSurvey(!0),children:"Edit"}),(0,jsx_runtime.jsx)(src.LemonDivider,{})]}),survey.end_date&&!survey.archived&&(0,jsx_runtime.jsx)(src.LemonButton,{onClick:()=>archiveSurvey(),fullWidth:!0,children:"Archive"}),(0,jsx_runtime.jsx)(src.LemonButton,{status:"danger",fullWidth:!0,onClick:()=>deleteSurvey(id),children:"Delete survey"})]})}),(0,jsx_runtime.jsx)(src.LemonDivider,{vertical:!0}),survey.start_date?survey.end_date&&!survey.archived?(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:()=>resumeSurvey(),children:"Resume"}):!survey.archived&&(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",status:"danger",onClick:()=>stopSurvey(),children:"Stop"}):(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>{launchSurvey()},children:"Launch"})]}),caption:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:survey&&!!survey.description&&(0,jsx_runtime.jsx)(EditableField.f,{multiline:!0,name:"description",value:survey.description||"",placeholder:"Description (optional)",onSave:value=>updateSurvey({id:id,description:value}),saveOnBlur:!0,compactButtons:!0})})}),!surveyLoading&&showSurveyAppWarning&&(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"error",children:["Surveys requires the"," ",(0,jsx_runtime.jsx)("a",{onClick:()=>surveyPlugin?.id&&editPlugin(surveyPlugin.id),children:"survey app"}),' to be enabled. You also need to make sure you have the "opt_in_site_apps" setting in your PostHog initialization code.']}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tabKey,onChange:key=>setTabKey(key),tabs:[survey.start_date?{content:(0,jsx_runtime.jsxs)("div",{children:[surveyMetricsQueries&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-4 mb-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(Query.A,{query:surveyMetricsQueries.surveysShown})}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(Query.A,{query:surveyMetricsQueries.surveysDismissed})})]}),survey.questions[0].type===types.I9.Rating&&(0,jsx_runtime.jsx)("div",{className:"mb-4",children:(0,jsx_runtime.jsx)(Query.A,{query:surveyDataVizQuery})}),(survey.questions[0].type===types.I9.SingleChoice||survey.questions[0].type===types.I9.MultipleChoice)&&(0,jsx_runtime.jsx)("div",{className:"mb-4",children:(0,jsx_runtime.jsx)(Query.A,{query:{kind:schema.O.DataTableNode,source:{kind:schema.O.HogQLQuery,query:`select count(), arrayJoin(JSONExtractArrayRaw(properties, '$survey_response')) as choice from events where event == 'survey sent' and properties.$survey_id == '${survey.id}' group by choice order by count() desc`}}})}),surveyLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{}):(0,jsx_runtime.jsx)(Query.A,{query:dataTableQuery})]}),key:"results",label:"Results"}:null,{content:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full",children:[(0,jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Display mode"}),(0,jsx_runtime.jsx)("span",{children:survey.type===types.d_.API?survey.type.toUpperCase():(0,utils.fm)(survey.type)}),survey.questions[0].question&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Type"}),(0,jsx_runtime.jsx)("span",{children:(0,utils.fm)(survey.questions[0].type)}),(0,jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Question"}),survey.questions.map(((q,idx)=>(0,jsx_runtime.jsx)("span",{children:q.question},idx)))]}),survey.questions[0].type===types.I9.Link&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Link url"}),(0,jsx_runtime.jsx)("span",{children:survey.questions[0].link})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-8",children:[survey.start_date&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Start date"}),(0,jsx_runtime.jsx)(apps_common_src.TZLabel,{time:survey.start_date})]}),survey.end_date&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"End date"}),(0,jsx_runtime.jsx)(apps_common_src.TZLabel,{time:survey.end_date})]})]}),(0,jsx_runtime.jsx)(src.LemonDivider,{}),(0,jsx_runtime.jsx)(SurveyReleaseSummary,{id:id,survey:survey,hasTargetingFlag:!!survey.targeting_flag})]}),(0,jsx_runtime.jsxs)("div",{className:"w-full flex flex-col items-center",children:[(0,jsx_runtime.jsxs)("div",{className:"border rounded p-4 w-full",children:[survey.type!==types.d_.API?showSurveyAppWarning&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)("div",{className:"flex gap-2 items-start",children:"1. Add the following option to your PostHog instance:"}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:OPT_IN_SNIPPET}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:["2."," ",(0,jsx_runtime.jsx)(src.LemonButton,{onClick:()=>surveyPlugin?.id&&editPlugin(surveyPlugin.id),children:"Enable and save the surveys app"})]})]}):(0,jsx_runtime.jsx)("span",{className:"font-medium",children:"See the documentation below on API survey setup."}),(0,jsx_runtime.jsxs)("div",{children:["Need more information?"," ",(0,jsx_runtime.jsxs)("a",{"data-attr":"survey-doc-link",target:"_blank",rel:"noopener",href:"https://posthog.com/docs/surveys/manual",children:["Check the docs ",(0,jsx_runtime.jsx)(icons.pFn,{})]})]})]}),survey.type!==types.d_.API?(0,jsx_runtime.jsx)("div",{className:"mt-6",children:(0,jsx_runtime.jsx)(SurveyAppearance_SurveyAppearance,{type:survey.questions[0].type,surveyQuestionItem:survey.questions[0],appearance:survey.appearance||defaultSurveyAppearance,question:survey.questions[0].question,description:survey.questions[0].description,link:survey.questions[0].type===types.I9.Link?survey.questions[0].link:void 0,readOnly:!0,onAppearanceChange:()=>{}})}):(0,jsx_runtime.jsx)("div",{className:"mt-2",children:(0,jsx_runtime.jsx)(SurveyAPIEditor,{survey:survey})})]})]}),key:"overview",label:"Overview"}]})]})})}const OPT_IN_SNIPPET="posthog.init('YOUR_PROJECT_API_KEY', {\n    api_host: 'YOUR API HOST',\n    opt_in_site_apps: true // <--- Add this line\n})";try{SurveyView.displayName="SurveyView",SurveyView.__docgenInfo={description:"",displayName:"SurveyView",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/SurveyView.tsx#SurveyView"]={docgenInfo:SurveyView.__docgenInfo,name:"SurveyView",path:"frontend/src/scenes/surveys/SurveyView.tsx#SurveyView"})}catch(__react_docgen_typescript_loader_error){}var logic_featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),FeatureFlagReleaseConditions=__webpack_require__("./frontend/src/scenes/feature-flags/FeatureFlagReleaseConditions.tsx");const scene={component:SurveyComponent,logic:surveyLogic,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{id:id}}};function SurveyComponent(){let{id:id}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{isEditingSurvey:isEditingSurvey}=(0,index_esm.useValues)(surveyLogic),showSurveyForm="new"===id||isEditingSurvey;return(0,jsx_runtime.jsx)("div",{children:id?(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:surveyLogic,props:{id:id},children:showSurveyForm?(0,jsx_runtime.jsx)(SurveyForm,{id:id}):(0,jsx_runtime.jsx)(SurveyView,{id:id})}):(0,jsx_runtime.jsx)(LemonSkeleton.y,{})})}function SurveyForm(_ref2){let{id:id}=_ref2;const{survey:survey,surveyLoading:surveyLoading,isEditingSurvey:isEditingSurvey,hasTargetingFlag:hasTargetingFlag}=(0,index_esm.useValues)(surveyLogic),{loadSurvey:loadSurvey,editingSurvey:editingSurvey,setHasTargetingFlag:setHasTargetingFlag}=(0,index_esm.useActions)(surveyLogic),{featureFlags:featureFlags}=(0,index_esm.useValues)(logic_featureFlagLogic.h);return(0,jsx_runtime.jsxs)(lib.Form,{formKey:"survey",logic:surveyLogic,className:"space-y-4",enableFormOnSubmit:!0,children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:"new"===id?"New survey":survey.name,buttons:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-survey",type:"secondary",loading:surveyLoading,onClick:()=>{isEditingSurvey?(editingSurvey(!1),loadSurvey()):kea_router_lib.router.actions.push(urls.j.surveys())},children:"Cancel"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:surveyLoading,children:"new"===id?"Save as draft":"Save"})]})}),(0,jsx_runtime.jsx)(src.LemonDivider,{}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(Field.g,{name:"name",label:"Name",children:(0,jsx_runtime.jsx)(src.LemonInput,{"data-attr":"survey-name"})}),(0,jsx_runtime.jsx)(Field.g,{name:"description",label:"Description (optional)",children:(0,jsx_runtime.jsx)(src.LemonTextArea,{"data-attr":"survey-description",minRows:2})}),(0,jsx_runtime.jsx)(Field.g,{name:"type",label:"Display mode",className:"w-max",children:(0,jsx_runtime.jsx)(src.LemonSelect,{"data-attr":"survey-type",options:[{label:"Popover",value:types.d_.Popover},{label:"API",value:types.d_.API}]})}),(0,jsx_runtime.jsx)(src.LemonDivider,{}),survey.questions.map(((question,index)=>(0,jsx_runtime.jsxs)(lib.Group,{name:`questions.${index}`,children:[(0,jsx_runtime.jsx)(Field.g,{name:"type",label:"Question type",className:"max-w-60",children:(0,jsx_runtime.jsx)(src.LemonSelect,{options:[{label:"Open text",value:types.I9.Open},{label:"Link",value:types.I9.Link},{label:"Rating",value:types.I9.Rating},...featureFlags[constants.y8.SURVEYS_MULTIPLE_CHOICE]?[{label:"Single choice select",value:types.I9.SingleChoice},{label:"Multiple choice select",value:types.I9.MultipleChoice}]:[]]})}),(0,jsx_runtime.jsx)(Field.g,{name:"question",label:"Question",children:(0,jsx_runtime.jsx)(src.LemonInput,{value:question.question})}),question.type===types.I9.Link&&(0,jsx_runtime.jsx)(Field.g,{name:"link",label:"Link",info:"Make sure to include https:// in the url.",children:(0,jsx_runtime.jsx)(src.LemonInput,{value:question.link||"",placeholder:"https://posthog.com"})}),(0,jsx_runtime.jsx)(Field.g,{name:"description",label:"Question description (optional)",children:(0,jsx_runtime.jsx)(src.LemonTextArea,{value:question.description||"",minRows:2})}),question.type===types.I9.Rating&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,jsx_runtime.jsx)(Field.g,{name:"display",label:"Display type",className:"min-w-50",children:(0,jsx_runtime.jsx)(src.LemonSelect,{options:[{label:"Number",value:"number"},{label:"Emoji",value:"emoji"}]})}),(0,jsx_runtime.jsx)(Field.g,{name:"scale",label:"Scale",className:"min-w-50",children:(0,jsx_runtime.jsx)(src.LemonSelect,{options:[..."emoji"===question.display?[{label:"1 - 3",value:3}]:[],{label:"1 - 5",value:5},..."number"===question.display?[{label:"1 - 10",value:10}]:[]]})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,jsx_runtime.jsx)(Field.g,{name:"lowerBoundLabel",label:"Lower bound label",className:"min-w-150",children:(0,jsx_runtime.jsx)(src.LemonInput,{value:question.lowerBoundLabel||""})}),(0,jsx_runtime.jsx)(Field.g,{name:"upperBoundLabel",label:"Upper bound label",className:"min-w-150",children:(0,jsx_runtime.jsx)(src.LemonInput,{value:question.upperBoundLabel||""})})]})]}),(question.type===types.I9.SingleChoice||question.type===types.I9.MultipleChoice)&&(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-2",children:(0,jsx_runtime.jsx)(Field.g,{name:"choices",label:"Choices",children:_ref3=>{let{value:value,onChange:onChange}=_ref3;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(value||[]).map(((choice,index)=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,jsx_runtime.jsx)(src.LemonInput,{value:choice,fullWidth:!0,onChange:val=>{const newChoices=[...value];newChoices[index]=val,onChange(newChoices)}}),(0,jsx_runtime.jsx)(src.LemonButton,{icon:(0,jsx_runtime.jsx)(icons.Fzz,{}),size:"small",status:"muted",noPadding:!0,onClick:()=>{const newChoices=[...value];newChoices.splice(index,1),onChange(newChoices)}})]},index))),(0,jsx_runtime.jsx)("div",{className:"w-fit",children:(value||[]).length<6&&(0,jsx_runtime.jsx)(src.LemonButton,{icon:(0,jsx_runtime.jsx)(icons.yZf,{}),type:"secondary",fullWidth:!1,onClick:()=>{onChange(value?[...value,""]:[""])},children:"Add choice"})})]})}})})]},index))),(0,jsx_runtime.jsx)(src.LemonDivider,{}),(0,jsx_runtime.jsx)(Field.g,{name:"appearance",label:"Thank you message (optional)",children:_ref4=>{let{value:value,onChange:onChange}=_ref4;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonCheckbox,{label:"Display thank you message",checked:value.displayThankYouMessage,onChange:checked=>onChange({...value,displayThankYouMessage:checked})}),value.displayThankYouMessage&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Field.e,{label:"Thank you header",children:(0,jsx_runtime.jsx)(src.LemonInput,{value:value.thankYouMessageHeader,onChange:val=>onChange({...value,thankYouMessageHeader:val}),placeholder:"ex: Thank you for your feedback!"})}),(0,jsx_runtime.jsx)(Field.e,{label:"Thank you description",children:(0,jsx_runtime.jsx)(src.LemonTextArea,{value:value.thankYouMessageDescription,onChange:val=>onChange({...value,thankYouMessageDescription:val}),minRows:2,placeholder:"ex: We really appreciate it."})})]})]})}}),(0,jsx_runtime.jsx)(src.LemonDivider,{className:"my-2"}),(0,jsx_runtime.jsxs)(Field.e,{label:"Targeting (optional)",children:[(0,jsx_runtime.jsxs)("span",{className:"text-muted",children:["If targeting options are set, the survey will be released to users who match ",(0,jsx_runtime.jsx)("b",{children:"all"})," of the conditions. If no targeting options are set, the survey"," ",(0,jsx_runtime.jsx)("b",{children:"will be released to everyone"}),"."]}),(0,jsx_runtime.jsx)(Field.g,{name:"linked_flag_id",label:"Link feature flag (optional)",info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Connecting to a feature flag will automatically enable this survey for everyone in the feature flag."}),children:_ref5=>{let{value:value,onChange:onChange}=_ref5;return(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)(EarlyAccessFeature.FlagSelector,{value:value,onChange:onChange}),value&&(0,jsx_runtime.jsx)(src.LemonButton,{className:"ml-2",icon:(0,jsx_runtime.jsx)(icons.uRT,{}),size:"small",status:"stealth",onClick:()=>onChange(void 0),"aria-label":"close"})]})}}),(0,jsx_runtime.jsx)(Field.g,{name:"conditions",children:_ref6=>{let{value:value,onChange:onChange}=_ref6;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Field.e,{label:"URL contains:",children:(0,jsx_runtime.jsx)(src.LemonInput,{value:value?.url,onChange:urlVal=>onChange({...value,url:urlVal}),placeholder:"ex: https://app.posthog.com"})}),(0,jsx_runtime.jsx)(Field.e,{label:"Selector matches:",children:(0,jsx_runtime.jsx)(src.LemonInput,{value:value?.selector,onChange:selectorVal=>onChange({...value,selector:selectorVal}),placeholder:"ex: .className or #id"})}),(0,jsx_runtime.jsx)(Field.e,{label:"Survey wait period",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.LemonCheckbox,{checked:!!value?.seenSurveyWaitPeriodInDays,onChange:checked=>{if(checked)onChange({...value,seenSurveyWaitPeriodInDays:value?.seenSurveyWaitPeriodInDays||30});else{const{seenSurveyWaitPeriodInDays:seenSurveyWaitPeriodInDays,...rest}=value||{};onChange(rest)}}}),"Do not display this survey to users who have already seen a survey in the last",(0,jsx_runtime.jsx)(src.LemonInput,{type:"number",size:"small",min:0,value:value?.seenSurveyWaitPeriodInDays,onChange:val=>{void 0!==val&&val>0&&onChange({...value,seenSurveyWaitPeriodInDays:val})},className:"w-16"})," ","days."]})})]})}}),(0,jsx_runtime.jsx)(Field.e,{label:"User properties",children:(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:featureFlagLogic.h,props:{id:survey.targeting_flag?.id||"new"},children:[!hasTargetingFlag&&(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",className:"w-max",onClick:()=>setHasTargetingFlag(!0),children:"Add user targeting"}),hasTargetingFlag&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mt-2",children:(0,jsx_runtime.jsx)(FeatureFlagReleaseConditions.I,{excludeTitle:!0})}),"new"===id&&(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",status:"danger",className:"w-max",onClick:()=>setHasTargetingFlag(!1),children:"Remove all user properties"})]})]})})]})]}),(0,jsx_runtime.jsx)(src.LemonDivider,{vertical:!0}),(0,jsx_runtime.jsx)("div",{className:"flex flex-col flex-1 items-center min-w-80",children:survey.type!==types.d_.API?(0,jsx_runtime.jsx)(Field.g,{name:"appearance",label:"",children:_ref7=>{let{value:value,onChange:onChange}=_ref7;return(0,jsx_runtime.jsx)(SurveyAppearance_SurveyAppearance,{type:survey.questions[0].type,surveyQuestionItem:survey.questions[0],question:survey.questions[0].question,description:survey.questions[0].description,onAppearanceChange:appearance=>{onChange(appearance)},link:survey.questions[0].type===types.I9.Link?survey.questions[0].link:void 0,appearance:value||defaultSurveyAppearance})}}):(0,jsx_runtime.jsx)(SurveyAPIEditor,{survey:survey})})]}),(0,jsx_runtime.jsx)(src.LemonDivider,{}),(0,jsx_runtime.jsx)(SurveyReleaseSummary,{id:id,survey:survey,hasTargetingFlag:hasTargetingFlag}),(0,jsx_runtime.jsx)(src.LemonDivider,{}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[(0,jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-survey",type:"secondary",loading:surveyLoading,onClick:()=>{isEditingSurvey?(editingSurvey(!1),loadSurvey()):kea_router_lib.router.actions.push(urls.j.surveys())},children:"Cancel"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-survey",htmlType:"submit",loading:surveyLoading,children:"new"===id?"Save as draft":"Save"})]})]})}function SurveyReleaseSummary(_ref8){let{id:id,survey:survey,hasTargetingFlag:hasTargetingFlag}=_ref8;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col mt-2 gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:"Release conditions summary"}),(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"By default surveys will be released to everyone unless targeting options are set."}),survey.conditions?.url&&(0,jsx_runtime.jsx)("div",{className:"flex flex-col font-medium gap-1",children:(0,jsx_runtime.jsxs)("div",{className:"flex-row",children:[(0,jsx_runtime.jsx)("span",{children:"URL contains:"})," ",(0,jsx_runtime.jsx)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:survey.conditions.url})]})}),survey.conditions?.selector&&(0,jsx_runtime.jsx)("div",{className:"flex flex-col font-medium gap-1",children:(0,jsx_runtime.jsxs)("div",{className:"flex-row",children:[(0,jsx_runtime.jsx)("span",{children:"Selector matches:"})," ",(0,jsx_runtime.jsx)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:survey.conditions.selector})]})}),survey.linked_flag_id&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-row font-medium gap-1",children:[(0,jsx_runtime.jsx)("span",{children:"Feature flag enabled for:"})," ","new"!==id?survey.linked_flag?.id?(0,jsx_runtime.jsx)(src.Link,{to:urls.j.featureFlag(survey.linked_flag?.id),children:survey.linked_flag?.key}):null:(0,jsx_runtime.jsx)(EarlyAccessFeature.FlagSelector,{value:survey.linked_flag_id,readOnly:!0,onChange:()=>{}})]}),(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:featureFlagLogic.h,props:{id:survey.targeting_flag?.id||"new"},children:hasTargetingFlag&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:"font-medium",children:"User properties:"})," ",(0,jsx_runtime.jsx)(FeatureFlagReleaseConditions.I,{readOnly:!0,excludeTitle:!0})]})})]})}try{SurveyComponent.displayName="SurveyComponent",SurveyComponent.__docgenInfo={description:"",displayName:"SurveyComponent",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#SurveyComponent"]={docgenInfo:SurveyComponent.__docgenInfo,name:"SurveyComponent",path:"frontend/src/scenes/surveys/Survey.tsx#SurveyComponent"})}catch(__react_docgen_typescript_loader_error){}try{SurveyForm.displayName="SurveyForm",SurveyForm.__docgenInfo={description:"",displayName:"SurveyForm",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#SurveyForm"]={docgenInfo:SurveyForm.__docgenInfo,name:"SurveyForm",path:"frontend/src/scenes/surveys/Survey.tsx#SurveyForm"})}catch(__react_docgen_typescript_loader_error){}try{SurveyReleaseSummary.displayName="SurveyReleaseSummary",SurveyReleaseSummary.__docgenInfo={description:"",displayName:"SurveyReleaseSummary",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},survey:{defaultValue:null,description:"",name:"survey",required:!0,type:{name:"Survey | NewSurvey"}},hasTargetingFlag:{defaultValue:null,description:"",name:"hasTargetingFlag",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#SurveyReleaseSummary"]={docgenInfo:SurveyReleaseSummary.__docgenInfo,name:"SurveyReleaseSummary",path:"frontend/src/scenes/surveys/Survey.tsx#SurveyReleaseSummary"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/surveys/surveysLogic.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{k:function(){return surveysLogic},z:function(){return getSurveyStatus}});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/types.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/urls.ts"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),kea_router__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js");function getSurveyStatus(survey){return survey.start_date?survey.end_date?_types__WEBPACK_IMPORTED_MODULE_3__.mN.Complete:_types__WEBPACK_IMPORTED_MODULE_3__.mN.Running:_types__WEBPACK_IMPORTED_MODULE_3__.mN.Draft}const surveysLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","surveys","surveysLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)([scenes_userLogic__WEBPACK_IMPORTED_MODULE_6__.userLogic]),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)((_ref=>{let{values:values}=_ref;return{surveys:{__default:[],loadSurveys:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.surveys.list()).results,deleteSurvey:async id=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.surveys.delete(id),values.surveys.filter((survey=>survey.id!==id))),updateSurvey:async _ref2=>{let{id:id,updatePayload:updatePayload}=_ref2;const updatedSurvey=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.surveys.update(id,{...updatePayload});return values.surveys.map((survey=>survey.id===id?updatedSurvey:survey))}}}})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((()=>({deleteSurveySuccess:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.lemonToast.success("Survey deleted"),kea_router__WEBPACK_IMPORTED_MODULE_7__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.surveys())},updateSurveySuccess:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.lemonToast.success("Survey updated")}}))),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{name:"Surveys",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.surveys()}]],nonArchivedSurveys:[s=>[s.surveys],surveys=>surveys.filter((survey=>!survey.archived))],archivedSurveys:[s=>[s.surveys],surveys=>surveys.filter((survey=>survey.archived))],whitelabelAvailable:[()=>[scenes_userLogic__WEBPACK_IMPORTED_MODULE_6__.userLogic.selectors.user],user=>(user?.organization?.available_features||[]).includes(_types__WEBPACK_IMPORTED_MODULE_3__.P$.WHITE_LABELLING)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((async _ref3=>{let{actions:actions}=_ref3;await actions.loadSurveys()}))]);try{getSurveyStatus.displayName="getSurveyStatus",getSurveyStatus.__docgenInfo={description:"",displayName:"getSurveyStatus",props:{id:{defaultValue:null,description:"UUID",name:"id",required:!0,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"popover"'},{value:'"button"'},{value:'"full_screen"'},{value:'"email"'},{value:'"api"'}]}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"string"}},linked_flag_id:{defaultValue:null,description:"",name:"linked_flag_id",required:!0,type:{name:"number | null"}},linked_flag:{defaultValue:null,description:"",name:"linked_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag:{defaultValue:null,description:"",name:"targeting_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag_filters:{defaultValue:null,description:"",name:"targeting_flag_filters",required:!0,type:{name:'Pick<FeatureFlagFilters, "groups"> | undefined'}},conditions:{defaultValue:null,description:"",name:"conditions",required:!0,type:{name:"{ url: string; selector: string; is_headless?: boolean | undefined; } | null"}},appearance:{defaultValue:null,description:"",name:"appearance",required:!0,type:{name:"SurveyAppearance"}},questions:{defaultValue:null,description:"",name:"questions",required:!0,type:{name:"(BasicSurveyQuestion | LinkSurveyQuestion | RatingSurveyQuestion | MultipleSurveyQuestion)[]"}},created_at:{defaultValue:null,description:"",name:"created_at",required:!0,type:{name:"string"}},created_by:{defaultValue:null,description:"",name:"created_by",required:!0,type:{name:"UserBasicType | null"}},start_date:{defaultValue:null,description:"",name:"start_date",required:!0,type:{name:"string | null"}},end_date:{defaultValue:null,description:"",name:"end_date",required:!0,type:{name:"string | null"}},archived:{defaultValue:null,description:"",name:"archived",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveysLogic.tsx#getSurveyStatus"]={docgenInfo:getSurveyStatus.__docgenInfo,name:"getSurveyStatus",path:"frontend/src/scenes/surveys/surveysLogic.tsx#getSurveyStatus"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/surveys/SurveyAppearance.scss":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".survey-form{color:#000;font-weight:400;font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;text-align:left;z-index:99999;flex-direction:column;background:#fff;border:1px solid #f0f0f0;border-radius:8px;padding-top:5px;max-width:320px;box-shadow:-6px 0 16px -8px rgba(0,0,0,.08),-9px 0 28px 0 rgba(0,0,0,.05),-12px 0 48px 16px rgba(0,0,0,.03)}.survey-form .button{width:64px;height:64px;border-radius:100%;text-align:center;line-height:60px;font-size:32px;border:none;cursor:pointer}.survey-form .button:hover{filter:brightness(1.2)}.survey-form .form-submit[disabled]{opacity:.6;filter:grayscale(100%);cursor:not-allowed}.survey-form .survey-box{padding:.5rem 1rem;display:flex;flex-direction:column}.survey-form .survey-question{padding-top:4px;padding-bottom:4px;font-size:16px;font-weight:500;color:#000}.survey-form .question-textarea-wrapper{display:flex;flex-direction:column;padding-bottom:4px}.survey-form .survey-textarea{color:#2d2d2d;font-size:14px;font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;background:#fff;color:#000;border:1px solid;padding-left:10px;padding-right:10px;padding-top:10px;border-radius:6px;margin:.5rem}.survey-form .buttons{display:flex;justify-content:center}.survey-form .form-submit{box-sizing:border-box;margin:0;font-family:inherit;overflow:visible;text-transform:none;line-height:1.5715;position:relative;display:inline-block;font-weight:400;white-space:nowrap;text-align:center;border:1px solid transparent;cursor:pointer;transition:all .3s cubic-bezier(.645,.045,.355,1);-webkit-user-select:none;-moz-user-select:none;user-select:none;touch-action:manipulation;height:32px;padding:4px 15px;font-size:14px;border-radius:4px;outline:0;background:#2c2c2c;color:#e5e7e0;text-shadow:0 -1px 0 rgba(0,0,0,.12);box-shadow:0 2px 0 rgba(0,0,0,.045)}.survey-form .form-submit:hover{filter:brightness(1.2)}.survey-form .form-cancel{background:#fff;float:right;border:none;cursor:pointer}.survey-form .bottom-section{padding-bottom:.5rem}.survey-form .description{font-size:14px;margin-top:.5rem;margin-bottom:.5rem;color:#4b4b52}.survey-form .rating-options{margin-top:.5rem}.survey-form .ratings-number{background-color:#e0e2e8;font-size:14px;border-radius:6px;border:1px solid #e0e2e8;padding:8px}.survey-form .ratings-number:hover{cursor:pointer;filter:brightness(.75)}.survey-form .rating-options-buttons{display:flex;justify-content:space-evenly}.survey-form .max-numbers{min-width:280px}.survey-form .rating-options-emoji{display:flex;justify-content:space-evenly}.survey-form .ratings-emoji{font-size:16px;background-color:transparent;border:none}.survey-form .ratings-emoji:hover{cursor:pointer;fill:coral}.survey-form .rating-text{display:flex;flex-direction:row;font-size:12px;justify-content:space-between;margin-top:.5rem;margin-bottom:.5rem;color:#4b4b52}.survey-form .rating-section{margin-bottom:.5rem}.survey-form .multiple-choice-options{margin-bottom:.5rem;margin-top:.5rem;font-size:14px}.survey-form .multiple-choice-options .choice-option{display:flex;align-items:center;gap:4px;background:rgba(0,0,0,.0117647059);font-size:14px;padding:10px 20px 10px 15px;border:1px solid rgba(0,0,0,.0509803922);border-radius:4px;cursor:pointer;margin-bottom:6px}.survey-form .multiple-choice-options .choice-option:hover{background:rgba(0,0,0,.0392156863)}.survey-form .multiple-choice-options input{cursor:pointer}.survey-form .multiple-choice-options label{width:100%;cursor:pointer}.thank-you-message{border-radius:8px;z-index:99999;box-shadow:-6px 0 16px -8px rgba(0,0,0,.08),-9px 0 28px 0 rgba(0,0,0,.05),-12px 0 48px 16px rgba(0,0,0,.03);font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.thank-you-message .thank-you-message-container{background:#fff;border:1px solid #f0f0f0;border-radius:8px;padding:12px 18px;text-align:center;max-width:320px;min-width:150px}.thank-you-message .thank-you-message-header{font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-weight:600}.thank-you-message .thank-you-message{color:#000}.thank-you-message .thank-you-message-body{padding-bottom:8px;font-size:14px;color:#4b4b52}.footer-branding{color:#6a6b69;font-size:10.5px;padding-top:.5rem;text-align:center}",""]),module.exports=exports}}]);