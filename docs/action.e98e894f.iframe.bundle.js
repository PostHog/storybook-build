(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{5623:function(module,__webpack_exports__,__webpack_require__){"use strict";var _EventDetails__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1764);__webpack_require__.d(__webpack_exports__,"a",(function(){return _EventDetails__WEBPACK_IMPORTED_MODULE_0__.a}));__webpack_require__(1762),__webpack_require__(1761);var _EventsTable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1763);__webpack_require__.d(__webpack_exports__,"b",(function(){return _EventsTable__WEBPACK_IMPORTED_MODULE_3__.a}));__webpack_require__(1759),__webpack_require__(1765)},6092:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Action",(function(){return Action}));__webpack_require__(42),__webpack_require__(35),__webpack_require__(49);var regenerator=__webpack_require__(8),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(66),__webpack_require__(15)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),react=__webpack_require__(0),react_default=__webpack_require__.n(react),toConsumableArray=(__webpack_require__(40),__webpack_require__(58),__webpack_require__(33),__webpack_require__(61),__webpack_require__(19)),toConsumableArray_default=__webpack_require__.n(toConsumableArray),defineProperty=__webpack_require__(5),defineProperty_default=__webpack_require__.n(defineProperty),slicedToArray=__webpack_require__(16),slicedToArray_default=__webpack_require__.n(slicedToArray),utils=__webpack_require__(12),Link=__webpack_require__(62),index_esm=__webpack_require__(3),api=(__webpack_require__(598),__webpack_require__(92),__webpack_require__(319),__webpack_require__(22)),react_toastify=__webpack_require__(63),actionsModel=__webpack_require__(367),actionEditLogic=Object(index_esm.kea)({props:{},key:function key(props){return props.id||"new"},actions:function actions(){return{saveAction:!0,setAction:function setAction(action){return{action:action}},setCreateNew:function setCreateNew(createNew){return{createNew:createNew}},actionAlreadyExists:function actionAlreadyExists(actionId){return{actionId:actionId}}}},reducers:function reducers(_ref){return{action:[_ref.props.action,{setAction:function setAction(_,_ref2){return _ref2.action}}],errorActionId:[null,{saveAction:function saveAction(){return null},actionAlreadyExists:function actionAlreadyExists(_,_ref3){return _ref3.actionId}}],createNew:[!1,{setCreateNew:function setCreateNew(_,_ref4){return _ref4.createNew}}]}},loaders:function loaders(_ref5){var _loadActionCount,props=_ref5.props;return{actionCount:{loadActionCount:(_loadActionCount=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,api.a.get("api/action/"+props.id+"/count");case 2:return _context.abrupt("return",_context.sent.count);case 3:case"end":return _context.stop()}}),_callee)}))),function loadActionCount(){return _loadActionCount.apply(this,arguments)})}}},listeners:function listeners(_ref6){var _saveAction,values=_ref6.values,props=_ref6.props,actions=_ref6.actions;return{saveAction:(_saveAction=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(){var action,token;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if((action=Object.assign({},values.action)).steps=action.steps?action.steps.filter((function(step){return step.event})):[],_context2.prev=2,token=props.temporaryToken?"?temporary_token="+props.temporaryToken:"",!action.id){_context2.next=10;break}return _context2.next=7,api.a.update("api/action/"+action.id+"/"+token,action);case 7:action=_context2.sent,_context2.next=13;break;case 10:return _context2.next=12,api.a.create("api/action/"+token,action);case 12:action=_context2.sent;case 13:_context2.next=23;break;case 15:if(_context2.prev=15,_context2.t0=_context2.catch(2),"unique"!==_context2.t0.code){_context2.next=22;break}return actions.actionAlreadyExists(_context2.t0.detail.split(" ").pop()),_context2.abrupt("return");case 22:throw _context2.t0;case 23:Object(react_toastify.c)("Action saved"),props.onSave(action,values.createNew),actionsModel.a.actions.loadActions();case 26:case"end":return _context2.stop()}}),_callee2,null,[[2,15]])}))),function saveAction(){return _saveAction.apply(this,arguments)})}},events:function events(_ref7){var _afterMount,actions=_ref7.actions,props=_ref7.props;return{afterMount:(_afterMount=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(){return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:props.id?actions.loadActionCount():actions.setAction({name:"",steps:[{isNew:Object(utils.rb)()}]});case 1:case"end":return _context3.stop()}}),_callee3)}))),function afterMount(){return _afterMount.apply(this,arguments)})}},path:function path(key){return["scenes","actions","actionEditLogic",key]}}),EventName=(__webpack_require__(866),__webpack_require__(2415)),EditAppUrls=__webpack_require__(1089),AppEditorLink_utils=__webpack_require__(378),teamLogic=__webpack_require__(53),es_button=__webpack_require__(113),modal=__webpack_require__(2566);function AppEditorLink(_ref){var _currentTeam$app_urls,actionId=_ref.actionId,style=_ref.style,children=_ref.children,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),modalOpen=_useState2[0],setModalOpen=_useState2[1],currentTeam=Object(index_esm.useValues)(teamLogic.a).currentTeam;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(es_button.a,{href:Object(AppEditorLink_utils.a)(null==currentTeam||null===(_currentTeam$app_urls=currentTeam.app_urls)||void 0===_currentTeam$app_urls?void 0:_currentTeam$app_urls[0],actionId),style:style,size:"small",onClick:function onClick(e){e.preventDefault(),setModalOpen(!0)}},children),react_default.a.createElement(modal.a,{visible:modalOpen,title:actionId?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:react_default.a.createElement(es_button.a,{onClick:function onClick(){return setModalOpen(!1)}},"Close"),onCancel:function onCancel(){return setModalOpen(!1)}},react_default.a.createElement(EditAppUrls.a,{actionId:actionId,allowNavigation:!0})))}try{AppEditorLink.displayName="AppEditorLink",AppEditorLink.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:AppEditorLink.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(__react_docgen_typescript_loader_error){}var PropertyFilters=__webpack_require__(284),Tooltip=__webpack_require__(54),hints=__webpack_require__(1656),typography=__webpack_require__(5484),col=__webpack_require__(230),card=__webpack_require__(5518),input=__webpack_require__(695),space=__webpack_require__(5522),es_radio=__webpack_require__(1143),ExportOutlined=__webpack_require__(5575),InfoCircleOutlined=__webpack_require__(682);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var Text=typography.a.Text,learnMoreLink="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function ActionStep(_ref){var step=_ref.step,actionId=_ref.actionId,isOnlyStep=_ref.isOnlyStep,index=_ref.index,identifier=_ref.identifier,onDelete=_ref.onDelete,onChange=_ref.onChange,sendStep=function sendStep(stepToSend){onChange(stepToSend)};return react_default.a.createElement(col.a,{span:24,md:12},react_default.a.createElement(card.a,{className:"action-step",style:{overflow:"visible"}},index>0&&react_default.a.createElement("div",{className:"stateful-badge pos-center-end or"},"OR"),react_default.a.createElement("div",null,!isOnlyStep&&react_default.a.createElement("div",{className:"remove-wrapper"},react_default.a.createElement("button",{type:"button","aria-label":"delete",onClick:onDelete},react_default.a.createElement("span",{"aria-hidden":"true"},"Ã—"))),react_default.a.createElement("div",{className:"mb"},react_default.a.createElement("b",null,"Match Group #",index+1)),react_default.a.createElement(TypeSwitcher,{step:step,sendStep:sendStep}),react_default.a.createElement("div",{style:{marginTop:"$pageview"===step.event?20:8,paddingBottom:0}},"$autocapture"===step.event&&react_default.a.createElement(AutocaptureFields,{step:step,sendStep:sendStep,actionId:actionId}),null!=step.event&&"$autocapture"!==step.event&&"$pageview"!==step.event&&react_default.a.createElement("div",{style:{marginTop:"2rem"}},react_default.a.createElement("label",null,react_default.a.createElement("b",null,"Event name: ")),react_default.a.createElement(EventName.a,{value:step.event,isActionStep:!0,onChange:function onChange(value){return sendStep(_objectSpread(_objectSpread({},step),{},{event:value||""}))}})),"$pageview"===step.event&&react_default.a.createElement("div",null,react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"url",extra_options:react_default.a.createElement(URLMatching,{step:step,sendStep:sendStep}),label:"URL"}),step.url_matching&&step.url_matching in hints.a&&react_default.a.createElement("small",{style:{display:"block",marginTop:-12}},hints.a[step.url_matching])),step.event&&react_default.a.createElement("div",{className:"property-filters"},react_default.a.createElement("h3",{className:"l3"},"Filters"),(!step.properties||0===step.properties.length)&&react_default.a.createElement("div",{className:"text-muted"},"This match group has no additional filters."),react_default.a.createElement(PropertyFilters.a,{propertyFilters:step.properties,pageKey:identifier,onChange:function onChange(properties){sendStep(_objectSpread(_objectSpread({},step),{},{properties:properties}))},showConditionBadge:!0}))))))}function Option(props){var onOptionChange=function onOptionChange(e){return props.sendStep(_objectSpread(_objectSpread({},props.step),{},defineProperty_default()({},props.item,e.target.value||null)))};return react_default.a.createElement("div",{className:"mb"},react_default.a.createElement("label",{style:{fontWeight:"bold"}},props.label," ",props.extra_options),props.caption&&react_default.a.createElement("div",{className:"action-step-caption"},props.caption),"selector"===props.item?react_default.a.createElement(input.a.TextArea,{allowClear:!0,onChange:onOptionChange,value:props.step[props.item]||"",placeholder:props.placeholder}):react_default.a.createElement(input.a,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:onOptionChange,value:props.step[props.item]||"",placeholder:props.placeholder}))}function AutocaptureFields(_ref2){var step=_ref2.step,actionId=_ref2.actionId,sendStep=_ref2.sendStep,AndC=function AndC(){return react_default.a.createElement("div",{className:"text-center"},react_default.a.createElement("span",{className:"stateful-badge and"},"AND"))};return react_default.a.createElement("div",null,react_default.a.createElement("span",null,react_default.a.createElement(AppEditorLink,{actionId:actionId,style:{margin:"1rem 0"}},"Select element on site ",react_default.a.createElement(ExportOutlined.a,null)),react_default.a.createElement("a",{href:"".concat(learnMoreLink,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8}},"See documentation.")," "),react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"href",label:"Link target equals",caption:react_default.a.createElement(react_default.a.Fragment,null,"If your element is a link, the location that the link opens (",react_default.a.createElement("code",null,"href")," tag)")}),react_default.a.createElement(AndC,null),react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"text",label:"Text equals",caption:"Text content inside your element"}),react_default.a.createElement(AndC,null),react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"selector",label:react_default.a.createElement(react_default.a.Fragment,null,"HTML selector matches",react_default.a.createElement(Tooltip.a,{title:"Click here to learn more about supported selectors"},react_default.a.createElement("a",{href:"".concat(learnMoreLink,"#matching-selectors"),target:"_blank",rel:"noopener"},react_default.a.createElement(InfoCircleOutlined.a,{style:{marginLeft:4}})))),placeholder:'button[data-attr="my-id"]',caption:react_default.a.createElement(space.b,{direction:"vertical"},react_default.a.createElement(Text,{style:{color:"var(--muted)"}},"CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",react_default.a.createElement(Text,{code:!0},'[data-attr="signup"]')))}),react_default.a.createElement("div",{style:{marginBottom:18}},react_default.a.createElement(AndC,null)),react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"url",extra_options:react_default.a.createElement(URLMatching,{step:step,sendStep:sendStep}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(null==step?void 0:step.url_matching)&&step.url_matching in hints.a&&react_default.a.createElement("small",{style:{display:"block",marginTop:-12}},hints.a[step.url_matching]))}function TypeSwitcher(_ref3){var step=_ref3.step,sendStep=_ref3.sendStep;return react_default.a.createElement("div",{className:"type-switcher".concat(void 0===step.event?" unselected":"")},react_default.a.createElement(es_radio.a.Group,{buttonStyle:"solid",onChange:function handleChange(e){var type=e.target.value;"$autocapture"===type?sendStep(_objectSpread(_objectSpread({},step),{},{event:"$autocapture"})):"event"===type?sendStep(_objectSpread(_objectSpread({},step),{},{event:""})):"$pageview"===type&&sendStep(_objectSpread(_objectSpread({},step),{},{event:"$pageview",url:step.url}))},value:"$autocapture"===step.event||"$pageview"===step.event||void 0===step.event?step.event:"event"},react_default.a.createElement(es_radio.a.Button,{value:"$autocapture"},"Autocapture"),react_default.a.createElement(es_radio.a.Button,{value:"event"},"Custom event"),react_default.a.createElement(es_radio.a.Button,{value:"$pageview"},"Page view")))}function URLMatching(_ref4){var step=_ref4.step,sendStep=_ref4.sendStep;return react_default.a.createElement(es_radio.a.Group,{buttonStyle:"solid",onChange:function handleURLMatchChange(e){sendStep(_objectSpread(_objectSpread({},step),{},{url_matching:e.target.value}))},value:step.url_matching||"contains",size:"small"},react_default.a.createElement(es_radio.a.Button,{value:"contains"},"contains"),react_default.a.createElement(es_radio.a.Button,{value:"regex"},"matches regex"),react_default.a.createElement(es_radio.a.Button,{value:"exact"},"matches exactly"))}try{ActionStep.displayName="ActionStep",ActionStep.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:ActionStep.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(__react_docgen_typescript_loader_error){}var row=__webpack_require__(353),DeleteOutlined=__webpack_require__(5497),LoadingOutlined=__webpack_require__(370),PlusOutlined=__webpack_require__(1755),SaveOutlined=__webpack_require__(5585),lib=__webpack_require__(21),PageHeader=__webpack_require__(209),PreflightCheck_logic=__webpack_require__(56),dayjs_min=__webpack_require__(30),dayjs_min_default=__webpack_require__.n(dayjs_min),urls=__webpack_require__(34);function ActionEdit_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function ActionEdit_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ActionEdit_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ActionEdit_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function ActionEdit(_ref){var loadedAction=_ref.action,actionId=_ref.actionId,_onSave=_ref.onSave,temporaryToken=_ref.temporaryToken,logic=actionEditLogic({id:actionId,action:loadedAction,onSave:function onSave(action,createNew){return _onSave(action,!actionId,createNew)},temporaryToken:temporaryToken}),_useValues=Object(index_esm.useValues)(logic),action=_useValues.action,errorActionId=_useValues.errorActionId,actionCount=_useValues.actionCount,actionCountLoading=_useValues.actionCountLoading,_useActions=Object(index_esm.useActions)(logic),setAction=_useActions.setAction,saveAction=_useActions.saveAction,loadActions=Object(index_esm.useActions)(actionsModel.a).loadActions,preflight=Object(index_esm.useValues)(PreflightCheck_logic.a).preflight,currentTeam=Object(index_esm.useValues)(teamLogic.a).currentTeam,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),edited=_useState2[0],setEdited=_useState2[1],slackEnabled=null==currentTeam?void 0:currentTeam.slack_incoming_webhook,newAction=function newAction(){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{steps:[].concat(toConsumableArray_default()(action.steps),[{isNew:Object(utils.rb)()}])}))},addGroup=react_default.a.createElement(es_button.a,{onClick:newAction,size:"small"},"Add another match group"),deleteAction=actionId?react_default.a.createElement(es_button.a,{"data-attr":"delete-action",danger:!0,icon:react_default.a.createElement(DeleteOutlined.a,null),onClick:function onClick(){Object(utils.r)({endpoint:"action",object:action,callback:function callback(){lib.router.actions.push("/events/actions"),loadActions()}})}},"Delete"):void 0;return react_default.a.createElement("div",{className:"action-edit-container"},react_default.a.createElement(PageHeader.a,{title:actionId?"Editing action":"Creating action",buttons:deleteAction}),react_default.a.createElement("form",{onSubmit:function onSubmit(e){e.preventDefault(),saveAction()}},react_default.a.createElement("div",{className:"input-set"},react_default.a.createElement("label",{htmlFor:"actionName"},"Action name"),react_default.a.createElement(input.a,{required:!0,placeholder:"e.g. user account created, purchase completed, movie watched",value:action.name,style:{maxWidth:500,display:"block"},onChange:function onChange(e){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{name:e.target.value})),setEdited(!!e.target.value)},"data-attr":"edit-action-input",id:"actionName"}),actionId&&react_default.a.createElement("div",null,react_default.a.createElement("span",{className:"text-muted mb-05"},actionCountLoading&&react_default.a.createElement(LoadingOutlined.a,null),null!==actionCount&&actionCount>-1&&react_default.a.createElement(react_default.a.Fragment,null,"This action matches ",react_default.a.createElement("b",null,Object(utils.m)(actionCount))," events","clickhouse"!==preflight.db_backend&&react_default.a.createElement(react_default.a.Fragment,null," ","(last calculated"," ",action.last_calculated_at?react_default.a.createElement("b",null,dayjs_min_default()(action.last_calculated_at).fromNow()):"a while ago",")"))))),react_default.a.createElement("div",{className:"match-group-section",style:{overflow:"visible"}},react_default.a.createElement("h2",{className:"subtitle"},"Match groups"),react_default.a.createElement("div",null,"Your action will be triggered whenever ",react_default.a.createElement("b",null,"any of your match groups")," are received."," ",react_default.a.createElement("a",{href:"https://posthog.com/docs/features/actions",target:"_blank"},react_default.a.createElement(InfoCircleOutlined.a,null))),react_default.a.createElement("div",{style:{textAlign:"right",marginBottom:12}},addGroup),react_default.a.createElement(row.a,{gutter:[24,24]},action.steps.map((function(step,index){return react_default.a.createElement(ActionStep,{key:step.id||step.isNew,identifier:step.id||step.isNew,index:index,step:step,isEditor:!1,actionId:action.id,isOnlyStep:1===action.steps.length,onDelete:function onDelete(){var identifier=step.id?"id":"isNew";setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{steps:action.steps.filter((function(s){return s[identifier]!==step[identifier]}))})),setEdited(!0)},onChange:function onChange(newStep){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{steps:action.steps.map((function(s){return step.id&&s.id==step.id||step.isNew&&s.isNew===step.isNew?ActionEdit_objectSpread({id:step.id,isNew:step.isNew},newStep):s}))})),setEdited(!0)}})})),react_default.a.createElement(col.a,{span:24,md:12},react_default.a.createElement("div",{className:"match-group-add-skeleton",onClick:newAction},react_default.a.createElement(PlusOutlined.a,{style:{fontSize:28,color:"#666666"}}))))),react_default.a.createElement("div",null,react_default.a.createElement("div",{style:{margin:"1rem 0"}},react_default.a.createElement("p",null,react_default.a.createElement("input",{id:"webhook-checkbox",type:"checkbox",onChange:function onChange(e){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{post_to_slack:e.target.checked})),setEdited(!0)},checked:!!action.post_to_slack,disabled:!slackEnabled}),react_default.a.createElement("label",{className:slackEnabled?"":"disabled",style:{marginLeft:"0.5rem",marginBottom:"0.5rem"},htmlFor:"webhook-checkbox"},"Post to webhook when this action is triggered.")," ",react_default.a.createElement(Link.a,{to:"/project/settings#webhook"},slackEnabled?"Configure":"Enable"," this integration in Setup.")),action.post_to_slack&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(input.a,{addonBefore:"Message format (optional)",placeholder:"Default: [action.name] triggered by [user.name]",value:action.slack_message_format,onChange:function onChange(e){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{slack_message_format:e.target.value})),setEdited(!0)},disabled:!slackEnabled||!action.post_to_slack,"data-attr":"edit-slack-message-format"}),react_default.a.createElement("small",null,react_default.a.createElement("a",{href:"https://posthog.com/docs/integrations/message-formatting/",target:"_blank",rel:"noopener noreferrer"},"See documentation on how to format webhook messages."))))),errorActionId&&react_default.a.createElement("p",{className:"text-danger"},"Action with this name already exists."," ",react_default.a.createElement("a",{href:urls.a.action(errorActionId)},"Click here to edit.")),react_default.a.createElement("div",{className:"float-right"},react_default.a.createElement("span",{"data-attr":"delete-action-bottom"},deleteAction),react_default.a.createElement(es_button.a,{disabled:!edited,"data-attr":"save-action-button",type:"primary",icon:react_default.a.createElement(SaveOutlined.a,null),onClick:saveAction,style:{marginLeft:16}},"Save action"))))}var eventsTableLogic=__webpack_require__(1759),spin=__webpack_require__(589),scenes_events=__webpack_require__(5623),actionLogic=Object(index_esm.kea)({key:function key(props){return props.id||"new"},actions:function actions(){return{checkIsFinished:function checkIsFinished(action){return{action:action}},setPollTimeout:function setPollTimeout(pollTimeout){return{pollTimeout:pollTimeout}},setIsComplete:function setIsComplete(isComplete){return{isComplete:isComplete}}}},reducers:function reducers(){return{pollTimeout:[null,{setPollTimeout:function setPollTimeout(_,_ref){return _ref.pollTimeout}}],isComplete:[!1,{setIsComplete:function setIsComplete(_,_ref2){return _ref2.isComplete}}]}},loaders:function loaders(_ref3){var _loadAction,actions=_ref3.actions,props=_ref3.props;return{action:{loadAction:(_loadAction=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var action;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return actions.setIsComplete(!1),_context.next=3,api.a.get("api/action/"+props.id);case 3:return action=_context.sent,actions.checkIsFinished(action),_context.abrupt("return",action);case 6:case"end":return _context.stop()}}),_callee)}))),function loadAction(){return _loadAction.apply(this,arguments)})}}},listeners:function listeners(_ref4){var actions=_ref4.actions,props=_ref4.props,values=_ref4.values;return{checkIsFinished:function checkIsFinished(_ref5){_ref5.action.is_calculating?actions.setPollTimeout(setTimeout((function(){return actions.loadAction()}),1e3)):(props.onComplete(),actions.setIsComplete(new Date),clearTimeout(values.pollTimeout))}}},events:function events(_ref6){var _afterMount,values=_ref6.values,actions=_ref6.actions,props=_ref6.props;return{afterMount:(_afterMount=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(){return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:props.id&&actions.loadAction();case 1:case"end":return _context2.stop()}}),_callee2)}))),function afterMount(){return _afterMount.apply(this,arguments)}),beforeUnmount:function beforeUnmount(){clearTimeout(values.pollTimeout)}}},path:function path(key){return["scenes","actions","Action",key]}});function Action(_ref7){var id=_ref7.id,fixedFilters={action_id:id},push=Object(index_esm.useActions)(lib.router).push,fetchEvents=Object(index_esm.useActions)(Object(eventsTableLogic.a)({fixedFilters:fixedFilters})).fetchEvents,_useValues=Object(index_esm.useValues)(actionLogic({id:id,onComplete:fetchEvents})),isComplete=_useValues.isComplete,action=_useValues.action,loadAction=Object(index_esm.useActions)(actionLogic({id:id,onComplete:fetchEvents})).loadAction,preflight=Object(index_esm.useValues)(PreflightCheck_logic.a).preflight,isClickHouseEnabled=!!(null==preflight?void 0:preflight.is_clickhouse_enabled);return react_default.a.createElement("div",null,(!id||action)&&react_default.a.createElement(ActionEdit,{apiURL:"",actionId:id,action:action,onSave:function onSave(savedAction){id||push(urls.a.action(savedAction.id)),loadAction()}}),id&&!isComplete&&react_default.a.createElement("div",{style:{marginBottom:"10rem"}},react_default.a.createElement("h2",{className:"subtitle"},"Events"),react_default.a.createElement(spin.a,{style:{marginRight:12}}),"Calculating action, please hold on."),isComplete&&react_default.a.createElement("div",{style:{marginTop:86}},isClickHouseEnabled?null:react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("h2",{className:"subtitle"},"Event List"),react_default.a.createElement("p",{className:"text-muted"},"List of the events that match this action."," ",action&&react_default.a.createElement(react_default.a.Fragment,null,"This list was"," ",react_default.a.createElement("b",null,"calculated"," ",action.last_calculated_at?dayjs_min_default()(action.last_calculated_at).fromNow():"a while ago")))," "),id&&react_default.a.createElement(scenes_events.b,{key:isComplete,fixedFilters:fixedFilters,filtersEnabled:!1})))}}}]);