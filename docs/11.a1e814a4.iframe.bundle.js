(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"./frontend/src/scenes/session-recordings/SessionRecordingsTable.tsx":function(J,j,e){"use strict";e.d(j,"a",function(){return R});var X=e("./node_modules/core-js/modules/es.array.filter.js"),Re=e("./node_modules/react/index.js"),o=e.n(Re),L=e("./node_modules/kea/lib/index.esm.js"),se=e("./frontend/src/lib/utils.tsx"),D=e("./node_modules/antd/es/row/index.js"),W=e("./node_modules/antd/es/col/index.js"),Y=e("./node_modules/antd/es/button/index.js"),G=e("./node_modules/antd/es/typography/index.js"),Oe=e("./frontend/src/scenes/session-recordings/sessionRecordingsTableLogic.ts"),oe=e("./node_modules/@ant-design/icons/es/icons/PlayCircleOutlined.js"),M=e("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),ae=e("./node_modules/@ant-design/icons/es/icons/CalendarOutlined.js"),Z=e("./frontend/src/scenes/session-recordings/SessionPlayerDrawer.tsx"),ie=e("./frontend/src/scenes/insights/ActionFilter/ActionFilter.tsx"),$=e("./node_modules/@ant-design/icons/es/icons/LeftOutlined.js"),le=e("./node_modules/@ant-design/icons/es/icons/RightOutlined.js"),k=e("./frontend/src/types.ts"),ce=e("./node_modules/antd/es/space/index.js"),de=e("./node_modules/antd/es/input/index.js"),x=e("./node_modules/antd/es/select/index.js"),ue=e("./frontend/src/lib/components/PropertyFilters/components/OperatorValueSelect.tsx"),me=e("./frontend/src/lib/components/Popup/Popup.tsx"),fe=e("./node_modules/core-js/modules/es.array.iterator.js"),q=e("./node_modules/core-js/modules/es.array.slice.js"),De=e("./node_modules/core-js/modules/es.object.to-string.js"),ge=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),A;(function(a){a.SECONDS="seconds",a.MINUTES="minutes",a.HOURS="hours"})(A||(A={}));var I={seconds:1,minutes:60,hours:3600},pe=Object(L.kea)({path:function(i){return["scenes","session-recordings","DurationFilterLogic",i]},key:function(i){return i.pageKey||"global"},props:{},actions:{setTimeValue:function(i){return{timeValue:i}},setUnit:function(i){return{unit:i}},setIsOpen:function(i){return{isOpen:i}},setOperator:function(i){return{operator:i}}},reducers:function(i){var l,c=i.props;return{unit:[A.MINUTES,{setUnit:function(u,d){var m=d.unit;return m}}],operator:[c==null||(l=c.initialFilter)===null||l===void 0?void 0:l.operator,{setOperator:function(u,d){var m=d.operator;return m}}],timeValue:[Math.floor(c.initialFilter.value/I[A.MINUTES]),{setTimeValue:function(u,d){var m=d.timeValue;return m}}],isOpen:[!1,{setIsOpen:function(u,d){var m=d.isOpen;return m}}]}},selectors:{durationString:[function(a){return[a.operator,a.timeValue,a.unit]},function(a,i,l){var c="";return a===k.z.GreaterThan?c+="> ":c+="< ",c+=i,i===1?c+=" "+l.slice(0,-1):c+=" "+l,c}]},listeners:function(i){var l=i.props,c=i.values,g=function(d){var m=d.timeValue,w=d.unit,z=d.operator,h=m||c.timeValue,B=w||c.unit,V=h*I[B];l.onChange({operator:z||c.operator,value:V,type:"recording",key:"duration"})};return{setTimeValue:function(d){var m=d.timeValue;return g({timeValue:m})},setUnit:function(d){var m=d.unit;return g({unit:m})},setOperator:function(d){var m=d.operator;return g({operator:m})}}}});function U(a){var i=a.initialFilter,l=a.onChange,c=a.pageKey,g=pe({initialFilter:i,onChange:l,pageKey:c}),u=Object(L.useActions)(g),d=u.setTimeValue,m=u.setIsOpen,w=u.setOperator,z=u.setUnit,h=Object(L.useValues)(g),B=h.durationString,V=h.unit,H=h.timeValue,Q=h.operator,Ee=h.isOpen;return o.a.createElement(me.a,{visible:Ee,placement:"bottom-end",fallbackPlacements:["bottom-start"],onClickOutside:function(){return m(!1)},overlay:o.a.createElement(D.a,null,o.a.createElement(ce.b,null,o.a.createElement(ue.a,{operator:Q,operators:[k.z.GreaterThan,k.z.LessThan],onChange:function(v){w(v)}}),o.a.createElement(de.a,{type:"number",value:H,placeholder:"0",min:0,autoFocus:!0,addonAfter:o.a.createElement(x.a,{showSearch:!1,value:V,onChange:function(v){z(v)}},o.a.createElement(x.a.Option,{value:"seconds"},"Seconds"),o.a.createElement(x.a.Option,{value:"minutes"},"Minutes"),o.a.createElement(x.a.Option,{value:"hours"},"Hours")),step:1,onChange:function(v){var Pe=parseFloat(v.target.value);d(Pe)}})))},o.a.createElement(Y.a,{onClick:function(){m(!0)}},B))}try{U.displayName="DurationFilter",U.__docgenInfo={description:"",displayName:"DurationFilter",props:{initialFilter:{defaultValue:null,description:"",name:"initialFilter",required:!0,type:{name:"RecordingDurationFilter"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: RecordingDurationFilter) => void"}},pageKey:{defaultValue:null,description:"",name:"pageKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/session-recordings/DurationFilter.tsx#DurationFilter"]={docgenInfo:U.__docgenInfo,name:"DurationFilter",path:"frontend/src/scenes/session-recordings/DurationFilter.tsx#DurationFilter"})}catch(a){}var ve=e("./frontend/src/scenes/persons/PersonHeader.tsx"),b=e("./frontend/src/lib/utils/eventUsageLogic.ts"),P=e("./frontend/src/lib/components/DateFilter/DateFilter.tsx"),K=e("./frontend/src/lib/components/Tooltip.tsx"),T=e("./frontend/src/lib/components/TaxonomicFilter/types.ts"),ee=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),te=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),ne=e.n(te),ye=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/session-recordings/SessionRecordingTable.scss"),n=e.n(ye),r={};r.insert="head",r.singleton=!1;var s=ne()(n.a,r),t=n.a.locals||{},f=e("./frontend/src/lib/components/LemonTable/index.ts"),E=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),F=e("./frontend/src/lib/components/icons.tsx"),C=e("./frontend/src/lib/components/LemonButton/index.ts"),S=e("./frontend/src/scenes/insights/ActionFilter/ActionFilterRow/ActionFilterRow.tsx");function N(a){var i=a.filter,l=a.propertyFiltersButton,c=a.deleteButton;return o.a.createElement(D.a,{className:"entity-filter-row",wrap:!1,align:"middle"},o.a.createElement(W.a,{flex:"1",className:"mr"},o.a.createElement(D.a,{align:"middle"},i)),o.a.createElement(W.a,{className:"mr"},l),o.a.createElement(W.a,null,c))}function R(a){var i=a.personUUID,l=a.isPersonPage,c=l===void 0?!1:l,g=Object(Oe.a)({personUUID:i}),u=Object(L.useValues)(g),d=u.sessionRecordings,m=u.sessionRecordingsResponseLoading,w=u.sessionRecordingId,z=u.entityFilters,h=u.propertyFilters,B=u.hasNext,V=u.hasPrev,H=u.fromDate,Q=u.toDate,Ee=u.durationFilter,_=u.showFilters,v=Object(L.useActions)(g),Pe=v.openSessionPlayer,Te=v.closeSessionPlayer,Fe=v.setEntityFilters,he=v.setPropertyFilters,be=v.loadNext,Se=v.loadPrev,je=v.setDateRange,Ie=v.setDurationFilter,Ce=v.enableFilter,re=v.reportRecordingsListFilterAdded,_e=[{title:"Start time",render:function(p,O){return o.a.createElement(E.b,{time:O.start_time,formatString:"MMMM DD, YYYY h:mm"})}},{title:"Duration",render:function(p,O){return o.a.createElement("span",null,Object(se.N)(O.recording_duration))}},{title:"Person",key:"person",render:function(p,O){return o.a.createElement(ve.a,{withIcon:!0,person:O.person})}},{render:function(p,O){return o.a.createElement("div",{className:"play-button-container"},o.a.createElement(Y.a,{className:O.viewed?"play-button viewed":"play-button","data-attr":"session-recordings-button",icon:o.a.createElement(oe.a,null)},"Watch recording"))}}];return o.a.createElement("div",{className:"session-recordings-table","data-attr":"session-recordings-table"},o.a.createElement(D.a,{className:"filter-row"},o.a.createElement("div",{className:"filter-container",style:{display:_?void 0:"none"}},o.a.createElement("div",null,o.a.createElement(G.a.Text,{strong:!0},"Filter by events and actions ",o.a.createElement(K.a,{title:"Show recordings where all of the events or actions listed below happen."},o.a.createElement(M.a,{className:"info-icon"}))),o.a.createElement(ie.a,{fullWidth:!0,filters:z,setFilters:function(p){re(b.e.EventAndAction),Fe(p)},typeKey:c?"person-".concat(i):"session-recordings",mathAvailability:S.b.None,buttonCopy:"Add filter",horizontalUI:!0,stripeActionRow:!1,propertyFilterWrapperClassName:"session-recording-action-property-filter",customRowPrefix:"",hideRename:!0,showOr:!0,renderRow:function(p){return o.a.createElement(N,p)},showNestedArrow:!1,actionsTaxonomicGroupTypes:[T.a.Actions,T.a.Events],propertiesTaxonomicGroupTypes:[T.a.EventProperties,T.a.Elements]})),!c&&o.a.createElement("div",{className:"mt-2"},o.a.createElement(G.a.Text,{strong:!0},"Filter by persons and cohorts ",o.a.createElement(K.a,{title:"Show recordings by persons who match the set criteria"},o.a.createElement(M.a,{className:"info-icon"}))),o.a.createElement(ee.a,{popoverPlacement:"bottomRight",pageKey:c?"person-".concat(i):"session-recordings",taxonomicGroupTypes:[T.a.PersonProperties,T.a.Cohorts],propertyFilters:h,onChange:function(p){re(b.e.PersonAndCohort),he(p)}}))),!_&&o.a.createElement(C.a,{type:"secondary",compact:!0,icon:o.a.createElement(F.IconFilter,null),onClick:function(){if(Ce(),c){var p=document.querySelectorAll(".entity-filter-row button");p.length>0&&p[0].click()}}},"Filter recordings"),o.a.createElement(D.a,{className:"time-filter-row"},o.a.createElement(D.a,{className:"time-filter"},o.a.createElement(P.a,{makeLabel:function(p){return o.a.createElement(o.a.Fragment,null,o.a.createElement(ae.a,null),o.a.createElement("span",null," ",p))},defaultValue:"Last 7 days",bordered:!0,dateFrom:H!=null?H:void 0,dateTo:Q!=null?Q:void 0,onChange:function(p,O){re(b.e.DateRange),je(p,O)},dateOptions:{Custom:{values:[]},"Last 24 hours":{values:["-24h"]},"Last 7 days":{values:["-7d"]},"Last 21 days":{values:["-21d"]}}})),o.a.createElement(D.a,{className:"time-filter"},o.a.createElement(G.a.Text,{className:"filter-label"},"Duration"),o.a.createElement(U,{onChange:function(p){re(b.e.Duration),Ie(p)},initialFilter:Ee,pageKey:c?"person-".concat(i):"session-recordings"})))),o.a.createElement(f.a,{dataSource:d,columns:_e,loading:m,onRow:function(p){return{onClick:function(Le){Le.target.closest("a")||Pe(p.id,b.d.RecordingsList)}}},rowClassName:"cursor-pointer","data-attr":"session-recording-table",emptyState:"No matching recordings found"}),(V||B)&&o.a.createElement(D.a,{className:"pagination-control"},o.a.createElement(Y.a,{type:"link",disabled:!V,onClick:function(){Se(),window.scrollTo(0,0)}},o.a.createElement($.a,null)," Previous"),o.a.createElement(Y.a,{type:"link",disabled:!B,onClick:function(){be(),window.scrollTo(0,0)}},"Next ",o.a.createElement(le.a,null))),o.a.createElement("div",{style:{marginBottom:64}}),!!w&&o.a.createElement(Z.a,{isPersonPage:c,onClose:Te}))}try{R.displayName="SessionRecordingsTable",R.__docgenInfo={description:"",displayName:"SessionRecordingsTable",props:{personUUID:{defaultValue:null,description:"",name:"personUUID",required:!1,type:{name:"string"}},isPersonPage:{defaultValue:{value:"false"},description:"",name:"isPersonPage",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/session-recordings/SessionRecordingsTable.tsx#SessionRecordingsTable"]={docgenInfo:R.__docgenInfo,name:"SessionRecordingsTable",path:"frontend/src/scenes/session-recordings/SessionRecordingsTable.tsx#SessionRecordingsTable"})}catch(a){}},"./frontend/src/scenes/session-recordings/sessionRecordingsTableLogic.ts":function(J,j,e){"use strict";e.d(j,"a",function(){return ye});var X=e("./node_modules/core-js/modules/es.array.concat.js"),Re=e.n(X),o=e("./node_modules/core-js/modules/es.array.iterator.js"),L=e.n(o),se=e("./node_modules/core-js/modules/es.array.map.js"),D=e.n(se),W=e("./node_modules/core-js/modules/es.object.to-string.js"),Y=e.n(W),G=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Oe=e.n(G),oe=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),M=e.n(oe),ae=e("./node_modules/@babel/runtime/regenerator/index.js"),Z=e.n(ae),ie=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),$=e.n(ie),le=e("./node_modules/regenerator-runtime/runtime.js"),k=e.n(le),ce=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),de=e.n(ce),x=e("./node_modules/kea/lib/index.esm.js"),ue=e("./frontend/src/lib/api.ts"),me=e("./frontend/src/lib/utils.tsx"),fe=e("./frontend/src/types.ts"),q=e("./node_modules/kea-router/lib/index.js"),De=e.n(q),ge=e("./frontend/src/lib/utils/eventUsageLogic.ts"),A=e("./node_modules/fast-deep-equal/index.js"),I=e.n(A),pe=e("./frontend/src/scenes/teamLogic.ts"),U=e("./frontend/src/lib/dayjs.ts"),ve=e("./frontend/src/lib/utils/getAppContext.ts");function b(n,r){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);r&&(t=t.filter(function(f){return Object.getOwnPropertyDescriptor(n,f).enumerable})),s.push.apply(s,t)}return s}function P(n){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?b(Object(s),!0).forEach(function(t){$()(n,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):b(Object(s)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(s,t))})}return n}var K=50,T={type:"recording",key:"duration",value:60,operator:fe.z.GreaterThan},ee=[],te=Object(ve.b)(),ne={events:[],actions:[],new_entity:[{id:te,type:fe.g.EVENTS,order:0,name:te}]},ye=Object(x.kea)({path:function(r){return["scenes","session-recordings","sessionRecordingsTableLogic",r]},key:function(r){return r.key||r.personUUID||"global"},props:{},connect:{values:[pe.a,["currentTeamId"]],actions:[ge.f,["reportRecordingsListFetched","reportRecordingsListFilterAdded"]]},actions:{getSessionRecordings:!0,openSessionPlayer:function(r,s){return{sessionRecordingId:r,source:s}},closeSessionPlayer:!0,setEntityFilters:function(r){return{filters:r}},setPropertyFilters:function(r){return{filters:r}},loadNext:!0,loadPrev:!0,enableFilter:!0,setOffset:function(r){return{offset:r}},setDateRange:function(r,s){return{incomingFromDate:r,incomingToDate:s}},setDurationFilter:function(r){return{durationFilter:r}}},loaders:function(r){var s=r.props,t=r.values,f=r.actions;return{sessionRecordingsResponse:[{results:[],has_next:!1},{getSessionRecordings:function(){var E=de()(Z.a.mark(function C(S,N){var R,a,i,l,c,g;return Z.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return a=P(P({},t.filterQueryParams),{},{person_uuid:(R=s.personUUID)!==null&&R!==void 0?R:"",limit:K}),i=Object(me.yb)(a),d.next=4,N(100);case 4:return l=performance.now(),d.next=7,ue.b.get("api/projects/".concat(t.currentTeamId,"/session_recordings?").concat(i));case 7:return c=d.sent,g=performance.now()-l,f.reportRecordingsListFetched(g),N(),d.abrupt("return",c);case 12:case"end":return d.stop()}},C)}));function F(C,S){return E.apply(this,arguments)}return F}()}]}},events:function(r){var s=r.actions;return{afterMount:function(){s.getSessionRecordings()}}},reducers:{filterEnabled:[!1,{enableFilter:function(){return!0}}],sessionRecordings:[[],{getSessionRecordingsSuccess:function(r,s){var t=s.sessionRecordingsResponse;return M()(t.results)},openSessionPlayer:function(r,s){var t=s.sessionRecordingId;return M()(r.map(function(f){return f.id===t?P(P({},f),{},{viewed:!0}):P({},f)}))}}],sessionRecordingId:[null,{openSessionPlayer:function(r,s){var t=s.sessionRecordingId;return t},closeSessionPlayer:function(){return null}}],entityFilters:[ne,{setEntityFilters:function(r,s){var t=s.filters;return P({},t)}}],propertyFilters:[ee,{setPropertyFilters:function(r,s){var t=s.filters;return M()(t)}}],durationFilter:[T,{setDurationFilter:function(r,s){var t=s.durationFilter;return t}}],offset:[0,{loadNext:function(r){return r+K},loadPrev:function(r){return Math.max(r-K)},setOffset:function(r,s){var t=s.offset;return t}}],fromDate:[Object(U.a)().subtract(7,"days").format("YYYY-MM-DD"),{setDateRange:function(r,s){var t=s.incomingFromDate;return t!=null?t:null}}],toDate:[null,{setDateRange:function(r,s){var t=s.incomingToDate;return t!=null?t:null}}]},listeners:function(r){var s=r.actions;return{setEntityFilters:function(){s.getSessionRecordings()},setPropertyFilters:function(){s.getSessionRecordings()},setDateRange:function(){s.getSessionRecordings()},setDurationFilter:function(){s.getSessionRecordings()},loadNext:function(){s.getSessionRecordings()},loadPrev:function(){s.getSessionRecordings()}}},selectors:{hasPrev:[function(n){return[n.offset]},function(n){return n>0}],hasNext:[function(n){return[n.sessionRecordingsResponse]},function(n){return n.has_next}],showFilters:[function(n){return[n.filterEnabled,n.entityFilters,n.propertyFilters]},function(n,r,s){return n||r!==ne||s!==ee}],filterQueryParams:[function(n){return[n.entityFilters,n.fromDate,n.toDate,n.offset,n.durationFilter,n.propertyFilters]},function(n,r,s,t,f,E){return{actions:n.actions,events:n.events,properties:E,date_from:r,date_to:s,offset:t,session_recording_duration:f}}]},actionToUrl:function(r){var s=r.values,t=function(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=arguments.length>1?arguments[1]:void 0,C=P({filters:s.filterQueryParams},E),S=P({},q.router.values.hashParams);return s.sessionRecordingId?S.sessionRecordingId=s.sessionRecordingId:delete S.sessionRecordingId,[q.router.values.location.pathname,C,S,{replace:F}]};return{loadSessionRecordings:function(){return t({},!0)},openSessionPlayer:function(E){var F=E.source;return t({source:F},!1)},closeSessionPlayer:function(){return t({},!1)},setEntityFilters:function(){return t({},!0)},setPropertyFilters:function(){return t({},!0)},setDateRange:function(){return t({},!0)},setDurationFilter:function(){return t({},!0)},loadNext:function(){return t({},!0)},loadPrev:function(){return t({},!0)}}},urlToAction:function(r){var s=r.actions,t=r.values,f=r.props,E=function(S,N,R){var a,i=(a=R.sessionRecordingId)!==null&&a!==void 0?a:null;i!==t.sessionRecordingId&&s.openSessionPlayer(i,ge.d.Direct);var l=N.filters;if(l){if((!I()(l.actions,t.entityFilters.actions)||!I()(l.events,t.entityFilters.events))&&s.setEntityFilters({events:l.events||[],actions:l.actions||[]}),!I()(l.properties,t.propertyFilters)){var c;s.setPropertyFilters((c=l.properties)!==null&&c!==void 0?c:[])}if(l.date_from!==t.fromDate||l.date_to!==t.toDate){var g,u;s.setDateRange((g=l.date_from)!==null&&g!==void 0?g:void 0,(u=l.date_to)!==null&&u!==void 0?u:void 0)}if(l.offset!==t.offset){var d;s.setOffset((d=l.offset)!==null&&d!==void 0?d:0)}if(!I()(l.session_recording_duration,t.durationFilter)){var m;s.setDurationFilter((m=l.session_recording_duration)!==null&&m!==void 0?m:T)}}},F=f.personUUID?"/person/*":"/recordings";return $()({},F,E)}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/session-recordings/SessionRecordingTable.scss":function(J,j,e){var X=e("./node_modules/css-loader/dist/runtime/api.js");j=X(!1),j.push([J.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.session-recordings-table .filter-row{width:100%;justify-content:space-between;margin-bottom:1rem;align-items:flex-end}.session-recordings-table .filter-container{max-width:700px;padding:1rem;border:1px solid rgba(0,0,0,.15);flex:1;border-radius:4px}.session-recordings-table .filter-section{padding-bottom:1rem}.session-recordings-table .session-recording-action-property-filter{margin:0 0 0 68px;background-color:#fafafa;border:1px solid rgba(0,0,0,.15);border-top:0 solid rgba(0,0,0,.15);padding:.25rem 1rem}.session-recordings-table .time-filter-row{justify-content:flex-end;align-items:flex-end}.session-recordings-table .time-filter-row .time-filter{align-items:center;margin-left:1rem}.session-recordings-table .time-filter-row .time-filter .filter-label{margin-right:4px}.session-recordings-table .pagination-control{margin:1rem;justify-content:center}.session-recordings-table .entity-filter-row{width:100%;padding:1rem;border:1px solid rgba(0,0,0,.15);margin-top:1rem;border-radius:4px}.session-recordings-table .play-button-container{display:flex;justify-content:flex-end}.session-recordings-table .play-button-container .play-button .anticon-play-circle{color:#5375ff}.session-recordings-table .play-button-container .play-button.viewed .anticon-play-circle{color:rgba(0,0,0,.5)}.session-recordings-table .info-icon{color:#5375ff}",""]),J.exports=j}}]);
