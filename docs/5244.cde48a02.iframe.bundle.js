"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[5244],{"./frontend/src/scenes/debug/DebugScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DebugScene:()=>DebugScene,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),examples=__webpack_require__("./frontend/src/queries/examples.ts");const DEFAULT_QUERY=examples.Os.HogQLRaw,debugSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","query","debugSceneLogic"]),(0,index_esm.actions)({setQuery:query=>({query})}),(0,index_esm.reducers)({query:[DEFAULT_QUERY,{setQuery:(_,_ref)=>{let{query}=_ref;return query}}]}),(0,lib.actionToUrl)({setQuery:_ref2=>{let{query}=_ref2;return[urls.j.debugQuery(),{},{q:query},{replace:!0}]}}),(0,lib.urlToAction)((_ref3=>{let{actions,values}=_ref3;return{[urls.j.debugQuery()]:(_,__,_ref4)=>{let{q}=_ref4;q&&q!==values.query&&actions.setQuery(q)}}}))]);var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),LemonSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),LemonLabel=__webpack_require__("./frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),HogQLQueryEditor=__webpack_require__("./frontend/src/queries/nodes/HogQLQuery/HogQLQueryEditor.tsx"),DateRange=__webpack_require__("./frontend/src/queries/nodes/DataNode/DateRange.tsx"),EventPropertyFilters=__webpack_require__("./frontend/src/queries/nodes/EventsNode/EventPropertyFilters.tsx"),dataNodeLogic=__webpack_require__("./frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),ElapsedTime=__webpack_require__("./frontend/src/queries/nodes/DataNode/ElapsedTime.tsx"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),CodeEditors=__webpack_require__("./frontend/src/lib/components/CodeEditors.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function HogQLDebug(_ref){let{query,setQuery}=_ref;const dataNodeLogicProps={query,key:"debug-scene"},{dataLoading,response,responseErrorObject,elapsedTime}=(0,index_esm.useValues)((0,dataNodeLogic.M)(dataNodeLogicProps));return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeLogic.M,props:dataNodeLogicProps,children:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)(HogQLQueryEditor.n,{query,setQuery}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(DateRange.C,{query,setQuery},"date-range"),(0,jsx_runtime.jsx)(EventPropertyFilters.H,{query,setQuery},"event-property")]}),dataLoading?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Running query..."}),(0,jsx_runtime.jsxs)("div",{className:"flex",children:["Time elapsed: ",(0,jsx_runtime.jsx)(ElapsedTime.W,{})]})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[response?.hogql?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Executed HogQL"}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.SQL,wrap:!0,children:response.hogql})]}):null,response?.clickhouse?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Executed ClickHouse SQL"}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.SQL,wrap:!0,children:response.clickhouse})]}):null,response?.timings&&null!==elapsedTime?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Time spent"}),(0,jsx_runtime.jsx)(ElapsedTime.F,{timings:response.timings,elapsedTime})]}):null,(0,jsx_runtime.jsx)("h2",{children:"Raw response"}),(0,jsx_runtime.jsx)(CodeEditors.p,{className:"border",language:"json",value:JSON.stringify(null!=response?response:responseErrorObject,null,2),height:800})]})]})})}try{HogQLDebug.displayName="HogQLDebug",HogQLDebug.__docgenInfo={description:"",displayName:"HogQLDebug",props:{query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"HogQLQuery"}},setQuery:{defaultValue:null,description:"",name:"setQuery",required:!0,type:{name:"(query: DataNode) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/debug/HogQLDebug.tsx#HogQLDebug"]={docgenInfo:HogQLDebug.__docgenInfo,name:"HogQLDebug",path:"frontend/src/scenes/debug/HogQLDebug.tsx#HogQLDebug"})}catch(__react_docgen_typescript_loader_error){}function DebugScene(){const{query}=(0,index_esm.useValues)(debugSceneLogic),{setQuery}=(0,index_esm.useActions)(debugSceneLogic);let parsed;try{parsed=JSON.parse(query)}catch(e){}const showQueryEditor=!(parsed&&"DataTableNode"==parsed.kind&&"HogQLQuery"==parsed.source.kind&&(parsed.full||parsed.showHogQLEditor));return(0,jsx_runtime.jsxs)("div",{className:"QueryScene",children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:"Query Debugger",buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.Jp,{active:query===examples.Os.HogQLRaw,onClick:()=>setQuery(examples.Os.HogQLRaw),children:"HogQL Debug"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{active:query===examples.Os.HogQLTable,onClick:()=>setQuery(examples.Os.HogQLTable),children:"HogQL Table"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{active:query===examples.Os.Events,onClick:()=>setQuery(examples.Os.Events),children:"Any Query"}),(0,jsx_runtime.jsx)(LemonLabel.H,{children:(0,jsx_runtime.jsx)(LemonSelect.Yv,{placeholder:"More sample queries",options:Object.entries(examples.Os).filter((_ref=>{let[k]=_ref;return"HogQLTable"!==k&&"HogQLRaw"!==k})).map((_ref2=>{let[k,v]=_ref2;return{label:k,value:v}})),onChange:v=>{v&&setQuery(v)}})})]})}),parsed&&"HogQLQuery"===parsed?.kind?(0,jsx_runtime.jsx)(HogQLDebug,{query:parsed,setQuery:query=>setQuery(JSON.stringify(query,null,2))}):(0,jsx_runtime.jsx)(Query.A,{query,setQuery:query=>setQuery(JSON.stringify(query,null,2)),context:{showQueryEditor}})]})}const scene={component:DebugScene,logic:debugSceneLogic}}}]);