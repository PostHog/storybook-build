"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[4064],{"./frontend/src/scenes/batch_exports/BatchExportScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BatchExportScene:()=>BatchExportScene,LogsTab:()=>LogsTab,RunsTab:()=>RunsTab,scene:()=>scene});var src=__webpack_require__("./frontend/@posthog/apps-common/src/index.ts"),posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),lemon_ui_src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),LemonCalendarRange=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCalendarRange/LemonCalendarRange.tsx"),LemonDialog=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDialog/index.ts"),LemonMenu=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMenu/index.ts"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),Popover=__webpack_require__("./frontend/src/lib/lemon-ui/Popover/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),BatchExportRuns=__webpack_require__("./frontend/src/scenes/pipeline/BatchExportRuns.tsx"),pipeline_utils=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonCalendarSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCalendar/LemonCalendarSelect.tsx"),LemonField=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),batchExportLogic=__webpack_require__("./frontend/src/scenes/batch_exports/batchExportLogic.ts"),batch_exports_utils=__webpack_require__("./frontend/src/scenes/batch_exports/utils.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function BatchExportBackfillModal(){if(!(0,batch_exports_utils.dv)())return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let{batchExportConfig,isBackfillModalOpen,isBackfillFormSubmitting}=(0,index_esm.useValues)(batchExportLogic.B),{closeBackfillModal}=(0,index_esm.useActions)(batchExportLogic.B);return(0,jsx_runtime.jsxs)(LemonModal.f,{title:"Export historical data",onClose:closeBackfillModal,isOpen:isBackfillModalOpen,width:"30rem",footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary","data-attr":"batch-export-backfill-cancel",disabledReason:isBackfillFormSubmitting?"Please wait...":void 0,onClick:closeBackfillModal,children:"Cancel"}),(0,jsx_runtime.jsx)(LemonButton.J,{form:"batch-export-backfill-form",htmlType:"submit",type:"primary","data-attr":"batch-export-backfill-submit",loading:isBackfillFormSubmitting,children:"Schedule runs"})]}),children:[(0,jsx_runtime.jsxs)("p",{children:["Triggering a historic export will create multiple runs, one after another for the range specified below. The runs will export data in ",(0,jsx_runtime.jsx)("b",{children:batchExportConfig?.interval})," intervals, from the start date until the end date is reached."]}),(0,jsx_runtime.jsxs)(lib.Form,{logic:batchExportLogic.B,formKey:"backfillForm",id:"batch-export-backfill-form",enableFormOnSubmit:!0,className:"space-y-2",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"start_at",label:"Start Date",className:"flex-1",children:_ref=>{let{value,onChange}=_ref;return(0,jsx_runtime.jsx)(LemonCalendarSelect.he,{value:value,onChange:onChange,placeholder:"Select start date"})}}),(0,jsx_runtime.jsx)(LemonField.D,{name:"end_at",label:"End date",className:"flex-1",children:_ref2=>{let{value,onChange}=_ref2;return(0,jsx_runtime.jsx)(LemonCalendarSelect.he,{value:value,onChange:onChange,placeholder:"Select end date (optional)"})}})]})]})}var kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts");let DEFAULT_LOG_LEVELS=["INFO","WARNING","LOG","ERROR"],ALL_LOG_LEVELS=["DEBUG",...DEFAULT_LOG_LEVELS],batchExportLogsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{batchExportId}=_ref;return batchExportId}),(0,index_esm.path)(batchExportId=>["scenes","batch_exports","batchExportLogsLogic",batchExportId]),(0,index_esm.actions)({clearBatchExportLogsBackground:!0,markLogsEnd:!0,setBatchExportLogsTypes:typeFilters=>({typeFilters}),setSearchTerm:searchTerm=>({searchTerm})}),(0,kea_loaders_lib.loaders)(_ref2=>{let{props:{batchExportId},values,actions,cache}=_ref2;return{batchExportLogs:{__default:[],loadBatchExportLogs:async()=>{let response=await api.ZP.batchExports.logs(batchExportId,{search:values.searchTerm,level:values.typeFilters.join(",")});return cache.pollingInterval||(cache.pollingInterval=setInterval(actions.loadBatchExportLogsBackgroundPoll,2e3)),actions.clearBatchExportLogsBackground(),response.results},loadBatchExportLogsMore:async()=>{let response=await api.ZP.batchExports.logs(batchExportId,{search:values.searchTerm,level:values.typeFilters.join(","),before:values.trailingEntry?.timestamp});return response.results.length<50&&actions.markLogsEnd(),[...values.batchExportLogs,...response.results]},revealBackground:()=>{let newArray=[...values.batchExportLogsBackground,...values.batchExportLogs];return actions.clearBatchExportLogsBackground(),newArray}},batchExportLogsBackground:{__default:[],loadBatchExportLogsBackgroundPoll:async()=>{if(values.batchExportLogsLoading)return values.batchExportLogsBackground;let response=await api.ZP.batchExports.logs(batchExportId,{search:values.searchTerm,level:values.typeFilters.join(","),after:values.leadingEntry?.timestamp});return[...response.results,...values.batchExportLogsBackground]}}}}),(0,index_esm.reducers)({batchExportLogsTypes:[DEFAULT_LOG_LEVELS,{setBatchExportLogsTypes:(_,_ref3)=>{let{typeFilters}=_ref3;return typeFilters.map(tf=>tf)}}],batchExportLogsBackground:[[],{clearBatchExportLogsBackground:()=>[]}],searchTerm:["",{setSearchTerm:(_,_ref4)=>{let{searchTerm}=_ref4;return searchTerm}}],typeFilters:[DEFAULT_LOG_LEVELS,{setBatchExportLogsTypes:(_,_ref5)=>{let{typeFilters}=_ref5;return typeFilters||[]}}],isThereMoreToLoad:[!0,{loadBatchExportLogsSuccess:(_,_ref6)=>{let{batchExportLogs}=_ref6;return batchExportLogs.length>=50},markLogsEnd:()=>!1}]}),(0,index_esm.selectors)(()=>({leadingEntry:[s=>[s.batchExportLogs,s.batchExportLogsBackground],(batchExportLogs,batchExportLogsBackground)=>batchExportLogsBackground.length?batchExportLogsBackground[0]:batchExportLogs.length?batchExportLogs[0]:null],trailingEntry:[s=>[s.batchExportLogs,s.batchExportLogsBackground],(batchExportLogs,batchExportLogsBackground)=>batchExportLogs.length?batchExportLogs[batchExportLogs.length-1]:batchExportLogsBackground.length?batchExportLogsBackground[batchExportLogsBackground.length-1]:null]})),(0,index_esm.listeners)(_ref7=>{let{actions}=_ref7;return{setBatchExportLogsTypes:()=>{actions.loadBatchExportLogs()},setSearchTerm:async(_ref8,breakpoint)=>{let{searchTerm}=_ref8;searchTerm&&await breakpoint(1e3),actions.loadBatchExportLogs()}}}),(0,index_esm.events)(_ref9=>{let{actions,cache}=_ref9;return{afterMount:()=>{actions.loadBatchExportLogs()},beforeUnmount:()=>{clearInterval(cache.pollingInterval)}}})]);var components=__webpack_require__("./frontend/src/scenes/batch_exports/components.tsx");let scene={component:BatchExportScene,logic:batchExportLogic.B,paramsToProps:_ref=>{let{params:{id}}=_ref;return{id:null!=id?id:"missing"}}};function RunsTab(){let{batchExportRunsResponse,batchExportConfig,groupedRuns,batchExportRunsResponseLoading,runsDateRange,batchExportConfigLoading}=(0,index_esm.useValues)(batchExportLogic.B),{loadNextBatchExportRuns,setRunsDateRange,retryRun}=(0,index_esm.useActions)(batchExportLogic.B),[dateRangeVisible,setDateRangeVisible]=(0,react.useState)(!1);return batchExportConfig||batchExportConfigLoading?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:batchExportConfig?(0,jsx_runtime.jsx)("div",{className:"flex items-start gap-8 flex-wrap",children:(0,jsx_runtime.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-end items-start",children:(0,jsx_runtime.jsx)(Popover.J2,{actionable:!0,onClickOutside:function noRefCheck(){setDateRangeVisible(!1)},visible:dateRangeVisible,overlay:(0,jsx_runtime.jsx)(LemonCalendarRange.O,{value:[runsDateRange.from,runsDateRange.to],onChange:_ref2=>{let[start,end]=_ref2;setRunsDateRange({from:start.startOf("day"),to:end.endOf("day")}),setDateRangeVisible(!1)},onClose:function noRefCheck(){setDateRangeVisible(!1)}}),children:(0,jsx_runtime.jsxs)(lemon_ui_src.LemonButton,{onClick:function onClick(){setDateRangeVisible(!dateRangeVisible)},type:"secondary",size:"small",children:[runsDateRange.from.format("MMMM D, YYYY")," -"," ",runsDateRange.to.format("MMMM D, YYYY")]})})}),(0,jsx_runtime.jsx)(BatchExportRuns.m,{id:batchExportConfig.id,groupedRuns:groupedRuns,loading:batchExportRunsResponseLoading,retryRun:retryRun,hasMoreRunsToLoad:!!batchExportRunsResponse?.next,loadOlderRuns:loadNextBatchExportRuns,interval:batchExportConfig.interval})]})}):null}):(0,jsx_runtime.jsx)(NotFound.T,{object:"Batch Export"})}let columns=[{title:"Timestamp",key:"timestamp",dataIndex:"timestamp",width:1,render:(_,entry)=>(0,dayjs.Bv)(entry.timestamp).format("YYYY-MM-DD HH:mm:ss.SSS UTC")},{title:"Level",key:"level",dataIndex:"level",width:1,render:(_,entry)=>(0,pipeline_utils.bH)(entry.level)},{title:"Run ID",key:"run_id",dataIndex:"instance_id",width:1,render:(_,entry)=>entry.instance_id},{title:"Message",key:"message",dataIndex:"message",width:6}];function LogsTab(_ref3){let{batchExportId}=_ref3,{activeTab,batchExportConfig,batchExportConfigLoading}=(0,index_esm.useValues)(batchExportLogic.B),logic=batchExportLogsLogic({batchExportId}),{batchExportLogs,batchExportLogsLoading,batchExportLogsBackground,isThereMoreToLoad,batchExportLogsTypes}=(0,index_esm.useValues)(logic),{revealBackground,loadBatchExportLogsMore,setBatchExportLogsTypes,setSearchTerm}=(0,index_esm.useActions)(logic);return batchExportConfig&&!batchExportConfigLoading&&activeTab?(0,jsx_runtime.jsxs)("div",{className:"ph-no-capture space-y-2 flex-1",children:[(0,jsx_runtime.jsx)(lemon_ui_src.LemonInput,{type:"search",placeholder:"Search for messages containingâ€¦",fullWidth:!0,onChange:setSearchTerm,allowClear:!0}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4",children:[(0,jsx_runtime.jsx)("span",{children:"Show logs of type:\xa0"}),ALL_LOG_LEVELS.map(type=>(0,jsx_runtime.jsx)(lemon_ui_src.LemonCheckbox,{label:type,checked:batchExportLogsTypes.includes(type),onChange:checked=>{let newBatchExportLogsTypes=checked?[...batchExportLogsTypes,type]:batchExportLogsTypes.filter(t=>t!=type);setBatchExportLogsTypes(newBatchExportLogsTypes)}},type))]}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{onClick:revealBackground,loading:batchExportLogsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:batchExportLogsBackground.length?void 0:"There's nothing to load",children:batchExportLogsBackground.length?`Load ${(0,utils.Zi)(batchExportLogsBackground.length,"newer entry","newer entries")}`:"No new entries"}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonTable,{dataSource:batchExportLogs,columns:columns,loading:batchExportLogsLoading,className:"ph-no-capture",pagination:{pageSize:200,hideOnSinglePage:!0}}),!!batchExportLogs.length&&(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{onClick:loadBatchExportLogsMore,loading:batchExportLogsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:isThereMoreToLoad?void 0:"There's nothing more to load",children:isThereMoreToLoad?"Load up to 50 older entries":"No older entries"})]}):(0,jsx_runtime.jsx)(LemonSkeleton.y,{})}function BatchExportScene(){let{batchExportConfig,batchExportConfigLoading,activeTab}=(0,index_esm.useValues)(batchExportLogic.B),{loadBatchExportConfig,loadBatchExportRuns,openBackfillModal,pause,unpause,archive,setActiveTab}=(0,index_esm.useActions)(batchExportLogic.B),hasDataPipelines=(0,batch_exports_utils.dv)();return((0,react.useEffect)(()=>{loadBatchExportConfig(),loadBatchExportRuns()},[]),batchExportConfig||batchExportConfigLoading)?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:batchExportConfig?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonMenu.d,{items:[{label:batchExportConfig.paused?"Unpause":"Pause",onClick:()=>{batchExportConfig.paused?unpause():pause()},disabledReason:batchExportConfigLoading?"Loading...":void 0},{label:"Archive",status:"danger",onClick:()=>LemonDialog.d.open({title:"Archive Batch Export?",description:"Are you sure you want to archive this Batch Export? This will stop all future runs",primaryButton:{children:"Archive",status:"danger",onClick:()=>archive()},secondaryButton:{children:"Cancel"}}),disabledReason:batchExportConfigLoading?"Loading...":void 0}],children:(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{}),size:"small"})}),hasDataPipelines&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(lemon_ui_src.LemonDivider,{vertical:!0}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{type:"secondary",onClick:()=>openBackfillModal(),children:"Create historic export"})]}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{type:"primary",to:urls.j.batchExportEdit(batchExportConfig?.id),children:"Edit"})]}):void 0}),(0,jsx_runtime.jsx)("div",{children:batchExportConfig?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(components.$o,{batchExportConfig:batchExportConfig}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonTag,{children:(0,utils.fm)((0,batch_exports_utils.J0)(batchExportConfig.interval))}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonTag,{children:batchExportConfig.end_at?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("span",{className:"flex gap-1",children:["Ends ",(0,jsx_runtime.jsx)(src.TZLabel,{time:batchExportConfig.end_at})]})}):"Indefinite"}),(0,jsx_runtime.jsx)(Tooltip.u,{title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("ul",{className:"mb-4",children:[(0,jsx_runtime.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Destination:"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:batchExportConfig.destination.type})]}),Object.keys(batchExportConfig.destination.config).filter(x=>!["password","aws_secret_access_key","client_email","token_uri","private_key","private_key_id"].includes(x)).map(x=>(0,jsx_runtime.jsxs)("li",{className:"flex items-center justify-between gap-2",children:[(0,jsx_runtime.jsxs)("span",{children:[(0,utils.UV)(x),":"]}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:batchExportConfig.destination.config[x]})]},x))]})}),children:(0,jsx_runtime.jsx)(lemon_ui_src.LemonTag,{children:(0,batch_exports_utils.qY)(batchExportConfig.destination)})})]})}):(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-10 h-4"})}),batchExportConfig&&activeTab?(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeTab,onChange:newKey=>setActiveTab(newKey),tabs:[{key:batchExportLogic.o.Runs,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Latest runs"}),content:(0,jsx_runtime.jsx)(RunsTab,{})},{key:batchExportLogic.o.Logs,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Logs"}),content:(0,jsx_runtime.jsx)(LogsTab,{batchExportId:batchExportConfig.id})}]}):null,(0,jsx_runtime.jsx)(BatchExportBackfillModal,{})]}):(0,jsx_runtime.jsx)(NotFound.T,{object:"Batch Export"})}},"./frontend/src/scenes/pipeline/destinations/destinationsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>pipelineDestinationsLogic});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),fuse_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/api.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/utils.tsx"),lib_utils_deleteWithUndo__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/utils/deleteWithUndo.tsx"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/types.ts"),_pipelineAccessLogic__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/scenes/pipeline/pipelineAccessLogic.tsx"),_types__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");let pipelineDestinationsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.key)(props=>props.syncFiltersWithUrl?"scene":"default"),(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(id=>["scenes","pipeline","destinationsLogic",id]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_7__.teamLogic,["currentTeamId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_8__.userLogic,["user","hasAvailableFeature"],_pipelineAccessLogic__WEBPACK_IMPORTED_MODULE_10__.g,["canEnableDestination"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({toggleNode:(destination,enabled)=>({destination,enabled}),toggleNodeHogFunction:(destination,enabled)=>({destination,enabled}),deleteNode:destination=>({destination}),deleteNodeBatchExport:destination=>({destination}),deleteNodeHogFunction:destination=>({destination}),deleteNodeWebhook:destination=>({destination}),updatePluginConfig:pluginConfig=>({pluginConfig}),updateBatchExportConfig:batchExportConfig=>({batchExportConfig}),setFilters:filters=>({filters}),resetFilters:!0}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)(_ref=>{let{props}=_ref;return{filters:[{...props.defaultFilters||{},...props.forceFilters||{}},{setFilters:(state,_ref2)=>{let{filters}=_ref2;return{...state,...filters,...props.forceFilters||{}}},resetFilters:()=>({...props.forceFilters||{}})}]}}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_2__.loaders)(_ref3=>{let{values,actions}=_ref3;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_12__.c$)("api/organizations/@current/pipeline_destinations")}],pluginConfigs:[{},{loadPluginConfigs:async()=>{let pluginConfigs={},results=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/pipeline_destination_configs`);for(let pluginConfig of results)pluginConfigs[pluginConfig.id]={...pluginConfig,name:pluginConfig.name||values.plugins[pluginConfig.plugin]?.name||"Unknown app",description:pluginConfig.description||values.plugins[pluginConfig.plugin]?.description};return pluginConfigs},toggleNodeWebhook:async _ref4=>{let{destination,enabled}=_ref4,{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[destination.id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_12__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let response=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.update(`api/plugin_config/${destination.id}`,{enabled});return{...pluginConfigs,[destination.id]:response}},updatePluginConfig:_ref5=>{let{pluginConfig}=_ref5;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}},deleteNodeWebhook:async _ref6=>{let{destination}=_ref6;await (0,lib_utils_deleteWithUndo__WEBPACK_IMPORTED_MODULE_6__.S)({endpoint:`projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_7__.teamLogic.values.currentTeamId}/plugin_configs`,object:{id:destination.id,name:destination.name},callback:undo=>{undo&&actions.loadPluginConfigs()}});let pluginConfigs={...values.pluginConfigs};return delete pluginConfigs[destination.id],pluginConfigs}}],batchExportConfigs:[{},{loadBatchExports:async()=>{let results=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/batch_exports`);return Object.fromEntries(results.map(batchExport=>[batchExport.id,batchExport]))},toggleNodeBatchExport:async _ref7=>{let{destination,enabled}=_ref7,batchExport=values.batchExportConfigs[destination.id];return enabled?await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.batchExports.unpause(destination.id):await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.batchExports.pause(destination.id),(0,_utils__WEBPACK_IMPORTED_MODULE_12__.hO)(`batch export ${enabled?"enabled":"disabled"}`,batchExport),{...values.batchExportConfigs,[destination.id]:{...batchExport,paused:!enabled}}},deleteNodeBatchExport:async _ref8=>{let{destination}=_ref8;await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.batchExports.delete(destination.id);let batchExportConfigs={...values.batchExportConfigs};return delete batchExportConfigs[destination.id],batchExportConfigs},updateBatchExportConfig:_ref9=>{let{batchExportConfig}=_ref9;return{...values.batchExportConfigs,[batchExportConfig.id]:batchExportConfig}}}],hogFunctions:[[],{loadHogFunctions:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.hogFunctions.list({filters:values.filters?.filters})).results,deleteNodeHogFunction:async _ref10=>{let{destination}=_ref10;return destination.backend!==_types__WEBPACK_IMPORTED_MODULE_11__.b.HogFunction?values.hogFunctions:(await (0,lib_utils_deleteWithUndo__WEBPACK_IMPORTED_MODULE_6__.S)({endpoint:`projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_7__.teamLogic.values.currentTeamId}/hog_functions`,object:{id:destination.hog_function.id,name:destination.name},callback:undo=>{undo&&actions.loadHogFunctions()}}),values.hogFunctions.filter(hogFunction=>hogFunction.id!==destination.hog_function.id))},toggleNodeHogFunction:async _ref11=>{let{destination,enabled}=_ref11,{hogFunctions}=values,hogFunctionIndex=hogFunctions.findIndex(hf=>hf.id===destination.hog_function.id),response=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.hogFunctions.update(destination.hog_function.id,{enabled});return[...hogFunctions.slice(0,hogFunctionIndex),response,...hogFunctions.slice(hogFunctionIndex+1)]}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading,s.batchExportConfigsLoading,s.hogFunctionsLoading],(pluginsLoading,pluginConfigsLoading,batchExportConfigsLoading,hogFunctionsLoading)=>pluginsLoading||pluginConfigsLoading||batchExportConfigsLoading||hogFunctionsLoading],destinations:[s=>[s.pluginConfigs,s.plugins,s.batchExportConfigs,s.hogFunctions,s.user],(pluginConfigs,plugins,batchExportConfigs,hogFunctions,user)=>{let rawBatchExports=Object.values(batchExportConfigs).filter(config=>"HTTP"!==config.destination.type||user?.is_impersonated),rawDestinations=[].concat(hogFunctions).concat(Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null}))).concat(rawBatchExports),convertedDestinations=rawDestinations.map(d=>(0,_types__WEBPACK_IMPORTED_MODULE_11__.n)(d,_types__WEBPACK_IMPORTED_MODULE_9__.We.Destination)),enabledFirst=convertedDestinations.sort((a,b)=>Number(b.enabled)-Number(a.enabled));return enabledFirst}],destinationsFuse:[s=>[s.destinations],destinations=>new fuse_js__WEBPACK_IMPORTED_MODULE_13__.Z(destinations||[],{keys:["name","description"],threshold:.3})],filteredDestinations:[s=>[s.filters,s.destinations,s.destinationsFuse],(filters,destinations,destinationsFuse)=>{let{search,onlyActive,kind}=filters;return(search?destinationsFuse.search(search).map(x=>x.item):destinations).filter(dest=>(!kind||dest.backend===kind)&&(!onlyActive||!!dest.enabled))}]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)(_ref12=>{let{values,actions}=_ref12;return{toggleNode:_ref13=>{let{destination,enabled}=_ref13;if(enabled&&!values.canEnableDestination(destination)){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("Data pipelines add-on is required for enabling new destinations.");return}destination.backend===_types__WEBPACK_IMPORTED_MODULE_11__.b.Plugin?actions.toggleNodeWebhook({destination:destination,enabled:enabled}):destination.backend===_types__WEBPACK_IMPORTED_MODULE_11__.b.BatchExport?actions.toggleNodeBatchExport({destination:destination,enabled:enabled}):destination.backend===_types__WEBPACK_IMPORTED_MODULE_11__.b.HogFunction&&actions.toggleNodeHogFunction(destination,enabled)},deleteNode:_ref14=>{let{destination}=_ref14;switch(destination.backend){case _types__WEBPACK_IMPORTED_MODULE_11__.b.Plugin:actions.deleteNodeWebhook(destination);break;case _types__WEBPACK_IMPORTED_MODULE_11__.b.BatchExport:actions.deleteNodeBatchExport(destination);break;case _types__WEBPACK_IMPORTED_MODULE_11__.b.HogFunction:actions.deleteNodeHogFunction(destination)}}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_3__.actionToUrl)(_ref15=>{let{props,values}=_ref15;if(!props.syncFiltersWithUrl)return{};let urlFromFilters=()=>[kea_router__WEBPACK_IMPORTED_MODULE_3__.router.values.location.pathname,values.filters,kea_router__WEBPACK_IMPORTED_MODULE_3__.router.values.hashParams,{replace:!0}];return{setFilters:()=>urlFromFilters(),resetFilters:()=>urlFromFilters()}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_3__.urlToAction)(_ref16=>{let{props,actions,values}=_ref16;return{"*":(_,searchParams)=>{props.syncFiltersWithUrl&&((0,lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(values.filters,searchParams)||actions.setFilters(searchParams))}}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.afterMount)(_ref17=>{let{actions}=_ref17;actions.loadPlugins(),actions.loadPluginConfigs(),actions.loadBatchExports(),actions.loadHogFunctions()})])}}]);