(window.webpackJsonp=window.webpackJsonp||[]).push([[317],{"./frontend/src/scenes/instance/DeadLetterQueue/DeadLetterQueue.tsx":function(se,O,r){"use strict";r.r(O),r.d(O,"scene",function(){return _}),r.d(O,"DeadLetterQueue",function(){return R});var M=r("./frontend/src/lib/components/PageHeader.tsx"),x=r("./node_modules/antd/es/tabs/index.js"),l=r("./node_modules/kea/lib/index.esm.js"),ne=r("./node_modules/core-js/modules/es.object.keys.js"),oe=r("./node_modules/core-js/modules/es.symbol.js"),ae=r("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),ue=r("./node_modules/core-js/modules/web.dom-collections.for-each.js"),ce=r("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),de=r("./node_modules/core-js/modules/es.array.slice.js"),ie=r("./node_modules/core-js/modules/es.function.name.js"),le=r("./node_modules/core-js/modules/es.array.from.js"),je=r("./node_modules/core-js/modules/es.string.iterator.js"),fe=r("./node_modules/core-js/modules/es.regexp.exec.js"),me=r("./node_modules/core-js/modules/es.symbol.description.js"),ve=r("./node_modules/core-js/modules/es.symbol.iterator.js"),V=r("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),p=r.n(V),C=r("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),L=r.n(C),$=r("./node_modules/@babel/runtime/helpers/defineProperty.js"),T=r.n($),K=r("./node_modules/@babel/runtime/regenerator/index.js"),y=r.n(K),be=r("./node_modules/core-js/modules/es.array.concat.js"),ye=r("./node_modules/core-js/modules/es.array.iterator.js"),ge=r("./node_modules/core-js/modules/es.object.to-string.js"),Oe=r("./node_modules/core-js/modules/web.dom-collections.iterator.js"),he=r("./node_modules/core-js/modules/es.array.filter.js"),A=r("./frontend/src/lib/api.ts"),h=r("./frontend/src/scenes/userLogic.ts"),E=r("./node_modules/kea-loaders/lib/index.js");function F(e,s){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=G(e))||s&&e&&typeof e.length=="number"){t&&(e=t);var o=0,u=function(){};return{s:u,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(j){throw j},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,f=!1,c;return{s:function(){t=t.call(e)},n:function(){var j=t.next();return a=j.done,j},e:function(j){f=!0,c=j},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(f)throw c}}}}function G(e,s){if(!!e){if(typeof e=="string")return Q(e,s);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Q(e,s)}}function Q(e,s){(s==null||s>e.length)&&(s=e.length);for(var t=0,o=new Array(s);t<s;t++)o[t]=e[t];return o}function P(e,s){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);s&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),t.push.apply(t,o)}return t}function S(e){for(var s=1;s<arguments.length;s++){var t=arguments[s]!=null?arguments[s]:{};s%2?P(Object(t),!0).forEach(function(o){T()(e,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))})}return e}var v;(function(e){e.Metrics="metrics",e.Management="management",e.Settings="settings"})(v||(v={}));var b=Object(l.kea)([Object(l.path)(["scenes","instance","DeadLetterQueue","deadLetterQueueLogic"]),Object(l.actions)({setActiveTab:function(s){return{tabKey:s}},loadMoreRows:function(s){return{key:s}},addRowsToMetric:function(s,t){return{key:s,rows:t}}}),Object(l.reducers)({activeTab:[v.Metrics,{setActiveTab:function(s,t){var o=t.tabKey;return o}}],rowsPerMetric:[{},{addRowsToMetric:function(s,t){var o=t.key,u=t.rows;return S(S({},s),{},T()({},o,[].concat(L()(s[o]||[]),L()(u))))},loadDeadLetterQueueMetricsSuccess:function(s,t){var o=t.deadLetterQueueMetrics,u={},a=F(o),f;try{for(a.s();!(f=a.n()).done;){var c=f.value;c.subrows&&(u[c.key]=c.subrows.rows)}}catch(d){a.e(d)}finally{a.f()}return u}}]}),Object(E.loaders)({deadLetterQueueMetrics:[[],{loadDeadLetterQueueMetrics:function(){var e=p()(y.a.mark(function t(){var o;return y.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if((o=h.a.values.user)!==null&&o!==void 0&&o.is_staff){a.next=2;break}return a.abrupt("return",[]);case 2:return a.next=4,A.b.get("api/dead_letter_queue");case 4:return a.abrupt("return",a.sent.results);case 5:case"end":return a.stop()}},t)}));function s(){return e.apply(this,arguments)}return s}()}]}),Object(l.listeners)(function(e){var s=e.values,t=e.actions;return{loadMoreRows:function(){var o=p()(y.a.mark(function a(f){var c,d,j,i;return y.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(d=f.key,j=((c=s.rowsPerMetric[d])===null||c===void 0?void 0:c.length)+1,!j){m.next=7;break}return m.next=5,A.b.get("api/dead_letter_queue/".concat(d,"?offset=").concat(j));case 5:i=m.sent,t.addRowsToMetric(d,i.subrows.rows);case 7:case"end":return m.stop()}},a)}));function u(a){return o.apply(this,arguments)}return u}()}}),Object(l.selectors)({singleValueMetrics:[function(e){return[e.deadLetterQueueMetrics]},function(e){return e.filter(function(s){return!s.subrows})}],tableMetrics:[function(e){return[e.deadLetterQueueMetrics]},function(e){return e.filter(function(s){return!!s.subrows})}]}),Object(l.afterMount)(function(e){var s=e.actions;s.loadDeadLetterQueueMetrics()})]),H=r("./node_modules/@babel/runtime/helpers/slicedToArray.js"),B=r.n(H),Me=r("./node_modules/core-js/modules/es.array.map.js"),J=r("./node_modules/antd/es/row/index.js"),U=r("./node_modules/antd/es/col/index.js"),z=r("./node_modules/antd/es/statistic/index.js"),D=r("./node_modules/antd/es/divider/index.js"),N=r("./node_modules/antd/es/button/index.js"),W=r("./frontend/src/lib/components/LemonTable/index.ts"),X=r("./frontend/src/lib/components/LemonButton/index.ts"),Y=r("./frontend/src/lib/components/Spinner/Spinner.tsx"),Z=r("./frontend/src/lib/components/icons.tsx"),n=r("./node_modules/react/jsx-runtime.js"),k=10;function q(){var e=Object(l.useValues)(h.a),s=e.user,t=Object(l.useValues)(b),o=t.singleValueMetrics,u=t.tableMetrics,a=t.deadLetterQueueMetricsLoading,f=t.rowsPerMetric,c=Object(l.useActions)(b),d=c.loadDeadLetterQueueMetrics,j=c.loadMoreRows;return s!=null&&s.is_staff?Object(n.jsxs)("div",{children:[Object(n.jsx)("br",{}),Object(n.jsx)("div",{className:"mb-4 float-right",children:Object(n.jsx)(X.a,{icon:a?Object(n.jsx)(Y.a,{}):Object(n.jsx)(Z.IconRefresh,{}),onClick:d,type:"secondary",size:"small",children:"Refresh"})}),Object(n.jsx)(J.a,{gutter:32,children:o.map(function(i){return Object(n.jsx)(U.a,{children:Object(n.jsx)(z.a,{title:i.metric,value:(i.value||"0").toLocaleString("en-US"),loading:a})},i.key)})}),Object(n.jsx)(D.a,{}),u.map(function(i){var g,m;return Object(n.jsxs)("div",{children:[Object(n.jsx)("h2",{children:i.metric}),Object(n.jsx)(W.a,{columns:[{title:(g=i.subrows)===null||g===void 0?void 0:g.columns[0],dataIndex:"key"},{title:(m=i.subrows)===null||m===void 0?void 0:m.columns[1],dataIndex:"value"}],dataSource:f[i.key].map(function(w){var I=B()(w,2),te=I[0],re=I[1];return{key:te,value:re}})||[],loading:a,defaultSorting:{columnKey:"value",order:-1},embedded:!0}),Object(n.jsx)("div",{style:{margin:"1rem",textAlign:"center"},children:Object(n.jsx)(N.a,{disabled:f[i.key].length%k!==0,onClick:function(){return j(i.key)},children:"Load more values"})}),Object(n.jsx)(D.a,{})]},i.key)})]}):Object(n.jsx)(n.Fragment,{})}var _={component:R,logic:b},ee=x.a.TabPane;function R(){var e=Object(l.useValues)(h.a),s=e.user,t=Object(l.useValues)(b),o=t.activeTab,u=Object(l.useActions)(b),a=u.setActiveTab;return s!=null&&s.is_staff?Object(n.jsxs)("div",{children:[Object(n.jsx)(M.a,{title:"Dead Letter Queue",caption:Object(n.jsx)(n.Fragment,{children:Object(n.jsx)("p",{children:"Manage your instance's dead letter queue."})})}),Object(n.jsx)(x.a,{activeKey:o,onChange:function(c){return a(c)},children:Object(n.jsx)(ee,{tab:"Metrics"},v.Metrics)}),o===v.Metrics?Object(n.jsx)(q,{}):null]}):Object(n.jsx)(M.a,{title:"Dead Letter Queue",caption:Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("p",{children:"Only users with staff access can manage the dead letter queue. Please contact your instance admin."}),Object(n.jsxs)("p",{children:["If you're an admin and don't have access, set ",Object(n.jsx)("code",{children:"is_staff=true"})," for your user on the PostgreSQL ",Object(n.jsx)("code",{children:"posthog_user"})," table."]})]})})}}}]);
