(window.webpackJsonp=window.webpackJsonp||[]).push([[251],{4754:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"DeadLetterQueue",(function(){return DeadLetterQueue}));var DeadLetterQueueTab,react=__webpack_require__(0),react_default=__webpack_require__.n(react),PageHeader=__webpack_require__(210),tabs=__webpack_require__(577),index_esm=__webpack_require__(1),regenerator=(__webpack_require__(41),__webpack_require__(61),__webpack_require__(45),__webpack_require__(39),__webpack_require__(49),__webpack_require__(7)),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(67),__webpack_require__(12)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),toConsumableArray=__webpack_require__(15),toConsumableArray_default=__webpack_require__.n(toConsumableArray),defineProperty=__webpack_require__(3),defineProperty_default=__webpack_require__.n(defineProperty),api=__webpack_require__(21),userLogic=__webpack_require__(65);function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}!function(DeadLetterQueueTab){DeadLetterQueueTab.Metrics="metrics",DeadLetterQueueTab.Management="management",DeadLetterQueueTab.Settings="settings"}(DeadLetterQueueTab||(DeadLetterQueueTab={}));var deadLetterQueueLogic=Object(index_esm.kea)({path:["scenes","instance","DeadLetterQueue","deadLetterQueueLogic"],actions:function actions(){return{setActiveTab:function setActiveTab(tabKey){return{tabKey:tabKey}},loadMoreRows:function loadMoreRows(key){return{key:key}},addRowsToMetric:function addRowsToMetric(key,rows){return{key:key,rows:rows}}}},reducers:{activeTab:[DeadLetterQueueTab.Metrics,{setActiveTab:function setActiveTab(_,_ref){return _ref.tabKey}}],rowsPerMetric:[{},{addRowsToMetric:function addRowsToMetric(state,_ref2){var key=_ref2.key,rows=_ref2.rows;return _objectSpread(_objectSpread({},state),{},defineProperty_default()({},key,[].concat(toConsumableArray_default()(state[key]||[]),toConsumableArray_default()(rows))))},loadDeadLetterQueueMetricsSuccess:function loadDeadLetterQueueMetricsSuccess(_,_ref3){var _step,rowsPerMetric={},_iterator=_createForOfIteratorHelper(_ref3.deadLetterQueueMetrics);try{for(_iterator.s();!(_step=_iterator.n()).done;){var metric=_step.value;metric.subrows&&(rowsPerMetric[metric.key]=metric.subrows.rows)}}catch(err){_iterator.e(err)}finally{_iterator.f()}return rowsPerMetric}}]},loaders:function loaders(){return{deadLetterQueueMetrics:[[],{loadDeadLetterQueueMetrics:(_loadDeadLetterQueueMetrics=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var _userLogic$values$use;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(null===(_userLogic$values$use=userLogic.a.values.user)||void 0===_userLogic$values$use?void 0:_userLogic$values$use.is_staff){_context.next=2;break}return _context.abrupt("return",[]);case 2:return _context.next=4,api.a.get("api/dead_letter_queue");case 4:return _context.abrupt("return",_context.sent.results);case 5:case"end":return _context.stop()}}),_callee)}))),function loadDeadLetterQueueMetrics(){return _loadDeadLetterQueueMetrics.apply(this,arguments)})}]};var _loadDeadLetterQueueMetrics},listeners:function listeners(_ref4){var _loadMoreRows,values=_ref4.values,actions=_ref4.actions;return{loadMoreRows:(_loadMoreRows=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(_ref5){var _values$rowsPerMetric,key,offset,res;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(key=_ref5.key,!(offset=(null===(_values$rowsPerMetric=values.rowsPerMetric[key])||void 0===_values$rowsPerMetric?void 0:_values$rowsPerMetric.length)+1)){_context2.next=7;break}return _context2.next=5,api.a.get("api/dead_letter_queue/".concat(key,"?offset=").concat(offset));case 5:res=_context2.sent,actions.addRowsToMetric(key,res.subrows.rows);case 7:case"end":return _context2.stop()}}),_callee2)}))),function loadMoreRows(_x){return _loadMoreRows.apply(this,arguments)})}},selectors:function selectors(){return{singleValueMetrics:[function(s){return[s.deadLetterQueueMetrics]},function(deadLetterQueueMetrics){return deadLetterQueueMetrics.filter((function(metric){return!metric.subrows}))}],tableMetrics:[function(s){return[s.deadLetterQueueMetrics]},function(deadLetterQueueMetrics){return deadLetterQueueMetrics.filter((function(metric){return!!metric.subrows}))}]}},events:function events(_ref6){var actions=_ref6.actions;return{afterMount:function afterMount(){actions.loadDeadLetterQueueMetrics()}}}}),slicedToArray=(__webpack_require__(32),__webpack_require__(13)),slicedToArray_default=__webpack_require__.n(slicedToArray),es_row=__webpack_require__(261),col=__webpack_require__(243),statistic=__webpack_require__(4160),divider=__webpack_require__(4118),es_button=__webpack_require__(142),LemonTable=__webpack_require__(244),LemonButton=__webpack_require__(54),Spinner=__webpack_require__(173),icons=__webpack_require__(24);function MetricsTab(){var user=Object(index_esm.useValues)(userLogic.a).user,_useValues2=Object(index_esm.useValues)(deadLetterQueueLogic),singleValueMetrics=_useValues2.singleValueMetrics,tableMetrics=_useValues2.tableMetrics,deadLetterQueueMetricsLoading=_useValues2.deadLetterQueueMetricsLoading,rowsPerMetric=_useValues2.rowsPerMetric,_useActions=Object(index_esm.useActions)(deadLetterQueueLogic),loadDeadLetterQueueMetrics=_useActions.loadDeadLetterQueueMetrics,loadMoreRows=_useActions.loadMoreRows;return(null==user?void 0:user.is_staff)?react_default.a.createElement("div",null,react_default.a.createElement("br",null),react_default.a.createElement("div",{className:"mb float-right"},react_default.a.createElement(LemonButton.a,{icon:deadLetterQueueMetricsLoading?react_default.a.createElement(Spinner.a,{size:"sm"}):react_default.a.createElement(icons.IconRefresh,null),onClick:loadDeadLetterQueueMetrics,type:"secondary",compact:!0},"Refresh")),react_default.a.createElement(es_row.a,{gutter:32},singleValueMetrics.map((function(row){return react_default.a.createElement(col.a,{key:row.key},react_default.a.createElement(statistic.a,{title:row.metric,value:(row.value||"0").toLocaleString("en-US"),loading:deadLetterQueueMetricsLoading}))}))),react_default.a.createElement(divider.a,null),tableMetrics.map((function(row){var _row$subrows,_row$subrows2;return react_default.a.createElement("div",{key:row.key},react_default.a.createElement("h2",null,row.metric),react_default.a.createElement(LemonTable.a,{columns:[{title:null===(_row$subrows=row.subrows)||void 0===_row$subrows?void 0:_row$subrows.columns[0],dataIndex:"key"},{title:null===(_row$subrows2=row.subrows)||void 0===_row$subrows2?void 0:_row$subrows2.columns[1],dataIndex:"value"}],dataSource:rowsPerMetric[row.key].map((function(_ref){var _ref2=slicedToArray_default()(_ref,2);return{key:_ref2[0],value:_ref2[1]}}))||[],loading:deadLetterQueueMetricsLoading,defaultSorting:{columnKey:"value",order:-1},embedded:!0}),react_default.a.createElement("div",{style:{margin:"1rem",textAlign:"center"}},react_default.a.createElement(es_button.a,{disabled:rowsPerMetric[row.key].length%10!=0,onClick:function onClick(){return loadMoreRows(row.key)}},"Load more values")),react_default.a.createElement(divider.a,null))}))):react_default.a.createElement(react_default.a.Fragment,null)}var scene={component:DeadLetterQueue,logic:deadLetterQueueLogic},TabPane=tabs.a.TabPane;function DeadLetterQueue(){var user=Object(index_esm.useValues)(userLogic.a).user,activeTab=Object(index_esm.useValues)(deadLetterQueueLogic).activeTab,setActiveTab=Object(index_esm.useActions)(deadLetterQueueLogic).setActiveTab;return(null==user?void 0:user.is_staff)?react_default.a.createElement("div",null,react_default.a.createElement(PageHeader.a,{title:"Dead Letter Queue",caption:react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("p",null,"Manage your instance's dead letter queue."))}),react_default.a.createElement(tabs.a,{activeKey:activeTab,onChange:function onChange(key){return setActiveTab(key)}},react_default.a.createElement(TabPane,{tab:"Metrics",key:DeadLetterQueueTab.Metrics})),activeTab===DeadLetterQueueTab.Metrics?react_default.a.createElement(MetricsTab,null):null):react_default.a.createElement(PageHeader.a,{title:"Dead Letter Queue",caption:react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("p",null,"Only users with staff access can manage the dead letter queue. Please contact your instance admin."),react_default.a.createElement("p",null,"If you're an admin and don't have access, set ",react_default.a.createElement("code",null,"is_staff=true")," for your user on the PostgreSQL ",react_default.a.createElement("code",null,"posthog_user")," table."))})}}}]);