(window.webpackJsonp=window.webpackJsonp||[]).push([[302],{"./frontend/src/lib/hooks/useAnchor.ts":function(he,U,i){"use strict";i.d(U,"a",function(){return ae});var $=i("./node_modules/react/index.js"),T=i.n($);function ae(M){Object($.useEffect)(function(){if(M&&document.getElementById(M.substr(1))){var Y=document.getElementById(M.substr(1));if(!Y)return;Y.classList.add("highlighted");var re=Y.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:re-50-32,behavior:"smooth"})}},[M])}},"./frontend/src/scenes/organization/Settings/index.tsx":function(he,U,i){"use strict";i.r(U),i.d(U,"scene",function(){return Ze}),i.d(U,"OrganizationSettings",function(){return be});var $=i("./node_modules/@babel/runtime/helpers/slicedToArray.js"),T=i.n($),ae=i("./node_modules/core-js/modules/es.function.name.js"),M=i("./node_modules/react/index.js"),Y=i("./frontend/src/lib/components/PageHeader.tsx"),re=i("./node_modules/core-js/modules/es.array.iterator.js"),He=i("./node_modules/core-js/modules/es.object.to-string.js"),Xe=i("./node_modules/core-js/modules/es.string.iterator.js"),qe=i("./node_modules/core-js/modules/web.dom-collections.iterator.js"),_e=i("./node_modules/core-js/modules/web.url.js"),en=i("./node_modules/core-js/modules/web.url-search-params.js"),f=i("./node_modules/kea/lib/index.esm.js"),k=i("./frontend/src/lib/components/CopyToClipboard.tsx"),se=i("./frontend/src/lib/components/ProfilePicture/index.ts"),oe=i("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),pe=i("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),q=i("./frontend/src/lib/components/LemonTable/index.ts"),le=i("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),ce=i("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),y=i("./frontend/src/lib/components/LemonButton/index.ts"),L=i("./frontend/src/lib/components/icons.tsx"),W=i("./frontend/src/lib/components/LemonDialog/index.ts"),e=i("./node_modules/react/jsx-runtime.js");function xe(t,n){var s=new URL("/signup/".concat(t),document.baseURI).href;return n.is_expired?Object(e.jsx)("b",{children:"Expired! Delete and recreate"}):Object(e.jsx)(k.a,{"data-attr":"invite-link",description:"invite link",children:s})}function ye(t){return function(s,a){return Object(e.jsx)(y.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:Object(e.jsx)(L.IconClose,{}),status:"danger",onClick:function(){a.is_expired?t(a):W.a.open({title:"Do you want to cancel the invite for ".concat(a.target_email,"?"),primaryButton:{children:"Yes, cancel invite",status:"danger",onClick:function(){return t(a)}},secondaryButton:{children:"No, keep invite"}})}})}}function Se(){var t=Object(f.useValues)(oe.a),n=t.invites,s=t.invitesLoading,a=Object(f.useActions)(oe.a),r=a.deleteInvite,l=a.showInviteModal,o=Object(f.useValues)(ce.a),c=o.preflight,j=[{key:"user_profile_picture",render:function(d,m){return Object(e.jsx)(se.b,{name:m.first_name,email:m.target_email})},width:32},{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(d,m){return m.target_email?Object(e.jsxs)("div",{className:"flex items-center",children:[m.target_email,m.first_name?" (".concat(m.first_name,")"):""]}):Object(e.jsx)("i",{children:"no one"})},width:"20%"},Object(le.b)(),Object(le.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(d,m){return xe(m.id,m)}},{title:"",key:"actions",width:24,render:ye(r)}];return Object(e.jsxs)("div",{children:[Object(e.jsxs)("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"},children:["Pending Invites",Object(e.jsx)(y.a,{type:"primary",onClick:l,"data-attr":"invite-teammate-button",children:"Invite team member"})]}),!(c!=null&&c.email_service_available)&&Object(e.jsx)(pe.a,{}),Object(e.jsx)(q.a,{dataSource:n,columns:j,rowKey:"id",loading:s,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."})]})}var nn=i("./node_modules/core-js/modules/es.array.filter.js"),tn=i("./node_modules/core-js/modules/es.array.map.js"),an=i("./node_modules/core-js/modules/es.array.concat.js"),rn=i("./node_modules/core-js/modules/es.regexp.exec.js"),sn=i("./node_modules/core-js/modules/es.string.search.js"),_=i("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),p=i("./frontend/src/lib/constants.tsx"),V=i("./frontend/src/scenes/organizationLogic.tsx"),de=i("./frontend/src/scenes/userLogic.ts"),E=i("./frontend/src/lib/utils/permissioning.ts"),Ce=i("./frontend/src/lib/components/TimezoneAware/index.tsx"),ue=i("./frontend/src/lib/components/LemonButton/More.tsx"),ee=i("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Ae=i("./frontend/src/lib/components/LemonDivider/index.ts"),x=i("./frontend/@posthog/lemon-ui/src/index.ts");function Le(t,n){var s,a=Object(f.useValues)(de.a),r=a.user,l=Object(f.useValues)(V.a),o=l.currentOrganization,c=Object(f.useActions)(_.a),j=c.removeMember,u=c.changeMemberAccessLevel;if(!r)return null;var d=(s=o==null?void 0:o.membership_level)!==null&&s!==void 0?s:-1,m=(d>=p.q.Admin&&n.level<=d||n.user.uuid===r.uuid)&&n.level!==p.q.Owner,h=o?o.membership_level:null,v=E.c.filter(function(b){return!Object(E.a)(h,r,n,b)}),I=Object(E.a)(h,r,n,v);return Object(e.jsx)(ue.a,{overlay:Object(e.jsxs)(e.Fragment,{children:[I?Object(e.jsx)("div",{children:I}):v.map(function(b){return Object(e.jsx)(y.a,{status:"stealth",fullWidth:!0,onClick:function(g){if(g.preventDefault(),!r)throw Error;if(b===p.q.Owner){var O;W.a.open({title:"Transfer organization ownership to ".concat(n.user.first_name,"?"),description:"You will no longer be the owner of ".concat((O=r.organization)===null||O===void 0?void 0:O.name,". After the transfer you will become an administrator."),primaryButton:{status:"danger",children:"Transfer Ownership",onClick:function(){return u(n,b)}},secondaryButton:{children:"Cancel"}})}else u(n,b)},"data-test-level":b,children:b===p.q.Owner?Object(e.jsx)(e.Fragment,{children:"Transfer organization ownership"}):b>n.level?Object(e.jsxs)(e.Fragment,{children:["Upgrade to ",E.b.get(b)]}):Object(e.jsxs)(e.Fragment,{children:["Downgrade to ",E.b.get(b)]})},"".concat(n.user.uuid,"-level-").concat(b))}),m?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ae.a,{}),Object(e.jsx)(y.a,{status:"danger","data-attr":"delete-org-membership",onClick:function(){var C;if(!r)throw Error;W.a.open({title:"".concat(n.user.uuid==r.uuid?"Leave":"Remove ".concat(n.user.first_name," from")," organization ").concat((C=r.organization)===null||C===void 0?void 0:C.name,"?"),primaryButton:{children:n.user.uuid==r.uuid?"Leave":"Remove",status:"danger",onClick:function(){return j(n)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0,children:n.user.uuid!==r.uuid?"Remove from organization":"Leave organization"})]}):null]})})}function Z(t){var n=t.user,s=Object(f.useValues)(_.a),a=s.filteredMembers,r=s.membersLoading,l=s.search,o=Object(f.useActions)(_.a),c=o.setSearch,j=[{key:"user_profile_picture",render:function(d,m){return Object(e.jsx)(se.b,{name:m.user.first_name,email:m.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(d,m){return m.user.uuid==n.uuid?"".concat(m.user.first_name," (me)"):m.user.first_name},sorter:function(d,m){return d.user.first_name.localeCompare(m.user.first_name)}},{title:"Email",key:"user_email",render:function(d,m){return m.user.email},sorter:function(d,m){return d.user.email.localeCompare(m.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(d,m){var h;return Object(e.jsx)(ee.a,{"data-attr":"membership-level",children:m.level===p.q.Owner?"Organization owner":"Project ".concat((h=E.b.get(m.level))!==null&&h!==void 0?h:"unknown (".concat(m.level,")"))})},sorter:function(d,m){return d.level-m.level}},{title:"Joined",dataIndex:"joined_at",key:"joined_at",render:function(d){return Object(e.jsx)("div",{className:"whitespace-nowrap",children:Object(e.jsx)(Ce.b,{time:d})})},sorter:function(d,m){return d.joined_at.localeCompare(m.joined_at)}},{key:"actions",width:0,render:Le}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Members"}),Object(e.jsx)(x.LemonInput,{type:"search",placeholder:"Search for members",value:l,onChange:c}),Object(e.jsx)(q.a,{dataSource:a,columns:j,rowKey:"id",style:{marginTop:"1rem"},loading:r,"data-attr":"org-members-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}})]})}try{Z.displayName="Members",Z.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:Z.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(t){}function G(t){var n=t.isOpen,s=t.setIsOpen,a=Object(f.useValues)(V.a),r=a.currentOrganization,l=a.organizationBeingDeleted,o=Object(f.useActions)(V.a),c=o.deleteOrganization,j=Object(M.useState)(!1),u=T()(j,2),d=u[0],m=u[1],h=!!r&&(l==null?void 0:l.id)===r.id;return Object(e.jsxs)(x.LemonModal,{title:"Delete the entire organization?",onClose:function(){return s(!1)},footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(x.LemonButton,{disabled:h,type:"secondary",onClick:function(){return s(!1)},children:"Cancel"}),Object(e.jsx)(x.LemonButton,{type:"primary",disabled:!d,loading:h,"data-attr":"delete-organization-ok",status:"danger",onClick:r?function(){return c(r)}:void 0,children:"Delete ".concat(r?r.name:"the current organization")})]}),isOpen:n,children:[Object(e.jsxs)("p",{children:["Organization deletion ",Object(e.jsx)("b",{children:"cannot be undone"}),". You will lose all data, ",Object(e.jsx)("b",{children:"including all events"}),", related to all projects within this organization."]}),Object(e.jsxs)("p",{children:["Please type"," ",Object(e.jsx)("strong",{children:r?r.name:"this organization's name"})," to confirm."]}),Object(e.jsx)(x.LemonInput,{type:"text",onChange:function(I){r&&m(I.toLowerCase()===r.name.toLowerCase())}})]})}function J(t){var n=t.isRestricted,s=Object(f.useValues)(V.a),a=s.currentOrganization,r=Object(M.useState)(!1),l=T()(r,2),o=l[0],c=l[1];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"text-danger",children:[Object(e.jsx)("h2",{className:"text-danger subtitle",children:"Danger Zone"}),Object(e.jsxs)("div",{className:"mt-4",children:[!n&&Object(e.jsxs)("p",{className:"text-danger",children:["This is ",Object(e.jsx)("b",{children:"irreversible"}),". Please be certain."]}),Object(e.jsxs)(x.LemonButton,{status:"danger",type:"secondary",onClick:function(){return c(!0)},"data-attr":"delete-organization-button",icon:Object(e.jsx)(L.IconDelete,{}),disabled:n,children:["Delete ",(a==null?void 0:a.name)||"the current organization"]})]})]}),Object(e.jsx)(G,{isOpen:o,setIsOpen:c})]})}try{G.displayName="DeleteOrganizationModal",G.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},setIsOpen:{defaultValue:null,description:"",name:"setIsOpen",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:G.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(t){}try{J.displayName="DangerZone",J.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:J.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(t){}var Q=i("./frontend/src/lib/components/RestrictedArea.tsx"),De=i("./frontend/src/lib/hooks/useAnchor.ts"),Me=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),H=i.n(Me),ne=i("./frontend/src/lib/components/Tooltip.tsx"),on=i("./node_modules/core-js/modules/es.object.keys.js"),ln=i("./node_modules/core-js/modules/es.symbol.js"),cn=i("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),dn=i("./node_modules/core-js/modules/web.dom-collections.for-each.js"),un=i("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Ve=i("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),Ie=i.n(Ve),ze=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),Ne=i.n(ze),Te=i("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),w=i.n(Te),Ee=i("./node_modules/@babel/runtime/regenerator/index.js"),S=i.n(Ee),mn=i("./node_modules/core-js/modules/es.array.sort.js"),jn=i("./node_modules/core-js/modules/es.array.find.js"),fn=i("./node_modules/core-js/modules/es.array.includes.js"),vn=i("./node_modules/core-js/modules/es.string.includes.js"),gn=i("./node_modules/core-js/modules/es.string.match.js"),R=i("./frontend/src/lib/api.ts"),X=i("./frontend/src/lib/components/lemonToast.tsx"),me=i("./frontend/src/types.ts"),je=i("./node_modules/kea-forms/lib/index.js"),we=i("./node_modules/kea-loaders/lib/index.js"),Re=["id"];function fe(t,n){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),s.push.apply(s,a)}return s}function te(t){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?fe(Object(s),!0).forEach(function(a){Ne()(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):fe(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var D=Object(f.kea)([Object(f.path)(["scenes","organization","verifiedDomainsLogic"]),Object(f.connect)({values:[V.a,["currentOrganization"]]}),Object(f.actions)({replaceDomain:function(n){return{domain:n}},setAddModalShown:function(n){return{shown:n}},setConfigureSAMLModalId:function(n){return{id:n}},setVerifyModal:function(n){return{id:n}}}),Object(f.reducers)({verifiedDomains:[[],{replaceDomain:function(n,s){var a=s.domain,r=[].concat(H()(n.filter(function(l){var o=l.id;return o!==a.id})),[a]);return r.sort(function(l,o){return l.domain.localeCompare(o.domain)}),r}}],addModalShown:[!1,{setAddModalShown:function(n,s){var a=s.shown;return a},addVerifiedDomainSuccess:function(){return!1}}],configureSAMLModalId:[null,{setConfigureSAMLModalId:function(n,s){var a=s.id;return a}}],verifyModal:[null,{setVerifyModal:function(n,s){var a=s.id;return a}}]}),Object(we.loaders)(function(t){var n=t.values,s=t.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var a=w()(S.a.mark(function l(){var o;return S.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,R.b.get("api/organizations/".concat((o=n.currentOrganization)===null||o===void 0?void 0:o.id,"/domains"));case 2:return j.abrupt("return",j.sent.results);case 3:case"end":return j.stop()}},l)}));function r(){return a.apply(this,arguments)}return r}(),addVerifiedDomain:function(){var a=w()(S.a.mark(function l(o){var c,j;return S.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,R.b.create("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains"),{domain:o});case 2:return j=d.sent,d.abrupt("return",[j].concat(H()(n.verifiedDomains)));case 4:case"end":return d.stop()}},l)}));function r(l){return a.apply(this,arguments)}return r}(),deleteVerifiedDomain:function(){var a=w()(S.a.mark(function l(o){var c;return S.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,R.b.delete("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(o));case 2:return u.abrupt("return",H()(n.verifiedDomains.filter(function(d){return d.id!==o})));case 3:case"end":return u.stop()}},l)}));function r(l){return a.apply(this,arguments)}return r}()}],updatingDomain:[!1,{updateDomain:function(){var a=w()(S.a.mark(function l(o){var c,j;return S.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,R.b.update("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(o.id),te(te({},o),{},{id:void 0}));case 2:return j=d.sent,X.d.success("Domain updated successfully! Changes will take immediately."),s.replaceDomain(j),d.abrupt("return",!1);case 6:case"end":return d.stop()}},l)}));function r(l){return a.apply(this,arguments)}return r}(),verifyDomain:function(){var a=w()(S.a.mark(function l(){var o,c;return S.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,R.b.create("api/organizations/".concat((o=n.currentOrganization)===null||o===void 0?void 0:o.id,"/domains/").concat(n.verifyModal,"/verify"));case 2:return c=u.sent,c.is_verified?X.d.success("Domain verified successfully."):X.d.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),s.replaceDomain(c),s.setVerifyModal(null),u.abrupt("return",!1);case 7:case"end":return u.stop()}},l)}));function r(){return a.apply(this,arguments)}return r}()}]}}),Object(f.listeners)(function(t){var n=t.actions,s=t.values;return{setConfigureSAMLModalId:function(r){var l=r.id,o=s.verifiedDomains.find(function(d){var m=d.id;return m===l});if(l&&o){var c=o.saml_acs_url,j=o.saml_entity_id,u=o.saml_x509_cert;n.setSamlConfigValues({saml_acs_url:c,saml_entity_id:j,saml_x509_cert:u,id:l})}}}}),Object(f.selectors)({domainBeingVerified:[function(t){return[t.verifiedDomains,t.verifyModal]},function(t,n){return n&&t.find(function(s){var a=s.id;return a===n})||null}],isSSOEnforcementAvailable:[function(t){return[t.currentOrganization]},function(t){var n;return(n=t==null?void 0:t.available_features.includes(me.d.SSO_ENFORCEMENT))!==null&&n!==void 0?n:!1}],isSAMLAvailable:[function(t){return[t.currentOrganization]},function(t){var n;return(n=t==null?void 0:t.available_features.includes(me.d.SAML))!==null&&n!==void 0?n:!1}]}),Object(f.afterMount)(function(t){var n=t.actions;return n.loadVerifiedDomains()}),Object(je.forms)(function(t){var n=t.actions,s=t.values;return{samlConfig:{defaults:{},errors:function(r){return{saml_acs_url:r.saml_acs_url&&!r.saml_acs_url.match(p.y)?"Please enter a valid URL, including https://":void 0}},submit:function(){var a=w()(S.a.mark(function l(o,c){var j,u,d,m;return S.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(u=o.id,d=Ie()(o,Re),u){v.next=3;break}return v.abrupt("return");case 3:return v.next=5,R.b.update("api/organizations/".concat((j=s.currentOrganization)===null||j===void 0?void 0:j.id,"/domains/").concat(o.id),te({},d));case 5:m=v.sent,c(),n.replaceDomain(m),n.setConfigureSAMLModalId(null),n.setSamlConfigValues({}),X.d.success("SAML configuration for ".concat(m.domain," updated successfully."));case 11:case"end":return v.stop()}},l)}));function r(l,o){return a.apply(this,arguments)}return r}()}}})]),ie=i("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),P=i("./frontend/src/lib/components/LemonModal/index.ts");function Pe(){var t=Object(f.useValues)(D),n=t.addModalShown,s=t.verifiedDomainsLoading,a=Object(f.useActions)(D),r=a.setAddModalShown,l=a.addVerifiedDomain,o=Object(M.useState)(""),c=T()(o,2),j=c[0],u=c[1],d=Object(M.useState)(!1),m=T()(d,2),h=m[0],v=m[1],I=!j||!j.match(p.d),b=function(){u(""),v(!1)},C=function(){r(!1),b()},g=function(){v(!0),I||(l(j),b())};return Object(e.jsxs)(P.a,{onClose:C,isOpen:n,title:"Add authentication domain",footer:Object(e.jsx)(y.a,{type:"primary",disabled:j===""||h&&I||s,onClick:g,children:"Add domain"}),children:[Object(e.jsx)(x.LemonInput,{placeholder:"posthog.com",autoFocus:!0,value:j,onChange:u,onPressEnter:g}),h&&I&&Object(e.jsx)("span",{className:"text-danger text-xs",children:"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"})]})}var Be=i("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx"),B=i("./frontend/src/lib/forms/Field.tsx");function Fe(){var t=Object(f.useValues)(D),n=t.domainBeingVerified,s=t.updatingDomainLoading,a=Object(f.useActions)(D),r=a.setVerifyModal,l=a.verifyDomain,o="_posthog-challenge.".concat(n==null?void 0:n.domain,".");return Object(e.jsx)(P.a,{isOpen:!!n,onClose:function(){return r(null)},title:"Verify your domain",description:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(ee.a,{className:"uppercase",children:(n==null?void 0:n.domain)||""}),Object(e.jsx)("p",{children:"To verify your domain, you need to add a record to your DNS zone."})]}),footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(y.a,{type:"secondary",onClick:function(){return r(null)},children:"Verify later"}),Object(e.jsx)(y.a,{type:"primary",disabled:s,onClick:l,children:"Verify"})]}),children:Object(e.jsx)("div",{children:Object(e.jsxs)("ol",{children:[Object(e.jsx)("li",{children:"Sign in to your DNS provider."}),Object(e.jsxs)("li",{children:["Add the following ",Object(e.jsx)("b",{children:"TXT"})," record.",Object(e.jsxs)("div",{className:"my-4 space-y-2",children:[Object(e.jsx)(B.b,{label:"Name",children:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:o}),Object(e.jsx)(k.a,{explicitValue:o})]})}),Object(e.jsx)(B.b,{label:"Value or content",children:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:n==null?void 0:n.verification_challenge}),Object(e.jsx)(k.a,{explicitValue:n==null?void 0:n.verification_challenge})]})}),Object(e.jsx)(B.b,{label:"TTL",children:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:"Default or 3600"}),Object(e.jsx)(k.a,{explicitValue:"3600"})]})})]})]}),Object(e.jsx)("li",{children:"Press verify below."})]})})})}var ve=i("./frontend/src/lib/components/Link.tsx"),Ke=i("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),Ue=i("./frontend/src/lib/components/AlertMessage/index.ts"),ge=i("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),Ye=i("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx");function $e(){var t=Object(f.useValues)(D),n=t.configureSAMLModalId,s=t.isSamlConfigSubmitting,a=t.samlConfig,r=Object(f.useActions)(D),l=r.setConfigureSAMLModalId,o=a.saml_acs_url&&a.saml_entity_id&&a.saml_x509_cert,c=function(){l(null)};return Object(e.jsx)(P.a,{onClose:c,isOpen:!!n,title:"",simple:!0,children:Object(e.jsxs)(je.Form,{logic:D,formKey:"samlConfig",enableFormOnSubmit:!0,className:"LemonModal__layout ",children:[Object(e.jsx)(P.a.Header,{children:Object(e.jsx)("h3",{children:"Configure SAML authentication and provisioning"})}),Object(e.jsxs)(P.a.Content,{className:"space-y-2",children:[Object(e.jsx)(B.a,{name:"saml_acs_url",label:"SAML ACS URL",children:Object(e.jsx)(ge.a,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})}),Object(e.jsx)(B.a,{name:"saml_entity_id",label:"SAML Entity ID",children:Object(e.jsx)(ge.a,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})}),Object(e.jsx)(B.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate",children:Object(e.jsx)(Ye.a,{className:"ph-ignore-input",minRows:10,placeholder:`Enter the public certificate of your IdP. Keep all line breaks.
-----BEGIN CERTIFICATE-----
MIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL
-----END CERTIFICATE-----`})}),!o&&Object(e.jsx)(Ue.a,{type:"info",children:"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft."})]}),Object(e.jsx)(P.a.Footer,{children:Object(e.jsx)(y.a,{loading:s,type:"primary",htmlType:"submit",children:"Save settings"})})]})})}var F={marginRight:4,fontSize:"1.15em",paddingTop:2};function ke(){var t=Object(f.useValues)(D),n=t.verifiedDomainsLoading,s=t.updatingDomainLoading,a=Object(f.useActions)(D),r=a.setAddModalShown;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsxs)("div",{style:{flexGrow:1},children:[Object(e.jsx)("div",{id:"domain-whitelist"})," ",Object(e.jsx)("h2",{id:"authentication-domains",className:"subtitle",children:"Authentication domains"}),Object(e.jsx)("p",{className:"text-muted-alt",children:"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains."})]}),Object(e.jsx)(y.a,{type:"primary",onClick:function(){return r(!0)},disabled:n||s,children:"Add domain"})]}),Object(e.jsx)(We,{})]})}function We(){var t=Object(f.useValues)(D),n=t.verifiedDomains,s=t.verifiedDomainsLoading,a=t.currentOrganization,r=t.updatingDomainLoading,l=t.isSSOEnforcementAvailable,o=t.isSAMLAvailable,c=Object(f.useActions)(D),j=c.updateDomain,u=c.deleteVerifiedDomain,d=c.setVerifyModal,m=c.setConfigureSAMLModalId,h=Object(f.useValues)(ce.a),v=h.preflight,I=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function(C,g){var O=g.domain;return Object(e.jsx)(ee.a,{children:O})}}].concat(H()(v!=null&&v.cloud?[{key:"is_verified",title:Object(e.jsxs)(e.Fragment,{children:["Verification",Object(e.jsx)(ne.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO).",children:Object(e.jsx)(ie.a,{style:{marginLeft:4}})})]}),render:function(C,g){var O=g.is_verified,A=g.verified_at;return O?Object(e.jsxs)("div",{className:"flex items-center text-success",children:[Object(e.jsx)(L.IconCheckmark,{style:F})," Verified"]}):A?Object(e.jsxs)("div",{className:"flex items-center text-danger",children:[Object(e.jsx)(L.IconExclamation,{style:F})," Verification expired"]}):Object(e.jsxs)("div",{className:"flex items-center text-warning",children:[Object(e.jsx)(L.IconWarning,{style:F})," Pending verification"]})}}]:[]),[{key:"jit_provisioning_enabled",title:Object(e.jsxs)(e.Fragment,{children:["Automatic provisioning"," ",Object(e.jsx)(ne.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((a==null?void 0:a.name)||"this organization"," if it does not exist."),children:Object(e.jsx)(ie.a,{})})]}),render:function(C,g){var O=g.jit_provisioning_enabled,A=g.id,z=g.is_verified;return z?Object(e.jsx)("div",{className:"flex items-center",children:Object(e.jsx)(Ke.a,{checked:O,disabled:r||!z,onChange:function(K){return j({id:A,jit_provisioning_enabled:K})},label:Object(e.jsx)("span",{className:"font-normal",children:O?"Enabled":"Disabled"})})}):Object(e.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable automatic provisioning"})}},{key:"sso_enforcement",title:Object(e.jsxs)(e.Fragment,{children:["Enforce SSO"," ",Object(e.jsx)(ne.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider.",children:Object(e.jsx)(ie.a,{})})]}),render:function(C,g,O){var A=g.sso_enforcement,z=g.is_verified,N=g.id,K=g.has_saml;return l?z?Object(e.jsx)(Be.a,{value:A,loading:r,onChange:function(Qe){return j({id:N,sso_enforcement:Qe})},samlAvailable:K}):Object(e.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):O===0?Object(e.jsxs)(ve.a,{to:Object(p.E)(v==null?void 0:v.cloud).url,target:Object(p.E)(v==null?void 0:v.cloud).target,className:"flex items-center",children:[Object(e.jsx)(L.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"]}):Object(e.jsx)(e.Fragment,{})}},{key:"saml",title:"SAML",render:function(C,g,O){var A=g.is_verified,z=g.saml_acs_url,N=g.saml_entity_id,K=g.saml_x509_cert,Oe=g.has_saml;return o?A?Object(e.jsx)(e.Fragment,{children:Oe?Object(e.jsxs)("div",{className:"flex items-center text-success",children:[Object(e.jsx)(L.IconCheckmark,{style:F})," SAML enabled"]}):z||N||K?Object(e.jsxs)("div",{className:"flex items-center text-warning",children:[Object(e.jsx)(L.IconWarning,{style:F})," SAML partially configured"]}):Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsx)(L.IconOffline,{style:F})," SAML not set up"]})}):Object(e.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):O===0?Object(e.jsxs)(ve.a,{to:Object(p.E)(v==null?void 0:v.cloud).url,target:Object(p.E)(v==null?void 0:v.cloud).target,className:"flex items-center",children:[Object(e.jsx)(L.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"]}):Object(e.jsx)(e.Fragment,{})}},{key:"actions",width:32,align:"center",render:function(C,g){var O=g.is_verified,A=g.id,z=g.domain;return O?Object(e.jsx)(ue.a,{overlay:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(y.a,{status:"stealth",onClick:function(){return m(A)},fullWidth:!0,disabled:!o,title:o?void 0:"Upgrade to enable SAML",children:"Configure SAML"}),Object(e.jsxs)(y.a,{status:"danger",onClick:function(){return W.a.open({title:"Remove ".concat(z,"?"),description:"This cannot be undone. If you have SAML configured or SSO enforced,it will be immediately disabled.",primaryButton:{status:"danger",children:"Remove domain",onClick:function(){return u(A)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0,children:[Object(e.jsx)(L.IconDelete,{})," Remove domain"]})]}),style:{display:"inline-block"}}):Object(e.jsx)(y.a,{type:"primary",onClick:function(){return d(A)},children:"Verify"})}}]);return Object(e.jsxs)("div",{children:[Object(e.jsx)(q.a,{dataSource:n,columns:I,loading:s,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),Object(e.jsx)(Pe,{}),Object(e.jsx)($e,{}),Object(e.jsx)(Fe,{})]})}var Ze={component:be,logic:V.a};function Ge(t){var n=t.isRestricted,s=Object(f.useValues)(V.a),a=s.currentOrganization,r=s.currentOrganizationLoading,l=Object(f.useActions)(V.a),o=l.updateOrganization,c=Object(M.useState)((a==null?void 0:a.name)||""),j=T()(c,2),u=j[0],d=j[1];return Object(e.jsxs)("div",{style:{maxWidth:"40rem"},children:[Object(e.jsx)("h2",{id:"name",className:"subtitle mt-0",children:"Display Name"}),Object(e.jsx)(x.LemonInput,{className:"mb-4",value:u,onChange:d,disabled:n}),Object(e.jsx)(x.LemonButton,{type:"primary",onClick:function(h){h.preventDefault(),o({name:u})},disabled:n||!u||!a||u===a.name,loading:r,children:"Rename Organization"})]})}function Je(t){var n=t.isRestricted,s=Object(f.useValues)(V.a),a=s.currentOrganization,r=Object(f.useActions)(V.a),l=r.updateOrganization;return Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{id:"notification-preferences",className:"subtitle",children:"Notification Preferences"}),Object(e.jsx)("div",{children:Object(e.jsx)(x.LemonSwitch,{"data-attr":"is-member-join-email-enabled-switch",onChange:function(c){l({is_member_join_email_enabled:c})},checked:!!(a!=null&&a.is_member_join_email_enabled),disabled:n||!a,label:"Email all current members when a new member joins",bordered:!0})})]})}function be(){var t=Object(f.useValues)(de.a),n=t.user;return Object(De.a)(location.hash),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Y.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),Object(e.jsxs)("div",{className:"border rounded p-6",children:[Object(e.jsx)(Q.a,{Component:Ge,minimumAccessLevel:p.q.Admin}),Object(e.jsx)(x.LemonDivider,{className:"my-6"}),Object(e.jsx)(Se,{}),Object(e.jsx)(x.LemonDivider,{className:"my-6"}),n&&Object(e.jsx)(Z,{user:n}),Object(e.jsx)(x.LemonDivider,{className:"my-6"}),Object(e.jsx)(Q.a,{Component:ke,minimumAccessLevel:p.q.Admin}),Object(e.jsx)(x.LemonDivider,{className:"my-6"}),Object(e.jsx)(Q.a,{Component:Je,minimumAccessLevel:p.q.Admin}),Object(e.jsx)(x.LemonDivider,{className:"my-6"}),Object(e.jsx)(Q.a,{Component:J,minimumAccessLevel:p.q.Owner})]})]})}}}]);
