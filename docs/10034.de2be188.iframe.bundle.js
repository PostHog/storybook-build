(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[10034],{"../../frontend/src/scenes/data-warehouse/editor/EditorScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EditorScene:()=>EditorScene_EditorScene});var injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),EditorScene=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/EditorScene.scss"),EditorScene_default=__webpack_require__.n(EditorScene),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(EditorScene_default(),options),EditorScene_default().locals;var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),dataNodeLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),variableModalLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/variableModalLogic.ts"),variablesLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/variablesLogic.ts"),dataVisualizationLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/dataVisualizationLogic.ts"),displayLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/displayLogic.ts"),types=__webpack_require__("../../frontend/src/types.ts"),ViewLinkModal=__webpack_require__("../../frontend/src/scenes/data-warehouse/ViewLinkModal.tsx"),resizerLogic=__webpack_require__("../../frontend/src/lib/components/Resizer/resizerLogic.ts");let editorSizingLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","editorSizingLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(props=>({values:[(0,resizerLogic.Z)(props.sourceNavigatorResizerProps),["desiredSize as sourceNavigatorDesiredSize"],(0,resizerLogic.Z)(props.sidebarResizerProps),["desiredSize as sidebarDesiredSize"],(0,resizerLogic.Z)(props.queryPaneResizerProps),["desiredSize as queryPaneDesiredSize"]],actions:[(0,resizerLogic.Z)(props.sidebarResizerProps),["setDesiredSize as sidebarSetDesiredSize"]]})),(0,index_esm.actions)({resetDefaultSidebarWidth:!0}),(0,index_esm.listeners)(_ref=>{let{actions}=_ref;return{resetDefaultSidebarWidth:()=>{actions.sidebarSetDesiredSize(300)}}}),(0,index_esm.selectors)({editorSceneRef:[()=>[(_,props)=>props.editorSceneRef],editorSceneRef=>editorSceneRef],sourceNavigatorWidth:[s=>[s.sourceNavigatorDesiredSize],desiredSize=>Math.max(desiredSize||350,100)],queryPaneHeight:[s=>[s.queryPaneDesiredSize],queryPaneDesiredSize=>Math.max(queryPaneDesiredSize||300,100)],queryTabsWidth:[s=>[s.queryPaneDesiredSize],desiredSize=>desiredSize||350],sourceNavigatorResizerProps:[()=>[(_,props)=>props.sourceNavigatorResizerProps],sourceNavigatorResizerProps=>sourceNavigatorResizerProps],queryPaneResizerProps:[()=>[(_,props)=>props.queryPaneResizerProps],queryPaneResizerProps=>queryPaneResizerProps],sidebarWidth:[s=>[s.sidebarDesiredSize],desiredSize=>null!==desiredSize&&desiredSize<75?0:Math.min(Math.max(desiredSize||300,150),550)],sidebarResizerProps:[()=>[(_,props)=>props.sidebarResizerProps],sidebarResizerProps=>sidebarResizerProps]})]);var multitabEditorLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/multitabEditorLogic.tsx"),outputPaneLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/outputPaneLogic.ts"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.24.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),panelLayoutLogic=__webpack_require__("../../frontend/src/layout/panel-layout/panelLayoutLogic.tsx"),dataWarehouseViewsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/saved_queries/dataWarehouseViewsLogic.tsx"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.257.0_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),fixSQLErrorsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/fixSQLErrorsLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function FixErrorButton(_ref){let{type,size,contentOverride,source}=_ref,{queryInput,fixErrorsError,metadata}=(0,index_esm.useValues)(multitabEditorLogic.tg),{fixErrors:fixHogQLErrors}=(0,index_esm.useActions)(multitabEditorLogic.tg),{responseError}=(0,index_esm.useValues)(dataNodeLogic.M),{responseLoading:fixHogQLErrorsLoading}=(0,index_esm.useValues)(fixSQLErrorsLogic.g),queryError=responseError||metadata?.errors?.map(n=>n.message)?.join(". ")||void 0,icon=(0,react.useMemo)(()=>fixHogQLErrorsLoading?(0,jsx_runtime.jsx)(src.$j,{}):fixErrorsError?(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{className:"text-warning"}):(0,jsx_runtime.jsx)(posthog_icons_es.IconMagicWand,{}),[fixHogQLErrorsLoading,fixErrorsError]),disabledReason=(0,react.useMemo)(()=>queryError?!!fixErrorsError&&fixErrorsError:"No query error to fix",[queryError,fixErrorsError]),content=(0,react.useMemo)(()=>fixHogQLErrorsLoading?"Fixing...":fixErrorsError?"Can't fix":null!=contentOverride?contentOverride:"Fix errors",[fixErrorsError,fixHogQLErrorsLoading,contentOverride]);return(0,jsx_runtime.jsx)(LemonButton.J,{type:type,size:size,disabledReason:disabledReason,icon:icon,onClick:()=>{fixHogQLErrors(queryInput,queryError),dist_module.ZP.capture("sql-editor-fix-error-click",{source})},children:content})}__webpack_require__("../../node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-data-grid/lib/styles.css");var DataGrid=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/DataGrid.scss"),DataGrid_default=__webpack_require__.n(DataGrid),DataGrid_options={};DataGrid_options.insert="head",DataGrid_options.singleton=!1,injectStylesIntoStyleTag_default()(DataGrid_default(),DataGrid_options),DataGrid_default().locals;var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),ExportButton=__webpack_require__("../../frontend/src/lib/components/ExportButton/ExportButton.tsx"),JSONViewer=__webpack_require__("../../frontend/src/lib/components/JSONViewer.tsx"),LemonMenu=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/LemonMenu.tsx"),LoadingBar=__webpack_require__("../../frontend/src/lib/lemon-ui/LoadingBar/index.ts"),copyToClipboard=__webpack_require__("../../frontend/src/lib/utils/copyToClipboard.tsx"),bundle=__webpack_require__("../../node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-data-grid/lib/bundle.js"),EmptyStates=__webpack_require__("../../frontend/src/scenes/insights/EmptyStates/index.ts"),BoldNumber=__webpack_require__("../../frontend/src/scenes/insights/views/BoldNumber/BoldNumber.tsx"),KeyboardShortcut=__webpack_require__("../../frontend/src/layout/navigation-3000/components/KeyboardShortcut.tsx"),themeLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),DateRange=__webpack_require__("../../frontend/src/queries/nodes/DataNode/DateRange.tsx"),ElapsedTime=__webpack_require__("../../frontend/src/queries/nodes/DataNode/ElapsedTime.tsx"),LoadNext=__webpack_require__("../../frontend/src/queries/nodes/DataNode/LoadNext.tsx"),LineGraph=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Charts/LineGraph.tsx"),SideBar=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/queries/nodes/DataVisualization/Components/SideBar.scss"),SideBar_default=__webpack_require__.n(SideBar),SideBar_options={};SideBar_options.insert="head",SideBar_options.singleton=!1,injectStylesIntoStyleTag_default()(SideBar_default(),SideBar_options),SideBar_default().locals;var ConditionalFormattingTab=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/queries/nodes/DataVisualization/Components/ConditionalFormatting/ConditionalFormattingTab.scss"),ConditionalFormattingTab_default=__webpack_require__.n(ConditionalFormattingTab),ConditionalFormattingTab_options={};ConditionalFormattingTab_options.insert="head",ConditionalFormattingTab_options.singleton=!1,injectStylesIntoStyleTag_default()(ConditionalFormattingTab_default(),ConditionalFormattingTab_options),ConditionalFormattingTab_default().locals;var DataVisualization_types=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/types.ts"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_subscriptions_lib=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.5_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let conditionalFormattingLogic=(0,index_esm.kea)([(0,index_esm.key)(props=>props.rule.id),(0,index_esm.path)(["queries","nodes","DataVisualization","Components","conditionalFormattingLogic"]),(0,index_esm.props)({rule:{id:""},key:""}),(0,index_esm.connect)(()=>({actions:[dataVisualizationLogic.H8,["updateConditionalFormattingRule"]]})),(0,index_esm.actions)({selectColumn:columnName=>({columnName}),updateInput:input=>({input}),selectTemplate:templateId=>({templateId}),updateBytecode:bytecode=>({bytecode}),selectColor:color=>({color}),deleteRule:!0}),(0,index_esm.reducers)(_ref=>{let{props}=_ref;return{rule:[props.rule,{selectColumn:(state,_ref2)=>{let{columnName}=_ref2;return{...state,columnName}},updateInput:(state,_ref3)=>{let{input}=_ref3;return{...state,input}},selectTemplate:(state,_ref4)=>{let{templateId}=_ref4;return{...state,templateId}},updateBytecode:(state,_ref5)=>{let{bytecode}=_ref5;return{...state,bytecode}},selectColor:(state,_ref6)=>{let{color}=_ref6;return{...state,color}}}]}}),(0,index_esm.selectors)({template:[s=>[s.rule],rule=>{let template=DataVisualization_types.p.find(n=>n.id===rule.templateId);return template||DataVisualization_types.p[0]}]}),(0,kea_loaders_lib.loaders)({hog:[null,{compileHog:async _ref7=>{let{hog}=_ref7;return(await api.ZP.hog.create(hog)).bytecode}}]}),(0,index_esm.listeners)(_ref8=>{let{actions,values}=_ref8;return{compileHogSuccess:_ref9=>{let{hog}=_ref9;actions.updateBytecode(hog)},deleteRule:()=>{actions.updateConditionalFormattingRule(values.rule,!0)}}}),(0,kea_subscriptions_lib.Vt)(_ref10=>{let{actions}=_ref10;return{template:(template,oldTemplate)=>{actions.compileHog({hog:template.hog}),!oldTemplate?.hideInput&&template.hideInput&&actions.updateInput("")},rule:rule=>{actions.updateConditionalFormattingRule(rule)}}})]),DEFAULT_PICKER_COLORS=["#FFADAD","#E8A598","#FFD6A5","#FFCFD2","#FDFFB6","#C1FBA4","#9BF6FF","#A0C4FF","#BDB2FF","#FFC6FF"],getRuleHeader=rule=>{if(!rule.columnName||!rule.input)return"New rule";let template=DataVisualization_types.p.find(n=>n.id===rule.templateId);return template?template.hideInput?`${rule.columnName} ${template.label.toLowerCase()}`:`${rule.columnName} ${template.label.toLowerCase()} ${rule.input}`:"New rule"},RuleItem=_ref=>{let{rule:propsRule}=_ref,{columns,responseLoading,dataVisualizationProps}=(0,index_esm.useValues)(dataVisualizationLogic.H8),builtCFLogic=conditionalFormattingLogic({key:dataVisualizationProps.key,rule:propsRule}),{selectColumn,updateInput,selectTemplate,selectColor,deleteRule}=(0,index_esm.useActions)(builtCFLogic),{rule,template}=(0,index_esm.useValues)(builtCFLogic);return(0,jsx_runtime.jsxs)("div",{className:"gap-2 flex flex-col",children:[(0,jsx_runtime.jsx)(src.Yv,{placeholder:"Column",className:"w-full",value:rule.columnName||null,options:columns.map(_ref2=>{let{name,type}=_ref2;return{value:name,label:(0,jsx_runtime.jsxs)("div",{className:"items-center flex-1",children:[name,(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"default",children:type.name})]})}}),disabledReason:responseLoading?"Query loading...":void 0,onChange:value=>{let column=columns.find(n=>n.name===value);column&&selectColumn(column.name)}}),(0,jsx_runtime.jsx)(src.Yv,{className:"w-full",options:DataVisualization_types.p.filter(n=>{let column=columns.find(n=>n.name===rule.columnName);return!column||n.availableColumnTypes.includes(column.type.name)}).map(_ref3=>{let{id,label}=_ref3;return{label,value:id}}),value:rule.templateId,onSelect:value=>selectTemplate(value)}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-1",children:[(0,jsx_runtime.jsx)(src.zn,{selectedColor:rule.color,onSelectColor:selectColor,colors:DEFAULT_PICKER_COLORS,showCustomColor:!0,hideDropdown:!0}),(0,jsx_runtime.jsx)(src.DF,{placeholder:"value",className:"ml-2 flex-1",onChange:value=>updateInput(value),value:rule.input,disabled:template.hideInput}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",title:"Delete rule",className:"ml-1",noPadding:!0,tooltip:"Delete formatting rule",onClick:()=>deleteRule()})]})]})};var SeriesGlyph=__webpack_require__("../../frontend/src/lib/components/SeriesGlyph.tsx"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),kea_forms_lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),colors=__webpack_require__("../../frontend/src/lib/colors.ts"),seriesBreakdownLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/seriesBreakdownLogic.ts");let YSeriesSettingsTab=function(YSeriesSettingsTab){return YSeriesSettingsTab.Formatting="formatting",YSeriesSettingsTab.Display="display",YSeriesSettingsTab}({}),ySeriesLogic=(0,index_esm.kea)([(0,index_esm.path)(["queries","nodes","DataVisualization","Components","ySeriesLogic"]),(0,index_esm.key)(props=>{var _props$series$column$,_props$seriesIndex;return`${null!==(_props$series$column$=props.series?.column?.name)&&void 0!==_props$series$column$?_props$series$column$:"new"}-${null!==(_props$seriesIndex=props.seriesIndex)&&void 0!==_props$seriesIndex?_props$seriesIndex:0}`}),(0,index_esm.connect)(props=>({actions:[(0,dataVisualizationLogic.H8)(props.dataVisualizationProps),["updateSeriesIndex"]]})),(0,index_esm.props)({series:dataVisualizationLogic.pf}),(0,index_esm.actions)({setSettingsOpen:open=>({open}),setSettingsTab:tab=>({tab})}),(0,index_esm.reducers)({isSettingsOpen:[!1,{setSettingsOpen:(_,_ref)=>{let{open}=_ref;return open}}],activeSettingsTab:[YSeriesSettingsTab.Formatting,{setSettingsTab:(_state,_ref2)=>{let{tab}=_ref2;return tab}}]}),(0,index_esm.selectors)({canOpenSettings:[(_s,p)=>[p.series],series=>series!==dataVisualizationLogic.pf]}),(0,kea_forms_lib.forms)(_ref3=>{var _props$series$setting,_props$series$setting2,_props$series$setting3,_props$series$setting4,_props$series$setting5,_props$series$setting6,_props$series$setting7,_props$series$setting8;let{actions,props}=_ref3;return{formatting:{defaults:{prefix:null!==(_props$series$setting=props.series?.settings?.formatting?.prefix)&&void 0!==_props$series$setting?_props$series$setting:"",suffix:null!==(_props$series$setting2=props.series?.settings?.formatting?.suffix)&&void 0!==_props$series$setting2?_props$series$setting2:"",style:null!==(_props$series$setting3=props.series?.settings?.formatting?.style)&&void 0!==_props$series$setting3?_props$series$setting3:"none",decimalPlaces:props.series?.settings?.formatting?.decimalPlaces},submit:async format=>{actions.updateSeriesIndex(props.seriesIndex,props.series.column.name,{formatting:{prefix:format.prefix,suffix:format.suffix,style:format.style,decimalPlaces:Number.isNaN(format.decimalPlaces)?void 0:format.decimalPlaces}}),actions.setSettingsOpen(!1)}},display:{defaults:{color:null!==(_props$series$setting4=props.series?.settings?.display?.color)&&void 0!==_props$series$setting4?_props$series$setting4:(0,colors._r)(props.seriesIndex),label:null!==(_props$series$setting5=props.series?.settings?.display?.label)&&void 0!==_props$series$setting5?_props$series$setting5:"",trendLine:null!==(_props$series$setting6=props.series?.settings?.display?.trendLine)&&void 0!==_props$series$setting6&&_props$series$setting6,yAxisPosition:null!==(_props$series$setting7=props.series?.settings?.display?.yAxisPosition)&&void 0!==_props$series$setting7?_props$series$setting7:"left",displayType:null!==(_props$series$setting8=props.series?.settings?.display?.displayType)&&void 0!==_props$series$setting8?_props$series$setting8:"auto"},submit:async display=>{actions.updateSeriesIndex(props.seriesIndex,props.series.column.name,{display:{color:display.color,label:display.label,trendLine:display.trendLine,yAxisPosition:display.yAxisPosition,displayType:display.displayType}}),actions.setSettingsOpen(!1)}}}})]),YSeries=_ref2=>{var _series$settings$disp;let{series,index}=_ref2,{columns,numericalColumns,responseLoading,dataVisualizationProps,showTableSettings}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{updateSeriesIndex,deleteYSeries}=(0,index_esm.useActions)(dataVisualizationLogic.H8),{selectedSeriesBreakdownColumn}=(0,index_esm.useValues)((0,seriesBreakdownLogic.h)({key:dataVisualizationProps.key})),seriesLogicProps={series,seriesIndex:index,dataVisualizationProps},seriesLogic=ySeriesLogic(seriesLogicProps),{isSettingsOpen,canOpenSettings,activeSettingsTab}=(0,index_esm.useValues)(seriesLogic),{setSettingsOpen,submitFormatting,submitDisplay,setSettingsTab}=(0,index_esm.useActions)(seriesLogic),seriesColor=null!==(_series$settings$disp=series.settings?.display?.color)&&void 0!==_series$settings$disp?_series$settings$disp:(0,colors._r)(index),showSeriesColor=!showTableSettings&&!selectedSeriesBreakdownColumn,options=(showTableSettings?columns:numericalColumns).map(_ref3=>{let{name,type}=_ref3;return{value:name,label:(0,jsx_runtime.jsxs)("div",{className:"items-center flex flex-1",children:[showSeriesColor&&(0,jsx_runtime.jsx)(src.Jw,{className:"mr-2",color:seriesColor}),series.settings?.display?.label&&series.column.name===name?series.settings.display.label:name,(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"default",children:type.name})]})}});return(0,jsx_runtime.jsxs)("div",{className:"flex gap-1 mb-1",children:[(0,jsx_runtime.jsx)(src.Yv,{className:"grow flex-1 break-all",value:null!==series?series.column.name:"None",options:options,disabledReason:responseLoading?"Query loading...":void 0,onChange:value=>{let column=columns.find(n=>n.name===value);column&&updateSeriesIndex(index,column.name)}}),(0,jsx_runtime.jsx)(src.J2,{overlay:(0,jsx_runtime.jsx)("div",{className:"m-2",children:(0,jsx_runtime.jsx)(src.TP,{activeKey:activeSettingsTab,barClassName:"justify-around",onChange:tab=>setSettingsTab(tab),tabs:Object.values(Y_SERIES_SETTINGS_TABS).map((_ref4,index)=>{let{label,Component}=_ref4;return{label:label,key:Object.keys(Y_SERIES_SETTINGS_TABS)[index],content:(0,jsx_runtime.jsx)(Component,{ySeriesLogicProps:seriesLogicProps})}})})}),visible:isSettingsOpen,placement:"bottom",onClickOutside:()=>{submitFormatting(),submitDisplay()},children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),noPadding:!0,onClick:()=>setSettingsOpen(!0),disabledReason:!canOpenSettings&&"Select a column first"},"seriesSettings")}),!showTableSettings&&(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",title:"Delete Y-series",noPadding:!0,onClick:()=>deleteYSeries(index)},"delete")]})},Y_SERIES_SETTINGS_TABS={[YSeriesSettingsTab.Formatting]:{label:"Formatting",Component:_ref5=>{let{ySeriesLogicProps}=_ref5;return(0,jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:ySeriesLogic,props:ySeriesLogicProps,formKey:"formatting",className:"deprecated-space-y-4",children:[ySeriesLogicProps.series.column.type.isNumerical&&(0,jsx_runtime.jsx)(LemonField.D,{name:"style",label:"Style",className:"gap-1",children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"none",label:"None"},{value:"number",label:"Number"},{value:"percent",label:"Percentage"}]})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"prefix",label:"Prefix",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"$"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"suffix",label:"Suffix",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"USD"})}),ySeriesLogicProps.series.column.type.isNumerical&&(0,jsx_runtime.jsx)(LemonField.D,{name:"decimalPlaces",label:"Decimal places",children:(0,jsx_runtime.jsx)(src.DF,{type:"number",min:0})})]})}},[YSeriesSettingsTab.Display]:{label:"Display",Component:_ref6=>{let{ySeriesLogicProps}=_ref6,{showTableSettings,dataVisualizationProps}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{selectedSeriesBreakdownColumn}=(0,index_esm.useValues)((0,seriesBreakdownLogic.h)({key:dataVisualizationProps.key})),showColorPicker=!showTableSettings&&!selectedSeriesBreakdownColumn,showLabelInput=showTableSettings||!selectedSeriesBreakdownColumn;return(0,jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:ySeriesLogic,props:ySeriesLogicProps,formKey:"display",className:"deprecated-space-y-4",children:[(showColorPicker||showLabelInput)&&(0,jsx_runtime.jsxs)("div",{className:"flex gap-3",children:[showColorPicker&&(0,jsx_runtime.jsx)(LemonField.D,{name:"color",label:"Color",children:_ref7=>{let{value,onChange}=_ref7;return(0,jsx_runtime.jsx)(src.zn,{selectedColor:value,onSelectColor:onChange,colors:(0,colors.Qu)(),showCustomColor:!0,hideDropdown:!0,preventPopoverClose:!0})}}),showLabelInput&&(0,jsx_runtime.jsx)(LemonField.D,{name:"label",label:"Label",children:(0,jsx_runtime.jsx)(src.DF,{})})]}),!showTableSettings&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!selectedSeriesBreakdownColumn&&(0,jsx_runtime.jsx)(LemonField.D,{name:"trendLine",label:"Trend line",children:_ref8=>{let{value,onChange}=_ref8;return(0,jsx_runtime.jsx)(src.f4,{checked:value,onChange:newValue=>onChange(newValue)})}}),(0,jsx_runtime.jsx)(LemonField.D,{name:"yAxisPosition",label:"Y-axis position",children:_ref9=>{let{value,onChange}=_ref9;return(0,jsx_runtime.jsx)(src.P4,{value:value,className:"w-full",options:[{label:"Left",value:"left"},{label:"Right",value:"right"}],onChange:newValue=>onChange(newValue)})}}),(0,jsx_runtime.jsx)(LemonField.D,{name:"displayType",label:"Display type",children:_ref10=>{let{value,onChange}=_ref10;return(0,jsx_runtime.jsx)(src.P4,{value:value,className:"w-full",options:[{label:"Auto",value:"auto"},{label:"Line",value:"line"},{label:"Bar",value:"bar"}],onChange:newValue=>onChange(newValue)})}})]})]})}}},SeriesBreakdownSelector=()=>{let{columns,responseLoading,selectedXAxis,dataVisualizationProps}=(0,index_esm.useValues)(dataVisualizationLogic.H8),breakdownLogic=(0,seriesBreakdownLogic.h)({key:dataVisualizationProps.key}),{selectedSeriesBreakdownColumn,seriesBreakdownData}=(0,index_esm.useValues)(breakdownLogic),{addSeriesBreakdown,deleteSeriesBreakdown}=(0,index_esm.useActions)(breakdownLogic),seriesBreakdownOptions=columns.map(_ref11=>{let{name,type}=_ref11;return{value:name,label:(0,jsx_runtime.jsxs)("div",{className:"items-center flex-1",children:[name,(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"default",children:type.name})]})}}).filter(column=>column.value!==selectedXAxis);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-1 my-1",children:[(0,jsx_runtime.jsx)(src.Yv,{className:"grow",value:null!==selectedSeriesBreakdownColumn?selectedSeriesBreakdownColumn:"None",options:seriesBreakdownOptions,disabledReason:responseLoading?"Query loading...":void 0,onChange:value=>{let column=columns.find(n=>n.name===value);column&&addSeriesBreakdown(column.name)}}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",title:"Delete series breakdown",noPadding:!0,onClick:()=>deleteSeriesBreakdown()},"delete")]}),(0,jsx_runtime.jsx)("div",{className:"ml-4 mt-2",children:seriesBreakdownData.error?(0,jsx_runtime.jsx)("div",{className:"text-danger font-bold mt-1",children:seriesBreakdownData.error}):seriesBreakdownData.seriesData.map((series,index)=>(0,jsx_runtime.jsx)(BreakdownSeries,{series:series,index:index},`${series.name}-${index}`))})]})},BreakdownSeries=_ref12=>{var _series$settings$disp2;let{series,index}=_ref12,seriesColor=null!==(_series$settings$disp2=series.settings?.display?.color)&&void 0!==_series$settings$disp2?_series$settings$disp2:(0,colors._r)(index);return(0,jsx_runtime.jsx)("div",{className:"flex gap-1 mb-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jw,{color:seriesColor,className:"mr-2"}),(0,jsx_runtime.jsx)("span",{children:series.name?series.name:"[No value]"})]})})},TABS_TO_CONTENT={[dataVisualizationLogic.B8.Series]:{label:"Series",content:(0,jsx_runtime.jsx)(()=>{let{columns,numericalColumns,xData,yData,responseLoading,showTableSettings,tabularColumns,selectedXAxis,dataVisualizationProps}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{updateXSeries,addYSeries}=(0,index_esm.useActions)(dataVisualizationLogic.H8),breakdownLogic=(0,seriesBreakdownLogic.h)({key:dataVisualizationProps.key}),{showSeriesBreakdown}=(0,index_esm.useValues)(breakdownLogic),{addSeriesBreakdown}=(0,index_esm.useActions)(breakdownLogic),hideAddYSeries=yData.length>=numericalColumns.length,hideAddSeriesBreakdown=!(!showSeriesBreakdown&&selectedXAxis&&columns.length>yData.length);if(showTableSettings)return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Columns"}),tabularColumns.map((series,index)=>(0,jsx_runtime.jsx)(YSeries,{series:series,index:index},`${series.column.name}-${index}`))]});let options=columns.map(_ref=>{let{name,type}=_ref;return{value:name,label:(0,jsx_runtime.jsxs)("div",{className:"items-center flex-1",children:[name,(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"default",children:type.name})]})}});return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full",children:[(0,jsx_runtime.jsx)(src.HQ,{className:"mb-1",children:"X-axis"}),(0,jsx_runtime.jsx)(src.Yv,{className:"w-full",value:null!==xData?xData.column.name:"None",options:options,disabledReason:responseLoading?"Query loading...":void 0,onChange:value=>{let column=columns.find(n=>n.name===value);column&&updateXSeries(column.name)}}),!hideAddSeriesBreakdown&&(0,jsx_runtime.jsx)(src.Jp,{className:"mt-1",type:"tertiary",onClick:()=>addSeriesBreakdown(null),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),fullWidth:!0,children:"Add series breakdown"}),showSeriesBreakdown&&(0,jsx_runtime.jsx)(SeriesBreakdownSelector,{}),(0,jsx_runtime.jsx)(src.HQ,{className:"mt-4 mb-1",children:"Y-axis"}),yData.map((series,index)=>(0,jsx_runtime.jsx)(YSeries,{series:series,index:index},`${series?.column.name}-${index}`)),!hideAddYSeries&&(0,jsx_runtime.jsx)(src.Jp,{className:"mt-1",type:"tertiary",onClick:()=>addYSeries(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),fullWidth:!0,children:"Add Y-series"})]})},{}),shouldShow:()=>!0},[dataVisualizationLogic.B8.ConditionalFormatting]:{label:"Conditional formatting",content:(0,jsx_runtime.jsx)(()=>{let{conditionalFormattingRules,conditionalFormattingRulesPanelActiveKeys}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{addConditionalFormattingRule,setConditionalFormattingRulesPanelActiveKeys}=(0,index_esm.useActions)(dataVisualizationLogic.H8);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col ConditionalFormattingTab",children:[(0,jsx_runtime.jsx)("p",{children:"You can add rules to make the cells in the table change color if they meet certain conditions."}),conditionalFormattingRules.length>0&&(0,jsx_runtime.jsx)(src.JL,{activeKeys:conditionalFormattingRulesPanelActiveKeys,onChange:activeKeys=>setConditionalFormattingRulesPanelActiveKeys(activeKeys),multiple:!0,className:"mb-2",size:"small",panels:conditionalFormattingRules.map(rule=>({key:rule.id,header:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jw,{color:rule.color}),(0,jsx_runtime.jsx)("span",{className:"ml-2",children:getRuleHeader(rule)})]}),content:(0,jsx_runtime.jsx)(RuleItem,{rule:rule},rule.id),className:"p-2"}))}),(0,jsx_runtime.jsx)(src.Jp,{className:"mt-1",onClick:()=>addConditionalFormattingRule(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),fullWidth:!0,type:"secondary",children:"Add rule"})]})},{}),shouldShow:displayType=>displayType===types.Qb.ActionsTable},[dataVisualizationLogic.B8.Display]:{label:"Display",content:(0,jsx_runtime.jsx)(()=>{var _chartSettings$showLe,_chartSettings$showTo,_chartSettings$leftYA,_ref,_chartSettings$leftYA2,_chartSettings$rightY,_ref2,_chartSettings$rightY2,_chartSettings$stackB;let{visualizationType}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{goalLines,chartSettings}=(0,index_esm.useValues)(displayLogic.Y),{addGoalLine,updateGoalLine,removeGoalLine,updateChartSettings}=(0,index_esm.useActions)(displayLogic.Y),isStackedBarChart=visualizationType===types.Qb.ActionsStackedBar;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full",children:[(0,jsx_runtime.jsxs)("div",{className:"mt-1 mb-2 flex flex-col",children:[(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 mb-3 w-full",label:"Show legend",checked:null!==(_chartSettings$showLe=chartSettings.showLegend)&&void 0!==_chartSettings$showLe&&_chartSettings$showLe,onChange:value=>{updateChartSettings({showLegend:value})}}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 mb-3 w-full",label:"Show total row",checked:null===(_chartSettings$showTo=chartSettings.showTotalRow)||void 0===_chartSettings$showTo||_chartSettings$showTo,onChange:value=>{updateChartSettings({showTotalRow:value})}})]}),(0,jsx_runtime.jsxs)("div",{className:"mt-1 mb-2 flex flex-col",children:[(0,jsx_runtime.jsx)("h3",{children:"Left Y-axis"}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Scale",className:"gap-0 mb-3",children:(0,jsx_runtime.jsx)(src.Yv,{value:null!==(_chartSettings$leftYA=chartSettings.leftYAxisSettings?.scale)&&void 0!==_chartSettings$leftYA?_chartSettings$leftYA:"linear",options:[{value:"linear",label:"Linear"},{value:"logarithmic",label:"Logarithmic"}],onChange:value=>{updateChartSettings({leftYAxisSettings:{scale:value}})}})}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 mb-3 w-full",label:"Begin Y-axis at zero",checked:null===(_ref=null!==(_chartSettings$leftYA2=chartSettings.leftYAxisSettings?.startAtZero)&&void 0!==_chartSettings$leftYA2?_chartSettings$leftYA2:chartSettings.yAxisAtZero)||void 0===_ref||_ref,onChange:value=>{updateChartSettings({leftYAxisSettings:{startAtZero:value}})}})]}),(0,jsx_runtime.jsxs)("div",{className:"mt-1 mb-2 flex flex-col",children:[(0,jsx_runtime.jsx)("h3",{children:"Right Y-axis"}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Scale",className:"gap-0 mb-3",children:(0,jsx_runtime.jsx)(src.Yv,{value:null!==(_chartSettings$rightY=chartSettings.rightYAxisSettings?.scale)&&void 0!==_chartSettings$rightY?_chartSettings$rightY:"linear",options:[{value:"linear",label:"Linear"},{value:"logarithmic",label:"Logarithmic"}],onChange:value=>{updateChartSettings({rightYAxisSettings:{scale:value}})}})}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 mb-3 w-full",label:"Begin Y-axis at zero",checked:null===(_ref2=null!==(_chartSettings$rightY2=chartSettings.rightYAxisSettings?.startAtZero)&&void 0!==_chartSettings$rightY2?_chartSettings$rightY2:chartSettings.yAxisAtZero)||void 0===_ref2||_ref2,onChange:value=>{updateChartSettings({rightYAxisSettings:{startAtZero:value}})}})]}),isStackedBarChart&&(0,jsx_runtime.jsx)("div",{className:"mt-1 mb-2 flex",children:(0,jsx_runtime.jsx)(src.f4,{className:"flex-1",label:"Stack bars 100%",checked:null!==(_chartSettings$stackB=chartSettings.stackBars100)&&void 0!==_chartSettings$stackB&&_chartSettings$stackB,onChange:value=>{updateChartSettings({stackBars100:value})}})}),(0,jsx_runtime.jsxs)("div",{className:"mt-1 mb-2",children:[(0,jsx_runtime.jsx)(src.HQ,{className:"mb-1",children:"Goals"}),goalLines.map((_ref3,goalLineIndex)=>{let{label,value=0,displayLabel=!0}=_ref3;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 gap-1 mb-1",children:[(0,jsx_runtime.jsx)(SeriesGlyph.rF,{className:"self-center",hasBreakdown:!1,seriesIndex:goalLineIndex}),(0,jsx_runtime.jsx)(src.DF,{placeholder:"Label",className:"grow-2",value:label,suffix:(0,jsx_runtime.jsx)(src.Jp,{size:"small",noPadding:!0,icon:displayLabel?(0,jsx_runtime.jsx)(posthog_icons_es.IconEye,{}):(0,jsx_runtime.jsx)(icons.$L,{}),tooltip:displayLabel?"Display label":"Hide label",onClick:e=>{e.stopPropagation(),updateGoalLine(goalLineIndex,"displayLabel",!displayLabel)}}),onChange:value=>updateGoalLine(goalLineIndex,"label",value)}),(0,jsx_runtime.jsx)(src.DF,{placeholder:"Value",className:"grow",value:value.toString(),inputMode:"numeric",onChange:value=>updateGoalLine(goalLineIndex,"value",parseInt(value))}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",title:"Delete Goal Line",noPadding:!0,onClick:()=>removeGoalLine(goalLineIndex)},"delete")]},`${goalLineIndex}`)}),(0,jsx_runtime.jsx)(src.Jp,{className:"mt-1",onClick:addGoalLine,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),fullWidth:!0,children:"Add goal line"})]})]})},{}),shouldShow:displayType=>displayType!==types.Qb.ActionsTable&&displayType!==types.Qb.BoldNumber}},ContentWrapper=_ref=>{let{children}=_ref;return(0,jsx_runtime.jsx)("div",{className:"SideBar bg-surface-primary border p-4 rounded-t-none",children:children})},SideBar_SideBar=()=>{let{activeSideBarTab,visualizationType}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{setSideBarTab}=(0,index_esm.useActions)(dataVisualizationLogic.H8),tabs=Object.values(TABS_TO_CONTENT).filter(n=>n.shouldShow(visualizationType)).map((tab,index)=>({label:tab.label,key:Object.keys(TABS_TO_CONTENT)[index],content:(0,jsx_runtime.jsx)(ContentWrapper,{children:tab.content})}));return(0,jsx_runtime.jsx)(src.TP,{activeKey:activeSideBarTab,onChange:tab=>setSideBarTab(tab),tabs:tabs})};var Table=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Table.tsx"),TableDisplay=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/TableDisplay.tsx"),LemonSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSelect/index.ts"),LemonSegmentedButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSegmentedButton/index.ts"),LemonTag=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTag/index.ts"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),databaseTableListLogic=__webpack_require__("../../frontend/src/scenes/data-management/database/databaseTableListLogic.ts");let infoTabLogic=(0,index_esm.kea)([(0,index_esm.path)(["data-warehouse","editor","sidebar","infoTabLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.codeEditorKey),(0,index_esm.connect)(props=>({values:[(0,multitabEditorLogic.tg)({key:props.codeEditorKey}),["metadata"],databaseTableListLogic.A,["posthogTablesMap","dataWarehouseTablesMap"],dataWarehouseViewsLogic.$,["dataWarehouseSavedQueryMap"]]})),(0,index_esm.selectors)({sourceTableItems:[s=>[s.metadata,s.dataWarehouseSavedQueryMap],(metadata,dataWarehouseSavedQueryMap)=>metadata&&metadata.table_names?.map(table_name=>{let view=dataWarehouseSavedQueryMap[table_name];return view?{name:table_name,type:"table",view_id:view.id,status:view.status,last_run_at:view.last_run_at||"never"}:{name:table_name,type:"source",status:void 0,last_run_at:void 0}})||[]]})]);__webpack_require__("../../node_modules/.pnpm/@xyflow+react@12.6.0_@types+react@17.0.52_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@xyflow/react/dist/style.css");var esm=__webpack_require__("../../node_modules/.pnpm/@xyflow+react@12.6.0_@types+react@17.0.52_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@xyflow/react/dist/esm/index.js"),dist_esm=__webpack_require__("../../node_modules/.pnpm/@xyflow+system@0.0.57/node_modules/@xyflow/system/dist/esm/index.js"),dagre=__webpack_require__("../../node_modules/.pnpm/@dagrejs+dagre@1.1.5/node_modules/@dagrejs/dagre/index.js"),dagre_default=__webpack_require__.n(dagre);function LineageNode(_ref){var type,lastRunAt;let{data,edges}=_ref,hasIncoming=edges.some(edge=>edge.target===data.id),hasOutgoing=edges.some(edge=>edge.source===data.id),isMatView="view"===data.type&&!!data.last_run_at;return(0,jsx_runtime.jsxs)("div",{className:"bg-bg-light border border-border rounded-lg p-3 min-w-[240px] shadow-sm",style:{minHeight:isMatView?92:68},children:[hasIncoming&&(0,jsx_runtime.jsx)(esm.HH,{type:"target",position:dist_esm.Ly.Left,className:"w-2 h-2 bg-primary"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[data.isCurrentView&&(0,jsx_runtime.jsx)(Tooltip.u,{placement:"top",title:"This is the currently viewed query",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconTarget,{className:"text-warning text-sm"})}),(0,jsx_runtime.jsx)(Tooltip.u,{title:data.name,placement:"top",children:(0,jsx_runtime.jsx)("span",{className:"font-medium text-sm truncate max-w-[180px] block",children:data.name})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.oe,{type:"view"===data.type?"primary":"highlight",size:"small",children:(type=data.type,lastRunAt=data.last_run_at,"view"===type?lastRunAt?"Mat. View":"View":"Table")}),data.status&&(0,jsx_runtime.jsx)(src.oe,{type:"Failed"===data.status?"danger":"Running"===data.status?"warning":"success",size:"small",children:data.status})]}),data.last_run_at&&(0,jsx_runtime.jsxs)("div",{className:"text-xs text-muted mt-2",children:["Last run: ",(0,utils.bo)(data.last_run_at)]}),hasOutgoing&&(0,jsx_runtime.jsx)(esm.HH,{type:"source",position:dist_esm.Ly.Right,className:"w-2 h-2 bg-primary"})]})}let getNodeTypes=edges=>({lineageNode:props=>(0,jsx_runtime.jsx)(LineageNode,{...props,edges:edges})}),getLayoutedElements=(nodes,edges,currentViewName)=>{let dagreGraph=new(dagre_default()).graphlib.Graph;return dagreGraph.setDefaultEdgeLabel(()=>({})),dagreGraph.setGraph({rankdir:"LR",nodesep:80,ranksep:160}),nodes.forEach(node=>{let isMatView="view"===node.type&&!!node.last_run_at;dagreGraph.setNode(node.id,{width:240,height:isMatView?92:68})}),edges.forEach(edge=>{dagreGraph.setEdge(edge.source,edge.target)}),dagre_default().layout(dagreGraph),{nodes:nodes.map(node=>{let nodeWithPosition=dagreGraph.node(node.id),isMatView="view"===node.type&&!!node.last_run_at;return{id:node.id,type:"lineageNode",position:{x:nodeWithPosition.x-nodeWithPosition.width/2,y:nodeWithPosition.y-nodeWithPosition.height/2},data:{...node,isCurrentView:node.name===currentViewName},width:240,height:isMatView?92:68}}),edges:edges.map((edge,index)=>({id:`edge-${index}`,source:edge.source,target:edge.target,type:"smoothstep",animated:!1,markerEnd:{type:dist_esm.QZ.ArrowClosed,width:20,height:20}}))}};function UpstreamGraphContent(_ref2){let{codeEditorKey}=_ref2,{upstream,editingView}=(0,index_esm.useValues)((0,multitabEditorLogic.tg)({key:codeEditorKey})),{fitView}=(0,esm._K)(),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),{nodes,edges}=(0,react.useMemo)(()=>upstream&&0!==upstream.nodes.length?getLayoutedElements(upstream.nodes,upstream.edges,editingView?.name):{nodes:[],edges:[]},[upstream,editingView?.name]);return((0,react.useEffect)(()=>{nodes.length>0&&setTimeout(()=>fitView({padding:.1}),100)},[nodes,fitView]),upstream&&0!==upstream.nodes.length)?(0,jsx_runtime.jsx)("div",{className:"w-full h-full",children:(0,jsx_runtime.jsxs)(esm.x$,{proOptions:{hideAttribution:!0},colorMode:isDarkModeOn?"dark":"light",nodes:nodes,edges:edges,nodeTypes:getNodeTypes(edges),fitView:!0,fitViewOptions:{padding:.1},minZoom:.1,maxZoom:2,children:[(0,jsx_runtime.jsx)(esm.Aq,{variant:esm.T7.Dots,gap:20,size:1}),(0,jsx_runtime.jsx)(esm.ZX,{showInteractive:!1,position:"bottom-right"}),(0,jsx_runtime.jsx)(esm.a9,{zoomable:!0,pannable:!0,position:"bottom-left",nodeStrokeWidth:2})]})}):(0,jsx_runtime.jsxs)("div",{"data-attr":"upstream-graph-empty-state",className:"flex flex-col flex-1 rounded p-4 w-full items-center justify-center",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconArchive,{className:"text-5xl mb-2 text-tertiary"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl leading-tight",children:"No tables or views found"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-center text-balance text-tertiary",children:"This query doesn't depend on any other tables or views"})]})}function UpstreamGraph(_ref3){let{codeEditorKey}=_ref3;return(0,jsx_runtime.jsx)("div",{className:"w-full h-full",children:(0,jsx_runtime.jsx)(esm.tV,{children:(0,jsx_runtime.jsx)(UpstreamGraphContent,{codeEditorKey:codeEditorKey})})})}let OPTIONS=[{value:"never",label:" No resync"},{value:"5min",label:" Resync every 5 mins"},{value:"30min",label:" Resync every 30 mins"},{value:"1hour",label:" Resync every 1 hour"},{value:"6hour",label:" Resync every 6 hours"},{value:"12hour",label:" Resync every 12 hours"},{value:"24hour",label:" Resync Daily"},{value:"7day",label:" Resync Weekly"},{value:"30day",label:" Resync Monthly"}];function QueryInfo(_ref){let{codeEditorKey}=_ref,{sourceTableItems}=(0,index_esm.useValues)(infoTabLogic({codeEditorKey:codeEditorKey})),{editingView,upstream,upstreamViewMode}=(0,index_esm.useValues)(multitabEditorLogic.tg),{runDataWarehouseSavedQuery,saveAsView,setUpstreamViewMode}=(0,index_esm.useActions)(multitabEditorLogic.tg),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),isLineageDependencyViewEnabled=featureFlags[constants.y8.LINEAGE_DEPENDENCY_VIEW],{dataWarehouseSavedQueryMapById,updatingDataWarehouseSavedQuery,initialDataWarehouseSavedQueryLoading,dataModelingJobs,hasMoreJobsToLoad}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{updateDataWarehouseSavedQuery,loadOlderDataModelingJobs,cancelDataWarehouseSavedQuery,revertMaterialization}=(0,index_esm.useActions)(dataWarehouseViewsLogic.$),savedQuery=editingView?dataWarehouseSavedQueryMapById[editingView.id]:null;return initialDataWarehouseSavedQueryLoading?(0,jsx_runtime.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,jsx_runtime.jsx)(src.$j,{className:"text-lg"})}):(0,jsx_runtime.jsx)("div",{className:"overflow-auto","data-attr":"sql-editor-sidebar-query-info-pane",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 gap-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:"Materialization"}),(0,jsx_runtime.jsx)(LemonTag.o,{type:"warning",children:"BETA"}),savedQuery?.latest_error&&"Failed"===savedQuery.status&&(0,jsx_runtime.jsx)(Tooltip.u,{title:savedQuery.latest_error,children:(0,jsx_runtime.jsx)(LemonTag.o,{type:"danger",children:"Error"})})]}),(0,jsx_runtime.jsx)("div",{children:savedQuery?.sync_frequency?(0,jsx_runtime.jsxs)("div",{children:[savedQuery?.last_run_at?`Last run at ${(0,utils.bo)(savedQuery?.last_run_at)}`:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("span",{children:"Materialization scheduled"})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,jsx_runtime.jsx)(LemonButton.J,{className:"whitespace-nowrap",loading:savedQuery?.status==="Running",disabledReason:savedQuery?.status==="Running"&&"Materialization is already running",onClick:()=>editingView&&runDataWarehouseSavedQuery(editingView.id),type:"secondary",sideAction:{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{fontSize:16}),tooltip:"Cancel materialization",onClick:()=>editingView&&cancelDataWarehouseSavedQuery(editingView.id),disabledReason:savedQuery?.status!=="Running"&&"Materialization is not running"},children:savedQuery?.status==="Running"?"Running...":"Sync now"}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{className:"h-9",disabledReason:savedQuery?.status==="Running"&&"Materialization is already running",value:editingView&&dataWarehouseSavedQueryMapById[editingView.id]?.sync_frequency||"never",onChange:newValue=>{editingView&&newValue&&updateDataWarehouseSavedQuery({id:editingView.id,sync_frequency:newValue,types:[[]],lifecycle:"update"})},loading:updatingDataWarehouseSavedQuery,options:OPTIONS}),editingView&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",tooltip:"Revert materialized view to view",disabledReason:savedQuery?.status==="Running"&&"Cannot revert while materialization is running",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconRevert,{}),onClick:()=>{src.dn.open({title:"Revert materialization",maxWidth:"30rem",description:"Are you sure you want to revert this materialized view to a regular view? This will stop all future materializations and remove the materialized table. You will always be able to go back to a materialized view at any time.",primaryButton:{status:"danger",children:"Revert materialization",onClick:()=>revertMaterialization(editingView.id)},secondaryButton:{children:"Cancel"}})}})]})]}):(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("p",{className:"text-xs",children:["Materialized views are a way to pre-compute data in your data warehouse. This allows you to run queries faster and more efficiently. Learn more about materialization"," ",(0,jsx_runtime.jsx)(src.rU,{"data-attr":"materializing-help",to:"https://posthog.com/docs/data-warehouse/views#materializing-and-scheduling-a-view",target:"_blank",children:"here"}),"."]}),(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",onClick:()=>{editingView?updateDataWarehouseSavedQuery({id:editingView.id,sync_frequency:"24hour",types:[[]],lifecycle:dataModelingJobs&&dataModelingJobs.results.length>0?"update":"create"}):saveAsView({materializeAfterSave:!0})},type:"primary",loading:updatingDataWarehouseSavedQuery,children:editingView?"Materialize":"Save and materialize"})]})})]}),savedQuery&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Materialization Runs"}),(0,jsx_runtime.jsx)("p",{className:"text-xs",children:"The last runs for this materialized view. These can be scheduled or run on demand."})]}),(0,jsx_runtime.jsx)(src.g3,{size:"small",loading:initialDataWarehouseSavedQueryLoading,dataSource:dataModelingJobs?.results||[],columns:[{title:"Status",dataIndex:"status",render:(_,_ref2)=>{let{status,error}=_ref2,type={Completed:"success",Failed:"danger",Running:"warning"}[status]||"warning";return error?(0,jsx_runtime.jsx)(Tooltip.u,{title:error,children:(0,jsx_runtime.jsx)(LemonTag.o,{type:type,children:status})}):(0,jsx_runtime.jsx)(LemonTag.o,{type:type,children:status})}},{title:"Rows",dataIndex:"rows_materialized",render:(_,_ref3)=>{let{rows_materialized,status}=_ref3;return("Running"===status||"Cancelled"===status)&&0===rows_materialized?"~":(0,utils.Lc)(rows_materialized)}},{title:"Updated",dataIndex:"last_run_at",render:(_,_ref4)=>{let{last_run_at}=_ref4;return(0,utils.bo)(last_run_at)}},{title:"Duration",render:(_,job)=>{if("Running"===job.status)return"In progress";let start=new Date(job.created_at).getTime(),end=new Date(job.last_run_at).getTime();return start>end?"N/A":(0,utils.C7)((end-start)/1e3)}}],nouns:["run","runs"],emptyState:"No runs available",footer:hasMoreJobsToLoad&&(0,jsx_runtime.jsx)("div",{className:"flex items-center m-2",children:(0,jsx_runtime.jsx)(LemonButton.J,{center:!0,fullWidth:!0,onClick:()=>loadOlderDataModelingJobs(),loading:initialDataWarehouseSavedQueryLoading,children:"Load older runs"})})})]}),!isLineageDependencyViewEnabled&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Dependencies"}),(0,jsx_runtime.jsx)("p",{className:"text-xs",children:"Dependencies are tables that this query uses."})]}),(0,jsx_runtime.jsx)(src.g3,{size:"small",columns:[{key:"Name",title:"Name",render:(_,_ref5)=>{let{name}=_ref5;return name}},{key:"Type",title:"Type",render:(_,_ref6)=>{let{type}=_ref6;return type}},{key:"Status",title:"Status",render:(_,_ref7)=>{let{type,status,last_run_at}=_ref7;return"source"===type?(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a source table, so it doesn't have a status",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})}):"never"!==last_run_at||status?status:(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a view, so it's always available with the latest data",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"Available"})})}},{key:"Last run at",title:"Last run at",render:(_,_ref8)=>{let{type,last_run_at,status}=_ref8;return"source"===type?(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a source table, so it is never run",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})}):"never"!==last_run_at||status?(0,utils.bo)(last_run_at):(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a view, so it is never run",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})})}}],dataSource:sourceTableItems})]}),upstream&&editingView&&upstream.nodes.length>0&&isLineageDependencyViewEnabled&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mb-1",children:"Tables we use"}),(0,jsx_runtime.jsx)("p",{className:"text-xs mb-0",children:"Tables and views that this query relies on."})]}),(0,jsx_runtime.jsx)(LemonSegmentedButton.P,{value:upstreamViewMode,onChange:mode=>setUpstreamViewMode(mode),options:[{value:"table",label:"Table"},{value:"graph",label:"Graph"}],size:"small"})]})}),"table"===upstreamViewMode?(0,jsx_runtime.jsx)(src.g3,{size:"small",columns:[{key:"name",title:"Name",render:(_,_ref9)=>{let{name}=_ref9;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[name===editingView?.name&&(0,jsx_runtime.jsx)(Tooltip.u,{placement:"right",title:"This is the currently viewed query",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconTarget,{className:"text-warning"})}),name]})}},{key:"type",title:"Type",render:(_,_ref10)=>{let{type,last_run_at}=_ref10;return"view"===type?last_run_at?"Mat. View":"View":"Table"}},{key:"upstream",title:"Direct Upstream",render:(_,node)=>{let upstreamNodes=upstream.edges.filter(edge=>edge.target===node.id).map(edge=>upstream.nodes.find(n=>n.id===edge.source)).filter(n=>void 0!==n);return 0===upstreamNodes.length?(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"None"}):(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap gap-1",children:upstreamNodes.map(upstreamNode=>(0,jsx_runtime.jsx)(LemonTag.o,{type:"primary",children:upstreamNode.name},upstreamNode.id))})}},{key:"last_run_at",title:"Last Run At",render:(_,_ref11)=>{let{last_run_at,sync_frequency}=_ref11;if(!last_run_at)return"On demand";let numericSyncFrequency=Number(sync_frequency),frequencyMap={300:"5 mins",1800:"30 mins",3600:"1 hour",21600:"6 hours",43200:"12 hours",86400:"24 hours",604800:"1 week"};return`${(0,utils.bo)(last_run_at)} ${frequencyMap[numericSyncFrequency]?`every ${frequencyMap[numericSyncFrequency]}`:""}`}}],dataSource:upstream.nodes}):(0,jsx_runtime.jsx)("div",{className:"h-96 border border-border rounded-lg overflow-hidden",children:(0,jsx_runtime.jsx)(UpstreamGraph,{codeEditorKey:codeEditorKey})})]})]})})}var AddVariableButton=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/AddVariableButton.tsx"),NewVariableModal=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/NewVariableModal.tsx"),Variables=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/Variables.tsx");function QueryVariables(){let{variablesForInsight}=(0,index_esm.useValues)(variablesLogic.Q),{updateVariableValue,removeVariable}=(0,index_esm.useActions)(variablesLogic.Q),{showEditingUI}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{variableOverridesAreSet}=(0,index_esm.useValues)(dataNodeLogic.M),{openExistingVariableModal}=(0,index_esm.useActions)(variableModalLogic.b);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1.5","data-attr":"sql-editor-sidebar-query-variables-pane",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-start",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:"Query variables"}),(0,jsx_runtime.jsxs)("span",{className:"text-xs",children:["Query variables let you dynamically set values in your SQL query."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/sql/variables",target:"_blank",children:"Learn more"})]})]}),(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("flex gap-4 flex-col items-start",0===variablesForInsight.length&&"h-full items-center justify-center"),children:variablesForInsight.map(n=>(0,jsx_runtime.jsx)(Variables.LO,{variable:n,showEditingUI:showEditingUI,onChange:updateVariableValue,onRemove:removeVariable,variableOverridesAreSet:variableOverridesAreSet,variableSettingsOnClick:()=>openExistingVariableModal(n)},n.id))}),(0,jsx_runtime.jsx)("div",{className:"self-start",children:(0,jsx_runtime.jsx)(AddVariableButton.u,{buttonProps:{type:"primary",size:"small"},title:"Add variable"})}),(0,jsx_runtime.jsx)(NewVariableModal.f,{})]})}function TabScroller(_ref){let{children}=_ref;return(0,jsx_runtime.jsx)("div",{className:"relative w-full overflow-auto",children:(0,jsx_runtime.jsx)("div",{className:"flex-1 absolute top-0 left-0 right-0 bottom-0",children:children})})}let CLICKHOUSE_TYPES=["UUID","String","Nothing","DateTime64","DateTime32","DateTime","Date","Date32","UInt8","UInt16","UInt32","UInt64","Float8","Float16","Float32","Float64","Int8","Int16","Int32","Int64","Tuple","Array","Map","Bool","Decimal","FixedString"],cleanClickhouseType=type=>{if(type)return(type=type.replace(/\n\s+/,"")).startsWith("Nullable(")&&(type=(type=type.replace("Nullable(","")).substring(0,type.length-1)),type.startsWith("Array(")&&(type=type.split(/(\W)/).filter(n=>!("Nullable"!==n&&(1!==n.length||/^[a-z0-9]+$/i.test(n)))||CLICKHOUSE_TYPES.includes(n)).join("")),type.replace(/\(.+\)+/,"")};function RowDetailsModal(_ref){let{isOpen,onClose,row,columns}=_ref,[showRawJson,setShowRawJson]=(0,react.useState)({}),[wordWrap,setWordWrap]=(0,react.useState)({});if(!row)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let isJsonString=str=>{try{let parsed=JSON.parse(str);return"object"==typeof parsed&&null!==parsed}catch{return!1}},tableData=columns.map(column=>{let value=row[column],isStringifiedJson="string"==typeof value&&isJsonString(value),isJson="object"==typeof value||isStringifiedJson,jsonValue=isStringifiedJson?JSON.parse(value):value;return{column,isJson,rawValue:null===value?"null":"object"==typeof value||isStringifiedJson?JSON.stringify(value,null,2):String(value),value:null===value?(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"null"}):isJson?(0,jsx_runtime.jsx)("div",{className:"flex gap-2 w-full",children:(0,jsx_runtime.jsx)("div",{className:"w-full overflow-hidden",children:showRawJson[column]?(0,jsx_runtime.jsx)("pre",{className:(0,clsx_m.default)("m-0 font-mono",wordWrap[column]?"whitespace-pre-wrap break-all":"overflow-x-auto hide-scrollbar"),children:String(value)}):(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto max-w-full",children:(0,jsx_runtime.jsx)(JSONViewer.C,{src:jsonValue,name:null,collapsed:1})})})}):(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto",children:(0,jsx_runtime.jsx)("span",{className:"whitespace-pre-wrap break-all font-mono",children:String(value)})})}});return(0,jsx_runtime.jsx)(src.fQ,{title:"Row Details",isOpen:isOpen,onClose:onClose,width:800,children:(0,jsx_runtime.jsx)("div",{className:"RowDetailsModal max-h-[70vh] overflow-y-auto px-2 overflow-x-hidden",children:(0,jsx_runtime.jsx)(src.g3,{dataSource:tableData,className:"w-full table-fixed",columns:[{title:"Column",dataIndex:"column",className:"font-semibold",width:"35%",render:(_,record)=>(0,jsx_runtime.jsx)("span",{title:record.column,children:record.column})},{title:"Value",dataIndex:"value",className:"px-4 overflow-hidden",width:"65%",render:(_,record)=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1 overflow-x-auto pr-2",children:record.value}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-1 flex-shrink-0 ml-auto",children:[record.isJson&&record.rawValue&&"null"!=record.rawValue&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode,{}),onClick:()=>setShowRawJson(prev=>({...prev,[record.column]:!prev[record.column]})),tooltip:showRawJson[record.column]?"Show formatted":"Show raw"}),showRawJson[record.column]&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:wordWrap[record.column]?(0,jsx_runtime.jsx)(posthog_icons_es.IconMinus,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>setWordWrap(prev=>({...prev,[record.column]:!prev[record.column]})),tooltip:wordWrap[record.column]?"Collapse":"Expand"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCopy,{}),onClick:()=>void(0,copyToClipboard.v)(record.rawValue,"value"),tooltip:"Copy value"})]})]})}]})})})}function OutputPane(){let{activeTab}=(0,index_esm.useValues)(outputPaneLogic.o),{setActiveTab}=(0,index_esm.useActions)(outputPaneLogic.o),{editingView}=(0,index_esm.useValues)(multitabEditorLogic.tg),{sourceQuery,exportContext,editorKey,editingInsight,updateInsightButtonEnabled,showLegacyFilters,localStorageResponse,queryInput}=(0,index_esm.useValues)(multitabEditorLogic.tg),{saveAsInsight,updateInsight,setSourceQuery,runQuery,shareTab}=(0,index_esm.useActions)(multitabEditorLogic.tg),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),{response:dataNodeResponse,responseLoading,responseError,queryId,pollResponse}=(0,index_esm.useValues)(dataNodeLogic.M),{queryCancelled}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{toggleChartSettingsPanel}=(0,index_esm.useActions)(dataVisualizationLogic.H8),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),response=null!=dataNodeResponse?dataNodeResponse:localStorageResponse,[progressCache,setProgressCache]=(0,react.useState)({}),vizKey=(0,react.useMemo)(()=>"SQLEditorScene",[]),[selectedRow,setSelectedRow]=(0,react.useState)(null),setProgress=(0,react.useCallback)((loadId,progress)=>{setProgressCache(prev=>({...prev,[loadId]:progress}))},[]),columns=(0,react.useMemo)(()=>{var _response$columns$map;let types=response?.types;return[{key:"__details",name:"",minWidth:30,width:30,renderCell:_ref2=>{let{row}=_ref2;return(0,jsx_runtime.jsx)("div",{className:"hover-actions-cell flex justify-center items-center",children:(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand45,{}),onClick:e=>{e.stopPropagation(),setSelectedRow(row)}})})}},...null!==(_response$columns$map=response?.columns?.map((column,index)=>{let type=types?.[index]?.[1],maxContentLength=Math.max(column.length,...(response.results||response.result).map(row=>{let content=row[index];return"string"==typeof content?content.length:null===content?0:content.toString().length})),baseColumn={key:column,name:jsx_runtime.jsxs(jsx_runtime.Fragment,{children:[column," ",type&&jsx_runtime.jsx("span",{className:"text-[10px] font-medium italic",children:cleanClickhouseType(type)})]}),resizable:!0,sortable:!0,width:maxContentLength>100?600:void 0,headerCellClass:"cursor-pointer",renderHeaderCell:_ref3=>{let{column:col,sortDirection}=_ref3;return jsx_runtime.jsxs("div",{className:"flex items-center justify-between py-2",children:[jsx_runtime.jsx("span",{children:col.name}),jsx_runtime.jsxs("div",{className:"flex flex-col ml-1",children:[jsx_runtime.jsx("span",{className:`text-[7px] leading-none ${"ASC"===sortDirection?"text-black-600":"text-gray-400"}`,children:"▲"}),jsx_runtime.jsx("span",{className:`text-[7px] leading-none ${"DESC"===sortDirection?"text-black-600":"text-gray-400"}`,children:"▼"})]})]})}};return type&&type.indexOf("Bool")!==-1?{...baseColumn,renderCell:props=>null===props.row[column]?null:props.row[column].toString()}:{...baseColumn,renderCell:props=>props.row[column]}}))&&void 0!==_response$columns$map?_response$columns$map:[]]},[response,setSelectedRow]),rows=(0,react.useMemo)(()=>response?.results?response.results.map((row,index)=>{let rowObject={__index:index};return response.columns?.forEach((column,i)=>{"object"==typeof row[i]&&null!==row[i]?rowObject[column]=JSON.stringify(row[i]):rowObject[column]=row[i]}),rowObject}):[],[response]),hasColumns=columns.length>1;return(0,jsx_runtime.jsxs)("div",{className:"OutputPane flex flex-col w-full flex-1 bg-white dark:bg-black",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between align-center w-full h-[50px] overflow-y-auto",children:[(0,jsx_runtime.jsx)("div",{className:"flex h-[50px] gap-2 ml-4",children:[{key:outputPaneLogic.R.Results,label:"Results",icon:(0,jsx_runtime.jsx)(icons.p$,{})},{key:outputPaneLogic.R.Visualization,label:"Visualization",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGraph,{})},...featureFlags[constants.y8.SQL_EDITOR_TREE_VIEW]?[{key:outputPaneLogic.R.Variables,label:(0,jsx_runtime.jsx)(src.u,{title:editingView?"Variables are not allowed in views.":void 0,children:"Variables"}),disabled:editingView,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBrackets,{})},{key:outputPaneLogic.R.Materialization,label:"Materialization",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBolt,{})}]:[]].map(tab=>(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("flex-1 flex-row flex items-center bold content-center px-2 pt-[3px] cursor-pointer border-b-[medium]",{"font-semibold !border-brand-yellow":tab.key===activeTab,"border-transparent":tab.key!==activeTab,"opacity-50 cursor-not-allowed":tab.disabled}),onClick:()=>!tab.disabled&&setActiveTab(tab.key),children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:tab.icon}),tab.label]},tab.key))}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 py-2 px-4",children:[showLegacyFilters&&(0,jsx_runtime.jsx)(DateRange.C,{query:sourceQuery.source,setQuery:query=>{setSourceQuery({...sourceQuery,source:query}),runQuery(query.query)}},"date-range"),activeTab===outputPaneLogic.R.Visualization&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between flex-wrap",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[(0,jsx_runtime.jsx)(TableDisplay.V,{disabledReason:hasColumns?void 0:"No results to visualize"}),(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasColumns?void 0:"No results to visualize",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>toggleChartSettingsPanel(),tooltip:"Visualization settings"}),editingInsight&&(0,jsx_runtime.jsx)(src.Jp,{disabledReason:!updateInsightButtonEnabled&&"No updates to save",type:"primary",onClick:()=>updateInsight(),id:"sql-editor-update-insight",sideAction:{dropdown:{placement:"bottom-end",overlay:(0,jsx_runtime.jsx)(LemonMenu.iy,{items:[{label:"Save as...",onClick:()=>saveAsInsight()}]})}},children:"Save insight"}),!editingInsight&&(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasColumns?void 0:"No results to save",type:"primary",onClick:()=>saveAsInsight(),id:"sql-editor-save-insight",children:"Save insight"})]})})]})}),activeTab===outputPaneLogic.R.Results&&(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasColumns||editingInsight?void 0:"No results to visualize",type:"secondary",onClick:()=>setActiveTab(outputPaneLogic.R.Visualization),id:`sql-editor-${editingInsight?"view":"create"}-insight`,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGraph,{}),children:editingInsight?"View insight":"Create insight"}),activeTab===outputPaneLogic.R.Results&&exportContext&&(0,jsx_runtime.jsx)(src.u,{title:"Export the table results",className:hasColumns?"":"hidden",children:(0,jsx_runtime.jsx)(ExportButton.j,{id:"sql-editor-export",disabledReason:hasColumns?void 0:"No results to export",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),sideIcon:null,buttonCopy:"",items:[{export_format:types.P5.CSV,export_context:exportContext},{export_format:types.P5.XLSX,export_context:exportContext}]})}),activeTab===outputPaneLogic.R.Results&&(0,jsx_runtime.jsx)(src.u,{title:"Share your current query",children:(0,jsx_runtime.jsx)(src.Jp,{id:"sql-editor-share",disabledReason:!queryInput&&"No query to share",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconShare,{}),onClick:()=>shareTab()})})]})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-1 relative bg-dark",children:(0,jsx_runtime.jsx)(Content,{activeTab:activeTab,responseError:responseError,responseLoading:responseLoading,response:response,sourceQuery:sourceQuery,queryCancelled:queryCancelled,columns:columns,rows:rows,isDarkModeOn:isDarkModeOn,vizKey:vizKey,setSourceQuery:setSourceQuery,exportContext:exportContext,saveAsInsight:saveAsInsight,queryId:queryId,pollResponse:pollResponse,editorKey:editorKey,setProgress:setProgress,progress:queryId?progressCache[queryId]:void 0})}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between px-2 border-t",children:[(0,jsx_runtime.jsx)("div",{children:response&&!responseError?(0,jsx_runtime.jsx)(LoadNext.D,{localResponse:localStorageResponse}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}),(0,jsx_runtime.jsx)(ElapsedTime.W,{})]}),(0,jsx_runtime.jsx)(RowDetailsModal,{isOpen:!!selectedRow,onClose:()=>setSelectedRow(null),row:selectedRow,columns:response?.columns||[]})]})}function InternalDataTableVisualization(props){let{query,visualizationType,showEditingUI,response,responseLoading,isChartSettingsPanelOpen}=(0,index_esm.useValues)(dataVisualizationLogic.H8),component=null;return showEditingUI||response&&!responseLoading?visualizationType===types.Qb.ActionsTable?component=(0,jsx_runtime.jsx)(Table.i,{uniqueKey:props.uniqueKey,query:query,context:props.context,cachedResults:props.cachedResults}):visualizationType===types.Qb.ActionsLineGraph||visualizationType===types.Qb.ActionsBar||visualizationType===types.Qb.ActionsAreaGraph||visualizationType===types.Qb.ActionsStackedBar?component=(0,jsx_runtime.jsx)(LineGraph.x,{}):visualizationType===types.Qb.BoldNumber&&(component=(0,jsx_runtime.jsx)(BoldNumber.w,{})):component=(0,jsx_runtime.jsx)("div",{className:"flex flex-col flex-1 justify-center items-center bg-surface-primary h-full",children:(0,jsx_runtime.jsx)(LoadingBar.F,{})}),(0,jsx_runtime.jsx)("div",{className:"DataVisualization h-full hide-scrollbar flex flex-1 gap-2",children:(0,jsx_runtime.jsx)("div",{className:"relative w-full flex flex-col gap-4 flex-1",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 flex-row gap-4 overflow-auto hide-scrollbar",children:[isChartSettingsPanelOpen&&(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(SideBar_SideBar,{})}),(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("w-full h-full flex-1 overflow-auto"),children:component})]})})})}let ErrorState=_ref4=>{let{responseError,sourceQuery,queryCancelled,response}=_ref4,error=queryCancelled?"The query was cancelled":response&&"error"in response&&response.error?response.error:responseError;return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("flex-1 absolute top-0 left-0 right-0 bottom-0 overflow-auto"),children:(0,jsx_runtime.jsx)(EmptyStates.jC,{query:sourceQuery,excludeDetail:!0,title:error,fixWithAIComponent:(0,jsx_runtime.jsx)(FixErrorButton,{contentOverride:"Fix error with AI",type:"primary",source:"query-error"})})})},Content=_ref5=>{let{activeTab,responseError,responseLoading,response,sourceQuery,queryCancelled,columns,rows,isDarkModeOn,vizKey,editorKey,setSourceQuery,exportContext,saveAsInsight,queryId,pollResponse,setProgress,progress}=_ref5,[sortColumns,setSortColumns]=(0,react.useState)([]),{editingView}=(0,index_esm.useValues)(multitabEditorLogic.tg),sortedRows=(0,react.useMemo)(()=>sortColumns.length?[...rows].sort((a,b)=>{for(let{columnKey,direction}of sortColumns){let aVal=a[columnKey],bVal=b[columnKey];if(aVal===bVal)continue;if(null==aVal)return 1;if(null==bVal)return -1;let result=aVal<bVal?-1:1;return"DESC"===direction?-result:result}return 0}):rows,[rows,sortColumns]);if(activeTab===outputPaneLogic.R.Materialization)return(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsx)("div",{className:"px-6 py-4 border-t",children:(0,jsx_runtime.jsx)(QueryInfo,{codeEditorKey:editorKey})})});if(activeTab===outputPaneLogic.R.Variables)return editingView?(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsx)("div",{className:"px-6 py-4 border-t text-secondary",children:"Variables are not allowed in views."})}):(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsx)("div",{className:"px-6 py-4 border-t max-w-1/2",children:(0,jsx_runtime.jsx)(QueryVariables,{})})});if(responseLoading)return(0,jsx_runtime.jsx)("div",{className:"flex flex-1 p-2 w-full justify-center items-center border-t",children:(0,jsx_runtime.jsx)(EmptyStates.sX,{queryId:queryId,pollResponse:pollResponse,setProgress:setProgress,progress:progress})});if(responseError)return(0,jsx_runtime.jsx)(ErrorState,{responseError:responseError,sourceQuery:sourceQuery,queryCancelled:queryCancelled,response:response});if(!response){let msg=activeTab===outputPaneLogic.R.Results?"Query results will appear here.":"Query results will be visualized here.";return(0,jsx_runtime.jsx)("div",{className:"flex flex-1 justify-center items-center border-t","data-attr":"sql-editor-output-pane-empty-state",children:(0,jsx_runtime.jsxs)("span",{className:"text-secondary mt-3",children:[msg," Press ",(0,jsx_runtime.jsx)(KeyboardShortcut.e,{command:!0,enter:!0})," to run the query."]})})}return activeTab===outputPaneLogic.R.Results?(0,jsx_runtime.jsx)(TabScroller,{"data-attr":"sql-editor-output-pane-results",children:(0,jsx_runtime.jsx)(bundle.ZP,{className:isDarkModeOn?"rdg-dark h-full":"rdg-light h-full",columns:columns,rows:sortedRows,sortColumns:sortColumns,onSortColumnsChange:setSortColumns})}):activeTab===outputPaneLogic.R.Visualization?(0,jsx_runtime.jsx)("div",{className:"flex-1 absolute top-0 left-0 right-0 bottom-0 px-4 py-1 hide-scrollbar border-t",children:(0,jsx_runtime.jsx)(InternalDataTableVisualization,{uniqueKey:vizKey,query:sourceQuery,setQuery:setSourceQuery,context:{},cachedResults:void 0,exportContext:exportContext,onSaveInsight:saveAsInsight})}):null};var size_dist_module=__webpack_require__("../../node_modules/.pnpm/@react-hook+size@2.1.2_react@18.2.0/node_modules/@react-hook/size/dist/module/index.js"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),MonacoDiffEditor=__webpack_require__("../../frontend/src/lib/components/MonacoDiffEditor.tsx"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),PaginationControl=__webpack_require__("../../frontend/src/lib/lemon-ui/PaginationControl/index.ts"),ProfilePicture=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),activityLogLogic=__webpack_require__("../../frontend/src/lib/components/ActivityLog/activityLogLogic.tsx");let queryHistoryLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","queryHistoryLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(_ref=>{let{id}=_ref;return{values:[(0,activityLogLogic.D)({scope:types.jc.DATA_WAREHOUSE_SAVED_QUERY,id:id}),["humanizedActivity","activityLoading","pagination"]]}})]);function QueryHistoryLogRow(_ref){var _logItem$email;let{logItem}=_ref,[isExpanded,setIsExpanded]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("flex flex-col px-1 py-0.5",isExpanded&&"border rounded"),children:[(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("ActivityLogRow flex deprecated-space-x-2",logItem.unread&&"ActivityLogRow--unread"),children:[(0,jsx_runtime.jsx)(ProfilePicture.Y,{showName:!1,user:{first_name:logItem.isSystem?logItem.name:void 0,email:null!==(_logItem$email=logItem.email)&&void 0!==_logItem$email?_logItem$email:void 0},type:logItem.isSystem?"system":"person",size:"xl"}),(0,jsx_runtime.jsxs)("div",{className:"ActivityLogRow__details flex-grow",children:[(0,jsx_runtime.jsx)("div",{className:"ActivityLogRow__description",children:logItem.description}),logItem.extendedDescription&&(0,jsx_runtime.jsx)("div",{className:"ActivityLogRow__description__extended",children:logItem.extendedDescription}),(0,jsx_runtime.jsx)("div",{className:"text-secondary",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:logItem.created_at})})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-row gap-2",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode,{}),onClick:()=>setIsExpanded(!isExpanded),active:isExpanded})})]}),isExpanded&&(0,jsx_runtime.jsx)("div",{className:"px-1 py-0.5",children:(0,jsx_runtime.jsx)(QueryHistoryLogDiff,{logItem:logItem})})]})}function QueryHistoryLogDiff(_ref2){let{logItem}=_ref2,changes=logItem.unprocessed?.detail.changes;return(0,jsx_runtime.jsx)("div",{className:"flex flex-col deprecated-space-y-2 px-2 py-1",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col deprecated-space-y-2",children:changes?.length?changes.map((change,i)=>(0,jsx_runtime.jsx)(QueryDiffViewer,{before:change.before,after:change.after},i)):(0,jsx_runtime.jsx)("div",{className:"text-secondary",children:"This item has no changes to compare"})})})}function QueryDiffViewer(_ref3){var _before$query,_after$query;let{before,after}=_ref3,containerRef=(0,react.useRef)(null),[width]=(0,size_dist_module.Z)(containerRef);return(0,jsx_runtime.jsx)("div",{ref:containerRef,className:"flex flex-col space-y-2 w-full",children:(0,jsx_runtime.jsx)(MonacoDiffEditor.Z,{original:null!==(_before$query=before?.query)&&void 0!==_before$query?_before$query:"",modified:null!==(_after$query=after?.query)&&void 0!==_after$query?_after$query:"",language:"hogQL",width:width,options:{renderOverviewRuler:!1,scrollBeyondLastLine:!1,renderGutterMenu:!1,scrollbar:{alwaysConsumeMouseWheel:!1}}},"diff-viewer")})}function QueryHistoryLog(_ref4){let{id}=_ref4,logic=queryHistoryLogic({id:id}),{humanizedActivity,activityLoading,pagination}=(0,index_esm.useValues)(logic),paginationState=(0,PaginationControl.h)(humanizedActivity||[],pagination);return activityLoading||0!==humanizedActivity.length?(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[activityLoading?(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{})]}):(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:humanizedActivity.map((logItem,index)=>(0,jsx_runtime.jsx)(QueryHistoryLogRow,{logItem:logItem},index))}),(0,jsx_runtime.jsx)(PaginationControl.R,{...paginationState,nouns:["activity","activities"]})]}):(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:(0,jsx_runtime.jsx)("div",{className:"text-secondary",children:"No history found"})})}function QueryHistoryModal(){let{isHistoryModalOpen}=(0,index_esm.useValues)(multitabEditorLogic.tg),{closeHistoryModal}=(0,index_esm.useActions)(multitabEditorLogic.tg),{editingView}=(0,index_esm.useValues)(multitabEditorLogic.tg);return(0,jsx_runtime.jsx)(src.fQ,{title:"View history",isOpen:isHistoryModalOpen,onClose:closeHistoryModal,width:800,children:(0,jsx_runtime.jsx)("div",{className:"ActivityLog",children:(0,jsx_runtime.jsx)(QueryHistoryLog,{id:editingView?.id})})})}var Resizer=__webpack_require__("../../frontend/src/lib/components/Resizer/Resizer.tsx"),CodeEditor=__webpack_require__("../../frontend/src/lib/monaco/CodeEditor.tsx"),AutoSizer=__webpack_require__("../../node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),MaxTool=__webpack_require__("../../frontend/src/scenes/max/MaxTool.tsx");function QueryPane(props){let{queryPaneHeight,queryPaneResizerProps}=(0,index_esm.useValues)(editorSizingLogic),{setSuggestedQueryInput,onAcceptSuggestedQueryInput,onRejectSuggestedQueryInput,reportAIQueryPromptOpen}=(0,index_esm.useActions)(multitabEditorLogic.tg),{acceptText,rejectText,diffShowRunButton}=(0,index_esm.useValues)(multitabEditorLogic.tg);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"relative flex flex-row w-full bg-primary",style:{height:`${queryPaneHeight}px`},ref:queryPaneResizerProps.containerRef,children:[(0,jsx_runtime.jsxs)("div",{className:"relative flex flex-col w-full",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1","data-attr":"hogql-query-editor",children:(0,jsx_runtime.jsx)(AutoSizer.q,{children:_ref=>{let{height,width}=_ref;return(0,jsx_runtime.jsx)(CodeEditor.p,{language:"hogQL",value:props.queryInput,sourceQuery:props.sourceQuery,height:height,width:width,originalValue:props.originalValue,...props.codeEditorProps,options:{minimap:{enabled:!1},wordWrap:"on",scrollBeyondLastLine:!!props.originalValue,automaticLayout:!0,fixedOverflowWidgets:!0,suggest:{showInlineDetails:!0},quickSuggestionsDelay:300}})}})}),(0,jsx_runtime.jsx)("div",{className:"absolute bottom-6 right-4",children:(0,jsx_runtime.jsx)(MaxTool.Z,{name:"generate_hogql_query",displayName:"Write and tweak SQL",description:"Max can write and tweak SQL queries for you",context:{current_query:props.queryInput},callback:toolOutput=>{setSuggestedQueryInput(toolOutput,"max_ai")},suggestions:[],onMaxOpen:()=>{reportAIQueryPromptOpen()},introOverride:{headline:"What data do you want to analyze?",description:"Let me help you quickly write SQL, and tweak it."},children:(0,jsx_runtime.jsx)("div",{className:"relative"})})}),props.originalValue&&(0,jsx_runtime.jsxs)("div",{className:"absolute flex gap-1 bg-bg-light rounded border py-1 px-1.5 z-10 left-1/2 -translate-x-1/2 bottom-4 whitespace-nowrap",style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},children:[!!diffShowRunButton&&(0,jsx_runtime.jsxs)(LemonButton.J,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{color:"var(--success)"}),onClick:()=>{onAcceptSuggestedQueryInput(!0)},tooltipPlacement:"top",size:"small",children:[acceptText," & run"]}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"tertiary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{color:"var(--success)"}),onClick:()=>{onAcceptSuggestedQueryInput()},tooltipPlacement:"top",size:"small",children:acceptText}),(0,jsx_runtime.jsx)(LemonButton.J,{status:"danger",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:()=>{onRejectSuggestedQueryInput()},tooltipPlacement:"top",size:"small",children:rejectText})]})]}),(0,jsx_runtime.jsx)(Resizer.w,{...queryPaneResizerProps})]})})}var QueryTabs=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/QueryTabs.tsx");let EditorSidebarTab=function(EditorSidebarTab){return EditorSidebarTab.QueryDatabase="query_database",EditorSidebarTab.QueryVariables="query_variables",EditorSidebarTab.QueryInfo="query_info",EditorSidebarTab}({}),editorSidebarLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","sidebar","editorSidebarLogic"]),(0,index_esm.props)({key:""}),(0,index_esm.key)(props=>props.key),(0,index_esm.connect)({values:[variablesLogic.Q,["variablesForInsight"]]}),(0,index_esm.actions)({setActiveTab:tab=>({tab}),setPreviousVariableCount:count=>({count})}),(0,index_esm.reducers)({activeTab:[EditorSidebarTab.QueryDatabase,{setActiveTab:(_,_ref)=>{let{tab}=_ref;return tab}}],previousVariableCount:[0,{setPreviousVariableCount:(_,_ref2)=>{let{count}=_ref2;return count}}]}),(0,kea_subscriptions_lib.Vt)(_ref3=>{let{values,actions}=_ref3;return{variablesForInsight:variables=>{variables.length>values.previousVariableCount&&actions.setActiveTab(EditorSidebarTab.QueryVariables),actions.setPreviousVariableCount(variables.length)}}})]);function QueryWindow(_ref){let{onSetMonacoAndEditor}=_ref,codeEditorKey=`hogQLQueryEditor/${lib.router.values.location.pathname}`,{allTabs,activeModelUri,queryInput,editingView,editingInsight,sourceQuery,inProgressViewEdits,changesToSave,originalQueryInput,suggestedQueryInput}=(0,index_esm.useValues)(multitabEditorLogic.tg),{activePanelIdentifier}=(0,index_esm.useValues)(panelLayoutLogic.ne),{setActivePanelIdentifier}=(0,index_esm.useActions)(panelLayoutLogic.ne),{renameTab,selectTab,deleteTab,createTab,setQueryInput,runQuery,setError,setMetadata,setMetadataLoading,saveAsView,updateView}=(0,index_esm.useActions)(multitabEditorLogic.tg),{openHistoryModal}=(0,index_esm.useActions)(multitabEditorLogic.tg),{response}=(0,index_esm.useValues)(dataNodeLogic.M),{updatingDataWarehouseSavedQuery}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{sidebarWidth}=(0,index_esm.useValues)(editorSizingLogic),{resetDefaultSidebarWidth}=(0,index_esm.useActions)(editorSizingLogic),{setActiveTab}=(0,index_esm.useActions)(editorSidebarLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),isMaterializedView=!!editingView?.last_run_at||!!editingView?.status&&("Completed"===editingView.status||"Failed"===editingView.status||"Cancelled"===editingView.status||"Running"===editingView.status),renderAddSQLVariablesButton=()=>featureFlags[constants.y8.SQL_EDITOR_TREE_VIEW]?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{}):(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>setActiveTab(EditorSidebarTab.QueryVariables),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBrackets,{}),type:"tertiary",size:"xsmall",id:"sql-editor-query-window-add-variables","data-attr":"sql-editor-query-window-add-variables-button",children:"Add SQL variables"}),renderMaterializeButton=()=>featureFlags[constants.y8.SQL_EDITOR_TREE_VIEW]?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{}):(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>setActiveTab(EditorSidebarTab.QueryInfo),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBolt,{}),type:"tertiary",size:"xsmall",id:"sql-editor-query-window-materialize","data-attr":"sql-editor-query-window-materialize-button",children:"Materialize"}),[editingViewDisabledReason,EditingViewButtonIcon]=(0,react.useMemo)(()=>updatingDataWarehouseSavedQuery?["Saving...",src.$j]:response?changesToSave?[void 0,posthog_icons_es.IconDownload]:["No changes to save",posthog_icons_es.IconDownload]:["Run query to update",posthog_icons_es.IconDownload],[updatingDataWarehouseSavedQuery,changesToSave,response]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 flex-col h-full overflow-hidden",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row overflow-x-auto",children:["Database"!==activePanelIdentifier&&featureFlags[constants.y8.SQL_EDITOR_TREE_VIEW]?(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>setActivePanelIdentifier("Database"),className:"rounded-none",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconSidebarClose,{}),type:"tertiary",size:"small"}):0===sidebarWidth?(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>resetDefaultSidebarWidth(),className:"rounded-none",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconSidebarClose,{}),type:"tertiary",size:"small"}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{}),(0,jsx_runtime.jsx)(QueryTabs.K,{models:allTabs,onClick:selectTab,onClear:deleteTab,onAdd:createTab,onRename:renameTab,activeModelUri:activeModelUri})]}),(editingView||editingInsight)&&(0,jsx_runtime.jsx)("div",{className:"h-5 bg-warning-highlight",children:(0,jsx_runtime.jsxs)("span",{className:"pl-2 text-xs",children:[editingView&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Editing ",isMaterializedView?"materialized view":"view",' "',editingView.name,'"']}),editingInsight&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:['Editing insight "',(0,jsx_runtime.jsx)(Link.r,{to:urls.j.insightView(editingInsight.short_id),children:editingInsight.name}),'"']})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-start align-center w-full pl-2 pr-2 bg-white dark:bg-black border-b",children:[(0,jsx_runtime.jsx)(RunButton,{}),(0,jsx_runtime.jsx)(src.p2,{vertical:!0}),editingView&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>{var _response$types;return updateView({id:editingView.id,query:{...sourceQuery.source,query:queryInput},types:response&&"types"in response&&null!==(_response$types=response?.types)&&void 0!==_response$types?_response$types:[],shouldRematerialize:isMaterializedView,edited_history_id:inProgressViewEdits[editingView.id]})},disabledReason:editingViewDisabledReason,icon:(0,jsx_runtime.jsx)(EditingViewButtonIcon,{}),type:"tertiary",size:"xsmall",id:`sql-editor-query-window-update-${isMaterializedView?"materialize":"view"}`,children:isMaterializedView?"Update and re-materialize view":"Update view"}),!isMaterializedView&&renderMaterializeButton(),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>openHistoryModal(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBook,{}),type:"tertiary",size:"xsmall",id:"sql-editor-query-window-history",children:"History"})]}),editingInsight&&renderAddSQLVariablesButton(),!editingInsight&&!editingView&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>saveAsView(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),type:"tertiary",size:"xsmall","data-attr":"sql-editor-save-view-button",id:"sql-editor-query-window-save-as-view",children:"Save as view"}),renderMaterializeButton(),renderAddSQLVariablesButton()]}),(0,jsx_runtime.jsx)(FixErrorButton,{type:"tertiary",size:"xsmall",source:"action-bar"})]}),(0,jsx_runtime.jsx)(QueryPane,{originalValue:originalQueryInput,queryInput:suggestedQueryInput,sourceQuery:sourceQuery.source,promptError:null,onRun:runQuery,codeEditorProps:{queryKey:codeEditorKey,onChange:v=>{setQueryInput(null!=v?v:"")},onMount:(editor,monaco)=>{onSetMonacoAndEditor(monaco,editor)},onPressCmdEnter:(value,selectionType)=>{value&&"selection"===selectionType?runQuery(value):runQuery()},onError:error=>{setError(error)},onMetadata:metadata=>{setMetadata(metadata)},onMetadataLoading:loading=>{setMetadataLoading(loading)}}}),(0,jsx_runtime.jsx)(InternalQueryWindow,{}),(0,jsx_runtime.jsx)(QueryHistoryModal,{})]})}function RunButton(){let{runQuery}=(0,index_esm.useActions)(multitabEditorLogic.tg),{cancelQuery}=(0,index_esm.useActions)(dataNodeLogic.M),{responseLoading}=(0,index_esm.useValues)(dataNodeLogic.M),{metadata,queryInput,isSourceQueryLastRun}=(0,index_esm.useValues)(multitabEditorLogic.tg),isUsingIndices=metadata?.isUsingIndices==="yes",[iconColor,tooltipContent]=(0,react.useMemo)(()=>isSourceQueryLastRun?["var(--primary)","No changes to run"]:!metadata||isUsingIndices||0===queryInput.trim().length?["var(--success)","New changes to run"]:["var(--warning)",isUsingIndices?void 0:"This query is not using indices optimally, which may result in slower performance."],[metadata,isUsingIndices,queryInput,isSourceQueryLastRun]);return(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"sql-editor-run-button",onClick:()=>{responseLoading?cancelQuery():runQuery()},icon:responseLoading?(0,jsx_runtime.jsx)(icons.uR,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPlayFilled,{color:iconColor}),type:"tertiary",size:"xsmall",tooltip:tooltipContent,children:responseLoading?"Cancel":"Run"})}function InternalQueryWindow(){let{cacheLoading}=(0,index_esm.useValues)(multitabEditorLogic.tg);return cacheLoading?null:(0,jsx_runtime.jsx)(OutputPane,{})}var LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),navigationLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/navigationLogic.tsx"),editorSceneLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/editorSceneLogic.tsx"),QueryDatabase=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/sidebar/QueryDatabase.tsx");let EditorSidebar=_ref=>{let{sidebarRef,codeEditorKey}=_ref,{sidebarOverlayOpen}=(0,index_esm.useValues)(editorSceneLogic.h),{sidebarWidth}=(0,index_esm.useValues)(editorSizingLogic),{setSidebarWidth}=(0,index_esm.useActions)(navigationLogic.f),editorSizingLogicProps=editorSizingLogic.props,{activeTab,variablesForInsight}=(0,index_esm.useValues)(editorSidebarLogic),{setActiveTab}=(0,index_esm.useActions)(editorSidebarLogic),{editingView}=(0,index_esm.useValues)(multitabEditorLogic.tg);(0,react.useEffect)(()=>{setSidebarWidth(sidebarWidth)},[sidebarWidth]);let tabs=(0,react.useMemo)(()=>[{key:EditorSidebarTab.QueryDatabase,label:(0,jsx_runtime.jsx)(src.u,{title:"Data warehouse",children:(0,jsx_runtime.jsx)("div",{className:"flex justify-center px-2",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconServer,{className:"text-xl"})})})},{key:EditorSidebarTab.QueryVariables,label:(0,jsx_runtime.jsx)(src.u,{title:editingView?"Variables are not allowed in views.":"Query variables",children:(0,jsx_runtime.jsxs)("div",{className:"flex justify-center px-2 relative",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconBrackets,{className:"text-xl"}),variablesForInsight.length>0&&(0,jsx_runtime.jsx)("div",{className:"absolute -top-1 -right-1 flex items-center justify-center bg-gray-700 rounded-full text-white text-[9px] h-3 w-3 min-w-3",children:variablesForInsight.length})]})}),disabled:editingView},{key:EditorSidebarTab.QueryInfo,label:(0,jsx_runtime.jsx)(src.u,{title:"Materialization and query properties",children:(0,jsx_runtime.jsx)("div",{className:"flex justify-center px-2",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconBolt,{className:"text-xl"})})})}],[variablesForInsight.length,editingView]);return(0,jsx_runtime.jsxs)("div",{className:"EditorSidebar flex flex-col h-full relative",ref:sidebarRef,style:{width:`${sidebarWidth}px`},children:[(0,jsx_runtime.jsx)("div",{className:"w-full",children:(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeTab,onChange:key=>{dist_module.ZP.capture("sql-editor-side-tab-change",{tab:key,oldTab:activeTab}),tabs.find(t=>t.key===key&&t.disabled)||setActiveTab(key)},tabs:tabs,size:"small",barClassName:"flex justify-center items-center"})}),(()=>{switch(activeTab){case EditorSidebarTab.QueryDatabase:return(0,jsx_runtime.jsx)(QueryDatabase.x,{isOpen:sidebarOverlayOpen});case EditorSidebarTab.QueryVariables:return editingView?(0,jsx_runtime.jsx)("div",{className:"px-4 py-2 text-secondary",children:"Variables are not allowed in views."}):(0,jsx_runtime.jsx)("div",{className:"px-4 py-2",children:(0,jsx_runtime.jsx)(QueryVariables,{})});case EditorSidebarTab.QueryInfo:return(0,jsx_runtime.jsx)("div",{className:"px-4 py-2 overflow-y-auto",children:(0,jsx_runtime.jsx)(QueryInfo,{codeEditorKey:codeEditorKey})});default:return(0,jsx_runtime.jsx)(QueryDatabase.x,{isOpen:sidebarOverlayOpen})}})(),(0,jsx_runtime.jsx)(Resizer.w,{...editorSizingLogicProps.sidebarResizerProps,offset:0})]})};function EditorScene_EditorScene(){let ref=(0,react.useRef)(null),navigatorRef=(0,react.useRef)(null),queryPaneRef=(0,react.useRef)(null),sidebarRef=(0,react.useRef)(null),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),[monacoAndEditor,setMonacoAndEditor]=(0,react.useState)(null),[monaco,editor]=null!=monacoAndEditor?monacoAndEditor:[],codeEditorKey=`hogQLQueryEditor/${lib.router.values.location.pathname}`,logic=(0,multitabEditorLogic.tg)({key:codeEditorKey,monaco,editor}),{queryInput,sourceQuery,dataLogicKey}=(0,index_esm.useValues)(logic),{setSourceQuery,setResponse,setDataError}=(0,index_esm.useActions)(logic),dataVisualizationLogicProps={key:dataLogicKey,query:sourceQuery,dashboardId:void 0,dataNodeCollectionId:dataLogicKey,insightMode:types.LO.Edit,loadPriority:void 0,cachedResults:void 0,variablesOverride:void 0,setQuery:setSourceQuery},dataNodeLogicProps={query:sourceQuery.source,key:dataLogicKey,cachedResults:void 0,loadPriority:void 0,dataNodeCollectionId:dataLogicKey,variablesOverride:void 0,autoLoad:!1,onData:data=>{setResponse(null!=data?data:null)},onError:error=>{setDataError(error)}},{loadData}=(0,index_esm.useActions)((0,dataNodeLogic.M)(dataNodeLogicProps)),variablesLogicProps={key:dataVisualizationLogicProps.key,readOnly:!1,queryInput,sourceQuery,setQuery:setSourceQuery,onUpdate:query=>{loadData("force_async",void 0,query.source)}};return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:editorSizingLogic,props:{editorSceneRef:ref,navigatorRef,sidebarRef,sourceNavigatorResizerProps:{containerRef:navigatorRef,logicKey:"source-navigator",placement:"right"},sidebarResizerProps:{containerRef:sidebarRef,logicKey:"sidebar-resizer",placement:"right"},queryPaneResizerProps:{containerRef:queryPaneRef,logicKey:"query-pane",placement:"bottom"}},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeLogic.M,props:dataNodeLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataVisualizationLogic.H8,props:dataVisualizationLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:displayLogic.Y,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:variablesLogic.Q,props:variablesLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:variableModalLogic.b,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:editorSidebarLogic,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:outputPaneLogic.o,props:{},children:(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:multitabEditorLogic.tg,props:{key:codeEditorKey,monaco,editor},children:[(0,jsx_runtime.jsxs)("div",{"data-attr":"editor-scene",className:"EditorScene w-full h-full flex flex-row overflow-hidden",ref:ref,children:[!featureFlags[constants.y8.SQL_EDITOR_TREE_VIEW]&&(0,jsx_runtime.jsx)(EditorSidebar,{sidebarRef:sidebarRef,codeEditorKey:codeEditorKey}),(0,jsx_runtime.jsx)(QueryWindow,{onSetMonacoAndEditor:(monaco,editor)=>setMonacoAndEditor([monaco,editor])})]}),(0,jsx_runtime.jsx)(ViewLinkModal.WI,{})]})})})})})})})})})}},"../../frontend/src/scenes/data-warehouse/editor/QueryTabs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{K:()=>QueryTabs});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.24.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let editor_AutoTab=_ref=>{let{value,onChange,onKeyDown,onBlur,autoFocus}=_ref,inputRef=(0,react.useRef)(null),spanRef=(0,react.useRef)(null);return(0,react.useEffect)(()=>{if(!inputRef.current||!spanRef.current)return;let newWidth=spanRef.current.offsetWidth;inputRef.current.style.width=newWidth+"px"},[value]),(0,jsx_runtime.jsxs)("div",{className:"relative inline-block",children:[(0,jsx_runtime.jsx)("span",{ref:spanRef,className:"pointer-events-none absolute invisible whitespace-pre","aria-hidden":"true",children:value}),(0,jsx_runtime.jsx)("input",{ref:inputRef,className:"bg-transparent border-none focus:outline-hidden p-0",value:value,onChange:e=>{onChange(e)},onKeyDown:onKeyDown,onBlur:onBlur,autoFocus:autoFocus})]})};var multitabEditorLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/multitabEditorLogic.tsx");function QueryTabs(_ref){let{models,onClear,onClick,onAdd,onRename,activeModelUri}=_ref,{allTabs}=(0,index_esm.useValues)(multitabEditorLogic.tg),containerRef=(0,react.useRef)(null),prevTabsCountRef=(0,react.useRef)(allTabs.length);return(0,react.useEffect)(()=>{allTabs.length>prevTabsCountRef.current&&containerRef.current?.scrollTo({left:containerRef.current.scrollWidth,behavior:"smooth"}),prevTabsCountRef.current=allTabs.length},[allTabs]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row overflow-auto hide-scrollbar h-[39px]",ref:containerRef,children:models.map(model=>(0,jsx_runtime.jsx)(QueryTabComponent,{model:model,onClear:models.length>1?onClear:void 0,onClick:onClick,active:activeModelUri?.uri.path===model.uri.path,onRename:onRename},model.uri.path))}),(0,jsx_runtime.jsx)(src.Jp,{className:"rounded-none",onClick:()=>onAdd(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{fontSize:14}),"data-attr":"sql-editor-new-tab-button"})]})}function QueryTabComponent(_ref2){let{model,active,onClear,onClick,onRename}=_ref2,[tabName,setTabName]=(0,react.useState)(()=>model.name||multitabEditorLogic.x$),[isEditing,setIsEditing]=(0,react.useState)(!1);(0,react.useEffect)(()=>{setTabName(model.view?.name||model.name||multitabEditorLogic.x$)},[model.view?.name,model.name]);let handleRename=()=>{setIsEditing(!1),onRename(model,tabName)};return(0,jsx_runtime.jsxs)("div",{onClick:()=>onClick?.(model),className:(0,clsx_m.default)("deprecated-space-y-px p-1 flex border-b-2 flex-row items-center gap-1 hover:bg-surface-primary cursor-pointer",active?"bg-surface-primary border-b-2 !border-brand-yellow":"bg-surface-secondary border-transparent",onClear?"pl-3 pr-2":"px-3"),children:[isEditing?(0,jsx_runtime.jsx)(editor_AutoTab,{value:tabName,onChange:e=>setTabName(e.target.value),onBlur:handleRename,autoFocus:!0,onKeyDown:e=>{"Enter"===e.key?handleRename():"Escape"===e.key&&setIsEditing(!1)}}):(0,jsx_runtime.jsx)("div",{onDoubleClick:()=>{!model.view&&setIsEditing(!isEditing)},className:"flex-grow text-left whitespace-pre",children:tabName}),onClear&&(0,jsx_runtime.jsx)(src.Jp,{onClick:e=>{e.stopPropagation(),onClear(model)},size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{})})]})}},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/queries/nodes/DataVisualization/Components/ConditionalFormatting/ConditionalFormattingTab.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".ConditionalFormattingTab__ColorPicker .LemonButton__chrome{gap:0;padding-left:6px!important}",""]),module.exports=exports},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/queries/nodes/DataVisualization/Components/SideBar.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".DataVisualization .LemonTabs .LemonTabs__bar{margin-bottom:1px;overflow-y:hidden;scrollbar-width:none}.DataVisualization .LemonTabs .LemonTabs__bar::-webkit-scrollbar{display:none}.DataVisualization .SideBar{border-radius:var(--radius);max-width:18rem;min-width:18rem}.DataVisualization .SideBar .LemonInput.LemonInput--medium{display:flex}.DataVisualization .SideBar .LemonInput.LemonInput--medium .LemonInput__input{flex:1;width:0}.DataVisualization .SideBar .grow-2{flex-grow:2}",""]),module.exports=exports},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/DataGrid.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".rdg-cell{border-block-end:1px solid var(--border);font-size:.75rem}.rdg-header-row .rdg-cell:focus,.rdg-header-row .rdg-cell:focus-visible{box-shadow:none!important;outline:none!important}.rdg-cell:focus,.rdg-cell:focus-visible{box-shadow:none!important;outline:none!important}.rdg-row .hover-actions-cell{opacity:0;transition:opacity .2s ease}.rdg-row:hover{cursor:pointer}.rdg-row:hover .hover-actions-cell{opacity:1}.RowDetailsModal .LemonTable__content table td{max-width:0}",""]),module.exports=exports},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/EditorScene.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".EditorScene .LemonTabs__bar{height:39px;margin-bottom:0}.EditorScene .OutputPane .LemonTabs{align-self:center}.EditorScene .OutputPane .LemonTabs__bar:before{display:none}",""]),module.exports=exports}}]);