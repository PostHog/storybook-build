(window.webpackJsonp=window.webpackJsonp||[]).push([[289],{"./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx":function(Ke,k,a){"use strict";a.d(k,"a",function(){return N});var Ce=a("./node_modules/core-js/modules/es.array.map.js"),me=a.n(Ce),e=a("./node_modules/react/index.js"),s=a.n(e),V=a("./node_modules/clsx/dist/clsx.m.js"),w=a("./node_modules/kea/lib/index.esm.js"),te=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),I=a("./frontend/src/lib/components/LemonButton/index.ts"),je=a("./node_modules/antd/es/popconfirm/index.js"),U=a("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),G=a("./frontend/src/lib/components/LemonRow/index.ts"),W=a("./frontend/src/lib/components/icons.tsx"),Se=a("./frontend/src/lib/components/Spinner/Spinner.tsx"),pe=a("./node_modules/kea-forms/lib/index.js"),Ve=a.n(pe),x=a("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),ne=a("./frontend/src/lib/forms/Field.tsx");function f(O){var y=O.numberOfResults,j=O.isSearching,P=O.isAddingEntry,R=O.type;return y>0?null:j?s.a.createElement(G.a,{outlined:!0,fullWidth:!0,size:"large",className:"AuthorizedUrlRow"},"There are no authorized ",R===U.a.RECORDING_DOMAINS?"domains":"URLs"," that match your search."):P?null:s.a.createElement(G.a,{outlined:!0,fullWidth:!0,size:"large",className:"AuthorizedUrlRow"},R===U.a.RECORDING_DOMAINS?"No domains are specified, so recordings will be authorized on all domains.":"There are no authorized urls. Add one to get started.")}function ae(O){var y=O.actionId,j=O.type,P=Object(U.c)({actionId:y,type:j}),R=Object(w.useValues)(P),H=R.isProposedUrlSubmitting,S=Object(w.useActions)(P),L=S.cancelProposingUrl;return s.a.createElement(pe.Form,{logic:U.c,props:{actionId:y,type:j},formKey:"proposedUrl",enableFormOnSubmit:!0,className:"w-full space-y-2"},s.a.createElement(ne.a,{name:"url"},s.a.createElement(x.a,{autoFocus:!0,placeholder:"Enter a URL or wildcard subdomain (e.g. https://*.posthog.com)","data-attr":"url-input"})),s.a.createElement("div",{className:"flex justify-end gap-2"},s.a.createElement(I.a,{type:"secondary",onClick:L},"Cancel"),s.a.createElement(I.a,{htmlType:"submit",type:"primary",disabled:H,"data-attr":"url-save"},"Save")))}function N(O){var y=O.actionId,j=O.type,P=O.addText,R=P===void 0?"Add":P,H=Object(U.c)({actionId:y,type:j}),S=Object(w.useValues)(H),L=S.urlsKeyed,ve=S.suggestionsLoading,J=S.searchTerm,fe=S.launchUrl,oe=S.editUrlIndex,$=S.isAddUrlFormVisible,C=S.onlyAllowDomains,M=Object(w.useActions)(H),re=M.addUrl,B=M.removeUrl,se=M.setSearchTerm,Le=M.newUrl,ge=M.setEditUrlIndex;return s.a.createElement("div",null,s.a.createElement("div",{className:"flex items-center mb-4 gap-2 justify-between"},s.a.createElement(x.a,{type:"search",placeholder:"Search for authorized ".concat(C?"domains":"URLs"),onChange:se,value:J}),s.a.createElement(I.a,{onClick:Le,type:"secondary",icon:s.a.createElement(W.IconPlus,null),"data-attr":"toolbar-add-url"},R)),ve?s.a.createElement(G.a,{outlined:!0,fullWidth:!0,size:"large",key:-1},s.a.createElement(Se.a,{className:"text-xl"})):s.a.createElement("div",{className:"space-y-2"},$&&s.a.createElement(G.a,{outlined:!0,fullWidth:!0,size:"large"},s.a.createElement(ae,{type:j,actionId:y})),s.a.createElement(f,{numberOfResults:L.length,isSearching:J.length>0,isAddingEntry:$,type:j}),L.map(function(T,X){return s.a.createElement("div",{key:X,className:Object(V.a)("border rounded flex items-center py-2 px-4 min-h-14")},oe===X?s.a.createElement(ae,{type:j,actionId:y}):s.a.createElement(s.a.Fragment,null,T.type==="suggestion"&&s.a.createElement(te.a,{type:"highlight",className:"mr-4 uppercase"},"Suggestion"),s.a.createElement("span",{title:T.url,className:"flex-1 truncate"},T.url),s.a.createElement("div",{className:"Actions flex space-x-2 shrink-0"},T.type==="suggestion"?s.a.createElement(I.a,{onClick:function(){return re(T.url)},icon:s.a.createElement(W.IconPlus,null),"data-attr":"toolbar-apply-suggestion"},"Apply suggestion"):s.a.createElement(s.a.Fragment,null,s.a.createElement(I.a,{icon:s.a.createElement(W.IconOpenInApp,null),to:fe(T.url),targetBlank:!0,tooltip:j===U.a.TOOLBAR_URLS?"Launch toolbar":"Launch url",center:!0,className:"ActionButton","data-attr":"toolbar-open"},"Launch"),s.a.createElement(I.a,{icon:s.a.createElement(W.IconEdit,null),onClick:function(){return ge(T.originalIndex)},tooltip:"Edit",center:!0,className:"ActionButton"}),s.a.createElement(je.a,{placement:"topRight",title:s.a.createElement(s.a.Fragment,null,"Are you sure you want to remove this authorized"," ",C?"domain":"URL","?"),onConfirm:function(){return B(X)}},s.a.createElement(I.a,{icon:s.a.createElement(W.IconDelete,null),tooltip:"Remove ".concat(C?"domain":"URL"),center:!0,className:"ActionButton"}))))))})))}try{N.displayName="AuthorizedUrlList",N.__docgenInfo={description:"",displayName:"AuthorizedUrlList",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"TOOLBAR_URLS"'},{value:'"RECORDING_DOMAINS"'}]}},addText:{defaultValue:{value:"Add"},description:"",name:"addText",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx#AuthorizedUrlList"]={docgenInfo:N.__docgenInfo,name:"AuthorizedUrlList",path:"frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx#AuthorizedUrlList"})}catch(O){}},"./frontend/src/scenes/actions/Action.tsx":function(Ke,k,a){"use strict";a.r(k),a.d(k,"scene",function(){return ut}),a.d(k,"Action",function(){return q});var Ce=a("./node_modules/core-js/modules/es.array.concat.js"),me=a("./node_modules/react/index.js"),e=a.n(me),s=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),V=a.n(s),w=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),te=a.n(w),I=a("./node_modules/core-js/modules/es.array.map.js"),je=a("./node_modules/core-js/modules/es.array.filter.js"),U=a("./node_modules/core-js/modules/es.object.to-string.js"),G=a("./node_modules/core-js/modules/es.object.keys.js"),W=a("./node_modules/core-js/modules/es.symbol.js"),Se=a("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),pe=a("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ve=a("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),x=a("./frontend/src/lib/utils.tsx"),ne=a("./frontend/src/lib/components/Link.tsx"),f=a("./node_modules/kea/lib/index.esm.js"),ae=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),N=a.n(ae),O=a("./node_modules/@babel/runtime/regenerator/index.js"),y=a.n(O),j=a("./node_modules/core-js/modules/es.function.name.js"),P=a("./node_modules/core-js/modules/es.array.iterator.js"),R=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),H=a("./node_modules/core-js/modules/es.regexp.exec.js"),S=a("./node_modules/core-js/modules/es.string.split.js"),L=a("./frontend/src/lib/api.ts"),ve=a("./frontend/src/models/actionsModel.ts"),J=a("./frontend/src/lib/components/lemonToast.tsx"),fe=a("./node_modules/kea-loaders/lib/index.js"),oe=a("./node_modules/kea-forms/lib/index.js"),$=a("./node_modules/kea-router/lib/index.js"),C=a("./frontend/src/scenes/urls.ts"),M=a("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts");function re(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,r)}return o}function B(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?re(Object(o),!0).forEach(function(r){V()(n,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):re(Object(o)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))})}return n}var se=Object(f.kea)([Object(f.path)(["scenes","actions","actionEditLogic"]),Object(f.props)({}),Object(f.key)(function(n){return n.id||"new"}),Object(f.actions)({setAction:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:t,options:o}},setCreateNew:function(t){return{createNew:t}},actionAlreadyExists:function(t){return{actionId:t}},deleteAction:!0}),Object(f.connect)({actions:[ve.a,["loadActions"],M.c,["loadEventDefinitions"]]}),Object(f.reducers)({createNew:[!1,{setCreateNew:function(t,o){var r=o.createNew;return r}}]}),Object(oe.forms)(function(n){var t=n.actions,o=n.props;return{action:{defaults:B({},o.action),errors:function(l){var u=l.name;return{name:u?null:"You need to set a name"}},submit:function(l){t.saveAction(l)}}}}),Object(fe.loaders)(function(n){var t=n.props,o=n.values,r=n.actions;return{actionCount:{loadActionCount:function(){var l=N()(y.a.mark(function d(){return y.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!t.id){i.next=6;break}return i.next=3,L.b.actions.getCount(t.id);case 3:i.t0=i.sent,i.next=7;break;case 6:i.t0=0;case 7:return i.abrupt("return",i.t0);case 8:case"end":return i.stop()}},d)}));function u(){return l.apply(this,arguments)}return u}()},action:[B({},t.action),{setAction:function(u){var d=u.action,g=u.options.merge;return g?B(B({},o.action),d):d},saveAction:function(){var l=N()(y.a.mark(function d(g,i){var c,E;return y.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(c=B({},g),c.steps=c.steps?c.steps.filter(function(ue){return ue.event}):[],p.prev=2,!c.id){p.next=9;break}return p.next=6,L.b.actions.update(c.id,c,t.temporaryToken);case 6:c=p.sent,p.next=12;break;case 9:return p.next=11,L.b.actions.create(c,t.temporaryToken);case 11:c=p.sent;case 12:i(),p.next=22;break;case 15:if(p.prev=15,p.t0=p.catch(2),p.t0.code!=="unique"){p.next=21;break}return E=p.t0.detail.split(" ").pop(),J.d.error(e.a.createElement(e.a.Fragment,null,"Action with this name already exists."," ",e.a.createElement(ne.a,{to:C.a.action(E)},"Click here to edit."))),p.abrupt("return",c);case 21:throw p.t0;case 22:return J.d.success("Action saved"),t.onSave(c),r.loadEventDefinitions(null),r.loadActions(),p.abrupt("return",c);case 27:case"end":return p.stop()}},d,null,[[2,15]])}));function u(d,g){return l.apply(this,arguments)}return u}()}]}}),Object(f.listeners)(function(n){var t=n.values,o=n.actions;return{deleteAction:function(){Object(x.x)({endpoint:L.b.actions.determineDeleteEndpoint(),object:t.action,callback:function(){$.router.actions.push(C.a.actions()),o.loadActions()}})}}}),Object(f.afterMount)(function(n){var t=n.actions,o=n.props;o.id?t.loadActionCount():t.setAction({name:"",steps:[{isNew:Object(x.Ib)()}]},{merge:!1})})]),Le=a("./frontend/src/scenes/actions/Actions.scss"),ge=a("./frontend/src/scenes/actions/EventName.tsx"),T=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),X=a.n(T),Q=a("./frontend/src/scenes/teamLogic.tsx"),Ee=a("./node_modules/antd/es/button/index.js"),we=a("./node_modules/antd/es/modal/index.js"),We=a("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),Te=a("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts");function le(n){var t,o=n.actionId,r=n.style,l=n.children,u=Object(me.useState)(!1),d=X()(u,2),g=d[0],i=d[1],c=Object(f.useValues)(Q.a),E=c.currentTeam;return e.a.createElement(e.a.Fragment,null,e.a.createElement(Ee.a,{href:Object(Te.b)(E==null||(t=E.app_urls)===null||t===void 0?void 0:t[0],o),style:r,size:"small",onClick:function(p){p.preventDefault(),i(!0)}},l),e.a.createElement(we.a,{visible:g,title:o?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:e.a.createElement(Ee.a,{onClick:function(){return i(!1)}},"Close"),onCancel:function(){return i(!1)}},e.a.createElement(We.a,{actionId:o,type:Te.a.TOOLBAR_URLS})))}try{le.displayName="AppEditorLink",le.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:le.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(n){}var $e=a("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Ye=a("./frontend/src/lib/components/Tooltip.tsx"),ie=a("./frontend/src/scenes/actions/hints.tsx"),ke=a("./node_modules/antd/es/typography/index.js"),Ie=a("./node_modules/antd/es/col/index.js"),Ge=a("./node_modules/antd/es/card/index.js"),He=a("./node_modules/antd/es/space/index.js"),D=a("./node_modules/antd/es/radio/index.js"),Je=a("./node_modules/@ant-design/icons/es/icons/ExportOutlined.js"),xe=a("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),Ne=a("./frontend/@posthog/lemon-ui/src/index.ts");function Pe(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,r)}return o}function b(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?Pe(Object(o),!0).forEach(function(r){V()(n,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Pe(Object(o)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))})}return n}var De=ke.a.Text,Ue="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function ce(n){var t=n.step,o=n.actionId,r=n.isOnlyStep,l=n.index,u=n.identifier,d=n.onDelete,g=n.onChange,i=function(E){g(E)};return e.a.createElement(Ie.a,{span:24,md:12},e.a.createElement(Ge.a,{className:"action-step",style:{overflow:"visible"}},l>0&&e.a.createElement("div",{className:"stateful-badge pos-center-end or"},"OR"),e.a.createElement("div",null,!r&&e.a.createElement("div",{className:"remove-wrapper"},e.a.createElement("button",{type:"button","aria-label":"delete",onClick:d},e.a.createElement("span",{"aria-hidden":"true"},"\xD7"))),e.a.createElement("div",{className:"mb-4"},e.a.createElement("b",null,"Match Group #",l+1)),e.a.createElement(Qe,{step:t,sendStep:i}),e.a.createElement("div",{style:{marginTop:t.event==="$pageview"?20:8,paddingBottom:0}},t.event==="$autocapture"&&e.a.createElement(Xe,{step:t,sendStep:i,actionId:o}),t.event!=null&&t.event!=="$autocapture"&&t.event!=="$pageview"&&e.a.createElement("div",{style:{marginTop:"2rem"}},e.a.createElement("label",null,e.a.createElement("b",null,"Event name: ")),e.a.createElement(ge.a,{value:t.event,onChange:function(E){return i(b(b({},t),{},{event:E||""}))}}),e.a.createElement("br",null),e.a.createElement("small",null,e.a.createElement("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer"},"See documentation")," ","on how to send custom events in lots of languages.")),t.event==="$pageview"&&e.a.createElement("div",null,e.a.createElement(Z,{step:t,sendStep:i,item:"url",extra_options:e.a.createElement(Re,{step:t,sendStep:i}),label:"URL"}),t.url_matching&&t.url_matching in ie.a&&e.a.createElement("small",{style:{display:"block",marginTop:-12}},ie.a[t.url_matching])),t.event&&e.a.createElement("div",{className:"action-property-filters"},e.a.createElement("h3",{className:"l3"},"Filters"),(!t.properties||t.properties.length===0)&&e.a.createElement("div",{className:"text-muted"},"This match group has no additional filters."),e.a.createElement($e.a,{propertyFilters:t.properties,pageKey:u,eventNames:t.event?[t.event]:[],onChange:function(E){i(b(b({},t),{},{properties:E}))},showConditionBadge:!0}))))))}function Z(n){var t=function(r){return n.sendStep(b(b({},n.step),{},V()({},n.item,r||null)))};return e.a.createElement("div",{className:"mb-4"},e.a.createElement("label",{style:{fontWeight:"bold"}},n.label," ",n.extra_options),n.caption&&e.a.createElement("div",{className:"action-step-caption"},n.caption),n.item==="selector"?e.a.createElement(Ne.LemonTextArea,{onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}):e.a.createElement(Ne.LemonInput,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}))}function Xe(n){var t=n.step,o=n.actionId,r=n.sendStep,l=function(){return e.a.createElement("div",{className:"text-center"},e.a.createElement("span",{className:"stateful-badge and"},"AND"))};return e.a.createElement("div",null,e.a.createElement("span",null,e.a.createElement(le,{actionId:o,style:{margin:"1rem 0"}},"Select element on site ",e.a.createElement(Je.a,null)),e.a.createElement("a",{href:"".concat(Ue,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8}},"See documentation.")," "),e.a.createElement(Z,{step:t,sendStep:r,item:"href",label:"Link target equals",caption:e.a.createElement(e.a.Fragment,null,"If your element is a link, the location that the link opens (",e.a.createElement("code",null,"href")," tag)")}),e.a.createElement(l,null),e.a.createElement(Z,{step:t,sendStep:r,item:"text",label:"Text equals",caption:"Text content inside your element"}),e.a.createElement(l,null),e.a.createElement(Z,{step:t,sendStep:r,item:"selector",label:e.a.createElement(e.a.Fragment,null,"HTML selector matches",e.a.createElement(Ye.a,{title:"Click here to learn more about supported selectors"},e.a.createElement("a",{href:"".concat(Ue,"#matching-selectors"),target:"_blank",rel:"noopener"},e.a.createElement(xe.a,{style:{marginLeft:4}})))),placeholder:'button[data-attr="my-id"]',caption:e.a.createElement(He.b,{direction:"vertical"},e.a.createElement(De,{style:{color:"var(--muted)"}},"CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",e.a.createElement(De,{code:!0},'[data-attr="signup"]')))}),e.a.createElement("div",{style:{marginBottom:18}},e.a.createElement(l,null)),e.a.createElement(Z,{step:t,sendStep:r,item:"url",extra_options:e.a.createElement(Re,{step:t,sendStep:r}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(t==null?void 0:t.url_matching)&&t.url_matching in ie.a&&e.a.createElement("small",{style:{display:"block",marginTop:-12}},ie.a[t.url_matching]))}function Qe(n){var t=n.step,o=n.sendStep,r=function(u){var d=u.target.value;d==="$autocapture"?o(b(b({},t),{},{event:"$autocapture"})):d==="event"?o(b(b({},t),{},{event:""})):d==="$pageview"&&o(b(b({},t),{},{event:"$pageview",url:t.url}))};return e.a.createElement("div",{className:"type-switcher"},e.a.createElement(D.a.Group,{buttonStyle:"solid",onChange:r,value:t.event==="$autocapture"||t.event==="$pageview"||t.event===void 0?t.event:"event"},e.a.createElement(D.a.Button,{value:"$autocapture"},"Autocapture"),e.a.createElement(D.a.Button,{value:"event"},"Custom event"),e.a.createElement(D.a.Button,{value:"$pageview"},"Page view")))}function Re(n){var t=n.step,o=n.sendStep,r=function(u){o(b(b({},t),{},{url_matching:u.target.value}))};return e.a.createElement(D.a.Group,{buttonStyle:"solid",onChange:r,value:t.url_matching||"contains",size:"small"},e.a.createElement(D.a.Button,{value:"contains"},"contains"),e.a.createElement(D.a.Button,{value:"regex"},"matches regex"),e.a.createElement(D.a.Button,{value:"exact"},"matches exactly"))}try{ce.displayName="ActionStep",ce.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:ce.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(n){}var Ze=a("./node_modules/antd/es/row/index.js"),qe=a("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),_e=a("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),et=a("./frontend/src/lib/components/PageHeader.tsx"),Me=a("./frontend/src/lib/components/EditableField/EditableField.tsx"),tt=a("./frontend/src/types.ts"),nt=a("./frontend/src/scenes/userLogic.ts"),at=a("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),F=a("./frontend/src/lib/forms/Field.tsx"),he=a("./frontend/src/lib/components/LemonButton/index.ts"),ot=a("./frontend/src/lib/components/LemonCheckbox/index.ts"),rt=a("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),st=a("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx");function Be(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,r)}return o}function lt(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?Be(Object(o),!0).forEach(function(r){V()(n,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Be(Object(o)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))})}return n}function de(n){var t=n.action,o=n.id,r=n.onSave,l=n.temporaryToken,u={id:o,action:t,onSave:function(m){return r(m)},temporaryToken:l},d=se(u),g=Object(f.useValues)(d),i=g.action,c=g.actionLoading,E=g.actionCount,z=g.actionCountLoading,p=Object(f.useActions)(d),ue=p.submitAction,mt=p.deleteAction,pt=Object(f.useValues)(Q.a),Oe=pt.currentTeam,vt=Object(f.useValues)(nt.a),ft=vt.hasAvailableFeature,be=Oe==null?void 0:Oe.slack_incoming_webhook,Fe=function(){return e.a.createElement(he.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",onClick:function(){mt()}},"Delete")},ze=function(){return e.a.createElement(he.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",onClick:function(){$.router.actions.push(C.a.actions())}},"Cancel")};return e.a.createElement("div",{className:"action-edit-container"},e.a.createElement(oe.Form,{logic:se,props:u,formKey:"action",enableFormOnSubmit:!0},e.a.createElement(et.a,{title:e.a.createElement(F.a,{name:"name"},function(v){var m=v.value,h=v.onChange;return e.a.createElement(Me.a,{name:"name",value:m||"",placeholder:"Name this action",onChange:o?void 0:h,onSave:function(K){h(K),ue()},mode:o?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(o?"edit":"create"),className:"action-name"})}),caption:e.a.createElement(e.a.Fragment,null,e.a.createElement(F.a,{name:"description"},function(v){var m=v.value,h=v.onChange;return e.a.createElement(Me.a,{multiline:!0,name:"description",value:m||"",placeholder:"Description (optional)",onChange:o?void 0:h,onSave:function(K){h(K),ue()},mode:o?void 0:"edit","data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!ft(tt.d.INGESTION_TAXONOMY)})}),e.a.createElement(F.a,{name:"tags"},function(v){var m=v.value,h=v.onChange;return e.a.createElement(at.a,{tags:m!=null?m:[],onChange:function(K,Ae){return h(Ae)},className:"action-tags",saving:c})})),buttons:o?Fe():ze()}),o&&e.a.createElement("div",{className:"input-set"},e.a.createElement("div",null,e.a.createElement("span",{className:"text-muted mb-2"},z&&e.a.createElement(qe.a,null),E!==null&&E>-1&&e.a.createElement(e.a.Fragment,null,"This action matches ",e.a.createElement("b",null,Object(x.p)(E))," events in the last 3 months")))),e.a.createElement("div",{style:{overflow:"visible"}},e.a.createElement("h2",{className:"subtitle"},"Match groups"),e.a.createElement("div",null,"Your action will be triggered whenever ",e.a.createElement("b",null,"any of your match groups")," are received."," ",e.a.createElement("a",{href:"https://posthog.com/docs/features/actions",target:"_blank"},e.a.createElement(xe.a,null))),e.a.createElement(F.a,{name:"steps"},function(v){var m=v.onChange;return e.a.createElement("div",{style:{textAlign:"right",marginBottom:12}},e.a.createElement(Ee.a,{onClick:function(){return m([].concat(te()(i.steps||[]),[{isNew:Object(x.Ib)()}]))},size:"small"},"Add another match group"))}),e.a.createElement(F.a,{name:"steps"},function(v){var m=v.value,h=v.onChange;return e.a.createElement(Ze.a,{gutter:[24,24]},e.a.createElement(e.a.Fragment,null,m.map(function(A,K){var Ae=String(JSON.stringify(A));return e.a.createElement(ce,{key:K,identifier:Ae,index:K,step:A,actionId:i.id||0,isOnlyStep:!!m&&m.length===1,onDelete:function(){var _,Y=A.id?"id":"isNew";h((_=m==null?void 0:m.filter(function(ee){return ee[Y]!==A[Y]}))!==null&&_!==void 0?_:[])},onChange:function(_){var Y;h((Y=m==null?void 0:m.map(function(ee){return A.id&&ee.id==A.id||A.isNew&&ee.isNew===A.isNew?lt({id:A.id,isNew:A.isNew},_):ee}))!==null&&Y!==void 0?Y:[])}})})),e.a.createElement(Ie.a,{span:24,md:12},e.a.createElement("div",{className:"match-group-add-skeleton",onClick:function(){h([].concat(te()(i.steps||[]),[{isNew:Object(x.Ib)()}]))}},e.a.createElement(_e.a,{style:{fontSize:28,color:"#666666"}}))))})),e.a.createElement("div",{className:"my-8"},e.a.createElement(F.a,{name:"post_to_slack"},function(v){var m=v.value,h=v.onChange;return e.a.createElement(e.a.Fragment,null,e.a.createElement(ot.a,{id:"webhook-checkbox",checked:!!m,onChange:h,disabled:!be,label:e.a.createElement(e.a.Fragment,null,"Post to webhook when this action is triggered.")}),e.a.createElement("p",{className:"pl-7"},e.a.createElement(ne.a,{to:"/project/settings#webhook"},be?"Configure":"Enable"," this integration in Setup.")))}),i.post_to_slack&&e.a.createElement(e.a.Fragment,null,e.a.createElement(F.a,{name:"slack_message_format"},function(v){var m=v.value,h=v.onChange;return e.a.createElement(e.a.Fragment,null,e.a.createElement(st.a,{showOptional:!0},"Message format"),e.a.createElement(rt.a,{placeholder:"Default: [action.name] triggered by [person]",value:m,onChange:h,disabled:!be||!i.post_to_slack,"data-attr":"edit-slack-message-format"}),e.a.createElement("small",null,e.a.createElement("a",{href:"https://posthog.com/docs/integrations/message-formatting/",target:"_blank",rel:"noopener noreferrer"},"See documentation on how to format webhook messages.")))}))),e.a.createElement("div",{className:"flex justify-end gap-2"},o?Fe():ze(),e.a.createElement(he.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:c},"Save"))))}try{de.displayName="ActionEdit",de.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:de.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(n){}var it=a("./frontend/src/scenes/events/index.ts"),ct=a("./frontend/src/lib/dayjs.ts"),dt=a("./frontend/src/lib/components/Spinner/Spinner.tsx"),ye=Object(f.kea)({props:{},key:function(t){return t.id||"new"},path:function(t){return["scenes","actions","actionLogic",t]},actions:function(){return{checkIsFinished:function(o){return{action:o}},setPollTimeout:function(o){return{pollTimeout:o}},setIsComplete:function(o){return{isComplete:o}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(o,r){var l=r.pollTimeout;return l}}],isComplete:[!1,{setIsComplete:function(o,r){var l=r.isComplete;return l}}]}},selectors:{breadcrumbs:[function(n){return[n.action]},function(n){return[{name:"Data Management",path:C.a.eventDefinitions()},{name:"Actions",path:C.a.actions()},{name:(n==null?void 0:n.name)||"Unnamed",path:n?C.a.action(n.id):void 0}]}]},loaders:function(t){var o=t.actions,r=t.props;return{action:{loadAction:function(){var l=N()(y.a.mark(function d(){var g;return y.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(o.setIsComplete(!1),r.id){c.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return c.next=5,L.b.actions.get(r.id);case 5:return g=c.sent,o.checkIsFinished(g),c.abrupt("return",g);case 8:case"end":return c.stop()}},d)}));function u(){return l.apply(this,arguments)}return u}()}}},listeners:function(t){var o=t.actions,r=t.values;return{checkIsFinished:function(u){var d=u.action;d.is_calculating?o.setPollTimeout(setTimeout(function(){return o.loadAction()},1e3)):(o.setIsComplete(new Date),r.pollTimeout&&clearTimeout(r.pollTimeout))}}},events:function(t){var o=t.values,r=t.actions,l=t.props;return{afterMount:function(){l.id&&r.loadAction()},beforeUnmount:function(){o.pollTimeout&&clearTimeout(o.pollTimeout)}}}}),ut={logic:ye,component:q,paramsToProps:function(t){var o=t.params.id;return{id:parseInt(o)}}};function q(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.id,o={action_id:t},r=Object(f.useActions)($.router),l=r.push,u=Object(f.useValues)(ye),d=u.action,g=u.isComplete,i=Object(f.useActions)(ye),c=i.loadAction;return e.a.createElement(e.a.Fragment,null,(!t||d)&&e.a.createElement(de,{id:t,action:d,onSave:function(z){t||l(C.a.action(z.id)),c()}}),t&&(g?e.a.createElement("div",null,e.a.createElement("h2",{className:"subtitle"},"Matching events"),e.a.createElement("p",null,"This is the list of ",e.a.createElement("strong",null,"recent")," events that match this action.",d!=null&&d.last_calculated_at?e.a.createElement(e.a.Fragment,null," ","Last calculated: ",e.a.createElement("b",null,Object(ct.a)(d.last_calculated_at).fromNow()),"."):""),e.a.createElement("div",{className:"pt-4 border-t"}),e.a.createElement(it.b,{fixedFilters:o,sceneUrl:C.a.action(t),fetchMonths:3,pageKey:"action-".concat(t,"-").concat(JSON.stringify(o)),showEventFilter:!1})):e.a.createElement("div",null,e.a.createElement("h2",{className:"subtitle"},"Matching events"),e.a.createElement("div",{className:"flex items-center"},e.a.createElement(dt.a,{className:"mr-4"}),"Calculating action, please hold on."))))}try{q.displayName="Action",q.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:q.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(n){}}}]);
