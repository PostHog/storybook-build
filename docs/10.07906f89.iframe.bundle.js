(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(J,g,t){"use strict";t.r(g),t.d(g,"AppMetricsTab",function(){return u}),t.d(g,"appMetricsSceneLogic",function(){return G});var L=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),y=t.n(L),U=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),p=t.n(U),R=t("./node_modules/@babel/runtime/regenerator/index.js"),d=t.n(R),h=t("./node_modules/core-js/modules/es.array.iterator.js"),N=t.n(h),B=t("./node_modules/core-js/modules/es.object.to-string.js"),z=t.n(B),K=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Q=t.n(K),W=t("./node_modules/core-js/modules/es.array.concat.js"),V=t.n(W),F=t("./node_modules/core-js/modules/es.function.name.js"),X=t.n(F),x=t("./node_modules/core-js/modules/es.array.includes.js"),Y=t.n(x),H=t("./node_modules/core-js/modules/es.string.includes.js"),Z=t.n(H),S=t("./node_modules/core-js/modules/es.array.filter.js"),w=t.n(S),$=t("./node_modules/core-js/modules/es.number.constructor.js"),k=t.n($),E=t("./node_modules/kea/lib/index.esm.js"),j=t("./node_modules/kea-loaders/lib/index.js"),q=t.n(j),v=t("./frontend/src/scenes/urls.ts"),m=t("./frontend/src/lib/api.ts"),D=t("./frontend/src/scenes/teamLogic.tsx"),M=t("./node_modules/kea-router/lib/index.js"),ee=t.n(M),O=t("./frontend/src/lib/utils.tsx"),u;(function(r){r.ProcessEvent="processEvent",r.OnEvent="onEvent",r.ExportEvents="exportEvents",r.ScheduledTask="scheduledTask",r.HistoricalExports="historical_exports"})(u||(u={}));var P="-30d",T=[u.ProcessEvent,u.OnEvent,u.ExportEvents,u.ScheduledTask],G=Object(E.kea)([Object(E.path)(function(r){return["scenes","apps","appMetricsSceneLogic",r]}),Object(E.props)({}),Object(E.key)(function(r){return r.pluginConfigId}),Object(E.actions)({setActiveTab:function(s){return{tab:s}},setDateFrom:function(s){return{dateFrom:s}},openErrorDetailsModal:function(s,e,n){return{errorType:s,category:e,jobId:n}},closeErrorDetailsModal:!0}),Object(E.reducers)({activeTab:[null,{setActiveTab:function(s,e){var n=e.tab;return n}}],dateFrom:[P,{setDateFrom:function(s,e){var n=e.dateFrom;return n}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(s,e){var n=e.errorType;return n},closeErrorDetailsModal:function(){return null}}]}),Object(j.loaders)(function(r){var s=r.values,e=r.props;return{pluginConfig:[null,{loadPluginConfig:function(){var n=p()(d.a.mark(function i(){return d.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,m.b.get("api/projects/".concat(D.a.values.currentTeamId,"/plugin_configs/").concat(e.pluginConfigId));case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},i)}));function o(){return n.apply(this,arguments)}return o}()}],appMetricsResponse:[null,{loadMetrics:function(){var n=p()(d.a.mark(function i(){var a;return d.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=Object(O.Eb)({category:s.activeTab,date_from:s.dateFrom}),c.next=3,m.b.get("api/projects/".concat(D.a.values.currentTeamId,"/app_metrics/").concat(e.pluginConfigId,"?").concat(a));case 3:return c.abrupt("return",c.sent);case 4:case"end":return c.stop()}},i)}));function o(){return n.apply(this,arguments)}return o}()}],historicalExports:[[],{loadHistoricalExports:function(){var n=p()(d.a.mark(function i(){var a,l;return d.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,m.b.get("api/projects/".concat(D.a.values.currentTeamId,"/app_metrics/").concat(e.pluginConfigId,"/historical_exports"));case 2:return a=_.sent,l=a.results,_.abrupt("return",l);case 5:case"end":return _.stop()}},i)}));function o(){return n.apply(this,arguments)}return o}()}],errorDetails:[[],{openErrorDetailsModal:function(){var n=p()(d.a.mark(function i(a){var l,c,_,b,I,A;return d.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return l=a.category,c=a.jobId,_=a.errorType,b=Object(O.Eb)({category:l,job_id:c,error_type:_}),f.next=4,m.b.get("api/projects/".concat(D.a.values.currentTeamId,"/app_metrics/").concat(e.pluginConfigId,"/error_details?").concat(b));case 4:return I=f.sent,A=I.result,f.abrupt("return",A);case 7:case"end":return f.stop()}},i)}));function o(i){return n.apply(this,arguments)}return o}()}]}}),Object(E.selectors)(function(r){var s=r.values;return{breadcrumbs:[function(e){return[e.pluginConfig,function(n,o){return o.pluginConfigId}]},function(e,n){var o;return[{name:"Apps",path:v.a.projectApps()},{name:e==null||(o=e.plugin_info)===null||o===void 0?void 0:o.name,path:v.a.appMetrics(n)}]}],showTab:[function(){return[]},function(){return function(e){if(s.pluginConfigLoading||!s.pluginConfig||!s.pluginConfig.plugin_info.capabilities)return!1;var n=s.pluginConfig.plugin_info.capabilities,o=n.methods.includes("exportEvents");return e===u.HistoricalExports?o:e===u.OnEvent&&o?!1:e===u.ScheduledTask?!o&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(i){return n.scheduled_tasks.includes(i)}):n.methods.includes(e)}}]}}),Object(E.listeners)(function(r){var s=r.values,e=r.actions;return{loadPluginConfigSuccess:function(){if(!s.activeTab){var o=T.filter(function(l){return s.showTab(l)}),i=y()(o,1),a=i[0];e.setActiveTab(a)}},setActiveTab:function(o){var i=o.tab;i===u.HistoricalExports?e.loadHistoricalExports():e.loadMetrics()},setDateFrom:function(){e.loadMetrics()}}}),Object(M.actionToUrl)(function(r){var s=r.values,e=r.props;return{setActiveTab:function(){return C(s,e)},setDateFrom:function(){return C(s,e)}}}),Object(M.urlToAction)(function(r){var s=r.values,e=r.actions,n=r.props;return{"/app/:pluginConfigId/:page":function(i,a){n.pluginConfigId===Number(i.pluginConfigId)&&(s.pluginConfig||e.loadPluginConfig(),i.page===u.HistoricalExports?e.setActiveTab(u.HistoricalExports):(a.tab&&T.includes(a.tab)&&e.setActiveTab(a.tab),a.from&&e.setDateFrom(a.from)))}}})]);function C(r,s){if(r.activeTab===u.HistoricalExports)return v.a.appHistoricalExports(s.pluginConfigId);var e={};return r.activeTab&&(e.tab=r.activeTab),r.dateFrom!==P&&(e.from=r.dateFrom),v.a.appMetrics(s.pluginConfigId,e)}}}]);
