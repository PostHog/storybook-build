"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[6464],{"./frontend/src/scenes/groups/Group.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Group:()=>Group,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),PropertiesTable=__webpack_require__("./frontend/src/lib/components/PropertiesTable/index.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),api=__webpack_require__("./frontend/src/lib/api.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),groupsModel=__webpack_require__("./frontend/src/models/groupsModel.ts"),types=__webpack_require__("./frontend/src/types.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),GroupActorDisplay=__webpack_require__("./frontend/src/scenes/persons/GroupActorDisplay.tsx"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),DataTable_utils=__webpack_require__("./frontend/src/queries/nodes/DataTable/utils.ts"),queries_utils=__webpack_require__("./frontend/src/queries/utils.ts"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx");const groupLogic=(0,index_esm.kea)({path:["groups","groupLogic"],connect:{values:[teamLogic.teamLogic,["currentTeamId"],groupsModel.$,["groupTypes","aggregationLabel"],featureFlagLogic.h,["featureFlags"]]},actions:()=>({setGroup:(groupTypeIndex,groupKey,groupTab)=>({groupTypeIndex,groupKey,groupTab}),setGroupTab:groupTab=>({groupTab}),setGroupEventsQuery:query=>({query})}),loaders:_ref=>{let{values}=_ref;return{groupData:[null,{loadGroup:async()=>{const params={group_type_index:values.groupTypeIndex,group_key:values.groupKey},url=`api/projects/${values.currentTeamId}/groups/find?${(0,utils.oZ)(params)}`;return await api.ZP.get(url)}}]}},reducers:{groupTypeIndex:[0,{setGroup:(_,_ref2)=>{let{groupTypeIndex}=_ref2;return groupTypeIndex}}],groupKey:["",{setGroup:(_,_ref3)=>{let{groupKey}=_ref3;return groupKey}}],groupTab:[null,{setGroup:(_,_ref4)=>{let{groupTab}=_ref4;return null!=groupTab?groupTab:null},setGroupTab:(_,_ref5)=>{let{groupTab}=_ref5;return groupTab}}],groupEventsQuery:[null,{setGroup:(_,_ref6)=>{let{groupTypeIndex,groupKey}=_ref6;return function getGroupEventsQuery(groupTypeIndex,groupKey){return{kind:schema.O.DataTableNode,full:!0,source:{kind:schema.O.EventsQuery,select:(0,DataTable_utils.Qi)(schema.O.EventsQuery),after:"-24h",fixedProperties:[{key:`$group_${groupTypeIndex}`,value:groupKey,type:types.FT.Event,operator:types.WV.Exact}]}}}(groupTypeIndex,groupKey)},setGroupEventsQuery:(_,_ref7)=>{let{query}=_ref7;return(0,queries_utils.TC)(query)?query:null}}]},selectors:{showCustomerSuccessDashboards:[s=>[s.featureFlags],featureFlags=>featureFlags[constants.y8.CS_DASHBOARDS]],groupTypeName:[s=>[s.aggregationLabel,s.groupTypeIndex],(aggregationLabel,index)=>aggregationLabel(index).singular],groupType:[s=>[s.groupTypes,s.groupTypeIndex],(groupTypes,index)=>groupTypes[index]?.group_type],breadcrumbs:[s=>[s.groupTypeName,s.groupTypeIndex,s.groupKey,s.groupData],(groupTypeName,groupTypeIndex,groupKey,groupData)=>[{name:(0,utils.fm)(groupTypeName),path:urls.j.groups(String(groupTypeIndex))},{name:(0,GroupActorDisplay.O)(groupKey,groupData?.group_properties||{}),path:urls.j.group(String(groupTypeIndex),groupKey)}]]},actionToUrl:_ref8=>{let{values}=_ref8;return{setGroup:()=>{const{groupTypeIndex,groupKey,groupTab}=values;return urls.j.group(String(groupTypeIndex),groupKey,!0,groupTab)},setGroupTab:()=>{const{groupTypeIndex,groupKey,groupTab}=values;return urls.j.group(String(groupTypeIndex),groupKey,!0,groupTab)}}},urlToAction:_ref9=>{let{actions,values}=_ref9;return{"/groups/:groupTypeIndex/:groupKey(/:groupTab)":_ref10=>{let{groupTypeIndex,groupKey,groupTab}=_ref10;groupTypeIndex&&groupKey&&(+groupTypeIndex===values.groupTypeIndex&&groupKey===values.groupKey?actions.setGroupTab(groupTab||null):actions.setGroup(+groupTypeIndex,decodeURIComponent(groupKey),groupTab))}}},listeners:_ref11=>{let{actions,selectors,values}=_ref11;return{setGroup:(_,__,___,previousState)=>{selectors.groupTypeIndex(previousState)===values.groupTypeIndex&&selectors.groupKey(previousState)===values.groupKey||actions.loadGroup()}}}});var RelatedGroups=__webpack_require__("./frontend/src/scenes/groups/RelatedGroups.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),CopyToClipboard=__webpack_require__("./frontend/src/lib/components/CopyToClipboard.tsx"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),RelatedFeatureFlags=__webpack_require__("./frontend/src/scenes/persons/RelatedFeatureFlags.tsx"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),Dashboard=__webpack_require__("./frontend/src/scenes/dashboard/Dashboard.tsx"),sceneTypes=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts");const groupDashboardLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","groups","groupDashboardLogic"]),(0,index_esm.connect)({values:[userLogic.userLogic,["user"]]}),(0,index_esm.selectors)((()=>({groupDashboardId:[s=>[s.user],user=>{const currentDashboard=user?.scene_personalisation?.find((choice=>choice.scene===sceneTypes.x.Group))?.dashboard;return"number"==typeof currentDashboard?currentDashboard:currentDashboard?.id}],dashboardLogicProps:[s=>[s.groupDashboardId],groupDashboardId=>({id:null!=groupDashboardId?groupDashboardId:void 0,placement:types.F4.Group})]})))]);var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),SceneDashboardChoiceRequired=__webpack_require__("./frontend/src/lib/components/SceneDashboardChoice/SceneDashboardChoiceRequired.tsx"),SceneDashboardChoiceModal=__webpack_require__("./frontend/src/lib/components/SceneDashboardChoice/SceneDashboardChoiceModal.tsx"),sceneDashboardChoiceModalLogic=__webpack_require__("./frontend/src/lib/components/SceneDashboardChoice/sceneDashboardChoiceModalLogic.ts"),dashboardLogic=__webpack_require__("./frontend/src/scenes/dashboard/dashboardLogic.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function GroupDashboard(_ref){let{groupData}=_ref;const{showSceneDashboardChoiceModal}=(0,index_esm.useActions)((0,sceneDashboardChoiceModalLogic.F)({scene:sceneTypes.x.Group})),{dashboardLogicProps}=(0,index_esm.useValues)(groupDashboardLogic),{dashboard}=(0,index_esm.useValues)((0,dashboardLogic.BM)(dashboardLogicProps)),{setProperties}=(0,index_esm.useActions)((0,dashboardLogic.BM)(dashboardLogicProps));return(0,react.useEffect)((()=>{if(dashboard&&groupData){const current=Array.isArray(dashboard?.filters.properties)?dashboard?.filters.properties:[],desired={key:"id",value:[groupData.group_properties.id.toString()],operator:types.WV.Exact,type:types.FT.Group,group_type_index:groupData.group_type_index};current.some((item=>item.type===types.FT.Group&&item.group_type_index===groupData.group_type_index&&"id"===item.key))||setProperties([...current,desired])}}),[dashboard,groupData]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[void 0!==dashboardLogicProps.id?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end mb-2",children:(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",size:"small","data-attr":"group-dashboard-change-dashboard",onClick:showSceneDashboardChoiceModal,children:"Change dashboard"})}),(0,jsx_runtime.jsx)(Dashboard.Dashboard,{id:dashboardLogicProps.id.toString(),placement:dashboardLogicProps.placement})]}):(0,jsx_runtime.jsx)(SceneDashboardChoiceRequired.C,{open:()=>{showSceneDashboardChoiceModal()},scene:sceneTypes.x.Group}),(0,jsx_runtime.jsx)(SceneDashboardChoiceModal.q,{scene:sceneTypes.x.Group})]})}try{GroupDashboard.displayName="GroupDashboard",GroupDashboard.__docgenInfo={description:"",displayName:"GroupDashboard",props:{groupData:{defaultValue:null,description:"",name:"groupData",required:!0,type:{name:"Group"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/groups/GroupDashboard.tsx#GroupDashboard"]={docgenInfo:GroupDashboard.__docgenInfo,name:"GroupDashboard",path:"frontend/src/scenes/groups/GroupDashboard.tsx#GroupDashboard"})}catch(__react_docgen_typescript_loader_error){}const scene={component:Group,logic:groupLogic};function GroupCaption(_ref){let{groupData,groupTypeName}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{className:"mr-4",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"Type:"})," ",groupTypeName]}),(0,jsx_runtime.jsxs)("div",{className:"mr-4",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"Key:"})," ",(0,jsx_runtime.jsx)(CopyToClipboard.D,{tooltipMessage:null,description:"group key",style:{display:"inline-flex",justifyContent:"flex-end"},children:groupData.group_key})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"First seen:"})," ",groupData.created_at?(0,jsx_runtime.jsx)(TZLabel.w,{time:groupData.created_at}):"unknown"]})]})}function Group(){const{groupData,groupDataLoading,groupTypeName,groupKey,groupTypeIndex,groupType,groupTab,groupEventsQuery,showCustomerSuccessDashboards}=(0,index_esm.useValues)(groupLogic),{setGroupTab,setGroupEventsQuery}=(0,index_esm.useActions)(groupLogic);return groupData?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:(0,GroupActorDisplay.O)(groupData.group_key,groupData.group_properties),caption:(0,jsx_runtime.jsx)(GroupCaption,{groupData,groupTypeName})}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:null!=groupTab?groupTab:types.j3.PROPERTIES,onChange:tab=>setGroupTab(tab),tabs:[{key:types.j3.PROPERTIES,label:(0,jsx_runtime.jsx)("span",{"data-attr":"persons-properties-tab",children:"Properties"}),content:(0,jsx_runtime.jsx)(PropertiesTable.V,{type:types.ll.Group,properties:groupData.group_properties||{},embedded:!1,searchable:!0})},{key:types.j3.EVENTS,label:(0,jsx_runtime.jsx)("span",{"data-attr":"persons-events-tab",children:"Events"}),content:groupEventsQuery?(0,jsx_runtime.jsx)(Query.A,{query:groupEventsQuery,setQuery:setGroupEventsQuery}):(0,jsx_runtime.jsx)(Spinner.$,{})},{key:types.j3.RELATED,label:(0,jsx_runtime.jsx)("div",{className:"flex items-center","data-attr":"group-related-tab",children:"Related people & groups"}),tooltip:`People and groups that have shared events with this ${groupTypeName} in the last 90 days.`,content:(0,jsx_runtime.jsx)(RelatedGroups.S,{id:groupKey,groupTypeIndex})},{key:types.j3.FEATURE_FLAGS,label:(0,jsx_runtime.jsx)("span",{"data-attr":"groups-related-flags-tab",children:"Feature flags"}),content:(0,jsx_runtime.jsx)(RelatedFeatureFlags.c,{distinctId:groupData.group_key,groups:{[groupType]:groupKey}})},showCustomerSuccessDashboards?{key:types.j3.DASHBOARD,label:"Dashboard",content:(0,jsx_runtime.jsx)(GroupDashboard,{groupData})}:null]})]}):groupDataLoading?(0,jsx_runtime.jsx)(Spinner.t,{sceneLevel:!0}):(0,jsx_runtime.jsx)(NotFound.T,{object:"group"})}}}]);