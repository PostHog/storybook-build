(window.webpackJsonp=window.webpackJsonp||[]).push([[5,9,11,309],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(C,p,e){"use strict";e.r(p);var P=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),O=e.n(P),M=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),r=e.n(M),b={};b.insert="head",b.singleton=!1;var d=O()(r.a,b);p.default=r.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(C,p,e){"use strict";e.r(p),e.d(p,"AppMetricsGraph",function(){return W});var P=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),O=e.n(P),M=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),r=e.n(M),b=e("./node_modules/core-js/modules/es.array.concat.js"),d=e.n(b),B=e("./node_modules/core-js/modules/es.object.keys.js"),w=e.n(B),H=e("./node_modules/core-js/modules/es.symbol.js"),k=e.n(H),G=e("./node_modules/core-js/modules/es.array.filter.js"),q=e.n(G),J=e("./node_modules/core-js/modules/es.object.to-string.js"),ee=e.n(J),N=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),se=e.n(N),$=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),re=e.n($),V=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),te=e.n(V),K=e("./node_modules/react/index.js"),oe=e.n(K),Y=e("./frontend/src/lib/colors.ts"),Z=e("./node_modules/chart.js/dist/chart.mjs"),D=e("./frontend/src/scenes/apps/constants.tsx"),S=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),ne=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),T=e("./frontend/src/lib/utils.tsx"),I=e("./node_modules/react/jsx-runtime.js"),U=e.n(I);function A(u,f){var _=Object.keys(u);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(u);f&&(m=m.filter(function(c){return Object.getOwnPropertyDescriptor(u,c).enumerable})),_.push.apply(_,m)}return _}function g(u){for(var f=1;f<arguments.length;f++){var _=arguments[f]!=null?arguments[f]:{};f%2?A(Object(_),!0).forEach(function(m){O()(u,m,_[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(_)):A(Object(_)).forEach(function(m){Object.defineProperty(u,m,Object.getOwnPropertyDescriptor(_,m))})}return u}function W(u){var f=u.tab,_=u.metrics,m=u.metricsLoading,c=Object(K.useRef)(null),h=D.DescriptionColumns[f];return Object(K.useEffect)(function(){var x;if(c.current&&_){var F;x=new Z.a((F=c.current)===null||F===void 0?void 0:F.getContext("2d"),{type:"line",data:{labels:_.dates,datasets:[g({label:h.successes,data:_.successes,borderColor:""},L("data-brand-blue"))].concat(r()(h.successes_on_retry?[g({label:h.successes_on_retry,data:_.successes_on_retry},L("data-yellow"))]:[]),[g({label:h.failures,data:_.failures},L("data-vermilion"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var y;(y=x)===null||y===void 0||y.destroy()}},[_]),m||!_?Object(I.jsx)(S.a,{className:"AppMetricsGraph border rounded p-6"}):Object(I.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:Object(I.jsx)("canvas",{ref:c})})}function L(u){var f=Object(Y.b)(u);return{borderColor:f,hoverBorderColor:Object(T.kb)(f,-20),hoverBackgroundColor:Object(T.kb)(f,-20),backgroundColor:f,fill:!1,borderWidth:2,pointRadius:0}}try{W.displayName="AppMetricsGraph",W.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'},{value:'"history"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:W.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(u){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(C,p,e){"use strict";e.r(p),e.d(p,"AppMetricsTab",function(){return c}),e.d(p,"appMetricsSceneLogic",function(){return F});var P=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),O=e.n(P),M=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),r=e.n(M),b=e("./node_modules/@babel/runtime/regenerator/index.js"),d=e.n(b),B=e("./node_modules/core-js/modules/es.array.iterator.js"),w=e.n(B),H=e("./node_modules/core-js/modules/es.object.to-string.js"),k=e.n(H),G=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),q=e.n(G),J=e("./node_modules/core-js/modules/es.array.concat.js"),ee=e.n(J),N=e("./node_modules/core-js/modules/es.function.name.js"),se=e.n(N),$=e("./node_modules/core-js/modules/es.array.filter.js"),re=e.n($),V=e("./node_modules/core-js/modules/es.array.includes.js"),te=e.n(V),K=e("./node_modules/core-js/modules/es.string.includes.js"),oe=e.n(K),Y=e("./node_modules/core-js/modules/es.number.constructor.js"),Z=e.n(Y),D=e("./node_modules/kea/lib/index.esm.js"),S=e("./node_modules/kea-loaders/lib/index.js"),ne=e.n(S),T=e("./frontend/src/scenes/urls.ts"),I=e("./frontend/src/types.ts"),U=e("./frontend/src/lib/api.ts"),A=e("./frontend/src/scenes/teamLogic.tsx"),g=e("./node_modules/kea-router/lib/index.js"),W=e.n(g),L=e("./frontend/src/lib/utils.tsx"),u=e("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),f=e("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),_=e("./frontend/src/lib/dayjs.ts"),m=e("./frontend/src/scenes/userLogic.ts"),c;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.ScheduledTask="scheduledTask",t.HistoricalExports="historical_exports",t.History="history"})(c||(c={}));var h="-30d",x=[c.ProcessEvent,c.OnEvent,c.ExportEvents,c.ScheduledTask],F=Object(D.kea)([Object(D.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(D.props)({}),Object(D.key)(function(t){return t.pluginConfigId}),Object(D.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}},openErrorDetailsModal:function(o,n,s){return{errorType:o,category:n,jobId:s}},closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),Object(D.reducers)({activeTab:[null,{setActiveTab:function(o,n){var s=n.tab;return s}}],selectedDateFrom:[null,{setDateFrom:function(o,n){var s=n.dateFrom;return s}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(o,n){var s=n.errorType;return s},closeErrorDetailsModal:function(){return null}}]}),Object(S.loaders)(function(t){var o=t.values,n=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var s=r()(d.a.mark(function a(){return d.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,U.b.get("api/projects/".concat(A.a.values.currentTeamId,"/plugin_configs/").concat(n.pluginConfigId));case 2:return E.abrupt("return",E.sent);case 3:case"end":return E.stop()}},a)}));function i(){return s.apply(this,arguments)}return i}()}],appMetricsResponse:[null,{loadMetrics:function(){var s=r()(d.a.mark(function a(){var l;return d.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!(o.activeTab&&o.dateFrom)){j.next=5;break}return l=Object(L.Fb)({category:o.activeTab,date_from:o.dateFrom}),j.next=4,U.b.get("api/projects/".concat(A.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"?").concat(l));case 4:return j.abrupt("return",j.sent);case 5:case"end":return j.stop()}},a)}));function i(){return s.apply(this,arguments)}return i}()}],historicalExports:[[],{loadHistoricalExports:function(){var s=r()(d.a.mark(function a(){var l,E;return d.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,U.b.get("api/projects/".concat(A.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/historical_exports"));case 2:return l=v.sent,E=l.results,v.abrupt("return",E);case 5:case"end":return v.stop()}},a)}));function i(){return s.apply(this,arguments)}return i}()}],errorDetails:[[],{openErrorDetailsModal:function(){var s=r()(d.a.mark(function a(l){var E,j,v,z,Q,X;return d.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return E=l.category,j=l.jobId,v=l.errorType,z=Object(L.Fb)({category:E,job_id:j,error_type:v}),R.next=4,U.b.get("api/projects/".concat(A.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/error_details?").concat(z));case 4:return Q=R.sent,X=Q.result,R.abrupt("return",X);case 7:case"end":return R.stop()}},a)}));function i(a){return s.apply(this,arguments)}return i}()}]}}),Object(D.selectors)(function(t){var o=t.values,n=t.actions;return{breadcrumbs:[function(s){return[s.pluginConfig,function(i,a){return a.pluginConfigId}]},function(s,i){var a;return[{name:"Apps",path:T.a.projectApps()},{name:s==null||(a=s.plugin_info)===null||a===void 0?void 0:a.name,path:T.a.appMetrics(i)}]}],shouldShowAppMetrics:[function(){return[m.a.selectors.hasAvailableFeature]},function(s){return s(I.e.APP_METRICS)}],defaultTab:[function(s){return[s.pluginConfig]},function(){var s;return(s=x.filter(function(i){return o.showTab(i)})[0])!==null&&s!==void 0?s:c.History}],currentTime:[function(){return[]},function(){return Date.now()}],defaultDateFrom:[function(s){return[s.pluginConfig,s.currentTime]},function(s,i){if(!(s!=null&&s.created_at))return h;var a=_.a.utc(s.created_at),l=Object(_.a)(i).diff(a,"days",!0);return l<=1?"-24h":l<=7?"-7d":h}],dateFrom:[function(s){return[s.selectedDateFrom,s.defaultDateFrom]},function(s,i){var a;return(a=s!=null?s:i)!==null&&a!==void 0?a:h}],showTab:[function(s){return[s.shouldShowAppMetrics]},function(s){return function(i){if(o.pluginConfigLoading||!o.pluginConfig||!o.pluginConfig.plugin_info.capabilities)return!1;var a=o.pluginConfig.plugin_info.capabilities,l=a.methods.includes("exportEvents");return i===c.History?!0:s?i===c.HistoricalExports?l:i===c.OnEvent&&l?!1:i===c.ScheduledTask?!l&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(E){return a.scheduled_tasks.includes(E)}):a.methods.includes(i):!1}}],interfaceJobsProps:[function(s){return[s.pluginConfig]},function(s){return!s||!s.plugin_info.public_jobs||!(s!=null&&s.enabled)?null:{jobName:u.b,jobSpec:s.plugin_info.public_jobs[u.b],pluginConfigId:s.id,pluginId:s.plugin,onSubmit:n.loadHistoricalExports}}],hasRunningExports:[function(s){return[s.historicalExports]},function(s){return s.some(function(i){return i.status=="not_finished"})}]}}),Object(D.listeners)(function(t){var o=t.values,n=t.actions;return{loadPluginConfigSuccess:function(){o.activeTab||n.setActiveTab(o.defaultTab)},setActiveTab:function(i){var a=i.tab;a===c.HistoricalExports?n.loadHistoricalExports():a!==c.History&&n.loadMetrics()},setDateFrom:function(){n.loadMetrics()},openHistoricalExportModal:function(){o.interfaceJobsProps&&Object(f.a)(o.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}}),Object(g.actionToUrl)(function(t){var o=t.values,n=t.props;return{setActiveTab:function(){return y(o,n)},setDateFrom:function(){return y(o,n)},openErrorDetailsModal:function(){return y(o,n)},closeErrorDetailsModal:function(){return y(o,n)}}}),Object(g.urlToAction)(function(t){var o=t.values,n=t.actions,s=t.props;return{"/app/:pluginConfigId/:page":function(a,l){if(s.pluginConfigId===Number(a.pluginConfigId))if(o.pluginConfig||n.loadPluginConfig(),a.page===c.HistoricalExports)n.setActiveTab(c.HistoricalExports);else if(a.page===c.History)n.setActiveTab(c.History);else if(l.tab&&x.includes(l.tab)&&l.tab!==o.activeTab?n.setActiveTab(l.tab):!o.pluginConfigLoading&&o.activeTab!==o.defaultTab&&n.setActiveTab(o.defaultTab),l.from&&o.selectedDateFrom!==l.from&&n.setDateFrom(l.from),l.error){var E=O()(l.error,2),j=E[0],v=E[1];o.errorDetailsModalError!==j&&(n.setActiveTab(v),n.openErrorDetailsModal(j,v))}else n.closeErrorDetailsModal()}}})]);function y(t,o){if(t.activeTab===c.HistoricalExports)return T.a.appHistoricalExports(o.pluginConfigId);if(t.activeTab===c.History)return T.a.appHistory(o.pluginConfigId,g.router.values.searchParams);var n={};return t.activeTab&&t.activeTab!==t.defaultTab&&(n.tab=t.activeTab),t.selectedDateFrom&&(n.from=t.selectedDateFrom),t.errorDetailsModalError&&t.activeTab&&(n.error=[t.errorDetailsModalError,t.activeTab]),T.a.appMetrics(o.pluginConfigId,n)}},"./frontend/src/scenes/apps/constants.tsx":function(C,p,e){"use strict";e.r(p),e.d(p,"DescriptionColumns",function(){return B});var P=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),O=e.n(P),M=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),r=e("./node_modules/react/jsx-runtime.js"),b=e.n(r),d,B=(d={},O()(d,M.AppMetricsTab.ProcessEvent,{successes:"Events processed",successes_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events were successfully processed and transformed by the ",Object(r.jsx)("i",{children:"processEvent"})," app method."]}),failures:"Failed events",failures_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events had errors when being processed by the ",Object(r.jsx)("i",{children:"processEvent"})," app method, but were still ingested."]})}),O()(d,M.AppMetricsTab.OnEvent,{successes:"Events processed",successes_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events were successfully processed by the ",Object(r.jsx)("i",{children:"onEvent"})," app method on the first try."]}),successes_on_retry:"Events processed on retry",successes_on_retry_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events were successfully processed by the ",Object(r.jsx)("i",{children:"onEvent"})," app method after being retried."]}),failures:"Failed events",failures_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events had errors when being processed by the ",Object(r.jsx)("i",{children:"onEvent"})," app method."]})}),O()(d,M.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_tooltip:Object(r.jsx)(r.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:Object(r.jsx)(r.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:Object(r.jsx)(r.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})}),O()(d,M.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_tooltip:Object(r.jsx)(r.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:Object(r.jsx)(r.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:Object(r.jsx)(r.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})}),O()(d,M.AppMetricsTab.ScheduledTask,{successes:"Successes",successes_tooltip:Object(r.jsxs)(r.Fragment,{children:["How many times ",Object(r.jsx)("i",{children:"runEveryMinute"}),", ",Object(r.jsx)("i",{children:"runEveryHour"})," or ",Object(r.jsx)("i",{children:"runEveryDay"})," was called successfully."]}),failures:"Failures",failures_tooltip:Object(r.jsxs)(r.Fragment,{children:["How many times ",Object(r.jsx)("i",{children:"runEveryMinute"}),", ",Object(r.jsx)("i",{children:"runEveryHour"})," or ",Object(r.jsx)("i",{children:"runEveryDay"})," failed due to errors."]})}),d)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(C,p,e){var P=e("./node_modules/css-loader/dist/runtime/api.js");p=P(!1),p.push([C.i,".AppMetricsGraph{height:300px}",""]),C.exports=p}}]);
