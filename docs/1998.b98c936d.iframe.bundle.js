"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[1998],{"./frontend/src/scenes/data-warehouse/new/dataWarehouseTableLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>dataWarehouseTableLogic});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/data-management/database/databaseTableListLogic.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/urls.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let NEW_WAREHOUSE_TABLE={id:"",name:"",url_pattern:"",format:"Parquet",credential:{access_key:"",access_secret:""}},dataWarehouseTableLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","data-warehouse","tableLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)(()=>({actions:[scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__.A,["loadDatabase"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({editingTable:editing=>({editing}),updateTargetingFlagFilters:(index,properties)=>({index,properties}),addConditionSet:!0,removeConditionSet:index=>({index}),launchTable:!0,stopTable:!0,archiveTable:!0,setDataTableQuery:query=>({query})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_3__.loaders)(_ref=>{let{props}=_ref;return{table:{loadTable:async()=>props.id&&"new"!==props.id?await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.get(props.id):{...NEW_WAREHOUSE_TABLE},createTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.create({...tablePayload}),updateTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.update(props.id,tablePayload)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)(_ref2=>{let{actions}=_ref2;return{createTableSuccess:async _ref3=>{let{table}=_ref3;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.Fragment,{children:["Table ",table.name," created"]})),actions.loadDatabase(),kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataWarehouse())},updateTableSuccess:async _ref4=>{let{table}=_ref4;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.Fragment,{children:["Table ",table.name," updated"]})),actions.editingTable(!1),kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataWarehouse())}}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)({isEditingTable:[!1,{editingTable:(_,_ref5)=>{let{editing}=_ref5;return editing}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref6)=>{let{query}=_ref6;return query}}]}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_2__.forms)(_ref7=>{let{actions,props}=_ref7;return{table:{defaults:{...NEW_WAREHOUSE_TABLE},errors:_ref8=>{let{name,url_pattern,credential,format}=_ref8;return{name:!name&&"Please enter a name.",url_pattern:!url_pattern&&"Please enter a url pattern.",credential:{access_secret:!credential.access_secret&&"Please enter an access secret.",access_key:!credential.access_key&&"Please enter an access key."},format:!format&&"Please enter the format of your files."}},submit:async tablePayload=>{props.id&&"new"!==props.id?actions.updateTable(tablePayload):actions.createTable(tablePayload)}}}})])},"./frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{So:()=>sourceWizardLogic,l2:()=>SOURCE_DETAILS});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/urls.ts"),_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/types.ts"),_settings_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts"),_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/scenes/data-warehouse/new/dataWarehouseTableLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let getHubspotRedirectUri=()=>`${window.location.origin}/data-warehouse/hubspot/redirect`,SOURCE_DETAILS={Stripe:{name:"Stripe",caption:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:["Enter your Stripe credentials to automatically pull your Stripe data into the PostHog Data warehouse.",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("br",{}),"You can find your account ID"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Link,{to:"https://dashboard.stripe.com/settings/user",target:"_blank",children:"in your Stripe dashboard"}),", and create a secret key"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Link,{to:"https://dashboard.stripe.com/apikeys",target:"_blank",children:"here"}),"."]}),fields:[{name:"account_id",label:"Account ID",type:"text",required:!0,placeholder:"acct_..."},{name:"client_secret",label:"Client Secret",type:"text",required:!0,placeholder:"sk_live_..."}]},Hubspot:{name:"Hubspot",fields:[],caption:""},Postgres:{name:"Postgres",caption:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:"Enter your Postgres credentials to automatically pull your Postgres data into the PostHog Data warehouse."}),fields:[{name:"host",label:"Host",type:"text",required:!0,placeholder:"localhost"},{name:"port",label:"Port",type:"number",required:!0,placeholder:"5432"},{name:"dbname",label:"Database",type:"text",required:!0,placeholder:"postgres"},{name:"user",label:"User",type:"text",required:!0,placeholder:"postgres"},{name:"password",label:"Password",type:"password",required:!0,placeholder:""},{name:"schema",label:"Schema",type:"text",required:!0,placeholder:"public"},{name:"ssh-tunnel",label:"Use SSH tunnel?",type:"switch-group",default:!1,fields:[{name:"host",label:"Tunnel host",type:"text",required:!0,placeholder:"localhost"},{name:"port",label:"Tunnel port",type:"number",required:!0,placeholder:"22"},{type:"select",name:"auth_type",label:"Authentication type",required:!0,defaultValue:"password",options:[{label:"Password",value:"password",fields:[{name:"username",label:"Tunnel username",type:"text",required:!0,placeholder:"User1"},{name:"password",label:"Tunnel password",type:"password",required:!0,placeholder:""}]},{label:"Key pair",value:"keypair",fields:[{name:"private_key",label:"Tunnel private key",type:"textarea",required:!0,placeholder:""},{name:"passphrase",label:"Tunnel passphrase",type:"password",required:!1,placeholder:""}]}]}]}]},Zendesk:{name:"Zendesk",caption:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:"Enter your Zendesk API key to automatically pull your Zendesk support data into the PostHog Data warehouse."}),fields:[{name:"subdomain",label:"Zendesk Subdomain",type:"text",required:!0,placeholder:""},{name:"api_key",label:"API Key",type:"text",required:!0,placeholder:""},{name:"email_address",label:"Zendesk Email Address",type:"email",required:!0,placeholder:""}]}},buildKeaFormDefaultFromSourceDetails=sourceDetails=>{let fieldDefaults=(field,obj)=>{if("switch-group"===field.type){obj[field.name]={},obj[field.name].enabled=field.default,field.fields.forEach(f=>fieldDefaults(f,obj[field.name]));return}if("select"===field.type){let hasOptionFields=!!field.options.filter(n=>{var _n$fields$length;return(null!==(_n$fields$length=n.fields?.length)&&void 0!==_n$fields$length?_n$fields$length:0)>0}).length;hasOptionFields?(obj[field.name]={},obj[field.name].selection=field.defaultValue,field.options.flatMap(n=>{var _n$fields;return null!==(_n$fields=n.fields)&&void 0!==_n$fields?_n$fields:[]}).forEach(f=>fieldDefaults(f,obj[field.name]))):obj[field.name]=field.defaultValue;return}obj[field.name]=""},sourceDetailsKeys=Object.keys(sourceDetails),formDefault=sourceDetailsKeys.reduce((defaults,cur)=>{let fields=sourceDetails[cur].fields;return fields.forEach(f=>fieldDefaults(f,defaults.payload)),defaults},{prefix:"",payload:{}});return formDefault},sourceWizardLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","data-warehouse","external","sourceWizardLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({selectConnector:connector=>({connector}),toggleManualLinkFormVisible:visible=>({visible}),handleRedirect:(kind,searchParams)=>({kind,searchParams}),onClear:!0,onBack:!0,onNext:!0,onSubmit:!0,setDatabaseSchemas:schemas=>({schemas}),toggleSchemaShouldSync:(schema,shouldSync)=>({schema,shouldSync}),clearSource:!0,updateSource:source=>({source}),createSource:!0,setIsLoading:isLoading=>({isLoading}),setSourceId:id=>({sourceId:id}),closeWizard:!0,cancelWizard:!0,setStep:step=>({step}),getDatabaseSchemas:!0,setManualLinkingProvider:provider=>({provider})}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)({values:[_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_10__.U,["tableLoading"],_settings_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_9__.T,["dataWarehouseSources"],scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_5__.preflightLogic,["preflight"]],actions:[_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_10__.U,["resetTable","createTableSuccess"],_settings_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_9__.T,["loadSources"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)({manualLinkingProvider:[null,{setManualLinkingProvider:(_,_ref)=>{let{provider}=_ref;return provider}}],selectedConnector:[null,{selectConnector:(_,_ref2)=>{let{connector}=_ref2;return connector}}],isManualLinkFormVisible:[!1,{toggleManualLinkFormVisible:(_,_ref3)=>{let{visible}=_ref3;return visible}}],currentStep:[1,{onNext:state=>state+1,onBack:state=>state-1,onClear:()=>1,setStep:(_,_ref4)=>{let{step}=_ref4;return step}}],databaseSchema:[[],{setDatabaseSchemas:(_,_ref5)=>{let{schemas}=_ref5;return schemas},toggleSchemaShouldSync:(state,_ref6)=>{let{schema,shouldSync}=_ref6,newSchema=state.map(s=>({...s,should_sync:s.table===schema.table?shouldSync:s.should_sync}));return newSchema}}],source:[{payload:{},prefix:""},{updateSource:(state,_ref7)=>{var _source$prefix,_state$payload,_source$payload;let{source}=_ref7;return{prefix:null!==(_source$prefix=source.prefix)&&void 0!==_source$prefix?_source$prefix:state.prefix,payload:{...null!==(_state$payload=state.payload)&&void 0!==_state$payload?_state$payload:{},...null!==(_source$payload=source.payload)&&void 0!==_source$payload?_source$payload:{}}}},clearSource:()=>({payload:{},prefix:""})}],isLoading:[!1,{onNext:()=>!1,setIsLoading:(_,_ref8)=>{let{isLoading}=_ref8;return isLoading}}],sourceId:[null,{setSourceId:(_,_ref9)=>{let{sourceId}=_ref9;return sourceId}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.selectors)({isManualLinkingSelected:[s=>[s.selectedConnector],selectedConnector=>!selectedConnector],canGoBack:[s=>[s.currentStep],currentStep=>4!==currentStep],canGoNext:[s=>[s.currentStep,s.dataWarehouseSources,s.sourceId,s.isManualLinkingSelected],(currentStep,allSources,sourceId,isManualLinkingSelected)=>{if(isManualLinkingSelected&&2==currentStep)return!1;let source=allSources?.results.find(n=>n.id===sourceId);return 4!==currentStep||void 0!==source&&"Completed"===source.status}],showSkipButton:[s=>[s.currentStep],currentStep=>4===currentStep],nextButtonText:[s=>[s.currentStep,s.isManualLinkingSelected],(currentStep,isManualLinkingSelected)=>3===currentStep&&isManualLinkingSelected?"Link":3===currentStep?"Import":4===currentStep?"Finish":"Next"],breadcrumbs:[()=>[],()=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_6__.x.DataWarehouse,name:"Data Warehouse",path:scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataWarehouse()},{key:[scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_6__.x.DataWarehouse,"New"],name:"New"}]],showFooter:[s=>[s.selectedConnector,s.isManualLinkFormVisible],(selectedConnector,isManualLinkFormVisible)=>selectedConnector||isManualLinkFormVisible],connectors:[s=>[s.dataWarehouseSources],sources=>Object.values(SOURCE_DETAILS).map(connector=>({...connector,disabledReason:sources&&sources.results.find(source=>source.source_type===connector.name)?"Already linked":null}))],addToHubspotButtonUrl:[s=>[s.preflight],preflight=>()=>{let clientId=preflight?.data_warehouse_integrations?.hubspot.client_id;if(!clientId)return null;let params=new URLSearchParams;return params.set("client_id",clientId),params.set("redirect_uri",getHubspotRedirectUri()),params.set("scope","crm.objects.contacts.read crm.objects.companies.read crm.objects.deals.read tickets crm.objects.quotes.read sales-email-read"),`https://app.hubspot.com/oauth/authorize?${params.toString()}`}],modalTitle:[s=>[s.currentStep],currentStep=>1===currentStep?"Select a data source to get started":2===currentStep?"Link your data source":3===currentStep?"Select tables to import":4===currentStep?"Importing your data...":""],modalCaption:[s=>[s.selectedConnector,s.currentStep],(selectedConnector,currentStep)=>2===currentStep&&selectedConnector?SOURCE_DETAILS[selectedConnector.name]?.caption:4===currentStep?"Sit tight as we import your data! After it's done, we'll show you a few examples to help you make the most of using the data within PostHog.":""]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)(_ref10=>{let{actions,values}=_ref10;return{onBack:()=>{values.currentStep<=1&&actions.onClear()},onClear:()=>{actions.selectConnector(null),actions.resetSourceConnectionDetails(),actions.clearSource(),actions.toggleManualLinkFormVisible(!1),actions.resetTable(),actions.setIsLoading(!1)},onSubmit:()=>{1!==values.currentStep&&(2===values.currentStep&&values.selectedConnector?.name&&actions.submitSourceConnectionDetails(),3===values.currentStep&&values.selectedConnector?.name?(actions.updateSource({payload:{schemas:values.databaseSchema.filter(schema=>schema.should_sync).map(schema=>schema.table)}}),actions.setIsLoading(!0),actions.createSource()):3===values.currentStep&&values.isManualLinkFormVisible&&_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_10__.U.actions.submitTable(),4===values.currentStep&&actions.closeWizard())},createTableSuccess:()=>{actions.onClear(),actions.clearSource(),actions.loadSources(null),actions.resetSourceConnectionDetails()},closeWizard:()=>{actions.onClear(),actions.clearSource(),actions.loadSources(null),actions.resetSourceConnectionDetails(),kea_router__WEBPACK_IMPORTED_MODULE_3__.router.values.location.pathname.includes(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataWarehouseTable())?kea_router__WEBPACK_IMPORTED_MODULE_3__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataWarehouseSettings()):kea_router__WEBPACK_IMPORTED_MODULE_3__.router.values.location.pathname.includes(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.pipelineNodeDataWarehouseNew())&&kea_router__WEBPACK_IMPORTED_MODULE_3__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.pipeline(_types__WEBPACK_IMPORTED_MODULE_8__.J9.DataImport))},cancelWizard:()=>{actions.onClear(),actions.setStep(1),actions.loadSources(null)},createSource:async()=>{if(null!==values.selectedConnector)try{let{id}=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.create({...values.source,source_type:values.selectedConnector.name});_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success("New Data Resource Created"),actions.setSourceId(id),actions.resetSourceConnectionDetails(),actions.loadSources(null),actions.onNext()}catch(e){var _e$data$message;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error(null!==(_e$data$message=e.data?.message)&&void 0!==_e$data$message?_e$data$message:e.message)}finally{actions.setIsLoading(!1)}},handleRedirect:async _ref11=>{let{kind,searchParams}=_ref11;if("hubspot"===kind){actions.updateSource({source_type:"Hubspot",payload:{code:searchParams.code,redirect_uri:getHubspotRedirectUri()}});return}_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("Something went wrong.")},submitSourceConnectionDetailsSuccess:()=>{actions.getDatabaseSchemas()},getDatabaseSchemas:async()=>{var _values$source$payloa,_e$data$message2;if(values.selectedConnector){actions.setIsLoading(!0);try{let schemas=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.database_schema(values.selectedConnector.name,null!==(_values$source$payloa=values.source.payload)&&void 0!==_values$source$payloa?_values$source$payloa:{});actions.setDatabaseSchemas(schemas),actions.onNext()}catch(e){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error(null!==(_e$data$message2=e.data?.message)&&void 0!==_e$data$message2?_e$data$message2:e.message)}actions.setIsLoading(!1)}},setManualLinkingProvider:()=>{actions.onNext()}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_3__.urlToAction)(_ref12=>{let{actions}=_ref12;return{"/data-warehouse/:kind/redirect":(_ref13,searchParams)=>{let{kind=""}=_ref13;"hubspot"===kind&&kea_router__WEBPACK_IMPORTED_MODULE_3__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataWarehouseTable(),{kind,code:searchParams.code})},"/data-warehouse/new":(_,searchParams)=>{"hubspot"==searchParams.kind&&searchParams.code&&(actions.selectConnector(SOURCE_DETAILS.Hubspot),actions.handleRedirect(searchParams.kind,{code:searchParams.code}),actions.setStep(2))}}}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_2__.forms)(_ref14=>{let{actions,values}=_ref14;return{sourceConnectionDetails:{defaults:buildKeaFormDefaultFromSourceDetails(SOURCE_DETAILS),errors:sourceValues=>{var _values$selectedConne;return getErrorsForFields(null!==(_values$selectedConne=values.selectedConnector?.fields)&&void 0!==_values$selectedConne?_values$selectedConne:[],sourceValues)},submit:async sourceValues=>{if(values.selectedConnector){let payload={...sourceValues,source_type:values.selectedConnector.name};actions.setIsLoading(!0);try{var _values$selectedConne2;await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.source_prefix(payload.source_type,sourceValues.prefix);let payloadKeys=(null!==(_values$selectedConne2=values.selectedConnector?.fields)&&void 0!==_values$selectedConne2?_values$selectedConne2:[]).map(n=>n.name);actions.updateSource({...payload,payload:{source_type:values.selectedConnector.name,...payloadKeys.reduce((acc,cur)=>(acc[cur]=payload.payload[cur],acc),{})}}),actions.setIsLoading(!1)}catch(e){throw e?.data?.message&&actions.setSourceConnectionDetailsManualErrors({prefix:e.data.message}),actions.setIsLoading(!1),e}}}}}})]),getErrorsForFields=(fields,values)=>{var _values$prefix,_values$payload;let errors={payload:{}};/^[a-zA-Z0-9_-]*$/.test(null!==(_values$prefix=values?.prefix)&&void 0!==_values$prefix?_values$prefix:"")||(errors.prefix="Please enter a valid prefix (only letters, numbers, and '_' or '-').");let validateField=(field,valueObj,errorsObj)=>{if("switch-group"===field.type){valueObj[field.name]?.enabled&&(errorsObj[field.name]={},field.fields.forEach(f=>validateField(f,valueObj[field.name],errorsObj[field.name])));return}if("select"===field.type){let hasOptionFields=!!field.options.filter(n=>{var _n$fields$length2;return(null!==(_n$fields$length2=n.fields?.length)&&void 0!==_n$fields$length2?_n$fields$length2:0)>0}).length;if(hasOptionFields){errorsObj[field.name]={};let selection=valueObj[field.name].selection;field.options.find(n=>n.value===selection)?.fields?.forEach(f=>validateField(f,valueObj[field.name],errorsObj[field.name]))}else field.required&&!valueObj[field.name]&&(errorsObj[field.name]=`Please select a ${field.label.toLowerCase()}`);return}field.required&&!valueObj[field.name]&&(errorsObj[field.name]=`Please enter a ${field.label.toLowerCase()}`)};for(let field of fields)validateField(field,null!==(_values$payload=values?.payload)&&void 0!==_values$payload?_values$payload:{},errors.payload);return errors}},"./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>dataWarehouseSettingsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/urls.ts");let dataWarehouseSettingsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-warehouse","settings","dataWarehouseSettingsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({deleteSource:source=>({source}),reloadSource:source=>({source}),reloadSchema:schema=>({schema}),resyncSchema:schema=>({schema}),sourceLoadingFinished:source=>({source}),schemaLoadingFinished:schema=>({schema}),updateSchema:schema=>({schema}),abortAnyRunningQuery:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{cache,actions}=_ref;return{dataWarehouseSources:[null,{loadSources:async(_,breakpoint)=>{await breakpoint(300),actions.abortAnyRunningQuery(),cache.abortController=new AbortController;let methodOptions={signal:cache.abortController.signal},res=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSources.list(methodOptions);return breakpoint(),cache.abortController=null,res}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(_ref2=>{let{cache}=_ref2;return{dataWarehouseSourcesLoading:[!1,{loadSources:()=>!0,loadSourcesFailure:()=>null!==cache.abortController,loadSourcesSuccess:()=>null!==cache.abortController}],sourceReloadingById:[{},{reloadSource:(state,_ref3)=>{let{source}=_ref3;return{...state,[source.id]:!0}},deleteSource:(state,_ref4)=>{let{source}=_ref4;return{...state,[source.id]:!0}},sourceLoadingFinished:(state,_ref5)=>{let{source}=_ref5;return{...state,[source.id]:!1}}}],schemaReloadingById:[{},{reloadSchema:(state,_ref6)=>{let{schema}=_ref6;return{...state,[schema.id]:!0}},resyncSchema:(state,_ref7)=>{let{schema}=_ref7;return{...state,[schema.id]:!0}},schemaLoadingFinished:(state,_ref8)=>{let{schema}=_ref8;return{...state,[schema.id]:!1}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_4__.x.DataWarehouse,name:"Data Warehouse",path:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.dataWarehouse()},{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_4__.x.DataWarehouseSettings,name:"Data Warehouse Settings",path:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.dataWarehouseSettings()}]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref9=>{let{actions,values,cache}=_ref9;return{loadSourcesSuccess:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout(()=>{actions.loadSources(null)},1e4)},loadSourcesFailure:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout(()=>{actions.loadSources(null)},1e4)},deleteSource:async _ref10=>{let{source}=_ref10;await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSources.delete(source.id),actions.loadSources(null),actions.sourceLoadingFinished(source)},reloadSource:async _ref11=>{var _values$dataWarehouse;let{source}=_ref11,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse?_values$dataWarehouse:[])),sourceIndex=clonedSources.findIndex(n=>n.id===source.id);clonedSources[sourceIndex].status="Running",clonedSources[sourceIndex].schemas=clonedSources[sourceIndex].schemas.map(n=>n.should_sync?{...n,status:"Running"}:n),actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources});try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSources.reload(source.id),actions.loadSources(null)}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Cant refresh source at this time")}actions.sourceLoadingFinished(source)},reloadSchema:async _ref12=>{var _values$dataWarehouse2;let{schema}=_ref12,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse2=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse2?_values$dataWarehouse2:[])),sourceIndex=clonedSources.findIndex(n=>n.schemas.find(m=>m.id===schema.id)),schemaIndex=clonedSources[sourceIndex].schemas.findIndex(n=>n.id===schema.id);clonedSources[sourceIndex].status="Running",clonedSources[sourceIndex].schemas[schemaIndex].status="Running",actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources});try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSchemas.reload(schema.id),actions.schemaLoadingFinished(schema),actions.loadSources(null)}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Cant reload schema at this time")}},resyncSchema:async _ref13=>{var _values$dataWarehouse3;let{schema}=_ref13,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse3=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse3?_values$dataWarehouse3:[])),sourceIndex=clonedSources.findIndex(n=>n.schemas.find(m=>m.id===schema.id)),schemaIndex=clonedSources[sourceIndex].schemas.findIndex(n=>n.id===schema.id);clonedSources[sourceIndex].status="Running",clonedSources[sourceIndex].schemas[schemaIndex].status="Running",actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources});try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSchemas.resync(schema.id),actions.schemaLoadingFinished(schema),actions.loadSources(null)}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Cant refresh schema at this time")}},updateSchema:async _ref14=>{var _values$dataWarehouse4;let{schema}=_ref14,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse4=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse4?_values$dataWarehouse4:[])),sourceIndex=clonedSources.findIndex(n=>n.schemas.find(m=>m.id===schema.id)),schemaIndex=clonedSources[sourceIndex].schemas.findIndex(n=>n.id===schema.id);clonedSources[sourceIndex].schemas[schemaIndex]=schema,actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources}),await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSchemas.update(schema.id,schema),actions.loadSources(null)},abortAnyRunningQuery:()=>{cache.abortController&&(cache.abortController.abort(),cache.abortController=null)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref15=>{let{actions}=_ref15;actions.loadSources(null)})])}}]);