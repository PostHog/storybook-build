(window.webpackJsonp=window.webpackJsonp||[]).push([[257],{"./frontend/src/scenes/annotations/Annotations.tsx":function(ln,L,n){"use strict";n.r(L),n.d(L,"scene",function(){return on}),n.d(L,"Annotations",function(){return Y});var cn=n("./node_modules/core-js/modules/es.function.name.js"),G=n("./node_modules/react/index.js"),t=n.n(G),p=n("./node_modules/kea/lib/index.esm.js"),W=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),I=n.n(W),J=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),E=n.n(J),K=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),g=n.n(K),U=n("./node_modules/@babel/runtime/regenerator/index.js"),A=n.n(U),dn=n("./node_modules/core-js/modules/es.array.concat.js"),un=n("./node_modules/core-js/modules/es.array.iterator.js"),mn=n("./node_modules/core-js/modules/es.object.to-string.js"),fn=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),x=n("./frontend/src/lib/api.ts"),D=n("./frontend/src/lib/utils.tsx"),H=n("./frontend/src/models/annotationsModel.ts"),d=n("./frontend/src/types.ts"),V=n("./frontend/src/scenes/teamLogic.tsx"),Q=n("./node_modules/kea-loaders/lib/index.js"),k=n("./node_modules/kea-forms/lib/index.js"),N=n("./frontend/src/lib/dayjs.ts"),T,y,F="MMMM\xA0DD,\xA0YYYY h:mm\xA0A",O=(T={},g()(T,d.c.Insight,"Insight"),g()(T,d.c.Project,"Project"),g()(T,d.c.Organization,"Organization"),T),B=(y={},g()(y,d.c.Insight,0),g()(y,d.c.Project,1),g()(y,d.c.Organization,2),y),M=Object(p.kea)([Object(p.path)(["scenes","annotations","logic"]),Object(p.actions)({deleteAnnotation:function(e){return{id:e}},restoreAnnotation:function(e){return{id:e}},loadAnnotationsNext:function(){return!0},setNext:function(e){return{next:e}},appendAnnotations:function(e){return{annotations:e}},openModalToCreateAnnotation:function(){return!0},openModalToEditAnnotation:function(e){return{annotation:e}},closeModal:!0}),Object(Q.loaders)(function(o){var e=o.actions;return{annotations:{__default:[],loadAnnotations:function(){var a=E()(A.a.mark(function l(){var r;return A.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,x.b.get("api/projects/".concat(V.a.values.currentTeamId,"/annotations/?").concat(Object(D.Db)({order:"-updated_at"})));case 2:return r=i.sent,e.setNext(r.next),i.abrupt("return",r.results);case 5:case"end":return i.stop()}},l)}));function s(){return a.apply(this,arguments)}return s}()}}}),Object(p.reducers)(function(){return{annotations:[[],{appendAnnotations:function(e,a){var s=a.annotations;return[].concat(I()(e),I()(s))}}],next:[null,{setNext:function(e,a){var s=a.next;return s}}],loadingNext:[!1,{loadAnnotationsNext:function(){return!0},appendAnnotations:function(){return!1}}],isModalOpen:[!1,{openModalToCreateAnnotation:function(){return!0},openModalToEditAnnotation:function(){return!0},closeModal:function(){return!1}}],existingModalAnnotation:[null,{openModalToCreateAnnotation:function(){return null},openModalToEditAnnotation:function(e,a){var s=a.annotation;return s}}]}}),Object(p.listeners)(function(o){var e=o.actions,a=o.values;return g()({openModalToEditAnnotation:function(l){var r=l.annotation,u=r.date_marker,i=r.scope,f=r.content;e.setAnnotationModalValues({dateMarker:Object(N.a)(u),scope:i,content:f})},openModalToCreateAnnotation:function(){e.resetAnnotationModal()},restoreAnnotation:function(){var s=E()(A.a.mark(function r(u){var i;return A.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=u.id,c.next=3,x.b.annotations.restore(i);case 3:e.loadAnnotations();case 4:case"end":return c.stop()}},r)}));function l(r){return s.apply(this,arguments)}return l}(),deleteAnnotation:function(l){var r=l.id;Object(D.w)({endpoint:x.b.annotations.determineDeleteEndpoint(),object:{name:"Annotation",id:r},callback:function(){return e.loadAnnotations()}})},loadAnnotationsNext:function(){var s=E()(A.a.mark(function r(){var u,i;return A.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(u=[],!a.next){c.next=7;break}return c.next=4,x.b.get(a.next);case 4:i=c.sent,e.setNext(i.next),u=i.results;case 7:e.appendAnnotations(u);case 8:case"end":return c.stop()}},r)}));function l(){return s.apply(this,arguments)}return l}()},H.a.actionTypes.createGlobalAnnotationSuccess,function(){e.loadAnnotations()})}),Object(p.afterMount)(function(o){var e=o.actions;return e.loadAnnotations()}),Object(k.forms)(function(o){var e=o.actions,a=o.values;return{annotationModal:{defaults:{dateMarker:Object(N.a)(),content:"",scope:d.c.Project},errors:function(l){var r=l.content;return{content:r?null:"An annotation must have text content."}},submit:function(){var s=E()(A.a.mark(function r(u){var i,f,c;return A.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(i=u.dateMarker,f=u.content,c=u.scope,!a.existingModalAnnotation){v.next=6;break}return v.next=4,x.b.annotations.update(a.existingModalAnnotation.id,{date_marker:i.toISOString(),content:f,scope:c});case 4:v.next=8;break;case 6:return v.next=8,x.b.annotations.create({date_marker:i.toISOString(),content:f,scope:c});case 8:e.loadAnnotations(),e.closeModal();case 10:case"end":return v.stop()}},r)}));function l(r){return s.apply(this,arguments)}return l}()}}})]),X=n("./frontend/src/lib/components/PageHeader.tsx"),Z=n("./frontend/src/lib/components/LemonTable/index.ts"),R=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),S=n("./frontend/src/lib/components/LemonButton/index.ts"),w=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),C=n("./frontend/src/lib/components/icons.tsx"),h=n("./frontend/@posthog/lemon-ui/src/index.ts"),q=n("./frontend/src/scenes/urls.ts"),_=n("./frontend/src/lib/components/Tooltip.tsx"),nn=n("./frontend/src/scenes/organizationLogic.tsx"),P=n("./frontend/src/lib/forms/Field.tsx"),tn=n("./frontend/src/lib/components/DatePicker.tsx");function en(){var o=Object(p.useValues)(M),e=o.isModalOpen,a=o.existingModalAnnotation,s=o.isAnnotationModalSubmitting,l=Object(p.useActions)(M),r=l.closeModal,u=l.deleteAnnotation,i=l.submitAnnotationModal,f=(a==null?void 0:a.scope)===d.c.Insight;return t.a.createElement(h.LemonModal,{isOpen:e,onClose:r,title:a?"Edit annotation":"New annotation",description:"Use annotations to add context to insights and dashboards.",footer:t.a.createElement("div",{className:"flex-1 flex items-center justify-between"},t.a.createElement("div",{className:"flex items-center gap-2"},a&&t.a.createElement(h.LemonButton,{form:"annotation-modal-form",type:"secondary",status:"danger",onClick:function(){u(a.id),r()},"data-attr":"delete-annotation"},"Delete annotation")),t.a.createElement("div",{className:"flex items-center gap-2"},t.a.createElement(h.LemonButton,{form:"annotation-modal-form",type:"secondary",onClick:r},"Cancel"),t.a.createElement(h.LemonButton,{form:"annotation-modal-form",htmlType:"submit",type:"primary",loading:s,"data-attr":"create-annotation-submit"},a?"Edit":"Create")))},t.a.createElement(k.Form,{logic:M,formKey:"annotationModal",id:"annotation-modal-form",enableFormOnSubmit:!0,className:"space-y-4"},t.a.createElement("div",{className:"flex gap-2"},t.a.createElement(P.a,{name:"dateMarker",label:"Date\xA0and\xA0time",className:"flex-1"},t.a.createElement(tn.a,{className:"h-10",allowClear:!1,showTime:!0,showSecond:!1,format:F})),t.a.createElement(P.a,{name:"scope",label:"Scope",className:"flex-1"},t.a.createElement(h.LemonSelect,{options:[].concat(I()((a==null?void 0:a.scope)===d.c.Insight?[{value:d.c.Insight,label:O[d.c.Insight]}]:[]),[{value:d.c.Project,label:O[d.c.Project],sideIcon:f?t.a.createElement(C.IconWarning,null):void 0,tooltip:f?"After saving, it won't be possible to make the annotation insight-scoped again.":void 0},{value:d.c.Organization,label:O[d.c.Organization],sideIcon:f?t.a.createElement(C.IconWarning,null):void 0,tooltip:f?"After saving, it won't be possible to make the annotation insight-scoped again.":void 0}]),fullWidth:!0}))),t.a.createElement(P.a,{name:"content",label:"Content"},t.a.createElement(h.LemonTextArea,{placeholder:"What's this annotation about?",onPressCmdEnter:i,"data-attr":"create-annotation-input"}))))}var on={component:Y,logic:M};function Y(){var o=Object(p.useValues)(V.a),e=o.currentTeam,a=Object(p.useValues)(nn.a),s=a.currentOrganization,l=Object(p.useValues)(M),r=l.annotations,u=l.annotationsLoading,i=l.next,f=l.loadingNext,c=Object(p.useActions)(M),$=c.loadAnnotationsNext,v=c.openModalToCreateAnnotation,an=c.openModalToEditAnnotation,rn=[{title:"Annotation",key:"annotation",width:"30%",render:function(b,m){return t.a.createElement("div",{className:"ph-no-capture"},m.content)}},{title:"Date\xA0and\xA0time",dataIndex:"date_marker",render:function(b,m){return Object(N.a)(m.date_marker).format(F)},sorter:function(b,m){return Object(N.a)(b.date_marker).diff(m.date_marker)}},{title:"Scope",key:"scope",render:function(b,m){var z=O[m.scope],sn=m.scope===d.c.Insight?'This annotation only applies to the "'.concat(m.insight_name,'" insight'):m.scope===d.c.Project?"This annotation applies to all insights in the ".concat(e==null?void 0:e.name," project"):"This annotation applies to all insights in the ".concat(s==null?void 0:s.name," organization");return t.a.createElement(_.a,{title:sn,placement:"right"},t.a.createElement(w.a,null,m.scope===d.c.Insight?t.a.createElement(h.Link,{to:q.a.insightView(m.insight_short_id),className:"flex items-center",target:"_blank"},z,t.a.createElement(C.IconOpenInNew,{className:"ml-1"})):z))},sorter:function(b,m){return B[b.scope]-B[m.scope]}},Object(R.b)(),Object(R.a)(),{key:"actions",width:0,render:function(b,m){return t.a.createElement(S.a,{icon:t.a.createElement(C.IconEdit,null),size:"small",type:"tertiary",status:"stealth",onClick:function(){return an(m)}})}}];return t.a.createElement(t.a.Fragment,null,t.a.createElement(X.a,{title:"Annotations",caption:t.a.createElement(t.a.Fragment,null,"Annotations add time-specific context to insights and dashboards.",t.a.createElement("br",null),"Manage all of this project's annotations from this page."),buttons:t.a.createElement(S.a,{type:"primary","data-attr":"create-annotation",onClick:v},"New annotation")}),t.a.createElement(Z.a,{"data-attr":"annotations-table",rowKey:"id",dataSource:r,columns:rn,defaultSorting:{columnKey:"date_marker",order:-1},noSortingCancellation:!0,loading:u,emptyState:"No annotations yet"}),i&&t.a.createElement("div",{className:"flex justify-center mt-6"},t.a.createElement(S.a,{type:"primary",loading:f,onClick:function(){$()}},"Load more annotations")),t.a.createElement(en,null))}}}]);
