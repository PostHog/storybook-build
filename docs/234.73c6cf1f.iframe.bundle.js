(window.webpackJsonp=window.webpackJsonp||[]).push([[234],{4233:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return appEditorUrl})),__webpack_require__.d(__webpack_exports__,"a",(function(){return NEW_URL})),__webpack_require__.d(__webpack_exports__,"c",(function(){return authorizedUrlsLogic}));__webpack_require__(41),__webpack_require__(61),__webpack_require__(85),__webpack_require__(416),__webpack_require__(45),__webpack_require__(34),__webpack_require__(123),__webpack_require__(651),__webpack_require__(906),__webpack_require__(40),__webpack_require__(84),__webpack_require__(111),__webpack_require__(100),__webpack_require__(98),__webpack_require__(277),__webpack_require__(50),__webpack_require__(469);var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(15),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_17__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(7),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_18__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_20__=(__webpack_require__(67),__webpack_require__(12)),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_20__),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(3),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_21__),kea__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(1),lib_api__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(22),lib_utils__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(10),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(26),lib_dayjs__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(35),fuse_js__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(308),kea_router__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(27);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_21___default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function appEditorUrl(appUrl,actionId,defaultIntent){var params=_objectSpread(_objectSpread({userIntent:defaultIntent?void 0:actionId?"edit-action":"add-action"},actionId?{actionId:actionId}:{}),appUrl?{appUrl:appUrl}:{});return"/api/user/redirect_to_site/"+Object(kea_router__WEBPACK_IMPORTED_MODULE_28__.encodeParams)(params,"?")}var NEW_URL="https://",authorizedUrlsLogic=Object(kea__WEBPACK_IMPORTED_MODULE_22__.kea)({path:function path(key){return["lib","components","AppEditorLink","appUrlsLogic",key]},key:function key(props){return"".concat(props.pageKey).concat(props.actionId)||"global"},props:{},connect:{values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_25__.a,["currentTeam","currentTeamId"]],actions:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_25__.a,["updateCurrentTeam"]]},actions:function actions(){return{setAppUrls:function setAppUrls(appUrls){return{appUrls:appUrls}},addUrl:function addUrl(url,launch){return{url:url,launch:launch}},newUrl:!0,removeUrl:function removeUrl(index){return{index:index}},updateUrl:function updateUrl(index,url){return{index:index,url:url}},launchAtUrl:function launchAtUrl(url){return{url:url}},setSearchTerm:function setSearchTerm(term){return{term:term}},setEditUrlIndex:function setEditUrlIndex(originalIndex){return{originalIndex:originalIndex}}}},loaders:function loaders(_ref){var _loadSuggestions,values=_ref.values;return{suggestions:{__default:[],loadSuggestions:(_loadSuggestions=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_20___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_18___default.a.mark((function _callee(){var _result$,params,result,domainsSeen;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_18___default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return params={events:[{id:"$pageview",name:"$pageview",type:"events"}],breakdown:"$current_url",date_from:Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_26__.a)().subtract(3,"days").toISOString()},_context.next=3,lib_api__WEBPACK_IMPORTED_MODULE_23__.a.get("api/projects/".concat(values.currentTeamId,"/insights/trend/?").concat(Object(lib_utils__WEBPACK_IMPORTED_MODULE_24__.zb)(params)));case 3:if(!(result=_context.sent.result)||0!==(null===(_result$=result[0])||void 0===_result$?void 0:_result$.count)){_context.next=6;break}return _context.abrupt("return",[]);case 6:return domainsSeen=[],_context.abrupt("return",(result||[]).filter((function(item){if(!item.breakdown_value)return!1;try{var domain=new URL(item.breakdown_value.toString()).hostname;if(domainsSeen.indexOf(domain)>-1)return;if(values.appUrls.filter((function(url){return url.indexOf(domain)>-1})).length>0)return;return domainsSeen.push(domain),!0}catch(error){return!1}})).map((function(item){return item.breakdown_value})).slice(0,20));case 8:case"end":return _context.stop()}}),_callee)}))),function loadSuggestions(){return _loadSuggestions.apply(this,arguments)})}}},events:function events(_ref2){var actions=_ref2.actions,values=_ref2.values;return{afterMount:function afterMount(){actions.loadSuggestions(),values.currentTeam&&actions.setAppUrls(values.currentTeam.app_urls)}}},reducers:function reducers(){return{appUrls:[[],{setAppUrls:function setAppUrls(_,_ref3){return _ref3.appUrls},addUrl:function addUrl(state,_ref4){var url=_ref4.url;return state.concat([url])},newUrl:function newUrl(state){return state.includes(NEW_URL)?state:[NEW_URL].concat(state)},updateUrl:function updateUrl(state,_ref5){var index=_ref5.index,url=_ref5.url;return Object.assign(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_17___default()(state),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_21___default()({},index,url))},removeUrl:function removeUrl(state,_ref6){var index=_ref6.index,newAppUrls=_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_17___default()(state);return newAppUrls.splice(index,1),newAppUrls}}],suggestions:[[],{addUrl:function addUrl(state,_ref7){var url=_ref7.url;return _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_17___default()(state).filter((function(item){return url!==item}))}}],searchTerm:["",{setSearchTerm:function setSearchTerm(_,_ref8){return _ref8.term}}],editUrlIndex:[null,{setEditUrlIndex:function setEditUrlIndex(_,_ref9){return _ref9.originalIndex},removeUrl:function removeUrl(editUrlIndex,_ref10){var index=_ref10.index;return editUrlIndex&&index<editUrlIndex?editUrlIndex-1:index===editUrlIndex?null:editUrlIndex}}]}},listeners:function listeners(_ref11){var _ref17,_ref15,sharedListeners=_ref11.sharedListeners,values=_ref11.values,actions=_ref11.actions;return _ref17={addUrl:[sharedListeners.saveAppUrls,function(){var _ref13=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_20___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_18___default.a.mark((function _callee2(_ref12){var url;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_18___default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:url=_ref12.url,_ref12.launch&&actions.launchAtUrl(url);case 2:case"end":return _context2.stop()}}),_callee2)})));return function(_x){return _ref13.apply(this,arguments)}}()],removeUrl:sharedListeners.saveAppUrls,updateUrl:[sharedListeners.saveAppUrls,function(){return actions.setEditUrlIndex(null)}]},_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_21___default()(_ref17,scenes_teamLogic__WEBPACK_IMPORTED_MODULE_25__.a.actionTypes.loadCurrentTeamSuccess,(_ref15=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_20___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_18___default.a.mark((function _callee3(_ref14){var currentTeam;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_18___default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:(currentTeam=_ref14.currentTeam)&&actions.setAppUrls(currentTeam.app_urls);case 2:case"end":return _context3.stop()}}),_callee3)}))),function(_x2){return _ref15.apply(this,arguments)})),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_21___default()(_ref17,"launchAtUrl",(function launchAtUrl(_ref16){var url=_ref16.url;window.location.href=values.launchUrl(url)})),_ref17},sharedListeners:function sharedListeners(_ref18){var values=_ref18.values;return{saveAppUrls:function saveAppUrls(){scenes_teamLogic__WEBPACK_IMPORTED_MODULE_25__.a.actions.updateCurrentTeam({app_urls:values.appUrls})}}},selectors:function selectors(_ref19){var props=_ref19.props;return{appUrlsKeyed:[function(s){return[s.appUrls,s.suggestions,s.searchTerm]},function(appUrls,suggestions,searchTerm){var urls=appUrls.map((function(url,index){return{url:url,type:"authorized",originalIndex:index}})).concat(suggestions.map((function(url,index){return{url:url,type:"suggestion",originalIndex:index}})));return searchTerm?new fuse_js__WEBPACK_IMPORTED_MODULE_27__.a(urls,{keys:["url"],threshold:.3}).search(searchTerm).map((function(result){return result.item})):urls}],launchUrl:[function(){return[]},function(){return function(url){return appEditorUrl(url,props.actionId,!props.actionId)}}]}}})},4235:function(module,exports,__webpack_require__){(exports=__webpack_require__(48)(!1)).push([module.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.authorized-urls-table .authorized-url-col{display:flex;align-items:center}.authorized-urls-table .authorized-url-col .lemon-tag{margin-left:4px}.authorized-urls-table .authorized-url-col.suggestion{color:#747ea1}.authorized-urls-table .authorized-url-col.authorized{color:var(--success)}.authorized-urls-table .actions-col{display:flex;align-items:center;justify-content:flex-end}",""]),module.exports=exports},4237:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AuthorizedUrlsTable_AuthorizedUrlsTable}));__webpack_require__(416),__webpack_require__(84),__webpack_require__(652);var slicedToArray=__webpack_require__(13),slicedToArray_default=__webpack_require__.n(slicedToArray),react=__webpack_require__(0),react_default=__webpack_require__.n(react),injectStylesIntoStyleTag=__webpack_require__(18),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),AuthorizedUrlsTable=__webpack_require__(4235),AuthorizedUrlsTable_default=__webpack_require__.n(AuthorizedUrlsTable),options={insert:"head",singleton:!1},clsx_m=(injectStylesIntoStyleTag_default()(AuthorizedUrlsTable_default.a,options),AuthorizedUrlsTable_default.a.locals,__webpack_require__(38)),index_esm=__webpack_require__(1),LemonTable=__webpack_require__(243),LemonTag=__webpack_require__(574),CheckCircleFilled=__webpack_require__(565),PlusOutlined=__webpack_require__(2560),EditOutlined=__webpack_require__(2562),DeleteOutlined=__webpack_require__(4103),LemonButton=__webpack_require__(57),input=__webpack_require__(468),es_button=__webpack_require__(141),authorizedUrlsLogic=__webpack_require__(4233),utils=__webpack_require__(10),More=__webpack_require__(518);function AuthorizedUrlsTable_AuthorizedUrlsTable(_ref){var pageKey=_ref.pageKey,actionId=_ref.actionId,logic=Object(authorizedUrlsLogic.c)({actionId:actionId}),_useValues=Object(index_esm.useValues)(logic),appUrlsKeyed=_useValues.appUrlsKeyed,suggestionsLoading=_useValues.suggestionsLoading,searchTerm=_useValues.searchTerm,launchUrl=_useValues.launchUrl,appUrls=_useValues.appUrls,editUrlIndex=_useValues.editUrlIndex,_useActions=Object(index_esm.useActions)(logic),addUrl=_useActions.addUrl,removeUrl=_useActions.removeUrl,setSearchTerm=_useActions.setSearchTerm,updateUrl=_useActions.updateUrl,newUrl=_useActions.newUrl,setEditUrlIndex=_useActions.setEditUrlIndex,columns=[{title:"URLs",dataIndex:"url",key:"url",render:function Render(url,record){var _useState=Object(react.useState)(record.url),_useState2=slicedToArray_default()(_useState,2),urlUpdatingState=_useState2[0],setUrlUpdatingState=_useState2[1],_useState3=Object(react.useState)(""),_useState4=slicedToArray_default()(_useState3,2),errorState=_useState4[0],setErrorState=_useState4[1];Object(react.useEffect)((function(){return setUrlUpdatingState(record.url)}),[record]);var save=function save(){setErrorState(""),urlUpdatingState===authorizedUrlsLogic.a&&removeUrl(record.originalIndex),urlUpdatingState.indexOf("*")>-1&&!urlUpdatingState.match(/^(.*)\*[^\*]*\.[^\*]+\.[^\*]+$/)?setErrorState("You can only wildcard subdomains. If you wildcard the domain or TLD, people might be able to gain access to your PostHog data."):Object(utils.bb)(urlUpdatingState)?appUrls.indexOf(urlUpdatingState)>-1&&appUrls.indexOf(urlUpdatingState,record.originalIndex)!==record.originalIndex&&appUrls.indexOf(urlUpdatingState,record.originalIndex+1)!==record.originalIndex?setErrorState("This URL is already registered."):updateUrl(record.originalIndex,urlUpdatingState):setErrorState("Please type a valid URL or domain.")};return"suggestion"===record.type||url!==authorizedUrlsLogic.a&&editUrlIndex!==record.originalIndex?react_default.a.createElement("div",{className:Object(clsx_m.a)("authorized-url-col",record.type)},"authorized"===record.type&&react_default.a.createElement(CheckCircleFilled.a,{style:{marginRight:4}}),url,"suggestion"===record.type&&react_default.a.createElement(LemonTag.a,null,"Suggestion")):react_default.a.createElement("div",null,react_default.a.createElement("div",{style:{display:"flex"}},react_default.a.createElement(input.a,{value:urlUpdatingState,onChange:function onChange(e){return setUrlUpdatingState(e.target.value)},onPressEnter:save,autoFocus:!0,placeholder:"Enter a URL or wildcard subdomain (e.g. https://*.posthog.com)"}),react_default.a.createElement(es_button.a,{type:"primary",onClick:save},"Save")),errorState&&react_default.a.createElement("span",{className:"text-small text-danger"},errorState))}},{title:"",key:"actions",render:function Render(_,record,index){return react_default.a.createElement("div",{className:"actions-col"},"suggestion"===record.type?react_default.a.createElement(LemonButton.a,{type:"default",onClick:function onClick(){return addUrl(record.url)}},react_default.a.createElement(PlusOutlined.a,null)," Add as authorized"):react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("a",{href:launchUrl(record.url),style:{marginRight:4}},react_default.a.createElement(LemonButton.a,{type:"highlighted"},"Launch toolbar")),react_default.a.createElement(More.a,{overlay:react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(LemonButton.a,{fullWidth:!0,type:"stealth",onClick:function onClick(){return setEditUrlIndex(record.originalIndex)}},react_default.a.createElement(EditOutlined.a,{style:{marginRight:4}}),"Edit authorized URL"),react_default.a.createElement(LemonButton.a,{fullWidth:!0,style:{color:"var(--danger)"},type:"stealth",onClick:function onClick(){return removeUrl(index)}},react_default.a.createElement(DeleteOutlined.a,{style:{marginRight:4}}),"Remove authorized URL"))})))}}];return react_default.a.createElement("div",null,react_default.a.createElement("div",{className:"flex-center mb"},react_default.a.createElement("div",{style:{flexGrow:1}},react_default.a.createElement(input.a.Search,{allowClear:!0,enterButton:!0,placeholder:"Search for authorized URLs",style:{maxWidth:480},value:searchTerm,onChange:function onChange(e){setSearchTerm(e.target.value)},autoFocus:"toolbar-launch"===pageKey&&!Object(utils.V)()})),react_default.a.createElement(es_button.a,{type:"primary",icon:react_default.a.createElement(PlusOutlined.a,null),onClick:newUrl},"Add","toolbar-launch"===pageKey&&" authorized domain")),react_default.a.createElement(LemonTable.a,{className:"authorized-urls-table",columns:columns,dataSource:appUrlsKeyed,emptyState:searchTerm?"There are no authorized URLs that match your search.":"There are no authorized URLs or domains. Add one to get started.",loading:suggestionsLoading}))}try{AuthorizedUrlsTable_AuthorizedUrlsTable.displayName="AuthorizedUrlsTable",AuthorizedUrlsTable_AuthorizedUrlsTable.__docgenInfo={description:"",displayName:"AuthorizedUrlsTable",props:{pageKey:{defaultValue:null,description:"",name:"pageKey",required:!1,type:{name:"string"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"]={docgenInfo:AuthorizedUrlsTable_AuthorizedUrlsTable.__docgenInfo,name:"AuthorizedUrlsTable",path:"frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"})}catch(__react_docgen_typescript_loader_error){}},4734:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Action",(function(){return Action}));var react=__webpack_require__(0),react_default=__webpack_require__.n(react),toConsumableArray=(__webpack_require__(193),__webpack_require__(209),__webpack_require__(41),__webpack_require__(61),__webpack_require__(34),__webpack_require__(63),__webpack_require__(15)),toConsumableArray_default=__webpack_require__.n(toConsumableArray),defineProperty=__webpack_require__(3),defineProperty_default=__webpack_require__.n(defineProperty),slicedToArray=__webpack_require__(13),slicedToArray_default=__webpack_require__.n(slicedToArray),utils=__webpack_require__(10),Link=__webpack_require__(56),index_esm=__webpack_require__(1),regenerator=(__webpack_require__(45),__webpack_require__(906),__webpack_require__(40),__webpack_require__(84),__webpack_require__(217),__webpack_require__(50),__webpack_require__(7)),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(67),__webpack_require__(12)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),api=__webpack_require__(22),react_toastify=__webpack_require__(69),actionsModel=__webpack_require__(266);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var actionEditLogic=Object(index_esm.kea)({path:function path(key){return["scenes","actions","actionEditLogic",key]},props:{},key:function key(props){return props.id||"new"},actions:function actions(){return{saveAction:!0,setAction:function setAction(action){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{merge:!0};return{action:action,options:options}},setCreateNew:function setCreateNew(createNew){return{createNew:createNew}},actionAlreadyExists:function actionAlreadyExists(actionId){return{actionId:actionId}}}},reducers:function reducers(){return{errorActionId:[null,{saveAction:function saveAction(){return null},actionAlreadyExists:function actionAlreadyExists(_,_ref){return _ref.actionId}}],createNew:[!1,{setCreateNew:function setCreateNew(_,_ref2){return _ref2.createNew}}]}},loaders:function loaders(_ref3){var _saveAction,_loadActionCount,props=_ref3.props,values=_ref3.values,actions=_ref3.actions;return{actionCount:{loadActionCount:(_loadActionCount=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!props.id){_context.next=6;break}return _context.next=3,api.a.actions.getCount(props.id);case 3:_context.t0=_context.sent,_context.next=7;break;case 6:_context.t0=0;case 7:return _context.abrupt("return",_context.t0);case 8:case"end":return _context.stop()}}),_callee)}))),function loadActionCount(){return _loadActionCount.apply(this,arguments)})},action:[props.action,{setAction:function setAction(_ref4){var action=_ref4.action;return _ref4.options.merge?_objectSpread(_objectSpread({},values.action),action):action},saveAction:(_saveAction=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(){var action;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if((action=Object.assign({},values.action)).steps=action.steps?action.steps.filter((function(step){return step.event})):[],_context2.prev=2,!action.id){_context2.next=9;break}return _context2.next=6,api.a.actions.update(action.id,action,props.temporaryToken);case 6:action=_context2.sent,_context2.next=12;break;case 9:return _context2.next=11,api.a.actions.create(action,props.temporaryToken);case 11:action=_context2.sent;case 12:_context2.next=22;break;case 14:if(_context2.prev=14,_context2.t0=_context2.catch(2),"unique"!==_context2.t0.code){_context2.next=21;break}return actions.actionAlreadyExists(_context2.t0.detail.split(" ").pop()),_context2.abrupt("return",action);case 21:throw _context2.t0;case 22:return Object(react_toastify.c)("Action saved"),props.onSave(action),actionsModel.a.actions.loadActions(),_context2.abrupt("return",action);case 26:case"end":return _context2.stop()}}),_callee2,null,[[2,14]])}))),function saveAction(){return _saveAction.apply(this,arguments)})}]}},events:function events(_ref5){var _afterMount,actions=_ref5.actions,props=_ref5.props;return{afterMount:(_afterMount=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(){return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:props.id?actions.loadActionCount():actions.setAction({name:"",steps:[{isNew:Object(utils.Cb)()}]},{merge:!1});case 1:case"end":return _context3.stop()}}),_callee3)}))),function afterMount(){return _afterMount.apply(this,arguments)})}}}),EventName=(__webpack_require__(911),__webpack_require__(2427)),teamLogic=__webpack_require__(26),es_button=__webpack_require__(141),modal=__webpack_require__(1248),AuthorizedUrlsTable=__webpack_require__(4237),authorizedUrlsLogic=__webpack_require__(4233);function AppEditorLink(_ref){var _currentTeam$app_urls,actionId=_ref.actionId,style=_ref.style,children=_ref.children,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),modalOpen=_useState2[0],setModalOpen=_useState2[1],currentTeam=Object(index_esm.useValues)(teamLogic.a).currentTeam;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(es_button.a,{href:Object(authorizedUrlsLogic.b)(null==currentTeam||null===(_currentTeam$app_urls=currentTeam.app_urls)||void 0===_currentTeam$app_urls?void 0:_currentTeam$app_urls[0],actionId),style:style,size:"small",onClick:function onClick(e){e.preventDefault(),setModalOpen(!0)}},children),react_default.a.createElement(modal.a,{visible:modalOpen,title:actionId?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:react_default.a.createElement(es_button.a,{onClick:function onClick(){return setModalOpen(!1)}},"Close"),onCancel:function onCancel(){return setModalOpen(!1)}},react_default.a.createElement(AuthorizedUrlsTable.a,{actionId:actionId,pageKey:"app-editor-link"})))}try{AppEditorLink.displayName="AppEditorLink",AppEditorLink.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:AppEditorLink.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(__react_docgen_typescript_loader_error){}var PropertyFilters=__webpack_require__(187),Tooltip=__webpack_require__(44),hints=__webpack_require__(1620),typography=__webpack_require__(2566),col=__webpack_require__(242),card=__webpack_require__(4154),input=__webpack_require__(468),space=__webpack_require__(4110),es_radio=__webpack_require__(1221),ExportOutlined=__webpack_require__(4231),InfoCircleOutlined=__webpack_require__(639);function ActionStep_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function ActionStep_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ActionStep_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ActionStep_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var Text=typography.a.Text,learnMoreLink="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function ActionStep(_ref){var step=_ref.step,actionId=_ref.actionId,isOnlyStep=_ref.isOnlyStep,index=_ref.index,identifier=_ref.identifier,onDelete=_ref.onDelete,onChange=_ref.onChange,sendStep=function sendStep(stepToSend){onChange(stepToSend)};return react_default.a.createElement(col.a,{span:24,md:12},react_default.a.createElement(card.a,{className:"action-step",style:{overflow:"visible"}},index>0&&react_default.a.createElement("div",{className:"stateful-badge pos-center-end or"},"OR"),react_default.a.createElement("div",null,!isOnlyStep&&react_default.a.createElement("div",{className:"remove-wrapper"},react_default.a.createElement("button",{type:"button","aria-label":"delete",onClick:onDelete},react_default.a.createElement("span",{"aria-hidden":"true"},"Ã—"))),react_default.a.createElement("div",{className:"mb"},react_default.a.createElement("b",null,"Match Group #",index+1)),react_default.a.createElement(TypeSwitcher,{step:step,sendStep:sendStep}),react_default.a.createElement("div",{style:{marginTop:"$pageview"===step.event?20:8,paddingBottom:0}},"$autocapture"===step.event&&react_default.a.createElement(AutocaptureFields,{step:step,sendStep:sendStep,actionId:actionId}),null!=step.event&&"$autocapture"!==step.event&&"$pageview"!==step.event&&react_default.a.createElement("div",{style:{marginTop:"2rem"}},react_default.a.createElement("label",null,react_default.a.createElement("b",null,"Event name: ")),react_default.a.createElement(EventName.a,{value:step.event,onChange:function onChange(value){return sendStep(ActionStep_objectSpread(ActionStep_objectSpread({},step),{},{event:value||""}))}}),react_default.a.createElement("br",null),react_default.a.createElement("small",null,react_default.a.createElement("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer"},"See documentation")," ","on how to send custom events in lots of languages.")),"$pageview"===step.event&&react_default.a.createElement("div",null,react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"url",extra_options:react_default.a.createElement(URLMatching,{step:step,sendStep:sendStep}),label:"URL"}),step.url_matching&&step.url_matching in hints.a&&react_default.a.createElement("small",{style:{display:"block",marginTop:-12}},hints.a[step.url_matching])),step.event&&react_default.a.createElement("div",{className:"property-filters"},react_default.a.createElement("h3",{className:"l3"},"Filters"),(!step.properties||0===step.properties.length)&&react_default.a.createElement("div",{className:"text-muted"},"This match group has no additional filters."),react_default.a.createElement(PropertyFilters.a,{propertyFilters:step.properties,pageKey:identifier,eventNames:step.event?[step.event]:[],onChange:function onChange(properties){sendStep(ActionStep_objectSpread(ActionStep_objectSpread({},step),{},{properties:properties}))},showConditionBadge:!0}))))))}function Option(props){var onOptionChange=function onOptionChange(e){return props.sendStep(ActionStep_objectSpread(ActionStep_objectSpread({},props.step),{},defineProperty_default()({},props.item,e.target.value||null)))};return react_default.a.createElement("div",{className:"mb"},react_default.a.createElement("label",{style:{fontWeight:"bold"}},props.label," ",props.extra_options),props.caption&&react_default.a.createElement("div",{className:"action-step-caption"},props.caption),"selector"===props.item?react_default.a.createElement(input.a.TextArea,{allowClear:!0,onChange:onOptionChange,value:props.step[props.item]||"",placeholder:props.placeholder}):react_default.a.createElement(input.a,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:onOptionChange,value:props.step[props.item]||"",placeholder:props.placeholder}))}function AutocaptureFields(_ref2){var step=_ref2.step,actionId=_ref2.actionId,sendStep=_ref2.sendStep,AndC=function AndC(){return react_default.a.createElement("div",{className:"text-center"},react_default.a.createElement("span",{className:"stateful-badge and"},"AND"))};return react_default.a.createElement("div",null,react_default.a.createElement("span",null,react_default.a.createElement(AppEditorLink,{actionId:actionId,style:{margin:"1rem 0"}},"Select element on site ",react_default.a.createElement(ExportOutlined.a,null)),react_default.a.createElement("a",{href:"".concat(learnMoreLink,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8}},"See documentation.")," "),react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"href",label:"Link target equals",caption:react_default.a.createElement(react_default.a.Fragment,null,"If your element is a link, the location that the link opens (",react_default.a.createElement("code",null,"href")," tag)")}),react_default.a.createElement(AndC,null),react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"text",label:"Text equals",caption:"Text content inside your element"}),react_default.a.createElement(AndC,null),react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"selector",label:react_default.a.createElement(react_default.a.Fragment,null,"HTML selector matches",react_default.a.createElement(Tooltip.a,{title:"Click here to learn more about supported selectors"},react_default.a.createElement("a",{href:"".concat(learnMoreLink,"#matching-selectors"),target:"_blank",rel:"noopener"},react_default.a.createElement(InfoCircleOutlined.a,{style:{marginLeft:4}})))),placeholder:'button[data-attr="my-id"]',caption:react_default.a.createElement(space.b,{direction:"vertical"},react_default.a.createElement(Text,{style:{color:"var(--muted)"}},"CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",react_default.a.createElement(Text,{code:!0},'[data-attr="signup"]')))}),react_default.a.createElement("div",{style:{marginBottom:18}},react_default.a.createElement(AndC,null)),react_default.a.createElement(Option,{step:step,sendStep:sendStep,item:"url",extra_options:react_default.a.createElement(URLMatching,{step:step,sendStep:sendStep}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(null==step?void 0:step.url_matching)&&step.url_matching in hints.a&&react_default.a.createElement("small",{style:{display:"block",marginTop:-12}},hints.a[step.url_matching]))}function TypeSwitcher(_ref3){var step=_ref3.step,sendStep=_ref3.sendStep;return react_default.a.createElement("div",{className:"type-switcher".concat(void 0===step.event?" unselected":"")},react_default.a.createElement(es_radio.a.Group,{buttonStyle:"solid",onChange:function handleChange(e){var type=e.target.value;"$autocapture"===type?sendStep(ActionStep_objectSpread(ActionStep_objectSpread({},step),{},{event:"$autocapture"})):"event"===type?sendStep(ActionStep_objectSpread(ActionStep_objectSpread({},step),{},{event:""})):"$pageview"===type&&sendStep(ActionStep_objectSpread(ActionStep_objectSpread({},step),{},{event:"$pageview",url:step.url}))},value:"$autocapture"===step.event||"$pageview"===step.event||void 0===step.event?step.event:"event"},react_default.a.createElement(es_radio.a.Button,{value:"$autocapture"},"Autocapture"),react_default.a.createElement(es_radio.a.Button,{value:"event"},"Custom event"),react_default.a.createElement(es_radio.a.Button,{value:"$pageview"},"Page view")))}function URLMatching(_ref4){var step=_ref4.step,sendStep=_ref4.sendStep;return react_default.a.createElement(es_radio.a.Group,{buttonStyle:"solid",onChange:function handleURLMatchChange(e){sendStep(ActionStep_objectSpread(ActionStep_objectSpread({},step),{},{url_matching:e.target.value}))},value:step.url_matching||"contains",size:"small"},react_default.a.createElement(es_radio.a.Button,{value:"contains"},"contains"),react_default.a.createElement(es_radio.a.Button,{value:"regex"},"matches regex"),react_default.a.createElement(es_radio.a.Button,{value:"exact"},"matches exactly"))}try{ActionStep.displayName="ActionStep",ActionStep.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:ActionStep.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(__react_docgen_typescript_loader_error){}var row=__webpack_require__(260),DeleteOutlined=__webpack_require__(4103),LoadingOutlined=__webpack_require__(348),PlusOutlined=__webpack_require__(2560),SaveOutlined=__webpack_require__(4211),lib=__webpack_require__(27),PageHeader=__webpack_require__(208),urls=__webpack_require__(19),EditableField=__webpack_require__(456),types=__webpack_require__(4),userLogic=__webpack_require__(65),ObjectTags=__webpack_require__(346);function ActionEdit_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function ActionEdit_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ActionEdit_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ActionEdit_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function ActionEdit(_ref){var _action$tags,_action$steps,loadedAction=_ref.action,id=_ref.id,_onSave=_ref.onSave,temporaryToken=_ref.temporaryToken,logic=actionEditLogic({id:id,action:loadedAction,onSave:function onSave(action){return _onSave(action)},temporaryToken:temporaryToken}),_useValues=Object(index_esm.useValues)(logic),action=_useValues.action,actionLoading=_useValues.actionLoading,errorActionId=_useValues.errorActionId,actionCount=_useValues.actionCount,actionCountLoading=_useValues.actionCountLoading,_useActions=Object(index_esm.useActions)(logic),setAction=_useActions.setAction,saveAction=_useActions.saveAction,loadActions=Object(index_esm.useActions)(actionsModel.a).loadActions,currentTeam=Object(index_esm.useValues)(teamLogic.a).currentTeam,hasAvailableFeature=Object(index_esm.useValues)(userLogic.a).hasAvailableFeature,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),edited=_useState2[0],setEdited=_useState2[1],slackEnabled=null==currentTeam?void 0:currentTeam.slack_incoming_webhook;function addMatchGroup(){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{steps:[].concat(toConsumableArray_default()(action.steps||[]),[{isNew:Object(utils.Cb)()}])}))}var addGroup=react_default.a.createElement(es_button.a,{onClick:addMatchGroup,size:"small"},"Add another match group"),deleteAction=id?react_default.a.createElement(es_button.a,{"data-attr":"delete-action",danger:!0,icon:react_default.a.createElement(DeleteOutlined.a,null),onClick:function onClick(){Object(utils.v)({endpoint:api.a.actions.determineDeleteEndpoint(),object:action,callback:function callback(){lib.router.actions.push("/events/actions"),loadActions()}})}},"Delete"):void 0;return react_default.a.createElement("div",{className:"action-edit-container"},react_default.a.createElement(PageHeader.a,{title:react_default.a.createElement(EditableField.a,{name:"name",value:action.name||"",placeholder:"Name this action",onChange:function onChange(name){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{name:name})),setEdited(!!name)},mode:id?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(id?"edit":"create"),saveButtonText:"Set"}),caption:react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(EditableField.a,{multiline:!0,name:"description",value:action.description||"",placeholder:"Description (optional)",onSave:function onSave(description){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{description:description})),setEdited(!!description)},mode:id?void 0:"edit",autoFocus:!!id,"data-attr":"action-description",compactButtons:!0,maxLength:600,paywall:!hasAvailableFeature(types.c.INGESTION_TAXONOMY),saveButtonText:"Set"}),hasAvailableFeature(types.c.TAGGING)&&react_default.a.createElement(ObjectTags.a,{tags:null!==(_action$tags=action.tags)&&void 0!==_action$tags?_action$tags:[],onChange:function onChange(_,tags){return setAction({tags:tags})},className:"action-tags",saving:actionLoading})),buttons:deleteAction}),react_default.a.createElement("form",{onSubmit:function onSubmit(e){e.preventDefault(),saveAction()}},id&&react_default.a.createElement("div",{className:"input-set"},react_default.a.createElement("div",null,react_default.a.createElement("span",{className:"text-muted mb-05"},actionCountLoading&&react_default.a.createElement(LoadingOutlined.a,null),null!==actionCount&&actionCount>-1&&react_default.a.createElement(react_default.a.Fragment,null,"This action matches ",react_default.a.createElement("b",null,Object(utils.q)(actionCount))," events in the last 3 months")))),react_default.a.createElement("div",{className:"match-group-section",style:{overflow:"visible"}},react_default.a.createElement("h2",{className:"subtitle"},"Match groups"),react_default.a.createElement("div",null,"Your action will be triggered whenever ",react_default.a.createElement("b",null,"any of your match groups")," are received."," ",react_default.a.createElement("a",{href:"https://posthog.com/docs/features/actions",target:"_blank"},react_default.a.createElement(InfoCircleOutlined.a,null))),react_default.a.createElement("div",{style:{textAlign:"right",marginBottom:12}},addGroup),react_default.a.createElement(row.a,{gutter:[24,24]},null===(_action$steps=action.steps)||void 0===_action$steps?void 0:_action$steps.map((function(step,index){return react_default.a.createElement(ActionStep,{key:step.id||step.isNew,identifier:String(step.id||step.isNew),index:index,step:step,actionId:action.id||0,isOnlyStep:!!action.steps&&1===action.steps.length,onDelete:function onDelete(){var _action$steps2,identifier=step.id?"id":"isNew";setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{steps:null===(_action$steps2=action.steps)||void 0===_action$steps2?void 0:_action$steps2.filter((function(s){return s[identifier]!==step[identifier]}))})),setEdited(!0)},onChange:function onChange(newStep){var _action$steps3;setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{steps:null===(_action$steps3=action.steps)||void 0===_action$steps3?void 0:_action$steps3.map((function(s){return step.id&&s.id==step.id||step.isNew&&s.isNew===step.isNew?ActionEdit_objectSpread({id:step.id,isNew:step.isNew},newStep):s}))})),setEdited(!0)}})})),react_default.a.createElement(col.a,{span:24,md:12},react_default.a.createElement("div",{className:"match-group-add-skeleton",onClick:addMatchGroup},react_default.a.createElement(PlusOutlined.a,{style:{fontSize:28,color:"#666666"}}))))),react_default.a.createElement("div",null,react_default.a.createElement("div",{style:{margin:"1rem 0"}},react_default.a.createElement("p",null,react_default.a.createElement("input",{id:"webhook-checkbox",type:"checkbox",onChange:function onChange(e){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{post_to_slack:e.target.checked})),setEdited(!0)},checked:!!action.post_to_slack,disabled:!slackEnabled}),react_default.a.createElement("label",{className:slackEnabled?"":"disabled",style:{marginLeft:"0.5rem",marginBottom:"0.5rem"},htmlFor:"webhook-checkbox"},"Post to webhook when this action is triggered.")," ",react_default.a.createElement(Link.a,{to:"/project/settings#webhook"},slackEnabled?"Configure":"Enable"," this integration in Setup.")),action.post_to_slack&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(input.a,{addonBefore:"Message format (optional)",placeholder:"Default: [action.name] triggered by [user.name]",value:action.slack_message_format,onChange:function onChange(e){setAction(ActionEdit_objectSpread(ActionEdit_objectSpread({},action),{},{slack_message_format:e.target.value})),setEdited(!0)},disabled:!slackEnabled||!action.post_to_slack,"data-attr":"edit-slack-message-format"}),react_default.a.createElement("small",null,react_default.a.createElement("a",{href:"https://posthog.com/docs/integrations/message-formatting/",target:"_blank",rel:"noopener noreferrer"},"See documentation on how to format webhook messages."))))),errorActionId&&react_default.a.createElement("p",{className:"text-danger"},"Action with this name already exists."," ",react_default.a.createElement("a",{href:urls.a.action(errorActionId)},"Click here to edit.")),react_default.a.createElement("div",{className:"float-right"},react_default.a.createElement("span",{"data-attr":"delete-action-bottom"},deleteAction),react_default.a.createElement(es_button.a,{disabled:!edited||!action.name,"data-attr":"save-action-button",type:"primary",icon:react_default.a.createElement(SaveOutlined.a,null),onClick:saveAction,style:{marginLeft:16}},"Save action"))))}try{ActionEdit.displayName="ActionEdit",ActionEdit.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:ActionEdit.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(__react_docgen_typescript_loader_error){}var eventsTableLogic=__webpack_require__(918),scenes_events=__webpack_require__(1745),dayjs=__webpack_require__(35),Spinner=__webpack_require__(175),actionLogic=Object(index_esm.kea)({props:{},key:function key(props){return props.id||"new"},path:function path(key){return["scenes","actions","actionLogic",key]},actions:function actions(){return{checkIsFinished:function checkIsFinished(action){return{action:action}},setPollTimeout:function setPollTimeout(pollTimeout){return{pollTimeout:pollTimeout}},setIsComplete:function setIsComplete(isComplete){return{isComplete:isComplete}}}},reducers:function reducers(){return{pollTimeout:[null,{setPollTimeout:function setPollTimeout(_,_ref){return _ref.pollTimeout}}],isComplete:[!1,{setIsComplete:function setIsComplete(_,_ref2){return _ref2.isComplete}}]}},selectors:{breadcrumbs:[function(s){return[s.action]},function(action){return[{name:"Events & Actions",path:urls.a.actions()},{name:(null==action?void 0:action.name)||"Unnamed",path:action?urls.a.action(action.id):void 0}]}]},loaders:function loaders(_ref3){var _loadAction,actions=_ref3.actions,props=_ref3.props;return{action:{loadAction:(_loadAction=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var action;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(actions.setIsComplete(!1),props.id){_context.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return _context.next=5,api.a.actions.get(props.id);case 5:return action=_context.sent,actions.checkIsFinished(action),_context.abrupt("return",action);case 8:case"end":return _context.stop()}}),_callee)}))),function loadAction(){return _loadAction.apply(this,arguments)})}}},listeners:function listeners(_ref4){var actions=_ref4.actions,props=_ref4.props,values=_ref4.values;return{checkIsFinished:function checkIsFinished(_ref5){_ref5.action.is_calculating?actions.setPollTimeout(setTimeout((function(){return actions.loadAction()}),1e3)):(props.onComplete(),actions.setIsComplete(new Date),values.pollTimeout&&clearTimeout(values.pollTimeout))}}},events:function events(_ref6){var values=_ref6.values,actions=_ref6.actions,props=_ref6.props;return{afterMount:function afterMount(){props.id&&actions.loadAction()},beforeUnmount:function beforeUnmount(){values.pollTimeout&&clearTimeout(values.pollTimeout)}}}}),scene={logic:actionLogic,component:Action,paramsToProps:function paramsToProps(_ref){var id=_ref.params.id;return{id:parseInt(id),onComplete:function onComplete(){}}}};function Action(){var _ref2=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},id=_ref2.id,fixedFilters={action_id:id},_useActions=Object(index_esm.useActions)(lib.router),push=_useActions.push,_useActions2=Object(index_esm.useActions)(Object(eventsTableLogic.a)({fixedFilters:fixedFilters,sceneUrl:id?urls.a.action(id):urls.a.actions(),key:"Action",disableActions:!0})),fetchEvents=_useActions2.fetchEvents,_useValues=Object(index_esm.useValues)(actionLogic({id:id,onComplete:fetchEvents})),action=_useValues.action,isComplete=_useValues.isComplete,_useActions3=Object(index_esm.useActions)(actionLogic({id:id,onComplete:fetchEvents})),loadAction=_useActions3.loadAction;return react_default.a.createElement(react_default.a.Fragment,null,(!id||action)&&react_default.a.createElement(ActionEdit,{id:id,action:action,onSave:function onSave(savedAction){id||push(urls.a.action(savedAction.id)),loadAction()}}),id&&!isComplete&&react_default.a.createElement("div",{style:{marginBottom:"10rem"}},react_default.a.createElement("h2",{className:"subtitle"},"Events"),react_default.a.createElement("div",{className:"flex-center"},react_default.a.createElement(Spinner.a,{style:{marginRight:12}}),"Calculating action, please hold on.")),isComplete&&id&&react_default.a.createElement("div",{style:{marginTop:"4rem"}},react_default.a.createElement("h2",{className:"subtitle"},"Matching events"),react_default.a.createElement("p",null,"This is the list of ",react_default.a.createElement("strong",null,"recent")," events that match this action.",(null==action?void 0:action.last_calculated_at)?react_default.a.createElement(react_default.a.Fragment,null," ","Last calculated: ",react_default.a.createElement("b",null,Object(dayjs.a)(action.last_calculated_at).fromNow()),"."):""),react_default.a.createElement(scenes_events.b,{fixedFilters:fixedFilters,sceneUrl:urls.a.action(id),fetchMonths:3,pageKey:"Action"})))}try{Action.displayName="Action",Action.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:Action.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(__react_docgen_typescript_loader_error){}}}]);