"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[35218],{"./products/llm_observability/frontend/LLMObservabilityTraceScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMObservabilityTraceScene:()=>LLMObservabilityTraceScene,scene:()=>scene});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),classnames=__webpack_require__("./node_modules/.pnpm/classnames@2.5.1/node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),EmptyStates=__webpack_require__("./frontend/src/scenes/insights/EmptyStates/index.ts"),PersonDisplay=__webpack_require__("./frontend/src/scenes/persons/PersonDisplay.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),dataNodeLogic=__webpack_require__("./frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),ConversationMessagesDisplay=__webpack_require__("./products/llm_observability/frontend/ConversationDisplay/ConversationMessagesDisplay.tsx"),MetadataHeader=__webpack_require__("./products/llm_observability/frontend/ConversationDisplay/MetadataHeader.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function ParametersHeader(_ref){let{eventProperties}=_ref;return(0,jsx_runtime.jsx)("div",{className:"flex flex-row flex-wrap gap-2",children:eventProperties.$ai_model_parameters&&Object.entries(eventProperties.$ai_model_parameters).map(_ref2=>{let[key,value]=_ref2;return null!==value&&(0,jsx_runtime.jsxs)(src.oe,{type:"muted",children:[key,": ",`${value}`]},key)})})}var lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.2.0_kea@3.1.5/node_modules/kea-router/lib/index.js"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),InsightViz=__webpack_require__("./frontend/src/queries/nodes/InsightViz/InsightViz.tsx"),schema=__webpack_require__("./frontend/src/queries/schema.json");let llmObservabilityTraceLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","llm-observability","llmObservabilityTraceLogic"]),(0,index_esm.connect)(()=>({values:[(0,dataNodeLogic.M)({key:"InsightViz.new-AdHoc.DataNode.llm-observability-traces"}),["response as cachedTracesResults"]]})),(0,index_esm.actions)({setTraceId:traceId=>({traceId}),setEventId:eventId=>({eventId}),setDateFrom:dateFrom=>({dateFrom})}),(0,index_esm.reducers)({traceId:["",{setTraceId:(_,_ref2)=>{let{traceId}=_ref2;return traceId}}],eventId:[null,{setEventId:(_,_ref3)=>{let{eventId}=_ref3;return eventId}}],dateFrom:[null,{setDateFrom:(_,_ref4)=>{let{dateFrom}=_ref4;return dateFrom}}]}),(0,index_esm.selectors)({query:[s=>[s.traceId,s.dateFrom],(traceId,dateFrom)=>{let tracesQuery={kind:schema.NodeKind.TracesQuery,traceId,dateRange:dateFrom?{date_from:dateFrom,date_to:(0,dayjs.Bv)(dateFrom).add(10,"minutes").toISOString()}:{date_from:dayjs.Bv.utc(new Date(2025,0,10)).toISOString()}};return{kind:schema.NodeKind.DataTableNode,source:tracesQuery}}],cachedTraceResponse:[s=>[s.cachedTracesResults,s.traceId],(cachedTracesResults,traceId)=>cachedTracesResults?{...cachedTracesResults,results:cachedTracesResults.results.filter(trace=>trace.id===traceId)}:null],breadcrumbs:[s=>[s.traceId],traceId=>[{key:"LLMObservability",name:"Traces",path:urls.j.llmObservability("traces")},{key:["LLMObservability",traceId||""],name:traceId}]]}),(0,lib.urlToAction)(_ref5=>{let{actions}=_ref5;return{[urls.j.llmObservabilityTrace(":id")]:(_ref6,_ref7)=>{let{id}=_ref6,{event,timestamp}=_ref7;actions.setTraceId(null!=id?id:""),actions.setEventId(event||null),actions.setDateFrom(timestamp||null)}}})]);var utils=__webpack_require__("./products/llm_observability/frontend/utils.ts");let scene={component:LLMObservabilityTraceScene,logic:llmObservabilityTraceLogic};function LLMObservabilityTraceScene(){let{traceId,query,eventId,cachedTraceResponse}=(0,index_esm.useValues)(llmObservabilityTraceLogic),{response,responseLoading,responseError}=(0,index_esm.useValues)((0,dataNodeLogic.M)(function(_ref){let{traceId,query,cachedResults}=_ref,insightProps={dashboardItemId:`new-Trace.${traceId}`,dataNodeCollectionId:traceId},vizKey=(0,InsightViz.gG)(insightProps),dataNodeLogicProps={query:query.source,key:vizKey,dataNodeCollectionId:traceId,alwaysRefresh:!1,cachedResults:cachedResults||void 0};return dataNodeLogicProps}({traceId,query,cachedResults:cachedTraceResponse}))),event=(0,react.useMemo)(()=>{let trace=response?.results?.[0];if(trace)return eventId?trace.events.find(event=>event.id===eventId):trace.events[0]},[response,eventId]);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:responseLoading?(0,jsx_runtime.jsx)(src.t2,{}):responseError?(0,jsx_runtime.jsx)(EmptyStates.jC,{}):response&&0!==response.results.length?(0,jsx_runtime.jsxs)("div",{className:"relative pb-4 space-y-4 flex flex-col md:h-[calc(100vh_-_var(--breadcrumbs-height-full)_-_var(--scene-padding)_-_var(--scene-padding-bottom))] ",children:[(0,jsx_runtime.jsx)(TraceMetadata,{trace:response.results[0]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 min-h-0 gap-4 flex-col md:flex-row",children:[(0,jsx_runtime.jsx)(TraceSidebar,{trace:response.results[0],eventId:eventId}),(0,jsx_runtime.jsx)(EventContent,{event:event})]})]}):(0,jsx_runtime.jsx)(NotFound.T,{object:"trace"})})}function Chip(_ref){let{title,children}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium",children:title}),(0,jsx_runtime.jsx)("span",{children:children})]})}function UsageChip(_ref2){let{event}=_ref2,usage=(0,utils.Pz)(event);return usage?(0,jsx_runtime.jsx)(Chip,{title:"Usage",children:usage}):null}function CostChip(_ref3){let{cost,title}=_ref3;return(0,jsx_runtime.jsx)(Chip,{title:title,children:(0,utils.K7)(cost)})}function TraceMetadata(_ref4){let{trace}=_ref4;return(0,jsx_runtime.jsxs)("header",{className:"flex gap-x-8 gap-y-2 flex-wrap border border-border rounded p-4 bg-bg-light text-sm",children:["person"in trace&&(0,jsx_runtime.jsx)(Chip,{title:"Person",children:(0,jsx_runtime.jsx)(PersonDisplay.I,{withIcon:"sm",person:trace.person})}),(0,jsx_runtime.jsx)(UsageChip,{event:trace}),"number"==typeof trace.inputCost&&(0,jsx_runtime.jsx)(CostChip,{cost:trace.inputCost,title:"Input cost"}),"number"==typeof trace.outputCost&&(0,jsx_runtime.jsx)(CostChip,{cost:trace.outputCost,title:"Output cost"}),"number"==typeof trace.totalCost&&(0,jsx_runtime.jsx)(CostChip,{cost:trace.totalCost,title:"Total cost"})]})}function TraceSidebar(_ref5){let{trace,eventId}=_ref5;return(0,jsx_runtime.jsxs)("aside",{className:"border-border h-80 bg-bg-light border rounded overflow-hidden md:h-full md:w-72",children:[(0,jsx_runtime.jsx)("header",{className:"p-2",children:(0,jsx_runtime.jsx)("h2",{className:"font-medium text-base p-0 m-0",children:"Timeline"})}),(0,jsx_runtime.jsx)(src.p2,{className:"m-0"}),(0,jsx_runtime.jsx)("ul",{className:"overflow-y-auto h-full",children:trace.events.map((event,index)=>{let usage=(0,utils.Pz)(event),eventSelected=eventId?eventId===event.id:0===index;return(0,jsx_runtime.jsx)("li",{className:"border-b border-border",children:(0,jsx_runtime.jsxs)(src.rU,{to:urls.j.llmObservabilityTrace(trace.id,{event:event.id,timestamp:(0,utils.sl)(trace.createdAt)}),className:classnames_default()("flex flex-col gap-1 p-2 text-xs hover:bg-primary-highlight",eventSelected&&"bg-primary-highlight"),children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row flex-wrap items-center",children:[(0,jsx_runtime.jsx)(src.oe,{className:"mr-2",children:"Generation"})," ",event.properties.$ai_model," (",event.properties.$ai_provider,")"]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row flex-wrap text-muted items-center gap-2",children:[(0,jsx_runtime.jsx)(src.oe,{type:"muted",children:(0,utils.DB)(event.properties.$ai_latency)}),usage&&(0,jsx_runtime.jsx)("span",{children:usage}),event.properties.$ai_total_cost_usd&&(0,jsx_runtime.jsx)("span",{children:(0,utils.K7)(event.properties.$ai_total_cost_usd)})]})]})},event.id)})})]})}function EventContent(_ref6){let{event}=_ref6;return(0,jsx_runtime.jsx)("div",{className:"flex-1 bg-bg-light border rounded flex flex-col border-border p-4 overflow-y-auto",children:event?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("header",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex-row flex items-center gap-2 mb-4",children:[(0,jsx_runtime.jsx)(src.oe,{type:"muted",children:"Generation"}),(0,jsx_runtime.jsxs)("h3",{className:"text-lg font-medium p-0 m-0",children:[event.properties.$ai_model," (",event.properties.$ai_provider,")"]})]}),(0,jsx_runtime.jsx)(MetadataHeader.I,{eventProperties:event.properties,className:"mb-2"}),(0,jsx_runtime.jsx)(ParametersHeader,{eventProperties:event.properties})]}),(0,jsx_runtime.jsx)(src.p2,{className:"my-4"}),(0,jsx_runtime.jsx)(ConversationMessagesDisplay.F,{eventProperties:event.properties})]}):(0,jsx_runtime.jsx)(EmptyStates.dV,{heading:"Event not found",detail:"Check if the event ID is correct."})})}}}]);