"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[97481,40392],{"../../products/llm_analytics/frontend/LLMAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMAnalyticsScene:()=>LLMAnalyticsScene,scene:()=>scene});var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),QueryCard=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/QueryCard.tsx"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),PropertyFilters=__webpack_require__("../../frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),TestAccountFiltersSwitch=__webpack_require__("../../frontend/src/lib/components/TestAccountFiltersSwitch.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),dataNodeCollectionLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeCollectionLogic.ts"),DataTable=__webpack_require__("../../frontend/src/queries/nodes/DataTable/DataTable.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),utils=__webpack_require__("../../frontend/src/queries/utils.ts"),ConversationMessagesDisplay=__webpack_require__("../../products/llm_analytics/frontend/ConversationDisplay/ConversationMessagesDisplay.tsx"),LLMAnalyticsPlaygroundScene=__webpack_require__("../../products/llm_analytics/frontend/LLMAnalyticsPlaygroundScene.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),llmAnalyticsLogic=__webpack_require__("../../products/llm_analytics/frontend/llmAnalyticsLogic.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let LastRefreshText=()=>{let{newestRefreshed}=(0,index_esm.useValues)(llmAnalyticsLogic.B);return newestRefreshed?(0,jsx_runtime.jsxs)("span",{children:["Last updated ",(0,dayjs.Bv)(newestRefreshed).fromNow()]}):(0,jsx_runtime.jsx)("span",{children:"Refresh"})};function LLMAnalyticsReloadAction(){let{isRefreshing}=(0,index_esm.useValues)(llmAnalyticsLogic.B),{refreshAllDashboardItems}=(0,index_esm.useActions)(llmAnalyticsLogic.B);return(0,jsx_runtime.jsx)("div",{className:"relative",children:(0,jsx_runtime.jsx)(src.Jp,{onClick:refreshAllDashboardItems,type:"secondary",icon:isRefreshing?(0,jsx_runtime.jsx)(Spinner.$,{textColored:!0}):(0,jsx_runtime.jsx)(icons.tr,{}),size:"small",disabledReason:isRefreshing?"Refreshing...":void 0,children:(0,jsx_runtime.jsx)("span",{className:"dashboard-items-action-refresh-text",children:isRefreshing?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Refreshing..."}):(0,jsx_runtime.jsx)(LastRefreshText,{})})})})}var TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),frontend_utils=__webpack_require__("../../products/llm_analytics/frontend/utils.ts");function LLMAnalyticsTraces(){let{setDates,setShouldFilterTestAccounts,setPropertyFilters,setTracesQuery}=(0,index_esm.useActions)(llmAnalyticsLogic.B),{tracesQuery}=(0,index_esm.useValues)(llmAnalyticsLogic.B);return(0,jsx_runtime.jsx)(DataTable.w,{query:{...tracesQuery,showSavedFilters:!0},setQuery:query=>{if(!(0,utils.zO)(query.source))throw Error("Invalid query");setDates(query.source.dateRange?.date_from||null,query.source.dateRange?.date_to||null),setShouldFilterTestAccounts(query.source.filterTestAccounts||!1),setPropertyFilters(query.source.properties||[]),setTracesQuery(query)},context:{emptyStateHeading:"There were no traces in this period",emptyStateDetail:"Try changing the date range or filters.",columns:{id:{title:"ID",render:IDColumn},inputState:{title:"Input message",render:InputMessageColumn},outputState:{title:"Output message",render:OutputMessageColumn},timestamp:{title:"Time",render:TimestampColumn},traceName:{title:"Trace Name",render:TraceNameColumn},person:{title:"Person"},totalLatency:{title:"Latency",render:LatencyColumn},usage:{title:"Token Usage",render:UsageColumn},totalCost:{title:"Total Cost",render:CostColumn}}},uniqueKey:"llm-analytics-traces"})}let IDColumn=_ref=>{let{record}=_ref;return(0,jsx_runtime.jsx)("strong",{children:(0,jsx_runtime.jsx)(Tooltip.u,{title:record.id,children:(0,jsx_runtime.jsxs)(Link.r,{className:"ph-no-capture",to:urls.j.llmAnalyticsTrace(record.id,{timestamp:(0,frontend_utils.sl)(record.createdAt)}),children:[record.id.slice(0,4),"...",record.id.slice(-4)]})})})},TraceNameColumn=_ref2=>{let{record}=_ref2;return(0,jsx_runtime.jsx)("strong",{children:(0,jsx_runtime.jsx)(Link.r,{className:"ph-no-capture",to:urls.j.llmAnalyticsTrace(record.id,{timestamp:(0,frontend_utils.sl)(record.createdAt)}),children:record.traceName||"–"})})},TimestampColumn=_ref3=>{let{record}=_ref3;return(0,jsx_runtime.jsx)(TZLabel.w,{time:record.createdAt})};TimestampColumn.displayName="TimestampColumn";let LatencyColumn=_ref4=>{let{record}=_ref4;return"number"==typeof record.totalLatency?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,frontend_utils.DB)(record.totalLatency,!0)}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})};LatencyColumn.displayName="LatencyColumn";let UsageColumn=_ref5=>{let{record}=_ref5,usage=(0,frontend_utils.Pz)(record);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:usage||"–"})};UsageColumn.displayName="UsageColumn";let CostColumn=_ref6=>{let{record}=_ref6;return"number"==typeof record.totalCost?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,frontend_utils.K7)(record.totalCost)}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})};CostColumn.displayName="CostColumn";let InputMessageColumn=_ref7=>{let{record}=_ref7,inputNormalized=(0,frontend_utils.VL)(record.inputState?.messages,"user");return inputNormalized.length?(0,jsx_runtime.jsx)(ConversationMessagesDisplay.qb,{message:inputNormalized.at(-1),isOutput:!1,minimal:!0}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})};InputMessageColumn.displayName="InputMessageColumn";let OutputMessageColumn=_ref8=>{let{record}=_ref8,errorEventFound=!!Array.isArray(record.events)&&record.events.find(e=>e.properties?.$ai_error||e.properties?.$ai_is_error);if(errorEventFound)return(0,jsx_runtime.jsx)(src.oe,{type:"danger",className:"font-mono max-w-50 truncate",children:errorEventFound.properties?.$ai_error||"Unknown error"});let outputNormalized=(0,frontend_utils.VL)(record.outputState?.messages,"assistant");return outputNormalized.length?(0,jsx_runtime.jsx)(ConversationMessagesDisplay.qb,{message:outputNormalized.at(-1),isOutput:!0,minimal:!0}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})};OutputMessageColumn.displayName="OutputMessageColumn";var LLMAnalyticsUsers=__webpack_require__("../../products/llm_analytics/frontend/LLMAnalyticsUsers.tsx"),LLMAnalyticsDatasetsScene=__webpack_require__("../../products/llm_analytics/frontend/datasets/LLMAnalyticsDatasetsScene.tsx");let scene={component:LLMAnalyticsScene,logic:llmAnalyticsLogic.B},Filters=()=>{let{dashboardDateFilter,dateFilter,shouldFilterTestAccounts,generationsQuery,propertyFilters,activeTab}=(0,index_esm.useValues)(llmAnalyticsLogic.B),{setDates,setShouldFilterTestAccounts,setPropertyFilters}=(0,index_esm.useActions)(llmAnalyticsLogic.B),dateFrom="dashboard"===activeTab?dashboardDateFilter.dateFrom:dateFilter.dateFrom,dateTo="dashboard"===activeTab?dashboardDateFilter.dateTo:dateFilter.dateTo;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-4 gap-y-2 items-center flex-wrap py-4 -mt-4 mb-4 border-b",children:[(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:dateFrom,dateTo:dateTo,onChange:setDates}),(0,jsx_runtime.jsx)(PropertyFilters.t,{propertyFilters:propertyFilters,taxonomicGroupTypes:generationsQuery.showPropertyFilter,onChange:setPropertyFilters,pageKey:"llm-analytics"}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:shouldFilterTestAccounts,onChange:setShouldFilterTestAccounts}),(0,jsx_runtime.jsx)(LLMAnalyticsReloadAction,{})]})},Tiles=()=>{let{tiles}=(0,index_esm.useValues)(llmAnalyticsLogic.B);return(0,jsx_runtime.jsx)("div",{className:"mt-2 grid grid-cols-1 @xl/dashboard:grid-cols-2 @4xl/dashboard:grid-cols-6 gap-4",children:tiles.map((_ref,i)=>{let{title,description,query,context}=_ref;return(0,jsx_runtime.jsx)(QueryCard.w,{attachTo:llmAnalyticsLogic.B,title:title,description:description,query:{kind:schema_general.OH.InsightVizNode,source:query},context:context,sceneSource:"llm-analytics",className:(0,clsx_m.default)("h-96",i<3||i>=5?"@4xl/dashboard:col-span-2":"@4xl/dashboard:col-span-3")},i)})})},IngestionStatusCheck=()=>(0,jsx_runtime.jsxs)(src.Vp,{type:"warning",children:[(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("strong",{children:"No LLM generation events have been detected!"})}),(0,jsx_runtime.jsxs)("p",{children:["To use the LLM Analytics product, please"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/llm-analytics/installation",children:"instrument your LLM calls with the PostHog SDK"})," ","(otherwise it'll be a little empty!)"]})]});function LLMAnalyticsDashboard(){return(0,jsx_runtime.jsxs)("div",{className:"@container/dashboard",children:[(0,jsx_runtime.jsx)(Filters,{}),(0,jsx_runtime.jsx)(Tiles,{})]})}function LLMAnalyticsGenerations(){let{setDates,setShouldFilterTestAccounts,setPropertyFilters,setGenerationsQuery,setGenerationsColumns}=(0,index_esm.useActions)(llmAnalyticsLogic.B),{generationsQuery}=(0,index_esm.useValues)(llmAnalyticsLogic.B);return(0,jsx_runtime.jsx)(DataTable.w,{query:{...generationsQuery,showSavedFilters:!0},setQuery:query=>{if(!(0,utils.rz)(query.source))throw Error("Invalid query");setDates(query.source.after||null,query.source.before||null),setShouldFilterTestAccounts(query.source.filterTestAccounts||!1),setPropertyFilters(query.source.properties||[]),query.source.select&&setGenerationsColumns(query.source.select),setGenerationsQuery(query)},context:{emptyStateHeading:"There were no generations in this period",emptyStateDetail:"Try changing the date range or filters.",columns:{uuid:{title:"ID",render:_ref2=>{let{record,value}=_ref2,traceId=record[1];if(!value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let visualValue=(0,frontend_utils.ol)(value);return traceId?(0,jsx_runtime.jsx)("strong",{children:(0,jsx_runtime.jsx)(Tooltip.u,{title:value,children:(0,jsx_runtime.jsx)(src.rU,{to:`/llm-analytics/traces/${traceId}?event=${value}`,children:visualValue})})}):(0,jsx_runtime.jsx)("strong",{children:visualValue})}},"properties.$ai_input[-1]":{title:"Input",render:_ref3=>{let inputNormalized,{value}=_ref3;if("string"==typeof value)try{inputNormalized=(0,frontend_utils.VL)(JSON.parse(value),"user")}catch(e){console.warn("Error parsing properties.$ai_input[-1] as JSON",e)}return inputNormalized?.length?(0,jsx_runtime.jsx)(ConversationMessagesDisplay.qb,{message:inputNormalized.at(-1),isOutput:!1,minimal:!0}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})}},"properties.$ai_output_choices":{title:"Output",render:_ref4=>{let outputNormalized,{value}=_ref4;if("string"==typeof value)try{outputNormalized=(0,frontend_utils.VL)(JSON.parse(value),"assistant")}catch(e){console.warn("Error parsing properties.$ai_output_choices as JSON",e)}return outputNormalized?.length?(0,jsx_runtime.jsx)("div",{children:outputNormalized.map((message,index)=>(0,jsx_runtime.jsx)(ConversationMessagesDisplay.qb,{message:message,isOutput:!0,minimal:!0},index))}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})}},"properties.$ai_trace_id":{title:"Trace ID",render:_ref5=>{let{value}=_ref5;if(!value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let visualValue=(0,frontend_utils.ol)(value);return(0,jsx_runtime.jsx)(Tooltip.u,{title:value,children:(0,jsx_runtime.jsx)(src.rU,{to:`/llm-analytics/traces/${value}`,children:visualValue})})}}}},uniqueKey:"llm-analytics-generations"})}function LLMAnalyticsNoEvents(){return(0,jsx_runtime.jsx)("div",{className:"w-full flex flex-col items-center justify-center",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center justify-center max-w-md w-full",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconArchive,{className:"text-5xl mb-2 text-muted-alt"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl leading-tight",children:"We haven't detected any LLM generations yet"}),(0,jsx_runtime.jsxs)("p",{className:"text-sm text-center text-balance",children:["To use the LLM Analytics product, please"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/llm-analytics/installation",children:"instrument your LLM calls with the PostHog SDK"})," "]})]})})}function LLMAnalyticsScene(){let{activeTab,hasSentAiGenerationEvent,hasSentAiGenerationEventLoading}=(0,index_esm.useValues)(llmAnalyticsLogic.B),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{searchParams}=(0,index_esm.useValues)(lib.router),tabs=[{key:"dashboard",label:"Dashboard",content:(0,jsx_runtime.jsx)(LLMAnalyticsDashboard,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsDashboard(),searchParams).url},{key:"traces",label:"Traces",content:hasSentAiGenerationEvent?(0,jsx_runtime.jsx)(LLMAnalyticsTraces,{}):(0,jsx_runtime.jsx)(LLMAnalyticsNoEvents,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsTraces(),searchParams).url},{key:"generations",label:"Generations",content:hasSentAiGenerationEvent?(0,jsx_runtime.jsx)(LLMAnalyticsGenerations,{}):(0,jsx_runtime.jsx)(LLMAnalyticsNoEvents,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsGenerations(),searchParams).url},{key:"users",label:"Users",content:hasSentAiGenerationEvent?(0,jsx_runtime.jsx)(LLMAnalyticsUsers.LLMAnalyticsUsers,{}):(0,jsx_runtime.jsx)(LLMAnalyticsNoEvents,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsUsers(),searchParams).url}];return featureFlags[constants.y8.LLM_OBSERVABILITY_PLAYGROUND]&&tabs.push({key:"playground",label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Playground"," ",(0,jsx_runtime.jsx)(src.oe,{className:"ml-1",type:"warning",children:"Beta"})]}),content:(0,jsx_runtime.jsx)(LLMAnalyticsPlaygroundScene.LLMAnalyticsPlaygroundScene,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsPlayground(),searchParams).url}),featureFlags[constants.y8.LLM_ANALYTICS_DATASETS]&&tabs.push({key:"datasets",label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Datasets"," ",(0,jsx_runtime.jsx)(src.oe,{className:"ml-1",type:"warning",children:"Beta"})]}),content:(0,jsx_runtime.jsx)(LLMAnalyticsDatasetsScene.LLMAnalyticsDatasetsScene,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsDatasets(),searchParams).url,"data-attr":"datasets-tab"}),(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeCollectionLogic.y,props:{key:llmAnalyticsLogic.S},children:(0,jsx_runtime.jsxs)(SceneContent._,{children:[!hasSentAiGenerationEventLoading&&!hasSentAiGenerationEvent&&(0,jsx_runtime.jsx)(IngestionStatusCheck,{}),(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:"LLM Analytics",description:"Analyze and understand your LLM usage and performance.",resourceType:{type:"llm_analytics"},actions:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.Jp,{to:"https://posthog.com/docs/llm-analytics/installation",type:"secondary",targetBlank:!0,size:"small",children:"Documentation"})})}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,"data-attr":"llm-analytics-tabs",tabs:tabs,sceneInset:!0})]})})}},"../../products/llm_analytics/frontend/datasets/LLMAnalyticsDatasetsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMAnalyticsDatasetsScene:()=>LLMAnalyticsDatasetsScene,scene:()=>scene});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),lib_lemon_ui_Link__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),lib_lemon_ui_ProfilePicture__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_scenes_components_SceneContent__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),_layout_scenes_components_SceneDivider__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),_layout_scenes_components_SceneTitleSection__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),_lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),_lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),_lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../products/llm_analytics/frontend/datasets/llmAnalyticsDatasetsLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:LLMAnalyticsDatasetsScene,logic:_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.x};function LLMAnalyticsDatasetsScene(){let{setFilters,deleteDataset}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.x),{datasets,datasetsLoading,sorting,pagination,filters,datasetCountLabel}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.x),columns=[{title:"Name",dataIndex:"name",key:"name",width:"20%",render:function renderName(_,dataset){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_Link__WEBPACK_IMPORTED_MODULE_3__.r,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.llmAnalyticsDataset(dataset.id),"data-testid":"dataset-link",children:dataset.name})}},{title:"Description",dataIndex:"description",key:"description",width:"50%",render:function renderDescription(description){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{className:"text-muted",children:description||(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("i",{children:"–"})})}},{title:"Created by",dataIndex:"created_by",render:function renderCreatedBy(_,item){let{created_by}=item;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"flex flex-row items-center flex-nowrap",children:created_by&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_ProfilePicture__WEBPACK_IMPORTED_MODULE_4__.Y,{user:created_by,size:"md",showName:!0})})}},(0,_lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_11__.rw)(),(0,_lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_11__.yI)(),{width:0,render:function renderMore(_,dataset){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_2__.T,{overlay:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.llmAnalyticsDataset(dataset.id),"data-attr":`dataset-item-${dataset.id}-dropdown-view`,fullWidth:!0,children:"View"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{status:"danger",onClick:()=>deleteDataset(dataset.id),"data-attr":`dataset-item-${dataset.id}-dropdown-delete`,fullWidth:!0,children:"Delete"})]})})}}];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_layout_scenes_components_SceneContent__WEBPACK_IMPORTED_MODULE_6__._,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_layout_scenes_components_SceneTitleSection__WEBPACK_IMPORTED_MODULE_8__.s,{name:"Datasets",resourceType:{type:"llm_analytics"},actions:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{type:"primary",to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.llmAnalyticsDataset("new"),"data-testid":"create-dataset-button",size:"small",children:"New dataset"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_layout_scenes_components_SceneDivider__WEBPACK_IMPORTED_MODULE_7__.V,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex gap-x-4 gap-y-2 items-center flex-wrap py-4 -mt-4 mb-4 border-b justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_9__.D,{type:"search",placeholder:"Search datasets...",value:filters.search,onChange:value=>setFilters({search:value}),className:"max-w-md","data-testid":"search-datasets-input"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"text-muted-alt",children:datasetCountLabel})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_10__.g,{loading:datasetsLoading,columns:columns,dataSource:datasets.results,pagination:pagination,noSortingCancellation:!0,sorting:sorting,onSort:newSorting=>setFilters({order_by:newSorting?`${-1===newSorting.order?"-":""}${newSorting.columnKey}`:void 0}),rowKey:"id",loadingSkeletonRows:_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.R,nouns:["dataset","datasets"]})]})}},"../../products/llm_analytics/frontend/datasets/llmAnalyticsDatasetsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>DATASETS_PER_PAGE,x:()=>llmAnalyticsDatasetsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),_lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/api.ts"),_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),_lib_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils.tsx"),_scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/sceneLogic.tsx"),_scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/urls.ts");let DATASETS_PER_PAGE=30;function cleanFilters(values){return{page:parseInt(String(values.page))||1,search:String(values.search||""),order_by:values.order_by||"-created_at"}}let llmAnalyticsDatasetsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","llm-analytics","llmAnalyticsDatasetsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:function(filters){let merge=!(arguments.length>1)||void 0===arguments[1]||arguments[1],debounce=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return{filters,merge,debounce}},loadDatasets:function(){let debounce=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return{debounce}},deleteDataset:datasetId=>({datasetId})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({rawFilters:[null,{setFilters:(state,_ref)=>{let{filters,merge}=_ref;return cleanFilters({...merge&&state||{},...filters,..."page"in filters?{}:{page:1}})}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values}=_ref2;return{datasets:[{results:[],count:0,offset:0},{loadDatasets:async(_ref3,breakpoint)=>{let{debounce}=_ref3;debounce&&values.datasets.results.length>0&&await breakpoint(300);let{filters}=values,params={search:filters.search,order_by:filters.order_by,offset:Math.max(0,(filters.page-1)*DATASETS_PER_PAGE),limit:DATASETS_PER_PAGE};return _scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_6__.k.findMounted()?.values.activeSceneId==="LLMAnalyticsDatasets"&&"POP"!==kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.lastMethod&&values.datasets.results.length>0&&values.rawFilters?.page!==filters.page&&window.scrollTo(0,0),await _lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.datasets.list(params)}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({filters:[s=>[s.rawFilters],rawFilters=>cleanFilters(rawFilters||{})],count:[s=>[s.datasets],datasets=>datasets.count],sorting:[s=>[s.filters],filters=>filters.order_by?filters.order_by.startsWith("-")?{columnKey:filters.order_by.slice(1),order:-1}:{columnKey:filters.order_by,order:1}:{columnKey:"updated_at",order:-1}],pagination:[s=>[s.filters,s.count],(filters,count)=>({controlled:!0,pageSize:DATASETS_PER_PAGE,currentPage:filters.page,entryCount:count})],datasetCountLabel:[s=>[s.filters,s.count],(filters,count)=>{let start=(filters.page-1)*DATASETS_PER_PAGE+1,end=Math.min(filters.page*DATASETS_PER_PAGE,count);return 0===count?"0 datasets":`${start}-${end} of ${count} dataset${1===count?"":"s"}`}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{asyncActions,values,selectors}=_ref4;return{setFilters:async(_ref5,_,__,previousState)=>{let{debounce}=_ref5,oldFilters=selectors.filters(previousState),{filters}=values;(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(oldFilters,filters)||await asyncActions.loadDatasets(debounce)},deleteDataset:async _ref6=>{let{datasetId}=_ref6;try{let datasetName=values.datasets.results.find(dataset=>dataset.id===datasetId)?.name;await _lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.datasets.update(datasetId,{deleted:!0}),_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.info(`${datasetName||"Dataset"} has been deleted.`),await asyncActions.loadDatasets(!1)}catch{_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Failed to delete dataset")}}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.actionToUrl)(_ref7=>{let{values}=_ref7;return{setFilters:()=>{let nextValues=cleanFilters(values.filters),urlValues=cleanFilters(kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.searchParams);if(!(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(nextValues,urlValues))return[_scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.llmAnalyticsDatasets(),nextValues,{},{replace:!1}]}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.urlToAction)(_ref8=>{let{actions,values}=_ref8;return{[_scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.llmAnalyticsDatasets()]:(_,searchParams)=>{let newFilters=cleanFilters(searchParams);null!==values.rawFilters&&(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(values.filters,newFilters)||actions.setFilters(newFilters,!1)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref9=>{let{actions}=_ref9;actions.loadDatasets()})])}}]);