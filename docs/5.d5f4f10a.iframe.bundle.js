(window.webpackJsonp=window.webpackJsonp||[]).push([[5,9,10,309],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(y,E,e){"use strict";e.r(E);var D=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),f=e.n(D),j=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),i=e.n(j),P={};P.insert="head",P.singleton=!1;var v=f()(i.a,P);E.default=i.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(y,E,e){"use strict";e.r(E),e.d(E,"AppMetricsGraph",function(){return C});var D=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),f=e.n(D),j=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=e.n(j),P=e("./node_modules/core-js/modules/es.array.concat.js"),v=e.n(P),K=e("./node_modules/core-js/modules/es.object.keys.js"),Y=e.n(K),U=e("./node_modules/core-js/modules/es.symbol.js"),Z=e.n(U),W=e("./node_modules/core-js/modules/es.array.filter.js"),z=e.n(W),S=e("./node_modules/core-js/modules/es.object.to-string.js"),Q=e.n(S),x=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),X=e.n(x),F=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),w=e.n(F),G=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),k=e.n(G),L=e("./node_modules/react/index.js"),q=e.n(L),H=e("./frontend/src/lib/colors.ts"),$=e("./node_modules/chart.js/dist/chart.mjs"),M=e("./frontend/src/scenes/apps/constants.tsx"),R=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),ee=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),A=e("./frontend/src/lib/utils.tsx"),g=e("./node_modules/react/jsx-runtime.js"),h=e.n(g);function b(l,d){var a=Object.keys(l);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(l);d&&(m=m.filter(function(s){return Object.getOwnPropertyDescriptor(l,s).enumerable})),a.push.apply(a,m)}return a}function B(l){for(var d=1;d<arguments.length;d++){var a=arguments[d]!=null?arguments[d]:{};d%2?b(Object(a),!0).forEach(function(m){f()(l,m,a[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach(function(m){Object.defineProperty(l,m,Object.getOwnPropertyDescriptor(a,m))})}return l}function C(l){var d=l.tab,a=l.metrics,m=l.metricsLoading,s=Object(L.useRef)(null),o=M.DescriptionColumns[d];return Object(L.useEffect)(function(){var r;if(s.current&&a){var t;r=new $.a((t=s.current)===null||t===void 0?void 0:t.getContext("2d"),{type:"line",data:{labels:a.dates,datasets:[B({label:o.successes,data:a.successes,borderColor:""},_("data-brand-blue"))].concat(i()(o.successes_on_retry?[B({label:o.successes_on_retry,data:a.successes_on_retry},_("data-yellow"))]:[]),[B({label:o.failures,data:a.failures},_("data-vermilion"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var n;(n=r)===null||n===void 0||n.destroy()}},[a]),m||!a?Object(g.jsx)(R.a,{className:"AppMetricsGraph border rounded p-6"}):Object(g.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:Object(g.jsx)("canvas",{ref:s})})}function _(l){var d=Object(H.b)(l);return{borderColor:d,hoverBorderColor:Object(A.lb)(d,-20),hoverBackgroundColor:Object(A.lb)(d,-20),backgroundColor:d,fill:!1,borderWidth:2,pointRadius:0}}try{C.displayName="AppMetricsGraph",C.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:C.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(l){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(y,E,e){"use strict";e.r(E),e.d(E,"AppMetricsTab",function(){return _}),e.d(E,"appMetricsSceneLogic",function(){return a});var D=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(D),j=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),i=e.n(j),P=e("./node_modules/@babel/runtime/regenerator/index.js"),v=e.n(P),K=e("./node_modules/core-js/modules/es.array.iterator.js"),Y=e.n(K),U=e("./node_modules/core-js/modules/es.object.to-string.js"),Z=e.n(U),W=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),z=e.n(W),S=e("./node_modules/core-js/modules/es.array.concat.js"),Q=e.n(S),x=e("./node_modules/core-js/modules/es.function.name.js"),X=e.n(x),F=e("./node_modules/core-js/modules/es.array.includes.js"),w=e.n(F),G=e("./node_modules/core-js/modules/es.string.includes.js"),k=e.n(G),L=e("./node_modules/core-js/modules/es.array.filter.js"),q=e.n(L),H=e("./node_modules/core-js/modules/es.number.constructor.js"),$=e.n(H),M=e("./node_modules/kea/lib/index.esm.js"),R=e("./node_modules/kea-loaders/lib/index.js"),ee=e.n(R),A=e("./frontend/src/scenes/urls.ts"),g=e("./frontend/src/lib/api.ts"),h=e("./frontend/src/scenes/teamLogic.tsx"),b=e("./node_modules/kea-router/lib/index.js"),B=e.n(b),C=e("./frontend/src/lib/utils.tsx"),_;(function(s){s.ProcessEvent="processEvent",s.OnEvent="onEvent",s.ExportEvents="exportEvents",s.ScheduledTask="scheduledTask",s.HistoricalExports="historical_exports"})(_||(_={}));var l="-30d",d=[_.ProcessEvent,_.OnEvent,_.ExportEvents,_.ScheduledTask],a=Object(M.kea)([Object(M.path)(function(s){return["scenes","apps","appMetricsSceneLogic",s]}),Object(M.props)({}),Object(M.key)(function(s){return s.pluginConfigId}),Object(M.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}},openErrorDetailsModal:function(o,r,t){return{errorType:o,category:r,jobId:t}},closeErrorDetailsModal:!0}),Object(M.reducers)({activeTab:[null,{setActiveTab:function(o,r){var t=r.tab;return t}}],dateFrom:[l,{setDateFrom:function(o,r){var t=r.dateFrom;return t}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(o,r){var t=r.errorType;return t},closeErrorDetailsModal:function(){return null}}]}),Object(R.loaders)(function(s){var o=s.values,r=s.props;return{pluginConfig:[null,{loadPluginConfig:function(){var t=i()(v.a.mark(function u(){return v.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,g.b.get("api/projects/".concat(h.a.values.currentTeamId,"/plugin_configs/").concat(r.pluginConfigId));case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},u)}));function n(){return t.apply(this,arguments)}return n}()}],appMetricsResponse:[null,{loadMetrics:function(){var t=i()(v.a.mark(function u(){var c;return v.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return c=Object(C.Eb)({category:o.activeTab,date_from:o.dateFrom}),O.next=3,g.b.get("api/projects/".concat(h.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"?").concat(c));case 3:return O.abrupt("return",O.sent);case 4:case"end":return O.stop()}},u)}));function n(){return t.apply(this,arguments)}return n}()}],historicalExports:[[],{loadHistoricalExports:function(){var t=i()(v.a.mark(function u(){var c,p;return v.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,g.b.get("api/projects/".concat(h.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/historical_exports"));case 2:return c=T.sent,p=c.results,T.abrupt("return",p);case 5:case"end":return T.stop()}},u)}));function n(){return t.apply(this,arguments)}return n}()}],errorDetails:[[],{openErrorDetailsModal:function(){var t=i()(v.a.mark(function u(c){var p,O,T,N,V,J;return v.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return p=c.category,O=c.jobId,T=c.errorType,N=Object(C.Eb)({category:p,job_id:O,error_type:T}),I.next=4,g.b.get("api/projects/".concat(h.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/error_details?").concat(N));case 4:return V=I.sent,J=V.result,I.abrupt("return",J);case 7:case"end":return I.stop()}},u)}));function n(u){return t.apply(this,arguments)}return n}()}]}}),Object(M.selectors)(function(s){var o=s.values;return{breadcrumbs:[function(r){return[r.pluginConfig,function(t,n){return n.pluginConfigId}]},function(r,t){var n;return[{name:"Apps",path:A.a.projectApps()},{name:r==null||(n=r.plugin_info)===null||n===void 0?void 0:n.name,path:A.a.appMetrics(t)}]}],showTab:[function(){return[]},function(){return function(r){if(o.pluginConfigLoading||!o.pluginConfig||!o.pluginConfig.plugin_info.capabilities)return!1;var t=o.pluginConfig.plugin_info.capabilities,n=t.methods.includes("exportEvents");return r===_.HistoricalExports?n:r===_.OnEvent&&n?!1:r===_.ScheduledTask?!n&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(u){return t.scheduled_tasks.includes(u)}):t.methods.includes(r)}}]}}),Object(M.listeners)(function(s){var o=s.values,r=s.actions;return{loadPluginConfigSuccess:function(){if(!o.activeTab){var n=d.filter(function(p){return o.showTab(p)}),u=f()(n,1),c=u[0];r.setActiveTab(c)}},setActiveTab:function(n){var u=n.tab;u===_.HistoricalExports?r.loadHistoricalExports():r.loadMetrics()},setDateFrom:function(){r.loadMetrics()}}}),Object(b.actionToUrl)(function(s){var o=s.values,r=s.props;return{setActiveTab:function(){return m(o,r)},setDateFrom:function(){return m(o,r)}}}),Object(b.urlToAction)(function(s){var o=s.values,r=s.actions,t=s.props;return{"/app/:pluginConfigId/:page":function(u,c){t.pluginConfigId===Number(u.pluginConfigId)&&(o.pluginConfig||r.loadPluginConfig(),u.page===_.HistoricalExports?r.setActiveTab(_.HistoricalExports):(c.tab&&d.includes(c.tab)&&r.setActiveTab(c.tab),c.from&&r.setDateFrom(c.from)))}}})]);function m(s,o){if(s.activeTab===_.HistoricalExports)return A.a.appHistoricalExports(o.pluginConfigId);var r={};return s.activeTab&&(r.tab=s.activeTab),s.dateFrom!==l&&(r.from=s.dateFrom),A.a.appMetrics(o.pluginConfigId,r)}},"./frontend/src/scenes/apps/constants.tsx":function(y,E,e){"use strict";e.r(E),e.d(E,"DescriptionColumns",function(){return P});var D=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),f=e.n(D),j=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),i,P=(i={},f()(i,j.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),f()(i,j.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),f()(i,j.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),f()(i,j.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),f()(i,j.AppMetricsTab.ScheduledTask,{successes:"Successes",failures:"Failures"}),i)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(y,E,e){var D=e("./node_modules/css-loader/dist/runtime/api.js");E=D(!1),E.push([y.i,".AppMetricsGraph{height:300px}",""]),y.exports=E}}]);
