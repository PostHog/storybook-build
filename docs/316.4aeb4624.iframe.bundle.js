(window.webpackJsonp=window.webpackJsonp||[]).push([[316],{"./frontend/src/scenes/actions/Action.tsx":function(ot,Y,s){"use strict";s.r(Y),s.d(Y,"scene",function(){return Ze}),s.d(Y,"Action",function(){return F});var st=s("./node_modules/core-js/modules/es.array.concat.js"),he=s("./node_modules/@babel/runtime/helpers/defineProperty.js"),V=s.n(he),ve=s("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Q=s.n(ve),at=s("./node_modules/core-js/modules/es.function.name.js"),it=s("./node_modules/core-js/modules/es.array.map.js"),rt=s("./node_modules/core-js/modules/es.array.filter.js"),ct=s("./node_modules/core-js/modules/es.object.to-string.js"),lt=s("./node_modules/core-js/modules/es.object.keys.js"),dt=s("./node_modules/core-js/modules/es.symbol.js"),ut=s("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),mt=s("./node_modules/core-js/modules/web.dom-collections.for-each.js"),pt=s("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),E=s("./frontend/src/lib/utils.tsx"),Z=s("./frontend/src/lib/components/Link.tsx"),h=s("./node_modules/kea/lib/index.esm.js"),be=s("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),z=s.n(be),fe=s("./node_modules/@babel/runtime/regenerator/index.js"),T=s.n(fe),jt=s("./node_modules/core-js/modules/es.array.iterator.js"),ht=s("./node_modules/core-js/modules/web.dom-collections.iterator.js"),vt=s("./node_modules/core-js/modules/es.regexp.exec.js"),bt=s("./node_modules/core-js/modules/es.string.split.js"),N=s("./frontend/src/lib/api.ts"),Oe=s("./frontend/src/models/actionsModel.ts"),q=s("./frontend/src/lib/components/lemonToast.tsx"),ge=s("./node_modules/kea-loaders/lib/index.js"),_=s("./node_modules/kea-forms/lib/index.js"),B=s("./node_modules/kea-router/lib/index.js"),g=s("./frontend/src/scenes/urls.ts"),xe=s("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts"),e=s("./node_modules/react/jsx-runtime.js");function ee(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),o.push.apply(o,a)}return o}function I(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?ee(Object(o),!0).forEach(function(a){V()(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):ee(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}var te=Object(h.kea)([Object(h.path)(["scenes","actions","actionEditLogic"]),Object(h.props)({}),Object(h.key)(function(n){return n.id||"new"}),Object(h.actions)({setAction:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:t,options:o}},setCreateNew:function(t){return{createNew:t}},actionAlreadyExists:function(t){return{actionId:t}},deleteAction:!0}),Object(h.connect)({actions:[Oe.a,["loadActions"],xe.c,["loadEventDefinitions"]]}),Object(h.reducers)({createNew:[!1,{setCreateNew:function(t,o){var a=o.createNew;return a}}]}),Object(_.forms)(function(n){var t=n.actions,o=n.props;return{action:{defaults:I({},o.action),errors:function(i){var d=i.name;return{name:d?null:"You need to set a name"}},submit:function(i){t.saveAction(i)}}}}),Object(ge.loaders)(function(n){var t=n.props,o=n.values,a=n.actions;return{actionCount:{loadActionCount:function(){var i=z()(T.a.mark(function l(){return T.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.id){r.next=6;break}return r.next=3,N.b.actions.getCount(t.id);case 3:r.t0=r.sent,r.next=7;break;case 6:r.t0=0;case 7:return r.abrupt("return",r.t0);case 8:case"end":return r.stop()}},l)}));function d(){return i.apply(this,arguments)}return d}()},action:[I({},t.action),{setAction:function(d){var l=d.action,j=d.options.merge;return j?I(I({},o.action),l):l},saveAction:function(){var i=z()(T.a.mark(function l(j,r){var c,v;return T.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(c=I({},j),c.steps=c.steps?c.steps.filter(function(K){return K.event}):[],u.prev=2,!c.id){u.next=9;break}return u.next=6,N.b.actions.update(c.id,c,t.temporaryToken);case 6:c=u.sent,u.next=12;break;case 9:return u.next=11,N.b.actions.create(c,t.temporaryToken);case 11:c=u.sent;case 12:r(),u.next=22;break;case 15:if(u.prev=15,u.t0=u.catch(2),u.t0.code!=="unique"){u.next=21;break}return v=u.t0.detail.split(" ").pop(),q.d.error(Object(e.jsxs)(e.Fragment,{children:["Action with this name already exists."," ",Object(e.jsx)(Z.a,{to:g.a.action(v),children:"Click here to edit."})]})),u.abrupt("return",c);case 21:throw u.t0;case 22:return q.d.success("Action saved"),t.onSave(c),a.loadEventDefinitions(null),a.loadActions(),u.abrupt("return",c);case 27:case"end":return u.stop()}},l,null,[[2,15]])}));function d(l,j){return i.apply(this,arguments)}return d}()}]}}),Object(h.listeners)(function(n){var t=n.values,o=n.actions;return{deleteAction:function(){Object(E.x)({endpoint:N.b.actions.determineDeleteEndpoint(),object:t.action,callback:function(){B.router.actions.push(g.a.actions()),o.loadActions()}})}}}),Object(h.afterMount)(function(n){var t=n.actions,o=n.props;o.id?t.loadActionCount():t.setAction({name:"",steps:[{isNew:Object(E.Ib)()}]},{merge:!1})})]),ft=s("./frontend/src/scenes/actions/Actions.scss"),ye=s("./frontend/src/scenes/actions/EventName.tsx"),Ae=s("./node_modules/@babel/runtime/helpers/slicedToArray.js"),Ce=s.n(Ae),Se=s("./node_modules/react/index.js"),ne=s("./frontend/src/scenes/teamLogic.tsx"),G=s("./node_modules/antd/es/button/index.js"),Te=s("./node_modules/antd/es/modal/index.js"),Le=s("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),oe=s("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts");function R(n){var t,o=n.actionId,a=n.style,i=n.children,d=Object(Se.useState)(!1),l=Ce()(d,2),j=l[0],r=l[1],c=Object(h.useValues)(ne.a),v=c.currentTeam;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(G.a,{href:Object(oe.b)(v==null||(t=v.app_urls)===null||t===void 0?void 0:t[0],o),style:a,size:"small",onClick:function(u){u.preventDefault(),r(!0)},children:i}),Object(e.jsx)(Te.a,{visible:j,title:o?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:Object(e.jsx)(G.a,{onClick:function(){return r(!1)},children:"Close"}),onCancel:function(){return r(!1)},children:Object(e.jsx)(Le.a,{actionId:o,type:oe.a.TOOLBAR_URLS})})]})}try{R.displayName="AppEditorLink",R.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:R.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(n){}var Ee=s("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Ne=s("./frontend/src/lib/components/Tooltip.tsx"),M=s("./frontend/src/scenes/actions/hints.tsx"),Ie=s("./node_modules/antd/es/typography/index.js"),se=s("./node_modules/antd/es/col/index.js"),Pe=s("./node_modules/antd/es/card/index.js"),Fe=s("./node_modules/antd/es/space/index.js"),y=s("./node_modules/antd/es/radio/index.js"),De=s("./node_modules/@ant-design/icons/es/icons/ExportOutlined.js"),ae=s("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),ie=s("./frontend/@posthog/lemon-ui/src/index.ts");function re(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),o.push.apply(o,a)}return o}function f(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?re(Object(o),!0).forEach(function(a){V()(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):re(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}var ce=Ie.a.Text,le="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function k(n){var t=n.step,o=n.actionId,a=n.isOnlyStep,i=n.index,d=n.identifier,l=n.onDelete,j=n.onChange,r=function(v){j(v)};return Object(e.jsx)(se.a,{span:24,md:12,children:Object(e.jsxs)(Pe.a,{className:"action-step",style:{overflow:"visible"},children:[i>0&&Object(e.jsx)("div",{className:"stateful-badge pos-center-end or",children:"OR"}),Object(e.jsxs)("div",{children:[!a&&Object(e.jsx)("div",{className:"remove-wrapper",children:Object(e.jsx)("button",{type:"button","aria-label":"delete",onClick:l,children:Object(e.jsx)("span",{"aria-hidden":"true",children:"\xD7"})})}),Object(e.jsx)("div",{className:"mb-4",children:Object(e.jsxs)("b",{children:["Match Group #",i+1]})}),Object(e.jsx)(Ve,{step:t,sendStep:r}),Object(e.jsxs)("div",{style:{marginTop:t.event==="$pageview"?20:8,paddingBottom:0},children:[t.event==="$autocapture"&&Object(e.jsx)(we,{step:t,sendStep:r,actionId:o}),t.event!=null&&t.event!=="$autocapture"&&t.event!=="$pageview"&&Object(e.jsxs)("div",{style:{marginTop:"2rem"},children:[Object(e.jsx)("label",{children:Object(e.jsx)("b",{children:"Event name: "})}),Object(e.jsx)(ye.a,{value:t.event,onChange:function(v){return r(f(f({},t),{},{event:v||""}))}}),Object(e.jsx)("br",{}),Object(e.jsxs)("small",{children:[Object(e.jsx)("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer",children:"See documentation"})," ","on how to send custom events in lots of languages."]})]}),t.event==="$pageview"&&Object(e.jsxs)("div",{children:[Object(e.jsx)(P,{step:t,sendStep:r,item:"url",extra_options:Object(e.jsx)(de,{step:t,sendStep:r}),label:"URL"}),t.url_matching&&t.url_matching in M.a&&Object(e.jsx)("small",{style:{display:"block",marginTop:-12},children:M.a[t.url_matching]})]}),t.event&&Object(e.jsxs)("div",{className:"action-property-filters",children:[Object(e.jsx)("h3",{className:"l3",children:"Filters"}),(!t.properties||t.properties.length===0)&&Object(e.jsx)("div",{className:"text-muted",children:"This match group has no additional filters."}),Object(e.jsx)(Ee.a,{propertyFilters:t.properties,pageKey:d,eventNames:t.event?[t.event]:[],onChange:function(v){r(f(f({},t),{},{properties:v}))},showConditionBadge:!0})]})]})]})]})})}function P(n){var t=function(a){return n.sendStep(f(f({},n.step),{},V()({},n.item,a||null)))};return Object(e.jsxs)("div",{className:"mb-4",children:[Object(e.jsxs)("label",{style:{fontWeight:"bold"},children:[n.label," ",n.extra_options]}),n.caption&&Object(e.jsx)("div",{className:"action-step-caption",children:n.caption}),n.item==="selector"?Object(e.jsx)(ie.LemonTextArea,{onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}):Object(e.jsx)(ie.LemonInput,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder})]})}function we(n){var t=n.step,o=n.actionId,a=n.sendStep,i=function(){return Object(e.jsx)("div",{className:"text-center",children:Object(e.jsx)("span",{className:"stateful-badge and",children:"AND"})})};return Object(e.jsxs)("div",{children:[Object(e.jsxs)("span",{children:[Object(e.jsxs)(R,{actionId:o,style:{margin:"1rem 0"},children:["Select element on site ",Object(e.jsx)(De.a,{})]}),Object(e.jsx)("a",{href:"".concat(le,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8},children:"See documentation."})," "]}),Object(e.jsx)(P,{step:t,sendStep:a,item:"href",label:"Link target equals",caption:Object(e.jsxs)(e.Fragment,{children:["If your element is a link, the location that the link opens (",Object(e.jsx)("code",{children:"href"})," tag)"]})}),Object(e.jsx)(i,{}),Object(e.jsx)(P,{step:t,sendStep:a,item:"text",label:"Text equals",caption:"Text content inside your element"}),Object(e.jsx)(i,{}),Object(e.jsx)(P,{step:t,sendStep:a,item:"selector",label:Object(e.jsxs)(e.Fragment,{children:["HTML selector matches",Object(e.jsx)(Ne.a,{title:"Click here to learn more about supported selectors",children:Object(e.jsx)("a",{href:"".concat(le,"#matching-selectors"),target:"_blank",rel:"noopener",children:Object(e.jsx)(ae.a,{style:{marginLeft:4}})})})]}),placeholder:'button[data-attr="my-id"]',caption:Object(e.jsx)(Fe.b,{direction:"vertical",children:Object(e.jsxs)(ce,{style:{color:"var(--muted)"},children:["CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",Object(e.jsx)(ce,{code:!0,children:'[data-attr="signup"]'})]})})}),Object(e.jsx)("div",{style:{marginBottom:18},children:Object(e.jsx)(i,{})}),Object(e.jsx)(P,{step:t,sendStep:a,item:"url",extra_options:Object(e.jsx)(de,{step:t,sendStep:a}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(t==null?void 0:t.url_matching)&&t.url_matching in M.a&&Object(e.jsx)("small",{style:{display:"block",marginTop:-12},children:M.a[t.url_matching]})]})}function Ve(n){var t=n.step,o=n.sendStep,a=function(d){var l=d.target.value;l==="$autocapture"?o(f(f({},t),{},{event:"$autocapture"})):l==="event"?o(f(f({},t),{},{event:""})):l==="$pageview"&&o(f(f({},t),{},{event:"$pageview",url:t.url}))};return Object(e.jsx)("div",{className:"type-switcher",children:Object(e.jsxs)(y.a.Group,{buttonStyle:"solid",onChange:a,value:t.event==="$autocapture"||t.event==="$pageview"||t.event===void 0?t.event:"event",children:[Object(e.jsx)(y.a.Button,{value:"$autocapture",children:"Autocapture"}),Object(e.jsx)(y.a.Button,{value:"event",children:"Custom event"}),Object(e.jsx)(y.a.Button,{value:"$pageview",children:"Page view"})]})})}function de(n){var t=n.step,o=n.sendStep,a=function(d){o(f(f({},t),{},{url_matching:d.target.value}))};return Object(e.jsxs)(y.a.Group,{buttonStyle:"solid",onChange:a,value:t.url_matching||"contains",size:"small",children:[Object(e.jsx)(y.a.Button,{value:"contains",children:"contains"}),Object(e.jsx)(y.a.Button,{value:"regex",children:"matches regex"}),Object(e.jsx)(y.a.Button,{value:"exact",children:"matches exactly"})]})}try{k.displayName="ActionStep",k.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:k.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(n){}var Be=s("./node_modules/antd/es/row/index.js"),Re=s("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),Me=s("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),ke=s("./frontend/src/lib/components/PageHeader.tsx"),ue=s("./frontend/src/lib/components/EditableField/EditableField.tsx"),$e=s("./frontend/src/types.ts"),Ue=s("./frontend/src/scenes/userLogic.ts"),Ke=s("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),A=s("./frontend/src/lib/forms/Field.tsx"),$=s("./frontend/src/lib/components/LemonButton/index.ts"),Ye=s("./frontend/src/lib/components/LemonCheckbox/index.ts"),ze=s("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),Ge=s("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),He=s("./frontend/src/lib/components/icons.tsx");function me(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),o.push.apply(o,a)}return o}function Je(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?me(Object(o),!0).forEach(function(a){V()(n,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):me(Object(o)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(o,a))})}return n}function U(n){var t=n.action,o=n.id,a=n.onSave,i=n.temporaryToken,d={id:o,action:t,onSave:function(m){return a(m)},temporaryToken:i},l=te(d),j=Object(h.useValues)(l),r=j.action,c=j.actionLoading,v=j.actionCount,C=j.actionCountLoading,u=Object(h.useActions)(l),K=u.submitAction,qe=u.deleteAction,_e=Object(h.useValues)(ne.a),J=_e.currentTeam,et=Object(h.useValues)(Ue.a),tt=et.hasAvailableFeature,W=J==null?void 0:J.slack_incoming_webhook,pe=function(){return Object(e.jsx)($.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",onClick:function(){qe()},children:"Delete"})},je=function(){return Object(e.jsx)($.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",onClick:function(){B.router.actions.push(g.a.actions())},children:"Cancel"})};return Object(e.jsx)("div",{className:"action-edit-container",children:Object(e.jsxs)(_.Form,{logic:te,props:d,formKey:"action",enableFormOnSubmit:!0,children:[Object(e.jsx)(ke.a,{title:Object(e.jsx)(A.a,{name:"name",children:function(m){var p=m.value,b=m.onChange;return Object(e.jsx)(ue.a,{name:"name",value:p||"",placeholder:"Name this action",onChange:o?void 0:b,onSave:function(S){b(S),K()},mode:o?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(o?"edit":"create"),className:"action-name"})}}),caption:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(A.a,{name:"description",children:function(m){var p=m.value,b=m.onChange;return Object(e.jsx)(ue.a,{multiline:!0,name:"description",value:p||"",placeholder:"Description (optional)",onChange:o?void 0:b,onSave:function(S){b(S),K()},mode:o?void 0:"edit","data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!tt($e.d.INGESTION_TAXONOMY)})}}),Object(e.jsx)(A.a,{name:"tags",children:function(m){var p=m.value,b=m.onChange;return Object(e.jsx)(Ke.a,{tags:p!=null?p:[],onChange:function(S,X){return b(X)},className:"action-tags",saving:c})}})]}),buttons:Object(e.jsxs)(e.Fragment,{children:[o?Object(e.jsx)($.a,{type:"secondary",to:Object(B.combineUrl)(g.a.sessionRecordings(),{filters:{actions:[{id:o,type:"actions",order:0,name:r.name}]}}).url,sideIcon:Object(e.jsx)(He.IconPlayCircle,{}),"data-attr":"action-view-recordings",children:"View recordings"}):null,o?pe():je()]})}),o&&Object(e.jsx)("div",{className:"input-set",children:Object(e.jsx)("div",{children:Object(e.jsxs)("span",{className:"text-muted mb-2",children:[C&&Object(e.jsx)(Re.a,{}),v!==null&&v>-1&&Object(e.jsxs)(e.Fragment,{children:["This action matches ",Object(e.jsx)("b",{children:Object(E.p)(v)})," events in the last 3 months"]})]})})}),Object(e.jsxs)("div",{style:{overflow:"visible"},children:[Object(e.jsx)("h2",{className:"subtitle",children:"Match groups"}),Object(e.jsxs)("div",{children:["Your action will be triggered whenever ",Object(e.jsx)("b",{children:"any of your match groups"})," are received."," ",Object(e.jsx)("a",{href:"https://posthog.com/docs/features/actions",target:"_blank",children:Object(e.jsx)(ae.a,{})})]}),Object(e.jsx)(A.a,{name:"steps",children:function(m){var p=m.onChange;return Object(e.jsx)("div",{style:{textAlign:"right",marginBottom:12},children:Object(e.jsx)(G.a,{onClick:function(){return p([].concat(Q()(r.steps||[]),[{isNew:Object(E.Ib)()}]))},size:"small",children:"Add another match group"})})}}),Object(e.jsx)(A.a,{name:"steps",children:function(m){var p=m.value,b=m.onChange;return Object(e.jsxs)(Be.a,{gutter:[24,24],children:[Object(e.jsx)(e.Fragment,{children:p.map(function(O,S){var X=String(JSON.stringify(O));return Object(e.jsx)(k,{identifier:X,index:S,step:O,actionId:r.id||0,isOnlyStep:!!p&&p.length===1,onDelete:function(){var D,L=O.id?"id":"isNew";b((D=p==null?void 0:p.filter(function(w){return w[L]!==O[L]}))!==null&&D!==void 0?D:[])},onChange:function(D){var L;b((L=p==null?void 0:p.map(function(w){return O.id&&w.id==O.id||O.isNew&&w.isNew===O.isNew?Je({id:O.id,isNew:O.isNew},D):w}))!==null&&L!==void 0?L:[])}},S)})}),Object(e.jsx)(se.a,{span:24,md:12,children:Object(e.jsx)("div",{className:"match-group-add-skeleton",onClick:function(){b([].concat(Q()(r.steps||[]),[{isNew:Object(E.Ib)()}]))},children:Object(e.jsx)(Me.a,{style:{fontSize:28,color:"#666666"}})})})]})}})]}),Object(e.jsxs)("div",{className:"my-8",children:[Object(e.jsx)(A.a,{name:"post_to_slack",children:function(m){var p=m.value,b=m.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ye.a,{id:"webhook-checkbox",checked:!!p,onChange:b,disabled:!W,label:Object(e.jsx)(e.Fragment,{children:"Post to webhook when this action is triggered."})}),Object(e.jsx)("p",{className:"pl-7",children:Object(e.jsxs)(Z.a,{to:"/project/settings#webhook",children:[W?"Configure":"Enable"," this integration in Setup."]})})]})}}),r.post_to_slack&&Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(A.a,{name:"slack_message_format",children:function(m){var p=m.value,b=m.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ge.a,{showOptional:!0,children:"Message format"}),Object(e.jsx)(ze.a,{placeholder:"Default: [action.name] triggered by [person]",value:p,onChange:b,disabled:!W||!r.post_to_slack,"data-attr":"edit-slack-message-format"}),Object(e.jsx)("small",{children:Object(e.jsx)("a",{href:"https://posthog.com/docs/integrate/webhooks/message-formatting",target:"_blank",rel:"noopener noreferrer",children:"See documentation on how to format webhook messages."})})]})}})})]}),Object(e.jsxs)("div",{className:"flex justify-end gap-2",children:[o?pe():je(),Object(e.jsx)($.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:c,children:"Save"})]})]})})}try{U.displayName="ActionEdit",U.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:U.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(n){}var We=s("./frontend/src/scenes/events/index.ts"),Xe=s("./frontend/src/lib/dayjs.ts"),Qe=s("./frontend/src/lib/components/Spinner/Spinner.tsx"),H=Object(h.kea)({props:{},key:function(t){return t.id||"new"},path:function(t){return["scenes","actions","actionLogic",t]},actions:function(){return{checkIsFinished:function(o){return{action:o}},setPollTimeout:function(o){return{pollTimeout:o}},setIsComplete:function(o){return{isComplete:o}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(o,a){var i=a.pollTimeout;return i}}],isComplete:[!1,{setIsComplete:function(o,a){var i=a.isComplete;return i}}]}},selectors:{breadcrumbs:[function(n){return[n.action]},function(n){return[{name:"Data Management",path:g.a.eventDefinitions()},{name:"Actions",path:g.a.actions()},{name:(n==null?void 0:n.name)||"Unnamed",path:n?g.a.action(n.id):void 0}]}]},loaders:function(t){var o=t.actions,a=t.props;return{action:{loadAction:function(){var i=z()(T.a.mark(function l(){var j;return T.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(o.setIsComplete(!1),a.id){c.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return c.next=5,N.b.actions.get(a.id);case 5:return j=c.sent,o.checkIsFinished(j),c.abrupt("return",j);case 8:case"end":return c.stop()}},l)}));function d(){return i.apply(this,arguments)}return d}()}}},listeners:function(t){var o=t.actions,a=t.values;return{checkIsFinished:function(d){var l=d.action;l.is_calculating?o.setPollTimeout(setTimeout(function(){return o.loadAction()},1e3)):(o.setIsComplete(new Date),a.pollTimeout&&clearTimeout(a.pollTimeout))}}},events:function(t){var o=t.values,a=t.actions,i=t.props;return{afterMount:function(){i.id&&a.loadAction()},beforeUnmount:function(){o.pollTimeout&&clearTimeout(o.pollTimeout)}}}}),Ze={logic:H,component:F,paramsToProps:function(t){var o=t.params.id;return{id:parseInt(o)}}};function F(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.id,o={action_id:t},a=Object(h.useActions)(B.router),i=a.push,d=Object(h.useValues)(H),l=d.action,j=d.isComplete,r=Object(h.useActions)(H),c=r.loadAction;return Object(e.jsxs)(e.Fragment,{children:[(!t||l)&&Object(e.jsx)(U,{id:t,action:l,onSave:function(C){t||i(g.a.action(C.id)),c()}}),t&&(j?Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("p",{children:["This is the list of ",Object(e.jsx)("strong",{children:"recent"})," events that match this action.",l!=null&&l.last_calculated_at?Object(e.jsxs)(e.Fragment,{children:[" ","Last calculated: ",Object(e.jsx)("b",{children:Object(Xe.a)(l.last_calculated_at).fromNow()}),"."]}):""]}),Object(e.jsx)("div",{className:"pt-4 border-t"}),Object(e.jsx)(We.b,{fixedFilters:o,sceneUrl:g.a.action(t),fetchMonths:3,pageKey:"action-".concat(t,"-").concat(JSON.stringify(o)),showEventFilter:!1})]}):Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsx)(Qe.a,{className:"mr-4"}),"Calculating action, please hold on."]})]}))]})}try{F.displayName="Action",F.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:F.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(n){}}}]);
