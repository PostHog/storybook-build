(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[90710],{"./frontend/src/scenes/max/Max.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Max:()=>Max_Max,MaxInstance:()=>MaxInstance,scene:()=>scene});var injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Max=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/max/Max.scss"),Max_default=__webpack_require__.n(Max),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(Max_default(),options),Max_default().locals;var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),HedgehogBuddy=__webpack_require__("./frontend/src/lib/components/HedgehogBuddy/HedgehogBuddy.tsx"),hedgehogBuddyLogic=__webpack_require__("./frontend/src/lib/components/HedgehogBuddy/hedgehogBuddyLogic.ts"),maxLogic=__webpack_require__("./frontend/src/scenes/max/maxLogic.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let HEADLINES=["How can I help you build?","What are you curious about?","How can I help you understand users?","What do you want to know today?"];function Intro(){let{hedgehogConfig}=(0,index_esm.useValues)(hedgehogBuddyLogic.r),{sessionId}=(0,index_esm.useValues)(maxLogic.v),headline=(0,react.useMemo)(()=>HEADLINES[parseInt(sessionId.split("-").at(-1),16)%HEADLINES.length],[]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex",children:(0,jsx_runtime.jsx)(HedgehogBuddy.CV,{static:!0,hedgehogConfig:{...hedgehogConfig,walking_enabled:!1,controls_enabled:!1},onClick:actor=>{.01>Math.random()?actor.setOnFire():actor.setRandomAnimation()},onActorLoaded:actor=>setTimeout(()=>actor.setAnimation("wave"),100)})}),(0,jsx_runtime.jsxs)("div",{className:"text-center mb-3",children:[(0,jsx_runtime.jsx)("h2",{className:"text-2xl font-bold mb-2 text-balance",children:headline}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-balance",children:"I'm Max, here to help you build a succesful product. Ask me about your product and your users."})]})]})}var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.9.1_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js");function QuestionInput(){let{question,thread,threadLoading}=(0,index_esm.useValues)(maxLogic.v),{askMax,setQuestion}=(0,index_esm.useActions)(maxLogic.v),textAreaRef=(0,react.useRef)(null),isFloating=thread.length>0;return(0,react.useEffect)(()=>{threadLoading||textAreaRef.current?.focus()},[threadLoading]),(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)(isFloating?"w-full max-w-192 sticky z-10 self-center p-1 mx-4 mb-3 bottom-3 border border-[var(--glass-border-3000)] rounded-[0.625rem] backdrop-blur bg-[var(--glass-bg-3000)]":"w-[min(44rem,100%)] relative"),children:[(0,jsx_runtime.jsx)(src._V,{ref:textAreaRef,value:question,onChange:value=>setQuestion(value),placeholder:threadLoading?"Thinking…":isFloating?"Ask follow-up":"Ask away",onPressEnter:()=>{question&&askMax(question)},disabled:threadLoading,minRows:1,maxRows:10,className:(0,clsx_m.default)("p-3",isFloating&&"border-border-bold")}),(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("absolute top-0 bottom-0 flex items-center",isFloating?"right-3":"right-2"),children:(0,jsx_runtime.jsx)(src.Jp,{type:isFloating&&!question?"secondary":"primary",onClick:()=>askMax(question),tooltip:"Let's go!",disabledReason:question?threadLoading?"Thinking…":void 0:"I need some input first",size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowRight,{})})})]})}var sidePanelSettingsLogic=__webpack_require__("./frontend/src/layout/navigation-3000/sidepanel/panels/sidePanelSettingsLogic.tsx");function QuestionSuggestions(){let{visibleSuggestions,allSuggestionsLoading,currentProject}=(0,index_esm.useValues)(maxLogic.v),{askMax,shuffleVisibleSuggestions}=(0,index_esm.useActions)(maxLogic.v),{openSettingsPanel}=(0,index_esm.useActions)(sidePanelSettingsLogic.A);return currentProject&&!currentProject.product_description?(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"primary",sideIcon:(0,jsx_runtime.jsx)(posthog_icons_es.IconOpenSidebar,{}),className:"relative",onClick:()=>{openSettingsPanel({settingId:"product-description"}),setTimeout(()=>document.getElementById("product-description-textarea")?.focus(),1)},children:"Tell me a bit about your product, and I'll offer better answers and suggestions"}):(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center flex-wrap gap-x-2 gap-y-1.5 w-[min(48rem,100%)]",children:allSuggestionsLoading?Array.from({length:3}).map((_,index)=>(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",disabled:!0,style:{width:["35%","42.5%","50%"][index]},children:(0,jsx_runtime.jsx)(src.yW,{className:"h-3 w-full"})},index)):visibleSuggestions?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[visibleSuggestions.map((suggestion,index)=>(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>askMax(suggestion),size:"xsmall",type:"secondary",sideIcon:(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowUpRight,{}),center:!0,className:"shrink",children:suggestion},index)),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:shuffleVisibleSuggestions,size:"xsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconShuffle,{}),tooltip:"Shuffle suggestions"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>openSettingsPanel({settingId:"product-description"}),size:"xsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),tooltip:"Edit product description"})]})]}):null})}var InsightDetails=__webpack_require__("./frontend/src/lib/components/Cards/InsightCard/InsightDetails.tsx"),TopHeading=__webpack_require__("./frontend/src/lib/components/Cards/InsightCard/TopHeading.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonMarkdown=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMarkdown/index.ts"),dist_module=__webpack_require__("./node_modules/.pnpm/posthog-js@1.186.2/node_modules/posthog-js/dist/module.js"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),max_utils=__webpack_require__("./frontend/src/scenes/max/utils.ts");function Thread(){let{thread,threadLoading}=(0,index_esm.useValues)(maxLogic.v);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-stretch w-full max-w-200 self-center gap-2 grow p-4",children:[thread.map((message,index)=>(0,max_utils.Q1)(message)?(0,jsx_runtime.jsx)(MessageTemplate,{type:"human",className:"error"===message.status?"border-danger":void 0,children:(0,jsx_runtime.jsx)(LemonMarkdown.j,{children:message.content||"*No text.*"})},index):(0,max_utils.Gn)(message)||(0,max_utils.W$)(message)?(0,jsx_runtime.jsx)(TextAnswer,{message:message,index:index},index):(0,max_utils.N_)(message)?(0,jsx_runtime.jsx)(VisualizationAnswer,{message:message,status:message.status},index):null),threadLoading&&(0,jsx_runtime.jsx)(MessageTemplate,{type:"ai",className:"w-fit select-none",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:["Let me think…",(0,jsx_runtime.jsx)(src.$j,{className:"text-xl"})]})})]})}let MessageTemplate=react.forwardRef(function MessageTemplate(_ref,ref){let{type,children,className,action}=_ref;return type===schema.pj.Human?(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("mt-1 mb-3 text-2xl font-medium",className),ref:ref,children:children}):(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("border p-2 rounded bg-bg-light",className),ref:ref,children:children}),action]})}),TextAnswer=react.forwardRef(function TextAnswer(_ref2,ref){let{message,index}=_ref2,{thread}=(0,index_esm.useValues)(maxLogic.v);return(0,jsx_runtime.jsx)(MessageTemplate,{type:"ai",className:"error"===message.status||"ai/failure"===message.type?"border-danger":void 0,ref:ref,action:"ai/failure"===message.type&&index===thread.length-1?(0,jsx_runtime.jsx)(RetriableAnswerActions,{}):"ai"===message.type&&"completed"===message.status&&(void 0===thread[index+1]||"human"===thread[index+1].type)?(0,jsx_runtime.jsx)(SuccessfulAnswerActions,{messageIndex:index}):null,children:(0,jsx_runtime.jsx)(LemonMarkdown.j,{children:message.content||"*Max has failed to generate an answer. Please try again.*"})})});function VisualizationAnswer(_ref3){let{message,status}=_ref3,query=(0,react.useMemo)(()=>message.answer?{kind:schema.OH.InsightVizNode,source:(0,max_utils.YO)(message.answer),showHeader:!0}:null,[message]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[message.reasoning_steps&&(0,jsx_runtime.jsx)(MessageTemplate,{type:"ai",action:"error"===status&&(0,jsx_runtime.jsx)(src.Qs,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{}),status:"warning",size:"small",children:"Max is generating this answer one more time because the previous attempt has failed."}),className:"error"===status?"border-warning":void 0,children:(0,jsx_runtime.jsx)("ul",{className:"list-disc ml-4",children:message.reasoning_steps.map((step,index)=>(0,jsx_runtime.jsx)("li",{children:step},index))})}),"completed"===status&&query&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)(MessageTemplate,{type:"ai",children:[(0,jsx_runtime.jsx)("div",{className:"h-96 flex",children:(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,embedded:!0})}),(0,jsx_runtime.jsxs)("div",{className:"relative mb-1",children:[(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.insightNew(void 0,void 0,query),sideIcon:(0,jsx_runtime.jsx)(icons.pF,{}),size:"xsmall",targetBlank:!0,className:"absolute right-0 -top-px",children:"Open as new insight"}),(0,jsx_runtime.jsx)(InsightDetails.qH,{query:query.source,heading:(0,jsx_runtime.jsx)(TopHeading.l,{query:query})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4 mt-1 *:grow",children:[(0,jsx_runtime.jsx)(InsightDetails.g4,{properties:query.source.properties}),(0,jsx_runtime.jsx)(InsightDetails.d8,{query:query.source})]})]})]})})]})}function RetriableAnswerActions(){let{retryLastMessage}=(0,index_esm.useActions)(maxLogic.v);return(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconRefresh,{}),type:"secondary",size:"small",tooltip:"Try again",onClick:()=>retryLastMessage(),children:"Try again"})}function SuccessfulAnswerActions(_ref4){let{messageIndex}=_ref4,{thread}=(0,index_esm.useValues)(maxLogic.v),{retryLastMessage}=(0,index_esm.useActions)(maxLogic.v),[rating,setRating]=(0,react.useState)(null),[feedback,setFeedback]=(0,react.useState)(""),[feedbackInputStatus,setFeedbackInputStatus]=(0,react.useState)("hidden"),hasScrolledFeedbackInputIntoView=(0,react.useRef)(!1),[relevantHumanMessage,relevantVisualizationMessage]=(0,react.useMemo)(()=>{let relevantMessages=thread.slice(0,messageIndex+1).reverse(),visualizationMessage=relevantMessages.find(max_utils.N_),humanMessage=relevantMessages.find(max_utils.Q1);return[humanMessage,visualizationMessage]},[thread,messageIndex]);function submitRating(newRating){rating||(setRating(newRating),dist_module.ZP.capture("chat rating",{question:relevantHumanMessage.content,answer:JSON.stringify(relevantVisualizationMessage.answer),answer_rating:rating}),"bad"===newRating&&setFeedbackInputStatus("pending"))}function submitFeedback(){feedback&&(dist_module.ZP.capture("chat feedback",{question:relevantHumanMessage.content,answer:JSON.stringify(relevantVisualizationMessage.answer),feedback}),setFeedbackInputStatus("submitted"))}return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:["bad"!==rating&&(0,jsx_runtime.jsx)(src.Jp,{icon:"good"===rating?(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsUpFilled,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsUp,{}),type:"tertiary",size:"small",tooltip:"Good answer",onClick:()=>submitRating("good")}),"good"!==rating&&(0,jsx_runtime.jsx)(src.Jp,{icon:"bad"===rating?(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsDownFilled,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsDown,{}),type:"tertiary",size:"small",tooltip:"Bad answer",onClick:()=>submitRating("bad")}),messageIndex===thread.length-1&&(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconRefresh,{}),type:"tertiary",size:"small",tooltip:"Try again",onClick:()=>retryLastMessage()})]}),"hidden"!==feedbackInputStatus&&(0,jsx_runtime.jsxs)(MessageTemplate,{type:"ai",ref:el=>{el&&!hasScrolledFeedbackInputIntoView.current&&(el.scrollIntoView({behavior:"smooth"}),hasScrolledFeedbackInputIntoView.current=!0)},children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("h4",{className:"m-0 text-sm grow",children:"pending"===feedbackInputStatus?"What disappointed you about the answer?":"Thank you for your feedback!"}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),type:"tertiary",size:"xsmall",onClick:()=>setFeedbackInputStatus("hidden")})]}),"pending"===feedbackInputStatus&&(0,jsx_runtime.jsxs)("div",{className:"flex w-full gap-2 items-center mt-1.5",children:[(0,jsx_runtime.jsx)(src.DF,{placeholder:"Help us improve Max…",fullWidth:!0,value:feedback,onChange:newValue=>setFeedback(newValue),onPressEnter:()=>submitFeedback(),autoFocus:!0}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>submitFeedback(),disabledReason:feedback?void 0:"Please type a few words!",children:"Submit"})]})]})]})}let scene={component:Max_Max};function Max_Max(){let{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h),sessionId=(0,react.useMemo)(()=>(0,utils.Vj)(),[]);return featureFlags[constants.y8.ARTIFICIAL_HOG]?(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:maxLogic.v,props:{sessionId},children:(0,jsx_runtime.jsx)(MaxInstance,{})}):(0,jsx_runtime.jsx)(NotFound.T,{object:"page",caption:"You don't have access to AI features yet."})}function MaxInstance(){let{thread}=(0,index_esm.useValues)(maxLogic.v);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:thread.length?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Thread,{}),(0,jsx_runtime.jsx)(QuestionInput,{})]}):(0,jsx_runtime.jsxs)("div",{className:"relative flex flex-col gap-3 px-4 items-center grow justify-center",children:[(0,jsx_runtime.jsx)(Intro,{}),(0,jsx_runtime.jsx)(QuestionInput,{}),(0,jsx_runtime.jsx)(QuestionSuggestions,{})]})})}},"./frontend/src/scenes/max/maxLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{v:()=>maxLogic});var esm_exports=__webpack_require__("./node_modules/.pnpm/@sentry+core@7.112.1/node_modules/@sentry/core/esm/exports.js");__webpack_require__("./node_modules/.pnpm/d3@7.8.2/node_modules/d3/src/index.js");var __defProp=Object.defineProperty,__defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,__publicField=(obj,key,value)=>__defNormalProp(obj,"symbol"!=typeof key?key+"":key,value);class ParseError extends Error{constructor(message,options){super(message),__publicField(this,"type"),__publicField(this,"field"),__publicField(this,"value"),__publicField(this,"line"),this.name="ParseError",this.type=options.type,this.field=options.field,this.value=options.value,this.line=options.line}}function noop(_arg){}var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),utils=__webpack_require__("./frontend/src/scenes/max/utils.ts"),projectLogic=__webpack_require__("./frontend/src/scenes/projectLogic.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts");let FAILURE_MESSAGE={type:schema.pj.Failure,content:"Oops! It looks like I’m having trouble generating this trends insight. Could you please try again?",status:"error",done:!0},maxLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","max","maxLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{sessionId}=_ref;return sessionId}),(0,index_esm.connect)({values:[projectLogic.K,["currentProject"]]}),(0,index_esm.actions)({askMax:prompt=>({prompt}),setThreadLoaded:function(){let testOnlyOverride=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{testOnlyOverride}},addMessage:message=>({message}),replaceMessage:(index,message)=>({index,message}),setMessageStatus:(index,status)=>({index,status}),setQuestion:question=>({question}),setVisibleSuggestions:suggestions=>({suggestions}),shuffleVisibleSuggestions:!0,retryLastMessage:!0}),(0,index_esm.reducers)({question:["",{setQuestion:(_,_ref2)=>{let{question}=_ref2;return question},askMax:()=>""}],thread:[[],{addMessage:(state,_ref3)=>{let{message}=_ref3;return[...state,message]},replaceMessage:(state,_ref4)=>{let{message,index}=_ref4;return[...state.slice(0,index),message,...state.slice(index+1)]},setMessageStatus:(state,_ref5)=>{let{index,status}=_ref5;return[...state.slice(0,index),{...state[index],status},...state.slice(index+1)]}}],threadLoading:[!1,{askMax:()=>!0,setThreadLoaded:(_,_ref6)=>{let{testOnlyOverride}=_ref6;return testOnlyOverride}}],visibleSuggestions:[null,{setVisibleSuggestions:(_,_ref7)=>{let{suggestions}=_ref7;return suggestions}}]}),(0,lib.loaders)({allSuggestions:[null,{loadSuggestions:async _ref8=>{let{refresh}=_ref8,response=await api.ZP.query({kind:schema.OH.SuggestedQuestionsQuery},void 0,void 0,refresh);return response.questions}}]}),(0,index_esm.listeners)(_ref9=>{let{actions,values,props}=_ref9;return{[projectLogic.K.actionTypes.updateCurrentProjectSuccess]:_ref10=>{let{payload}=_ref10;payload?.product_description&&actions.loadSuggestions({refresh:"blocking"})},[projectLogic.K.actionTypes.loadCurrentProjectSuccess]:_ref11=>{let{currentProject}=_ref11;currentProject?.product_description&&actions.loadSuggestions({refresh:"async_except_on_cache_miss"})},loadSuggestionsSuccess:()=>{actions.shuffleVisibleSuggestions()},shuffleVisibleSuggestions:()=>{if(!values.allSuggestions)throw Error("No question suggestions to shuffle");let allSuggestionsWithoutCurrentlyVisible=values.allSuggestions.filter(suggestion=>!values.visibleSuggestions?.includes(suggestion));actions.setVisibleSuggestions(allSuggestionsWithoutCurrentlyVisible.slice(0,3).sort((a,b)=>a.length-b.length))},askMax:async _ref12=>{let{prompt}=_ref12;actions.addMessage({type:schema.pj.Human,content:prompt,done:!0,status:"completed"});try{let response=await api.ZP.chat({session_id:props.sessionId,messages:values.thread.map(_ref13=>{let{status,...message}=_ref13;return message})}),reader=response.body?.getReader();if(!reader)return;let decoder=new TextDecoder,parser=function(callbacks){let{onEvent=noop,onError=noop,onRetry=noop,onComment}=callbacks,incompleteLine="",isFirstChunk=!0,id,data="",eventType="";function parseLine(line){if(""===line){data.length>0&&onEvent({id,event:eventType||void 0,data:data.endsWith(`
`)?data.slice(0,-1):data}),id=void 0,data="",eventType="";return}if(line.startsWith(":")){onComment&&onComment(line.slice(line.startsWith(": ")?2:1));return}let fieldSeparatorIndex=line.indexOf(":");if(-1!==fieldSeparatorIndex){let field=line.slice(0,fieldSeparatorIndex),offset=" "===line[fieldSeparatorIndex+1]?2:1,value=line.slice(fieldSeparatorIndex+offset);processField(field,value,line);return}processField(line,"",line)}function processField(field,value,line){switch(field){case"event":eventType=value;break;case"data":data=`${data}${value}
`;break;case"id":id=value.includes("\x00")?void 0:value;break;case"retry":/^\d+$/.test(value)?onRetry(parseInt(value,10)):onError(new ParseError(`Invalid \`retry\` value: "${value}"`,{type:"invalid-retry",value,line}));break;default:onError(new ParseError(`Unknown field "${field.length>20?`${field.slice(0,20)}\u2026`:field}"`,{type:"unknown-field",field,value,line}))}}return{feed:function(newChunk){let chunk=isFirstChunk?newChunk.replace(/^\xEF\xBB\xBF/,""):newChunk,[complete,incomplete]=function(chunk){let lines=[],incompleteLine="",totalLength=chunk.length;for(let i=0;i<totalLength;i++){let char=chunk[i];"\r"===char&&chunk[i+1]===`
`?(lines.push(incompleteLine),incompleteLine="",i++):"\r"===char||char===`
`?(lines.push(incompleteLine),incompleteLine=""):incompleteLine+=char}return[lines,incompleteLine]}(`${incompleteLine}${chunk}`);for(let line of complete)parseLine(line);incompleteLine=incomplete,isFirstChunk=!1},reset:function(options={}){incompleteLine&&options.consume&&parseLine(incompleteLine),id=void 0,data="",eventType="",incompleteLine=""}}}({onEvent:_ref14=>{let{data,event}=_ref14;if(event===schema.KC.Message){let parsedResponse=parseResponse(data);if(!parsedResponse)return;"completed"===values.thread[values.thread.length-1].status?actions.addMessage({...parsedResponse,status:parsedResponse.done?"completed":"loading"}):parsedResponse&&actions.replaceMessage(values.thread.length-1,{...parsedResponse,status:parsedResponse.done?"completed":"loading"})}else if(event===schema.KC.Status){let parsedResponse=parseResponse(data);if(!parsedResponse)return;parsedResponse.type===schema.PP.GenerationError&&actions.setMessageStatus(values.thread.length-1,"error")}}});for(;;){let{done,value}=await reader.read();if(parser.feed(decoder.decode(value)),done)break}}catch(e){(0,esm_exports.Tb)(e),values.thread[values.thread.length-1]?.status==="loading"?actions.replaceMessage(values.thread.length-1,FAILURE_MESSAGE):values.thread[values.thread.length-1]?.status!=="error"&&actions.addMessage({...FAILURE_MESSAGE,status:"completed"})}actions.setThreadLoaded()},retryLastMessage:()=>{let lastMessage=values.thread.filter(utils.Q1).pop();lastMessage&&actions.askMax(lastMessage.content)}}}),(0,index_esm.selectors)({sessionId:[(_,p)=>[p.sessionId],sessionId=>sessionId]}),(0,index_esm.afterMount)(_ref15=>{let{actions,values}=_ref15;values.currentProject?.product_description&&actions.loadSuggestions({refresh:"async_except_on_cache_miss"})})]);function parseResponse(response){try{let parsed=JSON.parse(response);return parsed}catch{return null}}},"./frontend/src/scenes/max/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Gn:()=>isAssistantMessage,N_:()=>isVisualizationMessage,Q1:()=>isHumanMessage,W$:()=>isFailureMessage,YO:()=>castAssistantQuery});var _queries_schema__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/queries/schema.ts"),_queries_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/queries/utils.ts");function isVisualizationMessage(message){return message?.type===_queries_schema__WEBPACK_IMPORTED_MODULE_0__.pj.Visualization}function isHumanMessage(message){return message?.type===_queries_schema__WEBPACK_IMPORTED_MODULE_0__.pj.Human}function isAssistantMessage(message){return message?.type===_queries_schema__WEBPACK_IMPORTED_MODULE_0__.pj.Assistant}function isFailureMessage(message){return message?.type===_queries_schema__WEBPACK_IMPORTED_MODULE_0__.pj.Failure}function castAssistantQuery(query){return(0,_queries_utils__WEBPACK_IMPORTED_MODULE_1__.kX)(query),query}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/max/Max.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".InsightVizDisplay{flex:1}",""]),module.exports=exports}}]);
//# sourceMappingURL=90710.586d20c7.iframe.bundle.js.map