(window.webpackJsonp=window.webpackJsonp||[]).push([[272],{"./frontend/src/scenes/instance/DeadLetterQueue/DeadLetterQueue.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"DeadLetterQueue",(function(){return DeadLetterQueue}));var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),tabs=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/tabs/index.js"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js");let DeadLetterQueueTab=function(DeadLetterQueueTab){return DeadLetterQueueTab.Metrics="metrics",DeadLetterQueueTab.Management="management",DeadLetterQueueTab.Settings="settings",DeadLetterQueueTab}({});const deadLetterQueueLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","instance","DeadLetterQueue","deadLetterQueueLogic"]),Object(index_esm.actions)({setActiveTab:tabKey=>({tabKey:tabKey}),loadMoreRows:key=>({key:key}),addRowsToMetric:(key,rows)=>({key:key,rows:rows})}),Object(index_esm.reducers)({activeTab:[DeadLetterQueueTab.Metrics,{setActiveTab:(_,_ref)=>{let{tabKey:tabKey}=_ref;return tabKey}}],rowsPerMetric:[{},{addRowsToMetric:(state,_ref2)=>{let{key:key,rows:rows}=_ref2;return{...state,[key]:[...state[key]||[],...rows]}},loadDeadLetterQueueMetricsSuccess:(_,_ref3)=>{let{deadLetterQueueMetrics:deadLetterQueueMetrics}=_ref3;const rowsPerMetric={};for(const metric of deadLetterQueueMetrics)metric.subrows&&(rowsPerMetric[metric.key]=metric.subrows.rows);return rowsPerMetric}}]}),Object(lib.loaders)({deadLetterQueueMetrics:[[],{loadDeadLetterQueueMetrics:async()=>{var _userLogic$values$use;return null!==(_userLogic$values$use=userLogic.a.values.user)&&void 0!==_userLogic$values$use&&_userLogic$values$use.is_staff?(await api.b.get("api/dead_letter_queue")).results:[]}}]}),Object(index_esm.listeners)((_ref4=>{let{values:values,actions:actions}=_ref4;return{loadMoreRows:async _ref5=>{var _values$rowsPerMetric;let{key:key}=_ref5;const offset=(null===(_values$rowsPerMetric=values.rowsPerMetric[key])||void 0===_values$rowsPerMetric?void 0:_values$rowsPerMetric.length)+1;if(offset){const res=await api.b.get(`api/dead_letter_queue/${key}?offset=${offset}`);actions.addRowsToMetric(key,res.subrows.rows)}}}})),Object(index_esm.selectors)({singleValueMetrics:[s=>[s.deadLetterQueueMetrics],deadLetterQueueMetrics=>deadLetterQueueMetrics.filter((metric=>!metric.subrows))],tableMetrics:[s=>[s.deadLetterQueueMetrics],deadLetterQueueMetrics=>deadLetterQueueMetrics.filter((metric=>!!metric.subrows))]}),Object(index_esm.afterMount)((_ref6=>{let{actions:actions}=_ref6;actions.loadDeadLetterQueueMetrics()}))]);var es_row=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/row/index.js"),col=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/col/index.js"),defineProperty=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),esm_extends=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/extends.js"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),classnames=__webpack_require__("./node_modules/.pnpm/classnames@2.3.1/node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),context=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/config-provider/context.js"),skeleton=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/skeleton/index.js"),padEnd=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/padEnd.js"),padEnd_default=__webpack_require__.n(padEnd),statistic_Number=function StatisticNumber(props){var valueNode,value=props.value,formatter=props.formatter,precision=props.precision,decimalSeparator=props.decimalSeparator,_props$groupSeparator=props.groupSeparator,groupSeparator=void 0===_props$groupSeparator?"":_props$groupSeparator,prefixCls=props.prefixCls;if("function"==typeof formatter)valueNode=formatter(value);else{var val=String(value),cells=val.match(/^(-?)(\d*)(\.(\d+))?$/);if(cells&&"-"!==val){var negative=cells[1],int=cells[2]||"0",decimal=cells[4]||"";int=int.replace(/\B(?=(\d{3})+(?!\d))/g,groupSeparator),"number"==typeof precision&&(decimal=padEnd_default()(decimal,precision,"0").slice(0,precision)),decimal&&(decimal="".concat(decimalSeparator).concat(decimal)),valueNode=[react.createElement("span",{key:"int",className:"".concat(prefixCls,"-content-value-int")},negative,int),decimal&&react.createElement("span",{key:"decimal",className:"".concat(prefixCls,"-content-value-decimal")},decimal)]}else valueNode=val}return react.createElement("span",{className:"".concat(prefixCls,"-content-value")},valueNode)},Statistic_Statistic=function Statistic(props){var prefixCls=props.prefixCls,className=props.className,style=props.style,valueStyle=props.valueStyle,_props$value=props.value,value=void 0===_props$value?0:_props$value,title=props.title,valueRender=props.valueRender,prefix=props.prefix,suffix=props.suffix,loading=props.loading,direction=props.direction,onMouseEnter=props.onMouseEnter,onMouseLeave=props.onMouseLeave,valueNode=react.createElement(statistic_Number,Object(esm_extends.a)({},props,{value:value})),cls=classnames_default()(prefixCls,Object(defineProperty.a)({},"".concat(prefixCls,"-rtl"),"rtl"===direction),className);return react.createElement("div",{className:cls,style:style,onMouseEnter:onMouseEnter,onMouseLeave:onMouseLeave},title&&react.createElement("div",{className:"".concat(prefixCls,"-title")},title),react.createElement(skeleton.a,{paragraph:!1,loading:loading},react.createElement("div",{style:valueStyle,className:"".concat(prefixCls,"-content")},prefix&&react.createElement("span",{className:"".concat(prefixCls,"-content-prefix")},prefix),valueRender?valueRender(valueNode):valueNode,suffix&&react.createElement("span",{className:"".concat(prefixCls,"-content-suffix")},suffix))))};Statistic_Statistic.defaultProps={decimalSeparator:".",groupSeparator:",",loading:!1};var statistic_Statistic=Object(context.c)({prefixCls:"statistic"})(Statistic_Statistic),classCallCheck=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),createClass=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/createClass.js"),inherits=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/inherits.js"),createSuper=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/createSuper.js"),slicedToArray=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),padStart=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/padStart.js"),padStart_default=__webpack_require__.n(padStart),timeUnits=[["Y",31536e6],["M",2592e6],["D",864e5],["H",36e5],["m",6e4],["s",1e3],["S",1]];function formatCountdown(value,config){var _config$format=config.format,format=void 0===_config$format?"":_config$format,target=new Date(value).getTime(),current=Date.now();return function formatTimeStr(duration,format){var leftDuration=duration,escapeRegex=/\[[^\]]*]/g,keepList=(format.match(escapeRegex)||[]).map((function(str){return str.slice(1,-1)})),templateText=format.replace(escapeRegex,"[]"),replacedText=timeUnits.reduce((function(current,_ref){var _ref2=Object(slicedToArray.a)(_ref,2),name=_ref2[0],unit=_ref2[1];if(-1!==current.indexOf(name)){var value=Math.floor(leftDuration/unit);return leftDuration-=value*unit,current.replace(new RegExp("".concat(name,"+"),"g"),(function(match){var len=match.length;return padStart_default()(value.toString(),len,"0")}))}return current}),templateText),index=0;return replacedText.replace(escapeRegex,(function(){var match=keepList[index];return index+=1,match}))}(Math.max(target-current,0),format)}var reactNode=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/_util/reactNode.js");function getTime(value){return new Date(value).getTime()}var Countdown_Countdown=function(_React$Component){Object(inherits.a)(Countdown,_React$Component);var _super=Object(createSuper.a)(Countdown);function Countdown(){var _this;return Object(classCallCheck.a)(this,Countdown),(_this=_super.apply(this,arguments)).syncTimer=function(){getTime(_this.props.value)>=Date.now()?_this.startTimer():_this.stopTimer()},_this.startTimer=function(){if(!_this.countdownId){var _this$props=_this.props,onChange=_this$props.onChange,timestamp=getTime(_this$props.value);_this.countdownId=window.setInterval((function(){_this.forceUpdate(),onChange&&timestamp>Date.now()&&onChange(timestamp-Date.now())}),33.333333333333336)}},_this.stopTimer=function(){var _this$props2=_this.props,onFinish=_this$props2.onFinish,value=_this$props2.value;if(_this.countdownId){clearInterval(_this.countdownId),_this.countdownId=void 0;var timestamp=getTime(value);onFinish&&timestamp<Date.now()&&onFinish()}},_this.formatCountdown=function(value,config){var format=_this.props.format;return formatCountdown(value,Object(esm_extends.a)(Object(esm_extends.a)({},config),{format:format}))},_this.valueRender=function(node){return Object(reactNode.a)(node,{title:void 0})},_this}return Object(createClass.a)(Countdown,[{key:"componentDidMount",value:function componentDidMount(){this.syncTimer()}},{key:"componentDidUpdate",value:function componentDidUpdate(){this.syncTimer()}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.stopTimer()}},{key:"render",value:function render(){return react.createElement(statistic_Statistic,Object(esm_extends.a)({valueRender:this.valueRender},this.props,{formatter:this.formatCountdown}))}}]),Countdown}(react.Component);Countdown_Countdown.defaultProps={format:"HH:mm:ss"};var statistic_Countdown=Countdown_Countdown;statistic_Statistic.Countdown=statistic_Countdown;var statistic=statistic_Statistic,divider=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/divider/index.js"),es_button=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/button/index.js"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function MetricsTab(){const{user:user}=Object(index_esm.useValues)(userLogic.a),{singleValueMetrics:singleValueMetrics,tableMetrics:tableMetrics,deadLetterQueueMetricsLoading:deadLetterQueueMetricsLoading,rowsPerMetric:rowsPerMetric}=Object(index_esm.useValues)(deadLetterQueueLogic),{loadDeadLetterQueueMetrics:loadDeadLetterQueueMetrics,loadMoreRows:loadMoreRows}=Object(index_esm.useActions)(deadLetterQueueLogic);return null!=user&&user.is_staff?Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("br",{}),Object(jsx_runtime.jsx)("div",{className:"mb-4 float-right",children:Object(jsx_runtime.jsx)(LemonButton.a,{icon:deadLetterQueueMetricsLoading?Object(jsx_runtime.jsx)(Spinner.a,{}):Object(jsx_runtime.jsx)(icons.Ec,{}),onClick:loadDeadLetterQueueMetrics,type:"secondary",size:"small",children:"Refresh"})}),Object(jsx_runtime.jsx)(es_row.a,{gutter:32,children:singleValueMetrics.map((row=>Object(jsx_runtime.jsx)(col.a,{children:Object(jsx_runtime.jsx)(statistic,{title:row.metric,value:(row.value||"0").toLocaleString("en-US"),loading:deadLetterQueueMetricsLoading})},row.key)))}),Object(jsx_runtime.jsx)(divider.a,{}),tableMetrics.map((row=>{var _row$subrows,_row$subrows2;return Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("h2",{children:row.metric}),Object(jsx_runtime.jsx)(LemonTable.a,{columns:[{title:null===(_row$subrows=row.subrows)||void 0===_row$subrows?void 0:_row$subrows.columns[0],dataIndex:"key"},{title:null===(_row$subrows2=row.subrows)||void 0===_row$subrows2?void 0:_row$subrows2.columns[1],dataIndex:"value"}],dataSource:rowsPerMetric[row.key].map((_ref=>{let[key,value]=_ref;return{key:key,value:value}}))||[],loading:deadLetterQueueMetricsLoading,defaultSorting:{columnKey:"value",order:-1},embedded:!0}),Object(jsx_runtime.jsx)("div",{style:{margin:"1rem",textAlign:"center"},children:Object(jsx_runtime.jsx)(es_button.a,{disabled:rowsPerMetric[row.key].length%10!=0,onClick:()=>loadMoreRows(row.key),children:"Load more values"})}),Object(jsx_runtime.jsx)(divider.a,{})]},row.key)}))]}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{})}const scene={component:DeadLetterQueue,logic:deadLetterQueueLogic},{TabPane:TabPane}=tabs.a;function DeadLetterQueue(){const{user:user}=Object(index_esm.useValues)(userLogic.a),{activeTab:activeTab}=Object(index_esm.useValues)(deadLetterQueueLogic),{setActiveTab:setActiveTab}=Object(index_esm.useActions)(deadLetterQueueLogic);return null!=user&&user.is_staff?Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:"Dead Letter Queue",caption:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsx)("p",{children:"Manage your instance's dead letter queue."})})}),Object(jsx_runtime.jsx)(tabs.a,{activeKey:activeTab,onChange:key=>setActiveTab(key),children:Object(jsx_runtime.jsx)(TabPane,{tab:"Metrics"},DeadLetterQueueTab.Metrics)}),activeTab===DeadLetterQueueTab.Metrics?Object(jsx_runtime.jsx)(MetricsTab,{}):null]}):Object(jsx_runtime.jsx)(PageHeader.a,{title:"Dead Letter Queue",caption:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("p",{children:"Only users with staff access can manage the dead letter queue. Please contact your instance admin."}),Object(jsx_runtime.jsxs)("p",{children:["If you're an admin and don't have access, set ",Object(jsx_runtime.jsx)("code",{children:"is_staff=true"})," for your user on the PostgreSQL ",Object(jsx_runtime.jsx)("code",{children:"posthog_user"})," table."]})]})})}},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_asciiSize.js":function(module,exports,__webpack_require__){var asciiSize=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseProperty.js")("length");module.exports=asciiSize},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseRepeat.js":function(module,exports){var nativeFloor=Math.floor;module.exports=function baseRepeat(string,n){var result="";if(!string||n<1||n>9007199254740991)return result;do{n%2&&(result+=string),(n=nativeFloor(n/2))&&(string+=string)}while(n);return result}},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_createPadding.js":function(module,exports,__webpack_require__){var baseRepeat=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseRepeat.js"),baseToString=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseToString.js"),castSlice=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_castSlice.js"),hasUnicode=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_hasUnicode.js"),stringSize=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringSize.js"),stringToArray=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringToArray.js"),nativeCeil=Math.ceil;module.exports=function createPadding(length,chars){var charsLength=(chars=void 0===chars?" ":baseToString(chars)).length;if(charsLength<2)return charsLength?baseRepeat(chars,length):chars;var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringSize.js":function(module,exports,__webpack_require__){var asciiSize=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_asciiSize.js"),hasUnicode=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_hasUnicode.js"),unicodeSize=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_unicodeSize.js");module.exports=function stringSize(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string)}},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_unicodeSize.js":function(module,exports){var rsAstral="[\\ud800-\\udfff]",rsCombo="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsNonAstral="[^\\ud800-\\udfff]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",reOptMod="(?:"+rsCombo+"|"+rsFitz+")"+"?",rsSeq="[\\ufe0e\\ufe0f]?"+reOptMod+("(?:\\u200d(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")[\\ufe0e\\ufe0f]?"+reOptMod+")*"),rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")",reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");module.exports=function unicodeSize(string){for(var result=reUnicode.lastIndex=0;reUnicode.test(string);)++result;return result}},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/padEnd.js":function(module,exports,__webpack_require__){var createPadding=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_createPadding.js"),stringSize=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringSize.js"),toInteger=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toInteger.js"),toString=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toString.js");module.exports=function padEnd(string,length,chars){string=toString(string);var strLength=(length=toInteger(length))?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/padStart.js":function(module,exports,__webpack_require__){var createPadding=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_createPadding.js"),stringSize=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringSize.js"),toInteger=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toInteger.js"),toString=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toString.js");module.exports=function padStart(string,length,chars){string=toString(string);var strLength=(length=toInteger(length))?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string}},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toFinite.js":function(module,exports,__webpack_require__){var toNumber=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toNumber.js");module.exports=function toFinite(value){return value?Infinity===(value=toNumber(value))||-Infinity===value?17976931348623157e292*(value<0?-1:1):value==value?value:0:0===value?value:0}},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toInteger.js":function(module,exports,__webpack_require__){var toFinite=__webpack_require__("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toFinite.js");module.exports=function toInteger(value){var result=toFinite(value),remainder=result%1;return result==result?remainder?result-remainder:result:0}}}]);