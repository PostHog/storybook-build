(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{"./frontend/src/lib/components/RestrictedArea.tsx":function(ye,T,t){"use strict";t.d(T,"b",function(){return j}),t.d(T,"a",function(){return J});var U=t("./node_modules/core-js/modules/es.array.concat.js"),N=t.n(U),H=t("./node_modules/kea/lib/index.esm.js"),O=t("./node_modules/react/index.js"),e=t.n(O),D=t("./frontend/src/scenes/organizationLogic.tsx"),X=t("./frontend/src/lib/constants.tsx"),se=t("./frontend/src/lib/components/Tooltip.tsx"),_=t("./frontend/src/lib/utils/permissioning.ts"),w=t("./frontend/src/scenes/teamLogic.tsx"),j;(function(x){x.Organization="organization",x.Project="project"})(j||(j={}));function J(x){var le=x.Component,q=x.minimumAccessLevel,ce=x.scope,Q=ce===void 0?j.Organization:ce,B=Object(H.useValues)(D.a),v=B.currentOrganization,ee=Object(H.useValues)(w.a),K=ee.currentTeam,W=Object(O.useMemo)(function(){var I;if(Q===j.Project){if(!K)return"Loading current project\u2026";I=K.effective_membership_level}else{if(!v)return"Loading current organization\u2026";I=v.membership_level}return I===null?"You don't have access to the current ".concat(Q,"."):I<q?q===X.m.Owner?"This area is restricted to the ".concat(Q," owner."):"This area is restricted to ".concat(Q," ").concat(_.b.get(q),"s and up. Your level is ").concat(_.b.get(I),"."):null},[v]);return W?e.a.createElement(se.a,{title:W,placement:"topLeft",delayMs:0},e.a.createElement("span",null,e.a.createElement(le,{isRestricted:!0,restrictionReason:W}))):e.a.createElement(le,{isRestricted:!1,restrictionReason:null})}try{J.displayName="RestrictedArea",J.__docgenInfo={description:"",displayName:"RestrictedArea",props:{Component:{defaultValue:null,description:"",name:"Component",required:!0,type:{name:"(props: RestrictedComponentProps) => Element"}},minimumAccessLevel:{defaultValue:null,description:"",name:"minimumAccessLevel",required:!0,type:{name:"enum",value:[{value:"1"},{value:"8"},{value:"15"},{value:"1"},{value:"8"}]}},scope:{defaultValue:{value:"RestrictionScope.Organization"},description:"",name:"scope",required:!1,type:{name:"enum",value:[{value:'"organization"'},{value:'"project"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"]={docgenInfo:J.__docgenInfo,name:"RestrictedArea",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"})}catch(x){}try{j.Organization.displayName="RestrictionScope.Organization",j.Organization.__docgenInfo={description:"Current organization-wide membership level will be used.",displayName:"RestrictionScope.Organization",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"]={docgenInfo:j.Organization.__docgenInfo,name:"RestrictionScope.Organization",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"})}catch(x){}try{j.Project.displayName="RestrictionScope.Project",j.Project.__docgenInfo={description:"Effective level for the current project will be used.",displayName:"RestrictionScope.Project",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"]={docgenInfo:j.Project.__docgenInfo,name:"RestrictionScope.Project",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"})}catch(x){}},"./frontend/src/lib/hooks/useAnchor.ts":function(ye,T,t){"use strict";t.d(T,"a",function(){return H});var U=t("./node_modules/react/index.js"),N=t.n(U);function H(O){Object(U.useEffect)(function(){if(O&&document.getElementById(O.substr(1))){var e=document.getElementById(O.substr(1));if(!e)return;e.classList.add("highlighted");var D=e.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:D-50-32,behavior:"smooth"})}},[O])}},"./frontend/src/scenes/organization/Settings/index.tsx":function(ye,T,t){"use strict";t.r(T),t.d(T,"scene",function(){return mn}),t.d(T,"OrganizationSettings",function(){return Ve});var U=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),N=t.n(U),H=t("./node_modules/core-js/modules/es.function.name.js"),O=t("./node_modules/react/index.js"),e=t.n(O),D=t("./node_modules/antd/es/input/index.js"),X=t("./node_modules/antd/es/button/index.js"),se=t("./node_modules/antd/es/switch/index.js"),_=t("./node_modules/antd/es/card/index.js"),w=t("./node_modules/antd/es/divider/index.js"),j=t("./frontend/src/lib/components/PageHeader.tsx"),J=t("./node_modules/core-js/modules/es.array.iterator.js"),x=t("./node_modules/core-js/modules/es.object.to-string.js"),le=t("./node_modules/core-js/modules/es.string.iterator.js"),q=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),ce=t("./node_modules/core-js/modules/web.url.js"),Q=t("./node_modules/core-js/modules/web.url-search-params.js"),B=t("./node_modules/antd/es/modal/index.js"),v=t("./node_modules/kea/lib/index.esm.js"),ee=t("./node_modules/@ant-design/icons/es/icons/ExclamationCircleOutlined.js"),K=t("./frontend/src/lib/components/CopyToClipboard.tsx"),W=t("./frontend/src/lib/components/ProfilePicture/index.ts"),I=t("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),ze=t("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),de=t("./frontend/src/lib/components/LemonTable/index.ts"),he=t("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),Oe=t("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),A=t("./frontend/src/lib/components/LemonButton/index.ts"),V=t("./frontend/src/lib/components/icons.tsx");function Te(a,n){var o=new URL("/signup/".concat(a),document.baseURI).href;return n.is_expired?e.a.createElement("b",null,"Expired! Delete and recreate"):e.a.createElement(K.a,{"data-attr":"invite-link",description:"invite link"},o)}function Ie(a){return function(o,r){return e.a.createElement(A.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:e.a.createElement(V.IconClose,null),status:"danger",onClick:function(){r.is_expired?a(r):B.a.confirm({title:"Do you want to cancel the invite for ".concat(r.target_email,"?"),icon:e.a.createElement(ee.a,null),okText:"Yes, cancel invite",okType:"danger",onOk:function(){a(r)},cancelText:"No, keep invite"})}})}}function Pe(){var a=Object(v.useValues)(I.a),n=a.invites,o=a.invitesLoading,r=Object(v.useActions)(I.a),i=r.deleteInvite,l=r.showInviteModal,s=Object(v.useValues)(Oe.a),c=s.preflight,f=[{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(d,m){return m.target_email?e.a.createElement("div",{className:"flex items-center"},e.a.createElement(W.b,{name:m.first_name,email:m.target_email,size:"md",style:{marginRight:8}}),m.target_email,m.first_name?" (".concat(m.first_name,")"):""):e.a.createElement("i",null,"no one")},width:"20%"},Object(he.b)(),Object(he.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(d,m){return Te(m.id,m)}},{title:"",key:"actions",width:24,render:Ie(i)}];return e.a.createElement("div",null,e.a.createElement("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"}},"Pending Invites",e.a.createElement(A.a,{type:"primary",onClick:l,"data-attr":"invite-teammate-button"},"Invite team member")),!(c!=null&&c.email_service_available)&&e.a.createElement(ze.a,null),e.a.createElement(de.a,{dataSource:n,columns:f,rowKey:"id",loading:o,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."}))}var pn=t("./node_modules/core-js/modules/es.array.filter.js"),En=t("./node_modules/core-js/modules/es.array.map.js"),yn=t("./node_modules/core-js/modules/es.array.concat.js"),hn=t("./node_modules/core-js/modules/es.regexp.exec.js"),On=t("./node_modules/core-js/modules/es.string.search.js"),ue=t("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),be=t("./node_modules/@ant-design/icons/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),Ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"},we=Ne,Be=t("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),Se=function(n,o){return O.createElement(Be.a,Object(be.a)(Object(be.a)({},n),{},{ref:o,icon:we}))};Se.displayName="SwapOutlined";var Ke=O.forwardRef(Se),b=t("./frontend/src/lib/constants.tsx"),R=t("./frontend/src/scenes/organizationLogic.tsx"),je=t("./frontend/src/scenes/userLogic.ts"),Y=t("./frontend/src/lib/utils/permissioning.ts"),Fe=t("./frontend/src/lib/components/TimezoneAware/index.tsx"),Ae=t("./frontend/src/lib/components/LemonButton/More.tsx"),me=t("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Ue=t("./frontend/src/lib/components/LemonDivider/index.ts");function We(a,n){var o,r=Object(v.useValues)(je.a),i=r.user,l=Object(v.useValues)(R.a),s=l.currentOrganization,c=Object(v.useActions)(ue.a),f=c.removeMember,u=c.changeMemberAccessLevel;if(!i)return null;var d=(o=s==null?void 0:s.membership_level)!==null&&o!==void 0?o:-1,m=(d>=b.m.Admin&&n.level<=d||n.user.uuid===i.uuid)&&n.level!==b.m.Owner,h=s?s.membership_level:null,g=Y.c.filter(function(E){return!Object(Y.a)(h,i,n,E)}),z=Object(Y.a)(h,i,n,g);return e.a.createElement(Ae.a,{overlay:e.a.createElement(e.a.Fragment,null,z?e.a.createElement("div",null,z):g.map(function(E){return e.a.createElement(A.a,{status:"stealth",fullWidth:!0,key:"".concat(n.user.uuid,"-level-").concat(E),onClick:function(p){if(p.preventDefault(),!i)throw Error;if(E===b.m.Owner){var y;B.a.confirm({centered:!0,title:"Transfer organization ownership to ".concat(n.user.first_name,"?"),content:"You will no longer be the owner of ".concat((y=i.organization)===null||y===void 0?void 0:y.name,". After the transfer you will become an administrator."),icon:e.a.createElement(Ke,null),okType:"danger",okText:"Transfer Ownership",onOk:function(){u(n,E)}})}else u(n,E)},"data-test-level":E},E===b.m.Owner?e.a.createElement(e.a.Fragment,null,"Transfer organization ownership"):E>n.level?e.a.createElement(e.a.Fragment,null,"Upgrade to ",Y.b.get(E)):e.a.createElement(e.a.Fragment,null,"Downgrade to ",Y.b.get(E)))}),m?e.a.createElement(e.a.Fragment,null,e.a.createElement(Ue.a,null),e.a.createElement(A.a,{status:"danger","data-attr":"delete-org-membership",onClick:function(){var L;if(!i)throw Error;B.a.confirm({title:"".concat(n.user.uuid==i.uuid?"Leave":"Remove ".concat(n.user.first_name," from")," organization ").concat((L=i.organization)===null||L===void 0?void 0:L.name,"?"),icon:e.a.createElement(ee.a,null),okText:n.user.uuid==i.uuid?"Leave":"Remove",okType:"danger",cancelText:"Cancel",onOk:function(){f(n)}})},fullWidth:!0},n.user.uuid!==i.uuid?"Remove from organization":"Leave organization")):null)})}function ne(a){var n=a.user,o=Object(v.useValues)(ue.a),r=o.filteredMembers,i=o.membersLoading,l=o.search,s=Object(v.useActions)(ue.a),c=s.setSearch,f=[{key:"user_profile_picture",render:function(d,m){return e.a.createElement(W.b,{name:m.user.first_name,email:m.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(d,m){return m.user.uuid==n.uuid?"".concat(m.user.first_name," (me)"):m.user.first_name},sorter:function(d,m){return d.user.first_name.localeCompare(m.user.first_name)}},{title:"Email",key:"user_email",render:function(d,m){return m.user.email},sorter:function(d,m){return d.user.email.localeCompare(m.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(d,m){var h;return e.a.createElement(me.a,{"data-attr":"membership-level"},m.level===b.m.Owner?"Organization owner":"Project ".concat((h=Y.b.get(m.level))!==null&&h!==void 0?h:"unknown (".concat(m.level,")")))},sorter:function(d,m){return d.level-m.level}},{title:"Joined",dataIndex:"joined_at",key:"joined_at",render:function(d){return e.a.createElement("div",{className:"whitespace-nowrap"},e.a.createElement(Fe.b,{time:d}))},sorter:function(d,m){return d.joined_at.localeCompare(m.joined_at)}},{key:"actions",width:0,render:We}];return e.a.createElement(e.a.Fragment,null,e.a.createElement("h2",{className:"subtitle"},"Members"),e.a.createElement(D.a.Search,{placeholder:"Search for members",allowClear:!0,enterButton:!0,style:{maxWidth:600,width:"initial",flexGrow:1,marginRight:12},value:l,onChange:function(d){c(d.target.value)}}),e.a.createElement(de.a,{dataSource:r,columns:f,rowKey:"id",style:{marginTop:"1rem"},loading:i,"data-attr":"org-members-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}}))}try{ne.displayName="Members",ne.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:ne.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(a){}var Ye=t("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),$e=t("./node_modules/antd/lib/typography/Paragraph.js"),Ze=t.n($e);function te(a){var n=a.isVisible,o=a.setIsVisible,r=Object(v.useValues)(R.a),i=r.currentOrganization,l=r.organizationBeingDeleted,s=Object(v.useActions)(R.a),c=s.deleteOrganization,f=Object(O.useState)(!1),u=N()(f,2),d=u[0],m=u[1],h=!!i&&(l==null?void 0:l.id)===i.id;return e.a.createElement(B.a,{title:"Delete the entire organization?",okText:"Delete ".concat(i?i.name:"the current organization"),onOk:i?function(){return c(i)}:void 0,okType:"primary",okButtonProps:{"data-attr":"delete-organization-ok",loading:h,disabled:!d,className:"btn-danger"},onCancel:function(){return o(!1)},cancelButtonProps:{disabled:h},visible:n},e.a.createElement("p",null,"Organization deletion ",e.a.createElement("b",null,"cannot be undone"),". You will lose all data, ",e.a.createElement("b",null,"including all events"),", related to all projects within this organization."),e.a.createElement("p",null,"Please type"," ",e.a.createElement("strong",null,i?i.name:"this organization's name")," to confirm."),e.a.createElement(D.a,{type:"text",onChange:function(z){if(i){var E=z.target.value;m(E.toLowerCase()===i.name.toLowerCase())}}}))}function ae(a){var n=a.isRestricted,o=Object(v.useValues)(R.a),r=o.currentOrganization,i=Object(O.useState)(!1),l=N()(i,2),s=l[0],c=l[1];return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{style:{color:"var(--danger)"}},e.a.createElement("h2",{style:{color:"var(--danger)"},className:"subtitle"},"Danger Zone"),e.a.createElement("div",{className:"mt-4"},!n&&e.a.createElement(Ze.a,{type:"danger"},"This is ",e.a.createElement("b",null,"irreversible"),". Please be certain."),e.a.createElement(X.a,{type:"primary",onClick:function(){return c(!0)},className:"mr-2 btn-danger","data-attr":"delete-project-button",icon:e.a.createElement(Ye.a,null),disabled:n},"Delete ",(r==null?void 0:r.name)||"the current organization"))),e.a.createElement(te,{isVisible:s,setIsVisible:c}))}try{te.displayName="DeleteOrganizationModal",te.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isVisible:{defaultValue:null,description:"",name:"isVisible",required:!0,type:{name:"boolean"}},setIsVisible:{defaultValue:null,description:"",name:"setIsVisible",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:te.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(a){}try{ae.displayName="DangerZone",ae.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:ae.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(a){}var re=t("./frontend/src/lib/components/RestrictedArea.tsx"),Ge=t("./frontend/src/lib/hooks/useAnchor.ts"),ke=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ie=t.n(ke),fe=t("./frontend/src/lib/components/Tooltip.tsx"),bn=t("./node_modules/core-js/modules/es.object.keys.js"),Sn=t("./node_modules/core-js/modules/es.symbol.js"),jn=t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),An=t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Cn=t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),He=t("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),Je=t.n(He),Qe=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),Xe=t.n(Qe),_e=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),$=t.n(_e),qe=t("./node_modules/@babel/runtime/regenerator/index.js"),C=t.n(qe),Ln=t("./node_modules/core-js/modules/es.array.sort.js"),Dn=t("./node_modules/core-js/modules/es.array.find.js"),Mn=t("./node_modules/core-js/modules/es.array.includes.js"),xn=t("./node_modules/core-js/modules/es.string.includes.js"),Vn=t("./node_modules/core-js/modules/es.string.match.js"),Z=t("./frontend/src/lib/api.ts"),oe=t("./frontend/src/lib/components/lemonToast.tsx"),Ce=t("./frontend/src/types.ts"),Le=t("./node_modules/kea-forms/lib/index.js"),en=t("./node_modules/kea-loaders/lib/index.js"),nn=["id"];function De(a,n){var o=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);n&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),o.push.apply(o,r)}return o}function ve(a){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?De(Object(o),!0).forEach(function(r){Xe()(a,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):De(Object(o)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(o,r))})}return a}var M=Object(v.kea)([Object(v.path)(["scenes","organization","verifiedDomainsLogic"]),Object(v.connect)({values:[R.a,["currentOrganization"]]}),Object(v.actions)({replaceDomain:function(n){return{domain:n}},setAddModalShown:function(n){return{shown:n}},setConfigureSAMLModalId:function(n){return{id:n}},setVerifyModal:function(n){return{id:n}}}),Object(v.reducers)({verifiedDomains:[[],{replaceDomain:function(n,o){var r=o.domain,i=[].concat(ie()(n.filter(function(l){var s=l.id;return s!==r.id})),[r]);return i.sort(function(l,s){return l.domain.localeCompare(s.domain)}),i}}],addModalShown:[!1,{setAddModalShown:function(n,o){var r=o.shown;return r},addVerifiedDomainSuccess:function(){return!1}}],configureSAMLModalId:[null,{setConfigureSAMLModalId:function(n,o){var r=o.id;return r}}],verifyModal:[null,{setVerifyModal:function(n,o){var r=o.id;return r}}]}),Object(en.loaders)(function(a){var n=a.values,o=a.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var r=$()(C.a.mark(function l(){var s;return C.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Z.b.get("api/organizations/".concat((s=n.currentOrganization)===null||s===void 0?void 0:s.id,"/domains"));case 2:return f.abrupt("return",f.sent.results);case 3:case"end":return f.stop()}},l)}));function i(){return r.apply(this,arguments)}return i}(),addVerifiedDomain:function(){var r=$()(C.a.mark(function l(s){var c,f;return C.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,Z.b.create("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains"),{domain:s});case 2:return f=d.sent,d.abrupt("return",[f].concat(ie()(n.verifiedDomains)));case 4:case"end":return d.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}(),deleteVerifiedDomain:function(){var r=$()(C.a.mark(function l(s){var c;return C.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,Z.b.delete("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s));case 2:return u.abrupt("return",ie()(n.verifiedDomains.filter(function(d){return d.id!==s})));case 3:case"end":return u.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}()}],updatingDomain:[!1,{updateDomain:function(){var r=$()(C.a.mark(function l(s){var c,f;return C.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,Z.b.update("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s.id),ve(ve({},s),{},{id:void 0}));case 2:return f=d.sent,oe.d.success("Domain updated successfully! Changes will take immediately."),o.replaceDomain(f),d.abrupt("return",!1);case 6:case"end":return d.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}(),verifyDomain:function(){var r=$()(C.a.mark(function l(){var s,c;return C.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,Z.b.create("api/organizations/".concat((s=n.currentOrganization)===null||s===void 0?void 0:s.id,"/domains/").concat(n.verifyModal,"/verify"));case 2:return c=u.sent,c.is_verified?oe.d.success("Domain verified successfully."):oe.d.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),o.replaceDomain(c),o.setVerifyModal(null),u.abrupt("return",!1);case 7:case"end":return u.stop()}},l)}));function i(){return r.apply(this,arguments)}return i}()}]}}),Object(v.listeners)(function(a){var n=a.actions,o=a.values;return{setConfigureSAMLModalId:function(i){var l=i.id,s=o.verifiedDomains.find(function(d){var m=d.id;return m===l});if(l&&s){var c=s.saml_acs_url,f=s.saml_entity_id,u=s.saml_x509_cert;n.setSamlConfigValues({saml_acs_url:c,saml_entity_id:f,saml_x509_cert:u,id:l})}}}}),Object(v.selectors)({domainBeingVerified:[function(a){return[a.verifiedDomains,a.verifyModal]},function(a,n){return n&&a.find(function(o){var r=o.id;return r===n})||null}],isSSOEnforcementAvailable:[function(a){return[a.currentOrganization]},function(a){var n;return(n=a==null?void 0:a.available_features.includes(Ce.d.SSO_ENFORCEMENT))!==null&&n!==void 0?n:!1}],isSAMLAvailable:[function(a){return[a.currentOrganization]},function(a){var n;return(n=a==null?void 0:a.available_features.includes(Ce.d.SAML))!==null&&n!==void 0?n:!1}]}),Object(v.afterMount)(function(a){var n=a.actions;return n.loadVerifiedDomains()}),Object(Le.forms)(function(a){var n=a.actions,o=a.values;return{samlConfig:{defaults:{},errors:function(i){return{saml_acs_url:i.saml_acs_url&&!i.saml_acs_url.match(b.u)?"Please enter a valid URL, including https://":void 0}},submit:function(){var r=$()(C.a.mark(function l(s,c){var f,u,d,m;return C.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(u=s.id,d=Je()(s,nn),u){g.next=3;break}return g.abrupt("return");case 3:return g.next=5,Z.b.update("api/organizations/".concat((f=o.currentOrganization)===null||f===void 0?void 0:f.id,"/domains/").concat(s.id),ve({},d));case 5:m=g.sent,c(),n.replaceDomain(m),n.setConfigureSAMLModalId(null),n.setSamlConfigValues({}),oe.d.success("SAML configuration for ".concat(m.domain," updated successfully."));case 11:case"end":return g.stop()}},l)}));function i(l,s){return r.apply(this,arguments)}return i}()}}})]),ge=t("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),pe=t("./frontend/src/lib/components/LemonModal/LemonModal.tsx");function tn(){var a=Object(v.useValues)(M),n=a.addModalShown,o=a.verifiedDomainsLoading,r=Object(v.useActions)(M),i=r.setAddModalShown,l=r.addVerifiedDomain,s=Object(O.useState)(""),c=N()(s,2),f=c[0],u=c[1],d=Object(O.useState)(!1),m=N()(d,2),h=m[0],g=m[1],z=!f||!f.match(b.c),E=function(){u(""),g(!1)},L=function(){i(!1),E()},p=function(){g(!0),z||(l(f),E())};return e.a.createElement(pe.a,{onCancel:L,visible:n,destroyOnClose:!0},e.a.createElement("section",null,e.a.createElement("h5",null,"Add authentication domain"),e.a.createElement(D.a,{placeholder:"posthog.com",autoFocus:!0,value:f,onChange:function(S){return u(S.target.value)},onPressEnter:p}),h&&z&&e.a.createElement("span",{className:"text-danger text-xs"},"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e.a.createElement(A.a,{type:"primary",disabled:f===""||h&&z||o,onClick:p},"Add domain"))))}var an=t("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx");function rn(){var a=Object(v.useValues)(M),n=a.domainBeingVerified,o=a.updatingDomainLoading,r=Object(v.useActions)(M),i=r.setVerifyModal,l=r.verifyDomain,s="_posthog-challenge.".concat(n==null?void 0:n.domain,".");return e.a.createElement(pe.a,{visible:!!n,onCancel:function(){return i(null)}},e.a.createElement("section",null,e.a.createElement("h5",null,"Verify your domain"),e.a.createElement(me.a,null,(n==null?void 0:n.domain)||""),e.a.createElement("p",{className:"text-muted-alt"},"To verify your domain, you need to add a record to your DNS zone."),e.a.createElement("div",null,e.a.createElement("ol",null,e.a.createElement("li",null,"Sign in to your DNS provider."),e.a.createElement("li",null,"Add the following ",e.a.createElement("b",null,"TXT")," record.",e.a.createElement("div",{className:"my-4"},e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-name"},"Name"),e.a.createElement("div",{className:"flex items-center"},e.a.createElement(D.a,{disabled:!0,value:s,name:"record-name"}),e.a.createElement(K.a,{explicitValue:s,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"Value or content"),e.a.createElement("div",{className:"flex items-center"},e.a.createElement(D.a,{disabled:!0,value:n==null?void 0:n.verification_challenge,name:"record-value"}),e.a.createElement(K.a,{explicitValue:n==null?void 0:n.verification_challenge,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"TTL"),e.a.createElement("div",{className:"flex items-center"},e.a.createElement(D.a,{disabled:!0,value:"Default or 3600",name:"record-value"}),e.a.createElement(K.a,{explicitValue:"3600",style:{marginLeft:4}}))))),e.a.createElement("li",null,"Press verify below."))),e.a.createElement("div",{className:"flex justif-end gap-2"},e.a.createElement(A.a,{onClick:function(){return i(null)}},"Verify later"),e.a.createElement(A.a,{type:"primary",disabled:o,onClick:l},"Verify"))))}var Me=t("./frontend/src/lib/components/Link.tsx"),on=t("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),Ee=t("./frontend/src/lib/forms/Field.tsx"),sn=t("./frontend/src/lib/components/AlertMessage/index.ts"),xe=t("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),ln=t("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx");function cn(){var a=Object(v.useValues)(M),n=a.configureSAMLModalId,o=a.isSamlConfigSubmitting,r=a.samlConfig,i=Object(v.useActions)(M),l=i.setConfigureSAMLModalId,s=r.saml_acs_url&&r.saml_entity_id&&r.saml_x509_cert,c=function(){l(null)};return e.a.createElement(pe.a,{onCancel:c,visible:!!n,destroyOnClose:!0},e.a.createElement("section",null,e.a.createElement("h5",null,"Configure SAML authentication and provisioning"),e.a.createElement(Le.Form,{logic:M,formKey:"samlConfig",className:"ant-form-vertical ant-form-hide-required-mark"},e.a.createElement(Ee.a,{name:"saml_acs_url",label:"SAML ACS URL"},e.a.createElement(xe.a,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})),e.a.createElement(Ee.a,{name:"saml_entity_id",label:"SAML Entity ID"},e.a.createElement(xe.a,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})),e.a.createElement(Ee.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate"},e.a.createElement(ln.a,{className:"ph-ignore-input",minRows:10,placeholder:`Enter the public certificate of your IdP. Keep all line breaks.
-----BEGIN CERTIFICATE-----
MIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL
-----END CERTIFICATE-----`})),!s&&e.a.createElement(sn.a,{type:"info",style:{marginBottom:16}},"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft."),e.a.createElement("div",{className:"flex justify-end"},e.a.createElement(A.a,{loading:o,type:"primary",htmlType:"submit"},"Save settings")))))}var G={marginRight:4,fontSize:"1.15em",paddingTop:2};function dn(){var a=Object(v.useValues)(M),n=a.verifiedDomainsLoading,o=a.updatingDomainLoading,r=Object(v.useActions)(M),i=r.setAddModalShown;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"flex items-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("div",{id:"domain-whitelist"})," ",e.a.createElement("h2",{id:"authentication-domains",className:"subtitle"},"Authentication domains"),e.a.createElement("p",{className:"text-muted-alt"},"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains.")),e.a.createElement(A.a,{type:"primary",onClick:function(){return i(!0)},disabled:n||o},"Add domain")),e.a.createElement(un,null))}function un(){var a=Object(v.useValues)(M),n=a.verifiedDomains,o=a.verifiedDomainsLoading,r=a.currentOrganization,i=a.updatingDomainLoading,l=a.isSSOEnforcementAvailable,s=a.isSAMLAvailable,c=Object(v.useActions)(M),f=c.updateDomain,u=c.deleteVerifiedDomain,d=c.setVerifyModal,m=c.setConfigureSAMLModalId,h=Object(v.useValues)(Oe.a),g=h.preflight,z=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function(L,p){var y=p.domain;return e.a.createElement(me.a,{style:{textTransform:"lowercase"}},y)}}].concat(ie()(g!=null&&g.cloud?[{key:"is_verified",title:e.a.createElement(e.a.Fragment,null,"Verification",e.a.createElement(fe.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO)."},e.a.createElement(ge.a,{style:{marginLeft:4}}))),render:function(L,p){var y=p.is_verified,S=p.verified_at;return y?e.a.createElement("div",{className:"flex items-center text-success"},e.a.createElement(V.IconCheckmark,{style:G})," Verified"):S?e.a.createElement("div",{className:"flex items-center text-danger"},e.a.createElement(V.IconExclamation,{style:G})," Verification expired"):e.a.createElement("div",{className:"flex items-center text-warning"},e.a.createElement(V.IconWarningAmber,{style:G})," Pending verification")}}]:[]),[{key:"jit_provisioning_enabled",title:e.a.createElement(e.a.Fragment,null,"Automatic provisioning"," ",e.a.createElement(fe.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((r==null?void 0:r.name)||"this organization"," if it does not exist.")},e.a.createElement(ge.a,null))),render:function(L,p){var y=p.jit_provisioning_enabled,S=p.id,P=p.is_verified;return P?e.a.createElement("div",{className:"flex items-center"},e.a.createElement(on.a,{checked:y,disabled:i||!P,onChange:function(k){return f({id:S,jit_provisioning_enabled:k})},label:e.a.createElement("span",{className:"font-normal"},y?"Enabled":"Disabled")})):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable automatic provisioning")}},{key:"sso_enforcement",title:e.a.createElement(e.a.Fragment,null,"Enforce SSO"," ",e.a.createElement(fe.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider."},e.a.createElement(ge.a,null))),render:function(L,p,y){var S=p.sso_enforcement,P=p.is_verified,F=p.id,k=p.has_saml;return l?P?e.a.createElement(an.a,{value:S,loading:i,onChange:function(gn){return f({id:F,sso_enforcement:gn})},samlAvailable:k}):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):y===0?e.a.createElement(Me.a,{to:Object(b.A)(g==null?void 0:g.cloud).url,target:Object(b.A)(g==null?void 0:g.cloud).target,className:"flex items-center"},e.a.createElement(V.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"):e.a.createElement(e.a.Fragment,null)}},{key:"saml",title:"SAML",render:function(L,p,y){var S=p.is_verified,P=p.saml_acs_url,F=p.saml_entity_id,k=p.saml_x509_cert,Re=p.has_saml;return s?S?e.a.createElement(e.a.Fragment,null,Re?e.a.createElement("div",{className:"flex items-center text-success"},e.a.createElement(V.IconCheckmark,{style:G})," SAML enabled"):P||F||k?e.a.createElement("div",{className:"flex items-center text-warning"},e.a.createElement(V.IconWarningAmber,{style:G})," SAML partially configured"):e.a.createElement("div",{className:"flex items-center"},e.a.createElement(V.IconOffline,{style:G})," SAML not set up")):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):y===0?e.a.createElement(Me.a,{to:Object(b.A)(g==null?void 0:g.cloud).url,target:Object(b.A)(g==null?void 0:g.cloud).target,className:"flex items-center"},e.a.createElement(V.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"):e.a.createElement(e.a.Fragment,null)}},{key:"actions",width:32,align:"center",render:function(L,p){var y=p.is_verified,S=p.id,P=p.domain;return y?e.a.createElement(Ae.a,{overlay:e.a.createElement(e.a.Fragment,null,e.a.createElement(A.a,{status:"stealth",onClick:function(){return m(S)},fullWidth:!0,disabled:!s,title:s?void 0:"Upgrade to enable SAML"},"Configure SAML"),e.a.createElement(A.a,{status:"danger",onClick:function(){return B.a.confirm({title:"Remove ".concat(P,"?"),icon:null,okText:"Remove domain",okType:"primary",okButtonProps:{className:"btn-danger"},content:e.a.createElement("div",null,"This cannot be undone. If you have SAML configured or SSO enforced, it will be immediately disabled."),onOk:function(){u(S)},cancelText:"Cancel"})},fullWidth:!0},e.a.createElement(V.IconDelete,null)," Remove domain")),style:{display:"inline-block"}}):e.a.createElement(A.a,{type:"primary",onClick:function(){return d(S)}},"Verify")}}]);return e.a.createElement("div",null,e.a.createElement(de.a,{dataSource:n,columns:z,loading:o,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),e.a.createElement(tn,null),e.a.createElement(cn,null),e.a.createElement(rn,null))}var mn={component:Ve,logic:R.a};function fn(a){var n=a.isRestricted,o=Object(v.useValues)(R.a),r=o.currentOrganization,i=o.currentOrganizationLoading,l=Object(v.useActions)(R.a),s=l.updateOrganization,c=Object(O.useState)((r==null?void 0:r.name)||""),f=N()(c,2),u=f[0],d=f[1];return e.a.createElement("div",null,e.a.createElement("h2",{id:"name",className:"subtitle"},"Display Name"),e.a.createElement(D.a,{value:u,onChange:function(h){d(h.target.value)},style:{maxWidth:"40rem",marginBottom:"1rem",display:"block"},disabled:n}),e.a.createElement(X.a,{type:"primary",onClick:function(h){h.preventDefault(),s({name:u})},disabled:n||!u||!r||u===r.name,loading:i},"Rename Organization"))}function vn(a){var n=a.isRestricted,o=Object(v.useValues)(R.a),r=o.currentOrganization,i=o.currentOrganizationLoading,l=Object(v.useActions)(R.a),s=l.updateOrganization;return e.a.createElement("div",null,e.a.createElement("h2",{id:"notification-preferences",className:"subtitle"},"Notification Preferences"),e.a.createElement("div",null,e.a.createElement(se.a,{id:"is-member-join-email-enabled-switch","data-attr":"is-member-join-email-enabled-switch",onChange:function(f){s({is_member_join_email_enabled:f})},checked:r==null?void 0:r.is_member_join_email_enabled,loading:i,disabled:n||!r}),e.a.createElement("label",{style:{marginLeft:"10px"},htmlFor:"is-member-join-email-enabled-switch"},"Email all current members when a new member joins")))}function Ve(){var a=Object(v.useValues)(je.a),n=a.user;return Object(Ge.a)(location.hash),e.a.createElement(e.a.Fragment,null,e.a.createElement(j.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),e.a.createElement(_.a,null,e.a.createElement(re.a,{Component:fn,minimumAccessLevel:b.m.Admin}),e.a.createElement(w.a,null),e.a.createElement(Pe,null),e.a.createElement(w.a,null),n&&e.a.createElement(ne,{user:n}),e.a.createElement(w.a,null),e.a.createElement(re.a,{Component:dn,minimumAccessLevel:b.m.Admin}),e.a.createElement(w.a,null),e.a.createElement(re.a,{Component:vn,minimumAccessLevel:b.m.Admin}),e.a.createElement(w.a,null),e.a.createElement(re.a,{Component:ae,minimumAccessLevel:b.m.Owner})))}}}]);
