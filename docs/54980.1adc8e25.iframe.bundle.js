"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[54980],{"./frontend/src/scenes/experiments/Experiment.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Experiment:()=>Experiment_Experiment,scene:()=>scene}),__webpack_require__("./frontend/src/scenes/experiments/Experiment.scss");var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.8.5_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5/node_modules/kea-forms/lib/index.js"),SeriesGlyph=__webpack_require__("./frontend/src/lib/components/SeriesGlyph.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonField=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonRadio=__webpack_require__("./frontend/src/lib/lemon-ui/LemonRadio/index.ts"),LemonSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),experimentsLogic=__webpack_require__("./frontend/src/scenes/experiments/experimentsLogic.ts"),experimentLogic=__webpack_require__("./frontend/src/scenes/experiments/experimentLogic.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ExperimentFormFields=()=>{var _experiment$parameter;let{experiment,featureFlags,groupTypes,aggregationLabel}=(0,index_esm.useValues)(experimentLogic.W),{addExperimentGroup,removeExperimentGroup,setExperiment,setNewExperimentInsight,createExperiment,setExperimentType}=(0,index_esm.useActions)(experimentLogic.W),{webExperimentsAvailable}=(0,index_esm.useValues)(experimentsLogic.OK);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsxs)("div",{className:"space-y-6 max-w-120",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"Pricing page conversion","data-attr":"experiment-name"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"feature_flag_key",label:"Feature flag key",help:"Each experiment is backed by a feature flag. You'll use this key in your code.",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"pricing-page-conversion","data-attr":"experiment-feature-flag-key"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"description",label:"Description",children:(0,jsx_runtime.jsx)(src._V,{placeholder:"The goal of this experiment is ...","data-attr":"experiment-description"})})]}),webExperimentsAvailable&&(0,jsx_runtime.jsxs)("div",{className:"mt-10",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-1",children:"Experiment type"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted font-medium tracking-normal",children:"Select your experiment setup, this cannot be changed once saved."}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(LemonRadio._,{value:experiment.type,className:"space-y-2 -mt-2",onChange:type=>{setExperimentType(type)},options:[{value:"product",label:(0,jsx_runtime.jsxs)("div",{className:"translate-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"Product experiment"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"Use custom code to manage how variants modify your product."})]})},{value:"web",label:(0,jsx_runtime.jsxs)("div",{className:"translate-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"No-code web experiment"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"Define variants on your website using the PostHog toolbar, no coding required."})]})}]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-10",children:"Participant type"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"The type on which to aggregate metrics. You can change this at any time during the experiment."}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(LemonRadio._,{value:void 0!=experiment.parameters.aggregation_group_type_index?experiment.parameters.aggregation_group_type_index:-1,onChange:rawGroupTypeIndex=>{let groupTypeIndex=-1!==rawGroupTypeIndex?rawGroupTypeIndex:void 0;setExperiment({parameters:{...experiment.parameters,aggregation_group_type_index:null!=groupTypeIndex?groupTypeIndex:void 0}}),setNewExperimentInsight()},options:[{value:-1,label:"Persons"},...Array.from(groupTypes.values()).map(groupType=>({value:groupType.group_type_index,label:(0,utils.fm)(aggregationLabel(groupType.group_type_index).plural)}))]})]}),(0,jsx_runtime.jsxs)("div",{className:"mt-10",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-1",children:"Variants"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"Add up to 9 variants to test against your control."}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-160",children:[(0,jsx_runtime.jsxs)("div",{className:"max-w-60",children:[(0,jsx_runtime.jsx)("h3",{children:"Control"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsxs)(lib.Group,{name:["parameters","feature_flag_variants",0],children:[(0,jsx_runtime.jsx)(SeriesGlyph.jc,{index:0,className:"h-7 w-7 text-base"}),(0,jsx_runtime.jsx)(LemonField.D,{name:"key",className:"ml-2 flex-grow",children:(0,jsx_runtime.jsx)(src.DF,{disabled:!0,"data-attr":"experiment-variant-key","data-key-index":0,className:"ph-ignore-input",fullWidth:!0,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})]},0)}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs mt-2",children:"Included automatically, cannot be edited or removed"})]}),(0,jsx_runtime.jsxs)("div",{className:"max-w-100",children:[(0,jsx_runtime.jsx)("h3",{children:"Test(s)"}),experiment.parameters.feature_flag_variants?.map((_,index)=>0===index?null:jsx_runtime.jsx(lib.Group,{name:["parameters","feature_flag_variants",index],children:jsx_runtime.jsxs("div",{className:`flex items-center space-x-2 ${index>1&&"mt-2"}`,children:[jsx_runtime.jsx(SeriesGlyph.jc,{index:index,className:"h-7 w-7 text-base"}),jsx_runtime.jsx(LemonField.D,{name:"key",className:"flex-grow",children:jsx_runtime.jsx(src.DF,{"data-attr":"experiment-variant-key","data-key-index":index.toString(),className:"ph-ignore-input",fullWidth:!0,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),jsx_runtime.jsx("div",{className:`${1===index&&"pr-9"}`,children:1!==index&&jsx_runtime.jsx(src.u,{title:"Delete this variant",placement:"top-start",children:jsx_runtime.jsx(LemonButton.J,{size:"small",icon:jsx_runtime.jsx(posthog_icons_es.IconTrash,{}),onClick:()=>removeExperimentGroup(index)})})})]},`variant-${index}`)},index)),(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs ml-9 mr-20 mt-2",children:"Alphanumeric, hyphens and underscores only"}),(null!==(_experiment$parameter=experiment.parameters.feature_flag_variants.length)&&void 0!==_experiment$parameter?_experiment$parameter:0)<constants.Rp&&(0,jsx_runtime.jsx)(LemonButton.J,{className:"ml-9 mt-2",type:"secondary",onClick:()=>addExperimentGroup(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),"data-attr":"add-test-variant",children:"Add test variant"})]})]})]}),featureFlags[constants.y8.EXPERIMENTS_HOLDOUTS]&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Holdout group"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"Exclude a stable group of users from the experiment."}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(HoldoutSelector,{})]})]}),(0,jsx_runtime.jsx)(LemonButton.J,{className:"mt-2",type:"primary","data-attr":"save-experiment",onClick:()=>createExperiment(!0),children:"Save as draft"})]})},HoldoutSelector=()=>{let{experiment,holdouts}=(0,index_esm.useValues)(experimentLogic.W),{setExperiment}=(0,index_esm.useActions)(experimentLogic.W),holdoutOptions=holdouts.map(holdout=>({value:holdout.id,label:holdout.name}));return holdoutOptions.unshift({value:null,label:"No holdout"}),(0,jsx_runtime.jsx)("div",{className:"mt-4 mb-8",children:(0,jsx_runtime.jsx)(LemonSelect.Yv,{options:holdoutOptions,value:experiment.holdout_id||null,onChange:value=>{setExperiment({...experiment,holdout_id:value})},"data-attr":"experiment-holdout-selector"})})};function ExperimentForm(){let{props}=(0,index_esm.useValues)(experimentLogic.W);return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(lib.Form,{id:"experiment-step",logic:experimentLogic.W,formKey:"experiment",props:props,enableFormOnSubmit:!0,className:"space-y-6 experiment-form",children:(0,jsx_runtime.jsx)(ExperimentFormFields,{})})})}var AuthorizedUrlList=__webpack_require__("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),authorizedUrlListLogic=__webpack_require__("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonDialog=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDialog/index.ts");function WebExperimentImplementationDetails(_ref){let{experiment}=_ref;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-2",children:"Implementation"}),(0,jsx_runtime.jsxs)("div",{className:"border p-6 rounded bg-bg-light space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold leading-tight text-base text-current",children:"Define variant changes directly on your website"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"Use our toolbar to select elements and apply transformations for each variant."}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",type:"secondary",onClick:()=>{LemonDialog.d.open({title:"Select a domain",description:experiment?.id?"Choose the domain on which to edit this experiment":"Choose the domain on which to create this experiment",content:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(AuthorizedUrlList.t,{experimentId:experiment?.id,type:authorizedUrlListLogic.uw.TOOLBAR_URLS})}),primaryButton:{children:"Close",type:"secondary"}})},sideIcon:(0,jsx_runtime.jsx)(icons.UE,{}),children:"Launch toolbar on your website"})})]})]})})}var react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts");function ServerSideWarning(){return(0,jsx_runtime.jsx)("div",{className:"warning",children:(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("b",{children:"Warning:"})," Server side experiment metrics require you to manually send the feature flag information."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/tutorials/experiments#step-2-sending-the-right-events",target:"_blank",children:"See this tutorial for more information."})]})})}let UTM_TAGS="?utm_medium=in-product&utm_campaign=experiment",DOC_BASE_URL="https://posthog.com/docs/",FF_ANCHOR="#feature-flags",OPTIONS=[{value:"JavaScript",documentationLink:`${DOC_BASE_URL}libraries/js${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.RQ,Snippet:function(_ref2){let{flagKey,variant}=_ref2;return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`if (posthog.getFeatureFlag('${flagKey}') === '${variant}') {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)("div",{className:"mt-4 mb-1",children:(0,jsx_runtime.jsx)("b",{children:"Test that it works"})}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`posthog.featureFlags.override({'${flagKey}': '${variant}'})`})]})}},{value:"ReactNative",documentationLink:`${DOC_BASE_URL}libraries/react-native${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.RQ,Snippet:function(_ref3){let{flagKey,variant}=_ref3;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`if (posthog.getFeatureFlag('${flagKey}') === '${variant}') {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`})})}},{value:"Node.js",documentationLink:`${DOC_BASE_URL}libraries/node${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.fS,Snippet:function(_ref){let{flagKey,variant}=_ref;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`const experimentFlagValue = await client.getFeatureFlag('${flagKey}', 'user distinct id')

if (experimentFlagValue === '${variant}' ) {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}},{value:"PHP",documentationLink:`${DOC_BASE_URL}libraries/php${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.W7,Snippet:function(_ref4){let{flagKey,variant}=_ref4;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.PHP,wrap:!0,children:`if (PostHog::getFeatureFlag('${flagKey}', 'user distinct id') == '${variant}') {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}},{value:"Ruby",documentationLink:`${DOC_BASE_URL}libraries/ruby${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.gz,Snippet:function(_ref6){let{flagKey,variant}=_ref6;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Ruby,wrap:!0,children:`experimentFlagValue = posthog.get_feature_flag('${flagKey}', 'user distinct id')


if experimentFlagValue == '${variant}'
    # Do something differently for this user
else
    # It's a good idea to let control variant always be the default behaviour,
    # so if something goes wrong with flag evaluation, you don't break your app.
end
`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}},{value:"Golang",documentationLink:`${DOC_BASE_URL}libraries/go${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.GH,Snippet:function(_ref5){let{flagKey,variant}=_ref5;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Go,wrap:!0,children:`experimentFlagValue, err := client.GetFeatureFlag(
                    FeatureFlagPayload{
                        Key:        '${flagKey}',
                        DistinctId: "distinct-id",
                    })

if (experimentFlagValue == '${variant}' ) {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}},{value:"Python",documentationLink:`${DOC_BASE_URL}libraries/python${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.Bm,Snippet:function(_ref7){let{flagKey,variant}=_ref7;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Python,wrap:!0,children:`experiment_flag_value = posthog.get_feature_flag("${flagKey}", "user_distinct_id"):

if experiment_flag_value == '${variant}':
    # Do something differently for this user
else:
    # It's a good idea to let control variant always be the default behaviour,
    # so if something goes wrong with flag evaluation, you don't break your app.
`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}}];function CodeLanguageSelect(_ref){let{selectedOptionValue,selectOption}=_ref;return(0,jsx_runtime.jsx)(src.Yv,{size:"small",className:"min-w-[7.5rem]",onSelect:selectOption,value:selectedOptionValue,options:OPTIONS.map(_ref2=>{let{value,Icon}=_ref2;return{value,label:value,labelInMenu:(0,jsx_runtime.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,jsx_runtime.jsx)(Icon,{}),(0,jsx_runtime.jsx)("span",{children:value})]})}})})}function ExperimentImplementationDetails(_ref3){var _experiment$parameter,_experiment$feature_f;let{experiment}=_ref3,defaultVariant=null!==(_experiment$parameter=experiment?.parameters?.feature_flag_variants?.[1]?.key)&&void 0!==_experiment$parameter?_experiment$parameter:"test",[currentVariant,setCurrentVariant]=(0,react.useState)(defaultVariant),[defaultSelectedOption]=OPTIONS,[selectedOption,setSelectedOption]=(0,react.useState)(defaultSelectedOption);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-2",children:"Implementation"}),(0,jsx_runtime.jsx)("div",{className:"border rounded bg-bg-light",children:(0,jsx_runtime.jsxs)("div",{className:"p-6 space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("span",{className:"mr-2",children:"Variant group"}),(0,jsx_runtime.jsx)(src.Yv,{size:"small",className:"min-w-[5rem]",onSelect:setCurrentVariant,value:currentVariant,options:(experiment?.parameters?.feature_flag_variants||[]).map(variant=>({value:variant.key,label:variant.key}))})]}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(CodeLanguageSelect,{selectOption:selectedValue=>{let option=OPTIONS.find(option=>option.value===selectedValue);option&&setSelectedOption(option)},selectedOptionValue:selectedOption.value})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"mb-1",children:(0,jsx_runtime.jsx)("b",{children:"Implement your experiment in code"})}),(0,jsx_runtime.jsx)("div",{className:"mb-1",children:(0,jsx_runtime.jsx)(selectedOption.Snippet,{variant:currentVariant,flagKey:null!==(_experiment$feature_f=experiment?.feature_flag?.key)&&void 0!==_experiment$feature_f?_experiment$feature_f:""})}),(0,jsx_runtime.jsx)(src.rU,{subtle:!0,to:selectedOption.documentationLink,target:"_blank",children:"See the docs for more implementation information."})]})]})})]})}var components=__webpack_require__("./frontend/src/scenes/experiments/ExperimentView/components.tsx"),animations=__webpack_require__("./frontend/src/lib/animations/animations.ts"),Animation=__webpack_require__("./frontend/src/lib/components/Animation/Animation.tsx"),LemonProgress=__webpack_require__("./frontend/src/lib/lemon-ui/LemonProgress/index.tsx"),types=__webpack_require__("./frontend/src/types.ts"),experiments_utils=__webpack_require__("./frontend/src/scenes/experiments/utils.ts"),LemonSlider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSlider/index.ts"),insightDataLogic=__webpack_require__("./frontend/src/scenes/insights/insightDataLogic.tsx"),insightLogic=__webpack_require__("./frontend/src/scenes/insights/insightLogic.tsx"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),experiments_constants=__webpack_require__("./frontend/src/scenes/experiments/constants.ts");function FunnelCalculation(_ref){let{experimentId}=_ref,{minimumDetectableEffect,experiment,conversionMetrics,minimumSampleSizePerVariant,recommendedRunningTime,variants}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),funnelConversionRate=conversionMetrics?.totalRate*100||0,conversionRate=100*conversionMetrics.totalRate,sampleSizePerVariant=minimumSampleSizePerVariant(conversionRate),funnelSampleSize=sampleSizePerVariant*variants.length,baselineConversionRate=funnelConversionRate.toFixed(1),minimumAcceptableConversionRate=(funnelConversionRate+(minimumDetectableEffect||5)).toFixed(1),recommendedSampleSize=(0,utils.Lc)(funnelSampleSize||0);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap",children:[!experiment?.start_date&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Baseline Conversion Rate"}),(0,jsx_runtime.jsxs)("div",{className:"l4",children:[baselineConversionRate,"%"]})]}),(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Conversion Rate"}),(0,jsx_runtime.jsxs)("div",{className:"l4",children:[minimumAcceptableConversionRate,"%"]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended Sample Size"}),(0,jsx_runtime.jsxs)("div",{className:"pb-4",children:[(0,jsx_runtime.jsxs)("span",{className:"l4",children:["~",recommendedSampleSize]})," persons"]})]}),!experiment?.start_date&&(0,jsx_runtime.jsxs)("div",{className:"w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("span",{className:"l4",children:["~",recommendedRunningTime]})," days"]})]})]})}function TrendCalculation(_ref2){let{experimentId}=_ref2,{minimumDetectableEffect,experiment,trendResults,recommendedExposureForCountData}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),trendCount=trendResults[0]?.count||0,trendExposure=recommendedExposureForCountData(trendCount),baselineCount=(0,utils.Lc)(trendCount||0),minimumAcceptableCount=(0,utils.Lc)(trendCount+Math.ceil(trendCount*((minimumDetectableEffect||5)/100))||0),recommendedRunningTime=(0,utils.Lc)(trendExposure||0);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap",children:[!experiment?.start_date&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Baseline Count"}),(0,jsx_runtime.jsx)("div",{className:"l4",children:baselineCount})]}),(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Count"}),(0,jsx_runtime.jsx)("div",{className:"l4",children:minimumAcceptableCount})]})]}),(0,jsx_runtime.jsxs)("div",{className:"w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("span",{className:"l4",children:["~",recommendedRunningTime]})," days"]})]})]})}function DataCollectionCalculator(_ref3){let{experimentId}=_ref3,{experimentInsightType,minimumDetectableEffect,experiment,conversionMetrics}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),{setExperiment}=(0,index_esm.useActions)((0,experimentLogic.W)({experimentId})),insightLogicInstance=(0,insightLogic.zm)({dashboardItemId:experiments_constants.Rw,syncWithUrl:!1}),{insightProps}=(0,index_esm.useValues)(insightLogicInstance),{query}=(0,index_esm.useValues)((0,insightDataLogic.S)(insightProps)),funnelConversionRate=conversionMetrics?.totalRate*100||0,sliderMaxValue=0;return sliderMaxValue=experimentInsightType===types.dw.FUNNELS?100-funnelConversionRate<50?100-funnelConversionRate:50:100,(0,jsx_runtime.jsx)("div",{className:"flex",children:(0,jsx_runtime.jsxs)("div",{className:"w-full",children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 experiment-preview-row",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("b",{children:"Minimum detectable effect"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"The Minimum detectable effect represents the smallest change that you want to be able to detect in your experiment."}),(0,jsx_runtime.jsx)("div",{children:"To make things easier, we initially set this value to a reasonable default. However, we encourage you to review and adjust it based on your specific goals."}),(0,jsx_runtime.jsxs)("div",{children:["Read more in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/experiments/sample-size-running-time#minimum-detectable-effect-mde",children:"documentation."})]})]}),closeDelayMs:200,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base ml-1"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonSlider.j,{value:minimumDetectableEffect,min:1,max:sliderMaxValue,step:1,onChange:value=>{setExperiment({parameters:{...experiment.parameters,minimum_detectable_effect:value}})},className:"w-5/6"}),(0,jsx_runtime.jsx)(src.DF,{className:"w-1/6","data-attr":"min-detectable-effect",type:"number",min:1,max:sliderMaxValue,defaultValue:5,suffix:(0,jsx_runtime.jsx)("span",{children:"%"}),value:minimumDetectableEffect,onChange:value=>{value&&setExperiment({parameters:{...experiment.parameters,minimum_detectable_effect:value}})}})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col experiment-preview-row",children:[(0,jsx_runtime.jsx)(src.Vp,{type:"info",className:"mb-4",children:"The calculations are based on the events received in the last 14 days. This event count may differ from what was considered in earlier estimates."}),experimentInsightType===types.dw.TRENDS?(0,jsx_runtime.jsx)(TrendCalculation,{experimentId:experimentId}):(0,jsx_runtime.jsx)(FunnelCalculation,{experimentId:experimentId}),(0,jsx_runtime.jsx)("div",{className:"hidden",children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:insightLogic.zm,props:insightProps,children:(0,jsx_runtime.jsx)(Query.A,{query:query,context:{insightProps},readOnly:!0})})})]})]})})}function DataCollection(){let{experimentId,experiment,experimentInsightType,funnelResultsPersonsTotal,actualRunningTime,minimumDetectableEffect}=(0,index_esm.useValues)(experimentLogic.W),{openExperimentCollectionGoalModal}=(0,index_esm.useActions)(experimentLogic.W),recommendedRunningTime=experiment?.parameters?.recommended_running_time||1,recommendedSampleSize=experiment?.parameters?.recommended_sample_size||100,experimentProgressPercent=experimentInsightType===types.dw.FUNNELS?funnelResultsPersonsTotal/recommendedSampleSize*100:actualRunningTime/recommendedRunningTime*100,hasHighRunningTime=recommendedRunningTime>62,GoalTooltip=()=>experiment?.parameters?.minimum_detectable_effect?(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{children:`Based on the Minimum detectable effect of ${experiment.parameters.minimum_detectable_effect}%.`}),hasHighRunningTime&&(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Given the current data, this experiment might take a while to reach statistical significance. Please make sure events are being tracked correctly and consider if this timeline works for you."})]}),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"inline-flex items-center space-x-2",children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-0",children:"Data collection"}),(0,jsx_runtime.jsx)(src.u,{title:"Estimated target for the number of participants. Actual data may reveal significance earlier or later than predicted.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsxs)("div",{className:"w-3/5 pr-4",children:[(0,jsx_runtime.jsx)("div",{className:"mt-2 mb-1 font-semibold",children:`${experimentProgressPercent>100?100:experimentProgressPercent.toFixed(2)}% complete`}),(0,jsx_runtime.jsx)(LemonProgress.b,{className:"w-full border",bgColor:"var(--bg-table)",size:"large",percent:experimentProgressPercent}),experimentInsightType===types.dw.TRENDS&&(0,jsx_runtime.jsx)("div",{className:"flex justify-between mt-0",children:(0,jsx_runtime.jsxs)("span",{className:"flex items-center text-xs",children:["Completed\xa0",(0,jsx_runtime.jsxs)("b",{children:[actualRunningTime," of"]}),hasHighRunningTime?(0,jsx_runtime.jsx)("b",{children:"\xa0 > 60 days"}):(0,jsx_runtime.jsxs)("span",{children:["\xa0",(0,jsx_runtime.jsx)("b",{children:recommendedRunningTime})," ",(0,experiments_utils.Du)(recommendedRunningTime,"day")]}),(0,jsx_runtime.jsx)("span",{className:"ml-1 text-xs",children:(0,jsx_runtime.jsx)(GoalTooltip,{})})]})}),experimentInsightType===types.dw.FUNNELS&&(0,jsx_runtime.jsx)("div",{className:"flex justify-between mt-0",children:(0,jsx_runtime.jsxs)("div",{className:"space-x-1 flex items-center text-xs",children:[(0,jsx_runtime.jsxs)("span",{children:["Saw\xa0",(0,jsx_runtime.jsxs)("b",{children:[(0,utils.Lc)(funnelResultsPersonsTotal)," of"," ",(0,utils.Lc)(recommendedSampleSize)," "]})," ",(0,experiments_utils.Du)(recommendedSampleSize,"participant")]}),(0,jsx_runtime.jsx)(GoalTooltip,{})]})})]}),(0,jsx_runtime.jsx)(src.p2,{className:"my-0",vertical:!0}),(0,jsx_runtime.jsxs)("div",{className:"w-2/5 pl-4",children:[(0,jsx_runtime.jsxs)("div",{className:`text-lg font-semibold ${experiment.end_date?"mt-4":""}`,children:[minimumDetectableEffect,"%"]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs space-x-1 text-sm flex",children:[(0,jsx_runtime.jsx)("span",{children:"Minimum detectable effect"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"The Minimum detectable effect represents the smallest change that you want to be able to detect in your experiment."}),(0,jsx_runtime.jsx)("div",{children:"To make things easier, we initially set this value to a reasonable default. However, we encourage you to review and adjust it based on your specific goals."}),(0,jsx_runtime.jsxs)("div",{children:["Read more in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/experiments/sample-size-running-time#minimum-detectable-effect-mde",children:"documentation."})]})]}),closeDelayMs:200,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})})]}),!experiment.end_date&&(0,jsx_runtime.jsx)("div",{className:"w-24",children:(0,jsx_runtime.jsx)(src.Jp,{className:"mt-2",size:"xsmall",type:"secondary",onClick:openExperimentCollectionGoalModal,children:(0,jsx_runtime.jsx)("span",{className:"px-0",children:"Edit"})})}),(0,jsx_runtime.jsx)(DataCollectionGoalModal,{experimentId:experimentId})]})]})]})}function DataCollectionGoalModal(_ref){let{experimentId}=_ref,{isExperimentCollectionGoalModalOpen,goalInsightDataLoading}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),{closeExperimentCollectionGoalModal,updateExperimentCollectionGoal}=(0,index_esm.useActions)((0,experimentLogic.W)({experimentId}));return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isExperimentCollectionGoalModalOpen,onClose:closeExperimentCollectionGoalModal,width:550,title:"Recalculate estimated sample size",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",type:"secondary",onClick:closeExperimentCollectionGoalModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",onClick:()=>updateExperimentCollectionGoal(),type:"primary","data-attr":"create-annotation-submit",children:"Save"})]}),children:goalInsightDataLoading?(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 justify-center items-center mb-6",children:[(0,jsx_runtime.jsx)(Animation.f,{type:animations.ru.LaptopHog}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-muted w-60",children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:"Fetching past events for the estimation"}),(0,jsx_runtime.jsx)(components.QT,{})]})]}):(0,jsx_runtime.jsx)(DataCollectionCalculator,{experimentId:experimentId})})}var featureFlagLogic=__webpack_require__("./frontend/src/scenes/feature-flags/featureFlagLogic.ts"),useUploadFiles=__webpack_require__("./frontend/src/lib/hooks/useUploadFiles.ts");function VariantScreenshot(_ref){let{variantKey,rolloutPercentage}=_ref,{experiment}=(0,index_esm.useValues)(experimentLogic.W),{updateExperimentVariantImages,reportExperimentVariantScreenshotUploaded}=(0,index_esm.useActions)(experimentLogic.W),[mediaId,setMediaId]=(0,react.useState)(experiment.parameters?.variant_screenshot_media_ids?.[variantKey]||null),[isLoadingImage,setIsLoadingImage]=(0,react.useState)(!0),[isModalOpen,setIsModalOpen]=(0,react.useState)(!1),{setFilesToUpload,filesToUpload,uploading}=(0,useUploadFiles.nc)({onUpload:(_,__,id)=>{if(setMediaId(id),id){let updatedVariantImages={...experiment.parameters?.variant_screenshot_media_ids,[variantKey]:id};updateExperimentVariantImages(updatedVariantImages),reportExperimentVariantScreenshotUploaded(experiment.id)}},onError:detail=>{src.UJ.error(`Error uploading image: ${detail}`)}});return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[mediaId?(0,jsx_runtime.jsx)("div",{className:"relative",children:(0,jsx_runtime.jsx)("div",{className:"text-muted inline-flex flow-row items-center gap-1 cursor-pointer",children:(0,jsx_runtime.jsxs)("div",{onClick:()=>setIsModalOpen(!0),className:"cursor-zoom-in relative",children:[(0,jsx_runtime.jsxs)("div",{className:"relative flex overflow-hidden select-none size-20 w-full rounded before:absolute before:inset-0 before:border before:rounded",children:[isLoadingImage&&(0,jsx_runtime.jsx)(src.yW,{className:"absolute inset-0"}),(0,jsx_runtime.jsx)("img",{className:"size-full object-cover",src:mediaId.startsWith("data:")?mediaId:`/uploaded_media/${mediaId}`,onError:()=>setIsLoadingImage(!1),onLoad:()=>setIsLoadingImage(!1)})]}),(0,jsx_runtime.jsx)("div",{className:"absolute -inset-2 group",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:e=>{e.stopPropagation(),setMediaId(null);let updatedVariantImages={...experiment.parameters?.variant_screenshot_media_ids};delete updatedVariantImages[variantKey],updateExperimentVariantImages(updatedVariantImages)},size:"small",tooltip:"Remove",tooltipPlacement:"right",noPadding:!0,className:"group-hover:flex hidden absolute right-0 top-0"})})]})})}):(0,jsx_runtime.jsx)(src.mH,{accept:"image/*",multiple:!1,onChange:setFilesToUpload,loading:uploading,value:filesToUpload,callToAction:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconUpload,{className:"text-2xl"}),(0,jsx_runtime.jsx)("span",{children:"Upload a preview of this variant's UI"})]})}),(0,jsx_runtime.jsx)(src.fQ,{isOpen:isModalOpen,onClose:()=>setIsModalOpen(!1),title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Screenshot"}),(0,jsx_runtime.jsx)(src.p2,{className:"my-0 mx-1",vertical:!0}),(0,jsx_runtime.jsx)(components.Aw,{experimentId:experiment.id,variantKey:variantKey}),void 0!==rolloutPercentage&&(0,jsx_runtime.jsxs)("span",{className:"text-muted text-sm",children:["(",rolloutPercentage,"% rollout)"]})]}),children:(0,jsx_runtime.jsx)("img",{src:mediaId?.startsWith("data:")?mediaId:`/uploaded_media/${mediaId}`,alt:`Screenshot: ${variantKey}`,className:"max-w-full max-h-[80vh] overflow-auto"})})]})}function DistributionModal(_ref){var _experiment$feature_f;let{experimentId}=_ref,{experiment,experimentLoading,isDistributionModalOpen}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),{closeDistributionModal}=(0,index_esm.useActions)((0,experimentLogic.W)({experimentId})),_featureFlagLogic=(0,featureFlagLogic.hk)({id:null!==(_experiment$feature_f=experiment.feature_flag?.id)&&void 0!==_experiment$feature_f?_experiment$feature_f:null}),{featureFlag,areVariantRolloutsValid,variantRolloutSum}=(0,index_esm.useValues)(_featureFlagLogic),{setFeatureFlagFilters,distributeVariantsEqually,saveSidebarExperimentFeatureFlag}=(0,index_esm.useActions)(_featureFlagLogic),handleRolloutPercentageChange=(index,value)=>{if(!featureFlag?.filters?.multivariate||!value)return;let updatedVariants=featureFlag.filters.multivariate.variants.map((variant,i)=>i===index?{...variant,rollout_percentage:value}:variant);setFeatureFlagFilters({...featureFlag.filters,multivariate:{...featureFlag.filters.multivariate,variants:updatedVariants}},null)};return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isDistributionModalOpen,onClose:closeDistributionModal,width:600,title:"Change experiment distribution",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:closeDistributionModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{saveSidebarExperimentFeatureFlag(featureFlag),closeDistributionModal()},type:"primary",loading:experimentLoading,disabled:!areVariantRolloutsValid,children:"Save"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:"Adjusting variant distribution may impact the validity of your results. Adjust only if you're aware of how changes will affect your experiment."}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold mb-0",children:"Variant Distribution"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",onClick:distributeVariantsEqually,tooltip:"Redistribute variant rollout percentages equally",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBalance,{}),children:"Distribute equally"})]}),(0,jsx_runtime.jsx)(src.g3,{dataSource:featureFlag?.filters?.multivariate?.variants||[],columns:[{title:"Variant",dataIndex:"key",render:value=>(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:value})},{title:"Rollout Percentage",dataIndex:"rollout_percentage",render:(_,record,index)=>(0,jsx_runtime.jsx)(src.DF,{type:"number",value:record.rollout_percentage,onChange:value=>handleRolloutPercentageChange(index,value),min:0,max:100,suffix:(0,jsx_runtime.jsx)("span",{children:"%"})})}]}),!areVariantRolloutsValid&&(0,jsx_runtime.jsxs)("p",{className:"text-danger mt-2",children:["Percentage rollouts must sum to 100 (currently ",variantRolloutSum,")."]})]})]})})}function DistributionTable(){let{openDistributionModal}=(0,index_esm.useActions)(experimentLogic.W),{experimentId,experiment,experimentResults}=(0,index_esm.useValues)(experimentLogic.W),{reportExperimentReleaseConditionsViewed}=(0,index_esm.useActions)(experimentLogic.W),onSelectElement=variant=>{src.dn.open({title:"Select a domain",description:"Choose the domain on which to preview this experiment variant",content:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(AuthorizedUrlList.t,{query:"?__experiment_id="+experiment?.id+"&__experiment_variant="+variant,experimentId:experiment?.id,type:authorizedUrlListLogic.uw.WEB_EXPERIMENTS})}),primaryButton:{children:"Close",type:"secondary"}})},className=experiment?.type==="web"?"w-1/2.5":"w-1/3",columns=[{className:className,key:"key",title:"Variant",render:function Key(_,item){return experimentResults&&experimentResults.insight?(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:item.key}):(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:item.key})}},{className:className,key:"rollout_percentage",title:"Rollout",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{children:`${item.rollout_percentage}%`})}},{className:className,key:"variant_screenshot",title:"Screenshot",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{className:"my-2",children:(0,jsx_runtime.jsx)(VariantScreenshot,{variantKey:item.key,rolloutPercentage:item.rollout_percentage})})}}];return"web"===experiment.type&&columns.push({className:className,key:"preview_web_experiment",title:"Preview",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{className:"my-2",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",onClick:e=>{e.preventDefault(),onSelectElement(item.key)},sideIcon:(0,jsx_runtime.jsx)(icons.UE,{}),children:"Preview variant"})})}}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2",children:(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg",children:"Distribution"})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,jsx_runtime.jsx)("div",{className:"ml-auto mb-2",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFlag,{}),onClick:()=>{openDistributionModal(),reportExperimentReleaseConditionsViewed(experiment.id)},type:"secondary",size:"xsmall",className:"font-semibold",children:"Manage distribution"})})})]}),(0,jsx_runtime.jsx)(src.g3,{loading:!1,columns:columns,dataSource:experiment.feature_flag?.filters.multivariate?.variants||[]})]})}var InsightLabel=__webpack_require__("./frontend/src/lib/components/InsightLabel/index.tsx"),PropertyFilterButton=__webpack_require__("./frontend/src/lib/components/PropertyFilters/components/PropertyFilterButton.tsx"),TaxonomicFilter_types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),AttributionFilter=__webpack_require__("./frontend/src/scenes/insights/EditorFilters/AttributionFilter.tsx"),SamplingFilter=__webpack_require__("./frontend/src/scenes/insights/EditorFilters/SamplingFilter.tsx"),ActionFilter=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),ActionFilterRow=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),AggregationSelect=__webpack_require__("./frontend/src/scenes/insights/filters/AggregationSelect.tsx"),insightVizDataLogic=__webpack_require__("./frontend/src/scenes/insights/insightVizDataLogic.ts"),FunnelConversionWindowFilter=__webpack_require__("./frontend/src/scenes/insights/views/Funnels/FunnelConversionWindowFilter.tsx"),filtersToQueryNode=__webpack_require__("./frontend/src/queries/nodes/InsightQuery/utils/filtersToQueryNode.ts"),queryNodeToFilter=__webpack_require__("./frontend/src/queries/nodes/InsightQuery/utils/queryNodeToFilter.ts"),InsightTestAccountFilter=__webpack_require__("./frontend/src/queries/nodes/InsightViz/filters/InsightTestAccountFilter.tsx");function MetricSelector(_ref){let{dashboardItemId,setPreviewInsight,showDateRangeBanner,forceTrendExposureMetric}=_ref,logic=(0,insightLogic.zm)({dashboardItemId,syncWithUrl:!1}),{insightProps}=(0,index_esm.useValues)(logic),{query}=(0,index_esm.useValues)((0,insightDataLogic.S)(insightProps)),{isTrends}=(0,index_esm.useValues)((0,insightVizDataLogic.Z)(insightProps));return(0,react.useEffect)(()=>{forceTrendExposureMetric&&!isTrends&&setPreviewInsight({insight:types.dw.TRENDS})},[forceTrendExposureMetric,isTrends]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center w-full gap-2 mb-4",children:[(0,jsx_runtime.jsx)("span",{children:"Insight Type"}),(0,jsx_runtime.jsx)(src.Yv,{"data-attr":"metrics-selector",value:isTrends?types.dw.TRENDS:types.dw.FUNNELS,onChange:val=>{val&&setPreviewInsight({insight:val})},options:[{value:types.dw.TRENDS,label:(0,jsx_runtime.jsx)("b",{children:"Trends"})},{value:types.dw.FUNNELS,label:(0,jsx_runtime.jsx)("b",{children:"Funnels"})}],disabledReason:forceTrendExposureMetric?"Exposure metric can only be a trend graph":void 0})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(SamplingFilter.V,{insightProps:insightProps,infoTooltipContent:"Sampling on experiment goals is an Alpha feature to enable faster computation of experiment results."}),(0,jsx_runtime.jsx)("br",{})]}),(0,jsx_runtime.jsx)(ExperimentInsightCreator,{insightProps:insightProps}),showDateRangeBanner&&(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:insightLogic.zm,props:insightProps,children:(0,jsx_runtime.jsx)(Query.A,{query:query,context:{insightProps},readOnly:!0})})})]})}function ExperimentInsightCreator(_ref2){let{insightProps}=_ref2,{isTrends,series,querySource}=(0,index_esm.useValues)((0,insightVizDataLogic.Z)(insightProps)),{updateQuerySource}=(0,index_esm.useActions)((0,insightVizDataLogic.Z)(insightProps)),filterSteps=series||[],isStepsEmpty=0===filterSteps.length;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,queryNodeToFilter.ce)(querySource),setFilters:payload=>{updateQuerySource({series:(0,filtersToQueryNode.NG)(payload,!0,isTrends?ActionFilterRow.Qq.All:ActionFilterRow.Qq.None)})},typeKey:`experiment-${isTrends?types.dw.TRENDS:types.dw.FUNNELS}-${insightProps.dashboardItemId}-metric`,mathAvailability:isTrends?void 0:ActionFilterRow.Qq.None,hideDeleteBtn:isTrends||1===filterSteps.length,buttonCopy:isTrends?"Add graph series":"Add funnel step",showSeriesIndicator:isTrends||!isStepsEmpty,entitiesLimit:isTrends?1:void 0,seriesIndicatorType:isTrends?void 0:"numeric",sortable:!isTrends||void 0,showNestedArrow:!isTrends||void 0,showNumericalPropsOnly:isTrends,actionsTaxonomicGroupTypes:[TaxonomicFilter_types.t.Events,TaxonomicFilter_types.t.Actions,TaxonomicFilter_types.t.DataWarehouse],propertiesTaxonomicGroupTypes:[TaxonomicFilter_types.t.EventProperties,TaxonomicFilter_types.t.PersonProperties,TaxonomicFilter_types.t.EventFeatureFlags,TaxonomicFilter_types.t.Cohorts,TaxonomicFilter_types.t.Elements,TaxonomicFilter_types.t.HogQLExpression,TaxonomicFilter_types.t.DataWarehouseProperties,TaxonomicFilter_types.t.DataWarehousePersonProperties]}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 space-y-4",children:[!isTrends&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center w-full gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Aggregating by"}),(0,jsx_runtime.jsx)(AggregationSelect.C,{insightProps:insightProps,hogqlAvailable:!0})]}),(0,jsx_runtime.jsx)(FunnelConversionWindowFilter.I,{insightProps:insightProps}),(0,jsx_runtime.jsx)(AttributionSelect,{insightProps:insightProps})]}),(0,jsx_runtime.jsx)(InsightTestAccountFilter.O,{query:querySource,setQuery:updateQuerySource})]})]})}function AttributionSelect(_ref3){let{insightProps}=_ref3;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center w-full gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("span",{children:"Attribution type"}),(0,jsx_runtime.jsx)(Tooltip.u,{closeDelayMs:200,title:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"When breaking down funnels, it's possible that the same properties don't exist on every event. For example, if you want to break down by browser on a funnel that contains both frontend and backend events."}),(0,jsx_runtime.jsx)("div",{children:"In this case, you can choose from which step the properties should be selected from by modifying the attribution type. There are four modes to choose from:"}),(0,jsx_runtime.jsxs)("ul",{className:"list-disc pl-4",children:[(0,jsx_runtime.jsx)("li",{children:"First touchpoint: the first property value seen in any of the steps is chosen."}),(0,jsx_runtime.jsx)("li",{children:"Last touchpoint: the last property value seen from all steps is chosen."}),(0,jsx_runtime.jsx)("li",{children:"All steps: the property value must be seen in all steps to be considered in the funnel."}),(0,jsx_runtime.jsx)("li",{children:"Specific step: only the property value seen at the selected step is chosen."})]}),(0,jsx_runtime.jsxs)("div",{children:["Read more in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/product-analytics/funnels#attribution-types",children:"documentation."})]})]}),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-xl text-muted-alt shrink-0 ml-1"})})]}),(0,jsx_runtime.jsx)(AttributionFilter.x,{insightProps:insightProps})]})}function MetricDisplay(_ref){let{filters}=_ref,experimentInsightType=filters?.insight||types.dw.TRENDS;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:[...filters?.events||[],...filters?.actions||[]].sort((a,b)=>(a.order||0)-(b.order||0)).map((event,idx)=>(0,jsx_runtime.jsxs)("div",{className:"mb-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex mb-1",children:[experimentInsightType===types.dw.FUNNELS&&(0,jsx_runtime.jsx)("div",{className:"shrink-0 w-6 h-6 mr-2 font-bold text-center text-primary-alt border rounded",style:{backgroundColor:"var(--bg-table)"},children:(event.order||0)+1}),(0,jsx_runtime.jsx)("b",{children:(0,jsx_runtime.jsx)(InsightLabel.q,{action:event,showCountedByTag:experimentInsightType===types.dw.TRENDS,hideIcon:!0,showEventName:!0})})]}),(0,jsx_runtime.jsx)("div",{className:"space-y-1",children:event.properties?.map(prop=>jsx_runtime.jsx(PropertyFilterButton.C,{item:prop},prop.key))})]},idx))})}function ExposureMetric(_ref2){let{experimentId}=_ref2,{experiment}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),{openExperimentExposureModal,updateExperimentExposure}=(0,index_esm.useActions)((0,experimentLogic.W)({experimentId}));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"card-secondary mb-2 mt-2",children:["Exposure metric",(0,jsx_runtime.jsx)(src.u,{title:`This metric determines how we calculate exposure for the experiment. Only users who have this event alongside the property '$feature/${experiment.feature_flag_key}' are included in the exposure calculations.`,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"ml-1 text-muted text-sm"})})]}),experiment.parameters?.custom_exposure_filter?(0,jsx_runtime.jsx)(MetricDisplay,{filters:experiment.parameters.custom_exposure_filter}):(0,jsx_runtime.jsx)("span",{className:"description",children:"Default via $feature_flag_called events"}),(0,jsx_runtime.jsx)("div",{className:"mb-2 mt-2",children:(0,jsx_runtime.jsxs)("span",{className:"flex",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"xsmall",onClick:openExperimentExposureModal,className:"mr-2",children:"Change exposure metric"}),experiment.parameters?.custom_exposure_filter&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",status:"danger",size:"xsmall",onClick:()=>updateExperimentExposure(null),children:"Reset"})]})})]})}function ExperimentGoalModal(_ref3){let{experimentId}=_ref3,{experiment,isExperimentGoalModalOpen,experimentLoading,goalInsightDataLoading,experimentInsightType}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),{closeExperimentGoalModal,updateExperimentGoal,setNewExperimentInsight}=(0,index_esm.useActions)((0,experimentLogic.W)({experimentId})),experimentFiltersLength=(experiment.filters?.events?.length||0)+(experiment.filters?.actions?.length||0);return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isExperimentGoalModalOpen,onClose:closeExperimentGoalModal,width:1e3,title:"Change experiment goal",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-goal-form",type:"secondary",onClick:closeExperimentGoalModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{disabledReason:goalInsightDataLoading&&"The insight needs to be loaded before saving the goal."||experimentInsightType===types.dw.FUNNELS&&experimentFiltersLength<2&&"The experiment needs at least two funnel steps.",form:"edit-experiment-goal-form",onClick:()=>{updateExperimentGoal(experiment.filters)},type:"primary",loading:experimentLoading,"data-attr":"create-annotation-submit",children:"Save"})]}),children:(0,jsx_runtime.jsx)(lib.Form,{logic:experimentLogic.W,props:{experimentId},formKey:"experiment",id:"edit-experiment-goal-form",className:"space-y-4",children:(0,jsx_runtime.jsx)(lib.Field,{name:"filters",children:(0,jsx_runtime.jsx)(MetricSelector,{dashboardItemId:experiments_constants.Rw,setPreviewInsight:setNewExperimentInsight,showDateRangeBanner:!0})})})})}function ExperimentExposureModal(_ref4){let{experimentId}=_ref4,{experiment,isExperimentExposureModalOpen,experimentLoading}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),{closeExperimentExposureModal,updateExperimentExposure,setExperimentExposureInsight}=(0,index_esm.useActions)((0,experimentLogic.W)({experimentId}));return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isExperimentExposureModalOpen,onClose:closeExperimentExposureModal,width:1e3,title:"Change experiment exposure",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",type:"secondary",onClick:closeExperimentExposureModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",onClick:()=>{experiment.parameters.custom_exposure_filter&&updateExperimentExposure(experiment.parameters.custom_exposure_filter)},type:"primary",loading:experimentLoading,"data-attr":"create-annotation-submit",children:"Save"})]}),children:(0,jsx_runtime.jsx)(lib.Form,{logic:experimentLogic.W,props:{experimentId},formKey:"experiment",id:"edit-experiment-exposure-form",className:"space-y-4",children:(0,jsx_runtime.jsx)(lib.Field,{name:"filters",children:(0,jsx_runtime.jsx)(MetricSelector,{dashboardItemId:experiments_constants.BH,setPreviewInsight:setExperimentExposureInsight,forceTrendExposureMetric:!0})})})})}function Goal(){let{experiment,experimentId,experimentInsightType,experimentMathAggregationForTrends,hasGoalSet}=(0,index_esm.useValues)(experimentLogic.W),{openExperimentGoalModal}=(0,index_esm.useActions)((0,experimentLogic.W)({experimentId}));return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"inline-flex space-x-2",children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-0",children:"Experiment goal"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[" ","This ",(0,jsx_runtime.jsx)("b",{children:experimentInsightType===types.dw.FUNNELS?"funnel":"trend"})," ",experimentInsightType===types.dw.FUNNELS?"experiment measures conversion at each stage.":"experiment tracks the count of a single metric."]}),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})})]})}),hasGoalSet?(0,jsx_runtime.jsxs)("div",{className:"inline-flex space-x-6",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary mb-2 mt-2",children:experimentInsightType===types.dw.FUNNELS?"Conversion goal steps":"Trend goal"}),(0,jsx_runtime.jsx)(MetricDisplay,{filters:experiment.filters}),(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",onClick:openExperimentGoalModal,children:"Change goal"})]}),experimentInsightType===types.dw.TRENDS&&!experimentMathAggregationForTrends()&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.p2,{className:"",vertical:!0}),(0,jsx_runtime.jsx)("div",{className:"",children:(0,jsx_runtime.jsx)("div",{className:"mt-auto ml-auto",children:(0,jsx_runtime.jsx)(ExposureMetric,{experimentId:experimentId})})})]})]}):(0,jsx_runtime.jsxs)("div",{className:"text-muted",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-balance mt-2 mb-2",children:"Add the main goal before launching the experiment."}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),type:"secondary",size:"small","data-attr":"add-experiment-goal",onClick:openExperimentGoalModal,children:"Add goal"})]})]})}var Info=__webpack_require__("./frontend/src/scenes/experiments/ExperimentView/Info.tsx");function Overview(){let{experimentId,experimentResults,getIndexForVariant,getHighestProbabilityVariant,areResultsSignificant}=(0,index_esm.useValues)(experimentLogic.W);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg",children:"Summary"}),(0,jsx_runtime.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,jsx_runtime.jsx)(function(){let highestProbabilityVariant=getHighestProbabilityVariant(experimentResults),index=getIndexForVariant(experimentResults,highestProbabilityVariant||"");if(highestProbabilityVariant&&null!==index&&experimentResults){let{probability}=experimentResults;return(0,jsx_runtime.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:highestProbabilityVariant}),(0,jsx_runtime.jsx)("span",{children:"\xa0is winning with a\xa0"}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold text-success items-center",children:[`${(100*probability[highestProbabilityVariant]).toFixed(2)}% probability`,"\xa0"]}),(0,jsx_runtime.jsx)("span",{children:"of being best.\xa0"})]})}return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},{}),(0,jsx_runtime.jsx)(function(){return(0,jsx_runtime.jsxs)("div",{className:"flex-wrap",children:[(0,jsx_runtime.jsx)("span",{children:"Your results are\xa0"}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold",children:[`${areResultsSignificant?"significant":"not significant"}`,"."]})]})},{})]})]})}var FeatureFlagReleaseConditions=__webpack_require__("./frontend/src/scenes/feature-flags/FeatureFlagReleaseConditions.tsx"),groupsModel=__webpack_require__("./frontend/src/models/groupsModel.ts");function ReleaseConditionsModal(_ref){var _experiment$feature_f,_featureFlag$filters;let{experimentId}=_ref,{experiment,isReleaseConditionsModalOpen}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),{closeReleaseConditionsModal}=(0,index_esm.useActions)((0,experimentLogic.W)({experimentId})),_featureFlagLogic=(0,featureFlagLogic.hk)({id:null!==(_experiment$feature_f=experiment.feature_flag?.id)&&void 0!==_experiment$feature_f?_experiment$feature_f:null}),{featureFlag,nonEmptyVariants}=(0,index_esm.useValues)(_featureFlagLogic),{setFeatureFlagFilters,saveSidebarExperimentFeatureFlag}=(0,index_esm.useActions)(_featureFlagLogic);return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isReleaseConditionsModalOpen,onClose:closeReleaseConditionsModal,width:600,title:"Change release conditions",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:closeReleaseConditionsModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{saveSidebarExperimentFeatureFlag(featureFlag),closeReleaseConditionsModal()},type:"primary",children:"Save"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:"Adjusting user targeting may impact the validity of your results. Adjust only if you're aware of how changes will affect your experiment."}),(0,jsx_runtime.jsx)(FeatureFlagReleaseConditions.I,{id:`${experiment.feature_flag?.id}`,filters:null!==(_featureFlag$filters=featureFlag?.filters)&&void 0!==_featureFlag$filters?_featureFlag$filters:[],onChange:setFeatureFlagFilters,nonEmptyFeatureFlagVariants:nonEmptyVariants})]})})}function ReleaseConditionsTable(){let{experiment}=(0,index_esm.useValues)(experimentLogic.W),{reportExperimentReleaseConditionsViewed,openReleaseConditionsModal}=(0,index_esm.useActions)(experimentLogic.W),{aggregationLabel}=(0,index_esm.useValues)(groupsModel.$);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2",children:(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg",children:"Release conditions"})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,jsx_runtime.jsx)("div",{className:"ml-auto mb-2",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFlag,{}),onClick:()=>{openReleaseConditionsModal(),reportExperimentReleaseConditionsViewed(experiment.id)},type:"secondary",size:"xsmall",className:"font-semibold",children:"Manage release conditions"})})})]}),(0,jsx_runtime.jsx)(src.g3,{loading:!1,columns:[{key:"key",title:"",render:function Key(_,_item,index){return(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:`Set ${index+1}`})}},{key:"rollout_percentage",title:"Rollout",render:function Key(_,item){let aggregationTargetName=null!=experiment.filters.aggregation_group_type_index?aggregationLabel(experiment.filters.aggregation_group_type_index).plural:"users",releaseText=`${item.rollout_percentage}% of ${aggregationTargetName}`;return(0,jsx_runtime.jsx)("div",{children:releaseText.startsWith("100% of")?(0,jsx_runtime.jsx)(src.oe,{type:"highlight",children:releaseText}):releaseText})}},{key:"variant",title:"Override",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{children:item.variant||"--"})}}],dataSource:experiment.feature_flag?.filters.groups||[]})]})}var SummaryTable=__webpack_require__("./frontend/src/scenes/experiments/ExperimentView/SummaryTable.tsx");function Results(){let{experimentResults}=(0,index_esm.useValues)(experimentLogic.W);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(components.wD,{}),(0,jsx_runtime.jsx)(SummaryTable.H,{}),(0,jsx_runtime.jsx)(components.MN,{targetResults:experimentResults,showTable:!0})]})}var EntityFilterInfo=__webpack_require__("./frontend/src/lib/components/EntityFilterInfo.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),cleanFilters=__webpack_require__("./frontend/src/scenes/insights/utils/cleanFilters.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");let defaultFormValuesGenerator=(aggregationType,disableAddEventToDefault,cohortIdToFilter)=>{let eventAddition=disableAddEventToDefault?{}:{events:[{...(0,cleanFilters.ie)(),...void 0!==aggregationType?{math:"unique_group",math_group_type_index:aggregationType}:{},...cohortIdToFilter?{properties:[{key:"id",type:"cohort",value:cohortIdToFilter}]}:{}}]};return{name:"",filters:{insight:types.dw.TRENDS,...eventAddition}}},secondaryMetricsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>`${props.experimentId||"new"}-${props.defaultAggregationType}`),(0,index_esm.path)(key=>["scenes","experiment","secondaryMetricsLogic",key]),(0,index_esm.connect)(props=>({logic:[(0,insightLogic.zm)({dashboardItemId:experiments_constants.hr,syncWithUrl:!1})],values:[teamLogic.H,["currentTeamId"],(0,experimentLogic.W)({experimentId:props.experimentId}),["experiment"]],actions:[(0,insightDataLogic.S)({dashboardItemId:experiments_constants.hr}),["setQuery"],(0,insightVizDataLogic.Z)({dashboardItemId:experiments_constants.hr}),["updateQuerySource"]]})),(0,index_esm.actions)({openModalToCreateSecondaryMetric:!0,openModalToEditSecondaryMetric:function(metric,metricIdx){let showResults=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{metric,metricIdx,showResults}},saveSecondaryMetric:!0,closeModal:!0,setMetricId:metricIdx=>({metricIdx}),addNewMetric:metric=>({metric}),updateMetric:(metric,metricIdx)=>({metric,metricIdx}),deleteMetric:metricIdx=>({metricIdx}),setPreviewInsight:filters=>({filters})}),(0,index_esm.reducers)(_ref=>{let{props}=_ref;return{isModalOpen:[!1,{openModalToCreateSecondaryMetric:()=>!0,openModalToEditSecondaryMetric:()=>!0,closeModal:()=>!1}],showResults:[!1,{openModalToEditSecondaryMetric:(_,_ref2)=>{let{showResults}=_ref2;return showResults},closeModal:()=>!1}],existingModalSecondaryMetric:[null,{openModalToCreateSecondaryMetric:()=>null,openModalToEditSecondaryMetric:(_,_ref3)=>{let{metric}=_ref3;return metric}}],metrics:[props.initialMetrics,{addNewMetric:(metrics,_ref4)=>{let{metric}=_ref4;return[...metrics,{...metric}]},updateMetric:(metrics,_ref5)=>{let{metric,metricIdx}=_ref5,metricsCopy=[...metrics];return metricsCopy[metricIdx]=metric,metricsCopy},deleteMetric:(metrics,_ref6)=>{let{metricIdx}=_ref6;return metrics.filter((_,idx)=>idx!==metricIdx)}}],metricIdx:[0,{setMetricId:(_,_ref7)=>{let{metricIdx}=_ref7;return metricIdx}}]}}),(0,lib.forms)(_ref8=>{let{props,values}=_ref8;return{secondaryMetricModal:{defaults:defaultFormValuesGenerator(props.defaultAggregationType,!1,values.experiment?.exposure_cohort),errors:()=>({}),submit:async()=>{}}}}),(0,index_esm.listeners)(_ref9=>{let{props,actions,values}=_ref9;return{openModalToCreateSecondaryMetric:()=>{actions.resetSecondaryMetricModal(),actions.setPreviewInsight(defaultFormValuesGenerator(props.defaultAggregationType,!1,values.experiment?.exposure_cohort).filters)},openModalToEditSecondaryMetric:_ref10=>{let{metric:{name,filters},metricIdx}=_ref10;actions.setSecondaryMetricModalValue("name",name),actions.setPreviewInsight(filters),actions.setMetricId(metricIdx)},setPreviewInsight:async _ref11=>{let newInsightFilters,{filters}=_ref11;newInsightFilters=filters?.insight===types.dw.FUNNELS?(0,cleanFilters.Ow)({insight:types.dw.FUNNELS,funnel_viz_type:types.Ui.Steps,date_from:(0,dayjs.Bv)().subtract(14,"day").format("YYYY-MM-DD"),date_to:(0,dayjs.Bv)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:constants.xp.horizontal,aggregation_group_type_index:props.defaultAggregationType,...filters}):(0,cleanFilters.Ow)({insight:types.dw.TRENDS,date_from:(0,dayjs.Bv)().subtract(14,"day").format("YYYY-MM-DD"),date_to:(0,dayjs.Bv)().endOf("d").format("YYYY-MM-DDTHH:mm"),...defaultFormValuesGenerator(props.defaultAggregationType,(filters?.actions?.length||0)+(filters?.events?.length||0)>0).filters,...filters});let newQuery=(0,filtersToQueryNode.wK)(newInsightFilters);filters?.insight===types.dw.FUNNELS?newQuery.trendsFilter=void 0:newQuery.funnelsFilter=void 0,actions.updateQuerySource(newQuery)},setQuery:_ref12=>{let{query}=_ref12;actions.setSecondaryMetricModalValue("filters",(0,queryNodeToFilter.ce)(query.source))},saveSecondaryMetric:()=>{values.existingModalSecondaryMetric?actions.updateMetric(values.secondaryMetricModal,values.metricIdx):actions.addNewMetric(values.secondaryMetricModal),props.onMetricsChange(values.metrics),actions.closeModal()},deleteMetric:()=>{props.onMetricsChange(values.metrics)}}})]);function SecondaryMetricsModal(_ref){let{onMetricsChange,initialMetrics,experimentId,defaultAggregationType}=_ref,logic=secondaryMetricsLogic({onMetricsChange,initialMetrics,experimentId,defaultAggregationType}),{secondaryMetricModal,isModalOpen,showResults,isSecondaryMetricModalSubmitting,existingModalSecondaryMetric,metricIdx}=(0,index_esm.useValues)(logic),{deleteMetric,closeModal,saveSecondaryMetric,setPreviewInsight}=(0,index_esm.useActions)(logic),{secondaryMetricResults,isExperimentRunning}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),targetResults=secondaryMetricResults&&secondaryMetricResults[metricIdx];return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isModalOpen,onClose:closeModal,width:1e3,title:showResults?secondaryMetricModal.name:existingModalSecondaryMetric?"Edit secondary metric":"New secondary metric",footer:showResults?(0,jsx_runtime.jsx)(src.Jp,{form:"secondary-metric-modal-form",type:"secondary",onClick:closeModal,children:"Close"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[existingModalSecondaryMetric&&(0,jsx_runtime.jsx)(src.Jp,{className:"mr-auto",form:"secondary-metric-modal-form",type:"secondary",status:"danger",onClick:()=>deleteMetric(metricIdx),children:"Delete"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"secondary-metric-modal-form",type:"secondary",onClick:closeModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{form:"secondary-metric-modal-form",onClick:saveSecondaryMetric,type:"primary",loading:isSecondaryMetricModalSubmitting,"data-attr":"create-annotation-submit",children:existingModalSecondaryMetric?"Save":"Create"})]})]}),children:showResults?(0,jsx_runtime.jsx)(components.MN,{targetResults:targetResults,showTable:!1}):(0,jsx_runtime.jsxs)(lib.Form,{logic:secondaryMetricsLogic,props:{onMetricsChange,initialMetrics,experimentId,defaultAggregationType},formKey:"secondaryMetricModal",id:"secondary-metric-modal-form",className:"space-y-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",children:(0,jsx_runtime.jsx)(src.DF,{"data-attr":"secondary-metric-name"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"filters",label:"Query",children:(0,jsx_runtime.jsx)(MetricSelector,{dashboardItemId:experiments_constants.hr,setPreviewInsight:setPreviewInsight,showDateRangeBanner:isExperimentRunning})})]})})}function SecondaryMetricsTable(_ref2){let{onMetricsChange,initialMetrics,experimentId,defaultAggregationType}=_ref2,logic=secondaryMetricsLogic({onMetricsChange,initialMetrics,experimentId,defaultAggregationType}),{metrics}=(0,index_esm.useValues)(logic),{openModalToCreateSecondaryMetric,openModalToEditSecondaryMetric}=(0,index_esm.useActions)(logic),{experimentResults,secondaryMetricResultsLoading,experiment,secondaryMetricResults,tabularSecondaryMetricResults,countDataForVariant,exposureCountDataForVariant,conversionRateForVariant,experimentMathAggregationForTrends,getHighestProbabilityVariant}=(0,index_esm.useValues)((0,experimentLogic.W)({experimentId})),columns=[{children:[{title:(0,jsx_runtime.jsx)("div",{className:"py-2",children:"Variant"}),render:function Key(_,item){return experimentResults&&experimentResults.insight?(0,jsx_runtime.jsx)("div",{className:"flex items-center py-2",children:(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:item.variant})}):(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:item.variant})}}]}];return experiment.secondary_metrics?.forEach((metric,idx)=>{let targetResults=secondaryMetricResults?.[idx],winningVariant=getHighestProbabilityVariant(targetResults||null),Header=()=>jsx_runtime.jsx("div",{className:"",children:jsx_runtime.jsxs("div",{className:"flex",children:[jsx_runtime.jsx("div",{className:"w-3/4 truncate",children:utils.fm(metric.name)}),jsx_runtime.jsx("div",{className:"w-1/4 flex flex-col justify-end",children:jsx_runtime.jsxs("div",{className:"ml-auto space-x-2 pb-1 inline-flex",children:[jsx_runtime.jsx(src.Jp,{className:"max-w-72",type:"secondary",size:"xsmall",icon:jsx_runtime.jsx(icons.Ii,{}),onClick:()=>openModalToEditSecondaryMetric(metric,idx,!0),disabledReason:targetResults&&targetResults.insight?void 0:"There are no results for this metric yet"}),jsx_runtime.jsx(src.Jp,{className:"max-w-72",type:"secondary",size:"xsmall",icon:jsx_runtime.jsx(posthog_icons_es.IconPencil,{}),onClick:()=>openModalToEditSecondaryMetric(metric,idx,!1)})]})})]})});metric.filters.insight===types.dw.TRENDS?columns.push({title:jsx_runtime.jsx(Header,{}),children:[{title:jsx_runtime.jsxs("div",{className:"flex",children:["[",targetResults&&targetResults.insight?.[0]&&"action"in targetResults.insight[0]&&jsx_runtime.jsx(EntityFilterInfo.c,{filter:targetResults.insight[0].action}),"]",jsx_runtime.jsx("span",{className:"pl-1",children:experimentMathAggregationForTrends()?"metric":"count"})]}),render:function Key(_,item){let{variant}=item;return jsx_runtime.jsx("div",{children:targetResults?countDataForVariant(targetResults,variant):"—"})}},{title:"Exposure",render:function Key(_,item){let{variant}=item;return jsx_runtime.jsx("div",{children:targetResults?exposureCountDataForVariant(targetResults,variant):"—"})}},{title:"Win probability",render:function Key(_,item){let{variant}=item;return jsx_runtime.jsx("div",{className:variant===winningVariant?"text-success":"",children:jsx_runtime.jsx("b",{children:targetResults?.probability?.[variant]!=void 0?`${(targetResults.probability?.[variant]*100).toFixed(1)}%`:"—"})})}}]}):columns.push({title:jsx_runtime.jsx(Header,{}),children:[{title:"Conversion rate",render:function Key(_,item){let{variant}=item,conversionRate=conversionRateForVariant(targetResults||null,variant);return conversionRate?jsx_runtime.jsx("div",{children:`${conversionRate.toFixed(2)}%`}):jsx_runtime.jsx(jsx_runtime.Fragment,{children:"—"})}},{title:"Win probability",render:function Key(_,item){let{variant}=item;return jsx_runtime.jsx("div",{className:variant===winningVariant?"text-success":"",children:jsx_runtime.jsx("b",{children:targetResults?.probability?.[variant]!=void 0?`${(targetResults.probability?.[variant]*100).toFixed(1)}%`:"—"})})}}]})}),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2 pt-5",children:(0,jsx_runtime.jsxs)("div",{className:"inline-flex space-x-2 mb-0",children:[(0,jsx_runtime.jsx)("h2",{className:"mb-0 font-semibold text-lg",children:"Secondary metrics"}),metrics.length>0&&(0,jsx_runtime.jsx)(src.u,{title:"Monitor side effects of your experiment.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})})]})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,jsx_runtime.jsx)("div",{className:"ml-auto",children:metrics&&metrics.length>0&&(0,jsx_runtime.jsx)("div",{className:"mb-2 mt-4 justify-end",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:openModalToCreateSecondaryMetric,disabledReason:metrics.length>=10?"You can only add up to 10 secondary metrics.":void 0,children:"Add metric"})})})})]}),metrics&&metrics.length>0?(0,jsx_runtime.jsx)(src.g3,{className:"secondary-metrics-table",loading:secondaryMetricResultsLoading,columns:columns,dataSource:tabularSecondaryMetricResults,emptyState:(0,jsx_runtime.jsx)("div",{children:"Waiting for experiment to start…"})}):(0,jsx_runtime.jsx)("div",{className:"border rounded bg-bg-light pt-6 pb-8 text-muted mt-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center mx-auto space-y-3",children:[(0,jsx_runtime.jsx)(icons.Ii,{fontSize:"30"}),(0,jsx_runtime.jsxs)("div",{className:"text-sm text-center text-balance",children:["Add up to ",10," secondary metrics to monitor side effects of your experiment."]}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),type:"secondary",size:"small",onClick:openModalToCreateSecondaryMetric,children:"Add metric"})]})})]}),(0,jsx_runtime.jsx)(SecondaryMetricsModal,{onMetricsChange:onMetricsChange,initialMetrics:initialMetrics,experimentId:experimentId,defaultAggregationType:defaultAggregationType})]})}let ResultsTab=()=>{let{experiment,experimentResults}=(0,index_esm.useValues)(experimentLogic.W),{updateExperimentSecondaryMetrics}=(0,index_esm.useActions)(experimentLogic.W),hasResultsInsight=experimentResults&&experimentResults.insight;return(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[hasResultsInsight?(0,jsx_runtime.jsx)(Results,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["web"===experiment.type?(0,jsx_runtime.jsx)(WebExperimentImplementationDetails,{experiment:experiment}):(0,jsx_runtime.jsx)(ExperimentImplementationDetails,{experiment:experiment}),experiment.start_date&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(components.wD,{}),(0,jsx_runtime.jsx)(components.LU,{})]})]}),(0,jsx_runtime.jsx)(SecondaryMetricsTable,{experimentId:experiment.id,onMetricsChange:metrics=>updateExperimentSecondaryMetrics(metrics),initialMetrics:experiment.secondary_metrics,defaultAggregationType:experiment.parameters?.aggregation_group_type_index})]})},VariantsTab=()=>(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsx)(ReleaseConditionsTable,{}),(0,jsx_runtime.jsx)(DistributionTable,{})]});function ExperimentView(){let{experimentLoading,experimentResultsLoading,experimentId,experimentResults,tabKey}=(0,index_esm.useValues)(experimentLogic.W),{setTabKey}=(0,index_esm.useActions)(experimentLogic.W),hasResultsInsight=experimentResults&&experimentResults.insight;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(components.nt,{}),(0,jsx_runtime.jsx)("div",{className:"space-y-8 experiment-view",children:experimentLoading?(0,jsx_runtime.jsx)(components.Gu,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Info.k,{}),experimentResultsLoading?(0,jsx_runtime.jsx)(components.f7,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[hasResultsInsight?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(Overview,{}),(0,jsx_runtime.jsx)(src.p2,{className:"mt-4"})]}):null,(0,jsx_runtime.jsxs)("div",{className:"xl:flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2 pr-2",children:(0,jsx_runtime.jsx)(Goal,{})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 xl:pl-2 mt-8 xl:mt-0",children:(0,jsx_runtime.jsx)(DataCollection,{})})]}),(0,jsx_runtime.jsx)(src.TP,{activeKey:tabKey,onChange:key=>setTabKey(key),tabs:[{key:"results",label:"Results",content:(0,jsx_runtime.jsx)(ResultsTab,{})},{key:"variants",label:"Variants",content:(0,jsx_runtime.jsx)(VariantsTab,{})}]})]}),(0,jsx_runtime.jsx)(ExperimentGoalModal,{experimentId:experimentId}),(0,jsx_runtime.jsx)(ExperimentExposureModal,{experimentId:experimentId}),(0,jsx_runtime.jsx)(DistributionModal,{experimentId:experimentId}),(0,jsx_runtime.jsx)(ReleaseConditionsModal,{experimentId:experimentId})]})})]})}let scene={component:Experiment_Experiment,logic:experimentLogic.W,paramsToProps:_ref=>{let{params:{id}}=_ref;return{experimentId:"new"===id?"new":parseInt(id)}}};function Experiment_Experiment(){let{experimentId,editingExistingExperiment,experimentMissing}=(0,index_esm.useValues)(experimentLogic.W);return experimentMissing?(0,jsx_runtime.jsx)(NotFound.T,{object:"experiment"}):"new"===experimentId||editingExistingExperiment?(0,jsx_runtime.jsx)(ExperimentForm,{}):(0,jsx_runtime.jsx)(ExperimentView,{})}}}]);
//# sourceMappingURL=54980.1adc8e25.iframe.bundle.js.map