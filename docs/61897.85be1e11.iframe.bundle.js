"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[61897],{"../../frontend/src/scenes/activity/explore/SessionsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SessionsScene:()=>SessionsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes=__webpack_require__("../../frontend/src/scenes/scenes.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),queryFeatures=__webpack_require__("../../frontend/src/queries/nodes/DataTable/queryFeatures.ts"),types=__webpack_require__("../../frontend/src/types.ts"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),queries_utils=__webpack_require__("../../frontend/src/queries/utils.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function isSessionLive(endTimestamp){return!!endTimestamp&&60>(0,dayjs.Bv)().diff((0,dayjs.Bv)(endTimestamp),"second")}function findColumnIndex(select,columnName){return select?select.findIndex(field=>field===columnName||"string"==typeof field&&field.includes(columnName)):-1}let renderSessionId=_ref=>{let{value,record,query}=_ref,source=query.source;if(!(0,queries_utils.Ip)(source))return(0,jsx_runtime.jsx)(Link.r,{to:urls.j.sessionProfile(value),className:"font-mono",children:value});let endTimestampIndex=findColumnIndex(source.select,"$end_timestamp"),recordArray=Array.isArray(record)?record:[],isLive=isSessionLive(-1!==endTimestampIndex?recordArray[endTimestampIndex]:null);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-row align-center items-center gap-2",children:[isLive?(0,jsx_runtime.jsx)(src.u,{title:"Live session",children:(0,jsx_runtime.jsxs)("span",{className:"relative flex h-2.5 w-2.5",children:[(0,jsx_runtime.jsx)("span",{className:"absolute inline-flex h-full w-full rounded-full bg-danger animate-ping",style:{opacity:.75}}),(0,jsx_runtime.jsx)("span",{className:"relative inline-flex rounded-full h-2.5 w-2.5 bg-danger"})]})}):(0,jsx_runtime.jsx)("span",{className:"relative flex h-2.5 w-2.5"}),(0,jsx_runtime.jsx)(Link.r,{to:urls.j.sessionProfile(value),className:"font-mono",children:value})]})};function getSessionsColumns(){return{session_id:{title:"Session ID",render:renderSessionId},$start_timestamp:{title:"Start time",render:_ref2=>{let{value}=_ref2;return(0,jsx_runtime.jsx)(TZLabel.w,{time:value,showSeconds:!0})}},$end_timestamp:{title:"End time",render:_ref3=>{let{value}=_ref3;return(0,jsx_runtime.jsx)(TZLabel.w,{time:value,showSeconds:!0})}},$session_duration:{title:"Duration",render:_ref4=>{let{value}=_ref4;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,utils.Dh)(value)})}},$entry_current_url:{title:"Entry URL"},$pageview_count:{title:"Pageviews"},$is_bounce:{title:"Bounced",render:_ref5=>{let{value}=_ref5;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:1===value||!0===value?"Yes":"No"})}}}}function createSessionsRowTransformer(query){return rows=>{if(!(0,queries_utils.Ip)(query.source)||0===rows.length)return rows;let startTimestampIndex=findColumnIndex(query.source.select,"$start_timestamp");if(-1===startTimestampIndex)return rows;let lastTimestamp=null,newRows=[];for(let row of rows){if(row.result&&Array.isArray(row.result)){let currentTimestamp=row.result[startTimestampIndex];lastTimestamp&&currentTimestamp&&!(0,dayjs.Bv)(currentTimestamp).isSame((0,dayjs.Bv)(lastTimestamp),"day")&&newRows.push({label:(0,dayjs.Bv)(currentTimestamp).format("LL")}),currentTimestamp&&(lastTimestamp=currentTimestamp)}newRows.push(row)}return newRows}}var fast_deep_equal=__webpack_require__("../../node_modules/.pnpm/fast-deep-equal@3.1.3/node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),tabAwareActionToUrl=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareActionToUrl.ts"),tabAwareScene=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareScene.ts"),tabAwareUrlToAction=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareUrlToAction.ts"),defaults=__webpack_require__("../../frontend/src/scenes/activity/explore/defaults.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx");let sessionsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","sessions","sessionsSceneLogic"]),(0,tabAwareScene.P)(),(0,index_esm.connect)(()=>({values:[teamLogic.teamLogic,["currentTeam"],featureFlagLogic.featureFlagLogic,["featureFlags"]]})),(0,index_esm.actions)({setQuery:query=>({query})}),(0,index_esm.reducers)({savedQuery:[null,{setQuery:(_,_ref)=>{let{query}=_ref;return query}}]}),(0,index_esm.selectors)({defaultQuery:[()=>[],()=>(0,defaults.Z)()],query:[s=>[s.savedQuery,s.defaultQuery],(savedQuery,defaultQuery)=>savedQuery||defaultQuery],breadcrumbs:[()=>[],()=>[{key:sceneTypes.x.ExploreSessions,name:scenes.lc[sceneTypes.x.ExploreSessions].name,iconType:scenes.lc[sceneTypes.x.ExploreSessions].iconType||"default_icon_type"}]]}),(0,tabAwareActionToUrl.N)(_ref2=>{let{values}=_ref2;return{setQuery:()=>[urls.j.activity(types.ZO.ExploreSessions),{},(0,utils.h0)(values.query,values.defaultQuery)?{}:{q:values.query},{replace:!0}]}}),(0,tabAwareUrlToAction.O)(_ref3=>{let{actions,values}=_ref3;return{[urls.j.activity(types.ZO.ExploreSessions)]:(_,__,_ref4)=>{let{q:queryParam}=_ref4;if(!fast_deep_equal_default()(queryParam,values.query)){if(!queryParam){(0,utils.h0)(values.query,values.defaultQuery)||actions.setQuery(values.defaultQuery);return}if("object"!=typeof queryParam){LemonToast.UJ.error("Invalid query in URL"),console.error({queryParam});return}actions.setQuery(queryParam)}}}}),(0,index_esm.afterMount)(_ref5=>{let{values}=_ref5;values.featureFlags[constants.y8.SESSIONS_EXPLORER]||lib.router.actions.push(urls.j.activity(types.ZO.ExploreEvents))})]);var explore_utils=__webpack_require__("../../frontend/src/scenes/activity/explore/utils.ts");function SessionsScene(){let{tabId}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{query}=(0,index_esm.useValues)(sessionsSceneLogic),{setQuery}=(0,index_esm.useActions)(sessionsSceneLogic),tabs=(0,explore_utils.b)(),dataTableRowsTransformer=(0,react.useMemo)(()=>createSessionsRowTransformer(query),[query]);return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:types.ZO.ExploreSessions,tabs:tabs,sceneInset:!0,className:"mb-3"}),(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:scenes.lc[sceneTypes.x.ExploreSessions].name,description:scenes.lc[sceneTypes.x.ExploreSessions].description,resourceType:{type:scenes.lc[sceneTypes.x.ExploreSessions].iconType||"default_icon_type"}}),(0,jsx_runtime.jsx)(Query.A,{attachTo:sessionsSceneLogic({tabId}),uniqueKey:`sessions-scene-${tabId}`,query:query,setQuery:setQuery,context:{columns:getSessionsColumns(),showOpenEditorButton:!0,extraDataTableQueryFeatures:[queryFeatures.P.highlightExceptionEventRows],dataTableMaxPaginationLimit:200,dataTableRowsTransformer}})]})}let scene={component:SessionsScene,logic:sessionsSceneLogic}},"../../frontend/src/scenes/activity/explore/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{b:()=>useActivityTabs});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/constants.tsx"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/types.ts");function useActivityTabs(){let{featureFlags}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_2__.featureFlagLogic);return[{key:_types__WEBPACK_IMPORTED_MODULE_4__.ZO.ExploreEvents,label:"Events",link:scenes_urls__WEBPACK_IMPORTED_MODULE_3__.j.activity(_types__WEBPACK_IMPORTED_MODULE_4__.ZO.ExploreEvents)},...featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_1__.y8.SESSIONS_EXPLORER]?[{key:_types__WEBPACK_IMPORTED_MODULE_4__.ZO.ExploreSessions,label:"Sessions",link:scenes_urls__WEBPACK_IMPORTED_MODULE_3__.j.activity(_types__WEBPACK_IMPORTED_MODULE_4__.ZO.ExploreSessions)}]:[],{key:_types__WEBPACK_IMPORTED_MODULE_4__.ZO.LiveEvents,label:"Live",link:scenes_urls__WEBPACK_IMPORTED_MODULE_3__.j.activity(_types__WEBPACK_IMPORTED_MODULE_4__.ZO.LiveEvents)}]}}}]);