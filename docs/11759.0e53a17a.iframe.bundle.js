"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[11759],{"../../products/tasks/frontend/TaskTracker.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{TaskTracker:()=>TaskTracker,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),useFeatureFlag=__webpack_require__("../../frontend/src/lib/hooks/useFeatureFlag.ts"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),tasksLogic=__webpack_require__("../../products/tasks/frontend/tasksLogic.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),constants=__webpack_require__("../../products/tasks/frontend/constants.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function TaskCard(_ref){let{task,onAssignToWorkflow,onClick,draggable=!1,workflows=[]}=_ref,[selectedWorkflowId,setSelectedWorkflowId]=(0,react.useState)(""),isInBacklog=!task.workflow||!task.current_stage;return(0,jsx_runtime.jsxs)(src.Mi,{className:`p-3 ${draggable?"cursor-grab active:cursor-grabbing":"cursor-pointer"}`,hoverEffect:!0,onClick:()=>{onClick&&onClick(task.id)},children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,jsx_runtime.jsx)("h4",{className:"font-medium text-sm leading-tight",children:task.title})}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted mb-3 line-clamp-2",children:task.description}),(task.github_branch||task.github_pr_url)&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 mb-2",children:[(0,jsx_runtime.jsx)(icons.Uv,{className:"text-xs"}),task.github_branch&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted",children:[(0,jsx_runtime.jsx)(icons.$M,{}),(0,jsx_runtime.jsx)("span",{className:"truncate max-w-32",children:task.github_branch})]}),task.github_pr_url&&(0,jsx_runtime.jsxs)(src.rU,{to:task.github_pr_url,target:"_blank",className:"flex items-center gap-1 text-xs text-link hover:text-link-hover",onClick:e=>e.stopPropagation(),children:[(0,jsx_runtime.jsx)("span",{children:"↗"}),(0,jsx_runtime.jsx)("span",{children:"PR"})]})]}),task.repository_scope&&(0,jsx_runtime.jsx)("div",{className:"mb-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium",children:"Repos:"}),"single"===task.repository_scope&&task.primary_repository&&(0,jsx_runtime.jsxs)("span",{className:"text-primary",children:[task.primary_repository.organization,"/",task.primary_repository.repository]}),"multiple"===task.repository_scope&&task.repository_list&&(0,jsx_runtime.jsxs)("span",{className:"text-primary",children:[task.repository_list.length," repositories"]}),"smart_select"===task.repository_scope&&(0,jsx_runtime.jsx)("span",{className:"text-primary",children:"Smart Select"})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${constants.z[task.origin_product]}`,children:constants.V[task.origin_product]}),isInBacklog&&onAssignToWorkflow&&workflows.length>0&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[(0,jsx_runtime.jsx)(src.Yv,{value:selectedWorkflowId,onChange:value=>setSelectedWorkflowId(value),options:[{value:"",label:"Select workflow..."},...workflows.map(workflow=>({value:workflow.id,label:workflow.name}))],placeholder:"Select workflow",size:"small",className:"min-w-32"}),(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"primary",onClick:e=>{e.stopPropagation(),selectedWorkflowId&&onAssignToWorkflow&&onAssignToWorkflow(task.id,selectedWorkflowId)},disabled:!selectedWorkflowId,children:"Assign"})]})]})]})}var types=__webpack_require__("../../products/tasks/frontend/types.ts"),RepositorySelector=__webpack_require__("../../products/tasks/frontend/components/RepositorySelector.tsx");function TaskCreateModal(_ref){let{isOpen,onClose}=_ref,{createTask}=(0,index_esm.useActions)(tasksLogic.A),[formData,setFormData]=(0,react.useState)({title:"",description:"",origin_product:types.A.USER_CREATED,repositoryConfig:{integrationId:void 0,organization:void 0,repository:void 0}}),[loading,setLoading]=(0,react.useState)(!1),[errors,setErrors]=(0,react.useState)({}),resetForm=()=>{setFormData({title:"",description:"",origin_product:types.A.USER_CREATED,repositoryConfig:{integrationId:void 0,organization:void 0,repository:void 0}})},handleSubmit=async()=>{let newErrors={};if(formData.title.trim()||(newErrors.title="Title is required"),formData.description.trim()||(newErrors.description="Description is required"),(formData.repositoryConfig.integrationId||formData.repositoryConfig.organization||formData.repositoryConfig.repository)&&(!formData.repositoryConfig.integrationId||!formData.repositoryConfig.organization||!formData.repositoryConfig.repository)&&(newErrors.repository="Please complete the repository configuration or leave it empty"),Object.keys(newErrors).length>0){setErrors(newErrors);return}setLoading(!0),setErrors({});try{let taskData={title:formData.title,description:formData.description,origin_product:formData.origin_product,repository_config:{organization:formData.repositoryConfig.organization||"",repository:formData.repositoryConfig.repository||""}};formData.repositoryConfig.integrationId&&(taskData.github_integration=formData.repositoryConfig.integrationId),await createTask(taskData),resetForm(),onClose()}catch(error){console.error("Failed to create task:",error),setErrors({submit:"Failed to create task. Please try again."})}finally{setLoading(!1)}},handleCancel=()=>{resetForm(),setErrors({}),onClose()};return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isOpen,onClose:handleCancel,title:"Create New Task",width:800,footer:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:handleCancel,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:handleSubmit,loading:loading,disabled:loading,children:"Create Task"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[errors.submit&&(0,jsx_runtime.jsx)("div",{className:"bg-danger-3000 text-danger border border-danger rounded p-3 text-sm",children:errors.submit}),(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Title *"}),(0,jsx_runtime.jsx)(src.DF,{value:formData.title,onChange:value=>setFormData({...formData,title:value}),placeholder:"Enter task title...",status:errors.title?"danger":void 0}),errors.title&&(0,jsx_runtime.jsx)("p",{className:"text-danger text-xs mt-1",children:errors.title})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description *"}),(0,jsx_runtime.jsx)(src._V,{value:formData.description,onChange:value=>setFormData({...formData,description:value}),placeholder:"Describe the task in detail...",rows:4}),errors.description&&(0,jsx_runtime.jsx)("p",{className:"text-danger text-xs mt-1",children:errors.description})]}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Origin"}),(0,jsx_runtime.jsx)(src.Yv,{value:formData.origin_product,onChange:value=>setFormData({...formData,origin_product:value}),options:Object.entries(constants.V).map(_ref2=>{let[key,label]=_ref2;return{value:key,label}})})]})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Repository Configuration"}),(0,jsx_runtime.jsx)(RepositorySelector.G,{value:formData.repositoryConfig,onChange:config=>setFormData({...formData,repositoryConfig:config})}),errors.repository&&(0,jsx_runtime.jsx)("p",{className:"text-danger text-xs mt-2",children:errors.repository})]})]})})}var MaxTool=__webpack_require__("../../frontend/src/scenes/max/MaxTool.tsx"),maxLogic=__webpack_require__("../../frontend/src/scenes/max/maxLogic.tsx");function TaskSummariesMaxTool(){let isEnabled=(0,useFeatureFlag.y)("TASK_SUMMARIES"),{setQuestion,focusInput,startNewConversation}=(0,index_esm.useActions)(maxLogic.v8),initialPrompt="Use the session_summarization tool to summarize all recent session recordings in the last 30 days. Focus on actionable fixes.";return isEnabled?(0,jsx_runtime.jsx)("div",{className:"relative",children:(0,jsx_runtime.jsx)(MaxTool.L,{identifier:"session_summarization",initialMaxPrompt:initialPrompt,onMaxOpen:()=>{startNewConversation(),setQuestion(initialPrompt),focusInput()},position:"top-right",children:(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"Kanban Board"})})}):null}function BacklogView(){let{unassignedTasks,assignedTasks,isCreateModalOpen,allWorkflows}=(0,index_esm.useValues)(tasksLogic.A),{assignTaskToWorkflow,openTaskDetail,openCreateModal,closeCreateModal}=(0,index_esm.useActions)(tasksLogic.A),totalTasks=unassignedTasks.length+assignedTasks.length;return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"All Tasks"})}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3",children:[(0,jsx_runtime.jsxs)("span",{className:"text-sm text-muted",children:[totalTasks," tasks"]}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:openCreateModal,children:"Create Task"})]})]}),unassignedTasks.length>0&&(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsxs)("h3",{className:"font-semibold text-muted",children:["Unassigned Tasks (",unassignedTasks.length,")"]}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:unassignedTasks.map(task=>(0,jsx_runtime.jsx)(TaskCard,{task:task,onAssignToWorkflow:assignTaskToWorkflow,onClick:openTaskDetail,workflows:allWorkflows},task.id))})]}),assignedTasks.length>0&&(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsxs)("h3",{className:"font-semibold text-muted",children:["Assigned Tasks (",assignedTasks.length,")"]}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:assignedTasks.map(task=>(0,jsx_runtime.jsx)(TaskCard,{task:task,onAssignToWorkflow:assignTaskToWorkflow,onClick:openTaskDetail,workflows:allWorkflows},task.id))})]}),0===totalTasks&&(0,jsx_runtime.jsxs)("div",{className:"text-center py-8 text-muted",children:[(0,jsx_runtime.jsx)("span",{children:"No tasks created yet. Create a task to get started."}),(0,jsx_runtime.jsx)(TaskSummariesMaxTool,{})]}),(0,jsx_runtime.jsx)(TaskCreateModal,{isOpen:isCreateModalOpen,onClose:closeCreateModal})]})}var lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),integrationsLogic=__webpack_require__("../../frontend/src/lib/integrations/integrationsLogic.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");function GitHubIntegrationSettings(){let{integrations,integrationsLoading,githubRepositoriesLoading,getGitHubRepositories}=(0,index_esm.useValues)(integrationsLogic.a),{loadIntegrations,loadGitHubRepositories}=(0,index_esm.useActions)(integrationsLogic.a),githubIntegration=integrations?.find(integration=>"github"===integration.kind),repositories=githubIntegration?getGitHubRepositories(githubIntegration.id):[];(0,react.useEffect)(()=>{loadIntegrations()},[loadIntegrations]),(0,react.useEffect)(()=>{githubIntegration&&loadGitHubRepositories(githubIntegration.id)},[githubIntegration,loadGitHubRepositories]);let handleManageIntegration=()=>{lib.router.actions.push(urls.j.settings("environment-integrations"))};return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(icons.Uv,{className:"text-2xl"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"GitHub Integration"}),githubIntegration&&(0,jsx_runtime.jsx)(src.oe,{type:"success",children:"Connected"})]}),(0,jsx_runtime.jsx)(src.Mi,{className:"p-6",children:githubIntegration?(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("h3",{className:"font-medium",children:["Connected to ",githubIntegration.display_name]}),(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm",children:'Issues moved to "To Do" will automatically create branches and pull requests.'})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,jsx_runtime.jsxs)("h4",{className:"font-medium flex items-center gap-2",children:[(0,jsx_runtime.jsx)(icons.$M,{className:"text-lg"}),"Accessible Repositories"]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-1",children:[(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.tr,{}),onClick:()=>githubIntegration&&loadGitHubRepositories(githubIntegration.id),loading:githubRepositoriesLoading,tooltip:"Refresh repositories"}),(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.pF,{}),to:githubIntegration?.config?.installation_id?`https://github.com/settings/installations/${githubIntegration.config.installation_id}`:void 0,tooltip:"Manage repository access on GitHub"})]})]}),githubRepositoriesLoading?(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-muted text-sm",children:[(0,jsx_runtime.jsx)(src.$j,{className:"text-lg"}),"Loading repositories..."]}):repositories.length>0?(0,jsx_runtime.jsx)("div",{className:"space-y-1",children:repositories.map(repo=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-sm bg-accent-3000 rounded px-2 py-1",children:[(0,jsx_runtime.jsx)(icons.$M,{className:"text-muted"}),(0,jsx_runtime.jsxs)("span",{className:"font-mono",children:[githubIntegration.config?.account?.name||"GitHub","/",repo]})]},repo))}):(0,jsx_runtime.jsxs)("div",{className:"text-muted text-sm",children:[(0,jsx_runtime.jsx)("p",{children:"No repositories found."}),(0,jsx_runtime.jsx)("p",{className:"mt-1",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.pF,{}),to:githubIntegration?.config?.installation_id?`https://github.com/settings/installations/${githubIntegration.config.installation_id}`:void 0,children:"Configure repository access"})})]})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(icons.pF,{}),onClick:handleManageIntegration,children:"Manage Integration"})]}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"font-medium",children:"No GitHub integration"}),(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm",children:"Connect GitHub to enable automatic branch creation and pull requests for issues."})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:handleManageIntegration,loading:integrationsLoading,children:"Connect GitHub"})]})})]})}var core_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@dnd-kit/core/dist/core.esm.js"),sortable_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+sortable@7.0.2_@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0__react@18.2.0/node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),utilities_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+utilities@3.2.1_react@18.2.0/node_modules/@dnd-kit/utilities/dist/utilities.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let workflowBuilderLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","tasks","components","workflowBuilderLogic"]),(0,index_esm.props)({}),(0,index_esm.actions)({setWorkflowName:name=>({name}),setWorkflowDescription:description=>({description}),setWorkflowColor:color=>({color}),addStage:!0,removeStage:stageId=>({stageId}),updateStage:(stageId,updates)=>({stageId,updates}),saveWorkflow:!0,deleteWorkflow:!0,setSavedWorkflow:workflow=>({workflow}),setDeletedWorkflow:!0,resetBuilder:!0}),(0,kea_loaders_lib.loaders)({agents:[[],{loadAgents:async()=>(await api.ZP.get("api/projects/@current/agents/")).results||[]}]}),(0,index_esm.reducers)(_ref=>{let{props}=_ref;return{workflowName:[props.workflow?.name||"",{setWorkflowName:(_,_ref2)=>{let{name}=_ref2;return name},resetBuilder:()=>""}],workflowDescription:[props.workflow?.description||"",{setWorkflowDescription:(_,_ref3)=>{let{description}=_ref3;return description},resetBuilder:()=>""}],workflowColor:[props.workflow?.color||"#3b82f6",{setWorkflowColor:(_,_ref4)=>{let{color}=_ref4;return color},resetBuilder:()=>"#3b82f6"}],stages:[props.workflow?.stages&&props.workflow.stages.length>0?props.workflow.stages:[{id:"temp-input",name:"Input",key:"input",position:0,color:"#6b7280",is_manual_only:!0,is_archived:!1,task_count:0},{id:"temp-complete",name:"Complete",key:"complete",position:1,color:"#10b981",is_manual_only:!0,is_archived:!1,task_count:0}],{addStage:state=>{if(!state||0===state.length)return state;let newPosition=state.length-1,suggestedNames=["Planning","Development","Review","Testing","Deployment"],stageName=newPosition<=suggestedNames.length&&suggestedNames[newPosition-1]||`Stage ${newPosition}`,newStage={id:`temp-${Date.now()}`,name:stageName,key:stageName.toLowerCase().replace(/\s+/g,"_"),position:newPosition,color:"#6b7280",is_manual_only:!1,is_archived:!1,task_count:0,agent:""},newState=[...state];return newState.splice(newPosition,0,newStage),newState.map((stage,index)=>({...stage,position:index}))},removeStage:(state,_ref5)=>{let{stageId}=_ref5;return state.filter(s=>s.id!==stageId).map((stage,index)=>({...stage,position:index}))},updateStage:(state,_ref6)=>{let{stageId,updates}=_ref6;return state.map(stage=>{if(stage.id===stageId){let updatedStage={...stage,...updates};return updates.name&&(updatedStage.key=updates.name.toLowerCase().replace(/\s+/g,"_")),updatedStage}return stage})},resetBuilder:()=>[]}],savedWorkflow:[null,{setSavedWorkflow:(_,_ref7)=>{let{workflow}=_ref7;return workflow},resetBuilder:()=>null}],deletedWorkflow:[!1,{setDeletedWorkflow:()=>!0,resetBuilder:()=>!1}]}}),(0,index_esm.selectors)({isValid:[s=>[s.workflowName,s.stages],(workflowName,stages)=>workflowName.trim().length>0&&stages&&stages.length>=2&&stages[stages.length-1]?.name.toLowerCase()==="complete"],workflowData:[s=>[s.workflowName,s.workflowDescription,s.workflowColor,s.stages],(workflowName,workflowDescription,workflowColor,stages)=>({name:workflowName,description:workflowDescription,color:workflowColor,stages:stages,is_default:!1})]}),(0,index_esm.listeners)(_ref8=>{let{actions,values,props}=_ref8;return{saveWorkflow:async()=>{if(!values.isValid)throw Error("Workflow is not valid");let workflowData={name:values.workflowName,description:values.workflowDescription,color:values.workflowColor,is_default:!1};try{let workflow;workflow=props.workflow?await api.ZP.update(`api/projects/@current/workflows/${props.workflow.id}/`,workflowData):await api.ZP.create("api/projects/@current/workflows/",workflowData);let savedStages=[];if(!values.stages||0===values.stages.length)throw Error("No stages to save");for(let stage of values.stages){let savedStage;let stageData={workflow:workflow.id,name:stage.name,key:stage.key,position:stage.position,color:stage.color,is_manual_only:"complete"===stage.name.toLowerCase()||!stage.agent,agent:"complete"===stage.name.toLowerCase()?null:stage.agent||null};savedStage=stage.id.startsWith("temp-")?await api.ZP.create("api/projects/@current/workflow-stages/",stageData):await api.ZP.update(`api/projects/@current/workflow-stages/${stage.id}/`,stageData),savedStages.push(savedStage)}actions.setSavedWorkflow({...workflow,stages:savedStages}),src.UJ.success(props.workflow?"Workflow updated successfully":"Workflow created successfully"),tasksLogic.A.actions.setActiveTab("kanban")}catch(error){if(console.error("Failed to save workflow:",error),error?.response?.status===400&&error?.response?.data){let errorData=error.response.data;errorData.name?src.UJ.error(errorData.name):src.UJ.error("Failed to save workflow. Please check your input.")}else src.UJ.error("Failed to save workflow. Please try again.");throw error}},deleteWorkflow:async()=>{if(props.workflow)try{await api.ZP.create(`api/projects/@current/workflows/${props.workflow.id}/deactivate/`),actions.setDeletedWorkflow(),src.UJ.success("Workflow deactivated successfully. Tasks have been migrated to the default workflow."),tasksLogic.A.actions.setActiveTab("kanban"),tasksLogic.A.actions.loadAllWorkflows(),tasksLogic.A.actions.loadTasks()}catch(error){throw console.error("Failed to deactivate workflow:",error),error?.response?.status===400&&error?.response?.data?.error?src.UJ.error(error.response.data.error):src.UJ.error("Failed to deactivate workflow. Please try again."),error}}}}),(0,index_esm.afterMount)(_ref9=>{let{actions}=_ref9;actions.loadAgents()})]);function WorkflowBuilder(_ref){let{workflow,onSave,onCancel}=_ref,logic=workflowBuilderLogic({workflow}),{workflowName,workflowDescription,workflowColor,stages,agents,isValid,savedWorkflow,deletedWorkflow}=(0,index_esm.useValues)(logic),{setWorkflowName,setWorkflowDescription,setWorkflowColor,addStage,removeStage,updateStage,saveWorkflow,deleteWorkflow}=(0,index_esm.useActions)(logic),[showDeleteConfirm,setShowDeleteConfirm]=(0,react.useState)(!1);return(0,react.useEffect)(()=>{savedWorkflow&&onSave(savedWorkflow)},[savedWorkflow,onSave]),(0,react.useEffect)(()=>{deletedWorkflow&&onCancel()},[deletedWorkflow,onCancel]),(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsxs)(src.Mi,{className:"p-6",children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold mb-4",children:workflow?"Edit Workflow":"Create New Workflow"}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Workflow Name"}),(0,jsx_runtime.jsx)(src.DF,{value:workflowName,onChange:setWorkflowName,placeholder:"Enter workflow name"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,jsx_runtime.jsx)(src.DF,{value:workflowDescription,onChange:setWorkflowDescription,placeholder:"Describe this workflow"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Workflow Color"}),(0,jsx_runtime.jsx)("input",{type:"color",value:workflowColor,onChange:e=>setWorkflowColor(e.target.value),className:"w-full h-10 border border-border rounded cursor-pointer"})]})]})]}),(0,jsx_runtime.jsxs)(src.Mi,{className:"p-6",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-medium",children:"Workflow Stages"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted mt-1",children:'All workflows start with "Input" and end with "Complete". Add stages in between as needed.'})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:addStage,children:"Add Stage"})]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[stages.map((stage,index)=>(0,jsx_runtime.jsx)(StageEditor,{stage:stage,position:index+1,agents:agents,onUpdate:updates=>updateStage(stage.id,updates),onRemove:()=>removeStage(stage.id),isLast:index===stages.length-1,isFirst:0===index},stage.id)),0===stages.length&&(0,jsx_runtime.jsx)("div",{className:"text-center py-8 text-muted",children:"No stages defined. Add a stage to get started."})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between",children:[workflow&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",status:"danger",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),onClick:()=>setShowDeleteConfirm(!0),children:"Delete Workflow"}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:onCancel,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>saveWorkflow(),disabled:!isValid,children:workflow?"Update Workflow":"Create Workflow"})]})]}),showDeleteConfirm&&(0,jsx_runtime.jsx)(src.dn,{title:"Delete Workflow?",description:`Are you sure you want to delete "${workflowName}"? This will deactivate the workflow and migrate all tasks to the backlog.`,primaryButton:{children:"Delete",status:"danger",onClick:()=>{deleteWorkflow(),setShowDeleteConfirm(!1)}},secondaryButton:{children:"Cancel",onClick:()=>setShowDeleteConfirm(!1)},onClose:()=>setShowDeleteConfirm(!1)})]})}function StageEditor(_ref2){let{stage,position,agents,onUpdate,onRemove,isLast,isFirst}=_ref2,[agent,setAgent]=(0,react.useState)(stage.agent||"no_agent");return(0,jsx_runtime.jsxs)("div",{className:"border border-border rounded-lg p-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"w-6 h-6 rounded-full bg-border flex items-center justify-center text-xs font-bold",children:position}),(0,jsx_runtime.jsxs)("h4",{className:"font-medium",children:["Stage ",position]}),isLast&&(0,jsx_runtime.jsx)("span",{className:"text-xs bg-border rounded px-2 py-1 text-muted",children:"Required"})]}),!(isFirst||isLast)&&(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:onRemove})]}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Stage Name"}),(0,jsx_runtime.jsx)(src.DF,{value:stage.name,onChange:name=>onUpdate({name}),placeholder:"e.g. Code Review",disabled:isLast})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Assigned Agent"}),isLast?(0,jsx_runtime.jsx)("div",{className:"h-10 px-3 py-2 border border-border rounded bg-bg-light text-muted text-sm flex items-center",children:"No agent - tasks complete here"}):(0,jsx_runtime.jsx)(src.Yv,{value:agent,onChange:value=>{setAgent(value),onUpdate({agent:"no_agent"===value?void 0:value})},options:[{value:"no_agent",label:"No agent (manual only)"},...agents.map(a=>({value:a.id,label:a.name}))],placeholder:"Select an agent"})]})]}),isLast&&(0,jsx_runtime.jsx)("div",{className:"mt-3 p-3 bg-bg-light rounded border",children:(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted",children:"✅ This is the final stage - tasks are marked as complete when they reach here."})})]})}let workflowSettingsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","tasks","components","workflowSettingsLogic"]),(0,index_esm.actions)({selectWorkflow:workflowId=>({workflowId}),deleteWorkflow:workflowId=>({workflowId}),setDefaultWorkflow:workflowId=>({workflowId}),deactivateWorkflow:workflowId=>({workflowId})}),(0,kea_loaders_lib.loaders)({workflows:[[],{loadWorkflows:async()=>(await api.ZP.get("api/projects/@current/workflows/")).results||[]}],agents:[[],{loadAgents:async()=>(await api.ZP.get("api/projects/@current/agents/")).results||[]}]}),(0,index_esm.reducers)({selectedWorkflowId:[null,{selectWorkflow:(_,_ref)=>{let{workflowId}=_ref;return workflowId}}]}),(0,index_esm.selectors)({selectedWorkflow:[s=>[s.workflows,s.selectedWorkflowId],(workflows,selectedWorkflowId)=>selectedWorkflowId&&workflows.find(w=>w.id===selectedWorkflowId)||null],defaultWorkflow:[s=>[s.workflows],workflows=>workflows.find(w=>w.is_default)||null],loading:[s=>[s.workflowsLoading,s.agentsLoading],(workflowsLoading,agentsLoading)=>workflowsLoading||agentsLoading]}),(0,index_esm.listeners)(_ref2=>{let{actions,values}=_ref2;return{loadWorkflowsSuccess:()=>{},deleteWorkflow:async _ref3=>{let{workflowId}=_ref3;try{await api.ZP.delete(`api/projects/@current/workflows/${workflowId}/`),actions.loadWorkflows(),values.selectedWorkflowId===workflowId&&actions.selectWorkflow(null)}catch(error){console.error("Failed to delete workflow:",error)}},setDefaultWorkflow:async _ref4=>{let{workflowId}=_ref4;try{await api.ZP.create(`api/projects/@current/workflows/${workflowId}/set_default/`,{}),actions.loadWorkflows()}catch(error){console.error("Failed to set default workflow:",error)}},deactivateWorkflow:async _ref5=>{let{workflowId}=_ref5;try{await api.ZP.create(`api/projects/@current/workflows/${workflowId}/deactivate/`,{}),actions.loadWorkflows(),values.selectedWorkflowId===workflowId&&actions.selectWorkflow(null)}catch(error){console.error("Failed to deactivate workflow:",error)}}}}),(0,index_esm.afterMount)(_ref6=>{let{actions}=_ref6;actions.loadWorkflows(),actions.loadAgents()})]);function DroppableContainer(_ref){let{children,disabled,id}=_ref,{setNodeRef,isOver}=(0,core_esm.Zj)({id,data:{type:"container"}});return(0,jsx_runtime.jsx)("div",{ref:disabled?void 0:setNodeRef,className:(0,css_classes.cn)("space-y-2 min-h-[200px] rounded-md",isOver&&!disabled&&"ring-2 ring-primary/40 bg-primary/5",disabled&&"opacity-50 pointer-events-none"),children:children})}function KanbanView(){let{tasks,workflowKanbanData}=(0,index_esm.useValues)(tasksLogic.A),{openTaskDetail,moveTask}=(0,index_esm.useActions)(tasksLogic.A),{loadWorkflows}=(0,index_esm.useActions)(workflowSettingsLogic),[activeTask,setActiveTask]=(0,react.useState)(null),[collapsedWorkflows,setCollapsedWorkflows]=(0,react.useState)(new Set),[clonedItems,setClonedItems]=(0,react.useState)(null),[dropIndicator,setDropIndicator]=(0,react.useState)({container:null,index:null}),[showCreateWorkflow,setShowCreateWorkflow]=(0,react.useState)(!1),[editingWorkflow,setEditingWorkflow]=(0,react.useState)(null),recentlyMovedToNewContainer=(0,react.useRef)(!1),[items,setItems]=(0,react.useState)({});(0,react.useEffect)(()=>{let newItems={};workflowKanbanData.forEach(_ref2=>{let{workflow,stages}=_ref2;stages.forEach(_ref3=>{let{stage,tasks}=_ref3;newItems[`${workflow.id}-${stage.key}`]=tasks})}),setItems(newItems)},[workflowKanbanData]);let toggleWorkflow=workflowId=>{let newCollapsed=new Set(collapsedWorkflows);newCollapsed.has(workflowId)?newCollapsed.delete(workflowId):newCollapsed.add(workflowId),setCollapsedWorkflows(newCollapsed)},handleTaskClick=taskId=>{openTaskDetail(taskId)},sensors=(0,core_esm.Dy)((0,core_esm.VT)(core_esm.MA,{activationConstraint:{distance:8}}),(0,core_esm.VT)(core_esm.LO,{activationConstraint:{delay:150,tolerance:5}}),(0,core_esm.VT)(core_esm.Lg,{coordinateGetter:sortable_esm.is})),findContainer=item=>{if(isContainer(item))return item.id;let task=tasks.find(t=>t.id===item.id);if(!task)return"";for(let{workflow,stages}of workflowKanbanData)for(let{stage}of stages)if(task.workflow===workflow.id&&task.current_stage===stage.id)return`${workflow.id}-${stage.key}`;return""},findStageByContainerId=targetContainerId=>{for(let workflowData of workflowKanbanData)for(let stageData of workflowData.stages)if(`${workflowData.workflow.id}-${stageData.stage.key}`===targetContainerId)return{workflow:workflowData.workflow,stage:stageData.stage};return null},canDropTask=(activeTask,targetContainerId)=>{let target=findStageByContainerId(targetContainerId);return!!target&&activeTask.workflow===target.workflow.id};return((0,react.useEffect)(()=>{requestAnimationFrame(()=>{recentlyMovedToNewContainer.current=!1})},[items]),showCreateWorkflow||editingWorkflow)?(0,jsx_runtime.jsx)(WorkflowBuilder,{workflow:editingWorkflow||void 0,onSave:()=>{setShowCreateWorkflow(!1),setEditingWorkflow(null),loadWorkflows()},onCancel:()=>{setShowCreateWorkflow(!1),setEditingWorkflow(null)}}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"Workflows"})}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>setShowCreateWorkflow(!0),children:"New Workflow"})]}),(0,jsx_runtime.jsxs)(core_esm.LB,{sensors:sensors,collisionDetection:core_esm.ey,measuring:{droppable:{strategy:core_esm.uN.Always}},onDragStart:_ref4=>{let{active}=_ref4,task=tasks.find(t=>t.id===active.id);task&&(setActiveTask(task),setClonedItems(items))},onDragOver:_ref5=>{let{active,over,delta}=_ref5;if(!over||!activeTask)return;let activeContainer=findContainer(active),overContainer=findContainer(over);if(!activeContainer||!overContainer)return;if(!canDropTask(activeTask,String(overContainer))){setDropIndicator({container:null,index:null});return}let targetItems=items[overContainer],overId=String(over.id),overIndex=targetItems.findIndex(i=>i.id===overId),putBelowLast=overIndex===targetItems.length-1&&(delta?.y||0)>0;setDropIndicator({container:overContainer,index:overIndex>=0?overIndex+ +!!putBelowLast:targetItems.length})},onDragEnd:_ref6=>{let{active,over}=_ref6,activeContainer=findContainer(active);if(!activeContainer){setActiveTask(null);return}if(null==over){setActiveTask(null),setDropIndicator({container:null,index:null});return}let overContainer=findContainer(over);if(overContainer&&activeTask&&canDropTask(activeTask,String(overContainer))){let sourceItems=items[activeContainer],targetItems=items[overContainer],sourceIndex=sourceItems.findIndex(t=>t.id===active.id),overIndexRaw=targetItems.findIndex(t=>t.id===over.id);if(activeContainer===overContainer){let fallbackIndex=dropIndicator.container===overContainer&&null!=dropIndicator.index?dropIndicator.index:targetItems.length,finalIndex=overIndexRaw>=0?overIndexRaw:fallbackIndex;if(sourceIndex>=0&&null!=finalIndex&&sourceIndex!==finalIndex){setItems(current=>({...current,[overContainer]:(0,sortable_esm.Rp)(current[overContainer],sourceIndex,finalIndex)}));let target=findStageByContainerId(String(overContainer));target&&moveTask(String(active.id),target.stage.key,finalIndex)}}else{let draggedTask=sourceIndex>=0?sourceItems[sourceIndex]:tasks.find(t=>t.id===active.id);if(!draggedTask){setActiveTask(null);return}let insertIndex=overIndexRaw>=0?overIndexRaw:dropIndicator.container===overContainer&&null!=dropIndicator.index?dropIndicator.index:targetItems.length;setItems(current=>({...current,[activeContainer]:current[activeContainer].filter(t=>t.id!==active.id),[overContainer]:[...current[overContainer].slice(0,insertIndex),{...draggedTask},...current[overContainer].slice(insertIndex)]}));let target=findStageByContainerId(String(overContainer));target&&moveTask(String(active.id),target.stage.key,insertIndex)}}else clonedItems&&setItems(clonedItems);setActiveTask(null),setDropIndicator({container:null,index:null})},onDragCancel:()=>{clonedItems&&setItems(clonedItems),setActiveTask(null),setClonedItems(null)},children:[(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[workflowKanbanData.map(_ref7=>{let{workflow,stages}=_ref7,isCollapsed=collapsedWorkflows.has(workflow.id),totalTasks=stages.reduce((sum,_ref8)=>{let{tasks}=_ref8;return sum+tasks.length},0);return(0,jsx_runtime.jsxs)("div",{className:"bg-bg-light rounded-lg border border-border",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-between p-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer hover:bg-bg-3000 rounded px-2 py-1 -mx-2 -my-1 flex-1",onClick:()=>toggleWorkflow(workflow.id),children:[(0,jsx_runtime.jsx)("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:workflow.color}}),(0,jsx_runtime.jsx)("h2",{className:"text-lg font-semibold",children:workflow.name}),(0,jsx_runtime.jsxs)("span",{className:"text-sm text-muted",children:["(",totalTasks," tasks)"]}),(0,jsx_runtime.jsx)("div",{className:"text-muted ml-auto",children:isCollapsed?"▶":"▼"})]})}),!isCollapsed&&(0,jsx_runtime.jsxs)("div",{className:"px-4 pb-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between py-2",children:[(0,jsx_runtime.jsx)("div",{}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:e=>{e.stopPropagation(),setEditingWorkflow(workflow)},tooltip:"Edit workflow"})]}),(0,jsx_runtime.jsx)("div",{className:"grid gap-4",style:{gridTemplateColumns:`repeat(${stages.length}, minmax(250px, 1fr))`},children:stages.map(_ref9=>{let{stage,tasks:stageTasks}=_ref9,containerId=`${workflow.id}-${stage.key}`,isAgentOnly=!stage.is_manual_only;return(0,jsx_runtime.jsxs)("div",{className:(0,css_classes.cn)("bg-white rounded-lg p-3 relative border border-border"),children:[isAgentOnly&&(0,jsx_runtime.jsx)("div",{className:"absolute top-2 right-2 z-10 pointer-events-none",children:(0,jsx_runtime.jsx)("div",{className:"bg-bg-light border border-border rounded-lg px-2 py-1 shadow-sm",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted",children:[(0,jsx_runtime.jsx)("span",{className:"w-2 h-2 bg-warning rounded-full"}),"Agent"]})})}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:stage.color}}),(0,jsx_runtime.jsx)("h3",{className:"font-medium text-sm",children:stage.name})]}),(0,jsx_runtime.jsx)("span",{className:"text-xs text-muted bg-border rounded-full px-2 py-1",children:stageTasks.length})]}),(0,jsx_runtime.jsx)(DroppableContainer,{id:containerId,disabled:!!activeTask&&!canDropTask(activeTask,containerId),children:(0,jsx_runtime.jsxs)(sortable_esm.Fo,{items:stageTasks.map(t=>t.id),strategy:sortable_esm.qw,children:[stageTasks.map((task,idx)=>(0,jsx_runtime.jsxs)(react.Fragment,{children:[dropIndicator.container===containerId&&dropIndicator.index===idx&&(0,jsx_runtime.jsx)(DropIndicator,{}),(0,jsx_runtime.jsx)(SortableItem,{task:task,onClick:handleTaskClick},task.id)]},`row-${task.id}`)),dropIndicator.container===containerId&&dropIndicator.index===stageTasks.length&&(0,jsx_runtime.jsx)(DropIndicator,{})]})})]},containerId)})})]})]},workflow.id)}),0===workflowKanbanData.length&&(0,jsx_runtime.jsxs)("div",{className:"text-center py-12 text-muted",children:[(0,jsx_runtime.jsx)("p",{className:"mb-2",children:"No workflows configured"}),(0,jsx_runtime.jsx)("p",{className:"text-sm",children:"Create a workflow in Settings to see tasks organized by stages"})]})]}),(0,jsx_runtime.jsx)(core_esm.y9,{children:activeTask?(0,jsx_runtime.jsx)("div",{className:"opacity-90",children:(0,jsx_runtime.jsx)(TaskCard,{task:activeTask,draggable:!0})}):null})]})]})}function SortableItem(_ref10){let{disabled,task,onClick}=_ref10,{setNodeRef,listeners,transform,attributes,transition,isDragging}=(0,sortable_esm.nB)({id:task.id,data:{current_stage:task.current_stage}});return(0,jsx_runtime.jsx)("div",{ref:disabled?void 0:setNodeRef,...listeners,...attributes,style:{transform:utilities_esm.ux.Translate.toString(transform),transition},className:(0,css_classes.cn)("cursor-grab active:cursor-grabbing",isDragging&&"opacity-50 z-50 relative"),children:(0,jsx_runtime.jsx)(TaskCard,{task:task,draggable:!0,onClick:()=>onClick(task.id)})})}function isContainer(item){return!!(item.data.current&&"container"===item.data.current.type)}function DropIndicator(){return(0,jsx_runtime.jsxs)(src.Mi,{className:"p-3 my-1 border-2 border-dashed border-primary/50 bg-transparent pointer-events-none",children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,jsx_runtime.jsx)("div",{className:"h-3 w-2/3 bg-border/60 rounded"})}),(0,jsx_runtime.jsx)("div",{className:"h-2 w-full bg-border/40 rounded mb-2"}),(0,jsx_runtime.jsx)("div",{className:"h-2 w-4/5 bg-border/40 rounded mb-3"}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"h-5 w-24 rounded-full bg-border/60"}),(0,jsx_runtime.jsx)("span",{className:"h-6 w-12 rounded bg-border/60"})]})]})}function TaskControlPanel(){let{tasks,workflowStages,allWorkflows}=(0,index_esm.useValues)(tasksLogic.A),{openTaskDetail}=(0,index_esm.useActions)(tasksLogic.A),getTaskStageKey=task=>{if(task.workflow&&task.current_stage){let stage=allWorkflows.flatMap(w=>w.stages||[]).find(s=>s.id===task.current_stage);return stage?.key||"backlog"}return"backlog"},tasksByStage=workflowStages.reduce((acc,stage)=>(acc[stage.key]=tasks.filter(task=>getTaskStageKey(task)===stage.key),acc),{}),needsAttention=tasks.filter(task=>{if(task.workflow&&task.current_stage){let stage=allWorkflows.flatMap(w=>w.stages||[]).find(s=>s.id===task.current_stage);if(stage){let isManualStage=stage.is_manual_only||!stage.agent_name,isCompleteStage=["done","completed","closed","finished"].includes(stage.key.toLowerCase());return isManualStage&&!isCompleteStage}}return!1}),activeTasks=tasks.filter(task=>{if(task.workflow&&task.current_stage){let stage=allWorkflows.flatMap(w=>w.stages||[]).find(s=>s.id===task.current_stage);if(stage&&!stage.is_archived)return!["done","completed","closed","finished"].includes(stage.key.toLowerCase())}return!1}),recentlyCompleted=tasks.filter(task=>{if(task.workflow&&task.current_stage){let stage=allWorkflows.flatMap(w=>w.stages||[]).find(s=>s.id===task.current_stage);if(stage)return["done","completed","closed","finished"].includes(stage.key.toLowerCase())}return!1}).sort((a,b)=>new Date(b.updated_at).getTime()-new Date(a.updated_at).getTime()).slice(0,5);return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-center",children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"Task Control Panel"}),(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm mt-1",children:"Monitor and manage your task workflows"})]})}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,jsx_runtime.jsx)(OverviewCard,{title:"Total Tasks",value:tasks.length,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"w-5 h-5"}),color:"text-primary"}),(0,jsx_runtime.jsx)(OverviewCard,{title:"Active Tasks",value:activeTasks.length,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconClock,{className:"w-5 h-5"}),color:"text-warning"}),(0,jsx_runtime.jsx)(OverviewCard,{title:"Need Attention",value:needsAttention.length,icon:(0,jsx_runtime.jsx)(icons.qV,{className:"w-5 h-5"}),color:"text-danger"}),(0,jsx_runtime.jsx)(OverviewCard,{title:"Completed",value:recentlyCompleted.length,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"w-5 h-5"}),color:"text-success"})]}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,jsx_runtime.jsxs)(src.Mi,{className:"p-6",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-medium",children:"Tasks Needing Attention"}),(0,jsx_runtime.jsx)(src.oe,{type:"warning",children:needsAttention.length})]}),(0,jsx_runtime.jsx)("div",{className:"space-y-3",children:0===needsAttention.length?(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm",children:"No tasks need attention"}):needsAttention.slice(0,5).map(task=>(0,jsx_runtime.jsx)(TaskSummaryCard,{task:task,onClick:()=>openTaskDetail(task.id)},task.id))})]}),(0,jsx_runtime.jsxs)(src.Mi,{className:"p-6",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-medium",children:"Recently Completed"}),(0,jsx_runtime.jsx)(src.oe,{type:"success",children:recentlyCompleted.length})]}),(0,jsx_runtime.jsx)("div",{className:"space-y-3",children:0===recentlyCompleted.length?(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm",children:"No completed tasks"}):recentlyCompleted.map(task=>(0,jsx_runtime.jsx)(TaskSummaryCard,{task:task,onClick:()=>openTaskDetail(task.id)},task.id))})]})]}),(0,jsx_runtime.jsxs)(src.Mi,{className:"p-6",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Workflow Overview"}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:workflowStages.map(stage=>{let stageTasks=tasksByStage[stage.key]||[];return(0,jsx_runtime.jsxs)("div",{className:"p-4 bg-bg-light rounded-lg",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,jsx_runtime.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:stage.color}}),(0,jsx_runtime.jsx)("h4",{className:"font-medium text-sm",children:stage.name})]}),(0,jsx_runtime.jsx)("div",{className:"text-2xl font-bold text-primary mb-1",children:stageTasks.length}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:stage.is_manual_only?"Manual":"Automated"}),stageTasks.length>0&&(0,jsx_runtime.jsxs)("div",{className:"mt-3",children:[(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted mb-1",children:"Latest:"}),(0,jsx_runtime.jsx)("div",{className:"text-xs font-medium truncate",children:stageTasks[stageTasks.length-1]?.title})]})]},stage.id)})})]})]})}function OverviewCard(_ref){let{title,value,icon,color}=_ref;return(0,jsx_runtime.jsx)(src.Mi,{className:"p-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted",children:title}),(0,jsx_runtime.jsx)("p",{className:"text-2xl font-bold",children:value})]}),(0,jsx_runtime.jsx)("div",{className:color,children:icon})]})})}function TaskSummaryCard(_ref2){let{task,onClick}=_ref2,{allWorkflows}=(0,index_esm.useValues)(tasksLogic.A);return(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between p-3 bg-bg-light rounded hover:bg-bg-3000 cursor-pointer transition-colors",onClick:onClick,children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm mb-1 truncate",children:task.title}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.oe,{size:"small",className:(task=>{if(task.workflow&&task.current_stage){let stage=allWorkflows.flatMap(w=>w.stages||[]).find(s=>s.id===task.current_stage);if(stage){if(["done","completed","closed","finished"].includes(stage.key.toLowerCase()))return"text-success";if(stage.agent_name&&!stage.is_manual_only)return"text-warning";if(stage.is_manual_only||!stage.agent_name)return"text-primary"}}return"text-muted"})(task),children:task.workflow&&task.current_stage&&allWorkflows.flatMap(w=>w.stages||[]).find(s=>s.id===task.current_stage)?.name||(task=>{if(task.workflow&&task.current_stage){let stage=allWorkflows.flatMap(w=>w.stages||[]).find(s=>s.id===task.current_stage);return stage?.key||"backlog"}return"backlog"})(task)}),task.github_pr_url&&(0,jsx_runtime.jsx)(src.oe,{size:"small",type:"highlight",children:"PR Ready"})]})]}),(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{}),onClick:e=>{e.stopPropagation(),onClick()}})]})}let scene={component:TaskTracker,logic:tasksLogic.A};function TaskTracker(){let{activeTab}=(0,index_esm.useValues)(tasksLogic.A),{setActiveTab}=(0,index_esm.useActions)(tasksLogic.A);if(!(0,useFeatureFlag.y)("TASKS"))return(0,jsx_runtime.jsx)(NotFound.T,{object:"Tasks",caption:"This feature is not enabled for your project."});let tabs=[{key:"dashboard",label:"Dashboard",content:(0,jsx_runtime.jsx)(TaskControlPanel,{})},{key:"backlog",label:"All Tasks",content:(0,jsx_runtime.jsx)(BacklogView,{})},{key:"kanban",label:"Workflows",content:(0,jsx_runtime.jsx)(KanbanView,{})},{key:"settings",label:"Settings",content:(0,jsx_runtime.jsx)(GitHubIntegrationSettings,{})}];return(0,jsx_runtime.jsx)("div",{className:"TaskTracker",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:"Tasks",resourceType:{type:"task"}}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeTab,onChange:setActiveTab,tabs:tabs,size:"medium",sceneInset:!0})]})})}},"../../products/tasks/frontend/components/RepositorySelector.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{G:()=>RepositorySelector});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),integrationsLogic=__webpack_require__("../../frontend/src/lib/integrations/integrationsLogic.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");let repositorySelectorLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","tasks","frontend","components","repositorySelectorLogic"]),(0,index_esm.connect)({actions:[integrationsLogic.a,["loadIntegrations","loadGitHubRepositories"]],values:[integrationsLogic.a,["integrations","getGitHubRepositories"]]}),(0,index_esm.actions)({setAvailableRepos:repos=>({repos}),setOnChangeCallback:callback=>({callback}),setCurrentConfig:config=>({config}),tryAutoSelectFirstIntegration:!0}),(0,index_esm.reducers)({availableRepos:[[],{setAvailableRepos:(_,_ref)=>{let{repos}=_ref;return repos}}],onChangeCallback:[null,{setOnChangeCallback:(_,_ref2)=>{let{callback}=_ref2;return callback}}],currentConfig:[{},{setCurrentConfig:(_,_ref3)=>{let{config}=_ref3;return config}}]}),(0,index_esm.selectors)({githubIntegrations:[s=>[s.integrations],integrations=>integrations?.filter(integration=>"github"===integration.kind)||[]]}),(0,index_esm.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadIntegrations()}),(0,index_esm.listeners)(_ref5=>{let{actions,values}=_ref5;return{[integrationsLogic.a.actionTypes.loadIntegrationsSuccess]:()=>{values.githubIntegrations.length>0&&values.githubIntegrations.forEach(integration=>{actions.loadGitHubRepositories(integration.id)})},[integrationsLogic.a.actionTypes.loadGitHubRepositoriesSuccess]:()=>{if(values.githubIntegrations.length>0){let repoData=[];for(let integration of values.githubIntegrations){let repos=values.getGitHubRepositories(integration.id);repoData.push({integration_id:integration.id,organization:integration.config?.account?.name||"GitHub",repositories:repos||[]})}actions.setAvailableRepos(repoData),actions.tryAutoSelectFirstIntegration()}},tryAutoSelectFirstIntegration:()=>{let config=values.currentConfig,onChange=values.onChangeCallback;if(onChange&&!config.integrationId&&values.githubIntegrations.length>0&&values.availableRepos.length>0){let firstIntegration=values.githubIntegrations[0],firstRepoData=values.availableRepos.find(r=>r.integration_id===firstIntegration.id);onChange({...config,integrationId:firstIntegration.id,organization:firstRepoData?.organization||firstIntegration.config?.account?.name||"GitHub",repository:firstRepoData?.repositories[0]||""})}}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function RepositorySelector(_ref){let{value,onChange}=_ref,{githubRepositoriesLoading}=(0,index_esm.useValues)(integrationsLogic.a),{availableRepos,githubIntegrations}=(0,index_esm.useValues)(repositorySelectorLogic),{setOnChangeCallback,setCurrentConfig}=(0,index_esm.useActions)(repositorySelectorLogic);(0,react.useEffect)(()=>{setOnChangeCallback(onChange),setCurrentConfig(value)},[onChange,value,setOnChangeCallback,setCurrentConfig]);let selectedRepoData=availableRepos.find(r=>r.integration_id===value.integrationId);return 0===githubIntegrations.length?(0,jsx_runtime.jsx)(src.Mi,{className:"p-6 text-center",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{className:"mx-auto text-4xl text-muted"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"font-medium",children:"No GitHub Integration"}),(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm",children:"Connect a GitHub integration to enable repository selection."})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>window.open(urls.j.currentProject(urls.j.settings("environment-integrations")),"_blank"),children:"Configure GitHub Integration"})]})}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"GitHub Integration"}),(0,jsx_runtime.jsx)(src.Yv,{value:value.integrationId,onChange:integrationId=>{let integration=githubIntegrations.find(i=>i.id===integrationId),repoData=availableRepos.find(r=>r.integration_id===integrationId);onChange({...value,integrationId,organization:repoData?.organization||integration?.config?.account?.name||"GitHub",repository:repoData?.repositories[0]||""})},options:githubIntegrations.map(integration=>({value:integration.id,label:`${integration.display_name} (${integration.config?.account?.name||"GitHub"})`})),placeholder:"Select GitHub integration..."})]}),selectedRepoData&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Repository"}),(0,jsx_runtime.jsx)(src.Yv,{value:value.repository,onChange:repository=>onChange({...value,repository,organization:selectedRepoData.organization}),options:selectedRepoData.repositories.map(repo=>({value:repo,label:`${selectedRepoData.organization}/${repo}`})),placeholder:"Select repository..."})]}),githubRepositoriesLoading&&0===availableRepos.length&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-muted",children:[(0,jsx_runtime.jsx)(src.$j,{})," Loading repositories..."]})]})}},"../../products/tasks/frontend/constants.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>ORIGIN_PRODUCT_LABELS,z:()=>ORIGIN_PRODUCT_COLORS});var _types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../products/tasks/frontend/types.ts");let ORIGIN_PRODUCT_LABELS={[_types__WEBPACK_IMPORTED_MODULE_0__.A.ERROR_TRACKING]:"Error Tracking",[_types__WEBPACK_IMPORTED_MODULE_0__.A.EVAL_CLUSTERS]:"Eval Clusters",[_types__WEBPACK_IMPORTED_MODULE_0__.A.USER_CREATED]:"User Created",[_types__WEBPACK_IMPORTED_MODULE_0__.A.SUPPORT_QUEUE]:"Support Queue",[_types__WEBPACK_IMPORTED_MODULE_0__.A.SESSION_SUMMARIES]:"Session Summaries"},ORIGIN_PRODUCT_COLORS={[_types__WEBPACK_IMPORTED_MODULE_0__.A.ERROR_TRACKING]:"bg-red-100 text-red-800",[_types__WEBPACK_IMPORTED_MODULE_0__.A.EVAL_CLUSTERS]:"bg-sky-100 text-sky-800",[_types__WEBPACK_IMPORTED_MODULE_0__.A.USER_CREATED]:"bg-emerald-100 text-emerald-800",[_types__WEBPACK_IMPORTED_MODULE_0__.A.SUPPORT_QUEUE]:"bg-orange-100 text-orange-800",[_types__WEBPACK_IMPORTED_MODULE_0__.A.SESSION_SUMMARIES]:"bg-purple-100 text-purple-800"}}}]);