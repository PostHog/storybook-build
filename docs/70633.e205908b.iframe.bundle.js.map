{"version":3,"file":"70633.e205908b.iframe.bundle.js","mappings":";AAkCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA4DA;AAIA","sources":["webpack://@posthog/storybook/../../products/error_tracking/frontend/components/ExceptionCard/FixModal.tsx"],"sourcesContent":["import { useActions, useValues } from 'kea'\nimport posthog from 'posthog-js'\n\nimport { LemonButton, LemonModal, LemonSegmentedButton } from '@posthog/lemon-ui'\n\nimport { errorPropertiesLogic } from 'lib/components/Errors/errorPropertiesLogic'\nimport { stackFrameLogic } from 'lib/components/Errors/stackFrameLogic'\nimport { ErrorTrackingException } from 'lib/components/Errors/types'\nimport { formatExceptionDisplay, formatResolvedName } from 'lib/components/Errors/utils'\nimport { copyToClipboard } from 'lib/utils/copyToClipboard'\nimport { urls } from 'scenes/urls'\n\nimport { fixModalLogic } from './fixModalLogic'\n\ninterface FixModalProps {\n    isOpen: boolean\n    onClose: () => void\n    issueId: string\n}\n\nexport function FixModal({ isOpen, onClose, issueId }: FixModalProps): JSX.Element {\n    const { exceptionList } = useValues(errorPropertiesLogic)\n    const { stackFrameRecords } = useValues(stackFrameLogic)\n    const { mode } = useValues(fixModalLogic)\n    const { setMode } = useActions(fixModalLogic)\n\n    const generatePrompt = (): string => {\n        const issueUrl = window.location.origin + urls.errorTrackingIssue(issueId)\n        const stacktraceText = exceptionList\n            .map((exception) => generateExceptionText(exception, stackFrameRecords))\n            .join('\\n\\n')\n\n        if (mode === 'explain') {\n            return `Please help me understand this error in depth. Here's the stack trace:\n\n\\`\\`\\`\n${stacktraceText}\n\\`\\`\\`\n\nNote: Frames marked with [IN-APP] are from the application code (my code), while frames without this marker are from external libraries/frameworks.\nFocus your analysis primarily on the [IN-APP] frames as these are most likely where the issue originates.\n\nCan you:\n1. Perform a deep dive analysis into what's causing this error. Consider multiple possible factors and dig deep to find the root cause.\n2. Explain the relevant parts of the code that are involved in this error. Walk through the execution flow that leads to this issue.\n3. Provide a detailed explanation of exactly how this issue happened, including the sequence of events and conditions that trigger it.\n4. Include code examples and context where helpful to illustrate your explanation.\n\nThe final output should be:\n- A comprehensive technical explanation of the root cause\n- A walkthrough of the relevant code paths\n- A detailed summary of exactly how the issue occurs\n\nPostHog issue: ${issueUrl}\n`\n        }\n        return `Please help me fix this error. Here's the stack trace:\n\n\\`\\`\\`\n${stacktraceText}\n\\`\\`\\`\n\nNote: Frames marked with [IN-APP] are from the application code (my code), while frames without this marker are from external libraries/frameworks.\nFocus your analysis primarily on the [IN-APP] frames as these are most likely where the issue needs to be fixed.\n\nCan you:\n1. Gather relevant information from the codebase to understand the context of this error.\n2. Inspect the code paths involved to identify the root cause.\n3. Determine the simplest and cleanest fix for this issue.\n4. Implement the fix directly in the codebase.\n\nThe final output of your efforts should be:\n- An implemented fix for the issue applied directly to the code\n- A brief explanation of what was changed and why\n\nPostHog issue: ${issueUrl}\n`\n    }\n\n    const handleCopy = (): void => {\n        void copyToClipboard(generatePrompt(), 'LLM prompt')\n        posthog.capture('error_tracking_prompt_copied', { mode })\n        onClose()\n    }\n\n    return (\n        <LemonModal\n            isOpen={isOpen}\n            onClose={onClose}\n            title={mode === 'explain' ? 'Explain this error with AI' : 'Fix this error with AI'}\n            width=\"50rem\"\n            footer={\n                <div className=\"flex items-center justify-end gap-2\">\n                    <LemonButton type=\"secondary\" onClick={onClose}>\n                        Close\n                    </LemonButton>\n                    <LemonButton type=\"primary\" onClick={handleCopy}>\n                        Copy to clipboard\n                    </LemonButton>\n                </div>\n            }\n        >\n            <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-2\">\n                    <span className=\"text-muted\">Mode:</span>\n                    <LemonSegmentedButton\n                        value={mode}\n                        onChange={(newMode) => setMode(newMode)}\n                        options={[\n                            { value: 'explain', label: 'Explain' },\n                            { value: 'fix', label: 'Fix' },\n                        ]}\n                        size=\"small\"\n                    />\n                </div>\n                <p className=\"text-muted\">\n                    {mode === 'explain'\n                        ? 'Paste this prompt into your favourite coding assistant to get a detailed explanation of this error:'\n                        : 'Paste this prompt into your favourite coding assistant to get help fixing this error:'}\n                </p>\n                <div className=\"bg-bg-light border rounded p-4 font-mono text-sm whitespace-pre-wrap max-h-96 overflow-auto\">\n                    {generatePrompt()}\n                </div>\n            </div>\n        </LemonModal>\n    )\n}\n\nfunction generateExceptionText(exception: ErrorTrackingException, stackFrameRecords: Record<string, any>): string {\n    let result = formatExceptionDisplay(exception)\n\n    const frames = exception.stacktrace?.frames || []\n\n    for (const frame of frames) {\n        const inAppMarker = frame.in_app ? ' [IN-APP]' : ''\n        const resolvedName = formatResolvedName(frame)\n        result += `\\n${inAppMarker}  File \"${frame.source || 'Unknown Source'}\"${frame.line ? `, line: ${frame.line}` : ''}${resolvedName ? `, in: ${resolvedName}` : ''}`\n\n        const frameRecord = stackFrameRecords[frame.raw_id]\n        if (frameRecord?.context?.line?.line) {\n            result += `\\n    ${frameRecord.context.line.line}`\n        }\n    }\n\n    return result\n}\n"],"names":[],"sourceRoot":""}