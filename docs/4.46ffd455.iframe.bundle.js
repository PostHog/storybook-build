(window.webpackJsonp=window.webpackJsonp||[]).push([[4,6,7,8,9,11,307],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(h,_,e){"use strict";e.r(_);var m=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),O=e.n(m),d=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),c=e.n(d),j={};j.insert="head",j.singleton=!1;var A=O()(c.a,j);_.default=c.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(h,_,e){"use strict";e.r(_),e.d(_,"AppMetricsGraph",function(){return U});var m=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),O=e.n(m),d=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),c=e.n(d),j=e("./node_modules/core-js/modules/es.array.concat.js"),A=e.n(j),R=e("./node_modules/core-js/modules/es.object.keys.js"),f=e.n(R),a=e("./node_modules/core-js/modules/es.symbol.js"),B=e.n(a),T=e("./node_modules/core-js/modules/es.array.filter.js"),g=e.n(T),v=e("./node_modules/core-js/modules/es.object.to-string.js"),u=e.n(v),l=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),P=e.n(l),C=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),b=e.n(C),i=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),L=e.n(i),I=e("./node_modules/react/index.js"),V=e.n(I),D=e("./frontend/src/lib/colors.ts"),F=e("./node_modules/chart.js/dist/chart.mjs"),x=e("./frontend/src/scenes/apps/constants.tsx"),G=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),Y=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),H=e("./frontend/src/lib/utils.tsx"),K=e("./node_modules/react/jsx-runtime.js"),Z=e.n(K);function J(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),s.push.apply(s,n)}return s}function M(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?J(Object(s),!0).forEach(function(n){O()(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):J(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function U(t){var r=t.tab,s=t.metrics,n=t.metricsLoading,o=Object(I.useRef)(null),E=x.DescriptionColumns[r];return Object(I.useEffect)(function(){var y;if(o.current&&s){var p;y=new F.a((p=o.current)===null||p===void 0?void 0:p.getContext("2d"),{type:"line",data:{labels:s.dates,datasets:[M({label:E.successes,data:s.successes,borderColor:""},$("data-brand-blue"))].concat(c()(E.successes_on_retry?[M({label:E.successes_on_retry,data:s.successes_on_retry},$("data-yellow"))]:[]),[M({label:E.failures,data:s.failures},$("data-pink"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var W;(W=y)===null||W===void 0||W.destroy()}},[s]),n||!s?Object(K.jsx)(G.a,{className:"AppMetricsGraph"}):Object(K.jsx)("div",{className:"AppMetricsGraph",children:Object(K.jsx)("canvas",{ref:o})})}function $(t){var r=Object(D.b)(t);return{borderColor:r,hoverBorderColor:Object(H.lb)(r,-20),hoverBackgroundColor:Object(H.lb)(r,-20),backgroundColor:r,fill:!1,borderWidth:2,pointRadius:0}}try{U.displayName="AppMetricsGraph",U.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:U.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(t){}},"./frontend/src/scenes/apps/HistoricalExport.tsx":function(h,_,e){"use strict";e.r(_),e.d(_,"HistoricalExport",function(){return B});var m=e("./node_modules/antd/es/card/index.js"),O=e("./node_modules/kea/lib/index.esm.js"),d=e("./frontend/src/lib/utils.tsx"),c=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),j=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),A=e("./frontend/src/scenes/apps/historicalExportLogic.ts"),R=e("./frontend/src/scenes/apps/MetricsTab.tsx"),f=e("./node_modules/react/jsx-runtime.js"),a=e.n(f);function B(T){var g,v,u=Object(O.useValues)(Object(A.historicalExportLogic)(T)),l=u.data,P=u.dataLoading;return Object(f.jsxs)("div",{className:"mt-4 mb-4 mr-8",children:[Object(f.jsxs)(m.a,{title:"Overview",children:[l&&l.summary.duration?Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{className:"card-secondary",children:"Export duration"}),Object(f.jsx)("div",{children:Object(d.O)(l.summary.duration)})]}):null,Object(f.jsx)(R.MetricsOverview,{tab:j.AppMetricsTab.HistoricalExports,metrics:(g=l==null?void 0:l.metrics)!==null&&g!==void 0?g:null,metricsLoading:P})]}),Object(f.jsx)(m.a,{title:"Delivery trends",className:"mt-4",children:Object(f.jsx)(c.AppMetricsGraph,{tab:j.AppMetricsTab.HistoricalExports,metrics:(v=l==null?void 0:l.metrics)!==null&&v!==void 0?v:null,metricsLoading:P})})]})}try{B.displayName="HistoricalExport",B.__docgenInfo={description:"",displayName:"HistoricalExport",props:{pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"]={docgenInfo:B.__docgenInfo,name:"HistoricalExport",path:"frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"})}catch(T){}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(h,_,e){"use strict";e.r(_),e.d(_,"MetricsTab",function(){return T}),e.d(_,"MetricsOverview",function(){return g});var m=e("./node_modules/antd/es/card/index.js"),O=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),d=e("./frontend/src/scenes/apps/constants.tsx"),c=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),j=e("./frontend/src/lib/utils.tsx"),A=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),R=e("./frontend/src/lib/components/LemonSelect.tsx"),f=e("./node_modules/kea/lib/index.esm.js"),a=e("./node_modules/react/jsx-runtime.js"),B=e.n(a);function T(u){var l=u.tab,P=Object(f.useValues)(O.appMetricsSceneLogic),C=P.metrics,b=P.metricsLoading,i=P.dateFrom,L=Object(f.useActions)(O.appMetricsSceneLogic),I=L.setDateFrom;return Object(a.jsxs)("div",{className:"mt-4",children:[Object(a.jsx)(m.a,{title:Object(a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[Object(a.jsx)("span",{children:"Metrics overview"}),Object(a.jsx)(R.a,{value:i,onChange:function(D){return I(D)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),children:Object(a.jsx)(g,{tab:l,metrics:C,metricsLoading:b})}),Object(a.jsx)(m.a,{title:"Delivery trends",className:"mt-4",children:Object(a.jsx)(A.AppMetricsGraph,{tab:l,metrics:C,metricsLoading:b})})]})}function g(u){var l,P,C,b=u.tab,i=u.metrics,L=u.metricsLoading;return L?Object(a.jsx)(c.a,{className:"h-20"}):Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"card-secondary",children:d.DescriptionColumns[b].successes}),Object(a.jsx)("div",{children:v(i==null||(l=i.totals)===null||l===void 0?void 0:l.successes)})]}),d.DescriptionColumns[b].successes_on_retry&&Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"card-secondary",children:d.DescriptionColumns[b].successes_on_retry}),Object(a.jsx)("div",{children:v(i==null||(P=i.totals)===null||P===void 0?void 0:P.successes_on_retry)})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"card-secondary",children:d.DescriptionColumns[b].failures}),Object(a.jsx)("div",{children:v(i==null||(C=i.totals)===null||C===void 0?void 0:C.failures)})]})]})}function v(u){return Object(a.jsx)(a.Fragment,{children:u&&Object(j.P)(u)})}try{T.displayName="MetricsTab",T.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:T.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(u){}try{g.displayName="MetricsOverview",g.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:g.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(u){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(h,_,e){"use strict";e.r(_),e.d(_,"AppMetricsTab",function(){return M}),e.d(_,"appMetricsSceneLogic",function(){return $});var m=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),O=e.n(m),d=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),c=e.n(d),j=e("./node_modules/@babel/runtime/regenerator/index.js"),A=e.n(j),R=e("./node_modules/core-js/modules/es.array.iterator.js"),f=e.n(R),a=e("./node_modules/core-js/modules/es.object.to-string.js"),B=e.n(a),T=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),g=e.n(T),v=e("./node_modules/core-js/modules/es.array.concat.js"),u=e.n(v),l=e("./node_modules/core-js/modules/es.function.name.js"),P=e.n(l),C=e("./node_modules/core-js/modules/es.array.includes.js"),b=e.n(C),i=e("./node_modules/core-js/modules/es.string.includes.js"),L=e.n(i),I=e("./node_modules/core-js/modules/es.array.filter.js"),V=e.n(I),D=e("./node_modules/kea/lib/index.esm.js"),F=e("./node_modules/kea-loaders/lib/index.js"),x=e.n(F),G=e("./frontend/src/scenes/urls.ts"),Y=e("./frontend/src/lib/api.ts"),H=e("./frontend/src/scenes/teamLogic.tsx"),K=e("./node_modules/kea-router/lib/index.js"),Z=e.n(K),J=e("./frontend/src/lib/utils.tsx"),M;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.HistoricalExports="historical_exports"})(M||(M={}));var U=[M.ProcessEvent,M.OnEvent,M.ExportEvents],$=Object(D.kea)([Object(D.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(D.props)({}),Object(D.key)(function(t){return t.pluginConfigId}),Object(D.actions)({setActiveTab:function(r){return{tab:r}},setDateFrom:function(r){return{dateFrom:r}}}),Object(D.reducers)({activeTab:[null,{setActiveTab:function(r,s){var n=s.tab;return n}}],dateFrom:["-30d",{setDateFrom:function(r,s){var n=s.dateFrom;return n}}]}),Object(F.loaders)(function(t){var r=t.values,s=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var n=c()(A.a.mark(function E(){return A.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Y.b.get("api/projects/".concat(H.a.values.currentTeamId,"/plugin_configs/").concat(s.pluginConfigId));case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},E)}));function o(){return n.apply(this,arguments)}return o}()}],metrics:[null,{loadMetrics:function(){var n=c()(A.a.mark(function E(){var y,p,W;return A.a.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return y=Object(J.Eb)({category:r.activeTab,date_from:r.dateFrom}),N.next=3,Y.b.get("api/projects/".concat(H.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"?").concat(y));case 3:return p=N.sent,W=p.results,N.abrupt("return",W);case 6:case"end":return N.stop()}},E)}));function o(){return n.apply(this,arguments)}return o}()}],historicalExports:[[],{loadHistoricalExports:function(){var n=c()(A.a.mark(function E(){var y,p;return A.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,Y.b.get("api/projects/".concat(H.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/historical_exports"));case 2:return y=S.sent,p=y.results,S.abrupt("return",p);case 5:case"end":return S.stop()}},E)}));function o(){return n.apply(this,arguments)}return o}()}]}}),Object(D.selectors)(function(t){var r=t.values;return{breadcrumbs:[function(s){return[s.pluginConfig,function(n,o){return o.pluginConfigId}]},function(s,n){var o;return[{name:"Apps",path:G.a.projectApps()},{name:s==null||(o=s.plugin_info)===null||o===void 0?void 0:o.name,path:G.a.appMetrics(n)}]}],showTab:[function(){return[]},function(){return function(s){var n;if(r.pluginConfigLoading||!r.pluginConfig)return!1;var o=((n=r.pluginConfig.plugin_info.capabilities)===null||n===void 0?void 0:n.methods)||[];return s===M.HistoricalExports?o.includes("exportEvents"):s===M.OnEvent&&o.includes("exportEvents")?!1:o.includes(s)}}]}}),Object(D.listeners)(function(t){var r=t.values,s=t.actions;return{loadPluginConfigSuccess:function(){if(!r.activeTab){var o=U.filter(function(p){return r.showTab(p)}),E=O()(o,1),y=E[0];s.setActiveTab(y)}},setActiveTab:function(o){var E=o.tab;E===M.HistoricalExports?s.loadHistoricalExports():s.loadMetrics()},setDateFrom:function(){s.loadMetrics()}}}),Object(K.actionToUrl)(function(t){var r=t.values,s=t.props;return{setActiveTab:function(){var o;return r.activeTab===M.HistoricalExports?G.a.appHistoricalExports(s.pluginConfigId):G.a.appMetrics(s.pluginConfigId,(o=r.activeTab)!==null&&o!==void 0?o:void 0)}}}),Object(K.urlToAction)(function(t){var r=t.values,s=t.actions;return{"/app/:pluginConfigId/:page":function(o,E){r.pluginConfig||s.loadPluginConfig(),o.page===M.HistoricalExports?s.setActiveTab(M.HistoricalExports):E.tab&&U.includes(E.tab)&&s.setActiveTab(E.tab)}}})])},"./frontend/src/scenes/apps/constants.tsx":function(h,_,e){"use strict";e.r(_),e.d(_,"DescriptionColumns",function(){return j});var m=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),O=e.n(m),d=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),c,j=(c={},O()(c,d.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),O()(c,d.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),O()(c,d.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),O()(c,d.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),c)},"./frontend/src/scenes/apps/historicalExportLogic.ts":function(h,_,e){"use strict";e.r(_),e.d(_,"historicalExportLogic",function(){return b});var m=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),O=e.n(m),d=e("./node_modules/@babel/runtime/regenerator/index.js"),c=e.n(d),j=e("./node_modules/core-js/modules/es.array.concat.js"),A=e.n(j),R=e("./node_modules/core-js/modules/es.array.iterator.js"),f=e.n(R),a=e("./node_modules/core-js/modules/es.object.to-string.js"),B=e.n(a),T=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),g=e.n(T),v=e("./node_modules/kea/lib/index.esm.js"),u=e("./node_modules/kea-loaders/lib/index.js"),l=e.n(u),P=e("./frontend/src/lib/api.ts"),C=e("./frontend/src/scenes/teamLogic.tsx"),b=Object(v.kea)([Object(v.path)(["scenes","apps","historicalExportLogic"]),Object(v.props)({}),Object(v.key)(function(i){var L=i.pluginConfigId,I=i.jobId;return"".concat(L,"_").concat(I)}),Object(u.loaders)(function(i){var L=i.props;return{data:[null,{loadExportData:function(){var I=O()(c.a.mark(function D(){return c.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,P.b.get("api/projects/".concat(C.a.values.currentTeamId,"/app_metrics/").concat(L.pluginConfigId,"/historical_exports/").concat(L.jobId));case 2:return x.abrupt("return",x.sent);case 3:case"end":return x.stop()}},D)}));function V(){return I.apply(this,arguments)}return V}()}]}}),Object(v.events)(function(i){var L=i.actions;return{afterMount:L.loadExportData}})])},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(h,_,e){var m=e("./node_modules/css-loader/dist/runtime/api.js");_=m(!1),_.push([h.i,".AppMetricsGraph{height:300px}",""]),h.exports=_}}]);
