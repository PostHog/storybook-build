(window.webpackJsonp=window.webpackJsonp||[]).push([[233],{"./frontend/src/lib/components/RestrictedArea.tsx":function(ie,A,n){"use strict";n.d(A,"b",function(){return g}),n.d(A,"a",function(){return C});var R=n("./node_modules/core-js/modules/es.array.concat.js"),Z=n.n(R),j=n("./node_modules/kea/lib/index.esm.js"),O=n("./node_modules/react/index.js"),e=n.n(O),y=n("./frontend/src/scenes/organizationLogic.tsx"),Y=n("./frontend/src/lib/constants.tsx"),H=n("./frontend/src/lib/components/Tooltip.tsx"),G=n("./frontend/src/lib/utils/permissioning.ts"),E=n("./frontend/src/scenes/teamLogic.ts"),g;(function(S){S.Organization="organization",S.Project="project"})(g||(g={}));function C(S){var N=S.Component,x=S.minimumAccessLevel,B=S.scope,P=B===void 0?g.Organization:B,p=Object(j.useValues)(y.a),k=p.currentOrganization,w=Object(j.useValues)(E.a),F=w.currentTeam,Q=Object(O.useMemo)(function(){var T;if(P===g.Project){if(!F)return"Loading current project\u2026";T=F.effective_membership_level}else{if(!k)return"Loading current organization\u2026";T=k.membership_level}return T===null?"You don't have access to the current ".concat(P,"."):T<x?x===Y.m.Owner?"This area is restricted to the ".concat(P," owner."):"This area is restricted to ".concat(P," ").concat(G.b.get(x),"s and up. Your level is ").concat(G.b.get(T),"."):null},[k]);return Q?e.a.createElement(H.a,{title:Q,placement:"topLeft",delayMs:0},e.a.createElement("span",null,e.a.createElement(N,{isRestricted:!0,restrictionReason:Q}))):e.a.createElement(N,{isRestricted:!1,restrictionReason:null})}try{C.displayName="RestrictedArea",C.__docgenInfo={description:"",displayName:"RestrictedArea",props:{Component:{defaultValue:null,description:"",name:"Component",required:!0,type:{name:"(props: RestrictedComponentProps) => Element"}},minimumAccessLevel:{defaultValue:null,description:"",name:"minimumAccessLevel",required:!0,type:{name:"enum",value:[{value:"1"},{value:"8"},{value:"15"},{value:"1"},{value:"8"}]}},scope:{defaultValue:{value:"RestrictionScope.Organization"},description:"",name:"scope",required:!1,type:{name:"enum",value:[{value:'"organization"'},{value:'"project"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"]={docgenInfo:C.__docgenInfo,name:"RestrictedArea",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"})}catch(S){}try{g.Organization.displayName="RestrictionScope.Organization",g.Organization.__docgenInfo={description:"Current organization-wide membership level will be used.",displayName:"RestrictionScope.Organization",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"]={docgenInfo:g.Organization.__docgenInfo,name:"RestrictionScope.Organization",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"})}catch(S){}try{g.Project.displayName="RestrictionScope.Project",g.Project.__docgenInfo={description:"Effective level for the current project will be used.",displayName:"RestrictionScope.Project",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"]={docgenInfo:g.Project.__docgenInfo,name:"RestrictionScope.Project",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"})}catch(S){}},"./frontend/src/lib/forms/Field.tsx":function(ie,A,n){"use strict";n.d(A,"a",function(){return C});var R=n("./node_modules/core-js/modules/es.function.name.js"),Z=n.n(R),j=n("./node_modules/@babel/runtime/helpers/extends.js"),O=n.n(j),e=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),y=n.n(e),Y=n("./node_modules/clsx/dist/clsx.m.js"),H=n("./node_modules/kea-forms/lib/components.js"),G=n.n(H),E=n("./node_modules/react/index.js"),g=n.n(E),C=function(N){var x=N.showOptional,B=N.name,P=y()(N,["showOptional","name"]),p=function(w){var F=w.label,Q=w.kids,T=w.hint,J=w.error;return g.a.createElement("div",{className:Object(Y.a)("ant-row","ant-form-item",T||J?"ant-form-item-with-help":"",J?"ant-form-item-has-error":"")},F?g.a.createElement("div",{className:"ant-col ant-form-item-label"},g.a.createElement("label",{htmlFor:String(B),title:typeof F=="string"?F:void 0},x?g.a.createElement(g.a.Fragment,null,F,x?g.a.createElement("span",{className:"ant-form-item-optional",title:""},"(optional)"):null):F)):null,g.a.createElement("div",{className:"ant-col ant-form-item-control"},g.a.createElement("div",{className:"ant-form-item-control-input"},g.a.createElement("div",{className:"ant-form-item-control-input-content"},Q)),T||J?g.a.createElement("div",{className:"ant-form-item-explain ant-form-item-explain-connected"},J?g.a.createElement("div",{role:"alert",className:"ant-form-item-explain-error"},"Error: ",J):null,T?g.a.createElement("div",{role:"alert",className:"ant-form-item-explain-warning"},"Hint: ",T):null):null))};return g.a.createElement(H.Field,O()({},P,{name:B,template:p}))};try{C.displayName="Field",C.__docgenInfo={description:"Compatible replacement for Form.Item",displayName:"Field",props:{showOptional:{defaultValue:null,description:"",name:"showOptional",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/forms/Field.tsx#Field"]={docgenInfo:C.__docgenInfo,name:"Field",path:"frontend/src/lib/forms/Field.tsx#Field"})}catch(S){}},"./frontend/src/lib/hooks/useAnchor.ts":function(ie,A,n){"use strict";n.d(A,"a",function(){return j});var R=n("./node_modules/react/index.js"),Z=n.n(R);function j(O){Object(R.useEffect)(function(){if(O&&document.getElementById(O.substr(1))){var e=document.getElementById(O.substr(1));if(!e)return;e.classList.add("highlighted");var y=e.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:y-50-32,behavior:"smooth"})}},[O])}},"./frontend/src/scenes/organization/Settings/index.tsx":function(ie,A,n){"use strict";n.r(A),n.d(A,"scene",function(){return vn}),n.d(A,"OrganizationSettings",function(){return Re});var R=n("./node_modules/core-js/modules/es.function.name.js"),Z=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),j=n.n(Z),O=n("./node_modules/react/index.js"),e=n.n(O),y=n("./node_modules/antd/es/input/index.js"),Y=n("./node_modules/antd/es/button/index.js"),H=n("./node_modules/antd/es/switch/index.js"),G=n("./node_modules/antd/es/card/index.js"),E=n("./node_modules/antd/es/divider/index.js"),g=n("./frontend/src/lib/components/PageHeader.tsx"),C=n("./node_modules/core-js/modules/es.array.iterator.js"),S=n("./node_modules/core-js/modules/es.object.to-string.js"),N=n("./node_modules/core-js/modules/es.string.iterator.js"),x=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),B=n("./node_modules/core-js/modules/web.url.js"),P=n("./node_modules/antd/es/modal/index.js"),p=n("./node_modules/kea/lib/index.esm.js"),k=n("./node_modules/@ant-design/icons/es/icons/ExclamationCircleOutlined.js"),w=n("./frontend/src/lib/components/CopyToClipboard.tsx"),F=n("./frontend/src/lib/components/ProfilePicture/index.ts"),Q=n("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),T=n("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),J=n("./frontend/src/lib/components/LemonTable/index.ts"),Oe=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),ye=n("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),_=n("./frontend/src/lib/components/LemonButton/index.ts"),$=n("./frontend/src/lib/components/icons.tsx");function Pe(t,a){var o=new URL("/signup/".concat(t),document.baseURI).href;return a.is_expired?e.a.createElement("b",null,"Expired! Delete and recreate"):e.a.createElement(w.a,{"data-attr":"invite-link",description:"invite link"},o)}function Te(t){return function(o,r){return e.a.createElement(_.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:e.a.createElement($.IconClose,null),status:"danger",onClick:function(){r.is_expired?t(r):P.a.confirm({title:"Do you want to cancel the invite for ".concat(r.target_email,"?"),icon:e.a.createElement(k.a,null),okText:"Yes, cancel invite",okType:"danger",onOk:function(){t(r)},cancelText:"No, keep invite"})}})}}function Ve(){var t=Object(p.useValues)(Q.a),a=t.invites,o=t.invitesLoading,r=Object(p.useActions)(Q.a),c=r.deleteInvite,d=r.showInviteModal,s=Object(p.useValues)(ye.a),l=s.preflight,i=[{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(f,u){return u.target_email?e.a.createElement("div",{className:"flex-center"},e.a.createElement(F.b,{name:u.first_name,email:u.target_email,size:"md",style:{marginRight:8}}),u.target_email,u.first_name?" (".concat(u.first_name,")"):""):e.a.createElement("i",null,"no one")},width:"20%"},Object(Oe.b)(),Object(Oe.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(f,u){return Pe(u.id,u)}},{title:"",key:"actions",width:24,render:Te(c)}];return e.a.createElement("div",null,e.a.createElement("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"}},"Pending Invites",e.a.createElement(_.a,{type:"primary",onClick:d,"data-attr":"invite-teammate-button"},"Invite team member")),!(l!=null&&l.email_service_available)&&e.a.createElement(T.a,null),e.a.createElement(J.a,{dataSource:a,columns:i,rowKey:"id",loading:o,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."}))}var hn=n("./node_modules/core-js/modules/es.array.concat.js"),On=n("./node_modules/core-js/modules/es.array.filter.js"),yn=n("./node_modules/core-js/modules/es.array.map.js"),ze=n("./node_modules/antd/es/dropdown/index.js"),be=n("./node_modules/antd/es/menu/index.js"),Ne=n("./node_modules/antd/es/table/index.js"),fe=n("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),Se=n("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),Be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"},we=Be,Fe=n("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),Ce=function(a,o){return O.createElement(Fe.a,Object(Se.a)(Object(Se.a)({},a),{},{ref:o,icon:we}))};Ce.displayName="SwapOutlined";var Ke=O.forwardRef(Ce),Ae=n("./node_modules/@ant-design/icons/es/icons/CrownFilled.js"),We=n("./node_modules/@ant-design/icons/es/icons/UpOutlined.js"),Ue=n("./node_modules/@ant-design/icons/es/icons/DownOutlined.js"),je=n("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),Ye=n("./node_modules/@ant-design/icons/es/icons/LogoutOutlined.js"),_e=n("./frontend/src/lib/utils.tsx"),L=n("./frontend/src/lib/constants.tsx"),K=n("./frontend/src/scenes/organizationLogic.tsx"),ve=n("./frontend/src/scenes/userLogic.ts"),oe=n("./frontend/src/lib/components/Tooltip.tsx"),ee=n("./frontend/src/lib/utils/permissioning.ts");function $e(t){var a,o=Object(p.useValues)(ve.a),r=o.user,c=Object(p.useValues)(K.a),d=c.currentOrganization,s=Object(p.useActions)(fe.a),l=s.changeMemberAccessLevel,i=d?d.membership_level:null;if(!r)return null;function m(v){return function(z){if(z.preventDefault(),!r)throw Error;if(v===L.m.Owner){var U;P.a.confirm({centered:!0,title:"Transfer organization ownership to ".concat(t.user.first_name,"?"),content:"You will no longer be the owner of ".concat((U=r.organization)===null||U===void 0?void 0:U.name,". After the transfer you will become an administrator."),icon:e.a.createElement(Ke,null),okType:"danger",okText:"Transfer Ownership",onOk:function(){l(t,v)}})}else l(t,v)}}var f=e.a.createElement(Y.a,{"data-attr":"change-membership-level",icon:t.level===L.m.Owner?e.a.createElement(Ae.a,null):void 0},(a=ee.b.get(t.level))!==null&&a!==void 0?a:"unknown (".concat(t.level,")")),u=ee.c.filter(function(v){return!Object(ee.a)(i,r,t,v)}),b=Object(ee.a)(i,r,t,u);return b?e.a.createElement(oe.a,{title:b},f):e.a.createElement(ze.a,{overlay:e.a.createElement(be.a,null,u.map(function(v){return e.a.createElement(be.a.Item,{key:"".concat(t.user.uuid,"-level-").concat(v)},e.a.createElement("a",{href:"#",onClick:m(v),"data-test-level":v},v===L.m.Owner?e.a.createElement(e.a.Fragment,null,e.a.createElement(Ae.a,{style:{marginRight:"0.5rem"}}),"Transfer organization ownership"):v>t.level?e.a.createElement(e.a.Fragment,null,e.a.createElement(We.a,{style:{marginRight:"0.5rem"}}),"Upgrade to ",ee.b.get(v)):e.a.createElement(e.a.Fragment,null,e.a.createElement(Ue.a,{style:{marginRight:"0.5rem"}}),"Downgrade to ",ee.b.get(v))))}))},f)}function Ze(t){var a,o=Object(p.useValues)(ve.a),r=o.user,c=Object(p.useValues)(K.a),d=c.currentOrganization,s=Object(p.useActions)(fe.a),l=s.removeMember;if(!r)return null;var i=(a=d==null?void 0:d.membership_level)!==null&&a!==void 0?a:-1;function m(){var u;if(!r)throw Error;P.a.confirm({title:"".concat(t.user.uuid==r.uuid?"Leave":"Remove ".concat(t.user.first_name," from")," organization ").concat((u=r.organization)===null||u===void 0?void 0:u.name,"?"),icon:e.a.createElement(k.a,null),okText:t.user.uuid==r.uuid?"Leave":"Remove",okType:"danger",cancelText:"Cancel",onOk:function(){l(t)}})}var f=(i>=L.m.Admin&&t.level<=i||t.user.uuid===r.uuid)&&t.level!==L.m.Owner;return e.a.createElement("div",null,f&&e.a.createElement("a",{className:"text-danger",onClick:m,"data-attr":"delete-org-membership"},t.user.uuid!==r.uuid?e.a.createElement(je.a,{title:"Remove from organization"}):e.a.createElement(Ye.a,{title:"Leave organization"})))}function le(t){var a=t.user,o=Object(p.useValues)(fe.a),r=o.members,c=o.membersLoading,d=[{key:"user_profile_picture",render:function(l,i){return e.a.createElement(F.b,{name:i.user.first_name,email:i.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(l,i){return i.user.uuid==a.uuid?"".concat(i.user.first_name," (me)"):i.user.first_name},sorter:function(l,i){return l.user.first_name.localeCompare(i.user.first_name)}},{title:"Email",key:"user_email",render:function(l,i){return i.user.email},sorter:function(l,i){return l.user.email.localeCompare(i.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(l,i){return $e(i)},sorter:function(l,i){return l.level-i.level},defaultSortOrder:"descend"},{title:"Joined\xA0At",dataIndex:"joined_at",key:"joined_at",render:function(l){return Object(_e.L)(l)},sorter:function(l,i){return l.joined_at.localeCompare(i.joined_at)},defaultSortOrder:"ascend"},{dataIndex:"actions",key:"actions",align:"center",render:function(l,i){return Ze(i)}}];return e.a.createElement(e.a.Fragment,null,e.a.createElement("h2",{className:"subtitle"},"Members"),e.a.createElement(Ne.a,{dataSource:r,columns:d,rowKey:"id",pagination:!1,style:{marginTop:"1rem"},loading:c,"data-attr":"org-members-table"}))}try{le.displayName="Members",le.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:le.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(t){}var He=n("./node_modules/antd/lib/typography/Paragraph.js"),Ge=n.n(He);function se(t){var a=t.isVisible,o=t.setIsVisible,r=Object(p.useValues)(K.a),c=r.currentOrganization,d=r.organizationBeingDeleted,s=Object(p.useActions)(K.a),l=s.deleteOrganization,i=Object(O.useState)(!1),m=j()(i,2),f=m[0],u=m[1],b=!!c&&(d==null?void 0:d.id)===c.id;return e.a.createElement(P.a,{title:"Delete the entire organization?",okText:"Delete ".concat(c?c.name:"the current organization"),onOk:c?function(){return l(c)}:void 0,okType:"primary",okButtonProps:{"data-attr":"delete-organization-ok",loading:b,disabled:!f,className:"btn-danger"},onCancel:function(){return o(!1)},cancelButtonProps:{disabled:b},visible:a},e.a.createElement("p",null,"Organization deletion ",e.a.createElement("b",null,"cannot be undone"),". You will lose all data, ",e.a.createElement("b",null,"including all events"),", related to all projects within this organization."),e.a.createElement("p",null,"Please type"," ",e.a.createElement("strong",null,c?c.name:"this organization's name")," to confirm."),e.a.createElement(y.a,{type:"text",onChange:function(D){if(c){var z=D.target.value;u(z.toLowerCase()===c.name.toLowerCase())}}}))}function ce(t){var a=t.isRestricted,o=Object(p.useValues)(K.a),r=o.currentOrganization,c=Object(O.useState)(!1),d=j()(c,2),s=d[0],l=d[1];return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{style:{color:"var(--danger)"}},e.a.createElement("h2",{style:{color:"var(--danger)"},className:"subtitle"},"Danger Zone"),e.a.createElement("div",{className:"mt"},!a&&e.a.createElement(Ge.a,{type:"danger"},"This is ",e.a.createElement("b",null,"irreversible"),". Please be certain."),e.a.createElement(Y.a,{type:"primary",onClick:function(){return l(!0)},className:"mr-05 btn-danger","data-attr":"delete-project-button",icon:e.a.createElement(je.a,null),disabled:a},"Delete ",(r==null?void 0:r.name)||"the current organization"))),e.a.createElement(se,{isVisible:s,setIsVisible:l}))}try{se.displayName="DeleteOrganizationModal",se.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isVisible:{defaultValue:null,description:"",name:"isVisible",required:!0,type:{name:"boolean"}},setIsVisible:{defaultValue:null,description:"",name:"setIsVisible",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:se.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(t){}try{ce.displayName="DangerZone",ce.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:ce.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(t){}var de=n("./frontend/src/lib/components/RestrictedArea.tsx"),Qe=n("./frontend/src/lib/hooks/useAnchor.ts"),Je=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ue=n.n(Je),De=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),bn=n("./node_modules/core-js/modules/es.array.find.js"),Sn=n("./node_modules/core-js/modules/es.array.includes.js"),Cn=n("./node_modules/core-js/modules/es.regexp.exec.js"),An=n("./node_modules/core-js/modules/es.string.includes.js"),jn=n("./node_modules/core-js/modules/es.string.match.js"),Xe=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),ke=n.n(Xe),qe=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),en=n.n(qe),nn=n("./node_modules/@babel/runtime/regenerator/index.js"),V=n.n(nn),Dn=n("./node_modules/regenerator-runtime/runtime.js"),tn=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ne=n.n(tn),te=n("./frontend/src/lib/api.ts"),me=n("./frontend/src/lib/components/lemonToast.tsx"),Me=n("./frontend/src/types.ts");function Le(t,a){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),o.push.apply(o,r)}return o}function ge(t){for(var a=1;a<arguments.length;a++){var o=arguments[a]!=null?arguments[a]:{};a%2?Le(Object(o),!0).forEach(function(r){en()(t,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):Le(Object(o)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))})}return t}var W=Object(p.kea)({path:["scenes","organization","verifiedDomainsLogic"],connect:{values:[K.a,["currentOrganization"]]},actions:{replaceDomain:function(a){return{domain:a}},setAddModalShown:function(a){return{shown:a}},setConfigureSAMLModalId:function(a){return{id:a}},setVerifyModal:function(a){return{id:a}}},reducers:{verifiedDomains:[[],{replaceDomain:function(a,o){var r=o.domain,c=[].concat(ue()(a.filter(function(d){var s=d.id;return s!==r.id})),[r]);return c.sort(function(d,s){return d.domain.localeCompare(s.domain)}),c}}],addModalShown:[!1,{setAddModalShown:function(a,o){var r=o.shown;return r},addVerifiedDomainSuccess:function(){return!1}}],configureSAMLModalId:[null,{setConfigureSAMLModalId:function(a,o){var r=o.id;return r}}],verifyModal:[null,{setVerifyModal:function(a,o){var r=o.id;return r}}]},loaders:function(a){var o=a.values,r=a.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var c=ne()(V.a.mark(function s(){var l;return V.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,te.b.get("api/organizations/".concat((l=o.currentOrganization)===null||l===void 0?void 0:l.id,"/domains"));case 2:return m.abrupt("return",m.sent.results);case 3:case"end":return m.stop()}},s)}));function d(){return c.apply(this,arguments)}return d}(),addVerifiedDomain:function(){var c=ne()(V.a.mark(function s(l){var i,m;return V.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,te.b.create("api/organizations/".concat((i=o.currentOrganization)===null||i===void 0?void 0:i.id,"/domains"),{domain:l});case 2:return m=u.sent,u.abrupt("return",[m].concat(ue()(o.verifiedDomains)));case 4:case"end":return u.stop()}},s)}));function d(s){return c.apply(this,arguments)}return d}(),deleteVerifiedDomain:function(){var c=ne()(V.a.mark(function s(l){var i;return V.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,te.b.delete("api/organizations/".concat((i=o.currentOrganization)===null||i===void 0?void 0:i.id,"/domains/").concat(l));case 2:return f.abrupt("return",ue()(o.verifiedDomains.filter(function(u){return u.id!==l})));case 3:case"end":return f.stop()}},s)}));function d(s){return c.apply(this,arguments)}return d}()}],updatingDomain:[!1,{updateDomain:function(){var c=ne()(V.a.mark(function s(l){var i,m;return V.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,te.b.update("api/organizations/".concat((i=o.currentOrganization)===null||i===void 0?void 0:i.id,"/domains/").concat(l.id),ge(ge({},l),{},{id:void 0}));case 2:return m=u.sent,me.a.success("Domain updated successfully! Changes will take immediately."),r.replaceDomain(m),u.abrupt("return",!1);case 6:case"end":return u.stop()}},s)}));function d(s){return c.apply(this,arguments)}return d}(),verifyDomain:function(){var c=ne()(V.a.mark(function s(){var l,i;return V.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,te.b.create("api/organizations/".concat((l=o.currentOrganization)===null||l===void 0?void 0:l.id,"/domains/").concat(o.verifyModal,"/verify"));case 2:return i=f.sent,i.is_verified?me.a.success("Domain verified successfully."):me.a.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),r.replaceDomain(i),r.setVerifyModal(null),f.abrupt("return",!1);case 7:case"end":return f.stop()}},s)}));function d(){return c.apply(this,arguments)}return d}()}]}},listeners:function(a){var o=a.actions,r=a.values;return{setConfigureSAMLModalId:function(d){var s=d.id,l=r.verifiedDomains.find(function(u){var b=u.id;return b===s});if(s&&l){var i=l.saml_acs_url,m=l.saml_entity_id,f=l.saml_x509_cert;o.setSamlConfigValues({saml_acs_url:i,saml_entity_id:m,saml_x509_cert:f,id:s})}}}},selectors:{domainBeingVerified:[function(t){return[t.verifiedDomains,t.verifyModal]},function(t,a){return a&&t.find(function(o){var r=o.id;return r===a})||null}],isSSOEnforcementAvailable:[function(t){return[t.currentOrganization]},function(t){var a;return(a=t==null?void 0:t.available_features.includes(Me.d.SSO_ENFORCEMENT))!==null&&a!==void 0?a:!1}],isSAMLAvailable:[function(t){return[t.currentOrganization]},function(t){var a;return(a=t==null?void 0:t.available_features.includes(Me.d.SAML))!==null&&a!==void 0?a:!1}]},events:function(a){var o=a.actions;return{afterMount:[o.loadVerifiedDomains]}},forms:function(a){var o=a.actions,r=a.values;return{samlConfig:{defaults:{},validator:function(d){return{saml_acs_url:d.saml_acs_url&&!d.saml_acs_url.match(L.u)?"Please enter a valid URL, including https://":void 0}},submit:function(){var c=ne()(V.a.mark(function s(l,i){var m,f,u,b;return V.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(f=l.id,u=ke()(l,["id"]),f){D.next=3;break}return D.abrupt("return");case 3:return D.next=5,te.b.update("api/organizations/".concat((m=r.currentOrganization)===null||m===void 0?void 0:m.id,"/domains/").concat(l.id),ge({},u));case 5:b=D.sent,i(),o.replaceDomain(b),o.setConfigureSAMLModalId(null),o.setSamlConfigValues({}),me.a.success("SAML configuration for ".concat(b.domain," updated successfully."));case 11:case"end":return D.stop()}},s)}));function d(s,l){return c.apply(this,arguments)}return d}()}}}}),pe=n("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),an=n("./frontend/src/lib/components/LemonButton/More.tsx"),Ee=n("./frontend/src/lib/components/LemonModal/LemonModal.tsx");function rn(){var t=Object(p.useValues)(W),a=t.addModalShown,o=t.verifiedDomainsLoading,r=Object(p.useActions)(W),c=r.setAddModalShown,d=r.addVerifiedDomain,s=Object(O.useState)(""),l=j()(s,2),i=l[0],m=l[1],f=Object(O.useState)(!1),u=j()(f,2),b=u[0],v=u[1],D=!i||!i.match(L.c),z=function(){m(""),v(!1)},U=function(){c(!1),z()},h=function(){v(!0),D||(d(i),z())};return e.a.createElement(Ee.a,{onCancel:U,visible:a,destroyOnClose:!0},e.a.createElement("section",null,e.a.createElement("h5",null,"Add authentication domain"),e.a.createElement(y.a,{placeholder:"posthog.com",autoFocus:!0,value:i,onChange:function(I){return m(I.target.value)},onPressEnter:h}),b&&D&&e.a.createElement("span",{className:"text-danger text-small"},"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e.a.createElement(_.a,{type:"primary",disabled:i===""||b&&D||o,onClick:h},"Add domain"))))}var on=n("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx");function ln(){var t=Object(p.useValues)(W),a=t.domainBeingVerified,o=t.updatingDomainLoading,r=Object(p.useActions)(W),c=r.setVerifyModal,d=r.verifyDomain,s="_posthog-challenge.".concat(a==null?void 0:a.domain,".");return e.a.createElement(Ee.a,{visible:!!a,onCancel:function(){return c(null)}},e.a.createElement("section",null,e.a.createElement("h5",null,"Verify your domain"),e.a.createElement(De.a,null,(a==null?void 0:a.domain)||""),e.a.createElement("p",{className:"text-muted-alt"},"To verify your domain, you need to add a record to your DNS zone."),e.a.createElement("div",null,e.a.createElement("ol",null,e.a.createElement("li",null,"Sign in to your DNS provider."),e.a.createElement("li",null,"Add the following ",e.a.createElement("b",null,"TXT")," record.",e.a.createElement("div",{className:"mt mb"},e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-name"},"Name"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(y.a,{disabled:!0,value:s,name:"record-name"}),e.a.createElement(w.a,{explicitValue:s,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"Value or content"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(y.a,{disabled:!0,value:a==null?void 0:a.verification_challenge,name:"record-value"}),e.a.createElement(w.a,{explicitValue:a==null?void 0:a.verification_challenge,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"TTL"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(y.a,{disabled:!0,value:"Default or 3600",name:"record-value"}),e.a.createElement(w.a,{explicitValue:"3600",style:{marginLeft:4}}))))),e.a.createElement("li",null,"Press verify below."))),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e.a.createElement(_.a,{onClick:function(){return c(null)},style:{marginRight:8}},"Verify later"),e.a.createElement(_.a,{type:"primary",disabled:o,onClick:d},"Verify"))))}var xe=n("./frontend/src/lib/components/Link.tsx"),sn=n("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),cn=n("./node_modules/kea-forms/lib/index.js"),he=n("./frontend/src/lib/forms/Field.tsx"),dn=n("./frontend/src/lib/components/AlertMessage/index.ts");function un(){var t=Object(p.useValues)(W),a=t.configureSAMLModalId,o=t.isSamlConfigSubmitting,r=t.samlConfig,c=Object(p.useActions)(W),d=c.setConfigureSAMLModalId,s=r.saml_acs_url&&r.saml_entity_id&&r.saml_x509_cert,l=function(){d(null)};return e.a.createElement(Ee.a,{onCancel:l,visible:!!a,destroyOnClose:!0},e.a.createElement("section",null,e.a.createElement("h5",null,"Configure SAML authentication and provisioning"),e.a.createElement(cn.Form,{logic:W,formKey:"samlConfig",className:"ant-form-vertical ant-form-hide-required-mark"},e.a.createElement(he.a,{name:"saml_acs_url",label:"SAML ACS URL"},function(i){var m=i.value,f=i.onChange;return e.a.createElement(y.a,{value:m,onChange:f,className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})}),e.a.createElement(he.a,{name:"saml_entity_id",label:"SAML Entity ID"},function(i){var m=i.value,f=i.onChange;return e.a.createElement(y.a,{value:m,onChange:f,className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})}),e.a.createElement(he.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate"},function(i){var m=i.value,f=i.onChange;return e.a.createElement(y.a.TextArea,{value:m,onChange:f,className:"ph-ignore-input",style:{minHeight:150},placeholder:`Enter the public certificate of your IdP. Keep all line breaks.
-----BEGIN CERTIFICATE-----
MIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL
-----END CERTIFICATE-----`})}),!s&&e.a.createElement(dn.a,{type:"info",style:{marginBottom:16}},"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft."),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e.a.createElement(_.a,{loading:o,type:"primary",htmlType:"submit"},"Save settings")))))}var ae={marginRight:4,fontSize:"1.15em",paddingTop:2};function mn(){var t=Object(p.useValues)(W),a=t.verifiedDomainsLoading,o=t.updatingDomainLoading,r=Object(p.useActions)(W),c=r.setAddModalShown;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"flex-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("div",{id:"domain-whitelist"})," ",e.a.createElement("h2",{id:"authentication-domains",className:"subtitle"},"Authentication domains"),e.a.createElement("p",{className:"text-muted-alt"},"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains.")),e.a.createElement(_.a,{type:"primary",onClick:function(){return c(!0)},disabled:a||o},"Add domain")),e.a.createElement(fn,null))}function fn(){var t=Object(p.useValues)(W),a=t.verifiedDomains,o=t.verifiedDomainsLoading,r=t.currentOrganization,c=t.updatingDomainLoading,d=t.isSSOEnforcementAvailable,s=t.isSAMLAvailable,l=Object(p.useActions)(W),i=l.updateDomain,m=l.deleteVerifiedDomain,f=l.setVerifyModal,u=l.setConfigureSAMLModalId,b=Object(p.useValues)(ye.a),v=b.preflight,D=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function(U,h){var M=h.domain;return e.a.createElement(De.a,{style:{textTransform:"lowercase"}},M)}}].concat(ue()(v!=null&&v.cloud?[{key:"is_verified",title:e.a.createElement(e.a.Fragment,null,"Verification",e.a.createElement(oe.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO)."},e.a.createElement(pe.a,{style:{marginLeft:4}}))),render:function(U,h){var M=h.is_verified,I=h.verified_at;return M?e.a.createElement("div",{className:"flex-center text-success"},e.a.createElement($.IconCheckmark,{style:ae})," Verified"):I?e.a.createElement("div",{className:"flex-center text-danger"},e.a.createElement($.IconExclamation,{style:ae})," Verification expired"):e.a.createElement("div",{className:"flex-center text-warning"},e.a.createElement($.IconWarningAmber,{style:ae})," Pending verification")}}]:[]),[{key:"jit_provisioning_enabled",title:e.a.createElement(e.a.Fragment,null,"Automatic provisioning"," ",e.a.createElement(oe.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((r==null?void 0:r.name)||"this organization"," if it does not exist.")},e.a.createElement(pe.a,null))),render:function(U,h){var M=h.jit_provisioning_enabled,I=h.id,X=h.is_verified;return X?e.a.createElement("div",{className:"flex-center"},e.a.createElement(sn.a,{checked:M,disabled:c||!X,onChange:function(re){return i({id:I,jit_provisioning_enabled:re})},label:M?"Enabled":"Disabled",style:{padding:0,fontWeight:400}})):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable automatic provisioning")}},{key:"sso_enforcement",title:e.a.createElement(e.a.Fragment,null,"Enforce SSO"," ",e.a.createElement(oe.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider."},e.a.createElement(pe.a,null))),render:function(U,h,M){var I=h.sso_enforcement,X=h.is_verified,q=h.id,re=h.has_saml;return d?X?e.a.createElement(on.a,{value:I,loading:c,onChange:function(En){return i({id:q,sso_enforcement:En})},samlAvailable:re}):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):M===0?e.a.createElement(xe.a,{to:Object(L.z)(v==null?void 0:v.cloud).url,target:Object(L.z)(v==null?void 0:v.cloud).target,className:"flex-center"},e.a.createElement($.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"):e.a.createElement(e.a.Fragment,null)}},{key:"saml",title:"SAML",render:function(U,h,M){var I=h.is_verified,X=h.saml_acs_url,q=h.saml_entity_id,re=h.saml_x509_cert,Ie=h.has_saml;return s?I?e.a.createElement(e.a.Fragment,null,Ie?e.a.createElement("div",{className:"flex-center text-success"},e.a.createElement($.IconCheckmark,{style:ae})," SAML enabled"):X||q||re?e.a.createElement("div",{className:"flex-center text-warning"},e.a.createElement($.IconWarningAmber,{style:ae})," SAML partially configured"):e.a.createElement("div",{className:"flex-center"},e.a.createElement($.IconOffline,{style:ae})," SAML not set up")):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):M===0?e.a.createElement(xe.a,{to:Object(L.z)(v==null?void 0:v.cloud).url,target:Object(L.z)(v==null?void 0:v.cloud).target,className:"flex-center"},e.a.createElement($.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"):e.a.createElement(e.a.Fragment,null)}},{key:"actions",width:32,align:"center",render:function(U,h){var M=h.is_verified,I=h.id,X=h.domain;return M?e.a.createElement(an.a,{overlay:e.a.createElement(e.a.Fragment,null,e.a.createElement(_.a,{type:"stealth",onClick:function(){return u(I)},fullWidth:!0,disabled:!s,title:s?void 0:"Upgrade to enable SAML"},"Configure SAML"),e.a.createElement(_.a,{type:"stealth",style:{color:"var(--danger)"},onClick:function(){return P.a.confirm({title:"Remove ".concat(X,"?"),icon:null,okText:"Remove domain",okType:"primary",okButtonProps:{className:"btn-danger"},content:e.a.createElement("div",null,"This cannot be undone. If you have SAML configured or SSO enforced, it will be immediately disabled."),onOk:function(){m(I)},cancelText:"Cancel"})},fullWidth:!0},e.a.createElement($.IconDelete,null)," Remove domain")),style:{display:"inline-block"}}):e.a.createElement(_.a,{type:"primary",onClick:function(){return f(I)}},"Verify")}}]);return e.a.createElement("div",null,e.a.createElement(J.a,{dataSource:a,columns:D,loading:o,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),e.a.createElement(rn,null),e.a.createElement(un,null),e.a.createElement(ln,null))}var vn={component:Re,logic:K.a};function gn(t){var a=t.isRestricted,o=Object(p.useValues)(K.a),r=o.currentOrganization,c=o.currentOrganizationLoading,d=Object(p.useActions)(K.a),s=d.updateOrganization,l=Object(O.useState)((r==null?void 0:r.name)||""),i=j()(l,2),m=i[0],f=i[1];return e.a.createElement("div",null,e.a.createElement("h2",{id:"name",className:"subtitle"},"Display Name"),e.a.createElement(y.a,{value:m,onChange:function(b){f(b.target.value)},style:{maxWidth:"40rem",marginBottom:"1rem",display:"block"},disabled:a}),e.a.createElement(Y.a,{type:"primary",onClick:function(b){b.preventDefault(),s({name:m})},disabled:a||!m||!r||m===r.name,loading:c},"Rename Organization"))}function pn(t){var a=t.isRestricted,o=Object(p.useValues)(K.a),r=o.currentOrganization,c=o.currentOrganizationLoading,d=Object(p.useActions)(K.a),s=d.updateOrganization;return e.a.createElement("div",null,e.a.createElement("h2",{id:"notification-preferences",className:"subtitle"},"Notification Preferences"),e.a.createElement("div",null,e.a.createElement(H.a,{id:"is-member-join-email-enabled-switch","data-attr":"is-member-join-email-enabled-switch",onChange:function(i){s({is_member_join_email_enabled:i})},checked:r==null?void 0:r.is_member_join_email_enabled,loading:c,disabled:a||!r}),e.a.createElement("label",{style:{marginLeft:"10px"},htmlFor:"is-member-join-email-enabled-switch"},"Email all current members when a new member joins")))}function Re(){var t=Object(p.useValues)(ve.a),a=t.user;return Object(Qe.a)(location.hash),e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),e.a.createElement(G.a,null,e.a.createElement(de.a,{Component:gn,minimumAccessLevel:L.m.Admin}),e.a.createElement(E.a,null),e.a.createElement(Ve,null),e.a.createElement(E.a,null),a&&e.a.createElement(le,{user:a}),e.a.createElement(E.a,null),e.a.createElement(de.a,{Component:mn,minimumAccessLevel:L.m.Admin}),e.a.createElement(E.a,null),e.a.createElement(de.a,{Component:pn,minimumAccessLevel:L.m.Admin}),e.a.createElement(E.a,null),e.a.createElement(de.a,{Component:ce,minimumAccessLevel:L.m.Owner})))}},"./node_modules/@ant-design/icons/es/icons/CrownFilled.js":function(ie,A,n){"use strict";var R=n("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),Z=n("./node_modules/react/index.js"),j={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M899.6 276.5L705 396.4 518.4 147.5a8.06 8.06 0 00-12.9 0L319 396.4 124.3 276.5c-5.7-3.5-13.1 1.2-12.2 7.9L188.5 865c1.1 7.9 7.9 14 16 14h615.1c8 0 14.9-6 15.9-14l76.4-580.6c.8-6.7-6.5-11.4-12.3-7.9zM512 734.2c-62.1 0-112.6-50.5-112.6-112.6S449.9 509 512 509s112.6 50.5 112.6 112.6S574.1 734.2 512 734.2zm0-160.9c-26.6 0-48.2 21.6-48.2 48.3 0 26.6 21.6 48.3 48.2 48.3s48.2-21.6 48.2-48.3c0-26.6-21.6-48.3-48.2-48.3z"}}]},name:"crown",theme:"filled"},O=j,e=n("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),y=function(G,E){return Z.createElement(e.a,Object(R.a)(Object(R.a)({},G),{},{ref:E,icon:O}))};y.displayName="CrownFilled";var Y=A.a=Z.forwardRef(y)},"./node_modules/antd/lib/typography/Paragraph.js":function(ie,A,n){"use strict";var R=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),Z=n("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var j=R(n("./node_modules/@babel/runtime/helpers/extends.js")),O=Y(n("./node_modules/react/index.js")),e=R(n("./node_modules/antd/lib/typography/Base.js"));function y(E){if(typeof WeakMap!="function")return null;var g=new WeakMap,C=new WeakMap;return(y=function(N){return N?C:g})(E)}function Y(E,g){if(!g&&E&&E.__esModule)return E;if(E===null||Z(E)!=="object"&&typeof E!="function")return{default:E};var C=y(g);if(C&&C.has(E))return C.get(E);var S={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in E)if(x!=="default"&&Object.prototype.hasOwnProperty.call(E,x)){var B=N?Object.getOwnPropertyDescriptor(E,x):null;B&&(B.get||B.set)?Object.defineProperty(S,x,B):S[x]=E[x]}return S.default=E,C&&C.set(E,S),S}var H=function(g){return O.createElement(e.default,(0,j.default)({},g,{component:"div"}))},G=H;A.default=G}}]);
