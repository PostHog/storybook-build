(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[51957],{"../../frontend/src/scenes/error-tracking/ErrorTrackingIssueScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ErrorTrackingIssueScene:()=>ErrorTrackingIssueScene,STATUS_LABEL:()=>STATUS_LABEL,scene:()=>scene});var injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),ErrorTracking=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.3_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/error-tracking/ErrorTracking.scss"),ErrorTracking_default=__webpack_require__.n(ErrorTracking),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(ErrorTracking_default(),options),ErrorTracking_default().locals;var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),AssigneeSelect=__webpack_require__("../../frontend/src/scenes/error-tracking/AssigneeSelect.tsx"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.7_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),ViewRecordingButton=__webpack_require__("../../frontend/src/lib/components/ViewRecordingButton/ViewRecordingButton.tsx"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),dist=__webpack_require__("../../node_modules/.pnpm/ts-pattern@4.3.0/node_modules/ts-pattern/dist/index.js"),errorTrackingIssueSceneLogic=__webpack_require__("../../frontend/src/scenes/error-tracking/errorTrackingIssueSceneLogic.ts"),Transition=__webpack_require__("../../node_modules/.pnpm/react-transition-group@4.4.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-transition-group/esm/Transition.js"),bundle_esm=__webpack_require__("../../node_modules/.pnpm/use-resize-observer@8.0.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/use-resize-observer/dist/bundle.esm.js"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function Collapsible(_ref){let{children,isExpanded,className,minHeight=0}=_ref,{height:contentHeight,ref:contentRef}=(0,bundle_esm.Z)({box:"border-box"});return(0,jsx_runtime.jsx)("div",{"aria-expanded":isExpanded,children:(0,jsx_runtime.jsx)(Transition.ZP,{in:isExpanded,timeout:200,children:status=>(0,jsx_runtime.jsx)("div",{style:getStyle(status,contentHeight,minHeight),className:"overflow-hidden","aria-busy":status.endsWith("ing"),children:(0,jsx_runtime.jsx)("div",{className:className,ref:contentRef,children:children})})})})}function getStyle(state,contentHeight,minHeight){switch(state){case Transition.d0:return{height:contentHeight,minHeight,transition:"height 200ms ease-in-out"};case Transition.cn:return{height:contentHeight,minHeight};case Transition.Ix:return{height:minHeight,minHeight,transition:"height 200ms ease-in-out"};case Transition.Wj:default:return{height:minHeight,minHeight}}}function ContextDisplay(_ref){let{className}=_ref,{exceptionAttributes,showContext,propertiesLoading}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r);return(0,jsx_runtime.jsx)("div",{className:(0,css_classes.cn)("pt-14 transition-[width] duration-200",className),children:(0,dist.EQ)([showContext,propertiesLoading,exceptionAttributes]).with([!1,dist.P.any,dist.P.any],()=>null).with([!0,!0,dist.P.any],()=>(0,jsx_runtime.jsx)("div",{className:"flex justify-center w-full h-32 items-center",children:(0,jsx_runtime.jsx)(src.$j,{})})).with([!0,!1,dist.P.nullish],()=>(0,jsx_runtime.jsx)("div",{children:"No data available"})).with([!0,!1,dist.P.any],_ref2=>{let[,,attrs]=_ref2;return(0,jsx_runtime.jsx)("table",{className:"border-spacing-0 border-separate rounded w-full border overflow-hidden",children:(0,jsx_runtime.jsx)("tbody",{className:"w-full",children:[{label:"Level",value:attrs?.level},{label:"Synthetic",value:attrs?.synthetic},{label:"Library",value:attrs?.library},{label:"Unhandled",value:attrs?.unhandled},{label:"Browser",value:attrs?.browser},{label:"OS",value:attrs?.os},{label:"URL",value:attrs?.url}].filter(row=>void 0!==row.value).map((row,index)=>(0,jsx_runtime.jsxs)("tr",{className:"even:bg-fill-tertiary w-full",children:[(0,jsx_runtime.jsx)("th",{className:"border-r-1 font-semibold text-xs p-1 w-1/3 text-left",children:row.label}),(0,jsx_runtime.jsx)("td",{className:"w-full truncate p-1 text-xs max-w-0",title:String(row.value),children:String(row.value)})]},index))})})}).exhaustive()})}var EmptyMessage=__webpack_require__("../../frontend/src/lib/components/EmptyMessage/EmptyMessage.tsx"),FingerprintRecordPartDisplay=__webpack_require__("../../frontend/src/lib/components/Errors/FingerprintRecordPartDisplay.tsx"),StackTraces=__webpack_require__("../../frontend/src/lib/components/Errors/StackTraces.tsx"),utils=__webpack_require__("../../frontend/src/scenes/error-tracking/utils.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts");let RuntimeIconMap={python:icons.Bm,web:icons.RQ,node:icons.fS,unknown:react.Fragment};function RuntimeIcon(_ref){let{runtime,...props}=_ref,Icon=RuntimeIconMap[runtime];return(0,jsx_runtime.jsx)(Icon,{...props})}function StacktraceDisplay(_ref){let{className,truncateMessage}=_ref,{exceptionList,issue,hasStacktrace,exceptionAttributes,showAllFrames,fingerprintRecords,issueLoading,propertiesLoading}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r),renderExceptionHeader=(0,react.useCallback)(_ref2=>{let{type,value,part}=_ref2;return(0,jsx_runtime.jsxs)("div",{className:"pb-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center h-7",children:[exceptionAttributes&&(0,jsx_runtime.jsx)(RuntimeIcon,{runtime:exceptionAttributes.runtime}),(0,jsx_runtime.jsx)("div",{className:"font-bold text-lg",children:type}),part&&(0,jsx_runtime.jsx)(FingerprintRecordPartDisplay.t,{part:part})]}),(0,jsx_runtime.jsx)("div",{className:(0,css_classes.cn)("text-tertiary leading-6",{"line-clamp-1":truncateMessage}),children:value})]})},[exceptionAttributes,truncateMessage]);return(0,jsx_runtime.jsx)("div",{className:className,children:(0,dist.EQ)([propertiesLoading,issueLoading,hasStacktrace]).with([dist.P.any,!0,dist.P.any],()=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"h-14 flex flex-col justify-around",children:[(0,jsx_runtime.jsx)(src.yW,{className:"w-[25%] h-3"}),(0,jsx_runtime.jsx)(src.yW,{className:"w-[50%] h-3"})]}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,jsx_runtime.jsx)(src.$j,{})})]})).with([!0,!1,dist.P.any],()=>(0,jsx_runtime.jsxs)("div",{children:[renderExceptionHeader({type:issue?.name||"Unknown Type",value:issue?.description||"Unknown"}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,jsx_runtime.jsx)(src.$j,{})})]})).with([!1,!1,!0],()=>(0,jsx_runtime.jsx)(StackTraces.v,{showAllFrames:showAllFrames,exceptionList:exceptionList,renderExceptionHeader:renderExceptionHeader,fingerprintRecords:fingerprintRecords,onFrameContextClick:(_,e)=>(0,utils.de)(e)})).with([!1,!1,!1],()=>(0,jsx_runtime.jsxs)("div",{children:[renderExceptionHeader({type:issue?.name||"Unknown",value:issue?.description||"Unknown"}),(0,jsx_runtime.jsx)(EmptyMessage.M,{title:"No stacktrace available",description:"Make sure sdk is setup correctly or contact support if problem persists",buttonText:"Check documentation",buttonTo:"https://posthog.com/docs/error-tracking/installation",size:"small"})]})).otherwise(()=>null)})}function IssueCard(){let{propertiesLoading,firstSeen,properties,sessionId,showStacktrace,showAllFrames,showContext}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r),{setShowStacktrace,setShowAllFrames,setShowContext}=(0,index_esm.useActions)(errorTrackingIssueSceneLogic.r);return(0,jsx_runtime.jsxs)(src.Mi,{hoverEffect:!1,className:"p-0 group cursor-pointer p-2 px-3 relative",onClick:()=>{setShowStacktrace(!showStacktrace)},children:[(0,jsx_runtime.jsxs)(Collapsible,{isExpanded:showStacktrace&&!propertiesLoading,className:"pb-2 flex w-full",minHeight:"calc(var(--spacing) * 13)",children:[(0,jsx_runtime.jsx)(StacktraceDisplay,{className:(0,css_classes.cn)("flex-grow",showContext?"w-2/3":"w-full"),truncateMessage:!showStacktrace}),(0,jsx_runtime.jsx)(ContextDisplay,{className:(0,css_classes.cn)("",showContext?"w-1/3 pl-2":"w-0")})]}),(0,jsx_runtime.jsxs)("div",{className:"absolute top-2 right-3 flex gap-2 items-center",children:[firstSeen&&(0,jsx_runtime.jsx)(TZLabel.w,{className:"text-muted text-xs",time:firstSeen}),(0,jsx_runtime.jsx)(ViewRecordingButton.Z,{sessionId:sessionId,timestamp:properties.timestamp,loading:propertiesLoading,inModal:!0,size:"xsmall",type:"secondary",disabledReason:(0,ViewRecordingButton.k)(properties)?void 0:"No recording available"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)(StacktraceExpander,{}),(0,jsx_runtime.jsxs)(IssueCardActions,{children:[(0,jsx_runtime.jsx)(src.f4,{id:"show-all-frames",label:"Show all frames",checked:showAllFrames,size:"xsmall",bordered:!0,onChange:setShowAllFrames,className:"select-none"}),(0,jsx_runtime.jsx)(src.f4,{id:"show-context",label:"Show context",checked:showContext,size:"xsmall",bordered:!0,onChange:setShowContext,className:"select-none"})]})]})]})}function StacktraceExpander(){let{showStacktrace,propertiesLoading,hasStacktrace}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r);return(0,jsx_runtime.jsx)("span",{className:"flex items-center gap-1 text-muted group-hover:text-brand-red",children:(0,dist.EQ)([propertiesLoading,hasStacktrace]).with([!0,dist.P.any],()=>(0,jsx_runtime.jsxs)("span",{className:"text-muted space-x-2 text-xs",children:[(0,jsx_runtime.jsx)(src.$j,{}),(0,jsx_runtime.jsx)("span",{children:"Loading stacktrace..."})]})).with([!1,!1],()=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{}),"No stacktrace available"]})).with([!1,!0],()=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:"text-xs",children:showStacktrace?"Hide details":"Show details"}),(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronDown,{className:(0,css_classes.cn)("transition-transform duration-300",{"rotate-180":showStacktrace})})]})).otherwise(()=>null)})}function IssueCardActions(_ref){let{children}=_ref;return(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-center gap-1",onClick:e=>e.stopPropagation(),children:children})}var ErrorTrackingSetupPrompt=__webpack_require__("../../frontend/src/scenes/error-tracking/ErrorTrackingSetupPrompt.tsx"),GenericSelect=__webpack_require__("../../frontend/src/scenes/error-tracking/issue/GenericSelect.tsx"),Indicator=__webpack_require__("../../frontend/src/scenes/error-tracking/issue/Indicator.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),SparklineChart=__webpack_require__("../../frontend/src/scenes/error-tracking/components/SparklineChart/SparklineChart.tsx"),ErrorTrackingFilters=__webpack_require__("../../frontend/src/scenes/error-tracking/ErrorTrackingFilters.tsx"),use_sparkline_data=__webpack_require__("../../frontend/src/scenes/error-tracking/hooks/use-sparkline-data.tsx");function useSparklineEvents(){let{firstSeen,lastSeen}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r);return(0,react.useMemo)(()=>{let events=[];return firstSeen&&events.push({id:"first_seen",date:firstSeen.toDate(),color:"var(--brand-blue)",payload:"First Seen",radius:6}),lastSeen&&events.push({id:"last_seen",date:lastSeen.toDate(),color:"var(--brand-red)",payload:"Last Seen",radius:6}),events},[firstSeen,lastSeen])}var use_sparkline_options=__webpack_require__("../../frontend/src/scenes/error-tracking/hooks/use-sparkline-options.tsx");let Metadata=()=>{let{aggregations,summaryLoading}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r),[hoveredDatum,setHoveredDatum]=(0,react.useState)(null),sparklineData=(0,use_sparkline_data.U)(),sparklineEvents=useSparklineEvents(),sparklineOptions=(0,use_sparkline_options.Q)({onDatumMouseEnter:d=>{setHoveredDatum({type:"datum",data:d})},onDatumMouseLeave:()=>{setHoveredDatum(null)},onEventMouseEnter:d=>{setHoveredDatum({type:"event",data:d})},onEventMouseLeave:()=>{setHoveredDatum(null)}},[setHoveredDatum]);return(0,jsx_runtime.jsxs)(src.Mi,{hoverEffect:!1,className:"grid grid-cols-[minmax(180px,min-content)_1fr] grid-rows-[50px_minmax(200px,_1fr)] p-0 overflow-hidden items-center",children:[(0,jsx_runtime.jsx)("div",{className:"h-full flex items-center justify-center p-1 pl-2 border-b w-full gap-2",children:(0,jsx_runtime.jsx)(ErrorTrackingFilters.rQ,{fullWidth:!0,className:"w-full"})}),(0,jsx_runtime.jsxs)("div",{className:"h-full flex items-center justify-center p-1 border-b w-full gap-2",children:[(0,jsx_runtime.jsx)(ErrorTrackingFilters.e_,{}),(0,jsx_runtime.jsx)(ErrorTrackingFilters.Tc,{})]}),(0,jsx_runtime.jsx)("div",{className:"border-r h-full",children:(0,dist.EQ)(hoveredDatum).when(shouldRenderIssueMetrics,()=>(0,jsx_runtime.jsx)(IssueMetrics,{aggregations:aggregations,summaryLoading:summaryLoading})).with({type:"datum"},s=>renderDataPoint(s.data)).with({type:"event"},s=>renderEventPoint(s.data)).otherwise(()=>null)}),(0,jsx_runtime.jsx)("div",{className:"h-full p-1",children:(0,jsx_runtime.jsx)(SparklineChart.P,{data:sparklineData,events:sparklineEvents,options:sparklineOptions,className:"h-full"})})]})};function shouldRenderIssueMetrics(data){return null==data||"datum"==data.type&&0==data.data.value}function IssueMetrics(_ref){let{aggregations,summaryLoading}=_ref,hasSessionCount=aggregations&&0!==aggregations.sessions;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col justify-around items-start h-full p-4",children:[renderMetric("Occurrences",aggregations?.occurrences,summaryLoading),renderMetric("Sessions",aggregations?.sessions,summaryLoading,hasSessionCount?void 0:"No $session_id was set for any event in this issue"),renderMetric("Users",aggregations?.users,summaryLoading)]})}function renderMetric(name,value,loading,tooltip){return(0,jsx_runtime.jsx)("div",{className:"flex items-end gap-2",children:(0,dist.EQ)([loading]).with([!0],()=>(0,jsx_runtime.jsx)(src.yW,{className:"w-[80px] h-2"})).with([!1],()=>(0,jsx_runtime.jsxs)(src.u,{title:tooltip,delayMs:0,placement:"right",children:[(0,jsx_runtime.jsx)("div",{className:"text-2xl font-bold",children:null==value?"0":(0,lib_utils.d$)(value)}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:name})]})).exhaustive()})}function renderDataPoint(d){return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col justify-between items-center h-full p-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col justify-center items-center  flex-grow",children:[(0,jsx_runtime.jsx)("div",{className:"text-3xl font-bold",children:(0,lib_utils.d$)(d.value)}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"Occurrences"})]}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:(0,dayjs.Bv)(d.date).format("D MMM YYYY HH:mm (UTC)")})]})}function renderEventPoint(d){return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col justify-between items-center h-full p-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col justify-center items-center  flex-grow",children:[(0,jsx_runtime.jsx)("div",{className:"text-2xl font-bold whitespace-nowrap",children:(0,dayjs.Bv)(d.date).fromNow()}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:d.payload})]}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted whitespace-nowrap",children:(0,dayjs.Bv)(d.date).format("D MMM YYYY HH:mm (UTC)")})]})}var Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx");let EventsTab=()=>{let{eventsQuery}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r);return(0,jsx_runtime.jsx)(Query.A,{query:eventsQuery,context:{columns:{"recording_button(properties.$session_id)":{title:"Recording",width:"134px"}},showOpenEditorButton:!1,insightProps:{dashboardItemId:"new-ErrorTrackingEventsQuery"}}})},scene={component:ErrorTrackingIssueScene,logic:errorTrackingIssueSceneLogic.r,paramsToProps:_ref=>{let{params:{id},searchParams:{fingerprint}}=_ref;return{id,fingerprint}}},STATUS_LABEL={active:"Active",archived:"Archived",resolved:"Resolved",pending_release:"Pending release",suppressed:"Suppressed"};function ErrorTrackingIssueScene(){let{issue,issueLoading}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r),{loadIssue,updateStatus,updateAssignee}=(0,index_esm.useActions)(errorTrackingIssueSceneLogic.r);return(0,react.useEffect)(()=>{loadIssue()},[loadIssue]),(0,jsx_runtime.jsxs)(ErrorTrackingSetupPrompt.n,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-2",children:[!issueLoading&&issue?.status=="active"&&(0,jsx_runtime.jsx)(AssigneeSelect.i,{assignee:issue?.assignee,onChange:updateAssignee,type:"secondary",showName:!0}),!issueLoading&&(0,jsx_runtime.jsx)(GenericSelect.e,{size:"small",current:issue?.status,values:["active","resolved","suppressed"],placeholder:"Mark as",renderValue:value=>(0,jsx_runtime.jsx)(Indicator.Eg,{status:value,size:"small",withTooltip:!0}),onChange:updateStatus})]})}),(0,jsx_runtime.jsxs)("div",{className:"ErrorTrackingIssue space-y-2",children:[(0,jsx_runtime.jsx)(IssueCard,{}),(0,jsx_runtime.jsx)(Metadata,{}),(0,jsx_runtime.jsx)(src.Mi,{className:"p-0 overflow-hidden",hoverEffect:!1,children:(0,jsx_runtime.jsx)(EventsTab,{})})]})]})}},"../../frontend/src/scenes/error-tracking/components/SparklineChart/SparklineChart.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{P:()=>SparklineChart});var d3__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/d3@7.9.0/node_modules/d3/src/index.js"),lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),use_resize_observer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/use-resize-observer@8.0.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/use-resize-observer/dist/bundle.esm.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SparklineChart(_ref){let{data,events=[],options,className}=_ref,svgRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),{height:contentHeight,width:contentWidth,ref:contentRef}=(0,use_resize_observer__WEBPACK_IMPORTED_MODULE_3__.Z)({box:"content-box"});return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{let svgEl=svgRef.current;if(svgEl&&contentHeight&&contentWidth){let svg=d3__WEBPACK_IMPORTED_MODULE_0__.Ys(svgEl);if(data.length<2)throw Error("Not enough data to render chart");let timeDiff=Math.abs(data[1].date.getTime()-data[0].date.getTime()),extent=d3__WEBPACK_IMPORTED_MODULE_0__.Wem(data.map(d=>d.date)),maxDate=new Date(extent[1]);maxDate.setTime(extent[1].getTime()+timeDiff);let xTicks=d3__WEBPACK_IMPORTED_MODULE_0__.jKP(extent[0],maxDate,8),xScale=d3__WEBPACK_IMPORTED_MODULE_0__.Xf().domain([extent[0],maxDate]).range([0,contentWidth]),maxValue=d3__WEBPACK_IMPORTED_MODULE_0__.Fp7(data.map(d=>d.value))||0,yScale=d3__WEBPACK_IMPORTED_MODULE_0__.BYU().domain([0,maxValue||1]).range([contentHeight,options.eventLabelHeight]),xAxis=d3__WEBPACK_IMPORTED_MODULE_0__.LLu(xScale).tickValues(xTicks).tickSize(0).tickPadding(5);return svg.selectAll("g.datum").data(data).enter().append("g").attr("class","datum").call(buildBarGroup,xScale,yScale,contentHeight,data,options),svg.append("g").attr("transform",`translate(0,${contentHeight})`).style("color",options.axisColor).call(xAxis),svg.selectAll("g.event").data(events||[]).enter().append("g").attr("class","event").call(buildEvent,xScale,options,contentHeight,contentWidth),()=>{svg.selectAll("*").remove()}}},[data,events,options,contentHeight,contentWidth]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{ref:contentRef,className:(0,lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_4__.cn)("h-full w-full p-4 overflow-hidden",className),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("svg",{ref:svgRef,className:"overflow-visible",height:"100%",width:"100%"})})}function buildBarGroup(group,xScale,yScale,contentHeight,data,options){let bandwidth=xScale(data[1].date)-xScale(data[0].date);group.attr("x",d=>xScale(d.date)).on("mouseover",function(_,d){let current=d3__WEBPACK_IMPORTED_MODULE_0__.Ys(this);options.onDatumMouseEnter?.(d),options.hoverBackgroundColor&&current.select(".bar").style("fill",options.hoverBackgroundColor)}).on("mouseout",function(_,d){let current=d3__WEBPACK_IMPORTED_MODULE_0__.Ys(this);options.onDatumMouseLeave?.(d),current.select(".bar").style("fill",options.backgroundColor)}),group.append("rect").attr("class","bar").attr("x",(_,i)=>xScale(data[i].date)).attr("y",d=>yScale(d.value)+options.borderRadius).attr("width",.9*bandwidth).attr("height",d=>d?contentHeight-yScale(d.value):0).style("fill",options.backgroundColor).style("clip-path",`inset(0 0 ${options.borderRadius+1}px 0)`).attr("rx",options.borderRadius).attr("ry",options.borderRadius);let maxValue=Math.max(...yScale.domain());group.append("rect").attr("class","overlay").attr("x",(_,i)=>xScale(data[i].date)).attr("y",yScale(maxValue)).attr("width",bandwidth).attr("height",d=>d?contentHeight-yScale(maxValue)+options.borderRadius:0).style("fill","transparent")}function buildEventLabel(selection,xScale,options,contentWidth){let paddingX=options.eventLabelPaddingX,paddingY=options.eventLabelPaddingY,baseLine=options.eventLabelHeight/2,textNodes=selection.append("text").attr("class","font-semibold").attr("x",d=>xScale(d.date)).attr("y",baseLine).attr("fill","white").attr("text-anchor","middle").attr("dominant-baseline","central").style("font-size","10px").text(d=>d.payload).nodes();selection.insert("rect","text").attr("x",(_,i)=>textNodes[i].getBBox().x-paddingX).attr("y",(_,i)=>textNodes[i].getBBox().y-paddingY).attr("width",(_,i)=>textNodes[i].getBBox().width+2*paddingX).attr("height",(_,i)=>textNodes[i].getBBox().height+2*paddingY).attr("rx",options.borderRadius).attr("ry",options.borderRadius).attr("fill",d=>d.color||"black");let movingNodes=selection.nodes().map((node,index)=>{let bbox=node.getBBox();return{x:bbox.x+bbox.width/2,y:bbox.y+bbox.height/2,radius:bbox.width/2+options.eventMinSpace,id:`moving-${index}`}}),clonedNodes=[...movingNodes.map(node=>({...node}))],simulation=d3__WEBPACK_IMPORTED_MODULE_0__.A4v(movingNodes).velocityDecay(.9).force("collision",d3__WEBPACK_IMPORTED_MODULE_0__.Hh().radius((_,i)=>movingNodes[i].radius)).force("boundaries",forceBoundaries(movingNodes,-10,contentWidth+10));simulation.stop(),simulation.tick(100),movingNodes.forEach((_,index)=>{let newX=movingNodes[index].x,initialX=clonedNodes[index].x,newY=movingNodes[index].y,initialY=clonedNodes[index].y,deltaX=newX-initialX,deltaY=newY-initialY;selection.filter((_,i)=>i===index).attr("transform",`translate(${deltaX}, ${deltaY})`).attr("dx",deltaX).attr("dy",deltaY)})}function buildEventAnchor(selection,xScale,contentHeight){selection.append("circle").attr("cx",d=>xScale(d.date)).attr("cy",contentHeight).attr("r",6).attr("fill","white").attr("stroke",d=>d.color||"black").attr("stroke-width",2)}function buildEvent(selection,xScale,options,contentHeight,contentWidth){selection.append("g").attr("class","label").call(buildEventLabel,xScale,options,contentWidth),selection.call(buildEventLine,xScale,contentHeight,contentWidth),selection.call(buildEventAnchor,xScale,contentHeight),selection.style("cursor",options.onEventClick?"pointer":"default").on("mouseover",function(_,d){options.onEventMouseEnter?.(d)}).on("mouseout",function(_,d){options.onEventMouseLeave?.(d)})}function buildEventLine(selection,xScale,contentHeight,contentWidth){selection.insert("line","g.label").attr("x1",d=>xScale(d.date)).attr("y1",contentHeight).attr("x2",(_,index)=>{let labelNode=selection.selectAll(".label").nodes().find((_,i)=>i===index),dx=parseFloat(labelNode.getAttribute("dx")||"0"),labelBbox=labelNode.getBBox();return labelBbox?.x+dx+labelBbox?.width/2||0}).attr("y2",5).attr("stroke-width",2).attr("stroke",d=>{let xPos=xScale(d.date);return xPos<0||xPos>contentWidth?"transparent":d.color||"black"})}function forceBoundaries(nodes,minX,maxX){return()=>{nodes.forEach(node=>{node.vy=0,node.x+node.radius>maxX?node.vx+=maxX-(node.x+node.radius):node.x-node.radius<minX&&(node.vx+=minX-(node.x-node.radius))})}}},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.3_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/error-tracking/ErrorTracking.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".ErrorTracking__issue{height:calc(100vh - 12rem);min-height:25rem}.ErrorTrackingIssue .SessionRecordingPlayer{height:24rem}.ErrorTrackingIssue .LemonCollapsePanel>.LemonButton:hover:has(.LemonSegmentedButton:hover){background-color:inherit}",""]),module.exports=exports}}]);