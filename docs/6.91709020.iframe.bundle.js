(window.webpackJsonp=window.webpackJsonp||[]).push([[6,7,8,9,307],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(L,l,e){"use strict";e.r(l);var j=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),r=e.n(j),v=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),_=e.n(v),p={};p.insert="head",p.singleton=!1;var P=r()(_.a,p);l.default=_.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(L,l,e){"use strict";e.r(l),e.d(l,"AppMetricsGraph",function(){return U});var j=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),r=e.n(j),v=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),_=e.n(v),p=e("./node_modules/core-js/modules/es.array.concat.js"),P=e.n(p),S=e("./node_modules/core-js/modules/es.object.keys.js"),Y=e.n(S),x=e("./node_modules/core-js/modules/es.symbol.js"),N=e.n(x),C=e("./node_modules/core-js/modules/es.array.filter.js"),y=e.n(C),b=e("./node_modules/core-js/modules/es.object.to-string.js"),f=e.n(b),D=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),g=e.n(D),A=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),T=e.n(A),E=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),G=e.n(E),I=e("./node_modules/react/index.js"),F=e.n(I),O=e("./frontend/src/lib/colors.ts"),H=e("./node_modules/chart.js/dist/chart.mjs"),Z=e("./frontend/src/scenes/apps/constants.tsx"),h=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),$=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),B=e("./frontend/src/lib/utils.tsx");function K(c,u){var s=Object.keys(c);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(c);u&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(c,t).enumerable})),s.push.apply(s,n)}return s}function V(c){for(var u=1;u<arguments.length;u++){var s=arguments[u]!=null?arguments[u]:{};u%2?K(Object(s),!0).forEach(function(n){r()(c,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(s)):K(Object(s)).forEach(function(n){Object.defineProperty(c,n,Object.getOwnPropertyDescriptor(s,n))})}return c}function U(c){var u=c.tab,s=c.metrics,n=c.metricsLoading,t=Object(I.useRef)(null),a=Z.DescriptionColumns[u];return Object(I.useEffect)(function(){var o;if(t.current&&s){var i;o=new H.a((i=t.current)===null||i===void 0?void 0:i.getContext("2d"),{type:"line",data:{labels:s.dates,datasets:[V({label:a.successes,data:s.successes,borderColor:""},d("data-brand-blue"))].concat(_()(a.successes_on_retry?[V({label:a.successes_on_retry,data:s.successes_on_retry},d("data-yellow"))]:[]),[V({label:a.failures,data:s.failures},d("data-pink"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var M;(M=o)===null||M===void 0||M.destroy()}},[s]),n||!s?F.a.createElement(h.a,{className:"AppMetricsGraph"}):F.a.createElement("div",{className:"AppMetricsGraph"},F.a.createElement("canvas",{ref:t}))}function d(c){var u=Object(O.b)(c);return{borderColor:u,hoverBorderColor:Object(B.lb)(u,-20),hoverBackgroundColor:Object(B.lb)(u,-20),backgroundColor:u,fill:!1,borderWidth:2,pointRadius:0}}try{U.displayName="AppMetricsGraph",U.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:U.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(c){}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(L,l,e){"use strict";e.r(l),e.d(l,"MetricsTab",function(){return C}),e.d(l,"MetricsOverview",function(){return y});var j=e("./node_modules/react/index.js"),r=e.n(j),v=e("./node_modules/antd/es/card/index.js"),_=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),p=e("./frontend/src/scenes/apps/constants.tsx"),P=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),S=e("./frontend/src/lib/utils.tsx"),Y=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),x=e("./frontend/src/lib/components/LemonSelect.tsx"),N=e("./node_modules/kea/lib/index.esm.js");function C(f){var D=f.tab,g=Object(N.useValues)(_.appMetricsSceneLogic),A=g.metrics,T=g.metricsLoading,E=g.dateFrom,G=Object(N.useActions)(_.appMetricsSceneLogic),I=G.setDateFrom;return r.a.createElement("div",{className:"mt-4"},r.a.createElement(v.a,{title:r.a.createElement("div",{className:"flex items-center justify-between gap-2"},r.a.createElement("span",null,"Metrics overview"),r.a.createElement(x.a,{value:E,onChange:function(O){return I(O)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]}))},r.a.createElement(y,{tab:D,metrics:A,metricsLoading:T})),r.a.createElement(v.a,{title:"Delivery trends",className:"mt-4"},r.a.createElement(Y.AppMetricsGraph,{tab:D,metrics:A,metricsLoading:T})))}function y(f){var D,g,A,T=f.tab,E=f.metrics,G=f.metricsLoading;return G?r.a.createElement(P.a,{className:"h-20"}):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("div",{className:"card-secondary"},p.DescriptionColumns[T].successes),r.a.createElement("div",null,b(E==null||(D=E.totals)===null||D===void 0?void 0:D.successes))),p.DescriptionColumns[T].successes_on_retry&&r.a.createElement("div",null,r.a.createElement("div",{className:"card-secondary"},p.DescriptionColumns[T].successes_on_retry),r.a.createElement("div",null,b(E==null||(g=E.totals)===null||g===void 0?void 0:g.successes_on_retry))),r.a.createElement("div",null,r.a.createElement("div",{className:"card-secondary"},p.DescriptionColumns[T].failures),r.a.createElement("div",null,b(E==null||(A=E.totals)===null||A===void 0?void 0:A.failures))))}function b(f){return r.a.createElement(r.a.Fragment,null,f&&Object(S.P)(f))}try{C.displayName="MetricsTab",C.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:C.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(f){}try{y.displayName="MetricsOverview",y.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:y.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(f){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(L,l,e){"use strict";e.r(l),e.d(l,"AppMetricsTab",function(){return d}),e.d(l,"appMetricsSceneLogic",function(){return u});var j=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),r=e.n(j),v=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),_=e.n(v),p=e("./node_modules/@babel/runtime/regenerator/index.js"),P=e.n(p),S=e("./node_modules/core-js/modules/es.array.iterator.js"),Y=e.n(S),x=e("./node_modules/core-js/modules/es.object.to-string.js"),N=e.n(x),C=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),y=e.n(C),b=e("./node_modules/core-js/modules/es.array.concat.js"),f=e.n(b),D=e("./node_modules/core-js/modules/es.function.name.js"),g=e.n(D),A=e("./node_modules/core-js/modules/es.array.includes.js"),T=e.n(A),E=e("./node_modules/core-js/modules/es.string.includes.js"),G=e.n(E),I=e("./node_modules/core-js/modules/es.array.filter.js"),F=e.n(I),O=e("./node_modules/kea/lib/index.esm.js"),H=e("./node_modules/kea-loaders/lib/index.js"),Z=e.n(H),h=e("./frontend/src/scenes/urls.ts"),$=e("./frontend/src/lib/api.ts"),B=e("./frontend/src/scenes/teamLogic.tsx"),K=e("./node_modules/kea-router/lib/index.js"),V=e.n(K),U=e("./frontend/src/lib/utils.tsx"),d;(function(s){s.ProcessEvent="processEvent",s.OnEvent="onEvent",s.ExportEvents="exportEvents",s.HistoricalExports="historical_exports"})(d||(d={}));var c=[d.ProcessEvent,d.OnEvent,d.ExportEvents],u=Object(O.kea)([Object(O.path)(function(s){return["scenes","apps","appMetricsSceneLogic",s]}),Object(O.props)({}),Object(O.key)(function(s){return s.pluginConfigId}),Object(O.actions)({setActiveTab:function(n){return{tab:n}},setDateFrom:function(n){return{dateFrom:n}}}),Object(O.reducers)({activeTab:[null,{setActiveTab:function(n,t){var a=t.tab;return a}}],dateFrom:["-30d",{setDateFrom:function(n,t){var a=t.dateFrom;return a}}]}),Object(H.loaders)(function(s){var n=s.values,t=s.props;return{pluginConfig:[null,{loadPluginConfig:function(){var a=_()(P.a.mark(function i(){return P.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,$.b.get("api/projects/".concat(B.a.values.currentTeamId,"/plugin_configs/").concat(t.pluginConfigId));case 2:return m.abrupt("return",m.sent);case 3:case"end":return m.stop()}},i)}));function o(){return a.apply(this,arguments)}return o}()}],metrics:[null,{loadMetrics:function(){var a=_()(P.a.mark(function i(){var M,m,J;return P.a.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return M=Object(U.Eb)({category:n.activeTab,date_from:n.dateFrom}),W.next=3,$.b.get("api/projects/".concat(B.a.values.currentTeamId,"/app_metrics/").concat(t.pluginConfigId,"?").concat(M));case 3:return m=W.sent,J=m.results,W.abrupt("return",J);case 6:case"end":return W.stop()}},i)}));function o(){return a.apply(this,arguments)}return o}()}],historicalExports:[[],{loadHistoricalExports:function(){var a=_()(P.a.mark(function i(){var M,m;return P.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,$.b.get("api/projects/".concat(B.a.values.currentTeamId,"/app_metrics/").concat(t.pluginConfigId,"/historical_exports"));case 2:return M=R.sent,m=M.results,R.abrupt("return",m);case 5:case"end":return R.stop()}},i)}));function o(){return a.apply(this,arguments)}return o}()}]}}),Object(O.selectors)(function(s){var n=s.values;return{breadcrumbs:[function(t){return[t.pluginConfig,function(a,o){return o.pluginConfigId}]},function(t,a){var o;return[{name:"Apps",path:h.a.projectApps()},{name:t==null||(o=t.plugin_info)===null||o===void 0?void 0:o.name,path:h.a.appMetrics(a)}]}],showTab:[function(){return[]},function(){return function(t){var a;if(n.pluginConfigLoading||!n.pluginConfig)return!1;var o=((a=n.pluginConfig.plugin_info.capabilities)===null||a===void 0?void 0:a.methods)||[];return t===d.HistoricalExports?o.includes("exportEvents"):t===d.OnEvent&&o.includes("exportEvents")?!1:o.includes(t)}}]}}),Object(O.listeners)(function(s){var n=s.values,t=s.actions;return{loadPluginConfigSuccess:function(){if(!n.activeTab){var o=c.filter(function(m){return n.showTab(m)}),i=r()(o,1),M=i[0];t.setActiveTab(M)}},setActiveTab:function(o){var i=o.tab;i===d.HistoricalExports?t.loadHistoricalExports():t.loadMetrics()},setDateFrom:function(){t.loadMetrics()}}}),Object(K.actionToUrl)(function(s){var n=s.values,t=s.props;return{setActiveTab:function(){var o;return n.activeTab===d.HistoricalExports?h.a.appHistoricalExports(t.pluginConfigId):h.a.appMetrics(t.pluginConfigId,(o=n.activeTab)!==null&&o!==void 0?o:void 0)}}}),Object(K.urlToAction)(function(s){var n=s.values,t=s.actions;return{"/app/:pluginConfigId/:page":function(o,i){n.pluginConfig||t.loadPluginConfig(),o.page===d.HistoricalExports?t.setActiveTab(d.HistoricalExports):i.tab&&c.includes(i.tab)&&t.setActiveTab(i.tab)}}})])},"./frontend/src/scenes/apps/constants.tsx":function(L,l,e){"use strict";e.r(l),e.d(l,"DescriptionColumns",function(){return p});var j=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),r=e.n(j),v=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),_,p=(_={},r()(_,v.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),r()(_,v.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),r()(_,v.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),r()(_,v.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),_)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(L,l,e){var j=e("./node_modules/css-loader/dist/runtime/api.js");l=j(!1),l.push([L.i,".AppMetricsGraph{height:300px}",""]),L.exports=l}}]);
