(window.webpackJsonp=window.webpackJsonp||[]).push([[298],{"./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx":function(Ke,J,o){"use strict";o.d(J,"a",function(){return G});var Ae=o("./node_modules/core-js/modules/es.array.map.js"),Ce=o.n(Ae),w=o("./node_modules/clsx/dist/clsx.m.js"),W=o("./node_modules/kea/lib/index.esm.js"),oe=o("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),I=o("./frontend/src/lib/components/LemonButton/index.ts"),Se=o("./node_modules/antd/es/popconfirm/index.js"),U=o("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),X=o("./frontend/src/lib/components/LemonRow/index.ts"),$=o("./frontend/src/lib/components/icons.tsx"),Le=o("./frontend/src/lib/components/Spinner/Spinner.tsx"),me=o("./node_modules/kea-forms/lib/index.js"),we=o.n(me),je=o("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),R=o("./frontend/src/lib/forms/Field.tsx"),r=o("./node_modules/react/jsx-runtime.js"),O=o.n(r);function pe(b){var L=b.numberOfResults,y=b.isSearching,P=b.isAddingEntry,M=b.type;return L>0?null:y?Object(r.jsxs)(X.a,{outlined:!0,fullWidth:!0,size:"large",className:"AuthorizedUrlRow",children:["There are no authorized ",M===U.a.RECORDING_DOMAINS?"domains":"URLs"," that match your search."]}):P?null:Object(r.jsx)(X.a,{outlined:!0,fullWidth:!0,size:"large",className:"AuthorizedUrlRow",children:M===U.a.RECORDING_DOMAINS?"No domains are specified, so recordings will be authorized on all domains.":"There are no authorized urls. Add one to get started."})}function Y(b){var L=b.actionId,y=b.type,P=Object(U.c)({actionId:L,type:y}),M=Object(W.useValues)(P),S=M.isProposedUrlSubmitting,A=Object(W.useActions)(P),B=A.cancelProposingUrl;return Object(r.jsxs)(me.Form,{logic:U.c,props:{actionId:L,type:y},formKey:"proposedUrl",enableFormOnSubmit:!0,className:"w-full space-y-2",children:[Object(r.jsx)(R.a,{name:"url",children:Object(r.jsx)(je.a,{autoFocus:!0,placeholder:"Enter a URL or wildcard subdomain (e.g. https://*.posthog.com)","data-attr":"url-input"})}),Object(r.jsxs)("div",{className:"flex justify-end gap-2",children:[Object(r.jsx)(I.a,{type:"secondary",onClick:B,children:"Cancel"}),Object(r.jsx)(I.a,{htmlType:"submit",type:"primary",disabled:S,"data-attr":"url-save",children:"Save"})]})]})}function G(b){var L=b.actionId,y=b.type,P=b.addText,M=P===void 0?"Add":P,S=Object(U.c)({actionId:L,type:y}),A=Object(W.useValues)(S),B=A.urlsKeyed,he=A.suggestionsLoading,Q=A.searchTerm,k=A.launchUrl,C=A.editUrlIndex,se=A.isAddUrlFormVisible,e=A.onlyAllowDomains,N=Object(W.useActions)(S),F=N.addUrl,ae=N.removeUrl,Ee=N.setSearchTerm,Oe=N.newUrl,be=N.setEditUrlIndex;return Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{className:"flex items-center mb-4 gap-2 justify-between",children:[Object(r.jsx)(je.a,{type:"search",placeholder:"Search for authorized ".concat(e?"domains":"URLs"),onChange:Ee,value:Q}),Object(r.jsx)(I.a,{onClick:Oe,type:"secondary",icon:Object(r.jsx)($.IconPlus,{}),"data-attr":"toolbar-add-url",children:M})]}),he?Object(r.jsx)(X.a,{outlined:!0,fullWidth:!0,size:"large",children:Object(r.jsx)(Le.a,{className:"text-xl"})},-1):Object(r.jsxs)("div",{className:"space-y-2",children:[se&&Object(r.jsx)(X.a,{outlined:!0,fullWidth:!0,size:"large",children:Object(r.jsx)(Y,{type:y,actionId:L})}),Object(r.jsx)(pe,{numberOfResults:B.length,isSearching:Q.length>0,isAddingEntry:se,type:y}),B.map(function(E,Z){return Object(r.jsx)("div",{className:Object(w.a)("border rounded flex items-center py-2 px-4 min-h-14"),children:C===Z?Object(r.jsx)(Y,{type:y,actionId:L}):Object(r.jsxs)(r.Fragment,{children:[E.type==="suggestion"&&Object(r.jsx)(oe.a,{type:"highlight",className:"mr-4 uppercase",children:"Suggestion"}),Object(r.jsx)("span",{title:E.url,className:"flex-1 truncate",children:E.url}),Object(r.jsx)("div",{className:"Actions flex space-x-2 shrink-0",children:E.type==="suggestion"?Object(r.jsx)(I.a,{onClick:function(){return F(E.url)},icon:Object(r.jsx)($.IconPlus,{}),"data-attr":"toolbar-apply-suggestion",children:"Apply suggestion"}):Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(I.a,{icon:Object(r.jsx)($.IconOpenInApp,{}),to:k(E.url),targetBlank:!0,tooltip:y===U.a.TOOLBAR_URLS?"Launch toolbar":"Launch url",center:!0,className:"ActionButton","data-attr":"toolbar-open",children:"Launch"}),Object(r.jsx)(I.a,{icon:Object(r.jsx)($.IconEdit,{}),onClick:function(){return be(E.originalIndex)},tooltip:"Edit",center:!0,className:"ActionButton"}),Object(r.jsx)(Se.a,{placement:"topRight",title:Object(r.jsxs)(r.Fragment,{children:["Are you sure you want to remove this authorized"," ",e?"domain":"URL","?"]}),onConfirm:function(){return ae(Z)},children:Object(r.jsx)(I.a,{icon:Object(r.jsx)($.IconDelete,{}),tooltip:"Remove ".concat(e?"domain":"URL"),center:!0,className:"ActionButton"})})]})})]})},Z)})]})]})}try{G.displayName="AuthorizedUrlList",G.__docgenInfo={description:"",displayName:"AuthorizedUrlList",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"TOOLBAR_URLS"'},{value:'"RECORDING_DOMAINS"'}]}},addText:{defaultValue:{value:"Add"},description:"",name:"addText",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx#AuthorizedUrlList"]={docgenInfo:G.__docgenInfo,name:"AuthorizedUrlList",path:"frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx#AuthorizedUrlList"})}catch(b){}},"./frontend/src/scenes/actions/Action.tsx":function(Ke,J,o){"use strict";o.r(J),o.d(J,"scene",function(){return jt}),o.d(J,"Action",function(){return ee});var Ae=o("./node_modules/core-js/modules/es.array.concat.js"),Ce=o("./node_modules/@babel/runtime/helpers/defineProperty.js"),w=o.n(Ce),W=o("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),oe=o.n(W),I=o("./node_modules/core-js/modules/es.function.name.js"),Se=o("./node_modules/core-js/modules/es.array.map.js"),U=o("./node_modules/core-js/modules/es.array.filter.js"),X=o("./node_modules/core-js/modules/es.object.to-string.js"),$=o("./node_modules/core-js/modules/es.object.keys.js"),Le=o("./node_modules/core-js/modules/es.symbol.js"),me=o("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),we=o("./node_modules/core-js/modules/web.dom-collections.for-each.js"),je=o("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),R=o("./frontend/src/lib/utils.tsx"),r=o("./frontend/src/lib/components/Link.tsx"),O=o("./node_modules/kea/lib/index.esm.js"),pe=o("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),Y=o.n(pe),G=o("./node_modules/@babel/runtime/regenerator/index.js"),b=o.n(G),L=o("./node_modules/core-js/modules/es.array.iterator.js"),y=o("./node_modules/core-js/modules/web.dom-collections.iterator.js"),P=o("./node_modules/core-js/modules/es.regexp.exec.js"),M=o("./node_modules/core-js/modules/es.string.split.js"),S=o("./frontend/src/lib/api.ts"),A=o("./frontend/src/models/actionsModel.ts"),B=o("./frontend/src/lib/components/lemonToast.tsx"),he=o("./node_modules/kea-loaders/lib/index.js"),Q=o("./node_modules/kea-forms/lib/index.js"),k=o("./node_modules/kea-router/lib/index.js"),C=o("./frontend/src/scenes/urls.ts"),se=o("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts"),e=o("./node_modules/react/jsx-runtime.js");function N(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function F(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?N(Object(s),!0).forEach(function(a){w()(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):N(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}var ae=Object(O.kea)([Object(O.path)(["scenes","actions","actionEditLogic"]),Object(O.props)({}),Object(O.key)(function(n){return n.id||"new"}),Object(O.actions)({setAction:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:t,options:s}},setCreateNew:function(t){return{createNew:t}},actionAlreadyExists:function(t){return{actionId:t}},deleteAction:!0}),Object(O.connect)({actions:[A.a,["loadActions"],se.c,["loadEventDefinitions"]]}),Object(O.reducers)({createNew:[!1,{setCreateNew:function(t,s){var a=s.createNew;return a}}]}),Object(Q.forms)(function(n){var t=n.actions,s=n.props;return{action:{defaults:F({},s.action),errors:function(i){var u=i.name;return{name:u?null:"You need to set a name"}},submit:function(i){t.saveAction(i)}}}}),Object(he.loaders)(function(n){var t=n.props,s=n.values,a=n.actions;return{actionCount:{loadActionCount:function(){var i=Y()(b.a.mark(function d(){return b.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!t.id){c.next=6;break}return c.next=3,S.b.actions.getCount(t.id);case 3:c.t0=c.sent,c.next=7;break;case 6:c.t0=0;case 7:return c.abrupt("return",c.t0);case 8:case"end":return c.stop()}},d)}));function u(){return i.apply(this,arguments)}return u}()},action:[F({},t.action),{setAction:function(u){var d=u.action,h=u.options.merge;return h?F(F({},s.action),d):d},saveAction:function(){var i=Y()(b.a.mark(function d(h,c){var l,v;return b.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(l=F({},h),l.steps=l.steps?l.steps.filter(function(ue){return ue.event}):[],m.prev=2,!l.id){m.next=9;break}return m.next=6,S.b.actions.update(l.id,l,t.temporaryToken);case 6:l=m.sent,m.next=12;break;case 9:return m.next=11,S.b.actions.create(l,t.temporaryToken);case 11:l=m.sent;case 12:c(),m.next=22;break;case 15:if(m.prev=15,m.t0=m.catch(2),m.t0.code!=="unique"){m.next=21;break}return v=m.t0.detail.split(" ").pop(),B.d.error(Object(e.jsxs)(e.Fragment,{children:["Action with this name already exists."," ",Object(e.jsx)(r.a,{to:C.a.action(v),children:"Click here to edit."})]})),m.abrupt("return",l);case 21:throw m.t0;case 22:return B.d.success("Action saved"),t.onSave(l),a.loadEventDefinitions(null),a.loadActions(),m.abrupt("return",l);case 27:case"end":return m.stop()}},d,null,[[2,15]])}));function u(d,h){return i.apply(this,arguments)}return u}()}]}}),Object(O.listeners)(function(n){var t=n.values,s=n.actions;return{deleteAction:function(){Object(R.x)({endpoint:S.b.actions.determineDeleteEndpoint(),object:t.action,callback:function(){k.router.actions.push(C.a.actions()),s.loadActions()}})}}}),Object(O.afterMount)(function(n){var t=n.actions,s=n.props;s.id?t.loadActionCount():t.setAction({name:"",steps:[{isNew:Object(R.Ib)()}]},{merge:!1})})]),Ee=o("./frontend/src/scenes/actions/Actions.scss"),Oe=o("./frontend/src/scenes/actions/EventName.tsx"),be=o("./node_modules/@babel/runtime/helpers/slicedToArray.js"),E=o.n(be),Z=o("./node_modules/react/index.js"),q=o("./frontend/src/scenes/teamLogic.tsx"),ve=o("./node_modules/antd/es/button/index.js"),We=o("./node_modules/antd/es/modal/index.js"),$e=o("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),Te=o("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts");function re(n){var t,s=n.actionId,a=n.style,i=n.children,u=Object(Z.useState)(!1),d=E()(u,2),h=d[0],c=d[1],l=Object(O.useValues)(q.a),v=l.currentTeam;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(ve.a,{href:Object(Te.b)(v==null||(t=v.app_urls)===null||t===void 0?void 0:t[0],s),style:a,size:"small",onClick:function(m){m.preventDefault(),c(!0)},children:i}),Object(e.jsx)(We.a,{visible:h,title:s?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:Object(e.jsx)(ve.a,{onClick:function(){return c(!1)},children:"Close"}),onCancel:function(){return c(!1)},children:Object(e.jsx)($e.a,{actionId:s,type:Te.a.TOOLBAR_URLS})})]})}try{re.displayName="AppEditorLink",re.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:re.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(n){}var Ye=o("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Ge=o("./frontend/src/lib/components/Tooltip.tsx"),ie=o("./frontend/src/scenes/actions/hints.tsx"),ke=o("./node_modules/antd/es/typography/index.js"),Ie=o("./node_modules/antd/es/col/index.js"),He=o("./node_modules/antd/es/card/index.js"),Je=o("./node_modules/antd/es/space/index.js"),D=o("./node_modules/antd/es/radio/index.js"),Xe=o("./node_modules/@ant-design/icons/es/icons/ExportOutlined.js"),Pe=o("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),Ne=o("./frontend/@posthog/lemon-ui/src/index.ts");function De(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function g(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?De(Object(s),!0).forEach(function(a){w()(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):De(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}var Ue=ke.a.Text,Re="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function ce(n){var t=n.step,s=n.actionId,a=n.isOnlyStep,i=n.index,u=n.identifier,d=n.onDelete,h=n.onChange,c=function(v){h(v)};return Object(e.jsx)(Ie.a,{span:24,md:12,children:Object(e.jsxs)(He.a,{className:"action-step",style:{overflow:"visible"},children:[i>0&&Object(e.jsx)("div",{className:"stateful-badge pos-center-end or",children:"OR"}),Object(e.jsxs)("div",{children:[!a&&Object(e.jsx)("div",{className:"remove-wrapper",children:Object(e.jsx)("button",{type:"button","aria-label":"delete",onClick:d,children:Object(e.jsx)("span",{"aria-hidden":"true",children:"\xD7"})})}),Object(e.jsx)("div",{className:"mb-4",children:Object(e.jsxs)("b",{children:["Match Group #",i+1]})}),Object(e.jsx)(Ze,{step:t,sendStep:c}),Object(e.jsxs)("div",{style:{marginTop:t.event==="$pageview"?20:8,paddingBottom:0},children:[t.event==="$autocapture"&&Object(e.jsx)(Qe,{step:t,sendStep:c,actionId:s}),t.event!=null&&t.event!=="$autocapture"&&t.event!=="$pageview"&&Object(e.jsxs)("div",{style:{marginTop:"2rem"},children:[Object(e.jsx)("label",{children:Object(e.jsx)("b",{children:"Event name: "})}),Object(e.jsx)(Oe.a,{value:t.event,onChange:function(v){return c(g(g({},t),{},{event:v||""}))}}),Object(e.jsx)("br",{}),Object(e.jsxs)("small",{children:[Object(e.jsx)("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer",children:"See documentation"})," ","on how to send custom events in lots of languages."]})]}),t.event==="$pageview"&&Object(e.jsxs)("div",{children:[Object(e.jsx)(_,{step:t,sendStep:c,item:"url",extra_options:Object(e.jsx)(Me,{step:t,sendStep:c}),label:"URL"}),t.url_matching&&t.url_matching in ie.a&&Object(e.jsx)("small",{style:{display:"block",marginTop:-12},children:ie.a[t.url_matching]})]}),t.event&&Object(e.jsxs)("div",{className:"action-property-filters",children:[Object(e.jsx)("h3",{className:"l3",children:"Filters"}),(!t.properties||t.properties.length===0)&&Object(e.jsx)("div",{className:"text-muted",children:"This match group has no additional filters."}),Object(e.jsx)(Ye.a,{propertyFilters:t.properties,pageKey:u,eventNames:t.event?[t.event]:[],onChange:function(v){c(g(g({},t),{},{properties:v}))},showConditionBadge:!0})]})]})]})]})})}function _(n){var t=function(a){return n.sendStep(g(g({},n.step),{},w()({},n.item,a||null)))};return Object(e.jsxs)("div",{className:"mb-4",children:[Object(e.jsxs)("label",{style:{fontWeight:"bold"},children:[n.label," ",n.extra_options]}),n.caption&&Object(e.jsx)("div",{className:"action-step-caption",children:n.caption}),n.item==="selector"?Object(e.jsx)(Ne.LemonTextArea,{onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}):Object(e.jsx)(Ne.LemonInput,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder})]})}function Qe(n){var t=n.step,s=n.actionId,a=n.sendStep,i=function(){return Object(e.jsx)("div",{className:"text-center",children:Object(e.jsx)("span",{className:"stateful-badge and",children:"AND"})})};return Object(e.jsxs)("div",{children:[Object(e.jsxs)("span",{children:[Object(e.jsxs)(re,{actionId:s,style:{margin:"1rem 0"},children:["Select element on site ",Object(e.jsx)(Xe.a,{})]}),Object(e.jsx)("a",{href:"".concat(Re,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8},children:"See documentation."})," "]}),Object(e.jsx)(_,{step:t,sendStep:a,item:"href",label:"Link target equals",caption:Object(e.jsxs)(e.Fragment,{children:["If your element is a link, the location that the link opens (",Object(e.jsx)("code",{children:"href"})," tag)"]})}),Object(e.jsx)(i,{}),Object(e.jsx)(_,{step:t,sendStep:a,item:"text",label:"Text equals",caption:"Text content inside your element"}),Object(e.jsx)(i,{}),Object(e.jsx)(_,{step:t,sendStep:a,item:"selector",label:Object(e.jsxs)(e.Fragment,{children:["HTML selector matches",Object(e.jsx)(Ge.a,{title:"Click here to learn more about supported selectors",children:Object(e.jsx)("a",{href:"".concat(Re,"#matching-selectors"),target:"_blank",rel:"noopener",children:Object(e.jsx)(Pe.a,{style:{marginLeft:4}})})})]}),placeholder:'button[data-attr="my-id"]',caption:Object(e.jsx)(Je.b,{direction:"vertical",children:Object(e.jsxs)(Ue,{style:{color:"var(--muted)"},children:["CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",Object(e.jsx)(Ue,{code:!0,children:'[data-attr="signup"]'})]})})}),Object(e.jsx)("div",{style:{marginBottom:18},children:Object(e.jsx)(i,{})}),Object(e.jsx)(_,{step:t,sendStep:a,item:"url",extra_options:Object(e.jsx)(Me,{step:t,sendStep:a}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(t==null?void 0:t.url_matching)&&t.url_matching in ie.a&&Object(e.jsx)("small",{style:{display:"block",marginTop:-12},children:ie.a[t.url_matching]})]})}function Ze(n){var t=n.step,s=n.sendStep,a=function(u){var d=u.target.value;d==="$autocapture"?s(g(g({},t),{},{event:"$autocapture"})):d==="event"?s(g(g({},t),{},{event:""})):d==="$pageview"&&s(g(g({},t),{},{event:"$pageview",url:t.url}))};return Object(e.jsx)("div",{className:"type-switcher",children:Object(e.jsxs)(D.a.Group,{buttonStyle:"solid",onChange:a,value:t.event==="$autocapture"||t.event==="$pageview"||t.event===void 0?t.event:"event",children:[Object(e.jsx)(D.a.Button,{value:"$autocapture",children:"Autocapture"}),Object(e.jsx)(D.a.Button,{value:"event",children:"Custom event"}),Object(e.jsx)(D.a.Button,{value:"$pageview",children:"Page view"})]})})}function Me(n){var t=n.step,s=n.sendStep,a=function(u){s(g(g({},t),{},{url_matching:u.target.value}))};return Object(e.jsxs)(D.a.Group,{buttonStyle:"solid",onChange:a,value:t.url_matching||"contains",size:"small",children:[Object(e.jsx)(D.a.Button,{value:"contains",children:"contains"}),Object(e.jsx)(D.a.Button,{value:"regex",children:"matches regex"}),Object(e.jsx)(D.a.Button,{value:"exact",children:"matches exactly"})]})}try{ce.displayName="ActionStep",ce.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:ce.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(n){}var qe=o("./node_modules/antd/es/row/index.js"),_e=o("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),et=o("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),tt=o("./frontend/src/lib/components/PageHeader.tsx"),Be=o("./frontend/src/lib/components/EditableField/EditableField.tsx"),nt=o("./frontend/src/types.ts"),ot=o("./frontend/src/scenes/userLogic.ts"),st=o("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),z=o("./frontend/src/lib/forms/Field.tsx"),le=o("./frontend/src/lib/components/LemonButton/index.ts"),at=o("./frontend/src/lib/components/LemonCheckbox/index.ts"),rt=o("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),it=o("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),ct=o("./frontend/src/lib/components/icons.tsx");function Fe(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function lt(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Fe(Object(s),!0).forEach(function(a){w()(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):Fe(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}function de(n){var t=n.action,s=n.id,a=n.onSave,i=n.temporaryToken,u={id:s,action:t,onSave:function(j){return a(j)},temporaryToken:i},d=ae(u),h=Object(O.useValues)(d),c=h.action,l=h.actionLoading,v=h.actionCount,V=h.actionCountLoading,m=Object(O.useActions)(d),ue=m.submitAction,pt=m.deleteAction,ht=Object(O.useValues)(q.a),ge=ht.currentTeam,Ot=Object(O.useValues)(ot.a),bt=Ot.hasAvailableFeature,xe=ge==null?void 0:ge.slack_incoming_webhook,ze=function(){return Object(e.jsx)(le.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",onClick:function(){pt()},children:"Delete"})},Ve=function(){return Object(e.jsx)(le.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",onClick:function(){k.router.actions.push(C.a.actions())},children:"Cancel"})};return Object(e.jsx)("div",{className:"action-edit-container",children:Object(e.jsxs)(Q.Form,{logic:ae,props:u,formKey:"action",enableFormOnSubmit:!0,children:[Object(e.jsx)(tt.a,{title:Object(e.jsx)(z.a,{name:"name",children:function(j){var p=j.value,f=j.onChange;return Object(e.jsx)(Be.a,{name:"name",value:p||"",placeholder:"Name this action",onChange:s?void 0:f,onSave:function(K){f(K),ue()},mode:s?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(s?"edit":"create"),className:"action-name"})}}),caption:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(z.a,{name:"description",children:function(j){var p=j.value,f=j.onChange;return Object(e.jsx)(Be.a,{multiline:!0,name:"description",value:p||"",placeholder:"Description (optional)",onChange:s?void 0:f,onSave:function(K){f(K),ue()},mode:s?void 0:"edit","data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!bt(nt.d.INGESTION_TAXONOMY)})}}),Object(e.jsx)(z.a,{name:"tags",children:function(j){var p=j.value,f=j.onChange;return Object(e.jsx)(st.a,{tags:p!=null?p:[],onChange:function(K,ye){return f(ye)},className:"action-tags",saving:l})}})]}),buttons:Object(e.jsxs)(e.Fragment,{children:[s?Object(e.jsx)(le.a,{type:"secondary",to:Object(k.combineUrl)(C.a.sessionRecordings(),{filters:{actions:[{id:s,type:"actions",order:0,name:c.name}]}}).url,sideIcon:Object(e.jsx)(ct.IconPlayCircle,{}),"data-attr":"action-view-recordings",children:"View recordings"}):null,s?ze():Ve()]})}),s&&Object(e.jsx)("div",{className:"input-set",children:Object(e.jsx)("div",{children:Object(e.jsxs)("span",{className:"text-muted mb-2",children:[V&&Object(e.jsx)(_e.a,{}),v!==null&&v>-1&&Object(e.jsxs)(e.Fragment,{children:["This action matches ",Object(e.jsx)("b",{children:Object(R.p)(v)})," events in the last 3 months"]})]})})}),Object(e.jsxs)("div",{style:{overflow:"visible"},children:[Object(e.jsx)("h2",{className:"subtitle",children:"Match groups"}),Object(e.jsxs)("div",{children:["Your action will be triggered whenever ",Object(e.jsx)("b",{children:"any of your match groups"})," are received."," ",Object(e.jsx)("a",{href:"https://posthog.com/docs/features/actions",target:"_blank",children:Object(e.jsx)(Pe.a,{})})]}),Object(e.jsx)(z.a,{name:"steps",children:function(j){var p=j.onChange;return Object(e.jsx)("div",{style:{textAlign:"right",marginBottom:12},children:Object(e.jsx)(ve.a,{onClick:function(){return p([].concat(oe()(c.steps||[]),[{isNew:Object(R.Ib)()}]))},size:"small",children:"Add another match group"})})}}),Object(e.jsx)(z.a,{name:"steps",children:function(j){var p=j.value,f=j.onChange;return Object(e.jsxs)(qe.a,{gutter:[24,24],children:[Object(e.jsx)(e.Fragment,{children:p.map(function(x,K){var ye=String(JSON.stringify(x));return Object(e.jsx)(ce,{identifier:ye,index:K,step:x,actionId:c.id||0,isOnlyStep:!!p&&p.length===1,onDelete:function(){var te,H=x.id?"id":"isNew";f((te=p==null?void 0:p.filter(function(ne){return ne[H]!==x[H]}))!==null&&te!==void 0?te:[])},onChange:function(te){var H;f((H=p==null?void 0:p.map(function(ne){return x.id&&ne.id==x.id||x.isNew&&ne.isNew===x.isNew?lt({id:x.id,isNew:x.isNew},te):ne}))!==null&&H!==void 0?H:[])}},K)})}),Object(e.jsx)(Ie.a,{span:24,md:12,children:Object(e.jsx)("div",{className:"match-group-add-skeleton",onClick:function(){f([].concat(oe()(c.steps||[]),[{isNew:Object(R.Ib)()}]))},children:Object(e.jsx)(et.a,{style:{fontSize:28,color:"#666666"}})})})]})}})]}),Object(e.jsxs)("div",{className:"my-8",children:[Object(e.jsx)(z.a,{name:"post_to_slack",children:function(j){var p=j.value,f=j.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(at.a,{id:"webhook-checkbox",checked:!!p,onChange:f,disabled:!xe,label:Object(e.jsx)(e.Fragment,{children:"Post to webhook when this action is triggered."})}),Object(e.jsx)("p",{className:"pl-7",children:Object(e.jsxs)(r.a,{to:"/project/settings#webhook",children:[xe?"Configure":"Enable"," this integration in Setup."]})})]})}}),c.post_to_slack&&Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(z.a,{name:"slack_message_format",children:function(j){var p=j.value,f=j.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(it.a,{showOptional:!0,children:"Message format"}),Object(e.jsx)(rt.a,{placeholder:"Default: [action.name] triggered by [person]",value:p,onChange:f,disabled:!xe||!c.post_to_slack,"data-attr":"edit-slack-message-format"}),Object(e.jsx)("small",{children:Object(e.jsx)("a",{href:"https://posthog.com/docs/integrations/message-formatting/",target:"_blank",rel:"noopener noreferrer",children:"See documentation on how to format webhook messages."})})]})}})})]}),Object(e.jsxs)("div",{className:"flex justify-end gap-2",children:[s?ze():Ve(),Object(e.jsx)(le.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:l,children:"Save"})]})]})})}try{de.displayName="ActionEdit",de.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:de.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(n){}var dt=o("./frontend/src/scenes/events/index.ts"),ut=o("./frontend/src/lib/dayjs.ts"),mt=o("./frontend/src/lib/components/Spinner/Spinner.tsx"),fe=Object(O.kea)({props:{},key:function(t){return t.id||"new"},path:function(t){return["scenes","actions","actionLogic",t]},actions:function(){return{checkIsFinished:function(s){return{action:s}},setPollTimeout:function(s){return{pollTimeout:s}},setIsComplete:function(s){return{isComplete:s}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(s,a){var i=a.pollTimeout;return i}}],isComplete:[!1,{setIsComplete:function(s,a){var i=a.isComplete;return i}}]}},selectors:{breadcrumbs:[function(n){return[n.action]},function(n){return[{name:"Data Management",path:C.a.eventDefinitions()},{name:"Actions",path:C.a.actions()},{name:(n==null?void 0:n.name)||"Unnamed",path:n?C.a.action(n.id):void 0}]}]},loaders:function(t){var s=t.actions,a=t.props;return{action:{loadAction:function(){var i=Y()(b.a.mark(function d(){var h;return b.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(s.setIsComplete(!1),a.id){l.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return l.next=5,S.b.actions.get(a.id);case 5:return h=l.sent,s.checkIsFinished(h),l.abrupt("return",h);case 8:case"end":return l.stop()}},d)}));function u(){return i.apply(this,arguments)}return u}()}}},listeners:function(t){var s=t.actions,a=t.values;return{checkIsFinished:function(u){var d=u.action;d.is_calculating?s.setPollTimeout(setTimeout(function(){return s.loadAction()},1e3)):(s.setIsComplete(new Date),a.pollTimeout&&clearTimeout(a.pollTimeout))}}},events:function(t){var s=t.values,a=t.actions,i=t.props;return{afterMount:function(){i.id&&a.loadAction()},beforeUnmount:function(){s.pollTimeout&&clearTimeout(s.pollTimeout)}}}}),jt={logic:fe,component:ee,paramsToProps:function(t){var s=t.params.id;return{id:parseInt(s)}}};function ee(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.id,s={action_id:t},a=Object(O.useActions)(k.router),i=a.push,u=Object(O.useValues)(fe),d=u.action,h=u.isComplete,c=Object(O.useActions)(fe),l=c.loadAction;return Object(e.jsxs)(e.Fragment,{children:[(!t||d)&&Object(e.jsx)(de,{id:t,action:d,onSave:function(V){t||i(C.a.action(V.id)),l()}}),t&&(h?Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("p",{children:["This is the list of ",Object(e.jsx)("strong",{children:"recent"})," events that match this action.",d!=null&&d.last_calculated_at?Object(e.jsxs)(e.Fragment,{children:[" ","Last calculated: ",Object(e.jsx)("b",{children:Object(ut.a)(d.last_calculated_at).fromNow()}),"."]}):""]}),Object(e.jsx)("div",{className:"pt-4 border-t"}),Object(e.jsx)(dt.b,{fixedFilters:s,sceneUrl:C.a.action(t),fetchMonths:3,pageKey:"action-".concat(t,"-").concat(JSON.stringify(s)),showEventFilter:!1})]}):Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsx)(mt.a,{className:"mr-4"}),"Calculating action, please hold on."]})]}))]})}try{ee.displayName="Action",ee.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:ee.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(n){}}}]);
