(window.webpackJsonp=window.webpackJsonp||[]).push([[5,6,8,10,308],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(B,c,e){"use strict";e.r(c);var D=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),f=e.n(D),O=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),p=e.n(O),T={};T.insert="head",T.singleton=!1;var g=f()(p.a,T);c.default=p.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(B,c,e){"use strict";e.r(c),e.d(c,"AppMetricsGraph",function(){return U});var D=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),f=e.n(D),O=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),p=e.n(O),T=e("./node_modules/core-js/modules/es.array.concat.js"),g=e.n(T),G=e("./node_modules/core-js/modules/es.object.keys.js"),F=e.n(G),N=e("./node_modules/core-js/modules/es.symbol.js"),z=e.n(N),V=e("./node_modules/core-js/modules/es.array.filter.js"),a=e.n(V),Y=e("./node_modules/core-js/modules/es.object.to-string.js"),W=e.n(Y),L=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),K=e.n(L),x=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),d=e.n(x),P=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),A=e.n(P),l=e("./node_modules/react/index.js"),b=e.n(l),i=e("./frontend/src/lib/colors.ts"),y=e("./node_modules/chart.js/dist/chart.mjs"),I=e("./frontend/src/scenes/apps/constants.tsx"),E=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),m=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),R=e("./frontend/src/lib/utils.tsx"),C=e("./node_modules/react/jsx-runtime.js"),X=e.n(C);function $(r,n){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);n&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),s.push.apply(s,t)}return s}function v(r){for(var n=1;n<arguments.length;n++){var s=arguments[n]!=null?arguments[n]:{};n%2?$(Object(s),!0).forEach(function(t){f()(r,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):$(Object(s)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(s,t))})}return r}function U(r){var n=r.tab,s=r.metrics,t=r.metricsLoading,o=Object(l.useRef)(null),_=I.DescriptionColumns[n];return Object(l.useEffect)(function(){var j;if(o.current&&s){var u;j=new y.a((u=o.current)===null||u===void 0?void 0:u.getContext("2d"),{type:"line",data:{labels:s.dates,datasets:[v({label:_.successes,data:s.successes,borderColor:""},H("data-brand-blue"))].concat(p()(_.successes_on_retry?[v({label:_.successes_on_retry,data:s.successes_on_retry},H("data-yellow"))]:[]),[v({label:_.failures,data:s.failures},H("data-pink"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var M;(M=j)===null||M===void 0||M.destroy()}},[s]),t||!s?Object(C.jsx)(E.a,{className:"AppMetricsGraph"}):Object(C.jsx)("div",{className:"AppMetricsGraph",children:Object(C.jsx)("canvas",{ref:o})})}function H(r){var n=Object(i.b)(r);return{borderColor:n,hoverBorderColor:Object(R.lb)(n,-20),hoverBackgroundColor:Object(R.lb)(n,-20),backgroundColor:n,fill:!1,borderWidth:2,pointRadius:0}}try{U.displayName="AppMetricsGraph",U.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:U.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(r){}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(B,c,e){"use strict";e.r(c),e.d(c,"MetricsTab",function(){return W}),e.d(c,"MetricsOverview",function(){return L}),e.d(c,"ErrorsOverview",function(){return K});var D=e("./node_modules/antd/es/card/index.js"),f=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),O=e("./frontend/src/scenes/apps/constants.tsx"),p=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),T=e("./frontend/src/lib/utils.tsx"),g=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),G=e("./frontend/src/lib/components/LemonSelect.tsx"),F=e("./node_modules/kea/lib/index.esm.js"),N=e("./frontend/src/lib/components/LemonTable/index.ts"),z=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),V=e("./frontend/src/lib/components/Link.tsx"),a=e("./node_modules/react/jsx-runtime.js"),Y=e.n(a);function W(d){var P=d.tab,A=Object(F.useValues)(f.appMetricsSceneLogic),l=A.appMetricsResponse,b=A.appMetricsResponseLoading,i=A.dateFrom,y=Object(F.useActions)(f.appMetricsSceneLogic),I=y.setDateFrom;return Object(a.jsxs)("div",{className:"mt-4",children:[Object(a.jsx)(D.a,{title:Object(a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[Object(a.jsx)("span",{children:"Metrics overview"}),Object(a.jsx)(G.a,{value:i,onChange:function(m){return I(m)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),children:Object(a.jsx)(L,{tab:P,metrics:l==null?void 0:l.metrics,metricsLoading:b})}),Object(a.jsx)(D.a,{title:"Delivery trends",className:"mt-4",children:Object(a.jsx)(g.AppMetricsGraph,{tab:P,metrics:l==null?void 0:l.metrics,metricsLoading:b})}),Object(a.jsx)(D.a,{title:"Errors",className:"mt-4",children:Object(a.jsx)(K,{category:P,errors:(l==null?void 0:l.errors)||[],loading:b})})]})}function L(d){var P,A,l,b=d.tab,i=d.metrics,y=d.metricsLoading;return y?Object(a.jsx)(p.a,{className:"h-20"}):Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"card-secondary",children:O.DescriptionColumns[b].successes}),Object(a.jsx)("div",{children:x(i==null||(P=i.totals)===null||P===void 0?void 0:P.successes)})]}),O.DescriptionColumns[b].successes_on_retry&&Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"card-secondary",children:O.DescriptionColumns[b].successes_on_retry}),Object(a.jsx)("div",{children:x(i==null||(A=i.totals)===null||A===void 0?void 0:A.successes_on_retry)})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"card-secondary",children:O.DescriptionColumns[b].failures}),Object(a.jsx)("div",{children:x(i==null||(l=i.totals)===null||l===void 0?void 0:l.failures)})]})]})}function K(d){var P=d.errors,A=d.loading,l=d.category,b=d.jobId,i=Object(F.useActions)(f.appMetricsSceneLogic),y=i.openErrorDetailsDrawer;return Object(a.jsx)(N.a,{dataSource:P,loading:A,columns:[{title:"Error type",dataIndex:"error_type",render:function(E,m){return Object(a.jsx)(V.a,{title:"View details",className:"font-semibold",onClick:function(C){C.preventDefault(),y(m.error_type,l,b)},children:m.error_type})},sorter:function(E,m){return E.error_type.localeCompare(m.error_type)}},{title:"Count",dataIndex:"count",align:"right",sorter:function(E,m){return E.count-m.count}},{title:"Last seen",dataIndex:"last_seen",render:function(E){return Object(a.jsx)("div",{className:"whitespace-nowrap text-right",children:Object(a.jsx)(z.b,{time:E})})},align:"right",sorter:function(E,m){return new Date(E.last_seen||0)>new Date(m.last_seen||0)?1:-1}}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0})}function x(d){return Object(a.jsx)(a.Fragment,{children:d&&Object(T.P)(d)})}try{W.displayName="MetricsTab",W.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:W.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(d){}try{L.displayName="MetricsOverview",L.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:L.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(d){}try{K.displayName="ErrorsOverview",K.__docgenInfo={description:"",displayName:"ErrorsOverview",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"AppErrorSummary[]"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},category:{defaultValue:null,description:"",name:"category",required:!0,type:{name:"string"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"]={docgenInfo:K.__docgenInfo,name:"ErrorsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"})}catch(d){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(B,c,e){"use strict";e.r(c),e.d(c,"AppMetricsTab",function(){return v}),e.d(c,"appMetricsSceneLogic",function(){return H});var D=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(D),O=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),p=e.n(O),T=e("./node_modules/@babel/runtime/regenerator/index.js"),g=e.n(T),G=e("./node_modules/core-js/modules/es.array.iterator.js"),F=e.n(G),N=e("./node_modules/core-js/modules/es.object.to-string.js"),z=e.n(N),V=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),a=e.n(V),Y=e("./node_modules/core-js/modules/es.array.concat.js"),W=e.n(Y),L=e("./node_modules/core-js/modules/es.function.name.js"),K=e.n(L),x=e("./node_modules/core-js/modules/es.array.includes.js"),d=e.n(x),P=e("./node_modules/core-js/modules/es.string.includes.js"),A=e.n(P),l=e("./node_modules/core-js/modules/es.array.filter.js"),b=e.n(l),i=e("./node_modules/kea/lib/index.esm.js"),y=e("./node_modules/kea-loaders/lib/index.js"),I=e.n(y),E=e("./frontend/src/scenes/urls.ts"),m=e("./frontend/src/lib/api.ts"),R=e("./frontend/src/scenes/teamLogic.tsx"),C=e("./node_modules/kea-router/lib/index.js"),X=e.n(C),$=e("./frontend/src/lib/utils.tsx"),v;(function(r){r.ProcessEvent="processEvent",r.OnEvent="onEvent",r.ExportEvents="exportEvents",r.HistoricalExports="historical_exports"})(v||(v={}));var U=[v.ProcessEvent,v.OnEvent,v.ExportEvents],H=Object(i.kea)([Object(i.path)(function(r){return["scenes","apps","appMetricsSceneLogic",r]}),Object(i.props)({}),Object(i.key)(function(r){return r.pluginConfigId}),Object(i.actions)({setActiveTab:function(n){return{tab:n}},setDateFrom:function(n){return{dateFrom:n}},openErrorDetailsDrawer:function(n,s,t){return{errorType:n,category:s,jobId:t}},closeErrorDetailsDrawer:!0}),Object(i.reducers)({activeTab:[null,{setActiveTab:function(n,s){var t=s.tab;return t}}],dateFrom:["-30d",{setDateFrom:function(n,s){var t=s.dateFrom;return t}}],errorDetailsDrawerError:[null,{openErrorDetailsDrawer:function(n,s){var t=s.errorType;return t},closeErrorDetailsDrawer:function(){return null}}]}),Object(y.loaders)(function(r){var n=r.values,s=r.props;return{pluginConfig:[null,{loadPluginConfig:function(){var t=p()(g.a.mark(function _(){return g.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,m.b.get("api/projects/".concat(R.a.values.currentTeamId,"/plugin_configs/").concat(s.pluginConfigId));case 2:return u.abrupt("return",u.sent);case 3:case"end":return u.stop()}},_)}));function o(){return t.apply(this,arguments)}return o}()}],appMetricsResponse:[null,{loadMetrics:function(){var t=p()(g.a.mark(function _(){var j;return g.a.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return j=Object($.Eb)({category:n.activeTab,date_from:n.dateFrom}),M.next=3,m.b.get("api/projects/".concat(R.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"?").concat(j));case 3:return M.abrupt("return",M.sent);case 4:case"end":return M.stop()}},_)}));function o(){return t.apply(this,arguments)}return o}()}],historicalExports:[[],{loadHistoricalExports:function(){var t=p()(g.a.mark(function _(){var j,u;return g.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,m.b.get("api/projects/".concat(R.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/historical_exports"));case 2:return j=h.sent,u=j.results,h.abrupt("return",u);case 5:case"end":return h.stop()}},_)}));function o(){return t.apply(this,arguments)}return o}()}],errorDetails:[[],{openErrorDetailsDrawer:function(){var t=p()(g.a.mark(function _(j){var u,M,h,J,Z,Q;return g.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=j.category,M=j.jobId,h=j.errorType,J=Object($.Eb)({category:u,job_id:M,error_type:h}),S.next=4,m.b.get("api/projects/".concat(R.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/error_details?").concat(J));case 4:return Z=S.sent,Q=Z.result,S.abrupt("return",Q);case 7:case"end":return S.stop()}},_)}));function o(_){return t.apply(this,arguments)}return o}()}]}}),Object(i.selectors)(function(r){var n=r.values;return{breadcrumbs:[function(s){return[s.pluginConfig,function(t,o){return o.pluginConfigId}]},function(s,t){var o;return[{name:"Apps",path:E.a.projectApps()},{name:s==null||(o=s.plugin_info)===null||o===void 0?void 0:o.name,path:E.a.appMetrics(t)}]}],showTab:[function(){return[]},function(){return function(s){var t;if(n.pluginConfigLoading||!n.pluginConfig)return!1;var o=((t=n.pluginConfig.plugin_info.capabilities)===null||t===void 0?void 0:t.methods)||[];return s===v.HistoricalExports?o.includes("exportEvents"):s===v.OnEvent&&o.includes("exportEvents")?!1:o.includes(s)}}]}}),Object(i.listeners)(function(r){var n=r.values,s=r.actions;return{loadPluginConfigSuccess:function(){if(!n.activeTab){var o=U.filter(function(u){return n.showTab(u)}),_=f()(o,1),j=_[0];s.setActiveTab(j)}},setActiveTab:function(o){var _=o.tab;_===v.HistoricalExports?s.loadHistoricalExports():s.loadMetrics()},setDateFrom:function(){s.loadMetrics()}}}),Object(C.actionToUrl)(function(r){var n=r.values,s=r.props;return{setActiveTab:function(){var o;return n.activeTab===v.HistoricalExports?E.a.appHistoricalExports(s.pluginConfigId):E.a.appMetrics(s.pluginConfigId,(o=n.activeTab)!==null&&o!==void 0?o:void 0)}}}),Object(C.urlToAction)(function(r){var n=r.values,s=r.actions;return{"/app/:pluginConfigId/:page":function(o,_){n.pluginConfig||s.loadPluginConfig(),o.page===v.HistoricalExports?s.setActiveTab(v.HistoricalExports):_.tab&&U.includes(_.tab)&&s.setActiveTab(_.tab)}}})])},"./frontend/src/scenes/apps/constants.tsx":function(B,c,e){"use strict";e.r(c),e.d(c,"DescriptionColumns",function(){return T});var D=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),f=e.n(D),O=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),p,T=(p={},f()(p,O.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),f()(p,O.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),f()(p,O.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),f()(p,O.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),p)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(B,c,e){var D=e("./node_modules/css-loader/dist/runtime/api.js");c=D(!1),c.push([B.i,".AppMetricsGraph{height:300px}",""]),B.exports=c}}]);
