(window.webpackJsonp=window.webpackJsonp||[]).push([[307],{"./frontend/src/scenes/instance/SystemStatus/index.tsx":function(z,I,r){"use strict";r.r(I),r.d(I,"scene",function(){return et}),r.d(I,"SystemStatus",function(){return me});var F=r("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),ge=r.n(F),ve=r("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss"),q=r.n(ve),Q={};Q.insert="head",Q.singleton=!1;var tt=ge()(q.a,Q),nt=q.a.locals||{},_=r("./node_modules/antd/es/alert/index.js"),L=r("./node_modules/antd/es/tabs/index.js"),g=r("./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),y=r("./node_modules/kea/lib/index.esm.js"),ye=r("./frontend/src/lib/components/PageHeader.tsx"),ee=r("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),C=r("./frontend/src/lib/components/icons.tsx"),st=r("./node_modules/core-js/modules/es.object.keys.js"),at=r("./node_modules/core-js/modules/es.symbol.js"),rt=r("./node_modules/core-js/modules/es.array.filter.js"),ot=r("./node_modules/core-js/modules/es.object.to-string.js"),it=r("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),lt=r("./node_modules/core-js/modules/web.dom-collections.for-each.js"),ct=r("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),he=r("./node_modules/@babel/runtime/helpers/defineProperty.js"),te=r.n(he),dt=r("./node_modules/core-js/modules/es.array.map.js"),ne=r("./frontend/src/lib/components/Link.tsx"),ut=r("./node_modules/core-js/modules/es.array.iterator.js"),ft=r("./node_modules/core-js/modules/es.set.js"),jt=r("./node_modules/core-js/modules/es.string.iterator.js"),mt=r("./node_modules/core-js/modules/web.dom-collections.iterator.js"),bt=r("./node_modules/core-js/modules/es.regexp.to-string.js"),A=r("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),D=r("./frontend/src/lib/utils.tsx"),e=r("./node_modules/react/jsx-runtime.js"),pe=new Set(["last_event_ingested_timestamp"]);function E(t,s){var a=s.key,n=s.value,i=s.value_type,l=s.emptyNullLabel,c=s.isSecret;return n&&c?Object(e.jsx)(A.a,{style:{color:"var(--muted)",backgroundColor:"#fee5b3"},className:"uppercase",icon:c?Object(e.jsx)(C.IconLock,{style:{color:"var(--warning)"}}):void 0,children:"Secret"}):a&&pe.has(a)&&typeof n=="string"?new Date(n).getTime()===new Date("1970-01-01T00:00:00").getTime()?"Never":Object(D.N)(n):i==="bool"||typeof n=="boolean"?Object(e.jsx)(A.a,{type:n?"success":"danger",children:n?"Yes":"No"}):n==null||n===""?Object(e.jsx)(A.a,{className:"uppercase",style:{color:"var(--muted)"},children:l!=null?l:"Unknown"}):i==="int"||typeof n=="number"?n.toLocaleString("en-US"):n.toString()}var p=r("./frontend/@posthog/lemon-ui/src/index.ts");function se(t,s){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);s&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,n)}return a}function Oe(t){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?se(Object(a),!0).forEach(function(n){te()(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):se(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}var ae={async_migrations_ok:"/instance/async_migrations"};function xe(t,s){return Object(e.jsxs)("span",{children:[s.metric," ",ae[s.key]?Object(e.jsx)(ne.a,{to:ae[s.key],children:Object(e.jsx)(C.IconOpenInNew,{style:{verticalAlign:"middle"}})}):null]})}function Se(){var t=Object(y.useValues)(g.b),s=t.overview,a=t.systemStatusLoading;return Object(e.jsx)(p.LemonTable,{className:"system-status-table",rowKey:"metric",dataSource:s,columns:[{title:"Metric",className:"metric-column",render:xe},{title:"Value",render:E}],loading:a,expandable:{expandedRowRender:function(i){var l;return(l=i.subrows)!==null&&l!==void 0&&l.rows.length?Object(e.jsx)(Ce,Oe({},i.subrows)):null},rowExpandable:function(i){var l;return!!((l=i.subrows)!==null&&l!==void 0&&l.rows.length)}}})}function Ce(t){return Object(e.jsx)(p.LemonTable,{dataSource:t.rows,columns:t.columns.map(function(s,a){return{title:s,dataIndex:a}}),embedded:!0})}var Ie=r("./node_modules/@babel/runtime/helpers/objectDestructuringEmpty.js"),Ae=r.n(Ie),Le=r("./node_modules/@babel/runtime/helpers/slicedToArray.js"),Y=r.n(Le),$=r("./node_modules/react/index.js"),U=r("./node_modules/antd/es/collapse/index.js"),Te=r("./node_modules/antd/es/checkbox/index.js"),k=r("./node_modules/antd/es/button/index.js"),Ue=r("./node_modules/antd/es/table/index.js"),H=r("./node_modules/@ant-design/icons/es/icons/ReloadOutlined.js"),Ve=r("./frontend/src/scenes/dashboard/Dashboard.tsx"),Ne=r("./frontend/src/types.ts"),gt=r("./node_modules/core-js/modules/es.object.entries.js");function Me(){var t=Object(y.useValues)(g.b),s=t.analyzeModalOpen,a=t.analyzeQuery,n=t.analyzeQueryResult,i=t.analyzeQueryResultLoading,l=Object(y.useActions)(g.b),c=l.setAnalyzeModalOpen,f=l.setAnalyzeQuery,d=l.runAnalyzeQuery;return Object(e.jsxs)(p.LemonModal,{isOpen:s,title:"Analyze ClickHouse query performance",footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(p.LemonButton,{type:"secondary",onClick:function(){return c(!1)},children:"Cancel"}),Object(e.jsx)(p.LemonButton,{type:"primary",onClick:function(){return void d()},disabled:i,children:"Analyze"})]}),onClose:function(){return c(!1)},width:"80%",children:[Object(e.jsx)(p.LemonTextArea,{placeholder:"SQL query to analyze",onChange:f,value:a,rows:10}),n&&Object(e.jsxs)("div",{className:"mt-2",children:[Object(e.jsx)("h2",{children:"Analysis results"}),Object(e.jsx)("ul",{children:Object.entries(n.timing).map(function(o){var u=Y()(o,2),m=u[0],j=u[1];return Object(e.jsxs)("li",{children:[m,": ",j]},m)})}),Object.entries(n.flamegraphs).map(function(o){var u=Y()(o,2),m=u[0],j=u[1];return Object(e.jsxs)("div",{children:[Object(e.jsxs)("h3",{children:["Flamegraph: ",m]}),Object(e.jsx)("a",{className:"embedded-svg-wrapper",href:"data:image/svg+xml;utf8,".concat(encodeURIComponent(j)),dangerouslySetInnerHTML:{__html:j}})]},m)})]})]})}function Ee(){var t=Object(y.useValues)(g.b),s=t.openSections,a=t.systemStatus,n=t.queries,i=t.queriesLoading,l=t.showAnalyzeQueryButton,c=Object(y.useActions)(g.b),f=c.setOpenSections,d=c.loadQueries,o=Object($.useState)(!1),u=Y()(o,2),m=u[0],j=u[1],v=Object($.useMemo)(function(){var x;return n==null||(x=n.postgres_running)===null||x===void 0?void 0:x.filter(function(h){var M=h.state;return m||M!=="idle"})},[m,n]),b=a==null?void 0:a.internal_metrics.clickhouse,O=function(h){h.stopPropagation(),d()};return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)(U.a,{activeKey:s,onChange:function(h){return f(h)},children:[b?Object(e.jsx)(U.a.Panel,{header:"Dashboards",children:Object(e.jsx)(Ve.Dashboard,{id:b.id.toString(),dashboard:b,placement:Ne.m.InternalMetrics})},"0"):null,Object(e.jsxs)(U.a.Panel,{header:"PostgreSQL - currently running queries",children:[Object(e.jsxs)("div",{className:"mb-4 float-right",children:[Object(e.jsx)(Te.a,{checked:m,onChange:function(h){j(h.target.checked)},children:"Show idle queries"}),Object(e.jsxs)(k.a,{style:{marginLeft:8},onClick:O,children:[Object(e.jsx)(H.a,{})," Reload Queries"]})]}),Object(e.jsx)(W,{queries:v,loading:i})]},"1"),(n==null?void 0:n.clickhouse_running)!=null?Object(e.jsxs)(U.a.Panel,{header:"Clickhouse - currently running queries",children:[Object(e.jsx)("div",{className:"mb-4 float-right",children:Object(e.jsxs)(k.a,{style:{marginLeft:8},onClick:O,children:[Object(e.jsx)(H.a,{})," Reload Queries"]})}),Object(e.jsx)(W,{queries:n==null?void 0:n.clickhouse_running,loading:i,showAnalyze:l})]},"2"):null,(n==null?void 0:n.clickhouse_slow_log)!=null?Object(e.jsxs)(U.a.Panel,{header:"Clickhouse - slow query log (past 6 hours)",children:[Object(e.jsx)("div",{className:"mb-4 float-right",children:Object(e.jsxs)(k.a,{style:{marginLeft:8},onClick:O,children:[Object(e.jsx)(H.a,{})," Reload Queries"]})}),Object(e.jsx)(W,{queries:n==null?void 0:n.clickhouse_slow_log,loading:i,showAnalyze:l})]},"3"):null]}),Object(e.jsx)(Me,{})]})}function W(t){var s=Object(y.useActions)(g.b),a=s.openAnalyzeModalWithQuery,n=[{title:"duration",dataIndex:"duration",key:"duration",sorter:function(l,c){return+l.duration-+c.duration}},{title:"query",dataIndex:"query",render:function(l,c){return Ae()(l),t.showAnalyze?Object(e.jsx)(ne.a,{to:"#",onClick:function(){return a(c.query)},children:c.query}):c.query},key:"query"}];return t.queries&&t.queries.length>0&&Object.keys(t.queries[0]).forEach(function(i){i!=="duration"&&i!=="query"&&n.push({title:i,dataIndex:i,key:i})}),Object(e.jsx)(Ue.a,{dataSource:t.queries||[],columns:n,loading:t.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",bordered:!0,style:{overflowX:"auto",overflowY:"auto"},locale:{emptyText:"No queries found"}})}var G=r("./frontend/src/lib/components/LemonTable/index.ts"),ke=r("./frontend/src/lib/hooks/useKeyboardHotkeys.tsx");function w(t){var s=t.key,a=t.value,n=t.value_type,i=t.onValueChanged,l=t.isSecret;if(n==="bool")return Object(e.jsx)(p.LemonCheckbox,{defaultChecked:!!a,onChange:function(d){return i(s,d)},label:Object(e.jsx)(A.a,{type:a?"success":"danger",className:"uppercase",children:a?"Yes":"No"})});var c=l&&a?"":a;return Object(e.jsx)(p.LemonInput,{defaultValue:c,type:n==="int"?"number":"text",placeholder:l&&a?"Keep existing secret value":void 0,onBlur:function(d){return i(s,d.target.value)}})}try{w.displayName="RenderMetricValueEdit",w.__docgenInfo={description:"",displayName:"RenderMetricValueEdit",props:{onValueChanged:{defaultValue:null,description:"",name:"onValueChanged",required:!0,type:{name:"(key: string, value: any) => void"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string | number | boolean | null"}},value_type:{defaultValue:null,description:"",name:"value_type",required:!1,type:{name:"enum",value:[{value:'"bool"'},{value:'"str"'},{value:'"int"'}]}},emptyNullLabel:{defaultValue:null,description:"",name:"emptyNullLabel",required:!1,type:{name:"string"}},isSecret:{defaultValue:null,description:"",name:"isSecret",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"]={docgenInfo:w.__docgenInfo,name:"RenderMetricValueEdit",path:"frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"})}catch(t){}var vt=r("./node_modules/core-js/modules/es.array.find.js"),yt=r("./node_modules/core-js/modules/es.string.starts-with.js"),ht=r("./node_modules/core-js/modules/es.array.includes.js"),pt=r("./node_modules/core-js/modules/es.string.includes.js"),re=r("./frontend/src/lib/components/AlertMessage/index.ts");function we(t){var s=t.metricKey,a=t.oldValue,n=t.value,i=t.isSecret;return(n==null?void 0:n.toString())===(a==null?void 0:a.toString())?null:Object(e.jsxs)("div",{className:"bg-border-light radius p-2",children:[Object(e.jsx)("div",{children:Object(e.jsx)("code",{children:s})}),Object(e.jsxs)("div",{className:"text-muted",children:["Value will be changed",!i&&Object(e.jsxs)(e.Fragment,{children:[" from ",Object(e.jsx)("span",{className:"font-bold text-default",children:E(null,{key:s,value:a,emptyNullLabel:"Unset",isSecret:i})})]})," to ",Object(e.jsx)("span",{className:"font-bold text-default",children:E(null,{key:s,value:n,emptyNullLabel:"Unset"})}),i&&Object(e.jsx)("div",{className:"text-danger",children:"This field is secret - you won't see its value once saved"})]})]})}function P(t){var s=t.onClose,a=t.isOpen,n=Object(y.useValues)(g.b),i=n.instanceConfigEditingState,l=n.editableInstanceSettings,c=n.updatedInstanceConfigCount,f=Object(y.useActions)(g.b),d=f.saveInstanceConfig,o=c!==null;return Object(e.jsx)(p.LemonModal,{title:"Confirm new changes",isOpen:a,closable:!o,onClose:s,footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(p.LemonButton,{type:"secondary",onClick:s,loading:o,children:"Cancel"}),Object(e.jsx)(p.LemonButton,{type:"primary",status:"danger",loading:o,onClick:d,children:"Apply changes"})]}),children:Object(e.jsxs)("div",{className:"space-y-2",children:[Object.keys(i).find(function(u){return u.startsWith("EMAIL")})&&Object(e.jsx)(re.a,{type:"info",children:Object(e.jsxs)(e.Fragment,{children:["As you are changing email settings, we'll attempt to send a ",Object(e.jsx)("b",{children:"test email"})," so you can verify everything works (unless you are turning email off)."]})}),Object.keys(i).includes("RECORDINGS_TTL_WEEKS")&&Object(e.jsx)(re.a,{type:"warning",children:Object(e.jsx)(e.Fragment,{children:"Changing your recordings TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately."})}),Object(e.jsx)("div",{children:"The following changes will be immediately applied to your instance."}),Object.keys(i).map(function(u){var m,j;return Object(e.jsx)(we,{metricKey:u,value:i[u],oldValue:(m=l.find(function(v){return v.key===u}))===null||m===void 0?void 0:m.value,isSecret:(j=l.find(function(v){return v.key===u}))===null||j===void 0?void 0:j.is_secret},u)}),o&&Object(e.jsx)("div",{className:"mt-4 text-success",children:Object(e.jsxs)("b",{children:[Object(D.sb)(c||0,"change")," updated successfully."]})})]})})}try{P.displayName="InstanceConfigSaveModal",P.__docgenInfo={description:"",displayName:"InstanceConfigSaveModal",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"]={docgenInfo:P.__docgenInfo,name:"InstanceConfigSaveModal",path:"frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"})}catch(t){}function oe(t,s){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);s&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,n)}return a}function ie(t){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?oe(Object(a),!0).forEach(function(n){te()(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):oe(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}function Pe(){var t=Object(y.useValues)(ee.a),s=t.configOptions,a=t.preflightLoading,n=Object(y.useValues)(g.b),i=n.editableInstanceSettings,l=n.instanceSettingsLoading,c=n.instanceConfigMode,f=n.instanceConfigEditingState,d=Object(y.useActions)(g.b),o=d.loadInstanceSettings,u=d.setInstanceConfigMode,m=d.updateInstanceConfigValue,j=d.clearInstanceConfigEditing;Object(ke.a)({e:{action:function(){return u(g.a.Edit)},disabled:c!==g.a.View||l},escape:{action:function(){return b()},disabled:c!==g.a.Edit||l},enter:{action:function(){return v()},disabled:c!==g.a.Edit||l}});var v=function(){Object.keys(f).length?u(g.a.Saving):u(g.a.View)},b=function(){u(g.a.View),j()};Object($.useEffect)(function(){o()},[]);var O=[{title:"Key",dataIndex:"key",render:function(M){return Object(e.jsx)("code",{children:M})}},{title:"Description",dataIndex:"description"},{title:"Value",render:function(M,T){var Z,be={value:T.value,key:T.key,emptyNullLabel:"Unset",value_type:T.value_type,isSecret:T.is_secret};return c===g.a.View?E(M,be):w(ie(ie({},be),{},{value:(Z=f[T.key])!==null&&Z!==void 0?Z:T.value,onValueChanged:m}))}}],x=[{key:"metric",title:"Metric",dataIndex:"metric"},{title:"Value",dataIndex:"value"}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[Object(e.jsxs)("div",{className:"flex-1",children:[Object(e.jsx)("h3",{children:"Instance configuration"}),Object(e.jsxs)("div",{children:["Changing these settings will take effect on your entire instance."," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings",target:"_blank",children:["Learn more ",Object(e.jsx)(C.IconOpenInNew,{style:{verticalAlign:"middle"}})]}),"."]})]}),c===g.a.View?Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(p.LemonButton,{type:"primary",onClick:function(){return u(g.a.Edit)},"data-attr":"instance-config-edit-button",disabled:l,children:"Edit"})}):Object(e.jsxs)(e.Fragment,{children:[Object.keys(f).length>0&&Object(e.jsxs)("span",{className:"text-warning-dark flex items-center gap-2",children:[Object(e.jsx)(C.IconWarning,{className:"text-lg"})," You have"," ",Object(e.jsx)("b",{children:Object.keys(f).length})," unapplied"," ",Object(D.sb)(Object.keys(f).length,"change",void 0,!1)]}),Object(e.jsx)(p.LemonButton,{type:"secondary",disabled:l,onClick:b,children:"Discard changes"}),Object(e.jsx)(p.LemonButton,{type:"primary",disabled:l,onClick:v,children:"Save"})]})]}),Object(e.jsx)(G.a,{dataSource:i,columns:O,loading:l,rowKey:"key"}),Object(e.jsxs)("div",{className:"my-4",children:[Object(e.jsx)("h3",{children:"Environment configuration"}),Object(e.jsxs)("div",{children:["These settings can only be modified by environment variables."," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/environment-variables",target:"_blank",children:["Learn more ",Object(e.jsx)(C.IconOpenInNew,{style:{verticalAlign:"middle"}})]}),"."]})]}),Object(e.jsx)(G.a,{dataSource:s,columns:x,loading:a,rowKey:"key"}),Object(e.jsx)(P,{isOpen:c===g.a.Saving,onClose:function(){return u(g.a.Edit)}})]})}var R=r("./frontend/src/scenes/userLogic.ts"),Re=r("./node_modules/antd/es/modal/index.js"),le=r("./node_modules/antd/es/divider/index.js"),Ke=r("./frontend/src/lib/components/ProfilePicture/index.ts"),Be=r("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),J=r.n(Be),ze=r("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),V=r.n(ze),Fe=r("./node_modules/@babel/runtime/regenerator/index.js"),S=r.n(Fe),Ot=r("./node_modules/core-js/modules/es.promise.js"),xt=r("./node_modules/core-js/modules/es.array.concat.js"),St=r("./node_modules/core-js/modules/es.array.sort.js"),Ct=r("./node_modules/core-js/modules/es.array.slice.js"),It=r("./node_modules/core-js/modules/es.function.name.js"),At=r("./node_modules/core-js/modules/es.array.from.js"),Lt=r("./node_modules/core-js/modules/es.regexp.exec.js"),Tt=r("./node_modules/core-js/modules/es.symbol.description.js"),Ut=r("./node_modules/core-js/modules/es.symbol.iterator.js"),Qe=r("./node_modules/kea-router/lib/index.js"),K=r("./frontend/src/lib/api.ts"),De=r("./frontend/src/scenes/urls.ts");function Ye(t,s){var a=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=$e(t))||s&&t&&typeof t.length=="number"){a&&(t=a);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(o){throw o},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,c=!1,f;return{s:function(){a=a.call(t)},n:function(){var o=a.next();return l=o.done,o},e:function(o){c=!0,f=o},f:function(){try{!l&&a.return!=null&&a.return()}finally{if(c)throw f}}}}function $e(t,s){if(!!t){if(typeof t=="string")return ce(t,s);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor&&(a=t.constructor.name),a==="Map"||a==="Set")return Array.from(t);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ce(t,s)}}function ce(t,s){(s==null||s>t.length)&&(s=t.length);for(var a=0,n=new Array(s);a<s;a++)n[a]=t[a];return n}var de=Object(y.kea)({path:["scenes","instance","SystemStatus","staffUsersLogic"],connect:{values:[R.a,["user"]],actions:[R.a,["loadUser"]]},actions:{setStaffUsersToBeAdded:function(s){return{userUuids:s}},addStaffUsers:!0,deleteStaffUser:function(s){return{userUuid:s}}},reducers:{staffUsersToBeAdded:[[],{setStaffUsersToBeAdded:function(s,a){var n=a.userUuids;return n}}]},loaders:function(s){var a=s.actions,n=s.values;return{allUsers:[[],{loadAllUsers:function(){var i=V()(S.a.mark(function c(){var f;return S.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,K.b.get("api/users");case 2:if(o.t1=f=o.sent.results,o.t0=o.t1!==null,!o.t0){o.next=6;break}o.t0=f!==void 0;case 6:if(!o.t0){o.next=10;break}o.t2=f,o.next=11;break;case 10:o.t2=[];case 11:return o.abrupt("return",o.t2);case 12:case"end":return o.stop()}},c)}));function l(){return i.apply(this,arguments)}return l}(),addStaffUsers:function(){var i=V()(S.a.mark(function c(){var f,d,o,u;return S.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return f=n.staffUsersToBeAdded,d=n.allUsers,a.setStaffUsersToBeAdded([]),j.next=4,Promise.all(f.map(function(){var v=V()(S.a.mark(function b(O){return S.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,K.b.update("api/users/".concat(O),{is_staff:!0});case 2:return h.abrupt("return",h.sent);case 3:case"end":return h.stop()}},b)}));return function(b){return v.apply(this,arguments)}}()));case 4:return o=j.sent,u=[].concat(J()(d.filter(function(v){var b=v.uuid;return!f.includes(b)})),J()(o)),u.sort(function(v,b){return v.first_name.localeCompare(b.first_name)}),j.abrupt("return",u);case 8:case"end":return j.stop()}},c)}));function l(){return i.apply(this,arguments)}return l}(),deleteStaffUser:function(){var i=V()(S.a.mark(function c(f){var d,o,u,m,j,v;return S.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return o=f.userUuid,O.next=3,K.b.update("api/users/".concat(o),{is_staff:!1});case 3:((d=n.user)===null||d===void 0?void 0:d.uuid)===o&&(a.loadUser(),Qe.router.actions.push(De.a.projectHomepage())),u=J()(n.allUsers),m=Ye(u);try{for(m.s();!(j=m.n()).done;)v=j.value,v.uuid===o&&(v.is_staff=!1)}catch(x){m.e(x)}finally{m.f()}return O.abrupt("return",u);case 8:case"end":return O.stop()}},c)}));function l(c){return i.apply(this,arguments)}return l}()}]}},selectors:{staffUsers:[function(t){return[t.allUsers]},function(t){return t.filter(function(s){return s.is_staff})}],nonStaffUsers:[function(t){return[t.allUsers]},function(t){return t.filter(function(s){return!s.is_staff})}]},events:function(s){var a=s.actions;return{afterMount:[a.loadAllUsers]}}}),ue=r("./frontend/src/lib/components/LemonButton/index.ts"),He=r("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),We=r("./frontend/src/lib/components/UserSelectItem.tsx");function Ge(){var t=Object(y.useValues)(R.a),s=t.user,a=Object(y.useValues)(de),n=a.staffUsers,i=a.allUsersLoading,l=a.nonStaffUsers,c=a.staffUsersToBeAdded,f=Object(y.useActions)(de),d=f.setStaffUsersToBeAdded,o=f.addStaffUsers,u=f.deleteStaffUser,m=[{key:"profile_picture",render:function(v,b){return Object(e.jsx)(Ke.b,{name:b.first_name,email:b.email})},width:32},{key:"name",title:"Name",dataIndex:"first_name",render:function(v,b){return Object(e.jsxs)(e.Fragment,{children:[b.first_name,b.uuid===(s==null?void 0:s.uuid)&&Object(e.jsx)(A.a,{className:"uppercase ml-1",children:"Me"})]})}},{key:"email",title:"Email",dataIndex:"email"},{key:"actions",width:32,render:function(v,b){return Object(e.jsx)(ue.a,{"data-attr":"invite-delete",icon:Object(e.jsx)(C.IconDelete,{}),status:"danger",disabled:n.length<2,title:n.length<2?"You should always have at least one staff user.":"Cancel the invite",onClick:function(){Re.a.confirm({title:"Remove ".concat((s==null?void 0:s.uuid)===b.uuid?"yourself":b.first_name," as a Staff User?"),icon:null,okText:"Remove user",okType:"primary",okButtonProps:{className:"btn-danger"},content:Object(e.jsx)("div",{style:{border:""},children:(s==null?void 0:s.uuid)===b.uuid?Object(e.jsxs)(e.Fragment,{children:["Please confirm you want to ",Object(e.jsx)("b",{children:"remove yourself"})," as a staff user.",Object(e.jsx)("div",{style:{fontWeight:"normal",color:"var(--muted-alt)"},children:"Only another staff user will be able to add you again."})]}):"Are you sure you want to remove ".concat(b.first_name," as a Staff User?")}),onOk:function(){u(b.uuid)},cancelText:"Cancel"})}})}}];return Object(e.jsxs)("div",{children:[Object(e.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Staff Users"}),Object(e.jsxs)("div",{className:"mb-4",children:["Users who have permissions to manage instance-wide settings. Staff user permissions are set at the"," ",Object(e.jsx)("b",{children:"instance-level and are independent of any organization or project permissions."})," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings#staff-users",target:"_blank",children:["Learn more ",Object(e.jsx)(C.IconOpenInNew,{style:{verticalAlign:"middle"}})]}),"."]}),Object(e.jsx)(le.a,{style:{margin:0,marginBottom:16}}),Object(e.jsx)("section",{children:Object(e.jsxs)("div",{className:"flex gap-2 mb-4",children:[Object(e.jsx)("div",{style:{flex:1},children:Object(e.jsx)(He.a,{placeholder:"Add staff users here\u2026",loading:i,value:c,onChange:function(v){return d(v)},filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:Object(We.a)(l,"uuid")})}),Object(e.jsx)(ue.a,{type:"primary",loading:i,disabled:c.length===0,onClick:o,children:"Add"})]})}),Object(e.jsx)(G.a,{dataSource:n,columns:m,loading:i,rowKey:"uuid"})]})}var Je=r("./frontend/src/lib/logic/featureFlagLogic.ts"),Xe=r("./frontend/src/lib/constants.tsx"),Ze=r("./node_modules/antd/es/row/index.js"),B=r("./node_modules/antd/es/col/index.js"),fe=r("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),Vt=r("./node_modules/core-js/modules/es.number.constructor.js"),N=r("./node_modules/kea-forms/lib/index.js"),qe=r("./node_modules/kea-loaders/lib/index.js"),je=Object(y.kea)([Object(y.path)(["scenes","instance","SystemStatus","kafkaInspectorLogic"]),Object(y.actions)({fetchKafkaMessage:function(s,a,n){return{topic:s,partition:a,offset:n}}}),Object(qe.loaders)({kafkaMessage:[null,{fetchKafkaMessage:function(){var t=V()(S.a.mark(function a(n){var i,l,c;return S.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return i=n.topic,l=n.partition,c=n.offset,d.next=3,K.b.create("api/kafka_inspector/fetch_message",{topic:i,partition:l,offset:c});case 3:return d.abrupt("return",d.sent);case 4:case"end":return d.stop()}},a)}));function s(a){return t.apply(this,arguments)}return s}()}]}),Object(N.forms)(function(t){var s=t.actions;return{fetchKafkaMessage:{defaults:{topic:"clickhouse_events_json",partition:0,offset:0},submit:function(n){var i=n.topic,l=n.partition,c=n.offset;s.fetchKafkaMessage(i,Number(l),Number(c))}}}})]),X=r("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function _e(){var t=Object(y.useValues)(je),s=t.kafkaMessage;return Object(e.jsxs)("div",{children:[Object(e.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Kafka Inspector"}),Object(e.jsx)("div",{className:"mb-4",children:"Debug Kafka messages using the inspector tool."}),Object(e.jsx)(le.a,{style:{margin:0,marginBottom:16}}),Object(e.jsx)("section",{children:Object(e.jsx)("div",{style:{display:"flex",marginBottom:"0.75rem"},children:Object(e.jsx)(N.Form,{logic:je,formKey:"fetchKafkaMessage",className:"ant-form-horizontal ant-form-hide-required-mark",enableFormOnSubmit:!0,children:Object(e.jsxs)(Ze.a,{gutter:[24,24],children:[Object(e.jsx)(B.a,{span:8,children:Object(e.jsx)(N.Field,{name:"topic",children:Object(e.jsx)(X.a,{placeholder:"Topic"})})}),Object(e.jsxs)(B.a,{span:4,children:[Object(e.jsx)(N.Field,{name:"partition",children:Object(e.jsx)(X.a,{placeholder:"Partition",type:"number"})})," "]}),Object(e.jsxs)(B.a,{span:4,children:[Object(e.jsx)(N.Field,{name:"offset",children:Object(e.jsx)(X.a,{placeholder:"Offset",type:"number"})})," "]}),Object(e.jsx)(B.a,{span:6,children:Object(e.jsxs)(k.a,{htmlType:"submit",type:"primary","data-attr":"fetch-kafka-message-submit-button",children:["Fetch message"," "]})})]})})})}),Object(e.jsx)(fe.a,{language:fe.b.JSON,children:s?JSON.stringify(s,null,4):`
`})]})}var et={component:me,logic:g.b};function me(){var t=Object(y.useValues)(g.b),s=t.tab,a=t.error,n=Object(y.useActions)(g.b),i=n.setTab,l=Object(y.useValues)(ee.a),c=l.preflight,f=l.siteUrlMisconfigured,d=Object(y.useValues)(R.a),o=d.user,u=Object(y.useValues)(Je.a),m=u.featureFlags;return Object(e.jsxs)("div",{className:"system-status-scene",children:[Object(e.jsx)(ye.a,{title:"Instance status & settings",caption:Object(e.jsxs)(e.Fragment,{children:["Here you can find all the critical runtime details and settings of your PostHog instance. You have access to this because you're a ",Object(e.jsx)("b",{children:"staff user"}),"."," ",Object(e.jsxs)("a",{target:"_blank",style:{display:"inline-flex",alignItems:"center"},href:"https://posthog.com/docs/self-host/configure/instance-settings?utm_medium=in-product&utm_campaign=instance_status",children:["Learn more ",Object(e.jsx)(C.IconOpenInNew,{style:{marginLeft:4}})]}),"."]})}),a&&Object(e.jsx)(_.a,{message:"Something went wrong",description:a||Object(e.jsx)("span",{children:"An unknown error occurred. Please try again or contact us."}),type:"error",showIcon:!0}),f&&Object(e.jsx)(_.a,{message:"Misconfiguration detected",description:Object(e.jsxs)(e.Fragment,{children:["Your ",Object(e.jsx)("code",{children:"SITE_URL"})," environment variable seems misconfigured. Your"," ",Object(e.jsx)("code",{children:"SITE_URL"})," is set to"," ",Object(e.jsx)("b",{children:Object(e.jsx)("code",{children:c==null?void 0:c.site_url})})," ","but you're currently browsing this page from"," ",Object(e.jsx)("b",{children:Object(e.jsx)("code",{children:window.location.origin})}),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."," ",Object(e.jsxs)("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig",children:["Learn more ",Object(e.jsx)(C.IconOpenInNew,{})]})]}),showIcon:!0,type:"warning",style:{marginBottom:32}}),Object(e.jsxs)(L.a,{tabPosition:"top",animated:!1,activeKey:s,onTabClick:function(v){return i(v)},children:[Object(e.jsx)(L.a.TabPane,{tab:"System overview",children:Object(e.jsx)(Se,{})},"overview"),(o==null?void 0:o.is_staff)&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(L.a.TabPane,{tab:"Internal metrics",children:Object(e.jsx)(Ee,{})},"metrics"),Object(e.jsx)(L.a.TabPane,{tab:Object(e.jsxs)(e.Fragment,{children:["Settings"," ",Object(e.jsx)(A.a,{type:"warning",className:"uppercase",children:"Beta"})]}),children:Object(e.jsx)(Pe,{})},"settings")]}),(o==null?void 0:o.is_staff)&&Object(e.jsx)(L.a.TabPane,{tab:Object(e.jsx)(e.Fragment,{children:"Staff Users"}),children:Object(e.jsx)(Ge,{})},"staff_users"),(o==null?void 0:o.is_staff)&&m[Xe.h.KAFKA_INSPECTOR]&&Object(e.jsx)(L.a.TabPane,{tab:Object(e.jsxs)(e.Fragment,{children:["Kafka Inspector"," ",Object(e.jsx)(A.a,{type:"warning",className:"uppercase",children:"Beta"})]}),children:Object(e.jsx)(_e,{})},"kafka_inspector")]})]})}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss":function(z,I,r){var F=r("./node_modules/css-loader/dist/runtime/api.js");I=F(!1),I.push([z.i,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}.embedded-svg-wrapper{cursor:text}.embedded-svg-wrapper svg{width:100%;height:100%}",""]),z.exports=I}}]);
