(window.webpackJsonp=window.webpackJsonp||[]).push([[5,6,8,10,308],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(x,c,e){"use strict";e.r(c);var P=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),M=e.n(P),j=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),d=e.n(j),C={};C.insert="head",C.singleton=!1;var b=M()(d.a,C);c.default=d.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(x,c,e){"use strict";e.r(c),e.d(c,"AppMetricsGraph",function(){return S});var P=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),M=e.n(P),j=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),d=e.n(j),C=e("./node_modules/core-js/modules/es.array.concat.js"),b=e.n(C),V=e("./node_modules/core-js/modules/es.object.keys.js"),$=e.n(V),H=e("./node_modules/core-js/modules/es.symbol.js"),Q=e.n(H),Y=e("./node_modules/core-js/modules/es.array.filter.js"),o=e.n(Y),J=e("./node_modules/core-js/modules/es.object.to-string.js"),G=e.n(J),h=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),U=e.n(h),W=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),_=e.n(W),g=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),y=e.n(g),l=e("./node_modules/react/index.js"),T=e.n(l),E=e("./frontend/src/lib/colors.ts"),B=e("./node_modules/chart.js/dist/chart.mjs"),m=e("./frontend/src/scenes/apps/constants.tsx"),D=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),A=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),K=e("./frontend/src/lib/utils.tsx"),L=e("./node_modules/react/jsx-runtime.js"),z=e.n(L);function N(u,O){var s=Object.keys(u);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(u);O&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),s.push.apply(s,t)}return s}function Z(u){for(var O=1;O<arguments.length;O++){var s=arguments[O]!=null?arguments[O]:{};O%2?N(Object(s),!0).forEach(function(t){M()(u,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(s)):N(Object(s)).forEach(function(t){Object.defineProperty(u,t,Object.getOwnPropertyDescriptor(s,t))})}return u}function S(u){var O=u.tab,s=u.metrics,t=u.metricsLoading,r=Object(l.useRef)(null),n=m.DescriptionColumns[O];return Object(l.useEffect)(function(){var a;if(r.current&&s){var p;a=new B.a((p=r.current)===null||p===void 0?void 0:p.getContext("2d"),{type:"line",data:{labels:s.dates,datasets:[Z({label:n.successes,data:s.successes,borderColor:""},v("data-brand-blue"))].concat(d()(n.successes_on_retry?[Z({label:n.successes_on_retry,data:s.successes_on_retry},v("data-yellow"))]:[]),[Z({label:n.failures,data:s.failures},v("data-pink"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var i;(i=a)===null||i===void 0||i.destroy()}},[s]),t||!s?Object(L.jsx)(D.a,{className:"AppMetricsGraph"}):Object(L.jsx)("div",{className:"AppMetricsGraph",children:Object(L.jsx)("canvas",{ref:r})})}function v(u){var O=Object(E.b)(u);return{borderColor:O,hoverBorderColor:Object(K.lb)(O,-20),hoverBackgroundColor:Object(K.lb)(O,-20),backgroundColor:O,fill:!1,borderWidth:2,pointRadius:0}}try{S.displayName="AppMetricsGraph",S.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:S.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(u){}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(x,c,e){"use strict";e.r(c),e.d(c,"MetricsTab",function(){return G}),e.d(c,"MetricsOverview",function(){return h}),e.d(c,"ErrorsOverview",function(){return U});var P=e("./node_modules/antd/es/card/index.js"),M=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),j=e("./frontend/src/scenes/apps/constants.tsx"),d=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),C=e("./frontend/src/lib/utils.tsx"),b=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),V=e("./frontend/src/lib/components/LemonSelect.tsx"),$=e("./node_modules/kea/lib/index.esm.js"),H=e("./frontend/src/lib/components/LemonTable/index.ts"),Q=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),Y=e("./frontend/src/lib/components/Link.tsx"),o=e("./node_modules/react/jsx-runtime.js"),J=e.n(o);function G(_){var g=_.tab,y=Object($.useValues)(M.appMetricsSceneLogic),l=y.appMetricsResponse,T=y.appMetricsResponseLoading,E=y.dateFrom,B=Object($.useActions)(M.appMetricsSceneLogic),m=B.setDateFrom;return Object(o.jsxs)("div",{className:"mt-4",children:[Object(o.jsx)(P.a,{title:Object(o.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[Object(o.jsx)("span",{children:"Metrics overview"}),Object(o.jsx)(V.a,{value:E,onChange:function(A){return m(A)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),children:Object(o.jsx)(h,{tab:g,metrics:l==null?void 0:l.metrics,metricsLoading:T})}),Object(o.jsx)(P.a,{title:"Delivery trends",className:"mt-4",children:Object(o.jsx)(b.AppMetricsGraph,{tab:g,metrics:l==null?void 0:l.metrics,metricsLoading:T})}),Object(o.jsx)(P.a,{title:"Errors",className:"mt-4",children:Object(o.jsx)(U,{category:g,errors:(l==null?void 0:l.errors)||[],loading:T})})]})}function h(_){var g,y,l,T=_.tab,E=_.metrics,B=_.metricsLoading;return B?Object(o.jsx)(d.a,{className:"h-20"}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{className:"card-secondary",children:j.DescriptionColumns[T].successes}),Object(o.jsx)("div",{children:W(E==null||(g=E.totals)===null||g===void 0?void 0:g.successes)})]}),j.DescriptionColumns[T].successes_on_retry&&Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{className:"card-secondary",children:j.DescriptionColumns[T].successes_on_retry}),Object(o.jsx)("div",{children:W(E==null||(y=E.totals)===null||y===void 0?void 0:y.successes_on_retry)})]}),Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{className:"card-secondary",children:j.DescriptionColumns[T].failures}),Object(o.jsx)("div",{children:W(E==null||(l=E.totals)===null||l===void 0?void 0:l.failures)})]})]})}function U(_){var g=_.errors,y=_.loading,l=_.category,T=_.jobId,E=Object($.useActions)(M.appMetricsSceneLogic),B=E.openErrorDetailsDrawer;return Object(o.jsx)(H.a,{dataSource:g,loading:y,columns:[{title:"Error type",dataIndex:"error_type",render:function(D,A){return Object(o.jsx)(Y.a,{title:"View details",className:"font-semibold",onClick:function(L){L.preventDefault(),B(A.error_type,l,T)},children:A.error_type})},sorter:function(D,A){return D.error_type.localeCompare(A.error_type)}},{title:"Count",dataIndex:"count",align:"right",sorter:function(D,A){return D.count-A.count}},{title:"Last seen",dataIndex:"last_seen",render:function(D){return Object(o.jsx)("div",{className:"whitespace-nowrap text-right",children:Object(o.jsx)(Q.b,{time:D})})},align:"right",sorter:function(D,A){return new Date(D.last_seen||0)>new Date(A.last_seen||0)?1:-1}}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0})}function W(_){return Object(o.jsx)(o.Fragment,{children:_&&Object(C.P)(_)})}try{G.displayName="MetricsTab",G.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:G.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(_){}try{h.displayName="MetricsOverview",h.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:h.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(_){}try{U.displayName="ErrorsOverview",U.__docgenInfo={description:"",displayName:"ErrorsOverview",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"AppErrorSummary[]"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},category:{defaultValue:null,description:"",name:"category",required:!0,type:{name:"string"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"]={docgenInfo:U.__docgenInfo,name:"ErrorsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"})}catch(_){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(x,c,e){"use strict";e.r(c),e.d(c,"AppMetricsTab",function(){return v}),e.d(c,"appMetricsSceneLogic",function(){return O});var P=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),M=e.n(P),j=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),d=e.n(j),C=e("./node_modules/@babel/runtime/regenerator/index.js"),b=e.n(C),V=e("./node_modules/core-js/modules/es.array.iterator.js"),$=e.n(V),H=e("./node_modules/core-js/modules/es.object.to-string.js"),Q=e.n(H),Y=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),o=e.n(Y),J=e("./node_modules/core-js/modules/es.array.concat.js"),G=e.n(J),h=e("./node_modules/core-js/modules/es.function.name.js"),U=e.n(h),W=e("./node_modules/core-js/modules/es.array.includes.js"),_=e.n(W),g=e("./node_modules/core-js/modules/es.string.includes.js"),y=e.n(g),l=e("./node_modules/core-js/modules/es.array.filter.js"),T=e.n(l),E=e("./node_modules/core-js/modules/es.number.constructor.js"),B=e.n(E),m=e("./node_modules/kea/lib/index.esm.js"),D=e("./node_modules/kea-loaders/lib/index.js"),A=e.n(D),K=e("./frontend/src/scenes/urls.ts"),L=e("./frontend/src/lib/api.ts"),z=e("./frontend/src/scenes/teamLogic.tsx"),N=e("./node_modules/kea-router/lib/index.js"),Z=e.n(N),S=e("./frontend/src/lib/utils.tsx"),v;(function(s){s.ProcessEvent="processEvent",s.OnEvent="onEvent",s.ExportEvents="exportEvents",s.HistoricalExports="historical_exports"})(v||(v={}));var u=[v.ProcessEvent,v.OnEvent,v.ExportEvents],O=Object(m.kea)([Object(m.path)(function(s){return["scenes","apps","appMetricsSceneLogic",s]}),Object(m.props)({}),Object(m.key)(function(s){return s.pluginConfigId}),Object(m.actions)({setActiveTab:function(t){return{tab:t}},setDateFrom:function(t){return{dateFrom:t}},openErrorDetailsDrawer:function(t,r,n){return{errorType:t,category:r,jobId:n}},closeErrorDetailsDrawer:!0}),Object(m.reducers)({activeTab:[null,{setActiveTab:function(t,r){var n=r.tab;return n}}],dateFrom:["-30d",{setDateFrom:function(t,r){var n=r.dateFrom;return n}}],errorDetailsDrawerError:[null,{openErrorDetailsDrawer:function(t,r){var n=r.errorType;return n},closeErrorDetailsDrawer:function(){return null}}]}),Object(D.loaders)(function(s){var t=s.values,r=s.props;return{pluginConfig:[null,{loadPluginConfig:function(){var n=d()(b.a.mark(function p(){return b.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,L.b.get("api/projects/".concat(z.a.values.currentTeamId,"/plugin_configs/").concat(r.pluginConfigId));case 2:return f.abrupt("return",f.sent);case 3:case"end":return f.stop()}},p)}));function a(){return n.apply(this,arguments)}return a}()}],appMetricsResponse:[null,{loadMetrics:function(){var n=d()(b.a.mark(function p(){var i;return b.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return i=Object(S.Eb)({category:t.activeTab,date_from:t.dateFrom}),I.next=3,L.b.get("api/projects/".concat(z.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"?").concat(i));case 3:return I.abrupt("return",I.sent);case 4:case"end":return I.stop()}},p)}));function a(){return n.apply(this,arguments)}return a}()}],historicalExports:[[],{loadHistoricalExports:function(){var n=d()(b.a.mark(function p(){var i,f;return b.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,L.b.get("api/projects/".concat(z.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/historical_exports"));case 2:return i=R.sent,f=i.results,R.abrupt("return",f);case 5:case"end":return R.stop()}},p)}));function a(){return n.apply(this,arguments)}return a}()}],errorDetails:[[],{openErrorDetailsDrawer:function(){var n=d()(b.a.mark(function p(i){var f,I,R,X,w,k;return b.a.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return f=i.category,I=i.jobId,R=i.errorType,X=Object(S.Eb)({category:f,job_id:I,error_type:R}),F.next=4,L.b.get("api/projects/".concat(z.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/error_details?").concat(X));case 4:return w=F.sent,k=w.result,F.abrupt("return",k);case 7:case"end":return F.stop()}},p)}));function a(p){return n.apply(this,arguments)}return a}()}]}}),Object(m.selectors)(function(s){var t=s.values;return{breadcrumbs:[function(r){return[r.pluginConfig,function(n,a){return a.pluginConfigId}]},function(r,n){var a;return[{name:"Apps",path:K.a.projectApps()},{name:r==null||(a=r.plugin_info)===null||a===void 0?void 0:a.name,path:K.a.appMetrics(n)}]}],showTab:[function(){return[]},function(){return function(r){var n;if(t.pluginConfigLoading||!t.pluginConfig)return!1;var a=((n=t.pluginConfig.plugin_info.capabilities)===null||n===void 0?void 0:n.methods)||[];return r===v.HistoricalExports?a.includes("exportEvents"):r===v.OnEvent&&a.includes("exportEvents")?!1:a.includes(r)}}]}}),Object(m.listeners)(function(s){var t=s.values,r=s.actions;return{loadPluginConfigSuccess:function(){if(!t.activeTab){var a=u.filter(function(f){return t.showTab(f)}),p=M()(a,1),i=p[0];r.setActiveTab(i)}},setActiveTab:function(a){var p=a.tab;p===v.HistoricalExports?r.loadHistoricalExports():r.loadMetrics()},setDateFrom:function(){r.loadMetrics()}}}),Object(N.actionToUrl)(function(s){var t=s.values,r=s.props;return{setActiveTab:function(){var a;return t.activeTab===v.HistoricalExports?K.a.appHistoricalExports(r.pluginConfigId):K.a.appMetrics(r.pluginConfigId,(a=t.activeTab)!==null&&a!==void 0?a:void 0)}}}),Object(N.urlToAction)(function(s){var t=s.values,r=s.actions,n=s.props;return{"/app/:pluginConfigId/:page":function(p,i){n.pluginConfigId===Number(i.pluginConfigId)&&(t.pluginConfig||r.loadPluginConfig(),p.page===v.HistoricalExports?r.setActiveTab(v.HistoricalExports):i.tab&&u.includes(i.tab)&&r.setActiveTab(i.tab))}}})])},"./frontend/src/scenes/apps/constants.tsx":function(x,c,e){"use strict";e.r(c),e.d(c,"DescriptionColumns",function(){return C});var P=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),M=e.n(P),j=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),d,C=(d={},M()(d,j.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),M()(d,j.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),M()(d,j.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),M()(d,j.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),d)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(x,c,e){var P=e("./node_modules/css-loader/dist/runtime/api.js");c=P(!1),c.push([x.i,".AppMetricsGraph{height:300px}",""]),x.exports=c}}]);
