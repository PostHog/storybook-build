(window.webpackJsonp=window.webpackJsonp||[]).push([[0,5,9,10,309],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(W,d,e){"use strict";e.r(d);var P=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),j=e.n(P),g=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),_=e.n(g),C={};C.insert="head",C.singleton=!1;var A=j()(_.a,C);d.default=_.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(W,d,e){"use strict";e.r(d),e.d(d,"AppMetricsGraph",function(){return N});var P=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),j=e.n(P),g=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),_=e.n(g),C=e("./node_modules/core-js/modules/es.array.concat.js"),A=e.n(C),S=e("./node_modules/core-js/modules/es.object.keys.js"),X=e.n(S),Y=e("./node_modules/core-js/modules/es.symbol.js"),w=e.n(Y),t=e("./node_modules/core-js/modules/es.array.filter.js"),k=e.n(t),U=e("./node_modules/core-js/modules/es.object.to-string.js"),F=e.n(U),I=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),z=e.n(I),l=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),h=e.n(l),T=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),m=e.n(T),f=e("./node_modules/react/index.js"),O=e.n(f),x=e("./frontend/src/lib/colors.ts"),y=e("./node_modules/chart.js/dist/chart.mjs"),c=e("./frontend/src/scenes/apps/constants.tsx"),M=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),q=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),R=e("./frontend/src/lib/utils.tsx"),B=e("./node_modules/react/jsx-runtime.js"),Z=e.n(B);function V(v,a){var u=Object.keys(v);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(v);a&&(b=b.filter(function(G){return Object.getOwnPropertyDescriptor(v,G).enumerable})),u.push.apply(u,b)}return u}function Q(v){for(var a=1;a<arguments.length;a++){var u=arguments[a]!=null?arguments[a]:{};a%2?V(Object(u),!0).forEach(function(b){j()(v,b,u[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(u)):V(Object(u)).forEach(function(b){Object.defineProperty(v,b,Object.getOwnPropertyDescriptor(u,b))})}return v}function N(v){var a=v.tab,u=v.metrics,b=v.metricsLoading,G=Object(f.useRef)(null),H=c.DescriptionColumns[a];return Object(f.useEffect)(function(){var r;if(G.current&&u){var o;r=new y.a((o=G.current)===null||o===void 0?void 0:o.getContext("2d"),{type:"line",data:{labels:u.dates,datasets:[Q({label:H.successes,data:u.successes,borderColor:""},J("data-brand-blue"))].concat(_()(H.successes_on_retry?[Q({label:H.successes_on_retry,data:u.successes_on_retry},J("data-yellow"))]:[]),[Q({label:H.failures,data:u.failures},J("data-vermilion"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var n;(n=r)===null||n===void 0||n.destroy()}},[u]),b||!u?Object(B.jsx)(M.a,{className:"AppMetricsGraph border rounded p-6"}):Object(B.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:Object(B.jsx)("canvas",{ref:G})})}function J(v){var a=Object(x.b)(v);return{borderColor:a,hoverBorderColor:Object(R.lb)(a,-20),hoverBackgroundColor:Object(R.lb)(a,-20),backgroundColor:a,fill:!1,borderWidth:2,pointRadius:0}}try{N.displayName="AppMetricsGraph",N.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:N.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(v){}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(W,d,e){"use strict";e.r(d),e.d(d,"MetricsTab",function(){return U}),e.d(d,"MetricsOverview",function(){return F}),e.d(d,"ErrorsOverview",function(){return I});var P=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),j=e("./frontend/src/scenes/apps/constants.tsx"),g=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),_=e("./frontend/src/lib/utils.tsx"),C=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),A=e("./frontend/src/lib/components/LemonSelect.tsx"),S=e("./node_modules/kea/lib/index.esm.js"),X=e("./frontend/src/lib/components/LemonTable/index.ts"),Y=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),w=e("./frontend/src/lib/components/Link.tsx"),t=e("./node_modules/react/jsx-runtime.js"),k=e.n(t);function U(l){var h=l.tab,T=Object(S.useValues)(P.appMetricsSceneLogic),m=T.appMetricsResponse,f=T.appMetricsResponseLoading,O=T.dateFrom,x=Object(S.useActions)(P.appMetricsSceneLogic),y=x.setDateFrom;return Object(t.jsxs)("div",{className:"space-y-8",children:[Object(t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[Object(t.jsx)(F,{tab:h,metrics:m==null?void 0:m.metrics,metricsLoading:f}),Object(t.jsx)(A.a,{value:O,onChange:function(M){return y(M)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),Object(t.jsxs)("div",{children:[Object(t.jsx)("h2",{children:"Delivery trends"}),Object(t.jsx)(C.AppMetricsGraph,{tab:h,metrics:m==null?void 0:m.metrics,metricsLoading:f})]}),Object(t.jsxs)("div",{children:[Object(t.jsx)("h2",{children:"Errors"}),Object(t.jsx)(I,{category:h,errors:(m==null?void 0:m.errors)||[],loading:f})]})]})}function F(l){var h,T,m,f=l.tab,O=l.metrics,x=l.metricsLoading,y=l.exportDuration,c=l.exportFailureReason;return x?Object(t.jsx)(g.a,{className:"w-20 mb-2",repeat:4}):Object(t.jsxs)("div",{className:"space-y-4",children:[Object(t.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[Object(t.jsxs)("div",{children:[Object(t.jsx)("div",{className:"text-muted font-semibold mb-2",children:j.DescriptionColumns[f].successes}),Object(t.jsx)("div",{className:"text-4xl",children:z(O==null||(h=O.totals)===null||h===void 0?void 0:h.successes)})]}),j.DescriptionColumns[f].successes_on_retry&&Object(t.jsxs)("div",{children:[Object(t.jsx)("div",{className:"text-muted font-semibold mb-2",children:j.DescriptionColumns[f].successes_on_retry}),Object(t.jsx)("div",{className:"text-4xl",children:z(O==null||(T=O.totals)===null||T===void 0?void 0:T.successes_on_retry)})]}),Object(t.jsxs)("div",{children:[Object(t.jsx)("div",{className:"text-muted font-semibold mb-2",children:j.DescriptionColumns[f].failures}),Object(t.jsx)("div",{className:"text-4xl",children:z(O==null||(m=O.totals)===null||m===void 0?void 0:m.failures)})]}),y&&Object(t.jsxs)("div",{children:[Object(t.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export duration"}),Object(t.jsx)("div",{className:"text-4xl",children:Object(_.O)(y)})]})]}),c&&Object(t.jsxs)("div",{children:[Object(t.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export failure reason"}),Object(t.jsx)("div",{children:c})]})]})}function I(l){var h=l.errors,T=l.loading,m=l.category,f=l.jobId,O=Object(S.useActions)(P.appMetricsSceneLogic),x=O.openErrorDetailsModal;return Object(t.jsx)(X.a,{dataSource:h,loading:T,columns:[{title:"Error type",dataIndex:"error_type",render:function(c,M){return Object(t.jsx)(w.a,{title:"View details",className:"font-semibold",onClick:function(R){R.preventDefault(),x(M.error_type,m,f)},children:M.error_type})},sorter:function(c,M){return c.error_type.localeCompare(M.error_type)}},{title:"Count",dataIndex:"count",align:"right",sorter:function(c,M){return c.count-M.count}},{title:"Last seen",dataIndex:"last_seen",render:function(c){return Object(t.jsx)("div",{className:"whitespace-nowrap text-right",children:Object(t.jsx)(Y.b,{time:c})})},align:"right",sorter:function(c,M){return new Date(c.last_seen||0)>new Date(M.last_seen||0)?1:-1}}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:Object(t.jsxs)("div",{className:"",children:[Object(t.jsx)("b",{children:"No errors! \u{1F973}"}),Object(t.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})}function z(l){return Object(t.jsx)(t.Fragment,{children:l&&Object(_.P)(l)})}try{U.displayName="MetricsTab",U.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:U.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(l){}try{F.displayName="MetricsOverview",F.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}},exportDuration:{defaultValue:null,description:"",name:"exportDuration",required:!1,type:{name:"number"}},exportFailureReason:{defaultValue:null,description:"",name:"exportFailureReason",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:F.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(l){}try{I.displayName="ErrorsOverview",I.__docgenInfo={description:"",displayName:"ErrorsOverview",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"AppErrorSummary[]"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},category:{defaultValue:null,description:"",name:"category",required:!0,type:{name:"string"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"]={docgenInfo:I.__docgenInfo,name:"ErrorsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"})}catch(l){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(W,d,e){"use strict";e.r(d),e.d(d,"AppMetricsTab",function(){return a}),e.d(d,"appMetricsSceneLogic",function(){return G});var P=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),j=e.n(P),g=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),_=e.n(g),C=e("./node_modules/@babel/runtime/regenerator/index.js"),A=e.n(C),S=e("./node_modules/core-js/modules/es.array.iterator.js"),X=e.n(S),Y=e("./node_modules/core-js/modules/es.object.to-string.js"),w=e.n(Y),t=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),k=e.n(t),U=e("./node_modules/core-js/modules/es.array.concat.js"),F=e.n(U),I=e("./node_modules/core-js/modules/es.function.name.js"),z=e.n(I),l=e("./node_modules/core-js/modules/es.array.includes.js"),h=e.n(l),T=e("./node_modules/core-js/modules/es.string.includes.js"),m=e.n(T),f=e("./node_modules/core-js/modules/es.array.filter.js"),O=e.n(f),x=e("./node_modules/core-js/modules/es.number.constructor.js"),y=e.n(x),c=e("./node_modules/kea/lib/index.esm.js"),M=e("./node_modules/kea-loaders/lib/index.js"),q=e.n(M),R=e("./frontend/src/scenes/urls.ts"),B=e("./frontend/src/lib/api.ts"),Z=e("./frontend/src/scenes/teamLogic.tsx"),V=e("./node_modules/kea-router/lib/index.js"),Q=e.n(V),N=e("./frontend/src/lib/utils.tsx"),J=e("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),v=e("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),a;(function(r){r.ProcessEvent="processEvent",r.OnEvent="onEvent",r.ExportEvents="exportEvents",r.ScheduledTask="scheduledTask",r.HistoricalExports="historical_exports"})(a||(a={}));var u="-30d",b=[a.ProcessEvent,a.OnEvent,a.ExportEvents,a.ScheduledTask],G=Object(c.kea)([Object(c.path)(function(r){return["scenes","apps","appMetricsSceneLogic",r]}),Object(c.props)({}),Object(c.key)(function(r){return r.pluginConfigId}),Object(c.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}},openErrorDetailsModal:function(o,n,s){return{errorType:o,category:n,jobId:s}},closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),Object(c.reducers)({activeTab:[null,{setActiveTab:function(o,n){var s=n.tab;return s}}],dateFrom:[u,{setDateFrom:function(o,n){var s=n.dateFrom;return s}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(o,n){var s=n.errorType;return s},closeErrorDetailsModal:function(){return null}}]}),Object(M.loaders)(function(r){var o=r.values,n=r.props;return{pluginConfig:[null,{loadPluginConfig:function(){var s=_()(A.a.mark(function i(){return A.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,B.b.get("api/projects/".concat(Z.a.values.currentTeamId,"/plugin_configs/").concat(n.pluginConfigId));case 2:return D.abrupt("return",D.sent);case 3:case"end":return D.stop()}},i)}));function E(){return s.apply(this,arguments)}return E}()}],appMetricsResponse:[null,{loadMetrics:function(){var s=_()(A.a.mark(function i(){var p;return A.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return p=Object(N.Eb)({category:o.activeTab,date_from:o.dateFrom}),L.next=3,B.b.get("api/projects/".concat(Z.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"?").concat(p));case 3:return L.abrupt("return",L.sent);case 4:case"end":return L.stop()}},i)}));function E(){return s.apply(this,arguments)}return E}()}],historicalExports:[[],{loadHistoricalExports:function(){var s=_()(A.a.mark(function i(){var p,D;return A.a.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,B.b.get("api/projects/".concat(Z.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/historical_exports"));case 2:return p=K.sent,D=p.results,K.abrupt("return",D);case 5:case"end":return K.stop()}},i)}));function E(){return s.apply(this,arguments)}return E}()}],errorDetails:[[],{openErrorDetailsModal:function(){var s=_()(A.a.mark(function i(p){var D,L,K,ee,se,te;return A.a.wrap(function($){for(;;)switch($.prev=$.next){case 0:return D=p.category,L=p.jobId,K=p.errorType,ee=Object(N.Eb)({category:D,job_id:L,error_type:K}),$.next=4,B.b.get("api/projects/".concat(Z.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/error_details?").concat(ee));case 4:return se=$.sent,te=se.result,$.abrupt("return",te);case 7:case"end":return $.stop()}},i)}));function E(i){return s.apply(this,arguments)}return E}()}]}}),Object(c.selectors)(function(r){var o=r.values,n=r.actions;return{breadcrumbs:[function(s){return[s.pluginConfig,function(E,i){return i.pluginConfigId}]},function(s,E){var i;return[{name:"Apps",path:R.a.projectApps()},{name:s==null||(i=s.plugin_info)===null||i===void 0?void 0:i.name,path:R.a.appMetrics(E)}]}],showTab:[function(){return[]},function(){return function(s){if(o.pluginConfigLoading||!o.pluginConfig||!o.pluginConfig.plugin_info.capabilities)return!1;var E=o.pluginConfig.plugin_info.capabilities,i=E.methods.includes("exportEvents");return s===a.HistoricalExports?i:s===a.OnEvent&&i?!1:s===a.ScheduledTask?!i&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(p){return E.scheduled_tasks.includes(p)}):E.methods.includes(s)}}],interfaceJobsProps:[function(s){return[s.pluginConfig]},function(s){return!s||!s.plugin_info.public_jobs||!(s!=null&&s.enabled)?null:{jobName:J.b,jobSpec:s.plugin_info.public_jobs[J.b],pluginConfigId:s.id,pluginId:s.plugin,onSubmit:n.loadHistoricalExports}}]}}),Object(c.listeners)(function(r){var o=r.values,n=r.actions;return{loadPluginConfigSuccess:function(){if(!o.activeTab){var E=b.filter(function(D){return o.showTab(D)}),i=j()(E,1),p=i[0];n.setActiveTab(p)}},setActiveTab:function(E){var i=E.tab;i===a.HistoricalExports?n.loadHistoricalExports():n.loadMetrics()},setDateFrom:function(){n.loadMetrics()},openHistoricalExportModal:function(){o.interfaceJobsProps&&Object(v.a)(o.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}}),Object(V.actionToUrl)(function(r){var o=r.values,n=r.props;return{setActiveTab:function(){return H(o,n)},setDateFrom:function(){return H(o,n)}}}),Object(V.urlToAction)(function(r){var o=r.values,n=r.actions,s=r.props;return{"/app/:pluginConfigId/:page":function(i,p){s.pluginConfigId===Number(i.pluginConfigId)&&(o.pluginConfig||n.loadPluginConfig(),i.page===a.HistoricalExports?n.setActiveTab(a.HistoricalExports):(p.tab&&b.includes(p.tab)&&n.setActiveTab(p.tab),p.from&&n.setDateFrom(p.from)))}}})]);function H(r,o){if(r.activeTab===a.HistoricalExports)return R.a.appHistoricalExports(o.pluginConfigId);var n={};return r.activeTab&&(n.tab=r.activeTab),r.dateFrom!==u&&(n.from=r.dateFrom),R.a.appMetrics(o.pluginConfigId,n)}},"./frontend/src/scenes/apps/constants.tsx":function(W,d,e){"use strict";e.r(d),e.d(d,"DescriptionColumns",function(){return C});var P=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),j=e.n(P),g=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),_,C=(_={},j()(_,g.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),j()(_,g.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),j()(_,g.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),j()(_,g.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),j()(_,g.AppMetricsTab.ScheduledTask,{successes:"Successes",failures:"Failures"}),_)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(W,d,e){var P=e("./node_modules/css-loader/dist/runtime/api.js");d=P(!1),d.push([W.i,".AppMetricsGraph{height:300px}",""]),W.exports=d}}]);
