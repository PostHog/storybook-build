"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[5244],{"./frontend/src/scenes/debug/DebugScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DebugScene:()=>DebugScene,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),examples=__webpack_require__("./frontend/src/queries/examples.ts");const DEFAULT_QUERY=examples.Os.HogQLRaw,debugSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","query","debugSceneLogic"]),(0,index_esm.actions)({setQuery1:query=>({query}),setQuery2:query=>({query})}),(0,index_esm.reducers)({query1:[DEFAULT_QUERY,{setQuery1:(_,_ref)=>{let{query}=_ref;return query}}],query2:[DEFAULT_QUERY,{setQuery2:(_,_ref2)=>{let{query}=_ref2;return query}}]}),(0,lib.actionToUrl)((_ref3=>{let{values}=_ref3;return{setQuery1:_ref4=>{let{query}=_ref4;return[urls.j.debugQuery(),{},{q:query,...values.query2?{q2:values.query2}:{}},{replace:!0}]},setQuery2:()=>[urls.j.debugQuery(),{},{q:values.query1,q2:values.query2},{replace:!0}]}})),(0,lib.urlToAction)((_ref5=>{let{actions,values}=_ref5;return{[urls.j.debugQuery()]:(_,__,_ref6)=>{var _values$query;let{q,q2}=_ref6;q&&q!==values.query1&&actions.setQuery1(q),(null!=q2?q2:"")!==(null!==(_values$query=values.query2)&&void 0!==_values$query?_values$query:"")&&actions.setQuery2(null!=q2?q2:"")}}}))]);var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),LemonSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),LemonLabel=__webpack_require__("./frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),HogQLQueryEditor=__webpack_require__("./frontend/src/queries/nodes/HogQLQuery/HogQLQueryEditor.tsx"),DateRange=__webpack_require__("./frontend/src/queries/nodes/DataNode/DateRange.tsx"),EventPropertyFilters=__webpack_require__("./frontend/src/queries/nodes/EventsNode/EventPropertyFilters.tsx"),dataNodeLogic=__webpack_require__("./frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),ElapsedTime=__webpack_require__("./frontend/src/queries/nodes/DataNode/ElapsedTime.tsx"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),CodeEditors=__webpack_require__("./frontend/src/lib/components/CodeEditors.tsx"),lemon_ui_LemonLabel=__webpack_require__("./frontend/src/lib/lemon-ui/LemonLabel/index.ts"),Reload=__webpack_require__("./frontend/src/queries/nodes/DataNode/Reload.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function HogQLDebug(_ref){var _query$modifiers$pers,_query$modifiers$pers2,_query$modifiers$inCo,_query$modifiers$mate;let{query,setQuery,queryKey}=_ref;const dataNodeLogicProps={query,key:queryKey},{dataLoading,response,responseErrorObject,elapsedTime}=(0,index_esm.useValues)((0,dataNodeLogic.M)(dataNodeLogicProps)),clickHouseTime=response?.timings?.find((_ref2=>{let{k}=_ref2;return"./clickhouse_execute"===k}))?.t;return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeLogic.M,props:dataNodeLogicProps,children:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)(HogQLQueryEditor.n,{query,setQuery}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(Reload.L,{}),(0,jsx_runtime.jsx)(DateRange.C,{query,setQuery},"date-range"),(0,jsx_runtime.jsx)(EventPropertyFilters.H,{query,setQuery},"event-property")]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsxs)(lemon_ui_LemonLabel.H,{children:["POE:",(0,jsx_runtime.jsx)(LemonSelect.Yv,{options:[{value:"disabled",label:"Disabled"},{value:"v1_enabled",label:"V1 Enabled"},{value:"v1_mixed",label:"V1 Mixed"},{value:"v2_enabled",label:"V2 Enabled"}],onChange:value=>setQuery({...query,modifiers:{...query.modifiers,personsOnEventsMode:value}}),value:null!==(_query$modifiers$pers=query.modifiers?.personsOnEventsMode)&&void 0!==_query$modifiers$pers?_query$modifiers$pers:response?.modifiers?.personsOnEventsMode})]}),(0,jsx_runtime.jsxs)(lemon_ui_LemonLabel.H,{children:["Persons ArgMax:",(0,jsx_runtime.jsx)(LemonSelect.Yv,{options:[{value:"v1",label:"V1"},{value:"v2",label:"V2"}],onChange:value=>setQuery({...query,modifiers:{...query.modifiers,personsArgMaxVersion:value}}),value:null!==(_query$modifiers$pers2=query.modifiers?.personsArgMaxVersion)&&void 0!==_query$modifiers$pers2?_query$modifiers$pers2:response?.modifiers?.personsArgMaxVersion})]}),(0,jsx_runtime.jsxs)(lemon_ui_LemonLabel.H,{children:["In Cohort Via:",(0,jsx_runtime.jsx)(LemonSelect.Yv,{options:[{value:"join",label:"join"},{value:"subquery",label:"subquery"}],onChange:value=>setQuery({...query,modifiers:{...query.modifiers,inCohortVia:value}}),value:null!==(_query$modifiers$inCo=query.modifiers?.inCohortVia)&&void 0!==_query$modifiers$inCo?_query$modifiers$inCo:response?.modifiers?.inCohortVia})]}),(0,jsx_runtime.jsxs)(lemon_ui_LemonLabel.H,{children:["Materialization Mode:",(0,jsx_runtime.jsx)(LemonSelect.Yv,{options:[{value:"auto",label:"auto"},{value:"legacy_null_as_string",label:"legacy_null_as_string"},{value:"legacy_null_as_null",label:"legacy_null_as_null"},{value:"disabled",label:"disabled"}],onChange:value=>setQuery({...query,modifiers:{...query.modifiers,materializationMode:value}}),value:null!==(_query$modifiers$mate=query.modifiers?.materializationMode)&&void 0!==_query$modifiers$mate?_query$modifiers$mate:response?.modifiers?.materializationMode})]})]}),dataLoading?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Running query..."}),(0,jsx_runtime.jsxs)("div",{className:"flex",children:["Time elapsed: ",(0,jsx_runtime.jsx)(ElapsedTime.W,{})]})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[response?.error?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{className:"text-danger",children:"Error Running Query!"}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Text,wrap:!0,children:response.error})]}):null,response?.hogql?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Executed HogQL"}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.SQL,wrap:!0,children:response.hogql})]}):null,response?.clickhouse?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("h2",{children:["Executed ClickHouse SQL",void 0!==clickHouseTime?` (${Math.floor(1e3*clickHouseTime)/1e3}s)`:""]}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.SQL,wrap:!0,children:response.clickhouse})]}):null,response?.explain?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Explained ClickHouseSQL"}),(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,children:response.explain.join("\n")})]}):null,response?.timings&&null!==elapsedTime?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Time spent"}),(0,jsx_runtime.jsx)(ElapsedTime.F,{timings:response.timings,elapsedTime})]}):null,(0,jsx_runtime.jsx)("h2",{children:"Raw response"}),(0,jsx_runtime.jsx)(CodeEditors.p,{className:"border",language:"json",value:JSON.stringify(null!=response?response:responseErrorObject,null,2),height:800})]})]})})}try{HogQLDebug.displayName="HogQLDebug",HogQLDebug.__docgenInfo={description:"",displayName:"HogQLDebug",props:{queryKey:{defaultValue:null,description:"",name:"queryKey",required:!0,type:{name:"string"}},query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"HogQLQuery"}},setQuery:{defaultValue:null,description:"",name:"setQuery",required:!0,type:{name:"(query: DataNode) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/debug/HogQLDebug.tsx#HogQLDebug"]={docgenInfo:HogQLDebug.__docgenInfo,name:"HogQLDebug",path:"frontend/src/scenes/debug/HogQLDebug.tsx#HogQLDebug"})}catch(__react_docgen_typescript_loader_error){}function QueryDebug(_ref){let parsed,{query,setQuery,queryKey}=_ref;try{parsed=JSON.parse(query)}catch(e){}return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:parsed&&"HogQLQuery"===parsed?.kind?(0,jsx_runtime.jsx)(HogQLDebug,{queryKey,query:parsed,setQuery:query=>setQuery(JSON.stringify(query,null,2))}):(0,jsx_runtime.jsx)(Query.A,{query,setQuery:query=>setQuery(JSON.stringify(query,null,2)),context:{showQueryEditor:!0}})})}function DebugScene(){const{query1,query2}=(0,index_esm.useValues)(debugSceneLogic),{setQuery1,setQuery2}=(0,index_esm.useActions)(debugSceneLogic);return(0,jsx_runtime.jsxs)("div",{className:"QueryScene",children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:"Query Debugger",buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.Jp,{active:!!query2,onClick:()=>setQuery2(query2?"":query1),children:"Split"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{active:query1===examples.Os.HogQLRaw,onClick:()=>setQuery1(examples.Os.HogQLRaw),children:"HogQL Debug"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{active:query1===examples.Os.HogQLTable,onClick:()=>setQuery1(examples.Os.HogQLTable),children:"HogQL Table"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{active:query1===examples.Os.Events,onClick:()=>setQuery1(examples.Os.Events),children:"Any Query"}),(0,jsx_runtime.jsx)(LemonLabel.H,{children:(0,jsx_runtime.jsx)(LemonSelect.Yv,{placeholder:"More sample queries",options:Object.entries(examples.Os).filter((_ref2=>{let[k]=_ref2;return"HogQLTable"!==k&&"HogQLRaw"!==k})).map((_ref3=>{let[k,v]=_ref3;return{label:k,value:v}})),onChange:v=>{v&&setQuery1(v)}})})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1 w-1/2",children:(0,jsx_runtime.jsx)(QueryDebug,{query:query1,setQuery:setQuery1,queryKey:"hogql-debug-1"})}),query2?(0,jsx_runtime.jsx)("div",{className:"flex-1 w-1/2",children:(0,jsx_runtime.jsx)(QueryDebug,{query:query2,setQuery:setQuery2,queryKey:"hogql-debug-2"})}):null]})]})}const scene={component:DebugScene,logic:debugSceneLogic}}}]);