"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[57387,55666,40392],{"../../products/llm_analytics/frontend/LLMAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMAnalyticsScene:()=>LLMAnalyticsScene,scene:()=>scene});var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.33.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),QueryCard=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/QueryCard.tsx"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),PropertyFilters=__webpack_require__("../../frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),TestAccountFiltersSwitch=__webpack_require__("../../frontend/src/lib/components/TestAccountFiltersSwitch.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),deleteWithUndo=__webpack_require__("../../frontend/src/lib/utils/deleteWithUndo.tsx"),EventDetails=__webpack_require__("../../frontend/src/scenes/activity/explore/EventDetails.tsx"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes=__webpack_require__("../../frontend/src/scenes/scenes.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),dataNodeCollectionLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeCollectionLogic.ts"),DataTable=__webpack_require__("../../frontend/src/queries/nodes/DataTable/DataTable.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),queries_utils=__webpack_require__("../../frontend/src/queries/utils.ts"),LLMAnalyticsPlaygroundScene=__webpack_require__("../../products/llm_analytics/frontend/LLMAnalyticsPlaygroundScene.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),llmAnalyticsLogic=__webpack_require__("../../products/llm_analytics/frontend/llmAnalyticsLogic.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let LastRefreshText=()=>{let{newestRefreshed}=(0,index_esm.useValues)(llmAnalyticsLogic.BK);return newestRefreshed?(0,jsx_runtime.jsxs)("span",{children:["Last updated ",(0,dayjs.Bv)(newestRefreshed).fromNow()]}):(0,jsx_runtime.jsx)("span",{children:"Refresh"})};function LLMAnalyticsReloadAction(){let{isRefreshing}=(0,index_esm.useValues)(llmAnalyticsLogic.BK),{refreshAllDashboardItems}=(0,index_esm.useActions)(llmAnalyticsLogic.BK);return(0,jsx_runtime.jsx)("div",{className:"relative",children:(0,jsx_runtime.jsx)(src.Jp,{onClick:refreshAllDashboardItems,type:"secondary",icon:isRefreshing?(0,jsx_runtime.jsx)(Spinner.$,{textColored:!0}):(0,jsx_runtime.jsx)(icons.tr,{}),size:"small",disabledReason:isRefreshing?"Refreshing...":void 0,children:(0,jsx_runtime.jsx)("span",{className:"dashboard-items-action-refresh-text",children:isRefreshing?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Refreshing..."}):(0,jsx_runtime.jsx)(LastRefreshText,{})})})})}var LLMAnalyticsTracesScene=__webpack_require__("../../products/llm_analytics/frontend/LLMAnalyticsTracesScene.tsx"),LLMAnalyticsUsers=__webpack_require__("../../products/llm_analytics/frontend/LLMAnalyticsUsers.tsx"),LLMAnalyticsDatasetsScene=__webpack_require__("../../products/llm_analytics/frontend/datasets/LLMAnalyticsDatasetsScene.tsx"),llmEvaluationsLogic=__webpack_require__("../../products/llm_analytics/frontend/evaluations/llmEvaluationsLogic.ts"),frontend_utils=__webpack_require__("../../products/llm_analytics/frontend/utils.ts");let scene={component:LLMAnalyticsScene,logic:llmAnalyticsLogic.BK},Filters=()=>{let{dashboardDateFilter,dateFilter,shouldFilterTestAccounts,generationsQuery,propertyFilters,activeTab}=(0,index_esm.useValues)(llmAnalyticsLogic.BK),{setDates,setShouldFilterTestAccounts,setPropertyFilters}=(0,index_esm.useActions)(llmAnalyticsLogic.BK),dateFrom="dashboard"===activeTab?dashboardDateFilter.dateFrom:dateFilter.dateFrom,dateTo="dashboard"===activeTab?dashboardDateFilter.dateTo:dateFilter.dateTo;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-4 gap-y-2 items-center flex-wrap py-4 -mt-4 mb-4 border-b",children:[(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:dateFrom,dateTo:dateTo,onChange:setDates}),(0,jsx_runtime.jsx)(PropertyFilters.t,{propertyFilters:propertyFilters,taxonomicGroupTypes:generationsQuery.showPropertyFilter,onChange:setPropertyFilters,pageKey:"llm-analytics"}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:shouldFilterTestAccounts,onChange:setShouldFilterTestAccounts}),(0,jsx_runtime.jsx)(LLMAnalyticsReloadAction,{})]})},Tiles=()=>{let{tiles}=(0,index_esm.useValues)(llmAnalyticsLogic.BK);return(0,jsx_runtime.jsx)("div",{className:"mt-2 grid grid-cols-1 @xl/dashboard:grid-cols-2 @4xl/dashboard:grid-cols-6 gap-4",children:tiles.map((_ref,i)=>{let{title,description,query,context}=_ref;return(0,jsx_runtime.jsx)(QueryCard.w,{attachTo:llmAnalyticsLogic.BK,title:title,description:description,query:{kind:schema_general.OH.InsightVizNode,source:query},context:context,sceneSource:"llm-analytics",className:(0,clsx_m.default)("h-96",i<3||i>=5?"@4xl/dashboard:col-span-2":"@4xl/dashboard:col-span-3")},i)})})},IngestionStatusCheck=()=>(0,jsx_runtime.jsxs)(src.Vp,{type:"warning",children:[(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("strong",{children:"No LLM generation events have been detected!"})}),(0,jsx_runtime.jsxs)("p",{children:["To use the LLM Analytics product, please"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/llm-analytics/installation",children:"instrument your LLM calls with the PostHog SDK"})," ","(otherwise it'll be a little empty!)"]})]});function LLMAnalyticsDashboard(){return(0,jsx_runtime.jsxs)("div",{className:"@container/dashboard",children:[(0,jsx_runtime.jsx)(Filters,{}),(0,jsx_runtime.jsx)(Tiles,{})]})}function LLMAnalyticsGenerations(){let{setDates,setShouldFilterTestAccounts,setPropertyFilters,setGenerationsColumns,toggleGenerationExpanded}=(0,index_esm.useActions)(llmAnalyticsLogic.BK),{generationsQuery,propertyFilters:currentPropertyFilters,expandedGenerationIds,loadedTraces}=(0,index_esm.useValues)(llmAnalyticsLogic.BK),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic);return(0,jsx_runtime.jsx)(DataTable.w,{query:{...generationsQuery,showSavedFilters:!0,defaultColumns:(0,llmAnalyticsLogic.yw)(!!featureFlags[constants.y8.LLM_OBSERVABILITY_SHOW_INPUT_OUTPUT])},setQuery:query=>{if(!(0,queries_utils.rz)(query.source))throw Error("Invalid query");setDates(query.source.after||null,query.source.before||null),setShouldFilterTestAccounts(query.source.filterTestAccounts||!1);let newPropertyFilters=query.source.properties||[];(0,utils.h0)(newPropertyFilters,currentPropertyFilters)||setPropertyFilters(newPropertyFilters),query.source.select&&setGenerationsColumns(query.source.select)},context:{emptyStateHeading:"There were no generations in this period",emptyStateDetail:"Try changing the date range or filters.",columns:{uuid:{title:"ID",render:_ref2=>{let{record,value}=_ref2;if(!value||"string"!=typeof value)return null;let traceId=Array.isArray(record)&&record.length>1?record[1]:void 0,visualValue=(0,frontend_utils.ol)(value);return traceId&&"string"==typeof traceId?(0,jsx_runtime.jsx)("strong",{children:(0,jsx_runtime.jsx)(Tooltip.u,{title:value,children:(0,jsx_runtime.jsx)(src.rU,{to:`/llm-analytics/traces/${traceId}?event=${value}`,children:visualValue})})}):(0,jsx_runtime.jsx)("strong",{children:visualValue})}}},expandable:{expandedRowRender:function renderExpandedGeneration(_ref3){let{result}=_ref3;if(!Array.isArray(result))return null;let uuid=result[0],trace=loadedTraces[result[1]],event=trace?.events.find(e=>e.id===uuid);if(!trace)return(0,jsx_runtime.jsx)("div",{className:"p-4",children:(0,jsx_runtime.jsx)(src.$j,{})});if(!event)return(0,jsx_runtime.jsx)("div",{className:"p-4",children:"Event not found in trace"});let eventForDetails={id:event.id,distinct_id:"",properties:event.properties,event:event.event,timestamp:event.createdAt,elements:[]};return(0,jsx_runtime.jsx)("div",{className:"pt-2 px-4 pb-4",children:(0,jsx_runtime.jsx)(EventDetails.T,{event:eventForDetails})})},rowExpandable:_ref4=>{let{result}=_ref4;return!!result&&Array.isArray(result)&&!!result[0]&&!!result[1]},isRowExpanded:_ref5=>{let{result}=_ref5;return Array.isArray(result)&&!!result[0]&&expandedGenerationIds.has(result[0])},onRowExpand:_ref6=>{let{result}=_ref6;Array.isArray(result)&&result[0]&&result[1]&&toggleGenerationExpanded(result[0],result[1])},onRowCollapse:_ref7=>{let{result}=_ref7;Array.isArray(result)&&result[0]&&result[1]&&toggleGenerationExpanded(result[0],result[1])},noIndent:!0}},uniqueKey:"llm-analytics-generations"})}function LLMAnalyticsEvaluations(){return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:llmEvaluationsLogic.k,props:{},children:(0,jsx_runtime.jsx)(LLMAnalyticsEvaluationsContent,{})})}function LLMAnalyticsEvaluationsContent(){let{filteredEvaluations,evaluationsLoading,evaluationsFilter}=(0,index_esm.useValues)(llmEvaluationsLogic.k),{setEvaluationsFilter,toggleEvaluationEnabled,duplicateEvaluation,loadEvaluations}=(0,index_esm.useActions)(llmEvaluationsLogic.k),{currentTeamId}=(0,index_esm.useValues)(teamLogic.teamLogic),{push}=(0,index_esm.useActions)(lib.router),columns=[{title:"Name",key:"name",render:(_,evaluation)=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)(src.rU,{to:urls.j.llmAnalyticsEvaluation(evaluation.id),className:"font-semibold text-primary",children:evaluation.name}),evaluation.description&&(0,jsx_runtime.jsx)("div",{className:"text-muted text-sm",children:evaluation.description})]}),sorter:(a,b)=>a.name.localeCompare(b.name)},{title:"Status",key:"enabled",render:(_,evaluation)=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.f4,{checked:evaluation.enabled,onChange:()=>toggleEvaluationEnabled(evaluation.id),size:"small"}),(0,jsx_runtime.jsx)("span",{className:evaluation.enabled?"text-success":"text-muted",children:evaluation.enabled?"Enabled":"Disabled"})]}),sorter:(a,b)=>Number(b.enabled)-Number(a.enabled)},{title:"Prompt",key:"prompt",render:(_,evaluation)=>(0,jsx_runtime.jsx)("div",{className:"max-w-md",children:(0,jsx_runtime.jsx)("div",{className:"text-sm font-mono bg-bg-light border rounded px-2 py-1 truncate",children:evaluation.prompt||"(No prompt)"})})},{title:"Triggers",key:"conditions",render:(_,evaluation)=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-1",children:[evaluation.conditions.map(condition=>(0,jsx_runtime.jsxs)(src.oe,{type:"option",children:[condition.rollout_percentage,"%",condition.properties.length>0&&` when ${condition.properties.length} condition${1!==condition.properties.length?"s":""}`]},condition.id)),0===evaluation.conditions.length&&(0,jsx_runtime.jsx)("span",{className:"text-muted text-sm",children:"No triggers"})]})},{title:"Runs",key:"total_runs",render:(_,evaluation)=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:evaluation.total_runs}),evaluation.last_run_at&&(0,jsx_runtime.jsxs)("div",{className:"text-muted text-xs",children:["Last: ",(0,utils.C7)(evaluation.last_run_at)]})]}),sorter:(a,b)=>b.total_runs-a.total_runs},{title:"Actions",key:"actions",render:(_,evaluation)=>(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{}),onClick:()=>push(urls.j.llmAnalyticsEvaluation(evaluation.id)),fullWidth:!0,children:"Edit"}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCopy,{}),onClick:()=>duplicateEvaluation(evaluation.id),fullWidth:!0,children:"Duplicate"}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",onClick:()=>{(0,deleteWithUndo.S)({endpoint:`environments/${currentTeamId}/evaluations`,object:evaluation,callback:()=>loadEvaluations()})},fullWidth:!0,children:"Delete"})]})})}];return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"Evaluations"}),(0,jsx_runtime.jsx)("p",{className:"text-muted",children:"Configure evaluation prompts and triggers to automatically assess your LLM generations."})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),to:urls.j.llmAnalyticsEvaluation("new"),children:"Create Evaluation"})]}),(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-2",children:(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search evaluations...",value:evaluationsFilter,onChange:setEvaluationsFilter,prefix:(0,jsx_runtime.jsx)(posthog_icons_es.IconSearch,{}),className:"max-w-sm"})}),(0,jsx_runtime.jsx)(src.g3,{columns:columns,dataSource:filteredEvaluations,loading:evaluationsLoading,rowKey:"id",pagination:{pageSize:50},nouns:["evaluation","evaluations"]})]})}function LLMAnalyticsNoEvents(){return(0,jsx_runtime.jsx)("div",{className:"w-full flex flex-col items-center justify-center",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center justify-center max-w-md w-full",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconArchive,{className:"text-5xl mb-2 text-muted-alt"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl leading-tight",children:"We haven't detected any LLM generations yet"}),(0,jsx_runtime.jsxs)("p",{className:"text-sm text-center text-balance",children:["To use the LLM Analytics product, please"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/llm-analytics/installation",children:"instrument your LLM calls with the PostHog SDK"})," "]})]})})}function LLMAnalyticsScene(){let{activeTab,hasSentAiGenerationEvent,hasSentAiGenerationEventLoading}=(0,index_esm.useValues)(llmAnalyticsLogic.BK),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{searchParams}=(0,index_esm.useValues)(lib.router),tabs=[{key:"dashboard",label:"Dashboard",content:(0,jsx_runtime.jsx)(LLMAnalyticsDashboard,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsDashboard(),searchParams).url},{key:"traces",label:"Traces",content:hasSentAiGenerationEvent?(0,jsx_runtime.jsx)(LLMAnalyticsTracesScene.s,{}):(0,jsx_runtime.jsx)(LLMAnalyticsNoEvents,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsTraces(),searchParams).url},{key:"generations",label:"Generations",content:hasSentAiGenerationEvent?(0,jsx_runtime.jsx)(LLMAnalyticsGenerations,{}):(0,jsx_runtime.jsx)(LLMAnalyticsNoEvents,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsGenerations(),searchParams).url},{key:"users",label:"Users",content:hasSentAiGenerationEvent?(0,jsx_runtime.jsx)(LLMAnalyticsUsers.LLMAnalyticsUsers,{}):(0,jsx_runtime.jsx)(LLMAnalyticsNoEvents,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsUsers(),searchParams).url}];return featureFlags[constants.y8.LLM_OBSERVABILITY_PLAYGROUND]&&tabs.push({key:"playground",label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Playground"," ",(0,jsx_runtime.jsx)(src.oe,{className:"ml-1",type:"warning",children:"Beta"})]}),content:(0,jsx_runtime.jsx)(LLMAnalyticsPlaygroundScene.LLMAnalyticsPlaygroundScene,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsPlayground(),searchParams).url}),featureFlags[constants.y8.LLM_ANALYTICS_EVALUATIONS]&&tabs.push({key:"evaluations",label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Evaluations"," ",(0,jsx_runtime.jsx)(src.oe,{className:"ml-1",type:"completion",children:"Alpha"})]}),content:(0,jsx_runtime.jsx)(LLMAnalyticsEvaluations,{}),link:(0,lib.combineUrl)("/llm-analytics/evaluations",searchParams).url,"data-attr":"evaluations-tab"}),featureFlags[constants.y8.LLM_ANALYTICS_DATASETS]&&tabs.push({key:"datasets",label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Datasets"," ",(0,jsx_runtime.jsx)(src.oe,{className:"ml-1",type:"warning",children:"Beta"})]}),content:(0,jsx_runtime.jsx)(LLMAnalyticsDatasetsScene.LLMAnalyticsDatasetsScene,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsDatasets(),searchParams).url,"data-attr":"datasets-tab"}),(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeCollectionLogic.y,props:{key:llmAnalyticsLogic.SD},children:(0,jsx_runtime.jsxs)(SceneContent._,{children:[!hasSentAiGenerationEventLoading&&!hasSentAiGenerationEvent&&(0,jsx_runtime.jsx)(IngestionStatusCheck,{}),(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:scenes.lc[sceneTypes.x.LLMAnalytics].name,description:scenes.lc[sceneTypes.x.LLMAnalytics].description,resourceType:{type:scenes.lc[sceneTypes.x.LLMAnalytics].iconType||"default_icon_type"},actions:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.Jp,{to:"https://posthog.com/docs/llm-analytics/installation",type:"secondary",targetBlank:!0,size:"small",children:"Documentation"})})}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,"data-attr":"llm-analytics-tabs",tabs:tabs,sceneInset:!0})]})})}},"../../products/llm_analytics/frontend/LLMAnalyticsUsers.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMAnalyticsUsers:()=>LLMAnalyticsUsers});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),scenes_persons_PersonDisplay__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/scenes/persons/PersonDisplay.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_queries_nodes_DataTable_DataTable__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/queries/nodes/DataTable/DataTable.tsx"),_queries_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/queries/utils.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/types.ts"),_llmAnalyticsLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../products/llm_analytics/frontend/llmAnalyticsLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let mapPerson=person=>{if(!Array.isArray(person)||0===person.length)return{distinct_id:"",created_at:"",properties:{}};let[distinctId,createdAt,propertiesJson]=person,properties={};try{properties=JSON.parse(propertiesJson)}catch(e){console.error("Error parsing person properties_json:",e)}return{distinct_id:distinctId,created_at:createdAt,properties}};function LLMAnalyticsUsers(){let{setDates,setShouldFilterTestAccounts,setPropertyFilters}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsLogic__WEBPACK_IMPORTED_MODULE_7__.BK),{usersQuery}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsLogic__WEBPACK_IMPORTED_MODULE_7__.BK);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_queries_nodes_DataTable_DataTable__WEBPACK_IMPORTED_MODULE_4__.w,{query:{...usersQuery,showSavedFilters:!0},setQuery:query=>{if(!(0,_queries_utils__WEBPACK_IMPORTED_MODULE_5__.tE)(query.source)){console.warn("LLMAnalyticsUsers received a non-events query:",query.source);return}let{filters={}}=query.source,{dateRange={}}=filters;setDates(dateRange.date_from||null,dateRange.date_to||null),setShouldFilterTestAccounts(filters.filterTestAccounts||!1),setPropertyFilters(filters.properties||[])},context:{columns:{user:{title:"Person",render:function RenderPerson(x){let person=mapPerson(x.value);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(scenes_persons_PersonDisplay__WEBPACK_IMPORTED_MODULE_2__.I,{person:person,withIcon:!0,noPopover:!0,href:(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.combineUrl)(scenes_urls__WEBPACK_IMPORTED_MODULE_3__.j.llmAnalyticsTraces(),{filters:[{type:_types__WEBPACK_IMPORTED_MODULE_6__.FT.HogQL,key:`distinct_id == '${person.distinct_id}'`,value:null}]}).url})}},first_seen:{title:"First Seen"},last_seen:{title:"Last Seen"},traces:{title:"Traces (count)"},generations:{title:"Generations (count)"},total_cost:{title:"Total Cost (USD)",render:function RenderCost(_ref){let{value}=_ref;return value&&Number(value)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("span",{children:["$",Number(value).toFixed(4)]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("span",{children:"N/A"})}}}},uniqueKey:"llm-analytics-users"})}},"../../products/llm_analytics/frontend/datasets/LLMAnalyticsDatasetsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMAnalyticsDatasetsScene:()=>LLMAnalyticsDatasetsScene,scene:()=>scene});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),lib_lemon_ui_Link__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),lib_lemon_ui_ProfilePicture__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_scenes_components_SceneContent__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),_layout_scenes_components_SceneDivider__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),_layout_scenes_components_SceneTitleSection__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),_lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),_lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),_lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../products/llm_analytics/frontend/datasets/llmAnalyticsDatasetsLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:LLMAnalyticsDatasetsScene,logic:_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.x};function LLMAnalyticsDatasetsScene(){let{setFilters,deleteDataset}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.x),{datasets,datasetsLoading,sorting,pagination,filters,datasetCountLabel}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.x),columns=[{title:"Name",dataIndex:"name",key:"name",width:"20%",render:function renderName(_,dataset){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_Link__WEBPACK_IMPORTED_MODULE_3__.r,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.llmAnalyticsDataset(dataset.id),"data-testid":"dataset-link",children:dataset.name})}},{title:"Description",dataIndex:"description",key:"description",width:"50%",render:function renderDescription(description){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{className:"text-muted",children:description||(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("i",{children:"–"})})}},{title:"Created by",dataIndex:"created_by",render:function renderCreatedBy(_,item){let{created_by}=item;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"flex flex-row items-center flex-nowrap",children:created_by&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_ProfilePicture__WEBPACK_IMPORTED_MODULE_4__.Y,{user:created_by,size:"md",showName:!0})})}},(0,_lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_11__.rw)(),(0,_lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_11__.yI)(),{width:0,render:function renderMore(_,dataset){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_2__.T,{overlay:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.llmAnalyticsDataset(dataset.id),"data-attr":`dataset-item-${dataset.id}-dropdown-view`,fullWidth:!0,children:"View"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{status:"danger",onClick:()=>deleteDataset(dataset.id),"data-attr":`dataset-item-${dataset.id}-dropdown-delete`,fullWidth:!0,children:"Delete"})]})})}}];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_layout_scenes_components_SceneContent__WEBPACK_IMPORTED_MODULE_6__._,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_layout_scenes_components_SceneTitleSection__WEBPACK_IMPORTED_MODULE_8__.s,{name:"Datasets",resourceType:{type:"llm_analytics"},actions:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{type:"primary",to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.llmAnalyticsDataset("new"),"data-testid":"create-dataset-button",size:"small",children:"New dataset"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_layout_scenes_components_SceneDivider__WEBPACK_IMPORTED_MODULE_7__.V,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex gap-x-4 gap-y-2 items-center flex-wrap py-4 -mt-4 mb-4 border-b justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_9__.D,{type:"search",placeholder:"Search datasets...",value:filters.search,onChange:value=>setFilters({search:value}),className:"max-w-md","data-testid":"search-datasets-input"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"text-muted-alt",children:datasetCountLabel})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_10__.g,{loading:datasetsLoading,columns:columns,dataSource:datasets.results,pagination:pagination,noSortingCancellation:!0,sorting:sorting,onSort:newSorting=>setFilters({order_by:newSorting?`${-1===newSorting.order?"-":""}${newSorting.columnKey}`:void 0}),rowKey:"id",loadingSkeletonRows:_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.R,nouns:["dataset","datasets"]})]})}},"../../products/llm_analytics/frontend/datasets/llmAnalyticsDatasetsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>DATASETS_PER_PAGE,x:()=>llmAnalyticsDatasetsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),_lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/api.ts"),_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),_lib_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils.tsx"),_scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/sceneLogic.tsx"),_scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/urls.ts");let DATASETS_PER_PAGE=30;function cleanFilters(values){return{page:parseInt(String(values.page))||1,search:String(values.search||""),order_by:values.order_by||"-created_at"}}let llmAnalyticsDatasetsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","llm-analytics","llmAnalyticsDatasetsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:function(filters){let merge=!(arguments.length>1)||void 0===arguments[1]||arguments[1],debounce=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return{filters,merge,debounce}},loadDatasets:function(){let debounce=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return{debounce}},deleteDataset:datasetId=>({datasetId})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({rawFilters:[null,{setFilters:(state,_ref)=>{let{filters,merge}=_ref;return cleanFilters({...merge&&state||{},...filters,..."page"in filters?{}:{page:1}})}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values}=_ref2;return{datasets:[{results:[],count:0,offset:0},{loadDatasets:async(_ref3,breakpoint)=>{let{debounce}=_ref3;debounce&&values.datasets.results.length>0&&await breakpoint(300);let{filters}=values,params={search:filters.search,order_by:filters.order_by,offset:Math.max(0,(filters.page-1)*DATASETS_PER_PAGE),limit:DATASETS_PER_PAGE};return _scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_6__.k.findMounted()?.values.activeSceneId==="LLMAnalyticsDatasets"&&"POP"!==kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.lastMethod&&values.datasets.results.length>0&&values.rawFilters?.page!==filters.page&&window.scrollTo(0,0),await _lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.datasets.list(params)}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({filters:[s=>[s.rawFilters],rawFilters=>cleanFilters(rawFilters||{})],count:[s=>[s.datasets],datasets=>datasets.count],sorting:[s=>[s.filters],filters=>filters.order_by?filters.order_by.startsWith("-")?{columnKey:filters.order_by.slice(1),order:-1}:{columnKey:filters.order_by,order:1}:{columnKey:"updated_at",order:-1}],pagination:[s=>[s.filters,s.count],(filters,count)=>({controlled:!0,pageSize:DATASETS_PER_PAGE,currentPage:filters.page,entryCount:count})],datasetCountLabel:[s=>[s.filters,s.count],(filters,count)=>{let start=(filters.page-1)*DATASETS_PER_PAGE+1,end=Math.min(filters.page*DATASETS_PER_PAGE,count);return 0===count?"0 datasets":`${start}-${end} of ${count} dataset${1===count?"":"s"}`}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{asyncActions,values,selectors}=_ref4;return{setFilters:async(_ref5,_,__,previousState)=>{let{debounce}=_ref5,oldFilters=selectors.filters(previousState),{filters}=values;(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(oldFilters,filters)||await asyncActions.loadDatasets(debounce)},deleteDataset:async _ref6=>{let{datasetId}=_ref6;try{let datasetName=values.datasets.results.find(dataset=>dataset.id===datasetId)?.name;await _lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.datasets.update(datasetId,{deleted:!0}),_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.info(`${datasetName||"Dataset"} has been deleted.`),await asyncActions.loadDatasets(!1)}catch{_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Failed to delete dataset")}}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.actionToUrl)(_ref7=>{let{values}=_ref7;return{setFilters:()=>{let nextValues=cleanFilters(values.filters),urlValues=cleanFilters(kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.searchParams);if(!(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(nextValues,urlValues))return[_scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.llmAnalyticsDatasets(),nextValues,{},{replace:!1}]}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.urlToAction)(_ref8=>{let{actions,values}=_ref8;return{[_scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.llmAnalyticsDatasets()]:(_,searchParams)=>{let newFilters=cleanFilters(searchParams);null!==values.rawFilters&&(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(values.filters,newFilters)||actions.setFilters(newFilters,!1)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref9=>{let{actions}=_ref9;actions.loadDatasets()})])},"../../products/llm_analytics/frontend/evaluations/llmEvaluationsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>llmEvaluationsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_api__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx");let llmEvaluationsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","llm_analytics","evaluations","llmEvaluationsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadEvaluations:!0,loadEvaluationsSuccess:evaluations=>({evaluations}),createEvaluation:evaluation=>({evaluation}),createEvaluationSuccess:evaluation=>({evaluation}),updateEvaluation:(id,evaluation)=>({id,evaluation}),updateEvaluationSuccess:(id,evaluation)=>({id,evaluation}),deleteEvaluation:id=>({id}),deleteEvaluationSuccess:id=>({id}),duplicateEvaluation:id=>({id}),duplicateEvaluationSuccess:evaluation=>({evaluation}),toggleEvaluationEnabled:id=>({id}),toggleEvaluationEnabledSuccess:id=>({id}),setEvaluationsFilter:filter=>({filter})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({evaluations:[[],{loadEvaluationsSuccess:(_,_ref)=>{let{evaluations}=_ref;return evaluations},createEvaluationSuccess:(state,_ref2)=>{let{evaluation}=_ref2;return[...state,evaluation]},updateEvaluationSuccess:(state,_ref3)=>{let{id,evaluation}=_ref3;return state.map(e=>e.id===id?{...e,...evaluation}:e)},deleteEvaluationSuccess:(state,_ref4)=>{let{id}=_ref4;return state.filter(e=>e.id!==id)},duplicateEvaluationSuccess:(state,_ref5)=>{let{evaluation}=_ref5;return[...state,evaluation]},toggleEvaluationEnabledSuccess:(state,_ref6)=>{let{id}=_ref6;return state.map(e=>e.id===id?{...e,enabled:!e.enabled}:e)}}],evaluationsLoading:[!1,{loadEvaluations:()=>!0,loadEvaluationsSuccess:()=>!1}],evaluationsFilter:["",{setEvaluationsFilter:(_,_ref7)=>{let{filter}=_ref7;return filter}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref8=>{let{actions,values}=_ref8;return{loadEvaluations:async()=>{try{let teamId=scenes_teamLogic__WEBPACK_IMPORTED_MODULE_2__.teamLogic.values.currentTeamId;if(!teamId)return;let response=await lib_api__WEBPACK_IMPORTED_MODULE_1__.ZP.get(`/api/environments/${teamId}/evaluations/`);actions.loadEvaluationsSuccess(response.results)}catch(error){console.error("Failed to load evaluations:",error),actions.loadEvaluationsSuccess([])}},createEvaluation:async _ref9=>{let{evaluation}=_ref9;try{let teamId=scenes_teamLogic__WEBPACK_IMPORTED_MODULE_2__.teamLogic.values.currentTeamId;if(!teamId)return;let response=await lib_api__WEBPACK_IMPORTED_MODULE_1__.ZP.create(`/api/environments/${teamId}/evaluations/`,evaluation);actions.createEvaluationSuccess(response)}catch(error){console.error("Failed to create evaluation:",error)}},updateEvaluation:async _ref10=>{let{id,evaluation}=_ref10;try{let teamId=scenes_teamLogic__WEBPACK_IMPORTED_MODULE_2__.teamLogic.values.currentTeamId;if(!teamId)return;let response=await lib_api__WEBPACK_IMPORTED_MODULE_1__.ZP.update(`/api/environments/${teamId}/evaluations/${id}/`,evaluation);actions.updateEvaluationSuccess(id,response)}catch(error){console.error("Failed to update evaluation:",error)}},deleteEvaluation:async _ref11=>{let{id}=_ref11;try{let teamId=scenes_teamLogic__WEBPACK_IMPORTED_MODULE_2__.teamLogic.values.currentTeamId;if(!teamId)return;await lib_api__WEBPACK_IMPORTED_MODULE_1__.ZP.update(`/api/environments/${teamId}/evaluations/${id}/`,{deleted:!0}),actions.deleteEvaluationSuccess(id)}catch(error){console.error("Failed to delete evaluation:",error)}},duplicateEvaluation:async _ref12=>{let{id}=_ref12;try{let original=values.evaluations.find(e=>e.id===id);if(!original)return;let duplicate={name:`${original.name} (Copy)`,description:original.description,enabled:original.enabled,prompt:original.prompt,conditions:original.conditions},teamId=scenes_teamLogic__WEBPACK_IMPORTED_MODULE_2__.teamLogic.values.currentTeamId;if(!teamId)return;let response=await lib_api__WEBPACK_IMPORTED_MODULE_1__.ZP.create(`/api/environments/${teamId}/evaluations/`,duplicate);actions.duplicateEvaluationSuccess(response)}catch(error){console.error("Failed to duplicate evaluation:",error)}},toggleEvaluationEnabled:async _ref13=>{let{id}=_ref13;try{let evaluation=values.evaluations.find(e=>e.id===id);if(!evaluation)return;let teamId=scenes_teamLogic__WEBPACK_IMPORTED_MODULE_2__.teamLogic.values.currentTeamId;if(!teamId)return;await lib_api__WEBPACK_IMPORTED_MODULE_1__.ZP.update(`/api/environments/${teamId}/evaluations/${id}/`,{enabled:!evaluation.enabled}),actions.toggleEvaluationEnabledSuccess(id)}catch(error){console.error("Failed to toggle evaluation enabled:",error)}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({filteredEvaluations:[s=>[s.evaluations,s.evaluationsFilter],(evaluations,filter)=>filter?evaluations.filter(e=>e.name.toLowerCase().includes(filter.toLowerCase())||e.description?.toLowerCase().includes(filter.toLowerCase())||e.prompt.toLowerCase().includes(filter.toLowerCase())):evaluations]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref14=>{let{actions}=_ref14;actions.loadEvaluations()})])}}]);