(window.webpackJsonp=window.webpackJsonp||[]).push([[251],{"./frontend/src/scenes/feature-flags/FeatureFlag.tsx":function(Y,x,n){"use strict";n.r(x),n.d(x,"scene",function(){return yt}),n.d(x,"FeatureFlag",function(){return M});var k=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),le=n.n(k),Kt=n("./node_modules/core-js/modules/es.array.map.js"),Bt=n("./node_modules/core-js/modules/es.object.to-string.js"),wt=n("./node_modules/core-js/modules/es.regexp.to-string.js"),Dt=n("./node_modules/core-js/modules/es.array.concat.js"),O=n("./node_modules/react/index.js"),e=n.n(O),oe=n("./node_modules/kea-forms/lib/index.js"),N=n("./node_modules/antd/es/row/index.js"),h=n("./node_modules/antd/es/col/index.js"),G=n("./node_modules/antd/es/collapse/index.js"),Ve=n("./node_modules/antd/es/popconfirm/index.js"),Pe=n("./node_modules/antd/es/radio/index.js"),ie=n("./node_modules/antd/es/button/index.js"),Me=n("./node_modules/antd/es/slider/index.js"),se=n("./node_modules/antd/es/input-number/index.js"),X=n("./node_modules/antd/es/select/index.js"),ue=n("./node_modules/antd/es/card/index.js"),v=n("./node_modules/kea/lib/index.esm.js"),V=n("./frontend/src/lib/utils.tsx"),Re=n("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),K=n("./node_modules/@ant-design/icons/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),$e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917.7 148.8l-42.4-42.4c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-76.1 76.1a199.27 199.27 0 00-112.1-34.3c-51.2 0-102.4 19.5-141.5 58.6L432.3 308.7a8.03 8.03 0 000 11.3L704 591.7c1.6 1.6 3.6 2.3 5.7 2.3 2 0 4.1-.8 5.7-2.3l101.9-101.9c68.9-69 77-175.7 24.3-253.5l76.1-76.1c3.1-3.2 3.1-8.3 0-11.4zM578.9 546.7a8.03 8.03 0 00-11.3 0L501 613.3 410.7 523l66.7-66.7c3.1-3.1 3.1-8.2 0-11.3L441 408.6a8.03 8.03 0 00-11.3 0L363 475.3l-43-43a7.85 7.85 0 00-5.7-2.3c-2 0-4.1.8-5.7 2.3L206.8 534.2c-68.9 68.9-77 175.7-24.3 253.5l-76.1 76.1a8.03 8.03 0 000 11.3l42.4 42.4c1.6 1.6 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3l76.1-76.1c33.7 22.9 72.9 34.3 112.1 34.3 51.2 0 102.4-19.5 141.5-58.6l101.9-101.9c3.1-3.1 3.1-8.2 0-11.3l-43-43 66.7-66.7c3.1-3.1 3.1-8.2 0-11.3l-36.6-36.2z"}}]},name:"api",theme:"filled"},Ge=$e,ce=n("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),de=function(t,l){return O.createElement(ce.a,Object(K.a)(Object(K.a)({},t),{},{ref:l,icon:Ge}))};de.displayName="ApiFilled";var Ke=O.forwardRef(de),Be=n("./node_modules/@ant-design/icons/es/icons/LockOutlined.js"),we={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"merge-cells",theme:"outlined"},De=we,me=function(t,l){return O.createElement(ce.a,Object(K.a)(Object(K.a)({},t),{},{ref:l,icon:De}))};me.displayName="MergeCellsOutlined";var We=O.forwardRef(me),ze=n("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),Wt=n("./node_modules/core-js/modules/es.object.keys.js"),zt=n("./node_modules/core-js/modules/es.symbol.js"),Ut=n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Ht=n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Ue=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),He=n.n(Ue),Je=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),B=n.n(Je),Ye=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),F=n.n(Ye),ke=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),fe=n.n(ke),Xe=n("./node_modules/@babel/runtime/regenerator/index.js"),b=n.n(Xe),Jt=n("./node_modules/core-js/modules/es.regexp.exec.js"),Yt=n("./node_modules/core-js/modules/es.string.match.js"),kt=n("./node_modules/core-js/modules/es.array.splice.js"),Xt=n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Qt=n("./node_modules/core-js/modules/es.array.iterator.js"),Zt=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),qt=n("./node_modules/core-js/modules/es.string.replace.js"),_t=n("./node_modules/core-js/modules/es.function.name.js"),ea=n("./node_modules/core-js/modules/es.array.filter.js"),ta=n("./node_modules/core-js/modules/es.array.find.js"),Q=n("./frontend/src/lib/api.ts"),Z=n("./node_modules/kea-router/lib/index.js"),P=n("./frontend/src/scenes/urls.ts"),ge=n("./frontend/src/scenes/teamLogic.tsx"),w=n("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),pe=n("./frontend/src/models/groupsModel.ts"),ve=n("./frontend/src/lib/components/TaxonomicFilter/types.ts"),Qe=n("./frontend/src/lib/components/lemonToast.tsx"),Ze=n("./frontend/src/lib/utils/eventUsageLogic.ts"),qe=n("./node_modules/kea-loaders/lib/index.js"),_e=["created_at","id"];function ye(a,t){var l=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);t&&(r=r.filter(function(u){return Object.getOwnPropertyDescriptor(a,u).enumerable})),l.push.apply(l,r)}return l}function o(a){for(var t=1;t<arguments.length;t++){var l=arguments[t]!=null?arguments[t]:{};t%2?ye(Object(l),!0).forEach(function(r){fe()(a,r,l[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):ye(Object(l)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(l,r))})}return a}var q={id:null,created_at:null,key:"",name:"",filters:{groups:[{properties:[],rollout_percentage:null}],multivariate:null},deleted:!1,active:!0,created_by:null,is_simple_flag:!1,rollout_percentage:null,ensure_experience_continuity:!1,experiment_set:null},et={key:"",name:"",rollout_percentage:0},tt={variants:[{key:"",name:"",rollout_percentage:100}]},D=Object(v.kea)([Object(v.path)(["scenes","feature-flags","featureFlagLogic"]),Object(v.props)({}),Object(v.key)(function(a){var t=a.id;return t!=null?t:"new"}),Object(v.connect)({values:[ge.a,["currentTeamId"],pe.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]]}),Object(v.actions)({setFeatureFlag:function(t){return{featureFlag:t}},addConditionSet:!0,setAggregationGroupTypeIndex:function(t){return{value:t}},removeConditionSet:function(t){return{index:t}},duplicateConditionSet:function(t){return{index:t}},updateConditionSet:function(t,l,r){return{index:t,newRolloutPercentage:l,newProperties:r}},deleteFeatureFlag:function(t){return{featureFlag:t}},setMultivariateEnabled:function(t){return{enabled:t}},setMultivariateOptions:function(t){return{multivariateOptions:t}},addVariant:!0,removeVariant:function(t){return{index:t}},distributeVariantsEqually:!0}),Object(oe.forms)(function(a){var t=a.actions;return{featureFlag:{defaults:o({},q),errors:function(r){var u,i,m,s=r.key,y=r.filters;return{key:s?(u=s.match)!==null&&u!==void 0&&u.call(s,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key",filters:{multivariate:{variants:y==null||(i=y.multivariate)===null||i===void 0||(m=i.variants)===null||m===void 0?void 0:m.map(function(g){var L,c=g.key;return{key:c?(L=c.match)!==null&&L!==void 0&&L.call(c,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key"}})}}}},submit:function(r){t.saveFeatureFlag(r)}}}}),Object(v.reducers)({featureFlag:[o({},q),{setFeatureFlag:function(t,l){var r=l.featureFlag;if(r.filters.groups){var u=r.filters.groups.map(function(i){return i.properties?o(o({},i),{},{properties:Object(V.s)(i.properties)}):i});return o(o({},r),{},{filters:o(o({},r==null?void 0:r.filters),{},{groups:u})})}return r},addConditionSet:function(t){if(!t)return t;var l=[].concat(F()(t==null?void 0:t.filters.groups),[{properties:[],rollout_percentage:null}]);return o(o({},t),{},{filters:o(o({},t.filters),{},{groups:l})})},updateConditionSet:function(t,l){var r=l.index,u=l.newRolloutPercentage,i=l.newProperties;if(!t)return t;var m=F()(t==null?void 0:t.filters.groups);return u!==void 0&&(m[r]=o(o({},m[r]),{},{rollout_percentage:u})),i!==void 0&&(m[r]=o(o({},m[r]),{},{properties:i})),o(o({},t),{},{filters:o(o({},t.filters),{},{groups:m})})},removeConditionSet:function(t,l){var r=l.index;if(!t)return t;var u=F()(t.filters.groups);return u.splice(r,1),o(o({},t),{},{filters:o(o({},t.filters),{},{groups:u})})},duplicateConditionSet:function(t,l){var r=l.index;if(!t)return t;var u=t.filters.groups.concat([t.filters.groups[r]]);return o(o({},t),{},{filters:o(o({},t.filters),{},{groups:u})})},setMultivariateOptions:function(t,l){var r=l.multivariateOptions;return t&&o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:r})})},addVariant:function(t){var l;if(!t)return t;var r=F()(((l=t.filters.multivariate)===null||l===void 0?void 0:l.variants)||[]);return o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate||{}),{},{variants:[].concat(F()(r),[et])})})})},removeVariant:function(t,l){var r,u=l.index;if(!t)return t;var i=F()(((r=t.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]);return i.splice(u,1),o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate),{},{variants:i})})})},distributeVariantsEqually:function(t){var l;if(!t)return t;var r=F()(((l=t.filters.multivariate)===null||l===void 0?void 0:l.variants)||[]),u=r.length;if(u>0&&u<=100){var i=Math.round(100/u),m=i*u,s=m-100;r.forEach(function(y,g){r[g]=o(o({},y),{},{rollout_percentage:i})}),r[u-1]=o(o({},r[u-1]),{},{rollout_percentage:i-s})}return o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate),{},{variants:r})})})},setAggregationGroupTypeIndex:function(t,l){var r=l.value;return!t||t.filters.aggregation_group_type_index==r?t:o(o({},t),{},{filters:o(o({},t.filters),{},{aggregation_group_type_index:r,groups:[{properties:[],rollout_percentage:null}]})})}}]}),Object(qe.loaders)(function(a){var t=a.values,l=a.props;return{featureFlag:{loadFeatureFlag:function(){var r=B()(b.a.mark(function i(){return b.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(l.id&&l.id!=="new")){s.next=4;break}return s.next=3,Q.b.get("api/projects/".concat(t.currentTeamId,"/feature_flags/").concat(l.id));case 3:return s.abrupt("return",s.sent);case 4:return s.abrupt("return",q);case 5:case"end":return s.stop()}},i)}));function u(){return r.apply(this,arguments)}return u}(),saveFeatureFlag:function(){var r=B()(b.a.mark(function i(m){var s,y,g;return b.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s=m.created_at,y=m.id,g=He()(m,_e),c.prev=1,m.id){c.next=8;break}return c.next=5,Q.b.create("api/projects/".concat(t.currentTeamId,"/feature_flags"),g);case 5:return c.abrupt("return",c.sent);case 8:return c.next=10,Q.b.update("api/projects/".concat(t.currentTeamId,"/feature_flags/").concat(m.id),g);case 10:return c.abrupt("return",c.sent);case 11:c.next=17;break;case 13:throw c.prev=13,c.t0=c.catch(1),(c.t0.code==="behavioral_cohort_found"||c.t0.code==="cohort_does_not_exist")&&Ze.f.actions.reportFailedToCreateFeatureFlagWithCohort(c.t0.code,c.t0.detail),c.t0;case 17:case"end":return c.stop()}},i,null,[[1,13]])}));function u(i){return r.apply(this,arguments)}return u}()}}}),Object(v.listeners)(function(a){var t=a.actions,l=a.values;return{saveFeatureFlagSuccess:function(u){var i,m=u.featureFlag;Qe.d.success("Feature flag saved"),(i=w.a.findMounted())===null||i===void 0||i.actions.updateFlag(m),Z.router.actions.replace(P.a.featureFlag(m.id))},deleteFeatureFlag:function(){var r=B()(b.a.mark(function i(m){var s;return b.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=m.featureFlag,Object(V.x)({endpoint:"projects/".concat(l.currentTeamId,"/feature_flags"),object:{name:s.name,id:s.id},callback:function(){var c,R;s.id&&((c=w.a.findMounted())===null||c===void 0||c.actions.deleteFlag(s.id)),(R=w.a.findMounted())===null||R===void 0||R.actions.loadFeatureFlags(),Z.router.actions.push(P.a.featureFlags())}});case 2:case"end":return g.stop()}},i)}));function u(i){return r.apply(this,arguments)}return u}(),setMultivariateEnabled:function(){var r=B()(b.a.mark(function i(m){var s;return b.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=m.enabled,s?t.setMultivariateOptions(tt):t.setMultivariateOptions(null);case 2:case"end":return g.stop()}},i)}));function u(i){return r.apply(this,arguments)}return u}()}}),Object(v.selectors)({props:[function(){return[function(a,t){return t}]},function(a){return a}],multivariateEnabled:[function(a){return[a.featureFlag]},function(a){return!!(a!=null&&a.filters.multivariate)}],variants:[function(a){return[a.featureFlag]},function(a){var t;return(a==null||(t=a.filters.multivariate)===null||t===void 0?void 0:t.variants)||[]}],nonEmptyVariants:[function(a){return[a.variants]},function(a){return a.filter(function(t){var l=t.key;return!!l})}],variantRolloutSum:[function(a){return[a.variants]},function(a){return a.reduce(function(t,l){var r=l.rollout_percentage;return t+r},0)}],areVariantRolloutsValid:[function(a){return[a.variants,a.variantRolloutSum]},function(a,t){return a.every(function(l){var r=l.rollout_percentage;return r>=0&&r<=100})&&t===100}],aggregationTargetName:[function(a){return[a.featureFlag,a.groupTypes,a.aggregationLabel]},function(a,t,l){return a&&a.filters.aggregation_group_type_index!=null&&t.length>0?l(a.filters.aggregation_group_type_index).plural:"users"}],taxonomicGroupTypes:[function(a){return[a.featureFlag,a.groupsTaxonomicTypes]},function(a,t){return a&&a.filters.aggregation_group_type_index!=null&&t.length>0?[t[a.filters.aggregation_group_type_index]]:[ve.a.PersonProperties,ve.a.Cohorts]}],breadcrumbs:[function(a){return[a.featureFlag]},function(a){return[{name:"Feature Flags",path:P.a.featureFlags()}].concat(F()(a?[{name:a.key||"Unnamed"}]:[]))}]}),Object(Z.urlToAction)(function(a){var t,l=a.actions,r=a.props;return fe()({},P.a.featureFlag((t=r.id)!==null&&t!==void 0?t:"new"),function(u,i,m,s){var y=s.method;y==="PUSH"&&(r.id?l.loadFeatureFlag():l.resetFeatureFlag())})}),Object(v.afterMount)(function(a){var t,l=a.props,r=a.actions,u=(t=w.a.findMounted())===null||t===void 0?void 0:t.values.featureFlags.find(function(i){return i.id===l.id});u?r.setFeatureFlag(u):l.id!=="new"&&r.loadFeatureFlag()})]),at=n("./frontend/src/lib/components/PageHeader.tsx"),nt=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),rt=n.n(nt),lt=n("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss"),he=n.n(lt),_={};_.insert="head",_.singleton=!1;var aa=rt()(he.a,_),na=he.a.locals||{},j=n("./frontend/src/lib/components/icons.tsx"),W=n("./frontend/src/lib/components/Tooltip.tsx"),I=n("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),z="?utm_medium=in-product&utm_campaign=feature-flag";function U(a){var t=a.flagKey;return e.a.createElement(e.a.Fragment,null,e.a.createElement(I.a,{language:I.b.JavaScript,wrap:!0},"if\xA0(posthog.isFeatureEnabled('".concat(t!=null?t:"",`')) {
    // run your activation code here
}`)),e.a.createElement("div",{className:"mt"},"Need more information?"," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/js-integration".concat(z,"#feature-flags")},"Check the docs ",e.a.createElement(j.IconOpenInNew,null))))}function H(a){var t=a.flagKey;return e.a.createElement(e.a.Fragment,null,e.a.createElement(I.a,{language:I.b.Python,wrap:!0},'if\xA0posthog.feature_enabled("'.concat(t,`", "user_distinct_id"):
    runAwesomeFeature()
`)),e.a.createElement("div",{className:"mt"},"Need more information?"," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/python-integration".concat(z,"#feature-flags")},"Check the docs ",e.a.createElement(j.IconOpenInNew,null))))}function ot(){var a=Object(v.useValues)(ge.a),t=a.currentTeam;return e.a.createElement(e.a.Fragment,null,e.a.createElement(I.a,{language:I.b.Bash,wrap:!0},"curl ".concat(window.location.origin,`/decide/ \\
-X POST -H 'Content-Type: application/json' \\
-d '{
    "api_key": "`).concat(t?t.api_token:"[project_api_key]",`",
    "distinct_id": "[user distinct id]"
}'
                `)),e.a.createElement("div",{className:"mt"},"Need more information?"," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/api/feature-flags".concat(z)},"Check the docs ",e.a.createElement(j.IconOpenInNew,null))))}try{U.displayName="JSSnippet",U.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:U.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(a){}try{H.displayName="PythonSnippet",H.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:H.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(a){}var Ee=n("./frontend/src/lib/components/LemonDivider/index.ts"),it=n("./frontend/src/lib/introductions/GroupsIntroductionOption.tsx"),Fe=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),st=n("./frontend/src/scenes/userLogic.ts"),ee=n("./frontend/src/types.ts"),be=n("./frontend/src/lib/components/Link.tsx"),T=n("./frontend/src/lib/components/LemonButton/index.ts"),ut=n("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),S=n("./frontend/src/lib/forms/Field.tsx"),ct=n("./frontend/src/lib/forms/VerticalForm.tsx"),dt=n("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx"),te=n("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),mt=n("./frontend/src/lib/components/LemonCheckbox/index.ts"),ft=n("./frontend/src/lib/constants.tsx"),gt=n("./frontend/src/lib/logic/featureFlagLogic.ts"),pt=n("./frontend/src/scenes/events/EventBufferNotice.tsx"),vt=n("./frontend/src/lib/components/AlertMessage/index.ts"),yt={component:M,logic:D,paramsToProps:function(t){var l=t.params.id;return{id:l&&l!=="new"?parseInt(l):"new"}}};function je(a){setTimeout(function(){var t;return(t=document.querySelector('.variant-form-list input[data-key-index="'.concat(a,'"]')))===null||t===void 0?void 0:t.focus()},50)}function M(){var a,t,l,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=r.id,i=Object(v.useValues)(D),m=i.props,s=i.featureFlag,y=i.multivariateEnabled,g=i.variants,L=i.nonEmptyVariants,c=i.areVariantRolloutsValid,R=i.variantRolloutSum,ht=i.groupTypes,$=i.aggregationTargetName,Et=i.taxonomicGroupTypes,Se=i.featureFlagLoading,E=Object(v.useActions)(D),Ft=E.addConditionSet,Ce=E.updateConditionSet,bt=E.removeConditionSet,jt=E.duplicateConditionSet,St=E.deleteFeatureFlag,xe=E.setMultivariateEnabled,Ct=E.addVariant,xt=E.removeVariant,Ot=E.distributeVariantsEqually,Tt=E.setAggregationGroupTypeIndex,Oe=Object(v.useValues)(pe.a),Lt=Oe.showGroupsOptions,At=Oe.aggregationLabel,Te=Object(v.useValues)(st.a),ae=Te.hasAvailableFeature,It=Te.upgradeLink,Nt=Object(O.useState)(!1),Le=le()(Nt,2),Ae=Le[0],Vt=Le[1],Pt=Object(O.useState)(!1),Ie=le()(Pt,2),Mt=Ie[0],ne=Ie[1],Rt=Object(it.a)({value:-2}),$t=Object(v.useValues)(gt.a),Gt=$t.featureFlags;return e.a.createElement("div",{className:"feature-flag"},s?e.a.createElement(ct.a,{logic:D,props:m,formKey:"featureFlag",enableFormOnSubmit:!0,className:"space-y"},e.a.createElement(at.a,{title:"Feature Flag",buttons:e.a.createElement("div",{className:"flex-center"},e.a.createElement(S.a,{name:"active"},function(f){var d=f.value,p=f.onChange;return e.a.createElement(ut.a,{checked:d,onChange:p,label:d?e.a.createElement("span",{className:"text-success"},"Enabled"):e.a.createElement("span",{className:"text-danger"},"Disabled")})}),(s==null?void 0:s.id)&&e.a.createElement(T.a,{"data-attr":"delete-flag",status:"danger",type:"secondary",onClick:function(){St(s)},style:{marginRight:16}},"Delete"),e.a.createElement(T.a,{type:"primary","data-attr":"feature-flag-submit",loading:Se,htmlType:"submit"},"Save changes"))}),s.experiment_set&&((a=s.experiment_set)===null||a===void 0?void 0:a.length)>0&&e.a.createElement(vt.a,{type:"warning"},"This feature flag is linked to an experiment. It's recommended to only make changes to this flag"," ",e.a.createElement(be.a,{to:P.a.experiment(s.experiment_set[0])},"using the experiment creation screen.")),e.a.createElement(pt.a,{additionalInfo:", meaning it can take around 60 seconds for some flags to update for recently-identified persons"}),e.a.createElement("h3",{className:"l3 mt"},"General configuration"),e.a.createElement("div",{className:"text-muted mb"},"General settings for your feature flag and integration instructions."),e.a.createElement(N.a,{gutter:16,style:{marginBottom:32}},e.a.createElement(h.a,{span:12},e.a.createElement(S.a,{name:"key",label:"Key (must be unique)",validateStatus:Ae?"warning":void 0,hint:Ae&&u!=="new"?e.a.createElement("small",null,e.a.createElement("b",null,"Warning! "),"Changing this key will",e.a.createElement("a",{href:"https://posthog.com/docs/features/feature-flags".concat(z,"#feature-flag-persistence"),target:"_blank",rel:"noopener"}," ","affect the persistence of your flag ",e.a.createElement(j.IconOpenInNew,null))):void 0},function(f){var d=f.value,p=f.onChange;return e.a.createElement(te.a,{value:d,onChange:function(C){C!==d&&Vt(!0),p(C)},"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),e.a.createElement(S.a,{name:"name",label:"Description"},e.a.createElement(dt.a,{className:"ph-ignore-input","data-attr":"feature-flag-description",placeholder:"Adding a helpful description can ensure others know what this feature is for."})),Gt[ft.h.FEATURE_FLAG_EXPERIENCE_CONTINUITY]&&e.a.createElement(S.a,{name:"ensure_experience_continuity"},function(f){var d=f.value,p=f.onChange;return e.a.createElement("div",{style:{border:"1px solid var(--border)",borderRadius:4}},e.a.createElement(mt.a,{id:"continuity-checkbox",label:e.a.createElement("div",null,"Persist flag across authentication steps"," ",e.a.createElement(Fe.a,{type:"warning"},"Beta")),onChange:function(){return p(!d)},rowProps:{fullWidth:!0},checked:d}),e.a.createElement("div",{className:"text-muted",style:{fontSize:13,marginLeft:"2.5rem",paddingBottom:".75rem",paddingRight:".75rem"}},"If your feature flag is applied prior to an identify or authentication event, use this to ensure that feature flags are not reset after a person is identified. This ensures the experience for the anonymous person is carried forward to the authenticated person. Currently supported for posthog-js only."))})),e.a.createElement(h.a,{span:12,style:{paddingTop:31}},e.a.createElement(G.a,null,e.a.createElement(G.a.Panel,{header:e.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},e.a.createElement(j.IconJavascript,{style:{marginRight:6}})," Javascript integration instructions"),key:"js"},e.a.createElement(U,{flagKey:s.key||"my-flag"})),e.a.createElement(G.a.Panel,{header:e.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},e.a.createElement(j.IconPython,{style:{marginRight:6}})," Python integration instructions"),key:"python"},e.a.createElement(H,{flagKey:s.key||"my-flag"})),e.a.createElement(G.a.Panel,{header:e.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},e.a.createElement(Ke,{style:{marginRight:6}})," API integration instructions"),key:"api"},e.a.createElement(ot,null))))),e.a.createElement("div",{className:"mb-2"},e.a.createElement("h3",{className:"l3"},"Served value"),e.a.createElement("div",{className:"mb-05"},e.a.createElement(Ve.a,{placement:"top",title:"Change value type? The variants below will be lost.",visible:Mt,onConfirm:function(){xe(!1),ne(!1)},onCancel:function(){return ne(!1)},okText:"OK",cancelText:"Cancel"},e.a.createElement(Pe.a.Group,{options:[{label:"Boolean value (A/B test)",value:!1},{label:e.a.createElement(W.a,{title:ae(ee.d.MULTIVARIATE_FLAGS)?"":"This feature is not available on your current plan."},e.a.createElement("div",null,!ae(ee.d.MULTIVARIATE_FLAGS)&&e.a.createElement(be.a,{to:It,target:"_blank"},e.a.createElement(Be.a,{style:{marginRight:4,color:"var(--warning)"}})),"String value (Multivariate test)"," ",e.a.createElement(Fe.a,{type:"warning"},"Beta"))),value:!0,disabled:!ae(ee.d.MULTIVARIATE_FLAGS)}],onChange:function(d){var p=d.target.value;p===!1&&L.length?ne(!0):(xe(p),je(0))},value:y,optionType:"button"}))),e.a.createElement("div",{className:"text-muted mb"},Object(V.j)($)," will be served"," ",y?e.a.createElement(e.a.Fragment,null,e.a.createElement("strong",null,"a variant key")," according to the below distribution"):e.a.createElement("strong",null,e.a.createElement("code",null,"true"))," ","if they match one or more release condition groups."),y&&e.a.createElement("div",{className:"variant-form-list space-y-05"},e.a.createElement(N.a,{gutter:8,className:"label-row"},e.a.createElement(h.a,{span:7},"Variant key"),e.a.createElement(h.a,{span:7},"Description"),e.a.createElement(h.a,{span:9},e.a.createElement("span",null,"Rollout percentage"),e.a.createElement(ie.a,{type:"link",onClick:Ot,icon:e.a.createElement(We,null),style:{padding:"0 0 0 0.5em"},title:"Distribute variants equally"},"Distribute"))),g.map(function(f,d){return e.a.createElement(oe.Group,{key:d,name:["filters","multivariate","variants",d]},e.a.createElement(N.a,{gutter:8},e.a.createElement(h.a,{span:7},e.a.createElement(S.a,{name:"key"},e.a.createElement(te.a,{"data-attr":"feature-flag-variant-key","data-key-index":d.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(d+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}))),e.a.createElement(h.a,{span:7},e.a.createElement(S.a,{name:"name"},e.a.createElement(te.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"}))),e.a.createElement(h.a,{span:7},e.a.createElement(S.a,{name:"rollout_percentage"},e.a.createElement(Me.a,{tooltipPlacement:"top"}))),e.a.createElement(h.a,{span:2},e.a.createElement(S.a,{name:"rollout_percentage"},function(p){var A=p.value,C=p.onChange;return e.a.createElement(se.a,{min:0,max:100,value:A,onChange:function(re){if(re!=null){var Ne=parseInt(re.toString());isNaN(Ne)||C(Ne)}},style:{width:"100%",borderColor:c?void 0:"var(--danger)"}})})),g.length>1&&e.a.createElement(h.a,{span:1},e.a.createElement(W.a,{title:"Delete this variant",placement:"bottomLeft"},e.a.createElement(ie.a,{type:"link",icon:e.a.createElement(ze.a,null),onClick:function(){return xt(d)},style:{color:"var(--danger)"}})))))}),g.length>0&&!c&&e.a.createElement("p",{className:"text-danger"},"Percentage rollouts for variants must sum to 100 (currently ",R,")."),e.a.createElement(T.a,{type:"secondary",onClick:function(){var d=g.length;Ct(),je(d)},style:{margin:"1rem 0"},fullWidth:!0,center:!0},"Add variant"))),e.a.createElement("div",{className:"feature-flag-form-row"},e.a.createElement("div",null,e.a.createElement("h3",{className:"l3"},"Release conditions"),e.a.createElement("div",{className:"text-muted mb"},"Specify the ",$," to which you want to release this flag. Note that condition sets are rolled out independently of each other.")),Lt&&e.a.createElement("div",{className:"centered"},"Match by",e.a.createElement(X.a,{value:((t=s.filters)===null||t===void 0?void 0:t.aggregation_group_type_index)!=null?(l=s.filters)===null||l===void 0?void 0:l.aggregation_group_type_index:-1,onChange:function(d){var p=d!==-1?d:null;Tt(p)},style:{marginLeft:8},"data-attr":"feature-flag-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]}},e.a.createElement(X.a.Option,{key:-1,value:-1},"Users"),ht.map(function(f){return e.a.createElement(X.a.Option,{key:f.group_type_index,value:f.group_type_index},Object(V.j)(At(f.group_type_index).plural))}),Rt))),e.a.createElement(N.a,{gutter:16},s.filters.groups.map(function(f,d){var p,A;return e.a.createElement(h.a,{span:24,md:24,key:"".concat(d,"-").concat(s.filters.groups.length)},d>0&&e.a.createElement("div",{style:{display:"flex",marginLeft:16}},e.a.createElement("div",{className:"stateful-badge or-light-grey mb"},"OR")),e.a.createElement(ue.a,{style:{marginBottom:16}},e.a.createElement("div",{className:"feature-flag-form-row",style:{height:24}},e.a.createElement("div",null,e.a.createElement("span",{className:"simple-tag tag-light-blue",style:{marginRight:8}},"Set ",d+1),(p=f.properties)!==null&&p!==void 0&&p.length?e.a.createElement(e.a.Fragment,null,"Matching ",e.a.createElement("b",null,$)," with filters"):e.a.createElement(e.a.Fragment,null,"Condition set will match ",e.a.createElement("b",null,"all ",$))),e.a.createElement(N.a,{align:"middle"},e.a.createElement(W.a,{title:"Duplicate this condition set",placement:"bottomLeft"},e.a.createElement(T.a,{icon:e.a.createElement(j.IconCopy,null),size:"small",onClick:function(){return jt(d)}})),s.filters.groups.length>1&&e.a.createElement(W.a,{title:"Delete this condition set",placement:"bottomLeft"},e.a.createElement(T.a,{icon:e.a.createElement(j.IconDelete,null),size:"small",onClick:function(){return bt(d)}})))),e.a.createElement(Ee.a,{large:!0}),e.a.createElement("div",{className:"ml"},e.a.createElement(Re.a,{pageKey:"feature-flag-".concat(s.id,"-").concat(d,"-").concat(s.filters.groups.length,"-").concat((A=s.filters.aggregation_group_type_index)!==null&&A!==void 0?A:""),propertyFilters:f==null?void 0:f.properties,onChange:function(J){return Ce(d,void 0,J)},taxonomicGroupTypes:Et,showConditionBadge:!0,useLemonButton:!0})),e.a.createElement(Ee.a,{large:!0}),e.a.createElement("div",{className:"feature-flag-form-row"},e.a.createElement("div",{className:"centered"},"Roll out to"," ",e.a.createElement(se.a,{style:{width:100,marginLeft:8,marginRight:8},onChange:function(J){Ce(d,J)},value:f.rollout_percentage!=null?f.rollout_percentage:100,min:0,max:100,addonAfter:"%"})," ","of ",e.a.createElement("b",null,$)," in this set"))))})),e.a.createElement(ue.a,{size:"small",style:{marginBottom:16}},e.a.createElement(T.a,{onClick:Ft,fullWidth:!0},"Add condition set")),e.a.createElement("div",{className:"text-right"},e.a.createElement(T.a,{htmlType:"submit",loading:Se,type:"primary","data-attr":"feature-flag-submit-bottom"},"Save changes"))):e.a.createElement(V.b,null))}try{M.displayName="FeatureFlag",M.__docgenInfo={description:"",displayName:"FeatureFlag",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"]={docgenInfo:M.__docgenInfo,name:"FeatureFlag",path:"frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"})}catch(a){}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss":function(Y,x,n){var k=n("./node_modules/css-loader/dist/runtime/api.js");x=k(!1),x.push([Y.i,".variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}.feature-flag-form-row{display:flex;justify-content:space-between;align-items:center;width:100%}.feature-flag-form-row .centered{display:flex;align-items:center;white-space:pre-wrap}",""]),Y.exports=x}}]);
