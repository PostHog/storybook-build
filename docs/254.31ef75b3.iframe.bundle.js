(window.webpackJsonp=window.webpackJsonp||[]).push([[254],{"./frontend/src/scenes/annotations/index.tsx":function(w,I,n){"use strict";n.r(I),n.d(I,"scene",function(){return Cn}),n.d(I,"Annotations",function(){return k});var U=n("./node_modules/@babel/runtime/regenerator/index.js"),v=n.n(U),W=n("./node_modules/regenerator-runtime/runtime.js"),F=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),C=n.n(F),G=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),h=n.n(G),b=n("./node_modules/react/index.js"),e=n.n(b),T=n("./node_modules/kea/lib/index.esm.js"),q=n("./node_modules/antd/es/input/index.js"),R=n("./node_modules/antd/es/tag/index.js"),L=n("./node_modules/antd/es/button/index.js"),_=n("./node_modules/antd/es/modal/index.js"),nn=n("./node_modules/antd/es/dropdown/index.js"),J=n("./node_modules/antd/es/menu/index.js"),en=n("./node_modules/antd/es/row/index.js"),Q=n("./frontend/src/models/annotationsModel.ts"),Tn=n("./node_modules/core-js/modules/es.array.concat.js"),Rn=n("./node_modules/core-js/modules/es.array.iterator.js"),Nn=n("./node_modules/core-js/modules/es.object.to-string.js"),Dn=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),tn=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),an=n.n(tn),on=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),X=n.n(on),$=n("./frontend/src/lib/api.ts"),Z=n("./frontend/src/lib/utils.tsx"),B=n("./frontend/src/scenes/teamLogic.ts"),K=Object(T.kea)({path:["scenes","annotations","logic"],loaders:function(o){var t=o.actions;return{annotations:{__default:[],loadAnnotations:function(){var c=C()(v.a.mark(function l(){var d;return v.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,$.a.get("api/projects/".concat(B.a.values.currentTeamId,"/annotations/?").concat(Object(Z.Ab)({order:"-updated_at"})));case 2:return d=r.sent,t.setNext(d.next),r.abrupt("return",d.results);case 5:case"end":return r.stop()}},l)}));function i(){return c.apply(this,arguments)}return i}()}}},reducers:function(){return{annotations:[[],{appendAnnotations:function(t,c){var i=c.annotations;return[].concat(X()(t),X()(i))}}],next:[null,{setNext:function(t,c){var i=c.next;return i}}],loadingNext:[!1,{loadAnnotationsNext:function(){return!0},appendAnnotations:function(){return!1}}]}},actions:function(){return{updateAnnotation:function(t,c){return{id:t,content:c}},deleteAnnotation:function(t){return{id:t}},restoreAnnotation:function(t){return{id:t}},loadAnnotationsNext:function(){return!0},setNext:function(t){return{next:t}},appendAnnotations:function(t){return{annotations:t}}}},listeners:function(o){var t=o.actions,c=o.values;return an()({updateAnnotation:function(){var i=C()(v.a.mark(function d(m){var r,p;return v.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return r=m.id,p=m.content,O.next=3,$.a.update("api/projects/".concat(B.a.values.currentTeamId,"/annotations/").concat(r),{content:p});case 3:t.loadAnnotations();case 4:case"end":return O.stop()}},d)}));function l(d){return i.apply(this,arguments)}return l}(),restoreAnnotation:function(){var i=C()(v.a.mark(function d(m){var r;return v.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r=m.id,u.next=3,$.a.update("api/projects/".concat(B.a.values.currentTeamId,"/annotations/").concat(r),{deleted:!1});case 3:t.loadAnnotations();case 4:case"end":return u.stop()}},d)}));function l(d){return i.apply(this,arguments)}return l}(),deleteAnnotation:function(l){var d=l.id;Object(Z.x)({endpoint:"projects/".concat(B.a.values.currentTeamId,"/annotations"),object:{name:"Annotation",id:d},callback:function(){return t.loadAnnotations()}})},loadAnnotationsNext:function(){var i=C()(v.a.mark(function d(){var m,r;return v.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(m=[],!c.next){u.next=7;break}return u.next=4,$.a.get(c.next);case 4:r=u.sent,t.setNext(r.next),m=r.results;case 7:t.appendAnnotations(m);case 8:case"end":return u.stop()}},d)}));function l(){return i.apply(this,arguments)}return l}()},Q.a.actionTypes.createGlobalAnnotationSuccess,function(){t.loadAnnotations()})},events:function(o){var t=o.actions;return{afterMount:function(){return t.loadAnnotations()}}}}),rn=n("./node_modules/@ant-design/icons/es/icons/ProjectOutlined.js"),sn=n("./node_modules/@ant-design/icons/es/icons/DeploymentUnitOutlined.js"),ln=n("./node_modules/@ant-design/icons/es/icons/DownOutlined.js"),dn=n("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),cn=n("./node_modules/@ant-design/icons/es/icons/RedoOutlined.js"),un=n("./frontend/src/lib/constants.tsx"),mn=n("./frontend/src/lib/components/PageHeader.tsx"),fn=n("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),S=n("./frontend/src/types.ts"),vn=n("./node_modules/rc-picker/lib/generate/dayjs.js"),An=n.n(vn),jn=n("./node_modules/antd/lib/date-picker/generatePicker/index.js"),pn=n.n(jn),M=n("./frontend/src/lib/dayjs.ts"),gn=n("./frontend/src/lib/components/Spinner/Spinner.tsx"),En=n("./frontend/src/lib/components/LemonTable/index.ts"),yn=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),bn=n("./frontend/src/lib/components/TimezoneAware/index.tsx"),xn=pn()(An.a),On=q.a.TextArea,Cn={component:k,logic:K};function k(){var a=Object(T.useValues)(K),o=a.annotations,t=a.annotationsLoading,c=a.next,i=a.loadingNext,l=Object(T.useActions)(K),d=l.updateAnnotation,m=l.deleteAnnotation,r=l.loadAnnotationsNext,p=l.restoreAnnotation,u=Object(T.useActions)(Q.a),O=u.createGlobalAnnotation,N=Object(b.useState)(!1),z=h()(N,2),V=z[0],D=z[1],H=Object(b.useState)(null),Y=h()(H,2),y=Y[0],g=Y[1],E=[{title:"Annotation",key:"annotation",width:"30%",render:function(A,s){return e.a.createElement("div",{className:"ph-no-capture",style:{width:"auto",maxWidth:250}},s.content)}},{title:"For date",dataIndex:"date_marker",render:function(A,s){return e.a.createElement("span",null,Object(M.a)(s.date_marker).format("MMMM DD, YYYY"))},sorter:function(A,s){return Object(M.a)(A.date_marker).diff(s.date_marker)}},Object(yn.b)(),{title:"Last updated",dataIndex:"updated_at",render:function(A,s){return e.a.createElement(bn.b,{time:s.updated_at})},sorter:function(A,s){return Object(M.a)(A.date_marker).diff(s.date_marker)}},{title:"Status",render:function(A,s){return s.deleted?e.a.createElement(R.a,{color:"red"},"Deleted"):e.a.createElement(R.a,{color:"green"},"Active")}},{title:"Scope",render:function(A,s){return s.scope===S.b.Insight?e.a.createElement(R.a,{color:"blue"},"Insight"):s.scope===S.b.Project?e.a.createElement(R.a,{color:"purple"},"Project"):s.scope===S.b.Organization?e.a.createElement(R.a,{color:"pink"},"Organization"):e.a.createElement(R.a,null,"Unknown (",s.scope,")")}}];function P(){D(!1),setTimeout(function(){return g(null)},500)}return e.a.createElement("div",null,e.a.createElement(mn.a,{title:"Annotations",caption:"Here you can add organization- and project-wide annotations. Dashboard-specific ones can be added directly in the dashboard.",buttons:e.a.createElement(L.a,{type:"primary","data-attr":"create-annotation",onClick:function(){return D(!0)},icon:e.a.createElement(fn.a,null)},"New Annotation")}),e.a.createElement("div",null,e.a.createElement(En.a,{"data-attr":"annotations-table",rowKey:"id",rowClassName:"cursor-pointer",dataSource:o,columns:E,loading:t,onRow:function(A){return{onClick:function(){g(A),D(!0)}}},emptyState:"No annotations yet"}),e.a.createElement("div",{style:{visibility:c?"visible":"hidden",margin:"2rem auto 5rem",textAlign:"center"}},i?e.a.createElement(gn.a,{size:"sm"}):e.a.createElement(L.a,{type:"primary",onClick:function(){r()}},"Load more annotations"))),e.a.createElement(hn,{visible:V,onCancel:function(){P()},onSubmit:function(){var f=C()(v.a.mark(function A(s,Sn){return v.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(j.t0=y,!j.t0){j.next=5;break}return j.next=4,y;case 4:j.t0=j.sent;case 5:if(!j.t0){j.next=9;break}d(y.id,s),j.next=10;break;case 9:O(s,Sn.format("YYYY-MM-DD"));case 10:P();case 11:case"end":return j.stop()}},A)}));return function(A,s){return f.apply(this,arguments)}}(),onDelete:function(){y&&m(y.id),P()},onRestore:function(){y&&p(y.id),P()},annotation:y}))}var x;(function(a){a[a.CREATE=0]="CREATE",a[a.EDIT=1]="EDIT"})(x||(x={}));function hn(a){var o,t=Object(b.useState)(S.b.Project),c=h()(t,2),i=c[0],l=c[1],d=Object(b.useState)(""),m=h()(d,2),r=m[0],p=m[1],u=Object(b.useState)(x.CREATE),O=h()(u,2),N=O[0],z=O[1],V=Object(b.useState)(Object(M.a)()),D=h()(V,2),H=D[0],Y=D[1];Object(b.useEffect)(function(){a.annotation?(z(x.EDIT),p(a.annotation.content)):(z(x.CREATE),p(""))},[a.annotation]);var y=function(E,P){a.onSubmit(E,P),p(""),Y(Object(M.a)()),l(S.b.Project)};return e.a.createElement(_.a,{footer:[e.a.createElement(L.a,{key:"create-annotation-cancel",onClick:function(){return a.onCancel()}},"Cancel"),e.a.createElement(L.a,{type:"primary",key:"create-annotation-submit","data-attr":"create-annotation-submit",onClick:function(){y(r,H)}},N===x.CREATE?"Submit":"Update")],closable:!1,visible:a.visible,onCancel:a.onCancel,title:N===x.CREATE?"Create annotation":"Edit ennotation"},N===x.CREATE?e.a.createElement("span",null,"This annotation will appear on all",e.a.createElement(nn.a,{overlay:e.a.createElement(J.a,{activeKey:i,onSelect:function(E){return l(E.key)}},e.a.createElement(J.a.Item,{key:S.b.Project,icon:e.a.createElement(rn.a,null)},"Project"),e.a.createElement(J.a.Item,{key:S.b.Organization,icon:e.a.createElement(sn.a,null)},"Organization"))},e.a.createElement(L.a,{style:{marginLeft:8,marginRight:8}},un.F.get(i)," ",e.a.createElement(ln.a,null)))," ","charts"):e.a.createElement(en.a,{justify:"space-between"},e.a.createElement("span",null,"Change existing annotation text"),!((o=a.annotation)===null||o===void 0)&&o.deleted?e.a.createElement(cn.a,{className:"button-border clickable",onClick:function(){a.onRestore()}}):e.a.createElement(dn.a,{className:"text-danger",onClick:function(){a.onDelete()}})),e.a.createElement("br",null),N===x.CREATE&&e.a.createElement("div",null,"Date:",e.a.createElement(xn,{style:{marginTop:16,marginLeft:8,marginBottom:16},getPopupContainer:function(E){return E.parentElement},value:H,onChange:function(E){return Y(E)},allowClear:!1})),e.a.createElement(On,{"data-attr":"create-annotation-input",maxLength:300,style:{marginBottom:12,marginTop:5},rows:4,value:r,onChange:function(E){return p(E.target.value)}}))}},"./node_modules/@ant-design/icons/es/icons/RedoOutlined.js":function(w,I,n){"use strict";var U=n("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),v=n("./node_modules/react/index.js"),W={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"}}]},name:"redo",theme:"outlined"},F=W,C=n("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),G=function(e,T){return v.createElement(C.a,Object(U.a)(Object(U.a)({},e),{},{ref:T,icon:F}))};G.displayName="RedoOutlined";var h=I.a=v.forwardRef(G)}}]);
