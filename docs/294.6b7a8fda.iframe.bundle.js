(window.webpackJsonp=window.webpackJsonp||[]).push([[294],{"./frontend/src/lib/hooks/useAnchor.ts":function(sn,q,n){"use strict";n.d(q,"a",function(){return Oe});var le=n("./node_modules/react/index.js"),Ce=n.n(le);function Oe(Z){Object(le.useEffect)(function(){if(Z&&document.getElementById(Z.substr(1))){var ce=document.getElementById(Z.substr(1));if(!ce)return;ce.classList.add("highlighted");var We=ce.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:We-50-32,behavior:"smooth"})}},[Z])}},"./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx":function(sn,q,n){"use strict";n.d(q,"a",function(){return Ye}),n.d(q,"b",function(){return D});var le=n("./node_modules/core-js/modules/es.symbol.js"),Ce=n.n(le),Oe=n("./node_modules/core-js/modules/es.array.filter.js"),Z=n.n(Oe),ce=n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),We=n.n(ce),Ve=n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),un=n.n(Ve),Ne=n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),de=n.n(Ne),Le=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),tn=n.n(Le),Fe=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),we=n.n(Fe),_=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),ee=n.n(_),be=n("./node_modules/@babel/runtime/regenerator/index.js"),ue=n.n(be),Se=n("./node_modules/core-js/modules/es.array.iterator.js"),_e=n.n(Se),ye=n("./node_modules/core-js/modules/es.object.to-string.js"),Ge=n.n(ye),z=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),V=n.n(z),me=n("./node_modules/core-js/modules/es.array.map.js"),e=n.n(me),Ie=n("./node_modules/core-js/modules/es.array.concat.js"),Te=n.n(Ie),Be=n("./node_modules/core-js/modules/es.object.keys.js"),W=n.n(Be),je=n("./node_modules/kea/lib/index.esm.js"),$e=n("./node_modules/kea-loaders/lib/index.js"),rn=n.n($e),fe=n("./frontend/src/lib/api.ts"),S=n("./frontend/src/types.ts"),F=n("./frontend/src/lib/logic/featureFlagLogic.ts"),Me=n("./frontend/src/lib/constants.tsx"),J;function Ee(P,C){var L=Object.keys(P);if(Object.getOwnPropertySymbols){var I=Object.getOwnPropertySymbols(P);C&&(I=I.filter(function(w){return Object.getOwnPropertyDescriptor(P,w).enumerable})),L.push.apply(L,I)}return L}function ge(P){for(var C=1;C<arguments.length;C++){var L=arguments[C]!=null?arguments[C]:{};C%2?Ee(Object(L),!0).forEach(function(I){ee()(P,I,L[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(L)):Ee(Object(L)).forEach(function(I){Object.defineProperty(P,I,Object.getOwnPropertyDescriptor(L,I))})}return P}var ve=ee()({},S.U.FEATURE_FLAGS,"Feature Flags"),Ye=(J={},ee()(J,S.a.WRITE,"View & Edit"),ee()(J,S.a.READ,"View Only"),J),D=Object(je.kea)([Object(je.path)(["scenes","organization","Settings","Permissions","permissionsLogic"]),Object(je.connect)({values:[F.a,["featureFlags"]]}),Object($e.loaders)(function(P){var C=P.values;return{organizationResourcePermissions:[[],{loadOrganizationResourcePermissions:function(){var L=we()(ue.a.mark(function w(){var Q;return ue.a.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,fe.b.resourcePermissions.list();case 2:return Q=B.sent,B.abrupt("return",(Q==null?void 0:Q.results)||[]);case 4:case"end":return B.stop()}},w)}));function I(){return L.apply(this,arguments)}return I}(),updateOrganizationResourcePermission:function(){var L=we()(ue.a.mark(function w(Q){var pe,B,te,Ue,ne;return ue.a.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(pe=Q.id,B=Q.resource,te=Q.access_level,!pe){N.next=8;break}return N.next=4,fe.b.resourcePermissions.update(pe,{access_level:te});case 4:return Ue=N.sent,N.abrupt("return",C.organizationResourcePermissions.map(function(Ke){return Ke.id==Ue.id?Ue:Ke}));case 8:return N.next=10,fe.b.resourcePermissions.create({resource:B,access_level:te});case 10:return ne=N.sent,N.abrupt("return",[].concat(tn()(C.organizationResourcePermissions),[ne]));case 12:case"end":return N.stop()}},w)}));function I(w){return L.apply(this,arguments)}return I}()}]}}),Object(je.selectors)({organizationResourcePermissionsMap:[function(P){return[P.organizationResourcePermissions]},function(P){return P.reduce(function(C,L){return ge(ge({},C),{},ee()({},L.resource,L))},{})}],allPermissions:[function(P){return[P.organizationResourcePermissionsMap]},function(P){return Object.keys(ve).map(function(C){var L,I;return{id:((L=P[C])===null||L===void 0?void 0:L.id)||null,resource:C,name:ve[C],access_level:((I=P[C])===null||I===void 0?void 0:I.access_level)||S.a.WRITE}})}],shouldShowPermissionsTable:[function(P){return[P.featureFlags]},function(P){return P[Me.i.ROLE_BASED_ACCESS]==="control"}]}),Object(je.afterMount)(function(P){var C=P.actions;C.loadOrganizationResourcePermissions()})])},"./frontend/src/scenes/organization/Settings/Roles/rolesLogic.tsx":function(sn,q,n){"use strict";n.d(q,"a",function(){return ln});var le=n("./node_modules/core-js/modules/es.object.keys.js"),Ce=n.n(le),Oe=n("./node_modules/core-js/modules/es.symbol.js"),Z=n.n(Oe),ce=n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),We=n.n(ce),Ve=n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),un=n.n(Ve),Ne=n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),de=n.n(Ne),Le=n("./node_modules/core-js/modules/es.array.slice.js"),tn=n.n(Le),Fe=n("./node_modules/core-js/modules/es.function.name.js"),we=n.n(Fe),_=n("./node_modules/core-js/modules/es.array.from.js"),ee=n.n(_),be=n("./node_modules/core-js/modules/es.regexp.exec.js"),ue=n.n(be),Se=n("./node_modules/core-js/modules/es.symbol.description.js"),_e=n.n(Se),ye=n("./node_modules/core-js/modules/es.symbol.iterator.js"),Ge=n.n(ye),z=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),V=n.n(z),me=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),e=n.n(me),Ie=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),Te=n.n(Ie),Be=n("./node_modules/@babel/runtime/regenerator/index.js"),W=n.n(Be),je=n("./node_modules/core-js/modules/es.array.map.js"),$e=n.n(je),rn=n("./node_modules/core-js/modules/es.array.iterator.js"),fe=n.n(rn),S=n("./node_modules/core-js/modules/es.object.to-string.js"),F=n.n(S),Me=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),J=n.n(Me),Ee=n("./node_modules/core-js/modules/es.array.concat.js"),ge=n.n(Ee),ve=n("./node_modules/core-js/modules/es.array.filter.js"),Ye=n.n(ve),D=n("./node_modules/core-js/modules/es.promise.js"),P=n.n(D),C=n("./node_modules/core-js/modules/es.string.iterator.js"),L=n.n(C),I=n("./node_modules/core-js/modules/es.object.assign.js"),w=n.n(I),Q=n("./node_modules/core-js/modules/es.array.sort.js"),pe=n.n(Q),B=n("./node_modules/kea/lib/index.esm.js"),te=n("./node_modules/kea-loaders/lib/index.js"),Ue=n.n(te),ne=n("./frontend/src/lib/api.ts"),on=n("./frontend/src/scenes/project/Settings/teamMembersLogic.tsx"),N=n("./frontend/src/types.ts");function Ke(i,m){var l=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!l){if(Array.isArray(i)||(l=an(i))||m&&i&&typeof i.length=="number"){l&&(i=l);var O=0,x=function(){};return{s:x,n:function(){return O>=i.length?{done:!0}:{done:!1,value:i[O++]}},e:function(R){throw R},f:x}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var A=!0,h=!1,y;return{s:function(){l=l.call(i)},n:function(){var R=l.next();return A=R.done,R},e:function(R){h=!0,y=R},f:function(){try{!A&&l.return!=null&&l.return()}finally{if(h)throw y}}}}function an(i,m){if(!!i){if(typeof i=="string")return Ze(i,m);var l=Object.prototype.toString.call(i).slice(8,-1);if(l==="Object"&&i.constructor&&(l=i.constructor.name),l==="Map"||l==="Set")return Array.from(i);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return Ze(i,m)}}function Ze(i,m){(m==null||m>i.length)&&(m=i.length);for(var l=0,O=new Array(m);l<m;l++)O[l]=i[l];return O}function He(i,m){var l=Object.keys(i);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(i);m&&(O=O.filter(function(x){return Object.getOwnPropertyDescriptor(i,x).enumerable})),l.push.apply(l,O)}return l}function oe(i){for(var m=1;m<arguments.length;m++){var l=arguments[m]!=null?arguments[m]:{};m%2?He(Object(l),!0).forEach(function(O){Te()(i,O,l[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):He(Object(l)).forEach(function(O){Object.defineProperty(i,O,Object.getOwnPropertyDescriptor(l,O))})}return i}var ln=Object(B.kea)([Object(B.path)(["scenes","organization","rolesLogic"]),Object(B.connect)({values:[on.b,["allMembers"]]}),Object(B.actions)({setCreateRoleModalShown:function(m){return{shown:m}},setRoleInFocus:function(m){return{role:m}},setRoleMembersInFocus:function(m){return{roleMembers:m}},setRoleMembersToAdd:function(m){return{uuids:m}},openCreateRoleModal:!0,setPermission:function(m,l){return{resource:m,access:l}},setPermissionInPlace:function(m,l){return{resource:m,access:l}},clearPermission:!0,updateRole:function(m){return{role:m}}}),Object(B.reducers)({createRoleModalShown:[!1,{setCreateRoleModalShown:function(m,l){var O=l.shown;return O}}],roleInFocus:[null,{setRoleInFocus:function(m,l){var O=l.role;return O}}],roleMembersInFocus:[[],{setRoleMembersInFocus:function(m,l){var O=l.roleMembers;return O}}],roleMembersToAdd:[[],{setRoleMembersToAdd:function(m,l){var O=l.uuids;return O}}],permissionsToSet:[{},{setPermission:function(m,l){var O=l.resource,x=l.access;return oe(oe({},m),{},Te()({},"".concat(O),x))},clearPermission:function(){return{}}}],roles:[[],{updateRole:function(m,l){var O=l.role;return m.map(function(x){return x.id==O.id?O:x})}}]}),Object(te.loaders)(function(i){var m=i.values,l=i.actions;return{roles:{loadRoles:function(){var O=e()(W.a.mark(function A(){var h;return W.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,ne.b.roles.list();case 2:return h=b.sent,b.abrupt("return",(h==null?void 0:h.results)||[]);case 4:case"end":return b.stop()}},A)}));function x(){return O.apply(this,arguments)}return x}(),createRole:function(){var O=e()(W.a.mark(function A(h){var y,b,R,T;return W.a.wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return y=m.roles,b=m.roleMembersToAdd,R=m.permissionsToSet,X.next=3,ne.b.roles.create(h,R[N.U.FEATURE_FLAGS]);case 3:return T=X.sent,X.next=6,l.addRoleMembers({role:T,membersToAdd:b});case 6:return l.setRoleMembersInFocus([]),l.setRoleMembersToAdd([]),l.clearPermission(),l.setCreateRoleModalShown(!1),X.abrupt("return",[T].concat(V()(y)));case 11:case"end":return X.stop()}},A)}));function x(A){return O.apply(this,arguments)}return x}(),deleteRole:function(){var O=e()(W.a.mark(function A(h){return W.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,ne.b.roles.delete(h.id);case 2:return b.abrupt("return",m.roles.filter(function(R){return R.id!==h.id}));case 3:case"end":return b.stop()}},A)}));function x(A){return O.apply(this,arguments)}return x}()},roleMembersInFocus:[[],{loadRoleMembers:function(){var O=e()(W.a.mark(function A(h){var y,b;return W.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return y=h.roleId,T.next=3,ne.b.roles.members.list(y);case 3:return b=T.sent,T.abrupt("return",(b==null?void 0:b.results)||[]);case 5:case"end":return T.stop()}},A)}));function x(A){return O.apply(this,arguments)}return x}(),addRoleMembers:function(){var O=e()(W.a.mark(function A(h){var y,b,R;return W.a.wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return y=h.role,b=h.membersToAdd,ae.next=3,Promise.all(b.map(function(){var X=e()(W.a.mark(function xe(H){return W.a.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,ne.b.roles.members.create(y.id,H);case 2:return G.abrupt("return",G.sent);case 3:case"end":return G.stop()}},xe)}));return function(xe){return X.apply(this,arguments)}}()));case 3:return R=ae.sent,l.setRoleMembersToAdd([]),ae.abrupt("return",[].concat(V()(m.roleMembersInFocus),V()(R)));case 6:case"end":return ae.stop()}},A)}));function x(A){return O.apply(this,arguments)}return x}(),deleteRoleMember:function(){var O=e()(W.a.mark(function A(h){var y;return W.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(y=h.roleMemberUuid,R.t0=m.roleInFocus,!R.t0){R.next=5;break}return R.next=5,ne.b.roles.members.delete(m.roleInFocus.id,y);case 5:return R.abrupt("return",m.roleMembersInFocus.filter(function(T){return T.id!==y}));case 6:case"end":return R.stop()}},A)}));function x(A){return O.apply(this,arguments)}return x}()}]}}),Object(B.listeners)(function(i){var m=i.actions,l=i.values;return{setRoleInFocus:function(x){var A=x.role;A&&m.loadRoleMembers({roleId:A.id}),m.setCreateRoleModalShown(!0)},openCreateRoleModal:function(){m.setRoleInFocus(null),m.setRoleMembersInFocus([]),m.setCreateRoleModalShown(!0)},setCreateRoleModalShown:function(){l.roleInFocus?m.setPermission(N.U.FEATURE_FLAGS,l.roleInFocus.feature_flags_access_level):m.setPermission(N.U.FEATURE_FLAGS,N.a.WRITE)},setPermissionInPlace:function(){var O=e()(W.a.mark(function A(h){var y,b;return W.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(y=h.access,!l.roleInFocus){T.next=9;break}if(T.t0=y,!T.t0){T.next=6;break}return T.next=6,ne.b.roles.update(l.roleInFocus.id,{feature_flags_access_level:y});case 6:b=Object.assign({},l.roleInFocus),b.feature_flags_access_level=y,m.updateRole(b);case 9:case"end":return T.stop()}},A)}));function x(A){return O.apply(this,arguments)}return x}()}}),Object(B.selectors)({addableMembers:[function(i){return[i.allMembers,i.roleMembersInFocus]},function(i,m){var l=[],O=Ke(i),x;try{var A=function(){var y=x.value;m.some(function(b){return b.user.uuid===y.user.uuid})||l.push(y.user)};for(O.s();!(x=O.n()).done;)A()}catch(h){O.e(h)}finally{O.f()}return l.sort(function(h,y){return h.first_name.localeCompare(y.first_name)}),l}]}),Object(B.afterMount)(function(i){var m=i.actions;m.loadRoles()})])},"./frontend/src/scenes/organization/Settings/index.tsx":function(sn,q,n){"use strict";n.r(q),n.d(q,"scene",function(){return Tn}),n.d(q,"OrganizationSettingsTabs",function(){return en}),n.d(q,"OrganizationSettings",function(){return vn});var le=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),Ce=n.n(le),Oe=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),Z=n.n(Oe),ce=n("./node_modules/core-js/modules/es.function.name.js"),We=n("./node_modules/core-js/modules/es.array.concat.js"),Ve=n("./node_modules/core-js/modules/es.array.iterator.js"),un=n("./node_modules/core-js/modules/es.object.to-string.js"),Ne=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),de=n("./node_modules/react/index.js"),Le=n("./frontend/src/lib/components/PageHeader.tsx"),tn=n("./node_modules/core-js/modules/es.string.iterator.js"),Fe=n("./node_modules/core-js/modules/web.url.js"),we=n("./node_modules/core-js/modules/web.url-search-params.js"),_=n("./node_modules/kea/lib/index.esm.js"),ee=n("./frontend/src/lib/components/CopyToClipboard.tsx"),be=n("./frontend/src/lib/components/ProfilePicture/index.ts"),ue=n("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),Se=n("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),_e=n("./frontend/src/lib/components/LemonTable/index.ts"),ye=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),Ge=n("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),z=n("./frontend/src/lib/components/LemonButton/index.ts"),V=n("./frontend/src/lib/components/icons.tsx"),me=n("./frontend/src/lib/components/LemonDialog/index.ts"),e=n("./node_modules/react/jsx-runtime.js");function Ie(t,s){var a=new URL("/signup/".concat(t),document.baseURI).href;return s.is_expired?Object(e.jsx)("b",{children:"Expired! Delete and recreate"}):Object(e.jsx)(ee.a,{"data-attr":"invite-link",description:"invite link",children:a})}function Te(t){return function(a,r){return Object(e.jsx)(z.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:Object(e.jsx)(V.IconClose,{}),status:"danger",onClick:function(){r.is_expired?t(r):me.a.open({title:"Do you want to cancel the invite for ".concat(r.target_email,"?"),primaryButton:{children:"Yes, cancel invite",status:"danger",onClick:function(){return t(r)}},secondaryButton:{children:"No, keep invite"}})}})}}function Be(){var t=Object(_.useValues)(ue.a),s=t.invites,a=t.invitesLoading,r=Object(_.useActions)(ue.a),o=r.deleteInvite,d=r.showInviteModal,c=Object(_.useValues)(Ge.a),j=c.preflight,g=[{key:"user_profile_picture",render:function(v,f){return Object(e.jsx)(be.b,{name:f.first_name,email:f.target_email})},width:32},{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(v,f){return f.target_email?Object(e.jsxs)("div",{className:"flex items-center",children:[f.target_email,f.first_name?" (".concat(f.first_name,")"):""]}):Object(e.jsx)("i",{children:"no one"})},width:"20%"},Object(ye.b)(),Object(ye.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(v,f){return Ie(f.id,f)}},{title:"",key:"actions",width:24,render:Te(o)}];return Object(e.jsxs)("div",{children:[Object(e.jsxs)("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"},children:["Pending Invites",Object(e.jsx)(z.a,{type:"primary",onClick:d,"data-attr":"invite-teammate-button",children:"Invite team member"})]}),!(j!=null&&j.email_service_available)&&Object(e.jsx)(Se.a,{}),Object(e.jsx)(_e.a,{dataSource:s,columns:g,rowKey:"id",loading:a,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."})]})}var W=n("./node_modules/core-js/modules/es.array.filter.js"),je=n("./node_modules/core-js/modules/es.array.map.js"),$e=n("./node_modules/core-js/modules/es.regexp.exec.js"),rn=n("./node_modules/core-js/modules/es.string.search.js"),fe=n("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),S=n("./frontend/src/lib/constants.tsx"),F=n("./frontend/src/scenes/organizationLogic.tsx"),Me=n("./frontend/src/scenes/userLogic.ts"),J=n("./frontend/src/lib/utils/permissioning.ts"),Ee=n("./frontend/src/lib/components/TZLabel/index.tsx"),ge=n("./frontend/src/lib/components/LemonButton/More.tsx"),ve=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Ye=n("./frontend/src/lib/components/LemonDivider/index.ts"),D=n("./frontend/@posthog/lemon-ui/src/index.ts");function P(t,s){var a,r=Object(_.useValues)(Me.a),o=r.user,d=Object(_.useValues)(F.a),c=d.currentOrganization,j=Object(_.useActions)(fe.a),g=j.removeMember,u=j.changeMemberAccessLevel;if(!o)return null;var v=(a=c==null?void 0:c.membership_level)!==null&&a!==void 0?a:-1,f=(v>=S.p.Admin&&s.level<=v||s.user.uuid===o.uuid)&&s.level!==S.p.Owner,M=c?c.membership_level:null,p=J.c.filter(function(U){return!Object(J.a)(M,o,s,U)}),k=Object(J.a)(M,o,s,p);return Object(e.jsx)(ge.a,{overlay:Object(e.jsxs)(e.Fragment,{children:[k?Object(e.jsx)("div",{children:k}):p.map(function(U){return Object(e.jsx)(z.a,{status:"stealth",fullWidth:!0,onClick:function(E){if(E.preventDefault(),!o)throw Error;if(U===S.p.Owner){var K;me.a.open({title:"Transfer organization ownership to ".concat(s.user.first_name,"?"),description:"You will no longer be the owner of ".concat((K=o.organization)===null||K===void 0?void 0:K.name,". After the transfer you will become an administrator."),primaryButton:{status:"danger",children:"Transfer Ownership",onClick:function(){return u(s,U)}},secondaryButton:{children:"Cancel"}})}else u(s,U)},"data-test-level":U,children:U===S.p.Owner?Object(e.jsx)(e.Fragment,{children:"Transfer organization ownership"}):U>s.level?Object(e.jsxs)(e.Fragment,{children:["Upgrade to ",J.b.get(U)]}):Object(e.jsxs)(e.Fragment,{children:["Downgrade to ",J.b.get(U)]})},"".concat(s.user.uuid,"-level-").concat(U))}),f?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ye.a,{}),Object(e.jsx)(z.a,{status:"danger","data-attr":"delete-org-membership",onClick:function(){var $;if(!o)throw Error;me.a.open({title:"".concat(s.user.uuid==o.uuid?"Leave":"Remove ".concat(s.user.first_name," from")," organization ").concat(($=o.organization)===null||$===void 0?void 0:$.name,"?"),primaryButton:{children:s.user.uuid==o.uuid?"Leave":"Remove",status:"danger",onClick:function(){return g(s)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0,children:s.user.uuid!==o.uuid?"Remove from organization":"Leave organization"})]}):null]})})}function C(t){var s=t.user,a=Object(_.useValues)(fe.a),r=a.filteredMembers,o=a.membersLoading,d=a.search,c=Object(_.useActions)(fe.a),j=c.setSearch,g=[{key:"user_profile_picture",render:function(v,f){return Object(e.jsx)(be.b,{name:f.user.first_name,email:f.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(v,f){return f.user.uuid==s.uuid?"".concat(f.user.first_name," (me)"):f.user.first_name},sorter:function(v,f){return v.user.first_name.localeCompare(f.user.first_name)}},{title:"Email",key:"user_email",render:function(v,f){return f.user.email},sorter:function(v,f){return v.user.email.localeCompare(f.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(v,f){var M;return Object(e.jsx)(ve.a,{"data-attr":"membership-level",children:f.level===S.p.Owner?"Organization owner":"Project ".concat((M=J.b.get(f.level))!==null&&M!==void 0?M:"unknown (".concat(f.level,")"))})},sorter:function(v,f){return v.level-f.level}},{title:"Joined",dataIndex:"joined_at",key:"joined_at",render:function(v){return Object(e.jsx)("div",{className:"whitespace-nowrap",children:Object(e.jsx)(Ee.a,{time:v})})},sorter:function(v,f){return v.joined_at.localeCompare(f.joined_at)}},{key:"actions",width:0,render:P}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Members"}),Object(e.jsx)(D.LemonInput,{type:"search",placeholder:"Search for members",value:d,onChange:j}),Object(e.jsx)(_e.a,{dataSource:r,columns:g,rowKey:"id",style:{marginTop:"1rem"},loading:o,"data-attr":"org-members-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}})]})}try{C.displayName="Members",C.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:C.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(t){}function L(t){var s=t.isOpen,a=t.setIsOpen,r=Object(_.useValues)(F.a),o=r.currentOrganization,d=r.organizationBeingDeleted,c=Object(_.useActions)(F.a),j=c.deleteOrganization,g=Object(de.useState)(!1),u=Z()(g,2),v=u[0],f=u[1],M=!!o&&(d==null?void 0:d.id)===o.id;return Object(e.jsxs)(D.LemonModal,{title:"Delete the entire organization?",onClose:M?void 0:function(){return a(!1)},footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(D.LemonButton,{disabled:M,type:"secondary",onClick:function(){return a(!1)},children:"Cancel"}),Object(e.jsx)(D.LemonButton,{type:"primary",disabled:!v,loading:M,"data-attr":"delete-organization-ok",status:"danger",onClick:o?function(){return j(o)}:void 0,children:"Delete ".concat(o?o.name:"the current organization")})]}),isOpen:s,children:[Object(e.jsxs)("p",{children:["Organization deletion ",Object(e.jsx)("b",{children:"cannot be undone"}),". You will lose all data, ",Object(e.jsx)("b",{children:"including all events"}),", related to all projects within this organization."]}),Object(e.jsxs)("p",{children:["Please type"," ",Object(e.jsx)("strong",{children:o?o.name:"this organization's name"})," to confirm."]}),Object(e.jsx)(D.LemonInput,{type:"text",onChange:function(k){o&&f(k.toLowerCase()===o.name.toLowerCase())}})]})}function I(t){var s=t.isRestricted,a=Object(_.useValues)(F.a),r=a.currentOrganization,o=Object(de.useState)(!1),d=Z()(o,2),c=d[0],j=d[1];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"text-danger",children:[Object(e.jsx)("h2",{className:"text-danger subtitle",children:"Danger Zone"}),Object(e.jsxs)("div",{className:"mt-4",children:[!s&&Object(e.jsxs)("p",{className:"text-danger",children:["This is ",Object(e.jsx)("b",{children:"irreversible"}),". Please be certain."]}),Object(e.jsxs)(D.LemonButton,{status:"danger",type:"secondary",onClick:function(){return j(!0)},"data-attr":"delete-organization-button",icon:Object(e.jsx)(V.IconDelete,{}),disabled:s,children:["Delete ",(r==null?void 0:r.name)||"the current organization"]})]})]}),Object(e.jsx)(L,{isOpen:c,setIsOpen:j})]})}try{L.displayName="DeleteOrganizationModal",L.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},setIsOpen:{defaultValue:null,description:"",name:"setIsOpen",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:L.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(t){}try{I.displayName="DangerZone",I.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:I.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(t){}var w=n("./frontend/src/lib/components/RestrictedArea.tsx"),Q=n("./frontend/src/lib/hooks/useAnchor.ts"),pe=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),B=n.n(pe),te=n("./frontend/src/lib/components/Tooltip.tsx"),Ue=n("./node_modules/core-js/modules/es.object.keys.js"),ne=n("./node_modules/core-js/modules/es.symbol.js"),on=n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),N=n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ke=n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),an=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),Ze=n.n(an),He=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),oe=n.n(He),ln=n("./node_modules/@babel/runtime/regenerator/index.js"),i=n.n(ln),m=n("./node_modules/core-js/modules/es.array.sort.js"),l=n("./node_modules/core-js/modules/es.array.find.js"),O=n("./node_modules/core-js/modules/es.array.includes.js"),x=n("./node_modules/core-js/modules/es.string.includes.js"),A=n("./node_modules/core-js/modules/es.string.match.js"),h=n("./frontend/src/lib/api.ts"),y=n("./frontend/src/lib/components/lemonToast.tsx"),b=n("./frontend/src/types.ts"),R=n("./node_modules/kea-forms/lib/index.js"),T=n("./node_modules/kea-loaders/lib/index.js"),ae=["id"];function X(t,s){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);s&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,r)}return a}function xe(t){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?X(Object(a),!0).forEach(function(r){Ce()(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):X(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}var H=Object(_.kea)([Object(_.path)(["scenes","organization","verifiedDomainsLogic"]),Object(_.connect)({values:[F.a,["currentOrganization"]]}),Object(_.actions)({replaceDomain:function(s){return{domain:s}},setAddModalShown:function(s){return{shown:s}},setConfigureSAMLModalId:function(s){return{id:s}},setVerifyModal:function(s){return{id:s}}}),Object(_.reducers)({verifiedDomains:[[],{replaceDomain:function(s,a){var r=a.domain,o=[].concat(B()(s.filter(function(d){var c=d.id;return c!==r.id})),[r]);return o.sort(function(d,c){return d.domain.localeCompare(c.domain)}),o}}],addModalShown:[!1,{setAddModalShown:function(s,a){var r=a.shown;return r},addVerifiedDomainSuccess:function(){return!1}}],configureSAMLModalId:[null,{setConfigureSAMLModalId:function(s,a){var r=a.id;return r}}],verifyModal:[null,{setVerifyModal:function(s,a){var r=a.id;return r}}]}),Object(T.loaders)(function(t){var s=t.values,a=t.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var r=oe()(i.a.mark(function d(){var c;return i.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,h.b.get("api/organizations/".concat((c=s.currentOrganization)===null||c===void 0?void 0:c.id,"/domains"));case 2:return g.abrupt("return",g.sent.results);case 3:case"end":return g.stop()}},d)}));function o(){return r.apply(this,arguments)}return o}(),addVerifiedDomain:function(){var r=oe()(i.a.mark(function d(c){var j,g;return i.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,h.b.create("api/organizations/".concat((j=s.currentOrganization)===null||j===void 0?void 0:j.id,"/domains"),{domain:c});case 2:return g=v.sent,v.abrupt("return",[g].concat(B()(s.verifiedDomains)));case 4:case"end":return v.stop()}},d)}));function o(d){return r.apply(this,arguments)}return o}(),deleteVerifiedDomain:function(){var r=oe()(i.a.mark(function d(c){var j;return i.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,h.b.delete("api/organizations/".concat((j=s.currentOrganization)===null||j===void 0?void 0:j.id,"/domains/").concat(c));case 2:return u.abrupt("return",B()(s.verifiedDomains.filter(function(v){return v.id!==c})));case 3:case"end":return u.stop()}},d)}));function o(d){return r.apply(this,arguments)}return o}()}],updatingDomain:[!1,{updateDomain:function(){var r=oe()(i.a.mark(function d(c){var j,g;return i.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,h.b.update("api/organizations/".concat((j=s.currentOrganization)===null||j===void 0?void 0:j.id,"/domains/").concat(c.id),xe(xe({},c),{},{id:void 0}));case 2:return g=v.sent,y.d.success("Domain updated successfully! Changes will take immediately."),a.replaceDomain(g),v.abrupt("return",!1);case 6:case"end":return v.stop()}},d)}));function o(d){return r.apply(this,arguments)}return o}(),verifyDomain:function(){var r=oe()(i.a.mark(function d(){var c,j;return i.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,h.b.create("api/organizations/".concat((c=s.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s.verifyModal,"/verify"));case 2:return j=u.sent,j.is_verified?y.d.success("Domain verified successfully."):y.d.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),a.replaceDomain(j),a.setVerifyModal(null),u.abrupt("return",!1);case 7:case"end":return u.stop()}},d)}));function o(){return r.apply(this,arguments)}return o}()}]}}),Object(_.listeners)(function(t){var s=t.actions,a=t.values;return{setConfigureSAMLModalId:function(o){var d=o.id,c=a.verifiedDomains.find(function(v){var f=v.id;return f===d});if(d&&c){var j=c.saml_acs_url,g=c.saml_entity_id,u=c.saml_x509_cert;s.setSamlConfigValues({saml_acs_url:j,saml_entity_id:g,saml_x509_cert:u,id:d})}}}}),Object(_.selectors)({domainBeingVerified:[function(t){return[t.verifiedDomains,t.verifyModal]},function(t,s){return s&&t.find(function(a){var r=a.id;return r===s})||null}],isSSOEnforcementAvailable:[function(t){return[t.currentOrganization]},function(t){var s;return(s=t==null?void 0:t.available_features.includes(b.e.SSO_ENFORCEMENT))!==null&&s!==void 0?s:!1}],isSAMLAvailable:[function(t){return[t.currentOrganization]},function(t){var s;return(s=t==null?void 0:t.available_features.includes(b.e.SAML))!==null&&s!==void 0?s:!1}]}),Object(_.afterMount)(function(t){var s=t.actions;return s.loadVerifiedDomains()}),Object(R.forms)(function(t){var s=t.actions,a=t.values;return{samlConfig:{defaults:{},errors:function(o){return{saml_acs_url:o.saml_acs_url&&!o.saml_acs_url.match(S.w)?"Please enter a valid URL, including https://":void 0}},submit:function(){var r=oe()(i.a.mark(function d(c,j){var g,u,v,f;return i.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(u=c.id,v=Ze()(c,ae),u){p.next=3;break}return p.abrupt("return");case 3:return p.next=5,h.b.update("api/organizations/".concat((g=a.currentOrganization)===null||g===void 0?void 0:g.id,"/domains/").concat(c.id),xe({},v));case 5:f=p.sent,j(),s.replaceDomain(f),s.setConfigureSAMLModalId(null),s.setSamlConfigValues({}),y.d.success("SAML configuration for ".concat(f.domain," updated successfully."));case 11:case"end":return p.stop()}},d)}));function o(d,c){return r.apply(this,arguments)}return o}()}}})]),Je=n("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),G=n("./frontend/src/lib/components/LemonModal/index.ts");function On(){var t=Object(_.useValues)(H),s=t.addModalShown,a=t.verifiedDomainsLoading,r=Object(_.useActions)(H),o=r.setAddModalShown,d=r.addVerifiedDomain,c=Object(de.useState)(""),j=Z()(c,2),g=j[0],u=j[1],v=Object(de.useState)(!1),f=Z()(v,2),M=f[0],p=f[1],k=!g||!g.match(S.e),U=function(){u(""),p(!1)},$=function(){o(!1),U()},E=function(){p(!0),k||(d(g),U())};return Object(e.jsxs)(G.a,{onClose:$,isOpen:s,title:"Add authentication domain",footer:Object(e.jsx)(z.a,{type:"primary",disabled:g===""||M&&k||a,onClick:E,children:"Add domain"}),children:[Object(e.jsx)(D.LemonInput,{placeholder:"posthog.com",autoFocus:!0,value:g,onChange:u,onPressEnter:E}),M&&k&&Object(e.jsx)("span",{className:"text-danger text-xs",children:"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"})]})}var bn=n("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx"),De=n("./frontend/src/lib/forms/Field.tsx");function _n(){var t=Object(_.useValues)(H),s=t.domainBeingVerified,a=t.updatingDomainLoading,r=Object(_.useActions)(H),o=r.setVerifyModal,d=r.verifyDomain,c="_posthog-challenge.".concat(s==null?void 0:s.domain,".");return Object(e.jsx)(G.a,{isOpen:!!s,onClose:function(){return o(null)},title:"Verify your domain",description:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(ve.a,{className:"uppercase",children:(s==null?void 0:s.domain)||""}),Object(e.jsx)("p",{children:"To verify your domain, you need to add a record to your DNS zone."})]}),footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(z.a,{type:"secondary",onClick:function(){return o(null)},children:"Verify later"}),Object(e.jsx)(z.a,{type:"primary",disabled:a,onClick:d,children:"Verify"})]}),children:Object(e.jsx)("div",{children:Object(e.jsxs)("ol",{children:[Object(e.jsx)("li",{children:"Sign in to your DNS provider."}),Object(e.jsxs)("li",{children:["Add the following ",Object(e.jsx)("b",{children:"TXT"})," record.",Object(e.jsxs)("div",{className:"my-4 space-y-2",children:[Object(e.jsx)(De.b,{label:"Name",children:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:c}),Object(e.jsx)(ee.a,{explicitValue:c})]})}),Object(e.jsx)(De.b,{label:"Value or content",children:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:s==null?void 0:s.verification_challenge}),Object(e.jsx)(ee.a,{explicitValue:s==null?void 0:s.verification_challenge})]})}),Object(e.jsx)(De.b,{label:"TTL",children:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:"Default or 3600"}),Object(e.jsx)(ee.a,{explicitValue:"3600"})]})})]})]}),Object(e.jsx)("li",{children:"Press verify below."})]})})})}var mn=n("./frontend/src/lib/components/Link.tsx"),gn=n("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),pn=n("./frontend/src/lib/components/AlertMessage/index.ts"),jn=n("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),hn=n("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx");function yn(){var t=Object(_.useValues)(H),s=t.configureSAMLModalId,a=t.isSamlConfigSubmitting,r=t.samlConfig,o=Object(_.useActions)(H),d=o.setConfigureSAMLModalId,c=r.saml_acs_url&&r.saml_entity_id&&r.saml_x509_cert,j=function(){d(null)};return Object(e.jsx)(G.a,{onClose:j,isOpen:!!s,title:"",simple:!0,children:Object(e.jsxs)(R.Form,{logic:H,formKey:"samlConfig",enableFormOnSubmit:!0,className:"LemonModal__layout ",children:[Object(e.jsx)(G.a.Header,{children:Object(e.jsx)("h3",{children:"Configure SAML authentication and provisioning"})}),Object(e.jsxs)(G.a.Content,{className:"space-y-2",children:[Object(e.jsx)(De.a,{name:"saml_acs_url",label:"SAML ACS URL",children:Object(e.jsx)(jn.a,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})}),Object(e.jsx)(De.a,{name:"saml_entity_id",label:"SAML Entity ID",children:Object(e.jsx)(jn.a,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})}),Object(e.jsx)(De.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate",children:Object(e.jsx)(hn.a,{className:"ph-ignore-input",minRows:10,placeholder:`Enter the public certificate of your IdP. Keep all line breaks.
-----BEGIN CERTIFICATE-----
MIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL
-----END CERTIFICATE-----`})}),!c&&Object(e.jsx)(pn.a,{type:"info",children:"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft."})]}),Object(e.jsx)(G.a.Footer,{children:Object(e.jsx)(z.a,{loading:a,type:"primary",htmlType:"submit",children:"Save settings"})})]})})}var Pe={marginRight:4,fontSize:"1.15em",paddingTop:2};function Mn(){var t=Object(_.useValues)(H),s=t.verifiedDomainsLoading,a=t.updatingDomainLoading,r=Object(_.useActions)(H),o=r.setAddModalShown;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsxs)("div",{style:{flexGrow:1},children:[Object(e.jsx)("div",{id:"domain-whitelist"})," ",Object(e.jsx)("h2",{id:"authentication-domains",className:"subtitle",children:"Authentication domains"}),Object(e.jsx)("p",{className:"text-muted-alt",children:"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains."})]}),Object(e.jsx)(z.a,{type:"primary",onClick:function(){return o(!0)},disabled:s||a,children:"Add domain"})]}),Object(e.jsx)(En,{})]})}function En(){var t=Object(_.useValues)(H),s=t.verifiedDomains,a=t.verifiedDomainsLoading,r=t.currentOrganization,o=t.updatingDomainLoading,d=t.isSSOEnforcementAvailable,c=t.isSAMLAvailable,j=Object(_.useActions)(H),g=j.updateDomain,u=j.deleteVerifiedDomain,v=j.setVerifyModal,f=j.setConfigureSAMLModalId,M=Object(_.useValues)(Ge.a),p=M.preflight,k=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function($,E){var K=E.domain;return Object(e.jsx)(ve.a,{children:K})}}].concat(B()(p!=null&&p.cloud?[{key:"is_verified",title:Object(e.jsxs)(e.Fragment,{children:["Verification",Object(e.jsx)(te.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO).",children:Object(e.jsx)(Je.a,{style:{marginLeft:4}})})]}),render:function($,E){var K=E.is_verified,Y=E.verified_at;return K?Object(e.jsxs)("div",{className:"flex items-center text-success",children:[Object(e.jsx)(V.IconCheckmark,{style:Pe})," Verified"]}):Y?Object(e.jsxs)("div",{className:"flex items-center text-danger",children:[Object(e.jsx)(V.IconExclamation,{style:Pe})," Verification expired"]}):Object(e.jsxs)("div",{className:"flex items-center text-warning",children:[Object(e.jsx)(V.IconWarning,{style:Pe})," Pending verification"]})}}]:[]),[{key:"jit_provisioning_enabled",title:Object(e.jsxs)(e.Fragment,{children:["Automatic provisioning"," ",Object(e.jsx)(te.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((r==null?void 0:r.name)||"this organization"," if it does not exist."),children:Object(e.jsx)(Je.a,{})})]}),render:function($,E){var K=E.jit_provisioning_enabled,Y=E.id,se=E.is_verified;return se?Object(e.jsx)("div",{className:"flex items-center",children:Object(e.jsx)(gn.a,{checked:K,disabled:o||!se,onChange:function(ie){return g({id:Y,jit_provisioning_enabled:ie})},label:Object(e.jsx)("span",{className:"font-normal",children:K?"Enabled":"Disabled"})})}):Object(e.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable automatic provisioning"})}},{key:"sso_enforcement",title:Object(e.jsxs)(e.Fragment,{children:["Enforce SSO"," ",Object(e.jsx)(te.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider.",children:Object(e.jsx)(Je.a,{})})]}),render:function($,E,K){var Y=E.sso_enforcement,se=E.is_verified,re=E.id,ie=E.has_saml;return d?se?Object(e.jsx)(bn.a,{value:Y,loading:o,onChange:function(dn){return g({id:re,sso_enforcement:dn})},samlAvailable:ie}):Object(e.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):K===0?Object(e.jsxs)(mn.a,{to:Object(S.D)(p==null?void 0:p.cloud).url,target:Object(S.D)(p==null?void 0:p.cloud).target,className:"flex items-center",children:[Object(e.jsx)(V.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"]}):Object(e.jsx)(e.Fragment,{})}},{key:"saml",title:"SAML",render:function($,E,K){var Y=E.is_verified,se=E.saml_acs_url,re=E.saml_entity_id,ie=E.saml_x509_cert,nn=E.has_saml;return c?Y?Object(e.jsx)(e.Fragment,{children:nn?Object(e.jsxs)("div",{className:"flex items-center text-success",children:[Object(e.jsx)(V.IconCheckmark,{style:Pe})," SAML enabled"]}):se||re||ie?Object(e.jsxs)("div",{className:"flex items-center text-warning",children:[Object(e.jsx)(V.IconWarning,{style:Pe})," SAML partially configured"]}):Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsx)(V.IconOffline,{style:Pe})," SAML not set up"]})}):Object(e.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):K===0?Object(e.jsxs)(mn.a,{to:Object(S.D)(p==null?void 0:p.cloud).url,target:Object(S.D)(p==null?void 0:p.cloud).target,className:"flex items-center",children:[Object(e.jsx)(V.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"]}):Object(e.jsx)(e.Fragment,{})}},{key:"actions",width:32,align:"center",render:function($,E){var K=E.is_verified,Y=E.id,se=E.domain;return K?Object(e.jsx)(ge.a,{overlay:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(z.a,{status:"stealth",onClick:function(){return f(Y)},fullWidth:!0,disabled:!c,title:c?void 0:"Upgrade to enable SAML",children:"Configure SAML"}),Object(e.jsxs)(z.a,{status:"danger",onClick:function(){return me.a.open({title:"Remove ".concat(se,"?"),description:"This cannot be undone. If you have SAML configured or SSO enforced,it will be immediately disabled.",primaryButton:{status:"danger",children:"Remove domain",onClick:function(){return u(Y)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0,children:[Object(e.jsx)(V.IconDelete,{})," Remove domain"]})]}),style:{display:"inline-block"}}):Object(e.jsx)(z.a,{type:"primary",onClick:function(){return v(Y)},children:"Verify"})}}]);return Object(e.jsxs)("div",{children:[Object(e.jsx)(_e.a,{dataSource:s,columns:k,loading:a,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),Object(e.jsx)(On,{}),Object(e.jsx)(yn,{}),Object(e.jsx)(_n,{})]})}var Ae=n("./node_modules/antd/es/tabs/index.js"),cn=n("./frontend/src/scenes/urls.ts"),xn=n("./node_modules/antd/es/row/index.js"),Dn=n("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),Pn=n("./frontend/src/lib/components/Spinner/Spinner.tsx"),An=n("./frontend/src/lib/components/UserSelectItem.tsx"),Qe=n("./frontend/src/scenes/organization/Settings/Roles/rolesLogic.tsx");function Rn(){var t=Object(_.useValues)(Qe.a),s=t.roleInFocus,a=t.createRoleModalShown,r=t.roleMembersToAdd,o=t.roleMembersInFocusLoading,d=t.addableMembers,c=t.rolesLoading,j=t.roleMembersInFocus,g=t.permissionsToSet,u=Object(_.useActions)(Qe.a),v=u.setCreateRoleModalShown,f=u.setRoleMembersToAdd,M=u.createRole,p=u.deleteRoleMember,k=u.addRoleMembers,U=u.setPermission,$=u.setPermissionInPlace,E=Object(_.useValues)(F.a),K=E.isAdminOrOwner,Y=Object(de.useState)(""),se=Z()(Y,2),re=se[0],ie=se[1],nn=function(){v(!1),f([])},dn=function(){M(re),ie("")},Kn=function(Re){Re&&(U(b.U.FEATURE_FLAGS,Re),$(b.U.FEATURE_FLAGS,Re))},ze=!s;return Object(e.jsxs)(G.a,{onClose:nn,isOpen:a,title:ze?"Create role":"Edit ".concat(s.name," role"),footer:ze&&Object(e.jsx)(z.a,{type:"primary",disabled:c,onClick:dn,children:c?Object(e.jsx)(Pn.a,{monocolor:!0}):"Create role"}),children:[ze&&Object(e.jsxs)("div",{className:"mb-5",children:[Object(e.jsx)("h5",{children:"Role Name"}),Object(e.jsx)(D.LemonInput,{placeholder:"Product",autoFocus:!0,value:re,onChange:ie})]}),K&&Object(e.jsxs)("div",{className:"mb-5",children:[Object(e.jsx)("h5",{children:"Members"}),Object(e.jsxs)("div",{className:"flex gap-2",children:[Object(e.jsx)("div",{className:"flex-1",children:Object(e.jsx)(Dn.a,{placeholder:"Search for team members to add\u2026",value:r,loading:o,onChange:function(Re){return f(Re)},filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:Object(An.a)(d,"uuid")})}),!ze&&Object(e.jsx)(z.a,{type:"primary",loading:o,disabled:r.length===0,onClick:function(){return k({role:s,membersToAdd:r})},children:"Add"})]})]}),!ze&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{children:"Role Members"}),j.length>0?Object(e.jsx)("div",{className:"mt-2 pb-2 rounded overflow-y-auto",style:{maxHeight:300},children:j.map(function(he){return Object(e.jsx)(Cn,{member:he,deleteMember:function(zn){return p({roleMemberUuid:zn})},isAdminOrOwner:!!K},he.id)})}):Object(e.jsx)("div",{className:"text-muted mb-2",children:"No members added yet"})]}),Object(e.jsx)(D.LemonDivider,{}),Object(e.jsx)("h5",{className:"mt-4",children:"Permissions"}),Object(e.jsxs)(xn.a,{justify:"space-between",align:"middle",children:[Object(e.jsx)("b",{className:"",children:"Feature Flags"}),Object(e.jsx)(D.LemonSelect,{disabled:!K,value:g[b.U.FEATURE_FLAGS],onChange:Kn,options:[{value:b.a.WRITE,label:"View & Edit"},{value:b.a.READ,label:"View Only"}]})]})]})}function Cn(t){var s=t.member,a=t.deleteMember,r=t.isAdminOrOwner,o=s.user;return Object(e.jsxs)("div",{className:"flex items-center justify-between mt-2 h-8",children:[Object(e.jsx)(be.b,{email:o.email,name:o.first_name,size:"md",showName:!0}),r&&a&&Object(e.jsx)(z.a,{icon:Object(e.jsx)(V.IconDelete,{}),onClick:function(){return a(s.id)},tooltip:"Remove user from role",status:"primary-alt",type:"tertiary",size:"small"})]})}function Xe(t){var s=t.isRestricted,a=Object(_.useValues)(Qe.a),r=a.roles,o=a.rolesLoading,d=Object(_.useActions)(Qe.a),c=d.setRoleInFocus,j=d.openCreateRoleModal,g=d.deleteRole,u=[{key:"name",title:"Role",dataIndex:"name",render:function(f,M){return Object(e.jsx)("div",{className:"row-name text-primary cursor-pointer",onClick:function(){c(M)},children:M.name})}},{key:"actions",width:0,sticky:!0,render:function(f,M){return Object(e.jsx)(ge.a,{overlay:s?"You don't have permission to delete roles":Object(e.jsx)(D.LemonButton,{onClick:function(){return g(M)},status:"danger",children:"Delete"})})}}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsxs)("div",{style:{flexGrow:1},children:[Object(e.jsx)("h2",{id:"roles",className:"subtitle",children:"Roles"}),Object(e.jsx)("p",{className:"text-muted-alt",children:"Create roles to provide fine-grained permissions to users across posthog resources. Admins+ will always have full edit access regardless of default or role."})]}),!s&&Object(e.jsx)(D.LemonButton,{type:"primary",onClick:j,"data-attr":"create-role-button",children:"Create role"})]}),Object(e.jsx)(_e.a,{dataSource:r,columns:u,rowKey:function(){return"id"},expandable:{expandedRowRender:function(f){return Object(e.jsxs)(Ae.a,{defaultActiveKey:"members",children:[Object(e.jsx)(Ae.a.TabPane,{tab:"Members",children:Object(e.jsx)("div",{className:"flex flex-col my-4",children:f.members.map(function(M){return Object(e.jsx)("div",{children:M.user.first_name},M.id)})})},"members"),Object(e.jsx)(Ae.a.TabPane,{tab:"Feature flags",children:Object(e.jsx)("div",{className:"mb-4",children:f.feature_flags_access_level===b.a.WRITE?"All":Object(e.jsx)("div",{className:"flex flex-col",children:f.associated_flags.map(function(M){return Object(e.jsx)(D.Link,{to:cn.a.featureFlag(M.id),children:M.key},M.id)})})})},"feature-flags")]})}},style:{marginTop:"1rem"},loading:o,"data-attr":"org-roles-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}}),Object(e.jsx)(Rn,{})]})}try{Xe.displayName="Roles",Xe.__docgenInfo={description:"",displayName:"Roles",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Roles/Roles.tsx#Roles"]={docgenInfo:Xe.__docgenInfo,name:"Roles",path:"frontend/src/scenes/organization/Settings/Roles/Roles.tsx#Roles"})}catch(t){}var Ln=n("./frontend/src/lib/utils.tsx"),ke=n("./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx");function qe(t){var s=t.isRestricted,a=Object(_.useValues)(ke.b),r=a.allPermissions,o=Object(_.useActions)(ke.b),d=o.updateOrganizationResourcePermission,c=[{key:"name",title:"Resource",dataIndex:"name",render:function(g,u){return Object(e.jsx)("b",{children:Object(Ln.i)(u.resource)})}},{key:"access_level",title:"Access Level",dataIndex:"access_level",render:function(g,u){return Object(e.jsx)(D.LemonSelect,{disabled:s,value:u.access_level,onChange:function(f){return d({id:u.id,resource:u.resource,access_level:f})},options:[{value:b.a.WRITE,label:ke.a[b.a.WRITE]},{value:b.a.READ,label:ke.a[b.a.READ]}]})}}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("div",{className:"flex items-center",children:Object(e.jsxs)("div",{style:{flexGrow:1},children:[Object(e.jsx)("h2",{id:"roles",className:"subtitle",children:"Permission Defaults"}),Object(e.jsx)("p",{className:"text-muted-alt",children:"Add organizational default permission levels for posthog resources. Use roles to apply permissions to specific sets of users."})]})}),Object(e.jsx)(_e.a,{dataSource:r,columns:c,rowKey:function(){return"id"},style:{marginTop:"1rem"},loading:!1,"data-attr":"org-permissions-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}})]})}try{qe.displayName="Permissions",qe.__docgenInfo={description:"",displayName:"Permissions",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Permissions/Permissions.tsx#Permissions"]={docgenInfo:qe.__docgenInfo,name:"Permissions",path:"frontend/src/scenes/organization/Settings/Permissions/Permissions.tsx#Permissions"})}catch(t){}var Sn=n("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),In=n("./frontend/src/lib/logic/featureFlagLogic.ts"),Tn={component:vn,logic:F.a},en;(function(t){t.GENERAL="general",t.ROLE_ACCESS="role_access"})(en||(en={}));function Bn(t){var s=t.isRestricted,a=Object(_.useValues)(F.a),r=a.currentOrganization,o=a.currentOrganizationLoading,d=Object(_.useActions)(F.a),c=d.updateOrganization,j=Object(de.useState)((r==null?void 0:r.name)||""),g=Z()(j,2),u=g[0],v=g[1];return Object(e.jsxs)("div",{style:{maxWidth:"40rem"},children:[Object(e.jsx)("h2",{id:"name",className:"subtitle mt-0",children:"Display Name"}),Object(e.jsx)(D.LemonInput,{className:"mb-4",value:u,onChange:v,disabled:s}),Object(e.jsx)(D.LemonButton,{type:"primary",onClick:function(M){M.preventDefault(),c({name:u})},disabled:s||!u||!r||u===r.name,loading:o,children:"Rename Organization"})]})}function Un(t){var s=t.isRestricted,a=Object(_.useValues)(F.a),r=a.currentOrganization,o=Object(_.useActions)(F.a),d=o.updateOrganization;return Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{id:"notification-preferences",className:"subtitle",children:"Notification Preferences"}),Object(e.jsx)("div",{children:Object(e.jsx)(D.LemonSwitch,{"data-attr":"is-member-join-email-enabled-switch",onChange:function(j){d({is_member_join_email_enabled:j})},checked:!!(r!=null&&r.is_member_join_email_enabled),disabled:s||!r,label:"Email all current members when a new member joins",bordered:!0})})]})}var fn=Object(_.kea)({path:["scenes","organization","Settings","index"],actions:{setTab:function(s){return{tab:s}}},reducers:{tab:[en.GENERAL,{setTab:function(s,a){var r=a.tab;return r}}]},actionToUrl:function(){return{setTab:function(a){var r=a.tab;return"".concat(cn.a.organizationSettings(),"?tab=").concat(r)}}},urlToAction:function(s){var a=s.values,r=s.actions;return Ce()({},cn.a.organizationSettings(),function(o,d){d.tab&&a.tab!==d.tab&&r.setTab(d.tab)})}});function vn(){var t=Object(_.useValues)(Me.a),s=t.user,a=Object(_.useValues)(In.a),r=a.featureFlags;Object(Q.a)(location.hash);var o=Object(_.useValues)(fn),d=o.tab,c=Object(_.useActions)(fn),j=c.setTab;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Le.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),Object(e.jsxs)(Ae.a,{activeKey:d,destroyInactiveTabPane:!0,onChange:function(u){return j(u)},children:[Object(e.jsx)(Ae.a.TabPane,{tab:"General",children:Object(e.jsxs)("div",{className:"border rounded p-6",children:[Object(e.jsx)(w.a,{Component:Bn,minimumAccessLevel:S.p.Admin}),Object(e.jsx)(D.LemonDivider,{className:"my-6"}),Object(e.jsx)(Be,{}),Object(e.jsx)(D.LemonDivider,{className:"my-6"}),s&&Object(e.jsx)(C,{user:s}),Object(e.jsx)(D.LemonDivider,{className:"my-6"}),Object(e.jsx)(w.a,{Component:Mn,minimumAccessLevel:S.p.Admin}),Object(e.jsx)(D.LemonDivider,{className:"my-6"}),Object(e.jsx)(w.a,{Component:Un,minimumAccessLevel:S.p.Admin}),Object(e.jsx)(D.LemonDivider,{className:"my-6"}),Object(e.jsx)(w.a,{Component:I,minimumAccessLevel:S.p.Owner})]})},"general"),r[S.i.ROLE_BASED_ACCESS]&&Object(e.jsx)(Ae.a.TabPane,{tab:"Role access",children:Object(e.jsxs)(Sn.a,{feature:b.e.ROLE_BASED_ACCESS,children:[Object(e.jsx)(w.a,{Component:qe,minimumAccessLevel:S.p.Admin}),Object(e.jsx)(D.LemonDivider,{className:"my-6"}),Object(e.jsx)(w.a,{Component:Xe,minimumAccessLevel:S.p.Admin}),Object(e.jsx)(D.LemonDivider,{className:"my-6"})]})},"role_access")]})]})}}}]);
