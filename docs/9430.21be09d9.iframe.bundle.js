"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[9430],{"./frontend/src/scenes/pipeline/Pipeline.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Pipeline:()=>Pipeline,scene:()=>Pipeline_scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),popconfirm=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@18.2.0_react@18.2.0/node_modules/antd/es/popconfirm/index.js"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonInput=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),preflightLogic=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),kea_forms_lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),CodeEditors=__webpack_require__("./frontend/src/lib/components/CodeEditors.tsx"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),appCodeLogic=__webpack_require__("./frontend/src/scenes/pipeline/appCodeLogic.tsx"),appsManagementLogic=__webpack_require__("./frontend/src/scenes/pipeline/appsManagementLogic.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AppCode(_ref){let{pluginId,pluginType}=_ref,logicProps={pluginId},logic=(0,appCodeLogic.d)(logicProps),{currentFile,filenames,pluginSource,pluginSourceLoading,editingAppCode,pluginSourceAllErrors,pluginSourceHasErrors,isPluginSourceSubmitting}=(0,index_esm.useValues)(logic),{setCurrentFile,cancelEditing,editAppCode,submitPluginSource}=(0,index_esm.useActions)(logic),{canGloballyManagePlugins,plugins}=(0,index_esm.useValues)(appsManagementLogic.k);if(pluginSourceLoading)return(0,jsx_runtime.jsx)(src.Spinner,{});let canEdit=canGloballyManagePlugins&&pluginType===types.ak.Source;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonModal,{onClose:cancelEditing,isOpen:editingAppCode,width:600,title:"Editing source code of "+plugins[pluginId].name,description:(0,jsx_runtime.jsxs)("p",{children:["Read our"," ",(0,jsx_runtime.jsx)(src.Link,{to:"https://posthog.com/docs/apps/build",target:"_blank",children:"app building overview in PostHog docs"})," ","for a good grasp of the possibilities."]}),footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:cancelEditing,children:"Cancel"}),(0,jsx_runtime.jsx)(src.LemonButton,{loading:isPluginSourceSubmitting,type:"primary",onClick:()=>submitPluginSource(),children:"Save"})]}),children:(0,jsx_runtime.jsx)(kea_forms_lib.Form,{logic:appCodeLogic.d,props:logicProps,formKey:"pluginSource",children:canEdit?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:pluginSourceLoading?(0,jsx_runtime.jsx)(src.Spinner,{}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.LemonTabs,{activeKey:currentFile,onChange:filename=>setCurrentFile(filename),tabs:Object.values(filenames).map(filename=>({label:filename,key:filename,content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[pluginSourceHasErrors&&(0,jsx_runtime.jsx)(src.LemonBanner,{type:"error",children:Object.entries(pluginSourceAllErrors).map(_ref2=>{let[filename,error]=_ref2;return(0,jsx_runtime.jsxs)("p",{children:[filename,": ",error]},filename)})}),(0,jsx_runtime.jsx)(kea_forms_lib.Field,{name:[currentFile],children:_ref3=>{let{value,onChange}=_ref3;return(0,jsx_runtime.jsx)(CodeEditors.p,{path:currentFile,language:currentFile.endsWith(".json")?"json":"typescript",value:value,onChange:v=>onChange(null!=v?v:""),height:700,options:{minimap:{enabled:!1}}})}})]})}))})})}):null})}),(0,jsx_runtime.jsx)(src.LemonTabs,{activeKey:currentFile,onChange:filename=>setCurrentFile(filename),tabs:Object.values(filenames).map(filename=>{var _pluginSource$current;return{label:filename,key:filename,content:(0,jsx_runtime.jsx)("div",{className:"mr-4",children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:currentFile.endsWith(".json")?CodeSnippet.S.JSON:CodeSnippet.S.JavaScript,thing:currentFile,maxLinesWithoutExpansion:20,actions:canEdit?[{icon:(0,jsx_runtime.jsx)(icons.yl5,{}),title:"Edit the code",callback:editAppCode}]:void 0,wrap:!0,children:null!==(_pluginSource$current=pluginSource[currentFile])&&void 0!==_pluginSource$current?_pluginSource$current:""})})}})})]})}var sourceAppInitialCode=__webpack_require__("./frontend/src/scenes/pipeline/sourceAppInitialCode.tsx"),utils=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");function AppsManagement(){appsManagementLogic.k.mount();let{canInstallPlugins,canGloballyManagePlugins,missingGlobalPlugins,shouldBeGlobalPlugins,shouldNotBeGlobalPlugins,globalPlugins,localPlugins,pluginsLoading}=(0,index_esm.useValues)(appsManagementLogic.k),{isDev,isCloudOrDev}=(0,index_esm.useValues)(preflightLogic.preflightLogic);return canInstallPlugins&&canGloballyManagePlugins?(0,jsx_runtime.jsxs)("div",{className:"pipeline-apps-management-scene",children:[isCloudOrDev&&!pluginsLoading&&(missingGlobalPlugins.length>0||shouldBeGlobalPlugins.length>0||shouldNotBeGlobalPlugins.length>0)&&(0,jsx_runtime.jsx)(OutOfSyncApps,{}),(0,jsx_runtime.jsx)("h2",{children:"Manual installation"}),(0,jsx_runtime.jsx)(InstallFromUrl,{}),isDev&&(0,jsx_runtime.jsx)(InstallLocalApp,{}),(0,jsx_runtime.jsx)(InstallSourceApp,{}),(0,jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),(0,jsx_runtime.jsx)("h2",{children:"Installed apps"}),(0,jsx_runtime.jsx)(AppsToUpdate,{}),globalPlugins&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Global apps"}),(0,jsx_runtime.jsx)("p",{children:"These apps can be used in all organizations."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:globalPlugins})]}),localPlugins&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Local apps"}),(0,jsx_runtime.jsx)("p",{children:"These apps can only be used by this organization, or ones with an existing plugin config."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:localPlugins})]})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"You don't have permission to manage apps."})}function AppsToUpdate(){let{updatablePlugins,pluginsNeedingUpdates,checkingForUpdates}=(0,index_esm.useValues)(appsManagementLogic.k),{checkForUpdates}=(0,index_esm.useActions)(appsManagementLogic.k);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[updatablePlugins&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",icon:(0,jsx_runtime.jsx)(icons.tr8,{}),onClick:checkForUpdates,loading:checkingForUpdates,children:checkingForUpdates?`Checking ${Object.keys(updatablePlugins).length} apps for updates`:"Check again for updates"}),pluginsNeedingUpdates.length>0&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Apps to update"}),(0,jsx_runtime.jsx)("p",{children:"These apps have newer commits in the repository they link to."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:pluginsNeedingUpdates})]})]})}function AppsTable(_ref){let{plugins}=_ref,{unusedPlugins}=(0,index_esm.useValues)(appsManagementLogic.k),{uninstallPlugin,patchPlugin,updatePlugin}=(0,index_esm.useActions)(appsManagementLogic.k),data=plugins.map(plugin=>({...plugin,key:plugin.id}));return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.LemonTable,{dataSource:data,columns:[{width:60,render:function RenderAppInfo(_,plugin){return(0,jsx_runtime.jsx)(utils.Wf,{plugin:plugin})}},{title:"Name",render:function RenderName(_,plugin){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold truncate",children:plugin.name}),plugin.latest_tag&&plugin.tag&&plugin.latest_tag!==plugin.tag&&(0,jsx_runtime.jsx)(Link.r,{to:plugin.url+"/compare/"+plugin.tag+"..."+plugin.latest_tag,children:(0,jsx_runtime.jsx)(src.LemonTag,{type:"completion",children:"See update diff"})})]}),(0,jsx_runtime.jsx)("div",{className:"text-sm",children:plugin.description})]})}},{title:"Capabilities",width:"30%",render:function RenderCapabilities(_,plugin){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Methods: ",JSON.stringify(plugin.capabilities?.methods)]}),(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Jobs: ",JSON.stringify(plugin.capabilities?.jobs)]}),(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Scheduled tasks: ",JSON.stringify(plugin.capabilities?.scheduled_tasks)]})]})}},{title:"Actions",width:240,align:"right",render:function RenderAccess(_,plugin){return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[plugin.latest_tag&&plugin.tag!=plugin.latest_tag&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",icon:(0,jsx_runtime.jsx)(icons.fY8,{}),onClick:()=>updatePlugin(plugin.id),children:"Update"}),plugin.is_global?(0,jsx_runtime.jsx)(src.Tooltip,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["This app can currently be used by other organizations in this instance of PostHog. This action will ",(0,jsx_runtime.jsx)("b",{children:"disable and hide it"})," for all organizations that do not have an existing pluginconfig."]}),children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",icon:(0,jsx_runtime.jsx)(icons._V1,{}),onClick:()=>patchPlugin(plugin.id,{is_global:!1}),children:"Make local"})}):(0,jsx_runtime.jsx)(src.Tooltip,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["This action will mark this app as installed for"," ",(0,jsx_runtime.jsx)("b",{children:"all organizations"})," in this instance of PostHog."]}),children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",icon:(0,jsx_runtime.jsx)(icons.e0r,{}),onClick:()=>patchPlugin(plugin.id,{is_global:!0}),children:"Make global"})}),(0,jsx_runtime.jsx)(popconfirm.Z,{placement:"topLeft",title:"Are you sure you wish to uninstall this app completely?",onConfirm:()=>uninstallPlugin(plugin.id),okText:"Uninstall",cancelText:"Cancel",className:"Plugins__Popconfirm",children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",status:"danger",size:"small",icon:(0,jsx_runtime.jsx)(icons.Fzz,{}),disabledReason:unusedPlugins.includes(plugin.id)?void 0:"This app is still in use.","data-attr":"plugin-uninstall",children:"Uninstall"})})]})}}],expandable:{expandedRowRender:function Render(plugin){return(0,jsx_runtime.jsx)(AppCode,{pluginId:plugin.id,pluginType:plugin.plugin_type})}}})})}function OutOfSyncApps(){let{shouldNotBeGlobalPlugins,shouldBeGlobalPlugins}=(0,index_esm.useValues)(appsManagementLogic.k);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Out-of-sync global apps"}),(0,jsx_runtime.jsx)(src.LemonBanner,{type:"warning",children:"This PostHog Cloud instance is currently out of sync with the GLOBAL_PLUGINS list."}),(0,jsx_runtime.jsx)(MissingGlobalPlugins,{}),shouldNotBeGlobalPlugins&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Apps that should NOT be global"}),(0,jsx_runtime.jsx)("p",{children:"These apps should NOT be global according to repo."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:shouldNotBeGlobalPlugins})]}),shouldBeGlobalPlugins&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Apps that SHOULD be global"}),(0,jsx_runtime.jsx)("p",{children:"These already installed apps should be global according to repo."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:shouldBeGlobalPlugins})]}),(0,jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"})]})}function MissingGlobalPlugins(){let{missingGlobalPlugins,pluginsLoading,installingPluginUrl}=(0,index_esm.useValues)(appsManagementLogic.k),{installPlugin}=(0,index_esm.useActions)(appsManagementLogic.k);if(0===missingGlobalPlugins.length)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let data=missingGlobalPlugins.map(url=>({url}));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Missing global apps"}),(0,jsx_runtime.jsx)("p",{children:"These plugins are defined in the GLOBAL_PLUGINS list, but are not installed on this instance."}),(0,jsx_runtime.jsx)(src.LemonTable,{dataSource:data,columns:[{title:"URL",key:"url",render:function RenderUrl(_,_ref2){let{url}=_ref2;return(0,jsx_runtime.jsx)(Link.r,{to:url,target:"_blank",children:url})}},{title:"Actions",width:0,align:"right",render:function RenderInstallButton(_,_ref3){let{url}=_ref3;return(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",loading:pluginsLoading&&installingPluginUrl===url,onClick:()=>installPlugin(types.ak.Repository,url),id:`install-plugin-${url}`,children:"Install"})}}]})]})}function InstallFromUrl(){let{isCloudOrDev}=(0,index_esm.useValues)(preflightLogic.preflightLogic),{pluginUrl}=(0,index_esm.useValues)(appsManagementLogic.k),{setPluginUrl,installPlugin}=(0,index_esm.useActions)(appsManagementLogic.k),cloudRequiredPrefix="https://github.com/PostHog/",disabledReason=pluginUrl?void 0:"Please enter a url";return isCloudOrDev&&(disabledReason=pluginUrl.startsWith(cloudRequiredPrefix)?void 0:"Please enter a PostHog org repo url"),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Install from GitHub"}),(0,jsx_runtime.jsx)("p",{children:isCloudOrDev?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Only PostHog organization repositories are allowed, i.e. starting with"," ",(0,jsx_runtime.jsx)(Link.r,{to:cloudRequiredPrefix,target:"blank",children:cloudRequiredPrefix})," "]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["For private repositories, append ",(0,jsx_runtime.jsx)("code",{children:"?private_token=TOKEN"})," to the end of the URL."]})}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonInput.D,{value:pluginUrl,onChange:setPluginUrl,placeholder:"https://github.com/PostHog/posthog-hello-world-plugin",className:"flex-1"}),(0,jsx_runtime.jsx)(LemonButton.J,{disabledReason:disabledReason,type:"primary",onClick:()=>installPlugin(types.ak.Custom),children:"Fetch and install"})]})]})}function InstallLocalApp(){let{localPluginPath}=(0,index_esm.useValues)(appsManagementLogic.k),{setLocalPluginPath,installPlugin}=(0,index_esm.useActions)(appsManagementLogic.k);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Install from local path"}),(0,jsx_runtime.jsx)("p",{children:"To install a local app from this computer/server, give its full path below."}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonInput.D,{value:localPluginPath,onChange:setLocalPluginPath,placeholder:"/var/posthog/apps/helloworldapp",className:"flex-1"}),(0,jsx_runtime.jsx)(LemonButton.J,{disabledReason:localPluginPath?void 0:"Please enter a path",type:"primary",onClick:()=>installPlugin(types.ak.Local),children:"Install"})]})]})})}function InstallSourceApp(){let{sourcePluginName,sourcePluginKind}=(0,index_esm.useValues)(appsManagementLogic.k),{setSourcePluginName,installPlugin,setSourcePluginKind}=(0,index_esm.useActions)(appsManagementLogic.k),menuItems=Object.values(sourceAppInitialCode.n).map(kind=>({label:kind,onClick:()=>{setSourcePluginKind(kind)}}));return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Install by writing source code"}),(0,jsx_runtime.jsxs)("p",{children:["To install a source app provide the name and start coding.",(0,jsx_runtime.jsxs)(Link.r,{to:"https://posthog.com/docs/apps",target:"_blank",children:[" ","Read the documentation for more information!"]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonInput.D,{value:sourcePluginName,onChange:setSourcePluginName,placeholder:"Hello World App",className:"flex-1"}),(0,jsx_runtime.jsx)(src.LemonMenu,{items:menuItems,placement:"bottom-end",children:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",children:sourcePluginKind})}),(0,jsx_runtime.jsx)(LemonButton.J,{disabledReason:sourcePluginName?void 0:"Please enter a name",type:"primary",onClick:()=>installPlugin(types.ak.Source),children:"Install"})]})]})}appsManagementLogic.k;var ProductIntroduction=__webpack_require__("./frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonMarkdown=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMarkdown/LemonMarkdown.tsx"),columnUtils=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),deleteWithUndo=__webpack_require__("./frontend/src/lib/utils/deleteWithUndo.tsx"),Sparkline=__webpack_require__("./frontend/src/lib/lemon-ui/Sparkline.tsx"),destinationsLogic=__webpack_require__("./frontend/src/scenes/pipeline/destinationsLogic.tsx"),pipelineAppMetricsLogic=__webpack_require__("./frontend/src/scenes/pipeline/pipelineAppMetricsLogic.tsx");function AppMetricSparkLine(_ref){let{config}=_ref;if("backend"in config&&config.backend===destinationsLogic.V.BatchExport)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});{let logic=(0,pipelineAppMetricsLogic._)({pluginConfigId:config.id}),{appMetricsResponse}=(0,index_esm.useValues)(logic),displayData=[{color:"success",name:"Events sent",values:appMetricsResponse?appMetricsResponse.metrics.successes:[]}];return appMetricsResponse?.metrics.failures.some(failure=>failure>0)&&displayData.push({color:"danger",name:"Events dropped",values:appMetricsResponse?appMetricsResponse.metrics.failures:[]}),(0,jsx_runtime.jsx)(Sparkline.b,{loading:null===appMetricsResponse,labels:appMetricsResponse?appMetricsResponse.metrics.dates:[],data:displayData,className:"max-w-24"})}}function NewButton(_ref){let{kind}=_ref;return(0,jsx_runtime.jsxs)(LemonButton.J,{"data-attr":`new-${kind}`,to:urls.j.pipelineApp(kind,"new",types.j.Configuration),type:"primary",children:["New ",kind]})}function Destinations(){let{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h);if(!featureFlags[constants.y8.PIPELINE_UI])return(0,jsx_runtime.jsx)("p",{children:"Pipeline 3000 not available yet"});let{enabledPluginConfigs,disabledPluginConfigs,shouldShowProductIntroduction}=(0,index_esm.useValues)(destinationsLogic.w),shouldShowEmptyState=0===enabledPluginConfigs.length&&0===disabledPluginConfigs.length;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(shouldShowEmptyState||shouldShowProductIntroduction)&&(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Pipeline destinations",thingName:"destination",productKey:types.Md.PIPELINE_DESTINATIONS,description:"Pipeline destinations allow you to export data outside of PostHog, such as webhooks to Slack.",docsURL:"https://posthog.com/docs/cdp",actionElementOverride:(0,jsx_runtime.jsx)(NewButton,{kind:types.e4.Destination}),isEmpty:!0}),(0,jsx_runtime.jsx)(DestinationsTable,{})]})}function DestinationsTable(){let{loading,destinations}=(0,index_esm.useValues)(destinationsLogic.w);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.LemonTable,{dataSource:destinations,size:"xs",loading:loading,columns:[{title:"Name",sticky:!0,render:function RenderPluginName(_,destination){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Tooltip,{title:"Click to update configuration, view metrics, and more",children:(0,jsx_runtime.jsx)(src.Link,{to:destination.config_url,children:(0,jsx_runtime.jsx)("span",{className:"row-name",children:destination.name})})}),destination.description&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"row-description",lowKeyHeadings:!0,children:destination.description})]})}},{title:"App",render:function RenderAppInfo(_,destination){return"plugin"===destination.backend?(0,jsx_runtime.jsx)(utils.Wf,{plugin:destination.plugin}):(0,jsx_runtime.jsx)(utils.oe,{type:destination.data_storage_type})}},{title:"Frequency",render:function RenderFrequency(_,destination){return destination.frequency}},{title:"Success rate",render:function RenderSuccessRate(_,destination){return(0,jsx_runtime.jsx)(AppMetricSparkLine,{config:destination})}},(0,columnUtils.yI)(),{title:"Status",render:function RenderStatus(_,destination){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:destination.enabled?(0,jsx_runtime.jsx)(src.LemonTag,{type:"success",className:"uppercase",children:"Active"}):(0,jsx_runtime.jsx)(src.LemonTag,{type:"default",className:"uppercase",children:"Paused"})})}},{width:0,render:function Render(_,destination){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(DestinationMoreOverlay,{destination:destination})})}}]})})}let DestinationMoreOverlay=_ref=>{let{destination,inOverview=!1}=_ref,{canConfigurePlugins}=(0,index_esm.useValues)(destinationsLogic.w),{toggleEnabled,loadPluginConfigs}=(0,index_esm.useActions)(destinationsLogic.w);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!inOverview&&(0,jsx_runtime.jsxs)(src.LemonButton,{onClick:()=>toggleEnabled(destination,!destination.enabled),id:`app-${destination.id}-enable-switch`,disabledReason:canConfigurePlugins?void 0:"You do not have permission to enable/disable destinations.",fullWidth:!0,children:[destination.enabled?"Pause":"Unpause"," destination"]}),(0,jsx_runtime.jsxs)(src.LemonButton,{to:destination.config_url,id:`app-${destination.id}-configuration`,fullWidth:!0,children:[canConfigurePlugins?"Edit":"View"," destination configuration"]}),(0,jsx_runtime.jsx)(src.LemonButton,{to:destination.metrics_url,id:`app-${destination.id}-metrics`,fullWidth:!0,children:"View metrics"}),(0,jsx_runtime.jsx)(src.LemonButton,{to:destination.logs_url,id:`app-${destination.id}-logs`,fullWidth:!0,children:"View logs"}),destination.app_source_code_url&&(0,jsx_runtime.jsx)(src.LemonButton,{to:destination.app_source_code_url,targetBlank:!0,id:`app-${destination.id}-source-code`,fullWidth:!0,children:"View app source code"}),!inOverview&&"plugin"===destination.backend&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonDivider,{}),(0,jsx_runtime.jsx)(src.LemonButton,{status:"danger",onClick:()=>{(0,deleteWithUndo.S)({endpoint:"plugin_config",object:{id:destination.id,name:destination.name},callback:loadPluginConfigs})},id:"app-delete",disabledReason:canConfigurePlugins?void 0:"You do not have permission to delete apps.",fullWidth:!0,children:"Delete app"})]})]})};var clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),SeriesGlyph=__webpack_require__("./frontend/src/lib/components/SeriesGlyph.tsx"),lemon_ui_LemonMarkdown=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMarkdown/index.ts"),PluginImage=__webpack_require__("./frontend/src/scenes/plugins/plugin/PluginImage.tsx"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),transformationsLogic=__webpack_require__("./frontend/src/scenes/pipeline/transformationsLogic.tsx");let pipelineOverviewLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","pipeline","overviewLogic"]),(0,index_esm.connect)({values:[teamLogic.teamLogic,["currentTeamId"],transformationsLogic.P,["pluginsLoading as transformationPluginsLoading","pluginConfigsLoading as transformationPluginConfigsLoading","displayablePluginConfigs as transformations"],destinationsLogic.w,["pluginsLoading as destinationPluginsLoading","pluginConfigsLoading as destinationPluginConfigsLoading","batchExportConfigsLoading","destinations"]],actions:[transformationsLogic.P,["loadPlugins as loadTransformationPlugins","loadPluginConfigs as loadTransformationPluginConfigs"],destinationsLogic.w,["loadPlugins as loadDestinationPlugins","loadPluginConfigs as loadDestinationPluginConfigs","loadBatchExports as loadBatchExportConfigs"]]}),(0,index_esm.selectors)({transformationsLoading:[s=>[s.transformationPluginsLoading,s.transformationPluginConfigsLoading],(transformationPluginsLoading,transformationPluginConfigsLoading)=>transformationPluginsLoading||transformationPluginConfigsLoading],destinationsLoading:[s=>[s.destinationPluginsLoading,s.destinationPluginConfigsLoading,s.batchExportConfigsLoading],(pluginsLoading,destinationPluginConfigsLoading,batchExportConfigsLoading)=>pluginsLoading||destinationPluginConfigsLoading||batchExportConfigsLoading]}),(0,index_esm.afterMount)(_ref=>{let{actions}=_ref;actions.loadTransformationPlugins(),actions.loadTransformationPluginConfigs(),actions.loadDestinationPlugins(),actions.loadDestinationPluginConfigs(),actions.loadBatchExportConfigs()})]);var core_esm=__webpack_require__("./node_modules/.pnpm/@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0/node_modules/@dnd-kit/core/dist/core.esm.js"),modifiers_esm=__webpack_require__("./node_modules/.pnpm/@dnd-kit+modifiers@6.0.1_@dnd-kit+core@6.0.8_react@18.2.0/node_modules/@dnd-kit/modifiers/dist/modifiers.esm.js"),sortable_esm=__webpack_require__("./node_modules/.pnpm/@dnd-kit+sortable@7.0.2_@dnd-kit+core@6.0.8_react@18.2.0/node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),utilities_esm=__webpack_require__("./node_modules/.pnpm/@dnd-kit+utilities@3.2.1_react@18.2.0/node_modules/@dnd-kit/utilities/dist/utilities.esm.js");function Transformations(){let{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h);if(!featureFlags[constants.y8.PIPELINE_UI])return(0,jsx_runtime.jsx)("p",{children:"Pipeline 3000 not available yet"});let{loading,sortedEnabledPluginConfigs,disabledPluginConfigs,displayablePluginConfigs,canConfigurePlugins,shouldShowProductIntroduction}=(0,index_esm.useValues)(transformationsLogic.P),{openReorderModal}=(0,index_esm.useActions)(transformationsLogic.P),shouldShowEmptyState=0===sortedEnabledPluginConfigs.length&&0===disabledPluginConfigs.length;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(shouldShowEmptyState||shouldShowProductIntroduction)&&(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Pipeline transformations",thingName:"transformation",productKey:types.Md.PIPELINE_TRANSFORMATIONS,description:"Pipeline transformations allow you to enrich your data with additional information, such as geolocation.",docsURL:"https://posthog.com/docs/cdp",actionElementOverride:(0,jsx_runtime.jsx)(NewButton,{kind:types.e4.Transformation}),isEmpty:!0}),!shouldShowEmptyState&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[sortedEnabledPluginConfigs.length>1&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ReorderModal,{}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:["Processed sequentially.",(0,jsx_runtime.jsx)(src.LemonButton,{onClick:openReorderModal,noPadding:!0,id:"app-reorder",disabledReason:canConfigurePlugins?void 0:"You do not have permission to reorder plugins.",children:"Change order"})]})]}),(0,jsx_runtime.jsx)(src.LemonTable,{dataSource:displayablePluginConfigs,size:"xs",loading:loading,columns:[{title:"Order",key:"order",sticky:!0,render:function RenderOrdering(_,pluginConfig){return pluginConfig.enabled?sortedEnabledPluginConfigs.findIndex(pc=>pc.id===pluginConfig.id)+1:null}},{title:"Name",sticky:!0,render:function RenderPluginName(_,pluginConfig){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Tooltip,{title:"Click to update configuration, view metrics, and more",children:(0,jsx_runtime.jsx)(src.Link,{to:urls.j.pipelineApp(types.e4.Transformation,pluginConfig.id,types.j.Configuration),children:(0,jsx_runtime.jsx)("span",{className:"row-name",children:pluginConfig.name})})}),pluginConfig.description&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"row-description",lowKeyHeadings:!0,children:pluginConfig.description})]})}},{title:"App",render:function RenderAppInfo(_,pluginConfig){return(0,jsx_runtime.jsx)(utils.Wf,{plugin:pluginConfig.plugin_info})}},(0,columnUtils.yI)(),{title:"Status",render:function RenderStatus(_,pluginConfig){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:pluginConfig.enabled?(0,jsx_runtime.jsx)(src.LemonTag,{type:"success",className:"uppercase",children:"Enabled"}):(0,jsx_runtime.jsx)(src.LemonTag,{type:"default",className:"uppercase",children:"Disabled"})})}},{width:0,render:function Render(_,pluginConfig){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(TransformationsMoreOverlay,{pluginConfig:pluginConfig})})}}]})]})]})}let TransformationsMoreOverlay=_ref=>{let{pluginConfig,inOverview=!1}=_ref,{canConfigurePlugins}=(0,index_esm.useValues)(transformationsLogic.P),{openReorderModal,toggleEnabled,loadPluginConfigs}=(0,index_esm.useActions)(transformationsLogic.P);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!inOverview&&(0,jsx_runtime.jsxs)(src.LemonButton,{onClick:()=>{toggleEnabled({enabled:!pluginConfig.enabled,id:pluginConfig.id})},id:`app-${pluginConfig.id}-enable-switch`,disabledReason:canConfigurePlugins?void 0:"You do not have permission to enable/disable apps.",fullWidth:!0,children:[pluginConfig.enabled?"Disable":"Enable"," app"]}),!inOverview&&pluginConfig.enabled&&(0,jsx_runtime.jsx)(src.LemonButton,{onClick:openReorderModal,id:"app-reorder",disabledReason:canConfigurePlugins?void 0:"You do not have permission to reorder apps.",fullWidth:!0,children:"Reorder apps"}),(0,jsx_runtime.jsxs)(src.LemonButton,{to:urls.j.pipelineApp(types.e4.Transformation,pluginConfig.id,types.j.Configuration),id:`app-${pluginConfig.id}-configuration`,fullWidth:!0,children:[canConfigurePlugins?"Edit":"View"," app configuration"]}),(0,jsx_runtime.jsx)(src.LemonButton,{to:urls.j.pipelineApp(types.e4.Transformation,pluginConfig.id,types.j.Metrics),id:`app-${pluginConfig.id}-metrics`,fullWidth:!0,children:"View app metrics"}),(0,jsx_runtime.jsx)(src.LemonButton,{to:urls.j.pipelineApp(types.e4.Transformation,pluginConfig.id,types.j.Logs),id:`app-${pluginConfig.id}-logs`,fullWidth:!0,children:"View app logs"}),(0,jsx_runtime.jsx)(src.LemonButton,{to:pluginConfig.plugin_info?.url,targetBlank:!0,loading:!pluginConfig.plugin_info?.url,id:`app-${pluginConfig.id}-source-code`,fullWidth:!0,children:"View app source code"}),!inOverview&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonDivider,{}),(0,jsx_runtime.jsx)(src.LemonButton,{status:"danger",onClick:()=>{(0,deleteWithUndo.S)({endpoint:"plugin_config",object:{id:pluginConfig.id,name:pluginConfig.name},callback:loadPluginConfigs})},id:"app-delete",disabledReason:canConfigurePlugins?void 0:"You do not have permission to delete apps.",fullWidth:!0,children:"Delete app"})]})]})};function ReorderModal(){let{reorderModalOpen,sortedEnabledPluginConfigs,temporaryOrder,pluginConfigsLoading}=(0,index_esm.useValues)(transformationsLogic.P),{closeReorderModal,setTemporaryOrder,savePluginConfigsOrder}=(0,index_esm.useActions)(transformationsLogic.P);return(0,jsx_runtime.jsx)(src.LemonModal,{onClose:closeReorderModal,isOpen:reorderModalOpen,width:600,title:"Reorder apps",description:(0,jsx_runtime.jsxs)("p",{children:["The order of apps is important as they are processed sequentially. You can"," ",(0,jsx_runtime.jsx)("b",{children:"drag and drop the apps below"})," to change their order."]}),footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:closeReorderModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.LemonButton,{loading:pluginConfigsLoading,type:"primary",onClick:()=>savePluginConfigsOrder(temporaryOrder),children:"Save order"})]}),children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-2",children:(0,jsx_runtime.jsx)(core_esm.LB,{modifiers:[modifiers_esm.DL,modifiers_esm.F4],onDragEnd:_ref2=>{let{active,over}=_ref2;if(active.id&&over&&active.id!==over.id){let from=sortedEnabledPluginConfigs.findIndex(config=>config.id===active.id),to=sortedEnabledPluginConfigs.findIndex(config=>config.id===over.id),newSortedEnabledPluginConfigs=(0,sortable_esm.Rp)(sortedEnabledPluginConfigs,from,to),newTemporaryOrder=newSortedEnabledPluginConfigs.reduce((acc,pluginConfig,index)=>({...acc,[pluginConfig.id]:index+1}),{});setTemporaryOrder(newTemporaryOrder)}},children:(0,jsx_runtime.jsx)(sortable_esm.Fo,{items:sortedEnabledPluginConfigs,strategy:sortable_esm.qw,children:sortedEnabledPluginConfigs.map((item,index)=>(0,jsx_runtime.jsx)(MinimalAppView,{pluginConfig:item,order:index},item.id))})})})})}let MinimalAppView=_ref3=>{let{pluginConfig,order}=_ref3,{plugins}=(0,index_esm.useValues)(transformationsLogic.P),{attributes,listeners,setNodeRef,transform,transition,isDragging}=(0,sortable_esm.nB)({id:pluginConfig.id}),plugin=plugins[pluginConfig.plugin];return(0,jsx_runtime.jsxs)("div",{ref:setNodeRef,className:"flex gap-2 cursor-move border rounded p-2 items-center bg-bg-light",style:{position:"relative",transform:utilities_esm.ux.Transform.toString(transform),transition,zIndex:isDragging?999999:void 0},...attributes,...listeners,children:[(0,jsx_runtime.jsx)(src.LemonBadge.Number,{count:order+1,maxDigits:3}),(0,jsx_runtime.jsx)(PluginImage.c,{plugin:plugin,size:"small"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:pluginConfig.name})]})},PipelineStep=_ref=>{let{order,name,to,description,headerInfo,additionalInfo,plugin}=_ref;return(0,jsx_runtime.jsxs)(src.LemonCard,{children:[void 0!==order&&(0,jsx_runtime.jsx)("div",{className:"mb-3",children:(0,jsx_runtime.jsx)(SeriesGlyph.K,{style:{color:"var(--muted)",borderColor:"var(--muted)"},children:order})}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-3 min-h-13",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[plugin&&(0,jsx_runtime.jsx)(PluginImage.c,{plugin:plugin,size:"small"}),(0,jsx_runtime.jsx)("h3",{className:(0,clsx_m.default)("mb-0 mr-2",{"ml-3":plugin}),children:(0,jsx_runtime.jsx)(src.Link,{to:to,subtle:!0,children:name})})]}),(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:headerInfo})]}),description?(0,jsx_runtime.jsx)(lemon_ui_LemonMarkdown.j,{className:"row-description",lowKeyHeadings:!0,children:description}):(0,jsx_runtime.jsx)("span",{className:"italic",children:"No description."}),additionalInfo&&(0,jsx_runtime.jsx)("div",{className:"mt-3 flex flex-end",children:additionalInfo})]})},PipelineStepSkeleton=()=>(0,jsx_runtime.jsxs)(src.LemonCard,{children:[(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"h-5 w-1/3 mb-3"}),(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"h-4 w-3/4 mb-3"}),(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"h-4 w-1/2"})]}),PipelineStepTransformation=_ref2=>{let{transformation}=_ref2,{sortedEnabledPluginConfigs}=(0,index_esm.useValues)(transformationsLogic.P);return(0,jsx_runtime.jsx)(PipelineStep,{order:sortedEnabledPluginConfigs.findIndex(pc=>pc.id===transformation.id)+1,name:transformation.name,to:urls.j.pipelineApp(types.e4.Transformation,transformation.id,types.j.Configuration),description:transformation.description,headerInfo:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mr-1",children:(0,jsx_runtime.jsx)(AppMetricSparkLine,{config:transformation})}),(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(TransformationsMoreOverlay,{pluginConfig:transformation,inOverview:!0})})]}),plugin:transformation.plugin_info})},PipelineStepDestination=_ref3=>{let{destination}=_ref3;return(0,jsx_runtime.jsx)(PipelineStep,{name:destination.name,to:destination.config_url,description:destination.description,headerInfo:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mr-1",children:(0,jsx_runtime.jsx)(AppMetricSparkLine,{config:destination})}),(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(DestinationMoreOverlay,{destination:destination,inOverview:!0})})]}),additionalInfo:(0,jsx_runtime.jsxs)("div",{className:"flex gap-1",children:[(0,jsx_runtime.jsx)(src.LemonTag,{type:"primary",children:(0,utils.NG)(destination.frequency)}),destination.backend===destinationsLogic.V.BatchExport]}),plugin:destination.backend===destinationsLogic.V.Plugin?destination.plugin:void 0})};function Overview(){let{transformations,destinations,transformationsLoading,destinationsLoading}=(0,index_esm.useValues)(pipelineOverviewLogic);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Filters"}),(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("i",{children:"Coming soon."})}),(0,jsx_runtime.jsx)("h2",{className:"mt-4",children:"Transformations"}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-3 gap-4",children:transformationsLoading?(0,jsx_runtime.jsx)(PipelineStepSkeleton,{}):transformations&&transformations.filter(t=>t.enabled).map(t=>(0,jsx_runtime.jsx)(PipelineStepTransformation,{transformation:t},t.id))}),(0,jsx_runtime.jsx)("h2",{className:"mt-4",children:"Destinations"}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-3 gap-4",children:destinationsLoading?(0,jsx_runtime.jsx)(PipelineStepSkeleton,{}):destinations&&destinations.filter(d=>d.enabled).map(d=>(0,jsx_runtime.jsx)(PipelineStepDestination,{destination:d},d.id))})]})}var PipelineApp=__webpack_require__("./frontend/src/scenes/pipeline/PipelineApp.tsx"),pipelineLogic=__webpack_require__("./frontend/src/scenes/pipeline/pipelineLogic.tsx");function Pipeline(){let{currentTab}=(0,index_esm.useValues)(pipelineLogic.B),tabToContent={[types.J9.Overview]:(0,jsx_runtime.jsx)(Overview,{}),[types.J9.Filters]:(0,jsx_runtime.jsx)("div",{children:"Coming soon"}),[types.J9.Transformations]:(0,jsx_runtime.jsx)(Transformations,{}),[types.J9.Destinations]:(0,jsx_runtime.jsx)(Destinations,{}),[types.J9.AppsManagement]:(0,jsx_runtime.jsx)(AppsManagement,{})},maybeKind=PipelineApp.PIPELINE_TAB_TO_APP_KIND[currentTab];return(0,jsx_runtime.jsxs)("div",{className:"pipeline-scene",children:[(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Add filters or transformations to the events sent to PostHog or export them to other tools.",buttons:maybeKind?(0,jsx_runtime.jsx)(NewButton,{kind:maybeKind}):void 0}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,onChange:tab=>lib.router.actions.push(urls.j.pipeline(tab)),tabs:Object.values(types.J9).map(tab=>({label:(0,pipelineLogic.$)(tab),key:tab,content:tabToContent[tab]}))})]})}let Pipeline_scene={component:Pipeline,logic:pipelineLogic.B}},"./frontend/src/scenes/pipeline/appCodeLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{d:()=>appsCodeLogic,g:()=>formatSource});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts");let appsCodeLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{pluginId}=_ref;return pluginId}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(id=>["scenes","pipeline","appsCodeLogic",id]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setCurrentFile:currentFile=>({currentFile}),editAppCode:!0,cancelEditing:!0,fetchPluginSource:!0,fetchPluginSourceComplete:!0,setFilenames:code=>({code})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({currentFile:["plugin.json",{setCurrentFile:(_,_ref2)=>{let{currentFile}=_ref2;return currentFile}}],editingAppCode:[!1,{editAppCode:()=>!0,cancelEditing:()=>!1,submitPluginSourceSuccess:()=>!1}],pluginSourceLoading:[!1,{fetchPluginSource:()=>!0,fetchPluginSourceComplete:()=>!1}],filenames:[[],{setFilenames:(_,_ref3)=>{let{code}=_ref3;return code?Object.keys(code):[]}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions,props}=_ref4;return{cancelEditing:async()=>{actions.fetchPluginSource()},fetchPluginSource:async()=>{try{let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/organizations/@current/plugins/${props.pluginId}/source`),formattedCode={};for(let[file,source]of Object.entries(response||{}))if(source&&file.match(/\.(ts|tsx|js|jsx|json)$/))try{let prettySource=await formatSource(file,source);formattedCode[file]=prettySource}catch(e){formattedCode[file]=source}actions.setPluginSourceValues(formattedCode),actions.setFilenames(formattedCode)}finally{actions.fetchPluginSourceComplete()}}}}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_1__.forms)(_ref5=>{let{actions,props,values}=_ref5;return{pluginSource:{defaults:{},preSubmit:async()=>{let changes={},errors={};for(let[file,source]of Object.entries(values.pluginSource))if(source&&file.match(/\.(ts|tsx|js|jsx|json)$/))try{let prettySource=await formatSource(file,source);prettySource!==source&&(changes[file]=prettySource)}catch(e){errors[file]=e.message}Object.keys(changes).length>0&&actions.setPluginSourceValues(changes),actions.setPluginSourceManualErrors(errors)},submit:async()=>{let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/organizations/@current/plugins/${props.pluginId}/update_source`,values.pluginSource);actions.setPluginSourceValues(response)}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref6=>{let{actions}=_ref6;actions.fetchPluginSource()})]);async function formatSource(filename,source){if(filename.endsWith(".json"))return JSON.stringify(JSON.parse(source),null,4)+"\n";let prettier=(await __webpack_require__.e(7192).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/.pnpm/prettier@2.8.8/node_modules/prettier/standalone.js",23))).default,parserTypeScript=(await __webpack_require__.e(775).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/.pnpm/prettier@2.8.8/node_modules/prettier/parser-typescript.js",23))).default;return prettier.format(source,{filepath:filename,parser:"typescript",plugins:[parserTypeScript],semi:!1,trailingComma:"es5",singleQuote:!0,tabWidth:4,printWidth:120})}},"./frontend/src/scenes/pipeline/appsManagementLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>appsManagementLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),posthog_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/posthog-js@1.104.0/node_modules/posthog-js/dist/es.js"),scenes_plugins_access__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/plugins/access.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/types.ts"),_sourceAppInitialCode__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/pipeline/sourceAppInitialCode.tsx"),_utils__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");function capturePluginEvent(event,plugin,type){posthog_js__WEBPACK_IMPORTED_MODULE_4__.ZP.capture(event,{plugin_name:plugin.name,plugin_url:plugin.url?.startsWith("file:")?"file://masked-local-path":plugin.url,plugin_tag:plugin.tag,plugin_installation_type:type})}let appsManagementLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","appsManagementLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_userLogic__WEBPACK_IMPORTED_MODULE_6__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setPluginUrl:pluginUrl=>({pluginUrl}),setLocalPluginPath:localPluginPath=>({localPluginPath}),setSourcePluginName:sourcePluginName=>({sourcePluginName}),setSourcePluginKind:sourcePluginKind=>({sourcePluginKind}),uninstallPlugin:id=>({id}),installPlugin:(pluginType,url)=>({pluginType,url}),installPluginFromUrl:url=>({url}),installSourcePlugin:name=>({name}),installLocalPlugin:path=>({path}),patchPlugin:function(id){let pluginChanges=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{id,pluginChanges}},updatePlugin:id=>({id}),checkForUpdates:!0,checkedForUpdates:!0,setPluginLatestTag:(id,latestTag)=>({id,latestTag})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>{let results=await (0,_utils__WEBPACK_IMPORTED_MODULE_9__.cw)("api/organizations/@current/plugins"),plugins={};for(let plugin of results)plugins[plugin.id]=plugin;return plugins},installPlugin:async _ref2=>{let{pluginType,url}=_ref2;if(!values.canInstallPlugins)return lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("You don't have permission to install apps."),values.plugins;let payload={plugin_type:pluginType};if(url||pluginType===_types__WEBPACK_IMPORTED_MODULE_7__.ak.Repository)payload.url=url;else if(pluginType===_types__WEBPACK_IMPORTED_MODULE_7__.ak.Custom)payload.url=values.pluginUrl;else if(pluginType===_types__WEBPACK_IMPORTED_MODULE_7__.ak.Local)payload.url=`file:${values.localPluginPath}`;else{if(pluginType!==_types__WEBPACK_IMPORTED_MODULE_7__.ak.Source)return lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Unsupported installation type."),values.plugins;payload.name=values.sourcePluginName}let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.create("api/organizations/@current/plugins",payload);return pluginType===_types__WEBPACK_IMPORTED_MODULE_7__.ak.Source&&await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/organizations/@current/plugins/${response.id}/update_source`,(0,_sourceAppInitialCode__WEBPACK_IMPORTED_MODULE_8__.g)(values.sourcePluginName,values.sourcePluginKind)),capturePluginEvent("plugin installed",response,pluginType),{...values.plugins,[response.id]:response}},uninstallPlugin:async _ref3=>{let{id}=_ref3;values.canGloballyManagePlugins||lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("You don't have permission to manage apps."),await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.delete(`api/organizations/@current/plugins/${id}`),capturePluginEvent("plugin uninstalled",values.plugins[id],values.plugins[id].plugin_type);let{[id]:_discard,...rest}=values.plugins;return rest},patchPlugin:async _ref4=>{let{id,pluginChanges}=_ref4;values.canGloballyManagePlugins||lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("You don't have permission to update apps.");let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/organizations/@current/plugins/${id}`,pluginChanges);return{...values.plugins,[id]:response}},setPluginLatestTag:async _ref5=>{let{id,latestTag}=_ref5;return{...values.plugins,[id]:{...values.plugins[id],latest_tag:latestTag}}},updatePlugin:async _ref6=>{let{id}=_ref6;values.canGloballyManagePlugins||lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("You don't have permission to update apps.");let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.create(`api/organizations/@current/plugins/${id}/upgrade`);return capturePluginEvent("plugin updated",values.plugins[id],values.plugins[id].plugin_type),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success(`Plugin ${response.name} updated!`),{...values.plugins,[id]:response}}}],unusedPlugins:[[],{loadUnusedPlugins:async()=>{let results=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get("api/organizations/@current/plugins/unused");return results}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({installingPluginUrl:[null,{installPlugin:(_,_ref7)=>{let{url}=_ref7;return url||null},installPluginSuccess:()=>null,installPluginFailure:()=>null}],pluginUrl:["",{setPluginUrl:(_,_ref8)=>{let{pluginUrl}=_ref8;return pluginUrl},installPluginSuccess:()=>""}],localPluginPath:["",{setLocalPluginPath:(_,_ref9)=>{let{localPluginPath}=_ref9;return localPluginPath},installPluginSuccess:()=>""}],sourcePluginName:["",{setSourcePluginName:(_,_ref10)=>{let{sourcePluginName}=_ref10;return sourcePluginName},installPluginSuccess:()=>""}],sourcePluginKind:[_sourceAppInitialCode__WEBPACK_IMPORTED_MODULE_8__.n.FilterEvent,{setSourcePluginKind:(_,_ref11)=>{let{sourcePluginKind}=_ref11;return sourcePluginKind},installPluginSuccess:()=>_sourceAppInitialCode__WEBPACK_IMPORTED_MODULE_8__.n.FilterEvent}],checkingForUpdates:[!1,{checkForUpdates:()=>!0,checkedForUpdates:()=>!1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({canInstallPlugins:[s=>[s.user],user=>(0,scenes_plugins_access__WEBPACK_IMPORTED_MODULE_5__.FZ)(user?.organization)],canGloballyManagePlugins:[s=>[s.user],user=>(0,scenes_plugins_access__WEBPACK_IMPORTED_MODULE_5__.YU)(user?.organization)],globalPlugins:[s=>[s.plugins],plugins=>Object.values(plugins).filter(plugin=>plugin.is_global)],localPlugins:[s=>[s.plugins],plugins=>Object.values(plugins).filter(plugin=>!plugin.is_global)],missingGlobalPlugins:[s=>[s.plugins],plugins=>{let existingUrls=new Set(Object.values(plugins).map(p=>p.url));return Array.from(_utils__WEBPACK_IMPORTED_MODULE_9__.$V).filter(url=>!existingUrls.has(url))}],shouldBeGlobalPlugins:[s=>[s.plugins],plugins=>Object.values(plugins).filter(plugin=>plugin.url&&_utils__WEBPACK_IMPORTED_MODULE_9__.$V.has(plugin.url)&&!plugin.is_global)],shouldNotBeGlobalPlugins:[s=>[s.plugins],plugins=>Object.values(plugins).filter(plugin=>!(plugin.url&&_utils__WEBPACK_IMPORTED_MODULE_9__.$V.has(plugin.url))&&plugin.is_global)],updatablePlugins:[s=>[s.plugins],plugins=>Object.values(plugins).filter(plugin=>plugin.plugin_type!==_types__WEBPACK_IMPORTED_MODULE_7__.ak.Source&&!plugin.url?.startsWith("file:"))],pluginsNeedingUpdates:[s=>[s.updatablePlugins],plugins=>plugins.filter(plugin=>plugin.latest_tag&&plugin.tag!==plugin.latest_tag)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref12=>{let{actions,values}=_ref12;return{checkForUpdates:async()=>{await Promise.all(values.updatablePlugins.map(async plugin=>{try{let updates=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/organizations/@current/plugins/${plugin.id}/check_for_updates`);actions.setPluginLatestTag(plugin.id,updates.plugin.latest_tag)}catch(e){lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error(`Error checking for updates for ${plugin.name}: ${JSON.stringify(e)}`)}})),actions.checkedForUpdates()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref13=>{let{actions}=_ref13;actions.loadPlugins(),actions.loadUnusedPlugins(),actions.checkForUpdates()})])},"./frontend/src/scenes/pipeline/pipelineLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>humanFriendlyTabName,B:()=>pipelineLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/urls.ts"),_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/types.ts");let humanFriendlyTabName=tab=>{switch(tab){case _types__WEBPACK_IMPORTED_MODULE_4__.J9.Overview:return"Overview";case _types__WEBPACK_IMPORTED_MODULE_4__.J9.Filters:return"Filters";case _types__WEBPACK_IMPORTED_MODULE_4__.J9.Transformations:return"Transformations";case _types__WEBPACK_IMPORTED_MODULE_4__.J9.Destinations:return"Destinations";case _types__WEBPACK_IMPORTED_MODULE_4__.J9.AppsManagement:return"Apps management"}},pipelineLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","pipelineLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setCurrentTab:function(){let tab=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_types__WEBPACK_IMPORTED_MODULE_4__.J9.Destinations;return{tab}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({currentTab:[_types__WEBPACK_IMPORTED_MODULE_4__.J9.Destinations,{setCurrentTab:(_,_ref)=>{let{tab}=_ref;return tab}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(()=>({breadcrumbs:[s=>[s.currentTab],tab=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_2__.x.Pipeline,name:"Data pipeline"},{key:tab,name:humanFriendlyTabName(tab)}]]})),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.actionToUrl)(_ref2=>{let{values}=_ref2;return{setCurrentTab:()=>[scenes_urls__WEBPACK_IMPORTED_MODULE_3__.j.pipeline(values.currentTab)]}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.urlToAction)(_ref3=>{let{actions,values}=_ref3;return{"/pipeline/:tab":_ref4=>{let{tab}=_ref4;tab!==values.currentTab&&actions.setCurrentTab(tab)}}})])},"./frontend/src/scenes/pipeline/sourceAppInitialCode.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>getInitialCode,n:()=>SourcePluginKind});let SourcePluginKind=function(SourcePluginKind){return SourcePluginKind.FilterEvent="filterEvent",SourcePluginKind.ModifyEvent="modifyEvent",SourcePluginKind.ComposeWebhook="composeWebhook",SourcePluginKind.Site="site",SourcePluginKind.Frontend="frontend",SourcePluginKind}({});function getInitialCode(name,kind){switch(kind){case SourcePluginKind.FilterEvent:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"eventToSkip",name:"Event to skip",type:"string",hint:"If the event name matches this, it will be skipped",default:"$pageview",required:!1}]},null,4),"index.ts":`// Learn more about plugins at: https://posthog.com/docs/apps/build

// Processes each event, optionally dropping it
export function processEvent(event, { config }) {
    if (event.event === config.eventToSkip) {
        return null
    }
    return event
}

// Runs when the plugin is loaded, allows for preparing it as needed
export function setupPlugin (meta) {
    console.log(\`The date is \${new Date().toDateString()}\`)
}`};case SourcePluginKind.ModifyEvent:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"propertyToRemove",name:"Property to remove",type:"string",hint:"This property will be removed from all events",default:"$browser",required:!1}]},null,4),"index.ts":`// Learn more about plugins at: https://posthog.com/docs/apps/build

// Processes each event, optionally modify it
export function processEvent(event, { config }) {
    event.properties[config.propertyToRemove] = undefined
    return event
}

// Runs when the plugin is loaded, allows for preparing it as needed
export function setupPlugin (meta) {
    console.log(\`The date is \${new Date().toDateString()}\`)
}`};case SourcePluginKind.ComposeWebhook:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"url",name:"The destination url",type:"string",hint:"Where the webhook will be sent to",default:"",required:!0}]},null,4),"index.ts":`// Learn more about plugins at: https://posthog.com/docs/apps/build
import { PostHogEvent, Webhook } from '@posthog/plugin-scaffold'

export function composeWebhook(event: PostHogEvent, { config }: any): Webhook {
    return {
        url: config.url,
        body: JSON.stringify(event),
        headers: {
            'Content-Type': 'application/json',
        },
        method: 'POST',
    }
}`};case SourcePluginKind.Site:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"name",name:"Person to greet",type:"string",hint:"Used to personalise the property `hello`",default:"world",required:!1}]},null,4),"site.ts":`export function inject({ config, posthog }) {
    console.log('Hello from PostHog-JS')
}
"`};case SourcePluginKind.Frontend:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"name",name:"Person to greet",type:"string",hint:"Used to personalise the property `hello`",default:"world",required:!1}]},null,4),"frontend.tsx":`import React from "react"

                export const scene = {
                    title: "My Stuff",
                    component: function MyStuff({ config }) {
                        return (
                            <div>
                                <h1>My Favourite Links</h1>
                                <ul>
                                    <li>
                                        <a href="https://news.ycombinator.com">The NEWS</a>
                                    </li>
                                </ul>
                                <h1>My Favourite Cow</h1>
                                <img src="https://media.giphy.com/media/RYKFEEjtYpxL2/giphy.gif" />
                            </div>
                        )
                    },
                }`}}}}}]);
//# sourceMappingURL=9430.21be09d9.iframe.bundle.js.map