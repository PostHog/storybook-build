"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[28399],{"../../products/endpoints/frontend/EndpointScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EndpointScene:()=>EndpointScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx");__webpack_require__("../../frontend/src/lib/lemon-ui/LemonModal/LemonModal.tsx");var LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),ButtonPrimitives=__webpack_require__("../../frontend/src/lib/ui/Button/ButtonPrimitives.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),SceneLayout=__webpack_require__("../../frontend/src/layout/scenes/SceneLayout.tsx"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),CodeSnippet=__webpack_require__("../../frontend/src/lib/components/CodeSnippet/index.ts"),SceneSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneSection.tsx"),endpointLogic=__webpack_require__("../../products/endpoints/frontend/endpointLogic.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function generateVariablesJson(variables){let entries=Object.entries(variables);return 0===entries.length?"      // No variables defined":entries.map((_ref,index)=>{let[key,value]=_ref,isLast=index===entries.length-1;return`      "${key}": ${JSON.stringify(value.value)}${isLast?"":","}`}).join("\n")}function getEndpointUrl(endpointPath){return`${window.location.origin}${endpointPath}`}function generateTerminalExample(endpointPath,variables){return`curl -X POST ${getEndpointUrl(endpointPath)} \\
  -H "Authorization: Bearer $POSTHOG_PERSONAL_API_KEY" \\
  -H "Content-Type: application/json" \\
  -d '{
    "variables_values": {
${generateVariablesJson(variables)}
    }
  }'`}function generatePythonExample(endpointPath,variables){return`import requests
import json

url = "${getEndpointUrl(endpointPath)}"

headers = {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'
}

payload = {
    "variables_values": {
${generateVariablesJson(variables)}
    }
}

response = requests.post(url, headers=headers, data=json.dumps(payload))
print(response.json())`}function generateNodeExample(endpointPath,variables){return`const fetch = require('node-fetch');

const url = '${getEndpointUrl(endpointPath)}';

const headers = {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'
};

const payload = {
    "variables_values": {
${generateVariablesJson(variables)}
    }
};

fetch(url, {
    method: 'POST',
    headers: headers,
    body: JSON.stringify(payload)
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`}function EndpointCodeExamples(_ref2){let{tabId}=_ref2,{setActiveCodeExampleTab}=(0,index_esm.useActions)((0,endpointLogic.U)({tabId})),{activeCodeExampleTab,endpoint}=(0,index_esm.useValues)((0,endpointLogic.U)({tabId}));if(!endpoint)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let variables=endpoint.parameters||{};return(0,jsx_runtime.jsx)(SceneSection.S,{title:"How to call this endpoint",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"terminal",label:"Terminal"},{value:"python",label:"Python"},{value:"nodejs",label:"Node.js"}],onChange:val=>{val&&setActiveCodeExampleTab(val)},value:activeCodeExampleTab})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:(tab=>{switch(tab){case"terminal":default:return CodeSnippet.S.Bash;case"python":return CodeSnippet.S.Python;case"nodejs":return CodeSnippet.S.JavaScript}})(activeCodeExampleTab),wrap:!0,children:(tab=>{switch(tab){case"terminal":default:return generateTerminalExample(endpoint.endpoint_path,variables);case"python":return generatePythonExample(endpoint.endpoint_path,variables);case"nodejs":return generateNodeExample(endpoint.endpoint_path,variables)}})(activeCodeExampleTab)})})]})})}var LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts");let CACHE_AGE_OPTIONS=[{value:null,label:"Default caching behavior"},{value:300,label:"5 minutes"},{value:900,label:"15 minutes"},{value:1800,label:"30 minutes"},{value:3600,label:"1 hour"},{value:10800,label:"3 hours"},{value:86400,label:"1 day"},{value:259200,label:"3 days"}];function EndpointConfiguration(_ref){let{tabId}=_ref,{endpoint,cacheAge}=(0,index_esm.useValues)((0,endpointLogic.U)({tabId})),{setCacheAge}=(0,index_esm.useActions)((0,endpointLogic.U)({tabId}));return endpoint?(0,jsx_runtime.jsxs)(SceneSection.S,{title:"Configure this endpoint",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-4 max-w-2xl",children:(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Cache age",info:"Cache age defines how long your endpoint will return cached results before running the query again and refreshing the results.",children:(0,jsx_runtime.jsx)(src.Yv,{value:cacheAge,onChange:setCacheAge,options:CACHE_AGE_OPTIONS})})}),(0,jsx_runtime.jsx)(src.p2,{})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}var SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),utils=__webpack_require__("../../frontend/src/queries/utils.ts"),tabAwareScene=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareScene.ts"),tabAwareUrlToAction=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareUrlToAction.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts");let EndpointTab=function(EndpointTab){return EndpointTab.QUERY="query",EndpointTab.CODE="code",EndpointTab.CONFIGURATION="configuration",EndpointTab.USAGE="usage",EndpointTab.HISTORY="history",EndpointTab}({}),endpointSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","endpoints","frontend","endpointSceneLogic"]),(0,tabAwareScene.P)(),(0,index_esm.connect)(()=>({actions:[endpointLogic.U,["loadEndpoint","loadEndpointSuccess"]],values:[endpointLogic.U,["endpoint","endpointLoading"]]})),(0,index_esm.actions)({setLocalQuery:query=>({query}),setActiveTab:tab=>({tab})}),(0,index_esm.reducers)({localQuery:[null,{setLocalQuery:(_,_ref)=>{let{query}=_ref;return query},loadEndpointSuccess:()=>null}],activeTab:[EndpointTab.QUERY,{setActiveTab:(_,_ref2)=>{let{tab}=_ref2;return tab}}]}),(0,index_esm.selectors)({currentQuery:[s=>[s.localQuery,s.endpoint],(localQuery,endpoint)=>localQuery||endpoint?.query||null],queryToRender:[s=>[s.currentQuery],currentQuery=>currentQuery?(0,utils.tE)(currentQuery)?{kind:schema_general.OH.DataTableNode,source:currentQuery,showHogQLEditor:!0}:(0,utils.Yg)(currentQuery)?{kind:schema_general.OH.InsightVizNode,source:currentQuery,full:!0}:currentQuery:null],breadcrumbs:[s=>[s.endpoint],endpoint=>[{key:sceneTypes.x.Endpoints,name:"Endpoints",path:urls.j.endpoints(),iconType:"endpoints"},{key:[sceneTypes.x.Endpoints,endpoint?.name||"new"],name:endpoint?.name||"New Endpoint"}]]}),(0,tabAwareUrlToAction.O)(_ref3=>{let{actions,values}=_ref3;return{[urls.j.endpoint(":name")]:_ref4=>{let{name}=_ref4,{searchParams}=lib.router.values;name&&actions.loadEndpoint(name),searchParams.tab&&searchParams.tab!==values.activeTab?actions.setActiveTab(searchParams.tab):searchParams.tab||values.activeTab===EndpointTab.QUERY||actions.setActiveTab(EndpointTab.QUERY)}}})]),EndpointSceneHeader=_ref=>{var _endpoint$cache_age_s;let{tabId}=_ref,{endpoint,endpointLoading,localQuery}=(0,index_esm.useValues)(endpointSceneLogic({tabId})),{endpointName,endpointDescription,cacheAge}=(0,index_esm.useValues)((0,endpointLogic.U)({tabId})),{setEndpointDescription,updateEndpoint,createEndpoint,setCacheAge}=(0,index_esm.useActions)((0,endpointLogic.U)({tabId})),{setLocalQuery}=(0,index_esm.useActions)(endpointSceneLogic({tabId})),isNewEndpoint=!endpoint?.name||"new-endpoint"===endpoint.name,hasNameChange=endpointName&&endpointName!==endpoint?.name,hasDescriptionChange=null!==endpointDescription&&endpointDescription!==endpoint?.description,hasQueryChange=null!==localQuery,hasCacheAgeChange=cacheAge!==(null!==(_endpoint$cache_age_s=endpoint?.cache_age_seconds)&&void 0!==_endpoint$cache_age_s?_endpoint$cache_age_s:null),hasChanges=hasNameChange||hasDescriptionChange||hasQueryChange||hasCacheAgeChange;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:endpointName||endpoint?.name,description:endpointDescription||endpoint?.description,resourceType:{type:"endpoints"},canEdit:!0,onDescriptionChange:description=>setEndpointDescription(description),isLoading:endpointLoading,renameDebounceMs:200,actions:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!isNewEndpoint&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>{if(endpoint){var _endpoint$cache_age_s2;setEndpointDescription(endpoint.description||""),setCacheAge(null!==(_endpoint$cache_age_s2=endpoint.cache_age_seconds)&&void 0!==_endpoint$cache_age_s2?_endpoint$cache_age_s2:null)}setLocalQuery(null)},disabledReason:!hasChanges&&"No changes to discard",children:"Discard changes"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{let queryToSave=localQuery||endpoint?.query;queryToSave&&(0,utils.KN)(queryToSave)&&(queryToSave=queryToSave.source),isNewEndpoint?createEndpoint({name:endpointName||endpoint?.name||"",description:endpointDescription||endpoint?.description,query:queryToSave}):updateEndpoint(endpoint.name,{name:endpointName||endpoint?.name,description:endpointDescription||endpoint?.description,cache_age_seconds:null!=cacheAge?cacheAge:void 0,query:queryToSave})},disabledReason:!hasChanges&&!isNewEndpoint&&"No changes to save",children:isNewEndpoint?"Create":"Update"})]})})})};var TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),Label=__webpack_require__("../../frontend/src/lib/ui/Label/Label.tsx");function EndpointOverview(_ref){let{tabId}=_ref,{endpoint}=(0,index_esm.useValues)((0,endpointLogic.U)({tabId}));if(!endpoint)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let hasParameters=endpoint.parameters&&Object.keys(endpoint.parameters).length>0;return(0,jsx_runtime.jsxs)("div",{className:"grid gap-2 overflow-hidden grid-cols-1 min-[1200px]:grid-cols-[1fr_26rem]",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-0 overflow-hidden",children:[(0,jsx_runtime.jsxs)("div",{className:"inline-flex deprecated-space-x-8",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)(Label._,{intent:"menu",children:"Status"}),(0,jsx_runtime.jsx)(src.oe,{type:endpoint.is_active?"success":"danger",children:(0,jsx_runtime.jsx)("b",{className:"uppercase",children:endpoint.is_active?"Active":"Inactive"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)(Label._,{intent:"menu",children:"Endpoint URL"}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"xsmall",onClick:()=>{navigator.clipboard.writeText(endpoint.endpoint_path),LemonToast.UJ.success("Endpoint URL copied to clipboard")},className:"font-mono text-xs",children:endpoint.endpoint_path})]})]}),hasParameters&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-col mt-4",children:[(0,jsx_runtime.jsx)(Label._,{intent:"menu",children:"Variables"}),(0,jsx_runtime.jsx)("div",{className:"space-y-2 mt-1",children:Object.entries(endpoint.parameters).map(_ref2=>{let[key,value]=_ref2;return(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-2",children:[(0,jsx_runtime.jsx)("code",{className:"text-xs bg-bg-light px-2 py-1 rounded",children:key}),(0,jsx_runtime.jsx)("span",{className:"text-muted-alt",children:":"}),(0,jsx_runtime.jsx)("code",{className:"text-xs text-muted",children:JSON.stringify(value)})]},key)})})]})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-4 overflow-hidden items-start min-[1200px]:items-end",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col overflow-hidden items-start min-[1200px]:items-end",children:(0,jsx_runtime.jsxs)("div",{className:"inline-flex deprecated-space-x-8",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)(Label._,{intent:"menu",children:"Last executed"}),endpoint.last_executed_at?(0,jsx_runtime.jsx)(TZLabel.w,{time:endpoint.last_executed_at}):(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"Never"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)(Label._,{intent:"menu",children:"Created by"}),endpoint.created_by&&(0,jsx_runtime.jsx)(src.YY,{user:endpoint.created_by,size:"md",showName:!0})]})]})})})]})}var icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),CodeEditor=__webpack_require__("../../frontend/src/lib/monaco/CodeEditor.tsx"),sceneLogic=__webpack_require__("../../frontend/src/scenes/sceneLogic.tsx"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx");function EndpointQuery(_ref){let{tabId}=_ref,{endpoint}=(0,index_esm.useValues)((0,endpointLogic.U)({tabId})),{queryToRender}=(0,index_esm.useValues)(endpointSceneLogic({tabId})),{setLocalQuery}=(0,index_esm.useActions)(endpointSceneLogic({tabId})),{newTab}=(0,index_esm.useActions)(sceneLogic.k);if(!endpoint||!queryToRender)return(0,jsx_runtime.jsx)("div",{children:"No query available"});if((0,utils.tE)(endpoint.query)){let hogqlQuery=endpoint.query,variables=hogqlQuery.variables||{};return(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(CodeEditor.p,{value:hogqlQuery.query,language:"hogQL",height:"300px",options:{readOnly:!0}}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>{newTab(urls.j.sqlEditor(hogqlQuery.query))},sideIcon:(0,jsx_runtime.jsx)(icons.pF,{}),children:"Edit query in SQL Editor"})})]}),(0,jsx_runtime.jsx)("div",{className:"w-80 flex-shrink-0",children:(0,jsx_runtime.jsxs)("div",{className:"border rounded p-4",children:[(0,jsx_runtime.jsx)("h3",{className:"text-sm font-semibold mb-2",children:"Variables (JSON)"}),(0,jsx_runtime.jsx)("pre",{className:"text-xs overflow-auto",children:JSON.stringify(variables,null,2)})]})})]})}return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(Query.A,{query:queryToRender,editMode:!0,setQuery:query=>{setLocalQuery(query)},context:{showOpenEditorButton:!1}})})}let scene={component:EndpointScene,logic:endpointSceneLogic};function EndpointScene(){let{tabId}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!tabId)throw Error("<EndpointScene /> must receive a tabId prop");let{endpoint,endpointLoading,activeTab}=(0,index_esm.useValues)(endpointSceneLogic({tabId})),{deleteEndpoint,updateEndpoint}=(0,index_esm.useActions)((0,endpointLogic.U)({tabId})),{searchParams}=(0,index_esm.useValues)(lib.router),isNewEndpoint=!endpoint?.name||"new-endpoint"===endpoint.name,tabs=[{key:EndpointTab.QUERY,label:"Query",content:(0,jsx_runtime.jsx)(EndpointQuery,{tabId:tabId}),link:endpoint?(0,lib.combineUrl)(urls.j.endpoint(endpoint.name),{...searchParams,tab:EndpointTab.QUERY}).url:void 0},{key:EndpointTab.CONFIGURATION,label:"Configuration",content:(0,jsx_runtime.jsx)(EndpointConfiguration,{tabId:tabId}),link:endpoint?(0,lib.combineUrl)(urls.j.endpoint(endpoint.name),{...searchParams,tab:EndpointTab.CONFIGURATION}).url:void 0},{key:EndpointTab.CODE,label:"Code",content:(0,jsx_runtime.jsx)(EndpointCodeExamples,{tabId:tabId}),link:endpoint?(0,lib.combineUrl)(urls.j.endpoint(endpoint.name),{...searchParams,tab:EndpointTab.CODE}).url:void 0},{key:EndpointTab.HISTORY,label:"History",content:endpoint?(0,jsx_runtime.jsx)(ActivityLog.DA,{scope:types.jc.ENDPOINT,id:endpoint.id}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{}),link:endpoint?(0,lib.combineUrl)(urls.j.endpoint(endpoint.name),{...searchParams,tab:EndpointTab.HISTORY}).url:void 0}];return(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:endpointSceneLogic,props:{tabId},children:[(0,jsx_runtime.jsxs)(SceneContent._,{className:"Endpoint",children:[(0,jsx_runtime.jsx)(EndpointSceneHeader,{tabId:tabId}),!endpointLoading&&(0,jsx_runtime.jsx)(EndpointOverview,{tabId:tabId}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeTab,tabs:tabs})]}),endpoint&&!isNewEndpoint&&(0,jsx_runtime.jsx)(SceneLayout.kI,{children:(0,jsx_runtime.jsxs)(SceneLayout.EJ,{children:[(0,jsx_runtime.jsxs)(ButtonPrimitives.hL,{menuItem:!0,onClick:()=>{endpoint?.name&&(endpoint.is_active?src.dn.open({title:"Deactivate endpoint?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"Are you sure you want to deactivate this endpoint? It will no longer be accessible via the API."}),primaryButton:{children:"Deactivate",type:"primary",status:"danger",onClick:()=>{updateEndpoint(endpoint.name,{is_active:!1})},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}}):updateEndpoint(endpoint.name,{is_active:!0}))},children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconPause,{}),endpoint.is_active?"Deactivate":"Activate"]}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsxs)(ButtonPrimitives.hL,{menuItem:!0,onClick:()=>{endpoint?.name&&src.dn.open({title:"Delete endpoint?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"Are you sure you want to delete this endpoint? This action cannot be undone."}),primaryButton:{children:"Delete",type:"primary",status:"danger",onClick:()=>{deleteEndpoint(endpoint.name),lib.router.actions.push(urls.j.endpoints())},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},className:"text-danger",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),"Delete endpoint"]})]})})]})}},"../../products/endpoints/frontend/endpointLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>endpointLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils.tsx"),lib_utils_kea_logic_builders__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/utils/kea-logic-builders.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),_endpointsLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../products/endpoints/frontend/endpointsLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let NEW_ENDPOINT={name:"new-endpoint",description:"New endpoint returns this and that",query:{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_8__.OH.HogQLQuery,query:"select * from events limit 1"}},endpointLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","endpoints","frontend","endpointLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.tabId),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({actions:[_endpointsLogic__WEBPACK_IMPORTED_MODULE_9__.S,["loadEndpoints"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setEndpointName:endpointName=>({endpointName}),setEndpointDescription:endpointDescription=>({endpointDescription}),setActiveCodeExampleTab:tab=>({tab}),setIsUpdateMode:isUpdateMode=>({isUpdateMode}),setSelectedEndpointName:selectedEndpointName=>({selectedEndpointName}),setCacheAge:cacheAge=>({cacheAge}),createEndpoint:request=>({request}),createEndpointSuccess:response=>({response}),createEndpointFailure:error=>({error}),updateEndpoint:(name,request)=>({name,request}),updateEndpointSuccess:response=>({response}),updateEndpointFailure:error=>({error}),deleteEndpoint:name=>({name}),deleteEndpointSuccess:response=>({response}),deleteEndpointFailure:error=>({error}),deactivateEndpoint:name=>({name}),deactivateEndpointSuccess:response=>({response}),deactivateEndpointFailure:error=>({error})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({endpointName:[null,{setEndpointName:(_,_ref)=>{let{endpointName}=_ref;return endpointName}}],endpointDescription:[null,{setEndpointDescription:(_,_ref2)=>{let{endpointDescription}=_ref2;return endpointDescription}}],activeCodeExampleTab:["terminal",{setActiveCodeExampleTab:(_,_ref3)=>{let{tab}=_ref3;return tab}}],isUpdateMode:[!1,{setIsUpdateMode:(_,_ref4)=>{let{isUpdateMode}=_ref4;return isUpdateMode}}],selectedEndpointName:[null,{setSelectedEndpointName:(_,_ref5)=>{let{selectedEndpointName}=_ref5;return selectedEndpointName}}],cacheAge:[null,{setCacheAge:(_,_ref6)=>{let{cacheAge}=_ref6;return cacheAge}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref7=>{let{actions}=_ref7;return{endpoint:[null,{loadEndpoint:async name=>{var _endpoint$cache_age_s;if(!name||"new"===name)return{...NEW_ENDPOINT};let endpoint=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.endpoint.get(name);try{let executionTimes=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.endpoint.getLastExecutionTimes({names:[name]});executionTimes[name]&&(endpoint.last_executed_at=executionTimes[name])}catch(error){console.error("Failed to fetch last execution time:",error)}return actions.setCacheAge(null!==(_endpoint$cache_age_s=endpoint.cache_age_seconds)&&void 0!==_endpoint$cache_age_s?_endpoint$cache_age_s:null),endpoint}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref8=>{let{actions}=_ref8;return{createEndpoint:async _ref9=>{let{request}=_ref9;try{request.name&&(request.name=(0,lib_utils__WEBPACK_IMPORTED_MODULE_5__.lV)(request.name));let response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.endpoint.create(request);actions.createEndpointSuccess(response)}catch(error){console.error("Failed to create endpoint:",error),actions.createEndpointFailure(error)}},createEndpointSuccess:_ref10=>{let{response}=_ref10;actions.setEndpointName(""),actions.setEndpointDescription(""),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:["Endpoint created successfully!",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("br",{}),"You will be redirected to the endpoint page."]}),{onClose:()=>{kea_router__WEBPACK_IMPORTED_MODULE_2__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.endpoint(response.name))}})},createEndpointFailure:_ref11=>{let{error}=_ref11;console.error("Failed to create endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Failed to create endpoint")},updateEndpoint:async _ref12=>{let{name,request}=_ref12;try{let response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.endpoint.update(name,request);actions.updateEndpointSuccess(response)}catch(error){console.error("Failed to update endpoint:",error),actions.updateEndpointFailure(error)}},updateEndpointSuccess:_ref13=>{let{response}=_ref13;lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.success("Endpoint updated successfully"),actions.loadEndpoint(response.name)},updateEndpointFailure:_ref14=>{let{error}=_ref14;console.error("Failed to update endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Failed to update endpoint")},deleteEndpoint:async _ref15=>{let{name}=_ref15;try{await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.endpoint.delete(name),actions.deleteEndpointSuccess(name)}catch(error){console.error("Failed to delete endpoint:",error),actions.deleteEndpointFailure(error)}},deleteEndpointSuccess:()=>{lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.success("Endpoint deleted successfully"),actions.loadEndpoints()},deleteEndpointFailure:_ref16=>{let{error}=_ref16;console.error("Failed to delete endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Failed to delete endpoint")},deactivateEndpoint:async _ref17=>{let{name}=_ref17;try{await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.endpoint.update(name,{is_active:!1}),actions.deactivateEndpointSuccess({})}catch(error){console.error("Failed to deactivate endpoint:",error),actions.deactivateEndpointFailure(error)}},deactivateEndpointSuccess:()=>{lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.success("Endpoint deactivated successfully"),actions.loadEndpoints()},deactivateEndpointFailure:_ref18=>{let{error}=_ref18;console.error("Failed to deactivate endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Failed to deactivate endpoint")}}}),(0,lib_utils_kea_logic_builders__WEBPACK_IMPORTED_MODULE_6__.Y)()])},"../../products/endpoints/frontend/endpointsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>endpointsLogic});var fuse_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts");let endpointsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","endpoints","frontend","endpointsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.tabId),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:filters=>({filters})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(()=>({allEndpoints:[[],{loadEndpoints:async()=>{let haystack=(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.endpoint.list()).results||[];if(haystack.length>0){let names={names:haystack.map(endpoint=>endpoint.name)},lastExecutionTimes=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.endpoint.getLastExecutionTimes(names);haystack=haystack.map(endpoint=>({...endpoint,last_executed_at:lastExecutionTimes[endpoint.name]}))}return haystack}}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({filters:[{search:""},{setFilters:(state,_ref)=>{let{filters}=_ref;return{...state,...filters}}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({endpoints:[s=>[s.allEndpoints,s.filters],(allEndpoints,filters)=>filters.search?new fuse_js__WEBPACK_IMPORTED_MODULE_3__.Z(allEndpoints,{keys:["name","description","query.query"],threshold:.3}).search(filters.search).map(result=>result.item):allEndpoints]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref2=>{let{actions}=_ref2;actions.loadEndpoints()})])}}]);
//# sourceMappingURL=28399.94ef3f42.iframe.bundle.js.map