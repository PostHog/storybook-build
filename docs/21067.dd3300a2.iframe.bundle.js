"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[21067],{"./frontend/src/scenes/data-warehouse/external/SourceModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>SourceModal});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts");let hubspot_logo=__webpack_require__.p+"images/hubspot-logo.c0fff3b062a9575d0c2b48cda3bb6d35.svg",postgres_logo=__webpack_require__.p+"images/postgres-logo.e407ebb120aa171a7512a371dda497b5.svg",stripe_logo=__webpack_require__.p+"images/stripe-logo.b028b0fcb152afb51f2ab5c15b9c8331.svg";var DataWarehouseTableForm=__webpack_require__("./frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx"),sourceModalLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/external/sourceModalLogic.tsx"),sourceFormLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/external/forms/sourceFormLogic.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PostgresSchemaForm(){(0,index_esm.useMountedLogic)((0,sourceFormLogic.c)({sourceType:"Postgres"}));let{selectSchema}=(0,index_esm.useActions)(sourceModalLogic.ju),{databaseSchema}=(0,index_esm.useValues)(sourceModalLogic.ju);return(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-2",children:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.g3,{emptyState:"No schemas found",dataSource:databaseSchema,columns:[{title:"Table",key:"table",render:function RenderTable(_,schema){return schema.table}},{title:"Sync",key:"should_sync",render:function RenderShouldSync(_,schema){return(0,jsx_runtime.jsx)(src.f4,{checked:schema.should_sync,onChange:()=>{selectSchema(schema)}})}}]})})})}var lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),LemonField=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts");function SourceForm(_ref){let{sourceType}=_ref;return(0,jsx_runtime.jsxs)(lib.Form,{logic:sourceFormLogic.c,props:{sourceType},formKey:"Postgres"==sourceType?"databaseSchemaForm":"externalDataSource",className:"space-y-4",enableFormOnSubmit:!0,children:[sourceModalLogic.l2[sourceType].fields.map(field=>(0,jsx_runtime.jsx)(LemonField.D,{name:["payload",field.name],label:field.label,children:(0,jsx_runtime.jsx)(src.DF,{className:"ph-ignore-input","data-attr":field.name})},field.name)),(0,jsx_runtime.jsx)(LemonField.D,{name:"prefix",label:"Table Prefix (optional)",children:(0,jsx_runtime.jsx)(src.DF,{className:"ph-ignore-input","data-attr":"prefix",placeholder:"internal_"})})]})}function SourceModal(props){let{modalTitle,modalCaption}=(0,index_esm.useValues)(sourceModalLogic.ju),{onClear,onBack,onSubmit}=(0,index_esm.useActions)(sourceModalLogic.ju),{currentStep}=(0,index_esm.useValues)(sourceModalLogic.ju);return(0,jsx_runtime.jsxs)(src.fQ,{...props,width:600,onAfterClose:()=>onClear(),title:modalTitle,description:modalCaption,footer:1===currentStep?null:(0,jsx_runtime.jsxs)("div",{className:"mt-2 flex flex-row justify-end gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",center:!0,"data-attr":"source-modal-back-button",onClick:onBack,children:"Back"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",center:!0,onClick:()=>onSubmit(),"data-attr":"source-link",children:"Link"})]}),children:[(0,jsx_runtime.jsx)(FirstStep,{}),(0,jsx_runtime.jsx)(SecondStep,{}),(0,jsx_runtime.jsx)(ThirdStep,{})]})}function ModalPage(_ref){let{children,page}=_ref,{currentStep}=(0,index_esm.useValues)(sourceModalLogic.ju);return currentStep!==page?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{}):(0,jsx_runtime.jsx)("div",{children:children})}function FirstStep(){let{connectors,addToHubspotButtonUrl}=(0,index_esm.useValues)(sourceModalLogic.ju),{selectConnector,toggleManualLinkFormVisible,onNext}=(0,index_esm.useActions)(sourceModalLogic.ju),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h),MenuButton=config=>{let onClick=()=>{selectConnector(config),onNext()};return"Stripe"===config.name?(0,jsx_runtime.jsx)(src.Jp,{onClick:onClick,fullWidth:!0,center:!0,type:"secondary",children:(0,jsx_runtime.jsx)("img",{src:stripe_logo,alt:"stripe logo",height:50})}):"Hubspot"===config.name?(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,center:!0,type:"secondary",to:addToHubspotButtonUrl()||"",children:(0,jsx_runtime.jsx)("img",{src:hubspot_logo,alt:"hubspot logo",height:45})}):"Postgres"===config.name&&featureFlags[constants.y8.DATA_WAREHOUSE_POSTGRES_IMPORT]?(0,jsx_runtime.jsx)(src.Jp,{onClick:onClick,fullWidth:!0,center:!0,type:"secondary",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 justify-center items-center",children:[(0,jsx_runtime.jsx)("img",{src:postgres_logo,alt:"postgres logo",height:45}),(0,jsx_runtime.jsx)("div",{className:"text-base",children:"Postgres"})]})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})};return(0,jsx_runtime.jsx)(ModalPage,{page:1,children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 items-center",children:[connectors.map((config,index)=>(0,jsx_runtime.jsx)(MenuButton,{...config},config.name+"_"+index)),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{toggleManualLinkFormVisible(!0),onNext()},className:"w-full",center:!0,type:"secondary",children:"Manual Link"})]})})}function SecondStep(){let{selectedConnector}=(0,index_esm.useValues)(sourceModalLogic.ju);return(0,jsx_runtime.jsx)(ModalPage,{page:2,children:selectedConnector?(0,jsx_runtime.jsx)(SourceForm,{sourceType:selectedConnector.name}):(0,jsx_runtime.jsx)(DataWarehouseTableForm.V,{})})}function ThirdStep(){return(0,jsx_runtime.jsx)(ModalPage,{page:3,children:(0,jsx_runtime.jsx)(PostgresSchemaForm,{})})}},"./frontend/src/scenes/data-warehouse/external/forms/sourceFormLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>sourceFormLogic});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/urls.ts"),_sourceModalLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/data-warehouse/external/sourceModalLogic.tsx");let getPayloadDefaults=sourceType=>"Stripe"===sourceType?{account_id:"",client_secret:""}:{},getErrorsDefaults=sourceType=>{switch(sourceType){case"Stripe":return _ref=>{let{prefix,payload}=_ref;return{prefix:/^[a-zA-Z0-9_-]*$/.test(prefix)?null:"Please enter a valid prefix (only letters, numbers, and '_' or '-').",payload:{account_id:!payload.account_id&&"Please enter an account id.",client_secret:!payload.client_secret&&"Please enter a client secret."}}};case"Hubspot":return _ref2=>{let{prefix}=_ref2;return{prefix:/^[a-zA-Z0-9_-]*$/.test(prefix)?null:"Please enter a valid prefix (only letters, numbers, and '_' or '-')."}};default:return()=>({})}},sourceFormLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","data-warehouse","external","sourceFormLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)({actions:[_sourceModalLogic__WEBPACK_IMPORTED_MODULE_6__.ju,["setDatabaseSchemas","onBack","onNext","selectConnector","toggleSourceModal","loadSources"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({onCancel:!0,handleRedirect:(kind,searchParams)=>({kind,searchParams}),onPostgresNext:!0}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)(_ref3=>{let{actions}=_ref3;return{onCancel:()=>{actions.resetExternalDataSource(),actions.onBack(),actions.selectConnector(null)},submitExternalDataSourceSuccess:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.success("New Data Resource Created"),actions.toggleSourceModal(!1),actions.resetExternalDataSource(),actions.loadSources(),kea_router__WEBPACK_IMPORTED_MODULE_3__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.dataWarehouseSettings())},submitDatabaseSchemaFormSuccess:()=>{actions.onNext()},submitExternalDataSourceFailure:_ref4=>{let{error}=_ref4;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error(error?.message||"Something went wrong")},submitDatabaseSchemaFormFailure:_ref5=>{let{error}=_ref5;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error(error?.message||"Something went wrong")},handleRedirect:async _ref6=>{let{kind,searchParams}=_ref6;if("hubspot"===kind){actions.setExternalDataSourceValue("payload",{code:searchParams.code,redirect_uri:(0,_sourceModalLogic__WEBPACK_IMPORTED_MODULE_6__.Eg)()}),actions.setExternalDataSourceValue("source_type","Hubspot");return}_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Something went wrong.")},onPostgresNext:async()=>{}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_3__.urlToAction)(_ref7=>{let{actions}=_ref7;return{"/data-warehouse/:kind/redirect":(_ref8,searchParams)=>{let{kind=""}=_ref8;actions.handleRedirect(kind,searchParams)}}}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_2__.forms)(_ref9=>{let{props,actions}=_ref9;return{externalDataSource:{defaults:{prefix:"",source_type:props.sourceType,payload:getPayloadDefaults(props.sourceType)},errors:getErrorsDefaults(props.sourceType),submit:async payload=>{let newResource=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.create(payload);return newResource}},databaseSchemaForm:{defaults:{prefix:"",payload:{host:"",port:"",dbname:"",user:"",password:"",schema:""}},errors:_ref10=>{let{prefix,payload:{host,port,dbname,user,password,schema}}=_ref10;return{prefix:/^[a-zA-Z0-9_-]*$/.test(prefix)?null:"Please enter a valid prefix (only letters, numbers, and '_' or '-').",payload:{host:!host&&"Please enter a host.",port:!port&&"Please enter a port.",dbname:!dbname&&"Please enter a dbname.",user:!user&&"Please enter a user.",password:!password&&"Please enter a password.",schema:!schema&&"Please enter a schema."}}},submit:async _ref11=>{let{payload:{host,port,dbname,user,password,schema},prefix}=_ref11,schemas=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.database_schema(host,port,dbname,user,password,schema);return actions.setDatabaseSchemas(schemas),{payload:{host,port,dbname,user,password,schema},prefix}}}}})])},"./frontend/src/scenes/data-warehouse/external/sourceModalLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Eg:()=>getHubspotRedirectUri,ju:()=>sourceModalLogic,l2:()=>SOURCE_DETAILS});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),_new_table_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/data-warehouse/new_table/dataWarehouseTableLogic.tsx"),_settings_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts"),_dataWarehouseSceneLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/data-warehouse/external/dataWarehouseSceneLogic.ts"),_forms_sourceFormLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/data-warehouse/external/forms/sourceFormLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let getHubspotRedirectUri=()=>`${window.location.origin}/data-warehouse/hubspot/redirect`,SOURCE_DETAILS={Stripe:{name:"Stripe",caption:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.Fragment,{children:["Enter your Stripe credentials to automatically pull your Stripe data into the PostHog Data warehouse.",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("br",{}),"You can find your account ID"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.rU,{to:"https://dashboard.stripe.com/settings/user",target:"_blank",children:"in your Stripe dashboard"}),", and create a secret key"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.rU,{to:"https://dashboard.stripe.com/apikeys",target:"_blank",children:"here"}),"."]}),fields:[{name:"account_id",label:"Account ID",type:"text",required:!0,placeholder:"acct_..."},{name:"client_secret",label:"Client Secret",type:"text",required:!0,placeholder:"sk_live_..."}]},Hubspot:{name:"Hubspot",fields:[],caption:""},Postgres:{name:"Postgres",caption:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.Fragment,{children:"Enter your Postgres credentials to automatically pull your Postgres data into the PostHog Data warehouse."}),fields:[{name:"host",label:"Host",type:"text",required:!0,placeholder:"localhost"},{name:"port",label:"Port",type:"number",required:!0,placeholder:"5432"},{name:"dbname",label:"Database",type:"text",required:!0,placeholder:"postgres"},{name:"user",label:"User",type:"text",required:!0,placeholder:"postgres"},{name:"password",label:"Password",type:"password",required:!0,placeholder:"password"},{name:"schema",label:"Schema",type:"text",required:!0,placeholder:"public"}]}},sourceModalLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","data-warehouse","external","sourceModalLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({selectConnector:connector=>({connector}),toggleManualLinkFormVisible:visible=>({visible}),handleRedirect:(kind,searchParams)=>({kind,searchParams}),onClear:!0,onBack:!0,onNext:!0,onSubmit:!0,setDatabaseSchemas:schemas=>({schemas}),selectSchema:schema=>({schema})}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)({values:[_new_table_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_3__.U,["tableLoading"],_settings_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_4__.T,["dataWarehouseSources"],scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_2__.preflightLogic,["preflight"]],actions:[_dataWarehouseSceneLogic__WEBPACK_IMPORTED_MODULE_5__.M,["toggleSourceModal"],_new_table_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_3__.U,["resetTable"],_settings_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_4__.T,["loadSources"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)({selectedConnector:[null,{selectConnector:(_,_ref)=>{let{connector}=_ref;return connector}}],isManualLinkFormVisible:[!1,{toggleManualLinkFormVisible:(_,_ref2)=>{let{visible}=_ref2;return visible}}],currentStep:[1,{onNext:state=>state+1,onBack:state=>state-1,onClear:()=>1}],databaseSchema:[[],{setDatabaseSchemas:(_,_ref3)=>{let{schemas}=_ref3;return schemas},selectSchema:(state,_ref4)=>{let{schema}=_ref4,newSchema=state.map(s=>({...s,should_sync:s.table===schema.table?!s.should_sync:s.should_sync}));return newSchema}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.selectors)({showFooter:[s=>[s.selectedConnector,s.isManualLinkFormVisible],(selectedConnector,isManualLinkFormVisible)=>selectedConnector||isManualLinkFormVisible],connectors:[s=>[s.dataWarehouseSources],sources=>Object.values(SOURCE_DETAILS).map(connector=>({...connector,disabledReason:sources&&sources.results.find(source=>source.source_type===connector.name)?"Already linked":null}))],addToHubspotButtonUrl:[s=>[s.preflight],preflight=>()=>{let clientId=preflight?.data_warehouse_integrations?.hubspot.client_id;if(!clientId)return null;let params=new URLSearchParams;return params.set("client_id",clientId),params.set("redirect_uri",getHubspotRedirectUri()),params.set("scope","crm.objects.contacts.read crm.objects.companies.read crm.objects.deals.read tickets crm.objects.quotes.read sales-email-read"),`https://app.hubspot.com/oauth/authorize?${params.toString()}`}],modalTitle:[s=>[s.currentStep],currentStep=>1===currentStep?"Select a data source to get started":2===currentStep?"Link your data source":3===currentStep?"Select tables to import":""],modalCaption:[s=>[s.selectedConnector,s.currentStep],(selectedConnector,currentStep)=>2==currentStep&&selectedConnector?SOURCE_DETAILS[selectedConnector.name]?.caption:""]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)(_ref5=>{let{actions,values}=_ref5;return{onClear:()=>{actions.selectConnector(null),actions.toggleManualLinkFormVisible(!1),actions.resetTable()},onSubmit:()=>{if(1!==values.currentStep&&(2===values.currentStep&&(values.selectedConnector?.name==="Postgres"?(0,_forms_sourceFormLogic__WEBPACK_IMPORTED_MODULE_6__.c)({sourceType:"Postgres"}).actions.submitDatabaseSchemaForm():values.selectedConnector?.name?(0,_forms_sourceFormLogic__WEBPACK_IMPORTED_MODULE_6__.c)({sourceType:values.selectedConnector?.name}).actions.submitExternalDataSource():_new_table_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_3__.U.actions.submitTable()),3===values.currentStep)){let logic=(0,_forms_sourceFormLogic__WEBPACK_IMPORTED_MODULE_6__.c)({sourceType:"Postgres"});logic.actions.setExternalDataSourceValue("payload",{...logic.values.databaseSchemaForm.payload,schemas:values.databaseSchema.filter(schema=>schema.should_sync).map(schema=>schema.table)}),logic.actions.setExternalDataSourceValue("prefix",logic.values.databaseSchemaForm.prefix),logic.actions.submitExternalDataSource()}}}})])},"./frontend/src/scenes/data-warehouse/new_table/DataWarehouseTableForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>DatawarehouseTableForm});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/data-warehouse/new_table/dataWarehouseTableLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DatawarehouseTableForm(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(kea_forms__WEBPACK_IMPORTED_MODULE_1__.Form,{formKey:"table",logic:_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_3__.U,className:"space-y-4",enableFormOnSubmit:!0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"flex flex-col gap-2 max-w-160",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_2__.D,{name:"name",label:"Table Name",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"Examples: stripe_invoice, hubspot_contacts, users",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"text-muted text-xs mb-4",children:"This will be the table name used when writing queries"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_2__.D,{name:"url_pattern",label:"Files URL pattern",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: https://your-org.s3.amazonaws.com/airbyte/stripe/invoices/*.pqt",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"text-muted text-xs mb-4",children:["You can use ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("strong",{children:"*"})," to select multiple files."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_2__.D,{name:"format",label:"File format",className:"w-max",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Yv,{"data-attr":"table-format",options:[{label:"Parquet (recommended)",value:"Parquet"},{label:"CSV",value:"CSV"},{label:"JSON",value:"JSONEachRow"}]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_2__.D,{name:["credential","access_key"],label:"Access Key",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{"data-attr":"access-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: AKIAIOSFODNN7EXAMPLE",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_2__.D,{name:["credential","access_secret"],label:"Access Secret",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{"data-attr":"access-secret",className:"ph-ignore-input",autoFocus:!0,type:"password",placeholder:"eg: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})]})})}},"./frontend/src/scenes/data-warehouse/new_table/dataWarehouseTableLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>dataWarehouseTableLogic});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/data-management/database/databaseTableListLogic.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/urls.ts"),_external_dataWarehouseSceneLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/data-warehouse/external/dataWarehouseSceneLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let NEW_WAREHOUSE_TABLE={id:"",name:"",url_pattern:"",format:"Parquet",credential:{access_key:"",access_secret:""},columns:[]},dataWarehouseTableLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","data-warehouse","tableLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)(()=>({actions:[scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__.A,["loadDatabase"],_external_dataWarehouseSceneLogic__WEBPACK_IMPORTED_MODULE_8__.M,["loadDataWarehouse","toggleSourceModal"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({editingTable:editing=>({editing}),updateTargetingFlagFilters:(index,properties)=>({index,properties}),addConditionSet:!0,removeConditionSet:index=>({index}),launchTable:!0,stopTable:!0,archiveTable:!0,setDataTableQuery:query=>({query})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_3__.loaders)(_ref=>{let{props}=_ref;return{table:{loadTable:async()=>props.id&&"new"!==props.id?await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.get(props.id):{...NEW_WAREHOUSE_TABLE},createTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.create({...tablePayload}),updateTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.update(props.id,tablePayload)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)(_ref2=>{let{actions}=_ref2;return{createTableSuccess:async _ref3=>{let{table}=_ref3;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:["Table ",table.name," created"]})),actions.loadDatabase(),actions.loadDataWarehouse(),actions.toggleSourceModal(!1),kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataWarehouse())},updateTableSuccess:async _ref4=>{let{table}=_ref4;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:["Table ",table.name," updated"]})),actions.editingTable(!1),kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataWarehouse())}}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)({isEditingTable:[!1,{editingTable:(_,_ref5)=>{let{editing}=_ref5;return editing}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref6)=>{let{query}=_ref6;return query}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.selectors)({breadcrumbs:[()=>[],()=>[{key:"new",name:"New"}]]}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_2__.forms)(_ref7=>{let{actions,props}=_ref7;return{table:{defaults:{...NEW_WAREHOUSE_TABLE},errors:_ref8=>{let{name,url_pattern,credential,format}=_ref8;return{name:!name&&"Please enter a name.",url_pattern:!url_pattern&&"Please enter a url pattern.",credential:{access_secret:!credential.access_secret&&"Please enter an access secret.",access_key:!credential.access_key&&"Please enter an access key."},format:!format&&"Please enter the format of your files."}},submit:async tablePayload=>{props.id&&"new"!==props.id?actions.updateTable(tablePayload):actions.createTable(tablePayload)}}}})])},"./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>dataWarehouseSettingsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/urls.ts");let dataWarehouseSettingsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-warehouse","settings","dataWarehouseSettingsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({deleteSource:source=>({source}),reloadSource:source=>({source}),loadingFinished:source=>({source}),updateSchema:schema=>({schema})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({dataWarehouseSources:[null,{loadSources:async()=>lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSources.list()}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({sourceReloadingById:[{},{reloadSource:(state,_ref)=>{let{source}=_ref;return{...state,[source.id]:!0}},deleteSource:(state,_ref2)=>{let{source}=_ref2;return{...state,[source.id]:!0}},loadingFinished:(state,_ref3)=>{let{source}=_ref3;return{...state,[source.id]:!1}}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_4__.x.DataWarehouseSettings,name:"Data Warehouse Settings",path:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.dataWarehouseSettings()}]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions,cache}=_ref4;return{loadSourcesSuccess:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout(()=>{actions.loadSources()},1e4)},deleteSource:async _ref5=>{let{source}=_ref5;await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSources.delete(source.id),actions.loadSources(),actions.loadingFinished(source)},reloadSource:async _ref6=>{let{source}=_ref6;try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSources.reload(source.id),actions.loadSources()}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Cant refresh source at this time")}actions.loadingFinished(source)},updateSchema:async _ref7=>{let{schema}=_ref7;await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.externalDataSchemas.update(schema.id,schema),actions.loadSources()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref8=>{let{actions}=_ref8;actions.loadSources()})])}}]);