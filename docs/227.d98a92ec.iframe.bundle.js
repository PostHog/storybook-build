(window.webpackJsonp=window.webpackJsonp||[]).push([[227],{"./frontend/src/lib/components/RestrictedArea.tsx":function(k,D,n){"use strict";n.d(D,"b",function(){return y}),n.d(D,"a",function(){return A});var R=n("./node_modules/core-js/modules/es.array.concat.js"),I=n.n(R),C=n("./node_modules/kea/lib/index.esm.js"),O=n("./node_modules/react/index.js"),e=n.n(O),j=n("./frontend/src/scenes/organizationLogic.tsx"),z=n("./frontend/src/lib/constants.tsx"),W=n("./frontend/src/lib/components/Tooltip.tsx"),N=n("./frontend/src/lib/utils/permissioning.ts"),p=n("./frontend/src/scenes/teamLogic.ts"),y;(function(h){h.Organization="organization",h.Project="project"})(y||(y={}));function A(h){var U=h.Component,L=h.minimumAccessLevel,w=h.scope,M=w===void 0?y.Organization:w,g=Object(C.useValues)(j.a),$=g.currentOrganization,_=Object(C.useValues)(p.a),Y=_.currentTeam,Z=Object(O.useMemo)(function(){var B;if(M===y.Project){if(!Y)return"Loading current project\u2026";B=Y.effective_membership_level}else{if(!$)return"Loading current organization\u2026";B=$.membership_level}return B===null?"You don't have access to the current ".concat(M,"."):B<L?L===z.r.Owner?"This area is restricted to the ".concat(M," owner."):"This area is restricted to ".concat(M," ").concat(N.b.get(L),"s and up. Your level is ").concat(N.b.get(B),"."):null},[$]);return Z?e.a.createElement(W.a,{title:Z,placement:"topLeft",delayMs:0},e.a.createElement("span",null,e.a.createElement(U,{isRestricted:!0,restrictionReason:Z}))):e.a.createElement(U,{isRestricted:!1,restrictionReason:null})}try{A.displayName="RestrictedArea",A.__docgenInfo={description:"",displayName:"RestrictedArea",props:{Component:{defaultValue:null,description:"",name:"Component",required:!0,type:{name:"(props: RestrictedComponentProps) => Element"}},minimumAccessLevel:{defaultValue:null,description:"",name:"minimumAccessLevel",required:!0,type:{name:"enum",value:[{value:"1"},{value:"8"},{value:"15"},{value:"1"},{value:"8"}]}},scope:{defaultValue:{value:"RestrictionScope.Organization"},description:"",name:"scope",required:!1,type:{name:"enum",value:[{value:'"organization"'},{value:'"project"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"]={docgenInfo:A.__docgenInfo,name:"RestrictedArea",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"})}catch(h){}try{y.Organization.displayName="RestrictionScope.Organization",y.Organization.__docgenInfo={description:"Current organization-wide membership level will be used.",displayName:"RestrictionScope.Organization",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"]={docgenInfo:y.Organization.__docgenInfo,name:"RestrictionScope.Organization",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"})}catch(h){}try{y.Project.displayName="RestrictionScope.Project",y.Project.__docgenInfo={description:"Effective level for the current project will be used.",displayName:"RestrictionScope.Project",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"]={docgenInfo:y.Project.__docgenInfo,name:"RestrictionScope.Project",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"})}catch(h){}},"./frontend/src/lib/hooks/useAnchor.ts":function(k,D,n){"use strict";n.d(D,"a",function(){return C});var R=n("./node_modules/react/index.js"),I=n.n(R);function C(O){Object(R.useEffect)(function(){if(O&&document.getElementById(O.substr(1))){var e=document.getElementById(O.substr(1));if(!e)return;e.classList.add("highlighted");var j=e.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:j-50-32,behavior:"smooth"})}},[O])}},"./frontend/src/scenes/organization/Settings/index.tsx":function(k,D,n){"use strict";n.r(D),n.d(D,"scene",function(){return tn}),n.d(D,"OrganizationSettings",function(){return je});var R=n("./node_modules/core-js/modules/es.function.name.js"),I=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),C=n.n(I),O=n("./node_modules/react/index.js"),e=n.n(O),j=n("./node_modules/antd/es/input/index.js"),z=n("./node_modules/antd/es/button/index.js"),W=n("./node_modules/antd/es/switch/index.js"),N=n("./node_modules/antd/es/card/index.js"),p=n("./node_modules/antd/es/divider/index.js"),y=n("./frontend/src/lib/components/PageHeader.tsx"),A=n("./node_modules/core-js/modules/es.array.iterator.js"),h=n("./node_modules/core-js/modules/es.object.to-string.js"),U=n("./node_modules/core-js/modules/es.string.iterator.js"),L=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),w=n("./node_modules/core-js/modules/web.url.js"),M=n("./node_modules/antd/es/modal/index.js"),g=n("./node_modules/kea/lib/index.esm.js"),$=n("./node_modules/@ant-design/icons/es/icons/ExclamationCircleOutlined.js"),_=n("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),Y=n("./frontend/src/lib/components/CopyToClipboard.tsx"),Z=n("./frontend/src/lib/components/ProfilePicture/index.ts"),B=n("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),Se=n("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),de=n("./frontend/src/lib/components/LemonTable/index.ts"),ue=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),De=n("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),G=n("./frontend/src/lib/components/LemonButton/index.ts"),J=n("./frontend/src/lib/components/icons.tsx");function Ce(t,a){var o=new URL("/signup/".concat(t),document.baseURI).href;return a.is_expired?e.a.createElement("b",null,"Expired! Delete and recreate"):e.a.createElement(Y.a,{"data-attr":"invite-link",description:"invite link"},o)}function Ae(t){return function(o,r){return e.a.createElement(G.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:e.a.createElement(J.IconClose,null),status:"danger",onClick:function(){r.is_expired?t(r):M.a.confirm({title:"Do you want to cancel the invite for ".concat(r.target_email,"?"),icon:e.a.createElement($.a,null),okText:"Yes, cancel invite",okType:"danger",onOk:function(){t(r)},cancelText:"No, keep invite"})}})}}function Re(){var t=Object(g.useValues)(B.a),a=t.invites,o=t.invitesLoading,r=Object(g.useActions)(B.a),l=r.deleteInvite,d=r.showInviteModal,c=Object(g.useValues)(De.a),s=c.preflight,i=[{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(f,u){return u.target_email?e.a.createElement("div",{className:"flex-center"},e.a.createElement(Z.a,{name:u.first_name,email:u.target_email,size:"md",style:{marginRight:8}}),u.target_email,u.first_name?" (".concat(u.first_name,")"):""):e.a.createElement("i",null,"no one")},width:"20%"},Object(ue.b)(),Object(ue.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(f,u){return Ce(u.id,u)}},{title:"",key:"actions",render:Ae(l)}];return e.a.createElement("div",null,e.a.createElement("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"}},"Pending Invites",e.a.createElement(z.a,{type:"primary",icon:e.a.createElement(_.a,null),onClick:d,"data-attr":"invite-teammate-button"},"Invite team member")),!(s!=null&&s.email_service_available)&&e.a.createElement(Se.a,null),e.a.createElement(de.a,{dataSource:a,columns:i,rowKey:"id",loading:o,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."}))}var sn=n("./node_modules/core-js/modules/es.array.concat.js"),ln=n("./node_modules/core-js/modules/es.array.filter.js"),cn=n("./node_modules/core-js/modules/es.array.map.js"),Le=n("./node_modules/antd/es/dropdown/index.js"),me=n("./node_modules/antd/es/menu/index.js"),Ve=n("./node_modules/antd/es/table/index.js"),ae=n("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),fe=n("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"},Me=ze,xe=n("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),ve=function(a,o){return O.createElement(xe.a,Object(fe.a)(Object(fe.a)({},a),{},{ref:o,icon:Me}))};ve.displayName="SwapOutlined";var Te=O.forwardRef(ve),ge=n("./node_modules/@ant-design/icons/es/icons/CrownFilled.js"),Pe=n("./node_modules/@ant-design/icons/es/icons/UpOutlined.js"),Ie=n("./node_modules/@ant-design/icons/es/icons/DownOutlined.js"),pe=n("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),Ne=n("./node_modules/@ant-design/icons/es/icons/LogoutOutlined.js"),we=n("./frontend/src/lib/utils.tsx"),T=n("./frontend/src/lib/constants.tsx"),V=n("./frontend/src/scenes/organizationLogic.tsx"),re=n("./frontend/src/scenes/userLogic.ts"),ie=n("./frontend/src/lib/components/Tooltip.tsx"),H=n("./frontend/src/lib/utils/permissioning.ts");function Be(t){var a,o=Object(g.useValues)(re.a),r=o.user,l=Object(g.useValues)(V.a),d=l.currentOrganization,c=Object(g.useActions)(ae.a),s=c.changeMemberAccessLevel,i=d?d.membership_level:null;if(!r)return null;function m(E){return function(b){if(b.preventDefault(),!r)throw Error;if(E===T.r.Owner){var P;M.a.confirm({centered:!0,title:"Transfer organization ownership to ".concat(t.user.first_name,"?"),content:"You will no longer be the owner of ".concat((P=r.organization)===null||P===void 0?void 0:P.name,". After the transfer you will become an administrator."),icon:e.a.createElement(Te,null),okType:"danger",okText:"Transfer Ownership",onOk:function(){s(t,E)}})}else s(t,E)}}var f=e.a.createElement(z.a,{"data-attr":"change-membership-level",icon:t.level===T.r.Owner?e.a.createElement(ge.a,null):void 0},(a=H.b.get(t.level))!==null&&a!==void 0?a:"unknown (".concat(t.level,")")),u=H.c.filter(function(E){return!Object(H.a)(i,r,t,E)}),v=Object(H.a)(i,r,t,u);return v?e.a.createElement(ie.a,{title:v},f):e.a.createElement(Le.a,{overlay:e.a.createElement(me.a,null,u.map(function(E){return e.a.createElement(me.a.Item,{key:"".concat(t.user.uuid,"-level-").concat(E)},e.a.createElement("a",{href:"#",onClick:m(E),"data-test-level":E},E===T.r.Owner?e.a.createElement(e.a.Fragment,null,e.a.createElement(ge.a,{style:{marginRight:"0.5rem"}}),"Transfer organization ownership"):E>t.level?e.a.createElement(e.a.Fragment,null,e.a.createElement(Pe.a,{style:{marginRight:"0.5rem"}}),"Upgrade to ",H.b.get(E)):e.a.createElement(e.a.Fragment,null,e.a.createElement(Ie.a,{style:{marginRight:"0.5rem"}}),"Downgrade to ",H.b.get(E))))}))},f)}function Fe(t){var a,o=Object(g.useValues)(re.a),r=o.user,l=Object(g.useValues)(V.a),d=l.currentOrganization,c=Object(g.useActions)(ae.a),s=c.removeMember;if(!r)return null;var i=(a=d==null?void 0:d.membership_level)!==null&&a!==void 0?a:-1;function m(){var u;if(!r)throw Error;M.a.confirm({title:"".concat(t.user.uuid==r.uuid?"Leave":"Remove ".concat(t.user.first_name," from")," organization ").concat((u=r.organization)===null||u===void 0?void 0:u.name,"?"),icon:e.a.createElement($.a,null),okText:t.user.uuid==r.uuid?"Leave":"Remove",okType:"danger",cancelText:"Cancel",onOk:function(){s(t)}})}var f=(i>=T.r.Admin&&t.level<=i||t.user.uuid===r.uuid)&&t.level!==T.r.Owner;return e.a.createElement("div",null,f&&e.a.createElement("a",{className:"text-danger",onClick:m,"data-attr":"delete-org-membership"},t.user.uuid!==r.uuid?e.a.createElement(pe.a,{title:"Remove from organization"}):e.a.createElement(Ne.a,{title:"Leave organization"})))}function q(t){var a=t.user,o=Object(g.useValues)(ae.a),r=o.members,l=o.membersLoading,d=[{key:"user_profile_picture",render:function(s,i){return e.a.createElement(Z.a,{name:i.user.first_name,email:i.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(s,i){return i.user.uuid==a.uuid?"".concat(i.user.first_name," (me)"):i.user.first_name},sorter:function(s,i){return s.user.first_name.localeCompare(i.user.first_name)}},{title:"Email",key:"user_email",render:function(s,i){return i.user.email},sorter:function(s,i){return s.user.email.localeCompare(i.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(s,i){return Be(i)},sorter:function(s,i){return s.level-i.level},defaultSortOrder:"descend"},{title:"Joined\xA0At",dataIndex:"joined_at",key:"joined_at",render:function(s){return Object(we.M)(s)},sorter:function(s,i){return s.joined_at.localeCompare(i.joined_at)},defaultSortOrder:"ascend"},{dataIndex:"actions",key:"actions",align:"center",render:function(s,i){return Fe(i)}}];return e.a.createElement(e.a.Fragment,null,e.a.createElement("h2",{className:"subtitle"},"Members"),e.a.createElement(Ve.a,{dataSource:r,columns:d,rowKey:"id",pagination:!1,style:{marginTop:"1rem"},loading:l,"data-attr":"org-members-table"}))}try{q.displayName="Members",q.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:q.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(t){}var Ke=n("./node_modules/antd/lib/typography/Paragraph.js"),We=n.n(Ke);function ee(t){var a=t.isVisible,o=t.setIsVisible,r=Object(g.useValues)(V.a),l=r.currentOrganization,d=r.organizationBeingDeleted,c=Object(g.useActions)(V.a),s=c.deleteOrganization,i=Object(O.useState)(!1),m=C()(i,2),f=m[0],u=m[1],v=!!l&&(d==null?void 0:d.id)===l.id;return e.a.createElement(M.a,{title:"Delete the entire organization?",okText:"Delete ".concat(l?l.name:"the current organization"),onOk:l?function(){return s(l)}:void 0,okType:"primary",okButtonProps:{"data-attr":"delete-organization-ok",loading:v,disabled:!f,className:"btn-danger"},onCancel:function(){return o(!1)},cancelButtonProps:{disabled:v},visible:a},e.a.createElement("p",null,"Organization deletion ",e.a.createElement("b",null,"cannot be undone"),". You will lose all data, ",e.a.createElement("b",null,"including all events"),", related to all projects within this organization."),e.a.createElement("p",null,"Please type"," ",e.a.createElement("strong",null,l?l.name:"this organization's name")," to confirm."),e.a.createElement(j.a,{type:"text",onChange:function(S){if(l){var b=S.target.value;u(b.toLowerCase()===l.name.toLowerCase())}}}))}function ne(t){var a=t.isRestricted,o=Object(g.useValues)(V.a),r=o.currentOrganization,l=Object(O.useState)(!1),d=C()(l,2),c=d[0],s=d[1];return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{style:{color:"var(--danger)"}},e.a.createElement("h2",{style:{color:"var(--danger)"},className:"subtitle"},"Danger Zone"),e.a.createElement("div",{className:"mt"},!a&&e.a.createElement(We.a,{type:"danger"},"This is ",e.a.createElement("b",null,"irreversible"),". Please be certain."),e.a.createElement(z.a,{type:"primary",onClick:function(){return s(!0)},className:"mr-05 btn-danger","data-attr":"delete-project-button",icon:e.a.createElement(pe.a,null),disabled:a},"Delete ",(r==null?void 0:r.name)||"the current organization"))),e.a.createElement(ee,{isVisible:c,setIsVisible:s}))}try{ee.displayName="DeleteOrganizationModal",ee.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isVisible:{defaultValue:null,description:"",name:"isVisible",required:!0,type:{name:"boolean"}},setIsVisible:{defaultValue:null,description:"",name:"setIsVisible",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:ee.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(t){}try{ne.displayName="DangerZone",ne.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:ne.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(t){}var te=n("./frontend/src/lib/components/RestrictedArea.tsx"),Ue=n("./frontend/src/lib/hooks/useAnchor.ts"),Ee=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),oe=n("./frontend/src/types.ts"),dn=n("./node_modules/core-js/modules/es.array.find.js"),un=n("./node_modules/core-js/modules/es.array.includes.js"),mn=n("./node_modules/core-js/modules/es.string.includes.js"),Ye=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),$e=n.n(Ye),Ze=n("./node_modules/@babel/runtime/regenerator/index.js"),x=n.n(Ze),fn=n("./node_modules/regenerator-runtime/runtime.js"),Ge=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),X=n.n(Ge),He=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),se=n.n(He),Q=n("./frontend/src/lib/api.ts"),le=n("./frontend/src/lib/components/lemonToast.tsx");function Oe(t,a){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),o.push.apply(o,r)}return o}function ye(t){for(var a=1;a<arguments.length;a++){var o=arguments[a]!=null?arguments[a]:{};a%2?Oe(Object(o),!0).forEach(function(r){$e()(t,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):Oe(Object(o)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))})}return t}var F=Object(g.kea)({path:["scenes","organization","verifiedDomainsLogic"],connect:{values:[V.a,["currentOrganization"]]},actions:{replaceDomain:function(a){return{domain:a}},setAddModalShown:function(a){return{shown:a}},setVerifyModal:function(a){return{id:a}}},reducers:{verifiedDomains:[[],{replaceDomain:function(a,o){var r=o.domain,l=[].concat(se()(a.filter(function(d){var c=d.id;return c!==r.id})),[r]);return l.sort(function(d,c){return d.domain.localeCompare(c.domain)}),l}}],addModalShown:[!1,{setAddModalShown:function(a,o){var r=o.shown;return r},addVerifiedDomainSuccess:function(){return!1}}],verifyModal:[null,{setVerifyModal:function(a,o){var r=o.id;return r}}]},loaders:function(a){var o=a.values,r=a.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var l=X()(x.a.mark(function c(){var s;return x.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,Q.a.get("api/organizations/".concat((s=o.currentOrganization)===null||s===void 0?void 0:s.id,"/domains"));case 2:return m.abrupt("return",m.sent.results);case 3:case"end":return m.stop()}},c)}));function d(){return l.apply(this,arguments)}return d}(),addVerifiedDomain:function(){var l=X()(x.a.mark(function c(s){var i,m;return x.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,Q.a.create("api/organizations/".concat((i=o.currentOrganization)===null||i===void 0?void 0:i.id,"/domains"),{domain:s});case 2:return m=u.sent,u.abrupt("return",[m].concat(se()(o.verifiedDomains)));case 4:case"end":return u.stop()}},c)}));function d(c){return l.apply(this,arguments)}return d}(),deleteVerifiedDomain:function(){var l=X()(x.a.mark(function c(s){var i;return x.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Q.a.delete("api/organizations/".concat((i=o.currentOrganization)===null||i===void 0?void 0:i.id,"/domains/").concat(s));case 2:return f.abrupt("return",se()(o.verifiedDomains.filter(function(u){return u.id!==s})));case 3:case"end":return f.stop()}},c)}));function d(c){return l.apply(this,arguments)}return d}()}],updatingDomain:[!1,{updateDomain:function(){var l=X()(x.a.mark(function c(s){var i,m;return x.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,Q.a.update("api/organizations/".concat((i=o.currentOrganization)===null||i===void 0?void 0:i.id,"/domains/").concat(s.id),ye(ye({},s),{},{id:void 0}));case 2:return m=u.sent,le.a.success("Domain updated successfully! Changes will take immediately."),r.replaceDomain(m),u.abrupt("return",!1);case 6:case"end":return u.stop()}},c)}));function d(c){return l.apply(this,arguments)}return d}(),verifyDomain:function(){var l=X()(x.a.mark(function c(){var s,i;return x.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Q.a.create("api/organizations/".concat((s=o.currentOrganization)===null||s===void 0?void 0:s.id,"/domains/").concat(o.verifyModal,"/verify"));case 2:return i=f.sent,i.is_verified?le.a.success("Domain verified successfully."):le.a.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),r.replaceDomain(i),r.setVerifyModal(null),f.abrupt("return",!1);case 7:case"end":return f.stop()}},c)}));function d(){return l.apply(this,arguments)}return d}()}]}},selectors:{domainBeingVerified:[function(t){return[t.verifiedDomains,t.verifyModal]},function(t,a){return a&&t.find(function(o){var r=o.id;return r===a})||null}],isFeatureAvailable:[function(t){return[t.currentOrganization]},function(t){var a;return(a=(t==null?void 0:t.available_features.includes(oe.c.SSO_ENFORCEMENT))||(t==null?void 0:t.available_features.includes(oe.c.SAML)))!==null&&a!==void 0?a:!1}]},events:function(a){var o=a.actions;return{afterMount:[o.loadVerifiedDomains]}}}),he=n("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),Je=n("./frontend/src/lib/components/LemonButton/More.tsx"),vn=n("./node_modules/core-js/modules/es.regexp.exec.js"),gn=n("./node_modules/core-js/modules/es.string.match.js"),be=n("./frontend/src/lib/components/LemonModal/LemonModal.tsx"),Xe=/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/;function Qe(){var t=Object(g.useValues)(F),a=t.addModalShown,o=t.verifiedDomainsLoading,r=Object(g.useActions)(F),l=r.setAddModalShown,d=r.addVerifiedDomain,c=Object(O.useState)(""),s=C()(c,2),i=s[0],m=s[1],f=Object(O.useState)(!1),u=C()(f,2),v=u[0],E=u[1],S=!i||!i.match(Xe),b=function(){m(""),E(!1)},P=function(){l(!1),b()},K=function(){E(!0),S||(d(i),b())};return e.a.createElement(be.a,{onCancel:P,visible:a,destroyOnClose:!0},e.a.createElement("section",null,e.a.createElement("h5",null,"Add verified domain"),e.a.createElement(j.a,{placeholder:"posthog.com",autoFocus:!0,value:i,onChange:function(on){return m(on.target.value)},onPressEnter:K}),v&&S&&e.a.createElement("span",{className:"text-danger text-small"},"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e.a.createElement(G.a,{type:"primary",disabled:i===""||v&&S||o,onClick:K},"Add domain"))))}var ke=n("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx");function _e(){var t=Object(g.useValues)(F),a=t.domainBeingVerified,o=t.updatingDomainLoading,r=Object(g.useActions)(F),l=r.setVerifyModal,d=r.verifyDomain,c="_posthog-challenge.".concat(a==null?void 0:a.domain,".");return e.a.createElement(be.a,{visible:!!a,onCancel:function(){return l(null)}},e.a.createElement("section",null,e.a.createElement("h5",null,"Verify your domain"),e.a.createElement(Ee.a,null,(a==null?void 0:a.domain)||""),e.a.createElement("p",{className:"text-muted-alt"},"To verify your domain, you need to add a record to your DNS zone."),e.a.createElement("div",null,e.a.createElement("ol",null,e.a.createElement("li",null,"Sign in to your DNS provider."),e.a.createElement("li",null,"Add the following ",e.a.createElement("b",null,"TXT")," record.",e.a.createElement("div",{className:"mt mb"},e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-name"},"Name"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(j.a,{disabled:!0,value:c,name:"record-name"}),e.a.createElement(Y.a,{explicitValue:c,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"Value or content"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(j.a,{disabled:!0,value:a==null?void 0:a.verification_challenge,name:"record-value"}),e.a.createElement(Y.a,{explicitValue:a==null?void 0:a.verification_challenge,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"TTL"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(j.a,{disabled:!0,value:"Default or 3600",name:"record-value"}),e.a.createElement(Y.a,{explicitValue:"3600",style:{marginLeft:4}}))))),e.a.createElement("li",null,"Press verify below."))),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e.a.createElement(G.a,{onClick:function(){return l(null)},style:{marginRight:8}},"Verify later"),e.a.createElement(G.a,{type:"primary",disabled:o,onClick:d},"Verify"))))}var qe=n("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx");function en(){var t=Object(g.useValues)(F),a=t.verifiedDomainsLoading,o=t.updatingDomainLoading,r=t.isFeatureAvailable,l=Object(g.useActions)(F),d=l.setAddModalShown;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"flex-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("div",{id:"domain-whitelist"})," ",e.a.createElement("h2",{id:"verified-domains",className:"subtitle"},"Verified domains"),e.a.createElement("p",{className:"text-muted-alt"},"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains.")),r&&e.a.createElement("div",null,e.a.createElement(z.a,{type:"primary",icon:e.a.createElement(_.a,null),onClick:function(){return d(!0)},disabled:a||o},"Add domain"))),e.a.createElement(qe.a,{feature:oe.c.SSO_ENFORCEMENT,overrideShouldShowGate:r},e.a.createElement(nn,null)))}function nn(){var t=Object(g.useValues)(F),a=t.verifiedDomains,o=t.verifiedDomainsLoading,r=t.currentOrganization,l=t.updatingDomainLoading,d=Object(g.useActions)(F),c=d.updateDomain,s=d.deleteVerifiedDomain,i=d.setVerifyModal,m=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function(u,v){var E=v.domain;return e.a.createElement(Ee.a,null,E)}},{key:"is_verified",title:"Verification",render:function(u,v){var E=v.is_verified,S=v.verified_at,b={marginRight:4,fontSize:"1.15em",paddingTop:2};return E?e.a.createElement("div",{className:"flex-center text-success"},e.a.createElement(J.IconCheckmark,{style:b})," Verified"):S?e.a.createElement("div",{className:"flex-center text-danger"},e.a.createElement(J.IconExclamation,{style:b})," Verification expired"):e.a.createElement("div",{className:"flex-center text-warning"},e.a.createElement(J.IconWarningAmber,{style:b})," Pending verification")}},{key:"jit_provisioning_enabled",title:e.a.createElement(e.a.Fragment,null,"Automatic provisioning"," ",e.a.createElement(ie.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((r==null?void 0:r.name)||"this organization"," if it does not exist.")},e.a.createElement(he.a,null))),render:function(u,v){var E=v.jit_provisioning_enabled,S=v.id,b=v.is_verified;return b?e.a.createElement(W.a,{checked:E,disabled:l||!b,onChange:function(K){return c({id:S,jit_provisioning_enabled:K})}}):e.a.createElement("span",{className:"text-muted-alt"},"Verify domain to enable")}},{key:"sso_enforcement",title:e.a.createElement(e.a.Fragment,null,"Enforce SSO"," ",e.a.createElement(ie.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider."},e.a.createElement(he.a,null))),render:function(u,v){var E=v.sso_enforcement,S=v.is_verified,b=v.id;return S?e.a.createElement(ke.a,{value:E,loading:l,onChange:function(K){return c({id:b,sso_enforcement:K})}}):e.a.createElement("span",{className:"text-muted-alt"},"Verify domain to enable")}},{key:"actions",width:32,align:"center",render:function(u,v){var E=v.is_verified,S=v.id,b=v.domain;return E?e.a.createElement(Je.a,{overlay:e.a.createElement(e.a.Fragment,null,e.a.createElement(G.a,{type:"stealth",style:{color:"var(--danger)"},onClick:function(){return M.a.confirm({title:"Remove ".concat(b,"?"),icon:null,okText:"Remove domain",okType:"primary",okButtonProps:{className:"btn-danger"},content:e.a.createElement("div",null,"This cannot be undone. If you have SAML configured or SSO enforced, it will be immediately disabled."),onOk:function(){s(S)},cancelText:"Cancel"})},fullWidth:!0},e.a.createElement(J.IconDelete,null)," Remove domain")),style:{display:"inline-block"}}):e.a.createElement(G.a,{type:"primary",onClick:function(){return i(S)}},"Verify")}}];return e.a.createElement("div",null,e.a.createElement(de.a,{dataSource:a,columns:m,loading:o,rowKey:"id",emptyState:"You haven't registered any verified domains."}),e.a.createElement(Qe,null),e.a.createElement(_e,null))}var tn={component:je,logic:V.a};function an(t){var a=t.isRestricted,o=Object(g.useValues)(V.a),r=o.currentOrganization,l=o.currentOrganizationLoading,d=Object(g.useActions)(V.a),c=d.updateOrganization,s=Object(O.useState)((r==null?void 0:r.name)||""),i=C()(s,2),m=i[0],f=i[1];return e.a.createElement("div",null,e.a.createElement("h2",{id:"name",className:"subtitle"},"Display Name"),e.a.createElement(j.a,{value:m,onChange:function(v){f(v.target.value)},style:{maxWidth:"40rem",marginBottom:"1rem",display:"block"},disabled:a}),e.a.createElement(z.a,{type:"primary",onClick:function(v){v.preventDefault(),c({name:m})},disabled:a||!m||!r||m===r.name,loading:l},"Rename Organization"))}function rn(t){var a=t.isRestricted,o=Object(g.useValues)(V.a),r=o.currentOrganization,l=o.currentOrganizationLoading,d=Object(g.useActions)(V.a),c=d.updateOrganization;return e.a.createElement("div",null,e.a.createElement("h2",{id:"notification-preferences",className:"subtitle"},"Notification Preferences"),e.a.createElement("div",null,e.a.createElement(W.a,{id:"is-member-join-email-enabled-switch","data-attr":"is-member-join-email-enabled-switch",onChange:function(i){c({is_member_join_email_enabled:i})},checked:r==null?void 0:r.is_member_join_email_enabled,loading:l,disabled:a||!r}),e.a.createElement("label",{style:{marginLeft:"10px"},htmlFor:"is-member-join-email-enabled-switch"},"Email all current members when a new member joins")))}function je(){var t=Object(g.useValues)(re.a),a=t.user;return Object(Ue.a)(location.hash),e.a.createElement(e.a.Fragment,null,e.a.createElement(y.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),e.a.createElement(N.a,null,e.a.createElement(te.a,{Component:an,minimumAccessLevel:T.r.Admin}),e.a.createElement(p.a,null),e.a.createElement(Re,null),e.a.createElement(p.a,null),a&&e.a.createElement(q,{user:a}),e.a.createElement(p.a,null),e.a.createElement(te.a,{Component:en,minimumAccessLevel:T.r.Admin}),e.a.createElement(p.a,null),e.a.createElement(te.a,{Component:rn,minimumAccessLevel:T.r.Admin}),e.a.createElement(p.a,null),e.a.createElement(te.a,{Component:ne,minimumAccessLevel:T.r.Owner})))}},"./node_modules/@ant-design/icons/es/icons/CrownFilled.js":function(k,D,n){"use strict";var R=n("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),I=n("./node_modules/react/index.js"),C={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M899.6 276.5L705 396.4 518.4 147.5a8.06 8.06 0 00-12.9 0L319 396.4 124.3 276.5c-5.7-3.5-13.1 1.2-12.2 7.9L188.5 865c1.1 7.9 7.9 14 16 14h615.1c8 0 14.9-6 15.9-14l76.4-580.6c.8-6.7-6.5-11.4-12.3-7.9zM512 734.2c-62.1 0-112.6-50.5-112.6-112.6S449.9 509 512 509s112.6 50.5 112.6 112.6S574.1 734.2 512 734.2zm0-160.9c-26.6 0-48.2 21.6-48.2 48.3 0 26.6 21.6 48.3 48.2 48.3s48.2-21.6 48.2-48.3c0-26.6-21.6-48.3-48.2-48.3z"}}]},name:"crown",theme:"filled"},O=C,e=n("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),j=function(N,p){return I.createElement(e.a,Object(R.a)(Object(R.a)({},N),{},{ref:p,icon:O}))};j.displayName="CrownFilled";var z=D.a=I.forwardRef(j)},"./node_modules/antd/lib/typography/Paragraph.js":function(k,D,n){"use strict";var R=n("./node_modules/@babel/runtime/helpers/interopRequireDefault.js"),I=n("./node_modules/@babel/runtime/helpers/typeof.js");Object.defineProperty(D,"__esModule",{value:!0}),D.default=void 0;var C=R(n("./node_modules/@babel/runtime/helpers/extends.js")),O=z(n("./node_modules/react/index.js")),e=R(n("./node_modules/antd/lib/typography/Base.js"));function j(p){if(typeof WeakMap!="function")return null;var y=new WeakMap,A=new WeakMap;return(j=function(U){return U?A:y})(p)}function z(p,y){if(!y&&p&&p.__esModule)return p;if(p===null||I(p)!=="object"&&typeof p!="function")return{default:p};var A=j(y);if(A&&A.has(p))return A.get(p);var h={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in p)if(L!=="default"&&Object.prototype.hasOwnProperty.call(p,L)){var w=U?Object.getOwnPropertyDescriptor(p,L):null;w&&(w.get||w.set)?Object.defineProperty(h,L,w):h[L]=p[L]}return h.default=p,A&&A.set(p,h),h}var W=function(y){return O.createElement(e.default,(0,C.default)({},y,{component:"div"}))},N=W;D.default=N}}]);
