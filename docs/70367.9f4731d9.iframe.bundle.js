"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[70367],{"../../frontend/src/scenes/session-recordings/playlist/SessionRecordingsPlaylistScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SessionRecordingsPlaylistScene:()=>SessionRecordingsPlaylistScene,scene:()=>scene});var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),EditableField=__webpack_require__("../../frontend/src/lib/components/EditableField/EditableField.tsx"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),UserActivityIndicator=__webpack_require__("../../frontend/src/lib/components/UserActivityIndicator/UserActivityIndicator.tsx"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonSkeleton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),playerSettingsLogic=__webpack_require__("../../frontend/src/scenes/session-recordings/player/playerSettingsLogic.ts"),utils=__webpack_require__("../../frontend/src/scenes/session-recordings/utils.ts"),SessionRecordingsPlaylist=__webpack_require__("../../frontend/src/scenes/session-recordings/playlist/SessionRecordingsPlaylist.tsx"),sessionRecordingsPlaylistLogic=__webpack_require__("../../frontend/src/scenes/session-recordings/playlist/sessionRecordingsPlaylistLogic.ts"),fast_deep_equal=__webpack_require__("../../node_modules/.pnpm/fast-deep-equal@3.1.3/node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),sceneLogic=__webpack_require__("../../frontend/src/scenes/sceneLogic.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),playlistUtils=__webpack_require__("../../frontend/src/scenes/session-recordings/playlist/playlistUtils.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),cohortsModel=__webpack_require__("../../frontend/src/models/cohortsModel.ts"),types=__webpack_require__("../../frontend/src/types.ts"),playerUtils=__webpack_require__("../../frontend/src/scenes/session-recordings/player/utils/playerUtils.ts");let sessionRecordingsPlaylistSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(key=>["scenes","session-recordings","playlist","sessionRecordingsPlaylistSceneLogic",key]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.shortId),(0,index_esm.connect)({values:[cohortsModel.Qo,["cohortsById"],sceneLogic.k,["activeScene"]]}),(0,index_esm.actions)({updatePlaylist:function(properties){let silent=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{properties,silent}},setFilters:filters=>({filters}),loadPinnedRecordings:!0,onPinnedChange:(recording,pinned)=>({pinned,recording}),markPlaylistViewed:!0}),(0,lib.loaders)(_ref=>{let{values,props}=_ref;return{playlist:[null,{getPlaylist:async()=>(0,playlistUtils.A5)(props.shortId),updatePlaylist:async _ref2=>{let{properties,silent}=_ref2;return values.playlist?.short_id?(0,playlistUtils.CE)(values.playlist?.short_id,null!=properties?properties:{filters:values.filters||void 0},silent):values.playlist},duplicatePlaylist:async()=>{var _values$playlist;return(0,playlistUtils.NR)(null!==(_values$playlist=values.playlist)&&void 0!==_values$playlist?_values$playlist:{},!0)},deletePlaylist:async()=>values.playlist?(0,playlistUtils.l8)(values.playlist,()=>{kea_router_lib.router.actions.replace(urls.j.replay(types.yd.Playlists))}):null}],pinnedRecordings:[null,{loadPinnedRecordings:async(_,breakpoint)=>{if(!props.shortId)return null;await breakpoint(100);let response=await api.ZP.recordings.listPlaylistRecordings(props.shortId,{limit:sessionRecordingsPlaylistLogic.uv});return breakpoint(),response.results},onPinnedChange:async _ref3=>{var _values$pinnedRecordi;let{recording,pinned}=_ref3,newResults=null!==(_values$pinnedRecordi=values.pinnedRecordings)&&void 0!==_values$pinnedRecordi?_values$pinnedRecordi:[];return newResults=newResults.filter(r=>r.id!==recording.id),pinned?(await (0,playerUtils.Of)(props.shortId,recording.id),newResults.push(recording)):await (0,playerUtils.ne)(props.shortId,recording.id),newResults}}]}}),(0,index_esm.reducers)(()=>({filters:[null,{getPlaylistSuccess:(_,_ref4)=>{let{playlist}=_ref4;return playlist?.filters||null},updatePlaylistSuccess:(_,_ref5)=>{let{playlist}=_ref5;return playlist?.filters||null},setFilters:(_,_ref6)=>{let{filters}=_ref6;return filters}}]})),(0,index_esm.listeners)(_ref7=>{let{actions,values}=_ref7;return{getPlaylistSuccess:_ref8=>{let{playlist}=_ref8;values.playlist?.derived_name!==values.derivedName&&actions.updatePlaylist({derived_name:values.derivedName},!0),playlist.filters&&actions.markPlaylistViewed()},markPlaylistViewed:async()=>{values.playlist&&await api.ZP.recordings.playlistViewed(values.playlist.short_id)}}}),(0,kea_router_lib.beforeUnload)(_ref9=>{let{values,actions}=_ref9;return{enabled:newLocation=>values.activeScene===sceneTypes.x.ReplayPlaylist&&values.hasChanges&&newLocation?.pathname!==kea_router_lib.router.values.location.pathname,message:"Leave playlist?\nChanges you made will be discarded.",onConfirm:()=>{actions.setFilters(values.playlist?.filters||null)}}}),(0,index_esm.selectors)(_ref10=>{let{asyncActions}=_ref10;return{breadcrumbs:[s=>[s.playlist],playlist=>[{key:sceneTypes.x.Replay,name:"Replay",path:urls.j.replay()},{key:types.yd.Playlists,name:"Playlists",path:urls.j.replay(types.yd.Playlists)},{key:[sceneTypes.x.ReplayPlaylist,playlist?.short_id||"new"],name:playlist?.name||playlist?.derived_name||"Unnamed",onRename:async name=>{if(!playlist){src.UJ.error("Cannot rename unsaved playlist");return}await asyncActions.updatePlaylist({short_id:playlist.short_id,name})}}]],hasChanges:[s=>[s.playlist,s.filters],(playlist,filters)=>!fast_deep_equal_default()(playlist?.filters,filters)],derivedName:[s=>[s.filters,s.cohortsById],(filters,cohortsById)=>{if(!filters)return"Unnamed";let universalFilters=(0,utils.$U)(filters)?filters:(0,sessionRecordingsPlaylistLogic.pr)({},filters);return playlistUtils.rP(utils.Ri(universalFilters),cohortsById)?.slice(0,400)||"Unnamed"}]}}),(0,index_esm.afterMount)(_ref11=>{let{actions}=_ref11;actions.getPlaylist(),actions.loadPinnedRecordings()})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:SessionRecordingsPlaylistScene,logic:sessionRecordingsPlaylistSceneLogic,paramsToProps:_ref=>{let{params:{id}}=_ref;return{shortId:id}}};function SessionRecordingsPlaylistScene(){let{playlist,playlistLoading,pinnedRecordings,hasChanges}=(0,index_esm.useValues)(sessionRecordingsPlaylistSceneLogic),{setFilters,updatePlaylist,duplicatePlaylist,deletePlaylist,onPinnedChange}=(0,index_esm.useActions)(sessionRecordingsPlaylistSceneLogic),{showFilters}=(0,index_esm.useValues)(playerSettingsLogic.NX),{setShowFilters}=(0,index_esm.useActions)(playerSettingsLogic.NX);return playlistLoading?(0,jsx_runtime.jsxs)("div",{className:"space-y-4 mt-6",children:[(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10 w-1/4"}),(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-4 w-1/3"}),(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-4 w-1/4"}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,jsx_runtime.jsx)(LemonSkeleton.y.Button,{}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonSkeleton.y.Button,{}),(0,jsx_runtime.jsx)(LemonSkeleton.y.Button,{})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between gap-4 mt-8",children:[(0,jsx_runtime.jsx)("div",{className:"space-y-8 w-1/4",children:(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10",repeat:10})}),(0,jsx_runtime.jsx)("div",{className:"flex-1"})]})]}):playlist?(0,jsx_runtime.jsxs)("div",{className:"-mb-14",children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>duplicatePlaylist(),fullWidth:!0,"data-attr":"duplicate-playlist",children:"Duplicate"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>updatePlaylist({short_id:playlist.short_id,pinned:!playlist.pinned}),fullWidth:!0,children:playlist.pinned?"Unpin playlist":"Pin playlist"}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(src.Jp,{status:"danger",onClick:()=>deletePlaylist(),fullWidth:!0,children:"Delete playlist"})]})}),(0,jsx_runtime.jsx)(src.p2,{vertical:!0}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",disabledReason:showFilters&&!hasChanges?"No changes to save":void 0,loading:hasChanges&&playlistLoading,onClick:()=>{showFilters?updatePlaylist():setShowFilters(!showFilters)},children:showFilters?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Save changes"}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Edit"})})]}),caption:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(EditableField.f,{multiline:!0,name:"description",markdown:!0,value:playlist.description||"",placeholder:"Description (optional)",onSave:value=>updatePlaylist({description:value}),saveOnBlur:!0,maxLength:400,"data-attr":"playlist-description",compactButtons:!0}),(0,jsx_runtime.jsx)(UserActivityIndicator.F,{at:playlist.last_modified_at,by:playlist.last_modified_by,className:"mt-2"})]})}),(0,jsx_runtime.jsx)("div",{className:"SessionRecordingPlaylistHeightWrapper",children:(0,jsx_runtime.jsx)(SessionRecordingsPlaylist.m,{logicKey:playlist.short_id,filters:playlist.filters&&(0,utils.$U)(playlist.filters)?playlist.filters:(0,sessionRecordingsPlaylistLogic.pr)({},playlist.filters),onFiltersChange:setFilters,onPinnedChange:onPinnedChange,pinnedRecordings:null!=pinnedRecordings?pinnedRecordings:[],updateSearchParams:!0})})]}):(0,jsx_runtime.jsx)(NotFound.T,{object:"Recording Playlist"})}}}]);