"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[3704],{"./frontend/src/scenes/data-management/database/databaseSceneLogic.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Y:function(){return databaseSceneLogic}});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),_queries_query__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/queries/query.ts"),_queries_schema__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/queries/schema.ts");const databaseSceneLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-management","database","databaseSceneLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setSearchTerm:searchTerm=>({searchTerm:searchTerm})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({database:[null,{loadDatabase:async()=>await(0,_queries_query__WEBPACK_IMPORTED_MODULE_2__.IO)({kind:_queries_schema__WEBPACK_IMPORTED_MODULE_3__.O.DatabaseSchemaQuery})}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({searchTerm:["",{setSearchTerm:(_,_ref)=>{let{searchTerm:searchTerm}=_ref;return searchTerm}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({filteredTables:[s=>[s.database,s.searchTerm],(database,searchTerm)=>database?Object.entries(database).map((_ref2=>{let[key,value]=_ref2;return{name:key,columns:value}})).filter((_ref3=>{let{name:name}=_ref3;return name.toLowerCase().includes(searchTerm.toLowerCase())})).sort(((a,b)=>a.name.localeCompare(b.name))):[]],tableOptions:[s=>[s.filteredTables],filteredTables=>filteredTables.map((row=>({value:row,label:row.name})))]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref4=>{let{actions:actions}=_ref4;return actions.loadDatabase()}))])},"./frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DataWarehousetTable:function(){return DataWarehousetTable},TableForm:function(){return TableForm},scene:function(){return scene}});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),databaseSceneLogic=__webpack_require__("./frontend/src/scenes/data-management/database/databaseSceneLogic.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const NEW_WAREHOUSE_TABLE={id:"",name:"",url_pattern:"",format:"Parquet",credential:{access_key:"",access_secret:""},columns:[]},dataWarehouseTableLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","tableLogic"]),(0,index_esm.props)({}),(0,index_esm.key)((_ref=>{let{id:id}=_ref;return id})),(0,index_esm.connect)((()=>({actions:[databaseSceneLogic.Y,["loadDatabase"]]}))),(0,index_esm.actions)({editingTable:editing=>({editing:editing}),updateTargetingFlagFilters:(index,properties)=>({index:index,properties:properties}),addConditionSet:!0,removeConditionSet:index=>({index:index}),launchTable:!0,stopTable:!0,archiveTable:!0,setDataTableQuery:query=>({query:query})}),(0,kea_loaders_lib.loaders)((_ref2=>{let{props:props}=_ref2;return{table:{loadTable:async()=>props.id&&"new"!==props.id?await api.ZP.dataWarehouseTables.get(props.id):{...NEW_WAREHOUSE_TABLE},createTable:async tablePayload=>await api.ZP.dataWarehouseTables.create({...tablePayload}),updateTable:async tablePayload=>await api.ZP.dataWarehouseTables.update(props.id,tablePayload)}}})),(0,index_esm.listeners)((_ref3=>{let{actions:actions}=_ref3;return{createTableSuccess:async _ref4=>{let{table:table}=_ref4;src.lemonToast.success((0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Table ",table.name," created"]})),actions.loadDatabase(),kea_router_lib.router.actions.replace(urls.j.dataWarehouse())},updateTableSuccess:async _ref5=>{let{table:table}=_ref5;src.lemonToast.success((0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Table ",table.name," updated"]})),actions.editingTable(!1),kea_router_lib.router.actions.replace(urls.j.dataWarehouse())}}})),(0,index_esm.reducers)({isEditingTable:[!1,{editingTable:(_,_ref6)=>{let{editing:editing}=_ref6;return editing}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref7)=>{let{query:query}=_ref7;return query}}]}),(0,index_esm.selectors)({breadcrumbs:[s=>[s.table],table=>[{name:"Tables",path:urls.j.dataWarehouse()},...table?.name?[{name:table.name}]:[]]]}),(0,lib.forms)((_ref8=>{let{actions:actions,props:props}=_ref8;return{table:{defaults:{...NEW_WAREHOUSE_TABLE},errors:_ref9=>{let{name:name,url_pattern:url_pattern,credential:credential,format:format}=_ref9;return{name:!name&&"Please enter a name.",url_pattern:!url_pattern&&"Please enter a url pattern.",credential:{access_secret:!credential.access_secret&&"Please enter an access secret.",access_key:!credential.access_key&&"Please enter an access key."},format:!format&&"Please enter the format of your files."}},submit:async tablePayload=>{props.id&&"new"!==props.id?actions.updateTable(tablePayload):actions.createTable(tablePayload)}}}})),(0,kea_router_lib.urlToAction)((_ref10=>{var _props$id;let{actions:actions,props:props}=_ref10;return{[urls.j.dataWarehouseTable(null!==(_props$id=props.id)&&void 0!==_props$id?_props$id:"new")]:(_,__,___,_ref11)=>{let{method:method}=_ref11;"PUSH"===method&&(props.id?actions.loadTable():actions.resetTable())}}})),(0,index_esm.afterMount)((async _ref12=>{let{props:props,actions:actions}=_ref12;"new"===props.id&&actions.resetTable()}))]);var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx");const scene={component:DataWarehousetTable,logic:dataWarehouseTableLogic,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{id:id}}};function DataWarehousetTable(){let{id:id}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{isEditingTable:isEditingTable}=(0,index_esm.useValues)(dataWarehouseTableLogic),showTableForm="new"===id||isEditingTable;return(0,jsx_runtime.jsx)("div",{children:id?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:showTableForm?(0,jsx_runtime.jsx)(TableForm,{id:id}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}):(0,jsx_runtime.jsx)(LemonSkeleton.y,{})})}function TableForm(_ref2){let{id:id}=_ref2;const{table:table,tableLoading:tableLoading,isEditingTable:isEditingTable}=(0,index_esm.useValues)(dataWarehouseTableLogic),{loadTable:loadTable,editingTable:editingTable}=(0,index_esm.useActions)(dataWarehouseTableLogic);return(0,jsx_runtime.jsxs)(lib.Form,{formKey:"table",logic:dataWarehouseTableLogic,className:"space-y-4",enableFormOnSubmit:!0,children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:"new"===id?"New table":table.name,buttons:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-table",type:"secondary",loading:tableLoading,onClick:()=>{isEditingTable?(editingTable(!1),loadTable()):kea_router_lib.router.actions.push(urls.j.dataWarehouse())},children:"Cancel"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:tableLoading,children:"Save"})]}),caption:(0,jsx_runtime.jsxs)("div",{children:["External tables are supported through object storage systems like S3."," ",(0,jsx_runtime.jsx)("a",{href:"https://posthog.com/docs/data/data-warehouse#step-1-creating-a-bucket-in-s3",target:"_blank",children:"Learn how to set up your data"})]})}),(0,jsx_runtime.jsx)(src.LemonDivider,{}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 max-w-160",children:[(0,jsx_runtime.jsx)(Field.g,{name:"name",label:"Table Name",children:(0,jsx_runtime.jsx)(src.LemonInput,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"Examples: stripe_invoice, hubspot_contacts, users",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs mb-4",children:"This will be the table name used when writing queries"}),(0,jsx_runtime.jsx)(Field.g,{name:"url_pattern",label:"Files URL pattern",children:(0,jsx_runtime.jsx)(src.LemonInput,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: https://your-org.s3.amazonaws.com/airbyte/stripe/invoices/*.pqt",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,jsx_runtime.jsxs)("div",{className:"text-muted text-xs mb-4",children:["You can use ",(0,jsx_runtime.jsx)("strong",{children:"*"})," to select multiple files."]}),(0,jsx_runtime.jsx)(Field.g,{name:"format",label:"File format",className:"w-max",children:(0,jsx_runtime.jsx)(src.LemonSelect,{"data-attr":"table-format",options:[{label:"Parquet (recommended)",value:"Parquet"},{label:"CSV",value:"CSV"},{label:"JSON",value:"JSONEachRow"}]})}),(0,jsx_runtime.jsx)(Field.g,{name:["credential","access_key"],label:"Access Key",children:(0,jsx_runtime.jsx)(src.LemonInput,{"data-attr":"access-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: AKIAIOSFODNN7EXAMPLE",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),(0,jsx_runtime.jsx)(Field.g,{name:["credential","access_secret"],label:"Access Secret",children:(0,jsx_runtime.jsx)(src.LemonInput,{"data-attr":"access-secret",className:"ph-ignore-input",autoFocus:!0,type:"password",placeholder:"eg: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})]})]})}try{DataWarehousetTable.displayName="DataWarehousetTable",DataWarehousetTable.__docgenInfo={description:"",displayName:"DataWarehousetTable",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx#DataWarehousetTable"]={docgenInfo:DataWarehousetTable.__docgenInfo,name:"DataWarehousetTable",path:"frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx#DataWarehousetTable"})}catch(__react_docgen_typescript_loader_error){}try{TableForm.displayName="TableForm",TableForm.__docgenInfo={description:"",displayName:"TableForm",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx#TableForm"]={docgenInfo:TableForm.__docgenInfo,name:"TableForm",path:"frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx#TableForm"})}catch(__react_docgen_typescript_loader_error){}}}]);