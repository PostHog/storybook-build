"use strict";(self.webpackChunk_posthog_frontend=self.webpackChunk_posthog_frontend||[]).push([[65393],{"./frontend/src/scenes/error-tracking/ErrorTrackingScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ErrorTrackingScene:()=>ErrorTrackingScene,scene:()=>scene});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.10.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),FeedbackNotice=__webpack_require__("./frontend/src/lib/components/FeedbackNotice.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),Sparkline=__webpack_require__("./frontend/src/lib/components/Sparkline.tsx"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),LemonTableLink=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),InsightViz=__webpack_require__("./frontend/src/queries/nodes/InsightViz/InsightViz.tsx"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),AlphaAccessScenePrompt=__webpack_require__("./frontend/src/scenes/error-tracking/AlphaAccessScenePrompt.tsx"),AssigneeSelect=__webpack_require__("./frontend/src/scenes/error-tracking/AssigneeSelect.tsx"),api=__webpack_require__("./frontend/src/lib/api.ts"),dataNodeLogic=__webpack_require__("./frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),error_tracking_utils=__webpack_require__("./frontend/src/scenes/error-tracking/utils.ts");let errorTrackingDataNodeLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","error-tracking","errorTrackingDataNodeLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(_ref=>{let{key,query}=_ref;return{values:[(0,dataNodeLogic.M)({key,query}),["response"]],actions:[(0,dataNodeLogic.M)({key,query}),["setResponse","loadData"]]}}),(0,index_esm.actions)({mergeIssues:ids=>({ids}),assignIssue:(id,assignee)=>({id,assignee})}),(0,index_esm.listeners)(_ref2=>{let{values,actions}=_ref2;return{mergeIssues:async _ref3=>{let{ids}=_ref3,results=values.response?.results,issues=results.filter(_ref4=>{let{id}=_ref4;return ids.includes(id)}),primaryIssue=issues.shift();if(primaryIssue&&issues.length>0){let mergingIds=issues.map(g=>g.id),mergedIssue=(0,error_tracking_utils.Z0)(primaryIssue,issues);actions.setResponse({...values.response,results:results.filter(_ref5=>{let{id}=_ref5;return!mergingIds.includes(id)}).map(issue=>mergedIssue.id===issue.id?mergedIssue:issue)}),await api.ZP.errorTracking.mergeInto(primaryIssue.id,mergingIds),actions.loadData(!0)}},assignIssue:async _ref6=>{let{id,assignee}=_ref6,response=values.response;if(response){let results=response.results,recordIndex=results.findIndex(r=>r.id===id);if(recordIndex>-1){let issue={...results[recordIndex],assignee};results.splice(recordIndex,1,issue),actions.setResponse({...response,results:results}),await api.ZP.errorTracking.assignIssue(issue.id,assignee),actions.loadData(!0)}}}}})]);var ErrorTrackingFilters=__webpack_require__("./frontend/src/scenes/error-tracking/ErrorTrackingFilters.tsx"),errorTrackingIssueSceneLogic=__webpack_require__("./frontend/src/scenes/error-tracking/errorTrackingIssueSceneLogic.ts"),errorTrackingLogic=__webpack_require__("./frontend/src/scenes/error-tracking/errorTrackingLogic.ts"),errorTrackingSceneLogic=__webpack_require__("./frontend/src/scenes/error-tracking/errorTrackingSceneLogic.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:ErrorTrackingScene,logic:errorTrackingSceneLogic.D};function ErrorTrackingScene(){let{query,selectedIssueIds}=(0,index_esm.useValues)(errorTrackingSceneLogic.D),insightProps={dashboardItemId:"new-ErrorTrackingQuery"};return(0,jsx_runtime.jsx)(AlphaAccessScenePrompt._,{children:(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:errorTrackingDataNodeLogic,props:{query,key:(0,InsightViz.gG)(insightProps)},children:[(0,jsx_runtime.jsx)(Header,{}),(0,jsx_runtime.jsx)(FeedbackNotice.J,{text:"Error tracking is currently in beta. Thanks for taking part! We'd love to hear what you think."}),(0,jsx_runtime.jsx)(ErrorTrackingFilters.ZP.FilterGroup,{children:(0,jsx_runtime.jsx)(ErrorTrackingFilters.ZP.UniversalSearch,{})}),(0,jsx_runtime.jsx)(src.p2,{className:"mt-2"}),0===selectedIssueIds.length?(0,jsx_runtime.jsx)(ErrorTrackingFilters.ZP.Options,{}):(0,jsx_runtime.jsx)(ErrorTrackingActions,{}),(0,jsx_runtime.jsx)(Query.A,{query:query,context:{columns:{error:{width:"50%",render:CustomGroupTitleColumn},occurrences:{align:"center",render:CountColumn},sessions:{align:"center",render:SessionCountColumn},users:{align:"center",render:CountColumn},volume:{renderTitle:VolumeColumnHeader,render:VolumeColumn},assignee:{render:AssigneeColumn}},showOpenEditorButton:!1,insightProps:insightProps,emptyStateHeading:"No issues found",emptyStateDetail:"Try changing the date range, changing the filters or removing the assignee."}})]})})}let ErrorTrackingActions=()=>{let{selectedIssueIds}=(0,index_esm.useValues)(errorTrackingSceneLogic.D),{setSelectedIssueIds}=(0,index_esm.useActions)(errorTrackingSceneLogic.D),{mergeIssues}=(0,index_esm.useActions)(errorTrackingDataNodeLogic);return(0,jsx_runtime.jsxs)("div",{className:"sticky top-[var(--breadcrumbs-height-compact)] z-20 py-2 bg-primary flex space-x-1",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>setSelectedIssueIds([]),children:"Unselect all"}),selectedIssueIds.length>1&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>{mergeIssues(selectedIssueIds),setSelectedIssueIds([])},children:"Merge"})]})},VolumeColumn=props=>{let{sparklineSelectedPeriod,customSparklineConfig}=(0,index_esm.useValues)(errorTrackingLogic.HT),record=props.record,[data,labels]="24h"===sparklineSelectedPeriod?[record.volumeDay,error_tracking_utils.it]:"1m"===sparklineSelectedPeriod?[record.volumeMonth,error_tracking_utils.U9]:customSparklineConfig?[record.customVolume,(0,error_tracking_utils.Gu)(customSparklineConfig)]:[null,null];return data?(0,jsx_runtime.jsx)(Sparkline.b,{className:"h-8",data:data,labels:labels}):null},VolumeColumnHeader=_ref=>{let{columnName}=_ref,{sparklineSelectedPeriod:period,sparklineOptions:options}=(0,index_esm.useValues)(errorTrackingLogic.HT),{setSparklineSelectedPeriod:onChange}=(0,index_esm.useActions)(errorTrackingLogic.HT);return period?(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center min-w-64",children:[(0,jsx_runtime.jsx)("div",{children:columnName}),(0,jsx_runtime.jsx)(src.P4,{size:"xsmall",value:period,options:options,onChange:onChange})]}):null},CustomGroupTitleColumn=props=>{let{selectedIssueIds}=(0,index_esm.useValues)(errorTrackingSceneLogic.D),{setSelectedIssueIds}=(0,index_esm.useActions)(errorTrackingSceneLogic.D),record=props.record,checked=selectedIssueIds.includes(record.id);return(0,jsx_runtime.jsxs)("div",{className:"flex items-start space-x-1.5 group",children:[(0,jsx_runtime.jsx)(src.Hw,{className:(0,clsx_m.default)("pt-1 group-hover:visible",!checked&&"invisible"),checked:checked,onChange:newValue=>{setSelectedIssueIds(newValue?[...new Set([...selectedIssueIds,record.id])]:selectedIssueIds.filter(id=>id!=record.id))}}),(0,jsx_runtime.jsx)(LemonTableLink.i,{title:record.name||"Unknown Type",description:(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsx)("div",{className:"line-clamp-1",children:record.description}),(0,jsx_runtime.jsxs)("div",{className:"space-x-1",children:[(0,jsx_runtime.jsx)(TZLabel.w,{time:record.first_seen,className:"border-dotted border-b"}),(0,jsx_runtime.jsx)("span",{children:"|"}),(0,jsx_runtime.jsx)(TZLabel.w,{time:record.last_seen,className:"border-dotted border-b"})]})]}),className:"flex-1",to:urls.j.errorTrackingIssue(record.id),onClick:()=>{let issueLogic=(0,errorTrackingIssueSceneLogic.H)({id:record.id});issueLogic.mount(),issueLogic.actions.setIssue(record)}})]})},SessionCountColumn=_ref2=>{let{children,...props}=_ref2;return 0===props.value?(0,jsx_runtime.jsx)(src.u,{title:"No $session_id was set for any event in this issue",delayMs:0,children:"-"}):(0,jsx_runtime.jsx)(CountColumn,{...props})},CountColumn=_ref3=>{let{value}=_ref3;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,utils.d$)(value)})},AssigneeColumn=props=>{let{assignIssue}=(0,index_esm.useActions)(errorTrackingDataNodeLogic),record=props.record;return(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsx)(AssigneeSelect.i,{assignee:record.assignee,onChange:assignee=>assignIssue(record.id,assignee)})})},Header=()=>{let{user}=(0,index_esm.useValues)(userLogic.userLogic);return(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[user?.is_staff?(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{throw Error("Oh my!")},children:"Send an exception"}):null,(0,jsx_runtime.jsx)(src.Jp,{to:"https://posthog.com/docs/error-tracking",type:"secondary",targetBlank:!0,children:"Documentation"}),(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.errorTrackingConfiguration(),type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),children:"Configure"})]})})}}}]);