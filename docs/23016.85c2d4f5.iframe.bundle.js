"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[23016],{"../../frontend/src/scenes/audit-logs/AdvancedActivityLogsList.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{d:()=>AdvancedActivityLogsList});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),activityLogLogic=__webpack_require__("../../frontend/src/lib/components/ActivityLog/activityLogLogic.tsx"),humanizeActivity=__webpack_require__("../../frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),PaginationControl=__webpack_require__("../../frontend/src/lib/lemon-ui/PaginationControl/index.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),MonacoDiffEditor=__webpack_require__("../../frontend/src/lib/components/MonacoDiffEditor.tsx"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),ProfilePicture=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AuditLogTableHeader(){return(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-12 gap-4 py-3 px-4 bg-accent-3000 border-b border-border font-semibold text-sm text-muted-alt",children:[(0,jsx_runtime.jsx)("div",{className:"col-span-4",children:"Description"}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:"User"}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:"Action"}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:"Scope"}),(0,jsx_runtime.jsx)("div",{className:"col-span-1",children:"Timestamp"}),(0,jsx_runtime.jsx)("div",{className:"col-span-1"})]})}function AuditLogTableRow(_ref){var _logItem$email;let{logItem}=_ref,[expanded,setExpanded]=(0,react.useState)(!1),unprocessed=logItem.unprocessed;return(0,jsx_runtime.jsxs)("div",{className:"border-b border-border last:border-b-0",children:[(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-12 gap-4 py-3 px-4 hover:bg-accent-3000 items-center text-sm cursor-pointer",onClick:()=>setExpanded(!expanded),"data-attr":"audit-log-row",children:[(0,jsx_runtime.jsx)("div",{className:"col-span-4",children:(0,jsx_runtime.jsx)("div",{className:"truncate",children:"string"==typeof logItem.description?logItem.description:logItem.description||"No description"})}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:(0,jsx_runtime.jsx)(ProfilePicture.Y,{showName:!0,user:{first_name:logItem.isSystem?"PostHog":logItem.name,email:null!==(_logItem$email=logItem.email)&&void 0!==_logItem$email?_logItem$email:void 0},type:logItem.isSystem?"system":"person",size:"md"})}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:(0,jsx_runtime.jsx)("span",{className:"font-medium capitalize",children:unprocessed?.activity||"Unknown"})}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:(0,jsx_runtime.jsx)("span",{className:"inline-block px-2 py-1 bg-accent-3000 rounded text-xs font-medium",children:unprocessed?.scope?(0,humanizeActivity.VI)(unprocessed.scope,!0):"Unknown"})}),(0,jsx_runtime.jsx)("div",{className:"col-span-1 text-muted text-xs",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:logItem.created_at})}),(0,jsx_runtime.jsx)("div",{className:"col-span-1 flex justify-end",children:(0,jsx_runtime.jsx)("button",{className:"text-muted-alt hover:text-default p-1 rounded hover:bg-accent-3000",onClick:e=>{e.stopPropagation(),setExpanded(!expanded)},"aria-label":expanded?"Collapse row":"Expand row","data-attr":"audit-log-expand-button",children:expanded?(0,jsx_runtime.jsx)(posthog_icons_es.IconCollapse,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand,{})})})]}),expanded&&(0,jsx_runtime.jsx)("div",{className:"bg-surface-secondary border-t border-border",children:(0,jsx_runtime.jsx)("div",{className:"px-6 py-4",children:unprocessed&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mb-6",children:(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-medium text-muted-alt uppercase tracking-wider mb-1",children:"Description"}),(0,jsx_runtime.jsx)("div",{className:"text-sm  text-default",children:logItem.description})]}),logItem.extendedDescription&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-medium text-muted-alt uppercase tracking-wider mb-1",children:"Extended Description"}),(0,jsx_runtime.jsx)("div",{className:"text-sm  text-default",children:logItem.extendedDescription})]}),unprocessed.item_id&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-medium text-muted-alt uppercase tracking-wider mb-1",children:"Item ID"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-default",children:unprocessed.item_id})]})]})})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(ActivityDetailsSection,{logItem:logItem})})]})})})]})}let ActivityDetailsSection=_ref2=>{let{logItem}=_ref2,[activeTab,setActiveTab]=(0,react.useState)("diff");return(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:key=>setActiveTab(key),"data-attr":"audit-log-details-tabs",tabs:[!!logItem.extendedDescription&&{key:"extended description",label:"Extended Description",tooltip:"Some activities have a more detailed description that is not shown when collapsed.",content:(0,jsx_runtime.jsx)("div",{children:logItem.extendedDescription?logItem.extendedDescription:"This item has no extended description"})},{key:"diff",label:"Diff",tooltip:"Show the diff of the changes made to the item. Each activity item could have more than one change.",content:(0,jsx_runtime.jsx)(ActivityLogDiff,{logItem:logItem})},{key:"raw",label:"Raw",tooltip:"Show the raw data of the activity item.",content:(0,jsx_runtime.jsx)("div",{className:"bg-surface-primary p-2 rounded border border-border text-sm",children:(0,jsx_runtime.jsx)("pre",{children:JSON.stringify(logItem.unprocessed,null,2)})})}]})},ActivityLogDiff=_ref3=>{let{logItem}=_ref3,changes=logItem.unprocessed?.detail.changes;return(0,jsx_runtime.jsx)("div",{className:"flex flex-col space-y-2 px-2 py-1",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col space-y-2",children:changes?.length?changes.map((change,i)=>(0,jsx_runtime.jsx)(JsonDiffViewer,{field:change.field||"",before:change.before,after:change.after},i)):(0,jsx_runtime.jsx)("div",{className:"text-muted",children:"This item has no changes to compare"})})})},JsonDiffViewer=_ref4=>{let{field,before,after}=_ref4,beforeStr=JSON.stringify(before,null,2),afterStr=JSON.stringify(after,null,2);return beforeStr===afterStr?(0,jsx_runtime.jsxs)("div",{className:"border rounded p-2 bg-surface-primary",children:[(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm mb-1",children:field}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs",children:"No changes detected"})]}):(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary",children:[(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm p-2",children:field}),(0,jsx_runtime.jsx)("div",{className:"h-40",children:(0,jsx_runtime.jsx)(MonacoDiffEditor.Z,{original:beforeStr,value:afterStr,modified:afterStr,language:"json",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,renderSideBySide:!0}})})]})};var advancedActivityLogsLogic=__webpack_require__("../../frontend/src/scenes/audit-logs/advancedActivityLogsLogic.tsx");function AdvancedActivityLogsList(){let{advancedActivityLogs,advancedActivityLogsLoading,pagination}=(0,index_esm.useValues)(advancedActivityLogsLogic.o),humanizedLogs=advancedActivityLogs?.results?(0,humanizeActivity.OI)(advancedActivityLogs.results,activityLogLogic.L_):[],paginationState=(0,PaginationControl.h)(humanizedLogs,pagination);return advancedActivityLogsLoading?(0,jsx_runtime.jsx)(AdvancedActivityLogsListSkeleton,{}):humanizedLogs.length?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"border border-border rounded-md bg-bg-light overflow-hidden",children:[(0,jsx_runtime.jsx)(AuditLogTableHeader,{}),(0,jsx_runtime.jsx)("div",{className:"divide-y divide-border",children:humanizedLogs.map((logItem,index)=>(0,jsx_runtime.jsx)(AuditLogTableRow,{logItem:logItem},index))})]}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center mt-6",children:(0,jsx_runtime.jsx)(PaginationControl.R,{...paginationState,"data-attr":"audit-logs-pagination"})})]}):(0,jsx_runtime.jsx)(AdvancedActivityLogsEmptyState,{})}let AdvancedActivityLogsListSkeleton=()=>(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{})]}),AdvancedActivityLogsEmptyState=()=>(0,jsx_runtime.jsxs)("div",{className:"text-center py-12",children:[(0,jsx_runtime.jsx)("div",{className:"text-muted text-lg mb-2",children:"No activity logs found"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted",children:"Try adjusting your filters or date range to see more results."})]})},"../../frontend/src/scenes/audit-logs/AdvancedActivityLogsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AdvancedActivityLogsScene:()=>AdvancedActivityLogsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let AdvancedFiltersTab=()=>(0,jsx_runtime.jsx)("div",{className:"pt-4",children:(0,jsx_runtime.jsxs)("div",{className:"text-center py-8 text-muted",children:[(0,jsx_runtime.jsx)("p",{children:"Advanced filters coming soon."}),(0,jsx_runtime.jsx)("p",{className:"text-xs",children:"Dynamic filtering by activity detail fields - placeholder."})]})});var humanizeActivity=__webpack_require__("../../frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),advancedActivityLogsLogic=__webpack_require__("../../frontend/src/scenes/audit-logs/advancedActivityLogsLogic.tsx");let BasicFiltersTab=()=>{let{filters,availableFilters}=(0,index_esm.useValues)(advancedActivityLogsLogic.o),{setFilters}=(0,index_esm.useActions)(advancedActivityLogsLogic.o);return(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pt-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Date Range"}),(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:filters.start_date,dateTo:filters.end_date,onChange:(start_date,end_date)=>{setFilters({start_date:start_date,end_date:end_date})},placeholder:"All time","data-attr":"audit-logs-date-filter"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"User"}),(0,jsx_runtime.jsx)(src.Yv,{value:filters.users[0]||null,onChange:user=>setFilters({users:user?[user]:[]}),options:availableFilters?.static_filters?.users?.map(u=>({label:u.label,value:u.value}))||[],placeholder:"All users",allowClear:!0,"data-attr":"audit-logs-user-filter"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Scope"}),(0,jsx_runtime.jsx)(src.Yv,{value:filters.scopes[0]||null,onChange:scope=>setFilters({scopes:scope?[scope]:[]}),options:availableFilters?.static_filters?.scopes?.map(s=>({label:humanizeActivity.VI(s.value,!0),value:s.value}))||[],placeholder:"All scopes",allowClear:!0,"data-attr":"audit-logs-scope-filter"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Action"}),(0,jsx_runtime.jsx)(src.Yv,{value:filters.activities[0]||null,onChange:activity=>setFilters({activities:activity?[activity]:[]}),options:availableFilters?.static_filters?.activities?.map(a=>({label:humanizeActivity.J$(a.value),value:a.value}))||[],placeholder:"All actions",allowClear:!0,"data-attr":"audit-logs-action-filter"})]})]})};function AdvancedActivityLogFiltersPanel(){let{hasActiveFilters}=(0,index_esm.useValues)(advancedActivityLogsLogic.o),{clearAllFilters}=(0,index_esm.useActions)(advancedActivityLogsLogic.o),[activeTab,setActiveTab]=(0,react.useState)("basic");return(0,jsx_runtime.jsxs)("div",{className:"border rounded-lg p-4 bg-bg-light",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold",children:"Filters"}),(0,jsx_runtime.jsx)("div",{className:"flex gap-2",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",disabledReason:hasActiveFilters?void 0:"No active filters",onClick:clearAllFilters,"data-attr":"audit-logs-clear-filters",children:"Clear all"})})]}),(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:setActiveTab,"data-attr":"audit-logs-filter-tabs",tabs:[{key:"basic",label:"Basic Filters",content:(0,jsx_runtime.jsx)(BasicFiltersTab,{})},{key:"advanced",label:"Advanced",content:(0,jsx_runtime.jsx)(AdvancedFiltersTab,{})},{key:"hogql",label:"HogQL",content:(0,jsx_runtime.jsx)(HogQLFilterTab,{})}]})]})}let HogQLFilterTab=()=>(0,jsx_runtime.jsx)("div",{className:"pt-4",children:(0,jsx_runtime.jsx)("div",{children:"HogQL filter placeholder"})});var AdvancedActivityLogsList=__webpack_require__("../../frontend/src/scenes/audit-logs/AdvancedActivityLogsList.tsx");let scene={component:AdvancedActivityLogsScene,logic:advancedActivityLogsLogic.o};function AdvancedActivityLogsScene(){let{isFeatureFlagEnabled}=(0,index_esm.useValues)(advancedActivityLogsLogic.o);return isFeatureFlagEnabled?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Track all changes and activities in your organization"}),(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(AdvancedActivityLogFiltersPanel,{}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(AdvancedActivityLogsList.d,{})]})]}):(window.location.href=urls.j.projectHomepage(),null)}},"../../frontend/src/scenes/audit-logs/advancedActivityLogsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{o:()=>advancedActivityLogsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_constants__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/constants.tsx"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils.tsx");let DEFAULT_FILTERS={start_date:null,end_date:null,users:[],scopes:[],activities:[]},advancedActivityLogsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","audit-logs","advancedActivityLogsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__.featureFlagLogic,["featureFlags"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:filters=>({filters}),clearAllFilters:!0,setPage:page=>({page}),exportLogs:format=>({format}),loadAvailableFilters:!0}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({filters:[DEFAULT_FILTERS,{setFilters:(state,_ref)=>{let{filters}=_ref;return{...state,...filters}},clearAllFilters:()=>DEFAULT_FILTERS}],currentPage:[1,{setPage:(_,_ref2)=>{let{page}=_ref2;return page},setFilters:()=>1}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref3=>{let{values}=_ref3;return{advancedActivityLogs:[{results:[],count:0},{loadAdvancedActivityLogs:async()=>{let params=new URLSearchParams;if(values.filters.start_date){let startDate=(0,lib_utils__WEBPACK_IMPORTED_MODULE_5__.FZ)(values.filters.start_date);startDate&&params.append("start_date",startDate.toISOString())}if(values.filters.end_date){let endDate=(0,lib_utils__WEBPACK_IMPORTED_MODULE_5__.FZ)(values.filters.end_date);endDate&&params.append("end_date",endDate.toISOString())}return values.filters.users.forEach(user=>params.append("users",user)),values.filters.scopes.forEach(scope=>params.append("scopes",scope)),values.filters.activities.forEach(activity=>params.append("activities",activity)),params.append("page",values.currentPage.toString()),params.append("page_size",lib_constants__WEBPACK_IMPORTED_MODULE_3__.Ls.toString()),await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/@current/advanced_activity_logs/?${params}`)}}],availableFilters:[null,{loadAvailableFilters:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get("api/projects/@current/advanced_activity_logs/available_filters/")}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(_ref4=>{let{actions}=_ref4;return{isFeatureFlagEnabled:[s=>[s.featureFlags],featureFlags=>!!featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_3__.y8.ADVANCED_ACTIVITY_LOGS]],hasActiveFilters:[s=>[s.filters],filters=>null!==filters.start_date||null!==filters.end_date||filters.users.length>0||filters.scopes.length>0||filters.activities.length>0],pagination:[s=>[s.currentPage,s.advancedActivityLogs],(currentPage,advancedActivityLogs)=>({controlled:!0,pageSize:lib_constants__WEBPACK_IMPORTED_MODULE_3__.Ls,currentPage,entryCount:advancedActivityLogs.count||0,onBackward:()=>actions.setPage(currentPage-1),onForward:()=>actions.setPage(currentPage+1)})]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref5=>{let{actions}=_ref5;return{setPage:()=>{actions.loadAdvancedActivityLogs()},setFilters:()=>{actions.loadAdvancedActivityLogs()},clearAllFilters:()=>{actions.loadAdvancedActivityLogs()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.events)(_ref6=>{let{actions}=_ref6;return{afterMount:()=>{actions.loadAvailableFilters(),actions.loadAdvancedActivityLogs()}}})])}}]);