"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[42957],{"../../frontend/src/scenes/coupons/Coupons.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Coupons:()=>Coupons,default:()=>coupons_Coupons,scene:()=>scene});var NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),BillingUpgradeCTA=__webpack_require__("../../frontend/src/lib/components/BillingUpgradeCTA.tsx"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),billingLogic=__webpack_require__("../../frontend/src/scenes/billing/billingLogic.tsx"),billingProductLogic=__webpack_require__("../../frontend/src/scenes/billing/billingProductLogic.ts"),paymentEntryLogic=__webpack_require__("../../frontend/src/scenes/billing/paymentEntryLogic.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),types=__webpack_require__("../../frontend/src/types.ts"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.297.0/node_modules/posthog-js/dist/module.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),organizationLogic=__webpack_require__("../../frontend/src/scenes/organizationLogic.tsx"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts");let couponLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","coupons","couponLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(()=>({values:[userLogic.userLogic,["user"],organizationLogic.organizationLogic,["currentOrganization","isAdminOrOwner"],billingLogic.billingLogic,["billing"]]})),(0,index_esm.actions)({setClaimed:claimed=>({claimed}),setClaimedDetails:details=>({details})}),(0,index_esm.reducers)({claimed:[!1,{setClaimed:(_,_ref)=>{let{claimed}=_ref;return claimed}}],claimedDetails:[null,{setClaimedDetails:(_,_ref2)=>{let{details}=_ref2;return details}}]}),(0,lib.forms)(_ref3=>{let{values,actions,props}=_ref3;return{coupon:{defaults:{code:"",organization_name:values.currentOrganization?.name||""},errors:_ref4=>{let{code}=_ref4;return values.billing?.has_active_subscription?{code:code?void 0:"Please enter a coupon code"}:{_form:"You need to be on a paid plan before claiming this coupon"}},submit:async formValues=>{try{let res=await api.ZP.create("api/billing/coupons/claim",{code:formValues.code});actions.setClaimed(!0),actions.setClaimedDetails(res),dist_module.ZP.capture("billing coupon claimed",{campaign:props.campaign,code:formValues.code})}catch(error){throw src.UJ.error(error.detail||"Failed to claim coupon"),error}}}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let BillingUpgradeCTAWrapper=_ref=>{let{platformAndSupportProduct}=_ref,{billing}=(0,index_esm.useValues)(billingLogic.billingLogic),{startPaymentEntryFlow}=(0,index_esm.useActions)(paymentEntryLogic.j),{billingProductLoading}=(0,index_esm.useValues)((0,billingProductLogic.cD)({product:platformAndSupportProduct}));return(0,jsx_runtime.jsx)(BillingUpgradeCTA.y,{type:"primary",disableClientSideRouting:!0,loading:!!billingProductLoading,onClick:()=>startPaymentEntryFlow(platformAndSupportProduct,window.location.pathname),children:billing?.customer_id?"Subscribe":"Add billing details"})};function CouponRedemption(_ref2){let{campaign,config,requiresBilling=!0}=_ref2,logic=couponLogic({campaign}),{claimed,claimedDetails,isAdminOrOwner}=(0,index_esm.useValues)(logic),{billing,billingLoading}=(0,index_esm.useValues)(billingLogic.billingLogic),platformAndSupportProduct=billing?.products?.find(product=>product.type===types.Md.PLATFORM_AND_SUPPORT);return isAdminOrOwner?(0,jsx_runtime.jsxs)("div",{className:"mx-auto max-w-[1200px]",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center mb-8 mt-8",children:[config.HeroImage&&(0,jsx_runtime.jsx)(config.HeroImage,{className:"h-auto w-full max-w-100 mb-4"}),(0,jsx_runtime.jsxs)("div",{className:"text-center",children:[(0,jsx_runtime.jsx)("h2",{className:"text-2xl sm:text-3xl font-bold mb-2",children:config.heroTitle}),(0,jsx_runtime.jsx)("h3",{className:"text-base sm:text-lg text-muted",children:config.heroSubtitle})]})]}),(0,jsx_runtime.jsxs)("div",{className:"grid md:grid-cols-2 gap-8 mb-8",children:[(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsxs)("div",{className:"bg-surface-secondary rounded-lg p-6",children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl mb-4",children:"What you'll get"}),(0,jsx_runtime.jsx)("div",{className:"space-y-3",children:config.benefits.map((benefit,index)=>(0,jsx_runtime.jsxs)("div",{className:"flex items-start",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{className:"text-success shrink-0 mt-1 mr-2"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold",children:benefit.title}),(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm",children:benefit.description})]})]},index))}),config.footerNote&&(0,jsx_runtime.jsx)("div",{className:"mt-6 text-sm text-muted",children:config.footerNote})]}),config.eligibilityCriteria&&config.eligibilityCriteria.length>0&&(0,jsx_runtime.jsxs)("div",{className:"bg-surface-secondary rounded-lg p-6",children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl mb-4",children:"Eligibility"}),(0,jsx_runtime.jsx)("ul",{className:"space-y-2",children:config.eligibilityCriteria.map((criterion,index)=>(0,jsx_runtime.jsxs)("li",{className:"flex items-start",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowRight,{className:"text-muted shrink-0 mt-1 mr-2"}),(0,jsx_runtime.jsx)("span",{className:"text-sm",children:criterion})]},index))})]})]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[requiresBilling&&(0,jsx_runtime.jsxs)("div",{className:"bg-surface-secondary rounded-lg p-6",children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl mb-4",children:"Step 1: Add billing details"}),billingLoading?(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.$j,{className:"text-lg"}),(0,jsx_runtime.jsx)("span",{children:"Checking if you're on a paid plan"})]}):billing?.has_active_subscription?(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-success",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{className:"shrink-0"}),(0,jsx_runtime.jsx)("span",{children:"You're on a paid plan"})]}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-start gap-2",children:[(0,jsx_runtime.jsx)("p",{className:"text-muted mb-2",children:"To claim this coupon, you need to be on a paid plan."}),(0,jsx_runtime.jsx)("p",{className:"text-muted mb-2",children:"Don't worry - you'll only pay for what you use and can set billing limits as low as $0 to control your spend."}),(0,jsx_runtime.jsx)("p",{className:"text-muted mb-2 italic",children:"P.S. You still keep the monthly free allowance for every product!"}),platformAndSupportProduct&&(0,jsx_runtime.jsx)(BillingUpgradeCTAWrapper,{platformAndSupportProduct:platformAndSupportProduct})]})]}),(0,jsx_runtime.jsxs)("div",{className:"bg-surface-secondary rounded-lg p-6",children:[(0,jsx_runtime.jsxs)("h2",{className:"text-xl mb-4",children:[requiresBilling?"Step 2: ":"","Redeem your coupon"]}),claimed?(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-success",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{className:"shrink-0"}),(0,jsx_runtime.jsx)("span",{children:"Coupon redeemed successfully!"})]}),(0,jsx_runtime.jsxs)("p",{className:"text-muted",children:["Your organization now has access to ",config.name," benefits.",claimedDetails?.expires_at&&` Valid until ${new Date(claimedDetails.expires_at).toLocaleDateString()}.`]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"primary",to:urls.j.organizationBilling(),disableClientSideRouting:!0,children:"View in billing"}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",to:urls.j.projectHomepage(),disableClientSideRouting:!0,children:"Return to PostHog"})]})]}):(0,jsx_runtime.jsxs)(lib.Form,{logic:couponLogic,formKey:"coupon",enableFormOnSubmit:!0,className:"space-y-3",props:{campaign},children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"organization_name",label:"PostHog organization",info:"To claim for a different organization, switch to that organization first",children:(0,jsx_runtime.jsx)(src.DF,{disabled:!0})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"code",label:"Coupon code",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"XXX-XXXXXXXXXXX"})}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",htmlType:"submit",className:"mt-4",children:"Redeem coupon"}),(0,jsx_runtime.jsx)(LemonField.D,{name:"_form",children:(0,jsx_runtime.jsx)("span",{})})]})]})]})]})]}):(0,jsx_runtime.jsx)("div",{className:"mx-auto max-w-200 mt-6 px-4",children:(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"warning",children:[(0,jsx_runtime.jsx)("h2",{className:"mb-2",children:"Admin or owner permission required"}),(0,jsx_runtime.jsx)("p",{children:"You need to be an organization admin or owner to claim coupons. Please contact your organization admin for assistance."}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",to:urls.j.projectHomepage(),className:"mt-2",children:"Return to PostHog"})]})})}var Logo=__webpack_require__("../../frontend/src/lib/brand/Logo.tsx");let campaignConfigs={lenny:{name:"Lenny's Newsletter",heroTitle:"Get FREE PostHog Scale for 12 months (worth $9,000)",heroSubtitle:"We like Lenny's Newsletter so much we made this exclusive off for annual subscribers",HeroImage:()=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4",children:[(0,jsx_runtime.jsx)(Logo.T,{style:{height:"3rem"}}),(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{className:"size-8 opacity-60"}),(0,jsx_runtime.jsx)("img",{src:"https://res.cloudinary.com/dmukukwp6/image/upload/q_auto,f_auto/lenny_logo_4f52d3bb15.webp",alt:"Lenny's Newsletter",className:"h-12 w-12 rounded-lg"}),(0,jsx_runtime.jsx)("img",{src:"https://res.cloudinary.com/dmukukwp6/image/upload/q_auto,f_auto/lenny_ca568a9fda.png",alt:"Lenny's Newsletter",className:"h-6"})]}),benefits:[{title:"Priority support",description:"Get help from our team. You'll speak to an actual engineer too!"},{title:"SAML, SSO & advanced permissions",description:"Fine-grained access control, SSO enforcement, and 2FA requirements"},{title:"Audit logs",description:"2 months of retention so you can track changes in your organization"},{title:"Extended session replay retention",description:"Keep your session replay data for 12 months instead of the standard 3"},{title:"Managed reverse proxy",description:"Up to 2 proxies to improve data collection and bypass ad blockers"}],eligibilityCriteria:["Active Lenny's Newsletter annual subscriber","PostHog organization created after December 2, 2025","Active paid subscription to PostHog"],footerNote:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["... and"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/platform-packages",target:"_blank",children:"many more"}),"! All features are available for 12 months from the date you redeem your coupon."]})}},scene={component:Coupons,paramsToProps:_ref=>{let{params:{campaign}}=_ref;return{campaign:campaign||void 0}}};function Coupons(_ref2){let{campaign}=_ref2;if(!campaign)return(0,jsx_runtime.jsx)(NotFound.T,{object:"coupon campaign"});let config=campaignConfigs[campaign];return config?(0,jsx_runtime.jsx)(CouponRedemption,{campaign:campaign,config:config}):(0,jsx_runtime.jsx)(NotFound.T,{object:"coupon campaign",caption:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:['The campaign "',campaign,'" does not exist or is not available.',(0,jsx_runtime.jsx)("br",{}),"Please check the URL and try again."]})})}let coupons_Coupons=Coupons}}]);