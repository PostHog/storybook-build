(window.webpackJsonp=window.webpackJsonp||[]).push([[7,10],{"./frontend/src/scenes/apps/ErrorDetailsModal.tsx":function(q,g,e){"use strict";e.r(g),e.d(g,"ErrorDetailsModal",function(){return $});var S=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),U=e.n(S),I=e("./node_modules/react/index.js"),L=e.n(I),B=e("./node_modules/kea/lib/index.esm.js"),u=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),R=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),H=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),W=e("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),K=e("./frontend/src/lib/components/LemonButton/index.ts"),P=e("./frontend/src/lib/components/icons.tsx"),J=e("./frontend/src/lib/components/LemonModal/index.ts"),v=e("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),s=e("./node_modules/react/jsx-runtime.js"),N=e.n(s);function $(){var O,M,D=Object(B.useValues)(u.appMetricsSceneLogic),E=D.errorDetails,T=D.errorDetailsModalError,A=D.errorDetailsLoading,G=Object(B.useActions)(u.appMetricsSceneLogic),m=G.closeErrorDetailsModal,y=Object(I.useState)(0),F=U()(y,2),f=F[0],b=F[1],c=E[f];return Object(s.jsx)(J.a,{isOpen:!!T,onClose:m,title:T,width:"min(50vw, 80rem)",description:Object(s.jsx)("span",{children:c==null||(O=c.error_details)===null||O===void 0||(M=O.error.message)===null||M===void 0?void 0:M.substring(0,200)}),footer:Object(s.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:A?Object(s.jsx)(R.a,{className:"1-10"}):Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("span",{children:[f+1," of ",E.length," sample",E.length>1?"s":""]}),Object(s.jsx)(K.a,{icon:Object(s.jsx)(P.IconChevronLeft,{}),onClick:function(){return b(f-1)},disabled:f==0}),Object(s.jsx)(K.a,{icon:Object(s.jsx)(P.IconChevronRight,{}),onClick:function(){return b(f+1)},disabled:f==E.length-1})]})}),children:!T||A?Object(s.jsx)(R.a,{className:"h-10"}):Object(s.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[Object(s.jsxs)("div",{children:[Object(s.jsx)(W.a,{children:"When:"})," ",Object(s.jsx)(H.b,{time:c.timestamp,showSeconds:!0})]}),c.error_details.eventCount&&Object(s.jsxs)("div",{children:[Object(s.jsx)(W.a,{children:"Event Count"}),Object(s.jsx)("div",{children:c.error_details.eventCount})]}),c.error_details.error.message&&Object(s.jsx)(h,{title:"Error message",defaultIsExpanded:!0,children:Object(s.jsx)(v.a,{wrap:!0,language:v.b.JavaScript,children:c.error_details.error.message})}),c.error_details.event&&Object(s.jsx)(h,{title:"Event payload",defaultIsExpanded:!1,children:Object(s.jsx)(v.a,{wrap:!0,language:v.b.JSON,children:JSON.stringify(c.error_details.event,null,2)})}),c.error_details.error.stack&&Object(s.jsx)(h,{title:"Stack trace",defaultIsExpanded:!1,children:Object(s.jsx)(v.a,{wrap:!0,language:v.b.JavaScript,children:c.error_details.error.stack})})]})})}function h(O){var M=Object(I.useState)(O.defaultIsExpanded),D=U()(M,2),E=D[0],T=D[1];return Object(s.jsxs)("div",{className:"bg-mid border rounded",children:[Object(s.jsx)(K.a,{status:"stealth",fullWidth:!0,onClick:function(){return T(!E)},sideIcon:E?Object(s.jsx)(P.IconUnfoldLess,{}):Object(s.jsx)(P.IconUnfoldMore,{}),title:E?"Show less":"Show more",className:"bg-mid",children:O.title}),E&&Object(s.jsx)("div",{className:"bg-light p-2",children:O.children})]})}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(q,g,e){"use strict";e.r(g),e.d(g,"AppMetricsTab",function(){return _}),e.d(g,"appMetricsSceneLogic",function(){return re});var S=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),U=e.n(S),I=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),L=e.n(I),B=e("./node_modules/@babel/runtime/regenerator/index.js"),u=e.n(B),R=e("./node_modules/core-js/modules/es.array.iterator.js"),H=e.n(R),W=e("./node_modules/core-js/modules/es.object.to-string.js"),K=e.n(W),P=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),J=e.n(P),v=e("./node_modules/core-js/modules/es.array.concat.js"),s=e.n(v),N=e("./node_modules/core-js/modules/es.function.name.js"),$=e.n(N),h=e("./node_modules/core-js/modules/es.array.includes.js"),O=e.n(h),M=e("./node_modules/core-js/modules/es.string.includes.js"),D=e.n(M),E=e("./node_modules/core-js/modules/es.array.filter.js"),T=e.n(E),A=e("./node_modules/core-js/modules/es.number.constructor.js"),G=e.n(A),m=e("./node_modules/kea/lib/index.esm.js"),y=e("./node_modules/kea-loaders/lib/index.js"),F=e.n(y),f=e("./frontend/src/scenes/urls.ts"),b=e("./frontend/src/lib/api.ts"),c=e("./frontend/src/scenes/teamLogic.tsx"),x=e("./node_modules/kea-router/lib/index.js"),te=e.n(x),z=e("./frontend/src/lib/utils.tsx"),V=e("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),ee=e("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),_;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.ScheduledTask="scheduledTask",t.HistoricalExports="historical_exports"})(_||(_={}));var Q="-30d",X=[_.ProcessEvent,_.OnEvent,_.ExportEvents,_.ScheduledTask],re=Object(m.kea)([Object(m.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(m.props)({}),Object(m.key)(function(t){return t.pluginConfigId}),Object(m.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}},openErrorDetailsModal:function(o,n,r){return{errorType:o,category:n,jobId:r}},closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),Object(m.reducers)({activeTab:[null,{setActiveTab:function(o,n){var r=n.tab;return r}}],dateFrom:[Q,{setDateFrom:function(o,n){var r=n.dateFrom;return r}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(o,n){var r=n.errorType;return r},closeErrorDetailsModal:function(){return null}}]}),Object(y.loaders)(function(t){var o=t.values,n=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var r=L()(u.a.mark(function a(){return u.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,b.b.get("api/projects/".concat(c.a.values.currentTeamId,"/plugin_configs/").concat(n.pluginConfigId));case 2:return d.abrupt("return",d.sent);case 3:case"end":return d.stop()}},a)}));function l(){return r.apply(this,arguments)}return l}()}],appMetricsResponse:[null,{loadMetrics:function(){var r=L()(u.a.mark(function a(){var i;return u.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return i=Object(z.Eb)({category:o.activeTab,date_from:o.dateFrom}),j.next=3,b.b.get("api/projects/".concat(c.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"?").concat(i));case 3:return j.abrupt("return",j.sent);case 4:case"end":return j.stop()}},a)}));function l(){return r.apply(this,arguments)}return l}()}],historicalExports:[[],{loadHistoricalExports:function(){var r=L()(u.a.mark(function a(){var i,d;return u.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,b.b.get("api/projects/".concat(c.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/historical_exports"));case 2:return i=p.sent,d=i.results,p.abrupt("return",d);case 5:case"end":return p.stop()}},a)}));function l(){return r.apply(this,arguments)}return l}()}],errorDetails:[[],{openErrorDetailsModal:function(){var r=L()(u.a.mark(function a(i){var d,j,p,Z,k,w;return u.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return d=i.category,j=i.jobId,p=i.errorType,Z=Object(z.Eb)({category:d,job_id:j,error_type:p}),C.next=4,b.b.get("api/projects/".concat(c.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/error_details?").concat(Z));case 4:return k=C.sent,w=k.result,C.abrupt("return",w);case 7:case"end":return C.stop()}},a)}));function l(a){return r.apply(this,arguments)}return l}()}]}}),Object(m.selectors)(function(t){var o=t.values,n=t.actions;return{breadcrumbs:[function(r){return[r.pluginConfig,function(l,a){return a.pluginConfigId}]},function(r,l){var a;return[{name:"Apps",path:f.a.projectApps()},{name:r==null||(a=r.plugin_info)===null||a===void 0?void 0:a.name,path:f.a.appMetrics(l)}]}],showTab:[function(){return[]},function(){return function(r){if(o.pluginConfigLoading||!o.pluginConfig||!o.pluginConfig.plugin_info.capabilities)return!1;var l=o.pluginConfig.plugin_info.capabilities,a=l.methods.includes("exportEvents");return r===_.HistoricalExports?a:r===_.OnEvent&&a?!1:r===_.ScheduledTask?!a&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(i){return l.scheduled_tasks.includes(i)}):l.methods.includes(r)}}],interfaceJobsProps:[function(r){return[r.pluginConfig]},function(r){return!r||!r.plugin_info.public_jobs||!(r!=null&&r.enabled)?null:{jobName:V.b,jobSpec:r.plugin_info.public_jobs[V.b],pluginConfigId:r.id,pluginId:r.plugin,onSubmit:n.loadHistoricalExports}}]}}),Object(m.listeners)(function(t){var o=t.values,n=t.actions;return{loadPluginConfigSuccess:function(){if(!o.activeTab){var l=X.filter(function(d){return o.showTab(d)}),a=U()(l,1),i=a[0];n.setActiveTab(i)}},setActiveTab:function(l){var a=l.tab;a===_.HistoricalExports?n.loadHistoricalExports():n.loadMetrics()},setDateFrom:function(){n.loadMetrics()},openHistoricalExportModal:function(){o.interfaceJobsProps&&Object(ee.a)(o.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}}),Object(x.actionToUrl)(function(t){var o=t.values,n=t.props;return{setActiveTab:function(){return Y(o,n)},setDateFrom:function(){return Y(o,n)}}}),Object(x.urlToAction)(function(t){var o=t.values,n=t.actions,r=t.props;return{"/app/:pluginConfigId/:page":function(a,i){r.pluginConfigId===Number(a.pluginConfigId)&&(o.pluginConfig||n.loadPluginConfig(),a.page===_.HistoricalExports?n.setActiveTab(_.HistoricalExports):(i.tab&&X.includes(i.tab)&&n.setActiveTab(i.tab),i.from&&n.setDateFrom(i.from)))}}})]);function Y(t,o){if(t.activeTab===_.HistoricalExports)return f.a.appHistoricalExports(o.pluginConfigId);var n={};return t.activeTab&&(n.tab=t.activeTab),t.dateFrom!==Q&&(n.from=t.dateFrom),f.a.appMetrics(o.pluginConfigId,n)}}}]);
