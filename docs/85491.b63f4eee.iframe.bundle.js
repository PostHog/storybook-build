"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[85491],{"../../frontend/src/lib/components/Cards/InsightCard/QueryCard.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>QueryCard});var clsx__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib_components_Cards_CardMeta__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/components/Cards/CardMeta.tsx"),lib_lemon_ui_LemonMenu_LemonMenu__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/LemonMenu.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_ErrorBoundary__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/layout/ErrorBoundary/index.ts"),_layout_navigation_3000_themeLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),_queries_Query_Query__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),_InsightDetails__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/InsightDetails.tsx"),_InsightMeta__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/InsightMeta.tsx"),_TopHeading__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/TopHeading.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let QueryCard=react__WEBPACK_IMPORTED_MODULE_1__.forwardRef(function QueryCard(_ref,ref){let{query,title,description,context,highlighted,ribbonColor,className,sceneSource,attachTo,...divProps}=_ref,{theme}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_layout_navigation_3000_themeLogic__WEBPACK_IMPORTED_MODULE_6__.b),[areDetailsShown,setAreDetailsShown]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:(0,clsx__WEBPACK_IMPORTED_MODULE_12__.default)("InsightCard border",highlighted&&"InsightCard--highlighted",className),"data-attr":"insight-card",...divProps,style:{...divProps?.style,...theme?.boxStyle},ref:ref,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(_layout_ErrorBoundary__WEBPACK_IMPORTED_MODULE_5__.S,{exceptionProps:{feature:"insight"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_components_Cards_CardMeta__WEBPACK_IMPORTED_MODULE_2__.I,{ribbonColor:ribbonColor,setAreDetailsShown:setAreDetailsShown,areDetailsShown:areDetailsShown,topHeading:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_TopHeading__WEBPACK_IMPORTED_MODULE_10__.l,{query:query}),content:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_InsightMeta__WEBPACK_IMPORTED_MODULE_9__.Q,{title:title,description:description}),metaDetails:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_InsightDetails__WEBPACK_IMPORTED_MODULE_8__.Mz,{query:query}),samplingFactor:"samplingFactor"in query&&"number"==typeof query.samplingFactor?query.samplingFactor:void 0,moreButtons:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonMenu_LemonMenu__WEBPACK_IMPORTED_MODULE_3__.tN,{items:[{label:"Open as new insight",to:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.insightNew({query,sceneSource})}]}),showEditingControls:!0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"InsightCard__viz",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_queries_Query_Query__WEBPACK_IMPORTED_MODULE_7__.A,{attachTo:attachTo,query:query,readOnly:!0,embedded:!0,context:context})})]})})})},"../../frontend/src/scenes/groups/Group.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Group:()=>Group,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),PropertiesTable=__webpack_require__("../../frontend/src/lib/components/PropertiesTable/index.ts"),utils=__webpack_require__("../../frontend/src/lib/components/UniversalFilters/utils.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),groupLogic=__webpack_require__("../../frontend/src/scenes/groups/groupLogic.ts"),NotebookSelectButton=__webpack_require__("../../frontend/src/scenes/notebooks/NotebookSelectButton/NotebookSelectButton.tsx"),types=__webpack_require__("../../frontend/src/scenes/notebooks/types.ts"),GroupActorDisplay=__webpack_require__("../../frontend/src/scenes/persons/GroupActorDisplay.tsx"),RelatedFeatureFlags=__webpack_require__("../../frontend/src/scenes/persons/RelatedFeatureFlags.tsx"),SessionRecordingsPlaylist=__webpack_require__("../../frontend/src/scenes/session-recordings/playlist/SessionRecordingsPlaylist.tsx"),session_recordings_utils=__webpack_require__("../../frontend/src/scenes/session-recordings/utils.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),groupsModel=__webpack_require__("../../frontend/src/models/groupsModel.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),src_types=__webpack_require__("../../frontend/src/types.ts"),Notebook=__webpack_require__("../../frontend/src/scenes/notebooks/Notebook/Notebook.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let GroupFeedCanvas_GroupFeedCanvas=_ref=>{let{group}=_ref,groupKey=group.group_key;return(0,jsx_runtime.jsx)(Notebook.a,{editable:!1,shortId:`canvas-${groupKey}`,mode:"canvas",initialContent:{type:"doc",content:[{type:"ph-usage-metrics",attrs:{groupKey,groupTypeIndex:group.group_type_index,nodeId:(0,lib_utils.Vj)(),children:[{type:"ph-group",attrs:{id:groupKey,groupTypeIndex:group.group_type_index,nodeId:(0,lib_utils.Vj)(),title:"Info"}},{type:"ph-group-properties",attrs:{groupKey,groupTypeIndex:group.group_type_index,nodeId:(0,lib_utils.Vj)()}},{type:"ph-related-groups",attrs:{id:groupKey,groupTypeIndex:group.group_type_index,nodeId:(0,lib_utils.Vj)(),title:"Related people",type:"person"}}]}}]}})};var react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),QueryCard=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/QueryCard.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),eventUsageLogic=__webpack_require__("../../frontend/src/lib/utils/eventUsageLogic.ts"),Dashboard=__webpack_require__("../../frontend/src/scenes/dashboard/Dashboard.tsx"),dashboardLogic=__webpack_require__("../../frontend/src/scenes/dashboard/dashboardLogic.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts");function GroupDetailDashboard(_ref){let{groupTypeDetailDashboard,groupData}=_ref,{groupTypeName}=(0,index_esm.useValues)(groupLogic.x),{setProperties,setLoadLayoutFromServerOnPreview}=(0,index_esm.useActions)((0,dashboardLogic.BM)({id:groupTypeDetailDashboard}));return(0,react.useEffect)(()=>{groupTypeDetailDashboard&&groupData&&(setLoadLayoutFromServerOnPreview(!0),setProperties([{type:src_types.FT.EventMetadata,key:`$group_${groupData.group_type_index}`,label:groupTypeName,value:groupData.group_key,operator:src_types.WV.Exact}]))},[groupTypeDetailDashboard,groupData,groupTypeName,setProperties,setLoadLayoutFromServerOnPreview]),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-0",children:[(0,jsx_runtime.jsx)("h2",{children:"Insights"}),(0,jsx_runtime.jsx)(Dashboard.Dashboard,{id:groupTypeDetailDashboard.toString(),placement:src_types.F4.Group})]})}function GroupDashboardCard(){let{groupData,groupTypeDetailDashboard,groupTypeName}=(0,index_esm.useValues)(groupLogic.x),{createDetailDashboard}=(0,index_esm.useActions)(groupLogic.x),{reportGroupTypeDetailDashboardCreated}=(0,index_esm.useActions)(eventUsageLogic.vx),[creatingDetailDashboard,setCreatingDetailDashboard]=(0,react.useState)(!1);return groupData?groupTypeDetailDashboard?(0,jsx_runtime.jsx)(GroupDetailDashboard,{groupTypeDetailDashboard:groupTypeDetailDashboard,groupData:groupData}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,jsx_runtime.jsx)("h2",{children:"Insights"}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",disabled:creatingDetailDashboard,onClick:()=>{setCreatingDetailDashboard(!0),reportGroupTypeDetailDashboardCreated(),createDetailDashboard(groupData.group_type_index)},children:"Customize"})]}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,jsx_runtime.jsx)(QueryCard.w,{title:"Top paths",description:`Shows the most popular pages viewed by this ${groupTypeName} in the last 30 days`,query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[{kind:schema_general.OH.EventsNode,event:"$pageview",name:"$pageview",properties:[{key:"$pathname",value:["/"],operator:"is_not",type:"event"},{key:`$group_${groupData.group_type_index}`,value:groupData.group_key,operator:src_types.WV.Exact}],math:"unique_session"}],trendsFilter:{display:"ActionsBarValue"},breakdownFilter:{breakdowns:[{property:"$pathname",type:"event",normalize_url:!0}]},dateRange:{date_from:"-30d",date_to:null,explicitDate:!1},interval:"day"},full:!0},context:{refresh:"force_blocking"}}),(0,jsx_runtime.jsx)(QueryCard.w,{title:"Top events",description:`Shows the most popular events by this ${groupTypeName} in the last 30 days`,query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[{kind:schema_general.OH.EventsNode,event:null,name:"All events",properties:[{key:`$group_${groupData.group_type_index}`,value:groupData.group_key,operator:src_types.WV.Exact}],math:"total"}],trendsFilter:{display:"ActionsBarValue"},breakdownFilter:{breakdowns:[{property:"event",type:"event_metadata"}]},dateRange:{date_from:"-30d",date_to:null,explicitDate:!1},interval:"day"},full:!0},context:{refresh:"force_blocking"}}),(0,jsx_runtime.jsx)(QueryCard.w,{title:"Weekly active users",description:`Shows the number of unique users from this ${groupTypeName} in the last 90 days`,query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,interval:"week",dateRange:{date_from:"-90d"},series:[{kind:schema_general.OH.EventsNode,math:"dau",event:null,properties:[{key:`$group_${groupData.group_type_index}`,value:groupData.group_key,operator:src_types.WV.Exact}]}]}},context:{refresh:"force_blocking"}}),(0,jsx_runtime.jsx)(QueryCard.w,{title:"Monthly active users",description:`Shows the number of unique users from this ${groupTypeName} in the last year`,query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,interval:"month",dateRange:{date_from:"-365d"},series:[{kind:schema_general.OH.EventsNode,math:"dau",event:null,properties:[{key:`$group_${groupData.group_type_index}`,value:groupData.group_key,operator:src_types.WV.Exact}]}]}},context:{refresh:"force_blocking"}})]}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-1 gap-2",children:(0,jsx_runtime.jsx)(QueryCard.w,{title:"Retained users",description:`Shows the number of users from this ${groupTypeName} who returned 12 weeks after their first visit`,query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.RetentionQuery,retentionFilter:{period:"Week",targetEntity:{id:"$pageview",name:"$pageview",type:"events"},retentionType:"retention_first_time",totalIntervals:12,returningEntity:{id:"$pageview",name:"$pageview",type:"events"},meanRetentionCalculation:"simple"},properties:{type:"AND",values:[{type:"AND",values:[{type:"hogql",key:`$group_${groupData.group_type_index}='${groupData.group_key}'`,value:null}]}]}},full:!0},context:{refresh:"force_blocking"}})})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}var RelatedGroups=__webpack_require__("../../frontend/src/scenes/groups/RelatedGroups.tsx");function GroupPeopleCard(_ref){let{groupData}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(RelatedGroups.S,{groupTypeIndex:groupData.group_type_index,id:groupData.group_key,type:"person",pageSize:5}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",to:urls.j.group(groupData.group_type_index,groupData.group_key,!0,"related"),children:"View people"})})]})}function GroupPropertiesCard(_ref){let{groupData}=_ref,{editProperty}=(0,index_esm.useActions)(groupLogic.x),propertySummary=(0,react.useMemo)(()=>Object.fromEntries(Object.entries(groupData.group_properties||{}).filter(_ref2=>{let[_,value]=_ref2;return"object"!=typeof value||null===value}).slice(0,5)),[groupData.group_properties]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(PropertiesTable.V,{type:src_types.ll.Group,properties:propertySummary||{},onEdit:editProperty,embedded:!1}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",to:urls.j.group(groupData.group_type_index,groupData.group_key,!0,"properties"),children:"View properties"})})]})}function GroupOverview(_ref){let{groupData}=_ref,{groupTypeName}=(0,index_esm.useValues)(groupLogic.x);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"col-span-1",children:[(0,jsx_runtime.jsxs)("h2",{children:[(0,lib_utils.fm)(groupTypeName)," properties"]}),(0,jsx_runtime.jsx)(GroupPropertiesCard,{groupData:groupData})]}),(0,jsx_runtime.jsxs)("div",{className:"col-span-1",children:[(0,jsx_runtime.jsx)("h2",{children:"Related people"}),(0,jsx_runtime.jsx)(GroupPeopleCard,{groupData:groupData})]})]}),(0,jsx_runtime.jsx)(GroupDashboardCard,{})]})}function GroupNotebookCard(_ref){let{shortId}=_ref;return(0,jsx_runtime.jsx)("div",{className:"flex-1 bg-white rounded-lg px-4",children:(0,jsx_runtime.jsx)(Notebook.a,{shortId:shortId,editable:!0,initialAutofocus:"end"})})}var GroupCaption=__webpack_require__("../../frontend/src/scenes/groups/components/GroupCaption.tsx");let scene={component:Group,logic:groupLogic.x,paramsToProps:_ref=>{let{params:{groupTypeIndex,groupKey}}=_ref;return{groupTypeIndex:parseInt(null!=groupTypeIndex?groupTypeIndex:"0"),groupKey:decodeURIComponent(null!=groupKey?groupKey:"")}}};function Group(){let{logicProps,groupData,groupDataLoading,groupTypeName,groupType,groupTab,groupEventsQuery}=(0,index_esm.useValues)(groupLogic.x),{groupKey,groupTypeIndex}=logicProps,{setGroupEventsQuery,editProperty,deleteProperty}=(0,index_esm.useActions)(groupLogic.x),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{aggregationLabel}=(0,index_esm.useValues)(groupsModel.$);if(!groupData||!groupType)return groupDataLoading?(0,jsx_runtime.jsx)(Spinner.t,{sceneLevel:!0}):(0,jsx_runtime.jsx)(NotFound.T,{object:"group"});let settingLevel=featureFlags[constants.y8.ENVIRONMENTS]?"environment":"project",activeTab=null!=groupTab?groupTab:featureFlags[constants.y8.CUSTOMER_ANALYTICS]?"feed":"overview";return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:(0,GroupActorDisplay.O)(groupData.group_key,groupData.group_properties),resourceType:{type:"group"},forceBackTo:{name:(0,lib_utils.fm)(aggregationLabel(groupTypeIndex).plural),key:"groups",path:urls.j.groups(groupTypeIndex)},actions:(0,jsx_runtime.jsx)(NotebookSelectButton.R,{size:"small",type:"secondary",resource:{type:types.C.Group,attrs:{id:groupKey,groupTypeIndex:groupTypeIndex}}})}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(GroupCaption.s,{groupData:groupData,groupTypeName:groupTypeName}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(LemonTabs.T,{sceneInset:!0,activeKey:activeTab,onChange:tab=>lib.router.actions.push(urls.j.group(String(groupTypeIndex),groupKey,!0,tab)),tabs:[...featureFlags[constants.y8.CUSTOMER_ANALYTICS]?[{key:src_types.lW.FEED,label:(0,jsx_runtime.jsx)("span",{"data-attr":"groups-feed-tab",children:"Feed"}),content:(0,jsx_runtime.jsx)(GroupFeedCanvas_GroupFeedCanvas,{group:groupData})}]:[],{key:src_types.lW.OVERVIEW,label:(0,jsx_runtime.jsx)("span",{"data-attr":"groups-overview-tab",children:"Overview"}),content:(0,jsx_runtime.jsx)(GroupOverview,{groupData:groupData})},...featureFlags[constants.y8.CRM_ITERATION_ONE]&&groupData.notebook?[{key:src_types.lW.NOTES,label:(0,jsx_runtime.jsx)("span",{"data-attr":"groups-notes-tab",children:"Notes"}),content:(0,jsx_runtime.jsx)(GroupNotebookCard,{shortId:groupData.notebook})}]:[],{key:src_types.j3.PROPERTIES,label:(0,jsx_runtime.jsx)("span",{"data-attr":"groups-properties-tab",children:"Properties"}),content:(0,jsx_runtime.jsx)(PropertiesTable.V,{type:src_types.ll.Group,properties:groupData.group_properties||{},embedded:!1,onEdit:editProperty,onDelete:deleteProperty,searchable:!0})},{key:src_types.j3.EVENTS,label:(0,jsx_runtime.jsx)("span",{"data-attr":"groups-events-tab",children:"Events"}),content:groupEventsQuery?(0,jsx_runtime.jsx)(Query.A,{query:groupEventsQuery,setQuery:setGroupEventsQuery,context:{refresh:"force_blocking"}}):(0,jsx_runtime.jsx)(Spinner.$,{})},{key:src_types.j3.SESSION_RECORDINGS,label:(0,jsx_runtime.jsx)("span",{"data-attr":"group-session-recordings-tab",children:"Recordings"}),content:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:currentTeam?.session_recording_opt_in?(0,jsx_runtime.jsx)("div",{className:"SessionRecordingPlaylistHeightWrapper",children:(0,jsx_runtime.jsx)(SessionRecordingsPlaylist.m,{logicKey:`groups-recordings-${groupKey}-${groupTypeIndex}`,updateSearchParams:!0,filters:{duration:[{type:src_types.FT.Recording,key:"duration",value:1,operator:src_types.WV.GreaterThan}],filter_group:{type:src_types.J2.And,values:[{type:src_types.J2.And,values:[{type:"events",name:"All events",properties:[{key:`$group_${groupTypeIndex} = '${groupKey}'`,type:"hogql"}]}]}]}},onFiltersChange:filters=>{let eventFilters=(0,session_recordings_utils.Ri)(filters).filter(utils.Lu);eventFilters?.some(event=>event.properties?.some(prop=>prop.key===`$group_${groupTypeIndex} = '${groupKey}'`))||LemonToast.U.warning("Group filter removed. Please add it back to see recordings for this group.")}})}):(0,jsx_runtime.jsx)("div",{className:"mb-4",children:(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",children:["Session recordings are currently disabled for this ",settingLevel,". To use this feature, please go to your"," ",(0,jsx_runtime.jsx)(Link.r,{to:`${urls.j.settings("project")}#recordings`,children:"project settings"})," ","and enable it."]})})})},{key:src_types.j3.RELATED,label:(0,jsx_runtime.jsx)("div",{className:"flex items-center","data-attr":"group-related-tab",children:"Related people & groups"}),tooltip:`People and groups that have shared events with this ${groupTypeName} in the last 90 days.`,content:(0,jsx_runtime.jsx)(RelatedGroups.S,{id:groupKey,groupTypeIndex:groupTypeIndex})},{key:src_types.j3.FEATURE_FLAGS,label:(0,jsx_runtime.jsx)("span",{"data-attr":"groups-related-flags-tab",children:"Feature flags"}),tooltip:`Only shows feature flags with targeting conditions based on ${groupTypeName} properties.`,content:(0,jsx_runtime.jsx)(RelatedFeatureFlags.c,{distinctId:groupData.group_key,groupTypeIndex:groupTypeIndex,groups:{[groupType]:groupKey}})},{key:src_types.j3.HISTORY,label:"History",content:(0,jsx_runtime.jsx)(ActivityLog.DA,{scope:src_types.jc.GROUP,id:`${groupTypeIndex}-${groupKey}`,caption:(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",children:"This page only shows changes made by users in the PostHog site. Automatic changes from the API aren't shown here."})})}]})]})}},"../../frontend/src/scenes/persons/RelatedFeatureFlags.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{z:()=>FeatureFlagMatchReason,c:()=>RelatedFeatureFlags});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),stringWithWBR=__webpack_require__("../../frontend/src/lib/utils/stringWithWBR.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),types=__webpack_require__("../../frontend/src/types.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),featureFlagsLogic=__webpack_require__("../../frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),projectLogic=__webpack_require__("../../frontend/src/scenes/projectLogic.ts");let relatedFeatureFlagsLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","persons","relatedFeatureFlagsLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>`${props.distinctId}`),(0,index_esm.connect)(()=>({values:[projectLogic.K,["currentProjectId"],featureFlagsLogic.bP,["featureFlags","pagination"]],actions:[featureFlagsLogic.bP,["setFeatureFlagsFilters","loadFeatureFlagsSuccess"]]})),(0,index_esm.actions)({setSearchTerm:searchTerm=>(featureFlagsLogic.bP.actions.setFeatureFlagsFilters({search:searchTerm}),{searchTerm}),setFilters:(filters,replace)=>({filters,replace}),loadRelatedFeatureFlags:!0}),(0,lib.loaders)(_ref=>{let{values,props}=_ref;return{relatedFeatureFlags:[null,{loadRelatedFeatureFlags:async()=>await api.ZP.get(`api/projects/${values.currentProjectId}/feature_flags/evaluation_reasons?${(0,utils.oZ)({...props.distinctId?{distinct_id:props.distinctId}:{},...props.groups?{groups:props.groups}:{}})}`)}]}}),(0,index_esm.reducers)({searchTerm:["",{setSearchTerm:(_,_ref2)=>{let{searchTerm}=_ref2;return searchTerm}}],filters:[{},{setFilters:(state,_ref3)=>{let{filters,replace}=_ref3;return replace?{...filters}:{...state,...filters}}}]}),(0,index_esm.selectors)(_ref4=>{let{props}=_ref4;return{mappedRelatedFeatureFlags:[selectors=>[selectors.relatedFeatureFlags,selectors.featureFlags],(relatedFlags,featureFlags)=>{if(relatedFlags&&featureFlags){let flags=featureFlags.results.map(flag=>({...relatedFlags[flag.key],...flag})).filter(flag=>void 0!==flag.evaluation);return void 0!==props.groupTypeIndex&&props.groups&&Object.keys(props.groups).length>0?flags.filter(flag=>void 0!==flag.filters.aggregation_group_type_index&&null!==flag.filters.aggregation_group_type_index&&flag.filters.aggregation_group_type_index===props.groupTypeIndex):flags.filter(flag=>void 0===flag.filters.aggregation_group_type_index||null===flag.filters.aggregation_group_type_index)}return[]}],filteredMappedFlags:[selectors=>[selectors.mappedRelatedFeatureFlags,selectors.filters],(featureFlags,filters)=>{if(0===Object.keys(filters).length)return featureFlags;let{reason}=filters,filteredFlags=featureFlags;return reason&&(filteredFlags=filteredFlags.filter(flag=>"not matched"===reason?flag.evaluation.reason!==FeatureFlagMatchReason.ConditionMatch:flag.evaluation.reason===FeatureFlagMatchReason.ConditionMatch)),filteredFlags}]}}),(0,index_esm.listeners)(_ref5=>{let{values,actions}=_ref5;return{setFilters:_ref6=>{let{filters,replace}=_ref6,apiFilters={};if(replace){let currentFilters=values.filters;"type"in filters||!currentFilters.type||(apiFilters.type=void 0),"active"in filters||!currentFilters.active||(apiFilters.active=void 0)}"type"in filters&&void 0!==filters.type&&(filters.type===types.aI.ReleaseToggle?apiFilters.type="boolean":filters.type===types.aI.Variants&&(apiFilters.type="multivariant")),"active"in filters&&void 0!==filters.active&&(apiFilters.active=filters.active),(Object.keys(apiFilters).length>0||replace)&&actions.setFeatureFlagsFilters({...apiFilters,page:1},replace)},loadFeatureFlagsSuccess:()=>{actions.loadRelatedFeatureFlags()}}}),(0,index_esm.events)(_ref7=>{let{actions}=_ref7;return{afterMount:actions.loadRelatedFeatureFlags}}),(0,kea_router_lib.urlToAction)(_ref8=>{let{actions}=_ref8;return{[urls.j.personByUUID("*",!1)]:async(_,searchParams)=>{let page=searchParams.page;void 0!==page&&actions.setFeatureFlagsFilters({page:parseInt(page)})}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let FeatureFlagMatchReason=function(FeatureFlagMatchReason){return FeatureFlagMatchReason.SuperConditionMatch="super_condition_value",FeatureFlagMatchReason.ConditionMatch="condition_match",FeatureFlagMatchReason.NoConditionMatch="no_condition_match",FeatureFlagMatchReason.OutOfRolloutBound="out_of_rollout_bound",FeatureFlagMatchReason.NoGroupType="no_group_type",FeatureFlagMatchReason.Disabled="disabled",FeatureFlagMatchReason}({}),featureFlagMatchMapping={[FeatureFlagMatchReason.ConditionMatch]:"Matches",[FeatureFlagMatchReason.NoConditionMatch]:"Doesn't match any conditions",[FeatureFlagMatchReason.OutOfRolloutBound]:"Out of rollout bound",[FeatureFlagMatchReason.NoGroupType]:"Missing group type",[FeatureFlagMatchReason.SuperConditionMatch]:"Matches early access condition",[FeatureFlagMatchReason.Disabled]:"Disabled"};function RelatedFeatureFlags(_ref){let{distinctId,groupTypeIndex,groups}=_ref,relatedFlagsLogic=relatedFeatureFlagsLogic({distinctId,groupTypeIndex,groups}),{filteredMappedFlags,relatedFeatureFlagsLoading,searchTerm,filters,pagination}=(0,index_esm.useValues)(relatedFlagsLogic),{setSearchTerm,setFilters}=(0,index_esm.useActions)(relatedFlagsLogic),columns=[{title:"Key",dataIndex:"key",className:"ph-no-capture",sticky:!0,width:"40%",sorter:(a,b)=>(a.key||"").localeCompare(b.key||""),render:function Render(_,featureFlag){let isExperiment=(featureFlag.experiment_set||[]).length>0;return(0,jsx_runtime.jsx)(LemonTableLink.i,{to:featureFlag.id?urls.j.featureFlag(featureFlag.id):void 0,title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,stringWithWBR.Z)(featureFlag.key,17),(0,jsx_runtime.jsx)(src.oe,{type:isExperiment?"completion":"default",className:"ml-2",children:isExperiment?"Experiment":"Feature flag"})]}),description:featureFlag.name})}},{title:"Type",width:100,render:function Render(_,featureFlag){return featureFlag.filters.multivariate?types.aI.Variants:types.aI.ReleaseToggle}},{title:"Value",dataIndex:"value",width:150,render:function Render(_,featureFlag){return(0,jsx_runtime.jsx)("div",{className:"break-words",children:featureFlag.active&&featureFlag.value?featureFlag.value.toString():"false"})}},{title:(0,jsx_runtime.jsxs)("div",{className:"inline-flex items-center deprecated-space-x-1",children:[(0,jsx_runtime.jsx)("div",{children:"Match evaluation"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"This column simulates the feature flag evaluation based on the selected distinct ID, current properties, and groups associated with the user. If the actual flag value differs, it could be due to different inputs used during evaluation."}),(0,jsx_runtime.jsxs)("div",{children:["If you are using local flag evaluation, you must ensure that you provide any person properties, groups, or group properties used to evaluate the release conditions of the flag. Read more in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/feature-flags/local-evaluation#step-3-evaluate-your-feature-flag",children:"documentation."})]})]}),closeDelayMs:200,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary text-base ml-1"})})]}),dataIndex:"evaluation",width:150,render:function Render(_,featureFlag){var _featureFlag$evaluati;let matchesSet=featureFlag.evaluation.reason===FeatureFlagMatchReason.ConditionMatch;return(0,jsx_runtime.jsxs)("div",{children:[featureFlag.active?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:featureFlagMatchMapping[featureFlag.evaluation.reason]}):"--",matchesSet&&(0,jsx_runtime.jsxs)(src.LV,{children:["Set ",(null!==(_featureFlag$evaluati=featureFlag.evaluation.condition_index)&&void 0!==_featureFlag$evaluati?_featureFlag$evaluati:0)+1]})]})}},{title:"Status",dataIndex:"active",sorter:(a,b)=>Number(a.active)-Number(b.active),width:100,render:function RenderActive(_,featureFlag){return(0,jsx_runtime.jsx)("span",{className:"font-normal",children:featureFlag.active?"Enabled":"Disabled"})}}],options=[{label:"All types",value:"all"},{label:types.aI.ReleaseToggle,value:types.aI.ReleaseToggle},{label:types.aI.Variants,value:types.aI.Variants}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between mb-4 gap-2 flex-wrap",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search for feature flags",onChange:setSearchTerm,value:searchTerm}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)("b",{children:"Type"})}),(0,jsx_runtime.jsx)(src.Yv,{options:options,onChange:type=>{if(type){if("all"===type){if(filters){let{type,...restFilters}=filters;setFilters(restFilters,!0)}}else setFilters({type})}},value:filters.type||"all",dropdownMaxContentWidth:!0}),(0,jsx_runtime.jsx)("span",{className:"ml-2",children:(0,jsx_runtime.jsx)("b",{children:"Match evaluation"})}),(0,jsx_runtime.jsx)(src.Yv,{options:[{label:"All",value:"all"},{label:"Matched",value:FeatureFlagMatchReason.ConditionMatch},{label:"Not matched",value:"not matched"}],onChange:reason=>{if(reason){if("all"===reason){if(filters){let{reason,...restFilters}=filters;setFilters(restFilters,!0)}}else setFilters({reason})}},value:filters.reason||"all",dropdownMaxContentWidth:!0}),(0,jsx_runtime.jsx)("span",{className:"ml-2",children:(0,jsx_runtime.jsx)("b",{children:"Flag status"})}),(0,jsx_runtime.jsx)(src.Yv,{onChange:status=>{if(status){if("all"===status){if(filters){let{active,...restFilters}=filters;setFilters(restFilters,!0)}}else setFilters({active:status})}},options:[{label:"All",value:"all"},{label:"Enabled",value:"true"},{label:"Disabled",value:"false"}],value:filters.active||"all",dropdownMaxContentWidth:!0})]})]}),(0,jsx_runtime.jsx)(src.g3,{columns:columns,loading:relatedFeatureFlagsLoading,dataSource:filteredMappedFlags,pagination:pagination})]})}}}]);