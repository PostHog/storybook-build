"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[90597],{"../../products/live_debugger/frontend/LiveDebugger.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LiveDebugger:()=>LiveDebugger,scene:()=>scene});var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),useFeatureFlag=__webpack_require__("../../frontend/src/lib/hooks/useFeatureFlag.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),JSONViewer=__webpack_require__("../../frontend/src/lib/components/JSONViewer.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let liveDebuggerLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","live_debugger","frontend","liveDebuggerLogic"]),(0,index_esm.actions)({toggleBreakpoint:(filename,lineNumber,repository)=>({filename,lineNumber,repository}),toggleBreakpointForFile:(filename,lineNumber,repository)=>({filename,lineNumber,repository}),setHoveredLine:lineNumber=>({lineNumber}),selectInstance:instanceId=>({instanceId}),clearAllBreakpoints:!0,markInstanceAsOld:instanceId=>({instanceId}),showHitsForLine:lineNumber=>({lineNumber}),startPollingBreakpoints:!0,stopPollingBreakpoints:!0,savePollingInterval:intervalHdl=>({intervalHdl}),setSelectedFilePath:filePath=>({filePath}),setCurrentRepository:repository=>({repository})}),(0,lib.loaders)(_ref=>{let{values}=_ref;return{breakpoints:[[],{loadBreakpoints:async()=>{if(!values.currentRepository||!values.selectedFilePath)return[];let params=new URLSearchParams;params.append("repository",values.currentRepository),params.append("filename",values.selectedFilePath);let queryString=params.toString(),url=`api/projects/@current/live_debugger_breakpoints/?${queryString}`;return(await api.ZP.get(url)).results||[]}}],breakpointInstances:[[],{loadBreakpointInstances:async()=>{let breakpointIds=values.breakpoints.map(bp=>bp.id),params=new URLSearchParams;breakpointIds.forEach(id=>params.append("breakpoint_ids",id));let queryString=params.toString(),url=`api/projects/@current/live_debugger_breakpoints/breakpoint_hits/${queryString?`?${queryString}`:""}`;return(await api.ZP.get(url)).results||[]}}]}}),(0,index_esm.reducers)({currentRepository:["PostHog/posthog",{setCurrentRepository:(_,_ref2)=>{let{repository}=_ref2;return repository}}],selectedFilePath:["",{setSelectedFilePath:(_,_ref3)=>{let{filePath}=_ref3;return filePath}}],selectedInstanceId:[null,{selectInstance:(_,_ref4)=>{let{instanceId}=_ref4;return instanceId}}],seenInstanceIds:[new Set,{markInstanceAsOld:(state,_ref5)=>{let{instanceId}=_ref5;return new Set([...state,instanceId])},loadBreakpointInstancesSuccess:state=>new Set(state)}],previousInstanceIds:[new Set,{loadBreakpointInstancesSuccess:(_,_ref6)=>{let{breakpointInstances}=_ref6;return new Set(breakpointInstances.map(instance=>instance.id))}}],selectedLineForHits:[null,{showHitsForLine:(_,_ref7)=>{let{lineNumber}=_ref7;return lineNumber}}],breakpointPollingInterval:[null,{savePollingInterval:(_,_ref8)=>{let{intervalHdl}=_ref8;return intervalHdl}}]}),(0,index_esm.listeners)(_ref9=>{let{actions,values}=_ref9;return{loadBreakpointInstancesSuccess:_ref10=>{let{breakpointInstances}=_ref10,newIds=breakpointInstances.map(instance=>instance.id).filter(id=>!values.seenInstanceIds.has(id));newIds.length>0&&setTimeout(()=>{newIds.forEach(id=>actions.markInstanceAsOld(id))},2e3)},toggleBreakpoint:async _ref11=>{let{filename,lineNumber,repository}=_ref11,existingBreakpoint=Array.isArray(values.breakpoints)?values.breakpoints.find(bp=>bp.line_number===lineNumber&&bp.filename===filename&&bp.repository===repository):void 0;existingBreakpoint?await api.ZP.delete(`api/projects/@current/live_debugger_breakpoints/${existingBreakpoint.id}/`):await api.ZP.create("api/projects/@current/live_debugger_breakpoints/",{repository,filename,line_number:lineNumber,enabled:!0}),actions.loadBreakpoints(),actions.loadBreakpointInstances()},toggleBreakpointForFile:async _ref12=>{let{filename,lineNumber,repository}=_ref12,existingBreakpoint=Array.isArray(values.breakpoints)?values.breakpoints.find(bp=>bp.line_number===lineNumber&&bp.filename===filename&&bp.repository===repository):void 0;existingBreakpoint?await api.ZP.delete(`api/projects/@current/live_debugger_breakpoints/${existingBreakpoint.id}/`):await api.ZP.create("api/projects/@current/live_debugger_breakpoints/",{repository,filename,line_number:lineNumber,enabled:!0}),actions.loadBreakpoints(),actions.loadBreakpointInstances()},clearAllBreakpoints:async()=>{Array.isArray(values.breakpoints)&&await Promise.all(values.breakpoints.map(bp=>api.ZP.delete(`api/projects/@current/live_debugger_breakpoints/${bp.id}/`))),actions.loadBreakpoints(),actions.loadBreakpointInstances()},startPollingBreakpoints:async()=>{actions.loadBreakpoints(),actions.loadBreakpointInstances();let interval=setInterval(()=>{actions.loadBreakpoints(),actions.loadBreakpointInstances()},15e3);actions.savePollingInterval(interval)},stopPollingBreakpoints:()=>{values.breakpointPollingInterval&&clearInterval(values.breakpointPollingInterval)},setCurrentRepository:()=>{values.selectedFilePath&&actions.loadBreakpoints()},setSelectedFilePath:()=>{values.currentRepository&&actions.loadBreakpoints()},loadBreakpointsSuccess:()=>{actions.loadBreakpointInstances()}}}),(0,index_esm.selectors)({selectedInstance:[s=>[s.selectedInstanceId,s.breakpointInstances],(selectedId,instances)=>instances.find(i=>i.id===selectedId)||null],visibleBreakpointIds:[s=>[s.breakpoints],breakpoints=>breakpoints.map(bp=>bp.id)],breakpointLines:[s=>[s.breakpoints,s.selectedFilePath],(breakpoints,selectedFilePath)=>Array.isArray(breakpoints)&&selectedFilePath?breakpoints.filter(bp=>bp.filename===selectedFilePath).map(bp=>bp.line_number).sort((a,b)=>a-b):[]],breakpointsByLine:[s=>[s.breakpoints,s.selectedFilePath],(breakpoints,selectedFilePath)=>{let byLine={};return Array.isArray(breakpoints)&&selectedFilePath&&breakpoints.filter(bp=>bp.filename===selectedFilePath).forEach(bp=>{byLine[bp.line_number]=bp}),byLine}],instancesByLine:[s=>[s.breakpointInstances,s.selectedFilePath],(instances,selectedFilePath)=>{let grouped={};return instances.filter(instance=>!selectedFilePath||instance.filename===selectedFilePath).forEach(instance=>{grouped[instance.lineNumber]||(grouped[instance.lineNumber]=[]),grouped[instance.lineNumber].push(instance)}),grouped}],newInstanceIds:[s=>[s.breakpointInstances,s.seenInstanceIds],(instances,seenIds)=>new Set(instances.filter(instance=>!seenIds.has(instance.id)).map(instance=>instance.id))],hitCountsByLine:[s=>[s.breakpointInstances,s.selectedFilePath],(instances,selectedFilePath)=>{let counts={};return instances.filter(instance=>!selectedFilePath||instance.filename===selectedFilePath).forEach(instance=>{counts[instance.lineNumber]=(counts[instance.lineNumber]||0)+1}),counts}],newHitsByLine:[s=>[s.breakpointInstances,s.seenInstanceIds,s.selectedFilePath],(instances,seenIds,selectedFilePath)=>new Set(instances.filter(instance=>!seenIds.has(instance.id)).filter(instance=>!selectedFilePath||instance.filename===selectedFilePath).map(instance=>instance.lineNumber))],hitsForSelectedLine:[s=>[s.selectedLineForHits,s.instancesByLine],(selectedLine,instancesByLine)=>selectedLine&&instancesByLine[selectedLine]||[]]}),(0,index_esm.events)(_ref13=>{let{actions}=_ref13;return{afterMount:[actions.startPollingBreakpoints],beforeUnmount:[actions.stopPollingBreakpoints]}})]);function parseJsonPickleVariable(value){if("string"!=typeof value)return{type:"object"==typeof value&&null!==value?"complex":"simple",value};try{let parsed=JSON.parse(value);if(null===parsed||"boolean"==typeof parsed||"number"==typeof parsed||"string"==typeof parsed)return{type:"simple",value:parsed};if("object"==typeof parsed){let typeName=parsed["py/object"]?String(parsed["py/object"]):void 0,cleaned=cleanJsonPickleMetadata(parsed);return{type:"complex",value:cleaned,typeName}}return{type:"simple",value:parsed}}catch{return{type:"simple",value}}}function cleanJsonPickleMetadata(obj){if(null===obj||"object"!=typeof obj)return obj;if(Array.isArray(obj))return obj.map(cleanJsonPickleMetadata);let cleaned={};for(let[key,value]of Object.entries(obj))!key.startsWith("py/")&&(cleaned[key]=cleanJsonPickleMetadata(value));return cleaned}var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function VariableDisplay(_ref){let{variables}=_ref;return(0,jsx_runtime.jsx)("div",{className:"border rounded divide-y",children:Object.entries(variables).map(_ref2=>{let[key,value]=_ref2,parsed=parseJsonPickleVariable(value);return(0,jsx_runtime.jsxs)("div",{className:"p-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs font-semibold",children:key}),parsed.typeName&&(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted-alt bg-bg-3000 px-1.5 py-0.5 rounded font-mono",children:parsed.typeName})]}),(0,jsx_runtime.jsx)("div",{className:"text-xs font-mono break-words",children:"complex"===parsed.type?(0,jsx_runtime.jsx)(JSONViewer.C,{src:parsed.value,collapsed:1}):(0,jsx_runtime.jsx)("span",{children:String(parsed.value)})})]},key)})})}function StateInspector(_ref3){let{selectedInstance,selectInstance}=_ref3,{breakpoints,breakpointInstances,currentRepository}=(0,index_esm.useValues)(liveDebuggerLogic),{toggleBreakpointForFile}=(0,index_esm.useActions)(liveDebuggerLogic);return(0,jsx_runtime.jsxs)("div",{className:"flex-[2] border rounded bg-bg-light overflow-hidden flex flex-col",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between p-2 border-b bg-bg-3000",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Debug Details"}),(0,jsx_runtime.jsx)("button",{onClick:()=>selectInstance(null),className:"text-muted hover:text-default",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex-1 p-3 overflow-auto space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("h4",{className:"font-semibold text-sm mb-2",children:["Variables at Line ",selectedInstance.lineNumber]}),(0,jsx_runtime.jsx)(VariableDisplay,{variables:selectedInstance.variables})]}),selectedInstance.stackTrace&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold text-sm mb-2",children:"Stack Trace"}),(0,jsx_runtime.jsx)("div",{className:"text-xs font-mono bg-bg-3000 p-2 rounded max-h-96 overflow-auto space-y-1",children:selectedInstance.stackTrace.map((frame,i)=>{let functionName=frame[1],fileName=frame[0],lineNumber=frame[2],fileNameMatch=(bpFilename,stackFilename)=>bpFilename===stackFilename||bpFilename.endsWith(stackFilename)||stackFilename.endsWith(bpFilename),hasBreakpoint=Array.isArray(breakpoints)&&breakpoints.some(bp=>fileNameMatch(bp.filename,fileName)&&bp.line_number===lineNumber),hitCount=Array.isArray(breakpointInstances)?breakpointInstances.filter(inst=>fileNameMatch(inst.filename,fileName)&&inst.lineNumber===lineNumber).length:0;return(0,jsx_runtime.jsxs)("div",{className:"px-2 py-1 border border-border rounded hover:bg-bg-light flex items-center justify-between gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-baseline gap-1.5",children:[(0,jsx_runtime.jsxs)("span",{className:"text-muted font-normal",children:["#",i]}),(0,jsx_runtime.jsx)("span",{className:"font-semibold truncate",children:functionName}),hitCount>0&&(0,jsx_runtime.jsx)("span",{className:"text-xs bg-orange-500 text-white px-1 rounded",children:hitCount})]}),(0,jsx_runtime.jsxs)("div",{className:"text-muted text-xs truncate",children:[fileName,lineNumber?`:${lineNumber}`:""]})]}),lineNumber&&(0,jsx_runtime.jsx)(LemonButton.J,{size:"xsmall",type:hasBreakpoint?"primary":"secondary",onClick:()=>{"number"==typeof lineNumber&&toggleBreakpointForFile(fileName,lineNumber,currentRepository)},children:"BP"})]},i)})})]})]})]})}var LemonInput=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),LemonTree=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTree/LemonTree.tsx");function highlightPythonSyntax(line){let highlighted=line.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(line.trim().startsWith("#"))return`<span class="text-green-600">${highlighted}</span>`;let commentIndex=line.indexOf("#"),beforeComment=highlighted,comment="";-1!==commentIndex&&(beforeComment=highlighted.substring(0,commentIndex),comment=`<span class="text-green-600">${highlighted.substring(commentIndex)}</span>`);let processed=beforeComment;return(processed=(processed=(processed=(processed=(processed=(processed=(processed=processed.replace(/(^|[^a-zA-Z0-9_])(["'])((?:\\.|(?!\2)[^\\])*?)\2/g,'$1<span class="text-orange-400">$2$3$2</span>')).replace(/(@[a-zA-Z_][a-zA-Z0-9_]*(?:\.[a-zA-Z_][a-zA-Z0-9_]*)*)/g,'<span class="text-yellow-400">$1</span>')).replace(/\b(def)\s+([a-zA-Z_][a-zA-Z0-9_]*)/g,'<span class="text-blue-400">$1</span> <span class="text-yellow-300">$2</span>')).replace(/\b(class)\s+([a-zA-Z_][a-zA-Z0-9_]*)/g,'<span class="text-blue-400">$1</span> <span class="text-green-300">$2</span>')).replace(/\b(if|else|elif|for|while|import|from|return|try|except|finally|with|as|pass|break|continue|and|or|not|in|is|lambda|global|nonlocal|yield|async|await)\b(?![^<]*>)/g,'<span class="text-blue-400">$1</span>')).replace(/\b(print|len|range|str|int|float|list|dict|set|tuple|bool|type|isinstance|hasattr|getattr|setattr|open|file|input|raw_input)\b(?![^<]*>)/g,'<span class="text-cyan-400">$1</span>')).replace(/\b(\d+\.?\d*)\b(?![^<]*>)/g,'<span class="text-green-400">$1</span>'))+comment}function CodeLine(_ref){let{line,lineNumber,hasBreakpoint,hasInstances,hitCount,hasNewHits,onClick,onHitCountClick}=_ref;return(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("flex items-center group hover:bg-bg-3000 transition-colors",hasNewHits&&"bg-yellow-100 dark:bg-yellow-900/20"),children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-10 px-1 cursor-pointer select-none",onClick:onClick,children:(0,jsx_runtime.jsx)("div",{className:"relative flex items-center justify-center",children:hasBreakpoint?hasInstances?(0,jsx_runtime.jsx)("div",{className:"w-3 h-3 bg-warning rounded-full animate-pulse border-2 border-danger"}):(0,jsx_runtime.jsx)("div",{className:"w-3 h-3 bg-danger rounded-full"}):hasInstances?(0,jsx_runtime.jsx)("div",{className:"w-3 h-3 bg-warning rounded-full animate-pulse"}):(0,jsx_runtime.jsx)("div",{className:"w-3 h-3 border border-muted rounded-full opacity-0 group-hover:opacity-100 transition-opacity"})})}),(0,jsx_runtime.jsx)("div",{className:"w-10 text-right pr-2 text-muted text-xs select-none",children:lineNumber}),hitCount>0&&(0,jsx_runtime.jsx)("div",{className:"w-6 h-4 text-xs bg-orange-500 text-white rounded-full flex items-center justify-center cursor-pointer mr-2 hover:bg-orange-600 transition-colors",onClick:onHitCountClick,title:`${hitCount} breakpoint hit${hitCount>1?"s":""}`,children:hitCount}),(0,jsx_runtime.jsx)("pre",{className:"flex-1 m-0 text-xs overflow-hidden whitespace-pre",children:(0,jsx_runtime.jsx)("code",{className:"block",dangerouslySetInnerHTML:{__html:highlightPythonSyntax(line||" ")}})})]})}var fuse_esm=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js");let DEFAULT_OWNER="PostHog",DEFAULT_REPO="posthog";async function loadRepositoryTree(){let owner=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DEFAULT_OWNER,repo=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DEFAULT_REPO,branch=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"master",branchResponse=await fetch(`https://api.github.com/repos/${owner}/${repo}/branches/${branch}`),sha=(await branchResponse.json()).commit.sha,response=await fetch(`https://api.github.com/repos/${owner}/${repo}/git/trees/${sha}?recursive=1`);return await response.json()}async function loadFileContent(filePath){let owner=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DEFAULT_OWNER,repo=arguments.length>2&&void 0!==arguments[2]?arguments[2]:DEFAULT_REPO,response=await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`),fileContent=await response.json();return"base64"===fileContent.encoding&&(fileContent.content=atob(fileContent.content)),fileContent}let repoBrowserLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","live_debugger","frontend","repo_browser","repoBrowserLogic"]),(0,index_esm.actions)({setFileSearchQuery:query=>({query}),loadFileContent:filePath=>({filePath}),setExpandedFolderPaths:paths=>({paths})}),(0,lib.loaders)(()=>({repositoryTree:[null,{loadRepositoryTree:async()=>loadRepositoryTree()}],fileContent:[null,{loadFileContent:async _ref=>{let{filePath}=_ref;return loadFileContent(filePath)}}]})),(0,index_esm.reducers)({fileSearchQuery:["",{setFileSearchQuery:(_,_ref2)=>{let{query}=_ref2;return query}}],repositoryTree:[null,{repositoryTreeSuccess:(_,_ref3)=>{let{repositoryTree}=_ref3;return repositoryTree}}],fileContent:[null,{fileContentSuccess:(_,_ref4)=>{let{fileContent}=_ref4;return fileContent}}],selectedFilePath:[null,{loadFileContent:(_,_ref5)=>{let{filePath}=_ref5;return filePath}}]}),(0,index_esm.selectors)({codeLines:[s=>[s.fileContent],fileContent=>fileContent?fileContent.content.split("\n"):[]],relevantFiles:[s=>[s.repositoryTree],tree=>tree?tree.tree.filter(item=>"tree"===item.type||"blob"===item.type&&item.path.endsWith(".py")):[]],fuzzyIndex:[s=>[s.relevantFiles],relevantFiles=>new fuse_esm.Z(relevantFiles,{keys:["path","name"],threshold:.3})],visibleFilesAndFolders:[s=>[s.fileSearchQuery,s.relevantFiles,s.fuzzyIndex],(fileSearchQuery,relevantFiles,fuzzyIndex)=>fileSearchQuery?fuzzyIndex.search(fileSearchQuery).map(r=>r.item):relevantFiles],treeData:[s=>[s.visibleFilesAndFolders],visibleFilesAndFolders=>{if(!visibleFilesAndFolders)return[];let folders=new Map,rootElements=[];return visibleFilesAndFolders.forEach(item=>{let{pathPrefix,filename,fullPath}=extractPathAndFilename(item),recordType="tree"===item.type?"folder":"file",children="tree"===item.type?[]:void 0,parent=folders.get(pathPrefix),newNode={id:item.sha,name:filename,record:{type:recordType,fullPath:fullPath},children};parent?(parent.children.push(newNode),parent.children?.sort(filesSortFn)):rootElements.push(newNode),"tree"===item.type&&folders.set(fullPath,newNode)}),rootElements.sort(filesSortFn),rootElements}]}),(0,index_esm.events)(_ref6=>{let{actions}=_ref6;return{afterMount:[actions.loadRepositoryTree]}})]);function extractPathAndFilename(item){let sections=item.path.split("/"),filename=sections.at(-1),pathPrefix=sections.slice(0,-1).join("/");return{filename,fullPath:item.path,pathPrefix}}function filesSortFn(a,b){return a.record.type!==b.record.type?"folder"===a.record.type?-1:1:a.name<b.name?-1:+(b.name<a.name)}function RepositoryBrowser(){let{fileSearchQuery,repositoryTreeLoading,treeData,codeLines,selectedFilePath}=(0,index_esm.useValues)(repoBrowserLogic),{loadFileContent,setFileSearchQuery}=(0,index_esm.useActions)(repoBrowserLogic),{breakpoints,breakpointsByLine,instancesByLine,hitCountsByLine,newHitsByLine,currentRepository}=(0,index_esm.useValues)(liveDebuggerLogic),{clearAllBreakpoints,toggleBreakpoint,showHitsForLine,setSelectedFilePath}=(0,index_esm.useActions)(liveDebuggerLogic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1 border rounded bg-bg-light overflow-hidden flex flex-col",children:[(0,jsx_runtime.jsx)("div",{className:"p-2 border-b bg-bg-3000",children:(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"Files"})}),(0,jsx_runtime.jsx)("div",{className:"p-2 border-b",children:(0,jsx_runtime.jsx)(LemonInput.D,{type:"search",placeholder:"Search files...",value:fileSearchQuery,onChange:value=>setFileSearchQuery(value),fullWidth:!0})}),(0,jsx_runtime.jsx)("div",{className:"flex-1 overflow-auto",children:repositoryTreeLoading?(0,jsx_runtime.jsx)("div",{className:"p-4 text-center text-muted",children:"Loading repository..."}):0===treeData.length?(0,jsx_runtime.jsx)("div",{className:"p-4 text-center text-muted",children:fileSearchQuery?"No files found":"No Python files in repository"}):(0,jsx_runtime.jsx)(LemonTree.I,{data:treeData,onFolderClick:()=>{},onItemClick:item=>{item?.record?.type==="file"&&(loadFileContent(item.record.fullPath),setSelectedFilePath(item.record.fullPath))}})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex-[2] border rounded bg-bg-light overflow-hidden flex flex-col",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between p-2 border-b bg-bg-3000",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:selectedFilePath||"Code"}),(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",type:"secondary",onClick:clearAllBreakpoints,disabled:!breakpoints||0===breakpoints.length,children:"Clear all breakpoints"})]}),(0,jsx_runtime.jsx)("div",{className:"flex-1 overflow-auto font-mono text-xs",children:codeLines?codeLines.map((line,index)=>{let lineNumber=index+1,hasBreakpoint=!!breakpointsByLine[lineNumber],hasInstances=!!instancesByLine[lineNumber]?.length,hitCount=hitCountsByLine[lineNumber]||0,hasNewHits=newHitsByLine.has(lineNumber);return(0,jsx_runtime.jsx)(CodeLine,{line:line,lineNumber:lineNumber,hasBreakpoint:hasBreakpoint,hasInstances:hasInstances,hitCount:hitCount,hasNewHits:hasNewHits,onClick:()=>{selectedFilePath&&toggleBreakpoint(selectedFilePath,lineNumber,currentRepository)},onHitCountClick:()=>showHitsForLine(lineNumber)},index)}):(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center h-full text-muted p-4 text-center",children:(0,jsx_runtime.jsx)("p",{children:"Select a file from the file browser to view its contents and set breakpoints"})})})]})]})}let scene={component:LiveDebugger,logic:liveDebuggerLogic};function BreakpointInstanceCard(_ref){let{instance,isSelected,isNew,onClick}=_ref;return(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("p-2 border rounded cursor-pointer transition-colors text-xs",isSelected?"border-primary bg-primary-highlight":"border-border hover:bg-bg-light",isNew&&"animate-pulse bg-warning-highlight border-warning"),onClick:onClick,children:[(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs mb-0.5",children:(0,dayjs.Bv)(instance.timestamp).fromNow()}),(0,jsx_runtime.jsxs)("div",{className:"font-mono font-semibold text-xs truncate",title:`${instance.functionName||"captureEvent"}:${instance.lineNumber}`,children:[instance.functionName||"captureEvent",":",instance.lineNumber]})]})}function LiveDebugger(){let isEnabled=(0,useFeatureFlag.y)("LIVE_DEBUGGER"),{selectedInstance,newInstanceIds,selectedLineForHits,hitsForSelectedLine}=(0,index_esm.useValues)(liveDebuggerLogic),{selectInstance,showHitsForLine}=(0,index_esm.useActions)(liveDebuggerLogic);return isEnabled?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:"Live Debugger",description:"Set breakpoints in your code to capture and inspect runtime values",resourceType:{type:"live_debugger"}}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(SceneContent._,{children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-3 h-[calc(100vh-200px)]",children:[(0,jsx_runtime.jsx)(RepositoryBrowser,{}),(0,jsx_runtime.jsxs)("div",{className:"w-64 border rounded bg-bg-light overflow-hidden flex flex-col",children:[(0,jsx_runtime.jsxs)("div",{className:"px-2 py-1.5 border-b bg-bg-3000 flex items-center justify-between",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold text-xs",children:selectedLineForHits?`Line ${selectedLineForHits}`:"Hits"}),selectedLineForHits&&(0,jsx_runtime.jsx)("button",{onClick:()=>showHitsForLine(null),className:"text-xs text-muted hover:text-default",children:"Clear"})]}),(0,jsx_runtime.jsx)("div",{className:"flex-1 overflow-auto",children:selectedLineForHits?hitsForSelectedLine.length>0?(0,jsx_runtime.jsx)("div",{className:"p-1.5 space-y-1.5",children:hitsForSelectedLine.map(instance=>(0,jsx_runtime.jsx)(BreakpointInstanceCard,{instance:instance,isSelected:selectedInstance?.id===instance.id,isNew:newInstanceIds.has(instance.id),onClick:()=>selectInstance(instance.id)},instance.id))}):(0,jsx_runtime.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted p-2 text-center",children:(0,jsx_runtime.jsx)("p",{className:"text-xs",children:"No hits"})}):(0,jsx_runtime.jsx)("div",{className:"flex-1 flex items-center justify-center text-muted p-2 text-center",children:(0,jsx_runtime.jsxs)("div",{className:"text-xs",children:[(0,jsx_runtime.jsx)("p",{children:"Click hit count badges"}),(0,jsx_runtime.jsx)("p",{className:"mt-1",children:"to view hits"})]})})})]}),selectedInstance&&(0,jsx_runtime.jsx)(StateInspector,{selectedInstance:selectedInstance,selectInstance:selectInstance})]})})]}):(0,jsx_runtime.jsx)(NotFound.T,{object:"Live debugger",caption:"This feature is not enabled for your project."})}}}]);