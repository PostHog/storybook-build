"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[18187],{"../../frontend/src/scenes/wizard/Wizard.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Wizard:()=>Wizard,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),hedgehogs=__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSelect/index.ts"),Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),organizationLogic=__webpack_require__("../../frontend/src/scenes/organizationLogic.tsx"),projectLogic=__webpack_require__("../../frontend/src/scenes/projectLogic.ts");let wizardLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","wizard","wizardLogic"]),(0,index_esm.connect)(()=>({values:[organizationLogic.organizationLogic,["currentOrganization"],projectLogic.K,["currentProject"]]})),(0,index_esm.actions)({setWizardHash:wizardHash=>({wizardHash}),setView:view=>({view}),setSelectedProjectId:projectId=>({projectId}),authenticateWizard:(wizardHash,projectId)=>({wizardHash,projectId}),continueToAuthentication:()=>({}),handleWizardRouting:()=>({})}),(0,lib.loaders)(_ref=>{let{actions}=_ref;return{wizardToken:[null,{authenticateWizard:async _ref2=>{let{wizardHash,projectId}=_ref2;try{actions.setView("pending");let response=await api.ZP.wizard.authenticateWizard({hash:wizardHash,projectId:projectId});return actions.setView("success"),response}catch{return actions.setView("invalid"),{success:!1}}}}]}}),(0,index_esm.reducers)({wizardHash:[null,{setWizardHash:(_,_ref3)=>{let{wizardHash}=_ref3;return wizardHash}}],view:["project",{setView:(_,_ref4)=>{let{view}=_ref4;return view}}],selectedProjectId:[null,{setSelectedProjectId:(_,_ref5)=>{let{projectId}=_ref5;return projectId}}]}),(0,index_esm.selectors)({availableProjects:[s=>[s.currentOrganization],currentOrganization=>currentOrganization?.teams?.map(team=>({value:team.id,label:team.name,api_token:team.api_token,organization:currentOrganization.id}))||[]],selectedProject:[s=>[s.availableProjects,s.selectedProjectId],(availableProjects,selectedProjectId)=>availableProjects.find(project=>project.value===selectedProjectId)]}),(0,index_esm.listeners)(_ref6=>{let{actions,values}=_ref6;return{continueToAuthentication:()=>{let projectId=values.selectedProjectId,wizardHash=values.wizardHash;if(!projectId||!wizardHash){actions.setView("invalid");return}actions.setView("pending"),actions.authenticateWizard(wizardHash,projectId)},handleWizardRouting:()=>{let wizardHash=values.wizardHash;if(!wizardHash){actions.setView("invalid");return}let currentProjectId=values.currentProject?.id;currentProjectId&&actions.setSelectedProjectId(currentProjectId),values.availableProjects.length<=1&&currentProjectId?(actions.authenticateWizard(wizardHash,currentProjectId),actions.setView("pending")):actions.setView("project")}}}),(0,kea_router_lib.urlToAction)(_ref7=>{let{actions}=_ref7;return{"/wizard":(_,params)=>{let wizardHash=params.hash;actions.setWizardHash(null!=wizardHash?wizardHash:null),actions.handleWizardRouting()}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:Wizard,logic:wizardLogic};function Wizard(){let{view,selectedProjectId,availableProjects}=(0,index_esm.useValues)(wizardLogic),{setSelectedProjectId,continueToAuthentication}=(0,index_esm.useActions)(wizardLogic);return(0,jsx_runtime.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,jsx_runtime.jsxs)("div",{className:"px-12 py-8 text-center flex flex-col items-center max-w-160 w-full",children:["project"===view&&(0,jsx_runtime.jsxs)("div",{className:"max-w-xs",children:[(0,jsx_runtime.jsxs)("div",{className:"mb-8",children:[(0,jsx_runtime.jsx)("h1",{className:"text-3xl font-bold mb-3",children:"AI wizard"}),(0,jsx_runtime.jsx)("p",{className:"text-muted-alt",children:"Select which project the wizard should use to install PostHog."})]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsxs)("div",{className:"justify-start items-start flex flex-col",children:[(0,jsx_runtime.jsx)("label",{className:"align-start block text-sm font-medium mb-3",children:"Project"}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{value:null!=selectedProjectId?selectedProjectId:void 0,onChange:projectId=>setSelectedProjectId(projectId),options:availableProjects,placeholder:"Choose a project...",className:"w-full"})]}),(0,jsx_runtime.jsx)("div",{className:"pt-4 flex items-center justify-center",children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",onClick:continueToAuthentication,disabledReason:selectedProjectId?void 0:"Please select a project to continue.",className:"w-auto",children:"Continue setup"})})]})]}),"pending"===view&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h1",{className:"text-lg font-bold",children:"Authenticating setup wizard..."}),(0,jsx_runtime.jsx)(Spinner.$,{className:"w-16 h-16 mt-12"})]}),"success"===view&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h1",{className:"text-3xl font-bold",children:"Success!"}),(0,jsx_runtime.jsx)("div",{className:"max-w-60 mb-12",children:(0,jsx_runtime.jsx)(hedgehogs.HeartHog,{className:"w-48 h-48"})}),(0,jsx_runtime.jsx)("p",{className:"text-lg",children:"You're all set! You can return to the PostHog setup wizard."})]}),"invalid"===view&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h1",{className:"text-xl font-bold",children:"Something went wrong!"}),(0,jsx_runtime.jsx)(hedgehogs.SurprisedHog,{className:"h-48 w-48"}),(0,jsx_runtime.jsx)("p",{className:"text-lg",children:"There was a problem authenticating the setup wizard. Please try again later."})]})]})})}}}]);