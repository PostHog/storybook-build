(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{"./frontend/src/scenes/instance/SystemStatus/index.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"SystemStatus",(function(){return SystemStatus_SystemStatus}));var injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@4.46.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),SystemStatus=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss"),SystemStatus_default=__webpack_require__.n(SystemStatus),options={insert:"head",singleton:!1},es_alert=(injectStylesIntoStyleTag_default()(SystemStatus_default.a,options),SystemStatus_default.a.locals,__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/alert/index.js")),tabs=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),systemStatusLogic=__webpack_require__("./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),preflightLogic=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link.tsx"),LemonTag=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const TIMESTAMP_VALUES=new Set(["last_event_ingested_timestamp"]);function RenderMetricValue(_,_ref){let{key:key,value:value,value_type:value_type,emptyNullLabel:emptyNullLabel,isSecret:isSecret}=_ref;return value&&isSecret?Object(jsx_runtime.jsx)(LemonTag.a,{style:{color:"var(--muted)",backgroundColor:"#fee5b3"},className:"uppercase",icon:isSecret?Object(jsx_runtime.jsx)(icons.Eb,{style:{color:"var(--warning)"}}):void 0,children:"Secret"}):key&&TIMESTAMP_VALUES.has(key)&&"string"==typeof value?new Date(value).getTime()===new Date("1970-01-01T00:00:00").getTime()?"Never":Object(utils.N)(value):"bool"===value_type||"boolean"==typeof value?Object(jsx_runtime.jsx)(LemonTag.a,{type:value?"success":"danger",children:value?"Yes":"No"}):null==value||""===value?Object(jsx_runtime.jsx)(LemonTag.a,{className:"uppercase",style:{color:"var(--muted)"},children:null!=emptyNullLabel?emptyNullLabel:"Unknown"}):"int"===value_type||"number"==typeof value?value.toLocaleString("en-US"):value.toString()}var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts");const METRIC_KEY_TO_INTERNAL_LINK={async_migrations_ok:"/instance/async_migrations"};function RenderMetric(_,systemStatusRow){return Object(jsx_runtime.jsxs)("span",{children:[systemStatusRow.metric," ",METRIC_KEY_TO_INTERNAL_LINK[systemStatusRow.key]?Object(jsx_runtime.jsx)(Link.a,{to:METRIC_KEY_TO_INTERNAL_LINK[systemStatusRow.key],children:Object(jsx_runtime.jsx)(icons.Ub,{style:{verticalAlign:"middle"}})}):null]})}function OverviewTab(){const{overview:overview,systemStatusLoading:systemStatusLoading}=Object(index_esm.useValues)(systemStatusLogic.b);return Object(jsx_runtime.jsx)(src.LemonTable,{className:"system-status-table",rowKey:"metric",dataSource:overview,columns:[{title:"Metric",className:"metric-column",render:RenderMetric},{title:"Value",render:RenderMetricValue}],loading:systemStatusLoading,expandable:{expandedRowRender:function renderExpand(row){var _row$subrows;return null!==(_row$subrows=row.subrows)&&void 0!==_row$subrows&&_row$subrows.rows.length?Object(jsx_runtime.jsx)(Subrows,{...row.subrows}):null},rowExpandable:row=>{var _row$subrows2;return!(null===(_row$subrows2=row.subrows)||void 0===_row$subrows2||!_row$subrows2.rows.length)}}})}function Subrows(props){return Object(jsx_runtime.jsx)(src.LemonTable,{dataSource:props.rows,columns:props.columns.map(((title,dataIndex)=>({title:title,dataIndex:dataIndex}))),embedded:!0})}var react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),collapse=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/collapse/index.js"),es_checkbox=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/checkbox/index.js"),es_button=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/button/index.js"),table=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/table/index.js"),objectSpread2=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),asn_ReloadOutlined={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},AntdIcon=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/components/AntdIcon.js"),icons_ReloadOutlined_ReloadOutlined=function ReloadOutlined(props,ref){return react.createElement(AntdIcon.a,Object(objectSpread2.a)(Object(objectSpread2.a)({},props),{},{ref:ref,icon:asn_ReloadOutlined}))};icons_ReloadOutlined_ReloadOutlined.displayName="ReloadOutlined";var icons_ReloadOutlined=react.forwardRef(icons_ReloadOutlined_ReloadOutlined);function AnalyzeQueryModal(){const{analyzeModalOpen:analyzeModalOpen,analyzeQuery:analyzeQuery,analyzeQueryResult:analyzeQueryResult,analyzeQueryResultLoading:analyzeQueryResultLoading}=Object(index_esm.useValues)(systemStatusLogic.b),{setAnalyzeModalOpen:setAnalyzeModalOpen,setAnalyzeQuery:setAnalyzeQuery,runAnalyzeQuery:runAnalyzeQuery}=Object(index_esm.useActions)(systemStatusLogic.b);return Object(jsx_runtime.jsxs)(src.LemonModal,{isOpen:analyzeModalOpen,title:"Analyze ClickHouse query performance",footer:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:()=>setAnalyzeModalOpen(!1),children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>{runAnalyzeQuery()},disabled:analyzeQueryResultLoading,children:"Analyze"})]}),onClose:()=>setAnalyzeModalOpen(!1),width:"80%",children:[Object(jsx_runtime.jsx)(src.LemonTextArea,{placeholder:"SQL query to analyze",onChange:setAnalyzeQuery,value:analyzeQuery,rows:10}),analyzeQueryResult&&Object(jsx_runtime.jsxs)("div",{className:"mt-2",children:[Object(jsx_runtime.jsx)("h2",{children:"Analysis results"}),Object(jsx_runtime.jsx)("ul",{children:Object.entries(analyzeQueryResult.timing).map((_ref=>{let[key,value]=_ref;return Object(jsx_runtime.jsxs)("li",{children:[key,": ",value]},key)}))}),Object.entries(analyzeQueryResult.flamegraphs).map((_ref2=>{let[key,value]=_ref2;return Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsxs)("h3",{children:["Flamegraph: ",key]}),Object(jsx_runtime.jsx)("a",{className:"embedded-svg-wrapper",href:`data:image/svg+xml;utf8,${encodeURIComponent(value)}`,dangerouslySetInnerHTML:{__html:value}})]},key)}))]})]})}function InternalMetricsTab(){const{openSections:openSections,queries:queries,queriesLoading:queriesLoading,showAnalyzeQueryButton:showAnalyzeQueryButton}=Object(index_esm.useValues)(systemStatusLogic.b),{setOpenSections:setOpenSections,loadQueries:loadQueries}=Object(index_esm.useActions)(systemStatusLogic.b),[showIdle,setShowIdle]=Object(react.useState)(!1),postgresQueries=Object(react.useMemo)((()=>{var _queries$postgres_run;return null==queries||null===(_queries$postgres_run=queries.postgres_running)||void 0===_queries$postgres_run?void 0:_queries$postgres_run.filter((_ref=>{let{state:state}=_ref;return showIdle||"idle"!==state}))}),[showIdle,queries]),reloadQueries=e=>{e.stopPropagation(),loadQueries()};return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)(collapse.a,{activeKey:openSections,onChange:keys=>setOpenSections(keys),children:[Object(jsx_runtime.jsxs)(collapse.a.Panel,{header:"PostgreSQL - currently running queries",children:[Object(jsx_runtime.jsxs)("div",{className:"mb-4 float-right",children:[Object(jsx_runtime.jsx)(es_checkbox.a,{checked:showIdle,onChange:e=>{setShowIdle(e.target.checked)},children:"Show idle queries"}),Object(jsx_runtime.jsxs)(es_button.a,{style:{marginLeft:8},onClick:reloadQueries,children:[Object(jsx_runtime.jsx)(icons_ReloadOutlined,{})," Reload Queries"]})]}),Object(jsx_runtime.jsx)(QueryTable,{queries:postgresQueries,loading:queriesLoading})]},"1"),null!=(null==queries?void 0:queries.clickhouse_running)?Object(jsx_runtime.jsxs)(collapse.a.Panel,{header:"Clickhouse - currently running queries",children:[Object(jsx_runtime.jsx)("div",{className:"mb-4 float-right",children:Object(jsx_runtime.jsxs)(es_button.a,{style:{marginLeft:8},onClick:reloadQueries,children:[Object(jsx_runtime.jsx)(icons_ReloadOutlined,{})," Reload Queries"]})}),Object(jsx_runtime.jsx)(QueryTable,{queries:null==queries?void 0:queries.clickhouse_running,loading:queriesLoading,showAnalyze:showAnalyzeQueryButton})]},"2"):null,null!=(null==queries?void 0:queries.clickhouse_slow_log)?Object(jsx_runtime.jsxs)(collapse.a.Panel,{header:"Clickhouse - slow query log (past 6 hours)",children:[Object(jsx_runtime.jsx)("div",{className:"mb-4 float-right",children:Object(jsx_runtime.jsxs)(es_button.a,{style:{marginLeft:8},onClick:reloadQueries,children:[Object(jsx_runtime.jsx)(icons_ReloadOutlined,{})," Reload Queries"]})}),Object(jsx_runtime.jsx)(QueryTable,{queries:null==queries?void 0:queries.clickhouse_slow_log,loading:queriesLoading,showAnalyze:showAnalyzeQueryButton})]},"3"):null]}),Object(jsx_runtime.jsx)(AnalyzeQueryModal,{})]})}function QueryTable(props){const{openAnalyzeModalWithQuery:openAnalyzeModalWithQuery}=Object(index_esm.useActions)(systemStatusLogic.b),columns=[{title:"duration",dataIndex:"duration",key:"duration",sorter:(a,b)=>+a.duration-+b.duration},{title:"query",dataIndex:"query",render:function RenderAnalyze(_ref2,item){let{}=_ref2;return props.showAnalyze?Object(jsx_runtime.jsx)(Link.a,{to:"#",onClick:()=>openAnalyzeModalWithQuery(item.query),children:item.query}):item.query},key:"query"}];return props.queries&&props.queries.length>0&&Object.keys(props.queries[0]).forEach((column=>{"duration"!==column&&"query"!==column&&columns.push({title:column,dataIndex:column,key:column})})),Object(jsx_runtime.jsx)(table.a,{dataSource:props.queries||[],columns:columns,loading:props.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",bordered:!0,style:{overflowX:"auto",overflowY:"auto"},locale:{emptyText:"No queries found"}})}var LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),useKeyboardHotkeys=__webpack_require__("./frontend/src/lib/hooks/useKeyboardHotkeys.tsx");function RenderMetricValueEdit(_ref){let{key:key,value:value,value_type:value_type,onValueChanged:onValueChanged,isSecret:isSecret}=_ref;if("bool"===value_type)return Object(jsx_runtime.jsx)(src.LemonCheckbox,{defaultChecked:!!value,onChange:val=>onValueChanged(key,val),label:Object(jsx_runtime.jsx)(LemonTag.a,{type:value?"success":"danger",className:"uppercase",children:value?"Yes":"No"})});const parsedValue=isSecret&&value?"":value;return Object(jsx_runtime.jsx)(src.LemonInput,{defaultValue:parsedValue,type:"int"===value_type?"number":"text",placeholder:isSecret&&value?"Keep existing secret value":void 0,onBlur:e=>onValueChanged(key,e.target.value)})}try{RenderMetricValueEdit.displayName="RenderMetricValueEdit",RenderMetricValueEdit.__docgenInfo={description:"",displayName:"RenderMetricValueEdit",props:{onValueChanged:{defaultValue:null,description:"",name:"onValueChanged",required:!0,type:{name:"(key: string, value: any) => void"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string | number | boolean | null"}},value_type:{defaultValue:null,description:"",name:"value_type",required:!1,type:{name:"enum",value:[{value:'"bool"'},{value:'"str"'},{value:'"int"'}]}},emptyNullLabel:{defaultValue:null,description:"",name:"emptyNullLabel",required:!1,type:{name:"string"}},isSecret:{defaultValue:null,description:"",name:"isSecret",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"]={docgenInfo:RenderMetricValueEdit.__docgenInfo,name:"RenderMetricValueEdit",path:"frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"})}catch(__react_docgen_typescript_loader_error){}var AlertMessage=__webpack_require__("./frontend/src/lib/lemon-ui/AlertMessage/index.ts");function ChangeRow(_ref){let{metricKey:metricKey,oldValue:oldValue,value:value,isSecret:isSecret}=_ref;return(null==value?void 0:value.toString())===(null==oldValue?void 0:oldValue.toString())?null:Object(jsx_runtime.jsxs)("div",{className:"bg-border-light radius p-2",children:[Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)("code",{children:metricKey})}),Object(jsx_runtime.jsxs)("div",{className:"text-muted",children:["Value will be changed",!isSecret&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[" from ",Object(jsx_runtime.jsx)("span",{className:"font-bold text-default",children:RenderMetricValue(0,{key:metricKey,value:oldValue,emptyNullLabel:"Unset",isSecret:isSecret})})]})," to ",Object(jsx_runtime.jsx)("span",{className:"font-bold text-default",children:RenderMetricValue(0,{key:metricKey,value:value,emptyNullLabel:"Unset"})}),isSecret&&Object(jsx_runtime.jsx)("div",{className:"text-danger",children:"This field is secret - you won't see its value once saved"})]})]})}function InstanceConfigSaveModal(_ref2){let{onClose:onClose,isOpen:isOpen}=_ref2;const{instanceConfigEditingState:instanceConfigEditingState,editableInstanceSettings:editableInstanceSettings,updatedInstanceConfigCount:updatedInstanceConfigCount}=Object(index_esm.useValues)(systemStatusLogic.b),{saveInstanceConfig:saveInstanceConfig}=Object(index_esm.useActions)(systemStatusLogic.b),loading=null!==updatedInstanceConfigCount;return Object(jsx_runtime.jsx)(src.LemonModal,{title:"Confirm new changes",isOpen:isOpen,closable:!loading,onClose:onClose,footer:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:onClose,loading:loading,children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",status:"danger",loading:loading,onClick:saveInstanceConfig,children:"Apply changes"})]}),children:Object(jsx_runtime.jsxs)("div",{className:"space-y-2",children:[Object.keys(instanceConfigEditingState).find((key=>key.startsWith("EMAIL")))&&Object(jsx_runtime.jsx)(AlertMessage.a,{type:"info",children:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["As you are changing email settings, we'll attempt to send a ",Object(jsx_runtime.jsx)("b",{children:"test email"})," so you can verify everything works (unless you are turning email off)."]})}),Object.keys(instanceConfigEditingState).includes("RECORDINGS_TTL_WEEKS")&&Object(jsx_runtime.jsx)(AlertMessage.a,{type:"warning",children:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Changing your recordings TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately."})}),Object.keys(instanceConfigEditingState).includes("RECORDINGS_PERFORMANCE_EVENTS_TTL_WEEKS")&&Object(jsx_runtime.jsx)(AlertMessage.a,{type:"warning",children:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Changing your performance events TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately."})}),Object(jsx_runtime.jsx)("div",{children:"The following changes will be immediately applied to your instance."}),Object.keys(instanceConfigEditingState).map((key=>{var _editableInstanceSett,_editableInstanceSett2;return Object(jsx_runtime.jsx)(ChangeRow,{metricKey:key,value:instanceConfigEditingState[key],oldValue:null===(_editableInstanceSett=editableInstanceSettings.find((record=>record.key===key)))||void 0===_editableInstanceSett?void 0:_editableInstanceSett.value,isSecret:null===(_editableInstanceSett2=editableInstanceSettings.find((record=>record.key===key)))||void 0===_editableInstanceSett2?void 0:_editableInstanceSett2.is_secret},key)})),loading&&Object(jsx_runtime.jsx)("div",{className:"mt-4 text-success",children:Object(jsx_runtime.jsxs)("b",{children:[Object(utils.vb)(updatedInstanceConfigCount||0,"change")," updated successfully."]})})]})})}try{InstanceConfigSaveModal.displayName="InstanceConfigSaveModal",InstanceConfigSaveModal.__docgenInfo={description:"",displayName:"InstanceConfigSaveModal",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"]={docgenInfo:InstanceConfigSaveModal.__docgenInfo,name:"InstanceConfigSaveModal",path:"frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"})}catch(__react_docgen_typescript_loader_error){}function InstanceConfigTab(){const{configOptions:configOptions,preflightLoading:preflightLoading}=Object(index_esm.useValues)(preflightLogic.a),{editableInstanceSettings:editableInstanceSettings,instanceSettingsLoading:instanceSettingsLoading,instanceConfigMode:instanceConfigMode,instanceConfigEditingState:instanceConfigEditingState}=Object(index_esm.useValues)(systemStatusLogic.b),{loadInstanceSettings:loadInstanceSettings,setInstanceConfigMode:setInstanceConfigMode,updateInstanceConfigValue:updateInstanceConfigValue,clearInstanceConfigEditing:clearInstanceConfigEditing}=Object(index_esm.useActions)(systemStatusLogic.b);Object(react.useEffect)((()=>{loadInstanceSettings()}),[]),Object(useKeyboardHotkeys.a)({e:{action:()=>setInstanceConfigMode(systemStatusLogic.a.Edit),disabled:instanceConfigMode!==systemStatusLogic.a.View||instanceSettingsLoading},escape:{action:()=>discard(),disabled:instanceConfigMode!==systemStatusLogic.a.Edit||instanceSettingsLoading},enter:{action:()=>save(),disabled:instanceConfigMode!==systemStatusLogic.a.Edit||instanceSettingsLoading}});const save=()=>{Object.keys(instanceConfigEditingState).length?setInstanceConfigMode(systemStatusLogic.a.Saving):setInstanceConfigMode(systemStatusLogic.a.View)},discard=()=>{setInstanceConfigMode(systemStatusLogic.a.View),clearInstanceConfigEditing()},columns=[{title:"Key",dataIndex:"key",render:function render(value){return Object(jsx_runtime.jsx)("code",{children:value})}},{title:"Description",dataIndex:"description"},{title:"Value",render:function renderValue(_,record){var _instanceConfigEditin;const props={value:record.value,key:record.key,emptyNullLabel:"Unset",value_type:record.value_type,isSecret:record.is_secret};return instanceConfigMode===systemStatusLogic.a.View?RenderMetricValue(0,props):RenderMetricValueEdit({...props,value:null!==(_instanceConfigEditin=instanceConfigEditingState[record.key])&&void 0!==_instanceConfigEditin?_instanceConfigEditin:record.value,onValueChanged:updateInstanceConfigValue})}}];return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[Object(jsx_runtime.jsxs)("div",{className:"flex-1",children:[Object(jsx_runtime.jsx)("h3",{children:"Instance configuration"}),Object(jsx_runtime.jsxs)("div",{children:["Changing these settings will take effect on your entire instance."," ",Object(jsx_runtime.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings",target:"_blank",children:["Learn more ",Object(jsx_runtime.jsx)(icons.Ub,{style:{verticalAlign:"middle"}})]}),"."]})]}),instanceConfigMode===systemStatusLogic.a.View?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>setInstanceConfigMode(systemStatusLogic.a.Edit),"data-attr":"instance-config-edit-button",disabled:instanceSettingsLoading,children:"Edit"})}):Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object.keys(instanceConfigEditingState).length>0&&Object(jsx_runtime.jsxs)("span",{className:"text-warning-dark flex items-center gap-2",children:[Object(jsx_runtime.jsx)(icons.id,{className:"text-lg"})," You have"," ",Object(jsx_runtime.jsx)("b",{children:Object.keys(instanceConfigEditingState).length})," unapplied"," ",Object(utils.vb)(Object.keys(instanceConfigEditingState).length,"change",void 0,!1)]}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",disabled:instanceSettingsLoading,onClick:discard,children:"Discard changes"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",disabled:instanceSettingsLoading,onClick:save,children:"Save"})]})]}),Object(jsx_runtime.jsx)(LemonTable.a,{dataSource:editableInstanceSettings,columns:columns,loading:instanceSettingsLoading,rowKey:"key"}),Object(jsx_runtime.jsxs)("div",{className:"my-4",children:[Object(jsx_runtime.jsx)("h3",{children:"Environment configuration"}),Object(jsx_runtime.jsxs)("div",{children:["These settings can only be modified by environment variables."," ",Object(jsx_runtime.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/environment-variables",target:"_blank",children:["Learn more ",Object(jsx_runtime.jsx)(icons.Ub,{style:{verticalAlign:"middle"}})]}),"."]})]}),Object(jsx_runtime.jsx)(LemonTable.a,{dataSource:configOptions,columns:[{key:"metric",title:"Metric",dataIndex:"metric"},{title:"Value",dataIndex:"value"}],loading:preflightLoading,rowKey:"key"}),Object(jsx_runtime.jsx)(InstanceConfigSaveModal,{isOpen:instanceConfigMode===systemStatusLogic.a.Saving,onClose:()=>setInstanceConfigMode(systemStatusLogic.a.Edit)})]})}var userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),modal=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/modal/index.js"),divider=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/divider/index.js"),ProfilePicture=__webpack_require__("./frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts");const staffUsersLogic=Object(index_esm.kea)({path:["scenes","instance","SystemStatus","staffUsersLogic"],connect:{values:[userLogic.a,["user"]],actions:[userLogic.a,["loadUser"]]},actions:{setStaffUsersToBeAdded:userUuids=>({userUuids:userUuids}),addStaffUsers:!0,deleteStaffUser:userUuid=>({userUuid:userUuid})},reducers:{staffUsersToBeAdded:[[],{setStaffUsersToBeAdded:(_,_ref)=>{let{userUuids:userUuids}=_ref;return userUuids}}]},loaders:_ref2=>{let{actions:actions,values:values}=_ref2;return{allUsers:[[],{loadAllUsers:async()=>{var _await$api$get$result;return null!==(_await$api$get$result=(await api.b.get("api/users")).results)&&void 0!==_await$api$get$result?_await$api$get$result:[]},addStaffUsers:async()=>{const{staffUsersToBeAdded:staffUsersToBeAdded,allUsers:allUsers}=values;actions.setStaffUsersToBeAdded([]);const newStaffUsers=await Promise.all(staffUsersToBeAdded.map((async userUuid=>await api.b.update(`api/users/${userUuid}`,{is_staff:!0})))),updatedAllUsers=[...allUsers.filter((_ref3=>{let{uuid:uuid}=_ref3;return!staffUsersToBeAdded.includes(uuid)})),...newStaffUsers];return updatedAllUsers.sort(((a,b)=>a.first_name.localeCompare(b.first_name))),updatedAllUsers},deleteStaffUser:async _ref4=>{var _values$user;let{userUuid:userUuid}=_ref4;await api.b.update(`api/users/${userUuid}`,{is_staff:!1}),(null===(_values$user=values.user)||void 0===_values$user?void 0:_values$user.uuid)===userUuid&&(actions.loadUser(),lib.router.actions.push(urls.a.projectHomepage()));const updatedAllUsers=[...values.allUsers];for(const user of updatedAllUsers)user.uuid===userUuid&&(user.is_staff=!1);return updatedAllUsers}}]}},selectors:{staffUsers:[s=>[s.allUsers],allUsers=>allUsers.filter((user=>user.is_staff))],nonStaffUsers:[s=>[s.allUsers],allUsers=>allUsers.filter((user=>!user.is_staff))]},events:_ref5=>{let{actions:actions}=_ref5;return{afterMount:[actions.loadAllUsers]}}});var LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonSelectMultiple=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelectMultiple/LemonSelectMultiple.tsx"),UserSelectItem=__webpack_require__("./frontend/src/lib/components/UserSelectItem.tsx");function StaffUsersTab(){const{user:myself}=Object(index_esm.useValues)(userLogic.a),{staffUsers:staffUsers,allUsersLoading:allUsersLoading,nonStaffUsers:nonStaffUsers,staffUsersToBeAdded:staffUsersToBeAdded}=Object(index_esm.useValues)(staffUsersLogic),{setStaffUsersToBeAdded:setStaffUsersToBeAdded,addStaffUsers:addStaffUsers,deleteStaffUser:deleteStaffUser}=Object(index_esm.useActions)(staffUsersLogic),columns=[{key:"profile_picture",render:function ProfilePictureRender(_,user){return Object(jsx_runtime.jsx)(ProfilePicture.b,{name:user.first_name,email:user.email})},width:32},{key:"name",title:"Name",dataIndex:"first_name",render:function ProfilePictureRender(_,user){return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[user.first_name,user.uuid===(null==myself?void 0:myself.uuid)&&Object(jsx_runtime.jsx)(LemonTag.a,{className:"uppercase ml-1",children:"Me"})]})}},{key:"email",title:"Email",dataIndex:"email"},{key:"actions",width:32,render:function RenderActions(_,user){return Object(jsx_runtime.jsx)(LemonButton.a,{"data-attr":"invite-delete",icon:Object(jsx_runtime.jsx)(icons.N,{}),status:"danger",disabled:staffUsers.length<2,title:staffUsers.length<2?"You should always have at least one staff user.":"Cancel the invite",onClick:()=>{modal.a.confirm({title:`Remove ${(null==myself?void 0:myself.uuid)===user.uuid?"yourself":user.first_name} as a Staff User?`,icon:null,okText:"Remove user",okType:"primary",okButtonProps:{className:"btn-danger"},content:Object(jsx_runtime.jsx)("div",{style:{border:""},children:(null==myself?void 0:myself.uuid)===user.uuid?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Please confirm you want to ",Object(jsx_runtime.jsx)("b",{children:"remove yourself"})," as a staff user.",Object(jsx_runtime.jsx)("div",{style:{fontWeight:"normal",color:"var(--muted-alt)"},children:"Only another staff user will be able to add you again."})]}):`Are you sure you want to remove ${user.first_name} as a Staff User?`}),onOk(){deleteStaffUser(user.uuid)},cancelText:"Cancel"})}})}}];return Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Staff Users"}),Object(jsx_runtime.jsxs)("div",{className:"mb-4",children:["Users who have permissions to manage instance-wide settings. Staff user permissions are set at the"," ",Object(jsx_runtime.jsx)("b",{children:"instance-level and are independent of any organization or project permissions."})," ",Object(jsx_runtime.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings#staff-users",target:"_blank",children:["Learn more ",Object(jsx_runtime.jsx)(icons.Ub,{style:{verticalAlign:"middle"}})]}),"."]}),Object(jsx_runtime.jsx)(divider.a,{style:{margin:0,marginBottom:16}}),Object(jsx_runtime.jsx)("section",{children:Object(jsx_runtime.jsxs)("div",{className:"flex gap-2 mb-4",children:[Object(jsx_runtime.jsx)("div",{style:{flex:1},children:Object(jsx_runtime.jsx)(LemonSelectMultiple.a,{placeholder:"Add staff users here…",loading:allUsersLoading,value:staffUsersToBeAdded,onChange:newValues=>setStaffUsersToBeAdded(newValues),filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:Object(UserSelectItem.a)(nonStaffUsers,"uuid")})}),Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",loading:allUsersLoading,disabled:0===staffUsersToBeAdded.length,onClick:addStaffUsers,children:"Add"})]})}),Object(jsx_runtime.jsx)(LemonTable.a,{dataSource:staffUsers,columns:columns,loading:allUsersLoading,rowKey:"uuid"})]})}var featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),es_row=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/row/index.js"),col=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/col/index.js"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.tsx"),kea_forms_lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.0/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js");const kafkaInspectorLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","instance","SystemStatus","kafkaInspectorLogic"]),Object(index_esm.actions)({fetchKafkaMessage:(topic,partition,offset)=>({topic:topic,partition:partition,offset:offset})}),Object(kea_loaders_lib.loaders)({kafkaMessage:[null,{fetchKafkaMessage:async _ref=>{let{topic:topic,partition:partition,offset:offset}=_ref;return await api.b.create("api/kafka_inspector/fetch_message",{topic:topic,partition:partition,offset:offset})}}]}),Object(kea_forms_lib.forms)((_ref2=>{let{actions:actions}=_ref2;return{fetchKafkaMessage:{defaults:{topic:"clickhouse_events_json",partition:0,offset:0},submit:_ref3=>{let{topic:topic,partition:partition,offset:offset}=_ref3;actions.fetchKafkaMessage(topic,Number(partition),Number(offset))}}}}))]);var LemonInput=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx");function KafkaInspectorTab(){const{kafkaMessage:kafkaMessage}=Object(index_esm.useValues)(kafkaInspectorLogic);return Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Kafka Inspector"}),Object(jsx_runtime.jsx)("div",{className:"mb-4",children:"Debug Kafka messages using the inspector tool."}),Object(jsx_runtime.jsx)(divider.a,{style:{margin:0,marginBottom:16}}),Object(jsx_runtime.jsx)("section",{children:Object(jsx_runtime.jsx)("div",{style:{display:"flex",marginBottom:"0.75rem"},children:Object(jsx_runtime.jsx)(kea_forms_lib.Form,{logic:kafkaInspectorLogic,formKey:"fetchKafkaMessage",className:"ant-form-horizontal ant-form-hide-required-mark",enableFormOnSubmit:!0,children:Object(jsx_runtime.jsxs)(es_row.a,{gutter:[24,24],children:[Object(jsx_runtime.jsx)(col.a,{span:8,children:Object(jsx_runtime.jsx)(kea_forms_lib.Field,{name:"topic",children:Object(jsx_runtime.jsx)(LemonInput.a,{placeholder:"Topic"})})}),Object(jsx_runtime.jsxs)(col.a,{span:4,children:[Object(jsx_runtime.jsx)(kea_forms_lib.Field,{name:"partition",children:Object(jsx_runtime.jsx)(LemonInput.a,{placeholder:"Partition",type:"number"})})," "]}),Object(jsx_runtime.jsxs)(col.a,{span:4,children:[Object(jsx_runtime.jsx)(kea_forms_lib.Field,{name:"offset",children:Object(jsx_runtime.jsx)(LemonInput.a,{placeholder:"Offset",type:"number"})})," "]}),Object(jsx_runtime.jsx)(col.a,{span:6,children:Object(jsx_runtime.jsxs)(es_button.a,{htmlType:"submit",type:"primary","data-attr":"fetch-kafka-message-submit-button",children:["Fetch message"," "]})})]})})})}),Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JSON,children:kafkaMessage?JSON.stringify(kafkaMessage,null,4):"\n"})]})}const scene={component:SystemStatus_SystemStatus,logic:systemStatusLogic.b};function SystemStatus_SystemStatus(){const{tab:tab,error:error}=Object(index_esm.useValues)(systemStatusLogic.b),{setTab:setTab}=Object(index_esm.useActions)(systemStatusLogic.b),{preflight:preflight,siteUrlMisconfigured:siteUrlMisconfigured}=Object(index_esm.useValues)(preflightLogic.a),{user:user}=Object(index_esm.useValues)(userLogic.a),{featureFlags:featureFlags}=Object(index_esm.useValues)(featureFlagLogic.a);return Object(jsx_runtime.jsxs)("div",{className:"system-status-scene",children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:"Instance status & settings",caption:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Here you can find all the critical runtime details and settings of your PostHog instance. You have access to this because you're a ",Object(jsx_runtime.jsx)("b",{children:"staff user"}),"."," ",Object(jsx_runtime.jsxs)("a",{target:"_blank",style:{display:"inline-flex",alignItems:"center"},href:"https://posthog.com/docs/self-host/configure/instance-settings?utm_medium=in-product&utm_campaign=instance_status",children:["Learn more ",Object(jsx_runtime.jsx)(icons.Ub,{style:{marginLeft:4}})]}),"."]})}),error&&Object(jsx_runtime.jsx)(es_alert.a,{message:"Something went wrong",description:error||Object(jsx_runtime.jsx)("span",{children:"An unknown error occurred. Please try again or contact us."}),type:"error",showIcon:!0}),siteUrlMisconfigured&&Object(jsx_runtime.jsx)(es_alert.a,{message:"Misconfiguration detected",description:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Your ",Object(jsx_runtime.jsx)("code",{children:"SITE_URL"})," environment variable seems misconfigured. Your"," ",Object(jsx_runtime.jsx)("code",{children:"SITE_URL"})," is set to"," ",Object(jsx_runtime.jsx)("b",{children:Object(jsx_runtime.jsx)("code",{children:null==preflight?void 0:preflight.site_url})})," ","but you're currently browsing this page from"," ",Object(jsx_runtime.jsx)("b",{children:Object(jsx_runtime.jsx)("code",{children:window.location.origin})}),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."," ",Object(jsx_runtime.jsxs)("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig",children:["Learn more ",Object(jsx_runtime.jsx)(icons.Ub,{})]})]}),showIcon:!0,type:"warning",style:{marginBottom:32}}),Object(jsx_runtime.jsxs)(tabs.a,{tabPosition:"top",animated:!1,activeKey:tab,onTabClick:key=>setTab(key),children:[Object(jsx_runtime.jsx)(tabs.a.TabPane,{tab:"System overview",children:Object(jsx_runtime.jsx)(OverviewTab,{})},"overview"),(null==user?void 0:user.is_staff)&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(tabs.a.TabPane,{tab:"Internal metrics",children:Object(jsx_runtime.jsx)(InternalMetricsTab,{})},"metrics"),Object(jsx_runtime.jsx)(tabs.a.TabPane,{tab:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Settings"," ",Object(jsx_runtime.jsx)(LemonTag.a,{type:"warning",className:"uppercase",children:"Beta"})]}),children:Object(jsx_runtime.jsx)(InstanceConfigTab,{})},"settings")]}),(null==user?void 0:user.is_staff)&&Object(jsx_runtime.jsx)(tabs.a.TabPane,{tab:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Staff Users"}),children:Object(jsx_runtime.jsx)(StaffUsersTab,{})},"staff_users"),(null==user?void 0:user.is_staff)&&featureFlags[constants.i.KAFKA_INSPECTOR]&&Object(jsx_runtime.jsx)(tabs.a.TabPane,{tab:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Kafka Inspector"," ",Object(jsx_runtime.jsx)(LemonTag.a,{type:"warning",className:"uppercase",children:"Beta"})]}),children:Object(jsx_runtime.jsx)(KafkaInspectorTab,{})},"kafka_inspector")]})]})}},"./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ConfigMode})),__webpack_require__.d(__webpack_exports__,"b",(function(){return systemStatusLogic}));var lib_api__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/lib/api.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),scenes_organizationLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/organizationLogic.tsx"),lib_constants__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/constants.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/utils.tsx"),lib_lemon_ui_lemonToast__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/lemon-ui/lemonToast.tsx"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts");let ConfigMode;!function(ConfigMode){ConfigMode.View="view",ConfigMode.Edit="edit",ConfigMode.Saving="saving"}(ConfigMode||(ConfigMode={}));const EDITABLE_INSTANCE_SETTINGS=["RECORDINGS_TTL_WEEKS","RECORDINGS_PERFORMANCE_EVENTS_TTL_WEEKS","EMAIL_ENABLED","EMAIL_HOST","EMAIL_PORT","EMAIL_HOST_USER","EMAIL_HOST_PASSWORD","EMAIL_USE_TLS","EMAIL_USE_SSL","EMAIL_DEFAULT_FROM","EMAIL_REPLY_TO","AGGREGATE_BY_DISTINCT_IDS_TEAMS","PERSON_ON_EVENTS_ENABLED","GROUPS_ON_EVENTS_ENABLED","STRICT_CACHING_TEAMS","SLACK_APP_CLIENT_ID","SLACK_APP_CLIENT_SECRET","SLACK_APP_SIGNING_SECRET","PARALLEL_DASHBOARD_ITEM_CACHE","RATE_LIMIT_ENABLED","RATE_LIMITING_ALLOW_LIST_TEAMS","SENTRY_AUTH_TOKEN","SENTRY_ORGANIZATION"],systemStatusLogic=Object(kea__WEBPACK_IMPORTED_MODULE_1__.kea)({path:["scenes","instance","SystemStatus","systemStatusLogic"],actions:{setTab:tab=>({tab:tab}),setOpenSections:sections=>({sections:sections}),setAnalyzeModalOpen:isOpen=>({isOpen:isOpen}),setAnalyzeQuery:query=>({query:query}),openAnalyzeModalWithQuery:query=>({query:query}),setInstanceConfigMode:mode=>({mode:mode}),updateInstanceConfigValue:(key,value)=>({key:key,value:value}),clearInstanceConfigEditing:!0,saveInstanceConfig:!0,setUpdatedInstanceConfigCount:count=>({count:count}),increaseUpdatedInstanceConfigCount:!0},loaders:_ref=>{let{values:values}=_ref;return{systemStatus:[null,{loadSystemStatus:async()=>{var _preflightLogic$value,_userLogic$values$use,_await$api$get$result;return Object(lib_utils__WEBPACK_IMPORTED_MODULE_6__.lb)()&&(null===(_preflightLogic$value=scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_3__.a.values.preflight)||void 0===_preflightLogic$value||!_preflightLogic$value.cloud||null!==(_userLogic$values$use=scenes_userLogic__WEBPACK_IMPORTED_MODULE_2__.a.values.user)&&void 0!==_userLogic$values$use&&_userLogic$values$use.is_staff)&&null!==(_await$api$get$result=(await lib_api__WEBPACK_IMPORTED_MODULE_0__.b.get("api/instance_status")).results)&&void 0!==_await$api$get$result?_await$api$get$result:null}}],instanceSettings:[[],{loadInstanceSettings:async()=>{var _await$api$get$result2;return null!==(_await$api$get$result2=(await lib_api__WEBPACK_IMPORTED_MODULE_0__.b.get("api/instance_settings")).results)&&void 0!==_await$api$get$result2?_await$api$get$result2:[]}}],queries:[null,{loadQueries:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_0__.b.get("api/instance_status/queries")).results}],analyzeQueryResult:[null,{setAnalyzeModalOpen:()=>null,runAnalyzeQuery:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_0__.b.create("api/instance_status/analyze_ch_query",{query:values.analyzeQuery})).results}]}},reducers:{tab:["overview",{setTab:(_,_ref2)=>{let{tab:tab}=_ref2;return tab}}],error:[null,{loadSystemStatusFailure:(_,_ref3)=>{let{error:error}=_ref3;return error}}],openSections:[["0"],{persist:!0},{setOpenSections:(_,_ref4)=>{let{sections:sections}=_ref4;return sections}}],analyzeModalOpen:[!1,{setAnalyzeModalOpen:(_,_ref5)=>{let{isOpen:isOpen}=_ref5;return isOpen},openAnalyzeModalWithQuery:()=>!0}],analyzeQuery:["",{setAnalyzeQuery:(_,_ref6)=>{let{query:query}=_ref6;return query},openAnalyzeModalWithQuery:(_,_ref7)=>{let{query:query}=_ref7;return query}}],instanceConfigMode:[ConfigMode.View,{setInstanceConfigMode:(_,_ref8)=>{let{mode:mode}=_ref8;return mode}}],instanceConfigEditingState:[{},{updateInstanceConfigValue:(s,_ref9)=>{let{key:key,value:value}=_ref9;if(void 0!==value)return{...s,[key]:value};const newState={...s};return delete newState[key],newState},clearInstanceConfigEditing:()=>({})}],updatedInstanceConfigCount:[null,{setUpdatedInstanceConfigCount:(_,_ref10)=>{let{count:count}=_ref10;return count},loadInstanceSettings:()=>null,increaseUpdatedInstanceConfigCount:state=>(null!=state?state:0)+1}]},selectors:()=>({overview:[s=>[s.systemStatus],status=>status?status.overview:[]],showAnalyzeQueryButton:[()=>[scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_3__.a.selectors.preflight,scenes_organizationLogic__WEBPACK_IMPORTED_MODULE_4__.a.selectors.currentOrganization,scenes_userLogic__WEBPACK_IMPORTED_MODULE_2__.a.selectors.user],(preflight,org,user)=>null!=preflight&&preflight.cloud?!(null==user||!user.is_staff):!(null==org||!org.membership_level)&&org.membership_level>=lib_constants__WEBPACK_IMPORTED_MODULE_5__.p.Admin],editableInstanceSettings:[s=>[s.instanceSettings],instanceSettings=>instanceSettings.filter((item=>item.editable&&EDITABLE_INSTANCE_SETTINGS.includes(item.key)))]}),listeners:_ref11=>{let{actions:actions,values:values}=_ref11;return{setTab:_ref12=>{let{tab:tab}=_ref12;"metrics"===tab&&actions.loadQueries(),actions.setInstanceConfigMode(ConfigMode.View)},updateInstanceConfigValue:_ref13=>{var _values$editableInsta;let{key:key,value:value}=_ref13;const previousValue=null===(_values$editableInsta=values.editableInstanceSettings.find((item=>item.key===key)))||void 0===_values$editableInsta?void 0:_values$editableInsta.value;value&&previousValue==value&&actions.updateInstanceConfigValue(key,void 0)},saveInstanceConfig:async(_,breakpoint)=>{actions.setUpdatedInstanceConfigCount(0),Object.entries(values.instanceConfigEditingState).map((async _ref14=>{let[key,value]=_ref14;try{await lib_api__WEBPACK_IMPORTED_MODULE_0__.b.update(`api/instance_settings/${key}`,{value:value}),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_8__.e.actions.reportInstanceSettingChange(key,value),actions.increaseUpdatedInstanceConfigCount()}catch{lib_lemon_ui_lemonToast__WEBPACK_IMPORTED_MODULE_7__.d.error("There was an error updating instance settings – please try again"),await breakpoint(1e3),actions.loadInstanceSettings()}})),await breakpoint(1e3),values.updatedInstanceConfigCount===Object.keys(values.instanceConfigEditingState).length&&(actions.loadInstanceSettings(),actions.clearInstanceConfigEditing(),actions.setInstanceConfigMode(ConfigMode.View),lib_lemon_ui_lemonToast__WEBPACK_IMPORTED_MODULE_7__.d.success("Instance settings updated"))}}},events:_ref15=>{let{actions:actions}=_ref15;return{afterMount:()=>{actions.loadSystemStatus()}}},actionToUrl:_ref16=>{let{values:values}=_ref16;return{setTab:()=>"/instance/"+("overview"===values.tab?"status":values.tab)}},urlToAction:_ref17=>{let{actions:actions,values:values}=_ref17;return{"/instance(/:tab)":_ref18=>{let{tab:tab}=_ref18;const currentTab=tab&&["metrics","settings","staff_users","kafka_inspector"].includes(tab)?tab:"overview";currentTab!==values.tab&&actions.setTab(currentTab)}}}})},"./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/collapse/index.js":function(module,__webpack_exports__,__webpack_require__){"use strict";var esm_extends=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/extends.js"),defineProperty=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),toConsumableArray=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"),classCallCheck=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),createClass=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/createClass.js"),inherits=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/inherits.js"),createSuper=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/createSuper.js"),classnames=__webpack_require__("./node_modules/.pnpm/classnames@2.3.2/node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),shallowequal=__webpack_require__("./node_modules/.pnpm/shallowequal@1.1.0/node_modules/shallowequal/index.js"),shallowequal_default=__webpack_require__.n(shallowequal),toArray=__webpack_require__("./node_modules/.pnpm/rc-util@5.24.4_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/rc-util/es/Children/toArray.js"),es=__webpack_require__("./node_modules/.pnpm/rc-motion@2.6.2_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/rc-motion/es/index.js"),slicedToArray=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),PanelContent=react.forwardRef((function(props,ref){var _classnames,prefixCls=props.prefixCls,forceRender=props.forceRender,className=props.className,style=props.style,children=props.children,isActive=props.isActive,role=props.role,_React$useState=react.useState(isActive||forceRender),_React$useState2=Object(slicedToArray.a)(_React$useState,2),rendered=_React$useState2[0],setRendered=_React$useState2[1];return react.useEffect((function(){(forceRender||isActive)&&setRendered(!0)}),[forceRender,isActive]),rendered?react.createElement("div",{ref:ref,className:classnames_default()("".concat(prefixCls,"-content"),(_classnames={},Object(defineProperty.a)(_classnames,"".concat(prefixCls,"-content-active"),isActive),Object(defineProperty.a)(_classnames,"".concat(prefixCls,"-content-inactive"),!isActive),_classnames),className),style:style,role:role},react.createElement("div",{className:"".concat(prefixCls,"-content-box")},children)):null}));PanelContent.displayName="PanelContent";var es_PanelContent=PanelContent,Panel_CollapsePanel=function(_React$Component){Object(inherits.a)(CollapsePanel,_React$Component);var _super=Object(createSuper.a)(CollapsePanel);function CollapsePanel(){var _this;return Object(classCallCheck.a)(this,CollapsePanel),(_this=_super.apply(this,arguments)).handleItemClick=function(){var _this$props=_this.props,onItemClick=_this$props.onItemClick,panelKey=_this$props.panelKey;"function"==typeof onItemClick&&onItemClick(panelKey)},_this.handleKeyPress=function(e){"Enter"!==e.key&&13!==e.keyCode&&13!==e.which||_this.handleItemClick()},_this}return Object(createClass.a)(CollapsePanel,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps){return!shallowequal_default()(this.props,nextProps)}},{key:"render",value:function render(){var _classNames,_classNames2,_this2=this,_this$props2=this.props,className=_this$props2.className,id=_this$props2.id,style=_this$props2.style,prefixCls=_this$props2.prefixCls,header=_this$props2.header,headerClass=_this$props2.headerClass,children=_this$props2.children,isActive=_this$props2.isActive,showArrow=_this$props2.showArrow,destroyInactivePanel=_this$props2.destroyInactivePanel,accordion=_this$props2.accordion,forceRender=_this$props2.forceRender,openMotion=_this$props2.openMotion,expandIcon=_this$props2.expandIcon,extra=_this$props2.extra,collapsible=_this$props2.collapsible,disabled="disabled"===collapsible,headerCls=classnames_default()("".concat(prefixCls,"-header"),(_classNames={},Object(defineProperty.a)(_classNames,headerClass,headerClass),Object(defineProperty.a)(_classNames,"".concat(prefixCls,"-header-collapsible-only"),"header"===collapsible),_classNames)),itemCls=classnames_default()((_classNames2={},Object(defineProperty.a)(_classNames2,"".concat(prefixCls,"-item"),!0),Object(defineProperty.a)(_classNames2,"".concat(prefixCls,"-item-active"),isActive),Object(defineProperty.a)(_classNames2,"".concat(prefixCls,"-item-disabled"),disabled),_classNames2),className),icon=react.createElement("i",{className:"arrow"});return showArrow&&"function"==typeof expandIcon&&(icon=expandIcon(this.props)),react.createElement("div",{className:itemCls,style:style,id:id},react.createElement("div",{className:headerCls,onClick:function onClick(){return"header"!==collapsible&&_this2.handleItemClick()},role:accordion?"tab":"button",tabIndex:disabled?-1:0,"aria-expanded":isActive,onKeyPress:this.handleKeyPress},showArrow&&icon,"header"===collapsible?react.createElement("span",{onClick:this.handleItemClick,className:"".concat(prefixCls,"-header-text")},header):header,extra&&react.createElement("div",{className:"".concat(prefixCls,"-extra")},extra)),react.createElement(es.default,Object.assign({visible:isActive,leavedClassName:"".concat(prefixCls,"-content-hidden")},openMotion,{forceRender:forceRender,removeOnLeave:destroyInactivePanel}),(function(_ref,ref){var motionClassName=_ref.className,motionStyle=_ref.style;return react.createElement(es_PanelContent,{ref:ref,prefixCls:prefixCls,className:motionClassName,style:motionStyle,isActive:isActive,forceRender:forceRender,role:accordion?"tabpanel":null},children)})))}}]),CollapsePanel}(react.Component);Panel_CollapsePanel.defaultProps={showArrow:!0,isActive:!1,onItemClick:function onItemClick(){},headerClass:"",forceRender:!1};var Panel=Panel_CollapsePanel;function getActiveKeysArray(activeKey){var currentActiveKey=activeKey;return Array.isArray(currentActiveKey)||(currentActiveKey=currentActiveKey?[currentActiveKey]:[]),currentActiveKey.map((function(key){return String(key)}))}var Collapse_Collapse=function(_React$Component){Object(inherits.a)(Collapse,_React$Component);var _super=Object(createSuper.a)(Collapse);function Collapse(props){var _this;Object(classCallCheck.a)(this,Collapse),(_this=_super.call(this,props)).onClickItem=function(key){var activeKey=_this.state.activeKey;if(_this.props.accordion)activeKey=activeKey[0]===key?[]:[key];else{var index=(activeKey=Object(toConsumableArray.a)(activeKey)).indexOf(key);index>-1?activeKey.splice(index,1):activeKey.push(key)}_this.setActiveKey(activeKey)},_this.getNewChild=function(child,index){if(!child)return null;var activeKey=_this.state.activeKey,_this$props=_this.props,prefixCls=_this$props.prefixCls,openMotion=_this$props.openMotion,accordion=_this$props.accordion,rootDestroyInactivePanel=_this$props.destroyInactivePanel,expandIcon=_this$props.expandIcon,collapsible=_this$props.collapsible,key=child.key||String(index),_child$props=child.props,header=_child$props.header,headerClass=_child$props.headerClass,destroyInactivePanel=_child$props.destroyInactivePanel,childCollapsible=_child$props.collapsible,mergeCollapsible=null!=childCollapsible?childCollapsible:collapsible,props={key:key,panelKey:key,header:header,headerClass:headerClass,isActive:accordion?activeKey[0]===key:activeKey.indexOf(key)>-1,prefixCls:prefixCls,destroyInactivePanel:null!=destroyInactivePanel?destroyInactivePanel:rootDestroyInactivePanel,openMotion:openMotion,accordion:accordion,children:child.props.children,onItemClick:"disabled"===mergeCollapsible?null:_this.onClickItem,expandIcon:expandIcon,collapsible:mergeCollapsible};return"string"==typeof child.type?child:react.cloneElement(child,props)},_this.getItems=function(){var children=_this.props.children;return Object(toArray.a)(children).map(_this.getNewChild)},_this.setActiveKey=function(activeKey){"activeKey"in _this.props||_this.setState({activeKey:activeKey}),_this.props.onChange(_this.props.accordion?activeKey[0]:activeKey)};var activeKey=props.activeKey,currentActiveKey=props.defaultActiveKey;return"activeKey"in props&&(currentActiveKey=activeKey),_this.state={activeKey:getActiveKeysArray(currentActiveKey)},_this}return Object(createClass.a)(Collapse,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps,nextState){return!shallowequal_default()(this.props,nextProps)||!shallowequal_default()(this.state,nextState)}},{key:"render",value:function render(){var _classNames,_this$props2=this.props,prefixCls=_this$props2.prefixCls,className=_this$props2.className,style=_this$props2.style,accordion=_this$props2.accordion,collapseClassName=classnames_default()((_classNames={},Object(defineProperty.a)(_classNames,prefixCls,!0),Object(defineProperty.a)(_classNames,className,!!className),_classNames));return react.createElement("div",{className:collapseClassName,style:style,role:accordion?"tablist":null},this.getItems())}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps){var newState={};return"activeKey"in nextProps&&(newState.activeKey=getActiveKeysArray(nextProps.activeKey)),newState}}]),Collapse}(react.Component);Collapse_Collapse.defaultProps={prefixCls:"rc-collapse",onChange:function onChange(){},accordion:!1,destroyInactivePanel:!1},Collapse_Collapse.Panel=Panel;var rc_collapse_es=Collapse_Collapse,node_modules_classnames=(Collapse_Collapse.Panel,__webpack_require__("./node_modules/.pnpm/classnames@2.3.1/node_modules/classnames/index.js")),node_modules_classnames_default=__webpack_require__.n(node_modules_classnames),RightOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/RightOutlined.js"),omit=__webpack_require__("./node_modules/.pnpm/rc-util@5.24.4_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/rc-util/es/omit.js"),context=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/config-provider/context.js"),devWarning=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/_util/devWarning.js"),collapse_CollapsePanel=function CollapsePanel(props){Object(devWarning.a)(!("disabled"in props),"Collapse.Panel",'`disabled` is deprecated. Please use `collapsible="disabled"` instead.');var getPrefixCls=react.useContext(context.b).getPrefixCls,customizePrefixCls=props.prefixCls,_props$className=props.className,className=void 0===_props$className?"":_props$className,_props$showArrow=props.showArrow,showArrow=void 0===_props$showArrow||_props$showArrow,prefixCls=getPrefixCls("collapse",customizePrefixCls),collapsePanelClassName=node_modules_classnames_default()(Object(defineProperty.a)({},"".concat(prefixCls,"-no-arrow"),!showArrow),className);return react.createElement(rc_collapse_es.Panel,Object(esm_extends.a)({},props,{prefixCls:prefixCls,className:collapsePanelClassName}))},motion=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/_util/motion.js"),reactNode=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/_util/reactNode.js"),collapse_Collapse_Collapse=function Collapse(props){var _classNames,_React$useContext=react.useContext(context.b),getPrefixCls=_React$useContext.getPrefixCls,direction=_React$useContext.direction,customizePrefixCls=props.prefixCls,_props$className=props.className,className=void 0===_props$className?"":_props$className,_props$bordered=props.bordered,bordered=void 0===_props$bordered||_props$bordered,ghost=props.ghost,prefixCls=getPrefixCls("collapse",customizePrefixCls),iconPosition=function getIconPosition(){var expandIconPosition=props.expandIconPosition;return void 0!==expandIconPosition?expandIconPosition:"rtl"===direction?"right":"left"}(),collapseClassName=node_modules_classnames_default()((_classNames={},Object(defineProperty.a)(_classNames,"".concat(prefixCls,"-borderless"),!bordered),Object(defineProperty.a)(_classNames,"".concat(prefixCls,"-icon-position-").concat(iconPosition),!0),Object(defineProperty.a)(_classNames,"".concat(prefixCls,"-rtl"),"rtl"===direction),Object(defineProperty.a)(_classNames,"".concat(prefixCls,"-ghost"),!!ghost),_classNames),className),openMotion=Object(esm_extends.a)(Object(esm_extends.a)({},motion.a),{motionAppear:!1,leavedClassName:"".concat(prefixCls,"-content-hidden")});return react.createElement(rc_collapse_es,Object(esm_extends.a)({openMotion:openMotion},props,{expandIcon:function renderExpandIcon(){var panelProps=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},expandIcon=props.expandIcon,icon=expandIcon?expandIcon(panelProps):react.createElement(RightOutlined.a,{rotate:panelProps.isActive?90:void 0});return react.createElement("div",null,Object(reactNode.a)(icon,(function(){return{className:node_modules_classnames_default()(icon.props.className,"".concat(prefixCls,"-arrow"))}})))},prefixCls:prefixCls,className:collapseClassName}),function getItems(){var children=props.children;return Object(toArray.a)(children).map((function(child,index){var _a;if(null===(_a=child.props)||void 0===_a?void 0:_a.disabled){var key=child.key||String(index),_child$props=child.props,disabled=_child$props.disabled,collapsible=_child$props.collapsible,childProps=Object(esm_extends.a)(Object(esm_extends.a)({},Object(omit.a)(child.props,["disabled"])),{key:key,collapsible:null!=collapsible?collapsible:disabled?"disabled":void 0});return Object(reactNode.a)(child,childProps)}return child}))}())};collapse_Collapse_Collapse.Panel=collapse_CollapsePanel;var collapse_Collapse=collapse_Collapse_Collapse;__webpack_exports__.a=collapse_Collapse},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}.embedded-svg-wrapper{cursor:text}.embedded-svg-wrapper svg{width:100%;height:100%}",""]),module.exports=exports}}]);