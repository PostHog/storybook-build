(window.webpackJsonp=window.webpackJsonp||[]).push([[246],{"./frontend/src/scenes/instance/SystemStatus/index.tsx":function(P,A,a){"use strict";a.r(A),a.d(A,"scene",function(){return He}),a.d(A,"SystemStatus",function(){return ce});var B=a("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),fe=a.n(B),ye=a("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss"),X=a.n(ye),z={};z.insert="head",z.singleton=!1;var Ye=fe()(X.a,z),$e=X.a.locals||{},L=a("./node_modules/react/index.js"),e=a.n(L),Z=a("./node_modules/antd/es/alert/index.js"),V=a("./node_modules/antd/es/tabs/index.js"),v=a("./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),h=a("./node_modules/kea/lib/index.esm.js"),ge=a("./frontend/src/lib/components/PageHeader.tsx"),q=a("./frontend/src/scenes/PreflightCheck/logic.tsx"),j=a("./frontend/src/lib/components/icons.tsx"),We=a("./node_modules/core-js/modules/es.array.map.js"),_=a("./node_modules/antd/es/card/index.js"),Q=a("./node_modules/antd/es/table/index.js"),ee=a("./frontend/src/lib/components/Link.tsx"),Ge=a("./node_modules/core-js/modules/es.array.iterator.js"),Je=a("./node_modules/core-js/modules/es.object.to-string.js"),Xe=a("./node_modules/core-js/modules/es.regexp.to-string.js"),Ze=a("./node_modules/core-js/modules/es.set.js"),qe=a("./node_modules/core-js/modules/es.string.iterator.js"),_e=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),I=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),K=a("./frontend/src/lib/utils.tsx"),ve=new Set(["last_event_ingested_timestamp"]);function T(t){var s=t.key,n=t.value,r=t.value_type,o=t.emptyNullLabel,i=t.isSecret;return n&&i?e.a.createElement(I.a,{style:{color:"var(--text-muted)",backgroundColor:"#fee5b3"},icon:i?e.a.createElement(j.IconLock,{style:{color:"var(--warning)"}}):void 0},"Secret"):ve.has(s)&&typeof n=="string"?new Date(n).getTime()===new Date("1970-01-01T00:00:00").getTime()?"Never":Object(K.M)(n):r==="bool"||typeof n=="boolean"?e.a.createElement(I.a,{type:n?"success":"danger"},n?"Yes":"No"):n==null||n===""?e.a.createElement(I.a,{style:{color:"var(--text-muted)"}},o!=null?o:"Unknown"):r==="int"||typeof n=="number"?n.toLocaleString("en-US"):n.toString()}try{T.displayName="RenderMetricValue",T.__docgenInfo={description:"",displayName:"RenderMetricValue",props:{emptyNullLabel:{defaultValue:null,description:"",name:"emptyNullLabel",required:!1,type:{name:"string"}},isSecret:{defaultValue:null,description:"",name:"isSecret",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string | number | boolean | null"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},value_type:{defaultValue:null,description:"",name:"value_type",required:!1,type:{name:"enum",value:[{value:'"bool"'},{value:'"str"'},{value:'"int"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/RenderMetricValue.tsx#RenderMetricValue"]={docgenInfo:T.__docgenInfo,name:"RenderMetricValue",path:"frontend/src/scenes/instance/SystemStatus/RenderMetricValue.tsx#RenderMetricValue"})}catch(t){}var te={async_migrations_ok:"/instance/async_migrations"};function pe(t){return e.a.createElement("span",null,t.metric," ",te[t.key]?e.a.createElement(ee.a,{to:te[t.key]},e.a.createElement(j.IconOpenInNew,{style:{verticalAlign:"middle"}})):null)}function he(){var t=Object(h.useValues)(v.b),s=t.overview,n=t.systemStatusLoading,r=[{title:"Metric",className:"metric-column",render:pe},{title:"Value",render:T}];return e.a.createElement(e.a.Fragment,null,e.a.createElement(_.a,null,e.a.createElement("h3",{className:"l3"},"Key metrics"),e.a.createElement(Q.a,{className:"system-status-table",size:"small",rowKey:"metric",pagination:!1,dataSource:s,columns:r,loading:n,expandable:{expandedRowRender:function(i){return i.subrows?e.a.createElement(Ee,i.subrows):null},rowExpandable:function(i){return!!i.subrows&&i.subrows.rows.length>0},expandRowByClick:!0}})))}function Ee(t){return e.a.createElement(Q.a,{rowKey:"metric",pagination:!1,dataSource:t.rows,columns:t.columns.map(function(s,n){return{title:s,dataIndex:n}})})}var et=a("./node_modules/core-js/modules/es.array.filter.js"),tt=a("./node_modules/core-js/modules/es.array.for-each.js"),nt=a("./node_modules/core-js/modules/es.object.keys.js"),at=a("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Se=a("./node_modules/@babel/runtime/helpers/objectDestructuringEmpty.js"),be=a.n(Se),je=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),D=a.n(je),x=a("./node_modules/antd/es/collapse/index.js"),ne=a("./node_modules/antd/es/checkbox/index.js"),C=a("./node_modules/antd/es/button/index.js"),F=a("./node_modules/@ant-design/icons/es/icons/ReloadOutlined.js"),Ce=a("./frontend/src/scenes/dashboard/Dashboard.tsx"),Oe=a("./frontend/src/types.ts"),rt=a("./node_modules/core-js/modules/es.object.entries.js"),H=a("./node_modules/antd/es/modal/index.js"),ae=a("./node_modules/antd/es/input/index.js");function Ae(){var t=Object(h.useValues)(v.b),s=t.analyzeModalOpen,n=t.analyzeQuery,r=t.analyzeQueryResult,o=t.analyzeQueryResultLoading,i=Object(h.useActions)(v.b),u=i.setAnalyzeModalOpen,m=i.setAnalyzeQuery,d=i.runAnalyzeQuery;return e.a.createElement(H.a,{visible:s,title:"Analyze ClickHouse query performance",footer:e.a.createElement(e.a.Fragment,null,e.a.createElement(C.a,{onClick:function(){return u(!1)}},"Cancel"),e.a.createElement(C.a,{type:"primary",onClick:function(){return void d()},disabled:o},"Analyze")),onCancel:function(){return u(!1)},width:"80%"},e.a.createElement(ae.a.TextArea,{placeholder:"SQL query to analyze",onChange:function(f){return m(f.target.value)},value:n,rows:10}),r&&e.a.createElement("div",{style:{marginTop:30}},e.a.createElement("h2",null,"Analysis results"),e.a.createElement("ul",null,Object.entries(r.timing).map(function(l){var f=D()(l,2),y=f[0],c=f[1];return e.a.createElement("li",{key:y},y,": ",c)})),Object.entries(r.flamegraphs).map(function(l){var f=D()(l,2),y=f[0],c=f[1];return e.a.createElement("div",{key:y},e.a.createElement("h3",null,"Flamegraph: ",y),e.a.createElement("a",{className:"embedded-svg-wrapper",href:"data:image/svg+xml;utf8,".concat(encodeURIComponent(c)),dangerouslySetInnerHTML:{__html:c}}))})))}function Ie(){var t=Object(h.useValues)(v.b),s=t.openSections,n=t.systemStatus,r=t.queries,o=t.queriesLoading,i=t.showAnalyzeQueryButton,u=Object(h.useActions)(v.b),m=u.setOpenSections,d=u.loadQueries,l=Object(L.useState)(!1),f=D()(l,2),y=f[0],c=f[1],E=Object(L.useMemo)(function(){var b;return r==null||(b=r.postgres_running)===null||b===void 0?void 0:b.filter(function(p){var N=p.state;return y||N!=="idle"})},[y,r]),g=n==null?void 0:n.internal_metrics.clickhouse,S=function(p){p.stopPropagation(),d()};return e.a.createElement(_.a,null,e.a.createElement(x.a,{activeKey:s,onChange:function(p){return m(p)}},g?e.a.createElement(x.a.Panel,{header:"Dashboards",key:"0"},e.a.createElement(Ce.Dashboard,{id:g.id.toString(),shareToken:g.share_token,placement:Oe.f.InternalMetrics})):null,e.a.createElement(x.a.Panel,{header:"PostgreSQL - currently running queries",key:"1"},e.a.createElement("div",{className:"mb float-right"},e.a.createElement(ne.a,{checked:y,onChange:function(p){c(p.target.checked)}},"Show idle queries"),e.a.createElement(C.a,{style:{marginLeft:8},onClick:S},e.a.createElement(F.a,null)," Reload Queries")),e.a.createElement(Y,{queries:E,loading:o})),(r==null?void 0:r.clickhouse_running)!=null?e.a.createElement(x.a.Panel,{header:"Clickhouse - currently running queries",key:"2"},e.a.createElement("div",{className:"mb float-right"},e.a.createElement(C.a,{style:{marginLeft:8},onClick:S},e.a.createElement(F.a,null)," Reload Queries")),e.a.createElement(Y,{queries:r==null?void 0:r.clickhouse_running,loading:o,showAnalyze:i})):null,(r==null?void 0:r.clickhouse_slow_log)!=null?e.a.createElement(x.a.Panel,{header:"Clickhouse - slow query log (past 6 hours)",key:"3"},e.a.createElement("div",{className:"mb float-right"},e.a.createElement(C.a,{style:{marginLeft:8},onClick:S},e.a.createElement(F.a,null)," Reload Queries")),e.a.createElement(Y,{queries:r==null?void 0:r.clickhouse_slow_log,loading:o,showAnalyze:i})):null),e.a.createElement(Ae,null))}function Y(t){var s=Object(h.useActions)(v.b),n=s.openAnalyzeModalWithQuery,r=[{title:"duration",dataIndex:"duration",key:"duration",sorter:function(i,u){return+i.duration-+u.duration}},{title:"query",dataIndex:"query",render:function(i,u){return be()(i),t.showAnalyze?e.a.createElement(ee.a,{to:"#",onClick:function(){return n(u.query)}},u.query):u.query},key:"query"}];return t.queries&&t.queries.length>0&&Object.keys(t.queries[0]).forEach(function(o){o!=="duration"&&o!=="query"&&r.push({title:o,dataIndex:o,key:o})}),e.a.createElement(Q.a,{dataSource:t.queries||[],columns:r,loading:t.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",bordered:!0,style:{overflowX:"auto",overflowY:"auto"},locale:{emptyText:"No queries found"}})}var Te=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),Ue=a.n(Te),Ve=a("./frontend/src/lib/components/HotkeyButton/HotkeyButton.tsx"),$=a("./frontend/src/lib/components/LemonTable/index.ts"),xe=a("./frontend/src/lib/hooks/useKeyboardHotkeys.tsx");function k(t){var s=t.key,n=t.value,r=t.value_type,o=t.onValueChanged,i=t.isSecret;if(r==="bool")return e.a.createElement(e.a.Fragment,null,e.a.createElement(ne.a,{defaultChecked:!!n,onChange:function(d){return o(s,d.target.checked)}}),e.a.createElement(I.a,{style:{marginLeft:4},type:n?"success":"danger"},n?"Yes":"No"));var u=i&&n?"":n;return e.a.createElement(ae.a,{defaultValue:u,type:r==="int"?"number":"text",placeholder:i&&n?"Keep existing secret value":void 0,onBlur:function(d){return o(s,d.target.value)}})}try{k.displayName="RenderMetricValueEdit",k.__docgenInfo={description:"",displayName:"RenderMetricValueEdit",props:{onValueChanged:{defaultValue:null,description:"",name:"onValueChanged",required:!0,type:{name:"(key: string, value: any) => void"}},emptyNullLabel:{defaultValue:null,description:"",name:"emptyNullLabel",required:!1,type:{name:"string"}},isSecret:{defaultValue:null,description:"",name:"isSecret",required:!1,type:{name:"boolean"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string | number | boolean | null"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},value_type:{defaultValue:null,description:"",name:"value_type",required:!1,type:{name:"enum",value:[{value:'"bool"'},{value:'"str"'},{value:'"int"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"]={docgenInfo:k.__docgenInfo,name:"RenderMetricValueEdit",path:"frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"})}catch(t){}var Le=a("./node_modules/@ant-design/icons/es/icons/WarningOutlined.js"),st=a("./node_modules/core-js/modules/es.array.find.js"),lt=a("./node_modules/core-js/modules/es.array.includes.js"),ot=a("./node_modules/core-js/modules/es.string.includes.js"),it=a("./node_modules/core-js/modules/es.string.starts-with.js"),re=a("./frontend/src/lib/components/InfoMessage/AlertMessage.tsx");function ke(t){var s=t.metricKey,n=t.oldValue,r=t.value,o=t.isSecret;return(r==null?void 0:r.toString())===(n==null?void 0:n.toString())?null:e.a.createElement("div",{style:{backgroundColor:"var(--border-light)",borderRadius:"var(--radius)",padding:8,marginTop:16}},e.a.createElement("div",null,e.a.createElement("code",null,s)),e.a.createElement("div",{style:{color:"var(--text-muted)"}},"Value will be changed",!o&&e.a.createElement(e.a.Fragment,null," from ",e.a.createElement("span",{style:{color:"var(--text-default)",fontWeight:"bold"}},T({key:s,value:n,emptyNullLabel:"Unset",isSecret:o})))," to ",e.a.createElement("span",{style:{color:"var(--text-default)",fontWeight:"bold"}},T({key:s,value:r,emptyNullLabel:"Unset"})),o&&e.a.createElement("div",{className:"text-danger"},"This field is secret \u2013 you won't see its value once saved")))}function w(t){var s=t.onClose,n=Object(h.useValues)(v.b),r=n.instanceConfigEditingState,o=n.editableInstanceSettings,i=n.updatedInstanceConfigCount,u=Object(h.useActions)(v.b),m=u.saveInstanceConfig,d=i!==null;return e.a.createElement(H.a,{title:"Confirm new changes",visible:!0,okText:"Apply changes",okType:"danger",onCancel:s,maskClosable:!1,onOk:m,okButtonProps:{loading:d},cancelButtonProps:{loading:d},closable:!d},Object.keys(r).find(function(l){return l.startsWith("EMAIL")})&&e.a.createElement(re.a,{style:{marginBottom:16}},e.a.createElement(e.a.Fragment,null,"As you are changing email settings, we'll attempt to send a ",e.a.createElement("b",null,"test email")," so you can verify everything works (unless you are turning email off).")),Object.keys(r).includes("RECORDINGS_TTL_WEEKS")&&e.a.createElement(re.a,{style:{marginBottom:16},type:"warning"},e.a.createElement(e.a.Fragment,null,"Changing your recordings TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately.")),e.a.createElement("div",null,"The following changes will be immediately applied to your instance."),Object.keys(r).map(function(l){var f,y;return e.a.createElement(ke,{key:l,metricKey:l,value:r[l],oldValue:(f=o.find(function(c){return c.key===l}))===null||f===void 0?void 0:f.value,isSecret:(y=o.find(function(c){return c.key===l}))===null||y===void 0?void 0:y.is_secret})}),d&&e.a.createElement("div",{className:"mt text-success"},e.a.createElement("b",null,Object(K.qb)(i||0,"change")," updated successfully.")))}try{w.displayName="InstanceConfigSaveModal",w.__docgenInfo={description:"",displayName:"InstanceConfigSaveModal",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"]={docgenInfo:w.__docgenInfo,name:"InstanceConfigSaveModal",path:"frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"})}catch(t){}function se(t,s){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);s&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function le(t){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?arguments[s]:{};s%2?se(Object(n),!0).forEach(function(r){Ue()(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function we(){var t=Object(h.useValues)(q.a),s=t.configOptions,n=t.preflightLoading,r=Object(h.useValues)(v.b),o=r.editableInstanceSettings,i=r.instanceSettingsLoading,u=r.instanceConfigMode,m=r.instanceConfigEditingState,d=Object(h.useActions)(v.b),l=d.loadInstanceSettings,f=d.setInstanceConfigMode,y=d.updateInstanceConfigValue,c=d.clearInstanceConfigEditing;Object(xe.a)({e:{action:function(){return f(v.a.Edit)},disabled:u!==v.a.View||i},escape:{action:function(){return g()},disabled:u!==v.a.Edit||i},enter:{action:function(){return E()},disabled:u!==v.a.Edit||i}});var E=function(){Object.keys(m).length?f(v.a.Saving):f(v.a.View)},g=function(){f(v.a.View),c()};Object(L.useEffect)(function(){l()},[]);var S=[{title:"Key",dataIndex:"key",render:function(N){return e.a.createElement("code",null,N)}},{title:"Description",dataIndex:"description"},{title:"Value",render:function(N,U){var J,me={value:U.value,key:U.key,emptyNullLabel:"Unset",value_type:U.value_type,isSecret:U.is_secret};return u===v.a.View?T(me):k(le(le({},me),{},{value:(J=m[U.key])!==null&&J!==void 0?J:U.value,onValueChanged:y}))},width:300}],b=[{key:"metric",title:"Metric",dataIndex:"metric"},{title:"Value",dataIndex:"value"}];return e.a.createElement("div",null,e.a.createElement("div",{className:"flex-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("h3",{className:"l3",style:{marginTop:16}},"Instance configuration"),e.a.createElement("div",{className:"mb"},"Changing these settings will take effect on your entire instance."," ",e.a.createElement("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings",target:"_blank"},"Learn more ",e.a.createElement(j.IconOpenInNew,{style:{verticalAlign:"middle"}})),".")),u===v.a.View?e.a.createElement(e.a.Fragment,null,e.a.createElement(Ve.a,{type:"primary",onClick:function(){return f(v.a.Edit)},"data-attr":"instance-config-edit-button",hotkey:"e",disabled:i},"Edit")):e.a.createElement(e.a.Fragment,null,Object.keys(m).length>0&&e.a.createElement("span",{style:{color:"var(--warning)"}},e.a.createElement(Le.a,null)," You have ",e.a.createElement("b",null,Object.keys(m).length)," ","unapplied"," ",Object(K.qb)(Object.keys(m).length,"change",void 0,!1)),e.a.createElement(C.a,{type:"link",disabled:i,onClick:g},"Discard changes"),e.a.createElement(C.a,{type:"primary",disabled:i,onClick:E},"Save"))),e.a.createElement($.a,{dataSource:o,columns:S,loading:i,rowKey:"key"}),e.a.createElement("h3",{className:"l3",style:{marginTop:32}},"Environment configuration"),e.a.createElement("div",{className:"mb"},"These settings can only be modified by environment variables."," ",e.a.createElement("a",{href:"https://posthog.com/docs/self-host/configure/environment-variables",target:"_blank"},"Learn more ",e.a.createElement(j.IconOpenInNew,{style:{verticalAlign:"middle"}})),"."),e.a.createElement($.a,{dataSource:s,columns:b,loading:n,rowKey:"key"}),u===v.a.Saving&&e.a.createElement(w,{onClose:function(){return f(v.a.Edit)}}))}var M=a("./frontend/src/scenes/userLogic.ts"),ut=a("./node_modules/core-js/modules/es.array.concat.js"),Me=a("./node_modules/antd/es/divider/index.js"),oe=a("./node_modules/antd/es/select/index.js"),ie=a("./frontend/src/lib/components/ProfilePicture/index.ts"),dt=a("./node_modules/core-js/modules/es.promise.js"),Re=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),W=a.n(Re),Ne=a("./node_modules/@babel/runtime/regenerator/index.js"),O=a.n(Ne),ct=a("./node_modules/regenerator-runtime/runtime.js"),Pe=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),R=a.n(Pe),Be=a("./node_modules/kea-router/lib/index.js"),G=a("./frontend/src/lib/api.ts"),ze=a("./frontend/src/scenes/urls.ts");function Qe(t,s){var n;if(typeof Symbol=="undefined"||t[Symbol.iterator]==null){if(Array.isArray(t)||(n=Ke(t))||s&&t&&typeof t.length=="number"){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,u=!1,m;return{s:function(){n=t[Symbol.iterator]()},n:function(){var l=n.next();return i=l.done,l},e:function(l){u=!0,m=l},f:function(){try{!i&&n.return!=null&&n.return()}finally{if(u)throw m}}}}function Ke(t,s){if(!!t){if(typeof t=="string")return ue(t,s);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ue(t,s)}}function ue(t,s){(s==null||s>t.length)&&(s=t.length);for(var n=0,r=new Array(s);n<s;n++)r[n]=t[n];return r}var de=Object(h.kea)({path:["scenes","instance","SystemStatus","staffUsersLogic"],connect:{values:[M.a,["user"]],actions:[M.a,["loadUser"]]},actions:{setStaffUsersToBeAdded:function(s){return{userUuids:s}},addStaffUsers:!0,deleteStaffUser:function(s){return{userUuid:s}}},reducers:{staffUsersToBeAdded:[[],{setStaffUsersToBeAdded:function(s,n){var r=n.userUuids;return r}}]},loaders:function(s){var n=s.actions,r=s.values;return{allUsers:[[],{loadAllUsers:function(){var o=R()(O.a.mark(function u(){var m;return O.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,G.a.get("api/users");case 2:if(l.t1=m=l.sent.results,l.t0=l.t1!==null,!l.t0){l.next=6;break}l.t0=m!==void 0;case 6:if(!l.t0){l.next=10;break}l.t2=m,l.next=11;break;case 10:l.t2=[];case 11:return l.abrupt("return",l.t2);case 12:case"end":return l.stop()}},u)}));function i(){return o.apply(this,arguments)}return i}(),addStaffUsers:function(){var o=R()(O.a.mark(function u(){var m,d,l,f;return O.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return m=r.staffUsersToBeAdded,d=r.allUsers,n.setStaffUsersToBeAdded([]),c.next=4,Promise.all(m.map(function(){var E=R()(O.a.mark(function g(S){return O.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,G.a.update("api/users/".concat(S),{is_staff:!0});case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},g)}));return function(g){return E.apply(this,arguments)}}()));case 4:return l=c.sent,f=[].concat(W()(d.filter(function(E){var g=E.uuid;return!m.includes(g)})),W()(l)),f.sort(function(E,g){return E.first_name.localeCompare(g.first_name)}),c.abrupt("return",f);case 8:case"end":return c.stop()}},u)}));function i(){return o.apply(this,arguments)}return i}(),deleteStaffUser:function(){var o=R()(O.a.mark(function u(m){var d,l,f,y,c,E;return O.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return l=m.userUuid,S.next=3,G.a.update("api/users/".concat(l),{is_staff:!1});case 3:((d=r.user)===null||d===void 0?void 0:d.uuid)===l&&(n.loadUser(),Be.router.actions.push(ze.a.projectHomepage())),f=W()(r.allUsers),y=Qe(f);try{for(y.s();!(c=y.n()).done;)E=c.value,E.uuid===l&&(E.is_staff=!1)}catch(b){y.e(b)}finally{y.f()}return S.abrupt("return",f);case 8:case"end":return S.stop()}},u)}));function i(u){return o.apply(this,arguments)}return i}()}]}},selectors:{staffUsers:[function(t){return[t.allUsers]},function(t){return t.filter(function(s){return s.is_staff})}],nonStaffUsers:[function(t){return[t.allUsers]},function(t){return t.filter(function(s){return!s.is_staff})}]},events:function(s){var n=s.actions;return{afterMount:[n.loadAllUsers]}}}),De=a("./frontend/src/lib/components/LemonButton/index.ts");function Fe(){var t=Object(h.useValues)(M.a),s=t.user,n=Object(h.useValues)(de),r=n.staffUsers,o=n.allUsersLoading,i=n.nonStaffUsers,u=n.staffUsersToBeAdded,m=Object(h.useActions)(de),d=m.setStaffUsersToBeAdded,l=m.addStaffUsers,f=m.deleteStaffUser,y=[{key:"profile_picture",render:function(E,g){return e.a.createElement(ie.a,{name:g.first_name,email:g.email})},width:32},{key:"name",title:"Name",dataIndex:"first_name",render:function(E,g){return e.a.createElement(e.a.Fragment,null,g.first_name,g.uuid===(s==null?void 0:s.uuid)&&e.a.createElement(I.a,{style:{marginLeft:4}},"Me"))}},{key:"email",title:"Email",dataIndex:"email"},{key:"actions",width:32,render:function(E,g){return e.a.createElement(De.a,{"data-attr":"invite-delete",icon:e.a.createElement(j.IconDelete,null),status:"danger",disabled:r.length<2,title:r.length<2?"You should always have at least one staff user.":"Cancel the invite",onClick:function(){H.a.confirm({title:"Remove ".concat((s==null?void 0:s.uuid)===g.uuid?"yourself":g.first_name," as a Staff User?"),icon:null,okText:"Remove user",okType:"primary",okButtonProps:{className:"btn-danger"},content:e.a.createElement("div",{style:{border:""}},(s==null?void 0:s.uuid)===g.uuid?e.a.createElement(e.a.Fragment,null,"Please confirm you want to ",e.a.createElement("b",null,"remove yourself")," as a staff user.",e.a.createElement("div",{style:{fontWeight:"normal",color:"var(--muted-alt)"}},"Only another staff user will be able to add you again.")):"Are you sure you want to remove ".concat(g.first_name," as a Staff User?")),onOk:function(){f(g.uuid)},cancelText:"Cancel"})}})}}];return e.a.createElement("div",null,e.a.createElement("div",{className:"flex-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("h3",{className:"l3",style:{marginTop:16}},"Staff Users"),e.a.createElement("div",{className:"mb"},"Users who have permissions to manage instance-wide settings. Staff user permissions are set at the ",e.a.createElement("b",null,"instance-level and are independent of any organization or project permissions.")," ",e.a.createElement("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings#staff-users",target:"_blank"},"Learn more ",e.a.createElement(j.IconOpenInNew,{style:{verticalAlign:"middle"}})),"."))),e.a.createElement(Me.a,{style:{margin:0,marginBottom:16}}),e.a.createElement("section",null,e.a.createElement("div",{style:{display:"flex",marginBottom:"0.75rem"}},e.a.createElement(oe.a,{mode:"multiple",placeholder:"Add staff users here\u2026",loading:o,value:u,onChange:function(E){return d(E)},showArrow:!0,showSearch:!0,style:{flexGrow:1}},i.map(function(c){return e.a.createElement(oe.a.Option,{key:c.uuid,value:c.uuid,title:"".concat(c.first_name," (").concat(c.email,")")},e.a.createElement(ie.a,{name:c.first_name,email:c.email,size:"sm",style:{display:"inline-flex",marginRight:8}}),c.first_name," (",c.email,")")})),e.a.createElement(C.a,{type:"primary",style:{flexShrink:0,marginLeft:"0.5rem"},loading:o,disabled:u.length===0,onClick:l},"Add"))),e.a.createElement($.a,{dataSource:r,columns:y,loading:o,rowKey:"uuid"}))}var He={component:ce,logic:v.b};function ce(){var t=Object(h.useValues)(v.b),s=t.tab,n=t.error,r=Object(h.useActions)(v.b),o=r.setTab,i=Object(h.useValues)(q.a),u=i.preflight,m=i.siteUrlMisconfigured,d=Object(h.useValues)(M.a),l=d.user;return e.a.createElement("div",{className:"system-status-scene"},e.a.createElement(ge.a,{title:"Instance status & settings",caption:e.a.createElement(e.a.Fragment,null,"Here you can find all the critical runtime details and settings of your PostHog instance. You have access to this because you're a ",e.a.createElement("b",null,"staff user"),"."," ",e.a.createElement("a",{target:"_blank",style:{display:"inline-flex",alignItems:"center"},href:"https://posthog.com/docs/self-host/configure/instance-settings?utm_medium=in-product&utm_campaign=instance_status"},"Learn more ",e.a.createElement(j.IconOpenInNew,{style:{marginLeft:4}})),".")}),n&&e.a.createElement(Z.a,{message:"Something went wrong",description:n||e.a.createElement("span",null,"An unknown error occurred. Please try again or contact us."),type:"error",showIcon:!0}),m&&e.a.createElement(Z.a,{message:"Misconfiguration detected",description:e.a.createElement(e.a.Fragment,null,"Your ",e.a.createElement("code",null,"SITE_URL")," environment variable seems misconfigured. Your"," ",e.a.createElement("code",null,"SITE_URL")," is set to"," ",e.a.createElement("b",null,e.a.createElement("code",null,u==null?void 0:u.site_url))," ","but you're currently browsing this page from"," ",e.a.createElement("b",null,e.a.createElement("code",null,window.location.origin)),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig"},"Learn more ",e.a.createElement(j.IconOpenInNew,null))),showIcon:!0,type:"warning",style:{marginBottom:32}}),e.a.createElement(V.a,{tabPosition:"top",animated:!1,activeKey:s,onTabClick:function(y){return o(y)}},e.a.createElement(V.a.TabPane,{tab:"System overview",key:"overview"},e.a.createElement(he,null)),(l==null?void 0:l.is_staff)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(V.a.TabPane,{tab:"Internal metrics",key:"metrics"},e.a.createElement(Ie,null)),e.a.createElement(V.a.TabPane,{tab:e.a.createElement(e.a.Fragment,null,"Settings ",e.a.createElement(I.a,{type:"warning"},"Beta")),key:"settings"},e.a.createElement(we,null))),(l==null?void 0:l.is_staff)&&e.a.createElement(V.a.TabPane,{tab:e.a.createElement(e.a.Fragment,null,"Staff Users ",e.a.createElement(I.a,{type:"success"},"New")),key:"staff_users"},e.a.createElement(Fe,null))))}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss":function(P,A,a){var B=a("./node_modules/css-loader/dist/runtime/api.js");A=B(!1),A.push([P.i,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}.embedded-svg-wrapper{cursor:text}.embedded-svg-wrapper svg{width:100%;height:100%}",""]),P.exports=A}}]);
