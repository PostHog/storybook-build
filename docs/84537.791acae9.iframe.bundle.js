"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[84537],{"../../products/error_tracking/frontend/scenes/ErrorTrackingFingerprintsScene/ErrorTrackingIssueFingerprintsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ErrorTrackingIssueFingerprintsScene:()=>ErrorTrackingIssueFingerprintsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),SetupPrompt=__webpack_require__("../../products/error_tracking/frontend/components/SetupPrompt/SetupPrompt.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),issueActionsLogic=__webpack_require__("../../products/error_tracking/frontend/components/IssueActions/issueActionsLogic.tsx"),queries=__webpack_require__("../../products/error_tracking/frontend/queries.ts");let errorTrackingIssueFingerprintsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(key=>["products","error_tracking","scenes","ErrorTrackingFingerprintsScene","errorTrackingIssueFingerprintsSceneLogic",key]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return id}),(0,index_esm.actions)({loadIssue:!0,split:exclusive=>({exclusive}),setSelectedFingerprints:fingerprints=>({fingerprints}),loadFingerprintSamples:(issue,fingerprints)=>({issue,fingerprints})}),(0,index_esm.connect)(()=>({actions:[issueActionsLogic.x,["splitIssue"]]})),(0,index_esm.defaults)({issue:null,issueFingerprints:null,fingerprintSamples:[]}),(0,index_esm.reducers)({selectedFingerprints:[[],{setSelectedFingerprints:(_,_ref2)=>{let{fingerprints}=_ref2;return fingerprints}}]}),(0,lib.loaders)(_ref3=>{let{values,props}=_ref3;return{issue:{loadIssue:async()=>await api.ZP.errorTracking.getIssue(props.id)},issueFingerprints:{loadIssueFingerprints:async()=>(await api.ZP.errorTracking.fingerprints.list(props.id)).results,split:()=>(values.issueFingerprints||[]).filter(f=>!values.selectedFingerprints.includes(f.fingerprint))},fingerprintSamples:{loadFingerprintSamples:async _ref4=>{let{issue,fingerprints}=_ref4;if(issue&&fingerprints){let query=(0,queries.FL)(issue.id,issue.first_seen,fingerprints.map(fingerprint=>fingerprint.fingerprint));return(await api.ZP.queryHogQL(query)).results.map(_ref5=>{let[fingerprint,count,samples]=_ref5;return{fingerprint,count,samples}})}return[]}}}}),(0,index_esm.selectors)({isLoading:[s=>[s.fingerprintSamplesLoading,s.issueLoading,s.issueFingerprintsLoading],(fingerprintSamplesLoading,issueLoading,issueFingerprintsLoading)=>fingerprintSamplesLoading||issueLoading||issueFingerprintsLoading],breadcrumbs:[s=>[s.issue],issue=>{let breadcrumbs=[{key:sceneTypes.x.ErrorTracking,name:"Error tracking",path:urls.j.errorTracking(),iconType:"error_tracking"}];if(issue){var _issue$name;let name=null!==(_issue$name=issue.name)&&void 0!==_issue$name?_issue$name:"Issue";breadcrumbs.push({key:[sceneTypes.x.ErrorTrackingIssue,name],path:urls.j.errorTrackingIssue(issue.id),name:name,iconType:"error_tracking"},{key:sceneTypes.x.ErrorTrackingIssueFingerprints,name:"Fingerprints",iconType:"error_tracking"})}else breadcrumbs.push({key:[sceneTypes.x.ErrorTrackingIssue,"Issue"],name:"Issue",iconType:"error_tracking"},{key:sceneTypes.x.ErrorTrackingIssueFingerprints,name:"Fingerprints",iconType:"error_tracking"});return breadcrumbs}]}),(0,index_esm.listeners)(_ref6=>{let{actions,props,values}=_ref6;return{split:_ref7=>{let{exclusive}=_ref7;actions.splitIssue(props.id,values.selectedFingerprints,exclusive),src.UJ.success("Issue split successfully!"),actions.setSelectedFingerprints([])}}}),(0,index_esm.events)(_ref8=>{let{actions}=_ref8;return{afterMount:()=>{actions.loadIssue(),actions.loadIssueFingerprints()}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:ErrorTrackingIssueFingerprintsScene,logic:errorTrackingIssueFingerprintsSceneLogic,paramsToProps:_ref=>{let{params:{id}}=_ref;return{id}}};function ErrorTrackingIssueFingerprintsScene(){let{issue,issueFingerprints,selectedFingerprints,fingerprintSamples,isLoading}=(0,index_esm.useValues)(errorTrackingIssueFingerprintsSceneLogic),{loadFingerprintSamples,setSelectedFingerprints,split}=(0,index_esm.useActions)(errorTrackingIssueFingerprintsSceneLogic);(0,react.useEffect)(()=>{issue&&issueFingerprints&&loadFingerprintSamples(issue,issueFingerprints)},[issue,issueFingerprints,loadFingerprintSamples]);let columns=[{key:"actions",dataIndex:"fingerprint",render:fingerprint=>(0,jsx_runtime.jsx)(src.Hw,{checked:selectedFingerprints.includes(fingerprint),onChange:checked=>{setSelectedFingerprints(checked?[...selectedFingerprints,fingerprint]:selectedFingerprints.filter(f=>f!==fingerprint))},disabledReason:1===fingerprintSamples.length?"You cannot split an issue that only has one fingerprint":void 0}),width:"30px",title:(0,jsx_runtime.jsx)(src.Hw,{checked:fingerprintSamples.length>0&&selectedFingerprints.length===fingerprintSamples.length,disabledReason:1===fingerprintSamples.length?"You cannot split an issue that only has one fingerprint":void 0,onChange:checked=>{setSelectedFingerprints(checked?fingerprintSamples.map(f=>f.fingerprint):[])}})},{title:"Example type",key:"type",dataIndex:"samples",width:"200px",render:samples=>samples.length>0?samples[0].type:(0,jsx_runtime.jsx)("span",{className:"text-muted italic",children:"No exception types"})},{title:"Example message",key:"message",dataIndex:"samples",render:messages=>messages.length>0?messages[0].value:(0,jsx_runtime.jsx)("span",{className:"text-muted italic",children:"No exception messages"})},{title:"Count",dataIndex:"count"}],disabledReason=selectedFingerprints.length===fingerprintSamples.length?"You must leave at least one fingerprint associated with the issue":0===selectedFingerprints.length?"Select at least one fingerprint":1===fingerprintSamples.length?"You cannot split an issue that only has one fingerprint":void 0;return(0,jsx_runtime.jsx)(SetupPrompt.n,{children:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"Select the fingerprints that you want to split out from this issue. An individual issue will be created for each of the fingerprints."}),selectedFingerprints.length<=1?(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"primary",disabledReason:disabledReason,onClick:()=>split(!0),children:"Split"}):(0,jsx_runtime.jsx)(src.Yv,{size:"small",type:"primary",placeholder:"Split",options:[{value:!1,label:"Split fingerprints into a single issue"},{value:!0,label:"Split fingerprints into individual issues"}],onSelect:value=>split(value),disabledReason:disabledReason}),(0,jsx_runtime.jsx)(src.g3,{className:"w-full",loading:isLoading,dataSource:fingerprintSamples,columns:columns,expandable:{noIndent:!0,rowExpandable:record=>record.samples.length>1,expandedRowRender:record=>(0,jsx_runtime.jsx)(src.g3,{className:"w-full",loading:!1,embedded:!0,showHeader:!0,dataSource:record.samples,columns:[{title:"Type",width:"200px",dataIndex:"type"},{title:"Message",dataIndex:"value"}]})}})]})})}}}]);