(window.webpackJsonp=window.webpackJsonp||[]).push([[233],{4260:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return api}));__webpack_require__(41),__webpack_require__(85),__webpack_require__(143),__webpack_require__(60),__webpack_require__(3),__webpack_require__(7),__webpack_require__(67),__webpack_require__(12);var APIMethod,lib_api__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(21),_constants__WEBPACK_IMPORTED_MODULE_10__=(__webpack_require__(26),__webpack_require__(18));!function(APIMethod){APIMethod.Create="create",APIMethod.Get="get",APIMethod.Update="update",APIMethod.Delete="delete"}(APIMethod||(APIMethod={}));APIMethod.Create,APIMethod.Get,APIMethod.Update,APIMethod.Delete;var api=lib_api__WEBPACK_IMPORTED_MODULE_8__.a;_constants__WEBPACK_IMPORTED_MODULE_10__.s.Admin,_constants__WEBPACK_IMPORTED_MODULE_10__.s.Admin},4274:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return experimentsLogic}));__webpack_require__(41),__webpack_require__(61),__webpack_require__(45),__webpack_require__(32),__webpack_require__(39),__webpack_require__(49);var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(15),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_6__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(7),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(67),__webpack_require__(12)),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__),kea__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(1),lib_api_mock__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(4260),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(27),_types__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(4),_ant_design_icons__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(391),react_toastify__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(69),react__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_16__),lib_utils__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(10),scenes_userLogic__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(65),experimentsLogic=Object(kea__WEBPACK_IMPORTED_MODULE_10__.kea)({path:["scenes","experiments","experimentsLogic"],connect:{values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_12__.a,["currentTeamId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_18__.a,["hasAvailableFeature"]]},actions:{},loaders:function loaders(_ref){var _setExperimentsFilters,_deleteExperiment,_loadExperiments,values=_ref.values,actions=_ref.actions;return{experiments:[[],{loadExperiments:(_loadExperiments=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default.a.mark((function _callee(filter){var response;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(values.hasAvailableFeature(_types__WEBPACK_IMPORTED_MODULE_13__.c.EXPERIMENTATION)){_context.next=2;break}return _context.abrupt("return",[]);case 2:return _context.next=4,lib_api_mock__WEBPACK_IMPORTED_MODULE_11__.a.get("api/projects/".concat(values.currentTeamId,"/experiments?").concat(filter||""));case 4:return response=_context.sent,_context.abrupt("return",response.results);case 6:case"end":return _context.stop()}}),_callee)}))),function loadExperiments(_x){return _loadExperiments.apply(this,arguments)}),deleteExperiment:(_deleteExperiment=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default.a.mark((function _callee2(id){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,lib_api_mock__WEBPACK_IMPORTED_MODULE_11__.a.delete("api/projects/".concat(values.currentTeamId,"/experiments/").concat(id));case 2:return Object(react_toastify__WEBPACK_IMPORTED_MODULE_15__.c)(react__WEBPACK_IMPORTED_MODULE_16___default.a.createElement("div",null,react__WEBPACK_IMPORTED_MODULE_16___default.a.createElement("h1",{className:"text-success"},react__WEBPACK_IMPORTED_MODULE_16___default.a.createElement(_ant_design_icons__WEBPACK_IMPORTED_MODULE_14__.a,null)," Experiment removed"))),_context2.abrupt("return",values.experiments.filter((function(experiment){return experiment.id!==id})));case 4:case"end":return _context2.stop()}}),_callee2)}))),function deleteExperiment(_x2){return _deleteExperiment.apply(this,arguments)}),addToExperiments:function addToExperiments(experiment){return[].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_6___default()(values.experiments),[experiment])},updateExperiments:function updateExperiments(experiment){return values.experiments.map((function(exp){return exp.id===experiment.id?experiment:exp}))}}],tab:[_types__WEBPACK_IMPORTED_MODULE_13__.g.All,{setExperimentsFilters:(_setExperimentsFilters=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default.a.mark((function _callee3(_ref2){var tab,tabFilter;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return tab=_ref2.tab,tabFilter=tab===_types__WEBPACK_IMPORTED_MODULE_13__.g.Yours?Object(lib_utils__WEBPACK_IMPORTED_MODULE_17__.zb)({user:!0}):Object(lib_utils__WEBPACK_IMPORTED_MODULE_17__.zb)({archived:!0}),tab===_types__WEBPACK_IMPORTED_MODULE_13__.g.All?actions.loadExperiments(Object(lib_utils__WEBPACK_IMPORTED_MODULE_17__.zb)({all:!0})):actions.loadExperiments(tabFilter),_context3.abrupt("return",tab);case 4:case"end":return _context3.stop()}}),_callee3)}))),function setExperimentsFilters(_x3){return _setExperimentsFilters.apply(this,arguments)})}]}},events:function events(_ref3){var actions=_ref3.actions;return{afterMount:function afterMount(){actions.loadExperiments()}}}})},4514:function(module,exports,__webpack_require__){(exports=__webpack_require__(48)(!1)).push([module.i,'.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.experiment-form .metrics-selection{width:100%;border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;margin-top:1rem}.experiment-form .metrics-selection .action-filters-bordered .draggable-action-filter{border-bottom:1px solid rgba(0,0,0,.15);padding:1rem .25rem;margin-top:0}.experiment-form .metrics-selection .action-filters-bordered .row-action-btn{color:#35416b}.experiment-form .person-selection{width:100%;border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;margin-top:1rem;align-items:center;justify-content:space-between}.experiment-form .insights-graph-container{margin-bottom:1rem;background-color:#fff}.experiment-form .insights-graph-container .ant-card-head{border-bottom:1px solid rgba(0,0,0,.15);min-height:unset;background-color:#fff;padding-left:1rem;padding-right:1rem}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title{padding:.5rem 0}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter{font-size:14px}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter:not(:last-child),.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter span.head-title-item{margin-right:.5rem}.experiment-form .insights-graph-container .display-config-inner{display:flex;align-items:center;justify-content:space-between;overflow-x:auto}.experiment-form .insights-graph-container .ant-card-body{padding:0}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left{width:100%}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right{width:100%;height:min(calc(90vh - 16rem),36rem);max-width:300px;padding:0 1rem 1rem 0;display:flex;align-items:center}.experiment-form .insights-graph-container .graph-container{width:calc(100% - 48px);height:calc(100% - 48px);margin-top:2rem}.experiment-form .insights-graph-header{margin-top:0!important;margin-bottom:0!important;padding-left:1rem;padding-right:1rem;min-height:48px}.experiment-form .experiment-preview{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.experiment-form .experiment-preview .mde-slider .ant-slider-handle{border:none}.experiment-form .experiment-preview .mde-slider .ant-slider-rail{background-color:#e5ebff}.experiment-form .variants{border:1px solid rgba(0,0,0,.15);border-radius:4px;padding-left:1rem;margin-top:.5rem;margin-bottom:1rem}.experiment-form .variants .feature-flag-variant{margin-top:20px}.experiment-form .variants .feature-flag-variant .ant-form-item-explain-error{padding-top:.5rem}.experiment-form .ant-input-number-disabled,.experiment-form .ant-input[disabled]{color:#000}.view-experiment .draft-header{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.view-experiment .stop-experiment{background-color:#f96132;color:#fff}.view-experiment .archive-experiment{color:#f96132}.view-experiment .exp-description{font-style:italic;color:rgba(0,0,0,.5)}.view-experiment .participants{background-color:#fff}.view-experiment .participants .ant-collapse-header{padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem}.view-experiment .variants-list{list-style:none;margin:0;padding:0}.view-experiment .variants-list li{display:inline}.view-experiment .variants-list li:after{content:", "}.view-experiment .variants-list li:last-child:after{content:""}.view-experiment .experiment-result{padding-top:1rem}.view-experiment .significant-results{padding:.5rem;width:100%;background:rgba(119,185,108,.1);border-radius:4px;text-align:center;margin-bottom:1rem}.view-experiment .not-significant-results{padding:.5rem;width:100%;background:rgba(83,117,255,.1);border-radius:4px;margin-bottom:1rem}.view-experiment .feature-flag-mods{padding:.5rem;width:100%;background:#f6ebf8;border-radius:4px;margin-bottom:1rem}.view-experiment .ant-collapse-content-box{display:flex;flex-flow:column}.view-experiment .secondary-progress{margin-top:.5rem}.view-experiment .secondary-progress li:before{content:"â€¢";display:inline-block;font-weight:900;margin-right:4px}.view-experiment .no-experiment-results{display:flex;justify-content:center;align-items:center;margin-top:1rem;background-color:#fafaf9;border:1px solid rgba(0,0,0,.15);width:100%;min-height:320px;font-size:24px}.preview-conversion-goal-num{height:24px;width:24px;text-align:center;background-color:#fafaf9;color:#35416b;font-weight:700;margin-right:.5rem}.experiment-preview-row{border-bottom:1px solid rgba(0,0,0,.15);padding-bottom:1rem;margin-bottom:1rem}.experiment-preview-row:last-child{border-bottom:none;padding-bottom:0;margin-bottom:0}.metric-name{border:1px solid rgba(0,0,0,.15);border-radius:4px;padding:8px 8px 8px 16px;margin-left:.5rem;flex:1}.experiment-implementation-details,.experiment-workflow{border-color:#d9d9d9}.experiment-implementation-details .ant-card-head,.experiment-workflow .ant-card-head{padding-left:1rem;padding-right:1rem;border:none}.experiment-implementation-details .ant-card-head-title,.experiment-workflow .ant-card-head-title{border-bottom:1px solid rgba(0,0,0,.15)}.experiment-implementation-details .exp-workflow-step,.experiment-workflow .exp-workflow-step{margin-bottom:.5rem;padding:.5rem;border-radius:4px}.experiment-implementation-details .exp-workflow-step:hover,.experiment-workflow .exp-workflow-step:hover{cursor:pointer}.experiment-implementation-details .step-completed,.experiment-workflow .step-completed{background-color:#e5ebff}',""]),module.exports=exports},4743:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Experiment_",(function(){return Experiment_})),__webpack_require__.d(__webpack_exports__,"CodeLanguageSelect",(function(){return CodeLanguageSelect}));__webpack_require__(184),__webpack_require__(195),__webpack_require__(41),__webpack_require__(61),__webpack_require__(32),__webpack_require__(308),__webpack_require__(60),__webpack_require__(211),__webpack_require__(475),__webpack_require__(113),__webpack_require__(39),__webpack_require__(109);var defineProperty=__webpack_require__(3),defineProperty_default=__webpack_require__.n(defineProperty),slicedToArray=__webpack_require__(13),slicedToArray_default=__webpack_require__.n(slicedToArray),es_form=__webpack_require__(330),row=__webpack_require__(261),col=__webpack_require__(243),input=__webpack_require__(473),tooltip=__webpack_require__(297),es_button=__webpack_require__(142),es_select=__webpack_require__(307),card=__webpack_require__(4164),tag=__webpack_require__(1742),collapse=__webpack_require__(4159),progress=__webpack_require__(2445),index_esm=__webpack_require__(1),PageHeader=__webpack_require__(210),PropertyFilters=__webpack_require__(174),utils=__webpack_require__(140),types=__webpack_require__(23),react=__webpack_require__(0),react_default=__webpack_require__.n(react),funnelLogic=__webpack_require__(73),ActionFilter=__webpack_require__(408),insightLogic=__webpack_require__(30),src_types=__webpack_require__(4),injectStylesIntoStyleTag=__webpack_require__(20),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Experiment=__webpack_require__(4514),Experiment_default=__webpack_require__.n(Experiment),options={insert:"head",singleton:!1},regenerator=(injectStylesIntoStyleTag_default()(Experiment_default.a,options),Experiment_default.a.locals,__webpack_require__(1264),__webpack_require__(116),__webpack_require__(661),__webpack_require__(45),__webpack_require__(656),__webpack_require__(1771),__webpack_require__(245),__webpack_require__(49),__webpack_require__(7)),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(67),__webpack_require__(12)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),toConsumableArray=__webpack_require__(15),toConsumableArray_default=__webpack_require__.n(toConsumableArray),api=__webpack_require__(21),dayjs=__webpack_require__(35),lib_utils=__webpack_require__(10),randomAnimal=__webpack_require__(1766),react_toastify=__webpack_require__(69),cleanFilters=__webpack_require__(122),teamLogic=__webpack_require__(27),urls=__webpack_require__(19),lib=__webpack_require__(26),experimentsLogic=__webpack_require__(4274),constants=__webpack_require__(18),trendsLogic=__webpack_require__(208),eventUsageLogic=__webpack_require__(36),userLogic=__webpack_require__(65),Tooltip=__webpack_require__(44),InfoCircleOutlined=__webpack_require__(644),groupsModel=__webpack_require__(129);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var experimentLogic=Object(index_esm.kea)({path:["scenes","experiment","experimentLogic"],connect:{values:[teamLogic.a,["currentTeamId"],userLogic.a,["hasAvailableFeature"],groupsModel.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]],actions:[experimentsLogic.a,["updateExperiments","addToExperiments"]]},actions:{setExperiment:function setExperiment(experiment){return{experiment:experiment}},createExperiment:function createExperiment(draft,runningTime,sampleSize){return{draft:draft,runningTime:runningTime,sampleSize:sampleSize}},setExperimentInsightId:function setExperimentInsightId(shortId){return{shortId:shortId}},createNewExperimentInsight:function createNewExperimentInsight(filters){return{filters:filters}},setFilters:function setFilters(filters){return{filters:filters}},setExperimentId:function setExperimentId(experimentId){return{experimentId:experimentId}},setNewExperimentData:function setNewExperimentData(experimentData){return{experimentData:experimentData}},updateExperimentGroup:function updateExperimentGroup(variant,idx){return{variant:variant,idx:idx}},removeExperimentGroup:function removeExperimentGroup(idx){return{idx:idx}},setExperimentInsightType:function setExperimentInsightType(insightType){return{insightType:insightType}},setEditExperiment:function setEditExperiment(editing){return{editing:editing}},setSecondaryMetrics:function setSecondaryMetrics(secondaryMetrics){return{secondaryMetrics:secondaryMetrics}},resetNewExperiment:!0,launchExperiment:!0,endExperiment:!0,addExperimentGroup:!0,archiveExperiment:!0},reducers:{experimentId:[null,{setExperimentId:function setExperimentId(_,_ref){return _ref.experimentId}}],newExperimentData:[null,{setNewExperimentData:function setNewExperimentData(vals,_ref2){var experimentData=_ref2.experimentData;if(experimentData.filters){var newFilters=_objectSpread(_objectSpread({},null==vals?void 0:vals.filters),experimentData.filters);return _objectSpread(_objectSpread(_objectSpread({},vals),experimentData),{},{filters:newFilters})}if(experimentData.parameters){var newParameters=_objectSpread(_objectSpread({},null==vals?void 0:vals.parameters),experimentData.parameters);return _objectSpread(_objectSpread(_objectSpread({},vals),experimentData),{},{parameters:newParameters})}return _objectSpread(_objectSpread({},vals),experimentData)},updateExperimentGroup:function updateExperimentGroup(state,_ref3){var _state$parameters,variant=_ref3.variant,idx=_ref3.idx,featureFlagVariants=toConsumableArray_default()((null==state||null===(_state$parameters=state.parameters)||void 0===_state$parameters?void 0:_state$parameters.feature_flag_variants)||[]);return featureFlagVariants[idx]=_objectSpread(_objectSpread({},featureFlagVariants[idx]),variant),_objectSpread(_objectSpread({},state),{},{parameters:_objectSpread(_objectSpread({},null==state?void 0:state.parameters),{},{feature_flag_variants:featureFlagVariants})})},addExperimentGroup:function addExperimentGroup(state){var _state$parameters2;if(null==state||null===(_state$parameters2=state.parameters)||void 0===_state$parameters2?void 0:_state$parameters2.feature_flag_variants){var newRolloutPercentages=percentageDistribution(state.parameters.feature_flag_variants.length+1),updatedRolloutPercentageVariants=state.parameters.feature_flag_variants.map((function(variant,i){return _objectSpread(_objectSpread({},variant),{},{rollout_percentage:newRolloutPercentages[i]})}));return _objectSpread(_objectSpread({},state),{},{parameters:_objectSpread(_objectSpread({},state.parameters),{},{feature_flag_variants:[].concat(toConsumableArray_default()(updatedRolloutPercentageVariants),[{key:"test_group_".concat(state.parameters.feature_flag_variants.length),rollout_percentage:newRolloutPercentages[newRolloutPercentages.length-1]}])})})}return state},removeExperimentGroup:function removeExperimentGroup(state,_ref4){var _state$parameters3,_state$parameters4,idx=_ref4.idx;if(!state)return state;var variants=toConsumableArray_default()((null===(_state$parameters3=state.parameters)||void 0===_state$parameters3?void 0:_state$parameters3.feature_flag_variants)||[]);variants.splice(idx,1);var newRolloutPercentages=percentageDistribution(((null==state||null===(_state$parameters4=state.parameters)||void 0===_state$parameters4?void 0:_state$parameters4.feature_flag_variants)||[]).length-1),updatedVariants=variants.map((function(variant,i){return _objectSpread(_objectSpread({},variant),{},{rollout_percentage:newRolloutPercentages[i]})}));return _objectSpread(_objectSpread({},state),{},{parameters:_objectSpread(_objectSpread({},state.parameters),{},{feature_flag_variants:updatedVariants})})},setSecondaryMetrics:function setSecondaryMetrics(state,_ref5){var metrics=_ref5.secondaryMetrics.map((function(metric){return metric}));return _objectSpread(_objectSpread({},state),{},{secondary_metrics:metrics})},resetNewExperiment:function resetNewExperiment(){return{parameters:{feature_flag_variants:[{key:"control",rollout_percentage:50},{key:"test",rollout_percentage:50}]}}}}],experimentInsightType:[src_types.r.FUNNELS,{setExperimentInsightType:function setExperimentInsightType(_,_ref6){return _ref6.insightType}}],experimentInsightId:[null,{setExperimentInsightId:function setExperimentInsightId(_,_ref7){return _ref7.shortId}}],editingExistingExperiment:[!1,{setEditExperiment:function setEditExperiment(_,_ref8){return _ref8.editing}}]},listeners:function listeners(_ref9){var _archiveExperiment,_endExperiment,_launchExperiment,_loadExperimentSuccess,_createNewExperimentInsight,_createExperiment,values=_ref9.values,actions=_ref9.actions;return{createExperiment:(_createExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(_ref10){var _values$newExperiment,_response2,draft,runningTime,sampleSize,response,isUpdate,_values$newExperiment2,_response,_values$newExperiment3,experimentId;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(draft=_ref10.draft,runningTime=_ref10.runningTime,sampleSize=_ref10.sampleSize,response=null,isUpdate=!!(null===(_values$newExperiment=values.newExperimentData)||void 0===_values$newExperiment?void 0:_values$newExperiment.id),_context.prev=3,!(null===(_values$newExperiment2=values.newExperimentData)||void 0===_values$newExperiment2?void 0:_values$newExperiment2.id)){_context.next=14;break}return _context.next=7,api.a.update("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId),_objectSpread(_objectSpread({},values.newExperimentData),{},{parameters:_objectSpread(_objectSpread({},values.newExperimentData.parameters),{},{recommended_running_time:runningTime,recommended_sample_size:sampleSize})},!draft&&{start_date:Object(dayjs.a)()}));case 7:if(response=_context.sent,!(null===(_response=response)||void 0===_response?void 0:_response.id)){_context.next=12;break}return actions.updateExperiments(response),lib.router.actions.push(urls.a.experiment(response.id)),_context.abrupt("return");case 12:_context.next=18;break;case 14:return _context.next=16,api.a.create("api/projects/".concat(values.currentTeamId,"/experiments"),_objectSpread(_objectSpread({},values.newExperimentData),{},{parameters:_objectSpread(_objectSpread({},null===(_values$newExperiment3=values.newExperimentData)||void 0===_values$newExperiment3?void 0:_values$newExperiment3.parameters),{},{recommended_running_time:runningTime,recommended_sample_size:sampleSize})},!draft&&{start_date:Object(dayjs.a)()}));case 16:(response=_context.sent)&&eventUsageLogic.f.actions.reportExperimentCreated(response);case 18:_context.next=24;break;case 20:return _context.prev=20,_context.t0=_context.catch(3),Object(lib_utils.z)("Error creating your experiment","Attempting to create this experiment returned an error:",0!==_context.t0.status?_context.t0.detail:"Check your internet connection and make sure you don't have an extension blocking our requests.",_context.t0.code),_context.abrupt("return");case 24:(null===(_response2=response)||void 0===_response2?void 0:_response2.id)&&(experimentId=response.id,lib.router.actions.push(urls.a.experiment(experimentId)),actions.addToExperiments(response),react_toastify.c.success(react_default.a.createElement("div",{"data-attr":"success-toast"},react_default.a.createElement("h1",null,"Experiment ",isUpdate?"updated":"created"," successfully!"),!isUpdate&&react_default.a.createElement("p",null,"Click here to view this experiment.")),{onClick:function onClick(){lib.router.actions.push(urls.a.experiment(experimentId))},closeOnClick:!0,onClose:function onClose(){lib.router.actions.push(urls.a.experiment(experimentId))}}));case 25:case"end":return _context.stop()}}),_callee,null,[[3,20]])}))),function createExperiment(_x){return _createExperiment.apply(this,arguments)}),createNewExperimentInsight:(_createNewExperimentInsight=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(_ref11){var filters,newInsightFilters,newInsight,createdInsight;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return filters=_ref11.filters,newInsightFilters=values.experimentInsightType===src_types.r.FUNNELS?Object(cleanFilters.a)(_objectSpread({insight:src_types.r.FUNNELS,funnel_viz_type:src_types.n.Steps,display:src_types.d.FunnelViz,date_from:Object(dayjs.a)().subtract(14,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(dayjs.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:constants.q.horizontal},filters)):Object(cleanFilters.a)(_objectSpread({insight:src_types.r.TRENDS,date_from:Object(dayjs.a)().subtract(14,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(dayjs.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},filters)),newInsight={name:Object(randomAnimal.a)(),description:"",tags:[],filters:newInsightFilters,result:null},_context2.next=5,api.a.create("api/projects/".concat(values.currentTeamId,"/insights"),newInsight);case 5:createdInsight=_context2.sent,actions.setExperimentInsightId(createdInsight.short_id),actions.setNewExperimentData({filters:_objectSpread({},newInsight.filters)});case 8:case"end":return _context2.stop()}}),_callee2)}))),function createNewExperimentInsight(_x2){return _createNewExperimentInsight.apply(this,arguments)}),setFilters:function setFilters(_ref12){var _funnelLogic$findMoun,_trendsLogic$findMoun,filters=_ref12.filters;values.experimentInsightType===src_types.r.FUNNELS?null===(_funnelLogic$findMoun=funnelLogic.a.findMounted({dashboardItemId:values.experimentInsightId}))||void 0===_funnelLogic$findMoun||_funnelLogic$findMoun.actions.setFilters(filters):null===(_trendsLogic$findMoun=trendsLogic.a.findMounted({dashboardItemId:values.experimentInsightId}))||void 0===_trendsLogic$findMoun||_trendsLogic$findMoun.actions.setFilters(filters)},loadExperimentSuccess:(_loadExperimentSuccess=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(_ref13){var experimentData;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:(experimentData=_ref13.experimentData)&&eventUsageLogic.f.actions.reportExperimentViewed(experimentData),actions.setExperimentInsightType((null==experimentData?void 0:experimentData.filters.insight)||src_types.r.FUNNELS),(null==experimentData?void 0:experimentData.start_date)?(actions.resetNewExperiment(),actions.loadExperimentResults(),actions.loadSecondaryMetricResults()):(actions.setNewExperimentData(_objectSpread({},experimentData)),actions.createNewExperimentInsight(null==experimentData?void 0:experimentData.filters));case 4:case"end":return _context3.stop()}}),_callee3)}))),function loadExperimentSuccess(_x3){return _loadExperimentSuccess.apply(this,arguments)}),launchExperiment:(_launchExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee4(){var startDate;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:startDate=Object(dayjs.a)(),actions.updateExperiment({start_date:startDate.format("YYYY-MM-DDTHH:mm")}),values.experimentData&&eventUsageLogic.f.actions.reportExperimentLaunched(values.experimentData,startDate);case 3:case"end":return _context4.stop()}}),_callee4)}))),function launchExperiment(){return _launchExperiment.apply(this,arguments)}),endExperiment:(_endExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee5(){var _values$experimentDat,endDate,duration;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:endDate=Object(dayjs.a)(),actions.updateExperiment({end_date:endDate.format("YYYY-MM-DDTHH:mm")}),duration=endDate.diff(null===(_values$experimentDat=values.experimentData)||void 0===_values$experimentDat?void 0:_values$experimentDat.start_date,"second"),values.experimentData&&eventUsageLogic.f.actions.reportExperimentCompleted(values.experimentData,endDate,duration,values.areResultsSignificant);case 4:case"end":return _context5.stop()}}),_callee5)}))),function endExperiment(){return _endExperiment.apply(this,arguments)}),archiveExperiment:(_archiveExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee6(){return regenerator_default.a.wrap((function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:actions.updateExperiment({archived:!0}),values.experimentData&&eventUsageLogic.f.actions.reportExperimentArchived(values.experimentData);case 2:case"end":return _context6.stop()}}),_callee6)}))),function archiveExperiment(){return _archiveExperiment.apply(this,arguments)}),setExperimentInsightType:function setExperimentInsightType(){var _values$experimentDat2;"new"===values.experimentId||values.editingExistingExperiment?actions.createNewExperimentInsight():actions.createNewExperimentInsight(null===(_values$experimentDat2=values.experimentData)||void 0===_values$experimentDat2?void 0:_values$experimentDat2.filters)}}},loaders:function loaders(_ref14){var _loadSecondaryMetricResults,_loadExperimentResults,_updateExperiment,_loadExperiment,values=_ref14.values,actions=_ref14.actions;return{experimentData:[null,{loadExperiment:(_loadExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee7(){var response;return regenerator_default.a.wrap((function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if(!values.experimentId||"new"===values.experimentId){_context7.next=5;break}return _context7.next=3,api.a.get("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId));case 3:return response=_context7.sent,_context7.abrupt("return",response);case 5:return _context7.abrupt("return",null);case 6:case"end":return _context7.stop()}}),_callee7)}))),function loadExperiment(){return _loadExperiment.apply(this,arguments)}),updateExperiment:(_updateExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee8(update){var response;return regenerator_default.a.wrap((function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return _context8.next=2,api.a.update("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId),update);case 2:return response=_context8.sent,actions.setExperimentId(response.id||"new"),_context8.abrupt("return",response);case 5:case"end":return _context8.stop()}}),_callee8)}))),function updateExperiment(_x4){return _updateExperiment.apply(this,arguments)})}],experimentResults:[null,{loadExperimentResults:(_loadExperimentResults=asyncToGenerator_default()(regenerator_default.a.mark((function _callee9(){var response;return regenerator_default.a.wrap((function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.prev=0,_context9.next=3,api.a.get("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId,"/results"));case 3:return response=_context9.sent,_context9.abrupt("return",_objectSpread(_objectSpread({},response),{},{itemID:Math.random().toString(36).substring(2,15)}));case 7:if(_context9.prev=7,_context9.t0=_context9.catch(0),"no_data"!==_context9.t0.code){_context9.next=11;break}return _context9.abrupt("return",null);case 11:return Object(lib_utils.z)("Error loading experiment results","Attempting to load results returned an error:",0!==_context9.t0.status?_context9.t0.detail:"Check your internet connection and make sure you don't have an extension blocking our requests.",_context9.t0.code),_context9.abrupt("return",null);case 13:case"end":return _context9.stop()}}),_callee9,null,[[0,7]])}))),function loadExperimentResults(){return _loadExperimentResults.apply(this,arguments)}),emptyExperimentResults:function emptyExperimentResults(){return null}}],secondaryMetricResults:[null,{loadSecondaryMetricResults:(_loadSecondaryMetricResults=asyncToGenerator_default()(regenerator_default.a.mark((function _callee10(){var results,i,_values$experimentDat3,secResults;return regenerator_default.a.wrap((function _callee10$(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:results=[],i=0;case 2:if(!(i<((null===(_values$experimentDat3=values.experimentData)||void 0===_values$experimentDat3?void 0:_values$experimentDat3.secondary_metrics.length)||0))){_context10.next=10;break}return _context10.next=5,api.a.get("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId,"/secondary_results?id=").concat(i));case 5:secResults=_context10.sent,results.push(secResults.result);case 7:i++,_context10.next=2;break;case 10:return _context10.abrupt("return",results);case 11:case"end":return _context10.stop()}}),_callee10)}))),function loadSecondaryMetricResults(){return _loadSecondaryMetricResults.apply(this,arguments)})}]}},selectors:{breadcrumbs:[function(s){return[s.experimentData,s.experimentId]},function(experimentData,experimentId){return[{name:"Experiments",path:urls.a.experiments()},{name:(null==experimentData?void 0:experimentData.name)||"New Experiment",path:urls.a.experiment(experimentId||"new")}]}],variants:[function(s){return[s.newExperimentData,s.experimentData]},function(newExperimentData,experimentData){var _newExperimentData$pa,_experimentData$param2,_experimentData$param;return(null==experimentData?void 0:experimentData.start_date)?(null==experimentData||null===(_experimentData$param=experimentData.parameters)||void 0===_experimentData$param?void 0:_experimentData$param.feature_flag_variants)||[]:(null==newExperimentData||null===(_newExperimentData$pa=newExperimentData.parameters)||void 0===_newExperimentData$pa?void 0:_newExperimentData$pa.feature_flag_variants)||(null==experimentData||null===(_experimentData$param2=experimentData.parameters)||void 0===_experimentData$param2?void 0:_experimentData$param2.feature_flag_variants)||[]}],taxonomicGroupTypesForSelection:[function(s){return[s.newExperimentData,s.groupsTaxonomicTypes]},function(newExperimentData,groupsTaxonomicTypes){var _newExperimentData$fi;return null!=(null==newExperimentData||null===(_newExperimentData$fi=newExperimentData.filters)||void 0===_newExperimentData$fi?void 0:_newExperimentData$fi.aggregation_group_type_index)&&groupsTaxonomicTypes.length>0?[groupsTaxonomicTypes[newExperimentData.filters.aggregation_group_type_index]]:[types.a.PersonProperties,types.a.Cohorts]}],parsedSecondaryMetrics:[function(s){return[s.newExperimentData,s.experimentData]},function(newExperimentData,experimentData){return(null==newExperimentData?void 0:newExperimentData.secondary_metrics)||(null==experimentData?void 0:experimentData.secondary_metrics)||[]}],minimumDetectableChange:[function(s){return[s.newExperimentData]},function(newExperimentData){var _newExperimentData$pa2;return(null==newExperimentData||null===(_newExperimentData$pa2=newExperimentData.parameters)||void 0===_newExperimentData$pa2?void 0:_newExperimentData$pa2.minimum_detectable_effect)||5}],minimumSampleSizePerVariant:[function(s){return[s.minimumDetectableChange]},function(mde){return function(conversionRate){return Math.ceil(1600*conversionRate*(1-conversionRate/100)/(mde*mde))}}],areResultsSignificant:[function(s){return[s.experimentResults]},function(experimentResults){return(null==experimentResults?void 0:experimentResults.significant)||!1}],significanceBannerDetails:[function(s){return[s.experimentResults]},function(experimentResults){var _ref15,_experimentResults$p_;return(null==experimentResults?void 0:experimentResults.significance_code)===src_types.D.HighLoss?react_default.a.createElement(react_default.a.Fragment,null,"This is because the expected loss in conversion is greater than 1%",react_default.a.createElement(Tooltip.a,{placement:"right",title:react_default.a.createElement(react_default.a.Fragment,null,"Current value is ",null===(_ref15=100*((null==experimentResults?void 0:experimentResults.expected_loss)||0))||void 0===_ref15?void 0:_ref15.toFixed(2),"%")},react_default.a.createElement(InfoCircleOutlined.a,{style:{padding:"4px 2px"}})),"."):(null==experimentResults?void 0:experimentResults.significance_code)===src_types.D.HighPValue?react_default.a.createElement(react_default.a.Fragment,null,"This is because the p value is greater than 0.05",react_default.a.createElement(Tooltip.a,{placement:"right",title:react_default.a.createElement(react_default.a.Fragment,null,"Current value is ",(null==experimentResults||null===(_experimentResults$p_=experimentResults.p_value)||void 0===_experimentResults$p_?void 0:_experimentResults$p_.toFixed(3))||1,".")},react_default.a.createElement(InfoCircleOutlined.a,{style:{padding:"4px 2px"}})),"."):(null==experimentResults?void 0:experimentResults.significance_code)===src_types.D.LowWinProbability?"This is because the win probability of all test variants combined is less than 90%.":(null==experimentResults?void 0:experimentResults.significance_code)===src_types.D.NotEnoughExposure?"This is because we need at least 100 people per variant to declare significance.":""}],recommendedExposureForCountData:[function(s){return[s.minimumDetectableChange]},function(mde){return function(baseCountData){var lambda1=baseCountData,lambda2=baseCountData*mde/100+baseCountData;return parseFloat((4/Math.pow(Math.sqrt(lambda1/14)-Math.sqrt(lambda2/14),2)).toFixed(1))}}],expectedRunningTime:[function(){return[]},function(){return function(entrants,sampleSize){var duration=arguments.length>2&&void 0!==arguments[2]?arguments[2]:14;return parseFloat((sampleSize/(entrants/duration)).toFixed(1))}}],conversionRateForVariant:[function(s){return[s.experimentResults]},function(experimentResults){return function(variant){if(!experimentResults)return"Can't find variant";var variantResults=(null==experimentResults?void 0:experimentResults.insight).find((function(variantFunnel){var _variantFunnel$,_variantFunnel$$break;return(null===(_variantFunnel$=variantFunnel[0])||void 0===_variantFunnel$||null===(_variantFunnel$$break=_variantFunnel$.breakdown_value)||void 0===_variantFunnel$$break?void 0:_variantFunnel$$break[0])===variant}));return variantResults?(variantResults[variantResults.length-1].count/variantResults[0].count*100).toFixed(1):"Can't find variant"}}],getIndexForVariant:[function(s){return[s.experimentResults]},function(experimentResults){return function(variant,insightType){if(!experimentResults)return 0;var index=-1;return-1===(index=insightType===src_types.r.FUNNELS?toConsumableArray_default()(null==experimentResults?void 0:experimentResults.insight).sort((function(a,b){var _b$,_a$;return(null===(_b$=b[0])||void 0===_b$?void 0:_b$.count)-(null===(_a$=a[0])||void 0===_a$?void 0:_a$.count)})).findIndex((function(variantFunnel){var _variantFunnel$2,_variantFunnel$2$brea;return(null===(_variantFunnel$2=variantFunnel[0])||void 0===_variantFunnel$2||null===(_variantFunnel$2$brea=_variantFunnel$2.breakdown_value)||void 0===_variantFunnel$2$brea?void 0:_variantFunnel$2$brea[0])===variant})):(null==experimentResults?void 0:experimentResults.insight).findIndex((function(variantTrend){return variantTrend.breakdown_value===variant})))?0:index}}],countDataForVariant:[function(s){return[s.experimentResults]},function(experimentResults){return function(variant){if(!experimentResults)return"Can't find variant";var variantResults=(null==experimentResults?void 0:experimentResults.insight).find((function(variantTrend){return variantTrend.breakdown_value===variant}));return variantResults?variantResults.count.toString():"Can't find variant"}}],highestProbabilityVariant:[function(s){return[s.experimentResults]},function(experimentResults){if(experimentResults){var maxValue=Math.max.apply(Math,toConsumableArray_default()(Object.values(experimentResults.probability)));return Object.keys(experimentResults.probability).find((function(key){return Math.abs(experimentResults.probability[key]-maxValue)<Number.EPSILON}))}}],areTrendResultsConfusing:[function(s){return[s.experimentResults,s.highestProbabilityVariant]},function(experimentResults,highestProbabilityVariant){if(!experimentResults)return!1;var variantResults=(null==experimentResults?void 0:experimentResults.insight).reduce((function(bestVariant,currentVariant){return currentVariant.count>bestVariant.count?currentVariant:bestVariant}),{count:0,breakdown_value:""});return!!variantResults.count&&variantResults.breakdown_value!==highestProbabilityVariant}]},urlToAction:function urlToAction(_ref16){var actions=_ref16.actions,values=_ref16.values;return{"/experiments/:id":function experimentsId(_ref17){var id=_ref17.id;if(actions.emptyExperimentResults(),values.hasAvailableFeature(src_types.c.EXPERIMENTATION)){if(id){var parsedId="new"===id?"new":parseInt(id);"new"===parsedId&&(actions.createNewExperimentInsight(),actions.resetNewExperiment(),actions.setSecondaryMetrics([])),actions.setEditExperiment(!1),parsedId!==values.experimentId&&actions.setExperimentId(parsedId),"new"!==parsedId&&actions.loadExperiment()}}else lib.router.actions.push("/experiments")}}}});function percentageDistribution(variantCount){var percentageRounded=Math.round(100/variantCount),delta=percentageRounded*variantCount-100,percentages=new Array(variantCount).fill(percentageRounded);return percentages[variantCount-1]=percentageRounded-delta,percentages}var InsightContainer=__webpack_require__(1608),icons=__webpack_require__(24),DeleteOutlined=__webpack_require__(4113),PlusOutlined=__webpack_require__(2564),CaretDownOutlined=__webpack_require__(2568),SaveOutlined=__webpack_require__(4222),CloseOutlined=__webpack_require__(228),CopyToClipboard=__webpack_require__(914),Spinner=__webpack_require__(173),funnelUtils=__webpack_require__(59),modal=__webpack_require__(1251),api_mock=__webpack_require__(4260);function secondaryMetricsLogic_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function secondaryMetricsLogic_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?secondaryMetricsLogic_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):secondaryMetricsLogic_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var BASIC_TRENDS_INSIGHT={name:"",filters:{insight:src_types.r.TRENDS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}]}},BASIC_FUNNELS_INSIGHT={name:"",filters:{insight:src_types.r.FUNNELS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}],layout:constants.q.horizontal}},secondaryMetricsLogic=Object(index_esm.kea)({props:{},path:["scenes","experiment","secondaryMetricsLogic"],connect:{values:[teamLogic.a,["currentTeamId"]]},actions:{setSecondaryMetrics:function setSecondaryMetrics(secondaryMetrics){return{secondaryMetrics:secondaryMetrics}},createNewMetric:!0,addNewMetric:function addNewMetric(metric){return{metric:metric}},updateMetricFilters:function updateMetricFilters(filters){return{filters:filters}},setFilters:function setFilters(filters){return{filters:filters}},setPreviewInsightId:function setPreviewInsightId(shortId){return{shortId:shortId}},createPreviewInsight:function createPreviewInsight(filters){return{filters:filters}},showModal:!0,hideModal:!1,changeInsightType:function changeInsightType(type){return{type:type}},setCurrentMetricName:function setCurrentMetricName(name){return{name:name}},deleteMetric:function deleteMetric(metricId){return{metricId:metricId}}},loaders:function loaders(_ref){var _loadExperiments,values=_ref.values;return{experiments:[[],{loadExperiments:(_loadExperiments=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var response;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,api_mock.a.get("api/projects/".concat(values.currentTeamId,"/experiments"));case 2:return response=_context.sent,_context.abrupt("return",response.results);case 4:case"end":return _context.stop()}}),_callee)}))),function loadExperiments(){return _loadExperiments.apply(this,arguments)})}]}},reducers:function reducers(_ref2){return{previewInsightId:[null,{setPreviewInsightId:function setPreviewInsightId(_,_ref3){return _ref3.shortId}}],metrics:[_ref2.props.initialMetrics,{addNewMetric:function addNewMetric(metrics,_ref4){var metric=_ref4.metric;return[].concat(toConsumableArray_default()(metrics),[secondaryMetricsLogic_objectSpread({},metric)])},deleteMetric:function deleteMetric(metrics,_ref5){var metricId=_ref5.metricId;return metrics.filter((function(_,idx){return idx!==metricId}))}}],modalVisible:[!1,{showModal:function showModal(){return!0},hideModal:function hideModal(){return!1}}],currentMetricName:["",{setCurrentMetricName:function setCurrentMetricName(_,_ref6){return _ref6.name}}],currentMetric:[BASIC_TRENDS_INSIGHT,{changeInsightType:function changeInsightType(metric,_ref7){return _ref7.type===src_types.r.TRENDS?BASIC_TRENDS_INSIGHT:metric.filters.insight===src_types.r.TRENDS?BASIC_FUNNELS_INSIGHT:BASIC_TRENDS_INSIGHT},updateMetricFilters:function updateMetricFilters(metric,_ref8){var filters=_ref8.filters;return secondaryMetricsLogic_objectSpread(secondaryMetricsLogic_objectSpread({},metric),{},{filters:filters})}}]}},listeners:function listeners(_ref9){var _createPreviewInsight,actions=_ref9.actions,values=_ref9.values,props=_ref9.props;return{createPreviewInsight:(_createPreviewInsight=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(_ref10){var filters,newInsightFilters,newInsight,createdInsight;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return filters=_ref10.filters,newInsightFilters=(null==filters?void 0:filters.insight)===src_types.r.FUNNELS?Object(cleanFilters.a)(secondaryMetricsLogic_objectSpread({insight:src_types.r.FUNNELS,funnel_viz_type:src_types.n.Steps,display:src_types.d.FunnelViz,date_from:Object(dayjs.a)().subtract(14,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(dayjs.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:constants.q.horizontal},filters)):Object(cleanFilters.a)(secondaryMetricsLogic_objectSpread({insight:src_types.r.TRENDS,date_from:Object(dayjs.a)().subtract(14,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(dayjs.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},filters)),newInsight={name:Object(randomAnimal.a)(),description:"",tags:[],filters:newInsightFilters,result:null},_context2.next=5,api_mock.a.create("api/projects/".concat(teamLogic.a.values.currentTeamId,"/insights"),newInsight);case 5:createdInsight=_context2.sent,actions.setPreviewInsightId(createdInsight.short_id);case 7:case"end":return _context2.stop()}}),_callee2)}))),function createPreviewInsight(_x){return _createPreviewInsight.apply(this,arguments)}),setFilters:function setFilters(_ref11){var _funnelLogic$findMoun,_trendsLogic$findMoun,filters=_ref11.filters;filters.insight===src_types.r.FUNNELS?null===(_funnelLogic$findMoun=funnelLogic.a.findMounted({dashboardItemId:values.previewInsightId}))||void 0===_funnelLogic$findMoun||_funnelLogic$findMoun.actions.setFilters(filters):null===(_trendsLogic$findMoun=trendsLogic.a.findMounted({dashboardItemId:values.previewInsightId}))||void 0===_trendsLogic$findMoun||_trendsLogic$findMoun.actions.setFilters(filters)},createNewMetric:function createNewMetric(){actions.addNewMetric(secondaryMetricsLogic_objectSpread(secondaryMetricsLogic_objectSpread({},values.currentMetric),{},{name:values.currentMetricName})),props.onMetricsChange(values.metrics),actions.changeInsightType(src_types.r.TRENDS),actions.setCurrentMetricName("")},deleteMetric:function deleteMetric(){props.onMetricsChange(values.metrics)},changeInsightType:function changeInsightType(){return actions.createPreviewInsight(values.currentMetric.filters)}}},events:function events(_ref12){var actions=_ref12.actions;return{afterMount:function afterMount(){actions.createPreviewInsight()}}}});function SecondaryMetrics_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function SecondaryMetrics_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?SecondaryMetrics_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):SecondaryMetrics_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function SecondaryMetrics(_ref){var onMetricsChange=_ref.onMetricsChange,initialMetrics=_ref.initialMetrics,logic=secondaryMetricsLogic({onMetricsChange:onMetricsChange,initialMetrics:initialMetrics}),_useValues=Object(index_esm.useValues)(logic),previewInsightId=_useValues.previewInsightId,metrics=_useValues.metrics,modalVisible=_useValues.modalVisible,currentMetric=_useValues.currentMetric,_useActions=Object(index_esm.useActions)(logic),createNewMetric=_useActions.createNewMetric,updateMetricFilters=_useActions.updateMetricFilters,_setFilters=_useActions.setFilters,showModal=_useActions.showModal,hideModal=_useActions.hideModal,changeInsightType=_useActions.changeInsightType,setCurrentMetricName=_useActions.setCurrentMetricName,deleteMetric=_useActions.deleteMetric,insightProps=Object(index_esm.useValues)(Object(insightLogic.b)({dashboardItemId:previewInsightId,syncWithUrl:!1})).insightProps,_useValues3=Object(index_esm.useValues)(Object(funnelLogic.a)(insightProps)),isStepsEmpty=_useValues3.isStepsEmpty,filterSteps=_useValues3.filterSteps;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(modal.a,{title:"Add secondary metric",visible:modalVisible,destroyOnClose:!0,onCancel:hideModal,onOk:function onOk(){createNewMetric(),hideModal()},okText:"Save",style:{minWidth:600}},react_default.a.createElement(es_form.a,{layout:"vertical",initialValues:{name:"",type:src_types.r.TRENDS},onValuesChange:function onValuesChange(values){values.name&&setCurrentMetricName(values.name)}},react_default.a.createElement(es_form.a.Item,{name:"name",label:"Name"},react_default.a.createElement(input.a,null)),react_default.a.createElement(es_form.a.Item,{name:"type",label:"Type"},react_default.a.createElement(es_select.a,{style:{display:"flex"},value:currentMetric.filters.insight,onChange:function onChange(){changeInsightType()},suffixIcon:react_default.a.createElement(CaretDownOutlined.a,null),dropdownMatchSelectWidth:!1},react_default.a.createElement(es_select.a.Option,{value:src_types.r.TRENDS},react_default.a.createElement(col.a,null,react_default.a.createElement("span",null,react_default.a.createElement("b",null,"Trend")))),react_default.a.createElement(es_select.a.Option,{value:src_types.r.FUNNELS},react_default.a.createElement(col.a,null,react_default.a.createElement("span",null,react_default.a.createElement("b",null,"Conversion funnel")))))),react_default.a.createElement(es_form.a.Item,{name:"query",label:"Query"},react_default.a.createElement(card.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},currentMetric.filters.insight===src_types.r.FUNNELS&&react_default.a.createElement(ActionFilter.a,{filters:currentMetric.filters,setFilters:function setFilters(payload){var newFilters=SecondaryMetrics_objectSpread(SecondaryMetrics_objectSpread({},currentMetric.filters),{},{insight:src_types.r.FUNNELS},payload);updateMetricFilters(newFilters),_setFilters(newFilters)},typeKey:"funnel-preview-metric",hideMathSelector:!0,hideDeleteBtn:1===filterSteps.length,buttonCopy:"Add funnel step",showSeriesIndicator:!isStepsEmpty,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.Cohorts,types.a.Elements],rowClassName:"action-filters-bordered"}),currentMetric.filters.insight===src_types.r.TRENDS&&react_default.a.createElement(ActionFilter.a,{entitiesLimit:1,horizontalUI:!0,filters:currentMetric.filters,setFilters:function setFilters(payload){var newFilters=SecondaryMetrics_objectSpread(SecondaryMetrics_objectSpread({},currentMetric.filters),{},{insight:src_types.r.TRENDS},payload);updateMetricFilters(newFilters),_setFilters(newFilters)},typeKey:"trend-preview-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.Cohorts,types.a.Elements]}))),react_default.a.createElement(es_form.a.Item,{name:"metric-preview",label:"Metric preview"},react_default.a.createElement(index_esm.BindLogic,{logic:insightLogic.b,props:insightProps},react_default.a.createElement(InsightContainer.a,{disableHeader:!0,disableTable:!0}))))),react_default.a.createElement(row.a,null,react_default.a.createElement(col.a,null,metrics.map((function(metric,idx){return react_default.a.createElement(row.a,{key:idx,className:"mt"},react_default.a.createElement(row.a,{align:"middle",className:"full-width border-all",style:{padding:8}},react_default.a.createElement("div",{style:{fontWeight:500}},"Name")," ",react_default.a.createElement("div",{className:"metric-name"},metric.name?metric.name:"".concat(metric.filters.insight," metric")),react_default.a.createElement(DeleteOutlined.a,{className:"text-danger",style:{padding:8},onClick:function onClick(){return deleteMetric(idx)}})),react_default.a.createElement(card.a,{className:"full-width",style:{borderTop:"none"},bodyStyle:{padding:0}},metric.filters.insight===src_types.r.FUNNELS&&react_default.a.createElement(ActionFilter.a,{filters:metric.filters,setFilters:function setFilters(payload){var newFilters=SecondaryMetrics_objectSpread(SecondaryMetrics_objectSpread({},metric.filters),{},{insight:src_types.r.FUNNELS},payload);updateMetricFilters(newFilters),_setFilters(newFilters)},typeKey:"funnel-preview-".concat(idx),hideMathSelector:!0,hideDeleteBtn:1===filterSteps.length,buttonCopy:"Add funnel step",showSeriesIndicator:!isStepsEmpty,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.Cohorts,types.a.Elements],rowClassName:"action-filters-bordered",readOnly:!0}),metric.filters.insight===src_types.r.TRENDS&&react_default.a.createElement(ActionFilter.a,{horizontalUI:!0,filters:metric.filters,setFilters:function setFilters(payload){var newFilters=SecondaryMetrics_objectSpread(SecondaryMetrics_objectSpread({},metric.filters),{},{insight:src_types.r.TRENDS},payload);updateMetricFilters(newFilters),_setFilters(newFilters)},typeKey:"trend-preview-".concat(idx),buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.Cohorts,types.a.Elements],readOnly:!0})))})),metrics&&!(metrics.length>2)&&react_default.a.createElement(col.a,null,react_default.a.createElement("div",{className:"mb-05 mt"},react_default.a.createElement(es_button.a,{style:{color:"var(--primary)",minWidth:240},onClick:showModal},"Add metric"))))))}try{SecondaryMetrics.displayName="SecondaryMetrics",SecondaryMetrics.__docgenInfo={description:"",displayName:"SecondaryMetrics",props:{onMetricsChange:{defaultValue:null,description:"",name:"onMetricsChange",required:!0,type:{name:"(metrics: SecondaryExperimentMetric[]) => void"}},initialMetrics:{defaultValue:null,description:"",name:"initialMetrics",required:!0,type:{name:"SecondaryExperimentMetric[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"]={docgenInfo:SecondaryMetrics.__docgenInfo,name:"SecondaryMetrics",path:"frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"})}catch(__react_docgen_typescript_loader_error){}var colors=__webpack_require__(135),EntityFilterInfo=__webpack_require__(409),EditableField=__webpack_require__(460),Link=__webpack_require__(56),featureFlagLogic=__webpack_require__(75),slider=__webpack_require__(4735),input_number=__webpack_require__(4157),InsightLabel=__webpack_require__(273),PropertyFilterButton=__webpack_require__(506);function ExperimentWorkflow(){var _useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),workflowValidateStepCompleted=_useState2[0],setWorkflowValidateStepCompleted=_useState2[1],_useState3=Object(react.useState)(!1),_useState4=slicedToArray_default()(_useState3,2),workflowLaunchStepCompleted=_useState4[0],setWorkflowLaunchStepCompleted=_useState4[1];return react_default.a.createElement(card.a,{className:"experiment-workflow",title:react_default.a.createElement("span",{className:"card-secondary"},"Experiment workflow")},react_default.a.createElement(row.a,null,react_default.a.createElement(col.a,{className:"exp-workflow-step step-completed full-width"},react_default.a.createElement(row.a,{align:"middle"},react_default.a.createElement(icons.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}),react_default.a.createElement("b",{className:"ml-05"},"Create experiment")),react_default.a.createElement("div",{className:"ml-2"},"Set variants, select participants, and add secondary metrics"))),react_default.a.createElement(row.a,null,react_default.a.createElement(col.a,{className:"full-width exp-workflow-step ".concat(workflowValidateStepCompleted?"step-completed":""),onClick:function onClick(){return setWorkflowValidateStepCompleted(!workflowValidateStepCompleted)}},react_default.a.createElement(row.a,{align:"middle"},workflowValidateStepCompleted?react_default.a.createElement(icons.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):react_default.a.createElement(icons.IconRadioButtonUnchecked,null),react_default.a.createElement("b",{className:"ml-05"},"Validate experiment")),react_default.a.createElement("div",{className:"ml-2"},"Once you've written your code, it's a good idea to test that each variant behaves as you'd expect."))),react_default.a.createElement(row.a,null,react_default.a.createElement(col.a,{className:"full-width exp-workflow-step ".concat(workflowLaunchStepCompleted?"step-completed":""),onClick:function onClick(){return setWorkflowLaunchStepCompleted(!workflowLaunchStepCompleted)}},react_default.a.createElement(row.a,{align:"middle"},workflowLaunchStepCompleted?react_default.a.createElement(icons.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):react_default.a.createElement(icons.IconRadioButtonUnchecked,null),react_default.a.createElement("b",{className:"ml-05"},"Launch experiment")),react_default.a.createElement("div",{className:"ml-2"},"Run your experiment, monitor results, and decide when to terminate your experiment."))))}function ExperimentPreview(_ref){var _experiment$parameter,_experiment$parameter2,_experiment$filters,_experiment$filters$p,_experiment$filters2,_experiment$filters3,_experiment$filters4,experiment=_ref.experiment,trendCount=_ref.trendCount,funnelConversionRate=_ref.funnelConversionRate,trendExposure=_ref.trendExposure,funnelSampleSize=_ref.funnelSampleSize,funnelEntrants=_ref.funnelEntrants,_useValues=Object(index_esm.useValues)(experimentLogic),experimentInsightType=_useValues.experimentInsightType,experimentId=_useValues.experimentId,editingExistingExperiment=_useValues.editingExistingExperiment,minimumDetectableChange=_useValues.minimumDetectableChange,expectedRunningTime=_useValues.expectedRunningTime,aggregationLabel=_useValues.aggregationLabel,setNewExperimentData=Object(index_esm.useActions)(experimentLogic).setNewExperimentData,sliderMaxValue=experimentInsightType===src_types.r.FUNNELS&&100-funnelConversionRate<50?100-funnelConversionRate:50,currentDuration=Object(dayjs.a)().diff(Object(dayjs.a)(null==experiment?void 0:experiment.start_date),"hour"),runningTime=0;runningTime=(null==experiment?void 0:experiment.start_date)?expectedRunningTime(funnelEntrants||1,funnelSampleSize||0,currentDuration):expectedRunningTime(funnelEntrants||1,funnelSampleSize||0);var expectedEndDate=Object(dayjs.a)(null==experiment?void 0:experiment.start_date).add(runningTime,"hour"),showEndDate=!(null==experiment?void 0:experiment.end_date)&&currentDuration>=24&&funnelEntrants&&funnelSampleSize;return react_default.a.createElement(row.a,null,react_default.a.createElement(col.a,{span:(null==experiment?void 0:experiment.start_date)||"new"===experimentId||editingExistingExperiment?24:12},"new"===experimentId&&react_default.a.createElement(row.a,{className:"experiment-preview-row"},react_default.a.createElement("div",null,react_default.a.createElement("div",null,react_default.a.createElement("b",null,"Experiment preview")),react_default.a.createElement("div",{className:"text-muted"},"Here are the baseline metrics for your experiment. Adjust your minimum detectible threshold to adjust for the smallest conversion value youâ€™ll accept, and the experiment duration."," "))),("new"===experimentId||editingExistingExperiment)&&react_default.a.createElement(row.a,{className:"mb"},react_default.a.createElement(col.a,{span:24},react_default.a.createElement("div",null,react_default.a.createElement("b",null,"Minimum acceptable improvement"),react_default.a.createElement(tooltip.a,{title:"Minimum acceptable improvement is a calculation that estimates the smallest significant improvement you are willing to accept."},react_default.a.createElement(InfoCircleOutlined.a,{style:{marginLeft:4}}))),react_default.a.createElement(row.a,{className:"mde-slider"},react_default.a.createElement(col.a,{span:8},react_default.a.createElement(slider.a,{defaultValue:5,value:minimumDetectableChange,min:1,max:sliderMaxValue,trackStyle:{background:"var(--primary)"},handleStyle:{background:"var(--primary)"},onChange:function onChange(value){setNewExperimentData({parameters:{minimum_detectable_effect:value}})},tipFormatter:function tipFormatter(value){return"".concat(value,"%")}})),react_default.a.createElement(input_number.a,{min:1,max:sliderMaxValue,defaultValue:5,formatter:function formatter(value){return"".concat(value,"%")},style:{margin:"0 16px"},value:minimumDetectableChange,onChange:function onChange(value){setNewExperimentData({parameters:{minimum_detectable_effect:value}})}})))),react_default.a.createElement(row.a,{className:"experiment-preview-row ".concat((null==experiment?void 0:experiment.start_date)?"mr":"")},experimentInsightType===src_types.r.TRENDS?react_default.a.createElement(react_default.a.Fragment,null,!(null==experiment?void 0:experiment.start_date)&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(col.a,{span:6},react_default.a.createElement("div",{className:"card-secondary"},"Baseline Count"),react_default.a.createElement("div",{className:"l4"},trendCount)),react_default.a.createElement(col.a,{span:6},react_default.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Count"),react_default.a.createElement("div",{className:"l4"},trendCount+Math.ceil(trendCount*(minimumDetectableChange/100))))),react_default.a.createElement(col.a,{span:12},react_default.a.createElement("div",{className:"card-secondary"},"Recommended running time"),react_default.a.createElement("div",null,react_default.a.createElement("span",{className:"l4"},"~",trendExposure)," days"))):react_default.a.createElement(react_default.a.Fragment,null,!(null==experiment?void 0:experiment.start_date)&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(col.a,{span:12},react_default.a.createElement("div",{className:"card-secondary"},"Baseline Conversion Rate"),react_default.a.createElement("div",{className:"l4"},funnelConversionRate.toFixed(1),"%")),react_default.a.createElement(col.a,{span:12},react_default.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Conversion Rate"),react_default.a.createElement("div",{className:"l4"},(funnelConversionRate+minimumDetectableChange).toFixed(1),"%"))),react_default.a.createElement(col.a,{span:12},react_default.a.createElement("div",{className:"card-secondary"},"Recommended Sample Size"),react_default.a.createElement("div",{className:"pb"},react_default.a.createElement("span",{className:"l4"},"~",funnelSampleSize)," persons")),!(null==experiment?void 0:experiment.start_date)&&react_default.a.createElement(col.a,{span:12},react_default.a.createElement("div",{className:"card-secondary"},"Recommended running time"),react_default.a.createElement("div",null,react_default.a.createElement("span",{className:"l4"},"~",runningTime)," days"))),react_default.a.createElement(row.a,{className:"full-width mt"},react_default.a.createElement(col.a,{span:12},react_default.a.createElement("div",{className:"card-secondary"},"Experiment variants"),react_default.a.createElement("ul",{className:"variants-list"},null==experiment||null===(_experiment$parameter=experiment.parameters)||void 0===_experiment$parameter||null===(_experiment$parameter2=_experiment$parameter.feature_flag_variants)||void 0===_experiment$parameter2?void 0:_experiment$parameter2.map((function(variant,idx){return react_default.a.createElement("li",{key:idx},variant.key)})))),react_default.a.createElement(col.a,{span:12},react_default.a.createElement("div",{className:"card-secondary"},"Participants"),react_default.a.createElement("div",null,(null==experiment||null===(_experiment$filters=experiment.filters)||void 0===_experiment$filters||null===(_experiment$filters$p=_experiment$filters.properties)||void 0===_experiment$filters$p?void 0:_experiment$filters$p.length)?react_default.a.createElement("div",null,null==experiment?void 0:experiment.filters.properties.map((function(item){return react_default.a.createElement(PropertyFilterButton.c,{key:item.key,item:item})}))):react_default.a.createElement(react_default.a.Fragment,null,"100% of"," ",null!=(null==experiment||null===(_experiment$filters2=experiment.filters)||void 0===_experiment$filters2?void 0:_experiment$filters2.aggregation_group_type_index)?Object(lib_utils.j)(aggregationLabel(experiment.filters.aggregation_group_type_index).plural):"users")))),react_default.a.createElement(row.a,null,"new"!==experimentId&&!editingExistingExperiment&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(col.a,{className:"mr"},react_default.a.createElement("div",{className:"card-secondary mt"},"Start date"),(null==experiment?void 0:experiment.start_date)?react_default.a.createElement("span",null,Object(dayjs.a)(null==experiment?void 0:experiment.start_date).format("D MMM YYYY")):react_default.a.createElement("span",{className:"description"},"Not started yet")),experimentInsightType===src_types.r.FUNNELS&&showEndDate?react_default.a.createElement(col.a,{className:"mr"},react_default.a.createElement("div",{className:"card-secondary mt"},"Expected end date"),react_default.a.createElement("span",null,expectedEndDate.isAfter(Object(dayjs.a)())?expectedEndDate.format("D MMM YYYY"):Object(dayjs.a)().format("D MMM YYYY"))):null),(null==experiment?void 0:experiment.end_date)&&react_default.a.createElement(col.a,{className:"ml"},react_default.a.createElement("div",{className:"card-secondary mt"},"Completed date"),react_default.a.createElement("span",null,Object(dayjs.a)(null==experiment?void 0:experiment.end_date).format("D MMM YYYY"))))),"new"!==experimentId&&!editingExistingExperiment&&react_default.a.createElement(row.a,{className:"experiment-preview-row"},react_default.a.createElement(col.a,null,react_default.a.createElement("div",{className:"card-secondary mb-05"},experimentInsightType===src_types.r.FUNNELS?"Conversion goal steps":"Trend goal"),[].concat(toConsumableArray_default()((null==experiment||null===(_experiment$filters3=experiment.filters)||void 0===_experiment$filters3?void 0:_experiment$filters3.events)||[]),toConsumableArray_default()((null==experiment||null===(_experiment$filters4=experiment.filters)||void 0===_experiment$filters4?void 0:_experiment$filters4.actions)||[])).sort((function(a,b){return(a.order||0)-(b.order||0)})).map((function(event,idx){var _event$properties;return react_default.a.createElement(col.a,{key:idx,className:"mb-05"},react_default.a.createElement(row.a,{style:{marginBottom:4}},react_default.a.createElement("div",{className:"preview-conversion-goal-num"},experimentInsightType===src_types.r.FUNNELS?(event.order||0)+1:idx+1),react_default.a.createElement("b",null,react_default.a.createElement(InsightLabel.b,{action:event,showCountedByTag:experimentInsightType===src_types.r.TRENDS,hideIcon:!0}))),null===(_event$properties=event.properties)||void 0===_event$properties?void 0:_event$properties.map((function(prop){return react_default.a.createElement(PropertyFilterButton.c,{key:prop.key,item:prop})})))}))))),"new"!==experimentId&&!editingExistingExperiment&&!(null==experiment?void 0:experiment.start_date)&&react_default.a.createElement(col.a,{span:12,className:"pl"},react_default.a.createElement(ExperimentWorkflow,null)))}try{ExperimentPreview.displayName="ExperimentPreview",ExperimentPreview.__docgenInfo={description:"",displayName:"ExperimentPreview",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}},trendCount:{defaultValue:null,description:"",name:"trendCount",required:!0,type:{name:"number"}},trendExposure:{defaultValue:null,description:"",name:"trendExposure",required:!1,type:{name:"number"}},funnelSampleSize:{defaultValue:null,description:"",name:"funnelSampleSize",required:!1,type:{name:"number"}},funnelConversionRate:{defaultValue:null,description:"",name:"funnelConversionRate",required:!0,type:{name:"number"}},funnelEntrants:{defaultValue:null,description:"",name:"funnelEntrants",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"]={docgenInfo:ExperimentPreview.__docgenInfo,name:"ExperimentPreview",path:"frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"})}catch(__react_docgen_typescript_loader_error){}var CodeSnippet=__webpack_require__(53);function ExperimentImplementationDetails(_ref){var _experiment$parameter,_experiment$parameter2,_experiment$feature_f,experiment=_ref.experiment,_useState=Object(react.useState)("control"),_useState2=slicedToArray_default()(_useState,2),currentVariant=_useState2[0],setCurrentVariant=_useState2[1];return react_default.a.createElement(card.a,{title:react_default.a.createElement("span",{className:"card-secondary"},"Feature flag usage and implementation"),className:"experiment-implementation-details"},react_default.a.createElement(row.a,{justify:"space-between",className:"mb-05"},react_default.a.createElement("div",null,react_default.a.createElement("span",{className:"mr-05"},"Variant group"),react_default.a.createElement(es_select.a,{onChange:setCurrentVariant,defaultValue:"control",suffixIcon:react_default.a.createElement(CaretDownOutlined.a,null)},null==experiment||null===(_experiment$parameter=experiment.parameters)||void 0===_experiment$parameter||null===(_experiment$parameter2=_experiment$parameter.feature_flag_variants)||void 0===_experiment$parameter2?void 0:_experiment$parameter2.map((function(variant,idx){return react_default.a.createElement(es_select.a.Option,{key:idx,value:variant.key},variant.key)})))),react_default.a.createElement("div",null,react_default.a.createElement(CodeLanguageSelect,null))),react_default.a.createElement("b",null,"Implement your experiment in code"),react_default.a.createElement(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0},"if (posthog.getFeatureFlag('".concat(null!==(_experiment$feature_f=null==experiment?void 0:experiment.feature_flag_key)&&void 0!==_experiment$feature_f?_experiment$feature_f:"","') === '").concat(currentVariant,"') {\n    // where '").concat(currentVariant,"' is the variant, run your code here\n}")),react_default.a.createElement("b",null,"Test that it works"),react_default.a.createElement(CodeSnippet.a,{language:CodeSnippet.b.JavaScript},"posthog.feature_flags.override({'".concat(null==experiment?void 0:experiment.feature_flag_key,"': '").concat(currentVariant,"'})")),react_default.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://posthog.com/docs/user-guides/feature-flags"},react_default.a.createElement(row.a,{align:"middle"},"Experiment implementation guide",react_default.a.createElement(icons.IconOpenInNew,{className:"ml-05"}))))}try{ExperimentImplementationDetails.displayName="ExperimentImplementationDetails",ExperimentImplementationDetails.__docgenInfo={description:"",displayName:"ExperimentImplementationDetails",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"]={docgenInfo:ExperimentImplementationDetails.__docgenInfo,name:"ExperimentImplementationDetails",path:"frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"})}catch(__react_docgen_typescript_loader_error){}function Experiment_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function Experiment_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Experiment_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):Experiment_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var scene={component:Experiment_,logic:experimentLogic};function Experiment_(){var _trendResults$,_results$,_experimentData$param,_experimentData$param2,_newExperimentData$pa,_newExperimentData$fi,_experimentData$param3,_experimentData$param4,_experimentData$param9,_experimentData$param10,_useValues=Object(index_esm.useValues)(experimentLogic),newExperimentData=_useValues.newExperimentData,experimentData=_useValues.experimentData,experimentInsightId=_useValues.experimentInsightId,minimumSampleSizePerVariant=_useValues.minimumSampleSizePerVariant,recommendedExposureForCountData=_useValues.recommendedExposureForCountData,variants=_useValues.variants,experimentResults=_useValues.experimentResults,countDataForVariant=_useValues.countDataForVariant,editingExistingExperiment=_useValues.editingExistingExperiment,experimentInsightType=_useValues.experimentInsightType,experimentResultsLoading=_useValues.experimentResultsLoading,parsedSecondaryMetrics=_useValues.parsedSecondaryMetrics,areResultsSignificant=_useValues.areResultsSignificant,experimentId=_useValues.experimentId,conversionRateForVariant=_useValues.conversionRateForVariant,getIndexForVariant=_useValues.getIndexForVariant,significanceBannerDetails=_useValues.significanceBannerDetails,areTrendResultsConfusing=_useValues.areTrendResultsConfusing,taxonomicGroupTypesForSelection=_useValues.taxonomicGroupTypesForSelection,groupTypes=_useValues.groupTypes,aggregationLabel=_useValues.aggregationLabel,secondaryMetricResults=_useValues.secondaryMetricResults,_useActions=Object(index_esm.useActions)(experimentLogic),setNewExperimentData=_useActions.setNewExperimentData,createExperiment=_useActions.createExperiment,launchExperiment=_useActions.launchExperiment,_setFilters=_useActions.setFilters,setEditExperiment=_useActions.setEditExperiment,endExperiment=_useActions.endExperiment,addExperimentGroup=_useActions.addExperimentGroup,updateExperiment=_useActions.updateExperiment,updateExperimentGroup=_useActions.updateExperimentGroup,removeExperimentGroup=_useActions.removeExperimentGroup,setSecondaryMetrics=_useActions.setSecondaryMetrics,setExperimentInsightType=_useActions.setExperimentInsightType,archiveExperiment=_useActions.archiveExperiment,featureFlags=Object(index_esm.useValues)(featureFlagLogic.a).featureFlags,_Form$useForm=es_form.a.useForm(),form=slicedToArray_default()(_Form$useForm,1)[0],_useState=Object(react.useState)(!0),_useState2=slicedToArray_default()(_useState,2),showWarning=_useState2[0],setShowWarning=_useState2[1],insightProps=Object(index_esm.useValues)(Object(insightLogic.b)({dashboardItemId:experimentInsightId,syncWithUrl:!1})).insightProps,_useValues4=Object(index_esm.useValues)(Object(funnelLogic.a)(insightProps)),isStepsEmpty=_useValues4.isStepsEmpty,filterSteps=_useValues4.filterSteps,funnelsFilters=_useValues4.filters,results=_useValues4.results,conversionMetrics=_useValues4.conversionMetrics,_useValues5=Object(index_esm.useValues)(Object(trendsLogic.a)(insightProps)),trendsFilters=_useValues5.filters,trendResults=_useValues5.results,conversionRate=100*conversionMetrics.totalRate,sampleSize=minimumSampleSizePerVariant(conversionRate)*variants.length,trendCount=null===(_trendResults$=trendResults[0])||void 0===_trendResults$?void 0:_trendResults$.count,entrants=null==results||null===(_results$=results[0])||void 0===_results$?void 0:_results$.count,exposure=recommendedExposureForCountData(trendCount),funnelResultsPersonsTotal=experimentInsightType===src_types.r.FUNNELS&&(null==experimentResults?void 0:experimentResults.insight)?experimentResults.insight.reduce((function(sum,variantResult){return variantResult[0].count+sum}),0):0,experimentProgressPercent=experimentInsightType===src_types.r.FUNNELS?(funnelResultsPersonsTotal||0)/((null==experimentData||null===(_experimentData$param=experimentData.parameters)||void 0===_experimentData$param?void 0:_experimentData$param.recommended_sample_size)||1)*100:Object(dayjs.a)().diff(null==experimentData?void 0:experimentData.start_date,"day")/((null==experimentData||null===(_experimentData$param2=experimentData.parameters)||void 0===_experimentData$param2?void 0:_experimentData$param2.recommended_running_time)||1)*100,status=function status(){return(null==experimentData?void 0:experimentData.start_date)?(null==experimentData?void 0:experimentData.end_date)?"complete":"running":"draft"};return react_default.a.createElement(react_default.a.Fragment,null,"new"===experimentId||editingExistingExperiment?react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(row.a,{align:"middle",justify:"space-between",style:{borderBottom:"1px solid var(--border)",marginBottom:"1rem",paddingBottom:8}},react_default.a.createElement(PageHeader.a,{title:"New Experiment"})),react_default.a.createElement(es_form.a,{name:"new-experiment",layout:"vertical",className:"experiment-form",form:form,onValuesChange:function onValuesChange(values){return setNewExperimentData(values)},initialValues:{name:null==newExperimentData?void 0:newExperimentData.name,feature_flag_key:null==newExperimentData?void 0:newExperimentData.feature_flag_key,description:null==newExperimentData?void 0:newExperimentData.description},onFinish:function onFinish(){return createExperiment(!0,exposure,sampleSize)},scrollToFirstError:!0},react_default.a.createElement("div",null,react_default.a.createElement(index_esm.BindLogic,{logic:insightLogic.b,props:insightProps},react_default.a.createElement(row.a,null,react_default.a.createElement(col.a,{span:12,style:{paddingRight:24}},react_default.a.createElement(row.a,{className:"full-width"},react_default.a.createElement(es_form.a.Item,{label:"Name",name:"name",rules:[{required:!0,message:"You have to enter a name."}],requiredMark:!1},react_default.a.createElement(input.a,{"data-attr":"experiment-name",className:"ph-ignore-input"})),react_default.a.createElement(es_form.a.Item,{style:{paddingLeft:16},label:react_default.a.createElement("div",null,"Feature flag key"," ",react_default.a.createElement(tooltip.a,{title:"Choose a unique key. This will create a new feature flag which will be associated with this experiment."},react_default.a.createElement(InfoCircleOutlined.a,null))),name:"feature_flag_key",requiredMark:!1,rules:[{required:!0,message:"You have to enter a feature flag key name."}]},react_default.a.createElement(input.a,{"data-attr":"experiment-feature-flag-key",disabled:editingExistingExperiment}))),react_default.a.createElement(es_form.a.Item,{label:react_default.a.createElement("div",null,"Description ",react_default.a.createElement("span",{className:"text-muted"},"(optional)")),name:"description"},react_default.a.createElement(input.a.TextArea,{"data-attr":"experiment-description",className:"ph-ignore-input",placeholder:"Adding a helpful description can ensure others know what this experiment is about."})),(null==newExperimentData||null===(_newExperimentData$pa=newExperimentData.parameters)||void 0===_newExperimentData$pa?void 0:_newExperimentData$pa.feature_flag_variants)&&react_default.a.createElement(col.a,null,react_default.a.createElement("label",null,react_default.a.createElement("b",null,"Experiment variants")),react_default.a.createElement("div",{className:"text-muted"},"Participants are divided into variant groups evenly. All experiments must consist of a control group and at least one test group. Experiments may have at most 3 test groups."),react_default.a.createElement(col.a,{className:"variants"},newExperimentData.parameters.feature_flag_variants.map((function(variant,idx){return react_default.a.createElement(es_form.a,{key:"".concat(variant,"-").concat(idx),initialValues:{key:variant.key},onValuesChange:function onValuesChange(changedValues){updateExperimentGroup(changedValues,idx)},validateTrigger:["onChange","onBlur"]},react_default.a.createElement(row.a,{className:"feature-flag-variant"},react_default.a.createElement(es_form.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}]},react_default.a.createElement(input.a,{disabled:0===idx,"data-attr":"feature-flag-variant-key","data-key-index":idx.toString(),className:"ph-ignore-input",style:{minWidth:300},placeholder:"example-variant-".concat(idx+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),react_default.a.createElement("div",{className:"float-right"},!(0===idx||1===idx)&&react_default.a.createElement(tooltip.a,{title:"Delete this variant",placement:"bottomLeft"},react_default.a.createElement(es_button.a,{type:"link",icon:react_default.a.createElement(DeleteOutlined.a,null),onClick:function onClick(){return removeExperimentGroup(idx)},style:{color:"var(--danger)",float:"right"}})))))})),newExperimentData.parameters.feature_flag_variants.length<4&&react_default.a.createElement("div",null,react_default.a.createElement(es_button.a,{style:{color:"var(--primary)",border:"none",boxShadow:"none",marginTop:"1rem",paddingLeft:0},icon:react_default.a.createElement(PlusOutlined.a,null),onClick:function onClick(){return addExperimentGroup()}},"Add test variant")))),react_default.a.createElement(row.a,{className:"person-selection"},react_default.a.createElement("span",null,react_default.a.createElement("b",null,"Select Participants")),react_default.a.createElement("span",null,react_default.a.createElement("b",null,"Participant Type"),react_default.a.createElement(es_select.a,{value:null!=(null==newExperimentData||null===(_newExperimentData$fi=newExperimentData.filters)||void 0===_newExperimentData$fi?void 0:_newExperimentData$fi.aggregation_group_type_index)?newExperimentData.filters.aggregation_group_type_index:-1,onChange:function onChange(value){var _newExperimentData$fi2,groupTypeIndex=-1!==value?value:void 0;groupTypeIndex!=(null==newExperimentData||null===(_newExperimentData$fi2=newExperimentData.filters)||void 0===_newExperimentData$fi2?void 0:_newExperimentData$fi2.aggregation_group_type_index)&&(_setFilters({properties:[],aggregation_group_type_index:groupTypeIndex}),setNewExperimentData({filters:{aggregation_group_type_index:groupTypeIndex,properties:[]}}))},style:{marginLeft:8},"data-attr":"participant-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]}},react_default.a.createElement(es_select.a.Option,{key:-1,value:-1},"Users"),groupTypes.map((function(groupType){return react_default.a.createElement(es_select.a.Option,{key:groupType.group_type_index,value:groupType.group_type_index},Object(lib_utils.j)(aggregationLabel(groupType.group_type_index).plural))})))),react_default.a.createElement(col.a,null,react_default.a.createElement("div",{className:"text-muted"},"Select the entities who will participate in this experiment. If no filters are set, 100% of participants will be targeted."),react_default.a.createElement("div",{style:{flex:3,marginRight:5}},react_default.a.createElement(PropertyFilters.a,{pageKey:"EditFunnel-property",propertyFilters:experimentInsightType===src_types.r.FUNNELS?funnelsFilters.properties:trendsFilters.properties,onChange:function onChange(anyProperties){setNewExperimentData({filters:{properties:anyProperties}}),_setFilters({properties:anyProperties.filter(utils.b)})},style:{margin:"1rem 0 0"},taxonomicGroupTypes:taxonomicGroupTypesForSelection,popoverPlacement:"top",taxonomicPopoverPlacement:"auto"})))),react_default.a.createElement(row.a,{className:"metrics-selection"},react_default.a.createElement(col.a,{style:{paddingRight:8}},react_default.a.createElement("div",{className:"mb-05"},react_default.a.createElement("b",null,"Goal type"),react_default.a.createElement("div",{className:"text-muted"},experimentInsightType===src_types.r.TRENDS?"Track counts of a specific event or action":"Track how many persons complete a sequence of actions and or events")),react_default.a.createElement(es_select.a,{style:{display:"flex"},value:experimentInsightType,onChange:setExperimentInsightType,suffixIcon:react_default.a.createElement(CaretDownOutlined.a,null),dropdownMatchSelectWidth:!1},react_default.a.createElement(es_select.a.Option,{value:src_types.r.TRENDS},react_default.a.createElement(col.a,null,react_default.a.createElement("span",null,react_default.a.createElement("b",null,"Trend")))),react_default.a.createElement(es_select.a.Option,{value:src_types.r.FUNNELS},react_default.a.createElement(col.a,null,react_default.a.createElement("span",null,react_default.a.createElement("b",null,"Conversion funnel"))))),react_default.a.createElement("div",{className:"mb mt"},react_default.a.createElement("b",null,"Experiment goal"),experimentInsightType===src_types.r.TRENDS&&react_default.a.createElement("div",{className:"text-muted"},"Trend-based experiments can have at most one graph series. This metric is used to track the progress of your experiment.")),react_default.a.createElement(row.a,null,react_default.a.createElement(card.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},experimentInsightType===src_types.r.FUNNELS&&react_default.a.createElement(ActionFilter.a,{filters:funnelsFilters,setFilters:function setFilters(payload){setNewExperimentData({filters:payload}),_setFilters(payload)},typeKey:"EditFunnel-action",hideMathSelector:!0,hideDeleteBtn:1===filterSteps.length,buttonCopy:"Add funnel step",buttonType:"link",showSeriesIndicator:!isStepsEmpty,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.Cohorts,types.a.Elements],rowClassName:"action-filters-bordered"}),experimentInsightType===src_types.r.TRENDS&&react_default.a.createElement(ActionFilter.a,{horizontalUI:!0,filters:trendsFilters,setFilters:function setFilters(payload){setNewExperimentData({filters:payload}),_setFilters(payload)},typeKey:"experiment-trends",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.Cohorts,types.a.Elements],customRowPrefix:trendsFilters.insight===src_types.r.LIFECYCLE?react_default.a.createElement(react_default.a.Fragment,null,"Showing ",react_default.a.createElement("b",null,"Unique users")," who did"):void 0}))))),featureFlags[constants.o.EXPERIMENTS_SECONDARY_METRICS]&&react_default.a.createElement(row.a,{className:"mt"},react_default.a.createElement(col.a,null,react_default.a.createElement("div",null,react_default.a.createElement("b",null,"Secondary metrics"),react_default.a.createElement("span",{className:"text-muted ml-05"},"(optional)")),react_default.a.createElement("div",{className:"text-muted",style:{marginTop:4}},"Use secondary metrics to monitor metrics related to your experiment goal. You can add up to three secondary metrics."," ")),react_default.a.createElement(SecondaryMetrics,{onMetricsChange:function onMetricsChange(metrics){return setSecondaryMetrics(metrics)},initialMetrics:parsedSecondaryMetrics}))),react_default.a.createElement(col.a,{span:12},react_default.a.createElement(card.a,{className:"experiment-preview"},react_default.a.createElement(ExperimentPreview,{experiment:newExperimentData,trendCount:trendCount,trendExposure:exposure,funnelSampleSize:sampleSize,funnelEntrants:entrants,funnelConversionRate:conversionRate}),react_default.a.createElement(InsightContainer.a,{disableHeader:experimentInsightType===src_types.r.TRENDS,disableTable:!0})))))),react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(SaveOutlined.a,null),className:"float-right",type:"primary",htmlType:"submit"},"Save"))):experimentData?react_default.a.createElement("div",{className:"view-experiment"},react_default.a.createElement(row.a,{className:"draft-header"},react_default.a.createElement(row.a,{justify:"space-between",align:"middle",className:"full-width pb"},react_default.a.createElement(col.a,null,react_default.a.createElement(row.a,null,react_default.a.createElement(PageHeader.a,{style:{margin:0,paddingRight:8},title:"".concat(null==experimentData?void 0:experimentData.name)}),react_default.a.createElement(CopyToClipboard.a,{explicitValue:experimentData.feature_flag_key,iconStyle:{color:"var(--text-muted-alt)"}},react_default.a.createElement("span",{className:"text-muted"},experimentData.feature_flag_key)),react_default.a.createElement(tag.a,{style:{alignSelf:"center",marginLeft:"1rem"},color:{running:"green",draft:"default",complete:"purple"}[status()]},react_default.a.createElement("b",{className:"uppercase"},status())),experimentResults&&experimentData.end_date&&react_default.a.createElement(tag.a,{style:{alignSelf:"center"},color:areResultsSignificant?"green":"geekblue"},react_default.a.createElement("b",{className:"uppercase"},areResultsSignificant?"Significant Results":"Results not significant"))),react_default.a.createElement("span",{className:"exp-description"},experimentData.start_date?react_default.a.createElement(EditableField.a,{multiline:!0,name:"description",value:experimentData.description||"",placeholder:"Description (optional)",onSave:function onSave(value){return updateExperiment({description:value})},maxLength:400,"data-attr":"experiment-description",compactButtons:!0}):react_default.a.createElement(react_default.a.Fragment,null,experimentData.description||"There is no description for this experiment."))),experimentData&&!experimentData.start_date&&react_default.a.createElement("div",null,react_default.a.createElement(es_button.a,{className:"mr-05",onClick:function onClick(){return setEditExperiment(!0)}},"Edit"),react_default.a.createElement(es_button.a,{type:"primary",onClick:function onClick(){return launchExperiment()}},"Launch")),experimentData&&experimentData.start_date&&!experimentData.end_date&&react_default.a.createElement(es_button.a,{className:"stop-experiment",onClick:function onClick(){return endExperiment()}},"Stop experiment"),(null==experimentData?void 0:experimentData.end_date)&&Object(dayjs.a)().isSameOrAfter(Object(dayjs.a)(experimentData.end_date),"day")&&!experimentData.archived&&react_default.a.createElement(es_button.a,{className:"archive-experiment",onClick:function onClick(){return archiveExperiment()}},react_default.a.createElement("b",null,"Archive experiment")))),react_default.a.createElement(row.a,null,showWarning&&experimentResults&&areResultsSignificant&&!experimentData.end_date&&react_default.a.createElement(row.a,{align:"middle",className:"significant-results"},react_default.a.createElement(col.a,{span:19,style:{color:"#497342"}},"Your results are ",react_default.a.createElement("b",null,"statistically significant"),"."," ",experimentData.end_date?"":"You can end this experiment now or let it run to completion."),react_default.a.createElement(col.a,{span:5},react_default.a.createElement(es_button.a,{style:{color:"#497342"},onClick:function onClick(){return setShowWarning(!1)}},"Dismiss"))),showWarning&&experimentResults&&!areResultsSignificant&&!experimentData.end_date&&react_default.a.createElement(row.a,{align:"middle",className:"not-significant-results"},react_default.a.createElement(col.a,{span:23,style:{color:"#2D2D2D"}},react_default.a.createElement("b",null,"Your results are not statistically significant"),". ",significanceBannerDetails," ",(null==experimentData?void 0:experimentData.end_date)?"":"We don't recommend ending this experiment yet."," ","See our"," ",react_default.a.createElement("a",{href:"https://posthog.com/docs/user-guides/experimentation#funnel-experiment-calculations"}," ","experimentation guide"," "),"for more information."," "),react_default.a.createElement(col.a,{span:1},react_default.a.createElement(CloseOutlined.a,{className:"close-button",onClick:function onClick(){return setShowWarning(!1)}}))),showWarning&&experimentData.end_date&&react_default.a.createElement(row.a,{align:"middle",className:"feature-flag-mods"},react_default.a.createElement(col.a,{span:23},react_default.a.createElement("b",null,"Your experiment is complete.")," We recommend removing the feature flag from your code completely, instead of relying on this distribution:"," ",react_default.a.createElement(Link.a,{to:experimentData.feature_flag?urls.a.featureFlag(experimentData.feature_flag):void 0},react_default.a.createElement("b",null,"Adjust feature flag distribution."))),react_default.a.createElement(col.a,{span:1},react_default.a.createElement(CloseOutlined.a,{className:"close-button",onClick:function onClick(){return setShowWarning(!1)}})))),react_default.a.createElement(row.a,null,react_default.a.createElement(collapse.a,{className:"full-width",defaultActiveKey:"experiment-details"},react_default.a.createElement(collapse.a.Panel,{header:react_default.a.createElement("b",null,"Experiment details"),key:"experiment-details"},react_default.a.createElement(row.a,null,react_default.a.createElement(col.a,{span:(null==experimentData?void 0:experimentData.start_date)?12:24},react_default.a.createElement(ExperimentPreview,{experiment:experimentData,trendCount:trendCount,trendExposure:null==experimentData?void 0:experimentData.parameters.recommended_running_time,funnelSampleSize:null==experimentData?void 0:experimentData.parameters.recommended_sample_size,funnelConversionRate:conversionRate,funnelEntrants:(null==experimentData?void 0:experimentData.start_date)?funnelResultsPersonsTotal:entrants})),!experimentResults&&experimentData.start_date&&react_default.a.createElement(col.a,{span:12},react_default.a.createElement(ExperimentImplementationDetails,{experiment:experimentData})),(experimentResults||experimentData.secondary_metrics.length>0)&&react_default.a.createElement(col.a,{className:"secondary-progress",span:(null==experimentData?void 0:experimentData.start_date)?12:24},featureFlags[constants.o.EXPERIMENTS_SECONDARY_METRICS]&&!!(null==experimentData?void 0:experimentData.secondary_metrics.length)&&react_default.a.createElement(col.a,{className:"border-bottom"},react_default.a.createElement(row.a,{align:"middle",justify:"space-between",className:"mb-05"},react_default.a.createElement("div",{className:"card-secondary"},"Secondary metrics"),null==experimentData||null===(_experimentData$param3=experimentData.parameters)||void 0===_experimentData$param3||null===(_experimentData$param4=_experimentData$param3.feature_flag_variants)||void 0===_experimentData$param4?void 0:_experimentData$param4.map((function(variant,idx){return react_default.a.createElement("li",{key:idx,style:{color:"".concat(experimentInsightType===src_types.r.FUNNELS?Object(funnelUtils.k)(getIndexForVariant(variant.key,src_types.r.FUNNELS)+1):Object(colors.c)("white")[getIndexForVariant(variant.key,src_types.r.TRENDS)])},className:"pr"},react_default.a.createElement("span",{className:"text-default"},Object(lib_utils.j)(variant.key)))}))),featureFlags[constants.o.EXPERIMENTS_SECONDARY_METRICS]&&(experimentData.start_date?react_default.a.createElement(react_default.a.Fragment,null,experimentData.secondary_metrics.map((function(metric,idx){var _experimentData$param5,_experimentData$param6;return react_default.a.createElement(row.a,{className:"border-top",key:idx,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},react_default.a.createElement("div",null,Object(lib_utils.j)(metric.name)),null==experimentData||null===(_experimentData$param5=experimentData.parameters)||void 0===_experimentData$param5||null===(_experimentData$param6=_experimentData$param5.feature_flag_variants)||void 0===_experimentData$param6?void 0:_experimentData$param6.map((function(variant,index){return react_default.a.createElement("div",{key:index},null==secondaryMetricResults?void 0:secondaryMetricResults[idx][variant.key])})))}))):react_default.a.createElement(react_default.a.Fragment,null,experimentData.secondary_metrics.map((function(metric,idx){var _experimentData$param7,_experimentData$param8;return react_default.a.createElement(row.a,{className:"border-top",key:idx,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},react_default.a.createElement("div",null,Object(lib_utils.j)(metric.name)),null==experimentData||null===(_experimentData$param7=experimentData.parameters)||void 0===_experimentData$param7||null===(_experimentData$param8=_experimentData$param7.feature_flag_variants)||void 0===_experimentData$param8?void 0:_experimentData$param8.map((function(_,index){return react_default.a.createElement("div",{key:index},"--")})))}))))),experimentResults&&react_default.a.createElement(col.a,{className:"mt"},react_default.a.createElement("div",{className:"mb-05"},react_default.a.createElement("b",null,"Experiment progress")),react_default.a.createElement(progress.a,{strokeWidth:20,showInfo:!1,percent:experimentProgressPercent,strokeColor:"var(--success)"}),experimentInsightType===src_types.r.TRENDS&&experimentData.start_date&&react_default.a.createElement(row.a,{justify:"space-between",className:"mt-05"},react_default.a.createElement("div",null,react_default.a.createElement("b",null,Object(dayjs.a)().diff(experimentData.start_date,"day"))," ","days running"),react_default.a.createElement("div",null,"Goal:"," ",react_default.a.createElement("b",null,null==experimentData||null===(_experimentData$param9=experimentData.parameters)||void 0===_experimentData$param9?void 0:_experimentData$param9.recommended_running_time)," ","days")),experimentInsightType===src_types.r.FUNNELS&&react_default.a.createElement(row.a,{justify:"space-between",className:"mt-05"},react_default.a.createElement("div",null,react_default.a.createElement("b",null,funnelResultsPersonsTotal)," participants seen"),react_default.a.createElement("div",null,"Goal:"," ",react_default.a.createElement("b",null,null==experimentData||null===(_experimentData$param10=experimentData.parameters)||void 0===_experimentData$param10?void 0:_experimentData$param10.recommended_sample_size)," ","participants"))))))),!(null==experimentData?void 0:experimentData.start_date)&&react_default.a.createElement("div",{className:"mt full-width"},react_default.a.createElement(ExperimentImplementationDetails,{experiment:experimentData}))),react_default.a.createElement("div",{className:"experiment-result"},experimentResults?react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(row.a,{justify:"space-around",style:{flexFlow:"nowrap"}},Object.keys(experimentResults.probability).sort((function(a,b){return experimentResults.probability[b]-experimentResults.probability[a]})).map((function(variant,idx){return react_default.a.createElement(col.a,{key:idx,className:"pr"},react_default.a.createElement("div",null,react_default.a.createElement("b",null,Object(lib_utils.j)(variant))),experimentInsightType===src_types.r.TRENDS?react_default.a.createElement(row.a,null,react_default.a.createElement("b",{style:{paddingRight:4}},react_default.a.createElement(row.a,null,"action"in experimentResults.insight[0]&&react_default.a.createElement(EntityFilterInfo.a,{filter:experimentResults.insight[0].action}),react_default.a.createElement("span",{style:{paddingLeft:4}},"count:")))," ",countDataForVariant(variant)," ",areTrendResultsConfusing&&0===idx&&react_default.a.createElement(tooltip.a,{placement:"right",title:"It might seem confusing that the best variant has lower absolute count, but this can happen when fewer people are exposed to this variant, so its relative count is higher."},react_default.a.createElement(InfoCircleOutlined.a,{style:{padding:"4px 2px"}}))):react_default.a.createElement(row.a,null,react_default.a.createElement("b",{style:{paddingRight:4}},"Conversion rate:")," ",conversionRateForVariant(variant),"%"),react_default.a.createElement(progress.a,{percent:Number((100*experimentResults.probability[variant]).toFixed(1)),size:"small",showInfo:!1,strokeColor:experimentInsightType===src_types.r.FUNNELS?Object(funnelUtils.k)(getIndexForVariant(variant,src_types.r.FUNNELS)+1):Object(colors.c)("white")[getIndexForVariant(variant,src_types.r.TRENDS)]}),react_default.a.createElement("div",null,"Probability that this variant is the best:"," ",react_default.a.createElement("b",null,(100*experimentResults.probability[variant]).toFixed(1),"%")))})))):experimentResultsLoading&&react_default.a.createElement("div",{className:"text-center"},react_default.a.createElement(Spinner.a,null)),experimentResults?react_default.a.createElement(index_esm.BindLogic,{logic:insightLogic.b,props:{dashboardItemId:experimentResults.itemID,filters:Experiment_objectSpread(Experiment_objectSpread(Experiment_objectSpread({},experimentResults.filters),{},{insight:experimentInsightType,display:experimentData.filters.display},experimentInsightType===src_types.r.FUNNELS&&{layout:constants.q.vertical,funnel_viz_type:src_types.n.Steps}),experimentInsightType===src_types.r.TRENDS&&{display:src_types.d.ActionsLineGraphCumulative}),cachedResults:experimentResults.insight,syncWithUrl:!1,doNotLoad:!0}},react_default.a.createElement("div",{className:"mt"},react_default.a.createElement(InsightContainer.a,{disableHeader:experimentInsightType===src_types.r.TRENDS,disableTable:experimentInsightType===src_types.r.FUNNELS}))):experimentData.start_date&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("div",{className:"no-experiment-results"},experimentResultsLoading?react_default.a.createElement(Spinner.a,null):react_default.a.createElement("div",{className:"text-center"},react_default.a.createElement("b",null,"There are no results for this experiment yet."),react_default.a.createElement("div",{className:"text-default"},"Double check your feature flag implementation if you're still not seeing results.")))))):react_default.a.createElement(Spinner.a,null))}function CodeLanguageSelect(){return react_default.a.createElement(es_select.a,{defaultValue:"JavaScript",suffixIcon:react_default.a.createElement(CaretDownOutlined.a,null)},react_default.a.createElement(es_select.a.Option,{value:"JavaScript"},react_default.a.createElement(row.a,{align:"middle"},react_default.a.createElement(icons.IconJavascript,{style:{marginRight:6}})," JavaScript")))}}}]);