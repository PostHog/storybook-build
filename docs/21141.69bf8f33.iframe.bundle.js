"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[21141],{"../../products/error_tracking/frontend/ErrorTrackingScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ErrorTrackingScene:()=>ErrorTrackingScene,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.26.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),utils=__webpack_require__("../../frontend/src/lib/components/Errors/utils.ts"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.258.2_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),InsightViz=__webpack_require__("../../frontend/src/queries/nodes/InsightViz/InsightViz.tsx"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),AssigneeDisplay=__webpack_require__("../../products/error_tracking/frontend/components/Assignee/AssigneeDisplay.tsx"),AssigneeSelect=__webpack_require__("../../products/error_tracking/frontend/components/Assignee/AssigneeSelect.tsx"),ErrorFilters=__webpack_require__("../../products/error_tracking/frontend/components/ErrorFilters/index.tsx"),errorIngestionLogic=__webpack_require__("../../products/error_tracking/frontend/components/ErrorTrackingSetupPrompt/errorIngestionLogic.tsx"),ErrorTrackingSetupPrompt=__webpack_require__("../../products/error_tracking/frontend/components/ErrorTrackingSetupPrompt/ErrorTrackingSetupPrompt.tsx"),issueActionsLogic=__webpack_require__("../../products/error_tracking/frontend/components/IssueActions/issueActionsLogic.tsx"),DropdownMenu=__webpack_require__("../../frontend/src/lib/ui/DropdownMenu/DropdownMenu.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),frontend_utils=__webpack_require__("../../products/error_tracking/frontend/utils.ts"),Indicator=__webpack_require__("../../products/error_tracking/frontend/components/Indicator.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let IssueStatusSelect=_ref=>{let{status,options=frontend_utils.y$,onChange}=_ref,[showPopover,setShowPopover]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(DropdownMenu.h_,{open:showPopover,onOpenChange:setShowPopover,children:[(0,jsx_runtime.jsxs)(DropdownMenu.$F,{className:"flex items-center hover:bg-fill-button-tertiary-hover p-[0.1rem] rounded cursor-pointer",role:"button",children:[(0,jsx_runtime.jsx)(Indicator.Eg,{status:status,className:"ml-1 text-xs text-secondary"}),(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronDown,{})]}),(0,jsx_runtime.jsx)(IssueStatusDropdown,{status:status,options:options,onChange:status=>{setShowPopover(!1),onChange(status)}})]})};function IssueStatusDropdown(_ref2){let{status,options,onChange}=_ref2;return(0,jsx_runtime.jsx)(DropdownMenu.AW,{children:options.map(option=>(0,jsx_runtime.jsx)(DropdownMenu.Xi,{className:"text-base text-secondary hover:bg-fill-button-tertiary-hover hover:text-fill-button-tertiary px-1",asChild:!0,children:(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,onClick:()=>option!==status&&onChange(option),role:"menuitem",size:"xsmall",active:option===status,children:(0,jsx_runtime.jsx)(Indicator.Eg,{status:option})})},option))})}var RuntimeIcon=__webpack_require__("../../products/error_tracking/frontend/components/RuntimeIcon.tsx"),dataNodeLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeLogic.ts");let errorTrackingDataNodeLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","error-tracking","errorTrackingDataNodeLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(_ref=>{let{key,query}=_ref,nodeLogic=(0,dataNodeLogic.M)({key,query,refresh:"blocking"});return{values:[nodeLogic,["response","responseLoading"]],actions:[nodeLogic,["setResponse","loadData","cancelQuery"],issueActionsLogic.x,["mergeIssues","resolveIssues","suppressIssues","activateIssues","assignIssues","updateIssueAssignee","updateIssueStatus","mutationSuccess","mutationFailure"]]}}),(0,index_esm.actions)({reloadData:()=>({})}),(0,index_esm.selectors)({results:[s=>[s.response],response=>response&&"results"in response?response.results:[]]}),(0,index_esm.listeners)(_ref2=>{let{values,actions}=_ref2;return{reloadData:async()=>{actions.loadData("force_blocking")},mergeIssues:_ref3=>{let{ids}=_ref3,{results}=values,issues=results.filter(_ref4=>{let{id}=_ref4;return ids.includes(id)}),primaryIssue=issues.shift();if(primaryIssue&&issues.length>0){let mergingIds=issues.map(g=>g.id),mergedIssue=(0,frontend_utils.Z0)(primaryIssue,issues);actions.setResponse({...values.response,results:results.filter(_ref5=>{let{id}=_ref5;return!mergingIds.includes(id)}).map(issue=>mergedIssue.id===issue.id?mergedIssue:issue)})}},resolveIssues:_ref6=>{let{ids}=_ref6,{results}=values;actions.setResponse({...values.response,results:results.map(issue=>ids.includes(issue.id)?{...issue,status:"resolved"}:issue)})},suppressIssues:_ref7=>{let{ids}=_ref7,{results}=values;actions.setResponse({...values.response,results:results.map(issue=>ids.includes(issue.id)?{...issue,status:"suppressed"}:issue)})},activateIssues:_ref8=>{let{ids}=_ref8,{results}=values;actions.setResponse({...values.response,results:results.map(issue=>ids.includes(issue.id)?{...issue,status:"active"}:issue)})},assignIssues:_ref9=>{let{ids,assignee}=_ref9,{results}=values;actions.setResponse({...values.response,results:results.map(issue=>ids.includes(issue.id)?{...issue,assignee}:issue)})},updateIssueAssignee:_ref10=>{let{id,assignee}=_ref10,response=values.response;if(response){let results="results"in response?response.results:[],recordIndex=results.findIndex(r=>r.id===id);if(recordIndex>-1){let issue={...results[recordIndex],assignee};results.splice(recordIndex,1,issue),actions.setResponse({...response,results:results})}}},updateIssueStatus:_ref11=>{let{id,status}=_ref11,response=values.response;if(response){let results="results"in response?response.results:[],recordIndex=results.findIndex(r=>r.id===id);if(recordIndex>-1){let issue={...results[recordIndex],status};results.splice(recordIndex,1,issue),actions.setResponse({...response,results:results})}}},mutationSuccess:()=>actions.reloadData(),mutationFailure:()=>actions.reloadData()}})]);var errorTrackingIssueSceneLogic=__webpack_require__("../../products/error_tracking/frontend/errorTrackingIssueSceneLogic.ts"),types=__webpack_require__("../../frontend/src/types.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.5_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),errorFiltersLogic=__webpack_require__("../../products/error_tracking/frontend/components/ErrorFilters/errorFiltersLogic.ts"),fast_deep_equal=__webpack_require__("../../node_modules/.pnpm/fast-deep-equal@3.1.3/node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js");let DEFAULT_ORDER_BY="last_seen",DEFAULT_ORDER_DIRECTION="DESC",DEFAULT_STATUS="active",issueQueryOptionsLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","error-tracking","issueQueryOptionsLogic"]),(0,index_esm.actions)({setOrderBy:orderBy=>({orderBy}),setOrderDirection:orderDirection=>({orderDirection}),setAssignee:assignee=>({assignee}),setStatus:status=>({status})}),(0,index_esm.reducers)({orderBy:[DEFAULT_ORDER_BY,{persist:!0},{setOrderBy:(_,_ref)=>{let{orderBy}=_ref;return orderBy}}],orderDirection:[DEFAULT_ORDER_DIRECTION,{persist:!0},{setOrderDirection:(_,_ref2)=>{let{orderDirection}=_ref2;return orderDirection}}],assignee:[null,{persist:!0},{setAssignee:(_,_ref3)=>{let{assignee}=_ref3;return assignee}}],status:[DEFAULT_STATUS,{persist:!0},{setStatus:(_,_ref4)=>{let{status}=_ref4;return status}}]}),(0,kea_router_lib.actionToUrl)(_ref5=>{let{values}=_ref5,buildURL=()=>(0,frontend_utils.qI)(kea_router_lib.router,params=>((0,frontend_utils.aM)(params,"assignee",values.assignee,null),(0,frontend_utils.aM)(params,"status",values.status,DEFAULT_STATUS),(0,frontend_utils.aM)(params,"orderBy",values.orderBy,DEFAULT_ORDER_BY),(0,frontend_utils.aM)(params,"orderDirection",values.orderDirection,DEFAULT_ORDER_DIRECTION),params));return{setOrderBy:()=>buildURL(),setStatus:()=>buildURL(),setAssignee:()=>buildURL(),setOrderDirection:()=>buildURL()}}),(0,kea_router_lib.urlToAction)(_ref6=>{let{actions,values}=_ref6;return{"*":(_,params)=>{params.orderBy&&!fast_deep_equal_default()(params.orderBy,values.orderBy)&&actions.setOrderBy(params.orderBy),params.status&&!fast_deep_equal_default()(params.status,values.status)&&actions.setStatus(params.status),params.assignee&&!fast_deep_equal_default()(params.assignee,values.assignee)&&actions.setAssignee(params.assignee),params.orderDirection&&!fast_deep_equal_default()(params.orderDirection,values.orderDirection)&&actions.setOrderDirection(params.orderDirection)}}})]);var queries=__webpack_require__("../../products/error_tracking/frontend/queries.ts");let errorTrackingSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","error-tracking","errorTrackingSceneLogic"]),(0,index_esm.connect)(()=>({values:[errorFiltersLogic.U,["dateRange","filterTestAccounts","filterGroup","searchQuery"],issueQueryOptionsLogic,["assignee","orderBy","orderDirection","status"]],actions:[issueActionsLogic.x,["mutationSuccess","mutationFailure"]]})),(0,index_esm.actions)({setSelectedIssueIds:ids=>({ids}),setShiftKeyHeld:shiftKeyHeld=>({shiftKeyHeld}),setPreviouslyCheckedRecordIndex:index=>({index})}),(0,index_esm.reducers)({selectedIssueIds:[[],{setSelectedIssueIds:(_,_ref)=>{let{ids}=_ref;return ids}}],shiftKeyHeld:[!1,{setShiftKeyHeld:(_,_ref2)=>{let{shiftKeyHeld}=_ref2;return shiftKeyHeld}}],previouslyCheckedRecordIndex:[null,{setPreviouslyCheckedRecordIndex:(_,_ref3)=>{let{index}=_ref3;return index}}]}),(0,index_esm.selectors)({query:[s=>[s.orderBy,s.status,s.dateRange,s.assignee,s.filterTestAccounts,s.filterGroup,s.searchQuery,s.orderDirection],(orderBy,status,dateRange,assignee,filterTestAccounts,filterGroup,searchQuery,orderDirection)=>(0,queries.mx)({orderBy,status,dateRange,assignee,filterTestAccounts,filterGroup,volumeResolution:frontend_utils.$N,searchQuery,columns:["error","volume","occurrences","sessions","users"],orderDirection})]}),(0,lib.Vt)(_ref4=>{let{actions}=_ref4;return{query:()=>actions.setSelectedIssueIds([])}}),(0,index_esm.listeners)(_ref5=>{let{actions}=_ref5;return{mutationSuccess:()=>actions.setSelectedIssueIds([]),mutationFailure:()=>actions.setSelectedIssueIds([])}}),(0,index_esm.afterMount)(_ref6=>{let{actions,cache}=_ref6,onKeyChange=event=>{actions.setShiftKeyHeld(event.shiftKey)};window.addEventListener("keydown",onKeyChange),window.addEventListener("keyup",onKeyChange),cache.onKeyChange=onKeyChange}),(0,index_esm.beforeUnmount)(_ref7=>{let{cache}=_ref7;window.removeEventListener("keydown",cache.onKeyChange),window.removeEventListener("keyup",cache.onKeyChange)})]);var GenericSelect=__webpack_require__("../../products/error_tracking/frontend/components/GenericSelect.tsx");function BulkActions(_ref){let{issues,selectedIds}=_ref,{mergeIssues,assignIssues,resolveIssues,suppressIssues,activateIssues}=(0,index_esm.useActions)(issueActionsLogic.x),{filterGroup}=(0,index_esm.useValues)(errorFiltersLogic.U),{setFilterGroup}=(0,index_esm.useActions)(errorFiltersLogic.U),{setSelectedIssueIds}=(0,index_esm.useActions)(errorTrackingSceneLogic),hasAtLeastTwoIssues=selectedIds.length>=2,currentStatus=issues.filter(issue=>selectedIds.includes(issue.id)).map(issue=>issue.status).reduce((acc,status)=>null===acc?status:"mixed"===acc||acc!==status?"mixed":acc,null);return(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-2 justify-between",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-2",children:[(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasAtLeastTwoIssues?null:"Select at least two issues to merge",type:"secondary",size:"small",onClick:()=>src.dn.open({title:"Merge Issues",content:`Are you sure you want to merge these ${selectedIds.length} issues?`,primaryButton:{children:"Merge",status:"danger",onClick:()=>{mergeIssues(selectedIds)}}}),children:"Merge"}),(0,jsx_runtime.jsx)(GenericSelect.e,{size:"small",current:"mixed"==currentStatus?null:currentStatus,values:["active","resolved","suppressed"],placeholder:"Mark as",renderValue:value=>(0,jsx_runtime.jsx)(Indicator.Eg,{status:value,size:"small",className:"w-full",withTooltip:!0}),onChange:value=>{if(value!=currentStatus)switch(value){case"resolved":resolveIssues(selectedIds);break;case"suppressed":suppressIssues(selectedIds);break;case"active":activateIssues(selectedIds)}}}),(0,jsx_runtime.jsx)(AssigneeSelect.i,{assignee:null,onChange:assignee=>assignIssues(selectedIds,assignee),children:displayAssignee=>(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",children:(0,jsx_runtime.jsx)(AssigneeDisplay.VQ,{assignee:displayAssignee,placeholder:"Assign"})})})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>{let quotedIds=selectedIds.map(id=>`'${id}'`).join(", "),newFilter={key:`issue_id NOT IN (${quotedIds})`,type:types.FT.HogQL,value:null},firstGroup=filterGroup.values[0],updatedFirstGroup={...firstGroup,values:[...firstGroup.values,newFilter]};setFilterGroup({type:types.J2.And,values:[updatedFirstGroup]}),setSelectedIssueIds([])},children:"Hide from search"})]})}let IssueQueryOptions=()=>{let{assignee,orderBy,status,orderDirection}=(0,index_esm.useValues)(issueQueryOptionsLogic),{setAssignee,setOrderBy,setStatus,setOrderDirection}=(0,index_esm.useActions)(issueQueryOptionsLogic);return(0,jsx_runtime.jsxs)("span",{className:"flex items-center justify-between gap-2 self-end",children:[(0,jsx_runtime.jsx)(Reload,{}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 self-end",children:[(0,jsx_runtime.jsx)(GenericSelect.e,{values:["all","active","resolved","suppressed"],current:status||null,renderValue:key=>{switch(key){case"all":case null:return(0,jsx_runtime.jsx)(Indicator.VO,{intent:"muted",label:"All",size:"small"});default:return(0,jsx_runtime.jsx)(Indicator.Eg,{status:key,size:"small"})}},placeholder:"Select status",onChange:value=>setStatus(value||void 0),size:"small"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("span",{children:"Sort by:"}),(0,jsx_runtime.jsx)(src.Yv,{onChange:setOrderBy,value:orderBy,options:[{value:"last_seen",label:"Last seen"},{value:"first_seen",label:"First seen"},{value:"occurrences",label:"Occurrences"},{value:"users",label:"Users"},{value:"sessions",label:"Sessions"}],size:"small"}),(0,jsx_runtime.jsx)(src.Yv,{onChange:setOrderDirection,value:orderDirection,options:[{value:"DESC",label:"Descending"},{value:"ASC",label:"Ascending"}],size:"small"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("span",{children:"Assigned to:"}),(0,jsx_runtime.jsx)(AssigneeSelect.i,{assignee:null!=assignee?assignee:null,onChange:assignee=>setAssignee(assignee),children:displayAssignee=>(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",children:(0,jsx_runtime.jsx)(AssigneeDisplay.VQ,{assignee:displayAssignee,placeholder:"Any user"})})})]})]})]})},Reload=()=>{let{responseLoading}=(0,index_esm.useValues)(errorTrackingDataNodeLogic),{reloadData,cancelQuery}=(0,index_esm.useActions)(errorTrackingDataNodeLogic);return(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>{responseLoading?cancelQuery():reloadData()},icon:responseLoading?(0,jsx_runtime.jsx)(src.$j,{textColored:!0}):(0,jsx_runtime.jsx)(posthog_icons_es.IconRefresh,{}),children:responseLoading?"Cancel":"Reload"})},ErrorTrackingListOptions=()=>{let{selectedIssueIds}=(0,index_esm.useValues)(errorTrackingSceneLogic),{results}=(0,index_esm.useValues)(errorTrackingDataNodeLogic);return(0,jsx_runtime.jsx)("div",{className:"sticky top-[var(--breadcrumbs-height-compact)] z-20 py-2 bg-primary",children:selectedIssueIds.length>0?(0,jsx_runtime.jsx)(BulkActions,{issues:results,selectedIds:selectedIssueIds}):(0,jsx_runtime.jsx)(IssueQueryOptions,{})})};var use_sparkline_data=__webpack_require__("../../products/error_tracking/frontend/hooks/use-sparkline-data.tsx"),Sparkline=__webpack_require__("../../frontend/src/lib/components/Sparkline.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts");__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts");var use_sparkline_options=__webpack_require__("../../products/error_tracking/frontend/hooks/use-sparkline-options.tsx");function OccurrenceSparkline(_ref){let{data,className,displayXAxis=!1}=_ref,colorVars=(0,use_sparkline_options.z)(),options=(0,use_sparkline_options.Q)({backgroundColor:colorVars[0],hoverBackgroundColor:colorVars[1]}),[occurrences,labels,labelRenderer]=(0,react.useMemo)(()=>[wrapDataWithColor(data,options),data.map(value=>(0,dayjs.Bv)(value.date).toISOString()),label=>(0,dayjs.Bv)(label).format("D MMM YYYY HH:mm (UTC)")],[data,options]),withXScale=(0,react.useCallback)(scale=>({...scale,type:"timeseries",ticks:{display:!0,maxRotation:0,maxTicksLimit:5,font:{size:10,lineHeight:1}},time:{unit:"day",displayFormats:{day:"D MMM"}}}),[]);return(0,jsx_runtime.jsx)(Sparkline.b,{className:className,data:occurrences,labels:labels,renderLabel:labelRenderer,withXScale:displayXAxis?withXScale:void 0})}function wrapDataWithColor(data,options){return[{values:data.map(d=>d.value),name:"Occurrences",color:options.backgroundColor,hoverColor:options.hoverBackgroundColor}]}var MaxTool=__webpack_require__("../../frontend/src/scenes/max/MaxTool.tsx"),taxonomicFilterLogic=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/taxonomicFilterLogic.tsx"),FilterGroup=__webpack_require__("../../products/error_tracking/frontend/components/ErrorFilters/FilterGroup.tsx");function updateFilterGroup(removedFilterIndexes,newFilters,filterGroup){let firstGroup;if(!(newFilters&&newFilters.length>0)&&!(removedFilterIndexes&&removedFilterIndexes.length>0))return null;let firstValue=filterGroup.values[0],updatedValues=[...(firstGroup=firstValue&&"values"in firstValue?firstValue:{type:types.J2.And,values:firstValue?[firstValue]:[]}).values];if(removedFilterIndexes&&removedFilterIndexes.length>0)for(let index of[...removedFilterIndexes].sort((a,b)=>b-a))index>=0&&index<updatedValues.length&&updatedValues.splice(index,1);return newFilters&&newFilters.length>0&&updatedValues.push(...newFilters),{...filterGroup,values:[{...firstGroup,values:updatedValues},...filterGroup.values.slice(1)]}}function ErrorTrackingSceneTool(){let{query}=(0,index_esm.useValues)(errorTrackingSceneLogic),{setDateRange,setFilterGroup,setFilterTestAccounts}=(0,index_esm.useActions)(errorFiltersLogic.U),{setOrderBy,setOrderDirection,setStatus}=(0,index_esm.useActions)(issueQueryOptionsLogic),{filterGroup}=(0,index_esm.useValues)(errorFiltersLogic.U),{setSearchQuery}=(0,index_esm.useActions)((0,taxonomicFilterLogic.aS)({taxonomicFilterLogicKey:FilterGroup.Vd,taxonomicGroupTypes:FilterGroup.o5})),callback=update=>{update.orderBy&&setOrderBy(update.orderBy),update.orderDirection&&setOrderDirection(update.orderDirection),update.status&&setStatus(update.status),update.searchQuery&&setSearchQuery(update.searchQuery),update.dateRange&&setDateRange(update.dateRange),void 0!==update.filterTestAccounts&&setFilterTestAccounts(update.filterTestAccounts);let updatedFilterGroup=updateFilterGroup(update.removedFilterIndexes,update.newFilters,filterGroup);updatedFilterGroup&&setFilterGroup(updatedFilterGroup)};return(0,jsx_runtime.jsx)(MaxTool.Z,{name:"search_error_tracking_issues",displayName:"Filter issues",description:"Max can search for issues by message, file name, event properties, or stack trace.",context:{current_query:query},callback:toolOutput=>{callback(toolOutput)},suggestions:[],introOverride:{headline:"What kind of issues are you looking for?",description:"Search by message, file name, event properties, or stack trace."},className:"hidden",children:(0,jsx_runtime.jsx)("div",{className:"relative"})})}var featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx");let scene={component:ErrorTrackingScene,logic:errorTrackingSceneLogic};function ErrorTrackingScene(){let{hasSentExceptionEvent,hasSentExceptionEventLoading}=(0,index_esm.useValues)(errorIngestionLogic.T),{query}=(0,index_esm.useValues)(errorTrackingSceneLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),insightProps={dashboardItemId:"new-ErrorTrackingQuery"};return(0,jsx_runtime.jsxs)(ErrorTrackingSetupPrompt.n,{children:[featureFlags[constants.y8.ERROR_TRACKING_SCENE_TOOL]&&(0,jsx_runtime.jsx)(ErrorTrackingSceneTool,{}),(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:errorTrackingDataNodeLogic,props:{key:(0,InsightViz.gG)(insightProps)},children:[(0,jsx_runtime.jsx)(Header,{}),hasSentExceptionEventLoading||hasSentExceptionEvent?null:(0,jsx_runtime.jsx)(IngestionStatusCheck,{}),(0,jsx_runtime.jsxs)(ErrorFilters.h.Root,{children:[(0,jsx_runtime.jsx)(ErrorFilters.h.DateRange,{}),(0,jsx_runtime.jsx)(ErrorFilters.h.FilterGroup,{}),(0,jsx_runtime.jsx)(ErrorFilters.h.InternalAccounts,{})]}),(0,jsx_runtime.jsx)(src.p2,{className:"mt-2"}),(0,jsx_runtime.jsx)(ErrorTrackingListOptions,{}),(0,jsx_runtime.jsx)(Query.A,{query:query,context:{columns:{error:{width:"50%",render:CustomGroupTitleColumn,renderTitle:CustomGroupTitleHeader},occurrences:{align:"center",render:CountColumn},sessions:{align:"center",render:CountColumn},users:{align:"center",render:CountColumn},volume:{align:"right",renderTitle:VolumeColumnHeader,render:VolumeColumn}},showOpenEditorButton:!1,insightProps:insightProps,emptyStateHeading:"No issues found",emptyStateDetail:"Try changing the date range, changing the filters or removing the assignee."}})]})]})}let VolumeColumn=props=>{let{dateRange}=(0,index_esm.useValues)(errorTrackingSceneLogic),record=props.record;if(!record.aggregations)throw Error("No aggregations found");let data=(0,use_sparkline_data.P)(record.aggregations.volumeRange,dateRange,frontend_utils.$N);return(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(OccurrenceSparkline,{className:"h-8",data:data,displayXAxis:!1})})},VolumeColumnHeader=_ref=>{let{columnName}=_ref;return(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-center min-w-64",children:(0,jsx_runtime.jsx)("div",{children:columnName})})},CustomGroupTitleHeader=_ref2=>{let{columnName}=_ref2,{selectedIssueIds}=(0,index_esm.useValues)(errorTrackingSceneLogic),{setSelectedIssueIds}=(0,index_esm.useActions)(errorTrackingSceneLogic),{results}=(0,index_esm.useValues)(errorTrackingDataNodeLogic),allSelected=results.length==selectedIssueIds.length&&selectedIssueIds.length>0;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.Hw,{checked:allSelected,onChange:()=>allSelected?setSelectedIssueIds([]):setSelectedIssueIds(results.map(r=>r.id))}),columnName]})},CustomGroupSeparator=()=>(0,jsx_runtime.jsx)(posthog_icons_es.IconMinus,{className:"text-quaternary",transform:"rotate(90)"}),CustomGroupTitleColumn=props=>{let{selectedIssueIds,shiftKeyHeld,previouslyCheckedRecordIndex}=(0,index_esm.useValues)(errorTrackingSceneLogic),{setSelectedIssueIds,setPreviouslyCheckedRecordIndex}=(0,index_esm.useActions)(errorTrackingSceneLogic),{updateIssueAssignee,updateIssueStatus}=(0,index_esm.useActions)(issueActionsLogic.x),{results}=(0,index_esm.useValues)(errorTrackingDataNodeLogic),record=props.record,checked=selectedIssueIds.includes(record.id),runtime=(0,utils.sm)(record.library),recordIndex=props.recordIndex;return(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-x-2 group my-1",children:[(0,jsx_runtime.jsx)(src.Hw,{className:"h-[1.2rem]",checked:checked,onChange:newValue=>{let includedIds=[];if(shiftKeyHeld&&null!==previouslyCheckedRecordIndex){let start=Math.min(previouslyCheckedRecordIndex,recordIndex),end=Math.max(previouslyCheckedRecordIndex,recordIndex)+1;includedIds.push(...results.slice(start,end).map(r=>r.id))}else includedIds.push(record.id);setPreviouslyCheckedRecordIndex(recordIndex),setSelectedIssueIds(newValue?[...new Set([...selectedIssueIds,...includedIds])]:selectedIssueIds.filter(id=>!includedIds.includes(id)))}}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-[2px]",children:[(0,jsx_runtime.jsx)(src.rU,{className:"flex-1 pr-12",to:urls.j.errorTrackingIssue(record.id,{timestamp:record.last_seen}),onClick:()=>{let issueLogic=(0,errorTrackingIssueSceneLogic.r)({id:record.id,timestamp:record.last_seen});issueLogic.mount(),issueLogic.actions.setIssue(record)},children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center h-[1.2rem] gap-2",children:[(0,jsx_runtime.jsx)(RuntimeIcon.Z,{className:"shrink-0",runtime:runtime,fontSize:"0.8rem"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold text-[1.2em] line-clamp-1",children:record.name||"Unknown Type"})]})}),(0,jsx_runtime.jsx)("div",{className:"line-clamp-1 text-secondary",children:record.description}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center text-secondary",children:[(0,jsx_runtime.jsx)(IssueStatusSelect,{status:record.status,onChange:status=>updateIssueStatus(record.id,status)}),(0,jsx_runtime.jsx)(CustomGroupSeparator,{}),(0,jsx_runtime.jsx)(AssigneeSelect.i,{assignee:record.assignee,onChange:assignee=>updateIssueAssignee(record.id,assignee),children:anyAssignee=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center hover:bg-fill-button-tertiary-hover p-[0.1rem] rounded cursor-pointer",role:"button",children:[(0,jsx_runtime.jsx)(AssigneeDisplay._x,{assignee:anyAssignee,size:"xsmall"}),(0,jsx_runtime.jsx)(AssigneeDisplay.VQ,{assignee:anyAssignee,className:"ml-1 text-xs text-secondary",size:"xsmall"}),(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronDown,{})]})}),(0,jsx_runtime.jsx)(CustomGroupSeparator,{}),(0,jsx_runtime.jsx)(TZLabel.w,{time:record.first_seen,className:"border-dotted border-b text-xs ml-1",delayMs:750}),(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronRight,{className:"text-quaternary mx-1"}),record.last_seen?(0,jsx_runtime.jsx)(TZLabel.w,{time:record.last_seen,className:"border-dotted border-b text-xs",delayMs:750}):(0,jsx_runtime.jsx)(src.yW,{})]})]})]})},CountColumn=_ref3=>{let{record,columnName}=_ref3,aggregations=record.aggregations,count=aggregations?aggregations[columnName]:0;return(0,jsx_runtime.jsx)("span",{className:"text-lg font-medium",children:"sessions"===columnName&&0===count?(0,jsx_runtime.jsx)(src.u,{title:"No $session_id was set for any event in this issue",delayMs:0,children:"-"}):(0,lib_utils.d$)(count)})},Header=()=>{let{isDev}=(0,index_esm.useValues)(preflightLogic.preflightLogic);return(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isDev?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{dist_module.LJ.captureException(Error("Kaboom !"))},children:"Send an exception"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{setInterval(()=>{throw Error("Kaboom !")},100)},children:"Start exception loop"})]}):null,(0,jsx_runtime.jsx)(src.Jp,{to:"https://posthog.com/docs/error-tracking",type:"secondary",targetBlank:!0,children:"Documentation"}),(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.errorTrackingConfiguration(),type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),children:"Configure"})]})})},IngestionStatusCheck=()=>(0,jsx_runtime.jsxs)(src.Vp,{type:"warning",className:"my-4",children:[(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("strong",{children:"No Exception events have been detected!"})}),(0,jsx_runtime.jsxs)("p",{children:["To use the Error tracking product, please"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/error-tracking/installation",children:"enable exception capture within the PostHog SDK"})," ","(otherwise it'll be a little empty!)"]})]})},"../../products/error_tracking/frontend/components/RuntimeIcon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>RuntimeIcon});var lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let RuntimeIconMap={python:lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_0__.Bm,web:lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_0__.RQ,node:lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_0__.fS,unknown:react__WEBPACK_IMPORTED_MODULE_1__.Fragment};function RuntimeIcon(_ref){let{runtime,...props}=_ref,Icon=RuntimeIconMap[runtime];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon,{...props})}}}]);