"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[3882],{"./frontend/src/lib/components/SocialLoginButton/SocialLoginIcon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>SocialLoginIcon});var lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const SocialLoginIcon=provider=>"google-oauth2"===provider?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_0__._8Z,{}):"github"===provider?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_0__.ETn,{}):"gitlab"===provider?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_0__.Ts0,{}):"saml"===provider?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_0__.Ol,{}):void 0;try{SocialLoginIcon.displayName="SocialLoginIcon",SocialLoginIcon.__docgenInfo={description:"",displayName:"SocialLoginIcon",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/SocialLoginButton/SocialLoginIcon.tsx#SocialLoginIcon"]={docgenInfo:SocialLoginIcon.__docgenInfo,name:"SocialLoginIcon",path:"frontend/src/lib/components/SocialLoginButton/SocialLoginIcon.tsx#SocialLoginIcon"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/lib/hooks/useAnchor.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{W:()=>useAnchor});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js");function useAnchor(hash){(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{if(hash&&document.getElementById(hash.substr(1))){const element=document.getElementById(hash.substr(1));if(!element)return;element.classList.add("highlighted"),window.requestAnimationFrame((()=>{element.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}))}}),[hash])}},"./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>ResourcePermissionMapping,f:()=>permissionsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/types.ts"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),lib_constants__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/constants.tsx"),_Roles_rolesLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/organization/Settings/Permissions/Roles/rolesLogic.tsx"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts");const ResourceDisplayMapping={[_types__WEBPACK_IMPORTED_MODULE_3__._z.FEATURE_FLAGS]:"Feature Flags"},ResourcePermissionMapping={[_types__WEBPACK_IMPORTED_MODULE_3__.uv.WRITE]:"View & Edit",[_types__WEBPACK_IMPORTED_MODULE_3__.uv.READ]:"View Only"},ResourceAccessLevelMapping={[_types__WEBPACK_IMPORTED_MODULE_3__._z.FEATURE_FLAGS]:"feature_flags_access_level"},permissionsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","organization","Settings","Permissions","permissionsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__.h,["featureFlags"],_Roles_rolesLogic__WEBPACK_IMPORTED_MODULE_6__.V,["roles"]],actions:[_Roles_rolesLogic__WEBPACK_IMPORTED_MODULE_6__.V,["updateRole"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({updatePermission:(checked,role,resourceId,resourceType)=>({checked,role,resourceId,resourceType})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)((_ref=>{let{values}=_ref;return{organizationResourcePermissions:[[],{loadOrganizationResourcePermissions:async()=>{const response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.resourcePermissions.list();return response?.results||[]},updateOrganizationResourcePermission:async _ref2=>{let{id,resource,access_level}=_ref2;if(id){const response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.resourcePermissions.update(id,{access_level});return values.organizationResourcePermissions.map((permission=>permission.id==response.id?response:permission))}{const response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.resourcePermissions.create({resource,access_level});return[...values.organizationResourcePermissions,response]}}}]}})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((_ref3=>{let{actions}=_ref3;return{updatePermission:async _ref4=>{let{checked,role,resourceId,resourceType}=_ref4;const accessLevel=checked?_types__WEBPACK_IMPORTED_MODULE_3__.uv.WRITE:_types__WEBPACK_IMPORTED_MODULE_3__.uv.READ;if(role.id){const updatedRole=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.roles.update(role.id,{[ResourceAccessLevelMapping[resourceType]]:accessLevel});updatedRole&&(actions.updateRole(updatedRole),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_7__.lemonToast.success(`${role.name} role ${resourceType} edit access updated`))}else actions.updateOrganizationResourcePermission({id:resourceId,resource:resourceType,access_level:accessLevel});lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_8__.vx.actions.reportResourceAccessLevelUpdated(resourceType,role.name,accessLevel)},updateOrganizationResourcePermissionSuccess:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_7__.lemonToast.success("Organizational edit access updated")}}})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({organizationResourcePermissionsMap:[s=>[s.organizationResourcePermissions],organizationResourcePermissions=>organizationResourcePermissions.reduce(((obj,resourcePermission)=>({...obj,[resourcePermission.resource]:resourcePermission})),{})],allPermissions:[s=>[s.organizationResourcePermissionsMap],organizationResourcePermissionsMap=>Object.keys(ResourceDisplayMapping).map((key=>({id:organizationResourcePermissionsMap[key]?.id||null,resource:key,name:ResourceDisplayMapping[key],access_level:organizationResourcePermissionsMap[key]?.access_level||_types__WEBPACK_IMPORTED_MODULE_3__.uv.WRITE})))],shouldShowPermissionsTable:[s=>[s.featureFlags],featureFlags=>"control"===featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_5__.y8.ROLE_BASED_ACCESS]],resourceRolesAccess:[s=>[s.allPermissions,s.roles],(permissions,roles)=>{const resources=permissions.map((resource=>({[resource.resource]:{organization_default:resource.access_level,id:resource.id}})));for(const role of roles)for(const source of resources){const resourceType=Object.keys(source)[0];source[resourceType][`${role.name}`]=role[ResourceAccessLevelMapping[resourceType]]}return resources}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref5=>{let{actions}=_ref5;actions.loadOrganizationResourcePermissions()}))])},"./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I:()=>SSOSelect});var antd__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/select/index.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib_components_SocialLoginButton_SocialLoginIcon__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/components/SocialLoginButton/SocialLoginIcon.tsx"),lib_constants__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/constants.tsx"),scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function SSOSelect(_ref){let{value,loading,onChange,samlAvailable}=_ref;const{preflight}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_3__.preflightLogic);return preflight?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(antd__WEBPACK_IMPORTED_MODULE_5__.Z,{style:{width:"100%"},value,loading,disabled:loading,onChange,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(antd__WEBPACK_IMPORTED_MODULE_5__.Z.Option,{value:"",children:"Don't enforce"}),Object.keys(preflight.available_social_auth_providers).map((key=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(antd__WEBPACK_IMPORTED_MODULE_5__.Z.Option,{value:key,disabled:!preflight.available_social_auth_providers[key],title:preflight.available_social_auth_providers[key]?void 0:"This provider is not configured.",children:[(0,lib_components_SocialLoginButton_SocialLoginIcon__WEBPACK_IMPORTED_MODULE_1__.T)(key)," ",lib_constants__WEBPACK_IMPORTED_MODULE_2__.mi[key]]},key))),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(antd__WEBPACK_IMPORTED_MODULE_5__.Z.Option,{value:"saml",disabled:!samlAvailable,title:samlAvailable?void 0:"This provider is not configured.",children:[(0,lib_components_SocialLoginButton_SocialLoginIcon__WEBPACK_IMPORTED_MODULE_1__.T)("saml")," ",lib_constants__WEBPACK_IMPORTED_MODULE_2__.mi.saml]},"saml")]}):null}try{SSOSelect.displayName="SSOSelect",SSOSelect.__docgenInfo={description:"",displayName:"SSOSelect",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"enum",value:[{value:'""'},{value:'"google-oauth2"'},{value:'"github"'},{value:'"gitlab"'},{value:'"saml"'}]}},loading:{defaultValue:null,description:"",name:"loading",required:!0,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:'(value: "" | SSOProvider) => void'}},samlAvailable:{defaultValue:null,description:"",name:"samlAvailable",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx#SSOSelect"]={docgenInfo:SSOSelect.__docgenInfo,name:"SSOSelect",path:"frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx#SSOSelect"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/organization/Settings/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{OrganizationSettings:()=>OrganizationSettings,OrganizationSettingsTabs:()=>OrganizationSettingsTabs,scene:()=>scene});var react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),CopyToClipboard=__webpack_require__("./frontend/src/lib/components/CopyToClipboard.tsx"),ProfilePicture=__webpack_require__("./frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),inviteLogic=__webpack_require__("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),InviteModal=__webpack_require__("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),preflightLogic=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonDialog=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDialog/index.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function makeActionsComponent(deleteInvite){return function ActionsComponent(_,invite){return(0,jsx_runtime.jsx)(LemonButton.Jp,{title:"Cancel the invite","data-attr":"invite-delete",icon:(0,jsx_runtime.jsx)(icons.bMz,{}),status:"danger",onClick:()=>{invite.is_expired?deleteInvite(invite):LemonDialog.d.open({title:`Do you want to cancel the invite for ${invite.target_email}?`,primaryButton:{children:"Yes, cancel invite",status:"danger",onClick:()=>deleteInvite(invite)},secondaryButton:{children:"No, keep invite"}})}})}}function Invites(){const{invites,invitesLoading}=(0,index_esm.useValues)(inviteLogic.n),{deleteInvite,showInviteModal}=(0,index_esm.useActions)(inviteLogic.n),{preflight}=(0,index_esm.useValues)(preflightLogic.preflightLogic),columns=[{key:"user_profile_picture",render:function ProfilePictureRender(_,invite){return(0,jsx_runtime.jsx)(ProfilePicture.Y,{name:invite.first_name,email:invite.target_email})},width:32},{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function TargetEmail(_,invite){return invite.target_email?(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[invite.target_email,invite.first_name?` (${invite.first_name})`:""]}):(0,jsx_runtime.jsx)("i",{children:"no one"})},width:"20%"},(0,columnUtils.J)(),(0,columnUtils.r)(),{title:"Invite Link",dataIndex:"id",key:"link",render:(_,invite)=>function InviteLinkComponent(id,invite){const url=new URL(`/signup/${id}`,document.baseURI).href;return invite.is_expired?(0,jsx_runtime.jsx)("b",{children:"Expired – please recreate"}):(0,jsx_runtime.jsx)(CopyToClipboard.D,{"data-attr":"invite-link",description:"invite link",children:url})}(invite.id,invite)},{title:"",key:"actions",width:24,render:makeActionsComponent(deleteInvite)}];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"},children:["Pending Invites",(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"primary",onClick:showInviteModal,"data-attr":"invite-teammate-button",children:"Invite team member"})]}),!preflight?.email_service_available&&(0,jsx_runtime.jsx)(InviteModal.K,{}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:invites,columns,rowKey:"id",loading:invitesLoading,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."})]})}var membersLogic=__webpack_require__("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),organizationLogic=__webpack_require__("./frontend/src/scenes/organizationLogic.tsx"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),permissioning=__webpack_require__("./frontend/src/lib/utils/permissioning.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonTag=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx"),LemonDivider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDivider/index.ts"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),row=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/row/index.js"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),Setup2FA=__webpack_require__("./frontend/src/scenes/authentication/Setup2FA.tsx");function ActionsComponent(_,member){var _currentOrganization$;const{user}=(0,index_esm.useValues)(userLogic.userLogic),{currentOrganization}=(0,index_esm.useValues)(organizationLogic.p),{removeMember,changeMemberAccessLevel}=(0,index_esm.useActions)(membersLogic.m);if(!user)return null;const currentMembershipLevel=null!==(_currentOrganization$=currentOrganization?.membership_level)&&void 0!==_currentOrganization$?_currentOrganization$:-1,allowDeletion=(currentMembershipLevel>=constants.Dk.Admin&&member.level<=currentMembershipLevel||member.user.uuid===user.uuid)&&member.level!==constants.Dk.Owner,myMembershipLevel=currentOrganization?currentOrganization.membership_level:null,allowedLevels=permissioning.mr.filter((listLevel=>!(0,permissioning.F9)(myMembershipLevel,user,member,listLevel))),disallowedReason=(0,permissioning.F9)(myMembershipLevel,user,member,allowedLevels);return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[disallowedReason?(0,jsx_runtime.jsx)("div",{children:disallowedReason}):allowedLevels.map((listLevel=>(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",fullWidth:!0,onClick:event=>{if(event.preventDefault(),!user)throw Error;listLevel===constants.Dk.Owner?LemonDialog.d.open({title:`Transfer organization ownership to ${member.user.first_name}?`,description:`You will no longer be the owner of ${user.organization?.name}. After the transfer you will become an administrator.`,primaryButton:{status:"danger",children:"Transfer Ownership",onClick:()=>changeMemberAccessLevel(member,listLevel)},secondaryButton:{children:"Cancel"}}):changeMemberAccessLevel(member,listLevel)},"data-test-level":listLevel,children:listLevel===constants.Dk.Owner?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Transfer organization ownership"}):listLevel>member.level?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Upgrade to ",permissioning.WS.get(listLevel)]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Downgrade to ",permissioning.WS.get(listLevel)]})},`${member.user.uuid}-level-${listLevel}`))),allowDeletion?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"danger","data-attr":"delete-org-membership",onClick:()=>{if(!user)throw Error;LemonDialog.d.open({title:`${member.user.uuid==user.uuid?"Leave":`Remove ${member.user.first_name} from`} organization ${user.organization?.name}?`,primaryButton:{children:member.user.uuid==user.uuid?"Leave":"Remove",status:"danger",onClick:()=>removeMember(member)},secondaryButton:{children:"Cancel"}})},fullWidth:!0,children:member.user.uuid!==user.uuid?"Remove from organization":"Leave organization"})]}):null]})})}function Members(_ref){let{user}=_ref;const{filteredMembers,membersLoading,search}=(0,index_esm.useValues)(membersLogic.m),{currentOrganization}=(0,index_esm.useValues)(organizationLogic.p),{setSearch}=(0,index_esm.useActions)(membersLogic.m),{updateOrganization}=(0,index_esm.useActions)(organizationLogic.p),[is2FAModalVisible,set2FAModalVisible]=(0,react.useState)(!1),{preflight}=(0,index_esm.useValues)(preflightLogic.preflightLogic),columns=[{key:"user_profile_picture",render:function ProfilePictureRender(_,member){return(0,jsx_runtime.jsx)(ProfilePicture.Y,{name:member.user.first_name,email:member.user.email})},width:32},{title:"Name",key:"user_first_name",render:(_,member)=>member.user.uuid==user.uuid?`${member.user.first_name} (me)`:member.user.first_name,sorter:(a,b)=>a.user.first_name.localeCompare(b.user.first_name)},{title:"Email",key:"user_email",render:(_,member)=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[member.user.email,!member.user.is_email_verified&&!member.has_social_auth&&preflight?.email_service_available&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[" ",(0,jsx_runtime.jsx)(LemonTag.o,{type:"highlight","data-attr":"pending-email-verification",children:"pending email verification"})]})]}),sorter:(a,b)=>a.user.email.localeCompare(b.user.email)},{title:"Level",dataIndex:"level",key:"level",render:function LevelRender(_,member){var _membershipLevelToNam;return(0,jsx_runtime.jsx)(LemonTag.o,{"data-attr":"membership-level",children:member.level===constants.Dk.Owner?"Organization owner":`Project ${null!==(_membershipLevelToNam=permissioning.WS.get(member.level))&&void 0!==_membershipLevelToNam?_membershipLevelToNam:`unknown (${member.level})`}`})},sorter:(a,b)=>a.level-b.level},{title:"2FA",dataIndex:"is_2fa_enabled",key:"is_2fa_enabled",render:function LevelRender(_,member){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[member.user.uuid==user.uuid&&is2FAModalVisible&&(0,jsx_runtime.jsx)(src.LemonModal,{title:"Set up or manage 2FA",onClose:()=>set2FAModalVisible(!1),children:(0,jsx_runtime.jsx)(Setup2FA.g,{onSuccess:()=>{set2FAModalVisible(!1),userLogic.userLogic.actions.updateUser({}),membersLogic.m.actions.loadMembers()}})}),(0,jsx_runtime.jsx)(Tooltip.u,{title:member.user.uuid!=user.uuid||member.is_2fa_enabled?"":"Click to setup 2FA for your account",children:(0,jsx_runtime.jsx)(LemonTag.o,{onClick:member.user.uuid!=user.uuid||member.is_2fa_enabled?void 0:()=>set2FAModalVisible(!0),"data-attr":"2fa-enabled",type:member.is_2fa_enabled?"success":"warning",children:member.is_2fa_enabled?"2FA enabled":"2FA not enabled"})})]})},sorter:(a,b)=>a.is_2fa_enabled!=b.is_2fa_enabled?1:0},{title:"Joined",dataIndex:"joined_at",key:"joined_at",render:function RenderJoinedAt(joinedAt){return(0,jsx_runtime.jsx)("div",{className:"whitespace-nowrap",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:joinedAt})})},sorter:(a,b)=>a.joined_at.localeCompare(b.joined_at)},{key:"actions",width:0,render:ActionsComponent}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{className:"subtitle",children:"Members"}),(0,jsx_runtime.jsxs)(row.Z,{align:"middle",justify:"space-between",children:[(0,jsx_runtime.jsx)(src.LemonInput,{type:"search",placeholder:"Search for members",value:search,onChange:setSearch}),(0,jsx_runtime.jsx)(src.LemonSwitch,{label:"Enforce 2FA",bordered:!0,checked:!!currentOrganization?.enforce_2fa,onChange:enforce_2fa=>updateOrganization({enforce_2fa})})]}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:filteredMembers,columns,rowKey:"id",style:{marginTop:"1rem"},loading:membersLoading,"data-attr":"org-members-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}})]})}try{Members.displayName="Members",Members.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:Members.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(__react_docgen_typescript_loader_error){}function DeleteOrganizationModal(_ref){let{isOpen,setIsOpen}=_ref;const{currentOrganization,organizationBeingDeleted}=(0,index_esm.useValues)(organizationLogic.p),{deleteOrganization}=(0,index_esm.useActions)(organizationLogic.p),[isDeletionConfirmed,setIsDeletionConfirmed]=(0,react.useState)(!1),isDeletionInProgress=!!currentOrganization&&organizationBeingDeleted?.id===currentOrganization.id;return(0,jsx_runtime.jsxs)(src.LemonModal,{title:"Delete the entire organization?",onClose:isDeletionInProgress?void 0:()=>setIsOpen(!1),footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonButton,{disabled:isDeletionInProgress,type:"secondary",onClick:()=>setIsOpen(!1),children:"Cancel"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",disabled:!isDeletionConfirmed,loading:isDeletionInProgress,"data-attr":"delete-organization-ok",status:"danger",onClick:currentOrganization?()=>deleteOrganization(currentOrganization):void 0,children:`Delete ${currentOrganization?currentOrganization.name:"the current organization"}`})]}),isOpen,children:[(0,jsx_runtime.jsxs)("p",{children:["Organization deletion ",(0,jsx_runtime.jsx)("b",{children:"cannot be undone"}),". You will lose all data, ",(0,jsx_runtime.jsx)("b",{children:"including all events"}),", related to all projects within this organization."]}),(0,jsx_runtime.jsxs)("p",{children:["Please type"," ",(0,jsx_runtime.jsx)("strong",{children:currentOrganization?currentOrganization.name:"this organization's name"})," to confirm."]}),(0,jsx_runtime.jsx)(src.LemonInput,{type:"text",onChange:value=>{currentOrganization&&setIsDeletionConfirmed(value.toLowerCase()===currentOrganization.name.toLowerCase())}})]})}function DangerZone(_ref2){let{isRestricted}=_ref2;const{currentOrganization}=(0,index_esm.useValues)(organizationLogic.p),[isModalVisible,setIsModalVisible]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"text-danger",children:[(0,jsx_runtime.jsx)("h2",{className:"text-danger subtitle",children:"Danger Zone"}),(0,jsx_runtime.jsxs)("div",{className:"mt-4",children:[!isRestricted&&(0,jsx_runtime.jsxs)("p",{className:"text-danger",children:["This is ",(0,jsx_runtime.jsx)("b",{children:"irreversible"}),". Please be certain."]}),(0,jsx_runtime.jsxs)(src.LemonButton,{status:"danger",type:"secondary",onClick:()=>setIsModalVisible(!0),"data-attr":"delete-organization-button",icon:(0,jsx_runtime.jsx)(icons.Fzz,{}),disabled:isRestricted,children:["Delete ",currentOrganization?.name||"the current organization"]})]})]}),(0,jsx_runtime.jsx)(DeleteOrganizationModal,{isOpen:isModalVisible,setIsOpen:setIsModalVisible})]})}try{DeleteOrganizationModal.displayName="DeleteOrganizationModal",DeleteOrganizationModal.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},setIsOpen:{defaultValue:null,description:"",name:"setIsOpen",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:DeleteOrganizationModal.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(__react_docgen_typescript_loader_error){}try{DangerZone.displayName="DangerZone",DangerZone.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:DangerZone.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(__react_docgen_typescript_loader_error){}var RestrictedArea=__webpack_require__("./frontend/src/lib/components/RestrictedArea.tsx"),useAnchor=__webpack_require__("./frontend/src/lib/hooks/useAnchor.ts"),api=__webpack_require__("./frontend/src/lib/api.ts"),lemonToast=__webpack_require__("./frontend/src/lib/lemon-ui/lemonToast.tsx"),types=__webpack_require__("./frontend/src/types.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js");const verifiedDomainsLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","organization","verifiedDomainsLogic"]),(0,index_esm.connect)({values:[organizationLogic.p,["currentOrganization"]]}),(0,index_esm.actions)({replaceDomain:domain=>({domain}),setAddModalShown:shown=>({shown}),setConfigureSAMLModalId:id=>({id}),setVerifyModal:id=>({id})}),(0,index_esm.reducers)({verifiedDomains:[[],{replaceDomain:(state,_ref)=>{let{domain}=_ref;const domains=[...state.filter((_ref2=>{let{id}=_ref2;return id!==domain.id})),domain];return domains.sort(((a,b)=>a.domain.localeCompare(b.domain))),domains}}],addModalShown:[!1,{setAddModalShown:(_,_ref3)=>{let{shown}=_ref3;return shown},addVerifiedDomainSuccess:()=>!1}],configureSAMLModalId:[null,{setConfigureSAMLModalId:(_,_ref4)=>{let{id}=_ref4;return id}}],verifyModal:[null,{setVerifyModal:(_,_ref5)=>{let{id}=_ref5;return id}}]}),(0,kea_loaders_lib.loaders)((_ref6=>{let{values,actions}=_ref6;return{verifiedDomains:[[],{loadVerifiedDomains:async()=>(await api.ZP.get(`api/organizations/${values.currentOrganization?.id}/domains`)).results,addVerifiedDomain:async domain=>[await api.ZP.create(`api/organizations/${values.currentOrganization?.id}/domains`,{domain}),...values.verifiedDomains],deleteVerifiedDomain:async id=>(await api.ZP.delete(`api/organizations/${values.currentOrganization?.id}/domains/${id}`),[...values.verifiedDomains.filter((domain=>domain.id!==id))])}],updatingDomain:[!1,{updateDomain:async payload=>{const response=await api.ZP.update(`api/organizations/${values.currentOrganization?.id}/domains/${payload.id}`,{...payload,id:void 0});return lemonToast.UJ.success("Domain updated successfully! Changes will take immediately."),actions.replaceDomain(response),!1},verifyDomain:async()=>{const response=await api.ZP.create(`api/organizations/${values.currentOrganization?.id}/domains/${values.verifyModal}/verify`);return response.is_verified?lemonToast.UJ.success("Domain verified successfully."):lemonToast.UJ.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),actions.replaceDomain(response),actions.setVerifyModal(null),!1}}]}})),(0,index_esm.listeners)((_ref7=>{let{actions,values}=_ref7;return{setConfigureSAMLModalId:_ref8=>{let{id}=_ref8;const domain=values.verifiedDomains.find((_ref9=>{let{id:_idToFind}=_ref9;return _idToFind===id}));if(id&&domain){const{saml_acs_url,saml_entity_id,saml_x509_cert}=domain;actions.setSamlConfigValues({saml_acs_url,saml_entity_id,saml_x509_cert,id})}}}})),(0,index_esm.selectors)({domainBeingVerified:[s=>[s.verifiedDomains,s.verifyModal],(verifiedDomains,verifyingId)=>verifyingId&&verifiedDomains.find((_ref10=>{let{id}=_ref10;return id===verifyingId}))||null],isSSOEnforcementAvailable:[s=>[s.currentOrganization],currentOrganization=>{var _currentOrganization$;return null!==(_currentOrganization$=currentOrganization?.available_features.includes(types.P$.SSO_ENFORCEMENT))&&void 0!==_currentOrganization$&&_currentOrganization$}],isSAMLAvailable:[s=>[s.currentOrganization],currentOrganization=>{var _currentOrganization$2;return null!==(_currentOrganization$2=currentOrganization?.available_features.includes(types.P$.SAML))&&void 0!==_currentOrganization$2&&_currentOrganization$2}]}),(0,index_esm.afterMount)((_ref11=>{let{actions}=_ref11;return actions.loadVerifiedDomains()})),(0,lib.forms)((_ref12=>{let{actions,values}=_ref12;return{samlConfig:{defaults:{},errors:payload=>({saml_acs_url:payload.saml_acs_url&&!payload.saml_acs_url.match(constants.cN)?"Please enter a valid URL, including https://":void 0}),submit:async(payload,breakpoint)=>{const{id,...updateParams}=payload;if(!id)return;const response=await api.ZP.update(`api/organizations/${values.currentOrganization?.id}/domains/${payload.id}`,{...updateParams});breakpoint(),actions.replaceDomain(response),actions.setConfigureSAMLModalId(null),actions.setSamlConfigValues({}),lemonToast.UJ.success(`SAML configuration for ${response.domain} updated successfully.`)}}}}))]);var InfoCircleOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts");function AddDomainModal(){const{addModalShown,verifiedDomainsLoading}=(0,index_esm.useValues)(verifiedDomainsLogic),{setAddModalShown,addVerifiedDomain}=(0,index_esm.useActions)(verifiedDomainsLogic),[newDomain,setNewDomain]=(0,react.useState)(""),[submitted,setSubmitted]=(0,react.useState)(!1),errored=!newDomain||!newDomain.match(constants.Xx),clean=()=>{setNewDomain(""),setSubmitted(!1)},handleSubmit=()=>{setSubmitted(!0),errored||(addVerifiedDomain(newDomain),clean())};return(0,jsx_runtime.jsxs)(LemonModal.f,{onClose:()=>{setAddModalShown(!1),clean()},isOpen:addModalShown,title:"Add authentication domain",footer:(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"primary",disabled:""===newDomain||submitted&&errored||verifiedDomainsLoading,onClick:handleSubmit,children:"Add domain"}),children:[(0,jsx_runtime.jsx)(src.LemonInput,{placeholder:"posthog.com",autoFocus:!0,value:newDomain,onChange:setNewDomain,onPressEnter:handleSubmit}),submitted&&errored&&(0,jsx_runtime.jsx)("span",{className:"text-danger text-xs",children:"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"})]})}var SSOSelect=__webpack_require__("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx");function VerifyDomainModal(){const{domainBeingVerified,updatingDomainLoading}=(0,index_esm.useValues)(verifiedDomainsLogic),{setVerifyModal,verifyDomain}=(0,index_esm.useActions)(verifiedDomainsLogic),challengeName=`_posthog-challenge.${domainBeingVerified?.domain}.`;return(0,jsx_runtime.jsx)(LemonModal.f,{isOpen:!!domainBeingVerified,onClose:()=>setVerifyModal(null),title:"Verify your domain",description:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonTag.o,{className:"uppercase",children:domainBeingVerified?.domain||""}),(0,jsx_runtime.jsx)("p",{children:"To verify your domain, you need to add a record to your DNS zone."})]}),footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"secondary",onClick:()=>setVerifyModal(null),children:"Verify later"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"primary",disabled:updatingDomainLoading,onClick:verifyDomain,children:"Verify"})]}),children:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("ol",{children:[(0,jsx_runtime.jsx)("li",{children:"Sign in to your DNS provider."}),(0,jsx_runtime.jsxs)("li",{children:["Add the following ",(0,jsx_runtime.jsx)("b",{children:"TXT"})," record.",(0,jsx_runtime.jsxs)("div",{className:"my-4 space-y-2",children:[(0,jsx_runtime.jsx)(Field.e,{label:"Name",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:challengeName}),(0,jsx_runtime.jsx)(CopyToClipboard.D,{explicitValue:challengeName})]})}),(0,jsx_runtime.jsx)(Field.e,{label:"Value or content",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:domainBeingVerified?.verification_challenge}),(0,jsx_runtime.jsx)(CopyToClipboard.D,{explicitValue:domainBeingVerified?.verification_challenge})]})}),(0,jsx_runtime.jsx)(Field.e,{label:"TTL",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:"Default or 3600"}),(0,jsx_runtime.jsx)(CopyToClipboard.D,{explicitValue:"3600"})]})})]})]}),(0,jsx_runtime.jsx)("li",{children:"Press verify below."})]})})})}var Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),LemonSwitch=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSwitch/LemonSwitch.tsx"),LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonInput=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx"),LemonTextArea=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTextArea/LemonTextArea.tsx");function ConfigureSAMLModal(){var _preflight$site_url;const{configureSAMLModalId,isSamlConfigSubmitting,samlConfig}=(0,index_esm.useValues)(verifiedDomainsLogic),{setConfigureSAMLModalId}=(0,index_esm.useActions)(verifiedDomainsLogic),{preflight}=(0,index_esm.useValues)(preflightLogic.preflightLogic),siteUrl=null!==(_preflight$site_url=preflight?.site_url)&&void 0!==_preflight$site_url?_preflight$site_url:window.location.origin,samlReady=samlConfig.saml_acs_url&&samlConfig.saml_entity_id&&samlConfig.saml_x509_cert;return(0,jsx_runtime.jsx)(LemonModal.f,{onClose:()=>{setConfigureSAMLModalId(null)},isOpen:!!configureSAMLModalId,title:"",simple:!0,children:(0,jsx_runtime.jsxs)(lib.Form,{logic:verifiedDomainsLogic,formKey:"samlConfig",enableFormOnSubmit:!0,className:"LemonModal__layout ",children:[(0,jsx_runtime.jsx)(LemonModal.f.Header,{children:(0,jsx_runtime.jsx)("h3",{children:"Configure SAML authentication and provisioning"})}),(0,jsx_runtime.jsxs)(LemonModal.f.Content,{className:"space-y-2",children:[(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsxs)(src.Link,{to:"https://posthog.com/docs/data/sso#setting-up-saml",children:["Read the docs ",(0,jsx_runtime.jsx)(icons.pFn,{})]})}),(0,jsx_runtime.jsx)(Field.g,{label:"ACS Consumer URL",name:"_ACSConsumerUrl",children:(0,jsx_runtime.jsx)(CopyToClipboard.D,{children:`${siteUrl}/complete/saml/`})}),(0,jsx_runtime.jsx)(Field.g,{label:"RelayState",name:"_RelayState",children:(0,jsx_runtime.jsx)(CopyToClipboard.D,{children:null!=configureSAMLModalId?configureSAMLModalId:void 0})}),(0,jsx_runtime.jsx)(Field.g,{label:"Audience / Entity ID",name:"_Audience",children:(0,jsx_runtime.jsx)(CopyToClipboard.D,{children:siteUrl})}),(0,jsx_runtime.jsx)(Field.g,{name:"saml_acs_url",label:"SAML ACS URL",children:(0,jsx_runtime.jsx)(LemonInput.D,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})}),(0,jsx_runtime.jsx)(Field.g,{name:"saml_entity_id",label:"SAML Entity ID",children:(0,jsx_runtime.jsx)(LemonInput.D,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})}),(0,jsx_runtime.jsx)(Field.g,{name:"saml_x509_cert",label:"SAML X.509 Certificate",children:(0,jsx_runtime.jsx)(LemonTextArea._,{className:"ph-ignore-input",minRows:10,placeholder:"Enter the public certificate of your IdP. Keep all line breaks.\n-----BEGIN CERTIFICATE-----\nMIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL\n-----END CERTIFICATE-----"})}),!samlReady&&(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",children:"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft."})]}),(0,jsx_runtime.jsx)(LemonModal.f.Footer,{children:(0,jsx_runtime.jsx)(LemonButton.Jp,{loading:isSamlConfigSubmitting,type:"primary",htmlType:"submit",children:"Save settings"})})]})})}const iconStyle={marginRight:4,fontSize:"1.15em",paddingTop:2};function VerifiedDomains(){const{verifiedDomainsLoading,updatingDomainLoading}=(0,index_esm.useValues)(verifiedDomainsLogic),{setAddModalShown}=(0,index_esm.useActions)(verifiedDomainsLogic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsxs)("div",{style:{flexGrow:1},children:[(0,jsx_runtime.jsx)("div",{id:"domain-whitelist"})," ",(0,jsx_runtime.jsx)("h2",{id:"authentication-domains",className:"subtitle",children:"Authentication domains"}),(0,jsx_runtime.jsx)("p",{className:"text-muted-alt",children:"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains."})]}),(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"primary",onClick:()=>setAddModalShown(!0),disabled:verifiedDomainsLoading||updatingDomainLoading,children:"Add domain"})]}),(0,jsx_runtime.jsx)(VerifiedDomainsTable,{})]})}function VerifiedDomainsTable(){const{verifiedDomains,verifiedDomainsLoading,currentOrganization,updatingDomainLoading,isSSOEnforcementAvailable,isSAMLAvailable}=(0,index_esm.useValues)(verifiedDomainsLogic),{updateDomain,deleteVerifiedDomain,setVerifyModal,setConfigureSAMLModalId}=(0,index_esm.useActions)(verifiedDomainsLogic),{preflight}=(0,index_esm.useValues)(preflightLogic.preflightLogic),columns=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function RenderDomainName(_,_ref){let{domain}=_ref;return(0,jsx_runtime.jsx)(LemonTag.o,{children:domain})}},...preflight?.cloud?[{key:"is_verified",title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Verification",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO).",children:(0,jsx_runtime.jsx)(InfoCircleOutlined.Z,{style:{marginLeft:4}})})]}),render:function Verified(_,_ref2){let{is_verified,verified_at}=_ref2;return is_verified?(0,jsx_runtime.jsxs)("div",{className:"flex items-center text-success",children:[(0,jsx_runtime.jsx)(icons.DLh,{style:iconStyle})," Verified"]}):verified_at?(0,jsx_runtime.jsxs)("div",{className:"flex items-center text-danger",children:[(0,jsx_runtime.jsx)(icons.qVT,{style:iconStyle})," Verification expired"]}):(0,jsx_runtime.jsxs)("div",{className:"flex items-center text-warning",children:[(0,jsx_runtime.jsx)(icons.FCX,{style:iconStyle})," Pending verification"]})}}]:[],{key:"jit_provisioning_enabled",title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Automatic provisioning"," ",(0,jsx_runtime.jsx)(Tooltip.u,{title:`Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ${currentOrganization?.name||"this organization"} if it does not exist.`,children:(0,jsx_runtime.jsx)(InfoCircleOutlined.Z,{})})]}),render:function AutomaticProvisioning(_,_ref3){let{jit_provisioning_enabled,id,is_verified}=_ref3;return is_verified?(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsx)(LemonSwitch.f,{checked:jit_provisioning_enabled,disabled:updatingDomainLoading||!is_verified,onChange:checked=>updateDomain({id,jit_provisioning_enabled:checked}),label:(0,jsx_runtime.jsx)("span",{className:"font-normal",children:jit_provisioning_enabled?"Enabled":"Disabled"})})}):(0,jsx_runtime.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable automatic provisioning"})}},{key:"sso_enforcement",title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Enforce SSO"," ",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider.",children:(0,jsx_runtime.jsx)(InfoCircleOutlined.Z,{})})]}),render:function SSOEnforcement(_,_ref4,index){let{sso_enforcement,is_verified,id,has_saml}=_ref4;return isSSOEnforcementAvailable?is_verified?(0,jsx_runtime.jsx)(SSOSelect.I,{value:sso_enforcement,loading:updatingDomainLoading,onChange:val=>updateDomain({id,sso_enforcement:val}),samlAvailable:has_saml}):(0,jsx_runtime.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):0===index?(0,jsx_runtime.jsxs)(Link.r,{to:(0,constants.NV)(preflight?.cloud).url,target:(0,constants.NV)(preflight?.cloud).target,className:"flex items-center",children:[(0,jsx_runtime.jsx)(icons._V1,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}},{key:"saml",title:"SAML",render:function SAML(_,_ref5,index){let{is_verified,saml_acs_url,saml_entity_id,saml_x509_cert,has_saml}=_ref5;return isSAMLAvailable?is_verified?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:has_saml?(0,jsx_runtime.jsxs)("div",{className:"flex items-center text-success",children:[(0,jsx_runtime.jsx)(icons.DLh,{style:iconStyle})," SAML enabled"]}):saml_acs_url||saml_entity_id||saml_x509_cert?(0,jsx_runtime.jsxs)("div",{className:"flex items-center text-warning",children:[(0,jsx_runtime.jsx)(icons.FCX,{style:iconStyle})," SAML partially configured"]}):(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)(icons.ign,{style:iconStyle})," SAML not set up"]})}):(0,jsx_runtime.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):0===index?(0,jsx_runtime.jsxs)(Link.r,{to:(0,constants.NV)(preflight?.cloud).url,target:(0,constants.NV)(preflight?.cloud).target,className:"flex items-center",children:[(0,jsx_runtime.jsx)(icons._V1,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}},{key:"actions",width:32,align:"center",render:function RenderActions(_,_ref6){let{is_verified,id,domain}=_ref6;return is_verified?(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",onClick:()=>setConfigureSAMLModalId(id),fullWidth:!0,disabled:!isSAMLAvailable,title:isSAMLAvailable?void 0:"Upgrade to enable SAML",children:"Configure SAML"}),(0,jsx_runtime.jsxs)(LemonButton.Jp,{status:"danger",onClick:()=>LemonDialog.d.open({title:`Remove ${domain}?`,description:"This cannot be undone. If you have SAML configured or SSO enforced,it will be immediately disabled.",primaryButton:{status:"danger",children:"Remove domain",onClick:()=>deleteVerifiedDomain(id)},secondaryButton:{children:"Cancel"}}),fullWidth:!0,children:[(0,jsx_runtime.jsx)(icons.Fzz,{})," Remove domain"]})]})}):(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"primary",onClick:()=>setVerifyModal(id),children:"Verify"})}}];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:verifiedDomains,columns,loading:verifiedDomainsLoading,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),(0,jsx_runtime.jsx)(AddDomainModal,{}),(0,jsx_runtime.jsx)(ConfigureSAMLModal,{}),(0,jsx_runtime.jsx)(VerifyDomainModal,{})]})}var PayGateMini=__webpack_require__("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),TitleWithIcon=__webpack_require__("./frontend/src/lib/components/TitleWithIcon.tsx"),permissionsLogic=__webpack_require__("./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx"),LemonSelectMultiple=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelectMultiple/LemonSelectMultiple.tsx"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),UserSelectItem=__webpack_require__("./frontend/src/lib/components/UserSelectItem.tsx"),rolesLogic=__webpack_require__("./frontend/src/scenes/organization/Settings/Permissions/Roles/rolesLogic.tsx");function CreateRoleModal(){const{roleInFocus,createRoleModalShown,roleMembersToAdd,roleMembersInFocusLoading,addableMembers,rolesLoading,roleMembersInFocus}=(0,index_esm.useValues)(rolesLogic.V),{setCreateRoleModalShown,setRoleMembersToAdd,createRole,deleteRoleMember,addRoleMembers,deleteRole}=(0,index_esm.useActions)(rolesLogic.V),{isAdminOrOwner}=(0,index_esm.useValues)(organizationLogic.p),[roleName,setRoleName]=(0,react.useState)(""),isNewRole=!roleInFocus;return(0,jsx_runtime.jsxs)(LemonModal.f,{onClose:()=>{setCreateRoleModalShown(!1),setRoleMembersToAdd([])},isOpen:createRoleModalShown,title:isNewRole?"Create role":isAdminOrOwner?`Edit ${roleInFocus.name} role`:`${roleInFocus.name} role`,footer:rolesLoading?(0,jsx_runtime.jsx)(Spinner.$,{textColored:!0}):isAdminOrOwner?(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between w-full",children:[(0,jsx_runtime.jsx)("div",{children:!isNewRole&&(0,jsx_runtime.jsx)(LemonButton.Jp,{htmlType:"submit",type:"primary",status:"danger",onClick:()=>deleteRole(roleInFocus),"data-attr":"role-delete-submit",children:"Delete role"})}),isNewRole&&(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"primary",onClick:()=>{createRole(roleName),setRoleName("")},children:"Save"})]}):void 0,children:[isNewRole&&(0,jsx_runtime.jsxs)("div",{className:"mb-5",children:[(0,jsx_runtime.jsx)("h5",{children:"Role Name"}),(0,jsx_runtime.jsx)(src.LemonInput,{placeholder:"Product",autoFocus:!0,value:roleName,onChange:setRoleName})]}),isAdminOrOwner&&(0,jsx_runtime.jsxs)("div",{className:"mb-5",children:[(0,jsx_runtime.jsx)("h5",{children:"Members"}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(LemonSelectMultiple.E,{placeholder:"Search for team members to add…",value:roleMembersToAdd,loading:roleMembersInFocusLoading,onChange:newValues=>setRoleMembersToAdd(newValues),filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:(0,UserSelectItem.W)(addableMembers,"uuid")})}),!isNewRole&&(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"primary",loading:roleMembersInFocusLoading,disabled:0===roleMembersToAdd.length,onClick:()=>addRoleMembers({role:roleInFocus,membersToAdd:roleMembersToAdd}),children:"Add"})]})]}),!isNewRole&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h5",{children:"Role Members"}),roleMembersInFocus.length>0?(0,jsx_runtime.jsx)("div",{className:"mt-2 pb-2 rounded overflow-y-auto",style:{maxHeight:300},children:roleMembersInFocus.map((member=>(0,jsx_runtime.jsx)(MemberRow,{member,deleteMember:roleMemberUuid=>deleteRoleMember({roleMemberUuid}),isAdminOrOwner:!!isAdminOrOwner},member.id)))}):(0,jsx_runtime.jsx)("div",{className:"text-muted mb-2",children:"No members added yet"})]})]})}function MemberRow(_ref){let{member,deleteMember,isAdminOrOwner}=_ref;const{user}=member;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mt-2 h-8",children:[(0,jsx_runtime.jsx)(ProfilePicture.Y,{email:user.email,name:user.first_name,size:"md",showName:!0}),isAdminOrOwner&&deleteMember&&(0,jsx_runtime.jsx)(LemonButton.Jp,{icon:(0,jsx_runtime.jsx)(icons.Fzz,{}),onClick:()=>deleteMember(member.id),tooltip:"Remove user from role",status:"primary-alt",type:"tertiary",size:"small"})]})}function PermissionsGrid(_ref){let{isRestricted}=_ref;const{resourceRolesAccess,organizationResourcePermissionsLoading}=(0,index_esm.useValues)(permissionsLogic.f),{updatePermission}=(0,index_esm.useActions)(permissionsLogic.f),{roles,rolesLoading}=(0,index_esm.useValues)(rolesLogic.V),{setRoleInFocus,openCreateRoleModal}=(0,index_esm.useActions)(rolesLogic.V),{isAdminOrOwner}=(0,index_esm.useValues)(organizationLogic.p),columns=[{key:"role",title:"",width:150,render:function RenderRole(_,role){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"organization_default"==role.name?(0,jsx_runtime.jsx)("b",{children:"All users by default"}):(0,jsx_runtime.jsx)(src.LemonButton,{type:"tertiary",noPadding:!0,onClick:()=>setRoleInFocus(role),children:role.name})})}},...resourceRolesAccess.flatMap((resource=>{const name=Object.keys(resource)[0];return[{key:"view",title:(0,jsx_runtime.jsx)(Tooltip.u,{title:"View defaults cannot be changed",children:(0,jsx_runtime.jsxs)("div",{className:"text-center",children:[name," ",(0,jsx_runtime.jsx)("br",{})," View"]})}),align:"center",render:function RenderView(){return(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsx)(src.LemonCheckbox,{defaultChecked:!0,disabled:!0,color:"gray"})})}},{key:"edit",title:(0,jsx_runtime.jsx)(TitleWithIcon.H,{icon:(0,jsx_runtime.jsx)(Tooltip.u,{title:`You can extend permissions on a per ${type=name,type===types._z.FEATURE_FLAGS?"flag":"resource"} basis.`,children:(0,jsx_runtime.jsx)(icons.aUG,{})}),children:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[name," ",(0,jsx_runtime.jsx)("br",{})," Edit"]})}),align:"center",render:function RenderEdit(_,role){return(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsx)(src.LemonCheckbox,{onChange:v=>{updatePermission(v,role,resource[name].id,name)},checked:resource[`${name}`][role.name]>=types.uv.WRITE,disabled:!isAdminOrOwner,color:isAdminOrOwner?"":"gray"})})}}];var type}))];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between items-center mb-4",children:[(0,jsx_runtime.jsx)("div",{className:"text-muted-alt",children:"Edit organizational default permission levels for posthog resources. Use roles to apply permissions to specific sets of users."}),!isRestricted&&(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:openCreateRoleModal,"data-attr":"create-role-button",children:"Create role"})]}),(0,jsx_runtime.jsx)(src.LemonTable,{columns,loading:rolesLoading||organizationResourcePermissionsLoading,dataSource:[{name:"organization_default"},...roles]}),(0,jsx_runtime.jsx)(CreateRoleModal,{})]})}try{PermissionsGrid.displayName="PermissionsGrid",PermissionsGrid.__docgenInfo={description:"",displayName:"PermissionsGrid",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Permissions/PermissionsGrid.tsx#PermissionsGrid"]={docgenInfo:PermissionsGrid.__docgenInfo,name:"PermissionsGrid",path:"frontend/src/scenes/organization/Settings/Permissions/PermissionsGrid.tsx#PermissionsGrid"})}catch(__react_docgen_typescript_loader_error){}var LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts");const scene={component:OrganizationSettings,logic:organizationLogic.p};let OrganizationSettingsTabs=function(OrganizationSettingsTabs){return OrganizationSettingsTabs.GENERAL="general",OrganizationSettingsTabs.ROLE_BASED_ACCESS="role_based_access",OrganizationSettingsTabs}({});function DisplayName(_ref){let{isRestricted}=_ref;const{currentOrganization,currentOrganizationLoading}=(0,index_esm.useValues)(organizationLogic.p),{updateOrganization}=(0,index_esm.useActions)(organizationLogic.p),[name,setName]=(0,react.useState)(currentOrganization?.name||"");return(0,jsx_runtime.jsxs)("div",{className:"max-w-160",children:[(0,jsx_runtime.jsx)("h2",{id:"name",className:"subtitle mt-0",children:"Display Name"}),(0,jsx_runtime.jsx)(src.LemonInput,{className:"mb-4",value:name,onChange:setName,disabled:isRestricted}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:e=>{e.preventDefault(),updateOrganization({name})},disabled:isRestricted||!name||!currentOrganization||name===currentOrganization.name,loading:currentOrganizationLoading,children:"Rename Organization"})]})}function EmailPreferences(_ref2){let{isRestricted}=_ref2;const{currentOrganization}=(0,index_esm.useValues)(organizationLogic.p),{updateOrganization}=(0,index_esm.useActions)(organizationLogic.p);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{id:"notification-preferences",className:"subtitle",children:"Notification Preferences"}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.LemonSwitch,{"data-attr":"is-member-join-email-enabled-switch",onChange:checked=>{updateOrganization({is_member_join_email_enabled:checked})},checked:!!currentOrganization?.is_member_join_email_enabled,disabled:isRestricted||!currentOrganization,label:"Email all current members when a new member joins",bordered:!0})})]})}const organizationSettingsTabsLogic=(0,index_esm.kea)({path:["scenes","organization","Settings","index"],actions:{setTab:tab=>({tab})},reducers:{tab:[OrganizationSettingsTabs.GENERAL,{setTab:(_,_ref3)=>{let{tab}=_ref3;return tab}}]},actionToUrl:()=>({setTab:_ref4=>{let{tab}=_ref4;return`${urls.j.organizationSettings()}?tab=${tab}`}}),urlToAction:_ref5=>{let{values,actions}=_ref5;return{[urls.j.organizationSettings()]:(_,searchParams)=>{searchParams.tab&&values.tab!==searchParams.tab&&actions.setTab(searchParams.tab)}}}});function OrganizationSettings(){const{user}=(0,index_esm.useValues)(userLogic.userLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h);(0,useAnchor.W)(location.hash);const{tab}=(0,index_esm.useValues)(organizationSettingsTabsLogic),{setTab}=(0,index_esm.useActions)(organizationSettingsTabsLogic),tabs=[{key:OrganizationSettingsTabs.GENERAL,label:"General",content:(0,jsx_runtime.jsxs)("div",{className:"border rounded p-6",children:[(0,jsx_runtime.jsx)(RestrictedArea.n,{Component:DisplayName,minimumAccessLevel:constants.Dk.Admin}),(0,jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),(0,jsx_runtime.jsx)(Invites,{}),(0,jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),user&&(0,jsx_runtime.jsx)(Members,{user}),(0,jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),(0,jsx_runtime.jsx)(RestrictedArea.n,{Component:VerifiedDomains,minimumAccessLevel:constants.Dk.Admin}),(0,jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),(0,jsx_runtime.jsx)(RestrictedArea.n,{Component:EmailPreferences,minimumAccessLevel:constants.Dk.Admin}),(0,jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),(0,jsx_runtime.jsx)(RestrictedArea.n,{Component:DangerZone,minimumAccessLevel:constants.Dk.Owner})]})}];return featureFlags[constants.y8.ROLE_BASED_ACCESS]&&tabs.push({key:OrganizationSettingsTabs.ROLE_BASED_ACCESS,label:"Role-based access",content:(0,jsx_runtime.jsx)(PayGateMini.E,{feature:types.P$.ROLE_BASED_ACCESS,children:(0,jsx_runtime.jsx)(RestrictedArea.n,{Component:PermissionsGrid,minimumAccessLevel:constants.Dk.Admin})})}),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tab,onChange:setTab,tabs})]})}}}]);