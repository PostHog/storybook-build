"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[93969],{"../../frontend/src/lib/components/CommandPalette/commandPaletteLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>GLOBAL_COMMAND_SCOPE,M:()=>commandPaletteLogic});var dist=__webpack_require__("../../node_modules/.pnpm/expr-eval@2.0.2/node_modules/expr-eval/dist/index.mjs"),fuse_esm=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.297.0/node_modules/posthog-js/dist/module.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),ProfilePicture=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),copyToClipboard=__webpack_require__("../../frontend/src/lib/utils/copyToClipboard.tsx"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),newDashboardLogic=__webpack_require__("../../frontend/src/scenes/dashboard/newDashboardLogic.ts"),insights_utils=__webpack_require__("../../frontend/src/scenes/insights/utils.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),types=__webpack_require__("../../frontend/src/types.ts");function isUUIDLike(candidate){return 36===candidate.length&&!!candidate.toLowerCase().match(/^[0-9a-f-]+$/)?.length}let WATCH_RECORDINGS_OF_KEY="watch-recordings-of",watchRecordingsOfCommand=push=>({key:WATCH_RECORDINGS_OF_KEY,scope:GLOBAL_COMMAND_SCOPE,resolver:argument=>{if(void 0===argument)return null;let replayFilter=(key,value)=>({date_from:"-3d",filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:key,value:[value],operator:types.WV.Exact,type:types.FT.Recording}]}]},duration:[{type:types.FT.Recording,key:"duration",value:1,operator:"gt"}]}),words=argument.split(" ");if(words.includes("web")||words.includes("mobile"))return{icon:posthog_icons_es.IconRewindPlay,display:`Watch ${argument} recordings`,executor:()=>{push(urls.j.replay(types.yd.Home,replayFilter("snapshot_source",argument)))}};let url=words.find(word=>(0,utils.PX)(word));if(url)return{icon:posthog_icons_es.IconRewindPlay,display:`Watch recordings of visits to ${url}`,executor:()=>{push(urls.j.replay(types.yd.Home,replayFilter("visited_page",url)))}};let uuid=words.find(word=>isUUIDLike(word));return uuid?{icon:posthog_icons_es.IconRewindPlay,display:`Watch recording of session: ${uuid}`,executor:()=>{push(urls.j.replaySingle(uuid))}}:null}});var teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),SidePanel=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/SidePanel.tsx"),sidePanelLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/sidePanelLogic.tsx"),sidePanelStateLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/sidePanelStateLogic.tsx"),DebugCHQueries=__webpack_require__("../../frontend/src/lib/components/AppShortcuts/utils/DebugCHQueries.tsx"),commandBarLogic=__webpack_require__("../../frontend/src/lib/components/CommandBar/commandBarLogic.ts"),CommandBar_types=__webpack_require__("../../frontend/src/lib/components/CommandBar/types.ts"),hedgehogBuddyLogic=__webpack_require__("../../frontend/src/lib/components/HedgehogBuddy/hedgehogBuddyLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let GLOBAL_COMMAND_SCOPE="global";function resolveCommand(source,argument,prefixApplied){let results=source.resolver instanceof Function?source.resolver(argument,prefixApplied):source.resolver;return results?(Array.isArray(results)||(results=[results]),results.map(result=>({...result,source}))):[]}let commandPaletteLogic=(0,index_esm.kea)([(0,index_esm.path)(["lib","components","CommandPalette","commandPaletteLogic"]),(0,index_esm.connect)(()=>({actions:[lib.router,["push"],userLogic.userLogic,["updateUser"],hedgehogBuddyLogic.r,["setHedgehogModeEnabled"],commandBarLogic.e,["setCommandBar"],sidePanelStateLogic.f,["openSidePanel","closeSidePanel"]],values:[teamLogic.teamLogic,["currentTeam"],userLogic.userLogic,["user"],featureFlagLogic.featureFlagLogic,["featureFlags"],hedgehogBuddyLogic.r,["hedgehogModeEnabled"],sidePanelLogic.x,["enabledTabs"],sidePanelStateLogic.f,["sidePanelOpen"]],logic:[preflightLogic.preflightLogic]})),(0,index_esm.actions)({hidePalette:!0,showPalette:!0,togglePalette:!0,setInput:input=>({input}),onArrowUp:!0,onArrowDown:maxIndex=>({maxIndex}),executeResult:result=>({result}),activateFlow:flow=>({flow}),backFlow:!0,registerCommand:command=>({command}),deregisterCommand:commandKey=>({commandKey}),setCustomCommand:commandKey=>({commandKey}),deregisterScope:scope=>({scope})}),(0,index_esm.reducers)({isPaletteShown:[!1,{hidePalette:()=>!1,showPalette:()=>!0,togglePalette:previousState=>!previousState}],activeResultIndex:[0,{setInput:()=>0,executeResult:()=>0,activateFlow:()=>0,backFlow:()=>0,onArrowUp:previousIndex=>previousIndex>0?previousIndex-1:0,onArrowDown:(previousIndex,_ref)=>{let{maxIndex}=_ref;return previousIndex<maxIndex?previousIndex+1:maxIndex}}],input:["",{setInput:(_,_ref2)=>{let{input}=_ref2;return input},activateFlow:()=>"",backFlow:()=>"",executeResult:()=>""}],activeFlow:[null,{activateFlow:(currentFlow,_ref3)=>{var _flow$scope;let{flow}=_ref3;return flow?{...flow,scope:null!==(_flow$scope=flow.scope)&&void 0!==_flow$scope?_flow$scope:currentFlow?.scope,previousFlow:currentFlow}:null},backFlow:currentFlow=>{var _currentFlow$previous;return null!==(_currentFlow$previous=currentFlow?.previousFlow)&&void 0!==_currentFlow$previous?_currentFlow$previous:null}}],commandRegistrations:[{},{registerCommand:(commands,_ref4)=>{let{command}=_ref4;return{...commands,[command.key]:command}},deregisterCommand:(commands,_ref5)=>{let{commandKey}=_ref5,{[commandKey]:_discard,...cleanedCommands}=commands;return cleanedCommands}}]}),(0,index_esm.selectors)({isSqueak:[selectors=>[selectors.input],input=>"squeak"===input.trim().toLowerCase()],regexpCommandPairs:[selectors=>[selectors.commandRegistrations],commandRegistrations=>{let array=[];for(let command of Object.values(commandRegistrations))command.prefixes?array.push([RegExp(`^\\s*(${command.prefixes.join("|")})(?:\\s+(.*)|$)`,"i"),command]):array.push([null,command]);return array}],commandSearchResults:[selectors=>[selectors.isPaletteShown,selectors.regexpCommandPairs,selectors.input,selectors.activeFlow,selectors.isSqueak],(isPaletteShown,regexpCommandPairs,argument,activeFlow,isSqueak)=>{if(!isPaletteShown||isSqueak)return[];if(activeFlow)return resolveCommand(activeFlow,argument);let directResults=[],prefixedResults=[];for(let[regexp,command]of regexpCommandPairs){if(regexp){let match=argument.match(regexp);match&&match[1]&&prefixedResults.push(...resolveCommand(command,match[2],match[1]))}directResults.push(...resolveCommand(command,argument))}let allResults=directResults.concat(prefixedResults),fusableResults=[],guaranteedResults=[];for(let result of allResults)result.guarantee?guaranteedResults.push(result):fusableResults.push(result);fusableResults=(0,utils.uw)(fusableResults,result=>result.display),guaranteedResults=(0,utils.uw)(guaranteedResults,result=>result.display);let fusedResults=argument?new fuse_esm.Z(fusableResults,{keys:["display","synonyms"]}).search(argument).slice(0,5).map(result=>result.item):fusableResults.slice(0,5);return guaranteedResults.concat(fusedResults)}],commandSearchResultsGrouped:[selectors=>[selectors.commandSearchResults,selectors.activeFlow],(commandSearchResults,activeFlow)=>{var _activeFlow$scope,_result$source$scope;let resultsGrouped={};for(let result of(activeFlow&&(resultsGrouped[null!==(_activeFlow$scope=activeFlow.scope)&&void 0!==_activeFlow$scope?_activeFlow$scope:"?"]=[]),commandSearchResults)){let scope=null!==(_result$source$scope=result.source.scope)&&void 0!==_result$source$scope?_result$source$scope:"?";scope in resultsGrouped||(resultsGrouped[scope]=[]),resultsGrouped[scope].push({...result})}let rollingGroupIndex=0,rollingResultIndex=0,resultsGroupedInOrder=[];for(let[group,results]of Object.entries(resultsGrouped)){for(let result of(resultsGroupedInOrder.push([group,[]]),results))resultsGroupedInOrder[rollingGroupIndex][1].push({...result,index:rollingResultIndex++});rollingGroupIndex++}return resultsGroupedInOrder}]}),(0,index_esm.listeners)(_ref6=>{let{actions,values}=_ref6;return{showPalette:()=>{dist_module.ZP.capture("palette shown",{isMobile:(0,utils.tq)()})},togglePalette:()=>{values.isPaletteShown&&dist_module.ZP.capture("palette shown",{isMobile:(0,utils.tq)()})},executeResult:_ref7=>{let{result}=_ref7;if(!0===result.executor)actions.activateFlow(null),actions.hidePalette();else{let possibleFlow=result.executor?.()||null;actions.activateFlow(possibleFlow),possibleFlow||actions.hidePalette()}let{icon,index,...cleanedResult}=result,{resolver,...cleanedCommand}=cleanedResult.source;cleanedResult.source=cleanedCommand,cleanedResult.isMobile=(0,utils.tq)(),dist_module.ZP.capture("palette command executed",cleanedResult)},deregisterScope:_ref8=>{let{scope}=_ref8;for(let command of Object.values(values.commandRegistrations))command.scope===scope&&actions.deregisterCommand(command.key)},setInput:async(_ref9,breakpoint)=>{let{input}=_ref9;if(await breakpoint(300),input.length>8){let person=(await api.ZP.persons.list({search:input})).results[0];person&&actions.registerCommand({key:`person-${person.distinct_ids[0]}`,resolver:[{icon:posthog_icons_es.IconPeopleFilled,display:`View person ${input}`,executor:()=>{let{push}=lib.router.actions;push(urls.j.personByDistinctId(person.distinct_ids[0]))}}],scope:GLOBAL_COMMAND_SCOPE})}}}}),(0,index_esm.events)(_ref10=>{let{actions,values}=_ref10;return{afterMount:()=>{let{push}=actions,goTo={key:"go-to",scope:GLOBAL_COMMAND_SCOPE,prefixes:["open","visit"],resolver:[{icon:posthog_icons_es.IconDashboard,display:"Go to Dashboards",executor:()=>{push(urls.j.dashboards())}},{icon:posthog_icons_es.IconHome,display:"Go to Project homepage",executor:()=>{push(urls.j.projectHomepage())}},{icon:posthog_icons_es.IconGraph,display:"Go to Insights",executor:()=>{push(urls.j.savedInsights())}},{icon:posthog_icons_es.IconTrends,display:"Create a new Trend insight",executor:()=>{push(insights_utils.il[types.dw.TRENDS])}},{icon:posthog_icons_es.IconFunnels,display:"Create a new Funnel insight",executor:()=>{push(insights_utils.il[types.dw.FUNNELS])}},{icon:posthog_icons_es.IconRetention,display:"Create a new Retention insight",executor:()=>{push(insights_utils.il[types.dw.RETENTION])}},{icon:posthog_icons_es.IconUserPaths,display:"Create a new Paths insight",executor:()=>{push(insights_utils.il[types.dw.PATHS])}},{icon:posthog_icons_es.IconStickiness,display:"Create a new Stickiness insight",executor:()=>{push(insights_utils.il[types.dw.STICKINESS])}},{icon:posthog_icons_es.IconLifecycle,display:"Create a new Lifecycle insight",executor:()=>{push(insights_utils.il[types.dw.LIFECYCLE])}},{icon:posthog_icons_es.IconHogQL,display:"Create a new SQL insight",synonyms:["hogql","sql"],executor:()=>{push(insights_utils.il[types.dw.SQL])}},{icon:posthog_icons_es.IconNotebook,display:"Go to Notebooks",executor:()=>{push(urls.j.notebooks())}},{icon:posthog_icons_es.IconLive,display:"Go to Activity",executor:()=>{push(urls.j.activity())}},{icon:posthog_icons_es.IconDatabase,display:"Go to Data management",synonyms:["events"],executor:()=>{push(urls.j.eventDefinitions())}},{icon:posthog_icons_es.IconCursor,display:"Go to Actions",executor:()=>{push(urls.j.actions())}},{icon:posthog_icons_es.IconList,display:"Go to Properties",executor:()=>{push(urls.j.propertyDefinitions())}},{icon:posthog_icons_es.IconThoughtBubble,display:"Go to Annotations",executor:()=>{push(urls.j.annotations())}},{icon:posthog_icons_es.IconPeople,display:"Go to Persons",synonyms:["people"],executor:()=>{push(urls.j.persons())}},{icon:posthog_icons_es.IconPeople,display:"Go to Cohorts",executor:()=>{push(urls.j.cohorts())}},{icon:posthog_icons_es.IconPieChart,display:"Go to Web analytics",executor:()=>{push(urls.j.webAnalytics())}},{icon:posthog_icons_es.IconServer,display:"Go to SQL editor",executor:()=>{push(urls.j.sqlEditor())}},{icon:posthog_icons_es.IconWarning,display:"Go to Error tracking",executor:()=>push(urls.j.errorTracking())},{display:"Go to Session replay",icon:posthog_icons_es.IconRewindPlay,executor:()=>{push(urls.j.replay())}},{display:"Go to Surveys",icon:posthog_icons_es.IconChat,executor:()=>{push(urls.j.surveys())}},{icon:posthog_icons_es.IconToggle,display:"Go to Feature flags",executor:()=>{push(urls.j.featureFlags())}},{icon:posthog_icons_es.IconTestTube,display:"Go to Experiments",executor:()=>{push(urls.j.experiments())}},{icon:posthog_icons_es.IconRocket,display:"Go to Early access features",executor:()=>{push(urls.j.earlyAccessFeatures())}},{icon:posthog_icons_es.IconDecisionTree,display:"Go to Data pipelines",synonyms:["integrations"],executor:()=>{push(urls.j.dataPipelines())}},{icon:posthog_icons_es.IconToolbar,display:"Go to Toolbar",executor:()=>{push(urls.j.toolbarLaunch())}},{icon:posthog_icons_es.IconGear,display:"Go to Project settings",executor:()=>{push(urls.j.settings("project"))}},{icon:posthog_icons_es.IconGear,display:"Go to Organization settings",executor:()=>{push(urls.j.settings("organization"))}},{icon:()=>(0,jsx_runtime.jsx)(ProfilePicture.Y,{user:values.user,size:"xs"}),display:"Go to User settings",synonyms:["account","profile"],executor:()=>{push(urls.j.settings("user"))}},{icon:posthog_icons_es.IconLeave,display:"Log out",executor:()=>{userLogic.userLogic.actions.logout()}},{icon:posthog_icons_es.IconUnlock,display:"Go to Personal API Keys",executor:()=>{push(urls.j.settings("user-api-keys"))}}]},debugClickhouseQueries={key:"debug-clickhouse-queries",scope:GLOBAL_COMMAND_SCOPE,resolver:userLogic.userLogic.values.user?.is_staff||userLogic.userLogic.values.user?.is_impersonated||preflightLogic.preflightLogic.values.preflight?.is_debug||preflightLogic.preflightLogic.values.preflight?.instance_preferences?.debug_queries?{icon:posthog_icons_es.IconDatabase,display:"Debug ClickHouse queries",executor:()=>(0,DebugCHQueries.x)()}:[]},debugCopySessionRecordingURL={key:"debug-copy-session-recording-url",scope:GLOBAL_COMMAND_SCOPE,resolver:{icon:posthog_icons_es.IconRewindPlay,display:"Debug: Copy the session recording link to clipboard",executor:()=>{let url=dist_module.ZP.get_session_replay_url({withTimestamp:!0,timestampLookBack:30});(0,copyToClipboard.v)(url,"Current session recording link to clipboard")}}},createDashboard={key:"create-dashboard",scope:GLOBAL_COMMAND_SCOPE,resolver:{icon:posthog_icons_es.IconDashboard,display:"Create Dashboard",executor:()=>({instruction:"Name your new dashboard",icon:posthog_icons_es.IconKeyboard,scope:"Creating Dashboard",resolver:argument=>argument?.length?{icon:posthog_icons_es.IconDashboard,display:`Create Dashboard "${argument}"`,executor:()=>{newDashboardLogic.Z.actions.addDashboard({name:argument})}}:null})}},shareFeedback={key:"share-feedback",scope:GLOBAL_COMMAND_SCOPE,resolver:{icon:posthog_icons_es.IconThoughtBubble,display:"Share Feedback",synonyms:["send opinion","ask question","message posthog","github issue"],executor:()=>({scope:"Sharing Feedback",resolver:[{display:"Send Message Directly to PostHog",icon:posthog_icons_es.IconThoughtBubble,executor:()=>({instruction:"What's on your mind?",icon:posthog_icons_es.IconThoughtBubble,resolver:argument=>({icon:posthog_icons_es.IconThoughtBubble,display:"Send",executor:argument?.length?()=>(dist_module.ZP.capture("palette feedback",{message:argument}),{resolver:{icon:posthog_icons_es.IconCheck,display:"Message Sent!",executor:!0}}):void 0})})},{icon:posthog_icons_es.IconGithub,display:"Create GitHub Issue",executor:()=>{open("https://github.com/PostHog/posthog/issues/new/choose")}}]})}},toggleTheme={key:"toggle-theme",scope:GLOBAL_COMMAND_SCOPE,resolver:{icon:posthog_icons_es.IconEye,display:"Change theme",synonyms:["toggle theme","dark mode","light mode"],executor:()=>({scope:"Change theme",resolver:[{icon:posthog_icons_es.IconDay,display:"Light mode",executor:()=>{actions.updateUser({theme_mode:"light"})}},{icon:posthog_icons_es.IconNight,display:"Dark mode",executor:()=>{actions.updateUser({theme_mode:"dark"})}},{icon:posthog_icons_es.IconLaptop,display:"Sync with system preferences",executor:()=>{actions.updateUser({theme_mode:"system"})}},{icon:posthog_icons_es.IconPalette,display:"Add custom CSS",executor:()=>push(urls.j.customCss())}]})}},toggleHedgehogMode={key:"toggle-hedgehog-mode",scope:GLOBAL_COMMAND_SCOPE,resolver:{icon:icons.yf,display:`${values.hedgehogModeEnabled?"Disable":"Enable"} hedgehog mode`,synonyms:["buddy","toggle","max"],executor:()=>{actions.setHedgehogModeEnabled(!values.hedgehogModeEnabled)}}},shortcuts={key:"shortcuts",scope:GLOBAL_COMMAND_SCOPE,resolver:{icon:posthog_icons_es.IconKeyboard,display:"Open keyboard shortcut overview",executor:()=>(actions.setCommandBar(CommandBar_types.j.SHOW_SHORTCUTS),{resolver:()=>({icon:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{}),display:"",executor:!0})})}},sidepanel={key:"sidepanel",scope:GLOBAL_COMMAND_SCOPE,resolver:[...values.enabledTabs.map(tab=>{let{Icon,label}=SidePanel.h[tab];return{icon:Icon,display:`Open ${label} side panel`,executor:()=>{actions.openSidePanel(tab)}}}),...values.sidePanelOpen?[{icon:posthog_icons_es.IconX,display:"Close side panel",executor:()=>{actions.closeSidePanel()}}]:[]]};actions.registerCommand(goTo),actions.registerCommand({key:"open-urls",scope:GLOBAL_COMMAND_SCOPE,prefixes:["open","visit"],resolver:argument=>{let words=argument?.split(" "),url=words?.find(word=>utils.PX(word));if(url)return{icon:posthog_icons_es.IconExternal,display:`Open ${url}`,synonyms:[`Visit ${url}`],executor:()=>{open(url)}};if(words&&words.length>0&&["open","visit"].includes(words[0].toLowerCase())){var _teamLogic$values$cur;let results=(null!==(_teamLogic$values$cur=teamLogic.teamLogic.values.currentTeam?.app_urls)&&void 0!==_teamLogic$values$cur?_teamLogic$values$cur:[]).map(url=>({icon:posthog_icons_es.IconExternal,display:`Open ${url}`,synonyms:[`Visit ${url}`],executor:()=>{open(url)}}));return results.push({icon:posthog_icons_es.IconExternal,display:"Open PostHog Docs",synonyms:["technical documentation"],executor:()=>{open("https://posthog.com/docs")}}),results}return null}}),actions.registerCommand(debugClickhouseQueries),actions.registerCommand({key:"calculator",scope:GLOBAL_COMMAND_SCOPE,resolver:argument=>{if(!argument||!isNaN(+argument))return null;try{let result=+dist._b.evaluate(argument);return isNaN(result)?null:{icon:posthog_icons_es.IconCalculator,display:`= ${result}`,guarantee:!0,executor:()=>{(0,copyToClipboard.v)(result.toString(),"calculation result")}}}catch{return null}}}),actions.registerCommand(createDashboard),actions.registerCommand(shareFeedback),actions.registerCommand(debugCopySessionRecordingURL),actions.registerCommand(toggleTheme),actions.registerCommand(toggleHedgehogMode),actions.registerCommand(shortcuts),actions.registerCommand(sidepanel),actions.registerCommand(watchRecordingsOfCommand(push))},beforeUnmount:()=>{actions.deregisterCommand("go-to"),actions.deregisterCommand("open-urls"),actions.deregisterCommand("debug-clickhouse-queries"),actions.deregisterCommand("calculator"),actions.deregisterCommand("create-personal-api-key"),actions.deregisterCommand("create-dashboard"),actions.deregisterCommand("share-feedback"),actions.deregisterCommand("debug-copy-session-recording-url"),actions.deregisterCommand("toggle-theme"),actions.deregisterCommand("toggle-hedgehog-mode"),actions.deregisterCommand("shortcuts"),actions.deregisterCommand("sidepanel"),actions.deregisterCommand(WATCH_RECORDINGS_OF_KEY)}}})])}}]);