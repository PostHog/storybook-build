(window.webpackJsonp=window.webpackJsonp||[]).push([[257],{"./frontend/src/scenes/annotations/index.tsx":function(Sn,$,n){"use strict";n.r($),n.d($,"scene",function(){return bn}),n.d($,"Annotations",function(){return W});var k=n("./node_modules/@babel/runtime/regenerator/index.js"),E=n.n(k),Tn=n("./node_modules/regenerator-runtime/runtime.js"),Q=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),R=n.n(Q),X=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),S=n.n(X),C=n("./node_modules/react/index.js"),t=n.n(C),M=n("./node_modules/kea/lib/index.esm.js"),Z=n("./node_modules/antd/es/input/index.js"),T=n("./node_modules/antd/es/tag/index.js"),z=n("./node_modules/antd/es/button/index.js"),w=n("./node_modules/antd/es/modal/index.js"),q=n("./node_modules/antd/es/dropdown/index.js"),B=n("./node_modules/antd/es/menu/index.js"),_=n("./node_modules/antd/es/row/index.js"),K=n("./frontend/src/models/annotationsModel.ts"),On=n("./node_modules/core-js/modules/es.array.concat.js"),Nn=n("./node_modules/core-js/modules/es.array.iterator.js"),Dn=n("./node_modules/core-js/modules/es.object.to-string.js"),Rn=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),nn=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),tn=n.n(nn),en=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),V=n.n(en),Y=n("./frontend/src/lib/api.ts"),F=n("./frontend/src/lib/utils.tsx"),U=n("./frontend/src/scenes/teamLogic.ts"),H=Object(M.kea)({path:["scenes","annotations","logic"],loaders:function(o){var e=o.actions;return{annotations:{__default:[],loadAnnotations:function(){var d=R()(E.a.mark(function l(){var c;return E.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Y.b.get("api/projects/".concat(U.a.values.currentTeamId,"/annotations/?").concat(Object(F.xb)({order:"-updated_at"})));case 2:return c=r.sent,e.setNext(c.next),r.abrupt("return",c.results);case 5:case"end":return r.stop()}},l)}));function i(){return d.apply(this,arguments)}return i}()}}},reducers:function(){return{annotations:[[],{appendAnnotations:function(e,d){var i=d.annotations;return[].concat(V()(e),V()(i))}}],next:[null,{setNext:function(e,d){var i=d.next;return i}}],loadingNext:[!1,{loadAnnotationsNext:function(){return!0},appendAnnotations:function(){return!1}}]}},actions:function(){return{updateAnnotation:function(e,d){return{id:e,content:d}},deleteAnnotation:function(e){return{id:e}},restoreAnnotation:function(e){return{id:e}},loadAnnotationsNext:function(){return!0},setNext:function(e){return{next:e}},appendAnnotations:function(e){return{annotations:e}}}},listeners:function(o){var e=o.actions,d=o.values;return tn()({updateAnnotation:function(){var i=R()(E.a.mark(function c(m){var r,p;return E.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return r=m.id,p=m.content,b.next=3,Y.b.update("api/projects/".concat(U.a.values.currentTeamId,"/annotations/").concat(r),{content:p});case 3:e.loadAnnotations();case 4:case"end":return b.stop()}},c)}));function l(c){return i.apply(this,arguments)}return l}(),restoreAnnotation:function(){var i=R()(E.a.mark(function c(m){var r;return E.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r=m.id,u.next=3,Y.b.update("api/projects/".concat(U.a.values.currentTeamId,"/annotations/").concat(r),{deleted:!1});case 3:e.loadAnnotations();case 4:case"end":return u.stop()}},c)}));function l(c){return i.apply(this,arguments)}return l}(),deleteAnnotation:function(l){var c=l.id;Object(F.w)({endpoint:"projects/".concat(U.a.values.currentTeamId,"/annotations"),object:{name:"Annotation",id:c},callback:function(){return e.loadAnnotations()}})},loadAnnotationsNext:function(){var i=R()(E.a.mark(function c(){var m,r;return E.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(m=[],!d.next){u.next=7;break}return u.next=4,Y.b.get(d.next);case 4:r=u.sent,e.setNext(r.next),m=r.results;case 7:e.appendAnnotations(m);case 8:case"end":return u.stop()}},c)}));function l(){return i.apply(this,arguments)}return l}()},K.a.actionTypes.createGlobalAnnotationSuccess,function(){e.loadAnnotations()})},events:function(o){var e=o.actions;return{afterMount:function(){return e.loadAnnotations()}}}}),an=n("./node_modules/@ant-design/icons/es/icons/ProjectOutlined.js"),on=n("./node_modules/@ant-design/icons/es/icons/DeploymentUnitOutlined.js"),rn=n("./node_modules/@ant-design/icons/es/icons/DownOutlined.js"),sn=n("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),ln=n("./node_modules/@ant-design/icons/es/icons/RedoOutlined.js"),cn=n("./frontend/src/lib/constants.tsx"),dn=n("./frontend/src/lib/components/PageHeader.tsx"),h=n("./frontend/src/types.ts"),un=n("./node_modules/rc-picker/lib/generate/dayjs.js"),mn=n.n(un),fn=n("./node_modules/antd/lib/date-picker/generatePicker/index.js"),vn=n.n(fn),P=n("./frontend/src/lib/dayjs.ts"),An=n("./frontend/src/lib/components/Spinner/Spinner.tsx"),pn=n("./frontend/src/lib/components/LemonTable/index.ts"),jn=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),gn=n("./frontend/src/lib/components/TimezoneAware/index.tsx"),En=n("./frontend/src/lib/components/LemonButton/index.ts"),yn=vn()(mn.a),xn=Z.a.TextArea,bn={component:W,logic:H};function W(){var a=Object(M.useValues)(H),o=a.annotations,e=a.annotationsLoading,d=a.next,i=a.loadingNext,l=Object(M.useActions)(H),c=l.updateAnnotation,m=l.deleteAnnotation,r=l.loadAnnotationsNext,p=l.restoreAnnotation,u=Object(M.useActions)(K.a),b=u.createGlobalAnnotation,O=Object(C.useState)(!1),L=S()(O,2),J=L[0],N=L[1],G=Object(C.useState)(null),I=S()(G,2),y=I[0],j=I[1],g=[{title:"Annotation",key:"annotation",width:"30%",render:function(v,s){return t.a.createElement("div",{className:"ph-no-capture",style:{width:"auto",maxWidth:250}},s.content)}},{title:"For date",dataIndex:"date_marker",render:function(v,s){return t.a.createElement("span",null,Object(P.a)(s.date_marker).format("MMMM DD, YYYY"))},sorter:function(v,s){return Object(P.a)(v.date_marker).diff(s.date_marker)}},Object(jn.b)(),{title:"Last updated",dataIndex:"updated_at",render:function(v,s){return t.a.createElement(gn.b,{time:s.updated_at})},sorter:function(v,s){return Object(P.a)(v.date_marker).diff(s.date_marker)}},{title:"Status",render:function(v,s){return s.deleted?t.a.createElement(T.a,{color:"red"},"Deleted"):t.a.createElement(T.a,{color:"green"},"Active")}},{title:"Scope",render:function(v,s){return s.scope===h.c.Insight?t.a.createElement(T.a,{color:"blue"},"Insight"):s.scope===h.c.Project?t.a.createElement(T.a,{color:"purple"},"Project"):s.scope===h.c.Organization?t.a.createElement(T.a,{color:"pink"},"Organization"):t.a.createElement(T.a,null,"Unknown (",s.scope,")")}}];function D(){N(!1),setTimeout(function(){return j(null)},500)}return t.a.createElement("div",null,t.a.createElement(dn.a,{title:"Annotations",caption:"Here you can add organization- and project-wide annotations. Dashboard-specific ones can be added directly in the dashboard.",buttons:t.a.createElement(En.a,{type:"primary","data-attr":"create-annotation",onClick:function(){return N(!0)}},"New annotation")}),t.a.createElement("div",null,t.a.createElement(pn.a,{"data-attr":"annotations-table",rowKey:"id",rowClassName:"cursor-pointer",dataSource:o,columns:g,loading:e,onRow:function(v){return{onClick:function(){j(v),N(!0)}}},emptyState:"No annotations yet"}),t.a.createElement("div",{style:{visibility:d?"visible":"hidden",margin:"2rem auto 5rem",textAlign:"center"}},i?t.a.createElement(An.a,{size:"sm"}):t.a.createElement(z.a,{type:"primary",onClick:function(){r()}},"Load more annotations"))),t.a.createElement(Cn,{visible:J,onCancel:function(){D()},onSubmit:function(){var f=R()(E.a.mark(function v(s,hn){return E.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(A.t0=y,!A.t0){A.next=5;break}return A.next=4,y;case 4:A.t0=A.sent;case 5:if(!A.t0){A.next=9;break}c(y.id,s),A.next=10;break;case 9:b(s,hn.format("YYYY-MM-DD"));case 10:D();case 11:case"end":return A.stop()}},v)}));return function(v,s){return f.apply(this,arguments)}}(),onDelete:function(){y&&m(y.id),D()},onRestore:function(){y&&p(y.id),D()},annotation:y}))}var x;(function(a){a[a.CREATE=0]="CREATE",a[a.EDIT=1]="EDIT"})(x||(x={}));function Cn(a){var o,e=Object(C.useState)(h.c.Project),d=S()(e,2),i=d[0],l=d[1],c=Object(C.useState)(""),m=S()(c,2),r=m[0],p=m[1],u=Object(C.useState)(x.CREATE),b=S()(u,2),O=b[0],L=b[1],J=Object(C.useState)(Object(P.a)()),N=S()(J,2),G=N[0],I=N[1];Object(C.useEffect)(function(){a.annotation?(L(x.EDIT),p(a.annotation.content)):(L(x.CREATE),p(""))},[a.annotation]);var y=function(g,D){a.onSubmit(g,D),p(""),I(Object(P.a)()),l(h.c.Project)};return t.a.createElement(w.a,{footer:[t.a.createElement(z.a,{key:"create-annotation-cancel",onClick:function(){return a.onCancel()}},"Cancel"),t.a.createElement(z.a,{type:"primary",key:"create-annotation-submit","data-attr":"create-annotation-submit",onClick:function(){y(r,G)}},O===x.CREATE?"Submit":"Update")],closable:!1,visible:a.visible,onCancel:a.onCancel,title:O===x.CREATE?"Create annotation":"Edit ennotation"},O===x.CREATE?t.a.createElement("span",null,"This annotation will appear on all",t.a.createElement(q.a,{overlay:t.a.createElement(B.a,{activeKey:i,onSelect:function(g){return l(g.key)}},t.a.createElement(B.a.Item,{key:h.c.Project,icon:t.a.createElement(an.a,null)},"Project"),t.a.createElement(B.a.Item,{key:h.c.Organization,icon:t.a.createElement(on.a,null)},"Organization"))},t.a.createElement(z.a,{style:{marginLeft:8,marginRight:8}},cn.A.get(i)," ",t.a.createElement(rn.a,null)))," ","charts"):t.a.createElement(_.a,{justify:"space-between"},t.a.createElement("span",null,"Change existing annotation text"),!((o=a.annotation)===null||o===void 0)&&o.deleted?t.a.createElement(ln.a,{className:"button-border clickable",onClick:function(){a.onRestore()}}):t.a.createElement(sn.a,{className:"text-danger",onClick:function(){a.onDelete()}})),t.a.createElement("br",null),O===x.CREATE&&t.a.createElement("div",null,"Date:",t.a.createElement(yn,{style:{marginTop:16,marginLeft:8,marginBottom:16},getPopupContainer:function(g){return g.parentElement},value:G,onChange:function(g){return I(g)},allowClear:!1})),t.a.createElement(xn,{"data-attr":"create-annotation-input",maxLength:300,style:{marginBottom:12,marginTop:5},rows:4,value:r,onChange:function(g){return p(g.target.value)}}))}}}]);
