{"version":3,"file":"69536.9af9d7b2.iframe.bundle.js","mappings":";AAqCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA6CA;AAIA","sources":["webpack://@posthog/storybook/../../products/error_tracking/frontend/components/ExceptionCard/FixModal.tsx"],"sourcesContent":["import { LemonButton, LemonModal } from '@posthog/lemon-ui'\nimport { useActions, useValues } from 'kea'\nimport { errorPropertiesLogic } from 'lib/components/Errors/errorPropertiesLogic'\nimport { stackFrameLogic } from 'lib/components/Errors/stackFrameLogic'\nimport { ErrorTrackingException } from 'lib/components/Errors/types'\nimport { copyToClipboard } from 'lib/utils/copyToClipboard'\nimport posthog from 'posthog-js'\nimport { useEffect } from 'react'\n\ninterface FixModalProps {\n    isOpen: boolean\n    onClose: () => void\n}\n\nexport function FixModal({ isOpen, onClose }: FixModalProps): JSX.Element {\n    const { exceptionList } = useValues(errorPropertiesLogic)\n    const { stackFrameRecords } = useValues(stackFrameLogic)\n    const { loadFromRawIds } = useActions(stackFrameLogic)\n\n    // Load all raw_ids for frames when modal opens\n    useEffect(() => {\n        if (isOpen && exceptionList.length > 0) {\n            const rawIds = exceptionList\n                .flatMap((exception) => exception.stacktrace?.frames || [])\n                .map((frame) => frame.raw_id)\n            if (rawIds.length > 0) {\n                loadFromRawIds(rawIds)\n            }\n        }\n    }, [isOpen, exceptionList, loadFromRawIds])\n\n    const generatePrompt = (): string => {\n        const stacktraceText = exceptionList\n            .map((exception) => generateExceptionText(exception, stackFrameRecords))\n            .join('\\n\\n')\n\n        return `Please help me fix this error. Here's the stack trace:\n\n\\`\\`\\`\n${stacktraceText}\n\\`\\`\\`\n\nNote: Frames marked with [IN-APP] are from the application code (my code), while frames without this marker are from external libraries/frameworks.\nFocus your analysis primarily on the [IN-APP] frames as these are most likely where the issue needs to be fixed.\n\nCan you:\n1. Analyze what's causing this error\n2. Suggest the most likely fix\n3. Provide code examples if applicable\n4. Explain why this error occurred\n\nPlease be specific about the file and line number where the fix should be applied.`\n    }\n\n    const handleCopy = (): void => {\n        void copyToClipboard(generatePrompt(), 'LLM prompt')\n        posthog.capture('error_tracking_prompt_copied')\n        onClose()\n    }\n\n    return (\n        <LemonModal\n            isOpen={isOpen}\n            onClose={onClose}\n            title=\"Fix this error with AI\"\n            width=\"50rem\"\n            footer={\n                <div className=\"flex items-center justify-end gap-2\">\n                    <LemonButton type=\"secondary\" onClick={onClose}>\n                        Close\n                    </LemonButton>\n                    <LemonButton type=\"primary\" onClick={handleCopy}>\n                        Copy to clipboard\n                    </LemonButton>\n                </div>\n            }\n        >\n            <div className=\"space-y-4\">\n                <p className=\"text-muted\">\n                    Paste this prompt into your favourite coding assistant to get help fixing this error:\n                </p>\n                <div className=\"bg-bg-light border rounded p-4 font-mono text-sm whitespace-pre-wrap max-h-96 overflow-auto\">\n                    {generatePrompt()}\n                </div>\n            </div>\n        </LemonModal>\n    )\n}\n\nfunction generateExceptionText(exception: ErrorTrackingException, stackFrameRecords: Record<string, any>): string {\n    let result = `${exception.type}: ${exception.value}`\n\n    const frames = exception.stacktrace?.frames || []\n\n    for (const frame of frames) {\n        const inAppMarker = frame.in_app ? ' [IN-APP]' : ''\n        result += `\\n${inAppMarker}  File \"${frame.source}\", line: ${frame.line}, in: ${frame.resolved_name}`\n\n        const frameRecord = stackFrameRecords[frame.raw_id]\n        if (frameRecord?.context?.line?.line) {\n            result += `\\n    ${frameRecord.context.line.line}`\n        }\n    }\n\n    return result\n}\n"],"names":[],"sourceRoot":""}