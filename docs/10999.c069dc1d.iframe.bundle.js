(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[10999],{"../../frontend/src/scenes/heatmaps/HeatmapsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HeatmapsScene:()=>HeatmapsScene,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.20.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),AuthorizedUrlList=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),authorizedUrlListLogic=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),hedgehogs=__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx"),ScreenShotEditor=__webpack_require__("../../frontend/src/lib/components/TakeScreenshot/ScreenShotEditor.tsx"),takeScreenshotLogic=__webpack_require__("../../frontend/src/lib/components/TakeScreenshot/takeScreenshotLogic.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),useResizeObserver=__webpack_require__("../../frontend/src/lib/hooks/useResizeObserver.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),HeatMapsSettings=__webpack_require__("../../frontend/src/lib/components/heatmaps/HeatMapsSettings.tsx"),utils=__webpack_require__("../../frontend/src/lib/components/IframedToolbarBrowser/utils.ts"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LoadingBar=__webpack_require__("../../frontend/src/lib/lemon-ui/LoadingBar/index.ts"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),TestAccountFilter=__webpack_require__("../../frontend/src/scenes/insights/filters/TestAccountFilter/index.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let useDebounceLoading=function(loading){let delay=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,[debouncedLoading,setDebouncedLoading]=(0,react.useState)(!1);return(0,react.useEffect)(()=>{let timer=setTimeout(()=>{setDebouncedLoading(loading)},delay);return()=>clearTimeout(timer)},[loading,delay]),debouncedLoading};function FilterPanel(_ref){let{heatmapFilters,heatmapColorPalette,heatmapFixedPositionMode,viewportRange,commonFilters,filterPanelCollapsed,loading,patchHeatmapFilters,setHeatmapColorPalette,setHeatmapFixedPositionMode,setCommonFilters,toggleFilterPanelCollapsed,isEmpty}=_ref,debouncedLoading=useDebounceLoading(null!=loading&&loading);return(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("flex flex-col gap-y-2 px-2 py-1 border-r border-t bg-surface-primary mt-2 relative",!filterPanelCollapsed&&"w-100"),children:[debouncedLoading&&(0,jsx_runtime.jsx)(LoadingBar.F,{wrapperClassName:"absolute top-0 left-0 w-full overflow-hidden rounded-none my-0",className:"h-1 rounded-none"}),filterPanelCollapsed?(0,jsx_runtime.jsx)(Tooltip.u,{title:"Expand heatmap settings",children:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",icon:(0,jsx_runtime.jsx)(icons.VG,{}),onClick:()=>toggleFilterPanelCollapsed?.()})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center",children:[(0,jsx_runtime.jsx)(Tooltip.u,{title:"Collapse heatmap settings",children:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCollapse,{className:"rotate-90"}),onClick:()=>toggleFilterPanelCollapsed?.()})}),(0,jsx_runtime.jsx)("h2",{className:"flex-1 mb-0 px-2",children:"Heatmap settings"})]}),isEmpty?(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",children:"No data found. Try changing your filters or the URL above."}):null,(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:commonFilters?.date_from,dateTo:commonFilters?.date_to,onChange:(fromDate,toDate)=>{setCommonFilters?.({...commonFilters||{},date_from:fromDate,date_to:toDate})},dateOptions:utils.PJ}),(0,jsx_runtime.jsx)(TestAccountFilter.z,{filters:{filter_test_accounts:commonFilters?.filter_test_accounts},onChange:value=>{setCommonFilters?.({...commonFilters||{},filter_test_accounts:value.filter_test_accounts})}}),(0,jsx_runtime.jsx)(HeatMapsSettings.s,{heatmapFilters:heatmapFilters,patchHeatmapFilters:patchHeatmapFilters,viewportRange:viewportRange,heatmapColorPalette:heatmapColorPalette,setHeatmapColorPalette:setHeatmapColorPalette,heatmapFixedPositionMode:heatmapFixedPositionMode,setHeatmapFixedPositionMode:setHeatmapFixedPositionMode})]})]})}var HeatmapCanvas=__webpack_require__("../../frontend/src/lib/components/heatmaps/HeatmapCanvas.tsx"),heatmapDataLogic=__webpack_require__("../../frontend/src/lib/components/heatmaps/heatmapDataLogic.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.249.3_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),sessionRecordingPlayerLogic=__webpack_require__("../../frontend/src/scenes/session-recordings/player/sessionRecordingPlayerLogic.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),queries_utils=__webpack_require__("../../frontend/src/queries/utils.ts");let teamId=window.POSTHOG_APP_CONTEXT?.current_team?.id,heatmapsBrowserLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","heatmaps","heatmapsBrowserLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(()=>({values:[(0,authorizedUrlListLogic.zl)({...authorizedUrlListLogic.P1,type:authorizedUrlListLogic.uw.TOOLBAR_URLS}),["urlsKeyed","checkUrlIsAuthorized"],heatmapDataLogic.y,["heatmapEmpty"]],actions:[heatmapDataLogic.y,["loadHeatmap","setFetchFn","setHref","setHrefMatchType"]]})),(0,index_esm.actions)({setBrowserSearch:searchTerm=>({searchTerm}),setBrowserUrl:url=>({url}),onIframeLoad:!0,sendToolbarMessage:(type,payload)=>({type,payload}),loadTopUrls:!0,maybeLoadTopUrls:!0,loadBrowserSearchResults:!0,patchHeatmapFilters:filters=>({filters}),setHeatmapColorPalette:Palette=>({Palette}),setHeatmapFixedPositionMode:mode=>({mode}),setCommonFilters:filters=>({filters}),setIframeWidth:width=>({width}),toggleFilterPanelCollapsed:!0,setIframeBanner:banner=>({banner}),startTrackingLoading:!0,stopTrackingLoading:!0,setReplayIframeData:replayIframeData=>({replayIframeData}),setReplayIframeDataURL:url=>({url})}),(0,lib.loaders)(_ref=>{let{values}=_ref;return{browserSearchResults:[null,{loadBrowserSearchResults:async()=>{if(!values.browserSearchTerm)return[];let query={kind:schema_general.OH.HogQLQuery,query:(0,queries_utils.zP)`SELECT distinct properties.$current_url AS urls
                                     FROM events
                                     WHERE timestamp >= now() - INTERVAL 7 DAY
                                       AND timestamp <= now()
                                       AND properties.$current_url like '%${queries_utils.zP.identifier(values.browserSearchTerm)}%'
                                     ORDER BY timestamp DESC
                                         limit 100`},res=await api.ZP.query(query);return res.results?.map(x=>x[0])}}],topUrls:[null,{loadTopUrls:async()=>{let query={kind:schema_general.OH.HogQLQuery,query:(0,queries_utils.zP)`SELECT properties.$current_url AS url, count() as count
                                     FROM events
                                     WHERE timestamp >= now() - INTERVAL 7 DAY
                                       AND event in ('$pageview'
                                         , '$autocapture')
                                       AND timestamp <= now()
                                     GROUP BY properties.$current_url
                                     ORDER BY count DESC
                                         LIMIT 10`},res=await api.ZP.query(query);return res.results?.map(x=>({url:x[0],count:x[1]}))}}]}}),(0,index_esm.reducers)({hasValidReplayIframeData:[!1,{setReplayIframeData:(_,_ref2)=>{let{replayIframeData}=_ref2;return!!replayIframeData?.url?.trim().length&&!!replayIframeData?.html.trim().length}}],replayIframeData:[null,{setReplayIframeData:(_,_ref3)=>{let{replayIframeData}=_ref3;return replayIframeData},setReplayIframeDataURL:(state,_ref4)=>{let{url}=_ref4;return null===state?null:{...state,url}}}],filterPanelCollapsed:[!1,{persist:!0},{toggleFilterPanelCollapsed:state=>!state}],commonFilters:[{date_from:"-7d"},{setCommonFilters:(_,_ref5)=>{let{filters}=_ref5;return filters}}],heatmapColorPalette:["default",{setHeatmapColorPalette:(_,_ref6)=>{let{Palette}=_ref6;return Palette}}],heatmapFilters:[utils._f,{patchHeatmapFilters:(state,_ref7)=>{let{filters}=_ref7;return{...state,...filters}}}],heatmapFixedPositionMode:["fixed",{setHeatmapFixedPositionMode:(_,_ref8)=>{let{mode}=_ref8;return mode}}],iframeWidth:[null,{setIframeWidth:(_,_ref9)=>{let{width}=_ref9;return width}}],browserSearchTerm:["",{setBrowserSearch:(_,_ref10)=>{let{searchTerm}=_ref10;return searchTerm}}],browserUrl:[null,{persist:!0,prefix:`${teamId}__`},{setBrowserUrl:(_,_ref11)=>{let{url}=_ref11;return url}}],loading:[!1,{setBrowserUrl:(state,_ref12)=>{let{url}=_ref12;return!!url?.trim().length||state},setIframeBanner:(state,_ref13)=>{let{banner}=_ref13;return banner?.level!="error"&&state},startTrackingLoading:()=>!0,stopTrackingLoading:()=>!1}],iframeBanner:[null,{setIframeBanner:(_,_ref14)=>{let{banner}=_ref14;return banner}}],widthOverride:[null,{setIframeWidth:(_,_ref15)=>{let{width}=_ref15;return width}}]}),(0,index_esm.selectors)({browserUrlSearchOptions:[s=>[s.browserSearchResults,s.topUrls,s.browserSearchTerm],(browserSearchResults,topUrls,browserSearchTerm)=>{var _topUrls$map;return browserSearchTerm?browserSearchResults:null!==(_topUrls$map=topUrls?.map(x=>x.url))&&void 0!==_topUrls$map?_topUrls$map:[]}],isBrowserUrlAuthorized:[s=>[s.browserUrl,s.checkUrlIsAuthorized],(browserUrl,checkUrlIsAuthorized)=>!!browserUrl&&checkUrlIsAuthorized(browserUrl)],isBrowserUrlValid:[s=>[s.browserUrl],browserUrl=>{if(!browserUrl)return!0;try{return new URL(browserUrl),browserUrl.includes("://")}catch(e){return!1}}],viewportRange:[s=>[s.heatmapFilters,s.iframeWidth],(heatmapFilters,iframeWidth)=>iframeWidth?(0,utils.f6)(heatmapFilters,iframeWidth):{min:0,max:1800}],noPageviews:[s=>[s.topUrlsLoading,s.topUrls],(topUrlsLoading,topUrls)=>!topUrlsLoading&&(!topUrls||0===topUrls.length)]}),(0,index_esm.listeners)(_ref16=>{let{actions,cache,props,values}=_ref16;return{setReplayIframeData:_ref17=>{let{replayIframeData}=_ref17;replayIframeData&&replayIframeData.url?(actions.setFetchFn("native"),actions.setHref(replayIframeData.url),actions.setHrefMatchType("exact")):(0,sessionRecordingPlayerLogic.x4)()},setBrowserSearch:async(_,breakpoint)=>{await breakpoint(200),actions.loadBrowserSearchResults()},sendToolbarMessage:_ref18=>{let{type,payload}=_ref18;props.iframeRef?.current?.contentWindow?.postMessage({type,payload},"*")},patchHeatmapFilters:_ref19=>{let{filters}=_ref19;actions.sendToolbarMessage(utils.TH.PH_PATCH_HEATMAP_FILTERS,{filters})},setHeatmapFixedPositionMode:_ref20=>{let{mode}=_ref20;actions.sendToolbarMessage(utils.TH.PH_HEATMAPS_FIXED_POSITION_MODE,{fixedPositionMode:mode})},setHeatmapColorPalette:_ref21=>{let{Palette}=_ref21;actions.sendToolbarMessage(utils.TH.PH_HEATMAPS_COLOR_PALETTE,{colorPalette:Palette})},setCommonFilters:_ref22=>{let{filters}=_ref22;actions.sendToolbarMessage(utils.TH.PH_HEATMAPS_COMMON_FILTERS,{commonFilters:filters})},onIframeLoad:()=>{if(values.hasValidReplayIframeData){actions.loadHeatmap();return}let init=()=>{actions.sendToolbarMessage(utils.TH.PH_APP_INIT,{filters:values.heatmapFilters,colorPalette:values.heatmapColorPalette,fixedPositionMode:values.heatmapFixedPositionMode,commonFilters:values.commonFilters}),actions.sendToolbarMessage(utils.TH.PH_HEATMAPS_CONFIG,{enabled:!0})};window.addEventListener("message",e=>{let type=e?.data?.type;if(type&&type.startsWith("ph-")){if(!values.checkUrlIsAuthorized(e.origin)){console.warn("ignoring message from iframe with origin not in authorized toolbar urls",e.origin,e.data);return}switch(type){case utils.TH.PH_TOOLBAR_INIT:return init();case utils.TH.PH_TOOLBAR_READY:return dist_module.ZP.capture("in-app heatmap frame loaded",{inapp_heatmap_page_url_visited:values.browserUrl,inapp_heatmap_filters:values.heatmapFilters,inapp_heatmap_color_palette:values.heatmapColorPalette,inapp_heatmap_fixed_position_mode:values.heatmapFixedPositionMode}),actions.startTrackingLoading();case utils.TH.PH_TOOLBAR_HEATMAP_LOADING:return actions.startTrackingLoading();case utils.TH.PH_TOOLBAR_HEATMAP_LOADED:return dist_module.ZP.capture("in-app heatmap loaded",{inapp_heatmap_page_url_visited:values.browserUrl,inapp_heatmap_filters:values.heatmapFilters,inapp_heatmap_color_palette:values.heatmapColorPalette,inapp_heatmap_fixed_position_mode:values.heatmapFixedPositionMode}),actions.stopTrackingLoading();case utils.TH.PH_TOOLBAR_HEATMAP_FAILED:dist_module.ZP.capture("in-app heatmap failed",{inapp_heatmap_page_url_visited:values.browserUrl,inapp_heatmap_filters:values.heatmapFilters,inapp_heatmap_color_palette:values.heatmapColorPalette,inapp_heatmap_fixed_position_mode:values.heatmapFixedPositionMode}),actions.stopTrackingLoading(),actions.setIframeBanner({level:"error",message:"The heatmap failed to load."});return;default:console.warn(`[PostHog Heatmaps] Received unknown child window message: ${type}`)}}},!1),init()},maybeLoadTopUrls:()=>{values.topUrls||values.topUrlsLoading||actions.loadTopUrls()},setReplayIframeDataURL:async(_ref23,breakpoint)=>{let{url}=_ref23;await breakpoint(150),url?.trim().length&&(actions.setFetchFn("native"),actions.setHref(url),actions.setHrefMatchType("exact"))},setBrowserUrl:_ref24=>{let{url}=_ref24;actions.maybeLoadTopUrls(),url?.trim().length&&actions.startTrackingLoading()},startTrackingLoading:()=>{actions.setIframeBanner(null),clearTimeout(cache.errorTimeout),cache.errorTimeout=setTimeout(()=>{actions.setIframeBanner({level:"error",message:"The heatmap failed to load (or is very slow)."})},7500),clearTimeout(cache.warnTimeout),cache.warnTimeout=setTimeout(()=>{actions.setIframeBanner({level:"warning",message:"Still waiting for the toolbar to load."})},3e3)},stopTrackingLoading:()=>{actions.setIframeBanner(null),clearTimeout(cache.errorTimeout),clearTimeout(cache.warnTimeout)}}}),(0,index_esm.afterMount)(_ref25=>{let{actions,values}=_ref25;values.browserUrl?.trim().length?actions.startTrackingLoading():actions.maybeLoadTopUrls()}),(0,kea_router_lib.urlToAction)(_ref26=>{let{actions,values}=_ref26;return{"/heatmaps":(_,searchParams)=>{if(searchParams.pageURL&&searchParams.pageURL!==values.browserUrl&&actions.setBrowserUrl(searchParams.pageURL),searchParams.heatmapFilters&&!(0,lib_utils.h0)(searchParams.heatmapFilters,values.heatmapFilters)&&actions.patchHeatmapFilters(searchParams.heatmapFilters),searchParams.heatmapPalette&&searchParams.heatmapPalette!==values.heatmapColorPalette&&actions.setHeatmapColorPalette(searchParams.heatmapPalette),searchParams.heatmapFixedPositionMode&&searchParams.heatmapFixedPositionMode!==values.heatmapFixedPositionMode&&actions.setHeatmapFixedPositionMode(searchParams.heatmapFixedPositionMode),searchParams.commonFilters&&!(0,lib_utils.h0)(searchParams.commonFilters,values.commonFilters)&&actions.setCommonFilters(searchParams.commonFilters),searchParams.iframeStorage){let replayFrameData=JSON.parse(localStorage.getItem(searchParams.iframeStorage)||"{}");actions.setReplayIframeData(replayFrameData)}}}}),(0,kea_router_lib.actionToUrl)(_ref27=>{let{values}=_ref27;return{setBrowserUrl:_ref28=>{let{url}=_ref28,searchParams={...kea_router_lib.router.values.searchParams,pageURL:url};return url&&""!==url.trim()||delete searchParams.pageURL,[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]},patchHeatmapFilters:()=>{let searchParams={...kea_router_lib.router.values.searchParams,heatmapFilters:values.heatmapFilters};return[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]},setHeatmapColorPalette:_ref29=>{let{Palette}=_ref29,searchParams={...kea_router_lib.router.values.searchParams,heatmapPalette:Palette};return[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]},setHeatmapFixedPositionMode:_ref30=>{let{mode}=_ref30,searchParams={...kea_router_lib.router.values.searchParams,heatmapFixedPositionMode:mode};return[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]},setCommonFilters:_ref31=>{let{filters}=_ref31,searchParams={...kea_router_lib.router.values.searchParams,commonFilters:filters};return[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]}}})]);function FixedReplayHeatmapBrowser(_ref){let{iframeRef}=_ref,logic=heatmapsBrowserLogic(),{replayIframeData,hasValidReplayIframeData,filterPanelCollapsed,widthOverride}=(0,index_esm.useValues)(logic),{onIframeLoad,setIframeWidth,toggleFilterPanelCollapsed}=(0,index_esm.useActions)(logic),{heatmapFilters,heatmapColorPalette,heatmapFixedPositionMode,viewportRange,commonFilters,rawHeatmapLoading,heatmapEmpty}=(0,index_esm.useValues)(heatmapDataLogic.y),{patchHeatmapFilters,setHeatmapColorPalette,setHeatmapFixedPositionMode,setCommonFilters,setWindowWidthOverride}=(0,index_esm.useActions)(heatmapDataLogic.y),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{setHtml}=(0,index_esm.useActions)((0,takeScreenshotLogic.Oe)({screenshotKey:"heatmaps"})),{width:iframeWidth}=(0,useResizeObserver.y)({ref:iframeRef});return(0,react.useEffect)(()=>{null===widthOverride&&setIframeWidth(null!=iframeWidth?iframeWidth:null),setWindowWidthOverride(widthOverride)},[iframeWidth,setIframeWidth,widthOverride,setWindowWidthOverride]),hasValidReplayIframeData?(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-x-2 w-full",children:[(0,jsx_runtime.jsx)(FilterPanel,{heatmapFilters,heatmapColorPalette,heatmapFixedPositionMode,viewportRange,commonFilters,filterPanelCollapsed,loading:rawHeatmapLoading,patchHeatmapFilters,setHeatmapColorPalette,setHeatmapFixedPositionMode,setCommonFilters,toggleFilterPanelCollapsed,isEmpty:heatmapEmpty}),(0,jsx_runtime.jsxs)("div",{className:"relative flex-1 w-full h-full mt-2",children:[featureFlags[constants.y8.SCREENSHOT_EDITOR]?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ScreenShotEditor.o,{screenshotKey:"heatmaps"}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)(ViewportChooser,{}),(0,jsx_runtime.jsx)(LemonButton.J,{className:"mb-2 mr-2",type:"secondary",onClick:()=>{let iframe=iframeRef?.current;if(!iframe){LemonToast.U.error("Cannot take screenshot. Please try again.");return}setHtml(iframe)},icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconLlmPromptEvaluation,{}),children:"Take screenshot"})]})]}):(0,jsx_runtime.jsx)(ViewportChooser,{}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center h-full w-full",children:(0,jsx_runtime.jsxs)("div",{className:"relative h-full ",style:{width:null!=widthOverride?widthOverride:"100%"},children:[(0,jsx_runtime.jsx)(HeatmapCanvas.F,{positioning:"absolute",widthOverride:widthOverride}),(0,jsx_runtime.jsx)("iframe",{ref:iframeRef,className:"w-full h-full bg-white",srcDoc:replayIframeData?.html,onLoad:onIframeLoad,allow:""})]})})]})]}):null}var teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),sidePanelSettingsLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/panels/sidePanelSettingsLogic.tsx");function UrlSearchHeader(){var _browserUrlSearchOpti,_browserUrlSearchOpti2;let logic=heatmapsBrowserLogic(),{browserUrlSearchOptions,browserUrl,isBrowserUrlValid,replayIframeData,hasValidReplayIframeData}=(0,index_esm.useValues)(logic),{setBrowserSearch,setBrowserUrl,setReplayIframeData,setReplayIframeDataURL}=(0,index_esm.useActions)(logic),placeholderUrl=null!==(_browserUrlSearchOpti=browserUrlSearchOptions?.[0])&&void 0!==_browserUrlSearchOpti?_browserUrlSearchOpti:"https://your-website.com/pricing";return(0,jsx_runtime.jsxs)("div",{className:"bg-surface-primary p-2 border-b flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"flex-1",children:hasValidReplayIframeData?(0,jsx_runtime.jsx)(src.DF,{value:replayIframeData?.url,onChange:s=>setReplayIframeDataURL(s)}):(0,jsx_runtime.jsx)(src.nt,{mode:"single",allowCustomValues:!0,placeholder:`e.g. ${placeholderUrl}`,onInputChange:e=>setBrowserSearch(e),value:browserUrl?[browserUrl]:void 0,onChange:v=>{var _v$;return setBrowserUrl(null!==(_v$=v[0])&&void 0!==_v$?_v$:null)},options:null!==(_browserUrlSearchOpti2=browserUrlSearchOptions?.map(x=>({label:x,key:x})))&&void 0!==_browserUrlSearchOpti2?_browserUrlSearchOpti2:[],className:isBrowserUrlValid?void 0:"border-red-500"})}),hasValidReplayIframeData?(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconRevert,{}),onClick:()=>{setReplayIframeData(null),setBrowserUrl(null)},children:"Reset"}):null,(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",sideIcon:(0,jsx_runtime.jsx)(icons.pF,{}),to:browserUrl?(0,authorizedUrlListLogic.Kc)(browserUrl,{userIntent:"heatmaps"}):hasValidReplayIframeData&&replayIframeData?.url?(0,authorizedUrlListLogic.Kc)(replayIframeData?.url,{userIntent:"heatmaps"}):void 0,targetBlank:!0,disabledReason:browserUrl||hasValidReplayIframeData?void 0:"Select a URL first",children:"Open in toolbar"})]})}function HeatmapsBrowserIntro(){let logic=heatmapsBrowserLogic(),{topUrls,topUrlsLoading,noPageviews}=(0,index_esm.useValues)(logic),{setBrowserUrl}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center overflow-y-auto",children:(0,jsx_runtime.jsxs)("div",{className:"max-w-[50rem] py-6 px-3 h-full w-full",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center flex-wrap gap-6",children:[(0,jsx_runtime.jsx)("div",{className:"w-50",children:(0,jsx_runtime.jsx)(hedgehogs.DetectiveHog,{className:"w-full h-full"})}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("h2",{children:"Welcome to Heatmaps"}),(0,jsx_runtime.jsx)("p",{children:"Heatmaps are powered by the embedded JavaScript SDK and allow you to see a range of user interactions directly on your website via the Toolbar."}),(0,jsx_runtime.jsx)("p",{children:"You can also view heatmaps for any page on your website by entering the URL above. As long as the page has the PostHog Toolbar installed, and can be loaded in an iframe, you can view heatmaps for it."})]})]}),(0,jsx_runtime.jsx)("div",{className:"gap-y-px p-2 border bg-surface-primary rounded",children:topUrlsLoading?(0,jsx_runtime.jsx)(src.yW,{className:"h-10",repeat:10}):noPageviews?(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:"No pageview events have been received yet. Once you have some data, you'll see the most viewed pages here."}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:topUrls?.map(_ref=>{let{url}=_ref;return jsx_runtime.jsx(src.Jp,{fullWidth:!0,onClick:()=>setBrowserUrl(url),children:url},url)})})})]})})}function ForbiddenURL(){let logic=heatmapsBrowserLogic(),{browserUrl}=(0,index_esm.useValues)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex-1 p-4 gap-y-4",children:[(0,jsx_runtime.jsxs)(src.Vp,{type:"error",children:[browserUrl," is not an authorized URL. Please add it to the list of authorized URLs to view heatmaps on this page."]}),(0,jsx_runtime.jsx)("h2",{children:"Authorized Toolbar URLs"}),(0,jsx_runtime.jsx)(AuthorizedUrlList.t,{type:authorizedUrlListLogic.uw.TOOLBAR_URLS})]})}function InvalidURL(){return(0,jsx_runtime.jsx)("div",{className:"flex-1 p-4 gap-y-4",children:(0,jsx_runtime.jsx)(src.Vp,{type:"error",children:"Not a valid URL. Can't load a heatmap for that \uD83D\uDE30"})})}function IframeErrorOverlay(){let logic=heatmapsBrowserLogic(),{iframeBanner}=(0,index_esm.useValues)(logic);return iframeBanner?(0,jsx_runtime.jsx)("div",{className:"absolute mt-10 flex flex-col w-full h-full bg-blend-overlay items-start py-4 px-8 pointer-events-none",children:(0,jsx_runtime.jsxs)(src.Vp,{className:"w-full",type:iframeBanner.level,children:[iframeBanner.message,'. Your site might not allow being embedded in an iframe. You can click "Open in toolbar" above to visit your site and view the heatmap there.']})}):null}function LoadingOverlay(){return(0,jsx_runtime.jsx)("div",{className:"absolute flex flex-col w-full h-full items-center justify-center pointer-events-none",children:(0,jsx_runtime.jsx)(src.$j,{className:"text-5xl",textColored:!0})})}function ViewportChooser(){let logic=heatmapsBrowserLogic(),{widthOverride}=(0,index_esm.useValues)(logic),{setIframeWidth}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsx)("div",{className:"flex justify-center mb-2",children:(0,jsx_runtime.jsx)(src.P4,{onChange:setIframeWidth,value:widthOverride||void 0,"data-attr":"viewport-chooser",options:[{value:320,label:(0,jsx_runtime.jsxs)("div",{className:"px-1",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconPhone,{}),(0,jsx_runtime.jsx)("div",{className:"text-xs",children:"320px"})]})},{value:375,label:(0,jsx_runtime.jsxs)("div",{className:"px-1",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconPhone,{}),(0,jsx_runtime.jsx)("div",{className:"text-xs",children:"375px"})]})},{value:425,label:(0,jsx_runtime.jsxs)("div",{className:"px-1",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconPhone,{}),(0,jsx_runtime.jsx)("div",{className:"text-xs",children:"425px"})]})},{value:768,label:(0,jsx_runtime.jsxs)("div",{className:"px-1",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconTabletPortrait,{}),(0,jsx_runtime.jsx)("div",{className:"text-xs",children:"768px"})]})},{value:1024,label:(0,jsx_runtime.jsxs)("div",{className:"px-1",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconTabletLandscape,{}),(0,jsx_runtime.jsx)("div",{className:"text-xs",children:"1024px"})]})},{value:1440,label:(0,jsx_runtime.jsxs)("div",{className:"px-1",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconLaptop,{}),(0,jsx_runtime.jsx)("div",{className:"text-xs",children:"1440px"})]})},{value:1920,label:(0,jsx_runtime.jsxs)("div",{className:"px-1",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconLaptop,{}),(0,jsx_runtime.jsx)("div",{className:"text-xs",children:"1920px"})]})}],size:"small"})})}function EmbeddedHeatmapBrowser(_ref2){let{iframeRef}=_ref2,logic=heatmapsBrowserLogic(),{browserUrl,loading,iframeBanner,heatmapFilters,heatmapColorPalette,heatmapFixedPositionMode,viewportRange,commonFilters,filterPanelCollapsed,heatmapEmpty,widthOverride}=(0,index_esm.useValues)(logic),{onIframeLoad,setIframeWidth,patchHeatmapFilters,setHeatmapColorPalette,setHeatmapFixedPositionMode,setCommonFilters,toggleFilterPanelCollapsed}=(0,index_esm.useActions)(logic),{setHtml}=(0,index_esm.useActions)((0,takeScreenshotLogic.Oe)({screenshotKey:"heatmaps"})),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{width:iframeWidth}=(0,useResizeObserver.y)({ref:iframeRef});return(0,react.useEffect)(()=>{null===widthOverride&&setIframeWidth(null!=iframeWidth?iframeWidth:null)},[iframeWidth,setIframeWidth,widthOverride]),browserUrl?(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-x-2 w-full",children:[(0,jsx_runtime.jsx)(FilterPanel,{heatmapFilters,heatmapColorPalette,heatmapFixedPositionMode,viewportRange,commonFilters,filterPanelCollapsed,loading,patchHeatmapFilters,setHeatmapColorPalette,setHeatmapFixedPositionMode,setCommonFilters,toggleFilterPanelCollapsed,isEmpty:heatmapEmpty}),(0,jsx_runtime.jsxs)("div",{className:"relative flex-1 w-full h-full mt-2",children:[loading?(0,jsx_runtime.jsx)(LoadingOverlay,{}):null,!loading&&iframeBanner?(0,jsx_runtime.jsx)(IframeErrorOverlay,{}):null,featureFlags[constants.y8.SCREENSHOT_EDITOR]?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ScreenShotEditor.o,{screenshotKey:"heatmaps"}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)(ViewportChooser,{}),(0,jsx_runtime.jsx)(src.Jp,{className:"mb-2 mr-2",type:"secondary",onClick:()=>{let iframe=iframeRef?.current;if(!iframe){src.UJ.error("Cannot take screenshot. Please try again.");return}setHtml(iframe)},icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconLlmPromptEvaluation,{}),children:"Take screenshot"})]})]}):(0,jsx_runtime.jsx)(ViewportChooser,{}),(0,jsx_runtime.jsx)("div",{className:"flex relative justify-center h-full border-l border-t",children:(0,jsx_runtime.jsx)("iframe",{id:"heatmap-iframe",ref:iframeRef,className:"h-full bg-white",style:{width:null!=widthOverride?widthOverride:"100%"},src:(0,authorizedUrlListLogic.Kc)(browserUrl,{userIntent:"heatmaps"}),onLoad:onIframeLoad,sandbox:"allow-scripts allow-same-origin",allow:""})})]})]}):null}function Warnings(){let{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),heatmapsEnabled=currentTeam?.heatmaps_opt_in,{openSettingsPanel}=(0,index_esm.useActions)(sidePanelSettingsLogic.A);return heatmapsEnabled?null:(0,jsx_runtime.jsx)(src.Vp,{type:"warning",action:{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>openSettingsPanel({sectionId:"environment-autocapture",settingId:"heatmaps"}),children:"Configure"},dismissKey:"heatmaps-might-be-disabled-warning",children:"You aren't collecting heatmaps data. Enable heatmaps in your project."})}function ReplayIframeDataIntro(){let{hasValidReplayIframeData}=(0,index_esm.useValues)(heatmapsBrowserLogic);return hasValidReplayIframeData?(0,jsx_runtime.jsx)(src.Vp,{type:"info",dismissKey:"heatmaps-replay-iframe-data-intro",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,jsx_runtime.jsx)(hedgehogs.FilmCameraHog,{className:"w-30 h-30"}),(0,jsx_runtime.jsxs)("div",{children:["You're using session recording data as the background for this heatmap."," ",(0,jsx_runtime.jsx)("p",{children:"You can change the URL that the heatmap data loads below, for example to add wildcards."}),"And use the filters below to slice and dice the data."]})]})}):null}function HeatmapsBrowser(){let iframeRef=(0,react.useRef)(null),logic=heatmapsBrowserLogic({iframeRef}),{browserUrl,isBrowserUrlAuthorized,hasValidReplayIframeData,isBrowserUrlValid}=(0,index_esm.useValues)(logic);return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:heatmapsBrowserLogic,props:{ref:iframeRef},children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(Warnings,{}),(0,jsx_runtime.jsx)(ReplayIframeDataIntro,{}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col overflow-hidden w-full h-[90vh] rounded border",children:[(0,jsx_runtime.jsx)(UrlSearchHeader,{}),(0,jsx_runtime.jsx)("div",{className:"relative flex flex-1 overflow-hidden",children:hasValidReplayIframeData?(0,jsx_runtime.jsx)(FixedReplayHeatmapBrowser,{iframeRef:iframeRef}):browserUrl?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:isBrowserUrlAuthorized?isBrowserUrlValid?(0,jsx_runtime.jsx)(EmbeddedHeatmapBrowser,{iframeRef:iframeRef}):(0,jsx_runtime.jsx)(InvalidURL,{}):(0,jsx_runtime.jsx)(ForbiddenURL,{})}):(0,jsx_runtime.jsx)(HeatmapsBrowserIntro,{})})]})]})})}let scene={component:HeatmapsScene,logic:(0,index_esm.kea)([(0,index_esm.path)(["scenes","heatmaps","heatmapsSceneLogic"])])};function HeatmapsScene(){return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(HeatmapsBrowser,{})})}},"../../node_modules/.pnpm/heatmap.js@2.0.5_patch_hash=gydrxrztd4ruyhouu6tu7zh43e/node_modules/heatmap.js/build/heatmap.js":function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__,factory;factory=function(){var Store,defaultRadius,rendererFn,HeatmapConfig={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},Store1=(Store=function Store(config){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=config.xField||config.defaultXField,this._yField=config.yField||config.defaultYField,this._valueField=config.valueField||config.defaultValueField,config.radius&&(this._cfgRadius=config.radius)},defaultRadius=HeatmapConfig.defaultRadius,Store.prototype={_organiseData:function(dataPoint,forceRender){var x=dataPoint[this._xField],y=dataPoint[this._yField],radi=this._radi,store=this._data,max=this._max,min=this._min,value=dataPoint[this._valueField]||1,radius=dataPoint.radius||this._cfgRadius||defaultRadius;store[x]||(store[x]=[],radi[x]=[]),store[x][y]?store[x][y]+=value:(store[x][y]=value,radi[x][y]=radius);var storedVal=store[x][y];return storedVal>max?(forceRender?this.setDataMax(storedVal):this._max=storedVal,!1):storedVal<min?(forceRender?this.setDataMin(storedVal):this._min=storedVal,!1):{x:x,y:y,value:value,radius:radius,min:min,max:max}},_unOrganizeData:function(){var unorganizedData=[],data=this._data,radi=this._radi;for(var x in data)for(var y in data[x])unorganizedData.push({x:x,y:y,radius:radi[x][y],value:data[x][y]});return{min:this._min,max:this._max,data:unorganizedData}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var dataArr=arguments[0],dataLen=dataArr.length;dataLen--;)this.addData.call(this,dataArr[dataLen]);else{var organisedEntry=this._organiseData(arguments[0],!0);organisedEntry&&(0===this._data.length&&(this._min=this._max=organisedEntry.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[organisedEntry]}))}return this},setData:function(data){var dataPoints=data.data,pointsLen=dataPoints.length;this._data=[],this._radi=[];for(var i=0;i<pointsLen;i++)this._organiseData(dataPoints[i],!1);return this._max=data.max,this._min=data.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(max){return this._max=max,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(min){return this._min=min,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(coordinator){this._coordinator=coordinator},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},Store),Canvas2dRenderer=function Canvas2dRendererClosure(){var _getColorPalette=function(config){var gradientConfig=config.gradient||config.defaultGradient,paletteCanvas=document.createElement("canvas"),paletteCtx=paletteCanvas.getContext("2d");paletteCanvas.width=256,paletteCanvas.height=1;var gradient=paletteCtx.createLinearGradient(0,0,256,1);for(var key in gradientConfig)gradient.addColorStop(key,gradientConfig[key]);return paletteCtx.fillStyle=gradient,paletteCtx.fillRect(0,0,256,1),paletteCtx.getImageData(0,0,256,1).data},_getPointTemplate=function(radius,blurFactor){var tplCanvas=document.createElement("canvas"),tplCtx=tplCanvas.getContext("2d");if(tplCanvas.width=tplCanvas.height=2*radius,1==blurFactor)tplCtx.beginPath(),tplCtx.arc(radius,radius,radius,0,2*Math.PI,!1),tplCtx.fillStyle="rgba(0,0,0,1)",tplCtx.fill();else{var gradient=tplCtx.createRadialGradient(radius,radius,radius*blurFactor,radius,radius,radius);gradient.addColorStop(0,"rgba(0,0,0,1)"),gradient.addColorStop(1,"rgba(0,0,0,0)"),tplCtx.fillStyle=gradient,tplCtx.fillRect(0,0,2*radius,2*radius)}return tplCanvas},_prepareData=function(data){for(var renderData=[],min=data.min,max=data.max,radi=data.radi,data=data.data,xValues=Object.keys(data),xValuesLen=xValues.length;xValuesLen--;)for(var xValue=xValues[xValuesLen],yValues=Object.keys(data[xValue]),yValuesLen=yValues.length;yValuesLen--;){var yValue=yValues[yValuesLen],value=data[xValue][yValue],radius=radi[xValue][yValue];renderData.push({x:xValue,y:yValue,value:value,radius:radius})}return{min:min,max:max,data:renderData}};function Canvas2dRenderer(config){var container=config.container,shadowCanvas=this.shadowCanvas=document.createElement("canvas"),canvas=this.canvas=config.canvas||document.createElement("canvas");this._renderBoundaries=[1e4,1e4,0,0];var computed=getComputedStyle(config.container)||{};canvas.className="heatmap-canvas",this._width=canvas.width=shadowCanvas.width=config.width||+computed.width.replace(/px/,""),this._height=canvas.height=shadowCanvas.height=config.height||+computed.height.replace(/px/,""),this.shadowCtx=shadowCanvas.getContext("2d"),this.ctx=canvas.getContext("2d"),canvas.style.cssText=shadowCanvas.style.cssText="position:absolute;left:0;top:0;",container.style.position="relative",container.appendChild(canvas),this._palette=_getColorPalette(config),this._templates={},this._setStyles(config)}return Canvas2dRenderer.prototype={renderPartial:function(data){data.data.length>0&&(this._drawAlpha(data),this._colorize())},renderAll:function(data){this._clear(),data.data.length>0&&(this._drawAlpha(_prepareData(data)),this._colorize())},_updateGradient:function(config){this._palette=_getColorPalette(config)},updateConfig:function(config){config.gradient&&this._updateGradient(config),this._setStyles(config)},setDimensions:function(width,height){this._width=width,this._height=height,this.canvas.width=this.shadowCanvas.width=width,this.canvas.height=this.shadowCanvas.height=height},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(config){this._blur=0==config.blur?0:config.blur||config.defaultBlur,config.backgroundColor&&(this.canvas.style.backgroundColor=config.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=config.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=config.height||this._height,this._opacity=255*(config.opacity||0),this._maxOpacity=255*(config.maxOpacity||config.defaultMaxOpacity),this._minOpacity=255*(config.minOpacity||config.defaultMinOpacity),this._useGradientOpacity=!!config.useGradientOpacity},_drawAlpha:function(data){for(var min=this._min=data.min,max=this._max=data.max,data=data.data||[],dataLen=data.length,blur=1-this._blur;dataLen--;){var tpl,point=data[dataLen],x=point.x,y=point.y,radius=point.radius,value=Math.min(point.value,max),rectX=x-radius,rectY=y-radius,shadowCtx=this.shadowCtx;this._templates[radius]?tpl=this._templates[radius]:this._templates[radius]=tpl=_getPointTemplate(radius,blur);var templateAlpha=(value-min)/(max-min);shadowCtx.globalAlpha=templateAlpha<.01?.01:templateAlpha,shadowCtx.drawImage(tpl,rectX,rectY),rectX<this._renderBoundaries[0]&&(this._renderBoundaries[0]=rectX),rectY<this._renderBoundaries[1]&&(this._renderBoundaries[1]=rectY),rectX+2*radius>this._renderBoundaries[2]&&(this._renderBoundaries[2]=rectX+2*radius),rectY+2*radius>this._renderBoundaries[3]&&(this._renderBoundaries[3]=rectY+2*radius)}},_colorize:function(){var x=this._renderBoundaries[0],y=this._renderBoundaries[1],width=this._renderBoundaries[2]-x,height=this._renderBoundaries[3]-y,maxWidth=this._width,maxHeight=this._height,opacity=this._opacity,maxOpacity=this._maxOpacity,minOpacity=this._minOpacity,useGradientOpacity=this._useGradientOpacity;x<0&&(x=0),y<0&&(y=0),x+width>maxWidth&&(width=maxWidth-x),y+height>maxHeight&&(height=maxHeight-y);for(var img=this.shadowCtx.getImageData(x,y,width,height),imgData=img.data,len=imgData.length,palette=this._palette,i=3;i<len;i+=4){var finalAlpha,alpha=imgData[i],offset=4*alpha;offset&&(finalAlpha=opacity>0?opacity:alpha<maxOpacity?alpha<minOpacity?minOpacity:alpha:maxOpacity,imgData[i-3]=palette[offset],imgData[i-2]=palette[offset+1],imgData[i-1]=palette[offset+2],imgData[i]=useGradientOpacity?palette[offset+3]:finalAlpha)}this.ctx.putImageData(img,x,y),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(point){return this.shadowCtx.getImageData(point.x,point.y,1,1).data[3]/255*Math.abs(this._max-this._min)>>0},getDataURL:function(){return this.canvas.toDataURL()}},Canvas2dRenderer}(),Renderer=(rendererFn=!1,"canvas2d"===HeatmapConfig.defaultRenderer&&(rendererFn=Canvas2dRenderer),rendererFn),Util_merge=function(){for(var merged={},argsLen=arguments.length,i=0;i<argsLen;i++){var obj=arguments[i];for(var key in obj)merged[key]=obj[key]}return merged},Heatmap=function HeatmapClosure(){var Coordinator=function CoordinatorClosure(){function Coordinator(){this.cStore={}}return Coordinator.prototype={on:function(evtName,callback,scope){var cStore=this.cStore;cStore[evtName]||(cStore[evtName]=[]),cStore[evtName].push(function(data){return callback.call(scope,data)})},emit:function(evtName,data){var cStore=this.cStore;if(cStore[evtName])for(var len=cStore[evtName].length,i=0;i<len;i++)(0,cStore[evtName][i])(data)}},Coordinator}(),_connect=function(scope){var renderer=scope._renderer,coordinator=scope._coordinator,store=scope._store;coordinator.on("renderpartial",renderer.renderPartial,renderer),coordinator.on("renderall",renderer.renderAll,renderer),coordinator.on("extremachange",function(data){scope._config.onExtremaChange&&scope._config.onExtremaChange({min:data.min,max:data.max,gradient:scope._config.gradient||scope._config.defaultGradient})}),store.setCoordinator(coordinator)};function Heatmap(){var config=this._config=Util_merge(HeatmapConfig,arguments[0]||{});if(this._coordinator=new Coordinator,config.plugin){var pluginToLoad=config.plugin;if(HeatmapConfig.plugins[pluginToLoad]){var plugin=HeatmapConfig.plugins[pluginToLoad];this._renderer=new plugin.renderer(config),this._store=new plugin.store(config)}else throw Error("Plugin '"+pluginToLoad+"' not found. Maybe it was not registered.")}else this._renderer=new Renderer(config),this._store=new Store1(config);_connect(this)}return Heatmap.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(config){return this._config=Util_merge(this._config,config),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(point){return this._store.getValueAt?this._store.getValueAt(point):this._renderer.getValueAt?this._renderer.getValueAt(point):null}},Heatmap}();return{create:function(config){return new Heatmap(config)},register:function(pluginKey,plugin){HeatmapConfig.plugins[pluginKey]=plugin}}},module.exports?module.exports=factory():void 0===(__WEBPACK_AMD_DEFINE_RESULT__=factory.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}}]);
//# sourceMappingURL=10999.c069dc1d.iframe.bundle.js.map