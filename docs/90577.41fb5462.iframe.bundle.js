"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[90577],{"../../frontend/src/lib/components/CyclotronJob/CyclotronJobInputs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>CyclotronJobInputs});var core_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@dnd-kit/core/dist/core.esm.js"),sortable_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+sortable@7.0.2_@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0__react@18.2.0/node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),utilities_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+utilities@3.2.1_react@18.2.0/node_modules/@dnd-kit/utilities/dist/utilities.esm.js"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.33.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonMarkdown=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMarkdown/LemonMarkdown.tsx"),CodeEditorInline=__webpack_require__("../../frontend/src/lib/monaco/CodeEditorInline.tsx"),CodeEditorResizable=__webpack_require__("../../frontend/src/lib/monaco/CodeEditorResizable.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),copyToClipboard=__webpack_require__("../../frontend/src/lib/utils/copyToClipboard.tsx"),EmailTemplater=__webpack_require__("../../frontend/src/scenes/hog-functions/email-templater/EmailTemplater.tsx"),CyclotronJobTemplateSuggestions=__webpack_require__("../../frontend/src/lib/components/CyclotronJob/CyclotronJobTemplateSuggestions.tsx");function formatJsonValue(value){return null==value?"{}":"string"!=typeof value?JSON.stringify(value,null,2):value}let cyclotronJobInputLogic=(0,index_esm.kea)({path:["lib","components","CyclotronJob","cyclotronJobInputLogic"],props:{},key:props=>`json_validation_${props.fieldKey}`,actions:{setJsonValue:value=>({value}),validateJson:value=>({value}),setError:error=>({error})},reducers:{jsonValue:["",{setJsonValue:(_state,_ref)=>{let{value}=_ref;return value}}],error:[null,{setError:(_state,_ref2)=>{let{error}=_ref2;return error}}]},selectors:{hasError:[s=>[s.error],error=>!!error]},listeners:_ref3=>{let{actions,props}=_ref3;return{setJsonValue:async(_ref4,breakpoint)=>{let{value}=_ref4;if(!value||""===value.trim()){actions.setError(null);return}props.onChange?.(value),await breakpoint(600);try{JSON.parse(value),actions.setError(null)}catch(e){let errorMessage=e.message||"Invalid JSON";errorMessage.includes("'u'")&&value.includes("undefined")&&(errorMessage="Error: 'undefined' is not allowed in JSON. Use null instead."),actions.setError(errorMessage)}}}},propsChanged(_ref5){let{actions,props}=_ref5;void 0!==props.initialValue&&actions.setJsonValue(formatJsonValue(props.initialValue))}});var IntegrationChoice=__webpack_require__("../../frontend/src/lib/components/CyclotronJob/integrations/IntegrationChoice.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function CyclotronJobInputIntegration(_ref){let{schema,persistForUnload,...props}=_ref;return(0,jsx_runtime.jsx)(IntegrationChoice.a,{...props,schema:schema,integration:schema.integration,redirectUrl:`${window.location.pathname}?integration_target=${schema.key}`,beforeRedirect:()=>persistForUnload?.()})}var lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let clickupIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","clickupIntegrationLogic",key]),(0,index_esm.actions)({loadClickUpLists:spaceId=>({spaceId}),loadClickUpSpaces:workspaceId=>({workspaceId}),loadClickUpWorkspaces:!0}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{clickUpSpaces:[null,{loadClickUpSpaces:async _ref2=>{let{workspaceId}=_ref2;return(await api.ZP.integrations.clickUpSpaces(props.id,workspaceId)).spaces}}],clickUpLists:[null,{loadClickUpLists:async _ref3=>{let{spaceId}=_ref3;return(await api.ZP.integrations.clickUpLists(props.id,spaceId)).lists}}],clickUpWorkspaces:[null,{loadClickUpWorkspaces:async()=>(await api.ZP.integrations.clickUpWorkspaces(props.id)).workspaces}]}})]),getClickUpSpaceOptions=clickUpSpaces=>clickUpSpaces?clickUpSpaces.map(space=>({key:space.id,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[space.name," (",space.id,")"]}),label:`${space.name} (${space.id})`})):null,getClickUpWorkspaceOptions=clickUpWorkspaces=>clickUpWorkspaces?clickUpWorkspaces.map(workspace=>({key:workspace.id,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[workspace.name," (",workspace.id,")"]}),label:`${workspace.name} (${workspace.id})`})):null,getClickUpListOptions=clickUpLists=>clickUpLists?clickUpLists.map(_ref=>{let{id,name}=_ref;return{key:id,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[name," (",id,")"]}),label:`${name} (${id})`}}):null;function ClickUpSpacePicker(_ref2){let{onChange,value,requiresFieldValue,integration,disabled}=_ref2,{clickUpSpaces,clickUpSpacesLoading}=(0,index_esm.useValues)(clickupIntegrationLogic({id:integration.id})),{loadClickUpSpaces}=(0,index_esm.useActions)(clickupIntegrationLogic({id:integration.id})),clickUpSpaceOptions=(0,react.useMemo)(()=>getClickUpSpaceOptions(clickUpSpaces),[clickUpSpaces]);return(0,react.useEffect)(()=>{!disabled&&requiresFieldValue&&loadClickUpSpaces(requiresFieldValue.split("/")[0])},[loadClickUpSpaces,requiresFieldValue,disabled]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!clickUpSpaces&&!clickUpSpacesLoading&&requiresFieldValue&&loadClickUpSpaces(requiresFieldValue.split("/")[0]),disabled:disabled,mode:"single","data-attr":"select-click-up-space",placeholder:"Select a Space...",options:null!=clickUpSpaceOptions?clickUpSpaceOptions:value?[{key:value,label:value}]:[],loading:clickUpSpacesLoading})})}function ClickUpWorkspacePicker(_ref3){let{onChange,value,integration,disabled}=_ref3,{clickUpWorkspaces,clickUpWorkspacesLoading}=(0,index_esm.useValues)(clickupIntegrationLogic({id:integration.id})),{loadClickUpWorkspaces}=(0,index_esm.useActions)(clickupIntegrationLogic({id:integration.id})),clickUpWorkspaceOptions=(0,react.useMemo)(()=>getClickUpWorkspaceOptions(clickUpWorkspaces),[clickUpWorkspaces]);return(0,react.useEffect)(()=>{loadClickUpWorkspaces()},[loadClickUpWorkspaces]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$2;return onChange?.(null!==(_val$2=val[0])&&void 0!==_val$2?_val$2:null)},value:value?[value]:[],onFocus:()=>!clickUpWorkspaces&&!clickUpWorkspacesLoading&&loadClickUpWorkspaces(),disabled:disabled,mode:"single","data-attr":"select-click-up-workspace",placeholder:"Select a Workspace...",options:null!=clickUpWorkspaceOptions?clickUpWorkspaceOptions:value?[{key:value,label:value}]:[],loading:clickUpWorkspacesLoading})})}function ClickUpListPicker(_ref4){let{onChange,value,requiresFieldValue,integration,disabled}=_ref4,{clickUpLists,clickUpListsLoading}=(0,index_esm.useValues)(clickupIntegrationLogic({id:integration.id})),{loadClickUpLists}=(0,index_esm.useActions)(clickupIntegrationLogic({id:integration.id})),clickUpListOptions=(0,react.useMemo)(()=>getClickUpListOptions(clickUpLists),[clickUpLists]);return(0,react.useEffect)(()=>{!disabled&&requiresFieldValue&&loadClickUpLists(requiresFieldValue.split("/")[0])},[loadClickUpLists,disabled,requiresFieldValue]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$3;return onChange?.(null!==(_val$3=val[0])&&void 0!==_val$3?_val$3:null)},value:value?[value]:[],onFocus:()=>!clickUpLists&&!clickUpListsLoading&&requiresFieldValue&&loadClickUpLists(requiresFieldValue.split("/")[0]),disabled:disabled,mode:"single","data-attr":"select-click-up-list",placeholder:"Select a List...",options:null!=clickUpListOptions?clickUpListOptions:value?[{key:value,label:value}]:[],loading:clickUpListsLoading})})}var GitHubIntegrationHelpers=__webpack_require__("../../frontend/src/lib/integrations/GitHubIntegrationHelpers.tsx");let googleAdsIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","googleAdsIntegrationLogic",key]),(0,index_esm.actions)({loadGoogleAdsConversionActions:(customerId,parentId)=>({customerId,parentId}),loadGoogleAdsAccessibleAccounts:!0}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{googleAdsConversionActions:[null,{loadGoogleAdsConversionActions:async _ref2=>{let{customerId,parentId}=_ref2;return(await api.ZP.integrations.googleAdsConversionActions(props.id,{customerId,parentId})).conversionActions}}],googleAdsAccessibleAccounts:[null,{loadGoogleAdsAccessibleAccounts:async()=>(await api.ZP.integrations.googleAdsAccounts(props.id)).accessibleAccounts}]}})]),getGoogleAdsAccountOptions=googleAdsAccounts=>googleAdsAccounts?googleAdsAccounts.map(customer=>({key:`${customer.id}/${customer.parent_id}`,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[customer.name," (",customer.id.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3"),")"]}),label:`${customer.name} (${customer.id.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")})`})):null,getGoogleAdsConversionActionOptions=googleAdsConversionActions=>googleAdsConversionActions?googleAdsConversionActions.map(_ref=>{let{id,name}=_ref;return{key:id,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[name," (",id,")"]}),label:`${name} (${id})`}}):null;function GoogleAdsConversionActionPicker(_ref2){let{onChange,value,requiresFieldValue,integration,disabled}=_ref2,{googleAdsConversionActions,googleAdsConversionActionsLoading}=(0,index_esm.useValues)(googleAdsIntegrationLogic({id:integration.id})),{loadGoogleAdsConversionActions}=(0,index_esm.useActions)(googleAdsIntegrationLogic({id:integration.id})),googleAdsConversionActionOptions=(0,react.useMemo)(()=>getGoogleAdsConversionActionOptions(googleAdsConversionActions),[googleAdsConversionActions]);return(0,react.useEffect)(()=>{requiresFieldValue&&loadGoogleAdsConversionActions(requiresFieldValue.split("/")[0],requiresFieldValue.split("/")[1])},[loadGoogleAdsConversionActions,requiresFieldValue]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!googleAdsConversionActions&&!googleAdsConversionActionsLoading&&requiresFieldValue&&loadGoogleAdsConversionActions(requiresFieldValue.split("/")[0],requiresFieldValue.split("/")[1]),disabled:disabled,mode:"single","data-attr":"select-google-ads-conversion-action",placeholder:"Select a Conversion Action...",options:null!=googleAdsConversionActionOptions?googleAdsConversionActionOptions:value?[{key:value,label:value}]:[],loading:googleAdsConversionActionsLoading})})}function GoogleAdsCustomerIdPicker(_ref3){let{onChange,value,integration,disabled}=_ref3,{googleAdsAccessibleAccounts,googleAdsAccessibleAccountsLoading}=(0,index_esm.useValues)(googleAdsIntegrationLogic({id:integration.id})),{loadGoogleAdsAccessibleAccounts}=(0,index_esm.useActions)(googleAdsIntegrationLogic({id:integration.id})),googleAdsAccountOptions=(0,react.useMemo)(()=>getGoogleAdsAccountOptions(googleAdsAccessibleAccounts),[googleAdsAccessibleAccounts]);return(0,react.useEffect)(()=>{disabled||loadGoogleAdsAccessibleAccounts()},[loadGoogleAdsAccessibleAccounts,disabled]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$2;return onChange?.(null!==(_val$2=val[0])&&void 0!==_val$2?_val$2:null)},value:value?[value]:[],onFocus:()=>!googleAdsAccessibleAccounts&&!googleAdsAccessibleAccountsLoading&&loadGoogleAdsAccessibleAccounts(),disabled:disabled,mode:"single","data-attr":"select-google-ads-customer-id-channel",placeholder:"Select a Customer ID...",options:null!=googleAdsAccountOptions?googleAdsAccountOptions:value?[{key:value,label:value.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}]:[],loading:googleAdsAccessibleAccountsLoading})})}var LinearIntegrationHelpers=__webpack_require__("../../frontend/src/lib/integrations/LinearIntegrationHelpers.tsx"),useOnMountEffect=__webpack_require__("../../frontend/src/lib/hooks/useOnMountEffect.ts");let linkedInAdsIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","linkedInAdsIntegrationLogic",key]),(0,index_esm.actions)({loadLinkedInAdsConversionRules:accountId=>accountId,loadLinkedInAdsAccounts:!0}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{linkedInAdsConversionRules:[null,{loadLinkedInAdsConversionRules:async customerId=>(await api.ZP.integrations.linkedInAdsConversionRules(props.id,customerId)).conversionRules}],linkedInAdsAccounts:[null,{loadLinkedInAdsAccounts:async()=>(await api.ZP.integrations.linkedInAdsAccounts(props.id)).adAccounts}]}})]),getLinkedInAdsAccountOptions=linkedInAdsAccounts=>linkedInAdsAccounts?linkedInAdsAccounts.map(account=>({key:account.id.toString(),labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[account.name," (",account.id.toString(),")"]}),label:`${account.name}`})):null,getLinkedInAdsConversionRuleOptions=linkedInAdsConversionRules=>linkedInAdsConversionRules?linkedInAdsConversionRules.map(_ref=>{let{id,name}=_ref;return{key:id.toString(),labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[name," (",id,")"]}),label:`${name} (${id})`}}):null;function LinkedInAdsConversionRulePicker(_ref2){let{onChange,value,requiresFieldValue,integration,disabled}=_ref2,{linkedInAdsConversionRules,linkedInAdsConversionRulesLoading}=(0,index_esm.useValues)(linkedInAdsIntegrationLogic({id:integration.id})),{loadLinkedInAdsConversionRules}=(0,index_esm.useActions)(linkedInAdsIntegrationLogic({id:integration.id})),linkedInAdsConversionRuleOptions=(0,react.useMemo)(()=>getLinkedInAdsConversionRuleOptions(linkedInAdsConversionRules),[linkedInAdsConversionRules]);return(0,react.useEffect)(()=>{requiresFieldValue&&loadLinkedInAdsConversionRules(requiresFieldValue)},[loadLinkedInAdsConversionRules,requiresFieldValue]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!linkedInAdsConversionRules&&!linkedInAdsConversionRulesLoading&&requiresFieldValue&&loadLinkedInAdsConversionRules(requiresFieldValue),disabled:disabled,mode:"single","data-attr":"select-linkedin-ads-conversion-action",placeholder:"Select a Conversion Action...",options:null!=linkedInAdsConversionRuleOptions?linkedInAdsConversionRuleOptions:value?[{key:value,label:value}]:[],loading:linkedInAdsConversionRulesLoading})})}function LinkedInAdsAccountIdPicker(_ref3){let{onChange,value,integration,disabled}=_ref3,{linkedInAdsAccounts,linkedInAdsAccountsLoading}=(0,index_esm.useValues)(linkedInAdsIntegrationLogic({id:integration.id})),{loadLinkedInAdsAccounts}=(0,index_esm.useActions)(linkedInAdsIntegrationLogic({id:integration.id})),linkedInAdsAccountOptions=(0,react.useMemo)(()=>getLinkedInAdsAccountOptions(linkedInAdsAccounts),[linkedInAdsAccounts]);return(0,useOnMountEffect.x)(()=>{disabled||loadLinkedInAdsAccounts()}),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$2;return onChange?.(null!==(_val$2=val[0])&&void 0!==_val$2?_val$2:null)},value:value?[value]:[],onFocus:()=>!linkedInAdsAccounts&&!linkedInAdsAccountsLoading&&loadLinkedInAdsAccounts(),disabled:disabled,mode:"single","data-attr":"select-linkedin-ads-customer-id-channel",placeholder:"Select a Account ID...",options:null!=linkedInAdsAccountOptions?linkedInAdsAccountOptions:value?[{key:value,label:value.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}]:[],loading:linkedInAdsAccountsLoading})})}var SlackIntegrationHelpers=__webpack_require__("../../frontend/src/lib/integrations/SlackIntegrationHelpers.tsx"),usePeriodicRerender=__webpack_require__("../../frontend/src/lib/hooks/usePeriodicRerender.ts"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx");let twilioIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","twilioIntegrationLogic",key]),(0,index_esm.connect)(()=>({values:[preflightLogic.preflightLogic,["siteUrlMisconfigured","preflight"]]})),(0,index_esm.actions)({loadAllTwilioPhoneNumbers:function(){let forceRefresh=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{forceRefresh}}}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{allTwilioPhoneNumbers:[null,{loadAllTwilioPhoneNumbers:async _ref2=>{let{forceRefresh}=_ref2;return await api.ZP.integrations.twilioPhoneNumbers(props.id,forceRefresh)}}]}}),(0,index_esm.selectors)({twilioPhoneNumbers:[s=>[s.allTwilioPhoneNumbers],allTwilioPhoneNumbers=>{var _allTwilioPhoneNumber;return null!==(_allTwilioPhoneNumber=allTwilioPhoneNumbers?.phone_numbers)&&void 0!==_allTwilioPhoneNumber?_allTwilioPhoneNumber:[]}],getPhoneNumberRefreshButtonDisabledReason:[s=>[s.allTwilioPhoneNumbers],allTwilioPhoneNumbers=>()=>{let now=(0,dayjs.Bv)();if(allTwilioPhoneNumbers){let earliestRefresh=(0,dayjs.Bv)(allTwilioPhoneNumbers.lastRefreshedAt).add(5,"minutes");if(now.isBefore(earliestRefresh))return`You can refresh the phone numbers again ${earliestRefresh.from(now)}`}return""}]})]),getTwilioPhoneNumberOptions=twilioPhoneNumbers=>twilioPhoneNumbers?twilioPhoneNumbers.map(x=>{let displayLabel=`${x.friendly_name} (${x.sid})`;return{key:x.phone_number,labelComponent:(0,jsx_runtime.jsx)("span",{className:"flex items-center",children:(0,jsx_runtime.jsx)("span",{children:displayLabel})}),label:displayLabel}}):null;function TwilioPhoneNumberPicker(_ref){let{onChange,value,integration,disabled}=_ref,{twilioPhoneNumbers,allTwilioPhoneNumbersLoading,getPhoneNumberRefreshButtonDisabledReason}=(0,index_esm.useValues)(twilioIntegrationLogic({id:integration.id})),{loadAllTwilioPhoneNumbers}=(0,index_esm.useActions)(twilioIntegrationLogic({id:integration.id}));(0,usePeriodicRerender.o)(15e3);let twilioPhoneNumberOptions=(0,react.useMemo)(()=>getTwilioPhoneNumberOptions(twilioPhoneNumbers),[twilioPhoneNumbers]),modifiedValue=(0,react.useMemo)(()=>{let phoneNumber=twilioPhoneNumbers.find(x=>x.phone_number===value);return phoneNumber?`${phoneNumber.friendly_name} (${phoneNumber.sid})`:value},[value,twilioPhoneNumbers]);return(0,react.useEffect)(()=>{disabled||loadAllTwilioPhoneNumbers()},[loadAllTwilioPhoneNumbers,disabled]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!twilioPhoneNumbers.length&&!allTwilioPhoneNumbersLoading&&loadAllTwilioPhoneNumbers(),disabled:disabled,mode:"single","data-attr":"select-twilio-phone-number",placeholder:"Select a phone number...",action:{children:(0,jsx_runtime.jsx)("span",{className:"Link",children:"Refresh phone numbers"}),onClick:()=>loadAllTwilioPhoneNumbers(!0),disabledReason:getPhoneNumberRefreshButtonDisabledReason()},emptyStateComponent:(0,jsx_runtime.jsxs)("p",{className:"text-secondary italic p-1",children:["No phone numbers found. Make sure your Twilio account has phone numbers configured."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/cdp/destinations/twilio",target:"_blank",children:"See the docs for more information."})]}),options:null!=twilioPhoneNumberOptions?twilioPhoneNumberOptions:modifiedValue?[{key:null!=value?value:modifiedValue,label:modifiedValue}]:[],loading:allTwilioPhoneNumbersLoading})})}var integrationsLogic=__webpack_require__("../../frontend/src/lib/integrations/integrationsLogic.ts");function CyclotronJobInputIntegrationField(_ref){var _configuration$inputs,_parentConfiguration$;let requiresFieldValue;let{schema,value,onChange,configuration,parentConfiguration}=_ref,combinedInputs={...configuration?.inputs,...parentConfiguration?.inputs},combinedInputsSchema=[...null!==(_configuration$inputs=configuration?.inputs_schema)&&void 0!==_configuration$inputs?_configuration$inputs:[],...null!==(_parentConfiguration$=parentConfiguration?.inputs_schema)&&void 0!==_parentConfiguration$?_parentConfiguration$:[]],{integrationsLoading,integrations}=(0,index_esm.useValues)(integrationsLogic.a);if(integrationsLoading)return(0,jsx_runtime.jsx)(src.yW,{className:"h-10"});let relatedSchemaIntegration=combinedInputsSchema.find(input=>input.key===schema.integration_key);if(!relatedSchemaIntegration)return(0,jsx_runtime.jsxs)("div",{className:"text-danger",children:["Bad configuration: integration key ",schema.integration_key," not found in schema"]});let integrationId=combinedInputs[relatedSchemaIntegration.key]?.value,integration=integrations?.find(integration=>integration.id===integrationId);if(schema.requires_field){let requiresFieldSchema=combinedInputsSchema.find(input=>input.key===schema.requires_field);if(!requiresFieldSchema)return(0,jsx_runtime.jsxs)("div",{className:"text-danger",children:["Bad configuration: required key ",schema.requires_field," not found in schema"]});let requiresField=combinedInputs?.[requiresFieldSchema.key];if(!(requiresFieldValue=requiresField?.value))return(0,jsx_runtime.jsxs)("div",{className:"p-2 h-10 italic rounded border border-dashed text-secondary",children:["Configure ",requiresFieldSchema.label," to continue"]})}return integration?"slack_channel"===schema.integration_field?(0,jsx_runtime.jsx)(SlackIntegrationHelpers.a,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"google_ads_conversion_action"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(GoogleAdsConversionActionPicker,{value:value,requiresFieldValue:requiresFieldValue,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"google_ads_customer_id"===schema.integration_field?(0,jsx_runtime.jsx)(GoogleAdsCustomerIdPicker,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"linkedin_ads_conversion_rule_id"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(LinkedInAdsConversionRulePicker,{value:value,requiresFieldValue:requiresFieldValue,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"linkedin_ads_account_id"===schema.integration_field?(0,jsx_runtime.jsx)(LinkedInAdsAccountIdPicker,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"linear_team"===schema.integration_field?(0,jsx_runtime.jsx)(LinearIntegrationHelpers.Ul,{value:value,onChange:x=>onChange?.(x),integration:integration}):"github_repository"===schema.integration_field?(0,jsx_runtime.jsx)(GitHubIntegrationHelpers.so,{value:value,onChange:x=>onChange?.(x),integrationId:integration.id}):"twilio_phone_number"===schema.integration_field?(0,jsx_runtime.jsx)(TwilioPhoneNumberPicker,{value:value,onChange:x=>onChange?.(x),integration:integration}):"clickup_space_id"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(ClickUpSpacePicker,{value:value,onChange:x=>onChange?.(x),integration:integration,requiresFieldValue:requiresFieldValue}):"clickup_list_id"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(ClickUpListPicker,{value:value,onChange:x=>onChange?.(x),integration:integration,requiresFieldValue:requiresFieldValue}):"clickup_workspace_id"===schema.integration_field?(0,jsx_runtime.jsx)(ClickUpWorkspacePicker,{value:value,onChange:x=>onChange?.(x),integration:integration}):(0,jsx_runtime.jsx)("div",{className:"text-danger",children:(0,jsx_runtime.jsxs)("p",{children:["Unsupported integration type: ",schema.integration]})}):(0,jsx_runtime.jsxs)("div",{className:"p-2 h-10 italic rounded border border-dashed text-secondary",children:["Configure ",relatedSchemaIntegration.label," to continue"]})}let EXTEND_OBJECT_KEY="$$_extend_object",INPUT_TYPE_LIST=["string","number","boolean","dictionary","choice","json","integration","email","native_email"];function CyclotronJobInputs(_ref){let{configuration,parentConfiguration,onInputSchemaChange,onInputChange,errors,showSource,sampleGlobalsWithInputs}=_ref;if(!configuration.inputs_schema?.length)return(0,jsx_runtime.jsx)("span",{className:"italic text-secondary",children:"This function does not require any input variables."});let inputSchemas=configuration.inputs_schema,inputSchemaIds=inputSchemas.map(schema=>schema.key);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(core_esm.LB,{collisionDetection:core_esm.pE,onDragEnd:_ref2=>{let{active,over}=_ref2;if(over&&active.id!==over.id){let oldIndex=inputSchemaIds.indexOf(active.id),newIndex=inputSchemaIds.indexOf(over.id);onInputSchemaChange?.(sortable_esm.Rp(inputSchemas,oldIndex,newIndex))}},children:(0,jsx_runtime.jsx)(sortable_esm.Fo,{disabled:!showSource,items:inputSchemaIds,strategy:sortable_esm.qw,children:configuration.inputs_schema?.filter(i=>!i.hidden).map(schema=>jsx_runtime.jsx(CyclotronJobInputWithSchema,{schema:schema,configuration:configuration,parentConfiguration:parentConfiguration,onInputSchemaChange:onInputSchemaChange,onInputChange:onInputChange,showSource:showSource,sampleGlobalsWithInputs:sampleGlobalsWithInputs,errors:errors},schema.key))})})})}function JsonConfigField(props){var _props$input$templati,_props$sampleGlobalsW;let key=(0,react.useMemo)(()=>`json_field_${(0,utils.Vj)()}`,[]),templatingKind=null!==(_props$input$templati=props.input.templating)&&void 0!==_props$input$templati?_props$input$templati:"hog",logic=cyclotronJobInputLogic({fieldKey:key,initialValue:props.input.value,onChange:value=>props.onChange?.({...props.input,value})}),{error,jsonValue}=(0,index_esm.useValues)(logic),{setJsonValue}=(0,index_esm.useActions)(logic),formattedValue=(0,react.useMemo)(()=>formatJsonValue(props.input.value),[props.input.value]),panels=[{key:1,header:"Click to edit",content:(0,jsx_runtime.jsx)(LemonField.D.Pure,{error:error,children:(0,jsx_runtime.jsxs)("span",{className:(0,clsx_m.default)("group relative",props.className),children:[(0,jsx_runtime.jsx)(CodeEditorResizable.Y,{language:props.templating?"hog"===templatingKind?"hogJson":"liquid":"json",value:formattedValue,embedded:!0,onChange:value=>setJsonValue(value||"{}"),options:{lineNumbers:"off",minimap:{enabled:!1},scrollbar:{vertical:"hidden",verticalScrollbarSize:0}},globals:props.templating&&null!==(_props$sampleGlobalsW=props.sampleGlobalsWithInputs)&&void 0!==_props$sampleGlobalsW?_props$sampleGlobalsW:void 0}),props.templating?(0,jsx_runtime.jsx)("span",{className:"absolute top-0 right-0 z-10 p-px opacity-0 transition-opacity group-hover:opacity-100",children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestions.T,{templating:templatingKind,value:jsonValue,setTemplatingEngine:templating=>props.onChange?.({...props.input,templating}),onOptionSelect:option=>{(0,copyToClipboard.v)(`{${option.example}}`,"template code")}})}):null]})}),className:"p-0"}];return(0,jsx_runtime.jsx)(src.JL,{embedded:!1,panels:panels,size:"xsmall"})}function EmailTemplateField(_ref3){let{schema,value,onChange,sampleGlobalsWithInputs}=_ref3;return(0,jsx_runtime.jsx)(EmailTemplater.N,{type:schema.type,variables:null!=sampleGlobalsWithInputs?sampleGlobalsWithInputs:{},defaultValue:schema.default,value:value,onChange:onChange,templating:schema.templating})}function CyclotronJobTemplateInput(props){var _props$input$templati2,_props$input$value,_props$sampleGlobalsW2;let templating=null!==(_props$input$templati2=props.input.templating)&&void 0!==_props$input$templati2?_props$input$templati2:"hog";return props.templating?(0,jsx_runtime.jsxs)("span",{className:(0,clsx_m.default)("group relative",props.className),children:[(0,jsx_runtime.jsx)(CodeEditorInline.s,{minHeight:"37",value:null!==(_props$input$value=props.input.value)&&void 0!==_props$input$value?_props$input$value:"",onChange:val=>props.onChange?.({...props.input,value:null!=val?val:""}),language:"hog"===props.input.templating?"hogTemplate":"liquid",globals:null!==(_props$sampleGlobalsW2=props.sampleGlobalsWithInputs)&&void 0!==_props$sampleGlobalsW2?_props$sampleGlobalsW2:void 0}),(0,jsx_runtime.jsx)("span",{className:"absolute top-0 right-0 z-10 p-px opacity-0 transition-opacity group-hover:opacity-100",children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestions.T,{templating:templating,value:props.input.value,setTemplatingEngine:templating=>props.onChange?.({...props.input,templating}),onOptionSelect:option=>{props.onChange?.({...props.input,value:`${props.input.value} {${option.example}}`})}})})]}):(0,jsx_runtime.jsx)(src.DF,{type:"text",value:props.input.value,onChange:val=>props.onChange?.({...props.input,value:val})})}function DictionaryField(_ref4){var _input$value;let{input,onChange,templating,sampleGlobalsWithInputs}=_ref4,value=null!==(_input$value=input.value)&&void 0!==_input$value?_input$value:{},[entries,setEntries]=(0,react.useState)(Object.entries(value)),prevFilteredEntriesRef=(0,react.useRef)(entries);return(0,react.useEffect)(()=>{let filteredEntries=entries.filter(_ref5=>{let[key,val]=_ref5;return""!==key.trim()||""!==val.trim()});if((0,utils.h0)(filteredEntries,prevFilteredEntriesRef.current))return;prevFilteredEntriesRef.current=filteredEntries;let val=Object.fromEntries(filteredEntries);onChange?.({...input,value:val})},[entries,onChange]),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[entries.some(_ref6=>{let[key]=_ref6;return key===EXTEND_OBJECT_KEY})?null:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),size:"small",type:"secondary",onClick:()=>{setEntries([[EXTEND_OBJECT_KEY,"{event.properties}"],...entries])},children:"Include properties from an entire object"}),entries.map((_ref7,index)=>{let[key,val]=_ref7;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.u,{title:EXTEND_OBJECT_KEY===key?"Include properties from an entire object":void 0,children:(0,jsx_runtime.jsx)(src.DF,{value:key===EXTEND_OBJECT_KEY?"INCLUDE ENTIRE OBJECT":key,disabled:key===EXTEND_OBJECT_KEY,className:"flex-1 min-w-60",onChange:key=>{let newEntries=[...entries];newEntries[index]=[key,newEntries[index][1]],setEntries(newEntries)},placeholder:"Key"})}),(0,jsx_runtime.jsx)(CyclotronJobTemplateInput,{className:"overflow-hidden flex-2",input:{...input,value:val},onChange:val=>{var _val$value;let newEntries=[...entries];newEntries[index]=[newEntries[index][0],null!==(_val$value=val.value)&&void 0!==_val$value?_val$value:""],val.templating&&onChange?.({...input,templating:val.templating}),setEntries(newEntries)},templating:templating,sampleGlobalsWithInputs:sampleGlobalsWithInputs}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),size:"small",onClick:()=>{let newEntries=[...entries];newEntries.splice(index,1),setEntries(newEntries)}})]},index)}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),size:"small",type:"secondary",onClick:()=>{setEntries([...entries,["",""]])},children:"Add entry"})]})}function CyclotronJobInputRenderer(_ref8){var _schema$templating,_schema$choices;let{onChange,onInputChange,schema,disabled,input,configuration,parentConfiguration,sampleGlobalsWithInputs}=_ref8,templating=null===(_schema$templating=schema.templating)||void 0===_schema$templating||_schema$templating,onValueChange=value=>onChange?.({...input,value});switch(schema.type){case"string":return(0,jsx_runtime.jsx)(CyclotronJobTemplateInput,{input:input,onChange:disabled?()=>{}:onChange,className:"ph-no-capture",templating:templating,sampleGlobalsWithInputs:sampleGlobalsWithInputs});case"number":return(0,jsx_runtime.jsx)(src.DF,{type:"number",value:input.value,onChange:onValueChange,className:"ph-no-capture"});case"json":return(0,jsx_runtime.jsx)(JsonConfigField,{input:input,onChange:onChange,className:"ph-no-capture",templating:templating,sampleGlobalsWithInputs:sampleGlobalsWithInputs});case"choice":return(0,jsx_runtime.jsx)(src.Yv,{fullWidth:!0,value:input.value,className:"ph-no-capture",onChange:onValueChange,options:null!==(_schema$choices=schema.choices)&&void 0!==_schema$choices?_schema$choices:[],disabled:disabled});case"dictionary":return(0,jsx_runtime.jsx)(DictionaryField,{input:input,onChange:onChange,templating:templating,sampleGlobalsWithInputs:sampleGlobalsWithInputs});case"boolean":return(0,jsx_runtime.jsx)(src.f4,{checked:input.value,onChange:checked=>onValueChange(checked),disabled:disabled});case"integration":return(0,jsx_runtime.jsx)(CyclotronJobInputIntegration,{schema:schema,value:input.value,onChange:newValue=>{configuration.inputs_schema&&onInputChange&&configuration.inputs_schema.filter(s=>"integration_field"===s.type).forEach(field=>{onInputChange(field.key,{value:null})}),onValueChange(newValue)}});case"integration_field":return(0,jsx_runtime.jsx)(CyclotronJobInputIntegrationField,{schema:schema,value:input.value,onChange:onValueChange,parentConfiguration:parentConfiguration,configuration:configuration});case"email":case"native_email":return(0,jsx_runtime.jsx)(EmailTemplateField,{schema:schema,value:input.value,onChange:onValueChange,sampleGlobalsWithInputs:sampleGlobalsWithInputs});default:return(0,jsx_runtime.jsxs)("strong",{className:"text-danger",children:['Unknown field type "',(0,jsx_runtime.jsx)("code",{children:schema.type}),'".']})}}function CyclotronJobInputSchemaControls(_ref9){let{value,onChange,onDone,configuration,parentConfiguration,sampleGlobalsWithInputs}=_ref9,_onChange=data=>{if(data?.key?.length===0){setLocalVariableError("Input variable name cannot be empty");return}onChange(data?{...value,...data}:null)},[localVariableValue,setLocalVariableValue]=(0,react.useState)(value.key),[localVariableError,setLocalVariableError]=(0,react.useState)(null);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap flex-1 gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.Yv,{size:"small",options:INPUT_TYPE_LIST.map(type=>({label:(0,utils.fm)(type),value:type})),value:value.type,className:"w-30",onChange:type=>_onChange({type})}),(0,jsx_runtime.jsx)(src.Hw,{size:"small",checked:value.required,onChange:required=>_onChange({required}),label:"Required",bordered:!0}),(0,jsx_runtime.jsx)(src.Hw,{size:"small",checked:value.secret,onChange:secret=>_onChange({secret}),label:"Secret",bordered:!0}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(src.Jp,{status:"danger",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),size:"small",onClick:()=>onChange(null)}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>onDone(),children:"Done"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap flex-1 gap-2",children:[(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Display label",children:(0,jsx_runtime.jsx)(src.DF,{className:"min-w-60",size:"small",value:value.label,onChange:label=>_onChange({label}),placeholder:"Display label"})}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Input variable name",error:localVariableError,children:(0,jsx_runtime.jsx)(src.DF,{size:"small",value:localVariableValue,onChange:key=>setLocalVariableValue(key),onBlur:()=>_onChange({key:localVariableValue}),placeholder:"Variable name"})})]}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Description",children:(0,jsx_runtime.jsx)(src._V,{minRows:1,value:value.description,onChange:description=>_onChange({description}),placeholder:"Description"})}),"choice"===value.type&&(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Choices",children:(0,jsx_runtime.jsx)(src.nt,{mode:"multiple",allowCustomValues:!0,value:value.choices?.map(choice=>choice.value),onChange:choices=>_onChange({choices:choices.map(value=>({label:value,value}))}),placeholder:"Choices"})}),"integration"===value.type&&(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Integration kind",children:(0,jsx_runtime.jsx)(src.Yv,{value:value.integration,onChange:integration=>_onChange({integration}),options:[{label:"Slack",value:"slack"},{label:"Salesforce",value:"salesforce"},{label:"Hubspot",value:"hubspot"}],placeholder:"Choose kind"})}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Default value",children:(0,jsx_runtime.jsx)(CyclotronJobInputRenderer,{schema:value,input:{value:value.default},onChange:val=>_onChange({default:val.value}),configuration:configuration,parentConfiguration:parentConfiguration,sampleGlobalsWithInputs:sampleGlobalsWithInputs})})]})}function CyclotronJobInputWithSchema(_ref10){var _configuration$inputs;let{schema,configuration,parentConfiguration,onInputSchemaChange,onInputChange,showSource,sampleGlobalsWithInputs,errors}=_ref10,{attributes,listeners,setNodeRef,transform,transition}=(0,sortable_esm.nB)({id:schema.key}),[editing,setEditing]=(0,react.useState)(!1),value=null!==(_configuration$inputs=configuration.inputs?.[schema.key])&&void 0!==_configuration$inputs?_configuration$inputs:{value:null},error=errors?.[schema.key];(0,react.useEffect)(()=>{showSource||setEditing(!1)},[showSource]);let onChange=newValue=>{onInputChange?.(schema.key,{...value,...newValue})};return(0,jsx_runtime.jsx)("div",{ref:setNodeRef,style:{transform:utilities_esm.ux.Transform.toString(transform),transition},children:editing?(0,jsx_runtime.jsx)("div",{className:"p-2 rounded border border-dashed deprecated-space-y-4",children:(0,jsx_runtime.jsx)(CyclotronJobInputSchemaControls,{value:schema,onChange:newSchema=>{let inputsSchema=configuration.inputs_schema||[];if(newSchema){let modifiedSchema={...schema,...newSchema};inputsSchema=inputsSchema.map(s=>s.key===schema.key?modifiedSchema:s)}else inputsSchema=inputsSchema.filter(s=>s.key!==schema.key);newSchema?.key&&onInputChange?.(newSchema.key,value),newSchema?.type&&newSchema.type!==schema.type&&onInputChange?.(schema.key,{value:null}),onInputSchemaChange?.(inputsSchema)},onDone:()=>setEditing(!1),configuration:configuration,parentConfiguration:parentConfiguration,sampleGlobalsWithInputs:sampleGlobalsWithInputs})}):(0,jsx_runtime.jsx)(LemonField.D.Pure,{error:error,help:"string"==typeof schema.description?(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"max-w-[30rem]",lowKeyHeadings:!0,children:schema.description}):void 0,children:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsxs)(src.HQ,{className:showSource?"cursor-grab":"",showOptional:!schema.required,...attributes,...listeners,children:[schema.label||schema.key,schema.secret?(0,jsx_runtime.jsx)(src.u,{title:"This input is marked as secret. It will be encrypted and not visible after saving.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconLock,{})}):void 0]}),showSource&&(0,jsx_runtime.jsxs)(src.oe,{type:"muted",className:"font-mono",children:["inputs.",schema.key]}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),showSource&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",noPadding:!0,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>setEditing(!0)})]}),value?.secret?(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center p-1 rounded border border-dashed",children:[(0,jsx_runtime.jsx)("span",{className:"flex-1 p-1 italic text-secondary",children:"This value is secret and is not displayed here."}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{onChange({value:"",secret:!1})},size:"small",type:"secondary",children:"Edit"})]}):(0,jsx_runtime.jsx)(CyclotronJobInputRenderer,{schema:schema,input:null!=value?value:{value:""},onChange:onChange,onInputChange:onInputChange,configuration:configuration,parentConfiguration:parentConfiguration,sampleGlobalsWithInputs:sampleGlobalsWithInputs})]})})})}},"../../frontend/src/lib/integrations/GitHubIntegrationHelpers.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{so:()=>GitHubRepositoryPicker,k8:()=>GitHubRepositorySelectField});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let githubIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","githubIntegrationLogic",key]),(0,index_esm.actions)({loadRepositories:()=>({})}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{repositories:[[],{loadRepositories:async()=>(await api.ZP.integrations.githubRepositories(props.id)).repositories}]}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let GitHubRepositoryPicker=_ref=>{let{value,onChange,integrationId}=_ref,{options,loading}=useRepositories(integrationId);return(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],mode:"single","data-attr":"select-github-repository",placeholder:"Select a repository...",options:options,loading:loading})},GitHubRepositorySelectField=_ref2=>{let{integrationId}=_ref2,{options,loading}=useRepositories(integrationId);return(0,jsx_runtime.jsx)(LemonField.D,{name:"repositories",label:"Repository",children:(0,jsx_runtime.jsx)(src.nt,{mode:"single","data-attr":"select-github-repository",placeholder:"Select a repository...",options:options,loading:loading})})};function useRepositories(integrationId){let logic=githubIntegrationLogic({id:integrationId}),{repositories,repositoriesLoading}=(0,index_esm.useValues)(logic),{loadRepositories}=(0,index_esm.useActions)(logic);return(0,react.useEffect)(()=>{loadRepositories()},[loadRepositories]),{options:(0,react.useMemo)(()=>repositories.map(r=>({key:r,label:r})),[repositories]),loading:repositoriesLoading}}},"../../frontend/src/lib/integrations/LinearIntegrationHelpers.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ul:()=>LinearTeamPicker,Af:()=>LinearTeamSelectField});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let linearIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","linearIntegrationLogic",key]),(0,index_esm.actions)({loadAllLinearTeams:()=>({})}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{linearTeams:[[],{loadAllLinearTeams:async()=>(await api.ZP.integrations.linearTeams(props.id)).teams}]}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function LinearTeamPicker(_ref){let{onChange,value,integration}=_ref,{options,loading}=useLinearTeams(integration.id);return(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],mode:"single","data-attr":"select-linear-team",placeholder:"Select a team...",options:options,loading:loading})}let LinearTeamSelectField=_ref2=>{let{integrationId}=_ref2,{options,loading}=useLinearTeams(integrationId);return(0,jsx_runtime.jsx)(LemonField.D,{name:"teamIds",label:"Team",children:(0,jsx_runtime.jsx)(src.nt,{mode:"single","data-attr":"select-linear-team",placeholder:"Select a team...",options:options,loading:loading})})};function useLinearTeams(integrationId){let logic=linearIntegrationLogic({id:integrationId}),{linearTeams,linearTeamsLoading}=(0,index_esm.useValues)(logic),{loadAllLinearTeams}=(0,index_esm.useActions)(logic),linearTeamOptions=(0,react.useMemo)(()=>linearTeams?linearTeams.map(x=>({key:x.id,label:x.name})):[],[linearTeams]);return(0,react.useEffect)(()=>{loadAllLinearTeams()},[loadAllLinearTeams]),{options:linearTeamOptions,loading:linearTeamsLoading}}},"../../frontend/src/lib/integrations/SlackIntegrationHelpers.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>SlackChannelPicker});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),usePeriodicRerender=__webpack_require__("../../frontend/src/lib/hooks/usePeriodicRerender.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx");let slackIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","slackIntegrationLogic",key]),(0,index_esm.connect)(()=>({values:[preflightLogic.preflightLogic,["siteUrlMisconfigured","preflight"]]})),(0,index_esm.actions)({loadAllSlackChannels:function(){let forceRefresh=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{forceRefresh}},loadSlackChannelById:channelId=>({channelId})}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{allSlackChannels:[null,{loadAllSlackChannels:async _ref2=>{let{forceRefresh}=_ref2;return await api.ZP.integrations.slackChannels(props.id,forceRefresh)}}],slackChannelById:[null,{loadSlackChannelById:async(_ref3,breakpoint)=>{let{channelId}=_ref3;return await breakpoint(500),(await api.ZP.integrations.slackChannelsById(props.id,channelId)).channels[0]||null}}]}}),(0,index_esm.reducers)({_fetchedSlackChannels:[[],{loadAllSlackChannelsSuccess:(_,_ref4)=>{var _allSlackChannels$cha;let{allSlackChannels}=_ref4;return null!==(_allSlackChannels$cha=allSlackChannels.channels)&&void 0!==_allSlackChannels$cha?_allSlackChannels$cha:[]}}],_fetchedSlackChannelById:[null,{loadSlackChannelByIdSuccess:(_,_ref5)=>{let{slackChannelById}=_ref5;return slackChannelById}}]}),(0,index_esm.selectors)({slackChannels:[s=>[s._fetchedSlackChannels,s._fetchedSlackChannelById],(_fetchedSlackChannels,_fetchedSlackChannelById)=>{let channels=[..._fetchedSlackChannels];return _fetchedSlackChannelById&&!channels.find(x=>x.id===_fetchedSlackChannelById.id)&&channels.push(_fetchedSlackChannelById),channels}],isMemberOfSlackChannel:[s=>[s.slackChannels],slackChannels=>channel=>{var _slackChannels$find$i;let[channelId]=channel.split("|");return null!==(_slackChannels$find$i=slackChannels.find(x=>x.id===channelId)?.is_member)&&void 0!==_slackChannels$find$i&&_slackChannels$find$i}],isPrivateChannelWithoutAccess:[s=>[s.slackChannels],slackChannels=>channel=>{var _slackChannels$find$i2;let[channelId]=channel.split("|");return null!==(_slackChannels$find$i2=slackChannels.find(x=>x.id===channelId)?.is_private_without_access)&&void 0!==_slackChannels$find$i2&&_slackChannels$find$i2}],getChannelRefreshButtonDisabledReason:[s=>[s.allSlackChannels],allSlackChannels=>()=>{let now=(0,dayjs.Bv)();if(allSlackChannels){let earliestRefresh=(0,dayjs.Bv)(allSlackChannels.lastRefreshedAt).add(5,"minutes");if(now.isBefore(earliestRefresh))return`You can refresh the channels again ${earliestRefresh.from(now)}`}return""}]})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let getSlackChannelOptions=slackChannels=>slackChannels?slackChannels.map(x=>{let name=x.is_private_without_access?"Private Channel":x.name,displayLabel=`${x.is_private?"🔒":"#"}${name} (${x.id})`;return{key:`${x.id}|#${x.name}`,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("span",{children:displayLabel}),(0,jsx_runtime.jsx)("span",{children:x.is_ext_shared?(0,jsx_runtime.jsx)(icons.Zf,{className:"ml-2"}):null})]}),label:displayLabel}}):null;function SlackChannelPicker(_ref){var _slackChannelOptions,_modifiedValue$split$;let{onChange,value,integration,disabled}=_ref,{slackChannels,allSlackChannelsLoading,slackChannelByIdLoading,isMemberOfSlackChannel,isPrivateChannelWithoutAccess,getChannelRefreshButtonDisabledReason}=(0,index_esm.useValues)(slackIntegrationLogic({id:integration.id})),{loadAllSlackChannels,loadSlackChannelById}=(0,index_esm.useActions)(slackIntegrationLogic({id:integration.id})),[localValue,setLocalValue]=(0,react.useState)(null);(0,usePeriodicRerender.o)(15e3);let rawSlackChannelOptions=(0,react.useMemo)(()=>getSlackChannelOptions(slackChannels),[slackChannels]),showSlackMembershipWarning=value&&!1===isMemberOfSlackChannel(value),modifiedValue=(0,react.useMemo)(()=>{if(value?.split("|").length===1){let channel=slackChannels.find(x=>x.id===value);if(channel)return`${channel.id}|#${channel.name}`}return value},[value,slackChannels]);return(0,react.useEffect)(()=>{disabled||loadAllSlackChannels()},[loadAllSlackChannels,disabled]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},onInputChange:val=>{val&&(loadSlackChannelById(val),setLocalValue(val))},value:modifiedValue?[modifiedValue]:[],onFocus:()=>!slackChannels.length&&!allSlackChannelsLoading&&loadAllSlackChannels(),disabled:disabled,mode:"single","data-attr":"select-slack-channel",placeholder:"Select a channel...",action:{children:(0,jsx_runtime.jsx)("span",{className:"Link",children:"Refresh channels"}),onClick:()=>loadAllSlackChannels(!0),disabledReason:getChannelRefreshButtonDisabledReason()},emptyStateComponent:(0,jsx_runtime.jsxs)("p",{className:"text-secondary italic p-1",children:["No channels found. Make sure the PostHog Slack App is installed in the channel."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/cdp/destinations/slack",target:"_blank",children:"See the docs for more information."})]}),options:null!==(_slackChannelOptions=rawSlackChannelOptions?rawSlackChannelOptions.filter(x=>{let[id]=x.key.split("|#");return!isPrivateChannelWithoutAccess(id)||id===value||id===localValue}):[])&&void 0!==_slackChannelOptions?_slackChannelOptions:modifiedValue?[{key:modifiedValue,label:null!==(_modifiedValue$split$=modifiedValue?.split("|")[1])&&void 0!==_modifiedValue$split$?_modifiedValue$split$:modifiedValue}]:[],loading:allSlackChannelsLoading||slackChannelByIdLoading}),showSlackMembershipWarning?(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsxs)("span",{children:["The PostHog Slack App is not in this channel. Please add it to the channel otherwise Subscriptions will fail to be delivered."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/webhooks/slack",target:"_blank",children:"See the Docs for more information"})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",disabledReason:getChannelRefreshButtonDisabledReason(),onClick:()=>loadAllSlackChannels(!0),loading:allSlackChannelsLoading,children:"Check again"})]})}):isPrivateChannelWithoutAccess(null!=value?value:"")?(0,jsx_runtime.jsxs)(src.Vp,{type:"info",children:["This is a private Slack channel. Ask"," ",(0,jsx_runtime.jsx)(src.YY,{user:integration.created_by,showName:!0,size:"sm"})," or connect your own Slack account to configure private channels."]}):null]})}}}]);