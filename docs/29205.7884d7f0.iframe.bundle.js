"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[29205],{"../../frontend/src/lib/components/FeedbackNotice.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{J:()=>FeedbackNotice});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),_Support_supportLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/components/Support/supportLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let FeedbackNotice=_ref=>{let{text}=_ref,{openSupportForm}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(_Support_supportLogic__WEBPACK_IMPORTED_MODULE_6__.Pw),{preflight}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_5__.preflightLogic),showSupportOptions=preflight?.cloud;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Vp,{type:"info",className:"my-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{className:"flex items-center flex-wrap gap-2 justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:"flex-1 min-w-full sm:min-w-0",children:text}),showSupportOptions?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("span",{className:"flex items-center gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_4__.J,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconBug,{}),onClick:()=>openSupportForm({kind:"bug",isEmailFormOpen:!0}),children:"Report a bug"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_4__.J,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_3__.Rz,{}),onClick:()=>openSupportForm({kind:"feedback",isEmailFormOpen:!0}),children:"Give feedback"})]}):null]})})}},"../../frontend/src/scenes/error-tracking/ErrorTrackingScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ErrorTrackingScene:()=>ErrorTrackingScene,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),FeedbackNotice=__webpack_require__("../../frontend/src/lib/components/FeedbackNotice.tsx"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),Sparkline=__webpack_require__("../../frontend/src/lib/components/Sparkline.tsx"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.227.0_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),InsightViz=__webpack_require__("../../frontend/src/queries/nodes/InsightViz/InsightViz.tsx"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),AssigneeSelect=__webpack_require__("../../frontend/src/scenes/error-tracking/AssigneeSelect.tsx"),api=__webpack_require__("../../frontend/src/lib/api.ts"),dataNodeLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),error_tracking_utils=__webpack_require__("../../frontend/src/scenes/error-tracking/utils.ts");let errorTrackingDataNodeLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","error-tracking","errorTrackingDataNodeLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(_ref=>{let{key,query}=_ref;return{values:[(0,dataNodeLogic.M)({key,query}),["response"]],actions:[(0,dataNodeLogic.M)({key,query}),["setResponse","loadData"]]}}),(0,index_esm.actions)({mergeIssues:ids=>({ids}),assignIssue:(id,assignee)=>({id,assignee})}),(0,index_esm.listeners)(_ref2=>{let{values,actions}=_ref2;return{mergeIssues:async _ref3=>{let{ids}=_ref3,results=values.response?.results,issues=results.filter(_ref4=>{let{id}=_ref4;return ids.includes(id)}),primaryIssue=issues.shift();if(primaryIssue&&issues.length>0){let mergingIds=issues.map(g=>g.id),mergedIssue=(0,error_tracking_utils.Z0)(primaryIssue,issues);actions.setResponse({...values.response,results:results.filter(_ref5=>{let{id}=_ref5;return!mergingIds.includes(id)}).map(issue=>mergedIssue.id===issue.id?mergedIssue:issue)}),dist_module.ZP.capture("error_tracking_issue_merged",{primary:primaryIssue.id}),await api.ZP.errorTracking.mergeInto(primaryIssue.id,mergingIds),actions.loadData(!0)}},assignIssue:async _ref6=>{let{id,assignee}=_ref6,response=values.response;if(response){let results=response.results,recordIndex=results.findIndex(r=>r.id===id);if(recordIndex>-1){let issue={...results[recordIndex],assignee};results.splice(recordIndex,1,issue),actions.setResponse({...response,results:results}),await api.ZP.errorTracking.assignIssue(issue.id,assignee),actions.loadData(!0)}}}}})]);var ErrorTrackingFilters=__webpack_require__("../../frontend/src/scenes/error-tracking/ErrorTrackingFilters.tsx"),errorTrackingIssueSceneLogic=__webpack_require__("../../frontend/src/scenes/error-tracking/errorTrackingIssueSceneLogic.ts"),errorTrackingLogic=__webpack_require__("../../frontend/src/scenes/error-tracking/errorTrackingLogic.ts"),fast_deep_equal=__webpack_require__("../../node_modules/.pnpm/fast-deep-equal@3.1.3/node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),kea_subscriptions_lib=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.5_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),queries=__webpack_require__("../../frontend/src/scenes/error-tracking/queries.ts");let errorTrackingSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","error-tracking","errorTrackingSceneLogic"]),(0,index_esm.connect)({values:[errorTrackingLogic.HT,["dateRange","assignee","filterTestAccounts","filterGroup","customSparklineConfig","searchQuery"]],actions:[errorTrackingLogic.HT,["setAssignee","setDateRange","setFilterGroup","setSearchQuery","setFilterTestAccounts"]]}),(0,index_esm.actions)({setOrderBy:orderBy=>({orderBy}),setStatus:status=>({status}),setSelectedIssueIds:ids=>({ids})}),(0,index_esm.reducers)({orderBy:["last_seen",{persist:!0},{setOrderBy:(_,_ref)=>{let{orderBy}=_ref;return orderBy}}],status:["active",{persist:!0},{setStatus:(_,_ref2)=>{let{status}=_ref2;return status}}],selectedIssueIds:[[],{setSelectedIssueIds:(_,_ref3)=>{let{ids}=_ref3;return ids}}]}),(0,index_esm.selectors)(_ref4=>{let{values}=_ref4;return{query:[s=>[s.orderBy,s.status,s.dateRange,s.assignee,s.filterTestAccounts,s.filterGroup,s.searchQuery],(orderBy,status,dateRange,assignee,filterTestAccounts,filterGroup,searchQuery)=>(0,queries.mx)({orderBy,status,dateRange,assignee,filterTestAccounts,filterGroup,customVolume:values.customSparklineConfig,searchQuery,columns:["error","volume","occurrences","sessions","users","assignee"]})]}}),(0,kea_subscriptions_lib.Vt)(_ref5=>{let{actions}=_ref5;return{query:()=>actions.setSelectedIssueIds([])}}),(0,lib.actionToUrl)(_ref6=>{let{values}=_ref6,buildURL=()=>{let searchParams={orderBy:values.orderBy,status:values.status,filterTestAccounts:values.filterTestAccounts};return(values.searchQuery&&(searchParams.searchQuery=values.searchQuery),(0,utils.h0)(values.filterGroup,errorTrackingLogic.Kg)||(searchParams.filterGroup=values.filterGroup),(0,utils.h0)(values.dateRange,errorTrackingLogic.O3)||(searchParams.dateRange=values.dateRange),(0,utils.h0)(searchParams,lib.router.values.searchParams))?[lib.router.values.location.pathname,lib.router.values.searchParams,lib.router.values.hashParams,{replace:!1}]:[lib.router.values.location.pathname,searchParams,lib.router.values.hashParams,{replace:!0}]};return{setOrderBy:()=>buildURL(),setStatus:()=>buildURL(),setDateRange:()=>buildURL(),setFilterGroup:()=>buildURL(),setSearchQuery:()=>buildURL(),setFilterTestAccounts:()=>buildURL()}}),(0,lib.urlToAction)(_ref7=>{let{actions,values}=_ref7;return{"*":(_,params)=>{params.orderBy&&!fast_deep_equal_default()(params.orderBy,values.orderBy)&&actions.setOrderBy(params.orderBy),params.status&&!fast_deep_equal_default()(params.status,values.status)&&actions.setStatus(params.status),params.dateRange&&!fast_deep_equal_default()(params.dateRange,values.dateRange)&&actions.setDateRange(params.dateRange),params.filterGroup&&!fast_deep_equal_default()(params.filterGroup,values.filterGroup)&&actions.setFilterGroup(params.filterGroup),params.filterTestAccounts&&!fast_deep_equal_default()(params.filterTestAccounts,values.filterTestAccounts)&&actions.setFilterTestAccounts(params.filterTestAccounts),params.searchQuery&&!fast_deep_equal_default()(params.searchQuery,values.searchQuery)&&actions.setSearchQuery(params.searchQuery)}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ErrorTrackingListOptions=()=>{let{assignee}=(0,index_esm.useValues)(errorTrackingLogic.HT),{setAssignee}=(0,index_esm.useActions)(errorTrackingLogic.HT),{orderBy,status}=(0,index_esm.useValues)(errorTrackingSceneLogic),{setOrderBy,setStatus}=(0,index_esm.useActions)(errorTrackingSceneLogic),{selectedIssueIds}=(0,index_esm.useValues)(errorTrackingSceneLogic),{setSelectedIssueIds}=(0,index_esm.useActions)(errorTrackingSceneLogic),{mergeIssues}=(0,index_esm.useActions)(errorTrackingDataNodeLogic);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"sticky top-[var(--breadcrumbs-height-compact)] z-20 py-2 bg-primary flex justify-between",children:[(0,jsx_runtime.jsxs)("div",{className:"flex deprecated-space-x-2",children:[(0,jsx_runtime.jsx)(src.Jp,{disabledReason:selectedIssueIds.length<2?"Select at least two issues to merge":null,type:"secondary",size:"small",onClick:()=>{mergeIssues(selectedIssueIds),setSelectedIssueIds([])},children:"Merge Issues"}),selectedIssueIds.length>0&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>setSelectedIssueIds([]),children:"Unselect all"})]}),selectedIssueIds.length<1&&(0,jsx_runtime.jsxs)("span",{className:"flex deprecated-space-x-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("span",{children:"Status:"}),(0,jsx_runtime.jsx)(src.Yv,{onSelect:setStatus,onChange:setStatus,value:status,options:[{value:"all",label:"All"},{value:"active",label:"Active"},{value:"resolved",label:"Resolved"}],size:"small"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("span",{children:"Sort by:"}),(0,jsx_runtime.jsx)(src.Yv,{onSelect:setOrderBy,onChange:setOrderBy,value:orderBy,options:[{value:"last_seen",label:"Last seen"},{value:"first_seen",label:"First seen"},{value:"occurrences",label:"Occurrences"},{value:"users",label:"Users"},{value:"sessions",label:"Sessions"}],size:"small"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("span",{children:"Assigned to:"}),(0,jsx_runtime.jsx)(AssigneeSelect.i,{showName:!0,showIcon:!1,assignee:assignee,onChange:assignee=>setAssignee(assignee),unassignedLabel:"Any user",type:"secondary",size:"small"})]})]})]})})};var ErrorTrackingSetupPrompt=__webpack_require__("../../frontend/src/scenes/error-tracking/ErrorTrackingSetupPrompt.tsx");let scene={component:ErrorTrackingScene,logic:errorTrackingSceneLogic};function ErrorTrackingScene(){let{hasSentExceptionEvent,hasSentExceptionEventLoading}=(0,index_esm.useValues)(errorTrackingLogic.HT),{query}=(0,index_esm.useValues)(errorTrackingSceneLogic),insightProps={dashboardItemId:"new-ErrorTrackingQuery"};return(0,jsx_runtime.jsx)(ErrorTrackingSetupPrompt.n,{children:(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:errorTrackingDataNodeLogic,props:{query,key:(0,InsightViz.gG)(insightProps)},children:[(0,jsx_runtime.jsx)(Header,{}),hasSentExceptionEventLoading?null:hasSentExceptionEvent?(0,jsx_runtime.jsx)(FeedbackNotice.J,{text:"Error tracking is currently in beta. Thanks for taking part! We'd love to hear what you think."}):(0,jsx_runtime.jsx)(IngestionStatusCheck,{}),(0,jsx_runtime.jsx)(ErrorTrackingFilters.n,{}),(0,jsx_runtime.jsx)(src.p2,{className:"mt-2"}),(0,jsx_runtime.jsx)(ErrorTrackingListOptions,{}),(0,jsx_runtime.jsx)(Query.A,{query:query,context:{columns:{error:{width:"50%",render:CustomGroupTitleColumn},occurrences:{align:"center",render:CountColumn},sessions:{align:"center",render:CountColumn},users:{align:"center",render:CountColumn},volume:{align:"right",renderTitle:VolumeColumnHeader,render:VolumeColumn},assignee:{align:"center",render:AssigneeColumn}},showOpenEditorButton:!1,insightProps:insightProps,emptyStateHeading:"No issues found",emptyStateDetail:"Try changing the date range, changing the filters or removing the assignee."}})]})})}let VolumeColumn=props=>{let{sparklineSelectedPeriod,customSparklineConfig}=(0,index_esm.useValues)(errorTrackingLogic.HT),record=props.record;if(!record.aggregations)return null;let[data,labels]="24h"===sparklineSelectedPeriod?[record.aggregations.volumeDay,error_tracking_utils.it]:"30d"===sparklineSelectedPeriod?[record.aggregations.volumeMonth,error_tracking_utils.U9]:customSparklineConfig?[record.aggregations.customVolume,(0,error_tracking_utils.Gu)(customSparklineConfig)]:[null,null];return data?(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(Sparkline.b,{className:"h-8",data:data,labels:labels})}):null},VolumeColumnHeader=_ref=>{let{columnName}=_ref,{sparklineSelectedPeriod,sparklineOptions}=(0,index_esm.useValues)(errorTrackingLogic.HT),{setSparklineSelectedPeriod:onChange}=(0,index_esm.useActions)(errorTrackingLogic.HT);return sparklineSelectedPeriod&&sparklineOptions?(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center min-w-64",children:[(0,jsx_runtime.jsx)("div",{children:columnName}),(0,jsx_runtime.jsx)(src.P4,{size:"xsmall",value:sparklineSelectedPeriod,options:Object.values(sparklineOptions),onChange:onChange})]}):null},CustomGroupTitleColumn=props=>{let{selectedIssueIds}=(0,index_esm.useValues)(errorTrackingSceneLogic),{setSelectedIssueIds}=(0,index_esm.useActions)(errorTrackingSceneLogic),record=props.record,checked=selectedIssueIds.includes(record.id);return(0,jsx_runtime.jsxs)("div",{className:"flex items-start deprecated-space-x-1.5 group",children:[(0,jsx_runtime.jsx)(src.Hw,{className:"pt-1",checked:checked,onChange:newValue=>{setSelectedIssueIds(newValue?[...new Set([...selectedIssueIds,record.id])]:selectedIssueIds.filter(id=>id!=record.id))}}),(0,jsx_runtime.jsx)(LemonTableLink.i,{title:record.name||"Unknown Type",description:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-1",children:[(0,jsx_runtime.jsx)("div",{className:"line-clamp-1",children:record.description}),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-x-1",children:[(0,jsx_runtime.jsx)(TZLabel.w,{time:record.first_seen,className:"border-dotted border-b",delayMs:750}),(0,jsx_runtime.jsx)("span",{children:"|"}),record.last_seen?(0,jsx_runtime.jsx)(TZLabel.w,{time:record.last_seen,className:"border-dotted border-b",delayMs:750}):(0,jsx_runtime.jsx)(src.yW,{})]})]}),className:"flex-1 pr-12",to:urls.j.errorTrackingIssue(record.id),onClick:()=>{let issueLogic=(0,errorTrackingIssueSceneLogic.r)({id:record.id});issueLogic.mount(),issueLogic.actions.setIssue(record)}})]})},CountColumn=_ref2=>{let{record,columnName}=_ref2,count=record.aggregations[columnName];return(0,jsx_runtime.jsx)("span",{className:"text-lg font-medium",children:"sessions"===columnName&&0===count?(0,jsx_runtime.jsx)(src.u,{title:"No $session_id was set for any event in this issue",delayMs:0,children:"-"}):(0,utils.d$)(count)})},AssigneeColumn=props=>{let{assignIssue}=(0,index_esm.useActions)(errorTrackingDataNodeLogic),record=props.record;return(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsx)(AssigneeSelect.i,{assignee:record.assignee,onChange:assignee=>assignIssue(record.id,assignee)})})},Header=()=>{let{user}=(0,index_esm.useValues)(userLogic.userLogic);return(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[user?.is_staff?(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{dist_module.LJ.captureException(Error("Oh my!"))},children:"Send an exception"}):null,(0,jsx_runtime.jsx)(src.Jp,{to:"https://posthog.com/docs/error-tracking",type:"secondary",targetBlank:!0,children:"Documentation"}),(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.errorTrackingConfiguration(),type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),children:"Configure"})]})})},IngestionStatusCheck=()=>(0,jsx_runtime.jsxs)(src.Vp,{type:"warning",className:"my-4",children:[(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("strong",{children:"No Exception events have been detected!"})}),(0,jsx_runtime.jsxs)("p",{children:["To use the Error tracking product, please"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/error-tracking/installation",children:"enable exception capture within the PostHog SDK"})," ","(otherwise it'll be a little empty!)"]})]})}}]);