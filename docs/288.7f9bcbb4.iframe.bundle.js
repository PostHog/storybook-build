var Ve=Object.defineProperty,ze=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var me=(S,j,t)=>j in S?Ve(S,j,{enumerable:!0,configurable:!0,writable:!0,value:t}):S[j]=t,V=(S,j)=>{for(var t in j||(j={}))Ke.call(j,t)&&me(S,t,j[t]);if(ue)for(var t of ue(j))De.call(j,t)&&me(S,t,j[t]);return S},te=(S,j)=>ze(S,Be(j));var I=(S,j,t)=>new Promise((C,M)=>{var N=L=>{try{E(t.next(L))}catch(U){M(U)}},k=L=>{try{E(t.throw(L))}catch(U){M(U)}},E=L=>L.done?C(L.value):Promise.resolve(L.value).then(N,k);E((t=t.apply(S,j)).next())});(window.webpackJsonp=window.webpackJsonp||[]).push([[288],{"./frontend/src/scenes/instance/SystemStatus/index.tsx":function(S,j,t){"use strict";t.r(j),t.d(j,"scene",function(){return Re}),t.d(j,"SystemStatus",function(){return ce});var C=t("./node_modules/.pnpm/style-loader@2.0.0_webpack@4.46.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),M=t.n(C),N=t("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss"),k=t.n(N),E={};E.insert="head",E.singleton=!1;var L=M()(k.a,E),U=k.a.locals||{},P=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/alert/index.js"),A=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),m=t("./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),f=t("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),W=t("./frontend/src/lib/components/PageHeader.tsx"),i=t("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),o=t("./frontend/src/lib/components/icons.tsx"),d=t("./frontend/src/lib/components/Link.tsx"),p=t("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),g=t("./frontend/src/lib/utils.tsx"),e=t("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const w=new Set(["last_event_ingested_timestamp"]);function T(a,s){let{key:l,value:n,value_type:r,emptyNullLabel:c,isSecret:b}=s;return n&&b?Object(e.jsx)(p.a,{style:{color:"var(--muted)",backgroundColor:"#fee5b3"},className:"uppercase",icon:b?Object(e.jsx)(o.IconLock,{style:{color:"var(--warning)"}}):void 0,children:"Secret"}):l&&w.has(l)&&typeof n=="string"?new Date(n).getTime()===new Date("1970-01-01T00:00:00").getTime()?"Never":Object(g.O)(n):r==="bool"||typeof n=="boolean"?Object(e.jsx)(p.a,{type:n?"success":"danger",children:n?"Yes":"No"}):n==null||n===""?Object(e.jsx)(p.a,{className:"uppercase",style:{color:"var(--muted)"},children:c!=null?c:"Unknown"}):r==="int"||typeof n=="number"?n.toLocaleString("en-US"):n.toString()}var x=t("./frontend/@posthog/lemon-ui/src/index.ts");const ne={async_migrations_ok:"/instance/async_migrations"};function fe(a,s){return Object(e.jsxs)("span",{children:[s.metric," ",ne[s.key]?Object(e.jsx)(d.a,{to:ne[s.key],children:Object(e.jsx)(o.IconOpenInNew,{style:{verticalAlign:"middle"}})}):null]})}function je(){const{overview:a,systemStatusLoading:s}=Object(f.useValues)(m.b);return Object(e.jsx)(x.LemonTable,{className:"system-status-table",rowKey:"metric",dataSource:a,columns:[{title:"Metric",className:"metric-column",render:fe},{title:"Value",render:T}],loading:s,expandable:{expandedRowRender:function(n){var r;return(r=n.subrows)!==null&&r!==void 0&&r.rows.length?Object(e.jsx)(be,V({},n.subrows)):null},rowExpandable:l=>{var n;return!!((n=l.subrows)!==null&&n!==void 0&&n.rows.length)}}})}function be(a){return Object(e.jsx)(x.LemonTable,{dataSource:a.rows,columns:a.columns.map((s,l)=>({title:s,dataIndex:l})),embedded:!0})}var H=t("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),z=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/collapse/index.js"),ge=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/checkbox/index.js"),B=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/button/index.js"),ye=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/table/index.js"),Y=t("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/ReloadOutlined.js");function pe(){const{analyzeModalOpen:a,analyzeQuery:s,analyzeQueryResult:l,analyzeQueryResultLoading:n}=Object(f.useValues)(m.b),{setAnalyzeModalOpen:r,setAnalyzeQuery:c,runAnalyzeQuery:b}=Object(f.useActions)(m.b);return Object(e.jsxs)(x.LemonModal,{isOpen:a,title:"Analyze ClickHouse query performance",footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(x.LemonButton,{type:"secondary",onClick:()=>r(!1),children:"Cancel"}),Object(e.jsx)(x.LemonButton,{type:"primary",onClick:()=>void b(),disabled:n,children:"Analyze"})]}),onClose:()=>r(!1),width:"80%",children:[Object(e.jsx)(x.LemonTextArea,{placeholder:"SQL query to analyze",onChange:c,value:s,rows:10}),l&&Object(e.jsxs)("div",{className:"mt-2",children:[Object(e.jsx)("h2",{children:"Analysis results"}),Object(e.jsx)("ul",{children:Object.entries(l.timing).map(u=>{let[y,O]=u;return Object(e.jsxs)("li",{children:[y,": ",O]},y)})}),Object.entries(l.flamegraphs).map(u=>{let[y,O]=u;return Object(e.jsxs)("div",{children:[Object(e.jsxs)("h3",{children:["Flamegraph: ",y]}),Object(e.jsx)("a",{className:"embedded-svg-wrapper",href:`data:image/svg+xml;utf8,${encodeURIComponent(O)}`,dangerouslySetInnerHTML:{__html:O}})]},y)})]})]})}function he(){const{openSections:a,queries:s,queriesLoading:l,showAnalyzeQueryButton:n}=Object(f.useValues)(m.b),{setOpenSections:r,loadQueries:c}=Object(f.useActions)(m.b),[b,u]=Object(H.useState)(!1),y=Object(H.useMemo)(()=>{var v;return s==null||(v=s.postgres_running)===null||v===void 0?void 0:v.filter(h=>{let{state:Z}=h;return b||Z!=="idle"})},[b,s]),O=v=>{v.stopPropagation(),c()};return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)(z.a,{activeKey:a,onChange:v=>r(v),children:[Object(e.jsxs)(z.a.Panel,{header:"PostgreSQL - currently running queries",children:[Object(e.jsxs)("div",{className:"mb-4 float-right",children:[Object(e.jsx)(ge.a,{checked:b,onChange:v=>{u(v.target.checked)},children:"Show idle queries"}),Object(e.jsxs)(B.a,{style:{marginLeft:8},onClick:O,children:[Object(e.jsx)(Y.a,{})," Reload Queries"]})]}),Object(e.jsx)(G,{queries:y,loading:l})]},"1"),(s==null?void 0:s.clickhouse_running)!=null?Object(e.jsxs)(z.a.Panel,{header:"Clickhouse - currently running queries",children:[Object(e.jsx)("div",{className:"mb-4 float-right",children:Object(e.jsxs)(B.a,{style:{marginLeft:8},onClick:O,children:[Object(e.jsx)(Y.a,{})," Reload Queries"]})}),Object(e.jsx)(G,{queries:s==null?void 0:s.clickhouse_running,loading:l,showAnalyze:n})]},"2"):null,(s==null?void 0:s.clickhouse_slow_log)!=null?Object(e.jsxs)(z.a.Panel,{header:"Clickhouse - slow query log (past 6 hours)",children:[Object(e.jsx)("div",{className:"mb-4 float-right",children:Object(e.jsxs)(B.a,{style:{marginLeft:8},onClick:O,children:[Object(e.jsx)(Y.a,{})," Reload Queries"]})}),Object(e.jsx)(G,{queries:s==null?void 0:s.clickhouse_slow_log,loading:l,showAnalyze:n})]},"3"):null]}),Object(e.jsx)(pe,{})]})}function G(a){const{openAnalyzeModalWithQuery:s}=Object(f.useActions)(m.b),l=[{title:"duration",dataIndex:"duration",key:"duration",sorter:(n,r)=>+n.duration-+r.duration},{title:"query",dataIndex:"query",render:function(r,c){let{}=r;return a.showAnalyze?Object(e.jsx)(d.a,{to:"#",onClick:()=>s(c.query),children:c.query}):c.query},key:"query"}];return a.queries&&a.queries.length>0&&Object.keys(a.queries[0]).forEach(n=>{n!=="duration"&&n!=="query"&&l.push({title:n,dataIndex:n,key:n})}),Object(e.jsx)(ye.a,{dataSource:a.queries||[],columns:l,loading:a.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",bordered:!0,style:{overflowX:"auto",overflowY:"auto"},locale:{emptyText:"No queries found"}})}var J=t("./frontend/src/lib/components/LemonTable/index.ts"),Oe=t("./frontend/src/lib/hooks/useKeyboardHotkeys.tsx");function K(a){let{key:s,value:l,value_type:n,onValueChanged:r,isSecret:c}=a;if(n==="bool")return Object(e.jsx)(x.LemonCheckbox,{defaultChecked:!!l,onChange:u=>r(s,u),label:Object(e.jsx)(p.a,{type:l?"success":"danger",className:"uppercase",children:l?"Yes":"No"})});const b=c&&l?"":l;return Object(e.jsx)(x.LemonInput,{defaultValue:b,type:n==="int"?"number":"text",placeholder:c&&l?"Keep existing secret value":void 0,onBlur:u=>r(s,u.target.value)})}try{K.displayName="RenderMetricValueEdit",K.__docgenInfo={description:"",displayName:"RenderMetricValueEdit",props:{onValueChanged:{defaultValue:null,description:"",name:"onValueChanged",required:!0,type:{name:"(key: string, value: any) => void"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string | number | boolean | null"}},value_type:{defaultValue:null,description:"",name:"value_type",required:!1,type:{name:"enum",value:[{value:'"bool"'},{value:'"str"'},{value:'"int"'}]}},emptyNullLabel:{defaultValue:null,description:"",name:"emptyNullLabel",required:!1,type:{name:"string"}},isSecret:{defaultValue:null,description:"",name:"isSecret",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"]={docgenInfo:K.__docgenInfo,name:"RenderMetricValueEdit",path:"frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"})}catch(a){}var se=t("./frontend/src/lib/components/AlertMessage/index.ts");function ve(a){let{metricKey:s,oldValue:l,value:n,isSecret:r}=a;return(n==null?void 0:n.toString())===(l==null?void 0:l.toString())?null:Object(e.jsxs)("div",{className:"bg-border-light radius p-2",children:[Object(e.jsx)("div",{children:Object(e.jsx)("code",{children:s})}),Object(e.jsxs)("div",{className:"text-muted",children:["Value will be changed",!r&&Object(e.jsxs)(e.Fragment,{children:[" from ",Object(e.jsx)("span",{className:"font-bold text-default",children:T(null,{key:s,value:l,emptyNullLabel:"Unset",isSecret:r})})]})," to ",Object(e.jsx)("span",{className:"font-bold text-default",children:T(null,{key:s,value:n,emptyNullLabel:"Unset"})}),r&&Object(e.jsx)("div",{className:"text-danger",children:"This field is secret - you won't see its value once saved"})]})]})}function D(a){let{onClose:s,isOpen:l}=a;const{instanceConfigEditingState:n,editableInstanceSettings:r,updatedInstanceConfigCount:c}=Object(f.useValues)(m.b),{saveInstanceConfig:b}=Object(f.useActions)(m.b),u=c!==null;return Object(e.jsx)(x.LemonModal,{title:"Confirm new changes",isOpen:l,closable:!u,onClose:s,footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(x.LemonButton,{type:"secondary",onClick:s,loading:u,children:"Cancel"}),Object(e.jsx)(x.LemonButton,{type:"primary",status:"danger",loading:u,onClick:b,children:"Apply changes"})]}),children:Object(e.jsxs)("div",{className:"space-y-2",children:[Object.keys(n).find(y=>y.startsWith("EMAIL"))&&Object(e.jsx)(se.a,{type:"info",children:Object(e.jsxs)(e.Fragment,{children:["As you are changing email settings, we'll attempt to send a ",Object(e.jsx)("b",{children:"test email"})," so you can verify everything works (unless you are turning email off)."]})}),Object.keys(n).includes("RECORDINGS_TTL_WEEKS")&&Object(e.jsx)(se.a,{type:"warning",children:Object(e.jsx)(e.Fragment,{children:"Changing your recordings TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately."})}),Object(e.jsx)("div",{children:"The following changes will be immediately applied to your instance."}),Object.keys(n).map(y=>{var O,v;return Object(e.jsx)(ve,{metricKey:y,value:n[y],oldValue:(O=r.find(h=>h.key===y))===null||O===void 0?void 0:O.value,isSecret:(v=r.find(h=>h.key===y))===null||v===void 0?void 0:v.is_secret},y)}),u&&Object(e.jsx)("div",{className:"mt-4 text-success",children:Object(e.jsxs)("b",{children:[Object(g.ub)(c||0,"change")," updated successfully."]})})]})})}try{D.displayName="InstanceConfigSaveModal",D.__docgenInfo={description:"",displayName:"InstanceConfigSaveModal",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"]={docgenInfo:D.__docgenInfo,name:"InstanceConfigSaveModal",path:"frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"})}catch(a){}function xe(){const{configOptions:a,preflightLoading:s}=Object(f.useValues)(i.a),{editableInstanceSettings:l,instanceSettingsLoading:n,instanceConfigMode:r,instanceConfigEditingState:c}=Object(f.useValues)(m.b),{loadInstanceSettings:b,setInstanceConfigMode:u,updateInstanceConfigValue:y,clearInstanceConfigEditing:O}=Object(f.useActions)(m.b);Object(H.useEffect)(()=>{b()},[]),Object(Oe.a)({e:{action:()=>u(m.a.Edit),disabled:r!==m.a.View||n},escape:{action:()=>h(),disabled:r!==m.a.Edit||n},enter:{action:()=>v(),disabled:r!==m.a.Edit||n}});const v=()=>{Object.keys(c).length?u(m.a.Saving):u(m.a.View)},h=()=>{u(m.a.View),O()},Z=[{title:"Key",dataIndex:"key",render:function(q){return Object(e.jsx)("code",{children:q})}},{title:"Description",dataIndex:"description"},{title:"Value",render:function(q,R){var ee;const de={value:R.value,key:R.key,emptyNullLabel:"Unset",value_type:R.value_type,isSecret:R.is_secret};return r===m.a.View?T(q,de):K(te(V({},de),{value:(ee=c[R.key])!==null&&ee!==void 0?ee:R.value,onValueChanged:y}))}}],Pe=[{key:"metric",title:"Metric",dataIndex:"metric"},{title:"Value",dataIndex:"value"}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[Object(e.jsxs)("div",{className:"flex-1",children:[Object(e.jsx)("h3",{children:"Instance configuration"}),Object(e.jsxs)("div",{children:["Changing these settings will take effect on your entire instance."," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings",target:"_blank",children:["Learn more ",Object(e.jsx)(o.IconOpenInNew,{style:{verticalAlign:"middle"}})]}),"."]})]}),r===m.a.View?Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(x.LemonButton,{type:"primary",onClick:()=>u(m.a.Edit),"data-attr":"instance-config-edit-button",disabled:n,children:"Edit"})}):Object(e.jsxs)(e.Fragment,{children:[Object.keys(c).length>0&&Object(e.jsxs)("span",{className:"text-warning-dark flex items-center gap-2",children:[Object(e.jsx)(o.IconWarning,{className:"text-lg"})," You have"," ",Object(e.jsx)("b",{children:Object.keys(c).length})," unapplied"," ",Object(g.ub)(Object.keys(c).length,"change",void 0,!1)]}),Object(e.jsx)(x.LemonButton,{type:"secondary",disabled:n,onClick:h,children:"Discard changes"}),Object(e.jsx)(x.LemonButton,{type:"primary",disabled:n,onClick:v,children:"Save"})]})]}),Object(e.jsx)(J.a,{dataSource:l,columns:Z,loading:n,rowKey:"key"}),Object(e.jsxs)("div",{className:"my-4",children:[Object(e.jsx)("h3",{children:"Environment configuration"}),Object(e.jsxs)("div",{children:["These settings can only be modified by environment variables."," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/environment-variables",target:"_blank",children:["Learn more ",Object(e.jsx)(o.IconOpenInNew,{style:{verticalAlign:"middle"}})]}),"."]})]}),Object(e.jsx)(J.a,{dataSource:a,columns:Pe,loading:s,rowKey:"key"}),Object(e.jsx)(D,{isOpen:r===m.a.Saving,onClose:()=>u(m.a.Edit)})]})}var F=t("./frontend/src/scenes/userLogic.ts"),Se=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/modal/index.js"),ae=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/divider/index.js"),Ie=t("./frontend/src/lib/components/ProfilePicture/index.ts"),Ce=t("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),Q=t("./frontend/src/lib/api.ts"),Le=t("./frontend/src/scenes/urls.ts");const ie=Object(f.kea)({path:["scenes","instance","SystemStatus","staffUsersLogic"],connect:{values:[F.a,["user"]],actions:[F.a,["loadUser"]]},actions:{setStaffUsersToBeAdded:a=>({userUuids:a}),addStaffUsers:!0,deleteStaffUser:a=>({userUuid:a})},reducers:{staffUsersToBeAdded:[[],{setStaffUsersToBeAdded:(a,s)=>{let{userUuids:l}=s;return l}}]},loaders:a=>{let{actions:s,values:l}=a;return{allUsers:[[],{loadAllUsers:()=>I(this,null,function*(){var n;return(n=(yield Q.b.get("api/users")).results)!==null&&n!==void 0?n:[]}),addStaffUsers:()=>I(this,null,function*(){const{staffUsersToBeAdded:n,allUsers:r}=l;s.setStaffUsersToBeAdded([]);const c=yield Promise.all(n.map(u=>I(this,null,function*(){return yield Q.b.update(`api/users/${u}`,{is_staff:!0})}))),b=[...r.filter(u=>{let{uuid:y}=u;return!n.includes(y)}),...c];return b.sort((u,y)=>u.first_name.localeCompare(y.first_name)),b}),deleteStaffUser:n=>I(this,null,function*(){var r;let{userUuid:c}=n;yield Q.b.update(`api/users/${c}`,{is_staff:!1}),((r=l.user)===null||r===void 0?void 0:r.uuid)===c&&(s.loadUser(),Ce.router.actions.push(Le.a.projectHomepage()));const b=[...l.allUsers];for(const u of b)u.uuid===c&&(u.is_staff=!1);return b})}]}},selectors:{staffUsers:[a=>[a.allUsers],a=>a.filter(s=>s.is_staff)],nonStaffUsers:[a=>[a.allUsers],a=>a.filter(s=>!s.is_staff)]},events:a=>{let{actions:s}=a;return{afterMount:[s.loadAllUsers]}}});var oe=t("./frontend/src/lib/components/LemonButton/index.ts"),Ee=t("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),Te=t("./frontend/src/lib/components/UserSelectItem.tsx");function Ae(){const{user:a}=Object(f.useValues)(F.a),{staffUsers:s,allUsersLoading:l,nonStaffUsers:n,staffUsersToBeAdded:r}=Object(f.useValues)(ie),{setStaffUsersToBeAdded:c,addStaffUsers:b,deleteStaffUser:u}=Object(f.useActions)(ie),y=[{key:"profile_picture",render:function(v,h){return Object(e.jsx)(Ie.b,{name:h.first_name,email:h.email})},width:32},{key:"name",title:"Name",dataIndex:"first_name",render:function(v,h){return Object(e.jsxs)(e.Fragment,{children:[h.first_name,h.uuid===(a==null?void 0:a.uuid)&&Object(e.jsx)(p.a,{className:"uppercase ml-1",children:"Me"})]})}},{key:"email",title:"Email",dataIndex:"email"},{key:"actions",width:32,render:function(v,h){return Object(e.jsx)(oe.a,{"data-attr":"invite-delete",icon:Object(e.jsx)(o.IconDelete,{}),status:"danger",disabled:s.length<2,title:s.length<2?"You should always have at least one staff user.":"Cancel the invite",onClick:()=>{Se.a.confirm({title:`Remove ${(a==null?void 0:a.uuid)===h.uuid?"yourself":h.first_name} as a Staff User?`,icon:null,okText:"Remove user",okType:"primary",okButtonProps:{className:"btn-danger"},content:Object(e.jsx)("div",{style:{border:""},children:(a==null?void 0:a.uuid)===h.uuid?Object(e.jsxs)(e.Fragment,{children:["Please confirm you want to ",Object(e.jsx)("b",{children:"remove yourself"})," as a staff user.",Object(e.jsx)("div",{style:{fontWeight:"normal",color:"var(--muted-alt)"},children:"Only another staff user will be able to add you again."})]}):`Are you sure you want to remove ${h.first_name} as a Staff User?`}),onOk(){u(h.uuid)},cancelText:"Cancel"})}})}}];return Object(e.jsxs)("div",{children:[Object(e.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Staff Users"}),Object(e.jsxs)("div",{className:"mb-4",children:["Users who have permissions to manage instance-wide settings. Staff user permissions are set at the"," ",Object(e.jsx)("b",{children:"instance-level and are independent of any organization or project permissions."})," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings#staff-users",target:"_blank",children:["Learn more ",Object(e.jsx)(o.IconOpenInNew,{style:{verticalAlign:"middle"}})]}),"."]}),Object(e.jsx)(ae.a,{style:{margin:0,marginBottom:16}}),Object(e.jsx)("section",{children:Object(e.jsxs)("div",{className:"flex gap-2 mb-4",children:[Object(e.jsx)("div",{style:{flex:1},children:Object(e.jsx)(Ee.a,{placeholder:"Add staff users here\u2026",loading:l,value:r,onChange:O=>c(O),filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:Object(Te.a)(n,"uuid")})}),Object(e.jsx)(oe.a,{type:"primary",loading:l,disabled:r.length===0,onClick:b,children:"Add"})]})}),Object(e.jsx)(J.a,{dataSource:s,columns:y,loading:l,rowKey:"uuid"})]})}var ke=t("./frontend/src/lib/logic/featureFlagLogic.ts"),we=t("./frontend/src/lib/constants.tsx"),Me=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/row/index.js"),$=t("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/col/index.js"),le=t("./frontend/src/lib/components/CodeSnippet/index.tsx"),_=t("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.0/node_modules/kea-forms/lib/index.js"),Ne=t("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js");const re=Object(f.kea)([Object(f.path)(["scenes","instance","SystemStatus","kafkaInspectorLogic"]),Object(f.actions)({fetchKafkaMessage:(a,s,l)=>({topic:a,partition:s,offset:l})}),Object(Ne.loaders)({kafkaMessage:[null,{fetchKafkaMessage:a=>I(this,null,function*(){let{topic:s,partition:l,offset:n}=a;return yield Q.b.create("api/kafka_inspector/fetch_message",{topic:s,partition:l,offset:n})})}]}),Object(_.forms)(a=>{let{actions:s}=a;return{fetchKafkaMessage:{defaults:{topic:"clickhouse_events_json",partition:0,offset:0},submit:l=>{let{topic:n,partition:r,offset:c}=l;s.fetchKafkaMessage(n,Number(r),Number(c))}}}})]);var X=t("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function Ue(){const{kafkaMessage:a}=Object(f.useValues)(re);return Object(e.jsxs)("div",{children:[Object(e.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Kafka Inspector"}),Object(e.jsx)("div",{className:"mb-4",children:"Debug Kafka messages using the inspector tool."}),Object(e.jsx)(ae.a,{style:{margin:0,marginBottom:16}}),Object(e.jsx)("section",{children:Object(e.jsx)("div",{style:{display:"flex",marginBottom:"0.75rem"},children:Object(e.jsx)(_.Form,{logic:re,formKey:"fetchKafkaMessage",className:"ant-form-horizontal ant-form-hide-required-mark",enableFormOnSubmit:!0,children:Object(e.jsxs)(Me.a,{gutter:[24,24],children:[Object(e.jsx)($.a,{span:8,children:Object(e.jsx)(_.Field,{name:"topic",children:Object(e.jsx)(X.a,{placeholder:"Topic"})})}),Object(e.jsxs)($.a,{span:4,children:[Object(e.jsx)(_.Field,{name:"partition",children:Object(e.jsx)(X.a,{placeholder:"Partition",type:"number"})})," "]}),Object(e.jsxs)($.a,{span:4,children:[Object(e.jsx)(_.Field,{name:"offset",children:Object(e.jsx)(X.a,{placeholder:"Offset",type:"number"})})," "]}),Object(e.jsx)($.a,{span:6,children:Object(e.jsxs)(B.a,{htmlType:"submit",type:"primary","data-attr":"fetch-kafka-message-submit-button",children:["Fetch message"," "]})})]})})})}),Object(e.jsx)(le.a,{language:le.b.JSON,children:a?JSON.stringify(a,null,4):`
`})]})}const Re={component:ce,logic:m.b};function ce(){const{tab:a,error:s}=Object(f.useValues)(m.b),{setTab:l}=Object(f.useActions)(m.b),{preflight:n,siteUrlMisconfigured:r}=Object(f.useValues)(i.a),{user:c}=Object(f.useValues)(F.a),{featureFlags:b}=Object(f.useValues)(ke.a);return Object(e.jsxs)("div",{className:"system-status-scene",children:[Object(e.jsx)(W.a,{title:"Instance status & settings",caption:Object(e.jsxs)(e.Fragment,{children:["Here you can find all the critical runtime details and settings of your PostHog instance. You have access to this because you're a ",Object(e.jsx)("b",{children:"staff user"}),"."," ",Object(e.jsxs)("a",{target:"_blank",style:{display:"inline-flex",alignItems:"center"},href:"https://posthog.com/docs/self-host/configure/instance-settings?utm_medium=in-product&utm_campaign=instance_status",children:["Learn more ",Object(e.jsx)(o.IconOpenInNew,{style:{marginLeft:4}})]}),"."]})}),s&&Object(e.jsx)(P.a,{message:"Something went wrong",description:s||Object(e.jsx)("span",{children:"An unknown error occurred. Please try again or contact us."}),type:"error",showIcon:!0}),r&&Object(e.jsx)(P.a,{message:"Misconfiguration detected",description:Object(e.jsxs)(e.Fragment,{children:["Your ",Object(e.jsx)("code",{children:"SITE_URL"})," environment variable seems misconfigured. Your"," ",Object(e.jsx)("code",{children:"SITE_URL"})," is set to"," ",Object(e.jsx)("b",{children:Object(e.jsx)("code",{children:n==null?void 0:n.site_url})})," ","but you're currently browsing this page from"," ",Object(e.jsx)("b",{children:Object(e.jsx)("code",{children:window.location.origin})}),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."," ",Object(e.jsxs)("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig",children:["Learn more ",Object(e.jsx)(o.IconOpenInNew,{})]})]}),showIcon:!0,type:"warning",style:{marginBottom:32}}),Object(e.jsxs)(A.a,{tabPosition:"top",animated:!1,activeKey:a,onTabClick:u=>l(u),children:[Object(e.jsx)(A.a.TabPane,{tab:"System overview",children:Object(e.jsx)(je,{})},"overview"),(c==null?void 0:c.is_staff)&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(A.a.TabPane,{tab:"Internal metrics",children:Object(e.jsx)(he,{})},"metrics"),Object(e.jsx)(A.a.TabPane,{tab:Object(e.jsxs)(e.Fragment,{children:["Settings"," ",Object(e.jsx)(p.a,{type:"warning",className:"uppercase",children:"Beta"})]}),children:Object(e.jsx)(xe,{})},"settings")]}),(c==null?void 0:c.is_staff)&&Object(e.jsx)(A.a.TabPane,{tab:Object(e.jsx)(e.Fragment,{children:"Staff Users"}),children:Object(e.jsx)(Ae,{})},"staff_users"),(c==null?void 0:c.is_staff)&&b[we.i.KAFKA_INSPECTOR]&&Object(e.jsx)(A.a.TabPane,{tab:Object(e.jsxs)(e.Fragment,{children:["Kafka Inspector"," ",Object(e.jsx)(p.a,{type:"warning",className:"uppercase",children:"Beta"})]}),children:Object(e.jsx)(Ue,{})},"kafka_inspector")]})]})}},"./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts":function(S,j,t){"use strict";t.d(j,"a",function(){return m}),t.d(j,"b",function(){return W});var C=t("./frontend/src/lib/api.ts"),M=t("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),N=t("./frontend/src/scenes/userLogic.ts"),k=t("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),E=t("./frontend/src/scenes/organizationLogic.tsx"),L=t("./frontend/src/lib/constants.tsx"),U=t("./frontend/src/lib/utils.tsx"),P=t("./frontend/src/lib/components/lemonToast.tsx"),A=t("./frontend/src/lib/utils/eventUsageLogic.ts");let m;(function(i){i.View="view",i.Edit="edit",i.Saving="saving"})(m||(m={}));const f=["RECORDINGS_TTL_WEEKS","EMAIL_ENABLED","EMAIL_HOST","EMAIL_PORT","EMAIL_HOST_USER","EMAIL_HOST_PASSWORD","EMAIL_USE_TLS","EMAIL_USE_SSL","EMAIL_DEFAULT_FROM","EMAIL_REPLY_TO","AGGREGATE_BY_DISTINCT_IDS_TEAMS","PERSON_ON_EVENTS_ENABLED","GROUPS_ON_EVENTS_ENABLED","STRICT_CACHING_TEAMS","SLACK_APP_CLIENT_ID","SLACK_APP_CLIENT_SECRET","SLACK_APP_SIGNING_SECRET","PARALLEL_DASHBOARD_ITEM_CACHE","SENTRY_AUTH_TOKEN","SENTRY_ORGANIZATION"],W=Object(M.kea)({path:["scenes","instance","SystemStatus","systemStatusLogic"],actions:{setTab:i=>({tab:i}),setOpenSections:i=>({sections:i}),setAnalyzeModalOpen:i=>({isOpen:i}),setAnalyzeQuery:i=>({query:i}),openAnalyzeModalWithQuery:i=>({query:i}),setInstanceConfigMode:i=>({mode:i}),updateInstanceConfigValue:(i,o)=>({key:i,value:o}),clearInstanceConfigEditing:!0,saveInstanceConfig:!0,setUpdatedInstanceConfigCount:i=>({count:i}),increaseUpdatedInstanceConfigCount:!0},loaders:i=>{let{values:o}=i;return{systemStatus:[null,{loadSystemStatus:()=>I(this,null,function*(){var d,p,g;return!Object(U.lb)()||(d=k.a.values.preflight)!==null&&d!==void 0&&d.cloud&&!((p=N.a.values.user)!==null&&p!==void 0&&p.is_staff)?null:(g=(yield C.b.get("api/instance_status")).results)!==null&&g!==void 0?g:null})}],instanceSettings:[[],{loadInstanceSettings:()=>I(this,null,function*(){var d;return(d=(yield C.b.get("api/instance_settings")).results)!==null&&d!==void 0?d:[]})}],queries:[null,{loadQueries:()=>I(this,null,function*(){return(yield C.b.get("api/instance_status/queries")).results})}],analyzeQueryResult:[null,{setAnalyzeModalOpen:()=>null,runAnalyzeQuery:()=>I(this,null,function*(){return(yield C.b.create("api/instance_status/analyze_ch_query",{query:o.analyzeQuery})).results})}]}},reducers:{tab:["overview",{setTab:(i,o)=>{let{tab:d}=o;return d}}],error:[null,{loadSystemStatusFailure:(i,o)=>{let{error:d}=o;return d}}],openSections:[["0"],{persist:!0},{setOpenSections:(i,o)=>{let{sections:d}=o;return d}}],analyzeModalOpen:[!1,{setAnalyzeModalOpen:(i,o)=>{let{isOpen:d}=o;return d},openAnalyzeModalWithQuery:()=>!0}],analyzeQuery:["",{setAnalyzeQuery:(i,o)=>{let{query:d}=o;return d},openAnalyzeModalWithQuery:(i,o)=>{let{query:d}=o;return d}}],instanceConfigMode:[m.View,{setInstanceConfigMode:(i,o)=>{let{mode:d}=o;return d}}],instanceConfigEditingState:[{},{updateInstanceConfigValue:(i,o)=>{let{key:d,value:p}=o;if(p!==void 0)return te(V({},i),{[d]:p});const g=V({},i);return delete g[d],g},clearInstanceConfigEditing:()=>({})}],updatedInstanceConfigCount:[null,{setUpdatedInstanceConfigCount:(i,o)=>{let{count:d}=o;return d},loadInstanceSettings:()=>null,increaseUpdatedInstanceConfigCount:i=>(i!=null?i:0)+1}]},selectors:()=>({overview:[i=>[i.systemStatus],i=>i?i.overview:[]],showAnalyzeQueryButton:[()=>[k.a.selectors.preflight,E.a.selectors.currentOrganization,N.a.selectors.user],(i,o,d)=>i!=null&&i.cloud?!!(d!=null&&d.is_staff):!!(o!=null&&o.membership_level)&&o.membership_level>=L.p.Admin],editableInstanceSettings:[i=>[i.instanceSettings],i=>i.filter(o=>o.editable&&f.includes(o.key))]}),listeners:i=>{let{actions:o,values:d}=i;return{setTab:p=>{let{tab:g}=p;g==="metrics"&&o.loadQueries(),o.setInstanceConfigMode(m.View)},updateInstanceConfigValue:p=>{var g;let{key:e,value:w}=p;const T=(g=d.editableInstanceSettings.find(x=>x.key===e))===null||g===void 0?void 0:g.value;w&&T==w&&o.updateInstanceConfigValue(e,void 0)},saveInstanceConfig:(p,g)=>I(this,null,function*(){o.setUpdatedInstanceConfigCount(0),Object.entries(d.instanceConfigEditingState).map(e=>I(this,null,function*(){let[w,T]=e;try{yield C.b.update(`api/instance_settings/${w}`,{value:T}),A.e.actions.reportInstanceSettingChange(w,T),o.increaseUpdatedInstanceConfigCount()}catch(x){P.d.error("There was an error updating instance settings \u2013 please try again"),yield g(1e3),o.loadInstanceSettings()}})),yield g(1e3),d.updatedInstanceConfigCount===Object.keys(d.instanceConfigEditingState).length&&(o.loadInstanceSettings(),o.clearInstanceConfigEditing(),o.setInstanceConfigMode(m.View),P.d.success("Instance settings updated"))})}},events:i=>{let{actions:o}=i;return{afterMount:()=>{o.loadSystemStatus()}}},actionToUrl:i=>{let{values:o}=i;return{setTab:()=>"/instance/"+(o.tab==="overview"?"status":o.tab)}},urlToAction:i=>{let{actions:o,values:d}=i;return{"/instance(/:tab)":p=>{let{tab:g}=p;const e=g&&["metrics","settings","staff_users","kafka_inspector"].includes(g)?g:"overview";e!==d.tab&&o.setTab(e)}}}})},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss":function(S,j,t){var C=t("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js");j=C(!1),j.push([S.i,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}.embedded-svg-wrapper{cursor:text}.embedded-svg-wrapper svg{width:100%;height:100%}",""]),S.exports=j}}]);
