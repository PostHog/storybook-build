(window.webpackJsonp=window.webpackJsonp||[]).push([[5,6,8,10,309],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(W,c,e){"use strict";e.r(c);var T=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),D=e.n(T),j=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),d=e.n(j),L={};L.insert="head",L.singleton=!1;var A=D()(d.a,L);c.default=d.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(W,c,e){"use strict";e.r(c),e.d(c,"AppMetricsGraph",function(){return G});var T=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),D=e.n(T),j=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),d=e.n(j),L=e("./node_modules/core-js/modules/es.array.concat.js"),A=e.n(L),$=e("./node_modules/core-js/modules/es.object.keys.js"),Y=e.n($),z=e("./node_modules/core-js/modules/es.symbol.js"),w=e.n(z),J=e("./node_modules/core-js/modules/es.array.filter.js"),n=e.n(J),Q=e("./node_modules/core-js/modules/es.object.to-string.js"),N=e.n(Q),B=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),S=e.n(B),F=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),l=e.n(F),b=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),I=e.n(b),i=e("./node_modules/react/index.js"),C=e.n(i),E=e("./frontend/src/lib/colors.ts"),x=e("./node_modules/chart.js/dist/chart.mjs"),m=e("./frontend/src/scenes/apps/constants.tsx"),P=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),y=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),U=e("./frontend/src/lib/utils.tsx"),h=e("./node_modules/react/jsx-runtime.js"),Z=e.n(h);function V(u,v){var _=Object.keys(u);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(u);v&&(g=g.filter(function(s){return Object.getOwnPropertyDescriptor(u,s).enumerable})),_.push.apply(_,g)}return _}function X(u){for(var v=1;v<arguments.length;v++){var _=arguments[v]!=null?arguments[v]:{};v%2?V(Object(_),!0).forEach(function(g){D()(u,g,_[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(_)):V(Object(_)).forEach(function(g){Object.defineProperty(u,g,Object.getOwnPropertyDescriptor(_,g))})}return u}function G(u){var v=u.tab,_=u.metrics,g=u.metricsLoading,s=Object(i.useRef)(null),o=m.DescriptionColumns[v];return Object(i.useEffect)(function(){var r;if(s.current&&_){var t;r=new x.a((t=s.current)===null||t===void 0?void 0:t.getContext("2d"),{type:"line",data:{labels:_.dates,datasets:[X({label:o.successes,data:_.successes,borderColor:""},O("data-brand-blue"))].concat(d()(o.successes_on_retry?[X({label:o.successes_on_retry,data:_.successes_on_retry},O("data-yellow"))]:[]),[X({label:o.failures,data:_.failures},O("data-pink"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var a;(a=r)===null||a===void 0||a.destroy()}},[_]),g||!_?Object(h.jsx)(P.a,{className:"AppMetricsGraph"}):Object(h.jsx)("div",{className:"AppMetricsGraph",children:Object(h.jsx)("canvas",{ref:s})})}function O(u){var v=Object(E.b)(u);return{borderColor:v,hoverBorderColor:Object(U.lb)(v,-20),hoverBackgroundColor:Object(U.lb)(v,-20),backgroundColor:v,fill:!1,borderWidth:2,pointRadius:0}}try{G.displayName="AppMetricsGraph",G.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:G.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(u){}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(W,c,e){"use strict";e.r(c),e.d(c,"MetricsTab",function(){return N}),e.d(c,"MetricsOverview",function(){return B}),e.d(c,"ErrorsOverview",function(){return S});var T=e("./node_modules/antd/es/card/index.js"),D=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),j=e("./frontend/src/scenes/apps/constants.tsx"),d=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),L=e("./frontend/src/lib/utils.tsx"),A=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),$=e("./frontend/src/lib/components/LemonSelect.tsx"),Y=e("./node_modules/kea/lib/index.esm.js"),z=e("./frontend/src/lib/components/LemonTable/index.ts"),w=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),J=e("./frontend/src/lib/components/Link.tsx"),n=e("./node_modules/react/jsx-runtime.js"),Q=e.n(n);function N(l){var b=l.tab,I=Object(Y.useValues)(D.appMetricsSceneLogic),i=I.appMetricsResponse,C=I.appMetricsResponseLoading,E=I.dateFrom,x=Object(Y.useActions)(D.appMetricsSceneLogic),m=x.setDateFrom;return Object(n.jsxs)("div",{className:"mt-4",children:[Object(n.jsx)(T.a,{title:Object(n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[Object(n.jsx)("span",{children:"Metrics overview"}),Object(n.jsx)($.a,{value:E,onChange:function(y){return m(y)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),children:Object(n.jsx)(B,{tab:b,metrics:i==null?void 0:i.metrics,metricsLoading:C})}),Object(n.jsx)(T.a,{title:"Delivery trends",className:"mt-4",children:Object(n.jsx)(A.AppMetricsGraph,{tab:b,metrics:i==null?void 0:i.metrics,metricsLoading:C})}),Object(n.jsx)(T.a,{title:"Errors",className:"mt-4",children:Object(n.jsx)(S,{category:b,errors:(i==null?void 0:i.errors)||[],loading:C})})]})}function B(l){var b,I,i,C=l.tab,E=l.metrics,x=l.metricsLoading;return x?Object(n.jsx)(d.a,{className:"h-20"}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{className:"card-secondary",children:j.DescriptionColumns[C].successes}),Object(n.jsx)("div",{children:F(E==null||(b=E.totals)===null||b===void 0?void 0:b.successes)})]}),j.DescriptionColumns[C].successes_on_retry&&Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{className:"card-secondary",children:j.DescriptionColumns[C].successes_on_retry}),Object(n.jsx)("div",{children:F(E==null||(I=E.totals)===null||I===void 0?void 0:I.successes_on_retry)})]}),Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{className:"card-secondary",children:j.DescriptionColumns[C].failures}),Object(n.jsx)("div",{children:F(E==null||(i=E.totals)===null||i===void 0?void 0:i.failures)})]})]})}function S(l){var b=l.errors,I=l.loading,i=l.category,C=l.jobId,E=Object(Y.useActions)(D.appMetricsSceneLogic),x=E.openErrorDetailsDrawer;return Object(n.jsx)(z.a,{dataSource:b,loading:I,columns:[{title:"Error type",dataIndex:"error_type",render:function(P,y){return Object(n.jsx)(J.a,{title:"View details",className:"font-semibold",onClick:function(h){h.preventDefault(),x(y.error_type,i,C)},children:y.error_type})},sorter:function(P,y){return P.error_type.localeCompare(y.error_type)}},{title:"Count",dataIndex:"count",align:"right",sorter:function(P,y){return P.count-y.count}},{title:"Last seen",dataIndex:"last_seen",render:function(P){return Object(n.jsx)("div",{className:"whitespace-nowrap text-right",children:Object(n.jsx)(w.b,{time:P})})},align:"right",sorter:function(P,y){return new Date(P.last_seen||0)>new Date(y.last_seen||0)?1:-1}}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0})}function F(l){return Object(n.jsx)(n.Fragment,{children:l&&Object(L.P)(l)})}try{N.displayName="MetricsTab",N.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:N.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(l){}try{B.displayName="MetricsOverview",B.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:B.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(l){}try{S.displayName="ErrorsOverview",S.__docgenInfo={description:"",displayName:"ErrorsOverview",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"AppErrorSummary[]"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},category:{defaultValue:null,description:"",name:"category",required:!0,type:{name:"string"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"]={docgenInfo:S.__docgenInfo,name:"ErrorsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"})}catch(l){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(W,c,e){"use strict";e.r(c),e.d(c,"AppMetricsTab",function(){return O}),e.d(c,"appMetricsSceneLogic",function(){return _});var T=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),D=e.n(T),j=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),d=e.n(j),L=e("./node_modules/@babel/runtime/regenerator/index.js"),A=e.n(L),$=e("./node_modules/core-js/modules/es.array.iterator.js"),Y=e.n($),z=e("./node_modules/core-js/modules/es.object.to-string.js"),w=e.n(z),J=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),n=e.n(J),Q=e("./node_modules/core-js/modules/es.array.concat.js"),N=e.n(Q),B=e("./node_modules/core-js/modules/es.function.name.js"),S=e.n(B),F=e("./node_modules/core-js/modules/es.array.includes.js"),l=e.n(F),b=e("./node_modules/core-js/modules/es.string.includes.js"),I=e.n(b),i=e("./node_modules/core-js/modules/es.array.filter.js"),C=e.n(i),E=e("./node_modules/core-js/modules/es.number.constructor.js"),x=e.n(E),m=e("./node_modules/kea/lib/index.esm.js"),P=e("./node_modules/kea-loaders/lib/index.js"),y=e.n(P),U=e("./frontend/src/scenes/urls.ts"),h=e("./frontend/src/lib/api.ts"),Z=e("./frontend/src/scenes/teamLogic.tsx"),V=e("./node_modules/kea-router/lib/index.js"),X=e.n(V),G=e("./frontend/src/lib/utils.tsx"),O;(function(s){s.ProcessEvent="processEvent",s.OnEvent="onEvent",s.ExportEvents="exportEvents",s.HistoricalExports="historical_exports"})(O||(O={}));var u="-30d",v=[O.ProcessEvent,O.OnEvent,O.ExportEvents],_=Object(m.kea)([Object(m.path)(function(s){return["scenes","apps","appMetricsSceneLogic",s]}),Object(m.props)({}),Object(m.key)(function(s){return s.pluginConfigId}),Object(m.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}},openErrorDetailsDrawer:function(o,r,t){return{errorType:o,category:r,jobId:t}},closeErrorDetailsDrawer:!0}),Object(m.reducers)({activeTab:[null,{setActiveTab:function(o,r){var t=r.tab;return t}}],dateFrom:[u,{setDateFrom:function(o,r){var t=r.dateFrom;return t}}],errorDetailsDrawerError:[null,{openErrorDetailsDrawer:function(o,r){var t=r.errorType;return t},closeErrorDetailsDrawer:function(){return null}}]}),Object(P.loaders)(function(s){var o=s.values,r=s.props;return{pluginConfig:[null,{loadPluginConfig:function(){var t=d()(A.a.mark(function f(){return A.a.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,h.b.get("api/projects/".concat(Z.a.values.currentTeamId,"/plugin_configs/").concat(r.pluginConfigId));case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}},f)}));function a(){return t.apply(this,arguments)}return a}()}],appMetricsResponse:[null,{loadMetrics:function(){var t=d()(A.a.mark(function f(){var p;return A.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return p=Object(G.Eb)({category:o.activeTab,date_from:o.dateFrom}),R.next=3,h.b.get("api/projects/".concat(Z.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"?").concat(p));case 3:return R.abrupt("return",R.sent);case 4:case"end":return R.stop()}},f)}));function a(){return t.apply(this,arguments)}return a}()}],historicalExports:[[],{loadHistoricalExports:function(){var t=d()(A.a.mark(function f(){var p,M;return A.a.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,h.b.get("api/projects/".concat(Z.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/historical_exports"));case 2:return p=K.sent,M=p.results,K.abrupt("return",M);case 5:case"end":return K.stop()}},f)}));function a(){return t.apply(this,arguments)}return a}()}],errorDetails:[[],{openErrorDetailsDrawer:function(){var t=d()(A.a.mark(function f(p){var M,R,K,k,q,ee;return A.a.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return M=p.category,R=p.jobId,K=p.errorType,k=Object(G.Eb)({category:M,job_id:R,error_type:K}),H.next=4,h.b.get("api/projects/".concat(Z.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/error_details?").concat(k));case 4:return q=H.sent,ee=q.result,H.abrupt("return",ee);case 7:case"end":return H.stop()}},f)}));function a(f){return t.apply(this,arguments)}return a}()}]}}),Object(m.selectors)(function(s){var o=s.values;return{breadcrumbs:[function(r){return[r.pluginConfig,function(t,a){return a.pluginConfigId}]},function(r,t){var a;return[{name:"Apps",path:U.a.projectApps()},{name:r==null||(a=r.plugin_info)===null||a===void 0?void 0:a.name,path:U.a.appMetrics(t)}]}],showTab:[function(){return[]},function(){return function(r){var t;if(o.pluginConfigLoading||!o.pluginConfig)return!1;var a=((t=o.pluginConfig.plugin_info.capabilities)===null||t===void 0?void 0:t.methods)||[];return r===O.HistoricalExports?a.includes("exportEvents"):r===O.OnEvent&&a.includes("exportEvents")?!1:a.includes(r)}}]}}),Object(m.listeners)(function(s){var o=s.values,r=s.actions;return{loadPluginConfigSuccess:function(){if(!o.activeTab){var a=v.filter(function(M){return o.showTab(M)}),f=D()(a,1),p=f[0];r.setActiveTab(p)}},setActiveTab:function(a){var f=a.tab;f===O.HistoricalExports?r.loadHistoricalExports():r.loadMetrics()},setDateFrom:function(){r.loadMetrics()}}}),Object(V.actionToUrl)(function(s){var o=s.values,r=s.props;return{setActiveTab:function(){return g(o,r)},setDateFrom:function(){return g(o,r)}}}),Object(V.urlToAction)(function(s){var o=s.values,r=s.actions,t=s.props;return{"/app/:pluginConfigId/:page":function(f,p){t.pluginConfigId===Number(f.pluginConfigId)&&(o.pluginConfig||r.loadPluginConfig(),f.page===O.HistoricalExports?r.setActiveTab(O.HistoricalExports):(p.tab&&v.includes(p.tab)&&r.setActiveTab(p.tab),p.from&&r.setDateFrom(p.from)))}}})]);function g(s,o){if(s.activeTab===O.HistoricalExports)return U.a.appHistoricalExports(o.pluginConfigId);var r={};return s.activeTab&&(r.tab=s.activeTab),s.dateFrom!==u&&(r.from=s.dateFrom),U.a.appMetrics(o.pluginConfigId,r)}},"./frontend/src/scenes/apps/constants.tsx":function(W,c,e){"use strict";e.r(c),e.d(c,"DescriptionColumns",function(){return L});var T=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),D=e.n(T),j=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),d,L=(d={},D()(d,j.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),D()(d,j.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),D()(d,j.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),D()(d,j.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),d)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(W,c,e){var T=e("./node_modules/css-loader/dist/runtime/api.js");c=T(!1),c.push([W.i,".AppMetricsGraph{height:300px}",""]),W.exports=c}}]);
