"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[28029],{"../../frontend/src/lib/components/AppMetrics/AppMetricSummary.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{p:()=>AppMetricSummary});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/utils.tsx"),_queries_nodes_DataVisualization_Components_Charts_LineGraph__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Charts/LineGraph.tsx"),_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/types.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AppMetricSummary(_ref){let{name,timeSeries,previousPeriodTimeSeries,description,color,colorIfZero,loading}=_ref,total=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>timeSeries?timeSeries.series.reduce((acc,curr)=>acc+curr.values.reduce((acc,curr)=>acc+curr,0),0):0,[timeSeries]),totalPreviousPeriod=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>previousPeriodTimeSeries?previousPeriodTimeSeries.series.reduce((acc,curr)=>acc+curr.values.reduce((acc,curr)=>acc+curr,0),0):0,[previousPeriodTimeSeries]),diff=(total-totalPreviousPeriod)/totalPreviousPeriod;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex flex-1 flex-col relative border rounded p-3 bg-surface-primary min-w-[16rem]",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex flex-row justify-between items-start",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.HQ,{info:description,children:name}),loading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.yW,{className:"w-20 h-6 mb-2"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"text-right text-2xl text-muted-foreground",children:(0,lib_utils__WEBPACK_IMPORTED_MODULE_2__.Lc)(total)})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"flex flex-row justify-end items-center gap-2 text-xs text-muted",children:loading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.yW,{className:"w-10 h-4"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.Fragment,{children:diff>0?` (+${(100*diff).toFixed(1)}%)`:` (-${(-(100*diff)).toFixed(1)}%)`})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"flex-1 mt-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"h-[10rem]",children:loading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.t2,{}):timeSeries?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_queries_nodes_DataVisualization_Components_Charts_LineGraph__WEBPACK_IMPORTED_MODULE_3__.x,{xData:{column:{name:"date",type:{name:"DATE",isNumerical:!1},label:"Date",dataIndex:0},data:timeSeries.labels},yData:timeSeries.series.map(x=>({column:{name:x.name,type:{name:"INTEGER",isNumerical:!0},label:x.name,dataIndex:0},data:x.values,settings:{display:{color:0===total?colorIfZero:color}}})),visualizationType:_types__WEBPACK_IMPORTED_MODULE_4__.Qb.ActionsLineGraph,chartSettings:{showLegend:!1,showTotalRow:!1,showXAxisBorder:!1,showYAxisBorder:!1,showXAxisTicks:!1,leftYAxisSettings:{showTicks:!1,showGridLines:!1}}}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.HQ,{children:"No data"})})})})]})}},"../../frontend/src/lib/components/AppMetrics/AppMetricsFilters.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>AppMetricsFilters});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),_posthog_icons__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.33.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),_DateFilter_DateFilter__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),_appMetricsLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/components/AppMetrics/appMetricsLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AppMetricsFilters(_ref){let{logicKey}=_ref,logic=(0,_appMetricsLogic__WEBPACK_IMPORTED_MODULE_4__.t)({logicKey}),{params,availableIntervals}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(logic),{setParams}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(logic);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex flex-row gap-2 flex-wrap",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.Yv,{options:[{label:"Hourly",value:"hour",disabledReason:availableIntervals.includes("hour")?void 0:"Please select a smaller date range"},{label:"Daily",value:"day",disabledReason:availableIntervals.includes("day")?void 0:"Please select a smaller date range"}],size:"small",value:params.interval,onChange:value=>setParams({interval:value})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_DateFilter_DateFilter__WEBPACK_IMPORTED_MODULE_3__.f,{dateTo:params.dateTo,dateFrom:params.dateFrom,onChange:(from,to)=>setParams({dateFrom:from||void 0,dateTo:to||void 0}),allowedRollingDateOptions:["days","weeks","months","years"],makeLabel:key=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_1__.IconCalendar,{})," ",key]})})]})}},"../../frontend/src/lib/components/AppMetrics/AppMetricsTrends.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>AppMetricsTrends});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),_queries_nodes_DataVisualization_Components_Charts_LineGraph__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Charts/LineGraph.tsx"),_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/types.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AppMetricsTrends(_ref){let{appMetricsTrends,loading}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"relative border rounded min-h-[20rem] h-[70vh] bg-white",children:loading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.t2,{}):appMetricsTrends?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_queries_nodes_DataVisualization_Components_Charts_LineGraph__WEBPACK_IMPORTED_MODULE_1__.x,{className:"p-2",xData:{column:{name:"date",type:{name:"DATE",isNumerical:!1},label:"Date",dataIndex:0},data:appMetricsTrends.labels},yData:appMetricsTrends.series.map(x=>({column:{name:x.name,type:{name:"INTEGER",isNumerical:!0},label:x.name,dataIndex:0},data:x.values})),visualizationType:_types__WEBPACK_IMPORTED_MODULE_2__.Qb.ActionsLineGraph,chartSettings:{showLegend:!0,showTotalRow:!1}}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"flex-1 flex items-center justify-center",children:"Missing"})})}},"../../frontend/src/scenes/data-pipelines/batch-exports/BatchExportIcon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{EL:()=>BATCH_EXPORT_ICON_MAP,oe:()=>RenderBatchExportIcon});var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),running_hog=__webpack_require__("../../frontend/public/hedgehog/running-hog.png"),aws_s3=__webpack_require__("../../frontend/public/services/aws-s3.png");let bigquery=__webpack_require__.p+"images/bigquery.1bd7c5187189fe1c78abeab849f5e0ec.png";var databricks=__webpack_require__("../../frontend/public/services/databricks.png");let postgres=__webpack_require__.p+"images/postgres.dc5b1b72f73b1a6c2c9d6d354a204e17.png",redshift=__webpack_require__.p+"images/redshift.943a52a8ba366d75ef13b578c582e1f4.png",snowflake=__webpack_require__.p+"images/snowflake.e08a91548c74ea3172ae2f0c9d22b0f8.png";var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function getBatchExportUrl(service){return`https://posthog.com/docs/cdp/batch-exports/${service.toLowerCase()}`}let BATCH_EXPORT_ICON_MAP={BigQuery:bigquery,Postgres:postgres,Redshift:redshift,S3:aws_s3.Z,Snowflake:snowflake,HTTP:running_hog.Z,Databricks:databricks.Z};function RenderBatchExportIcon(_ref){let{type,size="small"}=_ref,icon=BATCH_EXPORT_ICON_MAP[type],sizePx="small"===size?30:60;return(0,jsx_runtime.jsx)("div",{className:"flex gap-4 items-center",children:(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[type,(0,jsx_runtime.jsx)("br",{}),"Click to view docs"]}),children:(0,jsx_runtime.jsx)(src.rU,{to:getBatchExportUrl(type),children:(0,jsx_runtime.jsx)("img",{src:icon,alt:type,height:sizePx,width:sizePx})})})})}},"../../frontend/src/scenes/data-pipelines/batch-exports/BatchExportScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BatchExportScene:()=>BatchExportScene,BatchExportSceneContent:()=>BatchExportSceneContent,batchExportSceneLogic:()=>batchExportSceneLogic,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),FlaggedFeature=__webpack_require__("../../frontend/src/lib/components/FlaggedFeature.tsx"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),LemonProgress=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonProgress/index.tsx"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),kea_forms_lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.33.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),LemonCalendarSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonCalendar/LemonCalendarSelect.tsx"),LemonCheckbox=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonCheckbox/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonInput=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),LemonModal=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonModal/index.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),api=__webpack_require__("../../frontend/src/lib/api.ts"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),utils=__webpack_require__("../../frontend/src/scenes/data-pipelines/batch-exports/utils.ts");function getConfigurationFromBatchExportConfig(batchExportConfig){let config={name:batchExportConfig.name,destination:batchExportConfig.destination.type,paused:batchExportConfig.paused,interval:batchExportConfig.interval,model:batchExportConfig.model,filters:batchExportConfig.filters,integration_id:"Databricks"===batchExportConfig.destination.type?batchExportConfig.destination.integration:void 0,...batchExportConfig.destination.config},authorizationMode="IAMRole",copyInputsFields={};if("Redshift"===batchExportConfig.destination.type&&batchExportConfig.destination.config.copy_inputs){let copyInputs=batchExportConfig.destination.config.copy_inputs;copyInputsFields={redshift_s3_bucket:copyInputs.s3_bucket,redshift_s3_key_prefix:copyInputs.s3_key_prefix,redshift_s3_bucket_region_name:copyInputs.region_name,redshift_s3_bucket_aws_access_key_id:copyInputs.bucket_credentials?.aws_access_key_id,redshift_s3_bucket_aws_secret_access_key:copyInputs.bucket_credentials?.aws_secret_access_key,redshift_iam_role:void 0,redshift_aws_access_key_id:void 0,redshift_aws_secret_access_key:void 0},"string"==typeof copyInputs.authorization?(authorizationMode="IAMRole",copyInputsFields.redshift_iam_role=copyInputs.authorization):(authorizationMode="Credentials",copyInputsFields.redshift_aws_access_key_id=copyInputs.authorization?.aws_access_key_id,copyInputsFields.redshift_aws_secret_access_key=copyInputs.authorization?.aws_secret_access_key)}return{...config,...copyInputsFields,authorization_mode:authorizationMode}}function getDefaultConfiguration(service){return{name:(0,utils.x)(service),destination:service,model:"events",paused:!0,..."Snowflake"===service&&{authentication_type:"password"},..."S3"===service&&{file_format:"Parquet",compression:"zstd"},..."Redshift"===service&&{mode:"COPY",authorization_mode:"IAMRole",properties_data_type:"SUPER"},..."Databricks"===service&&{use_variant_type:!0,http_path:"/sql/1.0/warehouses/"}}}function getEventTable(service){return{type:"batch_export",id:"Events",name:"events",fields:{uuid:{name:"uuid",hogql_value:"toString(uuid)",type:"string",schema_valid:!0},timestamp:{name:"timestamp",hogql_value:"timestamp",type:"datetime",schema_valid:!0},event:{name:"event",hogql_value:"event",type:"string",schema_valid:!0},distinct_id:{name:"distinct_id",hogql_value:"toString(distinct_id)",type:"string",schema_valid:!0},properties:{name:"properties",hogql_value:"properties",type:"json",schema_valid:!0},..."S3"==service&&{person_id:{name:"person_id",hogql_value:"toString(person_id)",type:"string",schema_valid:!0},person_properties:{name:"person_properties",hogql_value:"nullIf(person_properties, '')",type:"string",schema_valid:!0},created_at:{name:"created_at",hogql_value:"created_at",type:"datetime",schema_valid:!0}},..."Databricks"==service&&{team_id:{name:"team_id",hogql_value:"team_id",type:"integer",schema_valid:!0},databricks_ingested_timestamp:{name:"databricks_ingested_timestamp",hogql_value:"NOW64()",type:"datetime",schema_valid:!0}},..."S3"!=service&&"Databricks"!=service&&{team_id:{name:"team_id",hogql_value:"Postgres"==service||"Redshift"==service?"toInt32(team_id)":"team_id",type:"integer",schema_valid:!0},set:{name:"Snowflake"==service?"people_set":"set",hogql_value:"nullIf(JSONExtractString(properties, '$set'), '')",type:"string",schema_valid:!0},set_once:{name:"Snowflake"==service?"people_set_once":"set_once",hogql_value:"nullIf(JSONExtractString(properties, '$set_once'), '')",type:"string",schema_valid:!0},site_url:{name:"site_url",hogql_value:"''",type:"string",schema_valid:!0},ip:{name:"ip",hogql_value:"nullIf(JSONExtractString(properties, '$ip'), '')",type:"string",schema_valid:!0},elements_chain:{name:"elements",hogql_value:"toJSONString(elements_chain)",type:"string",schema_valid:!0}},..."BigQuery"==service&&{bq_ingested_timestamp:{name:"bq_ingested_timestamp",hogql_value:"NOW64()",type:"datetime",schema_valid:!0}}}}}let personsTable={type:"batch_export",id:"Persons",name:"persons",fields:{team_id:{name:"team_id",hogql_value:"team_id",type:"integer",schema_valid:!0},distinct_id:{name:"distinct_id",hogql_value:"distinct_id",type:"string",schema_valid:!0},person_id:{name:"person_id",hogql_value:"person_id",type:"string",schema_valid:!0},properties:{name:"properties",hogql_value:"properties",type:"json",schema_valid:!0},person_version:{name:"person_version",hogql_value:"person_version",type:"integer",schema_valid:!0},person_distinct_id_version:{name:"person_distinct_id_version",hogql_value:"person_distinct_id_version",type:"integer",schema_valid:!0},created_at:{name:"created_at",hogql_value:"created_at",type:"datetime",schema_valid:!0},is_deleted:{name:"is_deleted",hogql_value:"is_deleted",type:"boolean",schema_valid:!0}}},sessionsTable={type:"batch_export",id:"Sessions",name:"sessions",fields:{team_id:{name:"team_id",hogql_value:"team_id",type:"integer",schema_valid:!0},session_id:{name:"session_id",type:"string",hogql_value:"session_id",schema_valid:!0},session_id_v7:{name:"session_id_v7",type:"string",hogql_value:"session_id_v7",schema_valid:!0},distinct_id:{name:"distinct_id",type:"string",hogql_value:"distinct_id",schema_valid:!0},start_timestamp:{name:"start_timestamp",type:"datetime",hogql_value:"start_timestamp",schema_valid:!0},end_timestamp:{name:"end_timestamp",type:"datetime",hogql_value:"end_timestamp",schema_valid:!0},urls:{name:"urls",type:"array",hogql_value:"urls",schema_valid:!0},num_uniq_urls:{name:"num_uniq_urls",type:"integer",hogql_value:"num_uniq_urls",schema_valid:!0},entry_current_url:{name:"entry_current_url",type:"string",hogql_value:"entry_current_url",schema_valid:!0},entry_pathname:{name:"entry_pathname",type:"string",hogql_value:"entry_pathname",schema_valid:!0},entry_hostname:{name:"entry_hostname",type:"string",hogql_value:"entry_hostname",schema_valid:!0},end_current_url:{name:"end_current_url",type:"string",hogql_value:"end_current_url",schema_valid:!0},end_pathname:{name:"end_pathname",type:"string",hogql_value:"end_pathname",schema_valid:!0},end_hostname:{name:"end_hostname",type:"string",hogql_value:"end_hostname",schema_valid:!0},entry_utm_source:{name:"entry_utm_source",type:"string",hogql_value:"entry_utm_source",schema_valid:!0},entry_utm_campaign:{name:"entry_utm_campaign",type:"string",hogql_value:"entry_utm_campaign",schema_valid:!0},entry_utm_medium:{name:"entry_utm_medium",type:"string",hogql_value:"entry_utm_medium",schema_valid:!0},entry_utm_term:{name:"entry_utm_term",type:"string",hogql_value:"entry_utm_term",schema_valid:!0},entry_utm_content:{name:"entry_utm_content",type:"string",hogql_value:"entry_utm_content",schema_valid:!0},entry_referring_domain:{name:"entry_referring_domain",type:"string",hogql_value:"entry_referring_domain",schema_valid:!0},entry_gclid:{name:"entry_gclid",type:"string",hogql_value:"entry_gclid",schema_valid:!0},entry_fbclid:{name:"entry_fbclid",type:"string",hogql_value:"entry_fbclid",schema_valid:!0},entry_gad_source:{name:"entry_gad_source",type:"string",hogql_value:"entry_gad_source",schema_valid:!0},pageview_count:{name:"pageview_count",type:"integer",hogql_value:"pageview_count",schema_valid:!0},autocapture_count:{name:"autocapture_count",type:"integer",hogql_value:"autocapture_count",schema_valid:!0},screen_count:{name:"screen_count",type:"integer",hogql_value:"screen_count",schema_valid:!0},channel_type:{name:"channel_type",type:"string",hogql_value:"channel_type",schema_valid:!0},session_duration:{name:"session_duration",type:"integer",hogql_value:"session_duration",schema_valid:!0},duration:{name:"duration",type:"integer",hogql_value:"duration",schema_valid:!0},is_bounce:{name:"is_bounce",type:"boolean",hogql_value:"is_bounce",schema_valid:!0},last_external_click_url:{name:"last_external_click_url",type:"string",hogql_value:"last_external_click_url",schema_valid:!0},page_screen_autocapture_count_up_to:{name:"page_screen_autocapture_count_up_to",type:"string",hogql_value:"page_screen_autocapture_count_up_to",schema_valid:!0},exit_current_url:{name:"exit_current_url",type:"string",hogql_value:"exit_current_url",schema_valid:!0},exit_pathname:{name:"exit_pathname",type:"string",hogql_value:"exit_pathname",schema_valid:!0},vital_lcp:{name:"vital_lcp",type:"float",hogql_value:"vital_lcp",schema_valid:!0},entry_gclsrc:{name:"entry_gclsrc",type:"string",hogql_value:"entry_gclsrc",schema_valid:!0},entry_dclid:{name:"entry_dclid",type:"string",hogql_value:"entry_dclid",schema_valid:!0},entry_gbraid:{name:"entry_gbraid",type:"string",hogql_value:"entry_gbraid",schema_valid:!0},entry_wbraid:{name:"entry_wbraid",type:"string",hogql_value:"entry_wbraid",schema_valid:!0},entry_msclkid:{name:"entry_msclkid",type:"string",hogql_value:"entry_msclkid",schema_valid:!0},entry_twclid:{name:"entry_twclid",type:"string",hogql_value:"entry_twclid",schema_valid:!0},entry_li_fat_id:{name:"entry_li_fat_id",type:"string",hogql_value:"entry_li_fat_id",schema_valid:!0},entry_mc_cid:{name:"entry_mc_cid",type:"string",hogql_value:"entry_mc_cid",schema_valid:!0},entry_igshid:{name:"entry_igshid",type:"string",hogql_value:"entry_igshid",schema_valid:!0},entry_ttclid:{name:"entry_ttclid",type:"string",hogql_value:"entry_ttclid",schema_valid:!0},entry__kx:{name:"entry__kx",type:"string",hogql_value:"entry__kx",schema_valid:!0},entry_irclid:{name:"entry_irclid",type:"string",hogql_value:"entry_irclid",schema_valid:!0}}},batchExportConfigurationLogic=(0,index_esm.kea)([(0,index_esm.props)({id:null,service:null}),(0,index_esm.key)(_ref=>{let{service,id}=_ref;return id?`ID:${id}`:`NEW:${service}`}),(0,index_esm.path)(id=>["scenes","data-pipelines","batch-exports","batchExportConfigurationLogic",id]),(0,index_esm.actions)({setSavedConfiguration:configuration=>({configuration}),setSelectedModel:model=>({model}),setRunningStep:step=>({step}),deleteBatchExport:()=>!0}),(0,kea_loaders_lib.loaders)(_ref2=>{let{props,actions,values}=_ref2;return{batchExportConfig:[null,{loadBatchExportConfig:async()=>props.id?await api.ZP.batchExports.get(props.id):null,updateBatchExportConfig:async formdata=>{let{name,destination,interval,paused,created_at,start_at,end_at,model,filters,json_config_file,integration_id,mode,authorization_mode,redshift_s3_bucket,redshift_s3_key_prefix,redshift_s3_bucket_region_name,redshift_s3_bucket_aws_access_key_id,redshift_s3_bucket_aws_secret_access_key,redshift_iam_role,redshift_aws_access_key_id,redshift_aws_secret_access_key,...config}=formdata;if("Redshift"===destination){if("COPY"===mode){let copyInputs={s3_bucket:redshift_s3_bucket,s3_key_prefix:redshift_s3_key_prefix,region_name:redshift_s3_bucket_region_name};redshift_iam_role?copyInputs.authorization=redshift_iam_role:redshift_aws_access_key_id&&redshift_aws_secret_access_key&&(copyInputs.authorization={aws_access_key_id:redshift_aws_access_key_id,aws_secret_access_key:redshift_aws_secret_access_key}),redshift_s3_bucket_aws_access_key_id&&redshift_s3_bucket_aws_secret_access_key&&(copyInputs.bucket_credentials={aws_access_key_id:redshift_s3_bucket_aws_access_key_id,aws_secret_access_key:redshift_s3_bucket_aws_secret_access_key}),config.copy_inputs=copyInputs}config.mode=mode}let data={paused,name,interval,model,filters,destination:{type:destination,integration:integration_id,config:config}};if(props.id){let res=await api.ZP.batchExports.update(props.id,data);return src.UJ.success("Batch export configuration updated successfully"),res}let res=await api.ZP.batchExports.create(data);return actions.resetConfiguration(getConfigurationFromBatchExportConfig(res)),lib.router.actions.replace(urls.j.batchExport(res.id)),src.UJ.success("Batch export created successfully"),res}}],batchExportConfigTest:[null,{loadBatchExportConfigTest:async()=>{if(props.service)try{return await api.ZP.batchExports.test(props.service)}catch{}return null},updateBatchExportConfigTest:async service=>{if(service)try{return await api.ZP.batchExports.test(service)}catch{}return null}}],batchExportConfigTestStep:[null,{runBatchExportConfigTestStep:async step=>{if(!values.batchExportConfigTest)return null;actions.setRunningStep(step),0===step&&values.batchExportConfigTest.steps.forEach(step=>{step.result=null});let{name,destination,interval,paused,created_at,start_at,end_at,model,filters,json_config_file,integration_id,...config}=values.configuration,data={paused,name,interval,model,filters,destination:{type:destination,config:config,integration:integration_id}};return props.id?await api.ZP.batchExports.runTestStep(props.id,step,data):await api.ZP.batchExports.runTestStepNew(step,data)}}]}}),(0,index_esm.reducers)(_ref3=>{let{props}=_ref3;return{tables:[props.service?[getEventTable(props.service),personsTable,sessionsTable]:[],{loadBatchExportConfigSuccess:(state,_ref4)=>{let{batchExportConfig}=_ref4;return batchExportConfig?[getEventTable(batchExportConfig.destination.type),personsTable,sessionsTable]:state},updateBatchExportConfigSuccess:(state,_ref5)=>{let{batchExportConfig}=_ref5;return batchExportConfig?[getEventTable(batchExportConfig.destination.type),personsTable,sessionsTable]:state}}],selectedModel:["events",{setSelectedModel:(_,_ref6)=>{let{model}=_ref6;return model},loadBatchExportConfigSuccess:(state,_ref7)=>{let{batchExportConfig}=_ref7;return batchExportConfig?batchExportConfig.model:state},updateBatchExportConfigSuccess:(state,_ref8)=>{let{batchExportConfig}=_ref8;return batchExportConfig?batchExportConfig.model:state}}],configuration:[props.service?getDefaultConfiguration(props.service):{},{loadBatchExportConfigSuccess:(state,_ref9)=>{let{batchExportConfig}=_ref9;return batchExportConfig?getConfigurationFromBatchExportConfig(batchExportConfig):state},updateBatchExportConfigSuccess:(state,_ref10)=>{let{batchExportConfig}=_ref10;return batchExportConfig?getConfigurationFromBatchExportConfig(batchExportConfig):state}}],savedConfiguration:[{},{loadBatchExportConfigSuccess:(state,_ref11)=>{let{batchExportConfig}=_ref11;return batchExportConfig?getConfigurationFromBatchExportConfig(batchExportConfig):state},updateBatchExportConfigSuccess:(state,_ref12)=>{let{batchExportConfig}=_ref12;return batchExportConfig?getConfigurationFromBatchExportConfig(batchExportConfig):state}}],runningStep:[null,{setRunningStep:(_,_ref13)=>{let{step}=_ref13;return step}}]}}),(0,index_esm.selectors)(()=>({logicProps:[()=>[(_,props)=>props],props=>props],service:[(s,p)=>[s.batchExportConfig,p.service],(config,service)=>config?.destination.type||service],isNew:[(_,p)=>[p.id],id=>!id],loading:[s=>[s.batchExportConfigLoading,s.batchExportConfigTestLoading],(batchExportConfigLoading,batchExportConfigTestLoading)=>batchExportConfigLoading||batchExportConfigTestLoading],requiredFields:[s=>[s.service,s.isNew,s.configuration],(service,isNew,config)=>{let generalRequiredFields=["interval","name","model"];if("Postgres"===service||"Redshift"===service)return[...generalRequiredFields,...isNew?["user"]:[],...isNew?["password"]:[],"host","port","database","schema","table_name"];if("S3"===service)return[...generalRequiredFields,"bucket_name","region","prefix",...isNew?["aws_access_key_id"]:[],...isNew?["aws_secret_access_key"]:[],...isNew?["file_format"]:[]];if("BigQuery"===service)return[...generalRequiredFields,...isNew?["json_config_file"]:[],"dataset_id","table_id"];if("HTTP"===service)return[...generalRequiredFields,"url","token"];else if("Snowflake"===service)return[...generalRequiredFields,"account","database","warehouse",...isNew?["user"]:[],...isNew&&"password"==config.authentication_type?["password"]:[],...isNew&&"keypair"==config.authentication_type?["private_key"]:[],"schema","table_name"];else if("Databricks"===service)return[...generalRequiredFields,"integration_id","http_path","catalog","schema","table_name","use_variant_type"];return generalRequiredFields}]})),(0,index_esm.listeners)(_ref14=>{let{values,actions}=_ref14;return{updateBatchExportConfigSuccess:_ref15=>{let{batchExportConfig}=_ref15;batchExportConfig&&actions.resetConfiguration(getConfigurationFromBatchExportConfig(batchExportConfig))},loadBatchExportConfigSuccess:_ref16=>{let{batchExportConfig}=_ref16;batchExportConfig&&actions.updateBatchExportConfigTest(batchExportConfig.destination.type)},runBatchExportConfigTestStepSuccess:_ref17=>{let{batchExportConfigTestStep}=_ref17;if(!values.batchExportConfigTest)return;let step=batchExportConfigTestStep||values.batchExportConfigTestStep;if(!step)return;let index=values.batchExportConfigTest.steps.findIndex(item=>item.name===step.name);index>-1&&(values.batchExportConfigTest.steps[index]=step,step.result&&"Passed"===step.result.status&&index<values.batchExportConfigTest.steps.length-1?actions.runBatchExportConfigTestStep(index+1):actions.setRunningStep(null))},runBatchExportConfigTestStepFailure:()=>{values.batchExportConfigTest&&values.runningStep&&(values.batchExportConfigTest.steps[values.runningStep].result={status:"Failed",message:"The batch export configuration could not be correctly serialized. Required fields may be missing or have invalid values"},actions.setRunningStep(null))},setConfigurationValue:async _ref18=>{let{name,value}=_ref18;if("json_config_file"===name[0]&&value)try{let loadedFile=await new Promise((resolve,reject)=>{let filereader=new FileReader;filereader.onload=e=>resolve(e.target?.result),filereader.onerror=e=>reject(e),filereader.readAsText(value[0])}),jsonConfig=JSON.parse(loadedFile),{json_config_file,...remainingConfig}=values.configuration;actions.setConfigurationValues({...remainingConfig,project_id:jsonConfig.project_id,private_key:jsonConfig.private_key,private_key_id:jsonConfig.private_key_id,client_email:jsonConfig.client_email,token_uri:jsonConfig.token_uri})}catch{actions.setConfigurationManualErrors({json_config_file:"The config file is not valid"})}},deleteBatchExport:async()=>{let batchExportId=values.batchExportConfig?.id;if(batchExportId)try{await api.ZP.batchExports.delete(batchExportId),src.UJ.success("Batch export deleted successfully"),lib.router.actions.replace(urls.j.dataPipelines("destinations"))}catch(error){let errorMessage=error.detail||error.message||"Failed to delete";src.UJ.error(errorMessage)}}}}),(0,kea_forms_lib.forms)(_ref19=>{let{asyncActions,values}=_ref19;return{configuration:{errors:formdata=>Object.fromEntries(values.requiredFields.map(field=>[field,formdata[field]?void 0:"This field is required"])),submit:async formdata=>{await asyncActions.updateBatchExportConfig(formdata)}}}}),(0,lib.beforeUnload)(_ref20=>{let{actions,values}=_ref20;return{enabled:()=>values.configurationChanged,message:"Leave action?\nChanges you made will be discarded.",onConfirm:()=>{values.batchExportConfig?actions.resetConfiguration(getConfigurationFromBatchExportConfig(values.batchExportConfig)):values.service?actions.resetConfiguration(getDefaultConfiguration(values.service)):actions.resetConfiguration()}}}),(0,index_esm.afterMount)(_ref21=>{let{actions}=_ref21;actions.loadBatchExportConfig(),actions.loadBatchExportConfigTest()})]),batchExportBackfillModalLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return id}),(0,index_esm.path)(key=>["scenes","pipeline","batchExportBackfillModalLogic",key]),(0,index_esm.connect)(props=>({values:[batchExportConfigurationLogic({id:props.id,service:null}),["batchExportConfig"]]})),(0,index_esm.actions)({openBackfillModal:!0,closeBackfillModal:!0,setEarliestBackfill:!0,unsetEarliestBackfill:!0}),(0,index_esm.reducers)({isBackfillModalOpen:[!1,{openBackfillModal:()=>!0,closeBackfillModal:()=>!1}],isEarliestBackfill:[!1,{setEarliestBackfill:()=>!0,unsetEarliestBackfill:()=>!1}]}),(0,kea_forms_lib.forms)(_ref2=>{let{props,actions,values}=_ref2;return{backfillForm:{defaults:{start_at:void 0,end_at:(0,dayjs.Bv)().tz(teamLogic.teamLogic.values.timezone).hour(0).minute(0).second(0).millisecond(0),earliest_backfill:!1},errors:_ref3=>{let{start_at,end_at,earliest_backfill}=_ref3;return{start_at:start_at?void 0:earliest_backfill?void 0:"Start date is required",end_at:end_at?void 0:"End date is required",earliest_backfill:void 0}},submit:async _ref4=>{var _start_at$toISOString,_end_at$toISOString;let{start_at,end_at,earliest_backfill}=_ref4;if(values.batchExportConfig&&values.batchExportConfig.interval.endsWith("minutes")&&(start_at?.minute()!==void 0&&start_at?.minute()%5!=0||end_at?.minute()!==void 0&&end_at?.minute()%5!=0)){src.UJ.error("Backfilling a 5 minute batch export requires bounds be multiple of five minutes");return}let upperBound=(0,dayjs.Bv)().tz(teamLogic.teamLogic.values.timezone);if(values.batchExportConfig&&end_at&&end_at>upperBound){src.UJ.error("Requested backfill end date lies in the future");return}await api.ZP.batchExports.createBackfill(props.id,{start_at:earliest_backfill?null:null!==(_start_at$toISOString=start_at?.toISOString())&&void 0!==_start_at$toISOString?_start_at$toISOString:null,end_at:null!==(_end_at$toISOString=end_at?.toISOString())&&void 0!==_end_at$toISOString?_end_at$toISOString:null}).catch(e=>{if(e.detail){var _e$attr;actions.setBackfillFormManualErrors({[null!==(_e$attr=e.attr)&&void 0!==_e$attr?_e$attr:"start_at"]:e.detail})}else src.UJ.error("Unknown error occurred");throw e}),actions.closeBackfillModal()}}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function BatchExportBackfillModal(_ref){let{id}=_ref,{timezone}=(0,index_esm.useValues)(teamLogic.teamLogic),logic=batchExportBackfillModalLogic({id}),{batchExportConfig,isBackfillModalOpen,isBackfillFormSubmitting,isEarliestBackfill}=(0,index_esm.useValues)(logic),{closeBackfillModal,setEarliestBackfill,unsetEarliestBackfill,setBackfillFormManualErrors}=(0,index_esm.useActions)(logic);return batchExportConfig?(0,jsx_runtime.jsxs)(LemonModal.f,{title:"Start backfill",onClose:closeBackfillModal,isOpen:isBackfillModalOpen,width:"30rem",footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary","data-attr":"batch-export-backfill-cancel",disabledReason:isBackfillFormSubmitting?"Please wait...":void 0,onClick:closeBackfillModal,children:"Cancel"}),(0,jsx_runtime.jsx)(LemonButton.J,{form:"batch-export-backfill-form",htmlType:"submit",type:"primary","data-attr":"batch-export-backfill-submit",loading:isBackfillFormSubmitting,onClick:()=>setBackfillFormManualErrors({}),children:"Schedule runs"})]}),children:[(0,jsx_runtime.jsxs)("p",{children:["Backfilling a batch export will sequentially run all batch periods that fall within the range specified below. The runs will export data in ",(0,jsx_runtime.jsx)("b",{children:batchExportConfig?.interval})," intervals, from the start date until the end date is reached."]}),(0,jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:batchExportBackfillModalLogic,props:{id:id},formKey:"backfillForm",id:"batch-export-backfill-form",enableFormOnSubmit:!0,className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"start_at",label:`Start Date (${timezone})`,className:"flex-1",children:_ref2=>{let{value,onChange}=_ref2;return isEarliestBackfill?(0,jsx_runtime.jsx)(LemonInput.D,{value:"Beginning of time",disabled:!0}):(0,jsx_runtime.jsx)(LemonCalendarSelect.he,{value:value&&batchExportConfig?"day"===batchExportConfig.interval?value.hour(0).minute(0).second(0):value.tz(timezone):value,onChange:date=>{if(date){let projectDate=date.tz(timezone,!0);batchExportConfig&&"day"===batchExportConfig.interval&&(projectDate=projectDate.hour(0).minute(0).second(0)),onChange(projectDate)}else onChange(date)},placeholder:"Select start date",granularity:batchExportConfig?"hour"===batchExportConfig.interval?"hour":batchExportConfig.interval.endsWith("minutes")?"minute":"day":"day"})}}),batchExportConfig?.model=="persons"||batchExportConfig?.model=="sessions"?(0,jsx_runtime.jsx)(LemonField.D,{name:"earliest_backfill",children:_ref3=>{let{onChange}=_ref3;return(0,jsx_runtime.jsx)(LemonCheckbox.H,{bordered:!0,label:(0,jsx_runtime.jsxs)("span",{className:"flex gap-2 items-center",children:["Backfill since beginning of time",(0,jsx_runtime.jsx)(src.u,{title:"If selected, we will backfill all data since the beginning of time until the end date set below. There is no need to set a start date for the backfill.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg text-secondary"})})]}),onChange:checked=>{onChange(checked),checked?setEarliestBackfill():unsetEarliestBackfill()}})}}):null,(0,jsx_runtime.jsx)(LemonField.D,{name:"end_at",label:`End Date (${timezone})`,className:"flex-1",children:_ref4=>{let{value,onChange}=_ref4;return(0,jsx_runtime.jsx)(LemonCalendarSelect.he,{value:value&&batchExportConfig?"day"===batchExportConfig.interval?value.hour(0).minute(0).second(0):value.tz(timezone):value,onChange:date=>{if(date){let projectDate=date.tz(timezone,!0);batchExportConfig&&"day"===batchExportConfig.interval&&(projectDate=projectDate.hour(0).minute(0).second(0)),onChange(projectDate)}else onChange(date)},placeholder:"Select end date",granularity:batchExportConfig?"hour"===batchExportConfig.interval?"hour":batchExportConfig.interval.endsWith("minutes")?"minute":"day":"day"})}})]})]}):(0,jsx_runtime.jsx)(NotFound.T,{object:"batch export"})}var LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts");let batchExportBackfillsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return id}),(0,index_esm.path)(key=>["scenes","pipeline","batchExportBackfillsLogic",key]),(0,index_esm.connect)(props=>({values:[(0,teamLogic.teamLogic)(),["currentTeamId"],batchExportConfigurationLogic({id:props.id,service:null}),["batchExportConfig"]],actions:[batchExportBackfillModalLogic(props),["submitBackfillFormSuccess","openBackfillModal"]]})),(0,index_esm.actions)({loadBackfills:!0,cancelBackfill:backfill=>({backfill})}),(0,kea_loaders_lib.loaders)(_ref2=>{let{props,values}=_ref2;return{backfillsPaginatedResponse:[null,{loadBackfills:async()=>{try{return await api.ZP.batchExports.listBackfills(props.id,{ordering:"-created_at"})}catch(e){throw LemonToast.U.error("Unknown error occurred when fetching backfills"),e}},loadOlderBackfills:async()=>{let nextUrl=values.backfillsPaginatedResponse?.next;if(!nextUrl)return values.backfillsPaginatedResponse;try{var _values$backfillsPagi;let res=await api.ZP.get(nextUrl);return res.results=[...null!==(_values$backfillsPagi=values.backfillsPaginatedResponse?.results)&&void 0!==_values$backfillsPagi?_values$backfillsPagi:[],...res.results],res}catch(e){throw LemonToast.U.error("Unknown error occurred when fetching backfills"),e}}}]}}),(0,index_esm.selectors)({hasMoreBackfillsToLoad:[s=>[s.backfillsPaginatedResponse],backfillsPaginatedResponse=>!!backfillsPaginatedResponse?.next],loading:[s=>[s.backfillsPaginatedResponseLoading],backfillsPaginatedResponseLoading=>backfillsPaginatedResponseLoading],latestBackfills:[s=>[s.backfillsPaginatedResponse],backfillsPaginatedResponse=>{var _backfillsPaginatedRe;return(null!==(_backfillsPaginatedRe=backfillsPaginatedResponse?.results)&&void 0!==_backfillsPaginatedRe?_backfillsPaginatedRe:[]).map(backfill=>{let parseDateSafely=date=>{if(!date)return;let parsed=(0,dayjs.Bv)(date);return parsed.isValid()?parsed:void 0};return{...backfill,created_at:parseDateSafely(backfill.created_at),finished_at:parseDateSafely(backfill.finished_at),start_at:parseDateSafely(backfill.start_at),end_at:parseDateSafely(backfill.end_at),last_updated_at:parseDateSafely(backfill.last_updated_at)}})}]}),(0,index_esm.listeners)(_ref3=>{let{actions,props}=_ref3;return{cancelBackfill:async _ref4=>{let{backfill}=_ref4;try{await api.ZP.batchExports.cancelBackfill(props.id,backfill.id),LemonToast.U.success("Backfill has been cancelled."),actions.loadBackfills()}catch{LemonToast.U.error("Failed to cancel backfill. Please try again.")}},submitBackfillFormSuccess:()=>{setTimeout(()=>{actions.loadBackfills()},1e3)}}}),(0,index_esm.afterMount)(_ref5=>{let{actions}=_ref5;actions.loadBackfills()})]);function BatchExportBackfills(_ref){let{id}=_ref,logic=batchExportBackfillsLogic({id}),{batchExportConfig}=(0,index_esm.useValues)(logic);return batchExportConfig?(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(BatchExportBackfillsControls,{id:id}),(0,jsx_runtime.jsx)(BatchExportLatestBackfills,{id:id}),(0,jsx_runtime.jsx)(BatchExportBackfillModal,{id:id})]}):(0,jsx_runtime.jsx)(NotFound.T,{object:"batch export"})}function BatchExportBackfillsControls(_ref2){let{id}=_ref2,logic=batchExportBackfillsLogic({id}),{loading}=(0,index_esm.useValues)(logic),{loadBackfills,openBackfillModal}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center justify-between",children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:loadBackfills,loading:loading,type:"secondary",icon:(0,jsx_runtime.jsx)(icons.tr,{}),size:"small",children:"Refresh"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>openBackfillModal(),children:"Start backfill"})]})}function BatchExportLatestBackfills(_ref3){let{id}=_ref3,logic=batchExportBackfillsLogic({id}),{latestBackfills,loading,hasMoreBackfillsToLoad,batchExportConfig}=(0,index_esm.useValues)(logic),{cancelBackfill,loadOlderBackfills,openBackfillModal}=(0,index_esm.useActions)(logic);return batchExportConfig?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.g3,{dataSource:latestBackfills,loading:loading,loadingSkeletonRows:5,footer:hasMoreBackfillsToLoad&&(0,jsx_runtime.jsx)("div",{className:"flex items-center m-2",children:(0,jsx_runtime.jsx)(src.Jp,{center:!0,fullWidth:!0,onClick:loadOlderBackfills,loading:loading,children:"Load more rows"})}),columns:[{title:"Status",key:"status",width:0,render:(_,backfill)=>{let status=backfill.status,color=colorForStatus(status);return(0,jsx_runtime.jsx)("span",{className:(0,clsx_m.default)("flex justify-center items-center p-2 h-6 text-xs font-semibold rounded-full border-2 select-none",{success:"border-success text-success-dark",accent:"border-accent text-primary-dark",warning:"border-warning text-warning-dark",danger:"border-danger text-danger-dark",default:"border-default text-default-dark"}[color]),children:(0,jsx_runtime.jsx)("span",{className:"text-center",children:status})})}},{title:"Progress",key:"progress",render:(_,backfill)=>{let color=colorForStatus(backfill.status),progress=backfill.progress;if(progress&&null!==progress.progress&&void 0!==progress.progress){let label="";if(null!==progress.finished_runs&&void 0!==progress.finished_runs&&progress.total_runs){let runsLabel=1===progress.total_runs?"run":"runs";label=`(${progress.finished_runs}/${progress.total_runs} ${runsLabel})`}return(0,jsx_runtime.jsxs)("span",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)(LemonProgress.b,{percent:100*progress.progress,strokeColor:`var(--${color})`,className:"min-w-[80px]"}),(0,jsx_runtime.jsx)("span",{className:"flex-shrink-0 whitespace-nowrap",children:label})]})}return""}},{title:"ID",key:"runId",render:(_,backfill)=>backfill.id},{title:"Interval start",key:"intervalStart",tooltip:"Start of the time range to backfill",render:(_,backfill)=>backfill.start_at?(0,jsx_runtime.jsx)(TZLabel.w,{time:backfill.start_at,formatDate:"MMMM DD, YYYY",formatTime:"HH:mm:ss"}):"Beginning of time"},{title:"Interval end",key:"intervalEnd",tooltip:"End of the time range to backfill",render:(_,backfill)=>backfill.end_at?(0,jsx_runtime.jsx)(TZLabel.w,{time:backfill.end_at,formatDate:"MMMM DD, YYYY",formatTime:"HH:mm:ss"}):"Until present"},{title:"Started",key:"started",tooltip:"Date and time when this BatchExport backfill started",render:(_,backfill)=>backfill.created_at?(0,jsx_runtime.jsx)(TZLabel.w,{time:backfill.created_at}):""},{title:"Finished",key:"finished",tooltip:"Date and time when this BatchExport backfill finished",render:(_,backfill)=>backfill.finished_at?(0,jsx_runtime.jsx)(TZLabel.w,{time:backfill.finished_at}):""},{key:"actions",width:0,render:function RenderActions(_,backfill){if(backfillIsCancelable(backfill.status))return(0,jsx_runtime.jsx)("div",{className:"flex gap-1",children:(0,jsx_runtime.jsx)(BackfillCancelButton,{backfill:backfill,cancelBackfill:cancelBackfill})})}}],emptyState:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"No backfills in this time range."}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>openBackfillModal(),children:"Start backfill"})]})})}):(0,jsx_runtime.jsx)(NotFound.T,{object:"batch export"})}function BackfillCancelButton(_ref4){let{backfill,cancelBackfill}=_ref4;return(0,jsx_runtime.jsx)("span",{className:"flex gap-1 items-center",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.uR,{}),tooltip:"Cancel backfill",onClick:()=>src.dn.open({title:"Cancel backfill?",description:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)("p",{children:"This will cancel the selected backfill."})}),width:"20rem",primaryButton:{children:"Cancel backfill",onClick:()=>cancelBackfill(backfill)},secondaryButton:{children:"Go back"}})})})}let colorForStatus=status=>{switch(status){case"Completed":return"success";case"ContinuedAsNew":case"Running":case"Starting":return"accent";case"Cancelled":case"Terminated":case"TimedOut":return"warning";case"Failed":case"FailedRetryable":return"danger";default:return"default"}},backfillIsCancelable=status=>"Running"===status||"Starting"===status;var DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx");let batchExportRunsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return id}),(0,index_esm.path)(key=>["scenes","pipeline","batchExportRunsLogic",key]),(0,index_esm.connect)(props=>({values:[batchExportConfigurationLogic({id:props.id,service:null}),["batchExportConfig"]],actions:[batchExportBackfillModalLogic(props),["submitBackfillFormSuccess","openBackfillModal"]]})),(0,index_esm.actions)({setDateRange:(from,to)=>({from,to}),switchLatestRuns:enabled=>({enabled}),loadRuns:!0,retryRun:run=>({run}),cancelRun:run=>({run})}),(0,kea_loaders_lib.loaders)(_ref2=>{let{props,values}=_ref2;return{runsPaginatedResponse:[null,{loadRuns:async()=>values.usingLatestRuns?await api.ZP.batchExports.listRuns(props.id,{}):await api.ZP.batchExports.listRuns(props.id,{start:values.dateRange.from,end:values.dateRange.to,ordering:"-data_interval_start"}),loadOlderRuns:async()=>{var _values$runsPaginated;let nextUrl=values.runsPaginatedResponse?.next;if(!nextUrl)return values.runsPaginatedResponse;let res=await api.ZP.get(nextUrl);return res.results=[...null!==(_values$runsPaginated=values.runsPaginatedResponse?.results)&&void 0!==_values$runsPaginated?_values$runsPaginated:[],...res.results],res}}]}}),(0,index_esm.reducers)({dateRange:[{from:"-2d",to:null},{setDateRange:(_,_ref3)=>{let{from,to}=_ref3;return{from:null!=from?from:"-2d",to:to}}}],usingLatestRuns:[!0,{switchLatestRuns:(_,_ref4)=>{let{enabled}=_ref4;return enabled}}]}),(0,index_esm.selectors)({hasMoreRunsToLoad:[s=>[s.runsPaginatedResponse],runsPaginatedResponse=>!!runsPaginatedResponse?.next],loading:[s=>[s.runsPaginatedResponseLoading],runsPaginatedResponseLoading=>runsPaginatedResponseLoading],latestRuns:[s=>[s.runsPaginatedResponse],runsPaginatedResponse=>{var _runsPaginatedRespons;return(null!==(_runsPaginatedRespons=runsPaginatedResponse?.results)&&void 0!==_runsPaginatedRespons?_runsPaginatedRespons:[]).map(run=>({...run,created_at:(0,dayjs.Bv)(run.created_at),data_interval_start:run.data_interval_start?(0,dayjs.Bv)(run.data_interval_start):void 0,data_interval_end:(0,dayjs.Bv)(run.data_interval_end),last_updated_at:run.last_updated_at?(0,dayjs.Bv)(run.last_updated_at):void 0}))}],groupedRuns:[s=>[s.runsPaginatedResponse,s.usingLatestRuns],(runsPaginatedResponse,usingLatestRuns)=>{var _runsPaginatedRespons2;if(usingLatestRuns)return[];let runs=null!==(_runsPaginatedRespons2=runsPaginatedResponse?.results)&&void 0!==_runsPaginatedRespons2?_runsPaginatedRespons2:[],groupedRuns={};return runs.forEach(run=>{if(!run.data_interval_start)return;let key=`${run.data_interval_start}-${run.data_interval_end}`;groupedRuns[key]||(groupedRuns[key]={data_interval_start:(0,dayjs.Bv)(run.data_interval_start),data_interval_end:(0,dayjs.Bv)(run.data_interval_end),runs:[],last_run_at:(0,dayjs.Bv)(run.created_at)}),groupedRuns[key].runs.push({...run,created_at:(0,dayjs.Bv)(run.created_at),data_interval_start:run.data_interval_start?(0,dayjs.Bv)(run.data_interval_start):void 0,data_interval_end:(0,dayjs.Bv)(run.data_interval_end),last_updated_at:run.last_updated_at?(0,dayjs.Bv)(run.last_updated_at):void 0}),groupedRuns[key].runs.sort((a,b)=>b.created_at.diff(a.created_at)),groupedRuns[key].last_run_at=groupedRuns[key].runs[0].created_at}),Object.values(groupedRuns)}]}),(0,index_esm.listeners)(_ref5=>{let{actions,props}=_ref5;return{setDateRange:()=>{actions.loadRuns()},switchLatestRuns:()=>{actions.loadRuns()},retryRun:async _ref6=>{let{run}=_ref6;await api.ZP.batchExports.retryRun(props.id,run.id),src.UJ.success("Retry has been scheduled.")},cancelRun:async _ref7=>{let{run}=_ref7;await api.ZP.batchExports.cancelRun(props.id,run.id),src.UJ.success("Run has been cancelled.")},submitBackfillFormSuccess:()=>{actions.loadRuns()}}}),(0,index_esm.afterMount)(_ref8=>{let{actions}=_ref8;actions.loadRuns()})]);function isRunInProgress(run){return["Running","Starting"].includes(run.status)}function BatchExportRuns(_ref){let{id}=_ref,logic=batchExportRunsLogic({id}),{batchExportConfig,groupedRuns,loading,hasMoreRunsToLoad,usingLatestRuns}=(0,index_esm.useValues)(logic),{loadOlderRuns,retryRun}=(0,index_esm.useActions)(logic);return batchExportConfig?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(BatchExportRunsFilters,{id:id}),usingLatestRuns?(0,jsx_runtime.jsx)(BatchExportLatestRuns,{id:id}):(0,jsx_runtime.jsx)(BatchExportRunsGrouped,{id:id,groupedRuns:groupedRuns,loading:loading,retryRun:retryRun,hasMoreRunsToLoad:hasMoreRunsToLoad,loadOlderRuns:loadOlderRuns,interval:batchExportConfig.interval})]}),(0,jsx_runtime.jsx)(BatchExportBackfillModal,{id:id})]}):(0,jsx_runtime.jsx)(NotFound.T,{object:"batch export"})}function BatchExportRunsFilters(_ref2){let{id}=_ref2,logic=batchExportRunsLogic({id}),{dateRange,usingLatestRuns,loading}=(0,index_esm.useValues)(logic),{setDateRange,switchLatestRuns,loadRuns}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:loadRuns,loading:loading,type:"secondary",icon:(0,jsx_runtime.jsx)(icons.tr,{}),size:"small",children:"Refresh"}),(0,jsx_runtime.jsx)(src.f4,{bordered:!0,label:"Show latest runs",checked:usingLatestRuns,onChange:switchLatestRuns,size:"small"}),(0,jsx_runtime.jsx)(DateFilter.f,{dateTo:dateRange.to,dateFrom:dateRange.from,disabledReason:usingLatestRuns?'Turn off "Show latest runs" to filter by data interval':void 0,onChange:(from,to)=>setDateRange(from,to),allowedRollingDateOptions:["hours","days","weeks","months","years"],makeLabel:key=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCalendar,{})," ",key]})})]})}function BatchExportLatestRuns(_ref3){let{id}=_ref3,logic=batchExportRunsLogic({id}),{batchExportConfig,latestRuns,loading,hasMoreRunsToLoad}=(0,index_esm.useValues)(logic),{openBackfillModal,loadOlderRuns,retryRun,cancelRun}=(0,index_esm.useActions)(logic);return batchExportConfig?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.g3,{dataSource:latestRuns,loading:loading,loadingSkeletonRows:5,footer:hasMoreRunsToLoad&&(0,jsx_runtime.jsx)("div",{className:"flex items-center m-2",children:(0,jsx_runtime.jsx)(src.Jp,{center:!0,fullWidth:!0,onClick:loadOlderRuns,loading:loading,children:"Load more rows"})}),columns:[{title:"Status",key:"status",width:0,render:(_,run)=>(0,jsx_runtime.jsx)(BatchExportRunIcon,{runs:[run],showLabel:!0})},{title:"ID",key:"runId",render:(_,run)=>run.id},{title:"Data interval start",key:"dataIntervalStart",tooltip:"Start of the time range to export",render:(_,run)=>run.data_interval_start?(0,jsx_runtime.jsx)(TZLabel.w,{time:run.data_interval_start,formatDate:"MMMM DD, YYYY",formatTime:"HH:mm:ss"}):"Beginning of time"},{title:"Data interval end",key:"dataIntervalEnd",tooltip:"End of the time range to export",render:(_,run)=>(0,jsx_runtime.jsx)(TZLabel.w,{time:run.data_interval_end,formatDate:"MMMM DD, YYYY",formatTime:"HH:mm:ss"})},{title:"Run start",key:"runStart",tooltip:"Date and time when this BatchExport run started",render:(_,run)=>(0,jsx_runtime.jsx)(TZLabel.w,{time:run.created_at})},{key:"actions",width:0,render:function RenderActions(_,run){return(0,jsx_runtime.jsxs)("div",{className:"flex gap-1",children:[(0,jsx_runtime.jsx)(RunRetryButton,{run:run,retryRun:retryRun}),(0,jsx_runtime.jsx)(RunCancelButton,{run:run,cancelRun:cancelRun})]})}}],emptyState:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsxs)("div",{children:["No runs in this time range. Your exporter runs every ",(0,jsx_runtime.jsx)("b",{children:batchExportConfig.interval}),"."]}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>openBackfillModal(),children:"Start backfill"})]})})}):(0,jsx_runtime.jsx)(NotFound.T,{object:"batch export"})}function BatchExportRunsGrouped(_ref4){let{id,groupedRuns,loading,retryRun,hasMoreRunsToLoad,loadOlderRuns,interval}=_ref4,logic=batchExportRunsLogic({id}),{openBackfillModal}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.g3,{dataSource:groupedRuns,loading:loading,loadingSkeletonRows:5,footer:hasMoreRunsToLoad&&(0,jsx_runtime.jsx)("div",{className:"flex items-center m-2",children:(0,jsx_runtime.jsx)(src.Jp,{center:!0,fullWidth:!0,onClick:loadOlderRuns,loading:loading,children:"Load more rows"})}),expandable:{noIndent:!0,expandedRowRender:groupedRuns=>(0,jsx_runtime.jsx)(src.g3,{dataSource:groupedRuns.runs,embedded:!0,columns:[{title:"Status",key:"status",width:0,render:(_,run)=>(0,jsx_runtime.jsx)(BatchExportRunIcon,{runs:[run],showLabel:!0})},{title:"ID",key:"runId",render:(_,run)=>run.id},{title:"Run start",key:"runStart",tooltip:"Date and time when this BatchExport run started",render:(_,run)=>(0,jsx_runtime.jsx)(TZLabel.w,{time:run.created_at})}]})},columns:[{key:"icon",width:0,render:(_,groupedRun)=>(0,jsx_runtime.jsx)(BatchExportRunIcon,{runs:groupedRun.runs})},{title:"Data interval start",key:"dataIntervalStart",tooltip:"Start of the time range to export",render:(_,run)=>run.data_interval_start?(0,jsx_runtime.jsx)(TZLabel.w,{time:run.data_interval_start,formatDate:"MMMM DD, YYYY",formatTime:"HH:mm:ss"}):"Beginning of time"},{title:"Data interval end",key:"dataIntervalEnd",tooltip:"End of the time range to export",render:(_,run)=>(0,jsx_runtime.jsx)(TZLabel.w,{time:run.data_interval_end,formatDate:"MMMM DD, YYYY",formatTime:"HH:mm:ss"})},{title:"Latest run start",key:"runStart",tooltip:"Date and time when this BatchExport run started",render:(_,groupedRun)=>(0,jsx_runtime.jsx)(TZLabel.w,{time:groupedRun.last_run_at})},{key:"actions",width:0,render:function RenderActions(_,groupedRun){if(!isRunInProgress(groupedRun.runs[0]))return(0,jsx_runtime.jsx)(RunRetryButton,{run:groupedRun.runs[0],retryRun:retryRun})}}],emptyState:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsxs)("div",{children:["No runs in this time range. Your exporter runs every ",(0,jsx_runtime.jsx)("b",{children:interval}),"."]}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>openBackfillModal(),children:"Start backfill"})]})})})}function RunRetryButton(_ref5){let{run,retryRun}=_ref5;return(0,jsx_runtime.jsx)("span",{className:"flex gap-1 items-center",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.tr,{}),onClick:()=>src.dn.open({title:"Retry export?",description:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("p",{children:"This will schedule a new run for the same interval. Any changes to the configuration will be applied to the new run."}),(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("b",{children:"Please note -"})," there may be a slight delay before the new run appears."]})]}),width:"20rem",primaryButton:{children:"Retry",onClick:()=>retryRun(run)},secondaryButton:{children:"Cancel"}})})})}function RunCancelButton(_ref6){let{run,cancelRun}=_ref6;return(0,jsx_runtime.jsx)("span",{className:"flex gap-1 items-center",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.uR,{}),disabledReason:"Running"===run.status||"Starting"===run.status?null:`Cannot cancel as run is '${run.status}'`,onClick:()=>src.dn.open({title:"Cancel run?",description:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)("p",{children:"This will cancel the selected backfill run."})}),width:"20rem",primaryButton:{children:"Cancel run",onClick:()=>cancelRun(run)},secondaryButton:{children:"Go back"}})})})}function BatchExportRunIcon(_ref7){let{runs,showLabel=!1}=_ref7,status=combineFailedStatuses(runs[0].status),color=BatchExportRuns_colorForStatus(status);return(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Run status: ",status,runs.length>1&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("br",{}),"Attempts: ",runs.length]})]}),children:(0,jsx_runtime.jsx)("span",{className:(0,clsx_m.default)(`BatchExportRunIcon h-6 p-2 border-2 flex items-center justify-center rounded-full font-semibold text-xs border-${color} text-${color}-dark select-none`,"primary"===color&&"BatchExportRunIcon--pulse",showLabel?"":"w-6"),children:showLabel?(0,jsx_runtime.jsx)("span",{className:"text-center",children:status}):runs.length})})}let combineFailedStatuses=status=>"FailedRetryable"===status?"Failed":status,BatchExportRuns_colorForStatus=status=>{switch(status){case"Completed":return"success";case"ContinuedAsNew":case"Running":case"Starting":return"primary";case"Cancelled":case"Terminated":case"TimedOut":return"warning";case"Failed":case"FailedRetryable":return"danger";default:return"default"}};var LogsViewer=__webpack_require__("../../frontend/src/scenes/hog-functions/logs/LogsViewer.tsx"),HogFunctionSkeleton=__webpack_require__("../../frontend/src/scenes/hog-functions/misc/HogFunctionSkeleton.tsx"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),PipelineNodeLogs=__webpack_require__("../../frontend/src/scenes/data-pipelines/legacy-plugins/PipelineNodeLogs.tsx"),PipelineNodeMetrics=__webpack_require__("../../frontend/src/scenes/data-pipelines/legacy-plugins/PipelineNodeMetrics.tsx"),EventSelect=__webpack_require__("../../frontend/src/lib/components/EventSelect/EventSelect.tsx"),PropertyFilters=__webpack_require__("../../frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),TaxonomicFilter_types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonCollapse=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonCollapse/index.ts"),LemonLabel=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/index.ts"),Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),LemonTag=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),deleteWithUndo=__webpack_require__("../../frontend/src/lib/utils/deleteWithUndo.tsx"),dataWarehouseJoinsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/external/dataWarehouseJoinsLogic.ts"),dataWarehouseSettingsSceneLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsSceneLogic.ts"),viewLinkLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/viewLinkLogic.tsx");let nonEditableSchemaTypes=["lazy_table","virtual_table","field_traverser","expression","view","materialized_view"],editSchemaOptions={integer:"Integer",float:"Float",decimal:"Decimal",string:"String",datetime:"DateTime",date:"Date",boolean:"Boolean",array:"Array",json:"JSON",unknown:"Unknown"},editSchemaOptionsAsArray=Object.keys(editSchemaOptions).map(n=>({value:n,label:editSchemaOptions[n]})),isNonEditableSchemaType=schemaType=>"string"==typeof schemaType&&nonEditableSchemaTypes.includes(schemaType),JoinsMoreMenu=_ref=>{let{tableName,fieldName}=_ref,{currentTeamId}=(0,index_esm.useValues)(teamLogic.teamLogic),{toggleEditJoinModal}=(0,index_esm.useActions)(viewLinkLogic.t),{joins,joinsLoading}=(0,index_esm.useValues)(dataWarehouseJoinsLogic.F),{loadJoins}=(0,index_esm.useActions)(dataWarehouseJoinsLogic.F),{loadDatabase}=(0,index_esm.useActions)(dataWarehouseSettingsSceneLogic.b),join=joins.find(n=>n.source_table_name===tableName&&n.field_name===fieldName),overlay=(0,react.useCallback)(()=>joinsLoading||!join?(0,jsx_runtime.jsx)(src.$j,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,onClick:()=>void toggleEditJoinModal(join),children:"Edit"}),(0,jsx_runtime.jsx)(src.Jp,{status:"danger",fullWidth:!0,onClick:()=>{(0,deleteWithUndo.S)({endpoint:`environments/${currentTeamId}/warehouse_view_link`,object:{id:join.id,name:`${join.field_name} on ${join.source_table_name}`},callback:()=>{loadDatabase(),loadJoins()}}).catch(e=>{src.UJ.error(`Failed to delete warehouse view link: ${e.detail}`)})},children:"Delete"})]}),[joinsLoading,join]);return(0,jsx_runtime.jsx)(More.T,{overlay:overlay()})};function DatabaseTable(_ref2){var _tables$find$fields;let{table,tables,inEditSchemaMode,schemaOnChange}=_ref2,dataSource=Object.values(null!==(_tables$find$fields=tables.find(_ref3=>{let{name}=_ref3;return name===table})?.fields)&&void 0!==_tables$find$fields?_tables$find$fields:{}),{dataWarehouseTables,databaseLoading}=(0,index_esm.useValues)(dataWarehouseSettingsSceneLogic.b);return(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:dataSource,loading:databaseLoading,disableTableWhileLoading:!1,columns:[{title:"Column",key:"key",dataIndex:"name",render:function RenderColumn(column){return(0,jsx_runtime.jsx)("code",{children:column})}},{title:"Type",key:"type",dataIndex:"type",render:function RenderType(_,_ref4){let{name,type,schema_valid}=_ref4;return inEditSchemaMode&&!isNonEditableSchemaType(type)?(0,jsx_runtime.jsx)(src.Yv,{options:editSchemaOptionsAsArray,value:type,onChange:newValue=>{schemaOnChange&&schemaOnChange(name,newValue)}}):"virtual_table"===type?(0,jsx_runtime.jsx)(LemonTag.o,{type:"default",className:"uppercase",children:"Virtual Table"}):"lazy_table"===type?(0,jsx_runtime.jsx)(LemonTag.o,{type:"default",className:"uppercase",children:"Reference"}):"field_traverser"===type?(0,jsx_runtime.jsx)(LemonTag.o,{type:"default",className:"uppercase",children:"Expression"}):(0,jsx_runtime.jsx)(LemonTag.o,{type:schema_valid?"default":"danger",className:"uppercase",children:type})}},{title:"Info",key:"info",dataIndex:"type",render:function RenderInfo(type,field){if("virtual_table"===type||"view"===type)return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Fields: ",(0,jsx_runtime.jsx)("code",{children:field.fields.join(", ")})]});if("lazy_table"===type)return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["To table: ",(0,jsx_runtime.jsx)("code",{children:String(field.table)})]});if("field_traverser"===type&&Array.isArray(field.chain))return(0,jsx_runtime.jsx)("code",{children:field.chain.join(".")});if("events"==table&&"json"==type&&"properties"==field.name)return(0,jsx_runtime.jsx)(Link.r,{to:urls.j.propertyDefinitions("event"),children:"Manage event properties"});if("persons"==table&&"json"==type&&"properties"==field.name)return(0,jsx_runtime.jsx)(Link.r,{to:urls.j.propertyDefinitions("person"),children:"Manage person properties"});return field.schema_valid||inEditSchemaMode?"":(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("code",{children:field.name})," can't be parsed as a ",(0,jsx_runtime.jsx)("code",{children:field.type}),". It will not be queryable until this is fixed."]})}},{width:0,dataIndex:"type",render:function RenderActions(_,data){if("view"===data.type)return(0,jsx_runtime.jsx)(JoinsMoreMenu,{tableName:table,fieldName:data.name});if("lazy_table"===data.type&&data.table){let isJoiningTableExternalTable=!!dataWarehouseTables.find(n=>n.name===data.table),isSourceExternalTable=!!dataWarehouseTables.find(n=>n.name===table);if(isJoiningTableExternalTable||isSourceExternalTable)return(0,jsx_runtime.jsx)(JoinsMoreMenu,{tableName:table,fieldName:data.name})}return null}}]})}var schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts");function BatchExportConfigurationSaveButton(){let{logicProps}=(0,index_esm.useValues)(batchExportSceneLogic),logic=batchExportConfigurationLogic(logicProps),{isNew,isConfigurationSubmitting,configurationChanged}=(0,index_esm.useValues)(logic),{submitConfiguration}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",htmlType:"submit",onClick:submitConfiguration,loading:isConfigurationSubmitting,disabledReason:configurationChanged?isConfigurationSubmitting?"Saving in progress…":void 0:"No changes to save",size:"small",children:isNew?"Create":"Save"})}function BatchExportConfigurationClearChangesButton(){let{logicProps}=(0,index_esm.useValues)(batchExportSceneLogic),logic=batchExportConfigurationLogic(logicProps),{isNew,isConfigurationSubmitting,configurationChanged,savedConfiguration,service}=(0,index_esm.useValues)(logic),{resetConfiguration}=(0,index_esm.useActions)(logic);return configurationChanged?(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",htmlType:"reset",onClick:()=>isNew&&service?resetConfiguration(getDefaultConfiguration(service)):resetConfiguration(savedConfiguration),disabledReason:configurationChanged?isConfigurationSubmitting?"Saving in progress…":void 0:"No changes",size:"small",children:isNew?"Reset":"Clear changes"}):null}var IntegrationChoice=__webpack_require__("../../frontend/src/lib/components/CyclotronJob/integrations/IntegrationChoice.tsx");function BatchExportGeneralEditFields(_ref){let{isNew,isPipeline=!1,batchExportConfigForm}=_ref;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[!isPipeline&&(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"Name your workflow for future reference"})}),(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap gap-2 items-start",children:(!isPipeline||batchExportConfigForm.end_at)&&(0,jsx_runtime.jsx)(LemonField.D,{name:"end_at",label:"End date",className:"flex-1",info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"The date up to which data is to be exported. Leaving it unset implies that data exports will continue forever until this export is paused or deleted."}),children:_ref2=>{let{value,onChange}=_ref2;return(0,jsx_runtime.jsx)(src.he,{value:value,onChange:onChange,placeholder:"Select end date (optional)",clearable:!0})}})}),isNew&&!isPipeline?(0,jsx_runtime.jsx)(LemonField.D,{name:"paused",children:(0,jsx_runtime.jsx)(src.Hw,{bordered:!0,label:(0,jsx_runtime.jsxs)("span",{className:"flex gap-2 items-center",children:["Create in paused state",(0,jsx_runtime.jsx)(src.u,{title:"If selected, the Batch Exporter will be created but will be 'paused' allowing you to resumed it at a later date.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg text-secondary"})})]})})}):null]})})}function BatchExportsEditFields(_ref3){let{isNew,batchExportConfigForm,configurationChanged}=_ref3;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)("div",{className:"mt-4 deprecated-space-y-4 max-w-200",children:"S3"===batchExportConfigForm.destination?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"bucket_name",label:"Bucket",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"e.g. my-bucket"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"region",label:"Region",className:"flex-1",children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"us-east-1",label:"US East (N. Virginia)"},{value:"us-east-2",label:"US East (Ohio)"},{value:"us-west-1",label:"US West (N. California)"},{value:"us-west-2",label:"US West (Oregon)"},{value:"af-south-1",label:"Africa (Cape Town)"},{value:"ap-east-1",label:"Asia Pacific (Hong Kong)"},{value:"ap-south-1",label:"Asia Pacific (Mumbai)"},{value:"ap-northeast-3",label:"Asia Pacific (Osaka-Local)"},{value:"ap-northeast-2",label:"Asia Pacific (Seoul)"},{value:"ap-southeast-1",label:"Asia Pacific (Singapore)"},{value:"ap-southeast-2",label:"Asia Pacific (Sydney)"},{value:"ap-northeast-1",label:"Asia Pacific (Tokyo)"},{value:"ca-central-1",label:"Canada (Central)"},{value:"cn-north-1",label:"China (Beijing)"},{value:"cn-northwest-1",label:"China (Ningxia)"},{value:"eu-central-1",label:"Europe (Frankfurt)"},{value:"eu-west-1",label:"Europe (Ireland)"},{value:"eu-west-2",label:"Europe (London)"},{value:"eu-south-1",label:"Europe (Milan)"},{value:"eu-west-3",label:"Europe (Paris)"},{value:"eu-north-1",label:"Europe (Stockholm)"},{value:"me-east-1",label:"Middle East (Dubai)"},{value:"me-south-1",label:"Middle East (Bahrain)"},{value:"me-central-1",label:"Middle East (Riyadh)"},{value:"sa-east-1",label:"South America (São Paulo)"},{value:"auto",label:"Automatic (AUTO)"},{value:"apac",label:"Asia Pacific (APAC)"},{value:"eeur",label:"Eastern Europe (EEUR)"},{value:"enam",label:"Eastern North America (ENAM)"},{value:"weur",label:"Western Europe (WEUR)"},{value:"wnam",label:"Western North America (WNAM)"}]})})]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"prefix",label:"Key prefix",info:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Template variables are supported. Please check out the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/cdp/batch-exports/s3#s3-key-prefix-template-variables",target:"_blank",children:"docs"})," ","for more information."]}),children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"e.g. posthog-events/"})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"file_format",label:"Format",className:"flex-1",info:"We recommend Parquet with zstd compression for the best performance",children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"Parquet",label:"Apache Parquet"},{value:"JSONLines",label:"JSON lines"}]})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"max_file_size_mb",label:"Max file size (MiB)",showOptional:!0,className:"flex-1",info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Files over this max file size will be split into multiple files. Leave empty or set to 0 for no splitting regardless of file size"}),children:(0,jsx_runtime.jsx)(src.DF,{type:"number",min:0})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"compression",label:"Compression",className:"flex-1",children:_ref4=>{let{value,onChange}=_ref4,parquetCompressionOptions=[{value:"zstd",label:"zstd"},{value:"lz4",label:"lz4"},{value:"snappy",label:"snappy"},{value:"gzip",label:"gzip"},{value:"brotli",label:"brotli"},{value:null,label:"No compression"}],jsonLinesCompressionOptions=[{value:"gzip",label:"gzip"},{value:"brotli",label:"brotli"},{value:null,label:"No compression"}],compressionOptions="Parquet"===batchExportConfigForm.file_format?parquetCompressionOptions:"JSONLines"===batchExportConfigForm.file_format?jsonLinesCompressionOptions:[],isSelectedCompressionOptionValid=value=>"Parquet"===batchExportConfigForm.file_format?parquetCompressionOptions.some(option=>option.value===value):"JSONLines"===batchExportConfigForm.file_format&&jsonLinesCompressionOptions.some(option=>option.value===value);return react.useEffect(()=>{configurationChanged&&(isNew&&"JSONLines"===batchExportConfigForm.file_format?onChange(null):isNew&&"Parquet"===batchExportConfigForm.file_format?onChange("zstd"):isSelectedCompressionOptionValid(value)||onChange(null))},[configurationChanged,batchExportConfigForm.file_format,isNew]),(0,jsx_runtime.jsx)(src.Yv,{options:compressionOptions,value:value,onChange:onChange,placeholder:batchExportConfigForm.file_format?void 0:"Select file format first"})}}),(0,jsx_runtime.jsx)(LemonField.D,{name:"encryption",label:"Encryption",className:"flex-1",children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"AES256",label:"AES256"},{value:"aws:kms",label:"aws:kms"},{value:null,label:"No encryption"}]})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"aws_access_key_id",label:"AWS Access Key ID",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"e.g. AKIAIOSFODNN7EXAMPLE":"Leave unchanged"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"aws_secret_access_key",label:"AWS Secret Access Key",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"e.g. secret-key":"Leave unchanged",type:"password"})}),"aws:kms"==batchExportConfigForm.encryption&&(0,jsx_runtime.jsx)(LemonField.D,{name:"kms_key_id",label:"AWS KMS Key ID",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"e.g. 1234abcd-12ab-34cd-56ef-1234567890ab":"leave unchanged"})})]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"endpoint_url",label:"Endpoint URL",showOptional:!0,info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Only required if exporting to an S3-compatible blob storage (like MinIO)"}),children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"e.g. https://your-minio-host:9000":"Leave unchanged"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"use_virtual_style_addressing",label:"Virtual style addressing",showOptional:!0,info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:'Some non-AWS S3-compatible destinations may require this setting enabled. Check your destination\'s documentation if "virtual hosted style" is required, otherwise leave unchecked'}),children:(0,jsx_runtime.jsx)(src.Hw,{bordered:!0,label:(0,jsx_runtime.jsx)("span",{className:"flex gap-2 items-center",children:"Use virtual style addressing"})})})]}):"Snowflake"===batchExportConfigForm.destination?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"account",label:"Account",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-account"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"user",label:"User",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"my-user":"Leave unchanged"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"authentication_type",label:"Authentication type",className:"flex-1",children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"password",label:"Password"},{value:"keypair",label:"Key pair"}]})}),"keypair"!=batchExportConfigForm.authentication_type&&(0,jsx_runtime.jsx)(LemonField.D,{name:"password",label:"Password",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"my-password":"Leave unchanged",type:"password"})}),"keypair"==batchExportConfigForm.authentication_type&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"private_key",label:"Private key",children:(0,jsx_runtime.jsx)(src._V,{className:"ph-ignore-input",placeholder:isNew?"my-private-key":"Leave unchanged",minRows:4})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"private_key_passphrase",label:"Private key passphrase",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"my-passphrase":"Leave unchanged"})})]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"database",label:"Database",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-database"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"warehouse",label:"Warehouse",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-warehouse"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"schema",label:"Schema",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-schema"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"table_name",label:"Table name",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"events"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"role",label:"Role",showOptional:!0,children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-role"})})]}):"Postgres"===batchExportConfigForm.destination?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"user",label:"User",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"my-user":"Leave unchanged"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"password",label:"Password",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"my-password":"Leave unchanged",type:"password"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"host",label:"Host",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-host"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"port",label:"Port",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"5432",type:"number",min:"0",max:"65535"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"database",label:"Database",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-database"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"schema",label:"Schema",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"public"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"table_name",label:"Table name",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"events"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"has_self_signed_cert",children:_ref5=>{let{value,onChange}=_ref5;return(0,jsx_runtime.jsx)(src.Hw,{bordered:!0,label:(0,jsx_runtime.jsxs)("span",{className:"flex gap-2 items-center",children:["Does your Postgres instance have a self-signed SSL certificate?",(0,jsx_runtime.jsx)(src.u,{title:"In most cases, Heroku and RDS users should check this.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg text-secondary"})})]}),checked:!!value,onChange:onChange})}})]}):"Redshift"===batchExportConfigForm.destination?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"user",label:"User",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"my-user":"Leave unchanged"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"password",label:"Password",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"my-password":"Leave unchanged",type:"password"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"host",label:"Host",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-host"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"port",label:"Port",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"5439",type:"number",min:"0",max:"65535"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"database",label:"Database",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-database"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"schema",label:"Schema",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"public"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"table_name",label:"Table name",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"events"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"properties_data_type",label:"Semi-structured data type",info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:'Different PostHog models have semi-structured data fields in them, like "events.properties". We can export these fields to Redshift as a "SUPER" type column, or a "VARCHAR" column. We recommend "SUPER" over "VARCHAR" as "VARCHAR" has a strict length limit that applies on the entire document, whereas with "SUPER" the limit applies on each value in the document.'}),children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"varchar",label:"VARCHAR(65535)"},{value:"super",label:"SUPER"}]})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"mode",label:"Command",className:"flex-1",info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:'Choose the SQL command used by the batch export. "COPY" has the best performance but requires an S3 bucket we can connect to. "INSERT" performs worse but without any additional requirements.'}),children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"COPY",label:"COPY"},{value:"INSERT",label:"INSERT"}]})}),"COPY"===batchExportConfigForm.mode&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted mt-1",children:"In order to execute a COPY SQL command, the batch export will first export files to an S3 bucket, which requires credentials to access it. After the files are available in the bucket, we will instruct Redshift to copy them into the configured table. As part of this, the batch export needs to specify to Redshift how to access your bucket. For this reason, additionally to the first set of credentials used by the batch export, either an IAM role (recommended), or the same or a different set of credentials is required."}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"redshift_s3_bucket",label:"S3 bucket name",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"e.g. my-bucket"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"redshift_s3_bucket_region_name",label:"S3 bucket region",className:"flex-1",children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"us-east-1",label:"US East (N. Virginia)"},{value:"us-east-2",label:"US East (Ohio)"},{value:"us-west-1",label:"US West (N. California)"},{value:"us-west-2",label:"US West (Oregon)"},{value:"af-south-1",label:"Africa (Cape Town)"},{value:"ap-east-1",label:"Asia Pacific (Hong Kong)"},{value:"ap-south-1",label:"Asia Pacific (Mumbai)"},{value:"ap-northeast-3",label:"Asia Pacific (Osaka-Local)"},{value:"ap-northeast-2",label:"Asia Pacific (Seoul)"},{value:"ap-southeast-1",label:"Asia Pacific (Singapore)"},{value:"ap-southeast-2",label:"Asia Pacific (Sydney)"},{value:"ap-northeast-1",label:"Asia Pacific (Tokyo)"},{value:"ca-central-1",label:"Canada (Central)"},{value:"cn-north-1",label:"China (Beijing)"},{value:"cn-northwest-1",label:"China (Ningxia)"},{value:"eu-central-1",label:"Europe (Frankfurt)"},{value:"eu-west-1",label:"Europe (Ireland)"},{value:"eu-west-2",label:"Europe (London)"},{value:"eu-south-1",label:"Europe (Milan)"},{value:"eu-west-3",label:"Europe (Paris)"},{value:"eu-north-1",label:"Europe (Stockholm)"},{value:"me-south-1",label:"Middle East (Bahrain)"},{value:"me-central-1",label:"Middle East (Riyadh)"},{value:"sa-east-1",label:"South America (São Paulo)"}]})})]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"redshift_s3_key_prefix",label:"S3 key prefix",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"e.g. /posthog-copy-files"})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"redshift_s3_bucket_aws_access_key_id",label:"AWS Access Key ID",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"e.g. AKIAIOSFODNN7EXAMPLE":"Leave unchanged"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"redshift_s3_bucket_aws_secret_access_key",label:"AWS Secret Access Key",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"e.g. secret-key":"Leave unchanged",type:"password"})})]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"authorization_mode",label:"Authorization",className:"flex-1",info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Redshift needs to authenticate to COPY data from your S3 bucket. Choose whether to assume an IAM role or to provide it with credentials to access the S3 bucket."}),children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"IAMRole",label:"IAM Role"},{value:"Credentials",label:"Credentials"}]})}),"IAMRole"===batchExportConfigForm.authorization_mode&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonField.D,{name:"redshift_iam_role",label:"IAM Role ARN",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"e.g. arn:aws:iam::<aws-account-id>:role/<role-name>"})})}),"Credentials"===batchExportConfigForm.authorization_mode&&(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"redshift_aws_access_key_id",label:"AWS Access Key ID",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"e.g. AKIAIOSFODNN7EXAMPLE":"Leave unchanged"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"redshift_aws_secret_access_key",label:"AWS Secret Access Key",className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:isNew?"e.g. secret-key":"Leave unchanged",type:"password"})})]})]})]}):"BigQuery"===batchExportConfigForm.destination?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"json_config_file",label:"Google Cloud JSON key file",children:(0,jsx_runtime.jsx)(src.mH,{accept:".json",multiple:!1})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"table_id",label:"Table ID",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"events"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"dataset_id",label:"Dataset ID",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"dataset"})}),isNew?(0,jsx_runtime.jsx)(LemonField.D,{name:"use_json_type",label:"Structured fields data type",children:(0,jsx_runtime.jsx)(src.Hw,{bordered:!0,label:(0,jsx_runtime.jsxs)("span",{className:"flex gap-2 items-center",children:["Export 'properties', 'set', and 'set_once' fields as BigQuery JSON type",(0,jsx_runtime.jsx)(src.u,{title:"If left unchecked, these fields will be sent as STRING type. This setting cannot be changed after batch export is created.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg text-secondary"})})]})})}):null]}):"Databricks"===batchExportConfigForm.destination?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"integration_id",label:"Integration",children:_ref6=>{let{value,onChange}=_ref6;return(0,jsx_runtime.jsx)(IntegrationChoice.a,{integration:"databricks",value:value,onChange:onChange})}}),(0,jsx_runtime.jsx)(LemonField.D,{name:"http_path",label:"HTTP Path",info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"HTTP Path value for your all-purpose compute or SQL warehouse."}),children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"/sql/1.0/warehouses/my-warehouse"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"catalog",label:"Catalog",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"workspace"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"schema",label:"Schema",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"default"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"table_name",label:"Table name",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-table"})}),isNew?(0,jsx_runtime.jsx)(LemonField.D,{name:"table_partition_field",label:"Table partition field",showOptional:!0,info:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["The field to partition the table by. If left empty, the default partition by field for the model will be used (if applicable). For more information, refer to the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://docs.databricks.com/aws/en/sql/language-manual/sql-ref-partition",target:"_blank",children:"Databricks documentation"}),".",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("strong",{children:"This setting cannot be changed after the batch export is created."})]}),children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"my-partition-field"})}):null,isNew?(0,jsx_runtime.jsx)(LemonField.D,{name:"use_variant_type",children:_ref7=>{let{value,onChange}=_ref7;return(0,jsx_runtime.jsx)(src.Hw,{checked:!!value,onChange:onChange,bordered:!0,label:(0,jsx_runtime.jsxs)("span",{className:"flex gap-2 items-center",children:["Use VARIANT type for storing JSON data",(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Using VARIANT for storing JSON data is"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://docs.databricks.com/aws/en/semi-structured/variant",target:"_blank",children:"recommended by Databricks"})," ",", however, the VARIANT data type is only available in Databricks Runtime 15.3 and above. If left unchecked, JSON data will be stored using the STRING type.",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("strong",{children:"This setting cannot be changed after the batch export is created."})]}),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg text-secondary"})})]})})}}):null]}):"HTTP"===batchExportConfigForm.destination?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"url",label:"PostHog region",children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"https://us.i.posthog.com/batch/",label:"US"},{value:"https://eu.i.posthog.com/batch/",label:"EU"}]})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"token",label:"Destination project API Key",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"e.g. phc_12345..."})})]}):null})})}function BatchExportConfiguration(){let{logicProps}=(0,index_esm.useValues)(batchExportSceneLogic),logic=batchExportConfigurationLogic(logicProps),{isNew,batchExportConfigTest,batchExportConfigTestLoading,configuration,configurationChanged,tables,batchExportConfig,selectedModel,runningStep}=(0,index_esm.useValues)(logic),{setSelectedModel,setConfigurationValue,runBatchExportConfigTestStep}=(0,index_esm.useActions)(logic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),highFrequencyBatchExports=featureFlags[constants.y8.HIGH_FREQUENCY_BATCH_EXPORTS],sessionsBatchExports=featureFlags[constants.y8.SESSIONS_BATCH_EXPORTS],requiredFieldsMissing=["interval"].filter(field=>!configuration[field]);return(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-3",children:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:batchExportConfigurationLogic,props:logicProps,formKey:"configuration",className:"deprecated-space-y-3",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4 items-start",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 min-w-100 deprecated-space-y-3",children:[(0,jsx_runtime.jsxs)("div",{className:"p-3 rounded border bg-surface-primary deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(LemonField.D,{label:"Status",name:"paused",info:"Start in a paused state or continuously exporting from now",children:_ref=>{let{value,onChange}=_ref;return(0,jsx_runtime.jsx)(src.f4,{label:"Enabled",onChange:()=>onChange(!value),checked:!value,fullWidth:!0,bordered:!0})}}),(0,jsx_runtime.jsx)("div",{className:"flex gap-2 min-h-16",children:(0,jsx_runtime.jsx)(LemonField.D,{name:"interval",label:"Interval",className:"flex-1",info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Dictates the frequency of batch export runs. For example, if you select hourly, a new batch export run will start every hour."}),children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"hour",label:"Hourly"},{value:"day",label:"Daily"},{value:"every 5 minutes",label:"Every 5 minutes",hidden:!highFrequencyBatchExports}]})})})]}),(0,jsx_runtime.jsxs)("div",{className:"p-3 rounded border bg-surface-primary deprecated-space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex gap-2 min-h-16",children:(0,jsx_runtime.jsx)(LemonField.D,{name:"model",label:"Model",info:"A model defines the data that will be exported.",className:"flex flex-1",children:(0,jsx_runtime.jsx)(src.Yv,{options:tables.map(table=>({value:table.name,label:table.id,hidden:!sessionsBatchExports&&"sessions"===table.name})),value:selectedModel,onSelect:newValue=>{setSelectedModel(newValue)},fullWidth:!0})})}),(0,jsx_runtime.jsx)("div",{className:"flex gap-2",children:(0,jsx_runtime.jsx)(LemonCollapse.J,{className:"flex flex-1",panels:[{key:"schema",header:"View model schema",content:(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(DatabaseTable,{table:selectedModel||"events",tables:tables,inEditSchemaMode:!1})})}]})}),"events"===selectedModel?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 min-h-16",children:[(0,jsx_runtime.jsx)("div",{className:"flex gap-2 justify-between w-full",children:(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Include events"})}),(0,jsx_runtime.jsxs)("p",{className:"mb-0 text-xs text-secondary",children:["If set, the batch export will ",(0,jsx_runtime.jsx)("b",{children:"only"})," export events matching any of the below. If left unset, all events will be exported."]}),(0,jsx_runtime.jsx)(EventSelect._,{onChange:includedEvents=>{setConfigurationValue("include_events",includedEvents.filter(event=>null!=event))},selectedEvents:configuration.include_events?configuration.include_events:[],addElement:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),sideIcon:null,children:"Include event"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 min-h-16",children:[(0,jsx_runtime.jsx)("div",{className:"flex gap-2 justify-between w-full",children:(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Exclude events"})}),(0,jsx_runtime.jsxs)("p",{className:"mb-0 text-xs text-secondary",children:["If set, the batch export will ",(0,jsx_runtime.jsx)("b",{children:"exclude"})," events matching any of the below. If left unset, no events will be excluded from the export."]}),(0,jsx_runtime.jsx)(EventSelect._,{onChange:excludedEvents=>{setConfigurationValue("exclude_events",excludedEvents.filter(event=>null!=event))},selectedEvents:configuration.exclude_events?configuration.exclude_events:[],addElement:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),sideIcon:null,children:"Exclude event"})})]}),(0,jsx_runtime.jsx)("div",{className:"flex gap-2 min-h-16",children:(0,jsx_runtime.jsx)(LemonField.D,{name:"filters",label:"Filters",className:"flex flex-1",children:(0,jsx_runtime.jsx)(PropertyFilters.t,{propertyFilters:configuration.filters?configuration.filters:[],taxonomicGroupTypes:"events"===selectedModel?[TaxonomicFilter_types.t.EventProperties]:[TaxonomicFilter_types.t.PersonProperties],onChange:filters=>{setConfigurationValue("filters",filters)},pageKey:`BatchExportsPropertyFilters.${batchExportConfig?batchExportConfig.id:"New"}`,metadataSource:{kind:schema_general.OH.ActorsQuery}})})})]}):null]})]}),(0,jsx_runtime.jsxs)("div",{className:"gap-4 flex-2 deprecated-space-y-4 min-w-100",children:[(0,jsx_runtime.jsx)("div",{className:"p-3 rounded border bg-surface-primary",children:(0,jsx_runtime.jsx)(BatchExportConfigurationFields,{isNew:isNew,formValues:configuration,configurationChanged:configurationChanged})}),batchExportConfigTest&&(0,jsx_runtime.jsx)("div",{className:"p-3 rounded border bg-surface-primary",children:(0,jsx_runtime.jsx)(BatchExportConfigurationTests,{batchExportConfigTest:batchExportConfigTest,batchExportConfigTestLoading:batchExportConfigTestLoading,runningStep:runningStep,runBatchExportConfigTestStep:runBatchExportConfigTestStep,requiredFieldsMissing:requiredFieldsMissing})})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,jsx_runtime.jsx)(BatchExportConfigurationClearChangesButton,{}),(0,jsx_runtime.jsx)(BatchExportConfigurationSaveButton,{})]})]})})})}function BatchExportConfigurationFields(_ref2){let{isNew,formValues,configurationChanged}=_ref2;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(BatchExportGeneralEditFields,{isNew:isNew,isPipeline:!0,batchExportConfigForm:formValues}),(0,jsx_runtime.jsx)(BatchExportsEditFields,{isNew:isNew,batchExportConfigForm:formValues,configurationChanged:configurationChanged})]})}function BatchExportConfigurationTests(_ref3){let{batchExportConfigTest,batchExportConfigTestLoading,runningStep,runBatchExportConfigTestStep,requiredFieldsMissing}=_ref3;if(!batchExportConfigTest&&batchExportConfigTestLoading)return(0,jsx_runtime.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,jsx_runtime.jsx)(Spinner.$,{})});if(!batchExportConfigTest||!batchExportConfigTest.steps)return null;let renderStatusIcon=(step,index)=>step.result&&runningStep!==index?"Passed"===step.result.status?(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"text-green-500 shrink-0"}):(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{className:"text-red-500 shrink-0"}):(0,jsx_runtime.jsx)(Spinner.$,{}),header=(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("h2",{className:"flex gap-2 items-center m-0 text-lg font-semibold",children:"Test configuration"}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-secondary",children:"Test the batch export's configuration to uncover errors before saving it"})]});return requiredFieldsMissing.length>0?(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[header,(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",children:["Please select a value for the following fields before testing the configuration:"," ",requiredFieldsMissing.join(", ")]})]}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[header,(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>runBatchExportConfigTestStep(0),disabledReason:null!==runningStep?"Test step is running":null,size:"small",type:"primary",children:runningStep?"Testing...":"Start test"})]}),(0,jsx_runtime.jsx)("div",{className:"space-y-4",children:batchExportConfigTest.steps.map((step,index)=>step.result||index===runningStep?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-start",children:[(0,jsx_runtime.jsx)("div",{className:"mt-1",children:renderStatusIcon(step,index)}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{info:step.description,className:"mb-2",children:step.name}),step.result&&(0,jsx_runtime.jsx)("div",{className:"mt-2",children:(0,jsx_runtime.jsx)(LemonBanner.V,{type:"Passed"===step.result.status?"success":"error",children:"Passed"===step.result.status?"Success":`${step.result.message}`})})]})]})},`${step.name}-${index}`):null)})]})}var BatchExportIcon=__webpack_require__("../../frontend/src/scenes/data-pipelines/batch-exports/BatchExportIcon.tsx"),colors=__webpack_require__("../../frontend/src/lib/colors.ts"),AppMetricSummary=__webpack_require__("../../frontend/src/lib/components/AppMetrics/AppMetricSummary.tsx"),AppMetricsFilters=__webpack_require__("../../frontend/src/lib/components/AppMetrics/AppMetricsFilters.tsx"),AppMetricsTrends=__webpack_require__("../../frontend/src/lib/components/AppMetrics/AppMetricsTrends.tsx"),appMetricsLogic=__webpack_require__("../../frontend/src/lib/components/AppMetrics/appMetricsLogic.ts");let BATCH_EXPORT_METRICS_INFO={succeeded:{name:"Success",description:"Total number of runs processed successfully",color:(0,colors.cM)("success")},rows_exported:{name:"Rows exported",description:"Total number of rows successfully exported",color:(0,colors.cM)("success")},failed:{name:"Failure",description:"Total number of runs that had errors during processing",color:(0,colors.cM)("danger")},failed_billing:{name:"Billing limit",description:"Total number of runs that failed due to exceeding billing limit",color:(0,colors.cM)("danger")},canceled:{name:"Canceled",description:"Total number of runs that were canceled",color:(0,colors.cM)("warning")}};function BatchExportsMetrics(_ref){let{id}=_ref,logicKey=`batch-exports-metrics-${id}`,logic=(0,appMetricsLogic.t)({logicKey,loadOnChanges:!0,forceParams:{appSource:"batch_export",appSourceId:id,metricName:Object.keys(BATCH_EXPORT_METRICS_INFO),breakdownBy:"metric_name"}}),{appMetricsTrends,appMetricsTrendsLoading,getSingleTrendSeries}=(0,index_esm.useValues)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row gap-2 flex-wrap justify-end",children:(0,jsx_runtime.jsx)(AppMetricsFilters.f,{logicKey:logicKey})}),(0,jsx_runtime.jsx)("div",{className:"flex flex-row gap-2 flex-wrap justify-center",children:["succeeded","rows_exported","failed","failed_billing","canceled"].map(key=>(0,jsx_runtime.jsx)(AppMetricSummary.p,{name:BATCH_EXPORT_METRICS_INFO[key].name,description:BATCH_EXPORT_METRICS_INFO[key].description,loading:appMetricsTrendsLoading,timeSeries:getSingleTrendSeries(key),previousPeriodTimeSeries:getSingleTrendSeries(key,!0),color:BATCH_EXPORT_METRICS_INFO[key].color,colorIfZero:(0,colors.cM)("muted")},key))}),(0,jsx_runtime.jsx)(AppMetricsTrends.f,{appMetricsTrends:appMetricsTrends,loading:appMetricsTrendsLoading})]})}let BATCH_EXPORT_SCENE_TABS=["configuration","metrics","logs","runs","backfills"],batchExportSceneLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return null!=id?id:"new"}),(0,index_esm.path)(key=>["scenes","data-pipelines","batch-exports","batchExportSceneLogic",key]),(0,index_esm.actions)({setCurrentTab:tab=>({tab})}),(0,index_esm.reducers)(()=>({currentTab:["configuration",{setCurrentTab:(_,_ref2)=>{let{tab}=_ref2;return tab}}]})),(0,index_esm.selectors)({logicProps:[()=>[(_,props)=>props],props=>props],breadcrumbs:[()=>[],()=>[{key:sceneTypes.x.DataPipelines,name:"Data pipelines",path:urls.j.dataPipelines(),iconType:"data_pipeline"},{key:[sceneTypes.x.DataPipelines,"destinations"],name:"Destinations",path:urls.j.dataPipelines("destinations"),iconType:"data_pipeline"},{key:sceneTypes.x.BatchExport,name:"Batch export",iconType:"data_pipeline"}]]}),(0,lib.actionToUrl)(_ref3=>{let{values}=_ref3;return{setCurrentTab:()=>[lib.router.values.location.pathname,{...lib.router.values.searchParams,tab:values.currentTab},lib.router.values.hashParams]}}),(0,lib.urlToAction)(_ref4=>{let{actions,values}=_ref4,reactToTabChange=(_,search)=>{var _search$tab;let possibleTab=null!==(_search$tab=search.tab)&&void 0!==_search$tab?_search$tab:"configuration",tab=BATCH_EXPORT_SCENE_TABS.includes(possibleTab)?possibleTab:"configuration";tab!==values.currentTab&&actions.setCurrentTab(tab)};return{[urls.j.batchExport(":id")]:reactToTabChange,[urls.j.batchExportNew(":service")]:reactToTabChange}})]),scene={component:BatchExportScene,logic:batchExportSceneLogic,paramsToProps:_ref5=>{let{params:{id,service}}=_ref5;return{id:"new"===id?null:id,service:service?(0,utils.l)(service):null}}};function BatchExportSceneHeader(_ref6){let{logicProps}=_ref6,{configuration,batchExportConfigLoading}=(0,index_esm.useValues)(batchExportConfigurationLogic(logicProps)),{setConfigurationValue,deleteBatchExport}=(0,index_esm.useActions)(batchExportConfigurationLogic(logicProps));return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:configuration.name,description:null,resourceType:{type:"data_pipelines",forceIcon:configuration.destination?(0,jsx_runtime.jsx)(BatchExportIcon.oe,{size:"medium",type:configuration.destination}):void 0},isLoading:batchExportConfigLoading,onNameChange:value=>setConfigurationValue("name",value),onDescriptionChange:value=>setConfigurationValue("description",value),canEdit:!0,actions:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(More.T,{size:"small",overlay:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonButton.J,{status:"danger",fullWidth:!0,onClick:()=>deleteBatchExport(),children:"Delete"})})}),(0,jsx_runtime.jsx)(src.p2,{vertical:!0}),(0,jsx_runtime.jsx)(BatchExportConfigurationClearChangesButton,{}),(0,jsx_runtime.jsx)(BatchExportConfigurationSaveButton,{})]})})})}function BatchExportScene(componentProps){let{id,service:serviceParam}=componentProps,logicProps={id:null!=id?id:null,service:serviceParam?(0,utils.l)(serviceParam):null},logic=(0,index_esm.useMountedLogic)(batchExportSceneLogic(logicProps));return(0,jsx_runtime.jsx)(BatchExportSceneContent,{logic:logic,logicProps:logicProps})}function BatchExportSceneContent(_ref7){let{logic,logicProps}=_ref7,{currentTab}=(0,index_esm.useValues)(logic),{setCurrentTab}=(0,index_esm.useActions)(logic),{id,service}=logicProps,{batchExportConfig,loading}=(0,index_esm.useValues)(batchExportConfigurationLogic(logicProps));if(loading&&!batchExportConfig)return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsx)(src.yW,{className:"w-full h-12"}),(0,jsx_runtime.jsx)(HogFunctionSkeleton.X,{})]});if(id&&!batchExportConfig)return(0,jsx_runtime.jsx)(NotFound.T,{object:"Batch export"});if(service&&!types.e2.includes(service))return(0,jsx_runtime.jsx)(NotFound.T,{object:`batch export service ${service}`});let tabs=[{label:"Configuration",key:"configuration",content:(0,jsx_runtime.jsx)(BatchExportConfiguration,{})},id?{label:"Metrics",key:"metrics",content:(0,jsx_runtime.jsx)(FlaggedFeature.P,{flag:"batch-export-new-metrics",fallback:(0,jsx_runtime.jsx)(PipelineNodeMetrics._,{id:id}),children:(0,jsx_runtime.jsx)(BatchExportsMetrics,{id:id})})}:null,id?{label:"Logs",key:"logs",content:(0,jsx_runtime.jsx)(FlaggedFeature.P,{flag:"batch-export-new-logs",fallback:(0,jsx_runtime.jsx)(PipelineNodeLogs.e,{id:id}),children:(0,jsx_runtime.jsx)(LogsViewer.FW,{sourceType:"batch_exports",sourceId:id,instanceLabel:"run"})})}:null,id?{label:"Runs",key:"runs",content:(0,jsx_runtime.jsx)(BatchExportRuns,{id:id})}:null,id?{label:"Backfills",key:"backfills",content:(0,jsx_runtime.jsx)(BatchExportBackfills,{id:id})}:null];return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(BatchExportSceneHeader,{logicProps:logicProps}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,tabs:tabs,onChange:setCurrentTab,sceneInset:!0})]})}},"../../frontend/src/scenes/data-pipelines/batch-exports/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>normalizeBatchExportService,x:()=>humanizeBatchExportName});var _types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/types.ts");let humanizeBatchExportName=service=>"HTTP"===service?"PostHog HTTP":service,normalizeBatchExportService=service=>{var _BATCH_EXPORT_SERVICE;return null!==(_BATCH_EXPORT_SERVICE=_types__WEBPACK_IMPORTED_MODULE_0__.e2.find(s=>s.toLowerCase()===service.toLowerCase()))&&void 0!==_BATCH_EXPORT_SERVICE?_BATCH_EXPORT_SERVICE:service}},"../../frontend/src/scenes/hog-functions/misc/HogFunctionSkeleton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X:()=>HogFunctionSkeleton});var lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function HogFunctionSkeleton(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)("div",{className:"flex flex-row flex-wrap gap-4 h-120",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)("div",{className:"flex flex-col flex-1 gap-4 min-w-60",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_0__.y,{className:"flex-1 w-full h-full"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_0__.y,{className:"flex-1 w-full h-full"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("div",{className:"flex flex-col gap-4 flex-2 min-w-60",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_0__.y,{className:"flex-1 w-full h-full"})})]})}}}]);