"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[16790],{"../../frontend/src/scenes/audit-logs/AdvancedActivityLogsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AdvancedActivityLogsScene:()=>AdvancedActivityLogsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),PayGateMini=__webpack_require__("../../frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),humanizeActivity=__webpack_require__("../../frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),AnimatedCollapsible=__webpack_require__("../../frontend/src/lib/components/AnimatedCollapsible.tsx"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),LemonInputSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInputSelect/LemonInputSelect.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts");let DEFAULT_FILTERS={start_date:"-30d",users:[],scopes:[],activities:[],detail_filters:{},item_ids:[],page:1},ADVANCED_FILTERS=["was_impersonated","is_system","item_ids","detail_filters"],advancedActivityLogsLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","audit-logs","advancedActivityLogsLogic"]),(0,index_esm.connect)(()=>({values:[featureFlagLogic.featureFlagLogic,["featureFlags"],userLogic.userLogic,["hasAvailableFeature"]]})),(0,index_esm.actions)({setFilters:filters=>({filters}),setPage:page=>({page}),clearAllFilters:!0,setActiveTab:tab=>({tab}),setShowMoreFilters:show=>({show}),addActiveFilter:function(fieldPath){let isCustom=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{fieldPath,isCustom}},updateActiveFilter:(key,updates)=>({key,updates}),removeActiveFilter:key=>({key}),setActiveFilters:activeFilters=>({activeFilters}),syncFiltersToAPI:!0,exportLogs:format=>({format})}),(0,index_esm.reducers)({filters:[DEFAULT_FILTERS,{setFilters:(state,_ref)=>{let{filters}=_ref;return(0,utils.hO)({...state,...filters})},setPage:(state,_ref2)=>{let{page}=_ref2;return{...state,page}},clearAllFilters:()=>DEFAULT_FILTERS}],activeFilters:[[],{addActiveFilter:(state,_ref3)=>{let{fieldPath,isCustom}=_ref3;return[...state,{key:`filter_${Date.now()}`,fieldPath:isCustom?"":fieldPath,operation:"exact",value:"",isCustom}]},updateActiveFilter:(state,_ref4)=>{let{key,updates}=_ref4;return state.map(filter=>filter.key===key?{...filter,...updates}:filter)},removeActiveFilter:(state,_ref5)=>{let{key}=_ref5;return state.filter(filter=>filter.key!==key)},setActiveFilters:(_,_ref6)=>{let{activeFilters}=_ref6;return activeFilters},clearAllFilters:()=>[]}],activeTab:["logs",{setActiveTab:(_,_ref7)=>{let{tab}=_ref7;return tab}}],showMoreFilters:[!1,{setShowMoreFilters:(_,_ref8)=>{let{show}=_ref8;return show},setFilters:(state,_ref9)=>{let{filters}=_ref9;return!!ADVANCED_FILTERS.some(key=>{if("detail_filters"===key)return filters.detail_filters&&Object.keys(filters.detail_filters).length>0;let value=filters[key];return null!=value&&(!Array.isArray(value)||value.length>0)})||state}}]}),(0,lib.loaders)(_ref10=>{let{values}=_ref10;return{advancedActivityLogs:[{results:[],count:0},{loadAdvancedActivityLogs:async(_,breakpoint)=>{await breakpoint(300);let params=new URLSearchParams;if(values.filters.start_date){let startDate=(0,utils.FZ)(values.filters.start_date);startDate&&params.append("start_date",startDate.toISOString())}if(values.filters.end_date){let endDate=(0,utils.FZ)(values.filters.end_date);endDate&&params.append("end_date",endDate.toISOString())}return values.filters.users?.forEach(user=>params.append("users",user)),values.filters.scopes?.forEach(scope=>params.append("scopes",scope)),values.filters.activities?.forEach(activity=>params.append("activities",activity)),values.filters.item_ids?.forEach(item_id=>params.append("item_ids",item_id)),void 0!==values.filters.was_impersonated&&params.append("was_impersonated",values.filters.was_impersonated.toString()),void 0!==values.filters.is_system&&params.append("is_system",values.filters.is_system.toString()),values.filters.detail_filters&&Object.keys(values.filters.detail_filters).length>0&&params.append("detail_filters",JSON.stringify(values.filters.detail_filters)),params.append("page",(values.filters.page||1).toString()),params.append("page_size",constants.Ls.toString()),params.append("include_organization_scoped","1"),await api.ZP.get(`api/projects/@current/advanced_activity_logs/?${params}`)}}],availableFilters:[null,{loadAvailableFilters:async()=>await api.ZP.get("api/projects/@current/advanced_activity_logs/available_filters/?include_organization_scoped=1")}],exports:[[],{loadExports:async()=>{let params=new URLSearchParams;return params.append("context_path","/advanced_activity_logs/"),(await api.ZP.get(`api/environments/@current/exports/?${params}`)).results||[]}}]}}),(0,index_esm.selectors)({hasActiveFilters:[s=>[s.filters],filters=>!!(filters.start_date||filters.end_date||filters.users?.length||filters.scopes?.length||filters.activities?.length||filters.item_ids?.length||void 0!==filters.was_impersonated||void 0!==filters.is_system||filters.detail_filters&&Object.keys(filters.detail_filters).length>0)],pagination:[s=>[s.filters,s.advancedActivityLogs],(filters,advancedActivityLogs)=>({controlled:!0,pageSize:constants.Ls,currentPage:filters.page||1,entryCount:advancedActivityLogs.count||0,onBackward:()=>advancedActivityLogsLogic.actions.setPage((filters.page||1)-1),onForward:()=>advancedActivityLogsLogic.actions.setPage((filters.page||1)+1)})],activeAdvancedFiltersCount:[s=>[s.filters],filters=>{let count=0;return void 0!==filters.was_impersonated&&count++,void 0!==filters.is_system&&count++,filters.item_ids&&filters.item_ids.length>0&&count++,filters.detail_filters&&Object.keys(filters.detail_filters).length>0&&count++,count}],urlSearchParams:[s=>[s.filters],filters=>(0,utils.hO)({...kea_router_lib.router.values.searchParams,start_date:filters.start_date,end_date:filters.end_date,users:filters.users?.length?filters.users.join(","):void 0,scopes:filters.scopes?.length?filters.scopes.join(","):void 0,activities:filters.activities?.length?filters.activities.join(","):void 0,item_ids:filters.item_ids?.length?filters.item_ids.join(","):void 0,was_impersonated:filters.was_impersonated?.toString(),is_system:filters.is_system?.toString(),detail_filters:filters.detail_filters&&Object.keys(filters.detail_filters).length>0?JSON.stringify(filters.detail_filters):void 0,page:filters.page&&filters.page>1?filters.page:void 0})]}),(0,index_esm.listeners)(_ref11=>{let{actions,values,cache}=_ref11;return{setFilters:async(_ref12,breakpoint)=>{let{filters}=_ref12;if(Object.keys(filters).some(key=>"page"!==key)&&values.filters.page&&values.filters.page>1&&!filters.page){actions.setPage(1);return}await breakpoint(300),actions.loadAdvancedActivityLogs({})},setPage:()=>{actions.loadAdvancedActivityLogs({})},clearAllFilters:()=>{actions.setActiveFilters([]),actions.setShowMoreFilters(!1),actions.loadAdvancedActivityLogs({})},setActiveTab:_ref13=>{let{tab}=_ref13;"exports"===tab?(actions.loadExports(),cache.disposables.add(()=>{let intervalId=setInterval(()=>{actions.loadExports()},5e3);return()=>clearInterval(intervalId)},"exportPollingInterval")):cache.disposables.dispose("exportPollingInterval")},addActiveFilter:_ref14=>{let{fieldPath}=_ref14;if("__add_custom__"===fieldPath){actions.addActiveFilter("",!0);return}actions.syncFiltersToAPI()},updateActiveFilter:()=>{actions.syncFiltersToAPI()},removeActiveFilter:()=>{actions.syncFiltersToAPI()},syncFiltersToAPI:()=>{let detailFilters={};values.activeFilters.forEach(filter=>{filter.fieldPath?.trim()&&(Array.isArray(filter.value)?filter.value.some(v=>v?.trim()):filter.value?.trim())&&(detailFilters[filter.fieldPath.includes("::")?filter.fieldPath.split("::")[1]:filter.fieldPath]={operation:filter.operation,value:filter.value})}),actions.setFilters({detail_filters:detailFilters}),Object.keys(detailFilters).length>0&&actions.setShowMoreFilters(!0)},loadAvailableFiltersSuccess:()=>{let searchParams=kea_router_lib.router.values.searchParams;if(searchParams.detail_filters&&values.availableFilters)try{let parsedDetailFilters=JSON.parse(searchParams.detail_filters),activeFilters=Object.entries(parsedDetailFilters).map((_ref15,index)=>{let[fieldPath,filter]=_ref15,isCustom=!0,fullFieldPath=fieldPath;if(values.availableFilters?.detail_fields){let scopeEntries=Object.entries(values.availableFilters.detail_fields),generalScope=scopeEntries.find(_ref16=>{let[scope]=_ref16;return"General"===scope}),otherScopes=scopeEntries.filter(_ref17=>{let[scope]=_ref17;return"General"!==scope});for(let scopeEntry of[generalScope,...otherScopes].filter(Boolean)){let[scope,scopeData]=scopeEntry;if(scopeData.fields.some(field=>field.name===fieldPath)){isCustom=!1,fullFieldPath=`${scope}::${fieldPath}`;break}}}return isCustom&&(fullFieldPath=fieldPath),{key:`url_filter_${index}_${Date.now()}`,fieldPath:fullFieldPath,operation:filter.operation,value:filter.value,isCustom}});actions.setActiveFilters(activeFilters),actions.setShowMoreFilters(!0)}catch(e){console.error("Failed to parse detail_filters from URL:",e)}},exportLogs:async _ref18=>{let{format}=_ref18;try{let startDate=values.filters.start_date?utils.FZ(values.filters.start_date)?.toISOString():void 0,endDate=values.filters.end_date?utils.FZ(values.filters.end_date)?.toISOString():void 0,filtersToExport={start_date:startDate,end_date:endDate,users:values.filters.users,scopes:values.filters.scopes,activities:values.filters.activities,detail_filters:values.filters.detail_filters,was_impersonated:values.filters.was_impersonated,is_system:values.filters.is_system,item_ids:values.filters.item_ids};await api.ZP.create("api/projects/@current/advanced_activity_logs/export/?include_organization_scoped=1",{format,filters:filtersToExport}),LemonToast.U.success(`Export started! Your ${format.toUpperCase()} export is being prepared.`),actions.setActiveTab("exports")}catch(error){console.error("Export failed:",error),LemonToast.U.error("Failed to start export. Please try again.")}}}}),(0,kea_router_lib.actionToUrl)(_ref19=>{let{values}=_ref19;return{setFilters:()=>[kea_router_lib.router.values.location.pathname,values.urlSearchParams,kea_router_lib.router.values.hashParams,{replace:!0}],setPage:()=>[kea_router_lib.router.values.location.pathname,values.urlSearchParams,kea_router_lib.router.values.hashParams,{replace:!0}]}}),(0,kea_router_lib.urlToAction)(_ref20=>{let{actions}=_ref20;return{"/activity-logs":(_,searchParams)=>{if(!(Object.keys(searchParams).length>0)){actions.clearAllFilters();return}let urlFilters={};if(searchParams.start_date&&(urlFilters.start_date=searchParams.start_date),searchParams.end_date&&(urlFilters.end_date=searchParams.end_date),searchParams.users&&(urlFilters.users=Array.isArray(searchParams.users)?searchParams.users:searchParams.users?.split(",")||[]),searchParams.scopes&&(urlFilters.scopes=Array.isArray(searchParams.scopes)?searchParams.scopes:searchParams.scopes?.split(",")||[]),searchParams.activities&&(urlFilters.activities=Array.isArray(searchParams.activities)?searchParams.activities:searchParams.activities?.split(",")||[]),searchParams.item_ids&&(urlFilters.item_ids=searchParams.item_ids.split?.(",")||[searchParams.item_ids]),void 0!==searchParams.was_impersonated&&(urlFilters.was_impersonated="true"===searchParams.was_impersonated||!0===searchParams.was_impersonated),void 0!==searchParams.is_system&&(urlFilters.is_system="true"===searchParams.is_system||!0===searchParams.is_system),searchParams.detail_filters)try{urlFilters.detail_filters=JSON.parse(searchParams.detail_filters)}catch(e){console.error("Failed to parse detail_filters from URL:",e)}searchParams.page&&(urlFilters.page=parseInt(searchParams.page,10)),actions.setFilters(urlFilters)}}}),(0,index_esm.events)(_ref21=>{let{actions}=_ref21;return{afterMount:()=>{actions.loadAvailableFilters(),actions.loadAdvancedActivityLogs({})}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let DetailFilterRow=_ref=>{let{filter}=_ref,{availableFilters,activeFilters}=(0,index_esm.useValues)(advancedActivityLogsLogic),{updateActiveFilter,removeActiveFilter}=(0,index_esm.useActions)(advancedActivityLogsLogic),[localValue,setLocalValue]=(0,react.useState)(filter.value),[localFieldPath,setLocalFieldPath]=(0,react.useState)(filter.fieldPath),[fieldPathError,setFieldPathError]=(0,react.useState)(null),debounceTimerRef=(0,react.useRef)(null),fieldOptionsForRow=(0,react.useMemo)(()=>{if(!availableFilters?.detail_fields)return[];let selectedFields=new Set(activeFilters.filter(f=>f.key!==filter.key&&!f.isCustom).map(f=>f.fieldPath)),fieldGroups=new Map;return Object.entries(availableFilters.detail_fields).forEach(_ref2=>{let[scope,scopeData]=_ref2;scopeData.fields.forEach(field=>{let fieldValue=`${scope}::${field.name}`;if(!selectedFields.has(fieldValue)||fieldValue===filter.fieldPath){fieldGroups.has(field.name)||fieldGroups.set(field.name,{scopes:[],fullPaths:[]});let group=fieldGroups.get(field.name);group.scopes.includes(scope)||(group.scopes.push(scope),group.fullPaths.push(fieldValue))}})}),[{title:"Available Fields",options:Array.from(fieldGroups.entries()).sort((_ref3,_ref4)=>{let[a]=_ref3,[b]=_ref4;return a.localeCompare(b)}).map(_ref5=>{let[fieldName,group]=_ref5,displayName=fieldName.split(".").pop()||fieldName,scopeNames=group.scopes.map(scope=>scope.replace(/([A-Z])/g," $1").trim()).join(", "),displayPath=fieldName.length>50?(0,utils.mq)(fieldName,50):fieldName;return{value:group.fullPaths[0],label:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)("div",{children:displayName}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:displayPath})]}),tooltip:(0,jsx_runtime.jsxs)("div",{className:"text-xs",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("strong",{children:"Full path:"}),(0,jsx_runtime.jsx)("br",{}),fieldName]}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("strong",{children:"Available in:"}),(0,jsx_runtime.jsx)("br",{}),scopeNames]})]})}})}]},[availableFilters,filter.key,filter.fieldPath,activeFilters]),validateCustomFieldPath=path=>{if(!path||!path.trim())return"Field path cannot be empty";let cleanPath=path.trim();return/^[a-zA-Z0-9_.[\]]+$/.test(cleanPath)?null:"Field path can only contain letters, numbers, dots, underscores, and square brackets"};(0,react.useEffect)(()=>{setLocalValue(filter.value)},[filter.value]),(0,react.useEffect)(()=>{setLocalFieldPath(filter.fieldPath)},[filter.fieldPath]);let handleValueChange=value=>{setLocalValue(value),debounceTimerRef.current&&clearTimeout(debounceTimerRef.current),(Array.isArray(value)?value.some(v=>v.length>0):value.length>0)&&(debounceTimerRef.current=setTimeout(()=>{updateActiveFilter(filter.key,{value})},500))};return(0,react.useEffect)(()=>()=>{debounceTimerRef.current&&clearTimeout(debounceTimerRef.current)},[]),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[filter.isCustom?(0,jsx_runtime.jsxs)("div",{className:"min-w-60",children:[(0,jsx_runtime.jsx)(src.DF,{value:localFieldPath,onChange:newPath=>{setLocalFieldPath(newPath);let error=validateCustomFieldPath(newPath);setFieldPathError(error),!error&&newPath&&newPath!==filter.fieldPath&&(debounceTimerRef.current&&clearTimeout(debounceTimerRef.current),debounceTimerRef.current=setTimeout(()=>{let cleanPath=newPath.trim();cleanPath&&cleanPath!==filter.fieldPath&&updateActiveFilter(filter.key,{fieldPath:cleanPath})},500))},placeholder:"Enter custom field path",status:fieldPathError?"danger":void 0,size:"small"}),fieldPathError&&(0,jsx_runtime.jsx)("div",{className:"text-xs text-danger mt-1",children:fieldPathError})]}):(0,jsx_runtime.jsx)(src.Yv,{value:filter.fieldPath,onChange:newFieldPath=>{newFieldPath!==filter.fieldPath&&(debounceTimerRef.current&&clearTimeout(debounceTimerRef.current),updateActiveFilter(filter.key,{fieldPath:newFieldPath}))},options:fieldOptionsForRow,placeholder:"Select field",size:"small",className:"min-w-60"}),(0,jsx_runtime.jsx)(src.Yv,{value:filter.operation,onChange:operation=>{let newValue=filter.value;"in"!==operation||Array.isArray(filter.value)||(newValue=filter.value&&filter.value.trim()?[filter.value]:[]),setLocalValue(newValue),updateActiveFilter(filter.key,{operation,value:newValue})},options:[{value:"exact",label:"equals"},{value:"contains",label:"contains"},{value:"in",label:"is one of"}],size:"small",className:"min-w-32"}),"in"===filter.operation?(0,jsx_runtime.jsx)(src.nt,{mode:"multiple",value:localValue,onChange:handleValueChange,allowCustomValues:!0,placeholder:"Enter values",size:"small",className:"min-w-60"}):(0,jsx_runtime.jsx)(src.DF,{value:localValue,onChange:handleValueChange,placeholder:"Enter value",size:"small",className:"min-w-60"}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),size:"small",type:"tertiary",onClick:()=>removeActiveFilter(filter.key),tooltip:"Remove filter"})]})},DetailFilters=()=>{let{activeFilters,availableFilters}=(0,index_esm.useValues)(advancedActivityLogsLogic),{addActiveFilter}=(0,index_esm.useActions)(advancedActivityLogsLogic),fieldOptions=(0,react.useMemo)(()=>{if(!availableFilters?.detail_fields)return[];let selectedFields=new Set(activeFilters.filter(f=>!f.isCustom).map(f=>f.fieldPath)),fieldGroups=new Map;Object.entries(availableFilters.detail_fields).forEach(_ref6=>{let[scope,scopeData]=_ref6;scopeData.fields.forEach(field=>{let fieldValue=`${scope}::${field.name}`;if(!selectedFields.has(fieldValue)){fieldGroups.has(field.name)||fieldGroups.set(field.name,{scopes:[],fullPaths:[]});let group=fieldGroups.get(field.name);group.scopes.includes(scope)||(group.scopes.push(scope),group.fullPaths.push(fieldValue))}})});let sections=[{title:"Available Fields",options:Array.from(fieldGroups.entries()).sort((_ref7,_ref8)=>{let[a]=_ref7,[b]=_ref8;return a.localeCompare(b)}).map(_ref9=>{let[fieldName,group]=_ref9,displayName=fieldName.split(".").pop()||fieldName,scopeNames=group.scopes.map(scope=>scope.replace(/([A-Z])/g," $1").trim()).join(", "),displayPath=fieldName.length>50?(0,utils.mq)(fieldName,50):fieldName;return{value:group.fullPaths[0],label:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)("div",{children:displayName}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:displayPath})]}),tooltip:(0,jsx_runtime.jsxs)("div",{className:"text-xs",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("strong",{children:"Full path:"}),(0,jsx_runtime.jsx)("br",{}),fieldName]}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("strong",{children:"Available in:"}),(0,jsx_runtime.jsx)("br",{}),scopeNames]})]})}})}];return sections.push({title:"Custom",options:[{value:"__add_custom__",label:(0,jsx_runtime.jsx)("span",{children:"Custom field path..."}),tooltip:(0,jsx_runtime.jsx)("div",{children:"Enter a custom field path manually"})}]}),sections},[availableFilters,activeFilters]);return availableFilters?.detail_fields&&0!==Object.keys(availableFilters.detail_fields).length?(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium",children:"Detail filters"}),(0,jsx_runtime.jsx)(src.u,{title:"Filter by specific fields within the activity log details field. For example, filter by changes to specific dashboard properties, feature flag variations, or other detailed attributes logged with each activity.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"w-4 h-4 text-muted-alt cursor-help"})})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-2",children:activeFilters.map(filter=>(0,jsx_runtime.jsx)(DetailFilterRow,{filter:filter},filter.key))}),(0,jsx_runtime.jsx)(src.Ds,{value:void 0,onChange:value=>{"__add_custom__"===value?addActiveFilter("",!0):value&&addActiveFilter(value,!1)},options:fieldOptions,placeholder:"Add filter",searchPlaceholder:"Search fields...",searchKeys:["value"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),size:"small",className:"w-[200px]"})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},BasicFiltersTab=()=>{let{filters,availableFilters,showMoreFilters,activeAdvancedFiltersCount}=(0,index_esm.useValues)(advancedActivityLogsLogic),{setFilters,setShowMoreFilters}=(0,index_esm.useActions)(advancedActivityLogsLogic);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4 pt-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 flex-start flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Date range"}),(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:filters.start_date,dateTo:filters.end_date,onChange:(start_date,end_date)=>{setFilters({start_date:start_date||void 0,end_date:end_date||void 0})},placeholder:"All time","data-attr":"audit-logs-date-filter",className:"h-[24px] flex items-center"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"User"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",value:filters.users||[],onChange:users=>setFilters({users}),options:availableFilters?.static_filters?.users?.map(u=>({key:u.value,label:u.label}))||[],placeholder:"All users",allowCustomValues:!1,"data-attr":"audit-logs-user-filter",size:"small",className:"min-w-50"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Scope"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",value:filters.scopes||[],onChange:scopes=>setFilters({scopes:scopes}),options:availableFilters?.static_filters?.scopes?.map(s=>({key:s.value,label:humanizeActivity.VI(s.value,!0)}))||[],placeholder:"All scopes",allowCustomValues:!1,"data-attr":"audit-logs-scope-filter",size:"small",className:"min-w-50"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Activity"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",value:filters.activities||[],onChange:activities=>setFilters({activities}),options:availableFilters?.static_filters?.activities?.map(a=>({key:a.value,label:humanizeActivity.J$(a.value)}))||[],placeholder:"All activities",allowCustomValues:!1,"data-attr":"audit-logs-action-filter",size:"small",className:"min-w-50"})]}),(0,jsx_runtime.jsx)("div",{className:"flex items-end justify-end mb-1",children:(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"tertiary",size:"small",icon:showMoreFilters?(0,jsx_runtime.jsx)(posthog_icons_es.IconCollapse,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand,{}),onClick:()=>setShowMoreFilters(!showMoreFilters),"data-attr":"audit-logs-more-filters-toggle",className:"text-muted-alt hover:text-default",children:"More filters"}),!showMoreFilters&&activeAdvancedFiltersCount>0&&(0,jsx_runtime.jsx)(src.Mo,{content:activeAdvancedFiltersCount.toString(),size:"small",className:"absolute -top-1 -right-1"})]})})]}),(0,jsx_runtime.jsx)(AnimatedCollapsible.r,{collapsed:!showMoreFilters,autoHeight:!0,children:(0,jsx_runtime.jsxs)("div",{className:"border-t border-border mt-4 pt-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 flex-start flex-wrap pt-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium",children:"Was impersonated?"}),(0,jsx_runtime.jsx)(src.u,{title:"During support, PostHog team members may act as a specific user to help troubleshoot issues. These impersonated actions are logged and can be filtered here.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"w-4 h-4 text-muted-alt cursor-help"})})]}),(0,jsx_runtime.jsx)(src.Yv,{value:void 0===filters.was_impersonated?"all":filters.was_impersonated.toString(),onChange:value=>setFilters({was_impersonated:"all"===value?void 0:"true"===value}),options:[{value:"all",label:"All"},{value:"true",label:"Yes"},{value:"false",label:"No"}],placeholder:"All","data-attr":"audit-logs-was-impersonated-filter",size:"small",className:"min-w-50"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium",children:"Is system activity?"}),(0,jsx_runtime.jsx)(src.u,{title:"Activities performed automatically by PostHog's system, such as scheduled tasks, background processes, or automated workflows.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"w-4 h-4 text-muted-alt cursor-help"})})]}),(0,jsx_runtime.jsx)(src.Yv,{value:void 0===filters.is_system?"all":filters.is_system.toString(),onChange:value=>setFilters({is_system:"all"===value?void 0:"true"===value}),options:[{value:"all",label:"All"},{value:"true",label:"Yes"},{value:"false",label:"No"}],placeholder:"All","data-attr":"audit-logs-is-system-filter",size:"small",className:"min-w-50"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium",children:"Item IDs"}),(0,jsx_runtime.jsx)(src.u,{title:"Filter by specific IDs of the items being tracked. Each activity log entry is associated with the ID of the object that was modified (e.g., dashboard ID, feature flag ID, etc.).",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"w-4 h-4 text-muted-alt cursor-help"})})]}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",value:filters.item_ids||[],onChange:item_ids=>setFilters({item_ids}),options:[],placeholder:"Enter item IDs",allowCustomValues:!0,"data-attr":"audit-logs-item-ids-filter",size:"small",className:"min-w-50"})]})]}),(0,jsx_runtime.jsx)("div",{className:"py-4",children:(0,jsx_runtime.jsx)(DetailFilters,{})})]})})]})};function AdvancedActivityLogFiltersPanel(){let{hasActiveFilters,exportsLoading}=(0,index_esm.useValues)(advancedActivityLogsLogic),{clearAllFilters,exportLogs}=(0,index_esm.useActions)(advancedActivityLogsLogic);return(0,jsx_runtime.jsxs)("div",{className:"border rounded-md p-4 bg-bg-light",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Qw,{overlay:(0,jsx_runtime.jsxs)("div",{className:"space-y-1 p-1",children:[(0,jsx_runtime.jsx)(src.Jp,{size:"small",fullWidth:!0,onClick:()=>exportLogs("csv"),loading:exportsLoading,"data-attr":"audit-logs-export-csv",children:"Export as CSV"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",fullWidth:!0,onClick:()=>exportLogs("xlsx"),loading:exportsLoading,"data-attr":"audit-logs-export-xlsx",children:"Export as Excel"})]}),placement:"bottom-end","data-attr":"audit-logs-export-dropdown",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),"data-attr":"audit-logs-export-button",children:"Export"})}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",disabledReason:hasActiveFilters?void 0:"No active filters",onClick:clearAllFilters,"data-attr":"audit-logs-clear-filters",children:"Clear all"})]})}),(0,jsx_runtime.jsx)(BasicFiltersTab,{})]})}var ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),activityLogLogic=__webpack_require__("../../frontend/src/lib/components/ActivityLog/activityLogLogic.tsx"),hedgehogs=__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx"),MonacoDiffEditor=__webpack_require__("../../frontend/src/lib/components/MonacoDiffEditor.tsx"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),ProfilePicture=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts");let columns=[{title:"Description",dataIndex:"description",key:"description",className:"max-w-80",render:description=>(0,jsx_runtime.jsx)("span",{className:"[&_*]:inline whitespace-nowrap overflow-hidden text-ellipsis",children:"string"==typeof description?description:description||"No description"}),width:"40%"},{title:"User",key:"user",render:(_,logItem)=>{var _logItem$email;return(0,jsx_runtime.jsx)(ProfilePicture.Y,{showName:!0,user:{first_name:logItem.isSystem?"PostHog":logItem.name,email:null!==(_logItem$email=logItem.email)&&void 0!==_logItem$email?_logItem$email:void 0},type:logItem.isSystem?"system":"person",size:"md"})},width:"20%"},{title:"Activity",key:"action",render:(_,logItem)=>(0,jsx_runtime.jsx)("span",{className:"capitalize",children:logItem.unprocessed?.activity||"Unknown"}),width:"20%"},{title:"Scope",key:"scope",render:(_,logItem)=>(0,jsx_runtime.jsx)("span",{className:"inline-block",children:logItem.unprocessed?.scope?(0,humanizeActivity.VI)(logItem.unprocessed.scope,!0):"Unknown"}),width:"20%"},{title:"Time",key:"time",render:(_,logItem)=>(0,jsx_runtime.jsx)(TZLabel.w,{time:logItem.created_at}),width:"10%"}];function AuditLogTable(_ref){let{logItems,pagination}=_ref,[expandedRows,setExpandedRows]=(0,react.useState)(new Set),toggleRowExpansion=(_,index)=>{setExpandedRows(prev=>{let newSet=new Set(prev);return newSet.has(index)?newSet.delete(index):newSet.add(index),newSet})},isRowExpanded=(_,index)=>expandedRows.has(index);return(0,jsx_runtime.jsx)(LemonTable.g,{columns:columns,dataSource:logItems,expandable:{expandedRowRender:logItem=>(0,jsx_runtime.jsx)(ExpandedRowContent,{logItem:logItem}),rowExpandable:()=>!0,isRowExpanded:(logItem,index)=>+!!isRowExpanded(logItem,index),onRowExpand:(logItem,index)=>toggleRowExpansion(logItem,index),onRowCollapse:(logItem,index)=>toggleRowExpansion(logItem,index)},onRow:(logItem,index)=>({onClick:e=>{!e.target.closest(".LemonTable__toggle")&&toggleRowExpansion(logItem,index)},style:{cursor:"pointer"}}),pagination:pagination,"data-attr":"audit-log-table"})}function ExpandedRowContent(_ref2){let{logItem}=_ref2,unprocessed=logItem.unprocessed;return unprocessed?(0,jsx_runtime.jsxs)("div",{className:"p-4 space-y-4",children:[(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-[11px] font-medium text-muted-alt uppercase tracking-wider mb-1",children:"Description"}),(0,jsx_runtime.jsx)("div",{className:"text-[13px] text-default",children:logItem.description})]}),logItem.extendedDescription&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-[11px] font-medium text-muted-alt uppercase tracking-wider mb-1",children:"Extended Description"}),(0,jsx_runtime.jsx)("div",{className:"text-[13px] text-default",children:logItem.extendedDescription})]}),unprocessed.item_id&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-[11px] font-medium text-muted-alt uppercase tracking-wider mb-1",children:"Item ID"}),(0,jsx_runtime.jsx)("div",{className:"text-[13px] text-default",children:unprocessed.item_id})]})]})}),(0,jsx_runtime.jsx)(ActivityDetailsSection,{logItem:logItem})]}):(0,jsx_runtime.jsx)("div",{className:"p-4 text-muted",children:"No additional details available"})}let ActivityDetailsSection=_ref3=>{let{logItem}=_ref3,[activeTab,setActiveTab]=(0,react.useState)("diff");return(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:key=>setActiveTab(key),"data-attr":"audit-log-details-tabs",tabs:[!!logItem.extendedDescription&&{key:"extended description",label:"Extended description",tooltip:"Some activities have a more detailed description that is not shown when collapsed.",content:(0,jsx_runtime.jsx)("div",{children:logItem.extendedDescription})},{key:"diff",label:"Diff",tooltip:"Show the diff of the changes made to the item. Each activity item could have more than one change.",content:(0,jsx_runtime.jsx)(ActivityLogDiff,{logItem:logItem})},{key:"raw",label:"Raw",tooltip:"Show the raw data of the activity item.",content:(0,jsx_runtime.jsx)("div",{className:"bg-surface-primary p-2 rounded border border-border text-sm",children:(0,jsx_runtime.jsx)("pre",{children:JSON.stringify(logItem.unprocessed,null,2)})})}]})},ActivityLogDiff=_ref4=>{let{logItem}=_ref4,changes=logItem.unprocessed?.detail.changes;return(0,jsx_runtime.jsx)("div",{className:"flex flex-col space-y-2 px-2 py-1",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col space-y-2",children:changes?.length?changes.map((change,i)=>(0,jsx_runtime.jsx)(JsonDiffViewer,{field:change.field||"",before:change.before,after:change.after},i)):(0,jsx_runtime.jsx)("div",{className:"text-muted",children:"This item has no changes to compare"})})})},JsonDiffViewer=_ref5=>{let{field,before,after}=_ref5,beforeStr=JSON.stringify(before,null,2),afterStr=JSON.stringify(after,null,2);return beforeStr===afterStr?(0,jsx_runtime.jsxs)("div",{className:"border rounded p-2 bg-surface-primary",children:[(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm mb-1",children:field}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs",children:"No changes detected"})]}):(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary",children:[(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm p-2",children:field}),(0,jsx_runtime.jsx)(MonacoDiffEditor.Z,{original:beforeStr,value:afterStr,modified:afterStr,language:"json",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,renderSideBySide:!0,hideUnchangedRegions:{enabled:!0,contextLineCount:3,minimumLineCount:3,revealLineCount:20},diffAlgorithm:"advanced"}})]})};function AdvancedActivityLogsList(){let{advancedActivityLogs,advancedActivityLogsLoading,pagination}=(0,index_esm.useValues)(advancedActivityLogsLogic),humanizedLogs=advancedActivityLogs?.results?(0,humanizeActivity.OI)(advancedActivityLogs.results,activityLogLogic.L_):[];return advancedActivityLogsLoading?(0,jsx_runtime.jsx)(AdvancedActivityLogsListSkeleton,{}):humanizedLogs.length?(0,jsx_runtime.jsx)(AuditLogTable,{logItems:humanizedLogs,pagination:pagination}):(0,jsx_runtime.jsx)(AdvancedActivityLogsEmptyState,{})}let AdvancedActivityLogsListSkeleton=()=>(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{})]}),AdvancedActivityLogsEmptyState=()=>(0,jsx_runtime.jsxs)("div",{"data-attr":"billing-empty-state",className:"flex flex-col border rounded px-4 py-8 items-center text-center mx-auto",children:[(0,jsx_runtime.jsx)(hedgehogs.DetectiveHog,{width:"100",height:"100",className:"mb-4"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl leading-tight",children:"We couldn't find any activity logs for your current query."}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-balance text-tertiary",children:"Try adjusting your filters or date range to see more results."})]});var dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts");let getStatusTag=exportAsset=>exportAsset.exception?(0,jsx_runtime.jsx)(src.oe,{type:"danger",children:"Failed"}):exportAsset.has_content?(0,jsx_runtime.jsx)(src.oe,{type:"success",children:"Completed"}):(0,jsx_runtime.jsx)(src.oe,{type:"default",children:"Processing"}),getHumanReadableFormat=format=>{let lowerFormat=format.toLowerCase();return["csv","text/csv"].some(matcher=>lowerFormat.includes(matcher))?"CSV":["xlsx","excel","spreadsheet"].some(matcher=>lowerFormat.includes(matcher))?"Excel":format.toUpperCase()},getFilterSummary=exportAsset=>{let filters=exportAsset.export_context?.filters;if(!filters)return"No filters";let activeFilters=[];return(filters.start_date||filters.end_date)&&activeFilters.push("Date: 1"),filters.users&&filters.users.length>0&&activeFilters.push(`Users: ${filters.users.length}`),filters.scopes&&filters.scopes.length>0&&activeFilters.push(`Scopes: ${filters.scopes.length}`),filters.activities&&filters.activities.length>0&&activeFilters.push(`Activities: ${filters.activities.length}`),filters.detail_filters&&Object.keys(filters.detail_filters).length>0&&activeFilters.push(`Detail filters: ${Object.keys(filters.detail_filters).length}`),void 0!==filters.was_impersonated&&activeFilters.push(`Was impersonated: ${filters.was_impersonated?"Yes":"No"}`),void 0!==filters.is_system&&activeFilters.push(`Is system: ${filters.is_system?"Yes":"No"}`),filters.item_ids&&filters.item_ids.length>0&&activeFilters.push(`Item IDs: ${filters.item_ids.length}`),activeFilters.length>0?activeFilters.join(", "):"No filters"},getFilterTooltip=exportAsset=>{let filters=exportAsset.export_context?.filters;if(!filters)return(0,jsx_runtime.jsx)("div",{children:"No filters applied"});let filterSections=[];if(filters.start_date||filters.end_date){let formatDate=dateStr=>{try{return(0,dayjs.Bv)(dateStr).format("YYYY-MM-DD HH:mm:ss")}catch{return dateStr}};filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("strong",{children:"Date range:"}),(0,jsx_runtime.jsx)("br",{}),filters.start_date&&`From: ${formatDate(filters.start_date)}`,filters.start_date&&filters.end_date&&(0,jsx_runtime.jsx)("br",{}),filters.end_date&&`To: ${formatDate(filters.end_date)}`]},"dates"))}if(filters.users&&filters.users.length>0&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("strong",{children:["Users (",filters.users.length,"):"]}),(0,jsx_runtime.jsx)("br",{}),filters.users.slice(0,5).join(", "),filters.users.length>5&&`... and ${filters.users.length-5} more`]},"users")),filters.scopes&&filters.scopes.length>0&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("strong",{children:["Scopes (",filters.scopes.length,"):"]}),(0,jsx_runtime.jsx)("br",{}),filters.scopes.slice(0,5).join(", "),filters.scopes.length>5&&`... and ${filters.scopes.length-5} more`]},"scopes")),filters.activities&&filters.activities.length>0&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("strong",{children:["Activities (",filters.activities.length,"):"]}),(0,jsx_runtime.jsx)("br",{}),filters.activities.slice(0,5).join(", "),filters.activities.length>5&&`... and ${filters.activities.length-5} more`]},"activities")),filters.detail_filters&&Object.keys(filters.detail_filters).length>0){let detailFilterEntries=Object.entries(filters.detail_filters),detailFilterText=detailFilterEntries.map(_ref=>{let[field,filter]=_ref,valueText=Array.isArray(filter.value)?filter.value.join(", "):filter.value,operationText="exact"===filter.operation?"equals":"contains"===filter.operation?"contains":"is one of";return`${field} ${operationText} "${valueText}"`});filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("strong",{children:["Detail filters (",detailFilterEntries.length,"):"]}),(0,jsx_runtime.jsx)("br",{}),detailFilterText.slice(0,3).join(", "),detailFilterText.length>3&&`... and ${detailFilterText.length-3} more`]},"detail_filters"))}return(void 0!==filters.was_impersonated&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("strong",{children:"Was impersonated:"}),(0,jsx_runtime.jsx)("br",{}),filters.was_impersonated?"Yes":"No"]},"was_impersonated")),void 0!==filters.is_system&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("strong",{children:"Is system activity:"}),(0,jsx_runtime.jsx)("br",{}),filters.is_system?"Yes":"No"]},"is_system")),filters.item_ids&&filters.item_ids.length>0&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("strong",{children:["Item IDs (",filters.item_ids.length,"):"]}),(0,jsx_runtime.jsx)("br",{}),filters.item_ids.slice(0,5).join(", "),filters.item_ids.length>5&&`... and ${filters.item_ids.length-5} more`]},"item_ids")),0===filterSections.length)?(0,jsx_runtime.jsx)("div",{children:"No filters applied"}):(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:filterSections.map((section,index)=>(0,jsx_runtime.jsx)("div",{children:section},index))})},downloadExport=exportAsset=>{let link=document.createElement("a");link.href=`/api/environments/@current/exports/${exportAsset.id}/content/?download=true`,link.download=exportAsset.filename||"",document.body.appendChild(link),link.click(),document.body.removeChild(link)};function ExportsList(){let{exports,exportsLoading}=(0,index_esm.useValues)(advancedActivityLogsLogic);if(!exports||0===exports.length)return(0,jsx_runtime.jsx)(ExportsEmptyState,{});let columns=[{title:"Filename",dataIndex:"filename",key:"filename",render:filename=>filename?String(filename):"export"},{title:"Format",dataIndex:"export_format",key:"export_format",render:format=>format?getHumanReadableFormat(String(format)):""},{title:"Filters",key:"filters",render:(_,exportAsset)=>(0,jsx_runtime.jsx)(src.u,{title:getFilterTooltip(exportAsset),children:(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs cursor-help truncate max-w-48",children:getFilterSummary(exportAsset)})})},{title:"Status",key:"status",render:(_,exportAsset)=>getStatusTag(exportAsset)},{title:"Created",dataIndex:"created_at",key:"created_at",render:createdAt=>createdAt?(0,utils.bo)(String(createdAt)):""},{title:"Actions",key:"actions",render:(_,exportAsset)=>{let failedReason=exportAsset.exception&&"Failed to export",disabledReason=!exportAsset.has_content&&"Export is not ready";return(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),disabledReason:failedReason||disabledReason,onClick:()=>downloadExport(exportAsset),"data-attr":`audit-logs-download-export-${exportAsset.id}`,children:"Download"})}}];return(0,jsx_runtime.jsx)("div",{className:"space-y-4",children:(0,jsx_runtime.jsx)(src.g3,{dataSource:exports,columns:columns,loading:exportsLoading,rowKey:"id",footer:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end mt-2 mr-2",children:(0,jsx_runtime.jsx)("p",{className:"text-muted text-xs",children:"Refreshed every 5 seconds"})})})})}let ExportsEmptyState=()=>(0,jsx_runtime.jsxs)("div",{"data-attr":"exports-empty-state",className:"flex flex-col border rounded px-4 py-8 items-center text-center mx-auto",children:[(0,jsx_runtime.jsx)(hedgehogs.DetectiveHog,{width:"100",height:"100",className:"mb-4"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl leading-tight",children:"No exports found"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-balance text-tertiary",children:'Exports will appear here when you create them from the Logs tab. Start by applying filters and then click "Export".'})]}),scene={component:AdvancedActivityLogsScene,logic:advancedActivityLogsLogic};function AdvancedActivityLogsScene(){let{activeTab}=(0,index_esm.useValues)(advancedActivityLogsLogic),{setActiveTab}=(0,index_esm.useActions)(advancedActivityLogsLogic),tabs=[{key:"logs",label:"Logs",content:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(AdvancedActivityLogFiltersPanel,{}),(0,jsx_runtime.jsx)(AdvancedActivityLogsList,{})]})},{key:"exports",label:"Exports",content:(0,jsx_runtime.jsx)(ExportsList,{})}];return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:"Activity logs",resourceType:{type:"team_activity",forceIcon:(0,jsx_runtime.jsx)(posthog_icons_es.IconNotification,{})}}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(PayGateMini.E,{feature:types.P$.AUDIT_LOGS,children:(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:key=>setActiveTab(key),tabs:tabs,sceneInset:!0})})]})}}}]);