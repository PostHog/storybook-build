var Ae=Object.defineProperty,Ee=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var ee=(m,d,s)=>d in m?Ae(m,d,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[d]=s,S=(m,d)=>{for(var s in d||(d={}))se.call(d,s)&&ee(m,s,d[s]);if(D)for(var s of D(d))te.call(d,s)&&ee(m,s,d[s]);return m},M=(m,d)=>Ee(m,Ie(d));var ne=(m,d)=>{var s={};for(var b in m)se.call(m,b)&&d.indexOf(b)<0&&(s[b]=m[b]);if(m!=null&&D)for(var b of D(m))d.indexOf(b)<0&&te.call(m,b)&&(s[b]=m[b]);return s};var v=(m,d,s)=>new Promise((b,T)=>{var r=O=>{try{N(s.next(O))}catch(p){T(p)}},x=O=>{try{N(s.throw(O))}catch(p){T(p)}},N=O=>O.done?b(O.value):Promise.resolve(O.value).then(r,x);N((s=s.apply(m,d)).next())});(window.webpackJsonp=window.webpackJsonp||[]).push([[316],{"./frontend/src/scenes/session-recordings/SessionRecordings.tsx":function(m,d,s){"use strict";s.r(d),s.d(d,"SessionsRecordings",function(){return q}),s.d(d,"scene",function(){return Fe});var b=s("./frontend/src/lib/components/PageHeader.tsx"),T=s("./frontend/src/scenes/teamLogic.tsx"),r=s("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),x=s("./frontend/src/scenes/urls.ts"),N=s("./frontend/src/scenes/session-recordings/playlist/SessionRecordingsPlaylist.tsx"),O=s("./frontend/src/lib/components/AlertMessage/index.ts"),p=s("./frontend/@posthog/lemon-ui/src/index.ts"),Z=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),f=s("./frontend/src/types.ts"),C=s("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),V=s("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),$=s("./frontend/src/lib/api.ts"),P=s("./frontend/src/lib/utils.tsx"),R=s("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),A=s("./frontend/src/scenes/session-recordings/playlist/playlistUtils.ts"),U=s("./frontend/src/lib/utils/eventUsageLogic.ts");const E=30,le={createdBy:"All users",page:1,dateFrom:"all"},ae=Object(r.kea)([Object(r.path)(n=>["scenes","session-recordings","saved-playlists","savedSessionRecordingPlaylistsLogic",n]),Object(r.props)({}),Object(r.key)(n=>n.tab),Object(r.connect)({actions:[U.e,["reportRecordingPlaylistCreated"]]}),Object(r.actions)(()=>({setSavedPlaylistsFilters:n=>({filters:n}),loadPlaylists:!0,updatePlaylist:(n,t)=>({shortId:n,properties:t}),deletePlaylist:n=>({playlist:n}),duplicatePlaylist:n=>({playlist:n})})),Object(r.reducers)(n=>{let{}=n;return{filters:[le,{setSavedPlaylistsFilters:(t,l)=>{let{filters:i}=l;return Object(P.qb)(S(S(S({},t||{}),i),"page"in i?{}:{page:1}))}}]}}),Object(V.loaders)(n=>{let{values:t,actions:l}=n;return{playlists:{__default:{results:[],count:0,filters:null},loadPlaylists:(i,a)=>v(this,null,function*(){var o,y;t.playlists.filters!==null&&(yield a(300));const c=S({},t.filters),u=c.createdBy==="All users"?void 0:c.createdBy,h={limit:E,offset:Math.max(0,(c.page-1)*E),order:(o=c.order)!==null&&o!==void 0?o:"-last_modified_at",created_by:u!=null?u:void 0,search:c.search||void 0,date_from:c.dateFrom&&c.dateFrom!="all"?c.dateFrom:void 0,date_to:(y=c.dateTo)!==null&&y!==void 0?y:void 0,pinned:c.pinned?!0:void 0},F=yield $.b.recordings.listPlaylists(Object(P.Ib)(h));return a(),F}),updatePlaylist:(i,a)=>v(this,null,function*(){let{shortId:o,properties:y}=i;yield a(100);const c=yield $.b.recordings.updatePlaylist(o,y);a();const u=t.playlists.results.findIndex(h=>h.short_id===c.short_id);return u>-1&&(t.playlists.results[u]=c),M(S({},t.playlists),{results:[...t.playlists.results]})}),deletePlaylist:i=>v(this,null,function*(){let{playlist:a}=i;return yield Object(A.b)(a,()=>l.loadPlaylists()),t.playlists.results=t.playlists.results.filter(o=>o.short_id!==a.short_id),t.playlists}),duplicatePlaylist:(i,a)=>v(this,null,function*(){let{playlist:o}=i;yield a(100);const F=o,{id:y,short_id:c}=F,u=ne(F,["id","short_id"]);u.name=u.name?u.name+" (copy)":"";const h=yield Object(A.a)(u);return l.reportRecordingPlaylistCreated("duplicate"),a(),h&&(p.lemonToast.success("Playlist duplicated successfully"),t.playlists.results=[h,...t.playlists.results]),t.playlists})}}}),Object(r.listeners)(n=>{let{actions:t}=n;return{setSavedPlaylistsFilters:()=>{t.loadPlaylists()}}}),Object(r.selectors)(n=>{let{actions:t}=n;return{sorting:[l=>[l.filters],l=>l.order?l.order.startsWith("-")?{columnKey:l.order.slice(1),order:-1}:{columnKey:l.order,order:1}:{columnKey:"last_modified_at",order:-1}],pagination:[l=>[l.filters,l.playlists],(l,i)=>({controlled:!0,pageSize:E,currentPage:l.page,entryCount:i.count,onBackward:i.previous?()=>t.setSavedPlaylistsFilters({page:l.page-1}):void 0,onForward:i.next?()=>t.setSavedPlaylistsFilters({page:l.page+1}):void 0})]}}),Object(R.actionToUrl)(n=>{let{values:t}=n;const l=()=>{if(R.router.values.location.pathname===x.a.sessionRecordings(f.Z.Playlists)){const i=t.filters,a=Object(P.qb)(R.router.values.searchParams);if(!Object(P.sb)(i,a))return[x.a.sessionRecordings(f.Z.Playlists),i,{},{replace:!1}]}};return{loadPlaylists:l,setSavedPlaylistsFilters:l}}),Object(R.urlToAction)(n=>{let{actions:t,values:l}=n;return{[x.a.sessionRecordings(f.Z.Playlists)]:(i,a)=>v(this,null,function*(){const o=l.filters,y=Object(P.qb)(a);Object(P.sb)(o,y)||t.setSavedPlaylistsFilters(y)})}}),Object(r.afterMount)(n=>{let{actions:t}=n;t.loadPlaylists()})]);var I=s("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M878.3 392.1L631.9 145.7c-6.5-6.5-15-9.7-23.5-9.7s-17 3.2-23.5 9.7L423.8 306.9c-12.2-1.4-24.5-2-36.8-2-73.2 0-146.4 24.1-206.5 72.3-15.4 12.3-16.6 35.4-2.7 49.4l181.7 181.7-215.4 215.2a15.8 15.8 0 00-4.6 9.8l-3.4 37.2c-.9 9.4 6.6 17.4 15.9 17.4.5 0 1 0 1.5-.1l37.2-3.4c3.7-.3 7.2-2 9.8-4.6l215.4-215.4 181.7 181.7c6.5 6.5 15 9.7 23.5 9.7 9.7 0 19.3-4.2 25.9-12.4 56.3-70.3 79.7-158.3 70.2-243.4l161.1-161.1c12.9-12.8 12.9-33.8 0-46.8z"}}]},name:"pushpin",theme:"filled"},oe=ie,G=s("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/components/AntdIcon.js"),H=function(t,l){return C.createElement(G.a,Object(I.a)(Object(I.a)({},t),{},{ref:l,icon:oe}))};H.displayName="PushpinFilled";var Y=C.forwardRef(H),re={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M878.3 392.1L631.9 145.7c-6.5-6.5-15-9.7-23.5-9.7s-17 3.2-23.5 9.7L423.8 306.9c-12.2-1.4-24.5-2-36.8-2-73.2 0-146.4 24.1-206.5 72.3a33.23 33.23 0 00-2.7 49.4l181.7 181.7-215.4 215.2a15.8 15.8 0 00-4.6 9.8l-3.4 37.2c-.9 9.4 6.6 17.4 15.9 17.4.5 0 1 0 1.5-.1l37.2-3.4c3.7-.3 7.2-2 9.8-4.6l215.4-215.4 181.7 181.7c6.5 6.5 15 9.7 23.5 9.7 9.7 0 19.3-4.2 25.9-12.4 56.3-70.3 79.7-158.3 70.2-243.4l161.1-161.1c12.9-12.8 12.9-33.8 0-46.8zM666.2 549.3l-24.5 24.5 3.8 34.4a259.92 259.92 0 01-30.4 153.9L262 408.8c12.9-7.1 26.3-13.1 40.3-17.9 27.2-9.4 55.7-14.1 84.7-14.1 9.6 0 19.3.5 28.9 1.6l34.4 3.8 24.5-24.5L608.5 224 800 415.5 666.2 549.3z"}}]},name:"pushpin",theme:"outlined"},ce=re,k=function(t,l){return C.createElement(G.a,Object(I.a)(Object(I.a)({},t),{},{ref:l,icon:ce}))};k.displayName="PushpinOutlined";var W=C.forwardRef(k),de=s("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/CalendarOutlined.js"),ue=s("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),me=s("./frontend/src/lib/components/DateFilter/DateFilter.tsx"),je=s("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),pe=s("./frontend/@posthog/apps-common/src/index.ts"),ye=s("./frontend/src/lib/components/LemonButton/index.ts"),B=s("./frontend/src/lib/components/icons.tsx"),e=s("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function ge(){return Object(e.jsx)("div",{className:"flex items-center justify-center",children:Object(e.jsxs)("div",{className:"max-w-lg mt-12 flex flex-col items-center",children:[Object(e.jsx)("h2",{className:"text-xl",children:"There are no playlists that match these filters"}),Object(e.jsx)("p",{className:"text-muted",children:"Once you create a playlist, it will show up here."}),Object(e.jsx)(ye.a,{type:"primary","data-attr":"add-session-playlist-button-empty-state",icon:Object(e.jsx)(B.IconPlus,{}),onClick:()=>Object(A.a)({},!0),children:"New playlist"})]})})}var be=s("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),fe=s("./frontend/src/lib/components/LemonButton/More.tsx");function w(n){let{tab:t}=n;const l=ae({tab:t}),{playlists:i,playlistsLoading:a,filters:o,sorting:y,pagination:c}=Object(r.useValues)(l),{setSavedPlaylistsFilters:u,updatePlaylist:h,duplicatePlaylist:F,deletePlaylist:Le}=Object(r.useActions)(l),{meFirstMembers:Ne}=Object(r.useValues)(je.a),Ce=[{width:0,dataIndex:"pinned",render:function(g,L){let{short_id:K}=L;return Object(e.jsx)(p.LemonButton,{size:"small",status:"primary-alt",onClick:()=>h(K,{pinned:!g}),children:g?Object(e.jsx)(Y,{}):Object(e.jsx)(W,{})})}},{title:"Name",dataIndex:"name",render:function(g,L){let{short_id:K,derived_name:Te,description:_}=L;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(p.Link,{className:Object(be.default)("font-semibold",!g&&"italic"),to:x.a.sessionRecordingPlaylist(K),children:g||Te||"(Untitled)"}),_?Object(e.jsx)("div",{className:"truncate",children:_}):null]})}},M(S({},Object(ue.b)()),{width:0}),{title:"Last modified",sorter:!0,dataIndex:"last_modified_at",width:0,render:function(g){return Object(e.jsx)("div",{children:g&&typeof g=="string"&&Object(e.jsx)(pe.TZLabel,{time:g})})}},{width:0,render:function(g,L){return Object(e.jsx)(fe.a,{overlay:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(p.LemonButton,{status:"stealth",onClick:()=>F(L),fullWidth:!0,"data-attr":"duplicate-playlist",loading:a,children:"Duplicate"}),Object(e.jsx)(p.LemonDivider,{}),Object(e.jsx)(p.LemonButton,{status:"danger",onClick:()=>Le(L),fullWidth:!0,loading:a,children:"Delete playlist"})]})})}}];return Object(e.jsxs)("div",{className:"space-y-4",children:[Object(e.jsxs)("div",{className:"flex justify-between gap-2 mb-2 items-center flex-wrap",children:[Object(e.jsx)(p.LemonInput,{type:"search",placeholder:"Search for playlists",onChange:j=>u({search:j||void 0}),value:o.search||""}),Object(e.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[Object(e.jsx)("div",{className:"flex items-center gap-2",children:Object(e.jsx)(p.LemonButton,{"data-attr":"session-recording-playlist-pinned-filter",active:o.pinned,size:"small",type:"secondary",status:"stealth",center:!0,onClick:()=>u({pinned:!o.pinned}),icon:Object(C.cloneElement)(o.pinned?Object(e.jsx)(Y,{}):Object(e.jsx)(W,{}),{className:"text-base flex items-center"}),children:"Pinned"})}),Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("span",{children:"Last modified:"}),Object(e.jsx)(me.a,{disabled:!1,dateFrom:o.dateFrom,dateTo:o.dateTo,onChange:(j,g)=>u({dateFrom:j,dateTo:g!=null?g:void 0}),makeLabel:j=>Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(de.a,{}),Object(e.jsxs)("span",{className:"hide-when-small",children:[" ",j]})]})})]}),Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("span",{children:"Created by:"}),Object(e.jsx)(p.LemonSelect,{size:"small",options:[{value:"All users",label:"All Users"},...Ne.map(j=>({value:j.user.id,label:j.user.first_name}))],value:o.createdBy,onChange:j=>{u({createdBy:j})},dropdownMatchSelectWidth:!1})]})]})]}),!a&&i.count<1?Object(e.jsx)(ge,{}):Object(e.jsx)(p.LemonTable,{loading:a,columns:Ce,dataSource:i.results,pagination:c,noSortingCancellation:!0,sorting:y,onSort:j=>u({order:j?`${j.order===-1?"-":""}${j.columnKey}`:void 0}),rowKey:"id",loadingSkeletonRows:E,nouns:["playlist","playlists"]})]})}try{w.displayName="SavedSessionRecordingPlaylists",w.__docgenInfo={description:"",displayName:"SavedSessionRecordingPlaylists",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"SessionRecordingsTabs.Playlists"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/session-recordings/saved-playlists/SavedSessionRecordingPlaylists.tsx#SavedSessionRecordingPlaylists"]={docgenInfo:w.__docgenInfo,name:"SavedSessionRecordingPlaylists",path:"frontend/src/scenes/session-recordings/saved-playlists/SavedSessionRecordingPlaylists.tsx#SavedSessionRecordingPlaylists"})}catch(n){}var z=s("./frontend/src/scenes/session-recordings/sessionRecordingsLogic.ts"),J=s("./frontend/src/lib/components/Spinner/Spinner.tsx"),X=s("./frontend/src/scenes/session-recordings/settings/SessionRecordingSettings.tsx"),he=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/lib/upload/Dragger.js"),Oe=s.n(he),xe=s("./frontend/src/scenes/session-recordings/player/SessionRecordingPlayer.tsx");const Q=Object(r.kea)([Object(r.path)(["scenes","session-recordings","detail","sessionRecordingDetailLogic"]),Object(r.connect)({actions:[U.e,["reportRecordingLoadedFromFile"]]}),Object(V.loaders)(n=>{let{actions:t}=n;return{sessionRecording:{__default:null,loadFromFile:l=>v(this,null,function*(){try{const i=yield new Promise((o,y)=>{const c=new FileReader;c.onload=u=>{var h;o((h=u.target)===null||h===void 0?void 0:h.result)},c.onerror=u=>{y(u)},c.readAsText(l)}),a=JSON.parse(i);if(!a.version||!a.data)throw new Error("File does not appear to be a valid session recording export");if(a.version==="2022-12-02")return t.reportRecordingLoadedFromFile({success:!0}),a.data;throw new Error("File version is not supported")}catch(i){return t.reportRecordingLoadedFromFile({success:!1,error:`${i}`}),p.lemonToast.error(`File import failed: ${i}`),null}}),resetSessionRecording:()=>null}}}),Object(r.reducers)({playerKey:["file-playback",{loadFromFileSuccess:()=>`file-playback-${Object(P.Lb)()}`,resetSessionRecording:()=>"file-playback"}]}),Object(R.beforeUnload)(n=>{let{values:t,actions:l}=n;return{enabled:()=>!!t.sessionRecording,message:"The loaded session recording will be lost. Are you sure you want to leave?",onConfirm:()=>{l.resetSessionRecording()}}}),Object(r.selectors)({breadcrumbs:[()=>[],()=>[{name:"Recordings",path:x.a.sessionRecordings()},{name:"Import"}]]})]);var ve=s("./frontend/src/scenes/userLogic.ts"),Pe=s("./frontend/src/lib/components/PayGatePage/PayGatePage.tsx");function Se(){const{loadFromFile:n,resetSessionRecording:t}=Object(r.useActions)(Q),{sessionRecording:l,sessionRecordingLoading:i,playerKey:a}=Object(r.useValues)(Q),{hasAvailableFeature:o}=Object(r.useValues)(ve.a);return o(f.e.RECORDINGS_FILE_EXPORT)?Object(e.jsx)("div",{children:i?Object(e.jsx)(J.b,{}):l?Object(e.jsxs)("div",{className:"space-y-2",children:[Object(e.jsx)(O.a,{type:"info",action:{onClick:()=>t(),children:"Load a different recording"},children:"You are viewing a recording loaded from a file."}),Object(e.jsx)(xe.a,{sessionRecordingId:"",sessionRecordingData:l,playerKey:a})]}):Object(e.jsx)(Oe.a,{name:"file",multiple:!1,accept:".json",showUploadList:!1,beforeUpload:c=>(n(c),!1),children:Object(e.jsxs)("div",{className:"p-20 flex flex-col items-center justify-center space-y-2 text-muted-alt",children:[Object(e.jsxs)("p",{className:"flex items-center gap-2 font-semibold",children:[Object(e.jsx)(B.IconUploadFile,{className:"text-xl"}),"Load recording"]}),Object(e.jsx)("p",{className:"text-muted-alt ",children:"Drag and drop your exported recording here or click to open the file browser."})]})})}):Object(e.jsx)(Pe.a,{featureKey:f.e.RECORDINGS_FILE_EXPORT,featureName:"Recording Exports",header:Object(e.jsxs)(e.Fragment,{children:["Export and playback ",Object(e.jsx)("span",{className:"highlight",children:"Recordings from file"}),"!"]}),caption:"Store your recordings outside of PostHog wherever you like.",docsLink:"https://posthog.com/docs/user-guides/session-recordings"})}var Re=s("./frontend/src/lib/hooks/useAsyncHandler.ts");function q(){const{currentTeam:n}=Object(r.useValues)(T.a),{tab:t}=Object(r.useValues)(z.c),l=n&&!(n!=null&&n.session_recording_opt_in),{reportRecordingPlaylistCreated:i}=Object(r.useActions)(U.e),a=Object(Re.a)(()=>v(this,null,function*(){yield Object(A.a)({},!0),i("new")}));return Object(e.jsxs)("div",{className:"-mb-12",children:[Object(e.jsx)(b.a,{title:Object(e.jsx)("div",{children:"Session Recordings"}),buttons:Object(e.jsxs)(e.Fragment,{children:[t===f.Z.Recent&&!l&&Object(e.jsx)(p.LemonButton,{type:"secondary",icon:Object(e.jsx)(B.IconSettings,{}),onClick:()=>Object(X.b)(),children:"Configure"}),t===f.Z.Playlists&&Object(e.jsx)(p.LemonButton,{type:"primary",onClick:a.onEvent,"data-attr":"save-recordings-playlist-button",loading:a.loading,children:"New playlist"})]})}),Object(e.jsx)(Z.a,{activeKey:t,animated:!1,style:{borderColor:"#D9D9D9"},onChange:o=>R.router.actions.push(x.a.sessionRecordings(o)),children:Object.values(f.Z).map(o=>Object(e.jsx)(Z.a.TabPane,{tab:Object(z.b)(o)},o))}),l?Object(e.jsx)("div",{className:"mb-4",children:Object(e.jsx)(O.a,{type:"info",action:{type:"secondary",icon:Object(e.jsx)(B.IconSettings,{}),onClick:()=>Object(X.b)(),children:"Configure"},children:"Session recordings are currently disabled for this project."})}):null,t?t===f.Z.Recent?Object(e.jsx)(N.a,{updateSearchParams:!0}):t===f.Z.Playlists?Object(e.jsx)(w,{tab:f.Z.Playlists}):t===f.Z.FilePlayback?Object(e.jsx)(Se,{}):null:Object(e.jsx)(J.a,{})]})}const Fe={component:q,logic:z.c}}}]);
