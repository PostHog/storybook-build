(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{"./frontend/src/scenes/feature-flags/FeatureFlag.tsx":function(ee,M,a){"use strict";a.r(M),a.d(M,"scene",function(){return pt}),a.d(M,"FeatureFlag",function(){return Ue});var te=a("./node_modules/core-js/modules/es.array.concat.js"),Ye=a("./node_modules/core-js/modules/es.array.map.js"),Pe=a("./node_modules/core-js/modules/es.function.name.js"),Xe=a("./node_modules/core-js/modules/es.object.to-string.js"),Se=a("./node_modules/core-js/modules/es.regexp.to-string.js"),Ie=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),ae=a.n(Ie),Me=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),X=a.n(Me),A=a("./node_modules/react/index.js"),t=a.n(A),y=a("./node_modules/antd/es/form/index.js"),ce=a("./node_modules/antd/es/switch/index.js"),I=a("./node_modules/antd/es/button/index.js"),W=a("./node_modules/antd/es/row/index.js"),C=a("./node_modules/antd/es/col/index.js"),G=a("./node_modules/antd/es/input/index.js"),Q=a("./node_modules/antd/es/collapse/index.js"),de=a("./node_modules/antd/es/popconfirm/index.js"),ne=a("./node_modules/antd/es/radio/index.js"),me=a("./node_modules/antd/es/slider/index.js"),K=a("./node_modules/antd/es/input-number/index.js"),Z=a("./node_modules/antd/es/select/index.js"),fe=a("./node_modules/antd/es/card/index.js"),L=a("./node_modules/kea/lib/index.esm.js"),D=a("./frontend/src/lib/utils.tsx"),ge=a("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),w=a("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),re=a("./node_modules/@ant-design/icons/es/icons/SaveOutlined.js"),$=a("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917.7 148.8l-42.4-42.4c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-76.1 76.1a199.27 199.27 0 00-112.1-34.3c-51.2 0-102.4 19.5-141.5 58.6L432.3 308.7a8.03 8.03 0 000 11.3L704 591.7c1.6 1.6 3.6 2.3 5.7 2.3 2 0 4.1-.8 5.7-2.3l101.9-101.9c68.9-69 77-175.7 24.3-253.5l76.1-76.1c3.1-3.2 3.1-8.3 0-11.4zM578.9 546.7a8.03 8.03 0 00-11.3 0L501 613.3 410.7 523l66.7-66.7c3.1-3.1 3.1-8.2 0-11.3L441 408.6a8.03 8.03 0 00-11.3 0L363 475.3l-43-43a7.85 7.85 0 00-5.7-2.3c-2 0-4.1.8-5.7 2.3L206.8 534.2c-68.9 68.9-77 175.7-24.3 253.5l-76.1 76.1a8.03 8.03 0 000 11.3l42.4 42.4c1.6 1.6 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3l76.1-76.1c33.7 22.9 72.9 34.3 112.1 34.3 51.2 0 102.4-19.5 141.5-58.6l101.9-101.9c3.1-3.1 3.1-8.2 0-11.3l-43-43 66.7-66.7c3.1-3.1 3.1-8.2 0-11.3l-36.6-36.2z"}}]},name:"api",theme:"filled"},ve=pe,v=a("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),f=function(e,l){return A.createElement(v.a,Object($.a)(Object($.a)({},e),{},{ref:l,icon:ve}))};f.displayName="ApiFilled";var E=A.forwardRef(f),h=a("./node_modules/@ant-design/icons/es/icons/LockOutlined.js"),b={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"merge-cells",theme:"outlined"},V=b,R=function(e,l){return A.createElement(v.a,Object($.a)(Object($.a)({},e),{},{ref:l,icon:V}))};R.displayName="MergeCellsOutlined";var k=A.forwardRef(R),T=a("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),q=a("./node_modules/@ant-design/icons/es/icons/CopyOutlined.js"),Qe=a("./node_modules/core-js/modules/es.array.every.js"),B=a("./node_modules/core-js/modules/es.array.filter.js"),ye=a("./node_modules/core-js/modules/es.array.find.js"),Vt=a("./node_modules/core-js/modules/es.array.for-each.js"),Rt=a("./node_modules/core-js/modules/es.array.iterator.js"),Nt=a("./node_modules/core-js/modules/es.array.reduce.js"),Kt=a("./node_modules/core-js/modules/es.array.splice.js"),Bt=a("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ut=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Ze=a("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),ke=a.n(Ze),qe=a("./node_modules/@babel/runtime/regenerator/index.js"),N=a.n(qe),Wt=a("./node_modules/regenerator-runtime/runtime.js"),et=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),le=a.n(et),tt=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),x=a.n(tt),Ee=a("./frontend/src/lib/api.ts"),at=a("./node_modules/kea-router/lib/index.js"),Ae=a("./frontend/src/scenes/urls.ts"),xe=a("./frontend/src/scenes/teamLogic.ts"),he=a("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),_e=a("./frontend/src/models/groupsModel.ts"),Le=a("./frontend/src/lib/components/TaxonomicFilter/types.ts"),nt=a("./frontend/src/lib/components/lemonToast.tsx");function De(n,e){var l=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),l.push.apply(l,r)}return l}function o(n){for(var e=1;e<arguments.length;e++){var l=arguments[e]!=null?arguments[e]:{};e%2?De(Object(l),!0).forEach(function(r){ae()(n,r,l[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(l)):De(Object(l)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(l,r))})}return n}var Ve={id:null,created_at:null,key:"",name:"",filters:{groups:[{properties:[],rollout_percentage:null}],multivariate:null},deleted:!1,active:!0,created_by:null,is_simple_flag:!1,rollout_percentage:null},rt={key:"",name:"",rollout_percentage:0},lt={variants:[{key:"",name:"",rollout_percentage:100}]},Fe=Object(L.kea)({path:["scenes","feature-flags","featureFlagLogic"],connect:{values:[xe.a,["currentTeamId"],_e.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]]},actions:{setFeatureFlagId:function(e){return{id:e}},setFeatureFlag:function(e){return{featureFlag:e}},addConditionSet:!0,setAggregationGroupTypeIndex:function(e){return{value:e}},removeConditionSet:function(e){return{index:e}},duplicateConditionSet:function(e){return{index:e}},updateConditionSet:function(e,l,r){return{index:e,newRolloutPercentage:l,newProperties:r}},deleteFeatureFlag:function(e){return{featureFlag:e}},setMultivariateEnabled:function(e){return{enabled:e}},setMultivariateOptions:function(e){return{multivariateOptions:e}},addVariant:!0,updateVariant:function(e,l){return{index:e,newProperties:l}},removeVariant:function(e){return{index:e}},distributeVariantsEqually:!0},reducers:{featureFlagId:[null,{setFeatureFlagId:function(e,l){var r=l.id;return r}}],featureFlag:[null,{setFeatureFlag:function(e,l){var r=l.featureFlag;if(r.filters.groups){var s=r.filters.groups.map(function(c){return c.properties?o(o({},c),{},{properties:Object(D.s)(c.properties)}):c});return o(o({},r),{},{filters:o(o({},r==null?void 0:r.filters),{},{groups:s})})}return r},addConditionSet:function(e){if(!e)return e;var l=[].concat(x()(e==null?void 0:e.filters.groups),[{properties:[],rollout_percentage:null}]);return o(o({},e),{},{filters:o(o({},e.filters),{},{groups:l})})},updateConditionSet:function(e,l){var r=l.index,s=l.newRolloutPercentage,c=l.newProperties;if(!e)return e;var u=x()(e==null?void 0:e.filters.groups);return s!==void 0&&(u[r]=o(o({},u[r]),{},{rollout_percentage:s})),c!==void 0&&(u[r]=o(o({},u[r]),{},{properties:c})),o(o({},e),{},{filters:o(o({},e.filters),{},{groups:u})})},removeConditionSet:function(e,l){var r=l.index;if(!e)return e;var s=x()(e.filters.groups);return s.splice(r,1),o(o({},e),{},{filters:o(o({},e.filters),{},{groups:s})})},duplicateConditionSet:function(e,l){var r=l.index;if(!e)return e;var s=e.filters.groups.concat([e.filters.groups[r]]);return o(o({},e),{},{filters:o(o({},e.filters),{},{groups:s})})},setMultivariateOptions:function(e,l){var r=l.multivariateOptions;return e&&o(o({},e),{},{filters:o(o({},e.filters),{},{multivariate:r})})},addVariant:function(e){var l;if(!e)return e;var r=x()(((l=e.filters.multivariate)===null||l===void 0?void 0:l.variants)||[]);return o(o({},e),{},{filters:o(o({},e.filters),{},{multivariate:o(o({},e.filters.multivariate||{}),{},{variants:[].concat(x()(r),[rt])})})})},updateVariant:function(e,l){var r,s=l.index,c=l.newProperties;if(!e)return e;var u=x()(((r=e.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]);return u[s]?(u[s]=o(o({},u[s]),c),o(o({},e),{},{filters:o(o({},e.filters),{},{multivariate:o(o({},e.filters.multivariate),{},{variants:u})})})):e},removeVariant:function(e,l){var r,s=l.index;if(!e)return e;var c=x()(((r=e.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]);return c.splice(s,1),o(o({},e),{},{filters:o(o({},e.filters),{},{multivariate:o(o({},e.filters.multivariate),{},{variants:c})})})},distributeVariantsEqually:function(e){var l;if(!e)return e;var r=x()(((l=e.filters.multivariate)===null||l===void 0?void 0:l.variants)||[]),s=r.length;if(s>0&&s<=100){var c=Math.round(100/s),u=c*s,m=u-100;r.forEach(function(p,F){r[F]=o(o({},p),{},{rollout_percentage:c})}),r[s-1]=o(o({},r[s-1]),{},{rollout_percentage:c-m})}return o(o({},e),{},{filters:o(o({},e.filters),{},{multivariate:o(o({},e.filters.multivariate),{},{variants:r})})})},setAggregationGroupTypeIndex:function(e,l){var r=l.value;return!e||e.filters.aggregation_group_type_index==r?e:o(o({},e),{},{filters:o(o({},e.filters),{},{aggregation_group_type_index:r,groups:[{properties:[],rollout_percentage:null}]})})}}]},loaders:function(e){var l=e.values;return{featureFlag:{loadFeatureFlag:function(){var r=le()(N.a.mark(function c(){return N.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(l.featureFlagId&&l.featureFlagId!=="new")){m.next=4;break}return m.next=3,Ee.a.get("api/projects/".concat(l.currentTeamId,"/feature_flags/").concat(l.featureFlagId));case 3:return m.abrupt("return",m.sent);case 4:return m.abrupt("return",Ve);case 5:case"end":return m.stop()}},c)}));function s(){return r.apply(this,arguments)}return s}(),saveFeatureFlag:function(){var r=le()(N.a.mark(function c(u){var m,p,F;return N.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(m=u.created_at,p=u.id,F=ke()(u,["created_at","id"]),u.id){j.next=7;break}return j.next=4,Ee.a.create("api/projects/".concat(l.currentTeamId,"/feature_flags"),F);case 4:return j.abrupt("return",j.sent);case 7:return j.next=9,Ee.a.update("api/projects/".concat(l.currentTeamId,"/feature_flags/").concat(u.id),F);case 9:return j.abrupt("return",j.sent);case 10:case"end":return j.stop()}},c)}));function s(c){return r.apply(this,arguments)}return s}()}}},listeners:function(e){var l=e.actions,r=e.values;return{saveFeatureFlagSuccess:function(c){var u,m=c.featureFlag;nt.a.success("Feature flag saved"),(u=he.a.findMounted())===null||u===void 0||u.actions.updateFlag(m)},deleteFeatureFlag:function(){var s=le()(N.a.mark(function u(m){var p;return N.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:p=m.featureFlag,Object(D.x)({endpoint:"projects/".concat(r.currentTeamId,"/feature_flags"),object:{name:p.name,id:p.id},callback:function(){var _;p.id&&((_=he.a.findMounted())===null||_===void 0||_.actions.deleteFlag(p.id)),at.router.actions.push(Ae.a.featureFlags())}});case 2:case"end":return P.stop()}},u)}));function c(u){return s.apply(this,arguments)}return c}(),setMultivariateEnabled:function(){var s=le()(N.a.mark(function u(m){var p;return N.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:p=m.enabled,p?l.setMultivariateOptions(lt):l.setMultivariateOptions(null);case 2:case"end":return P.stop()}},u)}));function c(u){return s.apply(this,arguments)}return c}()}},selectors:{multivariateEnabled:[function(n){return[n.featureFlag]},function(n){return!!(n!=null&&n.filters.multivariate)}],variants:[function(n){return[n.featureFlag]},function(n){var e;return(n==null||(e=n.filters.multivariate)===null||e===void 0?void 0:e.variants)||[]}],nonEmptyVariants:[function(n){return[n.variants]},function(n){return n.filter(function(e){var l=e.key;return!!l})}],variantRolloutSum:[function(n){return[n.variants]},function(n){return n.reduce(function(e,l){var r=l.rollout_percentage;return e+r},0)}],areVariantRolloutsValid:[function(n){return[n.variants,n.variantRolloutSum]},function(n,e){return n.every(function(l){var r=l.rollout_percentage;return r>=0&&r<=100})&&e===100}],aggregationTargetName:[function(n){return[n.featureFlag,n.groupTypes,n.aggregationLabel]},function(n,e,l){return n&&n.filters.aggregation_group_type_index!=null&&e.length>0?l(n.filters.aggregation_group_type_index).plural:"users"}],taxonomicGroupTypes:[function(n){return[n.featureFlag,n.groupsTaxonomicTypes]},function(n,e){return n&&n.filters.aggregation_group_type_index!=null&&e.length>0?[e[n.filters.aggregation_group_type_index]]:[Le.a.PersonProperties,Le.a.Cohorts]}],breadcrumbs:[function(n){return[n.featureFlag]},function(n){return[{name:"Feature Flags",path:Ae.a.featureFlags()}].concat(x()(n?[{name:n.key||"Unnamed"}]:[]))}]},actionToUrl:function(){return{saveFeatureFlagSuccess:function(l){var r=l.featureFlag;return["/feature_flags/".concat(r.id||"new"),{},{},{replace:!0}]}}},urlToAction:function(e){var l=e.actions,r=e.values;return{"/feature_flags/*":function(c){var u=c._;if(u&&u!==r.featureFlagId){var m,p=u==="new"?"new":parseInt(u);l.setFeatureFlagId(p);var F=(m=he.a.findMounted())===null||m===void 0?void 0:m.values.featureFlags.find(function(P){return P.id===p});F?l.setFeatureFlag(F):l.setFeatureFlag(Ve),u!=="new"&&l.loadFeatureFlag()}}}}}),ot=a("./frontend/src/lib/components/PageHeader.tsx"),st=a("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),it=a.n(st),ut=a("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss"),Re=a.n(ut),je={};je.insert="head",je.singleton=!1;var Gt=it()(Re.a,je),wt=Re.a.locals||{},z=a("./frontend/src/lib/components/icons.tsx"),oe=a("./frontend/src/lib/components/Tooltip.tsx"),H=a("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),se="?utm_medium=in-product&utm_campaign=feature-flag";function ie(n){var e=n.flagKey;return t.a.createElement(t.a.Fragment,null,"(",t.a.createElement(H.a,{language:H.b.JavaScript,wrap:!0},"if\xA0(posthog.isFeatureEnabled('".concat(e!=null?e:"",`')) {
    // run your activation code here
}`)),")",t.a.createElement("div",{className:"mt"},"Need more information?"," ",t.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/js-integration".concat(se,"#feature-flags")},"Check the docs ",t.a.createElement(z.IconOpenInNew,null))),")")}function ue(n){var e=n.flagKey;return t.a.createElement(t.a.Fragment,null,t.a.createElement(H.a,{language:H.b.Python,wrap:!0},'if\xA0posthog.feature_enabled("'.concat(e,`", "user_distinct_id"):
    runAwesomeFeature()
`)),t.a.createElement("div",{className:"mt"},"Need more information?"," ",t.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/python-integration".concat(se,"#feature-flags")},"Check the docs ",t.a.createElement(z.IconOpenInNew,null))))}function ct(){var n=Object(L.useValues)(xe.a),e=n.currentTeam;return t.a.createElement(t.a.Fragment,null,t.a.createElement(H.a,{language:H.b.Bash,wrap:!0},"curl ".concat(window.location.origin,`/decide/ \\
-X POST -H 'Content-Type: application/json' \\
-d '{
    "api_key": "`).concat(e?e.api_token:"[project_api_key]",`",
    "distinct_id": "[user distinct id]"
}'
                `)),t.a.createElement("div",{className:"mt"},"Need more information?"," ",t.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/api/feature-flags".concat(se)},"Check the docs ",t.a.createElement(z.IconOpenInNew,null))))}try{ie.displayName="JSSnippet",ie.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:ie.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(n){}try{ue.displayName="PythonSnippet",ue.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:ue.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(n){}var Ne=a("./frontend/src/lib/components/LemonRow/index.ts"),dt=a("./frontend/src/lib/introductions/GroupsIntroductionOption.tsx"),mt=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),ft=a("./frontend/src/scenes/userLogic.ts"),Oe=a("./frontend/src/types.ts"),gt=a("./frontend/src/lib/components/Link.tsx");function Ke(n,e){var l=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),l.push.apply(l,r)}return l}function J(n){for(var e=1;e<arguments.length;e++){var l=arguments[e]!=null?arguments[e]:{};e%2?Ke(Object(l),!0).forEach(function(r){ae()(n,r,l[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(l)):Ke(Object(l)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(l,r))})}return n}var pt={component:Ue,logic:Fe};function Be(n){setTimeout(function(){var e;return(e=document.querySelector('.variant-form-list input[data-key-index="'.concat(n,'"]')))===null||e===void 0?void 0:e.focus()},50)}function Ue(){var n=y.a.useForm(),e=X()(n,1),l=e[0],r=Object(L.useValues)(Fe),s=r.featureFlag,c=r.featureFlagId,u=r.multivariateEnabled,m=r.variants,p=r.nonEmptyVariants,F=r.areVariantRolloutsValid,P=r.variantRolloutSum,j=r.groupTypes,_=r.aggregationTargetName,vt=r.taxonomicGroupTypes,O=Object(L.useActions)(Fe),yt=O.addConditionSet,We=O.updateConditionSet,Et=O.removeConditionSet,ht=O.duplicateConditionSet,Ft=O.saveFeatureFlag,jt=O.deleteFeatureFlag,Ge=O.setMultivariateEnabled,Ot=O.addVariant,Ce=O.updateVariant,Ct=O.removeVariant,bt=O.distributeVariantsEqually,Tt=O.setFeatureFlag,Pt=O.setAggregationGroupTypeIndex,we=Object(L.useValues)(_e.a),St=we.showGroupsOptions,It=we.aggregationLabel,$e=Object(L.useValues)(ft.a),be=$e.hasAvailableFeature,Mt=$e.upgradeLink,At=Object(A.useState)(!1),ze=X()(At,2),He=ze[0],xt=ze[1],_t=Object(A.useState)(!1),Je=X()(_t,2),Lt=Je[0],Te=Je[1];Object(A.useEffect)(function(){l.setFieldsValue(J({},s))},[s]);var Dt=Object(dt.a)({value:-2});return t.a.createElement("div",{className:"feature-flag"},s?t.a.createElement(y.a,{layout:"vertical",form:l,initialValues:{name:s.name,key:s.key,active:s.active},onValuesChange:function(i){c!=="new"&&i.key&&xt(i.key!==s.key),Tt(J(J({},s),i))},onFinish:function(i){return Ft(J(J(J({},s),i),{},{filters:s.filters}))},requiredMark:!1,scrollToFirstError:!0},t.a.createElement(ot.a,{title:"Feature Flag",buttons:t.a.createElement("div",{style:{display:"flex"}},t.a.createElement(y.a.Item,{className:"enabled-switch"},t.a.createElement(y.a.Item,{shouldUpdate:function(i,g){return i.active!==g.active},style:{marginBottom:0,marginRight:6}},function(d){var i=d.getFieldValue;return t.a.createElement("span",{className:"ant-form-item-label",style:{lineHeight:"1.5rem"}},i("active")?t.a.createElement("span",{className:"text-success"},"Enabled"):t.a.createElement("span",{className:"text-danger"},"Disabled"))}),t.a.createElement(y.a.Item,{name:"active",noStyle:!0,valuePropName:"checked"},t.a.createElement(ce.a,null))),c!=="new"&&t.a.createElement(I.a,{"data-attr":"delete-flag",danger:!0,icon:t.a.createElement(w.a,null),onClick:function(){jt(s)},style:{marginRight:16}},"Delete"),t.a.createElement(I.a,{icon:t.a.createElement(re.a,null),type:"primary","data-attr":"feature-flag-submit",htmlType:"submit"},"Save changes"))}),t.a.createElement("h3",{className:"l3"},"General configuration"),t.a.createElement("div",{className:"text-muted mb"},"General settings for your feature flag and integration instructions."),t.a.createElement(W.a,{gutter:16,style:{marginBottom:32}},t.a.createElement(C.a,{span:12},t.a.createElement(y.a.Item,{name:"key",label:"Key (must be unique)",rules:[{required:!0,message:"You need to set a key."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}],validateStatus:He?"warning":void 0,help:He?t.a.createElement("small",null,t.a.createElement("b",null,"Warning! "),"Changing this key will",t.a.createElement("a",{href:"https://posthog.com/docs/features/feature-flags".concat(se,"#feature-flag-persistence"),target:"_blank",rel:"noopener"}," ","affect the persistence of your flag ",t.a.createElement(z.IconOpenInNew,null))):void 0},t.a.createElement(G.a,{"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),t.a.createElement(y.a.Item,{name:"name",label:"Description"},t.a.createElement(G.a.TextArea,{className:"ph-ignore-input","data-attr":"feature-flag-description",placeholder:"Adding a helpful description can ensure others know what this feature is for."}))),t.a.createElement(C.a,{span:12,style:{paddingTop:31}},t.a.createElement(Q.a,null,t.a.createElement(Q.a.Panel,{header:t.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},t.a.createElement(z.IconJavascript,{style:{marginRight:6}})," Javascript integration instructions"),key:"js"},t.a.createElement(y.a.Item,{shouldUpdate:function(i,g){return i.key!==g.key}},function(d){var i=d.getFieldValue;return t.a.createElement(ie,{flagKey:i("key")})})),t.a.createElement(Q.a.Panel,{header:t.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},t.a.createElement(z.IconPython,{style:{marginRight:6}})," Python integration instructions"),key:"python"},t.a.createElement(y.a.Item,{shouldUpdate:function(i,g){return i.key!==g.key}},function(d){var i=d.getFieldValue;return t.a.createElement(ue,{flagKey:i("key")})})),t.a.createElement(Q.a.Panel,{header:t.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},t.a.createElement(E,{style:{marginRight:6}})," API integration instructions"),key:"api"},t.a.createElement(y.a.Item,{shouldUpdate:function(i,g){return i.key!==g.key}},t.a.createElement(ct,null)))))),t.a.createElement("div",{className:"mb-2"},t.a.createElement("h3",{className:"l3"},"Served value"),t.a.createElement("div",{className:"mb-05"},t.a.createElement(de.a,{placement:"top",title:"Change value type? The variants below will be lost.",visible:Lt,onConfirm:function(){Ge(!1),Te(!1)},onCancel:function(){return Te(!1)},okText:"OK",cancelText:"Cancel"},t.a.createElement(ne.a.Group,{options:[{label:"Boolean value (A/B test)",value:!1},{label:t.a.createElement(oe.a,{title:be(Oe.c.MULTIVARIATE_FLAGS)?"":"This feature is not available on your current plan."},t.a.createElement("div",null,!be(Oe.c.MULTIVARIATE_FLAGS)&&t.a.createElement(gt.a,{to:Mt,target:"_blank"},t.a.createElement(h.a,{style:{marginRight:4,color:"var(--warning)"}})),"String value (Multivariate test)"," ",t.a.createElement(mt.a,{type:"warning"},"Beta"))),value:!0,disabled:!be(Oe.c.MULTIVARIATE_FLAGS)}],onChange:function(i){var g=i.target.value;g===!1&&p.length?Te(!0):(Ge(g),Be(0))},value:u,optionType:"button"}))),t.a.createElement("div",{className:"text-muted mb"},Object(D.j)(_)," will be served"," ",u?t.a.createElement(t.a.Fragment,null,t.a.createElement("strong",null,"a variant key")," according to the below distribution"):t.a.createElement("strong",null,t.a.createElement("code",null,"true"))," ","if they match one or more release condition groups."),u&&t.a.createElement("div",{className:"variant-form-list"},t.a.createElement(W.a,{gutter:8,className:"label-row"},t.a.createElement(C.a,{span:7},"Variant key"),t.a.createElement(C.a,{span:7},"Description"),t.a.createElement(C.a,{span:9},t.a.createElement("span",null,"Rollout percentage"),t.a.createElement(I.a,{type:"link",onClick:bt,icon:t.a.createElement(k,null),style:{padding:"0 0 0 0.5em"},title:"Distribute variants equally"},"Distribute"))),m.map(function(d,i){var g=d.rollout_percentage;return t.a.createElement(y.a,{key:i,onValuesChange:function(S){return Ce(i,S)},initialValues:m[i],validateTrigger:["onChange","onBlur"]},t.a.createElement(W.a,{gutter:8},t.a.createElement(C.a,{span:7},t.a.createElement(y.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}]},t.a.createElement(G.a,{"data-attr":"feature-flag-variant-key","data-key-index":i.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(i+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}))),t.a.createElement(C.a,{span:7},t.a.createElement(y.a.Item,{name:"name"},t.a.createElement(G.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"}))),t.a.createElement(C.a,{span:7},t.a.createElement(me.a,{tooltipPlacement:"top",value:g,onChange:function(S){return Ce(i,{rollout_percentage:S})}})),t.a.createElement(C.a,{span:2},t.a.createElement(K.a,{min:0,max:100,value:g,onChange:function(S){if(S!=null){var Y=parseInt(S.toString());isNaN(Y)||Ce(i,{rollout_percentage:Y})}},style:{width:"100%",borderColor:F?void 0:"var(--danger)"}})),m.length>1&&t.a.createElement(C.a,{span:1},t.a.createElement(oe.a,{title:"Delete this variant",placement:"bottomLeft"},t.a.createElement(I.a,{type:"link",icon:t.a.createElement(w.a,null),onClick:function(){return Ct(i)},style:{color:"var(--danger)"}})))))}),m.length>0&&!F&&t.a.createElement("p",{className:"text-danger"},"Percentage rollouts for variants must sum to 100 (currently ",P,")."),t.a.createElement(I.a,{type:"dashed",block:!0,icon:t.a.createElement(T.a,null),onClick:function(){var i=m.length;Ot(),Be(i)},style:{marginBottom:16}},"Add Variant"))),t.a.createElement("div",{className:"feature-flag-form-row"},t.a.createElement("div",null,t.a.createElement("h3",{className:"l3"},"Release conditions"),t.a.createElement("div",{className:"text-muted mb"},"Specify the ",_," to which you want to release this flag. Note that condition sets are rolled out independently of each other.")),St&&t.a.createElement("div",{className:"centered"},"Match by",t.a.createElement(Z.a,{value:s.filters.aggregation_group_type_index!=null?s.filters.aggregation_group_type_index:-1,onChange:function(i){var g=i!==-1?i:null;Pt(g)},style:{marginLeft:8},"data-attr":"feature-flag-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]}},t.a.createElement(Z.a.Option,{key:-1,value:-1},"Users"),j.map(function(d){return t.a.createElement(Z.a.Option,{key:d.group_type_index,value:d.group_type_index},Object(D.j)(It(d.group_type_index).plural))}),Dt))),t.a.createElement(W.a,{gutter:16},s.filters.groups.map(function(d,i){var g,U;return t.a.createElement(C.a,{span:24,md:24,key:"".concat(i,"-").concat(s.filters.groups.length)},i>0&&t.a.createElement("div",{style:{display:"flex",marginLeft:16}},t.a.createElement("div",{className:"stateful-badge or-light-grey mb"},"OR")),t.a.createElement(fe.a,{style:{marginBottom:16}},t.a.createElement("div",{className:"feature-flag-form-row",style:{height:24}},t.a.createElement("div",null,t.a.createElement("span",{className:"simple-tag tag-light-blue",style:{marginRight:8}},"Set ",i+1),!((g=d.properties)===null||g===void 0)&&g.length?t.a.createElement(t.a.Fragment,null,"Matching ",t.a.createElement("b",null,_)," with filters"):t.a.createElement(t.a.Fragment,null,"Condition set will match ",t.a.createElement("b",null,"all ",_))),t.a.createElement("div",null,t.a.createElement(oe.a,{title:"Duplicate this condition set",placement:"bottomLeft"},t.a.createElement(I.a,{type:"link",icon:t.a.createElement(q.a,null),style:{width:24,height:24},onClick:function(){return ht(i)}})),s.filters.groups.length>1&&t.a.createElement(oe.a,{title:"Delete this condition set",placement:"bottomLeft"},t.a.createElement(I.a,{type:"link",icon:t.a.createElement(w.a,null),style:{width:24,height:24},onClick:function(){return Et(i)}})))),t.a.createElement(Ne.b,{large:!0}),t.a.createElement(ge.a,{style:{marginLeft:15},pageKey:"feature-flag-".concat(s.id,"-").concat(i,"-").concat(s.filters.groups.length,"-").concat((U=s.filters.aggregation_group_type_index)!==null&&U!==void 0?U:""),propertyFilters:d==null?void 0:d.properties,onChange:function(Y){return We(i,void 0,Y)},taxonomicGroupTypes:vt,showConditionBadge:!0}),t.a.createElement(Ne.b,{large:!0}),t.a.createElement("div",{className:"feature-flag-form-row"},t.a.createElement("div",{className:"centered"},"Roll out to"," ",t.a.createElement(K.a,{style:{width:100,marginLeft:8,marginRight:8},onChange:function(Y){We(i,Y)},value:d.rollout_percentage!=null?d.rollout_percentage:100,min:0,max:100,addonAfter:"%"})," ","of ",t.a.createElement("b",null,_)," in this set"))))})),t.a.createElement(fe.a,{size:"small",style:{marginBottom:16}},t.a.createElement(I.a,{type:"link",onClick:yt,style:{marginLeft:5}},t.a.createElement(T.a,{style:{marginRight:15}})," Add condition set")),t.a.createElement(y.a.Item,{className:"text-right"},t.a.createElement(I.a,{icon:t.a.createElement(re.a,null),htmlType:"submit",type:"primary","data-attr":"feature-flag-submit-bottom"},"Save changes"))):t.a.createElement(D.c,null))}},"./frontend/src/scenes/feature-flags/featureFlagsLogic.ts":function(ee,M,a){"use strict";a.d(M,"a",function(){return ve});var te=a("./node_modules/core-js/modules/es.array.concat.js"),Ye=a.n(te),Pe=a("./node_modules/core-js/modules/es.array.filter.js"),Xe=a.n(Pe),Se=a("./node_modules/core-js/modules/es.array.find.js"),Ie=a.n(Se),ae=a("./node_modules/core-js/modules/es.array.iterator.js"),Me=a.n(ae),X=a("./node_modules/core-js/modules/es.array.map.js"),A=a.n(X),t=a("./node_modules/core-js/modules/es.object.to-string.js"),y=a.n(t),ce=a("./node_modules/core-js/modules/es.regexp.exec.js"),I=a.n(ce),W=a("./node_modules/core-js/modules/es.string.search.js"),C=a.n(W),G=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Q=a.n(G),de=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ne=a.n(de),me=a("./node_modules/@babel/runtime/regenerator/index.js"),K=a.n(me),Z=a("./node_modules/regenerator-runtime/runtime.js"),fe=a.n(Z),L=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),D=a.n(L),ge=a("./node_modules/kea/lib/index.esm.js"),w=a("./frontend/src/lib/api.ts"),re=a("./node_modules/fuse.js/dist/fuse.esm.js"),$=a("./frontend/src/scenes/teamLogic.ts"),pe=a("./frontend/src/scenes/urls.ts"),ve=Object(ge.kea)({path:["scenes","feature-flags","featureFlagsLogic"],connect:{values:[$.a,["currentTeamId"]]},actions:{updateFlag:function(f){return{flag:f}},deleteFlag:function(f){return{id:f}},setSearchTerm:function(f){return{searchTerm:f}}},loaders:function(f){var E=f.values;return{featureFlags:{__default:[],loadFeatureFlags:function(){var h=D()(K.a.mark(function V(){var R;return K.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,w.a.get("api/projects/".concat(E.currentTeamId,"/feature_flags/"));case 2:return R=T.sent,T.abrupt("return",R.results);case 4:case"end":return T.stop()}},V)}));function b(){return h.apply(this,arguments)}return b}(),updateFeatureFlag:function(){var h=D()(K.a.mark(function V(R){var k,T,q;return K.a.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return k=R.id,T=R.payload,B.next=3,w.a.update("api/projects/".concat(E.currentTeamId,"/feature_flags/").concat(k),T);case 3:return q=B.sent,B.abrupt("return",ne()(E.featureFlags).map(function(ye){return ye.id===q.id?q:ye}));case 5:case"end":return B.stop()}},V)}));function b(V){return h.apply(this,arguments)}return b}()}}},selectors:{searchedFeatureFlags:[function(v){return[v.featureFlags,v.searchTerm]},function(v,f){return f?new re.a(v,{keys:["key","name"],threshold:.3}).search(f).map(function(E){return E.item}):v}],breadcrumbs:[function(){return[]},function(){return[{name:"Feature Flags",path:pe.a.featureFlags()}]}]},reducers:{searchTerm:{setSearchTerm:function(f,E){var h=E.searchTerm;return h}},featureFlags:{updateFlag:function(f,E){var h=E.flag;return f.find(function(b){var V=b.id;return V===h.id})?f.map(function(b){return b.id===h.id?h:b}):[h].concat(ne()(f))},deleteFlag:function(f,E){var h=E.id;return f.filter(function(b){return b.id!==h})}}},events:function(f){var E=f.actions;return{afterMount:function(){E.loadFeatureFlags()}}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss":function(ee,M,a){var te=a("./node_modules/css-loader/dist/runtime/api.js");M=te(!1),M.push([ee.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.feature-flag .enabled-switch{margin-right:1rem!important}.feature-flag .enabled-switch .ant-form-item-control-input-content{flex-direction:row;align-items:center;display:flex}.feature-flag .enabled-switch .ant-form-item-label{padding:0 4px 0 0}.variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{margin-bottom:4px;font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}.feature-flag-form-row{display:flex;justify-content:space-between;align-items:center;width:100%}.feature-flag-form-row .centered{display:flex;align-items:center;white-space:pre-wrap}",""]),ee.exports=M}}]);
