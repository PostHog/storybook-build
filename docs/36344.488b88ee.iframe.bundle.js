(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[36344],{"../../frontend/src/scenes/billing/BillingSection.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BillingSection:()=>BillingSection,scene:()=>scene}),__webpack_require__("../../frontend/src/scenes/billing/Billing.scss");var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),billing_Billing=__webpack_require__("../../frontend/src/scenes/billing/Billing.tsx"),billingLogic=__webpack_require__("../../frontend/src/scenes/billing/billingLogic.tsx"),injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),BillingUsage=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.4_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/billing/BillingUsage.scss"),BillingUsage_default=__webpack_require__.n(BillingUsage),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(BillingUsage_default(),options),BillingUsage_default().locals;var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.22.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),RestrictedArea=__webpack_require__("../../frontend/src/lib/components/RestrictedArea.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonInputSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInputSelect/LemonInputSelect.tsx"),LemonLabel=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),billing_utils=__webpack_require__("../../frontend/src/scenes/billing/billing-utils.ts"),colors=__webpack_require__("../../frontend/src/lib/colors.ts"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");__webpack_require__("../../node_modules/.pnpm/chartjs-adapter-dayjs-3@1.2.3_chart.js@4.4.3_dayjs@1.11.11_patch_hash=lbfir4woetqmvzqg7l4q5mjtfq_/node_modules/chartjs-adapter-dayjs-3/dist/chartjs-adapter-dayjs-3.esm.js");var Chart=__webpack_require__("../../frontend/src/lib/Chart.ts"),client=__webpack_require__("../../node_modules/.pnpm/react-dom@18.2.0_react@18.2.0/node_modules/react-dom/client.js"),themeLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function BillingLineGraphTooltip(_ref){let{title,sortedSeries}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold text-text-primary",children:title}),sortedSeries.map(item=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(SeriesColorDot,{colorIndex:item.datasetIndex}),(0,jsx_runtime.jsx)("span",{className:"text-text-secondary whitespace-nowrap overflow-hidden text-ellipsis max-w-xs",children:item.label})]}),(0,jsx_runtime.jsx)("span",{className:"font-medium text-text-primary whitespace-nowrap",children:item.formattedValue})]},item.id))]})}let defaultFormatter=value=>value.toLocaleString();function useBillingTooltip(){let tooltipElRef=(0,react.useRef)(null),tooltipRootRef=(0,react.useRef)(null),ensureBillingTooltip=(0,react.useCallback)(()=>(tooltipElRef.current||(tooltipElRef.current=document.createElement("div"),tooltipElRef.current.id="BillingTooltipWrapper",tooltipElRef.current.className="BillingTooltipWrapper hidden absolute z-10 p-2 bg-bg-light rounded shadow-md text-xs pointer-events-none border border-border",document.body.appendChild(tooltipElRef.current)),tooltipRootRef.current||(tooltipRootRef.current=(0,client.createRoot)(tooltipElRef.current)),[tooltipRootRef.current,tooltipElRef.current]),[]),hideBillingTooltip=(0,react.useCallback)(()=>{tooltipElRef.current&&(tooltipElRef.current.classList.add("hidden"),tooltipElRef.current.classList.remove("block"))},[]);return(0,react.useEffect)(()=>()=>{tooltipRootRef.current&&setTimeout(()=>tooltipRootRef.current?.unmount(),0),tooltipElRef.current?.remove()},[]),{ensureBillingTooltip,hideBillingTooltip}}function SeriesColorDot(_ref){let{colorIndex}=_ref;return(0,jsx_runtime.jsx)("div",{className:`series-color-dot series-color-dot-${colorIndex%15}`})}function BillingLineGraph(_ref2){let{series,dates,isLoading,hiddenSeries,valueFormatter=defaultFormatter,showLegend=!0,interval="day"}=_ref2,canvasRef=(0,react.useRef)(null),chartRef=(0,react.useRef)(null),{ensureBillingTooltip,hideBillingTooltip}=useBillingTooltip(),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),graphColors=(0,colors.lw)();return(0,react.useEffect)(()=>{if(!canvasRef.current)return;chartRef.current&&chartRef.current.destroy();let datasets=series.filter(s=>!hiddenSeries.includes(s.id)).map(s=>({label:s.label,data:s.data,borderColor:(0,colors._r)(s.id%15),backgroundColor:(0,colors._r)(s.id%15),borderWidth:2,tension:.1,pointRadius:0,pointHoverRadius:4,pointHoverBackgroundColor:(0,colors._r)(s.id%15),pointHoverBorderColor:(0,colors._r)(s.id%15)})),options={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"nearest",axis:"x",intersect:!1},scales:{x:{type:"time",time:{unit:interval},ticks:{source:"labels",color:graphColors.axisLabel||"#666666"},grid:{display:!1}},y:{beginAtZero:!0,grid:{color:graphColors.axisLine||"rgba(0, 0, 0, 0.1)"},ticks:{callback:function(value){return"number"==typeof value?valueFormatter(value):value},color:graphColors.axisLabel||"#666666"}}},plugins:{tooltip:{enabled:!1,external:_ref3=>{let{tooltip}=_ref3;if(!canvasRef.current)return;let[tooltipRoot,tooltipEl]=ensureBillingTooltip();if(0===tooltip.opacity||!tooltip.body?.length){hideBillingTooltip();return}try{let title=tooltip.title?.[0]||"",sortedSeries=(tooltip.dataPoints||[]).map(point=>{let dataset=point.datasetIndex<series.length?series[point.datasetIndex]:null;if(!dataset)return null;let value=point.parsed.y;return{id:dataset.id,label:dataset.label,value:value,formattedValue:valueFormatter(value),color:(0,colors._r)(dataset.id%15),datasetIndex:point.datasetIndex}}).filter(item=>null!==item).sort((a,b)=>b.value-a.value);tooltipRoot.render((0,jsx_runtime.jsx)(BillingLineGraphTooltip,{title:title,sortedSeries:sortedSeries})),tooltipEl.classList.remove("hidden"),tooltipEl.classList.add("block");let bounds=canvasRef.current.getBoundingClientRect(),tooltipWidth=tooltipEl.offsetWidth,tooltipHeight=tooltipEl.offsetHeight,scrollX=window.scrollX,scrollY=window.scrollY,tooltipX=bounds.left+scrollX+tooltip.caretX+8,tooltipY=bounds.top+scrollY+tooltip.caretY-tooltipHeight/2;tooltipX+tooltipWidth>bounds.right+scrollX&&(tooltipX=bounds.left+scrollX+tooltip.caretX-tooltipWidth-8),tooltipX=Math.max(tooltipX,bounds.left+scrollX),tooltipY=Math.max(tooltipY,bounds.top+scrollY),tooltipY=Math.min(tooltipY,bounds.bottom+scrollY-tooltipHeight),tooltipEl.style.top=`${tooltipY}px`,tooltipEl.style.left=`${tooltipX}px`}catch{hideBillingTooltip()}},mode:"index",intersect:!1},legend:{display:showLegend,position:"bottom",labels:{usePointStyle:!0,boxWidth:6}}}},ctx=canvasRef.current.getContext("2d");return ctx&&(chartRef.current=new Chart.kL(ctx,{type:"line",data:{labels:dates,datasets},options})),()=>{chartRef.current&&chartRef.current.destroy()}},[series,dates,hiddenSeries,valueFormatter,showLegend,interval,ensureBillingTooltip,hideBillingTooltip,isDarkModeOn,graphColors]),(0,jsx_runtime.jsxs)("div",{className:"relative h-96",children:[isLoading&&(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-bg-light bg-opacity-75 z-10",children:(0,jsx_runtime.jsx)("div",{className:"text-muted",children:"Loading..."})}),(0,jsx_runtime.jsx)("canvas",{ref:canvasRef})]})}let BillingDataTable_defaultFormatter=value=>value.toLocaleString();function BillingDataTable(_ref){let{series,dates,isLoading,hiddenSeries,toggleSeries,toggleAllSeries,valueFormatter=BillingDataTable_defaultFormatter,totalLabel="Total"}=_ref,headerChecked=0===hiddenSeries.length||hiddenSeries.length!==series.length&&"indeterminate",dateColumns=(0,react.useMemo)(()=>dates&&0!==dates.length?dates.map((date,colIndex)=>({width:`${100/(dates.length+1)}%`,title:(0,dayjs.Bv)(date).format("MMM D"),render:(_,record)=>{let value=record.data[colIndex];return(0,jsx_runtime.jsxs)("div",{className:"text-right",children:[colIndex>=0&&colIndex<record.data.length?valueFormatter(value):valueFormatter(0)," "]})},key:`date-${colIndex}`,sorter:(a,b)=>{var _a$data$dateIndex,_b$data$dateIndex;return(null!==(_a$data$dateIndex=a.data[colIndex])&&void 0!==_a$data$dateIndex?_a$data$dateIndex:0)-(null!==(_b$data$dateIndex=b.data[colIndex])&&void 0!==_b$data$dateIndex?_b$data$dateIndex:0)},align:"right"})):[],[dates,valueFormatter]),totalColumn=(0,react.useMemo)(()=>({width:`${100/(dates.length+1)}%`,title:totalLabel,render:(_,record)=>{let total=record.data.reduce((sum,val)=>sum+val,0);return(0,jsx_runtime.jsx)("div",{className:"text-right font-semibold",children:valueFormatter(total)})},key:"total",sorter:(a,b)=>a.data.reduce((sum,val)=>sum+val,0)-b.data.reduce((sum,val)=>sum+val,0),align:"right"}),[dates.length,totalLabel,valueFormatter]),columns=(0,react.useMemo)(()=>[{title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)(src.Hw,{checked:headerChecked,onChange:toggleAllSeries,className:"mr-2"}),(0,jsx_runtime.jsx)("span",{children:"Series"})]}),render:(_,record)=>{let isHidden=hiddenSeries.includes(record.id);return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(src.Hw,{checked:!isHidden,onChange:()=>toggleSeries(record.id),className:"mr-2"}),(0,jsx_runtime.jsx)(SeriesColorDot,{colorIndex:record.id}),(0,jsx_runtime.jsx)("span",{className:"font-medium whitespace-nowrap overflow-hidden text-ellipsis max-w-xs",children:record.label})]})},key:"series",sorter:(a,b)=>a.label.localeCompare(b.label)},totalColumn,...dateColumns],[headerChecked,totalColumn,dateColumns,toggleSeries,toggleAllSeries,hiddenSeries]);return(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto border rounded bg-bg-light",children:(0,jsx_runtime.jsx)(src.g3,{"data-attr":"billing-data-table",dataSource:series,columns:columns,loading:isLoading,embedded:!0,size:"small",rowClassName:record=>hiddenSeries.includes(record.id)?"opacity-50":"",defaultSorting:{columnKey:"total",order:-1},rowRibbonColor:record=>(0,colors._r)(record.id%15),firstColumnSticky:!0})})}var hedgehogs=__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx"),supportLogic=__webpack_require__("../../frontend/src/lib/components/Support/supportLogic.ts"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonTag=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx");function BillingEarlyAccessBanner(){let{openSupportForm}=(0,index_esm.useActions)(supportLogic.Pw);return(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",hideIcon:!0,className:"overflow-visible",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"relative flex-shrink-0 mr-2",children:[(0,jsx_runtime.jsx)(LemonTag.o,{type:"completion",className:"absolute top-2.5 left-0 transform -rotate-12",children:"EARLY ACCESS"}),(0,jsx_runtime.jsx)(hedgehogs.BuilderHog3,{className:"w-20 h-20 mt-6"})]}),(0,jsx_runtime.jsxs)("div",{className:"text-primary",children:[(0,jsx_runtime.jsxs)("p",{children:["We're still tinkering with these dashboards - got questions, ideas or bugs?"," ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>openSupportForm({kind:"support",target_area:"billing",isEmailFormOpen:!0}),children:"Send them our way"}),"!"]}),(0,jsx_runtime.jsxs)("ul",{className:"list-disc list-inside pl-2",children:[(0,jsx_runtime.jsx)("li",{children:"Usage data updates daily (UTC) - so today's numbers show up tomorrow"}),(0,jsx_runtime.jsx)("li",{children:"Historical spend is calculated using the current subscription plan"})]})]})]})})}function BillingEmptyState(_ref){let{heading="No data available",detail="Please try adjusting your query or filters."}=_ref;return(0,jsx_runtime.jsxs)("div",{"data-attr":"billing-empty-state",className:"flex flex-col bg-white rounded px-4 py-8 items-center text-center mx-auto",children:[(0,jsx_runtime.jsx)(hedgehogs.WarningHog,{width:"100",height:"100",className:"mb-4"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl leading-tight",children:heading}),"string"==typeof detail?(0,jsx_runtime.jsx)("p",{className:"text-sm text-balance text-tertiary",children:detail}):(0,jsx_runtime.jsx)("div",{className:"text-sm text-balance text-tertiary",children:detail})]})}var BillingNoAccess=__webpack_require__("../../frontend/src/scenes/billing/BillingNoAccess.tsx"),fast_deep_equal=__webpack_require__("../../node_modules/.pnpm/fast-deep-equal@3.1.3/node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),eventUsageLogic=__webpack_require__("../../frontend/src/lib/utils/eventUsageLogic.ts"),lodash_difference=__webpack_require__("../../node_modules/.pnpm/lodash.difference@4.5.0/node_modules/lodash.difference/index.js"),lodash_difference_default=__webpack_require__.n(lodash_difference),lodash_sortby=__webpack_require__("../../node_modules/.pnpm/lodash.sortby@4.7.0/node_modules/lodash.sortby/index.js"),lodash_sortby_default=__webpack_require__.n(lodash_sortby),organizationLogic=__webpack_require__("../../frontend/src/scenes/organizationLogic.tsx");let DEFAULT_BILLING_SPEND_FILTERS={usage_types:[],team_ids:[],breakdowns:["type"],interval:"day"},billingSpendLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","billing","billingSpendLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{dashboardItemId}=_ref;return dashboardItemId||"global_spend"}),(0,index_esm.connect)({values:[organizationLogic.organizationLogic,["currentOrganization"],billingLogic.billingLogic,["billing"]],actions:[eventUsageLogic.vx,["reportBillingSpendInteraction"]]}),(0,index_esm.actions)({setFilters:function(filters){let shouldDebounce=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return{filters,shouldDebounce}},setDateRange:function(dateFrom,dateTo){let shouldDebounce=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return{dateFrom,dateTo,shouldDebounce}},toggleSeries:id=>({id}),toggleAllSeries:!0,setExcludeEmptySeries:function(exclude){let shouldDebounce=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return{exclude,shouldDebounce}},toggleBreakdown:dimension=>({dimension}),resetFilters:!0}),(0,kea_loaders_lib.loaders)(_ref2=>{let{values}=_ref2;return{billingSpendResponse:[null,{loadBillingSpend:async()=>{if(!(0,billing_utils.nM)(values.currentOrganization))return null;let{usage_types,team_ids,breakdowns,interval}=values.filters,params={...usage_types&&usage_types.length>0?{usage_types:JSON.stringify(usage_types)}:{},...team_ids&&team_ids.length>0?{team_ids:JSON.stringify(team_ids)}:{},...breakdowns&&breakdowns.length>0?{breakdowns:JSON.stringify(breakdowns)}:{},start_date:values.dateFrom||(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD"),end_date:values.dateTo||(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD"),...interval?{interval}:{}};try{return await api.ZP.get(`api/billing/spend/?${(0,utils.oZ)(params)}`)}catch(error){throw src.UJ.error("Failed to load billing spend, please try again or contact support."),error}}}]}}),(0,index_esm.reducers)({filters:[{...DEFAULT_BILLING_SPEND_FILTERS},{setFilters:(state,_ref3)=>{let{filters}=_ref3;return{...state,...filters}},toggleBreakdown:(state,_ref4)=>{let{dimension}=_ref4,current=state.breakdowns||[],next=current.includes(dimension)?current.filter(d=>d!==dimension):[...current,dimension];return{...state,breakdowns:next}},resetFilters:()=>({...DEFAULT_BILLING_SPEND_FILTERS})}],dateFrom:[(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD"),{setDateRange:(_,_ref5)=>{let{dateFrom}=_ref5;return dateFrom||(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD")},resetFilters:()=>(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD")}],dateTo:[(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD"),{setDateRange:(_,_ref6)=>{let{dateTo}=_ref6;return dateTo||(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD")},resetFilters:()=>(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD")}],userHiddenSeries:[[],{toggleSeries:(state,_ref7)=>{let{id}=_ref7;return state.includes(id)?state.filter(i=>i!==id):[...state,id]}}],excludeEmptySeries:[!1,{setExcludeEmptySeries:(_,_ref8)=>{let{exclude}=_ref8;return exclude},resetFilters:()=>!1}]}),(0,index_esm.selectors)({series:[s=>[s.billingSpendResponse],response=>response?.results?response.results:[]],dates:[s=>[s.billingSpendResponse],response=>response?.results?.[0]?.dates||[]],dateOptions:[s=>[s.billing],billing=>{let currentBillingPeriodStart=billing?.billing_period?.current_period_start,currentBillingPeriodEnd=billing?.billing_period?.current_period_end,currentBillingPeriodOption={key:"Current billing period",values:[currentBillingPeriodStart?.format("YYYY-MM-DD")||"",currentBillingPeriodEnd?.format("YYYY-MM-DD")||""],defaultInterval:"day"};return[currentBillingPeriodOption,{key:"Previous billing period",values:[currentBillingPeriodStart?.subtract(1,"month").format("YYYY-MM-DD")||"",currentBillingPeriodEnd?.subtract(1,"month").format("YYYY-MM-DD")||""]},...utils.bE.filter(o=>"hour"!==o.defaultInterval)]}],emptySeriesIDs:[s=>[s.series],series=>series.filter(item=>0===item.data.reduce((a,b)=>a+b,0)).map(item=>item.id)],finalHiddenSeries:[s=>[s.userHiddenSeries,s.excludeEmptySeries,s.emptySeriesIDs],(userHiddenSeries,excludeEmptySeries,emptySeriesIDs)=>excludeEmptySeries?Array.from(new Set([...userHiddenSeries,...emptySeriesIDs])):userHiddenSeries],showSeries:[s=>[s.billingSpendResponseLoading,s.series],(billingSpendResponseLoading,series)=>billingSpendResponseLoading||series.length>0],showEmptyState:[s=>[s.showSeries,s.billingSpendResponse],(showSeries,billingSpendResponse)=>!showSeries&&!!billingSpendResponse],heading:[s=>[s.filters],filters=>{let{interval,breakdowns}=filters,headingText="";"day"===interval?headingText="Daily":"week"===interval?headingText="Weekly":"month"===interval&&(headingText="Monthly"),headingText+=" spend";let breakdownParts=[];return breakdowns?.includes("type")&&breakdownParts.push("product"),breakdowns?.includes("team")&&breakdownParts.push("project"),breakdownParts.length>0&&(headingText+=` by ${breakdownParts.join(" and ")}`),headingText}],headingTooltip:[s=>[s.dateTo],dateTo=>(0,dayjs.Bv)(dateTo).isBefore((0,dayjs.Bv)(),"day")?null:"Spend is reported on a daily basis so the figures for the current day (UTC) are not available."],teamOptions:[s=>[s.currentOrganization,s.billingSpendResponse],(currentOrganization,billingSpendResponse)=>{let liveTeams=currentOrganization?.teams||[],liveTeamIds=liveTeams.map(team=>team.id),liveOptions=lodash_sortby_default()(liveTeams.map(team=>({key:String(team.id),label:team.name})),"label"),teamIdOptions=billingSpendResponse?.team_id_options||[],deletedTeamIds=lodash_difference_default()(teamIdOptions,liveTeamIds);return[...liveOptions,...lodash_sortby_default()(deletedTeamIds).map(teamId=>({key:String(teamId),label:`ID: ${teamId} (deleted)`}))]}]}),(0,lib.actionToUrl)(_ref9=>{let{values}=_ref9,buildURL=()=>(0,billing_utils.Pk)(lib.router,params=>((0,billing_utils.bU)(params,"usage_types",values.filters.usage_types,DEFAULT_BILLING_SPEND_FILTERS.usage_types),(0,billing_utils.bU)(params,"team_ids",values.filters.team_ids,DEFAULT_BILLING_SPEND_FILTERS.team_ids),(0,billing_utils.bU)(params,"breakdowns",values.filters.breakdowns,DEFAULT_BILLING_SPEND_FILTERS.breakdowns),(0,billing_utils.bU)(params,"interval",values.filters.interval,DEFAULT_BILLING_SPEND_FILTERS.interval),(0,billing_utils.bU)(params,"date_from",values.dateFrom,(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD")),(0,billing_utils.bU)(params,"date_to",values.dateTo,(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD")),(0,billing_utils.bU)(params,"exclude_empty",values.excludeEmptySeries,!1),params));return{setFilters:()=>buildURL(),setDateRange:()=>buildURL(),setExcludeEmptySeries:()=>buildURL(),toggleBreakdown:()=>buildURL(),resetFilters:()=>buildURL()}}),(0,lib.urlToAction)(_ref10=>{let{actions,values}=_ref10;return{"*":(_,params)=>{let filtersFromUrl={};params.usage_types&&!fast_deep_equal_default()(params.usage_types,values.filters.usage_types)&&(filtersFromUrl.usage_types=params.usage_types),params.team_ids&&!fast_deep_equal_default()(params.team_ids,values.filters.team_ids)&&(filtersFromUrl.team_ids=params.team_ids),params.breakdowns&&!fast_deep_equal_default()(params.breakdowns,values.filters.breakdowns)&&(filtersFromUrl.breakdowns=params.breakdowns),params.interval&&params.interval!==values.filters.interval&&(filtersFromUrl.interval=params.interval),Object.keys(filtersFromUrl).length>0&&actions.setFilters(filtersFromUrl,!1),(params.date_from&&params.date_from!==values.dateFrom||params.date_to&&params.date_to!==values.dateTo)&&actions.setDateRange(params.date_from||null,params.date_to||null,!1),void 0!==params.exclude_empty&&params.exclude_empty!==values.excludeEmptySeries&&actions.setExcludeEmptySeries(!!params.exclude_empty,!1)}}}),(0,index_esm.listeners)(_ref11=>{let{actions,values}=_ref11;return{setFilters:async(_ref12,breakpoint)=>{let{shouldDebounce}=_ref12;shouldDebounce&&(await breakpoint(200),actions.reportBillingSpendInteraction((0,billing_utils.m5)("filters_changed",values))),actions.loadBillingSpend()},setDateRange:async(_ref13,breakpoint)=>{let{shouldDebounce}=_ref13;shouldDebounce&&(await breakpoint(200),actions.reportBillingSpendInteraction((0,billing_utils.m5)("date_changed",values))),actions.loadBillingSpend()},resetFilters:async()=>{actions.reportBillingSpendInteraction((0,billing_utils.m5)("filters_cleared",values)),actions.loadBillingSpend()},toggleAllSeries:()=>{let{series,excludeEmptySeries,userHiddenSeries}=values,ids=(excludeEmptySeries?series.filter(s=>s.data.reduce((a,b)=>a+b,0)>0):series).map(s=>s.id),isAllVisible=ids.length>0&&ids.every(id=>!userHiddenSeries.includes(id));actions.reportBillingSpendInteraction((0,billing_utils.m5)("series_toggled",values)),isAllVisible?ids.forEach(id=>actions.toggleSeries(id)):userHiddenSeries.forEach(id=>actions.toggleSeries(id))},toggleBreakdown:async(_payload,breakpoint)=>{await breakpoint(200),actions.reportBillingSpendInteraction((0,billing_utils.m5)("breakdown_toggled",values)),actions.loadBillingSpend()}}}),(0,index_esm.afterMount)(logic=>{logic.actions.loadBillingSpend()})]);var billing_constants=__webpack_require__("../../frontend/src/scenes/billing/constants.ts");function BillingSpendView(){let restrictionReason=(0,RestrictedArea.U)({minimumAccessLevel:constants.Dk.Admin,scope:RestrictedArea.C.Organization}),logic=billingSpendLogic({dashboardItemId:"spendView"}),{series,dates,filters,dateFrom,dateTo,billingSpendResponseLoading,dateOptions,excludeEmptySeries,finalHiddenSeries,heading,headingTooltip,showSeries,showEmptyState,teamOptions}=(0,index_esm.useValues)(logic),{setFilters,setDateRange,toggleSeries,toggleAllSeries,setExcludeEmptySeries,toggleBreakdown,resetFilters}=(0,index_esm.useActions)(logic);return restrictionReason?(0,jsx_runtime.jsx)(BillingNoAccess.J,{title:"Spend",reason:restrictionReason}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(BillingEarlyAccessBanner,{}),(0,jsx_runtime.jsxs)("div",{className:"border rounded p-4 bg-bg-light space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 items-start flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Products"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",className:"w-50 h-10",value:filters.usage_types||[],onChange:value=>setFilters({usage_types:value}),placeholder:"All products",options:billing_constants.c.map(opt=>({key:opt.value,label:opt.label})),allowCustomValues:!1})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Projects"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",className:"w-50 h-10",value:(filters.team_ids||[]).map(String),onChange:value=>setFilters({team_ids:value.map(Number).filter(n=>!isNaN(n))}),placeholder:"All projects",options:teamOptions,loading:billingSpendResponseLoading,allowCustomValues:!1})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Break down by"}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center min-h-10",children:[(0,jsx_runtime.jsx)(src.Hw,{label:"Product",checked:filters.breakdowns?.includes("type"),onChange:()=>toggleBreakdown("type")}),(0,jsx_runtime.jsx)(src.Hw,{label:"Project",checked:filters.breakdowns?.includes("team"),onChange:()=>toggleBreakdown("team")})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Date range (UTC)"}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-light rounded-md",children:(0,jsx_runtime.jsx)(DateFilter.f,{className:"h-8 flex items-center",dateFrom:dateFrom,dateTo:dateTo,onChange:(fromDate,toDate)=>setDateRange(fromDate,toDate),dateOptions:dateOptions})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Group by"}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-light rounded-md",children:(0,jsx_runtime.jsx)(src.Yv,{className:"h-10.5 flex items-center",size:"small",value:filters.interval||"day",onChange:value=>setFilters({interval:value}),options:[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}]})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Options"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center min-h-10",children:(0,jsx_runtime.jsx)(src.Hw,{label:"Hide results with no spend",checked:excludeEmptySeries,onChange:value=>setExcludeEmptySeries(value)})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:" "}),(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"medium",onClick:resetFilters,children:"Clear filters"})})]})]}),showSeries&&(0,jsx_runtime.jsx)(BillingLineGraph,{series:series,dates:dates,isLoading:billingSpendResponseLoading,hiddenSeries:finalHiddenSeries,valueFormatter:billing_utils.oB,showLegend:!1,interval:filters.interval}),showEmptyState&&(0,jsx_runtime.jsx)(BillingEmptyState,{heading:"We couldn't find any usage data for your current query.",detail:"Try adjusting the filters. If you think something is wrong, contact us!"})]}),showSeries&&(0,jsx_runtime.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold mb-0",children:heading}),headingTooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:headingTooltip,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg text-secondary shrink-0"})})]}),(0,jsx_runtime.jsx)(BillingDataTable,{series:series,dates:dates,isLoading:billingSpendResponseLoading,hiddenSeries:finalHiddenSeries,toggleSeries:toggleSeries,toggleAllSeries:toggleAllSeries,valueFormatter:billing_utils.oB,totalLabel:"Total Spend"})]})]})}let TEMPORARILY_EXCLUDED_DATE_FILTER_OPTIONS=["This month","Year to date","All time"],DEFAULT_BILLING_USAGE_FILTERS={breakdowns:["type"],usage_types:[],team_ids:[],interval:"day"},billingUsageLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","billing","billingUsageLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{dashboardItemId}=_ref;return dashboardItemId||"global"}),(0,index_esm.connect)({values:[organizationLogic.organizationLogic,["currentOrganization"],billingLogic.billingLogic,["billing"]],actions:[eventUsageLogic.vx,["reportBillingUsageInteraction"]]}),(0,index_esm.actions)({setFilters:function(filters){let shouldDebounce=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return{filters,shouldDebounce}},setDateRange:function(dateFrom,dateTo){let shouldDebounce=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return{dateFrom,dateTo,shouldDebounce}},toggleSeries:id=>({id}),toggleAllSeries:!0,setExcludeEmptySeries:function(exclude){let shouldDebounce=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return{exclude,shouldDebounce}},toggleTeamBreakdown:!0,resetFilters:!0}),(0,kea_loaders_lib.loaders)(_ref2=>{let{values}=_ref2;return{billingUsageResponse:[null,{loadBillingUsage:async()=>{if(!(0,billing_utils.nM)(values.currentOrganization))return null;let{usage_types,team_ids,breakdowns,interval}=values.filters,params={...usage_types&&usage_types.length>0?{usage_types:JSON.stringify(usage_types)}:{},...team_ids&&team_ids.length>0?{team_ids:JSON.stringify(team_ids)}:{},...breakdowns&&breakdowns.length>0?{breakdowns:JSON.stringify(breakdowns)}:{},start_date:values.dateFrom||(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD"),end_date:values.dateTo||(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD"),...interval?{interval}:{}};try{return await api.ZP.get(`api/billing/usage/?${(0,utils.oZ)(params)}`)}catch(error){throw src.UJ.error("Failed to load billing usage. Please try again or contact support."),error}}}]}}),(0,index_esm.reducers)({filters:[{...DEFAULT_BILLING_USAGE_FILTERS},{setFilters:(state,_ref3)=>{let{filters}=_ref3;return{...state,...filters}},toggleTeamBreakdown:state=>{var _state$breakdowns;let current=null!==(_state$breakdowns=state.breakdowns)&&void 0!==_state$breakdowns?_state$breakdowns:[],next=current.includes("team")?current.filter(d=>"team"!==d):[...current,"team"];return{...state,breakdowns:next}},resetFilters:()=>({...DEFAULT_BILLING_USAGE_FILTERS})}],dateFrom:[(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD"),{setDateRange:(_,_ref4)=>{let{dateFrom}=_ref4;return dateFrom||(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD")},resetFilters:()=>(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD")}],dateTo:[(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD"),{setDateRange:(_,_ref5)=>{let{dateTo}=_ref5;return dateTo||(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD")},resetFilters:()=>(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD")}],userHiddenSeries:[[],{toggleSeries:(state,_ref6)=>{let{id}=_ref6;return state.includes(id)?state.filter(i=>i!==id):[...state,id]}}],excludeEmptySeries:[!1,{setExcludeEmptySeries:(_,_ref7)=>{let{exclude}=_ref7;return exclude},resetFilters:()=>!1}]}),(0,index_esm.selectors)({dateOptions:[s=>[s.billing],billing=>{let currentBillingPeriodStart=billing?.billing_period?.current_period_start,currentBillingPeriodEnd=billing?.billing_period?.current_period_end,currentBillingPeriodOption={key:"Current billing period",values:[currentBillingPeriodStart?.format("YYYY-MM-DD")||"",currentBillingPeriodEnd?.format("YYYY-MM-DD")||""],defaultInterval:"day"};return[currentBillingPeriodOption,{key:"Previous billing period",values:[currentBillingPeriodStart?.subtract(1,"month").format("YYYY-MM-DD")||"",currentBillingPeriodEnd?.subtract(1,"month").format("YYYY-MM-DD")||""]},...utils.bE.filter(o=>"hour"!==o.defaultInterval&&!TEMPORARILY_EXCLUDED_DATE_FILTER_OPTIONS.includes(o.key))]}],series:[s=>[s.billingUsageResponse],response=>response?.results?response.results:[]],dates:[s=>[s.billingUsageResponse],response=>response?.results?.[0]?.dates||[]],emptySeriesIDs:[s=>[s.series],series=>series.filter(item=>0===item.data.reduce((a,b)=>a+b,0)).map(item=>item.id)],finalHiddenSeries:[s=>[s.userHiddenSeries,s.excludeEmptySeries,s.emptySeriesIDs],(userHiddenSeries,excludeEmptySeries,emptySeriesIDs)=>excludeEmptySeries?Array.from(new Set([...userHiddenSeries,...emptySeriesIDs])):userHiddenSeries],showSeries:[s=>[s.billingUsageResponseLoading,s.series],(billingUsageResponseLoading,series)=>billingUsageResponseLoading||series.length>0],showEmptyState:[s=>[s.showSeries,s.billingUsageResponse],(showSeries,billingUsageResponse)=>!showSeries&&!!billingUsageResponse],heading:[s=>[s.filters],filters=>{let{interval,breakdowns}=filters,heading="";"day"===interval?heading="Daily":"week"===interval?heading="Weekly":"month"===interval&&(heading="Monthly"),heading+=" usage";let breakdownParts=[];return breakdowns?.includes("type")&&breakdownParts.push("product"),breakdowns?.includes("team")&&breakdownParts.push("project"),breakdownParts.length>0&&(heading+=` by ${breakdownParts.join(" and ")}`),heading}],headingTooltip:[s=>[s.dateTo],dateTo=>(0,dayjs.Bv)(dateTo).isBefore((0,dayjs.Bv)(),"day")?null:"Usage is reported on a daily basis so the figures for the current day (UTC) are not available."],teamOptions:[s=>[s.currentOrganization,s.billingUsageResponse],(currentOrganization,billingUsageResponse)=>{let liveTeams=currentOrganization?.teams||[],liveTeamIds=liveTeams.map(team=>team.id),liveOptions=lodash_sortby_default()(liveTeams.map(team=>({key:String(team.id),label:team.name})),"label"),teamIdOptions=billingUsageResponse?.team_id_options||[],deletedTeamIds=lodash_difference_default()(teamIdOptions,liveTeamIds);return[...liveOptions,...lodash_sortby_default()(deletedTeamIds).map(teamId=>({key:String(teamId),label:`ID: ${teamId} (deleted)`}))]}]}),(0,lib.actionToUrl)(_ref8=>{let{values}=_ref8,buildURL=()=>(0,billing_utils.Pk)(lib.router,params=>((0,billing_utils.bU)(params,"usage_types",values.filters.usage_types,DEFAULT_BILLING_USAGE_FILTERS.usage_types),(0,billing_utils.bU)(params,"team_ids",values.filters.team_ids,DEFAULT_BILLING_USAGE_FILTERS.team_ids),(0,billing_utils.bU)(params,"breakdowns",values.filters.breakdowns,DEFAULT_BILLING_USAGE_FILTERS.breakdowns),(0,billing_utils.bU)(params,"interval",values.filters.interval,DEFAULT_BILLING_USAGE_FILTERS.interval),(0,billing_utils.bU)(params,"date_from",values.dateFrom,(0,dayjs.Bv)().subtract(1,"month").subtract(1,"day").format("YYYY-MM-DD")),(0,billing_utils.bU)(params,"date_to",values.dateTo,(0,dayjs.Bv)().subtract(1,"day").format("YYYY-MM-DD")),(0,billing_utils.bU)(params,"exclude_empty",values.excludeEmptySeries,!1),params));return{setFilters:()=>buildURL(),setDateRange:()=>buildURL(),setExcludeEmptySeries:()=>buildURL(),toggleTeamBreakdown:()=>buildURL(),resetFilters:()=>buildURL()}}),(0,lib.urlToAction)(_ref9=>{let{actions,values}=_ref9;return{"*":(_,params)=>{let filtersFromUrl={};params.usage_types&&!fast_deep_equal_default()(params.usage_types,values.filters.usage_types)&&(filtersFromUrl.usage_types=params.usage_types),params.team_ids&&!fast_deep_equal_default()(params.team_ids,values.filters.team_ids)&&(filtersFromUrl.team_ids=params.team_ids),params.breakdowns&&!fast_deep_equal_default()(params.breakdowns,values.filters.breakdowns)&&(filtersFromUrl.breakdowns=params.breakdowns),params.interval&&params.interval!==values.filters.interval&&(filtersFromUrl.interval=params.interval),Object.keys(filtersFromUrl).length>0&&actions.setFilters(filtersFromUrl,!1),(params.date_from&&params.date_from!==values.dateFrom||params.date_to&&params.date_to!==values.dateTo)&&actions.setDateRange(params.date_from||null,params.date_to||null,!1),void 0!==params.exclude_empty&&params.exclude_empty!==values.excludeEmptySeries&&actions.setExcludeEmptySeries(!!params.exclude_empty,!1)}}}),(0,index_esm.listeners)(_ref10=>{let{actions,values}=_ref10;return{setFilters:async(_ref11,breakpoint)=>{let{shouldDebounce}=_ref11;shouldDebounce&&(await breakpoint(200),actions.reportBillingUsageInteraction((0,billing_utils.m5)("filters_changed",values))),actions.loadBillingUsage()},setDateRange:async(_ref12,breakpoint)=>{let{shouldDebounce}=_ref12;shouldDebounce&&(await breakpoint(200),actions.reportBillingUsageInteraction((0,billing_utils.m5)("date_changed",values))),actions.loadBillingUsage()},resetFilters:async()=>{actions.reportBillingUsageInteraction((0,billing_utils.m5)("filters_cleared",values)),actions.loadBillingUsage()},toggleAllSeries:()=>{let{series,excludeEmptySeries,userHiddenSeries}=values,ids=(excludeEmptySeries?series.filter(s=>s.data.reduce((a,b)=>a+b,0)>0):series).map(s=>s.id),isAllVisible=ids.length>0&&ids.every(id=>!userHiddenSeries.includes(id));actions.reportBillingUsageInteraction((0,billing_utils.m5)("series_toggled",values)),isAllVisible?ids.forEach(id=>actions.toggleSeries(id)):userHiddenSeries.forEach(id=>actions.toggleSeries(id))},toggleTeamBreakdown:async(_payload,breakpoint)=>{await breakpoint(200),actions.reportBillingUsageInteraction((0,billing_utils.m5)("breakdown_toggled",values)),actions.loadBillingUsage()}}}),(0,index_esm.afterMount)(_ref13=>{let{actions}=_ref13;actions.loadBillingUsage()})]);function BillingUsage_BillingUsage(){let restrictionReason=(0,RestrictedArea.U)({minimumAccessLevel:constants.Dk.Admin,scope:RestrictedArea.C.Organization}),logic=billingUsageLogic({dashboardItemId:"usage"}),{series,dates,filters,dateFrom,dateTo,billingUsageResponseLoading,dateOptions,excludeEmptySeries,finalHiddenSeries,heading,headingTooltip,showSeries,showEmptyState,teamOptions}=(0,index_esm.useValues)(logic),{setFilters,setDateRange,toggleSeries,toggleAllSeries,setExcludeEmptySeries,toggleTeamBreakdown,resetFilters}=(0,index_esm.useActions)(logic);return restrictionReason?(0,jsx_runtime.jsx)(BillingNoAccess.J,{title:"Usage",reason:restrictionReason}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(BillingEarlyAccessBanner,{}),(0,jsx_runtime.jsxs)("div",{className:"border rounded p-4 bg-bg-light space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 items-start flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Products"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",className:"w-50 h-10",value:filters.usage_types||[],onChange:value=>setFilters({usage_types:value}),placeholder:"All products",options:billing_constants.c.map(opt=>({key:opt.value,label:opt.label})),allowCustomValues:!1})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Projects"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",className:"w-50 h-10",value:(filters.team_ids||[]).map(String),onChange:value=>setFilters({team_ids:value.map(Number).filter(n=>!isNaN(n))}),placeholder:"All projects",options:teamOptions,loading:billingUsageResponseLoading,allowCustomValues:!1})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Break down by"}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center min-h-10",children:[(0,jsx_runtime.jsx)("span",{className:"opacity-70",children:(0,jsx_runtime.jsx)(src.Hw,{label:"Product",checked:!0,disabledReason:"Breakdown by Product is required for usage volume, as summing different units (e.g., events + recordings) doesn't produce a meaningful total."})}),(0,jsx_runtime.jsx)(src.Hw,{label:"Project",checked:(filters.breakdowns||[]).includes("team"),onChange:toggleTeamBreakdown})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Date range (UTC)"}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-light rounded-md",children:(0,jsx_runtime.jsx)(DateFilter.f,{className:"h-8 flex items-center",dateFrom:dateFrom,dateTo:dateTo,onChange:(fromDate,toDate)=>setDateRange(fromDate,toDate),dateOptions:dateOptions})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Group by"}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-light rounded-md",children:(0,jsx_runtime.jsx)(src.Yv,{className:"h-10.5 flex items-center",size:"small",value:filters.interval||"day",onChange:value=>setFilters({interval:value}),options:[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}]})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Options"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center min-h-10",children:(0,jsx_runtime.jsx)(src.Hw,{label:"Hide results with no usage",checked:excludeEmptySeries,onChange:value=>setExcludeEmptySeries(value)})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:" "}),(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"medium",onClick:resetFilters,children:"Clear filters"})})]})]}),showSeries&&(0,jsx_runtime.jsx)(BillingLineGraph,{series:series,dates:dates,isLoading:billingUsageResponseLoading,hiddenSeries:finalHiddenSeries,showLegend:!1,interval:filters.interval}),showEmptyState&&(0,jsx_runtime.jsx)(BillingEmptyState,{heading:"We couldn't find any usage data for your current query.",detail:"Try adjusting the filters. If you think something is wrong, contact us!"})]}),showSeries?(0,jsx_runtime.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold mb-0",children:heading}),headingTooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:headingTooltip,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg text-secondary shrink-0"})})]}),(0,jsx_runtime.jsx)(BillingDataTable,{series:series,dates:dates,isLoading:billingUsageResponseLoading,hiddenSeries:finalHiddenSeries,toggleSeries:toggleSeries,toggleAllSeries:toggleAllSeries})]}):null]})}let scene={component:BillingSection,logic:billingLogic.billingLogic},tabs=[{key:"overview",label:"Overview"},{key:"usage",label:"Usage"},{key:"spend",label:"Spend"}];function BillingSection(){let{location,searchParams}=(0,index_esm.useValues)(lib.router),section=location.pathname.includes("spend")?"spend":location.pathname.includes("usage")?"usage":"overview";return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)(src.TP,{activeKey:section,onChange:key=>{let newUrl=urls.j.organizationBillingSection(key),targetHasParams="usage"===key||"spend"===key;if(!(("usage"===section||"spend"===section)&&targetHasParams)){lib.router.actions.push(newUrl);return}let paramsToPreserve={...searchParams};if("spend"===section&&"usage"===key&&paramsToPreserve.breakdowns){let currentBreakdowns=Array.isArray(paramsToPreserve.breakdowns)?paramsToPreserve.breakdowns:[];currentBreakdowns.includes("type")||(paramsToPreserve.breakdowns=["type",...currentBreakdowns])}lib.router.actions.push(newUrl,paramsToPreserve)},tabs:tabs}),"overview"===section&&(0,jsx_runtime.jsx)(billing_Billing.Billing,{}),"usage"===section&&(0,jsx_runtime.jsx)(BillingUsage_BillingUsage,{}),"spend"===section&&(0,jsx_runtime.jsx)(BillingSpendView,{})]})}},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.4_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/billing/BillingUsage.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".series-color-dot{border-radius:9999px;display:inline-block;height:.75rem;margin-right:.5rem;width:.75rem}.series-color-dot-0{background-color:var(--data-color-1)}.series-color-dot-1{background-color:var(--data-color-2)}.series-color-dot-2{background-color:var(--data-color-3)}.series-color-dot-3{background-color:var(--data-color-4)}.series-color-dot-4{background-color:var(--data-color-5)}.series-color-dot-5{background-color:var(--data-color-6)}.series-color-dot-6{background-color:var(--data-color-7)}.series-color-dot-7{background-color:var(--data-color-8)}.series-color-dot-8{background-color:var(--data-color-9)}.series-color-dot-9{background-color:var(--data-color-10)}.series-color-dot-10{background-color:var(--data-color-11)}.series-color-dot-11{background-color:var(--data-color-12)}.series-color-dot-12{background-color:var(--data-color-13)}.series-color-dot-13{background-color:var(--data-color-14)}.series-color-dot-14{background-color:var(--data-color-15)}",""]),module.exports=exports}}]);