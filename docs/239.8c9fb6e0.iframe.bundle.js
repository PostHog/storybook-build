(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{"./frontend/src/scenes/feature-flags/FeatureFlag.tsx":function(ee,M,a){"use strict";a.r(M),a.d(M,"scene",function(){return pt}),a.d(M,"FeatureFlag",function(){return We});var te=a("./node_modules/core-js/modules/es.array.concat.js"),Xe=a("./node_modules/core-js/modules/es.array.map.js"),Se=a("./node_modules/core-js/modules/es.function.name.js"),Qe=a("./node_modules/core-js/modules/es.object.to-string.js"),Ie=a("./node_modules/core-js/modules/es.regexp.to-string.js"),Me=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),ae=a.n(Me),Ae=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),X=a.n(Ae),A=a("./node_modules/react/index.js"),e=a.n(A),y=a("./node_modules/antd/es/form/index.js"),ce=a("./node_modules/antd/es/switch/index.js"),I=a("./node_modules/antd/es/button/index.js"),W=a("./node_modules/antd/es/row/index.js"),C=a("./node_modules/antd/es/col/index.js"),G=a("./node_modules/antd/es/input/index.js"),Q=a("./node_modules/antd/es/collapse/index.js"),de=a("./node_modules/antd/es/popconfirm/index.js"),ne=a("./node_modules/antd/es/radio/index.js"),me=a("./node_modules/antd/es/slider/index.js"),N=a("./node_modules/antd/es/input-number/index.js"),Z=a("./node_modules/antd/es/select/index.js"),fe=a("./node_modules/antd/es/card/index.js"),L=a("./node_modules/kea/lib/index.esm.js"),K=a("./frontend/src/lib/utils.tsx"),ge=a("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),w=a("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),re=a("./node_modules/@ant-design/icons/es/icons/SaveOutlined.js"),$=a("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917.7 148.8l-42.4-42.4c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-76.1 76.1a199.27 199.27 0 00-112.1-34.3c-51.2 0-102.4 19.5-141.5 58.6L432.3 308.7a8.03 8.03 0 000 11.3L704 591.7c1.6 1.6 3.6 2.3 5.7 2.3 2 0 4.1-.8 5.7-2.3l101.9-101.9c68.9-69 77-175.7 24.3-253.5l76.1-76.1c3.1-3.2 3.1-8.3 0-11.4zM578.9 546.7a8.03 8.03 0 00-11.3 0L501 613.3 410.7 523l66.7-66.7c3.1-3.1 3.1-8.2 0-11.3L441 408.6a8.03 8.03 0 00-11.3 0L363 475.3l-43-43a7.85 7.85 0 00-5.7-2.3c-2 0-4.1.8-5.7 2.3L206.8 534.2c-68.9 68.9-77 175.7-24.3 253.5l-76.1 76.1a8.03 8.03 0 000 11.3l42.4 42.4c1.6 1.6 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3l76.1-76.1c33.7 22.9 72.9 34.3 112.1 34.3 51.2 0 102.4-19.5 141.5-58.6l101.9-101.9c3.1-3.1 3.1-8.2 0-11.3l-43-43 66.7-66.7c3.1-3.1 3.1-8.2 0-11.3l-36.6-36.2z"}}]},name:"api",theme:"filled"},ve=pe,v=a("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),f=function(t,r){return A.createElement(v.a,Object($.a)(Object($.a)({},t),{},{ref:r,icon:ve}))};f.displayName="ApiFilled";var E=A.forwardRef(f),h=a("./node_modules/@ant-design/icons/es/icons/LockOutlined.js"),b={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"merge-cells",theme:"outlined"},D=b,V=function(t,r){return A.createElement(v.a,Object($.a)(Object($.a)({},t),{},{ref:r,icon:D}))};V.displayName="MergeCellsOutlined";var k=A.forwardRef(V),T=a("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),q=a("./node_modules/@ant-design/icons/es/icons/CopyOutlined.js"),Ze=a("./node_modules/core-js/modules/es.array.every.js"),B=a("./node_modules/core-js/modules/es.array.filter.js"),ye=a("./node_modules/core-js/modules/es.array.find.js"),Vt=a("./node_modules/core-js/modules/es.array.for-each.js"),Rt=a("./node_modules/core-js/modules/es.array.iterator.js"),Nt=a("./node_modules/core-js/modules/es.array.reduce.js"),Kt=a("./node_modules/core-js/modules/es.array.splice.js"),Bt=a("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ut=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),ke=a("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),qe=a.n(ke),et=a("./node_modules/@babel/runtime/regenerator/index.js"),R=a.n(et),Wt=a("./node_modules/regenerator-runtime/runtime.js"),tt=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),le=a.n(tt),at=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),x=a.n(at),Ee=a("./frontend/src/lib/api.ts"),nt=a("./node_modules/react-toastify/esm/react-toastify.js"),xe=a("./node_modules/kea-router/lib/index.js"),he=a("./frontend/src/scenes/urls.ts"),_e=a("./frontend/src/scenes/teamLogic.tsx"),Fe=a("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),Le=a("./frontend/src/models/groupsModel.ts"),De=a("./frontend/src/lib/components/TaxonomicFilter/types.ts");function Ve(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),r.push.apply(r,l)}return r}function o(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ve(Object(r),!0).forEach(function(l){ae()(n,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Ve(Object(r)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(r,l))})}return n}var Re={id:null,created_at:null,key:"",name:"",filters:{groups:[{properties:[],rollout_percentage:null}],multivariate:null},deleted:!1,active:!0,created_by:null,is_simple_flag:!1,rollout_percentage:null},rt={key:"",name:"",rollout_percentage:0},lt={variants:[{key:"",name:"",rollout_percentage:100}]},je=Object(L.kea)({path:["scenes","feature-flags","featureFlagLogic"],connect:{values:[_e.a,["currentTeamId"],Le.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]]},actions:{setFeatureFlagId:function(t){return{id:t}},setFeatureFlag:function(t){return{featureFlag:t}},addConditionSet:!0,setAggregationGroupTypeIndex:function(t){return{value:t}},removeConditionSet:function(t){return{index:t}},duplicateConditionSet:function(t){return{index:t}},updateConditionSet:function(t,r,l){return{index:t,newRolloutPercentage:r,newProperties:l}},deleteFeatureFlag:function(t){return{featureFlag:t}},setMultivariateEnabled:function(t){return{enabled:t}},setMultivariateOptions:function(t){return{multivariateOptions:t}},addVariant:!0,updateVariant:function(t,r){return{index:t,newProperties:r}},removeVariant:function(t){return{index:t}},distributeVariantsEqually:!0},reducers:{featureFlagId:[null,{setFeatureFlagId:function(t,r){var l=r.id;return l}}],featureFlag:[null,{setFeatureFlag:function(t,r){var l=r.featureFlag;return l},addConditionSet:function(t){if(!t)return t;var r=[].concat(x()(t==null?void 0:t.filters.groups),[{properties:[],rollout_percentage:null}]);return o(o({},t),{},{filters:o(o({},t.filters),{},{groups:r})})},updateConditionSet:function(t,r){var l=r.index,s=r.newRolloutPercentage,m=r.newProperties;if(!t)return t;var u=x()(t==null?void 0:t.filters.groups);return s!==void 0&&(u[l]=o(o({},u[l]),{},{rollout_percentage:s})),m!==void 0&&(u[l]=o(o({},u[l]),{},{properties:m})),o(o({},t),{},{filters:o(o({},t.filters),{},{groups:u})})},removeConditionSet:function(t,r){var l=r.index;if(!t)return t;var s=x()(t.filters.groups);return s.splice(l,1),o(o({},t),{},{filters:o(o({},t.filters),{},{groups:s})})},duplicateConditionSet:function(t,r){var l=r.index;if(!t)return t;var s=t.filters.groups.concat([t.filters.groups[l]]);return o(o({},t),{},{filters:o(o({},t.filters),{},{groups:s})})},setMultivariateOptions:function(t,r){var l=r.multivariateOptions;return t&&o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:l})})},addVariant:function(t){var r;if(!t)return t;var l=x()(((r=t.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]);return o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate||{}),{},{variants:[].concat(x()(l),[rt])})})})},updateVariant:function(t,r){var l,s=r.index,m=r.newProperties;if(!t)return t;var u=x()(((l=t.filters.multivariate)===null||l===void 0?void 0:l.variants)||[]);return u[s]?(u[s]=o(o({},u[s]),m),o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate),{},{variants:u})})})):t},removeVariant:function(t,r){var l,s=r.index;if(!t)return t;var m=x()(((l=t.filters.multivariate)===null||l===void 0?void 0:l.variants)||[]);return m.splice(s,1),o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate),{},{variants:m})})})},distributeVariantsEqually:function(t){var r;if(!t)return t;var l=x()(((r=t.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]),s=l.length;if(s>0&&s<=100){var m=Math.round(100/s),u=m*s,d=u-100;l.forEach(function(p,F){l[F]=o(o({},p),{},{rollout_percentage:m})}),l[s-1]=o(o({},l[s-1]),{},{rollout_percentage:m-d})}return o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate),{},{variants:l})})})},setAggregationGroupTypeIndex:function(t,r){var l=r.value;return!t||t.filters.aggregation_group_type_index==l?t:o(o({},t),{},{filters:o(o({},t.filters),{},{aggregation_group_type_index:l,groups:[{properties:[],rollout_percentage:null}]})})}}]},loaders:function(t){var r=t.values;return{featureFlag:{loadFeatureFlag:function(){var l=le()(R.a.mark(function m(){return R.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(r.featureFlagId&&r.featureFlagId!=="new")){d.next=4;break}return d.next=3,Ee.a.get("api/projects/".concat(r.currentTeamId,"/feature_flags/").concat(r.featureFlagId));case 3:return d.abrupt("return",d.sent);case 4:return d.abrupt("return",Re);case 5:case"end":return d.stop()}},m)}));function s(){return l.apply(this,arguments)}return s}(),saveFeatureFlag:function(){var l=le()(R.a.mark(function m(u){var d,p,F;return R.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(d=u.created_at,p=u.id,F=qe()(u,["created_at","id"]),u.id){j.next=7;break}return j.next=4,Ee.a.create("api/projects/".concat(r.currentTeamId,"/feature_flags"),F);case 4:return j.abrupt("return",j.sent);case 7:return j.next=9,Ee.a.update("api/projects/".concat(r.currentTeamId,"/feature_flags/").concat(u.id),F);case 9:return j.abrupt("return",j.sent);case 10:case"end":return j.stop()}},m)}));function s(m){return l.apply(this,arguments)}return s}()}}},listeners:function(t){var r=t.actions,l=t.values;return{saveFeatureFlagSuccess:function(m){var u,d=m.featureFlag;nt.c.success(e.a.createElement("div",null,e.a.createElement("h1",null,"Your feature flag has been saved!"),e.a.createElement("p",null,"Click here to go back to the feature flag list.")),{onClick:function(){xe.router.actions.push(he.a.featureFlags())},closeOnClick:!0}),(u=Fe.a.findMounted())===null||u===void 0||u.actions.updateFlag(d)},deleteFeatureFlag:function(){var s=le()(R.a.mark(function u(d){var p;return R.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:p=d.featureFlag,Object(K.v)({endpoint:"projects/".concat(l.currentTeamId,"/feature_flags"),object:{name:p.name,id:p.id},callback:function(){var _;p.id&&((_=Fe.a.findMounted())===null||_===void 0||_.actions.deleteFlag(p.id)),xe.router.actions.push(he.a.featureFlags())}});case 2:case"end":return P.stop()}},u)}));function m(u){return s.apply(this,arguments)}return m}(),setMultivariateEnabled:function(){var s=le()(R.a.mark(function u(d){var p;return R.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:p=d.enabled,p?r.setMultivariateOptions(lt):r.setMultivariateOptions(null);case 2:case"end":return P.stop()}},u)}));function m(u){return s.apply(this,arguments)}return m}()}},selectors:{multivariateEnabled:[function(n){return[n.featureFlag]},function(n){return!!(n!=null&&n.filters.multivariate)}],variants:[function(n){return[n.featureFlag]},function(n){var t;return(n==null||(t=n.filters.multivariate)===null||t===void 0?void 0:t.variants)||[]}],nonEmptyVariants:[function(n){return[n.variants]},function(n){return n.filter(function(t){var r=t.key;return!!r})}],variantRolloutSum:[function(n){return[n.variants]},function(n){return n.reduce(function(t,r){var l=r.rollout_percentage;return t+l},0)}],areVariantRolloutsValid:[function(n){return[n.variants,n.variantRolloutSum]},function(n,t){return n.every(function(r){var l=r.rollout_percentage;return l>=0&&l<=100})&&t===100}],aggregationTargetName:[function(n){return[n.featureFlag,n.groupTypes,n.aggregationLabel]},function(n,t,r){return n&&n.filters.aggregation_group_type_index!=null&&t.length>0?r(n.filters.aggregation_group_type_index).plural:"users"}],taxonomicGroupTypes:[function(n){return[n.featureFlag,n.groupsTaxonomicTypes]},function(n,t){return n&&n.filters.aggregation_group_type_index!=null&&t.length>0?[t[n.filters.aggregation_group_type_index]]:[De.a.PersonProperties,De.a.Cohorts]}],breadcrumbs:[function(n){return[n.featureFlag]},function(n){return[{name:"Feature Flags",path:he.a.featureFlags()}].concat(x()(n?[{name:n.key||"Unnamed"}]:[]))}]},actionToUrl:function(){return{saveFeatureFlagSuccess:function(r){var l=r.featureFlag;return["/feature_flags/".concat(l.id||"new"),{},{},{replace:!0}]}}},urlToAction:function(t){var r=t.actions,l=t.values;return{"/feature_flags/*":function(m){var u=m._;if(u&&u!==l.featureFlagId){var d,p=u==="new"?"new":parseInt(u);r.setFeatureFlagId(p);var F=(d=Fe.a.findMounted())===null||d===void 0?void 0:d.values.featureFlags.find(function(P){return P.id===p});F?r.setFeatureFlag(F):r.setFeatureFlag(Re),u!=="new"&&r.loadFeatureFlag()}}}}}),ot=a("./frontend/src/lib/components/PageHeader.tsx"),st=a("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),it=a.n(st),ut=a("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss"),Ne=a.n(ut),Oe={};Oe.insert="head",Oe.singleton=!1;var Gt=it()(Ne.a,Oe),wt=Ne.a.locals||{},z=a("./frontend/src/lib/components/icons.tsx"),oe=a("./frontend/src/lib/components/Tooltip.tsx"),H=a("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),se="?utm_medium=in-product&utm_campaign=feature-flag";function ie(n){var t=n.flagKey;return e.a.createElement(e.a.Fragment,null,"(",e.a.createElement(H.a,{language:H.b.JavaScript,wrap:!0},"if\xA0(posthog.isFeatureEnabled('".concat(t!=null?t:"",`')) {
    // run your activation code here
}`)),")",e.a.createElement("div",{className:"mt"},"Need more information?"," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/js-integration".concat(se,"#feature-flags")},"Check the docs ",e.a.createElement(z.IconOpenInNew,null))),")")}function ue(n){var t=n.flagKey;return e.a.createElement(e.a.Fragment,null,e.a.createElement(H.a,{language:H.b.Python,wrap:!0},'if\xA0posthog.feature_enabled("'.concat(t,`", "user_distinct_id"):
    runAwesomeFeature()
`)),e.a.createElement("div",{className:"mt"},"Need more information?"," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/python-integration".concat(se,"#feature-flags")},"Check the docs ",e.a.createElement(z.IconOpenInNew,null))))}function ct(){var n=Object(L.useValues)(_e.a),t=n.currentTeam;return e.a.createElement(e.a.Fragment,null,e.a.createElement(H.a,{language:H.b.Bash,wrap:!0},"curl ".concat(window.location.origin,`/decide/ \\
-X POST -H 'Content-Type: application/json' \\
-d '{
    "api_key": "`).concat(t?t.api_token:"[project_api_key]",`",
    "distinct_id": "[user distinct id]"
}'
                `)),e.a.createElement("div",{className:"mt"},"Need more information?"," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/api/feature-flags".concat(se)},"Check the docs ",e.a.createElement(z.IconOpenInNew,null))))}try{ie.displayName="JSSnippet",ie.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:ie.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(n){}try{ue.displayName="PythonSnippet",ue.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:ue.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(n){}var Ke=a("./frontend/src/lib/components/LemonRow/index.ts"),dt=a("./frontend/src/lib/introductions/GroupsIntroductionOption.tsx"),mt=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),ft=a("./frontend/src/scenes/userLogic.tsx"),Ce=a("./frontend/src/types.ts"),gt=a("./frontend/src/lib/components/Link.tsx");function Be(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),r.push.apply(r,l)}return r}function J(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Be(Object(r),!0).forEach(function(l){ae()(n,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Be(Object(r)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(r,l))})}return n}var pt={component:We,logic:je};function Ue(n){setTimeout(function(){var t;return(t=document.querySelector('.variant-form-list input[data-key-index="'.concat(n,'"]')))===null||t===void 0?void 0:t.focus()},50)}function We(){var n=y.a.useForm(),t=X()(n,1),r=t[0],l=Object(L.useValues)(je),s=l.featureFlag,m=l.featureFlagId,u=l.multivariateEnabled,d=l.variants,p=l.nonEmptyVariants,F=l.areVariantRolloutsValid,P=l.variantRolloutSum,j=l.groupTypes,_=l.aggregationTargetName,vt=l.taxonomicGroupTypes,O=Object(L.useActions)(je),yt=O.addConditionSet,Ge=O.updateConditionSet,Et=O.removeConditionSet,ht=O.duplicateConditionSet,Ft=O.saveFeatureFlag,jt=O.deleteFeatureFlag,we=O.setMultivariateEnabled,Ot=O.addVariant,be=O.updateVariant,Ct=O.removeVariant,bt=O.distributeVariantsEqually,Tt=O.setFeatureFlag,Pt=O.setAggregationGroupTypeIndex,$e=Object(L.useValues)(Le.a),St=$e.showGroupsOptions,It=$e.aggregationLabel,ze=Object(L.useValues)(ft.a),Te=ze.hasAvailableFeature,Mt=ze.upgradeLink,At=Object(A.useState)(!1),He=X()(At,2),Je=He[0],xt=He[1],_t=Object(A.useState)(!1),Ye=X()(_t,2),Lt=Ye[0],Pe=Ye[1];Object(A.useEffect)(function(){r.setFieldsValue(J({},s))},[s]);var Dt=Object(dt.a)({value:-2});return e.a.createElement("div",{className:"feature-flag"},s?e.a.createElement(y.a,{layout:"vertical",form:r,initialValues:{name:s.name,key:s.key,active:s.active},onValuesChange:function(i){m!=="new"&&i.key&&xt(i.key!==s.key),Tt(J(J({},s),i))},onFinish:function(i){return Ft(J(J(J({},s),i),{},{filters:s.filters}))},requiredMark:!1,scrollToFirstError:!0},e.a.createElement(ot.a,{title:"Feature Flag",buttons:e.a.createElement("div",{style:{display:"flex"}},e.a.createElement(y.a.Item,{className:"enabled-switch"},e.a.createElement(y.a.Item,{shouldUpdate:function(i,g){return i.active!==g.active},style:{marginBottom:0,marginRight:6}},function(c){var i=c.getFieldValue;return e.a.createElement("span",{className:"ant-form-item-label",style:{lineHeight:"1.5rem"}},i("active")?e.a.createElement("span",{className:"text-success"},"Enabled"):e.a.createElement("span",{className:"text-danger"},"Disabled"))}),e.a.createElement(y.a.Item,{name:"active",noStyle:!0,valuePropName:"checked"},e.a.createElement(ce.a,null))),m!=="new"&&e.a.createElement(I.a,{"data-attr":"delete-flag",danger:!0,icon:e.a.createElement(w.a,null),onClick:function(){jt(s)},style:{marginRight:16}},"Delete"),e.a.createElement(I.a,{icon:e.a.createElement(re.a,null),type:"primary","data-attr":"feature-flag-submit",htmlType:"submit"},"Save changes"))}),e.a.createElement("h3",{className:"l3"},"General configuration"),e.a.createElement("div",{className:"text-muted mb"},"General settings for your feature flag and integration instructions."),e.a.createElement(W.a,{gutter:16,style:{marginBottom:32}},e.a.createElement(C.a,{span:12},e.a.createElement(y.a.Item,{name:"key",label:"Key (must be unique)",rules:[{required:!0,message:"You need to set a key."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}],validateStatus:Je?"warning":void 0,help:Je?e.a.createElement("small",null,e.a.createElement("b",null,"Warning! "),"Changing this key will",e.a.createElement("a",{href:"https://posthog.com/docs/features/feature-flags".concat(se,"#feature-flag-persistence"),target:"_blank",rel:"noopener"}," ","affect the persistence of your flag ",e.a.createElement(z.IconOpenInNew,null))):void 0},e.a.createElement(G.a,{"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),e.a.createElement(y.a.Item,{name:"name",label:"Description"},e.a.createElement(G.a.TextArea,{className:"ph-ignore-input","data-attr":"feature-flag-description",placeholder:"Adding a helpful description can ensure others know what this feature is for."}))),e.a.createElement(C.a,{span:12,style:{paddingTop:31}},e.a.createElement(Q.a,null,e.a.createElement(Q.a.Panel,{header:e.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},e.a.createElement(z.IconJavascript,{style:{marginRight:6}})," Javascript integration instructions"),key:"js"},e.a.createElement(y.a.Item,{shouldUpdate:function(i,g){return i.key!==g.key}},function(c){var i=c.getFieldValue;return e.a.createElement(ie,{flagKey:i("key")})})),e.a.createElement(Q.a.Panel,{header:e.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},e.a.createElement(z.IconPython,{style:{marginRight:6}})," Python integration instructions"),key:"python"},e.a.createElement(y.a.Item,{shouldUpdate:function(i,g){return i.key!==g.key}},function(c){var i=c.getFieldValue;return e.a.createElement(ue,{flagKey:i("key")})})),e.a.createElement(Q.a.Panel,{header:e.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},e.a.createElement(E,{style:{marginRight:6}})," API integration instructions"),key:"api"},e.a.createElement(y.a.Item,{shouldUpdate:function(i,g){return i.key!==g.key}},e.a.createElement(ct,null)))))),e.a.createElement("div",{className:"mb-2"},e.a.createElement("h3",{className:"l3"},"Served value"),e.a.createElement("div",{className:"mb-05"},e.a.createElement(de.a,{placement:"top",title:"Change value type? The variants below will be lost.",visible:Lt,onConfirm:function(){we(!1),Pe(!1)},onCancel:function(){return Pe(!1)},okText:"OK",cancelText:"Cancel"},e.a.createElement(ne.a.Group,{options:[{label:"Boolean value (A/B test)",value:!1},{label:e.a.createElement(oe.a,{title:Te(Ce.c.MULTIVARIATE_FLAGS)?"":"This feature is not available on your current plan."},e.a.createElement("div",null,!Te(Ce.c.MULTIVARIATE_FLAGS)&&e.a.createElement(gt.a,{to:Mt,target:"_blank"},e.a.createElement(h.a,{style:{marginRight:4,color:"var(--warning)"}})),"String value (Multivariate test)"," ",e.a.createElement(mt.a,{type:"warning"},"Beta"))),value:!0,disabled:!Te(Ce.c.MULTIVARIATE_FLAGS)}],onChange:function(i){var g=i.target.value;g===!1&&p.length?Pe(!0):(we(g),Ue(0))},value:u,optionType:"button"}))),e.a.createElement("div",{className:"text-muted mb"},Object(K.j)(_)," will be served"," ",u?e.a.createElement(e.a.Fragment,null,e.a.createElement("strong",null,"a variant key")," according to the below distribution"):e.a.createElement("strong",null,e.a.createElement("code",null,"true"))," ","if they match one or more release condition groups."),u&&e.a.createElement("div",{className:"variant-form-list"},e.a.createElement(W.a,{gutter:8,className:"label-row"},e.a.createElement(C.a,{span:7},"Variant key"),e.a.createElement(C.a,{span:7},"Description"),e.a.createElement(C.a,{span:9},e.a.createElement("span",null,"Rollout percentage"),e.a.createElement(I.a,{type:"link",onClick:bt,icon:e.a.createElement(k,null),style:{padding:"0 0 0 0.5em"},title:"Distribute variants equally"},"Distribute"))),d.map(function(c,i){var g=c.rollout_percentage;return e.a.createElement(y.a,{key:i,onValuesChange:function(S){return be(i,S)},initialValues:d[i],validateTrigger:["onChange","onBlur"]},e.a.createElement(W.a,{gutter:8},e.a.createElement(C.a,{span:7},e.a.createElement(y.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}]},e.a.createElement(G.a,{"data-attr":"feature-flag-variant-key","data-key-index":i.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(i+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}))),e.a.createElement(C.a,{span:7},e.a.createElement(y.a.Item,{name:"name"},e.a.createElement(G.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"}))),e.a.createElement(C.a,{span:7},e.a.createElement(me.a,{tooltipPlacement:"top",value:g,onChange:function(S){return be(i,{rollout_percentage:S})}})),e.a.createElement(C.a,{span:2},e.a.createElement(N.a,{min:0,max:100,value:g,onChange:function(S){if(S!=null){var Y=parseInt(S.toString());isNaN(Y)||be(i,{rollout_percentage:Y})}},style:{width:"100%",borderColor:F?void 0:"var(--danger)"}})),d.length>1&&e.a.createElement(C.a,{span:1},e.a.createElement(oe.a,{title:"Delete this variant",placement:"bottomLeft"},e.a.createElement(I.a,{type:"link",icon:e.a.createElement(w.a,null),onClick:function(){return Ct(i)},style:{color:"var(--danger)"}})))))}),d.length>0&&!F&&e.a.createElement("p",{className:"text-danger"},"Percentage rollouts for variants must sum to 100 (currently ",P,")."),e.a.createElement(I.a,{type:"dashed",block:!0,icon:e.a.createElement(T.a,null),onClick:function(){var i=d.length;Ot(),Ue(i)},style:{marginBottom:16}},"Add Variant"))),e.a.createElement("div",{className:"feature-flag-form-row"},e.a.createElement("div",null,e.a.createElement("h3",{className:"l3"},"Release conditions"),e.a.createElement("div",{className:"text-muted mb"},"Specify the ",_," to which you want to release this flag. Note that condition sets are rolled out independently of each other.")),St&&e.a.createElement("div",{className:"centered"},"Match by",e.a.createElement(Z.a,{value:s.filters.aggregation_group_type_index!=null?s.filters.aggregation_group_type_index:-1,onChange:function(i){var g=i!==-1?i:null;Pt(g)},style:{marginLeft:8},"data-attr":"feature-flag-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]}},e.a.createElement(Z.a.Option,{key:-1,value:-1},"Users"),j.map(function(c){return e.a.createElement(Z.a.Option,{key:c.group_type_index,value:c.group_type_index},Object(K.j)(It(c.group_type_index).plural))}),Dt))),e.a.createElement(W.a,{gutter:16},s.filters.groups.map(function(c,i){var g,U;return e.a.createElement(C.a,{span:24,md:24,key:"".concat(i,"-").concat(s.filters.groups.length)},i>0&&e.a.createElement("div",{style:{display:"flex",marginLeft:16}},e.a.createElement("div",{className:"stateful-badge or-light-grey mb"},"OR")),e.a.createElement(fe.a,{style:{marginBottom:16}},e.a.createElement("div",{className:"feature-flag-form-row",style:{height:24}},e.a.createElement("div",null,e.a.createElement("span",{className:"simple-tag tag-light-blue",style:{marginRight:8}},"Set ",i+1),!((g=c.properties)===null||g===void 0)&&g.length?e.a.createElement(e.a.Fragment,null,"Matching ",e.a.createElement("b",null,_)," with filters"):e.a.createElement(e.a.Fragment,null,"Condition set will match ",e.a.createElement("b",null,"all ",_))),e.a.createElement("div",null,e.a.createElement(oe.a,{title:"Duplicate this condition set",placement:"bottomLeft"},e.a.createElement(I.a,{type:"link",icon:e.a.createElement(q.a,null),style:{width:24,height:24},onClick:function(){return ht(i)}})),s.filters.groups.length>1&&e.a.createElement(oe.a,{title:"Delete this condition set",placement:"bottomLeft"},e.a.createElement(I.a,{type:"link",icon:e.a.createElement(w.a,null),style:{width:24,height:24},onClick:function(){return Et(i)}})))),e.a.createElement(Ke.b,{large:!0}),e.a.createElement(ge.a,{style:{marginLeft:15},pageKey:"feature-flag-".concat(s.id,"-").concat(i,"-").concat(s.filters.groups.length,"-").concat((U=s.filters.aggregation_group_type_index)!==null&&U!==void 0?U:""),propertyFilters:c==null?void 0:c.properties,onChange:function(Y){return Ge(i,void 0,Y)},taxonomicGroupTypes:vt,showConditionBadge:!0}),e.a.createElement(Ke.b,{large:!0}),e.a.createElement("div",{className:"feature-flag-form-row"},e.a.createElement("div",{className:"centered"},"Roll out to"," ",e.a.createElement(N.a,{style:{width:100,marginLeft:8,marginRight:8},onChange:function(Y){Ge(i,Y)},value:c.rollout_percentage!=null?c.rollout_percentage:100,min:0,max:100,addonAfter:"%"})," ","of ",e.a.createElement("b",null,_)," in this set"))))})),e.a.createElement(fe.a,{size:"small",style:{marginBottom:16}},e.a.createElement(I.a,{type:"link",onClick:yt,style:{marginLeft:5}},e.a.createElement(T.a,{style:{marginRight:15}})," Add condition set")),e.a.createElement(y.a.Item,{className:"text-right"},e.a.createElement(I.a,{icon:e.a.createElement(re.a,null),htmlType:"submit",type:"primary","data-attr":"feature-flag-submit-bottom"},"Save changes"))):e.a.createElement(K.c,null))}},"./frontend/src/scenes/feature-flags/featureFlagsLogic.ts":function(ee,M,a){"use strict";a.d(M,"a",function(){return ve});var te=a("./node_modules/core-js/modules/es.array.concat.js"),Xe=a.n(te),Se=a("./node_modules/core-js/modules/es.array.filter.js"),Qe=a.n(Se),Ie=a("./node_modules/core-js/modules/es.array.find.js"),Me=a.n(Ie),ae=a("./node_modules/core-js/modules/es.array.iterator.js"),Ae=a.n(ae),X=a("./node_modules/core-js/modules/es.array.map.js"),A=a.n(X),e=a("./node_modules/core-js/modules/es.object.to-string.js"),y=a.n(e),ce=a("./node_modules/core-js/modules/es.regexp.exec.js"),I=a.n(ce),W=a("./node_modules/core-js/modules/es.string.search.js"),C=a.n(W),G=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Q=a.n(G),de=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ne=a.n(de),me=a("./node_modules/@babel/runtime/regenerator/index.js"),N=a.n(me),Z=a("./node_modules/regenerator-runtime/runtime.js"),fe=a.n(Z),L=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),K=a.n(L),ge=a("./node_modules/kea/lib/index.esm.js"),w=a("./frontend/src/lib/api.ts"),re=a("./node_modules/fuse.js/dist/fuse.esm.js"),$=a("./frontend/src/scenes/teamLogic.tsx"),pe=a("./frontend/src/scenes/urls.ts"),ve=Object(ge.kea)({path:["scenes","feature-flags","featureFlagsLogic"],connect:{values:[$.a,["currentTeamId"]]},actions:{updateFlag:function(f){return{flag:f}},deleteFlag:function(f){return{id:f}},setSearchTerm:function(f){return{searchTerm:f}}},loaders:function(f){var E=f.values;return{featureFlags:{__default:[],loadFeatureFlags:function(){var h=K()(N.a.mark(function D(){var V;return N.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,w.a.get("api/projects/".concat(E.currentTeamId,"/feature_flags/"));case 2:return V=T.sent,T.abrupt("return",V.results);case 4:case"end":return T.stop()}},D)}));function b(){return h.apply(this,arguments)}return b}(),updateFeatureFlag:function(){var h=K()(N.a.mark(function D(V){var k,T,q;return N.a.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return k=V.id,T=V.payload,B.next=3,w.a.update("api/projects/".concat(E.currentTeamId,"/feature_flags/").concat(k),T);case 3:return q=B.sent,B.abrupt("return",ne()(E.featureFlags).map(function(ye){return ye.id===q.id?q:ye}));case 5:case"end":return B.stop()}},D)}));function b(D){return h.apply(this,arguments)}return b}()}}},selectors:{searchedFeatureFlags:[function(v){return[v.featureFlags,v.searchTerm]},function(v,f){return f?new re.a(v,{keys:["key","name"],threshold:.3}).search(f).map(function(E){return E.item}):v}],breadcrumbs:[function(){return[]},function(){return[{name:"Feature Flags",path:pe.a.featureFlags()}]}]},reducers:{searchTerm:{setSearchTerm:function(f,E){var h=E.searchTerm;return h}},featureFlags:{updateFlag:function(f,E){var h=E.flag;return f.find(function(b){var D=b.id;return D===h.id})?f.map(function(b){return b.id===h.id?h:b}):[h].concat(ne()(f))},deleteFlag:function(f,E){var h=E.id;return f.filter(function(b){return b.id!==h})}}},events:function(f){var E=f.actions;return{afterMount:function(){E.loadFeatureFlags()}}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss":function(ee,M,a){var te=a("./node_modules/css-loader/dist/runtime/api.js");M=te(!1),M.push([ee.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.feature-flag .enabled-switch{margin-right:1rem!important}.feature-flag .enabled-switch .ant-form-item-control-input-content{flex-direction:row;align-items:center;display:flex}.feature-flag .enabled-switch .ant-form-item-label{padding:0 4px 0 0}.variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{margin-bottom:4px;font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}.feature-flag-form-row{display:flex;justify-content:space-between;align-items:center;width:100%}.feature-flag-form-row .centered{display:flex;align-items:center;white-space:pre-wrap}",""]),ee.exports=M}}]);
