(window.webpackJsonp=window.webpackJsonp||[]).push([[252],{4749:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"DeadLetterQueue",(function(){return DeadLetterQueue}));var DeadLetterQueueTab,react=__webpack_require__(0),react_default=__webpack_require__.n(react),PageHeader=__webpack_require__(209),tabs=__webpack_require__(573),index_esm=__webpack_require__(1),regenerator=(__webpack_require__(64),__webpack_require__(48),__webpack_require__(42),__webpack_require__(51),__webpack_require__(8)),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(70),__webpack_require__(13)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),api=__webpack_require__(22),userLogic=__webpack_require__(66);!function(DeadLetterQueueTab){DeadLetterQueueTab.Metrics="metrics",DeadLetterQueueTab.Management="management",DeadLetterQueueTab.Settings="settings"}(DeadLetterQueueTab||(DeadLetterQueueTab={}));var deadLetterQueueLogic=Object(index_esm.kea)({path:["scenes","instance","DeadLetterQueue","deadLetterQueueLogic"],actions:function actions(){return{setActiveTab:function setActiveTab(tabKey){return{tabKey:tabKey}}}},reducers:function reducers(){return{activeTab:[DeadLetterQueueTab.Metrics,{setActiveTab:function setActiveTab(_,_ref){return _ref.tabKey}}]}},loaders:function loaders(){return{deadLetterQueueMetrics:[[],{loadDeadLetterQueueMetrics:(_loadDeadLetterQueueMetrics=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var _userLogic$values$use,_yield$api$get$result;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(null===(_userLogic$values$use=userLogic.a.values.user)||void 0===_userLogic$values$use?void 0:_userLogic$values$use.is_staff){_context.next=2;break}return _context.abrupt("return",[]);case 2:return _context.next=4,api.a.get("api/dead_letter_queue");case 4:if(_context.t1=_yield$api$get$result=_context.sent.results,_context.t0=null===_context.t1,_context.t0){_context.next=8;break}_context.t0=void 0===_yield$api$get$result;case 8:if(!_context.t0){_context.next=12;break}_context.t2=void 0,_context.next=13;break;case 12:_context.t2=_yield$api$get$result.overview;case 13:return _context.abrupt("return",_context.t2);case 14:case"end":return _context.stop()}}),_callee)}))),function loadDeadLetterQueueMetrics(){return _loadDeadLetterQueueMetrics.apply(this,arguments)})}]};var _loadDeadLetterQueueMetrics},selectors:function selectors(){return{singleValueMetrics:[function(s){return[s.deadLetterQueueMetrics]},function(deadLetterQueueMetrics){return deadLetterQueueMetrics.filter((function(metric){return!metric.subrows}))}],tableMetrics:[function(s){return[s.deadLetterQueueMetrics]},function(deadLetterQueueMetrics){return deadLetterQueueMetrics.filter((function(metric){return!!metric.subrows}))}]}},events:function events(_ref2){var actions=_ref2.actions;return{afterMount:function afterMount(){actions.loadDeadLetterQueueMetrics()}}}}),slicedToArray=(__webpack_require__(36),__webpack_require__(12)),slicedToArray_default=__webpack_require__.n(slicedToArray),es_row=__webpack_require__(261),col=__webpack_require__(242),statistic=__webpack_require__(4285),divider=__webpack_require__(4242),LemonTable=__webpack_require__(243),LemonButton=__webpack_require__(58),Spinner=__webpack_require__(187),icons=__webpack_require__(26);function MetricsTab(){var user=Object(index_esm.useValues)(userLogic.a).user,_useValues2=Object(index_esm.useValues)(deadLetterQueueLogic),singleValueMetrics=_useValues2.singleValueMetrics,tableMetrics=_useValues2.tableMetrics,deadLetterQueueMetricsLoading=_useValues2.deadLetterQueueMetricsLoading,loadDeadLetterQueueMetrics=Object(index_esm.useActions)(deadLetterQueueLogic).loadDeadLetterQueueMetrics;return(null==user?void 0:user.is_staff)?react_default.a.createElement("div",null,react_default.a.createElement("br",null),react_default.a.createElement("div",{className:"mb float-right"},react_default.a.createElement(LemonButton.a,{icon:deadLetterQueueMetricsLoading?react_default.a.createElement(Spinner.a,{size:"sm"}):react_default.a.createElement(icons.IconRefresh,null),onClick:loadDeadLetterQueueMetrics,type:"secondary",compact:!0},"Refresh")),react_default.a.createElement(es_row.a,{gutter:32},singleValueMetrics.map((function(row){return react_default.a.createElement(col.a,{key:row.key},react_default.a.createElement(statistic.a,{title:row.metric,value:(row.value||"0").toLocaleString("en-US"),loading:deadLetterQueueMetricsLoading}))}))),react_default.a.createElement(divider.a,null),tableMetrics.map((function(row){var _row$subrows,_row$subrows2,_row$subrows3;return react_default.a.createElement("div",{key:row.key},react_default.a.createElement("h2",null,row.metric),react_default.a.createElement(LemonTable.a,{columns:[{title:null===(_row$subrows=row.subrows)||void 0===_row$subrows?void 0:_row$subrows.columns[0],dataIndex:"key"},{title:null===(_row$subrows2=row.subrows)||void 0===_row$subrows2?void 0:_row$subrows2.columns[1],dataIndex:"value"}],dataSource:(null===(_row$subrows3=row.subrows)||void 0===_row$subrows3?void 0:_row$subrows3.rows.map((function(_ref){var _ref2=slicedToArray_default()(_ref,2);return{key:_ref2[0],value:_ref2[1]}})))||[],loading:deadLetterQueueMetricsLoading,defaultSorting:{columnKey:"value",order:-1},embedded:!0}),react_default.a.createElement(divider.a,null))}))):react_default.a.createElement(react_default.a.Fragment,null)}var scene={component:DeadLetterQueue,logic:deadLetterQueueLogic},TabPane=tabs.a.TabPane;function DeadLetterQueue(){var user=Object(index_esm.useValues)(userLogic.a).user,activeTab=Object(index_esm.useValues)(deadLetterQueueLogic).activeTab,setActiveTab=Object(index_esm.useActions)(deadLetterQueueLogic).setActiveTab;return(null==user?void 0:user.is_staff)?react_default.a.createElement("div",null,react_default.a.createElement(PageHeader.a,{title:"Dead Letter Queue",caption:react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("p",null,"Manage your instance's dead letter queue."))}),react_default.a.createElement(tabs.a,{activeKey:activeTab,onChange:function onChange(key){return setActiveTab(key)}},react_default.a.createElement(TabPane,{tab:"Metrics",key:DeadLetterQueueTab.Metrics})),activeTab===DeadLetterQueueTab.Metrics?react_default.a.createElement(MetricsTab,null):null):react_default.a.createElement(PageHeader.a,{title:"Dead Letter Queue",caption:react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("p",null,"Only users with staff access can manage the dead letter queue. Please contact your instance admin."),react_default.a.createElement("p",null,"If you're an admin and don't have access, set ",react_default.a.createElement("code",null,"is_staff=true")," for your user on the PostgreSQL ",react_default.a.createElement("code",null,"posthog_user")," table."))})}}}]);