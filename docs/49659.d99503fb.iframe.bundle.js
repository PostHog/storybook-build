"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[49659],{"../../frontend/src/scenes/audit-logs/AdvancedActivityLogsList.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{d:()=>AdvancedActivityLogsList});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),activityLogLogic=__webpack_require__("../../frontend/src/lib/components/ActivityLog/activityLogLogic.tsx"),humanizeActivity=__webpack_require__("../../frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),PaginationControl=__webpack_require__("../../frontend/src/lib/lemon-ui/PaginationControl/index.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),MonacoDiffEditor=__webpack_require__("../../frontend/src/lib/components/MonacoDiffEditor.tsx"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),ProfilePicture=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AuditLogTableHeader(){return(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-12 gap-4 py-3 px-4 bg-accent-3000 border-b border-border font-semibold text-sm text-muted-alt",children:[(0,jsx_runtime.jsx)("div",{className:"col-span-4",children:"Description"}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:"User"}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:"Action"}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:"Scope"}),(0,jsx_runtime.jsx)("div",{className:"col-span-1",children:"Timestamp"}),(0,jsx_runtime.jsx)("div",{className:"col-span-1"})]})}function AuditLogTableRow(_ref){var _logItem$email;let{logItem}=_ref,[expanded,setExpanded]=(0,react.useState)(!1),unprocessed=logItem.unprocessed;return(0,jsx_runtime.jsxs)("div",{className:"border-b border-border last:border-b-0",children:[(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-12 gap-4 py-3 px-4 hover:bg-accent-3000 items-center text-sm cursor-pointer",onClick:()=>setExpanded(!expanded),"data-attr":"audit-log-row",children:[(0,jsx_runtime.jsx)("div",{className:"col-span-4",children:(0,jsx_runtime.jsx)("div",{className:"truncate",children:"string"==typeof logItem.description?logItem.description:logItem.description||"No description"})}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:(0,jsx_runtime.jsx)(ProfilePicture.Y,{showName:!0,user:{first_name:logItem.isSystem?"PostHog":logItem.name,email:null!==(_logItem$email=logItem.email)&&void 0!==_logItem$email?_logItem$email:void 0},type:logItem.isSystem?"system":"person",size:"md"})}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:(0,jsx_runtime.jsx)("span",{className:"font-medium capitalize",children:unprocessed?.activity||"Unknown"})}),(0,jsx_runtime.jsx)("div",{className:"col-span-2",children:(0,jsx_runtime.jsx)("span",{className:"inline-block px-2 py-1 bg-accent-3000 rounded text-xs font-medium",children:unprocessed?.scope?(0,humanizeActivity.VI)(unprocessed.scope,!0):"Unknown"})}),(0,jsx_runtime.jsx)("div",{className:"col-span-1 text-muted text-xs",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:logItem.created_at})}),(0,jsx_runtime.jsx)("div",{className:"col-span-1 flex justify-end",children:(0,jsx_runtime.jsx)("button",{className:"text-muted-alt hover:text-default p-1 rounded hover:bg-accent-3000",onClick:e=>{e.stopPropagation(),setExpanded(!expanded)},"aria-label":expanded?"Collapse row":"Expand row","data-attr":"audit-log-expand-button",children:expanded?(0,jsx_runtime.jsx)(posthog_icons_es.IconCollapse,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand,{})})})]}),expanded&&(0,jsx_runtime.jsx)("div",{className:"bg-surface-secondary border-t border-border",children:(0,jsx_runtime.jsx)("div",{className:"px-6 py-4",children:unprocessed&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mb-6",children:(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-medium text-muted-alt uppercase tracking-wider mb-1",children:"Description"}),(0,jsx_runtime.jsx)("div",{className:"text-sm  text-default",children:logItem.description})]}),logItem.extendedDescription&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-medium text-muted-alt uppercase tracking-wider mb-1",children:"Extended Description"}),(0,jsx_runtime.jsx)("div",{className:"text-sm  text-default",children:logItem.extendedDescription})]}),unprocessed.item_id&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-xs font-medium text-muted-alt uppercase tracking-wider mb-1",children:"Item ID"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-default",children:unprocessed.item_id})]})]})})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(ActivityDetailsSection,{logItem:logItem})})]})})})]})}let ActivityDetailsSection=_ref2=>{let{logItem}=_ref2,[activeTab,setActiveTab]=(0,react.useState)("diff");return(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:key=>setActiveTab(key),"data-attr":"audit-log-details-tabs",tabs:[!!logItem.extendedDescription&&{key:"extended description",label:"Extended Description",tooltip:"Some activities have a more detailed description that is not shown when collapsed.",content:(0,jsx_runtime.jsx)("div",{children:logItem.extendedDescription})},{key:"diff",label:"Diff",tooltip:"Show the diff of the changes made to the item. Each activity item could have more than one change.",content:(0,jsx_runtime.jsx)(ActivityLogDiff,{logItem:logItem})},{key:"raw",label:"Raw",tooltip:"Show the raw data of the activity item.",content:(0,jsx_runtime.jsx)("div",{className:"bg-surface-primary p-2 rounded border border-border text-sm",children:(0,jsx_runtime.jsx)("pre",{children:JSON.stringify(logItem.unprocessed,null,2)})})}]})},ActivityLogDiff=_ref3=>{let{logItem}=_ref3,changes=logItem.unprocessed?.detail.changes;return(0,jsx_runtime.jsx)("div",{className:"flex flex-col space-y-2 px-2 py-1",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col space-y-2",children:changes?.length?changes.map((change,i)=>(0,jsx_runtime.jsx)(JsonDiffViewer,{field:change.field||"",before:change.before,after:change.after},i)):(0,jsx_runtime.jsx)("div",{className:"text-muted",children:"This item has no changes to compare"})})})},JsonDiffViewer=_ref4=>{let{field,before,after}=_ref4,beforeStr=JSON.stringify(before,null,2),afterStr=JSON.stringify(after,null,2);return beforeStr===afterStr?(0,jsx_runtime.jsxs)("div",{className:"border rounded p-2 bg-surface-primary",children:[(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm mb-1",children:field}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs",children:"No changes detected"})]}):(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary",children:[(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm p-2",children:field}),(0,jsx_runtime.jsx)(MonacoDiffEditor.Z,{original:beforeStr,value:afterStr,modified:afterStr,language:"json",options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,renderSideBySide:!0,hideUnchangedRegions:{enabled:!0,contextLineCount:3,minimumLineCount:3,revealLineCount:20},diffAlgorithm:"advanced"}})]})};var advancedActivityLogsLogic=__webpack_require__("../../frontend/src/scenes/audit-logs/advancedActivityLogsLogic.tsx");function AdvancedActivityLogsList(){let{advancedActivityLogs,advancedActivityLogsLoading,pagination}=(0,index_esm.useValues)(advancedActivityLogsLogic.o),humanizedLogs=advancedActivityLogs?.results?(0,humanizeActivity.OI)(advancedActivityLogs.results,activityLogLogic.L_):[],paginationState=(0,PaginationControl.h)(humanizedLogs,pagination);return advancedActivityLogsLoading?(0,jsx_runtime.jsx)(AdvancedActivityLogsListSkeleton,{}):humanizedLogs.length?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"border border-border rounded-md bg-bg-light overflow-hidden",children:[(0,jsx_runtime.jsx)(AuditLogTableHeader,{}),(0,jsx_runtime.jsx)("div",{className:"divide-y divide-border",children:humanizedLogs.map((logItem,index)=>(0,jsx_runtime.jsx)(AuditLogTableRow,{logItem:logItem},index))})]}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center mt-6",children:(0,jsx_runtime.jsx)(PaginationControl.R,{...paginationState,"data-attr":"audit-logs-pagination"})})]}):(0,jsx_runtime.jsx)(AdvancedActivityLogsEmptyState,{})}let AdvancedActivityLogsListSkeleton=()=>(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{})]}),AdvancedActivityLogsEmptyState=()=>(0,jsx_runtime.jsxs)("div",{className:"text-center py-12",children:[(0,jsx_runtime.jsx)("div",{className:"text-muted text-lg mb-2",children:"No activity logs found"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted",children:"Try adjusting your filters or date range to see more results."})]})},"../../frontend/src/scenes/audit-logs/AdvancedActivityLogsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AdvancedActivityLogsScene:()=>AdvancedActivityLogsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let AdvancedFiltersTab=()=>(0,jsx_runtime.jsx)("div",{className:"pt-4",children:(0,jsx_runtime.jsxs)("div",{className:"text-center py-8 text-muted",children:[(0,jsx_runtime.jsx)("p",{children:"Advanced filters coming soon."}),(0,jsx_runtime.jsx)("p",{className:"text-xs",children:"Dynamic filtering by activity detail fields - placeholder."})]})});var humanizeActivity=__webpack_require__("../../frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),advancedActivityLogsLogic=__webpack_require__("../../frontend/src/scenes/audit-logs/advancedActivityLogsLogic.tsx");let BasicFiltersTab=()=>{let{filters,availableFilters}=(0,index_esm.useValues)(advancedActivityLogsLogic.o),{setFilters}=(0,index_esm.useActions)(advancedActivityLogsLogic.o);return(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pt-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Date Range"}),(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:filters.start_date,dateTo:filters.end_date,onChange:(start_date,end_date)=>{setFilters({start_date:start_date||void 0,end_date:end_date||void 0})},placeholder:"All time","data-attr":"audit-logs-date-filter"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"User"}),(0,jsx_runtime.jsx)(src.Yv,{value:filters.users?.[0]||null,onChange:user=>setFilters({users:user?[user]:[]}),options:availableFilters?.static_filters?.users?.map(u=>({label:u.label,value:u.value}))||[],placeholder:"All users",allowClear:!0,"data-attr":"audit-logs-user-filter"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Scope"}),(0,jsx_runtime.jsx)(src.Yv,{value:filters.scopes?.[0]||null,onChange:scope=>setFilters({scopes:scope?[scope]:[]}),options:availableFilters?.static_filters?.scopes?.map(s=>({label:humanizeActivity.VI(s.value,!0),value:s.value}))||[],placeholder:"All scopes",allowClear:!0,"data-attr":"audit-logs-scope-filter"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Action"}),(0,jsx_runtime.jsx)(src.Yv,{value:filters.activities?.[0]||null,onChange:activity=>setFilters({activities:activity?[activity]:[]}),options:availableFilters?.static_filters?.activities?.map(a=>({label:humanizeActivity.J$(a.value),value:a.value}))||[],placeholder:"All actions",allowClear:!0,"data-attr":"audit-logs-action-filter"})]})]})};function AdvancedActivityLogFiltersPanel(){let{hasActiveFilters,exportsLoading}=(0,index_esm.useValues)(advancedActivityLogsLogic.o),{clearAllFilters,exportLogs}=(0,index_esm.useActions)(advancedActivityLogsLogic.o),[activeTab,setActiveTab]=(0,react.useState)("basic");return(0,jsx_runtime.jsxs)("div",{className:"border rounded-lg p-4 bg-bg-light",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold",children:"Filters"}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Qw,{overlay:(0,jsx_runtime.jsxs)("div",{className:"space-y-1 p-1",children:[(0,jsx_runtime.jsx)(src.Jp,{size:"small",fullWidth:!0,onClick:()=>exportLogs("csv"),loading:exportsLoading,"data-attr":"audit-logs-export-csv",children:"Export as CSV"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",fullWidth:!0,onClick:()=>exportLogs("xlsx"),loading:exportsLoading,"data-attr":"audit-logs-export-xlsx",children:"Export as Excel"})]}),placement:"bottom-end","data-attr":"audit-logs-export-dropdown",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),"data-attr":"audit-logs-export-button",children:"Export"})}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",disabledReason:hasActiveFilters?void 0:"No active filters",onClick:clearAllFilters,"data-attr":"audit-logs-clear-filters",children:"Clear all"})]})]}),(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:setActiveTab,"data-attr":"audit-logs-filter-tabs",tabs:[{key:"basic",label:"Basic filters",content:(0,jsx_runtime.jsx)(BasicFiltersTab,{})},{key:"advanced",label:"Advanced",content:(0,jsx_runtime.jsx)(AdvancedFiltersTab,{})},{key:"hogql",label:"HogQL",content:(0,jsx_runtime.jsx)(HogQLFilterTab,{})}]})]})}let HogQLFilterTab=()=>(0,jsx_runtime.jsx)("div",{className:"pt-4",children:(0,jsx_runtime.jsx)("div",{children:"HogQL filter placeholder"})});var AdvancedActivityLogsList=__webpack_require__("../../frontend/src/scenes/audit-logs/AdvancedActivityLogsList.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx");let getStatusTag=exportAsset=>exportAsset.exception?(0,jsx_runtime.jsx)(src.oe,{type:"danger",children:"Failed"}):exportAsset.has_content?(0,jsx_runtime.jsx)(src.oe,{type:"success",children:"Completed"}):(0,jsx_runtime.jsx)(src.oe,{type:"default",children:"Processing"}),getHumanReadableFormat=format=>{let lowerFormat=format.toLowerCase();return["csv","text/csv"].some(matcher=>lowerFormat.includes(matcher))?"CSV":["xlsx","excel","spreadsheet"].some(matcher=>lowerFormat.includes(matcher))?"Excel":format.toUpperCase()},getFilterSummary=exportAsset=>{let filters=exportAsset.export_context?.filters;if(!filters)return"No filters";let activeFilters=[];return(filters.start_date||filters.end_date)&&(filters.start_date&&filters.end_date?activeFilters.push(`Date: ${filters.start_date} to ${filters.end_date}`):filters.start_date?activeFilters.push(`From: ${filters.start_date}`):filters.end_date&&activeFilters.push(`Until: ${filters.end_date}`)),filters.users&&filters.users.length>0&&activeFilters.push(`Users: ${filters.users.length}`),filters.scopes&&filters.scopes.length>0&&activeFilters.push(`Scopes: ${filters.scopes.length}`),filters.activities&&filters.activities.length>0&&activeFilters.push(`Activities: ${filters.activities.length}`),activeFilters.length>0?activeFilters.join(", "):"No filters"},getFilterTooltip=exportAsset=>{let filters=exportAsset.export_context?.filters;if(!filters)return(0,jsx_runtime.jsx)("div",{children:"No filters applied"});let filterSections=[];return((filters.start_date||filters.end_date)&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("strong",{children:"Date Range:"}),(0,jsx_runtime.jsx)("br",{}),filters.start_date&&`From: ${filters.start_date}`,filters.start_date&&filters.end_date&&(0,jsx_runtime.jsx)("br",{}),filters.end_date&&`To: ${filters.end_date}`]},"dates")),filters.users&&filters.users.length>0&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("strong",{children:["Users (",filters.users.length,"):"]}),(0,jsx_runtime.jsx)("br",{}),filters.users.slice(0,5).join(", "),filters.users.length>5&&`... and ${filters.users.length-5} more`]},"users")),filters.scopes&&filters.scopes.length>0&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("strong",{children:["Scopes (",filters.scopes.length,"):"]}),(0,jsx_runtime.jsx)("br",{}),filters.scopes.slice(0,5).join(", "),filters.scopes.length>5&&`... and ${filters.scopes.length-5} more`]},"scopes")),filters.activities&&filters.activities.length>0&&filterSections.push((0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("strong",{children:["Activities (",filters.activities.length,"):"]}),(0,jsx_runtime.jsx)("br",{}),filters.activities.slice(0,5).join(", "),filters.activities.length>5&&`... and ${filters.activities.length-5} more`]},"activities")),0===filterSections.length)?(0,jsx_runtime.jsx)("div",{children:"No filters applied"}):(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:filterSections.map((section,index)=>(0,jsx_runtime.jsx)("div",{children:section},index))})},downloadExport=exportAsset=>{let link=document.createElement("a");link.href=`/api/environments/@current/exports/${exportAsset.id}/content/?download=true`,link.download=exportAsset.filename||"",document.body.appendChild(link),link.click(),document.body.removeChild(link)};function ExportsList(){let{exports,exportsLoading}=(0,index_esm.useValues)(advancedActivityLogsLogic.o),columns=[{title:"Filename",dataIndex:"filename",key:"filename",render:filename=>filename?String(filename):"export"},{title:"Format",dataIndex:"export_format",key:"export_format",render:format=>format?getHumanReadableFormat(String(format)):""},{title:"Filters",key:"filters",render:(_,exportAsset)=>(0,jsx_runtime.jsx)(src.u,{title:getFilterTooltip(exportAsset),children:(0,jsx_runtime.jsx)("span",{className:"text-muted text-xs cursor-help",children:getFilterSummary(exportAsset)})})},{title:"Status",key:"status",render:(_,exportAsset)=>getStatusTag(exportAsset)},{title:"Created",dataIndex:"created_at",key:"created_at",render:createdAt=>createdAt?(0,utils.bo)(String(createdAt)):""},{title:"Actions",key:"actions",render:(_,exportAsset)=>{let failedReason=exportAsset.exception&&"Failed to export",disabledReason=!exportAsset.has_content&&"Export is not ready";return(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),disabledReason:failedReason||disabledReason,onClick:()=>downloadExport(exportAsset),"data-attr":`audit-logs-download-export-${exportAsset.id}`,children:"Download"})}}];return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold",children:"Your exports"}),(0,jsx_runtime.jsx)("p",{className:"text-muted text-xs",children:"Refreshed every 5 seconds"})]}),(0,jsx_runtime.jsx)(src.g3,{dataSource:exports||[],columns:columns,loading:exportsLoading,rowKey:"id",emptyState:"No exports found"})]})}let scene={component:AdvancedActivityLogsScene,logic:advancedActivityLogsLogic.o};function AdvancedActivityLogsScene(){let{isFeatureFlagEnabled,exports,activeTab}=(0,index_esm.useValues)(advancedActivityLogsLogic.o),{setActiveTab}=(0,index_esm.useActions)(advancedActivityLogsLogic.o);if(!isFeatureFlagEnabled)return window.location.href=urls.j.projectHomepage(),null;let hasExports=exports&&exports.length>0,tabs=[{key:"logs",label:"Activity logs",content:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(AdvancedActivityLogFiltersPanel,{}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(AdvancedActivityLogsList.d,{})]})},...hasExports?[{key:"exports",label:"Exports",content:(0,jsx_runtime.jsx)(ExportsList,{})}]:[]];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Track all changes and activities in your organization"}),(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:key=>setActiveTab(key),tabs:tabs})]})}},"../../frontend/src/scenes/audit-logs/advancedActivityLogsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{o:()=>advancedActivityLogsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_constants__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/constants.tsx"),lib_lemon_ui_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/utils.tsx");let DEFAULT_FILTERS={start_date:void 0,end_date:void 0,users:[],scopes:[],activities:[]},advancedActivityLogsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","audit-logs","advancedActivityLogsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_5__.featureFlagLogic,["featureFlags"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:filters=>({filters}),clearAllFilters:!0,setPage:page=>({page}),exportLogs:format=>({format}),loadAvailableFilters:!0,loadExports:!0,setActiveTab:tab=>({tab})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({filters:[DEFAULT_FILTERS,{setFilters:(state,_ref)=>{let{filters}=_ref;return{...state,...filters}},clearAllFilters:()=>DEFAULT_FILTERS}],currentPage:[1,{setPage:(_,_ref2)=>{let{page}=_ref2;return page},setFilters:()=>1}],activeTab:["logs",{setActiveTab:(_,_ref3)=>{let{tab}=_ref3;return tab}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref4=>{let{values}=_ref4;return{advancedActivityLogs:[{results:[],count:0},{loadAdvancedActivityLogs:async()=>{let params=new URLSearchParams;if(values.filters.start_date){let startDate=(0,lib_utils__WEBPACK_IMPORTED_MODULE_6__.FZ)(values.filters.start_date);startDate&&params.append("start_date",startDate.toISOString())}if(values.filters.end_date){let endDate=(0,lib_utils__WEBPACK_IMPORTED_MODULE_6__.FZ)(values.filters.end_date);endDate&&params.append("end_date",endDate.toISOString())}return values.filters.users?.forEach(user=>params.append("users",user)),values.filters.scopes?.forEach(scope=>params.append("scopes",scope)),values.filters.activities?.forEach(activity=>params.append("activities",activity)),params.append("page",values.currentPage.toString()),params.append("page_size",lib_constants__WEBPACK_IMPORTED_MODULE_3__.Ls.toString()),await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/@current/advanced_activity_logs/?${params}`)}}],availableFilters:[null,{loadAvailableFilters:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get("api/projects/@current/advanced_activity_logs/available_filters/")}],exports:[[],{loadExports:async()=>{let params=new URLSearchParams;return params.append("context_path","/advanced_activity_logs/"),(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/environments/@current/exports/?${params}`)).results||[]}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(_ref5=>{let{actions}=_ref5;return{isFeatureFlagEnabled:[s=>[s.featureFlags],featureFlags=>!!featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_3__.y8.ADVANCED_ACTIVITY_LOGS]],hasActiveFilters:[s=>[s.filters],filters=>!!(filters.start_date||filters.end_date||filters.users?.length||filters.scopes?.length||filters.activities?.length)],pagination:[s=>[s.currentPage,s.advancedActivityLogs],(currentPage,advancedActivityLogs)=>({controlled:!0,pageSize:lib_constants__WEBPACK_IMPORTED_MODULE_3__.Ls,currentPage,entryCount:advancedActivityLogs.count||0,onBackward:()=>actions.setPage(currentPage-1),onForward:()=>actions.setPage(currentPage+1)})]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref6=>{let{actions,values}=_ref6;return{setPage:()=>{actions.loadAdvancedActivityLogs()},setFilters:()=>{actions.loadAdvancedActivityLogs()},clearAllFilters:()=>{actions.loadAdvancedActivityLogs()},exportLogs:async _ref7=>{let{format}=_ref7;try{let filtersToExport={start_date:values.filters.start_date,end_date:values.filters.end_date,users:values.filters.users,scopes:values.filters.scopes,activities:values.filters.activities};await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.create("api/projects/@current/advanced_activity_logs/export/",{format,filters:filtersToExport}),lib_lemon_ui_LemonToast__WEBPACK_IMPORTED_MODULE_4__.U.success(`Export started! Your ${format.toUpperCase()} export is being prepared.`),actions.loadExports(),actions.setActiveTab("exports")}catch(error){console.error("Export failed:",error),lib_lemon_ui_LemonToast__WEBPACK_IMPORTED_MODULE_4__.U.error("Failed to start export. Please try again.")}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.events)(_ref8=>{let{actions,cache}=_ref8;return{afterMount:()=>{actions.loadAvailableFilters(),actions.loadAdvancedActivityLogs(),actions.loadExports(),cache.exportPollingInterval=setInterval(()=>{actions.loadExports()},5e3)},beforeUnmount:()=>{cache.exportPollingInterval&&clearInterval(cache.exportPollingInterval)}}})])}}]);