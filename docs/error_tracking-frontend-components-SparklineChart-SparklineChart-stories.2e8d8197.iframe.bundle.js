"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[23880],{"../../products/error_tracking/frontend/components/SparklineChart/SparklineChart.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{IssueChartInsideRange:()=>IssueChartInsideRange,IssueChartWithBeforeEvents:()=>IssueChartWithBeforeEvents,IssueChartWithOverlappingEvents:()=>IssueChartWithOverlappingEvents,IssueChartWithZeroes:()=>IssueChartWithZeroes,__namedExportsOrder:()=>__namedExportsOrder,default:()=>SparklineChart_stories});var v4=__webpack_require__("../../node_modules/.pnpm/uuid@9.0.1/node_modules/uuid/dist/esm-browser/v4.js"),external_STORYBOOK_MODULE_PREVIEW_API_=__webpack_require__("@storybook/preview-api"),external_STORYBOOK_MODULE_GLOBAL_=__webpack_require__("@storybook/global"),preview_errors=__webpack_require__("../../node_modules/.pnpm/@storybook+core-events@7.6.4/node_modules/@storybook/core-events/dist/errors/preview-errors.mjs"),config={depth:10,clearOnStoryChange:!0,limit:50},findProto=(obj,callback)=>{let proto=Object.getPrototypeOf(obj);return!proto||callback(proto)?proto:findProto(proto,callback)},isReactSyntheticEvent=e=>!!("object"==typeof e&&e&&findProto(e,proto=>/^Synthetic(?:Base)?Event$/.test(proto.constructor.name))&&"function"==typeof e.persist),serializeArg=a=>{if(isReactSyntheticEvent(a)){let e=Object.create(a.constructor.prototype,Object.getOwnPropertyDescriptors(a));e.persist();let viewDescriptor=Object.getOwnPropertyDescriptor(e,"view"),view=viewDescriptor?.value;return"object"==typeof view&&view?.constructor.name==="Window"&&Object.defineProperty(e,"view",{...viewDescriptor,value:Object.create(view.constructor.prototype)}),e}return a},generateId=()=>"object"==typeof crypto&&"function"==typeof crypto.getRandomValues?(0,v4.Z)():Date.now().toString(36)+Math.random().toString(36).substring(2);function action(name,options={}){let actionOptions={...config,...options},handler=function(...args){if(options.implicit){let storyRenderer=("__STORYBOOK_PREVIEW__"in external_STORYBOOK_MODULE_GLOBAL_.global?external_STORYBOOK_MODULE_GLOBAL_.global.__STORYBOOK_PREVIEW__:void 0)?.storyRenders.find(render=>"playing"===render.phase||"rendering"===render.phase);if(storyRenderer){let deprecated=!window?.FEATURES?.disallowImplicitActionsInRenderV8,error=new preview_errors.is({phase:storyRenderer.phase,name,deprecated});if(deprecated)console.warn(error);else throw error}}let channel=external_STORYBOOK_MODULE_PREVIEW_API_.addons.getChannel(),id=generateId(),serializedArgs=args.map(serializeArg),actionDisplayToEmit={id,count:0,data:{name,args:args.length>1?serializedArgs:serializedArgs[0]},options:{...actionOptions,maxDepth:5+(actionOptions.depth||3),allowFunction:actionOptions.allowFunction||!1}};channel.emit("storybook/actions/action-event",actionDisplayToEmit)};return handler.isAction=!0,handler}var src=__webpack_require__("../../node_modules/.pnpm/d3@7.9.0/node_modules/d3/src/index.js"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts");let SparklineChart_stories={title:"ErrorTracking/SparklineChart",parameters:{layout:"centered",viewMode:"story"},component:__webpack_require__("../../products/error_tracking/frontend/components/SparklineChart/SparklineChart.tsx").P},datumInteractions={onDatumMouseEnter:action("datum-mouse-enter"),onDatumMouseLeave:action("datum-mouse-leave")},eventsInteractions={onEventMouseEnter:action("mouse-enter-event"),onEventMouseLeave:action("mouse-leave-event"),onEventClick:action("mouse-click-event")},IssueChartInsideRange={args:{data:buildData(),events:buildEvents("2022-01-05","2022-01-10"),options:buildSparklineOptions(),className:"w-[800px] h-[200px]"}},IssueChartWithZeroes={args:{data:buildData(0,0),options:buildSparklineOptions(),className:"w-[800px] h-[200px]"}},IssueChartWithOverlappingEvents={args:{data:buildData(),events:buildEvents("2022-01-05","2022-01-05"),options:buildSparklineOptions(),className:"w-[800px] h-[200px]"}},IssueChartWithBeforeEvents={args:{data:buildData(0,1e3,"2022-02-01","2022-03-01"),events:buildEvents("2022-01-01","2022-01-02"),options:buildSparklineOptions(),className:"w-[800px] h-[200px]"}};function buildData(){let minValue=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,maxValue=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,minDate=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"2022-01-01",maxDate=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"2022-02-01",generator=src.b2d(42),dayJsStart=(0,dayjs.Bv)(minDate),binSize=(0,dayjs.Bv)(maxDate).diff(dayJsStart,"seconds")/60;return Array(60).fill(0).map((_,index)=>({value:Math.floor(generator()*(maxValue-minValue)+minValue),date:dayJsStart.add(index*binSize,"seconds").toDate()}))}function buildSparklineOptions(){return{...datumInteractions,...eventsInteractions,backgroundColor:"var(--primitive-neutral-200)",hoverBackgroundColor:"var(--primitive-neutral-700)",axisColor:"var(--primitive-neutral-300)",eventLabelHeight:20,eventMinSpace:2,eventLabelPaddingX:5,eventLabelPaddingY:3,borderRadius:5}}function buildEvents(firstDate,lastDate){return[{id:"1",date:new Date(firstDate),payload:"First seen",color:"var(--brand-red)"},{id:"2",date:new Date(lastDate),payload:"Last seen",color:"var(--brand-blue)"}]}IssueChartInsideRange.parameters={...IssueChartInsideRange.parameters,docs:{...IssueChartInsideRange.parameters?.docs,source:{originalSource:"{\n  args: {\n    data: buildData(),\n    events: buildEvents('2022-01-05', '2022-01-10'),\n    options: buildSparklineOptions(),\n    className: 'w-[800px] h-[200px]'\n  }\n}",...IssueChartInsideRange.parameters?.docs?.source}}},IssueChartWithZeroes.parameters={...IssueChartWithZeroes.parameters,docs:{...IssueChartWithZeroes.parameters?.docs,source:{originalSource:"{\n  args: {\n    data: buildData(0, 0),\n    options: buildSparklineOptions(),\n    className: 'w-[800px] h-[200px]'\n  }\n}",...IssueChartWithZeroes.parameters?.docs?.source}}},IssueChartWithOverlappingEvents.parameters={...IssueChartWithOverlappingEvents.parameters,docs:{...IssueChartWithOverlappingEvents.parameters?.docs,source:{originalSource:"{\n  args: {\n    data: buildData(),\n    events: buildEvents('2022-01-05', '2022-01-05'),\n    options: buildSparklineOptions(),\n    className: 'w-[800px] h-[200px]'\n  }\n}",...IssueChartWithOverlappingEvents.parameters?.docs?.source}}},IssueChartWithBeforeEvents.parameters={...IssueChartWithBeforeEvents.parameters,docs:{...IssueChartWithBeforeEvents.parameters?.docs,source:{originalSource:"{\n  args: {\n    data: buildData(0, 1000, '2022-02-01', '2022-03-01'),\n    events: buildEvents('2022-01-01', '2022-01-02'),\n    options: buildSparklineOptions(),\n    className: 'w-[800px] h-[200px]'\n  }\n}",...IssueChartWithBeforeEvents.parameters?.docs?.source}}};let __namedExportsOrder=["IssueChartInsideRange","IssueChartWithZeroes","IssueChartWithOverlappingEvents","IssueChartWithBeforeEvents"]},"../../products/error_tracking/frontend/components/SparklineChart/SparklineChart.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>SparklineChart});var d3__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/d3@7.9.0/node_modules/d3/src/index.js"),lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),use_resize_observer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/use-resize-observer@8.0.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/use-resize-observer/dist/bundle.esm.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SparklineChart(_ref){let{data,events=[],options,className}=_ref,svgRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),{height:contentHeight,width:contentWidth,ref:contentRef}=(0,use_resize_observer__WEBPACK_IMPORTED_MODULE_3__.Z)({box:"content-box"});return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{let svgEl=svgRef.current;if(svgEl&&contentHeight&&contentWidth){let svg=d3__WEBPACK_IMPORTED_MODULE_0__.Ys(svgEl);if(data.length<2)throw Error("Not enough data to render chart");let timeDiff=Math.abs(data[1].date.getTime()-data[0].date.getTime()),extent=d3__WEBPACK_IMPORTED_MODULE_0__.Wem(data.map(d=>d.date)),maxDate=new Date(extent[1]);maxDate.setTime(extent[1].getTime()+timeDiff);let xTicks=d3__WEBPACK_IMPORTED_MODULE_0__.jKP(extent[0],maxDate,8),xScale=d3__WEBPACK_IMPORTED_MODULE_0__.Xf().domain([extent[0],maxDate]).range([0,contentWidth]),maxValue=d3__WEBPACK_IMPORTED_MODULE_0__.Fp7(data.map(d=>d.value))||0,yScale=d3__WEBPACK_IMPORTED_MODULE_0__.BYU().domain([0,maxValue||1]).range([contentHeight,options.eventLabelHeight]),xAxis=d3__WEBPACK_IMPORTED_MODULE_0__.LLu(xScale).tickValues(xTicks).tickSize(0).tickPadding(5);return svg.selectAll("g.datum").data(data).enter().append("g").attr("class","datum").call(buildBarGroup,xScale,yScale,contentHeight,data,options),svg.append("g").attr("transform",`translate(0,${contentHeight})`).style("color",options.axisColor).call(xAxis),svg.selectAll("g.event").data(events||[]).enter().append("g").attr("class","event").call(buildEvent,xScale,options,contentHeight,contentWidth),()=>{svg.selectAll("*").remove()}}},[data,events,options,contentHeight,contentWidth]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{ref:contentRef,className:(0,lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_4__.cn)("h-full w-full p-4 overflow-hidden",className),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("svg",{ref:svgRef,className:"overflow-visible",height:"100%",width:"100%"})})}function buildBarGroup(group,xScale,yScale,contentHeight,data,options){let bandwidth=xScale(data[1].date)-xScale(data[0].date);group.attr("x",d=>xScale(d.date)).on("mouseover",function(_,d){let current=d3__WEBPACK_IMPORTED_MODULE_0__.Ys(this);options.onDatumMouseEnter?.(d),options.hoverBackgroundColor&&current.select(".bar").style("fill",options.hoverBackgroundColor)}).on("mouseout",function(_,d){let current=d3__WEBPACK_IMPORTED_MODULE_0__.Ys(this);options.onDatumMouseLeave?.(d),current.select(".bar").style("fill",options.backgroundColor)}),group.append("rect").attr("class","bar").attr("x",(_,i)=>xScale(data[i].date)).attr("y",d=>yScale(d.value)+options.borderRadius).attr("width",.9*bandwidth).attr("height",d=>d?contentHeight-yScale(d.value):0).style("fill",options.backgroundColor).style("clip-path",`inset(0 0 ${options.borderRadius+1}px 0)`).attr("rx",options.borderRadius).attr("ry",options.borderRadius);let maxValue=Math.max(...yScale.domain());group.append("rect").attr("class","overlay").attr("x",(_,i)=>xScale(data[i].date)).attr("y",yScale(maxValue)).attr("width",bandwidth).attr("height",d=>d?contentHeight-yScale(maxValue)+options.borderRadius:0).style("fill","transparent")}function buildEventLabel(selection,xScale,options,contentWidth){let paddingX=options.eventLabelPaddingX,paddingY=options.eventLabelPaddingY,baseLine=options.eventLabelHeight/2,textNodes=selection.append("text").attr("class","font-semibold").attr("x",d=>xScale(d.date)).attr("y",baseLine).attr("fill","white").attr("text-anchor","middle").attr("dominant-baseline","central").style("font-size","10px").text(d=>d.payload).nodes();selection.insert("rect","text").attr("x",(_,i)=>textNodes[i].getBBox().x-paddingX).attr("y",(_,i)=>textNodes[i].getBBox().y-paddingY).attr("width",(_,i)=>textNodes[i].getBBox().width+2*paddingX).attr("height",(_,i)=>textNodes[i].getBBox().height+2*paddingY).attr("rx",options.borderRadius).attr("ry",options.borderRadius).attr("fill",d=>d.color||"black");let movingNodes=selection.nodes().map((node,index)=>{let bbox=node.getBBox();return{x:bbox.x+bbox.width/2,y:bbox.y+bbox.height/2,radius:bbox.width/2+options.eventMinSpace,id:`moving-${index}`}}),clonedNodes=movingNodes.map(node=>({...node})),simulation=d3__WEBPACK_IMPORTED_MODULE_0__.A4v(movingNodes).velocityDecay(.9).force("collision",d3__WEBPACK_IMPORTED_MODULE_0__.Hh().radius((_,i)=>movingNodes[i].radius)).force("boundaries",forceBoundaries(movingNodes,-10,contentWidth+10));simulation.stop(),simulation.tick(500),movingNodes.forEach((_,index)=>{let newX=movingNodes[index].x,initialX=clonedNodes[index].x,newY=movingNodes[index].y,initialY=clonedNodes[index].y,deltaX=newX-initialX,deltaY=newY-initialY;selection.filter((_,i)=>i===index).attr("transform",`translate(${deltaX}, ${deltaY})`).attr("dx",deltaX).attr("dy",deltaY)})}function buildEventAnchor(selection,xScale,contentHeight){selection.append("circle").attr("cx",d=>xScale(d.date)).attr("cy",contentHeight).attr("r",6).attr("fill","white").attr("stroke",d=>d.color||"black").attr("stroke-width",2)}function buildEvent(selection,xScale,options,contentHeight,contentWidth){selection.append("g").attr("class","label").call(buildEventLabel,xScale,options,contentWidth),selection.call(buildEventLine,xScale,contentHeight,contentWidth),selection.call(buildEventAnchor,xScale,contentHeight),selection.style("cursor",options.onEventClick?"pointer":"default").on("mouseover",function(_,d){options.onEventMouseEnter?.(d)}).on("mouseout",function(_,d){options.onEventMouseLeave?.(d)})}function buildEventLine(selection,xScale,contentHeight,contentWidth){selection.insert("line","g.label").attr("x1",d=>xScale(d.date)).attr("y1",contentHeight).attr("x2",(_,index)=>{let labelNode=selection.selectAll(".label").nodes().find((_,i)=>i===index),dx=parseFloat(labelNode.getAttribute("dx")||"0"),labelBbox=labelNode.getBBox();return labelBbox?.x+dx+labelBbox?.width/2||0}).attr("y2",5).attr("stroke-width",2).attr("stroke",d=>{let xPos=xScale(d.date);return xPos<0||xPos>contentWidth?"transparent":d.color||"black"})}function forceBoundaries(nodes,minX,maxX){return()=>{nodes.forEach(node=>{node.vy=0,node.x+node.radius>maxX?node.vx+=maxX-(node.x+node.radius):node.x-node.radius<minX&&(node.vx+=minX-(node.x-node.radius))})}}}}]);