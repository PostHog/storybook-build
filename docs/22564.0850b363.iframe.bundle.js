"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[22564],{"../../products/messaging/frontend/TemplateLibrary/MessageTemplate.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MessageTemplate:()=>MessageTemplate,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),EmailTemplater=__webpack_require__("../../frontend/src/scenes/hog-functions/email-templater/EmailTemplater.tsx"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");let NEW_TEMPLATE={id:"new",name:"",description:"",content:{templating:"liquid",email:{from:"",to:"",subject:"",html:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"><head>\n\x3c!--[if gte mso 9]>\n<xml>\n  <o:OfficeDocumentSettings>\n    <o:AllowPNG/>\n    <o:PixelsPerInch>96</o:PixelsPerInch>\n  </o:OfficeDocumentSettings>\n</xml>\n<![endif]--\x3e\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <meta name="x-apple-disable-message-reformatting" />\n  \x3c!--[if !mso]>\x3c!--\x3e<meta http-equiv="X-UA-Compatible" content="IE=edge" />\x3c!--<![endif]--\x3e\n  <title></title>\n  \n    <style type="text/css">\n      \n      @media only screen and (min-width: 520px) \\{\n        .u-row \\{\n          width: 500px !important;\n        }\n\n        .u-row .u-col \\{\n          vertical-align: top;\n        }\n\n        \n            .u-row .u-col-100 \\{\n              width: 500px !important;\n            }\n          \n      }\n\n      @media only screen and (max-width: 520px) \\{\n        .u-row-container \\{\n          max-width: 100% !important;\n          padding-left: 0px !important;\n          padding-right: 0px !important;\n        }\n\n        .u-row \\{\n          width: 100% !important;\n        }\n\n        .u-row .u-col \\{\n          display: block !important;\n          width: 100% !important;\n          min-width: 320px !important;\n          max-width: 100% !important;\n        }\n\n        .u-row .u-col &gt; div \\{\n          margin: 0 auto;\n        }\n\n\n}\n    \nbody \\{\n  margin: 0;\n  padding: 0;\n}\n\ntable,\ntr,\ntd \\{\n  vertical-align: top;\n  border-collapse: collapse;\n}\n\np \\{\n  margin: 0;\n}\n\n.ie-container table,\n.mso-container table \\{\n  table-layout: fixed;\n}\n\n* \\{\n  line-height: inherit;\n}\n\na[x-apple-data-detectors=\'true\'] \\{\n  color: inherit !important;\n  text-decoration: none !important;\n}\n\n\n\ntable, td \\{ color: #000000; } #u_body a \\{ color: #0000ee; text-decoration: underline; }\n    </style>\n  \n  \n\n</head>\n\n<body class="clean-body u_body" style="margin: 0;padding: 0;-webkit-text-size-adjust: 100%;background-color: #F7F8F9;color: #000000">\n  \x3c!--[if IE]><div class="ie-container"><![endif]--\x3e\n  \x3c!--[if mso]><div class="mso-container"><![endif]--\x3e\n  <table id="u_body" style="border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;min-width: 320px;Margin: 0 auto;background-color: #F7F8F9;width:100%" cellpadding="0" cellspacing="0">\n  <tbody>\n  <tr style="vertical-align: top">\n    <td style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">\n    \x3c!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color: #F7F8F9;"><![endif]--\x3e\n    \n  \n  \n<div class="u-row-container" style="padding: 0px;background-color: transparent">\n  <div class="u-row" style="margin: 0 auto;min-width: 320px;max-width: 500px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: transparent;">\n    <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">\n      \x3c!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:500px;"><tr style="background-color: transparent;"><![endif]--\x3e\n      \n\x3c!--[if (mso)|(IE)]><td align="center" width="500" style="width: 500px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;" valign="top"><![endif]--\x3e\n<div class="u-col u-col-100" style="max-width: 320px;min-width: 500px;display: table-cell;vertical-align: top;">\n  <div style="height: 100%;width: 100% !important;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;">\n  \x3c!--[if (!mso)&(!IE)]>\x3c!--\x3e<div style="box-sizing: border-box; height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;">\x3c!--<![endif]--\x3e\n  \n<table style="font-family:arial,helvetica,sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">\n  <tbody>\n    <tr>\n      <td style="overflow-wrap:break-word;word-break:break-word;padding:10px;font-family:arial,helvetica,sans-serif;" align="left">\n        \n  <div style="font-size: 14px; line-height: 140%; text-align: left; word-wrap: break-word;">\n    <p style="line-height: 140%;">Hello from PostHog!</p>\n  </div>\n\n      </td>\n    </tr>\n  </tbody>\n</table>\n\n<table style="font-family:arial,helvetica,sans-serif;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">\n  <tbody>\n    <tr>\n      <td style="overflow-wrap:break-word;word-break:break-word;padding:10px;font-family:arial,helvetica,sans-serif;" align="left">\n        \n  \x3c!--[if mso]><style>.v-button \\{background: transparent !important;}</style><![endif]--\x3e\n<div align="center">\n  \x3c!--[if mso]><v:roundrect xmlns:v="urn:schemas-microsoft-com:vml" xmlns:w="urn:schemas-microsoft-com:office:word" href="https://posthog.com/" style="height:37px; v-text-anchor:middle; width:112px;" arcsize="11%"  stroke="f" fillcolor="#3AAEE0"><w:anchorlock/><center style="color:#FFFFFF;"><![endif]--\x3e\n    <a href="https://posthog.com/" target="_blank" class="v-button" style="box-sizing: border-box;display: inline-block;text-decoration: none;-webkit-text-size-adjust: none;text-align: center;color: #FFFFFF; background-color: #3AAEE0; border-radius: 4px;-webkit-border-radius: 4px; -moz-border-radius: 4px; width:auto; max-width:100%; overflow-wrap: break-word; word-break: break-word; word-wrap:break-word; mso-border-alt: none;font-size: 14px;">\n      <span style="display:block;padding:10px 20px;line-height:120%;">Learn more</span>\n    </a>\n    \x3c!--[if mso]></center></v:roundrect><![endif]--\x3e\n</div>\n\n      </td>\n    </tr>\n  </tbody>\n</table>\n\n  \x3c!--[if (!mso)&(!IE)]>\x3c!--\x3e</div>\x3c!--<![endif]--\x3e\n  </div>\n</div>\n\x3c!--[if (mso)|(IE)]></td><![endif]--\x3e\n      \x3c!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]--\x3e\n    </div>\n  </div>\n  </div>\n  \n\n\n    \x3c!--[if (mso)|(IE)]></td></tr></table><![endif]--\x3e\n    </td>\n  </tr>\n  </tbody>\n  </table>\n  \x3c!--[if mso]></div><![endif]--\x3e\n  \x3c!--[if IE]></div><![endif]--\x3e\n\n\n\n</body></html>',design:{body:{id:"TlJ2GekAva",rows:[{id:"-sL7LJ6rhD",cells:[1],values:{_meta:{htmlID:"u_row_1",htmlClassNames:"u_row"},anchor:"",columns:!1,padding:"0px",hideable:!0,deletable:!0,draggable:!0,selectable:!0,_styleGuide:null,hideDesktop:!1,duplicatable:!0,backgroundColor:"",backgroundImage:{url:"",size:"custom",repeat:"no-repeat",position:"center",fullWidth:!0,customPosition:["50%","50%"]},displayCondition:null,columnsBackgroundColor:""},columns:[{id:"IT_J8vPWTn",values:{_meta:{htmlID:"u_column_1",htmlClassNames:"u_column"},border:{},padding:"0px",borderRadius:"0px",backgroundColor:""},contents:[{id:"BSAz3H7CN9",type:"text",values:{text:'<p style="line-height: 140%;">Hello from PostHog!</p>',_meta:{htmlID:"u_content_text_1",htmlClassNames:"u_content_text"},anchor:"",fontSize:"14px",hideable:!0,deletable:!0,draggable:!0,linkStyle:{inherit:!0,linkColor:"#0000ee",linkUnderline:!0,linkHoverColor:"#0000ee",linkHoverUnderline:!0},textAlign:"left",_languages:{},lineHeight:"140%",selectable:!0,_styleGuide:null,duplicatable:!0,containerPadding:"10px",displayCondition:null}},{id:"cAnEDJLdIg",type:"button",values:{href:{name:"web",attrs:{href:"{{href}}",target:"{{target}}"},values:{href:"https://posthog.com/",target:"_blank"}},size:{width:"100%",autoWidth:!0},text:"Learn more",_meta:{htmlID:"u_content_button_1",htmlClassNames:"u_content_button"},anchor:"",border:{},padding:"10px 20px",fontSize:"14px",hideable:!0,deletable:!0,draggable:!0,textAlign:"center",_languages:{},lineHeight:"120%",selectable:!0,_styleGuide:null,borderRadius:"4px",buttonColors:{color:"#FFFFFF",hoverColor:"#FFFFFF",backgroundColor:"#3AAEE0",hoverBackgroundColor:"#3AAEE0"},duplicatable:!0,calculatedWidth:112,calculatedHeight:37,containerPadding:"10px",displayCondition:null}}]}]}],values:{_meta:{htmlID:"u_body",htmlClassNames:"u_body"},language:{},linkStyle:{body:!0,linkColor:"#0000ee",linkUnderline:!0,linkHoverColor:"#0000ee",linkHoverUnderline:!0},textColor:"#000000",fontFamily:{label:"Arial",value:"arial,helvetica,sans-serif"},popupWidth:"600px",_styleGuide:null,popupHeight:"auto",borderRadius:"10px",contentAlign:"center",contentWidth:"500px",popupPosition:"center",preheaderText:"",backgroundColor:"#F7F8F9",backgroundImage:{url:"",size:"custom",repeat:"no-repeat",position:"center",fullWidth:!0},contentVerticalAlign:"center",popupBackgroundColor:"#FFFFFF",popupBackgroundImage:{url:"",size:"cover",repeat:"no-repeat",position:"center",fullWidth:!0},popupCloseButton_action:{name:"close_popup",attrs:{onClick:"document.querySelector('.u-popup-container').style.display = 'none';"}},popupCloseButton_margin:"0px",popupCloseButton_position:"top-right",popupCloseButton_iconColor:"#000000",popupOverlay_backgroundColor:"rgba(0, 0, 0, 0.1)",popupCloseButton_borderRadius:"0px",popupCloseButton_backgroundColor:"#DDDDDD"},footers:[],headers:[]},counters:{u_row:1,u_column:1,u_content_text:1,u_content_button:1},schemaVersion:17},text:"Hello from PostHog!\n\n[Learn more]\nhttps://posthog.com/"}},created_at:null,updated_at:null,created_by:null},messageTemplateLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","messageTemplateLogic"]),(0,index_esm.key)(_ref=>{let{id}=_ref;return null!=id?id:"unknown"}),(0,index_esm.props)({}),(0,index_esm.actions)({setTemplate:template=>({template}),setOriginalTemplate:template=>({template})}),(0,index_esm.selectors)({breadcrumbs:[(_,p)=>[p.id],id=>[{key:sceneTypes.x.Messaging,name:"Messaging",path:urls.j.messaging()},{key:[sceneTypes.x.Messaging,"library"],name:"Library",path:urls.j.messaging("library")},..."new"===id?[{key:"new-template",name:"New template",path:urls.j.messagingLibraryTemplateNew()}]:[{key:"edit-template",name:"Manage template",path:urls.j.messagingLibraryTemplate(id)}]]]}),(0,lib.forms)(_ref2=>{let{actions}=_ref2;return{template:{defaults:{...NEW_TEMPLATE},errors:template=>({name:template.name?void 0:"Name is required",content:{email:{subject:template.content.email.subject?void 0:"Subject is required"}}}),submit:async template=>{actions.saveTemplate(template)}}}}),(0,index_esm.reducers)({template:[{...NEW_TEMPLATE},{setTemplate:(_,_ref3)=>{let{template}=_ref3;return template}}],originalTemplate:[{...NEW_TEMPLATE},{setOriginalTemplate:(_,_ref4)=>{let{template}=_ref4;return template},loadTemplateSuccess:(_,_ref5)=>{let{template}=_ref5;return template}}]}),(0,kea_loaders_lib.loaders)(_ref6=>{let{props}=_ref6;return{template:{loadTemplate:async()=>props.id&&"new"!==props.id?await api.ZP.messaging.getTemplate(props.id):{...NEW_TEMPLATE},saveTemplate:template=>"new"===template.id?api.ZP.messaging.createTemplate(template):api.ZP.messaging.updateTemplate(template.id,template)},message:{loadMessage:async()=>props.messageId?await api.ZP.hogFunctions.get(props.messageId):null}}}),(0,index_esm.listeners)(_ref7=>{let{actions}=_ref7;return{saveTemplateSuccess:async _ref8=>{let{template}=_ref8;LemonToast.U.success("Template saved"),template.id&&kea_router_lib.router.actions.replace(urls.j.messagingLibraryTemplate(template.id)),actions.resetTemplate(template),actions.setOriginalTemplate(template)},loadMessageSuccess:async _ref9=>{let{message}=_ref9;message&&actions.setTemplateValues({name:message.name,description:message.description,content:{email:message.inputs?.email?.value}})}}}),(0,index_esm.afterMount)(_ref10=>{let{props,actions}=_ref10;"new"!==props.id&&actions.loadTemplate(),props.messageId?actions.loadMessage():actions.resetTemplate(NEW_TEMPLATE)})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:MessageTemplate,logic:messageTemplateLogic,paramsToProps:_ref=>{let{params:{id},searchParams:{messageId}}=_ref;return{id:id||"new",messageId}}};function MessageTemplate(_ref2){let{id}=_ref2,{submitTemplate,resetTemplate,setTemplateValue}=(0,index_esm.useActions)(messageTemplateLogic),{template,originalTemplate,isTemplateSubmitting,templateChanged,messageLoading}=(0,index_esm.useValues)(messageTemplateLogic);return(0,jsx_runtime.jsx)("div",{className:"space-y-4",children:(0,jsx_runtime.jsxs)(lib.Form,{logic:messageTemplateLogic,formKey:"template",children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[templateChanged&&(0,jsx_runtime.jsx)(src.Jp,{"data-attr":"cancel-message-template",type:"secondary",onClick:()=>resetTemplate(originalTemplate),children:"Discard changes"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",htmlType:"submit",form:"template",onClick:submitTemplate,loading:isTemplateSubmitting,disabledReason:templateChanged?void 0:"No changes to save",children:"new"===id?"Create":"Save"})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4 items-start",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1 self-start p-3 space-y-2 rounded border min-w-100 bg-surface-primary",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",children:(0,jsx_runtime.jsx)(src.DF,{disabled:messageLoading})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"description",label:"Description",info:"Add a description to share context with other team members",children:(0,jsx_runtime.jsx)(src._V,{disabled:messageLoading})})]}),(0,jsx_runtime.jsxs)("div",{className:"p-3 space-y-2 rounded border flex-2 min-w-100 bg-surface-primary",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("h3",{children:"Email template"}),(0,jsx_runtime.jsx)(src.u,{title:"You can use Liquid templating in any email text field.",docLink:"https://liquidjs.com/filters/overview.html",children:(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode,{fontSize:24})})})]}),messageLoading?(0,jsx_runtime.jsx)(src.$j,{className:"text-lg"}):(0,jsx_runtime.jsx)(EmailTemplater.N,{value:template?.content.email,onChange:value=>setTemplateValue("content.email",value),onChangeTemplating:templating=>setTemplateValue("content.email.templating",templating),type:"native_email_template"})]})]})]})})}},"../../node_modules/.pnpm/react-email-editor@1.7.11_react@18.2.0/node_modules/react-email-editor/dist/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("../../node_modules/.pnpm/react-email-editor@1.7.11_react@18.2.0/node_modules/react-email-editor/dist/react-email-editor.cjs.production.min.js")},"../../node_modules/.pnpm/react-email-editor@1.7.11_react@18.2.0/node_modules/react-email-editor/dist/react-email-editor.cjs.production.min.js":(__unused_webpack_module,exports,__webpack_require__)=>{var t=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),n=t&&"object"==typeof t&&"default"in t?t.default:t;function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var r=[],i=!1,l=function(){if(i)for(var e;e=r.shift();)e()},d="undefined"==typeof window?{__unlayer_lastEditorId:0}:window;d.__unlayer_lastEditorId=d.__unlayer_lastEditorId||0,exports.default=n.forwardRef(function(e,a){var u,s,c,f,p,y,v,E,m,_=e.onLoad,h=e.onReady,j=e.scriptUrl,b=e.minHeight,O=e.style,w=t.useState(null),x=w[0],M=w[1],L=t.useState(!1),S=L[0],H=L[1],R=t.useMemo(function(){return e.editorId||"editor-"+ ++d.__unlayer_lastEditorId},[e.editorId]),k=o({},e.options||{},{appearance:null!=(u=e.appearance)?u:null==(s=e.options)?void 0:s.appearance,displayMode:(null==e?void 0:e.displayMode)||(null==(c=e.options)?void 0:c.displayMode)||"email",locale:null!=(f=e.locale)?f:null==(p=e.options)?void 0:p.locale,projectId:null!=(y=e.projectId)?y:null==(v=e.options)?void 0:v.projectId,tools:null!=(E=e.tools)?E:null==(m=e.options)?void 0:m.tools,id:R,source:{name:"react-email-editor",version:"1.7.11"}});t.useImperativeHandle(a,function(){return{editor:x}},[x]),t.useEffect(function(){return function(){null==x||x.destroy()}},[]),t.useEffect(function(){H(!1),function(e,t){if(void 0===t&&(t="https://editor.unlayer.com/embed.js?2"),r.push(function(){return H(!0)}),e1=t,t1=document.querySelectorAll("script"),n=!1,t1.forEach(function(t){t.src.includes(e1)&&(n=!0)}),n)l();else{var e1,t1,n,n1=document.createElement("script");n1.setAttribute("src",t),n1.onload=function(){i=!0,l()},document.head.appendChild(n1)}}(0,j)},[j]),t.useEffect(function(){S&&(null==x||x.destroy(),M(unlayer.createEditor(k)))},[JSON.stringify(k),S]);var q=Object.keys(e).filter(function(e){return/^on/.test(e)});return t.useEffect(function(){x&&(null==_||_(x),q.forEach(function(t){/^on/.test(t)&&"onLoad"!==t&&"onReady"!==t&&"function"==typeof e[t]&&x.addEventListener(t,e[t])}),h&&x.addEventListener("editor:ready",function(){h(x)}))},[x,Object.keys(q).join(",")]),n.createElement("div",{style:{flex:1,display:"flex",minHeight:void 0===b?500:b}},n.createElement("div",{id:R,style:o({},void 0===O?{}:O,{flex:1})}))})}}]);