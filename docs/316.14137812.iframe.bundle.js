var xe=Object.defineProperty,Oe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var k=(j,d,s)=>d in j?xe(j,d,{enumerable:!0,configurable:!0,writable:!0,value:s}):j[d]=s,R=(j,d)=>{for(var s in d||(d={}))W.call(d,s)&&k(j,s,d[s]);if(B)for(var s of B(d))J.call(d,s)&&k(j,s,d[s]);return j},K=(j,d)=>Oe(j,he(d));var X=(j,d)=>{var s={};for(var b in j)W.call(j,b)&&d.indexOf(b)<0&&(s[b]=j[b]);if(j!=null&&B)for(var b of B(j))d.indexOf(b)<0&&J.call(j,b)&&(s[b]=j[b]);return s};var P=(j,d,s)=>new Promise((b,I)=>{var r=O=>{try{N(s.next(O))}catch(y){I(y)}},v=O=>{try{N(s.throw(O))}catch(y){I(y)}},N=O=>O.done?b(O.value):Promise.resolve(O.value).then(r,v);N((s=s.apply(j,d)).next())});(window.webpackJsonp=window.webpackJsonp||[]).push([[316],{"./frontend/src/scenes/session-recordings/SessionRecordings.tsx":function(j,d,s){"use strict";s.r(d),s.d(d,"SessionsRecordings",function(){return H}),s.d(d,"scene",function(){return ye});var b=s("./frontend/src/lib/components/PageHeader.tsx"),I=s("./frontend/src/scenes/teamLogic.tsx"),r=s("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),v=s("./frontend/src/scenes/urls.ts"),N=s("./frontend/src/scenes/session-recordings/playlist/SessionRecordingsPlaylist.tsx"),O=s("./frontend/src/lib/components/AlertMessage/index.ts"),y=s("./frontend/@posthog/lemon-ui/src/index.ts"),Z=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),f=s("./frontend/src/types.ts"),V=s("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),M=s("./frontend/src/lib/api.ts"),S=s("./frontend/src/lib/utils.tsx"),F=s("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),T=s("./frontend/src/scenes/session-recordings/playlist/playlistUtils.ts"),D=s("./frontend/src/lib/utils/eventUsageLogic.ts");const A=30,Q={createdBy:"All users",page:1,dateFrom:"all"},q=Object(r.kea)([Object(r.path)(n=>["scenes","session-recordings","saved-playlists","savedSessionRecordingPlaylistsLogic",n]),Object(r.props)({}),Object(r.key)(n=>n.tab),Object(r.connect)({actions:[D.e,["reportRecordingPlaylistCreated"]]}),Object(r.actions)(()=>({setSavedPlaylistsFilters:n=>({filters:n}),loadPlaylists:!0,updatePlaylist:(n,t)=>({shortId:n,properties:t}),deletePlaylist:n=>({playlist:n}),duplicatePlaylist:n=>({playlist:n})})),Object(r.reducers)(n=>{let{}=n;return{filters:[Q,{setSavedPlaylistsFilters:(t,l)=>{let{filters:i}=l;return Object(S.qb)(R(R(R({},t||{}),i),"page"in i?{}:{page:1}))}}]}}),Object(V.loaders)(n=>{let{values:t,actions:l}=n;return{playlists:{__default:{results:[],count:0,filters:null},loadPlaylists:(i,a)=>P(this,null,function*(){var o,g;t.playlists.filters!==null&&(yield a(300));const c=R({},t.filters),u=c.createdBy==="All users"?void 0:c.createdBy,x={limit:A,offset:Math.max(0,(c.page-1)*A),order:(o=c.order)!==null&&o!==void 0?o:"-last_modified_at",created_by:u!=null?u:void 0,search:c.search||void 0,date_from:c.dateFrom&&c.dateFrom!="all"?c.dateFrom:void 0,date_to:(g=c.dateTo)!==null&&g!==void 0?g:void 0,pinned:c.pinned?!0:void 0},L=yield M.b.recordings.listPlaylists(Object(S.Ib)(x));return a(),L}),updatePlaylist:(i,a)=>P(this,null,function*(){let{shortId:o,properties:g}=i;yield a(100);const c=yield M.b.recordings.updatePlaylist(o,g);a();const u=t.playlists.results.findIndex(x=>x.short_id===c.short_id);return u>-1&&(t.playlists.results[u]=c),K(R({},t.playlists),{results:[...t.playlists.results]})}),deletePlaylist:i=>P(this,null,function*(){let{playlist:a}=i;return yield Object(T.b)(a,()=>l.loadPlaylists()),t.playlists.results=t.playlists.results.filter(o=>o.short_id!==a.short_id),t.playlists}),duplicatePlaylist:(i,a)=>P(this,null,function*(){let{playlist:o}=i;yield a(100);const L=o,{id:g,short_id:c}=L,u=X(L,["id","short_id"]);u.name=u.name?u.name+" (copy)":"";const x=yield Object(T.a)(u);return l.reportRecordingPlaylistCreated("duplicate"),a(),x&&(y.lemonToast.success("Playlist duplicated successfully"),t.playlists.results=[x,...t.playlists.results]),t.playlists})}}}),Object(r.listeners)(n=>{let{actions:t}=n;return{setSavedPlaylistsFilters:()=>{t.loadPlaylists()}}}),Object(r.selectors)(n=>{let{actions:t}=n;return{sorting:[l=>[l.filters],l=>l.order?l.order.startsWith("-")?{columnKey:l.order.slice(1),order:-1}:{columnKey:l.order,order:1}:{columnKey:"last_modified_at",order:-1}],pagination:[l=>[l.filters,l.playlists],(l,i)=>({controlled:!0,pageSize:A,currentPage:l.page,entryCount:i.count,onBackward:i.previous?()=>t.setSavedPlaylistsFilters({page:l.page-1}):void 0,onForward:i.next?()=>t.setSavedPlaylistsFilters({page:l.page+1}):void 0})]}}),Object(F.actionToUrl)(n=>{let{values:t}=n;const l=()=>{if(F.router.values.location.pathname===v.a.sessionRecordings(f.Z.Playlists)){const i=t.filters,a=Object(S.qb)(F.router.values.searchParams);if(!Object(S.sb)(i,a))return[v.a.sessionRecordings(f.Z.Playlists),i,{},{replace:!1}]}};return{loadPlaylists:l,setSavedPlaylistsFilters:l}}),Object(F.urlToAction)(n=>{let{actions:t,values:l}=n;return{[v.a.sessionRecordings(f.Z.Playlists)]:(i,a)=>P(this,null,function*(){const o=l.filters,g=Object(S.qb)(a);Object(S.sb)(o,g)||t.setSavedPlaylistsFilters(g)})}}),Object(r.afterMount)(n=>{let{actions:t}=n;t.loadPlaylists()})]);var _=s("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),ee=s("./frontend/src/lib/components/DateFilter/DateFilter.tsx"),se=s("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),te=s("./frontend/@posthog/apps-common/src/index.ts"),ne=s("./frontend/src/lib/components/LemonButton/index.ts"),h=s("./frontend/src/lib/components/icons.tsx"),e=s("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function le(){return Object(e.jsx)("div",{className:"flex items-center justify-center",children:Object(e.jsxs)("div",{className:"max-w-lg mt-12 flex flex-col items-center",children:[Object(e.jsx)("h2",{className:"text-xl",children:"There are no playlists that match these filters"}),Object(e.jsx)("p",{className:"text-muted",children:"Once you create a playlist, it will show up here."}),Object(e.jsx)(ne.a,{type:"primary","data-attr":"add-session-playlist-button-empty-state",icon:Object(e.jsx)(h.IconPlus,{}),onClick:()=>Object(T.a)({},!0),children:"New playlist"})]})})}var ae=s("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),ie=s("./frontend/src/lib/components/LemonButton/More.tsx");function E(n){let{tab:t}=n;const l=q({tab:t}),{playlists:i,playlistsLoading:a,filters:o,sorting:g,pagination:c}=Object(r.useValues)(l),{setSavedPlaylistsFilters:u,updatePlaylist:x,duplicatePlaylist:L,deletePlaylist:ge}=Object(r.useActions)(l),{meFirstMembers:pe}=Object(r.useValues)(se.a),be=[{width:0,dataIndex:"pinned",render:function(p,C){let{short_id:w}=C;return Object(e.jsx)(y.LemonButton,{size:"small",status:"primary-alt",onClick:()=>x(w,{pinned:!p}),icon:p?Object(e.jsx)(h.IconPinFilled,{}):Object(e.jsx)(h.IconPinOutline,{})})}},{title:"Name",dataIndex:"name",render:function(p,C){let{short_id:w,derived_name:fe,description:Y}=C;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(y.Link,{className:Object(ae.default)("font-semibold",!p&&"italic"),to:v.a.sessionRecordingPlaylist(w),children:p||fe||"(Untitled)"}),Y?Object(e.jsx)("div",{className:"truncate",children:Y}):null]})}},K(R({},Object(_.b)()),{width:0}),{title:"Last modified",sorter:!0,dataIndex:"last_modified_at",width:0,render:function(p){return Object(e.jsx)("div",{children:p&&typeof p=="string"&&Object(e.jsx)(te.TZLabel,{time:p})})}},{width:0,render:function(p,C){return Object(e.jsx)(ie.a,{overlay:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(y.LemonButton,{status:"stealth",onClick:()=>L(C),fullWidth:!0,"data-attr":"duplicate-playlist",loading:a,children:"Duplicate"}),Object(e.jsx)(y.LemonDivider,{}),Object(e.jsx)(y.LemonButton,{status:"danger",onClick:()=>ge(C),fullWidth:!0,loading:a,children:"Delete playlist"})]})})}}];return Object(e.jsxs)("div",{className:"space-y-4",children:[Object(e.jsxs)("div",{className:"flex justify-between gap-2 mb-2 items-center flex-wrap",children:[Object(e.jsx)(y.LemonInput,{type:"search",placeholder:"Search for playlists",onChange:m=>u({search:m||void 0}),value:o.search||""}),Object(e.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[Object(e.jsx)("div",{className:"flex items-center gap-2",children:Object(e.jsx)(y.LemonButton,{"data-attr":"session-recording-playlist-pinned-filter",active:o.pinned,size:"small",type:"secondary",status:"stealth",center:!0,onClick:()=>u({pinned:!o.pinned}),icon:o.pinned?Object(e.jsx)(h.IconPinFilled,{}):Object(e.jsx)(h.IconPinOutline,{}),children:"Pinned"})}),Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("span",{children:"Last modified:"}),Object(e.jsx)(ee.a,{disabled:!1,dateFrom:o.dateFrom,dateTo:o.dateTo,onChange:(m,p)=>u({dateFrom:m,dateTo:p!=null?p:void 0}),makeLabel:m=>Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(h.IconCalendar,{}),Object(e.jsxs)("span",{className:"hide-when-small",children:[" ",m]})]})})]}),Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("span",{children:"Created by:"}),Object(e.jsx)(y.LemonSelect,{size:"small",options:[{value:"All users",label:"All Users"},...pe.map(m=>({value:m.user.id,label:m.user.first_name}))],value:o.createdBy,onChange:m=>{u({createdBy:m})},dropdownMatchSelectWidth:!1})]})]})]}),!a&&i.count<1?Object(e.jsx)(le,{}):Object(e.jsx)(y.LemonTable,{loading:a,columns:be,dataSource:i.results,pagination:c,noSortingCancellation:!0,sorting:g,onSort:m=>u({order:m?`${m.order===-1?"-":""}${m.columnKey}`:void 0}),rowKey:"id",loadingSkeletonRows:A,nouns:["playlist","playlists"]})]})}try{E.displayName="SavedSessionRecordingPlaylists",E.__docgenInfo={description:"",displayName:"SavedSessionRecordingPlaylists",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"SessionRecordingsTabs.Playlists"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/session-recordings/saved-playlists/SavedSessionRecordingPlaylists.tsx#SavedSessionRecordingPlaylists"]={docgenInfo:E.__docgenInfo,name:"SavedSessionRecordingPlaylists",path:"frontend/src/scenes/session-recordings/saved-playlists/SavedSessionRecordingPlaylists.tsx#SavedSessionRecordingPlaylists"})}catch(n){}var U=s("./frontend/src/scenes/session-recordings/sessionRecordingsLogic.ts"),$=s("./frontend/src/lib/components/Spinner/Spinner.tsx"),z=s("./frontend/src/scenes/session-recordings/settings/SessionRecordingSettings.tsx"),oe=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/lib/upload/Dragger.js"),re=s.n(oe),ce=s("./frontend/src/scenes/session-recordings/player/SessionRecordingPlayer.tsx");const G=Object(r.kea)([Object(r.path)(["scenes","session-recordings","detail","sessionRecordingDetailLogic"]),Object(r.connect)({actions:[D.e,["reportRecordingLoadedFromFile"]]}),Object(V.loaders)(n=>{let{actions:t}=n;return{sessionRecording:{__default:null,loadFromFile:l=>P(this,null,function*(){try{const i=yield new Promise((o,g)=>{const c=new FileReader;c.onload=u=>{var x;o((x=u.target)===null||x===void 0?void 0:x.result)},c.onerror=u=>{g(u)},c.readAsText(l)}),a=JSON.parse(i);if(!a.version||!a.data)throw new Error("File does not appear to be a valid session recording export");if(a.version==="2022-12-02")return t.reportRecordingLoadedFromFile({success:!0}),a.data;throw new Error("File version is not supported")}catch(i){return t.reportRecordingLoadedFromFile({success:!1,error:`${i}`}),y.lemonToast.error(`File import failed: ${i}`),null}}),resetSessionRecording:()=>null}}}),Object(r.reducers)({playerKey:["file-playback",{loadFromFileSuccess:()=>`file-playback-${Object(S.Lb)()}`,resetSessionRecording:()=>"file-playback"}]}),Object(F.beforeUnload)(n=>{let{values:t,actions:l}=n;return{enabled:()=>!!t.sessionRecording,message:"The loaded session recording will be lost. Are you sure you want to leave?",onConfirm:()=>{l.resetSessionRecording()}}}),Object(r.selectors)({breadcrumbs:[()=>[],()=>[{name:"Recordings",path:v.a.sessionRecordings()},{name:"Import"}]]})]);var de=s("./frontend/src/scenes/userLogic.ts"),ue=s("./frontend/src/lib/components/PayGatePage/PayGatePage.tsx");function je(){const{loadFromFile:n,resetSessionRecording:t}=Object(r.useActions)(G),{sessionRecording:l,sessionRecordingLoading:i,playerKey:a}=Object(r.useValues)(G),{hasAvailableFeature:o}=Object(r.useValues)(de.a);return o(f.e.RECORDINGS_FILE_EXPORT)?Object(e.jsx)("div",{children:i?Object(e.jsx)($.b,{}):l?Object(e.jsxs)("div",{className:"space-y-2",children:[Object(e.jsx)(O.a,{type:"info",action:{onClick:()=>t(),children:"Load a different recording"},children:"You are viewing a recording loaded from a file."}),Object(e.jsx)(ce.a,{sessionRecordingId:"",sessionRecordingData:l,playerKey:a})]}):Object(e.jsx)(re.a,{name:"file",multiple:!1,accept:".json",showUploadList:!1,beforeUpload:c=>(n(c),!1),children:Object(e.jsxs)("div",{className:"p-20 flex flex-col items-center justify-center space-y-2 text-muted-alt",children:[Object(e.jsxs)("p",{className:"flex items-center gap-2 font-semibold",children:[Object(e.jsx)(h.IconUploadFile,{className:"text-xl"}),"Load recording"]}),Object(e.jsx)("p",{className:"text-muted-alt ",children:"Drag and drop your exported recording here or click to open the file browser."})]})})}):Object(e.jsx)(ue.a,{featureKey:f.e.RECORDINGS_FILE_EXPORT,featureName:"Recording Exports",header:Object(e.jsxs)(e.Fragment,{children:["Export and playback ",Object(e.jsx)("span",{className:"highlight",children:"Recordings from file"}),"!"]}),caption:"Store your recordings outside of PostHog wherever you like.",docsLink:"https://posthog.com/docs/user-guides/session-recordings"})}var me=s("./frontend/src/lib/hooks/useAsyncHandler.ts");function H(){const{currentTeam:n}=Object(r.useValues)(I.a),{tab:t}=Object(r.useValues)(U.c),l=n&&!(n!=null&&n.session_recording_opt_in),{reportRecordingPlaylistCreated:i}=Object(r.useActions)(D.e),a=Object(me.a)(()=>P(this,null,function*(){yield Object(T.a)({},!0),i("new")}));return Object(e.jsxs)("div",{className:"-mb-12",children:[Object(e.jsx)(b.a,{title:Object(e.jsx)("div",{children:"Session Recordings"}),buttons:Object(e.jsxs)(e.Fragment,{children:[t===f.Z.Recent&&!l&&Object(e.jsx)(y.LemonButton,{type:"secondary",icon:Object(e.jsx)(h.IconSettings,{}),onClick:()=>Object(z.b)(),children:"Configure"}),t===f.Z.Playlists&&Object(e.jsx)(y.LemonButton,{type:"primary",onClick:a.onEvent,"data-attr":"save-recordings-playlist-button",loading:a.loading,children:"New playlist"})]})}),Object(e.jsx)(Z.a,{activeKey:t,animated:!1,style:{borderColor:"#D9D9D9"},onChange:o=>F.router.actions.push(v.a.sessionRecordings(o)),children:Object.values(f.Z).map(o=>Object(e.jsx)(Z.a.TabPane,{tab:Object(U.b)(o)},o))}),l?Object(e.jsx)("div",{className:"mb-4",children:Object(e.jsx)(O.a,{type:"info",action:{type:"secondary",icon:Object(e.jsx)(h.IconSettings,{}),onClick:()=>Object(z.b)(),children:"Configure"},children:"Session recordings are currently disabled for this project."})}):null,t?t===f.Z.Recent?Object(e.jsx)(N.a,{updateSearchParams:!0}):t===f.Z.Playlists?Object(e.jsx)(E,{tab:f.Z.Playlists}):t===f.Z.FilePlayback?Object(e.jsx)(je,{}):null:Object(e.jsx)($.a,{})]})}const ye={component:H,logic:U.c}}}]);
