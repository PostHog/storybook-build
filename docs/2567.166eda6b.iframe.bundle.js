"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[2567],{"./frontend/src/scenes/notebooks/NotebooksScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{NotebooksScene:()=>NotebooksScene,scene:()=>scene});__webpack_require__("./frontend/src/scenes/notebooks/NotebookScene.scss");var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.4.11_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),file_utils=__webpack_require__("./frontend/src/lib/utils/file-utils.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),MemberSelect=__webpack_require__("./frontend/src/lib/components/MemberSelect.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonMenu=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMenu/index.ts"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),LemonSelectMultiple=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelectMultiple/index.ts"),es=__webpack_require__("./node_modules/.pnpm/posthog-js@1.100.0/node_modules/posthog-js/dist/es.js"),types=__webpack_require__("./frontend/src/types.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const fromNodeTypeToLabel={[types.Cz.FeatureFlag]:"Feature flags",[types.Cz.FeatureFlagCodeExample]:"Feature flag Code Examples",[types.Cz.Experiment]:"Experiments",[types.Cz.EarlyAccessFeature]:"Early Access Features",[types.Cz.Survey]:"Surveys",[types.Cz.Image]:"Images",[types.Cz.Person]:"Persons",[types.Cz.Query]:"Queries",[types.Cz.Recording]:"Session recordings",[types.Cz.RecordingPlaylist]:"Session replay playlists",[types.Cz.ReplayTimestamp]:"Session recording comments",[types.Cz.Cohort]:"Cohorts",[types.Cz.Group]:"Groups"};function ContainsTypeFilters(_ref){let{filters,setFilters}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Containing:"}),(0,jsx_runtime.jsx)(LemonSelectMultiple.E,{mode:"multiple",selectClassName:"min-w-[10rem]",placeholder:"Any content",options:Object.entries(fromNodeTypeToLabel).filter((entry=>""!==entry[1])).reduce(((acc,_ref2)=>{let[type,label]=_ref2;return acc[type]={label},acc}),{}),value:filters.contains,onChange:newValue=>{es.ZP.capture("notebook containing filter applied"),setFilters({contains:newValue.map((x=>x))})},"data-attr":"notebooks-list-contains-filters"})]})}var kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),notebooksModel=__webpack_require__("./frontend/src/models/notebooksModel.ts");const DEFAULT_FILTERS={search:"",createdBy:null,contains:[]},notebooksTableLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","notebooks","NotebooksTable","notebooksTableLogic"]),(0,index_esm.actions)({loadNotebooks:!0,setFilters:filters=>({filters}),setSortValue:sortValue=>({sortValue}),setPage:page=>({page})}),(0,index_esm.connect)({values:[notebooksModel.L,["notebookTemplates"]],actions:[notebooksModel.L,["deleteNotebookSuccess"]]}),(0,index_esm.reducers)({filters:[DEFAULT_FILTERS,{setFilters:(state,_ref)=>{let{filters}=_ref;return(0,utils.hO)({...state||{},...filters})}}],sortValue:[null,{setSortValue:(_,_ref2)=>{let{sortValue}=_ref2;return sortValue}}],page:[1,{setPage:(_,_ref3)=>{let{page}=_ref3;return page},setFilters:()=>1,setSortValue:()=>1}]}),(0,kea_loaders_lib.loaders)((_ref4=>{let{values}=_ref4;return{notebooksResponse:[null,{loadNotebooks:async(_,breakpoint)=>{var _values$sortValue;await breakpoint(100);const contains=values.filters?.contains.map((type=>({type,attrs:{}})))||void 0,createdByForQuery=values.filters?.createdBy===DEFAULT_FILTERS.createdBy?void 0:values.filters?.createdBy,res=await api.ZP.notebooks.list({contains,created_by:null!=createdByForQuery?createdByForQuery:void 0,search:values.filters?.search||void 0,order:null!==(_values$sortValue=values.sortValue)&&void 0!==_values$sortValue?_values$sortValue:"-last_modified_at",limit:50,offset:50*(values.page-1)});return breakpoint(),res}}]}})),(0,index_esm.listeners)((_ref5=>{let{actions}=_ref5;return{setFilters:()=>actions.loadNotebooks(),setSortValue:()=>actions.loadNotebooks(),setPage:()=>actions.loadNotebooks(),deleteNotebookSuccess:()=>actions.loadNotebooks()}})),(0,index_esm.selectors)((_ref6=>{let{actions}=_ref6;return{notebooksAndTemplates:[s=>[s.notebooks,s.notebookTemplates,s.filters],(notebooks,notebookTemplates,filters)=>[...(0,utils.h0)(filters,DEFAULT_FILTERS)?notebookTemplates:[],...notebooks]],notebooks:[s=>[s.notebooksResponse],notebooksResponse=>notebooksResponse?.results||[]],pagination:[s=>[s.page,s.notebooksResponse],(page,notebooksResponse)=>{var _notebooksResponse$co;return{controlled:!0,pageSize:50,currentPage:page,entryCount:null!==(_notebooksResponse$co=notebooksResponse?.count)&&void 0!==_notebooksResponse$co?_notebooksResponse$co:0,onBackward:()=>actions.setPage(page-1),onForward:()=>actions.setPage(page+1)}}]}}))]);var notebookPanelLogic=__webpack_require__("./frontend/src/scenes/notebooks/NotebookPanel/notebookPanelLogic.ts");function NotebooksTable(){const{notebooksAndTemplates,filters,notebooksResponseLoading,notebookTemplates,sortValue,pagination}=(0,index_esm.useValues)(notebooksTableLogic),{loadNotebooks,setFilters,setSortValue}=(0,index_esm.useActions)(notebooksTableLogic),{selectNotebook}=(0,index_esm.useActions)(notebookPanelLogic.F);(0,react.useEffect)((()=>{loadNotebooks()}),[]);const columns=[{title:"Title",dataIndex:"title",width:"100%",render:function Render(title,_ref){let{short_id,is_template}=_ref;return(0,jsx_runtime.jsxs)(Link.r,{"data-attr":"notebook-title",to:urls.j.notebook(short_id),className:"font-semibold flex items-center gap-2",children:[title||"Untitled",is_template&&(0,jsx_runtime.jsx)(src.LemonTag,{type:"highlight",children:"TEMPLATE"})]})},sorter:(a,b)=>{var _a$title,_b$title;return(null!==(_a$title=a.title)&&void 0!==_a$title?_a$title:"Untitled").localeCompare(null!==(_b$title=b.title)&&void 0!==_b$title?_b$title:"Untitled")}},(0,columnUtils.JB)(),(0,columnUtils.pD)("created_at","Created"),(0,columnUtils.pD)("last_modified_at","Last modified"),{render:function Render(_,notebook){return(0,jsx_runtime.jsx)(LemonMenu.d,{items:[{items:[{label:"Delete",icon:(0,jsx_runtime.jsx)(icons.Fzz,{}),status:"danger",onClick:()=>{notebooksModel.L.actions.deleteNotebook(notebook.short_id,notebook?.title)}}]}],actionable:!0,children:(0,jsx_runtime.jsx)(src.LemonButton,{"aria-label":"more",icon:(0,jsx_runtime.jsx)(icons.YRX,{}),size:"small"})})}}];return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",action:{onClick:()=>{selectNotebook(notebookTemplates[0].short_id)},children:"Get started"},dismissKey:"notebooks-preview-banner",children:[(0,jsx_runtime.jsx)("b",{children:"Welcome to Notebooks"})," - a great way to bring Insights, Replays, Feature Flags and many more PostHog products together into one place."]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between gap-2 flex-wrap",children:[(0,jsx_runtime.jsx)(src.LemonInput,{type:"search",placeholder:"Search for notebooks",onChange:s=>{setFilters({search:s})},value:filters.search,"data-attr":"notebooks-search"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,jsx_runtime.jsx)(ContainsTypeFilters,{filters,setFilters}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Created by:"}),(0,jsx_runtime.jsx)(MemberSelect.a,{value:filters.createdBy,onChange:user=>setFilters({createdBy:user?.uuid||null})})]})]})]}),(0,jsx_runtime.jsx)(LemonTable.g,{"data-attr":"notebooks-table",pagination,dataSource:notebooksAndTemplates,rowKey:"short_id",columns,loading:notebooksResponseLoading,defaultSorting:{columnKey:"-created_at",order:1},emptyState:"No notebooks matching your filters!",nouns:["notebook","notebooks"],sorting:sortValue?{columnKey:sortValue,order:sortValue.startsWith("-")?-1:1}:void 0,onSort:newSorting=>setSortValue(newSorting?`${-1===newSorting.order?"-":""}${newSorting.columnKey}`:null)})]})}const scene={component:NotebooksScene};function NotebooksScene(){return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonMenu,{items:[{label:"Load from JSON",onClick:()=>{(0,file_utils.l)({contentType:"application/json",multiple:!1}).then((files=>(0,file_utils.m)(files[0]))).then((text=>{if("doc"!==JSON.parse(text).type)throw new Error("Not a notebook");lib.router.actions.push(urls.j.canvas(),{},{"ðŸ¦”":(0,utils.h$)(text)})})).catch((e=>{src.lemonToast.error(e.message)}))}}],children:(0,jsx_runtime.jsx)(src.LemonButton,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{}),size:"small"})}),(0,jsx_runtime.jsx)(src.LemonButton,{"data-attr":"new-notebook",to:urls.j.notebook("new"),type:"primary",children:"New notebook"})]})}),(0,jsx_runtime.jsx)(NotebooksTable,{})]})}}}]);