"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[48861],{"./frontend/src/scenes/data-warehouse/external/forms/SyncMethodForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>SyncMethodForm});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonRadio/index.ts"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let getIncrementalSyncSupported=schema=>schema.incremental_available?0===schema.incremental_fields.length?{disabled:!0,disabledReason:"No incremental fields found on table"}:{disabled:!1}:{disabled:!0,disabledReason:"Incremental append replication isn't supported on this table"},hasInputChanged=(newSchemaSyncType,newSchemaIncrementalField,originalSchemaSyncType,originalSchemaIncrementalField)=>originalSchemaSyncType!==newSchemaSyncType||"incremental"===newSchemaSyncType&&newSchemaIncrementalField!==originalSchemaIncrementalField,getSaveDisabledReason=(syncType,incrementalField)=>syncType?"incremental"!==syncType||incrementalField?void 0:"You must select an incremental field":"You must select a sync method before saving",SyncMethodForm=_ref=>{var _schema$sync_type,_schema$incremental_f,_schema$sync_type2,_schema$incremental_f2,_schema$incremental_f4;let{schema,onClose,onSave,saveButtonIsLoading,showRefreshMessageOnChange}=_ref,[originalSchemaSyncType]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$sync_type=schema.sync_type)&&void 0!==_schema$sync_type?_schema$sync_type:null),[originalSchemaIncrementalField]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$incremental_f=schema.incremental_field)&&void 0!==_schema$incremental_f?_schema$incremental_f:null),[radioValue,setRadioValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$sync_type2=schema.sync_type)&&void 0!==_schema$sync_type2?_schema$sync_type2:void 0),[incrementalFieldValue,setIncrementalFieldValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$incremental_f2=schema.incremental_field)&&void 0!==_schema$incremental_f2?_schema$incremental_f2:null);(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{var _schema$sync_type3,_schema$incremental_f3;setRadioValue(null!==(_schema$sync_type3=schema.sync_type)&&void 0!==_schema$sync_type3?_schema$sync_type3:void 0),setIncrementalFieldValue(null!==(_schema$incremental_f3=schema.incremental_field)&&void 0!==_schema$incremental_f3?_schema$incremental_f3:null)},[schema.table]);let incrementalSyncSupported=getIncrementalSyncSupported(schema),inputChanged=hasInputChanged(null!=radioValue?radioValue:null,incrementalFieldValue,originalSchemaSyncType,originalSchemaIncrementalField);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__._,{radioPosition:"top",value:radioValue,options:[{value:"incremental",disabledReason:incrementalSyncSupported.disabled&&incrementalSyncSupported.disabledReason||void 0,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-6 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-2.5",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h2",{className:"mb-0 mr-2",children:"Incremental append replication"}),!incrementalSyncSupported.disabled&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{type:"success",children:"Recommended"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"When using incremental append replication, we'll store the max value of the below field on each sync and only sync rows with greater or equal value on the next run."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:["You should pick a field that increments for each row, such as a"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("code",{children:"created_at"})," timestamp."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:["This method will append all new rows to your existing table - this means duplicate data can exist if the incremental field updates for updated rows (such as when using an ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("code",{children:"updated_at"})," field)"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Yv,{value:incrementalFieldValue,onChange:newValue=>setIncrementalFieldValue(newValue),options:null!==(_schema$incremental_f4=schema.incremental_fields.map(n=>({value:n.field,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{className:"leading-5",children:n.label}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{className:"ml-2",type:"success",children:n.type})]})})))&&void 0!==_schema$incremental_f4?_schema$incremental_f4:[],disabledReason:incrementalSyncSupported.disabled?"":void 0})]})},{value:"full_refresh",label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-6 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-2.5",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h2",{className:"mb-0 mr-2",children:"Full table replication"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"We'll replicate the whole table on every sync. This can take longer to sync and increase your monthly billing."})]})}],onChange:newValue=>setRadioValue(newValue)}),inputChanged&&showRefreshMessageOnChange&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"text-danger",children:"Note: Changing the sync type or incremental append replication field will trigger a full table refresh"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"flex flex-row justify-end w-full",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{className:"mr-3",type:"secondary",onClick:onClose,children:"Close"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{type:"primary",loading:saveButtonIsLoading,disabledReason:getSaveDisabledReason(radioValue,incrementalFieldValue),onClick:()=>{if("incremental"===radioValue){let fieldSelected=schema.incremental_fields.find(n=>n.field===incrementalFieldValue);if(!fieldSelected){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Selected field for incremental append replication not found");return}onSave("incremental",incrementalFieldValue,fieldSelected.field_type)}else onSave("full_refresh",null,null)},children:"Save"})]})]})}},"./frontend/src/scenes/data-warehouse/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>defaultQuery});var _queries_schema__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/queries/schema.ts");let defaultQuery=(table,columns)=>({kind:_queries_schema__WEBPACK_IMPORTED_MODULE_0__.OH.DataVisualizationNode,source:{kind:_queries_schema__WEBPACK_IMPORTED_MODULE_0__.OH.HogQLQuery,query:`SELECT ${columns.filter(_ref=>{let{table,fields,chain,schema_valid}=_ref;return!table&&!fields&&!chain&&schema_valid}).map(_ref2=>{let{name}=_ref2;return name})} FROM ${"numbers"===table?"numbers(0, 10)":table} LIMIT 100`}})},"./frontend/src/scenes/pipeline/hogfunctions/integrations/IntegrationChoice.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>IntegrationChoice});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.8.4_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts"),lib_integrations_integrationsLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/integrations/integrationsLogic.ts"),lib_integrations_IntegrationView__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/integrations/IntegrationView.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/utils.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/urls.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function IntegrationChoice(_ref){let{onChange,value,integration,redirectUrl,beforeRedirect}=_ref,{integrationsLoading,integrations}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(lib_integrations_integrationsLogic__WEBPACK_IMPORTED_MODULE_4__.a),{newGoogleCloudKey}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(lib_integrations_integrationsLogic__WEBPACK_IMPORTED_MODULE_4__.a),integrationsOfKind=integrations?.filter(x=>x.kind===integration),integrationKind=integrationsOfKind?.find(integration=>integration.id===value);if(!integration)return null;if(integrationsLoading)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.yW,{className:"h-10"});let kindName="google-pubsub"==integration?"Google Cloud Pub/Sub":"google-cloud-storage"==integration?"Google Cloud Storage":"google-ads"==integration?"Google Ads":(0,lib_utils__WEBPACK_IMPORTED_MODULE_6__.fm)(integration),button=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.d6,{items:[integrationsOfKind?.length?{items:[...integrationsOfKind?.map(integration=>({icon:react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx("img",{src:integration.icon_url,className:"w-6 h-6 rounded"}),onClick:()=>onChange?.(integration.id),active:integration.id===value,label:integration.display_name}))||[]]}:null,["google-pubsub","google-cloud-storage"].includes(integration)?{items:[{onClick:()=>(function(kind){let input=document.createElement("input");input.type="file",input.accept=".json",input.onchange=async e=>{let file=e.target.files?.[0];file&&newGoogleCloudKey(kind,file,integration=>onChange?.(integration.id))},input.click()})(integration),label:"Upload Google Cloud .json key file"}]}:{items:[{to:lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.integrations.authorizeUrl({kind:integration,next:redirectUrl}),disableClientSideRouting:!0,onClick:beforeRedirect,label:integrationsOfKind?.length?`Connect to a different ${integration} integration`:`Connect to ${integration}`}]},{items:[{to:scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.settings("project-integrations"),label:"Manage integrations",sideIcon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconExternal,{})},value?{onClick:()=>onChange?.(null),label:"Clear",sideIcon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconX,{})}:null]}],children:integrationKind?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"secondary",children:"Change"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"secondary",children:["Choose ",kindName," connection"]})});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.Fragment,{children:integrationKind?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_integrations_IntegrationView__WEBPACK_IMPORTED_MODULE_5__.K,{integration:integrationKind,suffix:button}):button})}}}]);