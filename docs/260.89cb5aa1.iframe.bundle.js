(window.webpackJsonp=window.webpackJsonp||[]).push([[260],{"./frontend/src/scenes/feature-flags/FeatureFlags.tsx":function(Q,P,e){"use strict";e.r(P),e.d(P,"scene",function(){return _}),e.d(P,"FeatureFlags",function(){return m}),e.d(P,"groupFilters",function(){return i});var p=e("./node_modules/core-js/modules/es.array.includes.js"),X=e.n(p),b=e("./node_modules/core-js/modules/es.array.some.js"),Z=e.n(b),x=e("./node_modules/core-js/modules/es.function.name.js"),w=e.n(x),S=e("./node_modules/core-js/modules/es.number.constructor.js"),k=e.n(S),N=e("./node_modules/react/index.js"),t=e.n(N),O=e("./node_modules/kea/lib/index.esm.js"),y=e("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),V=e("./node_modules/antd/es/input/index.js"),A=e("./node_modules/antd/es/tabs/index.js"),G=e("./frontend/src/lib/components/Link.tsx"),Y=e("./frontend/src/lib/utils.tsx"),h=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),J=e("./frontend/src/lib/components/PageHeader.tsx"),C=e("./frontend/src/lib/components/LinkButton.tsx"),j=e("./frontend/src/lib/components/Table/utils.tsx"),g=e("./frontend/src/scenes/urls.ts"),D=e("./frontend/src/lib/utils/stringWithWBR.tsx"),z=e("./frontend/src/scenes/teamLogic.ts"),L=e("./frontend/src/lib/components/LemonButton/index.ts"),$=e("./frontend/src/lib/components/LemonRow/index.ts"),I=e("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),H=e("./frontend/src/lib/components/LemonTable/index.ts"),F=e("./frontend/src/lib/components/LemonButton/More.tsx"),R=e("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),B=e("./frontend/src/lib/components/PropertyFilters/components/PropertyFiltersDisplay.tsx"),W=e("./frontend/src/lib/logic/featureFlagLogic.ts"),K=e("./frontend/src/lib/constants.tsx"),o=e("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),a=e("./frontend/src/scenes/feature-flags/activityDescriptions.tsx"),l=e("./frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),_={component:m,logic:y.a};function c(){var u=Object(O.useValues)(z.a),s=u.currentTeamId,r=Object(O.useValues)(y.a),T=r.featureFlagsLoading,d=r.searchedFeatureFlags,E=r.searchTerm,v=Object(O.useActions)(y.a),q=v.updateFeatureFlag,ee=v.loadFeatureFlags,te=v.setSearchTerm,ne=Object(O.useValues)(W.a),ae=ne.featureFlags,re=ae[K.n.FEATURE_FLAGS_ACTIVITY_LOG],se=[{title:Object(j.a)("Key"),dataIndex:"key",className:"ph-no-capture",sticky:!0,width:"40%",sorter:function(f,n){return(f.key||"").localeCompare(n.key||"")},render:function(f,n){return t.a.createElement(t.a.Fragment,null,t.a.createElement(G.a,{to:n.id?g.a.featureFlag(n.id):void 0,className:"row-name"},Object(D.a)(n.key,17)),n.name&&t.a.createElement("span",{className:"row-description"},n.name))}},Object(R.b)(),Object(R.a)(),{title:"Rollout",width:200,render:function(f,n){return i(n.filters.groups)}},{title:"Status",dataIndex:"active",sorter:function(f,n){return Number(f.active)-Number(n.active)},width:100,render:function(f,n){var U="feature-flag-".concat(n.id,"-switch");return t.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},t.a.createElement("label",{htmlFor:U},n.active?"Enabled":"Disabled"),t.a.createElement(I.a,{id:U,checked:n.active,onChange:function(oe){return n.id?q({id:n.id,payload:{active:oe}}):null},style:{marginLeft:"0.5rem"}}))}},{width:0,render:function(f,n){return t.a.createElement(F.a,{overlay:t.a.createElement(t.a.Fragment,null,t.a.createElement(L.a,{type:"stealth",onClick:function(){Object(Y.t)(n.key,"feature flag key")},fullWidth:!0},"Copy key"),n.id&&t.a.createElement(L.a,{type:"stealth",to:g.a.featureFlag(n.id),fullWidth:!0},"Edit"),t.a.createElement(L.a,{type:"stealth",to:g.a.insightNew({events:[{id:"$pageview",name:"$pageview",type:"events",math:"dau"}],breakdown_type:"event",breakdown:"$feature/".concat(n.key)}),"data-attr":"usage",fullWidth:!0},"Try out in Insights"),t.a.createElement($.b,null),n.id&&t.a.createElement(L.a,{type:"stealth",style:{color:"var(--danger)"},onClick:function(){Object(Y.x)({endpoint:"projects/".concat(s,"/feature_flags"),object:{name:n.key,id:n.id},callback:ee})},fullWidth:!0},"Delete feature flag"))})}}];return t.a.createElement(t.a.Fragment,null,t.a.createElement("div",null,t.a.createElement(V.a.Search,{placeholder:"Search for feature flags",allowClear:!0,enterButton:!0,style:{maxWidth:400,width:"initial",flexGrow:1,marginBottom:"1rem"},value:E,onChange:function(f){te(f.target.value)}}),!re&&t.a.createElement("div",{className:"mb float-right"},t.a.createElement(C.a,{type:"primary",to:g.a.featureFlag("new"),"data-attr":"new-feature-flag",icon:t.a.createElement(h.a,null)},"New Feature Flag"))),t.a.createElement(H.a,{dataSource:d,columns:se,rowKey:"key",loading:T,defaultSorting:{columnKey:"key",order:1},pagination:{pageSize:100},nouns:["feature flag","feature flags"],"data-attr":"feature-flag-table"}))}function m(){var u=Object(O.useValues)(W.a),s=u.featureFlags,r=s[K.n.FEATURE_FLAGS_ACTIVITY_LOG];return t.a.createElement("div",{className:"feature_flags"},t.a.createElement(J.a,{title:"Feature Flags",caption:r?"":"Feature Flags are a way of turning functionality in your app on or off, based on user properties.",buttons:r?t.a.createElement(C.a,{type:"primary",to:g.a.featureFlag("new"),"data-attr":"new-feature-flag",icon:t.a.createElement(h.a,null)},"New Feature Flag"):!1}),r?t.a.createElement(A.a,{defaultActiveKey:"overview",destroyInactiveTabPane:!0},t.a.createElement(A.a.TabPane,{tab:"Overview",key:"overview"},t.a.createElement(c,null)),t.a.createElement(A.a.TabPane,{tab:"Activity",key:"activity"},t.a.createElement(o.a,{scope:l.a.FEATURE_FLAG,describer:a.a}))):t.a.createElement(c,null))}function i(u){if(u.length===0||!u.some(function(E){return E.rollout_percentage!==0}))return"No users";if(u.some(function(E){var v;return!(!((v=E.properties)===null||v===void 0)&&v.length)&&[null,void 0,100].includes(E.rollout_percentage)}))return"All users";if(u.length===1){var s=u[0],r=s.properties,T=s.rollout_percentage,d=T===void 0?null:T;return(r==null?void 0:r.length)>0&&d!=null?t.a.createElement("div",{style:{display:"flex",alignItems:"center"}},t.a.createElement("span",{style:{flexShrink:0,marginRight:5}},d,"% of"),t.a.createElement(B.a,{filters:r,style:{margin:0,width:"100%"}})):(r==null?void 0:r.length)>0?t.a.createElement(B.a,{filters:r,style:{margin:0}}):d!==null?"".concat(d,"% of all users"):(console.error("A group with full rollout was not detected early"),"All users")}return"".concat(u.length," groups")}try{i.displayName="groupFilters",i.__docgenInfo={description:"",displayName:"groupFilters",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlags.tsx#groupFilters"]={docgenInfo:i.__docgenInfo,name:"groupFilters",path:"frontend/src/scenes/feature-flags/FeatureFlags.tsx#groupFilters"})}catch(u){}},"./frontend/src/scenes/feature-flags/featureFlagsLogic.ts":function(Q,P,e){"use strict";e.d(P,"a",function(){return K});var p=e("./node_modules/core-js/modules/es.array.concat.js"),X=e.n(p),b=e("./node_modules/core-js/modules/es.array.filter.js"),Z=e.n(b),x=e("./node_modules/core-js/modules/es.array.find.js"),w=e.n(x),S=e("./node_modules/core-js/modules/es.array.iterator.js"),k=e.n(S),N=e("./node_modules/core-js/modules/es.array.map.js"),t=e.n(N),O=e("./node_modules/core-js/modules/es.object.to-string.js"),y=e.n(O),V=e("./node_modules/core-js/modules/es.regexp.exec.js"),A=e.n(V),G=e("./node_modules/core-js/modules/es.string.search.js"),Y=e.n(G),h=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),J=e.n(h),C=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),j=e.n(C),g=e("./node_modules/@babel/runtime/regenerator/index.js"),D=e.n(g),z=e("./node_modules/regenerator-runtime/runtime.js"),L=e.n(z),$=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),I=e.n($),H=e("./node_modules/kea/lib/index.esm.js"),F=e("./frontend/src/lib/api.ts"),R=e("./node_modules/fuse.js/dist/fuse.esm.js"),B=e("./frontend/src/scenes/teamLogic.ts"),W=e("./frontend/src/scenes/urls.ts"),K=Object(H.kea)({path:["scenes","feature-flags","featureFlagsLogic"],connect:{values:[B.a,["currentTeamId"]]},actions:{updateFlag:function(a){return{flag:a}},deleteFlag:function(a){return{id:a}},setSearchTerm:function(a){return{searchTerm:a}}},loaders:function(a){var l=a.values;return{featureFlags:{__default:[],loadFeatureFlags:function(){var _=I()(D.a.mark(function m(){var i;return D.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,F.a.get("api/projects/".concat(l.currentTeamId,"/feature_flags/"));case 2:return i=s.sent,s.abrupt("return",i.results);case 4:case"end":return s.stop()}},m)}));function c(){return _.apply(this,arguments)}return c}(),updateFeatureFlag:function(){var _=I()(D.a.mark(function m(i){var u,s,r;return D.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return u=i.id,s=i.payload,d.next=3,F.a.update("api/projects/".concat(l.currentTeamId,"/feature_flags/").concat(u),s);case 3:return r=d.sent,d.abrupt("return",j()(l.featureFlags).map(function(E){return E.id===r.id?r:E}));case 5:case"end":return d.stop()}},m)}));function c(m){return _.apply(this,arguments)}return c}()}}},selectors:{searchedFeatureFlags:[function(o){return[o.featureFlags,o.searchTerm]},function(o,a){return a?new R.a(o,{keys:["key","name"],threshold:.3}).search(a).map(function(l){return l.item}):o}],breadcrumbs:[function(){return[]},function(){return[{name:"Feature Flags",path:W.a.featureFlags()}]}]},reducers:{searchTerm:{setSearchTerm:function(a,l){var _=l.searchTerm;return _}},featureFlags:{updateFlag:function(a,l){var _=l.flag;return a.find(function(c){var m=c.id;return m===_.id})?a.map(function(c){return c.id===_.id?_:c}):[_].concat(j()(a))},deleteFlag:function(a,l){var _=l.id;return a.filter(function(c){return c.id!==_})}}},events:function(a){var l=a.actions;return{afterMount:function(){l.loadFeatureFlags()}}}})}}]);
