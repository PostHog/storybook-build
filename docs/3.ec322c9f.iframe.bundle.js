(window.webpackJsonp=window.webpackJsonp||[]).push([[3,4,6,7,8,9,11,307],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(U,a,e){"use strict";e.r(a);var v=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),t=e.n(v),E=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),o=e.n(E),u={};u.insert="head",u.singleton=!1;var m=t()(o.a,u);a.default=o.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(U,a,e){"use strict";e.r(a),e.d(a,"AppMetricsGraph",function(){return F});var v=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),t=e.n(v),E=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),o=e.n(E),u=e("./node_modules/core-js/modules/es.array.concat.js"),m=e.n(u),b=e("./node_modules/core-js/modules/es.object.keys.js"),x=e.n(b),h=e("./node_modules/core-js/modules/es.symbol.js"),R=e.n(h),j=e("./node_modules/core-js/modules/es.array.filter.js"),D=e.n(j),p=e("./node_modules/core-js/modules/es.object.to-string.js"),i=e.n(p),d=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),P=e.n(d),L=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),C=e.n(L),c=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),T=e.n(c),I=e("./node_modules/react/index.js"),K=e.n(I),M=e("./frontend/src/lib/colors.ts"),V=e("./node_modules/chart.js/dist/chart.mjs"),W=e("./frontend/src/scenes/apps/constants.tsx"),G=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),Y=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),H=e("./frontend/src/lib/utils.tsx");function N(O,A){var s=Object.keys(O);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(O);A&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(O,r).enumerable})),s.push.apply(s,n)}return s}function J(O){for(var A=1;A<arguments.length;A++){var s=arguments[A]!=null?arguments[A]:{};A%2?N(Object(s),!0).forEach(function(n){t()(O,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(s)):N(Object(s)).forEach(function(n){Object.defineProperty(O,n,Object.getOwnPropertyDescriptor(s,n))})}return O}function F(O){var A=O.tab,s=O.metrics,n=O.metricsLoading,r=Object(I.useRef)(null),_=W.DescriptionColumns[A];return Object(I.useEffect)(function(){var l;if(r.current&&s){var f;l=new V.a((f=r.current)===null||f===void 0?void 0:f.getContext("2d"),{type:"line",data:{labels:s.dates,datasets:[J({label:_.successes,data:s.successes,borderColor:""},g("data-brand-blue"))].concat(o()(_.successes_on_retry?[J({label:_.successes_on_retry,data:s.successes_on_retry},g("data-yellow"))]:[]),[J({label:_.failures,data:s.failures},g("data-pink"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var B;(B=l)===null||B===void 0||B.destroy()}},[s]),n||!s?K.a.createElement(G.a,{className:"AppMetricsGraph"}):K.a.createElement("div",{className:"AppMetricsGraph"},K.a.createElement("canvas",{ref:r}))}function g(O){var A=Object(M.b)(O);return{borderColor:A,hoverBorderColor:Object(H.lb)(A,-20),hoverBackgroundColor:Object(H.lb)(A,-20),backgroundColor:A,fill:!1,borderWidth:2,pointRadius:0}}try{F.displayName="AppMetricsGraph",F.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:F.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(O){}},"./frontend/src/scenes/apps/HistoricalExport.tsx":function(U,a,e){"use strict";e.r(a),e.d(a,"HistoricalExport",function(){return R});var v=e("./node_modules/antd/es/card/index.js"),t=e("./node_modules/kea/lib/index.esm.js"),E=e("./node_modules/react/index.js"),o=e.n(E),u=e("./frontend/src/lib/utils.tsx"),m=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),b=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),x=e("./frontend/src/scenes/apps/historicalExportLogic.ts"),h=e("./frontend/src/scenes/apps/MetricsTab.tsx");function R(j){var D,p,i=Object(t.useValues)(Object(x.historicalExportLogic)(j)),d=i.data,P=i.dataLoading;return o.a.createElement("div",{className:"mt-4 mb-4 mr-8"},o.a.createElement(v.a,{title:"Overview"},d&&d.summary.duration?o.a.createElement("div",null,o.a.createElement("div",{className:"card-secondary"},"Export duration"),o.a.createElement("div",null,Object(u.O)(d.summary.duration))):null,o.a.createElement(h.MetricsOverview,{tab:b.AppMetricsTab.HistoricalExports,metrics:(D=d==null?void 0:d.metrics)!==null&&D!==void 0?D:null,metricsLoading:P})),o.a.createElement(v.a,{title:"Delivery trends",className:"mt-4"},o.a.createElement(m.AppMetricsGraph,{tab:b.AppMetricsTab.HistoricalExports,metrics:(p=d==null?void 0:d.metrics)!==null&&p!==void 0?p:null,metricsLoading:P})))}try{R.displayName="HistoricalExport",R.__docgenInfo={description:"",displayName:"HistoricalExport",props:{pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"]={docgenInfo:R.__docgenInfo,name:"HistoricalExport",path:"frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"})}catch(j){}},"./frontend/src/scenes/apps/HistoricalExportsTab.tsx":function(U,a,e){"use strict";e.r(a),e.d(a,"HistoricalExportsTab",function(){return p});var v=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),t=e.n(v),E=e("./node_modules/core-js/modules/es.array.concat.js"),o=e.n(E),u=e("./node_modules/react/index.js"),m=e.n(u),b=e("./node_modules/kea/lib/index.esm.js"),x=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),h=e("./frontend/src/lib/components/LemonTable/index.ts"),R=e("./frontend/src/scenes/apps/HistoricalExport.tsx"),j=e("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),D=e("./frontend/src/lib/components/LemonTag/LemonTag.tsx");function p(){var i=Object(b.useValues)(x.appMetricsSceneLogic),d=i.historicalExports,P=i.historicalExportsLoading,L=i.pluginConfig;return m.a.createElement(h.a,{dataSource:d,loading:P,columns:[{title:"Dates exported",render:function(c,T){var I=t()(T.payload.dateRange,2),K=I[0],M=I[1];return K===M?K:"".concat(K," - ").concat(M)}},{title:"Status",width:100,render:function(c,T){switch(T.status){case"success":return m.a.createElement(D.a,{type:"success",className:"uppercase"},"Success");case"fail":return m.a.createElement(D.a,{type:"danger",className:"uppercase"},"Failed");case"not_finished":return m.a.createElement(D.a,{type:"default",className:"uppercase"},"Running")}}},Object(j.b)(),Object(j.a)()],expandable:{expandedRowRender:function(c){if(!!L)return m.a.createElement(R.HistoricalExport,{pluginConfigId:L.id,jobId:c.job_id})}}})}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(U,a,e){"use strict";e.r(a),e.d(a,"MetricsTab",function(){return j}),e.d(a,"MetricsOverview",function(){return D});var v=e("./node_modules/react/index.js"),t=e.n(v),E=e("./node_modules/antd/es/card/index.js"),o=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),u=e("./frontend/src/scenes/apps/constants.tsx"),m=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),b=e("./frontend/src/lib/utils.tsx"),x=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),h=e("./frontend/src/lib/components/LemonSelect.tsx"),R=e("./node_modules/kea/lib/index.esm.js");function j(i){var d=i.tab,P=Object(R.useValues)(o.appMetricsSceneLogic),L=P.metrics,C=P.metricsLoading,c=P.dateFrom,T=Object(R.useActions)(o.appMetricsSceneLogic),I=T.setDateFrom;return t.a.createElement("div",{className:"mt-4"},t.a.createElement(E.a,{title:t.a.createElement("div",{className:"flex items-center justify-between gap-2"},t.a.createElement("span",null,"Metrics overview"),t.a.createElement(h.a,{value:c,onChange:function(M){return I(M)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]}))},t.a.createElement(D,{tab:d,metrics:L,metricsLoading:C})),t.a.createElement(E.a,{title:"Delivery trends",className:"mt-4"},t.a.createElement(x.AppMetricsGraph,{tab:d,metrics:L,metricsLoading:C})))}function D(i){var d,P,L,C=i.tab,c=i.metrics,T=i.metricsLoading;return T?t.a.createElement(m.a,{className:"h-20"}):t.a.createElement(t.a.Fragment,null,t.a.createElement("div",null,t.a.createElement("div",{className:"card-secondary"},u.DescriptionColumns[C].successes),t.a.createElement("div",null,p(c==null||(d=c.totals)===null||d===void 0?void 0:d.successes))),u.DescriptionColumns[C].successes_on_retry&&t.a.createElement("div",null,t.a.createElement("div",{className:"card-secondary"},u.DescriptionColumns[C].successes_on_retry),t.a.createElement("div",null,p(c==null||(P=c.totals)===null||P===void 0?void 0:P.successes_on_retry))),t.a.createElement("div",null,t.a.createElement("div",{className:"card-secondary"},u.DescriptionColumns[C].failures),t.a.createElement("div",null,p(c==null||(L=c.totals)===null||L===void 0?void 0:L.failures))))}function p(i){return t.a.createElement(t.a.Fragment,null,i&&Object(b.P)(i))}try{j.displayName="MetricsTab",j.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:j.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(i){}try{D.displayName="MetricsOverview",D.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:D.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(i){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(U,a,e){"use strict";e.r(a),e.d(a,"AppMetricsTab",function(){return g}),e.d(a,"appMetricsSceneLogic",function(){return A});var v=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),t=e.n(v),E=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),o=e.n(E),u=e("./node_modules/@babel/runtime/regenerator/index.js"),m=e.n(u),b=e("./node_modules/core-js/modules/es.array.iterator.js"),x=e.n(b),h=e("./node_modules/core-js/modules/es.object.to-string.js"),R=e.n(h),j=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),D=e.n(j),p=e("./node_modules/core-js/modules/es.array.concat.js"),i=e.n(p),d=e("./node_modules/core-js/modules/es.function.name.js"),P=e.n(d),L=e("./node_modules/core-js/modules/es.array.includes.js"),C=e.n(L),c=e("./node_modules/core-js/modules/es.string.includes.js"),T=e.n(c),I=e("./node_modules/core-js/modules/es.array.filter.js"),K=e.n(I),M=e("./node_modules/kea/lib/index.esm.js"),V=e("./node_modules/kea-loaders/lib/index.js"),W=e.n(V),G=e("./frontend/src/scenes/urls.ts"),Y=e("./frontend/src/lib/api.ts"),H=e("./frontend/src/scenes/teamLogic.tsx"),N=e("./node_modules/kea-router/lib/index.js"),J=e.n(N),F=e("./frontend/src/lib/utils.tsx"),g;(function(s){s.ProcessEvent="processEvent",s.OnEvent="onEvent",s.ExportEvents="exportEvents",s.HistoricalExports="historical_exports"})(g||(g={}));var O=[g.ProcessEvent,g.OnEvent,g.ExportEvents],A=Object(M.kea)([Object(M.path)(function(s){return["scenes","apps","appMetricsSceneLogic",s]}),Object(M.props)({}),Object(M.key)(function(s){return s.pluginConfigId}),Object(M.actions)({setActiveTab:function(n){return{tab:n}},setDateFrom:function(n){return{dateFrom:n}}}),Object(M.reducers)({activeTab:[null,{setActiveTab:function(n,r){var _=r.tab;return _}}],dateFrom:["-30d",{setDateFrom:function(n,r){var _=r.dateFrom;return _}}]}),Object(V.loaders)(function(s){var n=s.values,r=s.props;return{pluginConfig:[null,{loadPluginConfig:function(){var _=o()(m.a.mark(function f(){return m.a.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,Y.b.get("api/projects/".concat(H.a.values.currentTeamId,"/plugin_configs/").concat(r.pluginConfigId));case 2:return y.abrupt("return",y.sent);case 3:case"end":return y.stop()}},f)}));function l(){return _.apply(this,arguments)}return l}()}],metrics:[null,{loadMetrics:function(){var _=o()(m.a.mark(function f(){var B,y,Z;return m.a.wrap(function($){for(;;)switch($.prev=$.next){case 0:return B=Object(F.Eb)({category:n.activeTab,date_from:n.dateFrom}),$.next=3,Y.b.get("api/projects/".concat(H.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"?").concat(B));case 3:return y=$.sent,Z=y.results,$.abrupt("return",Z);case 6:case"end":return $.stop()}},f)}));function l(){return _.apply(this,arguments)}return l}()}],historicalExports:[[],{loadHistoricalExports:function(){var _=o()(m.a.mark(function f(){var B,y;return m.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,Y.b.get("api/projects/".concat(H.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/historical_exports"));case 2:return B=S.sent,y=B.results,S.abrupt("return",y);case 5:case"end":return S.stop()}},f)}));function l(){return _.apply(this,arguments)}return l}()}]}}),Object(M.selectors)(function(s){var n=s.values;return{breadcrumbs:[function(r){return[r.pluginConfig,function(_,l){return l.pluginConfigId}]},function(r,_){var l;return[{name:"Apps",path:G.a.projectApps()},{name:r==null||(l=r.plugin_info)===null||l===void 0?void 0:l.name,path:G.a.appMetrics(_)}]}],showTab:[function(){return[]},function(){return function(r){var _;if(n.pluginConfigLoading||!n.pluginConfig)return!1;var l=((_=n.pluginConfig.plugin_info.capabilities)===null||_===void 0?void 0:_.methods)||[];return r===g.HistoricalExports?l.includes("exportEvents"):r===g.OnEvent&&l.includes("exportEvents")?!1:l.includes(r)}}]}}),Object(M.listeners)(function(s){var n=s.values,r=s.actions;return{loadPluginConfigSuccess:function(){if(!n.activeTab){var l=O.filter(function(y){return n.showTab(y)}),f=t()(l,1),B=f[0];r.setActiveTab(B)}},setActiveTab:function(l){var f=l.tab;f===g.HistoricalExports?r.loadHistoricalExports():r.loadMetrics()},setDateFrom:function(){r.loadMetrics()}}}),Object(N.actionToUrl)(function(s){var n=s.values,r=s.props;return{setActiveTab:function(){var l;return n.activeTab===g.HistoricalExports?G.a.appHistoricalExports(r.pluginConfigId):G.a.appMetrics(r.pluginConfigId,(l=n.activeTab)!==null&&l!==void 0?l:void 0)}}}),Object(N.urlToAction)(function(s){var n=s.values,r=s.actions;return{"/app/:pluginConfigId/:page":function(l,f){n.pluginConfig||r.loadPluginConfig(),l.page===g.HistoricalExports?r.setActiveTab(g.HistoricalExports):f.tab&&O.includes(f.tab)&&r.setActiveTab(f.tab)}}})])},"./frontend/src/scenes/apps/constants.tsx":function(U,a,e){"use strict";e.r(a),e.d(a,"DescriptionColumns",function(){return u});var v=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),t=e.n(v),E=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),o,u=(o={},t()(o,E.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),t()(o,E.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),t()(o,E.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),t()(o,E.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),o)},"./frontend/src/scenes/apps/historicalExportLogic.ts":function(U,a,e){"use strict";e.r(a),e.d(a,"historicalExportLogic",function(){return C});var v=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),t=e.n(v),E=e("./node_modules/@babel/runtime/regenerator/index.js"),o=e.n(E),u=e("./node_modules/core-js/modules/es.array.concat.js"),m=e.n(u),b=e("./node_modules/core-js/modules/es.array.iterator.js"),x=e.n(b),h=e("./node_modules/core-js/modules/es.object.to-string.js"),R=e.n(h),j=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),D=e.n(j),p=e("./node_modules/kea/lib/index.esm.js"),i=e("./node_modules/kea-loaders/lib/index.js"),d=e.n(i),P=e("./frontend/src/lib/api.ts"),L=e("./frontend/src/scenes/teamLogic.tsx"),C=Object(p.kea)([Object(p.path)(["scenes","apps","historicalExportLogic"]),Object(p.props)({}),Object(p.key)(function(c){var T=c.pluginConfigId,I=c.jobId;return"".concat(T,"_").concat(I)}),Object(i.loaders)(function(c){var T=c.props;return{data:[null,{loadExportData:function(){var I=t()(o.a.mark(function M(){return o.a.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,P.b.get("api/projects/".concat(L.a.values.currentTeamId,"/app_metrics/").concat(T.pluginConfigId,"/historical_exports/").concat(T.jobId));case 2:return W.abrupt("return",W.sent);case 3:case"end":return W.stop()}},M)}));function K(){return I.apply(this,arguments)}return K}()}]}}),Object(p.events)(function(c){var T=c.actions;return{afterMount:T.loadExportData}})])},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(U,a,e){var v=e("./node_modules/css-loader/dist/runtime/api.js");a=v(!1),a.push([U.i,".AppMetricsGraph{height:300px}",""]),U.exports=a}}]);
