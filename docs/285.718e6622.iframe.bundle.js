(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{"./frontend/src/scenes/feature-flags/FeatureFlag.tsx":function(pe,C,t){"use strict";t.r(C),t.d(C,"scene",function(){return Jn}),t.d(C,"FeatureFlag",function(){return _t});var Q=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),w=t.n(Q),be=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),D=t.n(be),_e=t("./node_modules/core-js/modules/es.function.name.js"),Fe=t("./node_modules/core-js/modules/es.array.map.js"),ae=t("./node_modules/core-js/modules/es.object.to-string.js"),Ae=t("./node_modules/core-js/modules/es.regexp.to-string.js"),Ie=t("./node_modules/core-js/modules/es.array.find.js"),Ke=t("./node_modules/core-js/modules/es.array.includes.js"),oe=t("./node_modules/core-js/modules/es.string.includes.js"),Re=t("./node_modules/core-js/modules/es.array.concat.js"),ie=t("./node_modules/react/index.js"),ve=t("./node_modules/kea-forms/lib/index.js"),Oe=t("./node_modules/antd/es/divider/index.js"),P=t("./node_modules/antd/es/row/index.js"),K=t("./node_modules/antd/es/col/index.js"),E=t("./node_modules/antd/es/skeleton/index.js"),ue=t("./node_modules/antd/es/tabs/index.js"),ne=t("./node_modules/antd/es/popconfirm/index.js"),se=t("./node_modules/antd/es/radio/index.js"),me=t("./node_modules/antd/es/input-number/index.js"),T=t("./node_modules/antd/es/select/index.js"),j=t("./node_modules/kea/lib/index.esm.js"),R=t("./frontend/src/lib/utils.tsx"),fe=t("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Ce=t("./node_modules/@ant-design/icons/es/icons/LockOutlined.js"),qe=t("./node_modules/core-js/modules/es.object.keys.js"),et=t("./node_modules/core-js/modules/es.symbol.js"),k=t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),ze=t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),lt=t("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),Ot=t.n(lt),tt=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),q=t.n(tt),Je=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),We=t.n(Je),ct=t("./node_modules/@babel/runtime/regenerator/index.js"),M=t.n(ct),Ut=t("./node_modules/core-js/modules/es.regexp.exec.js"),ht=t("./node_modules/core-js/modules/es.string.match.js"),G=t("./node_modules/core-js/modules/es.array.splice.js"),J=t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),X=t("./node_modules/core-js/modules/es.array.iterator.js"),ee=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),we=t("./node_modules/core-js/modules/es.string.replace.js"),Le=t("./node_modules/core-js/modules/es.array.slice.js"),nt=t("./node_modules/core-js/modules/es.array.filter.js"),I=t("./frontend/src/types.ts"),he=t("./frontend/src/lib/api.ts"),le=t("./node_modules/kea-router/lib/index.js"),ce=t("./frontend/src/scenes/urls.ts"),dt=t("./frontend/src/scenes/teamLogic.tsx"),$=t("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),Xe=t("./frontend/src/models/groupsModel.ts"),Me=t("./frontend/src/lib/components/TaxonomicFilter/types.ts"),Wt=t("./frontend/src/lib/components/lemonToast.tsx"),Vt=t("./frontend/src/lib/utils/eventUsageLogic.ts"),ut=t("./node_modules/kea-loaders/lib/index.js"),bt=t("./frontend/src/scenes/insights/utils/cleanFilters.ts"),mt=t("./frontend/src/lib/dayjs.ts"),wt=t("./frontend/src/scenes/insights/sharedUtils.ts"),p=t("./node_modules/core-js/modules/es.promise.js"),g=t("./node_modules/core-js/modules/es.string.iterator.js"),f=t("./node_modules/core-js/modules/es.array.from.js"),_=t("./node_modules/core-js/modules/es.symbol.description.js"),B=t("./node_modules/core-js/modules/es.symbol.iterator.js");function N(s,n){var r=typeof Symbol!="undefined"&&s[Symbol.iterator]||s["@@iterator"];if(!r){if(Array.isArray(s)||(r=W(s))||n&&s&&typeof s.length=="number"){r&&(s=r);var a=0,i=function(){};return{s:i,n:function(){return a>=s.length?{done:!0}:{done:!1,value:s[a++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,d=!1,c;return{s:function(){r=r.call(s)},n:function(){var l=r.next();return o=l.done,l},e:function(l){d=!0,c=l},f:function(){try{!o&&r.return!=null&&r.return()}finally{if(d)throw c}}}}function W(s,n){if(!!s){if(typeof s=="string")return L(s,n);var r=Object.prototype.toString.call(s).slice(8,-1);if(r==="Object"&&s.constructor&&(r=s.constructor.name),r==="Map"||r==="Set")return Array.from(s);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L(s,n)}}function L(s,n){(n==null||n>s.length)&&(n=s.length);for(var r=0,a=new Array(n);r<n;r++)a[r]=s[r];return a}var b=Object(j.kea)([Object(j.path)(["scenes","feature-flags","featureFlagPermissionsLogic"]),Object(j.props)({}),Object(j.key)(function(s){return"".concat(s.flagId)}),Object(j.actions)({setModalOpen:function(n){return{visible:n}},setRolesToAdd:function(n){return{roleIds:n}}}),Object(j.reducers)({permissionModalVisible:[!1,{setModalOpen:function(n,r){var a=r.visible;return a}}],rolesToAdd:[[],{setRolesToAdd:function(n,r){var a=r.roleIds;return a}}]}),Object(ut.loaders)(function(s){var n=s.props,r=s.values,a=s.actions;return{unfilteredAddableRoles:[[],{loadPossibleRolesToAdd:function(){var i=q()(M.a.mark(function d(){var c;return M.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,he.b.roles.list({feature_flags_access_level:I.a.READ});case 2:return c=l.sent,l.abrupt("return",c.results||[]);case 4:case"end":return l.stop()}},d)}));function o(){return i.apply(this,arguments)}return o}()}],associatedRoles:[[],{loadAssociatedRoles:function(){var i=q()(M.a.mark(function d(){var c;return M.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!n.flagId){l.next=7;break}return l.next=3,he.b.resourceAccessPermissions.featureFlags.list(n.flagId);case 3:return c=l.sent,l.abrupt("return",c.results||[]);case 7:return l.abrupt("return",[]);case 8:case"end":return l.stop()}},d)}));function o(){return i.apply(this,arguments)}return o}(),addAssociatedRoles:function(){var i=q()(M.a.mark(function d(c){var m,l,O;return M.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(m=r.rolesToAdd,l=n.flagId||c,!l){h.next=8;break}return h.next=5,Promise.all(m.map(function(){var F=q()(M.a.mark(function v(V){return M.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,he.b.resourceAccessPermissions.featureFlags.create(l,V);case 2:return S.abrupt("return",S.sent);case 3:case"end":return S.stop()}},v)}));return function(v){return F.apply(this,arguments)}}()));case 5:return O=h.sent,a.setRolesToAdd([]),h.abrupt("return",[].concat(w()(r.associatedRoles),w()(O)));case 8:return h.abrupt("return",r.associatedRoles);case 9:case"end":return h.stop()}},d)}));function o(d){return i.apply(this,arguments)}return o}(),deleteAssociatedRole:function(){var i=q()(M.a.mark(function d(c){var m,l,O;return M.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(l=c.roleId,O=(m=r.associatedRoles.find(function(F){return F.role.id===l}))===null||m===void 0?void 0:m.id,!n.flagId){h.next=7;break}if(h.t0=O,!h.t0){h.next=7;break}return h.next=7,he.b.resourceAccessPermissions.featureFlags.delete(n.flagId,O);case 7:return h.abrupt("return",r.associatedRoles.filter(function(F){return F.id!==O}));case 8:case"end":return h.stop()}},d)}));function o(d){return i.apply(this,arguments)}return o}()}]}}),Object(j.selectors)({derivedRoles:[function(s){return[s.associatedRoles]},function(s){return s.map(function(n){return n.role})}],addableRoles:[function(s){return[s.unfilteredAddableRoles,s.associatedRoles]},function(s,n){var r=[],a=N(s),i;try{var o=function(){var c=i.value;n.some(function(m){return m.role.id===c.id})||r.push(c)};for(a.s();!(i=a.n()).done;)o()}catch(d){a.e(d)}finally{a.f()}return r}]}),Object(j.afterMount)(function(s){var n=s.actions;n.loadPossibleRolesToAdd(),n.loadAssociatedRoles()})]),U=t("./frontend/src/scenes/userLogic.ts"),H=["created_at","id"];function Be(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),r.push.apply(r,a)}return r}function u(s){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Be(Object(r),!0).forEach(function(a){We()(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Be(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}var yt=function(){return{operator:"gt",threshold_type:I.V.Sentry,threshold:50,threshold_metric:u({},Object(bt.a)({insight:I.F.TRENDS,date_from:Object(mt.a)().subtract(7,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(mt.a)().endOf("d").format("YYYY-MM-DDTHH:mm")}))}},ft={id:null,created_at:null,key:"",name:"",filters:{groups:[{properties:[],rollout_percentage:null,variant:void 0}],multivariate:null},deleted:!1,active:!0,created_by:null,is_simple_flag:!1,rollout_percentage:null,ensure_experience_continuity:!1,experiment_set:null,rollback_conditions:[],performed_rollback:!1,can_edit:!0},zt={key:"",name:"",rollout_percentage:0},$e={variants:[{key:"",name:"",rollout_percentage:100}]},fn=function(n){return{events:[{id:"$feature_flag_called",name:"$feature_flag_called",type:"events",properties:Jt(n)}]}},Jt=function(n){return[{key:"$feature/"+n,type:I.N.Event,value:["false"],operator:I.P.IsNot},{key:"$feature/"+n,type:I.N.Event,value:"is_set",operator:I.P.IsSet},{key:"$feature_flag",type:I.N.Event,value:n,operator:I.P.Exact}]},Se=Object(j.kea)([Object(j.path)(["scenes","feature-flags","featureFlagLogic"]),Object(j.props)({}),Object(j.key)(function(s){var n=s.id;return n!=null?n:"unknown"}),Object(j.connect)({values:[dt.a,["currentTeamId","sentryIntegrationEnabled"],Xe.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"],U.a,["hasAvailableFeature"]]}),Object(j.actions)({setFeatureFlag:function(n){return{featureFlag:n}},setFeatureFlagMissing:!0,addConditionSet:!0,addRollbackCondition:!0,setAggregationGroupTypeIndex:function(n){return{value:n}},removeConditionSet:function(n){return{index:n}},removeRollbackCondition:function(n){return{index:n}},duplicateConditionSet:function(n){return{index:n}},updateConditionSet:function(n,r,a,i){return{index:n,newRolloutPercentage:r,newProperties:a,newVariant:i}},deleteFeatureFlag:function(n){return{featureFlag:n}},setMultivariateEnabled:function(n){return{enabled:n}},setMultivariateOptions:function(n){return{multivariateOptions:n}},addVariant:!0,duplicateVariant:function(n){return{index:n}},removeVariant:function(n){return{index:n}},editFeatureFlag:function(n){return{editing:n}},distributeVariantsEqually:!0,setFilters:function(n){return{filters:n}},loadInsightAtIndex:function(n,r){return{index:n,filters:r}},setInsightResultAtIndex:function(n,r){return{index:n,average:r}},loadAllInsightsForFlag:!0}),Object(ve.forms)(function(s){var n=s.actions;return{featureFlag:{defaults:u({},ft),errors:function(a){var i,o,d,c=a.key,m=a.filters;return{key:c?(i=c.match)!==null&&i!==void 0&&i.call(c,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key",filters:{multivariate:{variants:m==null||(o=m.multivariate)===null||o===void 0||(d=o.variants)===null||d===void 0?void 0:d.map(function(l){var O,x=l.key;return{key:x?(O=x.match)!==null&&O!==void 0&&O.call(x,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key"}})}}}},submit:function(a){n.saveFeatureFlag(a)}}}}),Object(j.reducers)({featureFlag:[u({},ft),{setFeatureFlag:function(n,r){var a=r.featureFlag;if(a.filters.groups){var i=a.filters.groups.map(function(o){return o.properties?u(u({},o),{},{properties:Object(R.r)(o.properties)}):o});return u(u({},a),{},{filters:u(u({},a==null?void 0:a.filters),{},{groups:i})})}return a},addConditionSet:function(n){if(!n)return n;var r=[].concat(w()(n==null?void 0:n.filters.groups),[{properties:[],rollout_percentage:null}]);return u(u({},n),{},{filters:u(u({},n.filters),{},{groups:r})})},addRollbackCondition:function(n){return n&&u(u({},n),{},{rollback_conditions:[].concat(w()(n.rollback_conditions),[yt()])})},removeRollbackCondition:function(n,r){var a=r.index;if(!n)return n;var i=w()(n.rollback_conditions);return i.splice(a,1),u(u({},n),{},{rollback_conditions:i})},updateConditionSet:function(n,r){var a=r.index,i=r.newRolloutPercentage,o=r.newProperties,d=r.newVariant;if(!n)return n;var c=w()(n==null?void 0:n.filters.groups);return i!==void 0&&(c[a]=u(u({},c[a]),{},{rollout_percentage:i})),o!==void 0&&(c[a]=u(u({},c[a]),{},{properties:o})),d!==void 0&&(c[a]=u(u({},c[a]),{},{variant:d})),u(u({},n),{},{filters:u(u({},n.filters),{},{groups:c})})},removeConditionSet:function(n,r){var a=r.index;if(!n)return n;var i=w()(n.filters.groups);return i.splice(a,1),u(u({},n),{},{filters:u(u({},n.filters),{},{groups:i})})},duplicateConditionSet:function(n,r){var a=r.index;if(!n)return n;var i=n.filters.groups.concat([n.filters.groups[a]]);return u(u({},n),{},{filters:u(u({},n.filters),{},{groups:i})})},setMultivariateOptions:function(n,r){var a=r.multivariateOptions;return n&&u(u({},n),{},{filters:u(u({},n.filters),{},{multivariate:a})})},addVariant:function(n){var r;if(!n)return n;var a=w()(((r=n.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]);return u(u({},n),{},{filters:u(u({},n.filters),{},{multivariate:u(u({},n.filters.multivariate||{}),{},{variants:[].concat(w()(a),[zt])})})})},removeVariant:function(n,r){var a,i=r.index;if(!n)return n;var o=w()(((a=n.filters.multivariate)===null||a===void 0?void 0:a.variants)||[]);return o.splice(i,1),u(u({},n),{},{filters:u(u({},n.filters),{},{multivariate:u(u({},n.filters.multivariate),{},{variants:o})})})},distributeVariantsEqually:function(n){var r;if(!n)return n;var a=w()(((r=n.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]),i=a.length;if(i>0&&i<=100){var o=Math.round(100/i),d=o*i,c=d-100;a.forEach(function(m,l){a[l]=u(u({},m),{},{rollout_percentage:o})}),a[i-1]=u(u({},a[i-1]),{},{rollout_percentage:o-c})}return u(u({},n),{},{filters:u(u({},n.filters),{},{multivariate:u(u({},n.filters.multivariate),{},{variants:a})})})},setAggregationGroupTypeIndex:function(n,r){var a=r.value;return!n||n.filters.aggregation_group_type_index==a?n:u(u({},n),{},{filters:u(u({},n.filters),{},{aggregation_group_type_index:a,groups:[{properties:[],rollout_percentage:null}]})})}}],featureFlagMissing:[!1,{setFeatureFlagMissing:function(){return!0}}],isEditingFlag:[!1,{editFeatureFlag:function(n,r){var a=r.editing;return a}}],insightRollingAverages:[{},{setInsightResultAtIndex:function(n,r){var a=r.index,i=r.average;return u(u({},n),{},We()({},"".concat(a),i))}}]}),Object(ut.loaders)(function(s){var n=s.values,r=s.props,a=s.actions;return{featureFlag:{loadFeatureFlag:function(){var i=q()(M.a.mark(function d(){return M.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(r.id&&r.id!=="new")){m.next=11;break}return m.prev=1,m.next=4,he.b.get("api/projects/".concat(n.currentTeamId,"/feature_flags/").concat(r.id));case 4:return m.abrupt("return",m.sent);case 7:throw m.prev=7,m.t0=m.catch(1),a.setFeatureFlagMissing(),m.t0;case 11:return m.abrupt("return",ft);case 12:case"end":return m.stop()}},d,null,[[1,7]])}));function o(){return i.apply(this,arguments)}return o}(),saveFeatureFlag:function(){var i=q()(M.a.mark(function d(c){var m,l,O,x,h;return M.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(m=c.created_at,l=c.id,O=Ot()(c,H),v.prev=1,c.id){v.next=10;break}return v.next=5,he.b.create("api/projects/".concat(n.currentTeamId,"/feature_flags"),O);case 5:return x=v.sent,n.roleBasedAccessEnabled&&((h=b({flagId:null}))===null||h===void 0||h.actions.addAssociatedRoles(x.id)),v.abrupt("return",x);case 10:return v.next=12,he.b.update("api/projects/".concat(n.currentTeamId,"/feature_flags/").concat(c.id),O);case 12:return v.abrupt("return",v.sent);case 13:v.next=19;break;case 15:throw v.prev=15,v.t0=v.catch(1),(v.t0.code==="behavioral_cohort_found"||v.t0.code==="cohort_does_not_exist")&&Vt.e.actions.reportFailedToCreateFeatureFlagWithCohort(v.t0.code,v.t0.detail),v.t0;case 19:case"end":return v.stop()}},d,null,[[1,15]])}));function o(d){return i.apply(this,arguments)}return o}()},recentInsights:[[],{loadRecentInsights:function(){var i=q()(M.a.mark(function d(){var c;return M.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(r.id&&r.id!=="new"&&n.featureFlag.key)){l.next=5;break}return l.next=3,he.b.get("api/projects/".concat(n.currentTeamId,"/insights/?feature_flag=").concat(n.featureFlag.key,"&order=-created_at"));case 3:return c=l.sent,l.abrupt("return",c.results);case 5:return l.abrupt("return",[]);case 6:case"end":return l.stop()}},d)}));function o(){return i.apply(this,arguments)}return o}()}],sentryErrorCount:[void 0,{loadSentryErrorCount:function(){var i=q()(M.a.mark(function d(){var c;return M.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,he.b.get("api/sentry_errors/");case 2:return c=l.sent,l.abrupt("return",c.total_count);case 4:case"end":return l.stop()}},d)}));function o(){return i.apply(this,arguments)}return o}()}]}}),Object(j.listeners)(function(s){var n=s.actions,r=s.values;return{saveFeatureFlagSuccess:function(i){var o,d=i.featureFlag;Wt.d.success("Feature flag saved"),(o=$.b.findMounted())===null||o===void 0||o.actions.updateFlag(d),le.router.actions.replace(ce.a.featureFlag(d.id)),n.editFeatureFlag(!1)},deleteFeatureFlag:function(){var a=q()(M.a.mark(function o(d){var c;return M.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:c=d.featureFlag,Object(R.x)({endpoint:"projects/".concat(r.currentTeamId,"/feature_flags"),object:{name:c.name,id:c.id},callback:function(){var x,h;c.id&&((x=$.b.findMounted())===null||x===void 0||x.actions.deleteFlag(c.id)),(h=$.b.findMounted())===null||h===void 0||h.actions.loadFeatureFlags(),le.router.actions.push(ce.a.featureFlags())}});case 2:case"end":return l.stop()}},o)}));function i(o){return a.apply(this,arguments)}return i}(),setMultivariateEnabled:function(){var a=q()(M.a.mark(function o(d){var c;return M.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:c=d.enabled,c?n.setMultivariateOptions($e):n.setMultivariateOptions(null);case 2:case"end":return l.stop()}},o)}));function i(o){return a.apply(this,arguments)}return i}(),loadFeatureFlagSuccess:function(){var a=q()(M.a.mark(function o(){return M.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:n.loadRecentInsights(),n.loadAllInsightsForFlag();case 2:case"end":return c.stop()}},o)}));function i(){return a.apply(this,arguments)}return i}(),loadInsightAtIndex:function(){var a=q()(M.a.mark(function o(d){var c,m,l,O,x,h,F,v;return M.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(c=d.index,m=d.filters,!m){A.next=9;break}return A.next=4,he.b.get("api/projects/".concat(r.currentTeamId,"/insights/trend/?").concat(Object(R.Fb)(Object(wt.a)(m))));case 4:x=A.sent,h=(l=x.result)===null||l===void 0||(O=l[0])===null||O===void 0?void 0:O.data,F=h.slice(0,7),v=Math.round(Object(R.Eb)(F)/7),n.setInsightResultAtIndex(c,v);case 9:case"end":return A.stop()}},o)}));function i(o){return a.apply(this,arguments)}return i}(),loadAllInsightsForFlag:function(){var i;(i=r.featureFlag.rollback_conditions)===null||i===void 0||i.forEach(function(o,d){o.threshold_metric&&n.loadInsightAtIndex(d,o.threshold_metric)})},addRollbackCondition:function(){var i=r.featureFlag.rollback_conditions.length-1;n.loadInsightAtIndex(i,r.featureFlag.rollback_conditions[i].threshold_metric)}}}),Object(j.selectors)({props:[function(){return[function(s,n){return n}]},function(s){return s}],multivariateEnabled:[function(s){return[s.featureFlag]},function(s){return!!(s!=null&&s.filters.multivariate)}],roleBasedAccessEnabled:[function(s){return[s.hasAvailableFeature]},function(s){return s(I.e.ROLE_BASED_ACCESS)}],variants:[function(s){return[s.featureFlag]},function(s){var n;return(s==null||(n=s.filters.multivariate)===null||n===void 0?void 0:n.variants)||[]}],nonEmptyVariants:[function(s){return[s.variants]},function(s){return s.filter(function(n){var r=n.key;return!!r})}],variantRolloutSum:[function(s){return[s.variants]},function(s){return s.reduce(function(n,r){var a=r.rollout_percentage;return n+a},0)}],areVariantRolloutsValid:[function(s){return[s.variants,s.variantRolloutSum]},function(s,n){return s.every(function(r){var a=r.rollout_percentage;return a>=0&&a<=100})&&n===100}],aggregationTargetName:[function(s){return[s.featureFlag,s.groupTypes,s.aggregationLabel]},function(s,n,r){return s&&s.filters.aggregation_group_type_index!=null&&n.length>0?r(s.filters.aggregation_group_type_index).plural:"users"}],taxonomicGroupTypes:[function(s){return[s.featureFlag,s.groupsTaxonomicTypes]},function(s,n){return s&&s.filters.aggregation_group_type_index!=null&&n.length>0?[n[s.filters.aggregation_group_type_index]]:[Me.a.PersonProperties,Me.a.Cohorts]}],breadcrumbs:[function(s){return[s.featureFlag]},function(s){return[{name:"Feature Flags",path:ce.a.featureFlags()}].concat(w()(s?[{name:s.key||"Unnamed"}]:[]))}]}),Object(le.urlToAction)(function(s){var n,r=s.actions,a=s.props;return We()({},ce.a.featureFlag((n=a.id)!==null&&n!==void 0?n:"new"),function(i,o,d,c){var m=c.method;m==="PUSH"&&(a.id?r.loadFeatureFlag():r.resetFeatureFlag())})}),Object(j.afterMount)(function(s){var n,r=s.props,a=s.actions,i=(n=$.b.findMounted())===null||n===void 0?void 0:n.values.featureFlags.find(function(o){return o.id===r.id});i?(a.setFeatureFlag(i),a.loadRecentInsights(),a.loadAllInsightsForFlag()):r.id!=="new"&&a.loadFeatureFlag(),a.loadSentryErrorCount()})]),Xt=t("./frontend/src/lib/logic/featureFlagLogic.ts"),gn=t("./node_modules/antd/es/card/index.js"),te=t("./frontend/src/lib/components/icons.tsx"),Ve=t("./frontend/src/lib/components/LemonDivider/index.ts"),ye=t("./frontend/src/lib/components/CodeSnippet/index.tsx"),e=t("./node_modules/react/jsx-runtime.js"),He="?utm_medium=in-product&utm_campaign=feature-flag";function Et(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ye.a,{language:ye.b.JavaScript,wrap:!0,children:"const isMyFlagEnabledForUser = await client.isFeatureEnabled('".concat(n,`', 'user distinct id')

if (isMyFlagEnabledForUser) {
    // Do something differently for this user
}`)})})}function Rt(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ye.a,{language:ye.b.JavaScript,wrap:!0,children:"if\xA0(posthog.isFeatureEnabled('".concat(n!=null?n:"",`')) {
    // run your activation code here
}`)})})}function xt(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ye.a,{language:ye.b.PHP,wrap:!0,children:"if (PostHog::isFeatureEnabled('".concat(n,`', 'some distinct id')) {
    // do something here
}`)})})}function Pt(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ye.a,{language:ye.b.Go,wrap:!0,children:`isFlagEnabledForUser, err := client.IsFeatureEnabled(
                    FeatureFlagPayload{
                        Key:        '`.concat(n,`',
                        DistinctId: "distinct-id",
                    })

if (isFlagEnabledForUser) {
  // Do something differently for this user
}`)})})}function Ft(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ye.a,{language:ye.b.Ruby,wrap:!0,children:"is_my_flag_enabled = posthog.is_feature_enabled('".concat(n,`', 'user distinct id')

if is_my_flag_enabled
  # Do something differently for this user
end`)})})}function At(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ye.a,{language:ye.b.Python,wrap:!0,children:'if posthog.feature_enabled("'.concat(n,`", "user_distinct_id"):
    runAwesomeFeature()
`)})})}function pn(){var s=Object(j.useValues)(dt.a),n=s.currentTeam;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ye.a,{language:ye.b.Bash,wrap:!0,children:"curl ".concat(window.location.origin,`/decide/ \\
-X POST -H 'Content-Type: application/json' \\
-d '{
    "api_key": "`).concat(n?n.api_token:"[project_api_key]",`",
    "distinct_id": "[user distinct id]"
}'
                `)})})}try{Et.displayName="NodeJSSnippet",Et.__docgenInfo={description:"",displayName:"NodeJSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#NodeJSSnippet"]={docgenInfo:Et.__docgenInfo,name:"NodeJSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#NodeJSSnippet"})}catch(s){}try{Rt.displayName="JSSnippet",Rt.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:Rt.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(s){}try{xt.displayName="PHPSnippet",xt.__docgenInfo={description:"",displayName:"PHPSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PHPSnippet"]={docgenInfo:xt.__docgenInfo,name:"PHPSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PHPSnippet"})}catch(s){}try{Pt.displayName="GolangSnippet",Pt.__docgenInfo={description:"",displayName:"GolangSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#GolangSnippet"]={docgenInfo:Pt.__docgenInfo,name:"GolangSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#GolangSnippet"})}catch(s){}try{Ft.displayName="RubySnippet",Ft.__docgenInfo={description:"",displayName:"RubySnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#RubySnippet"]={docgenInfo:Ft.__docgenInfo,name:"RubySnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#RubySnippet"})}catch(s){}try{At.displayName="PythonSnippet",At.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:At.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(s){}var jn=t("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Qt=t.n(jn),_n=t("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlagInstructions.scss"),Zt=t.n(_n),$t={};$t.insert="head",$t.singleton=!1;var Qn=Qt()(Zt.a,$t),Zn=Zt.a.locals||{},Qe="https://posthog.com/docs/",st="#feature-flags",Ht=[{value:"JavaScript",documentationLink:"".concat(Qe,"integrations/js-integration").concat(He).concat(st),Icon:te.IconJavascript,Snippet:Rt},{value:"Node.js",documentationLink:"".concat(Qe,"integrations/node-integration").concat(He).concat(st),Icon:te.IconNodeJS,Snippet:Et},{value:"PHP",documentationLink:"".concat(Qe,"integrations/php-integration").concat(He).concat(st),Icon:te.IconPHP,Snippet:xt},{value:"Ruby",documentationLink:"".concat(Qe,"integrations/ruby-integration").concat(He).concat(st),Icon:te.IconRuby,Snippet:Ft},{value:"Golang",documentationLink:"".concat(Qe,"integrations/go-integration").concat(He).concat(st),Icon:te.IconGolang,Snippet:Pt},{value:"Python",documentationLink:"".concat(Qe,"integrations/python-integration").concat(He).concat(st),Icon:te.IconPython,Snippet:At},{value:"API",documentationLink:"".concat(Qe,"api/feature-flags").concat(He),Icon:te.IconOpenInNew,Snippet:pn}];function vn(s){var n=s.selectedOptionValue,r=s.selectOption;return Object(e.jsxs)(P.a,{className:"FeatureFlagInstructionsHeader",justify:"space-between",align:"middle",children:[Object(e.jsxs)("div",{className:"FeatureFlagInstructionsHeader__header-title",children:[Object(e.jsx)(te.IconFlag,{className:"FeatureFlagInstructionsHeader__header-title__icon"}),Object(e.jsx)("b",{children:"Learn how to use feature flags in your code"})]}),Object(e.jsx)(T.a,{"data-attr":"feature-flag-instructions-select",value:n,style:{width:140},onChange:r,children:Ht.map(function(a,i){var o=a.value,d=a.Icon;return Object(e.jsx)(T.a.Option,{"data-attr":"feature-flag-instructions-select-option-"+o,value:o,children:Object(e.jsxs)("div",{className:"FeatureFlagInstructionsHeader__option",children:[Object(e.jsx)("div",{className:"FeatureFlagInstructionsHeader__option__icon",children:Object(e.jsx)(d,{})}),Object(e.jsx)("div",{children:o})]})},i)})})]})}function On(s){var n=s.documenrationLink;return Object(e.jsxs)("div",{className:"mt-4",children:["Need more information?"," ",Object(e.jsxs)("a",{"data-attr":"feature-flag-doc-link",target:"_blank",rel:"noopener",href:n,children:["Check the docs ",Object(e.jsx)(te.IconOpenInNew,{})]})]})}function gt(s){var n=s.featureFlagKey,r=Ht[0],a=Object(ie.useState)(r),i=D()(a,2),o=i[0],d=i[1],c=function(l){var O=Ht.find(function(x){return x.value===l});O&&d(O)};return Object(e.jsxs)(gn.a,{size:"small",children:[Object(e.jsx)(vn,{selectedOptionValue:o.value,selectOption:c}),Object(e.jsx)(Ve.a,{}),Object(e.jsx)("div",{className:"mt mb",children:Object(e.jsx)(o.Snippet,{"data-attr":"feature-flag-instructions-snippet",flagKey:n})}),Object(e.jsx)(Ve.a,{}),Object(e.jsx)(On,{documenrationLink:o.documentationLink})]})}try{gt.displayName="FeatureFlagInstructions",gt.__docgenInfo={description:"",displayName:"FeatureFlagInstructions",props:{featureFlagKey:{defaultValue:null,description:"",name:"featureFlagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagInstructions.tsx#FeatureFlagInstructions"]={docgenInfo:gt.__docgenInfo,name:"FeatureFlagInstructions",path:"frontend/src/scenes/feature-flags/FeatureFlagInstructions.tsx#FeatureFlagInstructions"})}catch(s){}var kt=t("./frontend/src/lib/components/PageHeader.tsx"),hn=t("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss"),qt=t.n(hn),Gt={};Gt.insert="head",Gt.singleton=!1;var kn=Qt()(qt.a,Gt),qn=qt.a.locals||{},bn=t("./frontend/src/lib/components/Tooltip.tsx"),yn=t("./node_modules/rc-select/es/index.js"),It=t("./frontend/src/lib/components/Link.tsx"),Ct=t("./frontend/src/lib/introductions/groupsAccessLogic.ts");function Mt(s){var n=s.value,r=Object(j.useValues)(Ct.b),a=r.groupsAccessStatus;return[Ct.a.HasAccess,Ct.a.HasGroupTypes,Ct.a.NoAccess].includes(a)?Object(e.jsxs)(yn.c.Option,{value:n,disabled:!0,style:{height:"100%",width:"100%",overflow:"hidden",textOverflow:"ellipsis",backgroundColor:"var(--side)",color:"var(--muted)"},children:[Object(e.jsx)(Ce.a,{style:{marginRight:6,color:"var(--warning)"}}),"Unique groups \u2013"," ",Object(e.jsx)(It.a,{to:"https://posthog.com/docs/user-guides/group-analytics?utm_medium=in-product&utm_campaign=group-analytics-learn-more",target:"_blank","data-attr":"group-analytics-learn-more",className:"font-semibold",children:"Learn more"})]},"groups"):null}try{Mt.displayName="GroupsIntroductionOption",Mt.__docgenInfo={description:"",displayName:"GroupsIntroductionOption",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/introductions/GroupsIntroductionOption.tsx#GroupsIntroductionOption"]={docgenInfo:Mt.__docgenInfo,name:"GroupsIntroductionOption",path:"frontend/src/lib/introductions/GroupsIntroductionOption.tsx#GroupsIntroductionOption"})}catch(s){}var je=t("./frontend/src/lib/components/LemonButton/index.ts"),xe=t("./frontend/src/lib/forms/Field.tsx"),En=t("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx"),Yt=t("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),en=t("./frontend/src/lib/components/LemonCheckbox/index.ts"),Rn=t("./frontend/src/scenes/events/EventBufferNotice.tsx"),tn=t("./frontend/src/lib/components/AlertMessage/index.ts"),Tt=t("./frontend/src/lib/components/Spinner/Spinner.tsx"),nn=t("./frontend/src/lib/components/CopyToClipboard.tsx"),Lt=t("./frontend/src/lib/components/Lettermark/Lettermark.tsx"),Ge=t("./frontend/src/lib/constants.tsx"),sn=t("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),xn=t("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),Pn=t("./frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),Fn=t("./frontend/src/lib/components/DefinitionPopup/utils.ts"),rn=t("./frontend/src/lib/components/CompactList/CompactList.tsx"),An=t("./frontend/src/scenes/project-homepage/RecentInsights.tsx");function In(){var s=Object(j.useValues)(Se),n=s.recentInsights,r=s.recentInsightsLoading,a=s.featureFlag;return Object(e.jsx)(rn.a,{title:"Insights that use this feature flag",loading:r,emptyMessage:{title:"You have no insights that use this feature flag",description:"Explore this feature flag's insights by creating one below.",buttonText:"Create insight",buttonTo:ce.a.insightNew({events:[{id:"$pageview",name:"$pageview",type:"events",math:"dau"}],breakdown_type:"event",breakdown:"$feature/".concat(a.key)})},items:n.slice(0,5),renderRow:function(o,d){return Object(e.jsx)(An.a,{insight:o},d)}})}var Cn=t("./frontend/src/lib/components/NotFound/index.tsx"),Mn=t("./frontend/src/models/cohortsModel.ts"),ge=t("./frontend/@posthog/lemon-ui/src/index.ts"),Tn=t("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),Ln=t("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx");function an(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),r.push.apply(r,a)}return r}function Sn(s){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?an(Object(r),!0).forEach(function(a){We()(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):an(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function pt(s){var n=s.readOnly,r=Object(j.useValues)(Se),a=r.featureFlag,i=r.sentryIntegrationEnabled,o=r.sentryErrorCount,d=r.insightRollingAverages,c=Object(j.useActions)(Se),m=c.addRollbackCondition,l=c.removeRollbackCondition,O=c.loadInsightAtIndex,x=Object(j.useValues)(U.a),h=x.user;return Object(e.jsxs)("div",{children:[Object(e.jsxs)("div",{className:"mb-2",children:[Object(e.jsx)("b",{children:"Auto rollback"}),Object(e.jsx)(ge.LemonTag,{type:"warning",className:"uppercase ml-2",children:"Beta"}),!n&&Object(e.jsx)("div",{className:"mt-2",children:"Specify the conditions in which this feature flag will automatically roll back."})]}),n&&a.rollback_conditions&&a.rollback_conditions.map(function(F,v){var V,A,S;return Object(e.jsxs)(e.Fragment,{children:[v>0&&Object(e.jsx)("div",{className:"condition-set-separator",children:"OR"}),F.threshold_type==="insight"&&(V=F.threshold_metric)!==null&&V!==void 0&&(A=V.events)!==null&&A!==void 0&&(S=A[0])!==null&&S!==void 0&&S.name?Object(e.jsxs)("div",{className:"mb-4 border rounded p-4",children:[Object(e.jsx)("b",{children:"".concat(Object(R.i)(F.threshold_type)," based rollback")}),Object(e.jsx)(ge.LemonDivider,{className:"my-3"}),Object(e.jsxs)(P.a,{align:"middle",children:[d[v]&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("b",{children:F.threshold_metric.events[0].name}),"\xA0 trailing average is ",d[v],"."]}),"\xA0Trigger when trailing average of \xA0",Object(e.jsx)("b",{children:F.threshold_metric.events[0].name}),"\xA0 is\xA0",F.operator&&R.I[F.operator]," ",F.threshold]})]}):Object(e.jsxs)("div",{className:"mb-4 border rounded p-4",children:[Object(e.jsx)("b",{children:"".concat(Object(R.i)(F.threshold_type)," based rollback")}),Object(e.jsx)(ge.LemonDivider,{className:"my-3"}),Object(e.jsxs)(P.a,{align:"middle",children:["Trigger when there is a\xA0",Object(e.jsxs)("b",{children:[F.threshold,"%"]}),"\xA0increase in errors"]})]})]})}),!n&&a.rollback_conditions&&a.rollback_conditions.map(function(F,v){return Object(e.jsxs)(e.Fragment,{children:[v>0&&Object(e.jsx)("div",{className:"condition-set-separator",children:"OR"}),Object(e.jsx)("div",{className:"mb-4 border rounded p-4",children:Object(e.jsxs)(ve.Group,{name:["rollback_conditions",v],children:[Object(e.jsxs)(P.a,{align:"middle",justify:"space-between",children:[Object(e.jsxs)(P.a,{children:[Object(e.jsx)("div",{className:"mt-3 mr-3",children:Object(e.jsx)("b",{children:"Rollback Condition Type"})}),Object(e.jsx)(xe.a,{name:"threshold_type",children:function(A){var S=A.value,Y=A.onChange;return Object(e.jsx)(ge.LemonSelect,{value:S,onChange:Y,options:[{value:I.V.Sentry,label:"Error Based"},{value:I.V.Insight,label:"Metric Based"}]})}})]}),Object(e.jsx)(ge.LemonButton,{icon:Object(e.jsx)(te.IconDelete,{}),status:"muted",noPadding:!0,onClick:function(){l(v)}})]}),Object(e.jsx)(ge.LemonDivider,{className:"my-3"}),a.rollback_conditions[v].threshold_type=="insight"?Object(e.jsxs)("div",{className:"flex gap-2 items-center mt-4",children:[Object(e.jsx)(xe.a,{name:"threshold_metric",children:function(A){var S=A.value,Y=A.onChange;return Object(e.jsx)(Tn.a,{filters:S,setFilters:function(De){Y(Sn({},De)),O(v,De)},typeKey:"feature-flag-rollback-trends-"+v,buttonCopy:"Add graph series",showSeriesIndicator:!1,showNestedArrow:!0,hideRename:!0,entitiesLimit:1,mathAvailability:Ln.b.None,propertiesTaxonomicGroupTypes:[Me.a.EventProperties,Me.a.PersonProperties,Me.a.EventFeatureFlags,Me.a.Cohorts,Me.a.Elements]})}}),Object(e.jsxs)("span",{children:["trailing 7 day average is\xA0",d[v]!==void 0?Object(e.jsx)("b",{children:d[v]}):Object(e.jsx)(Tt.a,{}),". Trigger when trailing average is"]}),Object(e.jsx)(xe.a,{name:"operator",children:function(A){var S=A.value,Y=A.onChange;return Object(e.jsx)(ge.LemonSelect,{value:S,onChange:Y,options:[{label:"greater than",value:"gt"},{label:"less than",value:"lt"}]})}}),Object(e.jsx)(xe.a,{name:"threshold",children:Object(e.jsx)(ge.LemonInput,{min:0,type:"number"})})]}):i?Object(e.jsx)("div",{children:Object(e.jsxs)(P.a,{align:"middle",children:[o?Object(e.jsxs)("span",{children:[Object(e.jsxs)("b",{children:[Object(R.P)(o)," "]})," sentry errors in the past 24 hours."," "]}):Object(e.jsx)(Tt.a,{}),Object(e.jsx)("span",{children:"\xA0Trigger when there is a"}),Object(e.jsx)(xe.a,{name:"threshold",className:"ml-3 mr-3",children:function(A){var S=A.value,Y=A.onChange;return Object(e.jsx)(ge.LemonInput,{value:S,suffix:Object(e.jsx)(e.Fragment,{children:"%"}),type:"number",min:0,onChange:Y})}}),Object(e.jsx)(xe.a,{name:"operator",className:"mr-3",children:function(A){var S=A.value,Y=A.onChange;return Object(e.jsx)(ge.LemonSelect,{options:[{label:"increase",value:"gt"},{label:"decrease",value:"lt"}],value:S,onChange:Y})}}),Object(e.jsxs)("span",{children:["to"," ",o?Object(e.jsx)("b",{children:Object(R.P)(Math.round(o*(1+(a.rollback_conditions[v].threshold||0)/100)))}):Object(e.jsx)(Tt.a,{})," ","errors."]}),Object(e.jsx)("div",{})]})}):h!=null&&h.is_staff?Object(e.jsxs)("div",{className:"mt-4",children:[Object(e.jsx)("b",{children:"This feature requires an active Sentry integration."}),Object(e.jsx)("br",{}),Object(e.jsx)(ge.Link,{to:ce.a.instanceSettings(),children:"Go to Instance Settings"})," and update the"," ",Object(e.jsx)("code",{children:'"SENTRY_"'})," properties from your Sentry account to enable."]}):Object(e.jsx)("p",{className:"text-muted",children:"This PostHog instance is not configured for Sentry. Please contact the instance owner to configure it."})]})})]})}),!n&&Object(e.jsx)(ge.LemonButton,{type:"secondary",onClick:function(){m()},children:"Add condition"})]})}try{pt.displayName="FeatureFlagAutoRollback",pt.__docgenInfo={description:"",displayName:"FeatureFlagAutoRollback",props:{readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagAutoRollout.tsx#FeatureFlagAutoRollback"]={docgenInfo:pt.__docgenInfo,name:"FeatureFlagAutoRollback",path:"frontend/src/scenes/feature-flags/FeatureFlagAutoRollout.tsx#FeatureFlagAutoRollback"})}catch(s){}var Dn=t("./frontend/src/scenes/project-homepage/RecentRecordings.tsx"),Kn=t("./frontend/src/scenes/session-recordings/player/modal/SessionPlayerModal.tsx"),Bn=t("./frontend/src/scenes/session-recordings/playlist/sessionRecordingsListLogic.ts"),St=function(n){return{events:fn(n).events}};function Dt(s){var n=s.flagKey,r=Object(j.useValues)(dt.a),a=r.currentTeam,i=Object(Bn.d)({key:"feature-flag-".concat(n),filters:St(n)}),o=Object(j.useValues)(i),d=o.sessionRecordings,c=o.sessionRecordingsResponseLoading,m=o.filters;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Kn.a,{}),Object(e.jsx)(rn.a,{title:"Recordings with current feature flag",viewAllURL:ce.a.sessionRecordings(void 0,m),loading:c,emptyMessage:a!=null&&a.session_recording_opt_in?{title:"There are no recordings for this project",description:"Make sure you have the javascript snippet setup in your website.",buttonText:"Learn more",buttonTo:"https://posthog.com/docs/user-guides/recordings"}:{title:"Recordings are not enabled for this project",description:"Once recordings are enabled, new recordings will display here.",buttonText:"Enable recordings",buttonTo:ce.a.projectSettings()+"#recordings"},items:d.slice(0,5),renderRow:function(O,x){return Object(e.jsx)(Dn.b,{recording:O},x)}})]})}try{Dt.displayName="FeatureFlagRecordings",Dt.__docgenInfo={description:"",displayName:"FeatureFlagRecordings",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#FeatureFlagRecordings"]={docgenInfo:Dt.__docgenInfo,name:"FeatureFlagRecordings",path:"frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#FeatureFlagRecordings"})}catch(s){}try{St.displayName="filtersForFlag",St.__docgenInfo={description:"",displayName:"filtersForFlag",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#filtersForFlag"]={docgenInfo:St.__docgenInfo,name:"filtersForFlag",path:"frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#filtersForFlag"})}catch(s){}var Nn=t("./frontend/src/scenes/billing/billingLogic.ts"),Un=t("./frontend/src/scenes/events/index.ts"),Wn=t("./frontend/src/lib/components/PropertyFilters/utils.ts"),Vn=t("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),on=t("./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx"),wn=t("./frontend/src/scenes/organization/Settings/Roles/rolesLogic.tsx"),$n=t("./frontend/src/scenes/organizationLogic.tsx");function Kt(s){return s.map(function(n){return{key:n.id,label:"".concat(n.name),labelComponent:Object(e.jsx)("span",{children:Object(e.jsx)("b",{children:"".concat(n.name)})})}})}function Bt(s){var n=s.title,r=s.visible,a=s.onClose,i=s.rolesToAdd,o=s.addableRoles,d=s.onChange,c=s.addableRolesLoading,m=s.onAdd,l=s.roles,O=s.deleteAssociatedRole,x=s.isNewResource;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ge.LemonModal,{title:n,isOpen:r,onClose:a,children:Object(e.jsx)(jt,{resourceType:I.U.FEATURE_FLAGS,isNewResource:x,onChange:d,rolesToAdd:i,addableRoles:o,addableRolesLoading:c,onAdd:m,roles:l,deleteAssociatedRole:O})})})}function jt(s){var n=s.rolesToAdd,r=s.addableRoles,a=s.onChange,i=s.addableRolesLoading,o=s.onAdd,d=s.roles,c=s.deleteAssociatedRole,m=s.isNewResource,l=s.resourceType,O=Object(j.useValues)(on.b),x=O.allPermissions,h=Object(j.useValues)(wn.a),F=h.roles,v=Object(j.useValues)($n.a),V=v.isAdminOrOwner,A=x.find(function(Y){return Y.resource===l}),S=F.filter(function(Y){return Y.feature_flags_access_level===I.a.WRITE});return Object(e.jsxs)(e.Fragment,{children:[A&&Object(e.jsx)(Hn,{resourceLevel:A}),Object(e.jsx)(Gn,{roles:S}),V&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(ge.LemonDivider,{className:"mt-4"}),Object(e.jsx)("h5",{className:"mt-4",children:"Custom edit roles"}),Object(e.jsxs)("div",{className:"flex gap-2",children:[Object(e.jsx)("div",{className:"flex-1",children:Object(e.jsx)(Vn.a,{placeholder:"Search for roles to add\u2026",loading:i,onChange:a,value:n,filterOption:!0,mode:"multiple","data-attr":"resource-permissioning-select",options:Kt(r)})}),!m&&Object(e.jsx)(ge.LemonButton,{type:"primary",loading:!1,disabled:n.length===0,onClick:o,children:"Add"})]})]}),!m&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{className:"mt-4",children:"Roles"}),d.length>0?Object(e.jsx)("div",{className:"pb-2 rounded overflow-y-auto",style:{maxHeight:300},children:d.map(function(Y){return Object(e.jsx)(Yn,{role:Y,deleteRole:function(De){return c(De)}},Y.id)})}):Object(e.jsx)("div",{className:"text-muted mb-2",children:"No roles added yet"})]})]})}function Hn(s){var n=s.resourceLevel;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{children:"Organization Default"}),Object(e.jsx)("b",{children:on.a[n.access_level]})]})}function Gn(s){var n=s.roles;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{className:"mt-4",children:"Roles with edit access"}),Object(e.jsx)(P.a,{children:n.map(function(r){return Object(e.jsxs)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:[Object(e.jsx)("b",{children:r.name})," "]},r.id)})})]})}function Yn(s){var n=s.role,r=s.deleteRole;return Object(e.jsxs)("div",{className:"flex items-center justify-between h-8",children:[Object(e.jsx)("b",{children:n.name}),r&&Object(e.jsx)(ge.LemonButton,{icon:Object(e.jsx)(te.IconDelete,{}),onClick:function(){return r(n.id)},tooltip:"Remove role from permission",status:"primary-alt",type:"tertiary",size:"small"})]})}try{Kt.displayName="roleLemonSelectOptions",Kt.__docgenInfo={description:"",displayName:"roleLemonSelectOptions",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/ResourcePermissionModal.tsx#roleLemonSelectOptions"]={docgenInfo:Kt.__docgenInfo,name:"roleLemonSelectOptions",path:"frontend/src/scenes/ResourcePermissionModal.tsx#roleLemonSelectOptions"})}catch(s){}try{Bt.displayName="ResourcePermissionModal",Bt.__docgenInfo={description:"",displayName:"ResourcePermissionModal",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},addableRoles:{defaultValue:null,description:"",name:"addableRoles",required:!0,type:{name:"RoleType[]"}},addableRolesLoading:{defaultValue:null,description:"",name:"addableRolesLoading",required:!0,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: string[]) => void"}},rolesToAdd:{defaultValue:null,description:"",name:"rolesToAdd",required:!0,type:{name:"string[]"}},onAdd:{defaultValue:null,description:"",name:"onAdd",required:!0,type:{name:"() => void"}},roles:{defaultValue:null,description:"",name:"roles",required:!0,type:{name:"RoleType[]"}},deleteAssociatedRole:{defaultValue:null,description:"",name:"deleteAssociatedRole",required:!0,type:{name:"(id: string) => void"}},isNewResource:{defaultValue:null,description:"",name:"isNewResource",required:!0,type:{name:"boolean"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"Resource"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermissionModal"]={docgenInfo:Bt.__docgenInfo,name:"ResourcePermissionModal",path:"frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermissionModal"})}catch(s){}try{jt.displayName="ResourcePermission",jt.__docgenInfo={description:"",displayName:"ResourcePermission",props:{addableRoles:{defaultValue:null,description:"",name:"addableRoles",required:!0,type:{name:"RoleType[]"}},addableRolesLoading:{defaultValue:null,description:"",name:"addableRolesLoading",required:!0,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: string[]) => void"}},rolesToAdd:{defaultValue:null,description:"",name:"rolesToAdd",required:!0,type:{name:"string[]"}},onAdd:{defaultValue:null,description:"",name:"onAdd",required:!0,type:{name:"() => void"}},roles:{defaultValue:null,description:"",name:"roles",required:!0,type:{name:"RoleType[]"}},deleteAssociatedRole:{defaultValue:null,description:"",name:"deleteAssociatedRole",required:!0,type:{name:"(id: string) => void"}},isNewResource:{defaultValue:null,description:"",name:"isNewResource",required:!0,type:{name:"boolean"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"Resource"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermission"]={docgenInfo:jt.__docgenInfo,name:"ResourcePermission",path:"frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermission"})}catch(s){}var zn=t("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),Jn={component:_t,logic:Se,paramsToProps:function(n){var r=n.params.id;return{id:r&&r!=="new"?parseInt(r):"new"}}};function ln(s){setTimeout(function(){var n;return(n=document.querySelector('.variant-form-list input[data-key-index="'.concat(s,'"]')))===null||n===void 0?void 0:n.focus()},50)}function _t(){var s,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.id,a=Object(j.useValues)(Se),i=a.props,o=a.featureFlag,d=a.featureFlagLoading,c=a.featureFlagMissing,m=a.isEditingFlag,l=Object(j.useValues)(Xt.a),O=l.featureFlags,x=Object(j.useActions)(Se),h=x.deleteFeatureFlag,F=x.editFeatureFlag,v=x.loadFeatureFlag,V=Object(j.useValues)(b({flagId:o.id})),A=V.permissionModalVisible,S=V.addableRoles,Y=V.unfilteredAddableRolesLoading,Ne=V.rolesToAdd,De=V.derivedRoles,Ue=Object(j.useActions)(b({flagId:o.id})),rt=Ue.setModalOpen,at=Ue.setRolesToAdd,Pe=Ue.addAssociatedRoles,y=Ue.deleteAssociatedRole,Z=Object(ie.useState)(!1),Ee=D()(Z,2),Ze=Ee[0],ke=Ee[1],ot=Object(ie.useState)($.a.OVERVIEW),z=D()(ot,2),Te=z[0],it=z[1],Nt=r==="new"||r===void 0;return c?Object(e.jsx)(Cn.a,{object:"feature flag"}):d?Object(e.jsx)(Tt.b,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("div",{className:"feature-flag",children:Nt||m?Object(e.jsxs)(ve.Form,{logic:Se,props:i,formKey:"featureFlag",enableFormOnSubmit:!0,className:"space-y-4",children:[Object(e.jsx)(kt.a,{title:Nt?"New feature flag":o.key||"Untitled",buttons:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)(je.a,{"data-attr":"cancel-feature-flag",type:"secondary",onClick:function(){m?(F(!1),v()):le.router.actions.push(ce.a.featureFlags())},disabled:d,children:"Cancel"}),Object(e.jsx)(je.a,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:d,disabled:d,children:"Save"})]})}),Object(e.jsx)(Oe.a,{}),o.experiment_set&&((s=o.experiment_set)===null||s===void 0?void 0:s.length)>0&&Object(e.jsxs)(tn.a,{type:"warning",children:["This feature flag is linked to an experiment. It's recommended to only make changes to this flag"," ",Object(e.jsx)(It.a,{to:ce.a.experiment(o.experiment_set[0]),children:"using the experiment creation screen."})]}),Object(e.jsx)(Rn.a,{additionalInfo:", meaning it can take around 60 seconds for some flags to update for recently-identified persons. To sidestep this, you can choose to override server properties when requesting the feature flag"}),Object(e.jsxs)(P.a,{gutter:16,style:{marginBottom:32},children:[Object(e.jsxs)(K.a,{span:12,className:"space-y-4",children:[Object(e.jsx)(xe.a,{name:"key",label:"Key",help:Ze&&r!=="new"?Object(e.jsxs)("span",{className:"text-warning",children:[Object(e.jsx)("b",{children:"Warning! "}),"Changing this key will",Object(e.jsxs)("a",{href:"https://posthog.com/docs/features/feature-flags".concat(He,"#feature-flag-persistence"),target:"_blank",rel:"noopener",children:[" ","affect the persistence of your flag ",Object(e.jsx)(te.IconOpenInNew,{})]})]}):void 0,children:function(de){var Ye=de.value,vt=de.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Yt.a,{value:Ye,onChange:function(mn){mn!==Ye&&ke(!0),vt(mn)},"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}),Object(e.jsx)("span",{style:{fontSize:13},className:"text-muted",children:"Feature flag keys must be unique"})]})}}),Object(e.jsx)(xe.a,{name:"name",label:"Description",children:Object(e.jsx)(En.a,{className:"ph-ignore-input","data-attr":"feature-flag-description",defaultValue:o.name||""})}),Object(e.jsx)(xe.a,{name:"ensure_experience_continuity",children:function(de){var Ye=de.value,vt=de.onChange;return Object(e.jsxs)("div",{className:"border rounded p-4",children:[Object(e.jsx)(en.a,{id:"continuity-checkbox",label:"Persist flag across authentication steps",onChange:function(){return vt(!Ye)},fullWidth:!0,checked:Ye}),Object(e.jsxs)("div",{className:"text-muted text-sm pl-7",children:["If your feature flag is applied prior to an identify or authentication event, use this to ensure that feature flags are not reset after a person is identified. This ensures the experience for the anonymous person is carried forward to the authenticated person."," ",Object(e.jsxs)(It.a,{to:"https://posthog.com/manual/feature-flags#persisting-feature-flags-across-authentication-steps",target:"_blank",children:["Learn more ",Object(e.jsx)(te.IconOpenInNew,{})]})]})]})}}),Object(e.jsx)(xe.a,{name:"active",children:function(de){var Ye=de.value,vt=de.onChange;return Object(e.jsx)("div",{className:"border rounded p-4",children:Object(e.jsx)(en.a,{id:"flag-enabled-checkbox",label:"Enable feature flag",onChange:function(){return vt(!Ye)},checked:Ye})})}})]}),Object(e.jsxs)(K.a,{span:12,children:[Object(e.jsx)(je.a,{type:"secondary",onClick:function(){return rt(!0)},className:"mb-4",children:"Set permissions"}),Object(e.jsx)(gt,{featureFlagKey:o.key||"my-flag"})]})]}),Object(e.jsx)(Oe.a,{}),Object(e.jsx)(cn,{}),Object(e.jsx)(Oe.a,{}),Object(e.jsx)(dn,{}),Object(e.jsx)(Oe.a,{}),O[Ge.i.AUTO_ROLLBACK_FEATURE_FLAGS]&&Object(e.jsx)(pt,{}),Object(e.jsx)(Ve.a,{className:"mt-8"}),Object(e.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[Object(e.jsx)(je.a,{"data-attr":"cancel-feature-flag",type:"secondary",onClick:function(){m?(F(!1),v()):le.router.actions.push(ce.a.featureFlags())},disabled:d,children:"Cancel"}),Object(e.jsx)(je.a,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:d,disabled:d,children:"Save"})]})]}):Object(e.jsx)(e.Fragment,{children:d?Object(e.jsx)(E.a,{active:!0}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(kt.a,{title:Object(e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[o.key||"Untitled",Object(e.jsx)(nn.a,{explicitValue:o.key,iconStyle:{color:"var(--muted-alt)"}}),Object(e.jsx)("div",{className:"flex",children:o.active?Object(e.jsx)(sn.a,{type:"success",className:"uppercase",children:"Enabled"}):Object(e.jsx)(sn.a,{type:"default",className:"uppercase",children:"Disabled"})})]}),description:Object(e.jsx)(e.Fragment,{children:o.name?Object(e.jsx)("span",{style:{fontStyle:"normal"},children:o.name}):"There is no description for this feature flag."}),buttons:Object(e.jsx)(e.Fragment,{children:Object(e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[Object(e.jsx)(je.a,{"data-attr":"delete-feature-flag",status:"danger",type:"secondary",onClick:function(){h(o)},disabled:d||!o.can_edit,children:"Delete feature flag"}),Object(e.jsx)(je.a,{"data-attr":"edit-feature-flag",type:"secondary",tooltip:O[Ge.i.ROLE_BASED_ACCESS]&&!o.can_edit&&"You have only 'View' access for this feature flag. To make changes, please contact the flag's creator.",onClick:function(){F(!0)},disabled:d||!o.can_edit,children:"Edit"})]})})}),Object(e.jsxs)(ue.a,{activeKey:Te,destroyInactiveTabPane:!0,onChange:function(de){return it(de)},children:[Object(e.jsx)(ue.a.TabPane,{tab:"Overview",children:Object(e.jsxs)(P.a,{children:[Object(e.jsxs)(K.a,{span:13,children:[Object(e.jsx)(cn,{readOnly:!0}),Object(e.jsx)(dn,{readOnly:!0}),O[Ge.i.AUTO_ROLLBACK_FEATURE_FLAGS]&&Object(e.jsx)(pt,{readOnly:!0})]}),Object(e.jsxs)(K.a,{span:11,className:"pl-4",children:[Object(e.jsx)(In,{}),Object(e.jsx)("div",{className:"my-4"}),O[Ge.i.RECORDINGS_ON_FEATURE_FLAGS]?Object(e.jsx)(Dt,{flagKey:o.key||"my-flag"}):Object(e.jsx)(gt,{featureFlagKey:o.key||"my-flag"})]})]})},"overview"),O[Ge.i.EXPOSURES_ON_FEATURE_FLAGS]&&o.key&&r&&Object(e.jsx)(ue.a.TabPane,{tab:"Exposures",children:Object(e.jsx)(Xn,{id:r,featureFlagKey:o.key})},"exposure"),o.id&&Object(e.jsx)(ue.a.TabPane,{tab:"History",children:Object(e.jsx)(xn.a,{scope:Pn.a.FEATURE_FLAG,id:o.id})},"history"),O[Ge.i.ROLE_BASED_ACCESS]&&Object(e.jsx)(ue.a.TabPane,{tab:"Permissions",children:Object(e.jsx)(zn.a,{feature:I.e.ROLE_BASED_ACCESS,children:o.can_edit&&Object(e.jsx)(jt,{resourceType:I.U.FEATURE_FLAGS,isNewResource:r==="new",onChange:function(de){return at(de)},rolesToAdd:Ne,addableRoles:S,addableRolesLoading:Y,onAdd:function(){return Pe()},roles:De,deleteAssociatedRole:function(de){return y({roleId:de})}})})},"permissions")]})]})})}),Object(e.jsx)(Bt,{resourceType:I.U.FEATURE_FLAGS,isNewResource:r==="new",onChange:function(de){return at(de)},rolesToAdd:Ne,addableRoles:S,addableRolesLoading:Y,onClose:function(){return rt(!1)},title:"Feature Flag Permissions",onAdd:function(){return Pe()},visible:A,roles:De,deleteAssociatedRole:function(de){return y({roleId:de})}})]})}function Xn(s){var n=s.id,r=s.featureFlagKey;return Object(e.jsx)(Un.b,{fixedFilters:{event_filter:"$feature_flag_called",properties:Jt(r)},sceneUrl:ce.a.featureFlag(n),fetchMonths:3,pageKey:"feature-flag-".concat(r,"}"),showEventFilter:!1,showPropertyFilter:!1})}function cn(s){var n=s.readOnly,r=Object(j.useValues)(Se),a=r.multivariateEnabled,i=r.variants,o=r.areVariantRolloutsValid,d=r.featureFlagLoading,c=r.variantRolloutSum,m=r.nonEmptyVariants,l=r.aggregationTargetName,O=r.featureFlag,x=Object(j.useActions)(Se),h=x.distributeVariantsEqually,F=x.addVariant,v=x.removeVariant,V=x.setMultivariateEnabled,A=Object(ie.useState)(!1),S=D()(A,2),Y=S[0],Ne=S[1],De=Object(j.useValues)(U.a),Ue=De.hasAvailableFeature,rt=Object(j.useValues)(Nn.b),at=rt.upgradeLink;return Object(e.jsxs)(e.Fragment,{children:[n?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex flex-col mb-4",children:[Object(e.jsx)("span",{className:"card-secondary",children:"Type"}),Object(e.jsx)("span",{children:O.filters.multivariate?"Multiple variants with rollout percentages (A/B/C test)":"Release toggle (boolean)"}),Object(e.jsx)("span",{className:"card-secondary mt-4",children:"Flag persistence"}),Object(e.jsxs)("span",{children:["This flag"," ",Object(e.jsxs)("b",{children:[O.ensure_experience_continuity?"persists":"does not persist"," "]}),"across authentication events."]})]}),Object(e.jsx)(Ve.a,{className:"my-3"}),O.filters.multivariate&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("div",{className:"mb-2",children:Object(e.jsx)("b",{children:"Variant keys"})}),Object(e.jsxs)("div",{className:"border rounded p-4 mb-4",children:[Object(e.jsxs)(P.a,{className:"font-semibold",children:[Object(e.jsx)(K.a,{span:10,children:"Key"}),Object(e.jsx)(K.a,{span:11,children:"Description"}),Object(e.jsx)(K.a,{span:3,children:"Rollout"})]}),Object(e.jsx)(Ve.a,{className:"my-3"}),i.map(function(Pe,y){return Object(e.jsxs)("div",{children:[Object(e.jsxs)(P.a,{children:[Object(e.jsxs)(K.a,{span:10,children:[Object(e.jsx)(Lt.a,{name:R.c[y],color:Lt.b.Gray}),Object(e.jsx)(nn.a,{tooltipMessage:null,description:"key",style:{marginLeft:"0.5rem"},iconStyle:{color:"var(--muted-alt)"},children:Pe.key})]}),Object(e.jsx)(K.a,{span:12,children:Pe.name||"There is no description for this variant key"}),Object(e.jsxs)(K.a,{span:2,children:[Pe.rollout_percentage,"%"]})]}),y!==i.length-1&&Object(e.jsx)(Ve.a,{className:"my-3"})]},y)})]})]})]}):Object(e.jsxs)("div",{className:"mb-8",children:[Object(e.jsx)("h3",{className:"l4",children:"Served value"}),Object(e.jsx)("div",{className:"mb-2",children:Object(e.jsx)(ne.a,{placement:"top",title:"Change value type? The variants below will be lost.",disabled:d,visible:Y,onConfirm:function(){V(!1),Ne(!1)},onCancel:function(){return Ne(!1)},okText:"OK",cancelText:"Cancel",children:Object(e.jsx)(se.a.Group,{options:[{label:"Release toggle (boolean)",value:!1},{label:Object(e.jsx)(bn.a,{title:Ue(I.e.MULTIVARIATE_FLAGS)?"":"This feature is not available on your current plan.",children:Object(e.jsxs)("div",{children:[!Ue(I.e.MULTIVARIATE_FLAGS)&&Object(e.jsx)(It.a,{to:at,target:"_blank",children:Object(e.jsx)(Ce.a,{style:{marginRight:4,color:"var(--warning)"}})}),"Multiple variants with rollout percentages (A/B test)"]})}),value:!0,disabled:!Ue(I.e.MULTIVARIATE_FLAGS)}],onChange:function(y){var Z=y.target.value;Z===!1&&m.length?Ne(!0):(V(Z),ln(0))},value:a,optionType:"button"})})}),Object(e.jsxs)("div",{className:"text-muted mb-4",children:[Object(R.i)(l)," will be served"," ",a?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("strong",{children:"a variant key"})," according to the below distribution"]}):Object(e.jsx)("strong",{children:Object(e.jsx)("code",{children:"true"})})," ","if they match one or more release condition groups."]})]}),!n&&a&&Object(e.jsxs)("div",{className:"feature-flag-variants",children:[Object(e.jsx)("h3",{className:"l4",children:"Variant keys"}),Object(e.jsx)("span",{children:"The rollout percentage of feature flag variants must add up to 100%"}),Object(e.jsxs)("div",{className:"variant-form-list space-y-2",children:[Object(e.jsxs)(P.a,{gutter:8,className:"label-row",children:[Object(e.jsx)(K.a,{span:1}),Object(e.jsx)(K.a,{span:6,children:"Variant key"}),Object(e.jsx)(K.a,{span:12,children:"Description"}),Object(e.jsxs)(K.a,{span:4,children:["Rollout",Object(e.jsx)(je.a,{type:"tertiary",onClick:h,children:"(Redistribute)"})]})]}),i.map(function(Pe,y){return Object(e.jsx)(ve.Group,{name:["filters","multivariate","variants",y],children:Object(e.jsxs)(P.a,{gutter:8,align:"middle",children:[Object(e.jsx)(K.a,{span:1,children:Object(e.jsx)(Lt.a,{name:R.c[y],color:Lt.b.Gray})}),Object(e.jsx)(K.a,{span:6,children:Object(e.jsx)(xe.a,{name:"key",children:Object(e.jsx)(Yt.a,{"data-attr":"feature-flag-variant-key","data-key-index":y.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(y+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})}),Object(e.jsx)(K.a,{span:12,children:Object(e.jsx)(xe.a,{name:"name",children:Object(e.jsx)(Yt.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"})})}),Object(e.jsx)(K.a,{span:3,children:Object(e.jsx)(xe.a,{name:"rollout_percentage",children:function(Ee){var Ze=Ee.value,ke=Ee.onChange;return Object(e.jsx)(me.a,{min:0,max:100,value:Ze,onChange:function(z){if(z!=null){var Te=parseInt(z.toString());isNaN(Te)||ke(Te)}},style:{width:"100%",borderColor:o?void 0:"var(--danger)"}})}})}),Object(e.jsx)(K.a,{span:2,children:Object(e.jsx)(P.a,{children:i.length>1&&Object(e.jsx)(je.a,{icon:Object(e.jsx)(te.IconDelete,{}),status:"primary-alt","data-attr":"delete-prop-filter-".concat(y),noPadding:!0,onClick:function(){return v(y)}})})})]})},y)}),i.length>0&&!o&&Object(e.jsxs)("p",{className:"text-danger",children:["Percentage rollouts for variants must sum to 100 (currently ",c,")."]}),Object(e.jsx)(je.a,{type:"secondary",onClick:function(){var y=i.length;F(),ln(y)},icon:Object(e.jsx)(te.IconPlus,{}),center:!0,children:"Add variant"})]})]})]})}function dn(s){var n,r,a=s.readOnly,i=Object(j.useValues)(Xe.a),o=i.showGroupsOptions,d=i.aggregationLabel,c=Object(j.useValues)(Se),m=c.aggregationTargetName,l=c.featureFlag,O=c.groupTypes,x=c.taxonomicGroupTypes,h=c.nonEmptyVariants,F=Object(j.useActions)(Se),v=F.setAggregationGroupTypeIndex,V=F.updateConditionSet,A=F.duplicateConditionSet,S=F.removeConditionSet,Y=F.addConditionSet,Ne=Object(j.useValues)(Mn.a),De=Ne.cohortsById,Ue=Object(j.useValues)(Xt.a),rt=Ue.featureFlags,at=Mt({value:-2}),Pe=function(Z){return!!Z.find(function(Ee){return Ee.type==="cohort"||!Ge.l.includes(Ee.key||"")})};return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"feature-flag-form-row",children:[Object(e.jsx)("div",{"data-attr":"feature-flag-release-conditions",children:a?Object(e.jsx)("div",{className:"mb-2",children:Object(e.jsx)("b",{children:"Release conditions"})}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h3",{className:"l4",children:"Release conditions"}),Object(e.jsxs)("div",{className:"text-muted mb-4",children:["Specify the ",m," to which you want to release this flag. Note that condition sets are rolled out independently of each other."]})]})}),!a&&o&&Object(e.jsxs)("div",{className:"centered",children:["Match by",Object(e.jsxs)(T.a,{value:((n=l.filters)===null||n===void 0?void 0:n.aggregation_group_type_index)!=null?(r=l.filters)===null||r===void 0?void 0:r.aggregation_group_type_index:-1,onChange:function(Z){var Ee=Z!==-1?Z:null;v(Ee)},style:{marginLeft:8},"data-attr":"feature-flag-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]},children:[Object(e.jsx)(T.a.Option,{value:-1,children:"Users"},-1),O.map(function(y){return Object(e.jsx)(T.a.Option,{value:y.group_type_index,children:Object(R.i)(d(y.group_type_index).plural)},y.group_type_index)}),at]})]})]}),Object(e.jsx)(P.a,{gutter:16,children:l.filters.groups.map(function(y,Z){var Ee,Ze,ke,ot;return Object(e.jsxs)(K.a,{span:24,md:24,children:[Z>0&&Object(e.jsx)("div",{className:"condition-set-separator",children:"OR"}),Object(e.jsxs)("div",{className:"mb-4 border rounded p-4",children:[Object(e.jsxs)(P.a,{align:"middle",justify:"space-between",children:[Object(e.jsxs)(P.a,{align:"middle",children:[Object(e.jsxs)("span",{className:"simple-tag tag-light-blue font-medium mr-2",children:["Set ",Z+1]}),Object(e.jsx)("div",{children:(Ee=y.properties)!==null&&Ee!==void 0&&Ee.length?Object(e.jsx)(e.Fragment,{children:a?Object(e.jsxs)(e.Fragment,{children:["Match ",Object(e.jsx)("b",{children:m})," against ",Object(e.jsx)("b",{children:"all"})," criteria"]}):Object(e.jsxs)(e.Fragment,{children:["Matching ",Object(e.jsx)("b",{children:m})," against the criteria"]})}):Object(e.jsxs)(e.Fragment,{children:["Condition set will match ",Object(e.jsxs)("b",{children:["all ",m]})]})})]}),!a&&Object(e.jsxs)(P.a,{children:[Object(e.jsx)(je.a,{icon:Object(e.jsx)(te.IconCopy,{}),status:"muted",noPadding:!0,onClick:function(){return A(Z)}}),l.filters.groups.length>1&&Object(e.jsx)(je.a,{icon:Object(e.jsx)(te.IconDelete,{}),status:"muted",noPadding:!0,onClick:function(){return S(Z)}})]})]}),Object(e.jsx)(Ve.a,{className:"my-3"}),!a&&Pe(y.properties)&&Object(e.jsxs)(tn.a,{type:"info",className:"mt-3 mb-3",children:["These properties aren't immediately available on first page load for unidentified persons. This feature flag requires that at least one event is sent prior to becoming available to your product or website."," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/integrate/client/js#bootstrapping-flags",target:"_blank",children:[" ","Learn more about how to make feature flags available instantly."]})]}),a?Object(e.jsx)(e.Fragment,{children:y.properties.map(function(z,Te){return Object(e.jsx)(e.Fragment,{children:Object(e.jsxs)("div",{className:"feature-flag-property-display",children:[Te===0?Object(e.jsx)(je.a,{icon:Object(e.jsx)(te.IconSubArrowRight,{className:"arrow-right"}),status:"muted",size:"small"}):Object(e.jsx)(je.a,{icon:Object(e.jsx)("span",{className:"text-sm",children:"&"}),status:"muted",size:"small"}),Object(e.jsxs)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:[z.type==="cohort"?"Cohort":z.key," "]}),Object(Wn.d)(z)?Object(e.jsxs)("span",{children:[Object(Fn.a)(z.operator)," "]}):null,w()(Array.isArray(z.value)?z.value:[z.value]).map(function(it,Nt){var re;return Object(e.jsx)("span",{className:"simple-tag tag-light-blue text-primary-alt display-value",children:z.type==="cohort"?it&&((re=De[it])===null||re===void 0?void 0:re.name)||"ID ".concat(it):it},Nt)})]})})})}):Object(e.jsx)("div",{children:Object(e.jsx)(fe.a,{orFiltering:!0,pageKey:"feature-flag-".concat(l.id,"-").concat(Z,"-").concat(l.filters.groups.length,"-").concat((Ze=l.filters.aggregation_group_type_index)!==null&&Ze!==void 0?Ze:""),propertyFilters:y==null?void 0:y.properties,logicalRowDivider:!0,addButton:Object(e.jsx)(je.a,{icon:Object(e.jsx)(te.IconPlusMini,{}),noPadding:!0,children:"Add condition"}),onChange:function(Te){return V(Z,void 0,Te)},taxonomicGroupTypes:x,hasRowOperator:!1})}),(!a||a&&((ke=y.properties)===null||ke===void 0?void 0:ke.length)>0)&&Object(e.jsx)(Ve.a,{className:"my-3"}),a?Object(e.jsxs)("div",{children:["Rolled out to"," ",Object(e.jsxs)("b",{children:[y.rollout_percentage!=null?y.rollout_percentage:100,"%"]})," of"," ",Object(e.jsx)("b",{children:m})," in this set"]}):Object(e.jsx)("div",{className:"feature-flag-form-row",children:Object(e.jsxs)("div",{className:"centered",children:["Roll out to"," ",Object(e.jsx)(me.a,{style:{width:100,marginLeft:8,marginRight:8},onChange:function(Te){V(Z,Te)},value:y.rollout_percentage!=null?y.rollout_percentage:100,min:0,max:100,addonAfter:"%"})," ","of ",Object(e.jsx)("b",{children:m})," in this set"]})}),rt[Ge.i.VARIANT_OVERRIDES]&&h.length>0&&Object(e.jsxs)(e.Fragment,{children:[(!a||a&&((ot=y.properties)===null||ot===void 0?void 0:ot.length)>0)&&Object(e.jsx)(Ve.a,{className:"my-3"}),a?Object(e.jsxs)("div",{children:["All ",Object(e.jsx)("b",{children:m})," in this set"," ",y.variant?Object(e.jsxs)(e.Fragment,{children:[" ","will be in variant ",Object(e.jsx)("b",{children:y.variant})]}):Object(e.jsx)(e.Fragment,{children:"have no variant override"})]}):Object(e.jsx)("div",{className:"feature-flag-form-row",children:Object(e.jsxs)("div",{className:"centered",children:[Object(e.jsx)("b",{children:"Optional override:"})," Set variant for all"," ",Object(e.jsx)("b",{children:m})," in this set to"," ",Object(e.jsx)(ge.LemonSelect,{placeholder:"Select variant",allowClear:!0,value:y.variant,onChange:function(Te){return V(Z,void 0,void 0,Te||void 0)},options:h.map(function(z){return{label:z.key,value:z.key}}),"data-attr":"feature-flags-variant-override-select"})]})})]})]})]},"".concat(Z,"-").concat(l.filters.groups.length))})}),!a&&Object(e.jsx)(je.a,{type:"secondary",className:"mt-0",onClick:Y,icon:Object(e.jsx)(te.IconPlus,{}),children:"Add condition set"})]})}try{_t.displayName="FeatureFlag",_t.__docgenInfo={description:"",displayName:"FeatureFlag",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"]={docgenInfo:_t.__docgenInfo,name:"FeatureFlag",path:"frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"})}catch(s){}},"./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx":function(pe,C,t){"use strict";t.d(C,"a",function(){return Ut}),t.d(C,"b",function(){return ht});var Q=t("./node_modules/core-js/modules/es.symbol.js"),w=t.n(Q),be=t("./node_modules/core-js/modules/es.array.filter.js"),D=t.n(be),_e=t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Fe=t.n(_e),ae=t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ae=t.n(ae),Ie=t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Ke=t.n(Ie),oe=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Re=t.n(oe),ie=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ve=t.n(ie),Oe=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),P=t.n(Oe),K=t("./node_modules/@babel/runtime/regenerator/index.js"),E=t.n(K),ue=t("./node_modules/core-js/modules/es.array.iterator.js"),ne=t.n(ue),se=t("./node_modules/core-js/modules/es.object.to-string.js"),me=t.n(se),T=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),j=t.n(T),R=t("./node_modules/core-js/modules/es.array.map.js"),fe=t.n(R),Ce=t("./node_modules/core-js/modules/es.array.concat.js"),qe=t.n(Ce),et=t("./node_modules/core-js/modules/es.object.keys.js"),k=t.n(et),ze=t("./node_modules/kea/lib/index.esm.js"),lt=t("./node_modules/kea-loaders/lib/index.js"),Ot=t.n(lt),tt=t("./frontend/src/lib/api.ts"),q=t("./frontend/src/types.ts"),Je;function We(G,J){var X=Object.keys(G);if(Object.getOwnPropertySymbols){var ee=Object.getOwnPropertySymbols(G);J&&(ee=ee.filter(function(we){return Object.getOwnPropertyDescriptor(G,we).enumerable})),X.push.apply(X,ee)}return X}function ct(G){for(var J=1;J<arguments.length;J++){var X=arguments[J]!=null?arguments[J]:{};J%2?We(Object(X),!0).forEach(function(ee){P()(G,ee,X[ee])}):Object.getOwnPropertyDescriptors?Object.defineProperties(G,Object.getOwnPropertyDescriptors(X)):We(Object(X)).forEach(function(ee){Object.defineProperty(G,ee,Object.getOwnPropertyDescriptor(X,ee))})}return G}var M=P()({},q.U.FEATURE_FLAGS,"Feature Flags"),Ut=(Je={},P()(Je,q.a.WRITE,"View & Edit"),P()(Je,q.a.READ,"View Only"),Je),ht=Object(ze.kea)([Object(ze.path)(["scenes","organization","Settings","Permissions","permissionsLogic"]),Object(lt.loaders)(function(G){var J=G.values;return{organizationResourcePermissions:[[],{loadOrganizationResourcePermissions:function(){var X=ve()(E.a.mark(function we(){var Le;return E.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,tt.b.resourcePermissions.list();case 2:return Le=I.sent,I.abrupt("return",(Le==null?void 0:Le.results)||[]);case 4:case"end":return I.stop()}},we)}));function ee(){return X.apply(this,arguments)}return ee}(),updateOrganizationResourcePermission:function(){var X=ve()(E.a.mark(function we(Le){var nt,I,he,le,ce;return E.a.wrap(function($){for(;;)switch($.prev=$.next){case 0:if(nt=Le.id,I=Le.resource,he=Le.access_level,!nt){$.next=8;break}return $.next=4,tt.b.resourcePermissions.update(nt,{access_level:he});case 4:return le=$.sent,$.abrupt("return",J.organizationResourcePermissions.map(function(Xe){return Xe.id==le.id?le:Xe}));case 8:return $.next=10,tt.b.resourcePermissions.create({resource:I,access_level:he});case 10:return ce=$.sent,$.abrupt("return",[].concat(Re()(J.organizationResourcePermissions),[ce]));case 12:case"end":return $.stop()}},we)}));function ee(we){return X.apply(this,arguments)}return ee}()}]}}),Object(ze.selectors)({organizationResourcePermissionsMap:[function(G){return[G.organizationResourcePermissions]},function(G){return G.reduce(function(J,X){return ct(ct({},J),{},P()({},X.resource,X))},{})}],allPermissions:[function(G){return[G.organizationResourcePermissionsMap]},function(G){return Object.keys(M).map(function(J){var X,ee;return{id:((X=G[J])===null||X===void 0?void 0:X.id)||null,resource:J,name:M[J],access_level:((ee=G[J])===null||ee===void 0?void 0:ee.access_level)||q.a.WRITE}})}]}),Object(ze.afterMount)(function(G){var J=G.actions;J.loadOrganizationResourcePermissions()})])},"./frontend/src/scenes/organization/Settings/Roles/rolesLogic.tsx":function(pe,C,t){"use strict";t.d(C,"a",function(){return wt});var Q=t("./node_modules/core-js/modules/es.object.keys.js"),w=t.n(Q),be=t("./node_modules/core-js/modules/es.symbol.js"),D=t.n(be),_e=t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Fe=t.n(_e),ae=t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ae=t.n(ae),Ie=t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Ke=t.n(Ie),oe=t("./node_modules/core-js/modules/es.array.slice.js"),Re=t.n(oe),ie=t("./node_modules/core-js/modules/es.function.name.js"),ve=t.n(ie),Oe=t("./node_modules/core-js/modules/es.array.from.js"),P=t.n(Oe),K=t("./node_modules/core-js/modules/es.regexp.exec.js"),E=t.n(K),ue=t("./node_modules/core-js/modules/es.symbol.description.js"),ne=t.n(ue),se=t("./node_modules/core-js/modules/es.symbol.iterator.js"),me=t.n(se),T=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),j=t.n(T),R=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),fe=t.n(R),Ce=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),qe=t.n(Ce),et=t("./node_modules/@babel/runtime/regenerator/index.js"),k=t.n(et),ze=t("./node_modules/core-js/modules/es.array.map.js"),lt=t.n(ze),Ot=t("./node_modules/core-js/modules/es.array.iterator.js"),tt=t.n(Ot),q=t("./node_modules/core-js/modules/es.object.to-string.js"),Je=t.n(q),We=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),ct=t.n(We),M=t("./node_modules/core-js/modules/es.array.concat.js"),Ut=t.n(M),ht=t("./node_modules/core-js/modules/es.array.filter.js"),G=t.n(ht),J=t("./node_modules/core-js/modules/es.promise.js"),X=t.n(J),ee=t("./node_modules/core-js/modules/es.string.iterator.js"),we=t.n(ee),Le=t("./node_modules/core-js/modules/es.object.assign.js"),nt=t.n(Le),I=t("./node_modules/core-js/modules/es.array.sort.js"),he=t.n(I),le=t("./node_modules/kea/lib/index.esm.js"),ce=t("./node_modules/kea-loaders/lib/index.js"),dt=t.n(ce),$=t("./frontend/src/lib/api.ts"),Xe=t("./frontend/src/scenes/project/Settings/teamMembersLogic.tsx"),Me=t("./frontend/src/types.ts");function Wt(p,g){var f=typeof Symbol!="undefined"&&p[Symbol.iterator]||p["@@iterator"];if(!f){if(Array.isArray(p)||(f=Vt(p))||g&&p&&typeof p.length=="number"){f&&(p=f);var _=0,B=function(){};return{s:B,n:function(){return _>=p.length?{done:!0}:{done:!1,value:p[_++]}},e:function(U){throw U},f:B}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var N=!0,W=!1,L;return{s:function(){f=f.call(p)},n:function(){var U=f.next();return N=U.done,U},e:function(U){W=!0,L=U},f:function(){try{!N&&f.return!=null&&f.return()}finally{if(W)throw L}}}}function Vt(p,g){if(!!p){if(typeof p=="string")return ut(p,g);var f=Object.prototype.toString.call(p).slice(8,-1);if(f==="Object"&&p.constructor&&(f=p.constructor.name),f==="Map"||f==="Set")return Array.from(p);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return ut(p,g)}}function ut(p,g){(g==null||g>p.length)&&(g=p.length);for(var f=0,_=new Array(g);f<g;f++)_[f]=p[f];return _}function bt(p,g){var f=Object.keys(p);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(p);g&&(_=_.filter(function(B){return Object.getOwnPropertyDescriptor(p,B).enumerable})),f.push.apply(f,_)}return f}function mt(p){for(var g=1;g<arguments.length;g++){var f=arguments[g]!=null?arguments[g]:{};g%2?bt(Object(f),!0).forEach(function(_){qe()(p,_,f[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(f)):bt(Object(f)).forEach(function(_){Object.defineProperty(p,_,Object.getOwnPropertyDescriptor(f,_))})}return p}var wt=Object(le.kea)([Object(le.path)(["scenes","organization","rolesLogic"]),Object(le.connect)({values:[Xe.b,["plainMembers"]]}),Object(le.actions)({setCreateRoleModalShown:function(g){return{shown:g}},setRoleInFocus:function(g){return{role:g}},setRoleMembersInFocus:function(g){return{roleMembers:g}},setRoleMembersToAdd:function(g){return{uuids:g}},openCreateRoleModal:!0,setPermission:function(g,f){return{resource:g,access:f}},setPermissionInPlace:function(g,f){return{resource:g,access:f}},clearPermission:!0,updateRole:function(g){return{role:g}}}),Object(le.reducers)({createRoleModalShown:[!1,{setCreateRoleModalShown:function(g,f){var _=f.shown;return _}}],roleInFocus:[null,{setRoleInFocus:function(g,f){var _=f.role;return _}}],roleMembersInFocus:[[],{setRoleMembersInFocus:function(g,f){var _=f.roleMembers;return _}}],roleMembersToAdd:[[],{setRoleMembersToAdd:function(g,f){var _=f.uuids;return _}}],permissionsToSet:[{},{setPermission:function(g,f){var _=f.resource,B=f.access;return mt(mt({},g),{},qe()({},"".concat(_),B))},clearPermission:function(){return{}}}],roles:[[],{updateRole:function(g,f){var _=f.role;return g.map(function(B){return B.id==_.id?_:B})}}]}),Object(ce.loaders)(function(p){var g=p.values,f=p.actions;return{roles:{loadRoles:function(){var _=fe()(k.a.mark(function N(){var W;return k.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,$.b.roles.list();case 2:return W=b.sent,b.abrupt("return",(W==null?void 0:W.results)||[]);case 4:case"end":return b.stop()}},N)}));function B(){return _.apply(this,arguments)}return B}(),createRole:function(){var _=fe()(k.a.mark(function N(W){var L,b,U,H;return k.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return L=g.roles,b=g.roleMembersToAdd,U=g.permissionsToSet,u.next=3,$.b.roles.create(W,U[Me.U.FEATURE_FLAGS]);case 3:return H=u.sent,u.next=6,f.addRoleMembers({role:H,membersToAdd:b});case 6:return f.setRoleMembersInFocus([]),f.setRoleMembersToAdd([]),f.clearPermission(),f.setCreateRoleModalShown(!1),u.abrupt("return",[H].concat(j()(L)));case 11:case"end":return u.stop()}},N)}));function B(N){return _.apply(this,arguments)}return B}(),deleteRole:function(){var _=fe()(k.a.mark(function N(W){return k.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,$.b.roles.delete(W.id);case 2:return b.abrupt("return",g.roles.filter(function(U){return U.id!==W.id}));case 3:case"end":return b.stop()}},N)}));function B(N){return _.apply(this,arguments)}return B}()},roleMembersInFocus:[[],{loadRoleMembers:function(){var _=fe()(k.a.mark(function N(W){var L,b;return k.a.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return L=W.roleId,H.next=3,$.b.roles.members.list(L);case 3:return b=H.sent,H.abrupt("return",(b==null?void 0:b.results)||[]);case 5:case"end":return H.stop()}},N)}));function B(N){return _.apply(this,arguments)}return B}(),addRoleMembers:function(){var _=fe()(k.a.mark(function N(W){var L,b,U;return k.a.wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return L=W.role,b=W.membersToAdd,Be.next=3,Promise.all(b.map(function(){var u=fe()(k.a.mark(function yt(ft){return k.a.wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return $e.next=2,$.b.roles.members.create(L.id,ft);case 2:return $e.abrupt("return",$e.sent);case 3:case"end":return $e.stop()}},yt)}));return function(yt){return u.apply(this,arguments)}}()));case 3:return U=Be.sent,f.setRoleMembersToAdd([]),Be.abrupt("return",[].concat(j()(g.roleMembersInFocus),j()(U)));case 6:case"end":return Be.stop()}},N)}));function B(N){return _.apply(this,arguments)}return B}(),deleteRoleMember:function(){var _=fe()(k.a.mark(function N(W){var L;return k.a.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(L=W.roleMemberUuid,U.t0=g.roleInFocus,!U.t0){U.next=5;break}return U.next=5,$.b.roles.members.delete(g.roleInFocus.id,L);case 5:return U.abrupt("return",g.roleMembersInFocus.filter(function(H){return H.id!==L}));case 6:case"end":return U.stop()}},N)}));function B(N){return _.apply(this,arguments)}return B}()}]}}),Object(le.listeners)(function(p){var g=p.actions,f=p.values;return{setRoleInFocus:function(B){var N=B.role;N&&g.loadRoleMembers({roleId:N.id}),g.setCreateRoleModalShown(!0)},openCreateRoleModal:function(){g.setRoleInFocus(null),g.setRoleMembersInFocus([]),g.setCreateRoleModalShown(!0)},setCreateRoleModalShown:function(){f.roleInFocus?g.setPermission(Me.U.FEATURE_FLAGS,f.roleInFocus.feature_flags_access_level):g.setPermission(Me.U.FEATURE_FLAGS,Me.a.WRITE)},setPermissionInPlace:function(){var _=fe()(k.a.mark(function N(W){var L,b;return k.a.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(L=W.access,!f.roleInFocus){H.next=9;break}if(H.t0=L,!H.t0){H.next=6;break}return H.next=6,$.b.roles.update(f.roleInFocus.id,{feature_flags_access_level:L});case 6:b=Object.assign({},f.roleInFocus),b.feature_flags_access_level=L,g.updateRole(b);case 9:case"end":return H.stop()}},N)}));function B(N){return _.apply(this,arguments)}return B}()}}),Object(le.selectors)({addableMembers:[function(p){return[p.plainMembers,p.roleMembersInFocus]},function(p,g){var f=[],_=Wt(p),B;try{var N=function(){var L=B.value;g.some(function(b){return b.user.uuid===L.user.uuid})||f.push(L.user)};for(_.s();!(B=_.n()).done;)N()}catch(W){_.e(W)}finally{_.f()}return f.sort(function(W,L){return W.first_name.localeCompare(L.first_name)}),f}]}),Object(le.afterMount)(function(p){var g=p.actions;g.loadRoles()})])},"./frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx":function(pe,C,t){"use strict";t.d(C,"a",function(){return Fe});var Q=t("./frontend/@posthog/lemon-ui/src/index.ts"),w=t("./node_modules/react/index.js"),be=t.n(w),D=t("./node_modules/react/jsx-runtime.js"),_e=t.n(D);function Fe(ae){var Ae=ae.to,Ie=ae.onClick,Ke=ae.title,oe=ae.subtitle,Re=ae.prefix,ie=ae.suffix;return Object(D.jsx)(Q.LemonButton,{fullWidth:!0,to:Ae,onClick:Ie,children:Object(D.jsxs)("div",{className:"flex items-center justify-between h-10 overflow-hidden gap-2 flex-1",children:[Re?Object(D.jsx)("span",{className:"shrink-0",children:Re}):null,Object(D.jsxs)("div",{className:"truncate space-y-1 flex-1",children:[Object(D.jsx)("div",{className:"text-primary font-semibold truncate",children:Ke}),Object(D.jsx)("div",{className:"truncate text-default font-normal",children:oe})]}),ie?Object(D.jsx)("span",{className:"shrink-0",children:ie}):null]})})}try{Fe.displayName="ProjectHomePageCompactListItem",Fe.__docgenInfo={description:"",displayName:"ProjectHomePageCompactListItem",props:{to:{defaultValue:null,description:"URL to link to.",name:"to",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},subtitle:{defaultValue:null,description:"",name:"subtitle",required:!0,type:{name:"string"}},prefix:{defaultValue:null,description:"",name:"prefix",required:!1,type:{name:"ReactNode"}},suffix:{defaultValue:null,description:"",name:"suffix",required:!1,type:{name:"ReactNode"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx#ProjectHomePageCompactListItem"]={docgenInfo:Fe.__docgenInfo,name:"ProjectHomePageCompactListItem",path:"frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx#ProjectHomePageCompactListItem"})}catch(ae){}},"./frontend/src/scenes/project-homepage/ProjectHomepage.scss":function(pe,C,t){"use strict";var Q=t("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),w=t.n(Q),be=t("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/project-homepage/ProjectHomepage.scss"),D=t.n(be),_e={};_e.insert="head",_e.singleton=!1;var Fe=w()(D.a,_e),ae=D.a.locals||{}},"./frontend/src/scenes/project-homepage/RecentInsights.tsx":function(pe,C,t){"use strict";t.d(C,"a",function(){return E}),t.d(C,"b",function(){return ue});var Q=t("./node_modules/core-js/modules/es.function.name.js"),w=t.n(Q),be=t("./node_modules/core-js/modules/es.array.slice.js"),D=t.n(be),_e=t("./node_modules/react/index.js"),Fe=t.n(_e),ae=t("./frontend/src/scenes/project-homepage/ProjectHomepage.scss"),Ae=t("./node_modules/kea/lib/index.esm.js"),Ie=t("./frontend/src/lib/dayjs.ts"),Ke=t("./frontend/src/lib/components/CompactList/CompactList.tsx"),oe=t("./frontend/src/scenes/urls.ts"),Re=t("./frontend/src/scenes/saved-insights/SavedInsights.tsx"),ie=t("./frontend/src/scenes/project-homepage/projectHomepageLogic.tsx"),ve=t("./frontend/src/lib/utils/eventUsageLogic.ts"),Oe=t("./frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx"),P=t("./node_modules/react/jsx-runtime.js"),K=t.n(P);function E(ne){var se=ne.insight,me=Object(Ae.useActions)(ve.e),T=me.reportInsightOpenedFromRecentInsightList;return Object(P.jsx)(Oe.a,{title:se.name||se.derived_name||"Insight",subtitle:"Last modified ".concat(Object(Ie.a)(se.last_modified_at).fromNow()),prefix:Object(P.jsx)(Re.InsightIcon,{insight:se}),to:oe.a.insightView(se.short_id),onClick:function(){T()}})}function ue(){var ne=Object(Ae.useValues)(ie.a),se=ne.recentInsights,me=ne.recentInsightsLoading,T=Object(Ae.useActions)(ie.a),j=T.loadRecentInsights;return Object(_e.useEffect)(function(){j()},[]),Object(P.jsx)(P.Fragment,{children:Object(P.jsx)(Ke.a,{title:"Your recently viewed insights",viewAllURL:oe.a.savedInsights(),loading:me,emptyMessage:{title:"You have no recently viewed insights",description:"Explore this project's insights by clicking below.",buttonText:"View insights",buttonTo:oe.a.savedInsights()},items:se.slice(0,5),renderRow:function(fe,Ce){return Object(P.jsx)(E,{insight:fe},Ce)}})})}try{E.displayName="InsightRow",E.__docgenInfo={description:"",displayName:"InsightRow",props:{insight:{defaultValue:null,description:"",name:"insight",required:!0,type:{name:"InsightModel"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/project-homepage/RecentInsights.tsx#InsightRow"]={docgenInfo:E.__docgenInfo,name:"InsightRow",path:"frontend/src/scenes/project-homepage/RecentInsights.tsx#InsightRow"})}catch(ne){}},"./frontend/src/scenes/project-homepage/RecentRecordings.tsx":function(pe,C,t){"use strict";t.d(C,"b",function(){return ne}),t.d(C,"a",function(){return se});var Q=t("./node_modules/core-js/modules/es.array.slice.js"),w=t.n(Q),be=t("./frontend/src/lib/dayjs.ts"),D=t("./node_modules/kea/lib/index.esm.js"),_e=t("./frontend/src/scenes/project-homepage/ProjectHomepage.scss"),Fe=t("./frontend/src/lib/components/CompactList/CompactList.tsx"),ae=t("./frontend/src/lib/components/ProfilePicture/index.ts"),Ae=t("./frontend/src/scenes/persons/PersonHeader.tsx"),Ie=t("./frontend/src/scenes/session-recordings/playlist/sessionRecordingsListLogic.ts"),Ke=t("./frontend/src/scenes/urls.ts"),oe=t("./frontend/src/lib/utils/eventUsageLogic.ts"),Re=t("./frontend/src/lib/utils.tsx"),ie=t("./frontend/src/lib/components/icons.tsx"),ve=t("./frontend/src/scenes/session-recordings/player/modal/SessionPlayerModal.tsx"),Oe=t("./frontend/src/scenes/teamLogic.tsx"),P=t("./frontend/src/scenes/session-recordings/player/modal/sessionPlayerModalLogic.ts"),K=t("./frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx"),E=t("./node_modules/react/jsx-runtime.js"),ue=t.n(E);function ne(me){var T=me.recording,j=Object(D.useActions)(P.a),R=j.openSessionPlayer,fe=Object(D.useActions)(oe.e),Ce=fe.reportRecordingOpenedFromRecentRecordingList;return Object(E.jsx)(K.a,{title:Object(Ae.b)(T.person),subtitle:"Recorded ".concat(Object(be.a)(T.start_time).fromNow()),prefix:Object(E.jsx)(ae.b,{name:Object(Ae.b)(T.person)}),suffix:Object(E.jsxs)("div",{className:"flex items-center justify-end text-default",children:[Object(E.jsx)("span",{children:Object(Re.O)(T.recording_duration)}),Object(E.jsx)(ie.IconPlayCircle,{className:"text-2xl ml-2"})]}),onClick:function(){R({id:T.id,matching_events:T.matching_events}),Ce()}})}function se(){var me=Object(D.useValues)(Oe.a),T=me.currentTeam,j=Object(Ie.d)({key:"projectHomepage"}),R=Object(D.useValues)(j),fe=R.sessionRecordings,Ce=R.sessionRecordingsResponseLoading;return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(ve.a,{}),Object(E.jsx)(Fe.a,{title:"Recent recordings",viewAllURL:Ke.a.sessionRecordings(),loading:Ce,emptyMessage:T!=null&&T.session_recording_opt_in?{title:"There are no recordings for this project",description:"Make sure you have the javascript snippet setup in your website.",buttonText:"Learn more",buttonTo:"https://posthog.com/docs/user-guides/recordings"}:{title:"Recordings are not enabled for this project",description:"Once recordings are enabled, new recordings will display here.",buttonText:"Enable recordings",buttonTo:Ke.a.projectSettings()+"#recordings"},items:fe.slice(0,5),renderRow:function(et,k){return Object(E.jsx)(ne,{recording:et},k)}})]})}try{ne.displayName="RecordingRow",ne.__docgenInfo={description:"",displayName:"RecordingRow",props:{recording:{defaultValue:null,description:"",name:"recording",required:!0,type:{name:"SessionRecordingType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/project-homepage/RecentRecordings.tsx#RecordingRow"]={docgenInfo:ne.__docgenInfo,name:"RecordingRow",path:"frontend/src/scenes/project-homepage/RecentRecordings.tsx#RecordingRow"})}catch(me){}},"./frontend/src/scenes/project-homepage/projectHomepageLogic.tsx":function(pe,C,t){"use strict";t.d(C,"a",function(){return K});var Q=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),w=t.n(Q),be=t("./node_modules/@babel/runtime/regenerator/index.js"),D=t.n(be),_e=t("./node_modules/core-js/modules/es.array.iterator.js"),Fe=t.n(_e),ae=t("./node_modules/core-js/modules/es.object.to-string.js"),Ae=t.n(ae),Ie=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Ke=t.n(Ie),oe=t("./node_modules/kea/lib/index.esm.js"),Re=t("./frontend/src/scenes/teamLogic.tsx"),ie=t("./frontend/src/types.ts"),ve=t("./frontend/src/lib/api.ts"),Oe=t("./node_modules/kea-loaders/lib/index.js"),P=t.n(Oe),K=Object(oe.kea)([Object(oe.path)(["scenes","project-homepage","projectHomepageLogic"]),Object(oe.connect)({values:[Re.a,["currentTeamId","currentTeam"]]}),Object(oe.selectors)({primaryDashboardId:[function(){return[Re.a.selectors.currentTeam]},function(E){return E==null?void 0:E.primary_dashboard}],dashboardLogicProps:[function(E){return[E.primaryDashboardId]},function(E){return{id:E!=null?E:void 0,placement:ie.n.ProjectHomepage}}]}),Object(Oe.loaders)(function(E){var ue=E.values;return{recentInsights:[[],{loadRecentInsights:function(){var ne=w()(D.a.mark(function me(){var T;return D.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,ve.b.get("api/projects/".concat(ue.currentTeamId,"/insights/?my_last_viewed=true&order=-my_last_viewed_at"));case 2:return T=R.sent,R.abrupt("return",T.results);case 4:case"end":return R.stop()}},me)}));function se(){return ne.apply(this,arguments)}return se}()}],persons:[[],{loadPersons:function(){var ne=w()(D.a.mark(function me(){var T;return D.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.next=2,ve.b.persons.list();case 2:return T=R.sent,R.abrupt("return",T.results);case 4:case"end":return R.stop()}},me)}));function se(){return ne.apply(this,arguments)}return se}()}]}}),Object(oe.afterMount)(function(E){var ue=E.actions;ue.loadRecentInsights(),ue.loadPersons()})])},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss":function(pe,C,t){var Q=t("./node_modules/css-loader/dist/runtime/api.js");C=Q(!1),C.push([pe.i,".variant-form-list{font-size:13px;border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-top:16px}.variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}.feature-flag-property-display{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;gap:.5rem;margin-top:.5rem}.feature-flag-property-display .arrow-right{margin-right:-8px;margin-top:.25rem}.feature-flag-property-display .display-value{word-break:break-all}.condition-set-separator{color:var(--primary-alt);font-size:12px;font-weight:var(--font-semibold);margin-left:.5rem;margin-bottom:.5rem}.feature-flag-form-row{display:flex;justify-content:space-between;align-items:center;width:100%}.feature-flag-form-row .centered{display:flex;align-items:center;white-space:pre-wrap}",""]),pe.exports=C},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlagInstructions.scss":function(pe,C,t){var Q=t("./node_modules/css-loader/dist/runtime/api.js");C=Q(!1),C.push([pe.i,".FeatureFlagInstructionsHeader{flex-wrap:nowrap}.FeatureFlagInstructionsHeader .FeatureFlagInstructionsHeader__header-title{display:flex;justify-items:center}.FeatureFlagInstructionsHeader .FeatureFlagInstructionsHeader__header-title .FeatureFlagInstructionsHeader__header-title__icon{color:var(--text-muted-alt);margin-right:12px;font-size:1.6em}.FeatureFlagInstructionsHeader__option{display:flex;justify-items:center}.FeatureFlagInstructionsHeader__option .FeatureFlagInstructionsHeader__option__icon{margin-top:2px;margin-right:8px}",""]),pe.exports=C},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/project-homepage/ProjectHomepage.scss":function(pe,C,t){var Q=t("./node_modules/css-loader/dist/runtime/api.js");C=Q(!1),C.push([pe.i,".project-homepage .homepage-dashboard-header{display:flex;justify-content:space-between;align-items:center}.project-homepage .homepage-dashboard-header .dashboard-title-container{display:flex;flex-direction:row;align-items:center}.project-homepage .homepage-dashboard-header .dashboard-title-container .ant-skeleton{width:300px}.project-homepage .homepage-dashboard-header .dashboard-title-container .ant-skeleton h3{margin:0}.project-homepage .top-list-container-horizontal{display:flex}.project-homepage .top-list-container-horizontal .top-list{margin-bottom:1.5rem;width:33%}.project-homepage .top-list-container-horizontal .spacer{width:1rem}.project-homepage .top-list-container-vertical{margin-bottom:1.5rem}.project-homepage .top-list-container-vertical .spacer{height:1rem}.project-homepage .empty-state-container{background-color:var(--side);width:100%;justify-content:center;align-items:center;padding:4rem;display:flex;flex-direction:column}",""]),pe.exports=C}}]);
