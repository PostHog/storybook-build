"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[32172],{"../../frontend/src/scenes/pipeline/PipelineNodeLogs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{e:()=>PipelineNodeLogs});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.22.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),pipelineNodeLogic=__webpack_require__("../../frontend/src/scenes/pipeline/pipelineNodeLogic.tsx"),api=__webpack_require__("../../frontend/src/lib/api.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),types=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),pipeline_utils=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ALL_LOG_LEVELS=["DEBUG","LOG","INFO","WARNING","ERROR"],pipelineNodeLogsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return id}),(0,index_esm.path)(key=>["scenes","pipeline","pipelineNodeLogsLogic",key]),(0,index_esm.connect)(props=>({values:[(0,teamLogic.teamLogic)(),["currentTeamId"],(0,pipelineNodeLogic.y)(props),["node"]]})),(0,index_esm.actions)({setSelectedLogLevels:levels=>({levels}),setSearchTerm:searchTerm=>({searchTerm}),setInstanceId:instanceId=>({instanceId}),clearBackgroundLogs:!0,markLogsEnd:!0}),(0,lib.loaders)(_ref2=>{let{values,actions,cache}=_ref2;return{logs:[[],{loadLogs:async()=>{var _values$instanceId;let results=[],logParams={search:values.searchTerm,level:values.selectedLogLevelsForAPI.join(","),limit:constants.F2,instance_id:null!==(_values$instanceId=values.instanceId)&&void 0!==_values$instanceId?_values$instanceId:void 0};return results=values.node.backend===types.b.BatchExport?(await api.ZP.batchExports.logs(values.node.id,logParams)).results:values.node.backend===types.b.HogFunction?(await api.ZP.hogFunctions.logs(values.node.id,logParams)).results:await api.ZP.pluginConfigs.logs(Number(values.node.id),logParams),cache.pollingInterval||(cache.pollingInterval=setInterval(actions.pollBackgroundLogs,5e3)),actions.clearBackgroundLogs(),results},loadMoreLogs:async()=>{var _values$instanceId2;let results;let logParams={search:values.searchTerm,level:values.selectedLogLevels.join(","),limit:constants.F2,before:values.trailingEntry?.timestamp,instance_id:null!==(_values$instanceId2=values.instanceId)&&void 0!==_values$instanceId2?_values$instanceId2:void 0};return(results=values.node.backend===types.b.BatchExport?(await api.ZP.batchExports.logs(values.node.id,logParams)).results:values.node.backend===types.b.HogFunction?(await api.ZP.hogFunctions.logs(values.node.id,logParams)).results:await api.ZP.pluginConfigs.logs(Number(values.node.id),logParams)).length<constants.F2&&actions.markLogsEnd(),[...values.logs,...results]},revealBackground:()=>{let newArray=[...values.backgroundLogs,...values.logs];return actions.clearBackgroundLogs(),newArray}}],backgroundLogs:[[],{pollBackgroundLogs:async()=>{var _values$instanceId3;let results;if(values.logsLoading)return values.backgroundLogs;let logParams={search:values.searchTerm,level:values.selectedLogLevels.join(","),limit:constants.F2,after:values.leadingEntry?.timestamp,instance_id:null!==(_values$instanceId3=values.instanceId)&&void 0!==_values$instanceId3?_values$instanceId3:void 0};return[...values.node.backend===types.b.BatchExport?(await api.ZP.batchExports.logs(values.node.id,logParams)).results:values.node.backend===types.b.HogFunction?(await api.ZP.hogFunctions.logs(values.node.id,logParams)).results:await api.ZP.pluginConfigs.logs(Number(values.node.id),logParams),...values.backgroundLogs]}}]}}),(0,index_esm.reducers)({selectedLogLevels:[["LOG","INFO","WARNING","ERROR"],{setSelectedLogLevels:(_,_ref3)=>{let{levels}=_ref3;return levels}}],backgroundLogs:[[],{clearBackgroundLogs:()=>[]}],searchTerm:["",{setSearchTerm:(_,_ref4)=>{let{searchTerm}=_ref4;return searchTerm}}],instanceId:[null,{setInstanceId:(_,_ref5)=>{let{instanceId}=_ref5;return instanceId}}],isThereMoreToLoad:[!0,{loadLogsSuccess:(_,_ref6)=>{let{logs}=_ref6;return logs.length>=constants.F2},markLogsEnd:()=>!1}]}),(0,index_esm.selectors)(_ref7=>{let{actions,values}=_ref7;return{leadingEntry:[s=>[s.logs,s.backgroundLogs],(logs,backgroundLogs)=>backgroundLogs.length?backgroundLogs[0]:logs.length?logs[0]:null],trailingEntry:[s=>[s.logs,s.backgroundLogs],(logs,backgroundLogs)=>logs.length?logs[logs.length-1]:backgroundLogs.length?backgroundLogs[backgroundLogs.length-1]:null],columns:[s=>[s.node],node=>[{title:"Timestamp",key:"timestamp",dataIndex:"timestamp",sorter:(a,b)=>(0,dayjs.Bv)(a.timestamp).unix()-(0,dayjs.Bv)(b.timestamp).unix(),render:timestamp=>(0,jsx_runtime.jsx)(TZLabel.w,{time:timestamp}),width:0},{width:0,title:node.backend==types.b.HogFunction?"Invocation":node.backend==types.b.BatchExport?"Run Id":"Source",dataIndex:"instance_id",key:"instance_id",render:instanceId=>(0,jsx_runtime.jsx)("code",{className:"whitespace-nowrap",children:node.backend!==types.b.Plugin?(0,jsx_runtime.jsx)(src.rU,{subtle:!0,onClick:()=>{values.instanceId===instanceId?actions.setInstanceId(null):actions.setInstanceId(instanceId)},children:instanceId}):instanceId})},{width:100,title:"Level",key:"level",dataIndex:"level",render:pipeline_utils.bH},{title:"Message",key:"message",dataIndex:"message",render:message=>(0,jsx_runtime.jsx)("code",{className:"whitespace-pre-wrap",children:message})}]],selectedLogLevelsForAPI:[s=>[s.selectedLogLevels],logLevels=>{let uniqueLevels=new Set(logLevels);return uniqueLevels.has("WARN")&&uniqueLevels.add("WARNING"),uniqueLevels.has("WARNING")&&uniqueLevels.add("WARN"),Array.from(uniqueLevels)}]}}),(0,index_esm.listeners)(_ref8=>{let{actions}=_ref8;return{setSelectedLogLevels:()=>{actions.loadLogs()},setSearchTerm:async(_ref9,breakpoint)=>{let{searchTerm}=_ref9;searchTerm&&await breakpoint(1e3),actions.loadLogs()},setInstanceId:async()=>{actions.loadLogs()}}}),(0,index_esm.events)(_ref10=>{let{actions,cache}=_ref10;return{afterMount:()=>{actions.loadLogs()},beforeUnmount:()=>{clearInterval(cache.pollingInterval)}}})]);function PipelineNodeLogs(_ref){let{id,stage}=_ref,logic=pipelineNodeLogsLogic({id,stage}),{logs,logsLoading,backgroundLogs,columns,isThereMoreToLoad,selectedLogLevels,instanceId}=(0,index_esm.useValues)(logic),{revealBackground,loadMoreLogs,setSelectedLogLevels,setSearchTerm,setInstanceId}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex-1 ph-no-capture deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search for messages containingâ€¦",fullWidth:!0,onChange:setSearchTerm,allowClear:!0,prefix:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconSearch,{}),instanceId&&(0,jsx_runtime.jsx)(src.LV,{onClose:()=>setInstanceId(null),children:instanceId})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:"Show logs of level:"}),ALL_LOG_LEVELS.map(level=>(0,jsx_runtime.jsx)(src.Hw,{label:level,checked:selectedLogLevels.includes(level),onChange:checked=>{setSelectedLogLevels(checked?[...selectedLogLevels,level]:selectedLogLevels.filter(t=>t!=level))}},level))]}),(0,jsx_runtime.jsx)(src.Jp,{onClick:revealBackground,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:backgroundLogs.length?void 0:"There's nothing to load",children:backgroundLogs.length?`Load ${(0,utils.Zi)(backgroundLogs.length,"newer entry","newer entries")}`:"No new entries"}),(0,jsx_runtime.jsx)(src.g3,{dataSource:logs,columns:columns,loading:logsLoading,className:"ph-no-capture",rowKey:record=>`${record.log_source_id}:${record.instance_id}:${record.timestamp}`,pagination:{pageSize:200,hideOnSinglePage:!0}}),!!logs.length&&(0,jsx_runtime.jsx)(src.Jp,{onClick:loadMoreLogs,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:isThereMoreToLoad?void 0:"There's nothing more to load",children:isThereMoreToLoad?`Load up to ${constants.F2} older entries`:"No older entries"})]})}},"../../frontend/src/scenes/pipeline/PipelineNodeMetrics.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>PipelineNodeMetrics});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.22.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_Chart__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/Chart.ts"),lib_colors__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/colors.ts"),lib_components_CodeSnippet__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/components/CodeSnippet/index.ts"),lib_components_DateFilter_DateFilter__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),lib_components_TZLabel__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonLabel_LemonLabel__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonModal/index.ts"),lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),lib_lemon_ui_Link__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("../../frontend/src/lib/utils.tsx"),react__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_pipelineNodeMetricsLogic__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("../../frontend/src/scenes/pipeline/pipelineNodeMetricsLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelineNodeMetrics(_ref){let{id}=_ref,logic=(0,_pipelineNodeMetricsLogic__WEBPACK_IMPORTED_MODULE_17__.j)({id}),{appMetricsResponse,appMetricsResponseLoading,dateRange}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(logic),{setDateRange}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)(logic);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{className:"deprecated-space-y-8",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(MetricsOverview,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_components_DateFilter_DateFilter__WEBPACK_IMPORTED_MODULE_5__.f,{dateTo:dateRange.to,dateFrom:dateRange.from,onChange:(from,to)=>setDateRange(from,to),allowedRollingDateOptions:["days","weeks","months","years"],makeLabel:key=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconCalendar,{})," ",key]})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("h2",{children:"Delivery trends"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(AppMetricsGraph,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("h2",{children:"Errors"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(ErrorsOverview,{id:id})]})]})}function MetricsOverview(_ref2){let{metrics,metricsLoading}=_ref2;return metricsLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_11__.y,{className:"w-20 h-4 mb-2",repeat:4}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div",{className:"deprecated-space-y-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{className:"text-secondary font-semibold mb-2",children:["Events Processed successfully",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_14__.u,{title:"Total number of events processed successfully",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconInfo,{})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.successes)})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{className:"text-secondary font-semibold mb-2",children:["Events Failed",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_14__.u,{title:"Total number of events that threw an error during processing",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconInfo,{})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.failures)})]})]})})}function renderNumber(value){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment,{children:value?(0,lib_utils__WEBPACK_IMPORTED_MODULE_15__.Lc)(value):value})}function AppMetricsGraph(_ref3){let{metrics,metricsLoading}=_ref3,canvasRef=(0,react__WEBPACK_IMPORTED_MODULE_16__.useRef)(null);return((0,react__WEBPACK_IMPORTED_MODULE_16__.useEffect)(()=>{let chart;if(canvasRef.current&&metrics&&!(0,lib_utils__WEBPACK_IMPORTED_MODULE_15__.es)())return chart=new lib_Chart__WEBPACK_IMPORTED_MODULE_2__.kL(canvasRef.current?.getContext("2d"),{type:"line",data:{labels:metrics.dates,datasets:[{label:"events processed successfully",data:metrics.successes,borderColor:"",...colorConfig("data-color-1")},{label:"events failed",data:metrics.failures,...colorConfig("data-color-5")}]},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}}),()=>{chart?.destroy()}},[metrics]),metricsLoading||!metrics)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_11__.y,{className:"AppMetricsGraph border rounded p-6"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("canvas",{ref:canvasRef})})}function colorConfig(baseColorVar){let mainColor=(0,lib_colors__WEBPACK_IMPORTED_MODULE_3__.cM)(baseColorVar);return{borderColor:mainColor,hoverBorderColor:(0,lib_utils__WEBPACK_IMPORTED_MODULE_15__._$)(mainColor,-20),hoverBackgroundColor:(0,lib_utils__WEBPACK_IMPORTED_MODULE_15__._$)(mainColor,-20),backgroundColor:mainColor,fill:!1,borderWidth:2,pointRadius:0}}function ErrorsOverview(_ref4){let{id}=_ref4,logic=(0,_pipelineNodeMetricsLogic__WEBPACK_IMPORTED_MODULE_17__.j)({id}),{appMetricsResponse,appMetricsResponseLoading}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(logic),{openErrorDetailsModal}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)(logic);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(ErrorDetailsModal,{id:id}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_12__.g,{dataSource:appMetricsResponse?.errors||[],loading:appMetricsResponseLoading,columns:[{title:"Error type",dataIndex:"error_type",render:function RenderErrorType(_,errorSummary){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_Link__WEBPACK_IMPORTED_MODULE_13__.r,{title:"View details",className:"font-semibold",onClick:event=>{event.preventDefault(),openErrorDetailsModal(errorSummary.error_type)},children:errorSummary.error_type})},sorter:(a,b)=>a.error_type.localeCompare(b.error_type)},{title:"Count",dataIndex:"count",align:"right",sorter:(a,b)=>a.count-b.count},{title:"Last seen",dataIndex:"last_seen",render:function RenderCreatedAt(lastSeen){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div",{className:"whitespace-nowrap text-right",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_components_TZLabel__WEBPACK_IMPORTED_MODULE_6__.w,{time:lastSeen})})},align:"right",sorter:(a,b)=>new Date(a.last_seen||0)>new Date(b.last_seen||0)?1:-1}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{className:"",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("b",{children:"No errors! \uD83E\uDD73"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})]})}function ErrorDetailsModal(_ref5){let{id}=_ref5,logic=(0,_pipelineNodeMetricsLogic__WEBPACK_IMPORTED_MODULE_17__.j)({id}),{errorDetails,errorDetailsModalError,errorDetailsLoading}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(logic),{closeErrorDetailsModal}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)(logic),[page,setPage]=(0,react__WEBPACK_IMPORTED_MODULE_16__.useState)(0),activeErrorDetails=errorDetails[page];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_10__.f,{isOpen:!!errorDetailsModalError,onClose:closeErrorDetailsModal,title:errorDetailsModalError,width:"min(50vw, 80rem)",description:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("span",{children:activeErrorDetails?.error_details?.error.message?.substring(0,200)}),footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:errorDetailsLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_11__.y,{className:"h-10"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("span",{children:[page+1," of ",errorDetails.length," sample",errorDetails.length>1?"s":""]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_8__.J,{icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_7__.ed,{}),onClick:()=>setPage(page-1),disabledReason:0==page?"First page":void 0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_8__.J,{icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_7__.VG,{}),onClick:()=>setPage(page+1),disabledReason:page==errorDetails.length-1?"Last page":void 0})]})}),children:!errorDetailsModalError||errorDetailsLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_11__.y,{className:"h-10"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{className:"flex flex-col deprecated-space-y-2 h-[80vh]",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("span",{className:"font-semibold",children:"When:"})," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_components_TZLabel__WEBPACK_IMPORTED_MODULE_6__.w,{time:activeErrorDetails.timestamp,showSeconds:!0})]}),activeErrorDetails.error_details.eventCount&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonLabel_LemonLabel__WEBPACK_IMPORTED_MODULE_9__.H,{children:"Event Count"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div",{children:activeErrorDetails.error_details.eventCount})]}),activeErrorDetails.error_details.error.message&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(CollapsibleSection,{title:"Error message",defaultIsExpanded:!0,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_components_CodeSnippet__WEBPACK_IMPORTED_MODULE_4__.O,{wrap:!0,language:lib_components_CodeSnippet__WEBPACK_IMPORTED_MODULE_4__.S.JavaScript,children:activeErrorDetails.error_details.error.message})}),activeErrorDetails.error_details.event&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(CollapsibleSection,{title:"Event payload",defaultIsExpanded:!1,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_components_CodeSnippet__WEBPACK_IMPORTED_MODULE_4__.O,{wrap:!0,language:lib_components_CodeSnippet__WEBPACK_IMPORTED_MODULE_4__.S.JSON,children:JSON.stringify(activeErrorDetails.error_details.event,null,2)})}),activeErrorDetails.error_details.error.stack&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(CollapsibleSection,{title:"Stack trace",defaultIsExpanded:!1,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_components_CodeSnippet__WEBPACK_IMPORTED_MODULE_4__.O,{wrap:!0,language:lib_components_CodeSnippet__WEBPACK_IMPORTED_MODULE_4__.S.JavaScript,children:activeErrorDetails.error_details.error.stack})})]})})}function CollapsibleSection(props){let[isExpanded,setIsExpanded]=(0,react__WEBPACK_IMPORTED_MODULE_16__.useState)(props.defaultIsExpanded);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{className:"bg-primary border rounded",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_8__.J,{fullWidth:!0,onClick:()=>setIsExpanded(!isExpanded),sideIcon:isExpanded?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconCollapse,{}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconExpand,{}),title:isExpanded?"Show less":"Show more",className:"bg-primary",children:props.title}),isExpanded&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("div",{className:"bg-surface-primary p-2",children:props.children})]})}},"../../frontend/src/scenes/pipeline/pipelineNodeLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{y:()=>pipelineNodeLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/utils.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_navigation_3000_sidepanel_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/types.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_pipelineNodeNewLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/pipeline/pipelineNodeNewLogic.tsx"),_types__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts");let pipelineNodeLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{id}=_ref;return id}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(id=>["scenes","pipeline","pipelineNodeLogic",id]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setCurrentTab:function(){let tab=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_types__WEBPACK_IMPORTED_MODULE_5__.il.Configuration;return{tab}},setBreadcrumbTitle:title=>({title}),setProjectTreeRef:projectTreeRef=>({projectTreeRef})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(()=>({currentTab:[_types__WEBPACK_IMPORTED_MODULE_5__.il.Configuration,{setCurrentTab:(_,_ref2)=>{let{tab}=_ref2;return tab}}],breadcrumbTitle:["",{setBreadcrumbTitle:(_,_ref3)=>{let{title}=_ref3;return title}}],projectTreeRef:[null,{setProjectTreeRef:(_,_ref4)=>{let{projectTreeRef}=_ref4;return projectTreeRef}}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(()=>({breadcrumbs:[(s,p)=>[p.id,p.stage,s.breadcrumbTitle],(id,stage,breadcrumbTitle)=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.Pipeline,name:"Data pipeline",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.pipeline()},{key:stage||"unknown",name:stage?(0,lib_utils__WEBPACK_IMPORTED_MODULE_2__.fm)(_pipelineNodeNewLogic__WEBPACK_IMPORTED_MODULE_6__.U[stage]||""):"Unknown",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.pipeline(stage?_pipelineNodeNewLogic__WEBPACK_IMPORTED_MODULE_6__.U[stage]:void 0)},{key:[scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.PipelineNode,id],name:breadcrumbTitle}]],[_layout_navigation_3000_sidepanel_types__WEBPACK_IMPORTED_MODULE_8__.f]:[s=>[s.node],node=>node.backend===_types__WEBPACK_IMPORTED_MODULE_7__.b.Plugin?{activity_scope:_types__WEBPACK_IMPORTED_MODULE_5__.jc.PLUGIN,activity_item_id:`${node.id}`}:null],nodeBackend:[s=>[s.node],node=>node.backend],node:[(_,p)=>[p.id],id=>"string"==typeof id?0===id.indexOf("hog-")?{backend:_types__WEBPACK_IMPORTED_MODULE_7__.b.HogFunction,id:`${id}`.replace("hog-","")}:{backend:_types__WEBPACK_IMPORTED_MODULE_7__.b.BatchExport,id}:{backend:_types__WEBPACK_IMPORTED_MODULE_7__.b.Plugin,id}],tabs:[s=>[s.nodeBackend],nodeBackend=>{let tabs=Object.values(_types__WEBPACK_IMPORTED_MODULE_5__.il);return nodeBackend===_types__WEBPACK_IMPORTED_MODULE_7__.b.BatchExport?tabs.filter(t=>t!==_types__WEBPACK_IMPORTED_MODULE_5__.il.History):tabs}],id:[(_,p)=>[p.id],id=>id],stage:[(_,p)=>[p.stage],stage=>stage]})),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.actionToUrl)(_ref5=>{let{values,props}=_ref5;return{setCurrentTab:()=>[scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.pipelineNode(props.stage,props.id,values.currentTab)]}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.urlToAction)(_ref6=>{let{props,actions,values}=_ref6;return{[scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.pipelineNode(props.stage,props.id,":nodeTab")]:_ref7=>{let{nodeTab}=_ref7;if(nodeTab!==values.currentTab&&Object.values(_types__WEBPACK_IMPORTED_MODULE_5__.il).includes(nodeTab)&&actions.setCurrentTab(nodeTab),"string"==typeof props.id&&(props.id.startsWith("managed-")||props.id.startsWith("self-managed-"))){kea_router__WEBPACK_IMPORTED_MODULE_1__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.dataWarehouseSource(props.id.toString()));return}let match=kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.location.pathname.match(/\/pipeline\/([^/]+)\/hog-([^/]+)\/?/);if(match){let{projectTreeRef}=values,type="hog_function/",ref=match[2];projectTreeRef&&projectTreeRef.type===type&&projectTreeRef.ref===ref||actions.setProjectTreeRef({type,ref})}}}})])},"../../frontend/src/scenes/pipeline/pipelineNodeMetricsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>pipelineNodeMetricsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/utils.tsx"),scenes_projectLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/projectLogic.ts");let pipelineNodeMetricsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{id}=_ref;return id}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(id=>["scenes","pipeline","appMetricsLogic",id]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_projectLogic__WEBPACK_IMPORTED_MODULE_4__.K,["currentProjectId"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setDateRange:(from,to)=>({from,to}),openErrorDetailsModal:errorType=>({errorType}),closeErrorDetailsModal:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values,props}=_ref2;return{appMetricsResponse:[null,{loadMetrics:async()=>{let params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({date_from:values.dateRange.from,date_to:values.dateRange.to});return await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${values.currentProjectId}/app_metrics/${props.id}?${params}`)}}],errorDetails:[[],{openErrorDetailsModal:async _ref3=>{let{errorType}=_ref3,params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({error_type:errorType}),{result}=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${values.currentProjectId}/app_metrics/${props.id}/error_details?${params}`);return result}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({dateRange:[{from:"-7d",to:null},{setDateRange:(_,_ref4)=>{let{from,to}=_ref4;return{from:null!=from?from:"-7d",to:to}}}],errorDetailsModalError:[null,{openErrorDetailsModal:(_,_ref5)=>{let{errorType}=_ref5;return errorType},closeErrorDetailsModal:()=>null}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref6=>{let{actions}=_ref6;return{setDateRange:()=>{actions.loadMetrics()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref7=>{let{actions}=_ref7;actions.loadMetrics()})])},"../../frontend/src/scenes/pipeline/pipelineNodeNewLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Q:()=>pipelineNodeNewLogic,U:()=>NODE_STAGE_TO_PIPELINE_TAB});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/utils.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/urls.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");let NODE_STAGE_TO_PIPELINE_TAB={[_types__WEBPACK_IMPORTED_MODULE_6__.We.Transformation]:_types__WEBPACK_IMPORTED_MODULE_6__.J9.Transformations,[_types__WEBPACK_IMPORTED_MODULE_6__.We.Destination]:_types__WEBPACK_IMPORTED_MODULE_6__.J9.Destinations,[_types__WEBPACK_IMPORTED_MODULE_6__.We.SiteApp]:_types__WEBPACK_IMPORTED_MODULE_6__.J9.SiteApps,[_types__WEBPACK_IMPORTED_MODULE_6__.We.Source]:_types__WEBPACK_IMPORTED_MODULE_6__.J9.Sources},pipelineNodeNewLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_userLogic__WEBPACK_IMPORTED_MODULE_5__.userLogic,["user"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(id=>["scenes","pipeline","pipelineNodeNewLogic",id]),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_destinations")}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading],pluginsLoading=>pluginsLoading],breadcrumbs:[(_,p)=>[p.stage,p.pluginId,p.kind,p.batchExportDestination],(stage,pluginId,kind,batchDestination)=>{let parsedStage=stage?stage.replace("-"," "):null;return[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.Pipeline,name:"Data pipeline",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.pipeline()},{key:stage||"unknown",name:stage?(0,lib_utils__WEBPACK_IMPORTED_MODULE_2__.fm)(NODE_STAGE_TO_PIPELINE_TAB[stage]||""):"Unknown",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.pipeline(stage?NODE_STAGE_TO_PIPELINE_TAB[stage]:void 0)},{key:pluginId||batchDestination||"Unknown",name:kind?`New ${(0,lib_utils__WEBPACK_IMPORTED_MODULE_2__.fm)(kind)} source`:pluginId?"New":batchDestination?`New ${batchDestination} destination`:`New ${parsedStage}`.trim()}]}],projectTreeRef:[s=>[s.loading],()=>({type:"hog_function/",ref:null})]})])}}]);