"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[86451],{"../../frontend/src/scenes/experiments/ExperimentMetricForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>ExperimentMetricForm});var react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),useFeatureFlag=__webpack_require__("../../frontend/src/lib/hooks/useFeatureFlag.ts"),LemonLabel=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/index.ts"),LemonRadio=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonRadio/index.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),ActionFilter=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),queries_query=__webpack_require__("../../frontend/src/queries/query.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),types=__webpack_require__("../../frontend/src/types.ts"),LemonInput=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),LemonSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSelect/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),FunnelConversionWindowFilter=__webpack_require__("../../frontend/src/scenes/insights/views/Funnels/FunnelConversionWindowFilter.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function ExperimentMetricConversionWindowFilter(_ref){var _metric$conversion_wi2;let{metric,handleSetMetric}=_ref,options=Object.keys(FunnelConversionWindowFilter.V).map(unit=>{var _metric$conversion_wi;return{label:(0,utils.fm)((0,utils.Zi)(null!==(_metric$conversion_wi=metric.conversion_window)&&void 0!==_metric$conversion_wi?_metric$conversion_wi:72,unit,`${unit}s`,!1)),value:unit}}),intervalBounds=FunnelConversionWindowFilter.V[null!==(_metric$conversion_wi2=metric.conversion_window_unit)&&void 0!==_metric$conversion_wi2?_metric$conversion_wi2:types.ih.Day];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{className:"mb-1",info:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Controls how long a metric value is considered relevant to an experiment exposure:",(0,jsx_runtime.jsxs)("ul",{className:"list-disc pl-4",children:[(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"Experiment duration"})," considers any data from when a user is first exposed until the experiment ends."]}),(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"Time window"})," only includes data that occurs within the specified time window after a user's first exposure (also ignoring the experiment end date)."]})]})]}),children:"Conversion window limit"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonRadio._,{className:"my-1.5",value:void 0===metric.conversion_window_unit?"experiment_duration":"time_window",orientation:"horizontal",onChange:value=>handleSetMetric({...metric,conversion_window:"experiment_duration"===value?void 0:14,conversion_window_unit:"experiment_duration"===value?void 0:types.ih.Day}),options:[{value:"experiment_duration",label:"Experiment duration"},{value:"time_window",label:"Time window"}]}),void 0!==metric.conversion_window_unit&&(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonInput.D,{type:"number",className:"max-w-20",fullWidth:!1,min:intervalBounds[0],max:intervalBounds[1],value:metric.conversion_window||1,onChange:value=>{handleSetMetric({...metric,conversion_window:value||void 0})}}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{dropdownMatchSelectWidth:!1,value:metric.conversion_window_unit,onChange:value=>handleSetMetric({...metric,conversion_window_unit:value||void 0}),options:options})]})})]})]})}let funnelOrderOptions=[{label:"Sequential",value:types.kO.ORDERED},{label:"Any order",value:types.kO.UNORDERED}];function StepOrderInfo(){return(0,jsx_runtime.jsxs)("ul",{className:"list-disc pl-4",children:[(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("b",{children:"Sequential"})," - Step B must happen after Step A, but any number of events can happen between A and B."]}),(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("b",{children:"Any order"})," - Steps can be completed in any sequence."]})]})}function ExperimentMetricFunnelOrderSelector(_ref){let{metric,handleSetMetric}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{info:(0,jsx_runtime.jsx)(StepOrderInfo,{}),children:"Step order"}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{"data-attr":"experiment-funnel-order-selector",value:metric.funnel_order_type||types.kO.ORDERED,onChange:funnelOrderType=>{handleSetMetric({...metric,funnel_order_type:funnelOrderType})},dropdownMatchSelectWidth:!1,options:funnelOrderOptions})]})}var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts");function ExperimentMetricOutlierHandling(_ref){let{metric,handleSetMetric}=_ref;return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{className:"mb-1",info:"Prevent outliers from skewing results by capping the lower and upper bounds of a metric.",children:"Outlier handling"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted-alt",children:"Set winsorization lower and upper bounds to cap metric values at the specified percentiles."}),(0,jsx_runtime.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Hw,{label:"Lower bound percentile",checked:void 0!==metric.lower_bound_percentile,onChange:checked=>handleSetMetric({...metric,lower_bound_percentile:checked?.05:void 0})}),(0,jsx_runtime.jsx)(LemonInput.D,{value:void 0!==metric.lower_bound_percentile?100*metric.lower_bound_percentile:0,onChange:value=>void 0!==metric.lower_bound_percentile&&handleSetMetric({...metric,lower_bound_percentile:(null!=value?value:0)/100}),type:"number",step:1,suffix:(0,jsx_runtime.jsx)("span",{className:"text-sm",children:"%"}),size:"small",className:`w-20 transition-opacity ${void 0===metric.lower_bound_percentile?"opacity-0 invisible":"opacity-100 visible"}`})]}),(0,jsx_runtime.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Hw,{label:"Upper bound percentile",checked:void 0!==metric.upper_bound_percentile,onChange:checked=>handleSetMetric({...metric,upper_bound_percentile:checked?.95:void 0})}),(0,jsx_runtime.jsx)(LemonInput.D,{value:void 0!==metric.upper_bound_percentile?100*metric.upper_bound_percentile:0,onChange:value=>void 0!==metric.upper_bound_percentile&&handleSetMetric({...metric,upper_bound_percentile:(null!=value?value:0)/100}),type:"number",step:1,suffix:(0,jsx_runtime.jsx)("span",{className:"text-sm",children:"%"}),size:"small",className:`w-20 transition-opacity ${void 0===metric.upper_bound_percentile?"opacity-0 invisible":"opacity-100 visible"}`})]})]})}var Selectors=__webpack_require__("../../frontend/src/scenes/experiments/Metrics/Selectors.tsx"),metricQueryUtils=__webpack_require__("../../frontend/src/scenes/experiments/metricQueryUtils.ts"),experiments_utils=__webpack_require__("../../frontend/src/scenes/experiments/utils.ts");let loadEventCount=async(metric,filterTestAccounts,setEventCount,setIsLoading)=>{setIsLoading(!0);try{let query=(0,experiments_utils.lr)(metric,filterTestAccounts);if(!query){setEventCount(0);return}let response=await (0,queries_query.jr)(query),count=0;if(response.results.length>0){let firstResult=response.results[0];firstResult&&"number"==typeof firstResult.aggregated_value&&(count=firstResult.aggregated_value)}setEventCount(count)}catch(error){LemonToast.U.error(JSON.stringify(error)),setEventCount(0)}finally{setIsLoading(!1)}},dataWarehousePopoverFields=[{key:"timestamp_field",label:"Timestamp Field"},{key:"data_warehouse_join_key",label:"Data Warehouse Join Key",allowHogQL:!0},{key:"events_join_key",label:"Events Join Key",allowHogQL:!0,hogQLOnly:!0,tableName:"events"}];function ExperimentMetricForm(_ref){let{metric,handleSetMetric,filterTestAccounts}=_ref,mathAvailability=(0,experiments_utils.Vb)(metric.metric_type),allowedMathTypes=(0,experiments_utils.dR)(metric.metric_type),[eventCount,setEventCount]=(0,react.useState)(null),[isLoading,setIsLoading]=(0,react.useState)(!1),isRatioMetricEnabled=(0,useFeatureFlag.y)("EXPERIMENTS_RATIO_METRIC")||(0,schema_general.FQ)(metric),handleSetFilters=_ref2=>{let{actions,events,data_warehouse}=_ref2,metricConfig=(0,metricQueryUtils.jG)(metric.metric_type,actions,events,data_warehouse);metricConfig&&handleSetMetric({...metric,...metricConfig})},radioOptions=[{value:schema_general.Tu.FUNNEL,label:"Funnel",description:"Calculates the percentage of users exposed to the experiment who completed the funnel. Useful for measuring conversion rates."},{value:schema_general.Tu.MEAN,label:"Mean",description:"Calculates the value per user exposed to the experiment. Useful for measuring count of clicks, revenue or other numeric values."},...isRatioMetricEnabled?[{value:schema_general.Tu.RATIO,label:"Ratio",description:"Calculates the ratio between two metrics. Useful when you want to use a different denominator than users exposed to the experiment."}]:[]],metricFilter=(0,metricQueryUtils.zK)(metric),meanSource=(0,schema_general.Gt)(metric)?metric.source:null,funnelSeries=(0,schema_general.N4)(metric)?metric.series:null,ratioNumerator=(0,schema_general.FQ)(metric)?metric.numerator:null,ratioDenominator=(0,schema_general.FQ)(metric)?metric.denominator:null;return(0,react.useEffect)(()=>{loadEventCount(metric,filterTestAccounts,setEventCount,setIsLoading)},[metric.metric_type,meanSource,funnelSeries,ratioNumerator,ratioDenominator,filterTestAccounts]),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{className:"mb-1",children:"Type"}),(0,jsx_runtime.jsx)(LemonRadio._,{"data-attr":"metrics-selector",value:metric.metric_type,onChange:newMetricType=>{handleSetMetric({...(0,experiments_utils.FN)(newMetricType),uuid:metric.uuid,name:metric.name})},options:radioOptions})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{className:"mb-1",children:"Metric"}),(0,schema_general.Gt)(metric)&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:metricFilter,setFilters:handleSetFilters,typeKey:"experiment-metric",buttonCopy:"Add graph series",showSeriesIndicator:!1,hideRename:!0,entitiesLimit:1,showNumericalPropsOnly:!0,mathAvailability:mathAvailability,allowedMathTypes:allowedMathTypes,dataWarehousePopoverFields:dataWarehousePopoverFields,...Selectors.dF}),metric.source.math===types.xu.HogQL&&(0,jsx_runtime.jsxs)("div",{className:"text-muted text-sm mt-2",children:["SQL expressions allow you to write custom computations and aggregations. The expression should return a numeric value and will be evaluated for each user in the experiment."," ",(0,jsx_runtime.jsx)(Link.r,{to:"https://posthog.com/docs/hogql/expressions",target:"_blank",disableDocsPanel:!0,children:"Learn more about HogQL expressions"})]})]}),(0,schema_general.N4)(metric)&&(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:metricFilter,setFilters:handleSetFilters,typeKey:"experiment-metric",buttonCopy:"Add step",showSeriesIndicator:!1,hideRename:!0,hideDeleteBtn:(_,index)=>0===index,sortable:!0,showNestedArrow:!0,mathAvailability:mathAvailability,allowedMathTypes:allowedMathTypes,actionsTaxonomicGroupTypes:Selectors.dF.actionsTaxonomicGroupTypes?.filter(type=>"data_warehouse"!==type),propertiesTaxonomicGroupTypes:Selectors.dF.propertiesTaxonomicGroupTypes}),(0,schema_general.FQ)(metric)&&(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{className:"mb-1",children:"Numerator (what you're measuring)"}),(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,metricQueryUtils.Aq)(metric.numerator),setFilters:filters=>{let source=(0,metricQueryUtils.tc)(filters.actions,filters.events,filters.data_warehouse);source&&handleSetMetric({...metric,numerator:source})},typeKey:"experiment-metric-numerator",buttonCopy:"Add numerator event",showSeriesIndicator:!1,hideRename:!0,entitiesLimit:1,showNumericalPropsOnly:!0,mathAvailability:mathAvailability,allowedMathTypes:allowedMathTypes,dataWarehousePopoverFields:dataWarehousePopoverFields,...Selectors.dF})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{className:"mb-1",children:"Denominator (what you're dividing by)"}),(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,metricQueryUtils.Aq)(metric.denominator),setFilters:filters=>{let source=(0,metricQueryUtils.tc)(filters.actions,filters.events,filters.data_warehouse);source&&handleSetMetric({...metric,denominator:source})},typeKey:"experiment-metric-denominator",buttonCopy:"Add denominator event",showSeriesIndicator:!1,hideRename:!0,entitiesLimit:1,mathAvailability:mathAvailability,allowedMathTypes:allowedMathTypes,dataWarehousePopoverFields:dataWarehousePopoverFields,...Selectors.dF})]})]})]}),(0,jsx_runtime.jsx)(ExperimentMetricConversionWindowFilter,{metric:metric,handleSetMetric:handleSetMetric}),(0,schema_general.N4)(metric)&&(0,jsx_runtime.jsx)(ExperimentMetricFunnelOrderSelector,{metric:metric,handleSetMetric:handleSetMetric}),(0,schema_general.Gt)(metric)&&(0,jsx_runtime.jsx)(ExperimentMetricOutlierHandling,{metric:metric,handleSetMetric:handleSetMetric}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{className:"mb-1",info:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)("div",{children:"This shows recent activity for your selected metric over the past 2 weeks."}),(0,jsx_runtime.jsx)("div",{children:"It's a quick health check to ensure your tracking is working properly, so that you'll receive accurate results when your experiment starts."}),(0,jsx_runtime.jsxs)("div",{children:["If you see zero activity, double-check that this metric is being tracked properly in your application. Head to"," ",(0,jsx_runtime.jsxs)(Link.r,{target:"_blank",className:"font-semibold",to:urls.j.insightNew(),children:["Product analytics",(0,jsx_runtime.jsx)(icons.pF,{fontSize:"18"})]})," ","to do a detailed analysis of the events received so far."]})]}),children:"Recent activity"}),(0,jsx_runtime.jsx)("div",{className:"border rounded p-4 bg-bg-light",children:isLoading?(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(Spinner.$,{}),(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"Loading recent activity..."})]}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)("div",{className:"text-2xl font-semibold",children:null!==eventCount?eventCount.toLocaleString():"0"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:null!==eventCount&&eventCount>0?`${(()=>{if((0,schema_general.Gt)(metric))return metric.source.kind===schema_general.OH.ActionsNode?"actions":"events";if((0,schema_general.N4)(metric)){let lastStep=metric.series[metric.series.length-1];return lastStep?.kind===schema_general.OH.ActionsNode?"actions":"events"}return(0,schema_general.FQ)(metric),"events"})()} in the past 2 weeks`:"No recent activity"})]})})]})]})}},"../../frontend/src/scenes/experiments/Metrics/Selectors.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{IF:()=>FunnelConversionWindowFilter,dF:()=>commonActionFilterProps,f$:()=>FunnelAttributionSelect,xE:()=>FunnelAggregationSelect});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),_posthog_icons__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.28.1_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_components_HogQLEditor_HogQLEditor__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/components/HogQLEditor/HogQLEditor.tsx"),lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/introductions/groupsAccessLogic.ts"),lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/lib/utils.tsx"),scenes_groups_GroupsIntroduction__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/scenes/groups/GroupsIntroduction.tsx"),scenes_insights_EditorFilters_FunnelsQuerySteps__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/scenes/insights/EditorFilters/FunnelsQuerySteps.tsx"),scenes_insights_views_Funnels_FunnelConversionWindowFilter__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/scenes/insights/views/Funnels/FunnelConversionWindowFilter.tsx"),_models_groupsModel__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/models/groupsModel.ts"),_types__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../frontend/src/types.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let commonActionFilterProps={actionsTaxonomicGroupTypes:[lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.Events,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.Actions,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.DataWarehouse],propertiesTaxonomicGroupTypes:[lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.EventProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.PersonProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.EventFeatureFlags,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.Cohorts,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.Elements,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.SessionProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.HogQLExpression,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.DataWarehouseProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.DataWarehousePersonProperties]};function FunnelAggregationSelect(_ref){let{value,onChange}=_ref,{groupTypes,aggregationLabel}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_models_groupsModel__WEBPACK_IMPORTED_MODULE_11__.$),{needsUpgradeForGroups,canStartUsingGroups}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_5__.e),UNIQUE_USERS="person_id",baseValues=[UNIQUE_USERS],optionSections=[{title:"Event Aggregation",options:[{value:UNIQUE_USERS,label:"Unique users"}]}];return needsUpgradeForGroups||canStartUsingGroups?optionSections[0].footer=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(scenes_groups_GroupsIntroduction__WEBPACK_IMPORTED_MODULE_8__.b,{needsUpgrade:needsUpgradeForGroups}):Array.from(groupTypes.values()).forEach(groupType=>{baseValues.push(`$group_${groupType.group_type_index}`),optionSections[0].options.push({value:`$group_${groupType.group_type_index}`,label:`Unique ${aggregationLabel(groupType.group_type_index).plural}`})}),baseValues.push("properties.$session_id"),optionSections[0].options.push({value:"properties.$session_id",label:"Unique sessions"}),optionSections[0].options.push({label:"Custom SQL expression",options:[{value:!value||baseValues.includes(value)?"":value,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{className:"font-mono",children:value}),labelInMenu:function CustomHogQLOptionWrapped(_ref2){let{onSelect}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"w-120",style:{maxWidth:"max(60vw, 20rem)"},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_components_HogQLEditor_HogQLEditor__WEBPACK_IMPORTED_MODULE_3__.E,{onChange:onSelect,value:value,placeholder:"Enter SQL expression, such as:\n- distinct_id\n- properties.$session_id\n- concat(distinct_id, ' ', properties.$session_id)\n- if(1 < 2, 'one', 'two')"})})}}]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex items-center w-full gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{children:"Aggregating by"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.Yv,{className:"flex-1",value:value,onChange:onChange,options:optionSections,dropdownMatchSelectWidth:!1})]})}function FunnelConversionWindowFilter(_ref3){let{funnelWindowInterval,funnelWindowIntervalUnit,onFunnelWindowIntervalChange,onFunnelWindowIntervalUnitChange}=_ref3,options=Object.keys(scenes_insights_views_Funnels_FunnelConversionWindowFilter__WEBPACK_IMPORTED_MODULE_10__.V).map(unit=>({label:(0,lib_utils__WEBPACK_IMPORTED_MODULE_7__.fm)((0,lib_utils__WEBPACK_IMPORTED_MODULE_7__.Zi)(null!=funnelWindowInterval?funnelWindowInterval:7,unit,`${unit}s`,!1)),value:unit})),intervalBounds=scenes_insights_views_Funnels_FunnelConversionWindowFilter__WEBPACK_IMPORTED_MODULE_10__.V[null!=funnelWindowIntervalUnit?funnelWindowIntervalUnit:_types__WEBPACK_IMPORTED_MODULE_12__.ih.Day];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex items-center gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("span",{className:"flex whitespace-nowrap",children:["Conversion window limit",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_6__.u,{title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("b",{children:"Recommended!"})," Limit to participants that converted within a specific time frame. Participants that do not convert in this time frame will be considered as drop-offs."]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_1__.IconInfo,{className:"w-4 info-indicator"})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex items-center gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.DF,{type:"number",className:"max-w-20",fullWidth:!1,min:intervalBounds[0],max:intervalBounds[1],value:funnelWindowInterval,onChange:onFunnelWindowIntervalChange}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.Yv,{dropdownMatchSelectWidth:!1,value:funnelWindowIntervalUnit,onChange:onFunnelWindowIntervalUnitChange,options:options})]})]})}function FunnelAttributionSelect(_ref4){let{value,onChange,stepsLength}=_ref4,funnelOrderType=void 0;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex items-center w-full gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{children:"Attribution type"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_6__.u,{closeDelayMs:200,title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{children:"When breaking down funnels, it's possible that the same properties don't exist on every event. For example, if you want to break down by browser on a funnel that contains both frontend and backend events."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{children:"In this case, you can choose from which step the properties should be selected from by modifying the attribution type. There are four modes to choose from:"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("ul",{className:"list-disc pl-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("li",{children:"First touchpoint: the first property value seen in any of the steps is chosen."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("li",{children:"Last touchpoint: the last property value seen from all steps is chosen."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("li",{children:"All steps: the property value must be seen in all steps to be considered in the funnel."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("li",{children:"Specific step: only the property value seen at the selected step is chosen."})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{children:["Read more in the"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.rU,{to:"https://posthog.com/docs/product-analytics/funnels#attribution-types",children:"documentation."})]})]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_1__.IconInfo,{className:"text-xl text-secondary shrink-0 ml-1"})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.Yv,{value:value,placeholder:"Attribution",options:[{value:_types__WEBPACK_IMPORTED_MODULE_12__.q9.FirstTouch,label:"First touchpoint"},{value:_types__WEBPACK_IMPORTED_MODULE_12__.q9.LastTouch,label:"Last touchpoint"},{value:_types__WEBPACK_IMPORTED_MODULE_12__.q9.AllSteps,label:"All steps"},{value:_types__WEBPACK_IMPORTED_MODULE_12__.q9.Step,label:"Any step",hidden:funnelOrderType!==_types__WEBPACK_IMPORTED_MODULE_12__.kO.UNORDERED},{label:"Specific step",options:Array(scenes_insights_EditorFilters_FunnelsQuerySteps__WEBPACK_IMPORTED_MODULE_9__.i).fill(null).map((_,stepIndex)=>({value:`${_types__WEBPACK_IMPORTED_MODULE_12__.q9.Step}/${stepIndex}`,label:`Step ${stepIndex+1}`,hidden:stepIndex>=stepsLength})),hidden:funnelOrderType===_types__WEBPACK_IMPORTED_MODULE_12__.kO.UNORDERED}],onChange:onChange,dropdownMaxContentWidth:!0,"data-attr":"breakdown-attributions"})]})}}}]);