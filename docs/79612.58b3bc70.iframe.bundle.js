"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[79612],{"../../frontend/src/lib/components/Scenes/SceneLoadingSkeleton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>SceneLoadingSkeleton});var lib_ui_Button_ButtonPrimitives__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/lib/ui/Button/ButtonPrimitives.tsx"),lib_ui_Label_Label__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/ui/Label/Label.tsx"),lib_ui_WrappingLoadingSkeleton_WrappingLoadingSkeleton__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/ui/WrappingLoadingSkeleton/WrappingLoadingSkeleton.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SceneLoadingSkeleton(_ref){let{fullWidth=!0}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"flex flex-col gap-px",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_ui_WrappingLoadingSkeleton_WrappingLoadingSkeleton__WEBPACK_IMPORTED_MODULE_2__.x,{fullWidth:!1,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_ui_Label_Label__WEBPACK_IMPORTED_MODULE_1__._,{intent:"menu","aria-hidden":!0,children:"Some label text"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_ui_WrappingLoadingSkeleton_WrappingLoadingSkeleton__WEBPACK_IMPORTED_MODULE_2__.x,{fullWidth:fullWidth,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_ui_Button_ButtonPrimitives__WEBPACK_IMPORTED_MODULE_0__.hL,{inert:!0,"aria-hidden":!0,children:"Loading..."})})]})}},"../../frontend/src/lib/components/Scenes/SceneTextInput.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>SceneTextInput});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib_ui_Button_ButtonPrimitives__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/ui/Button/ButtonPrimitives.tsx"),lib_ui_TextareaPrimitive_TextareaPrimitive__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/ui/TextareaPrimitive/TextareaPrimitive.tsx"),_layout_scenes_SceneLayout__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/layout/scenes/SceneLayout.tsx"),_SceneLoadingSkeleton__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/components/Scenes/SceneLoadingSkeleton.tsx"),_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/components/Scenes/utils.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SceneTextInput(_ref){let{defaultValue="",onSave,dataAttrKey,optional=!1,canEdit=!0,isLoading=!1,name}=_ref,[localValue,setLocalValue]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(defaultValue),[localIsEditing,setLocalIsEditing]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),[hasChanged,setHasChanged]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),[error,setError]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null),nameCapitalized=name.charAt(0).toUpperCase()+name.slice(1);return((0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{setHasChanged(localValue!==defaultValue),0!==localValue.length||optional?setError(null):setError(`${nameCapitalized} is required`)},[localValue,defaultValue,optional,nameCapitalized]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{isLoading||localIsEditing||setLocalValue(defaultValue)},[isLoading,defaultValue,localIsEditing]),isLoading)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_SceneLoadingSkeleton__WEBPACK_IMPORTED_MODULE_4__.T,{}):localIsEditing?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("form",{onSubmit:e=>{e.preventDefault(),onSave(localValue),setHasChanged(!1),setLocalIsEditing(!1)},name:`page-${name}-form`,className:"flex flex-col gap-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_layout_scenes_SceneLayout__WEBPACK_IMPORTED_MODULE_3__.ZV,{htmlFor:`page-${name}-input`,title:nameCapitalized,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_ui_TextareaPrimitive_TextareaPrimitive__WEBPACK_IMPORTED_MODULE_2__.L,{value:localValue,onChange:e=>{setLocalValue(e.target.value)},placeholder:`${nameCapitalized} ${optional?"(optional)":""}`,id:`page-${name}-input`,"data-attr":`${dataAttrKey}-${name}-input`,autoFocus:!0,error:!!error})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_utils__WEBPACK_IMPORTED_MODULE_5__.B,{name:name,onCancel:()=>{setLocalValue(defaultValue),setLocalIsEditing(!1)},hasChanged:hasChanged,error:error,dataAttrKey:dataAttrKey,isLoading:isLoading})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_layout_scenes_SceneLayout__WEBPACK_IMPORTED_MODULE_3__.ZV,{title:nameCapitalized,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_ui_Button_ButtonPrimitives__WEBPACK_IMPORTED_MODULE_1__.hL,{className:"hyphens-auto flex gap-1 items-center",lang:"en",onClick:()=>setLocalIsEditing(!0),tooltip:canEdit?`Edit ${name}`:`${nameCapitalized} is read-only`,autoHeight:!0,menuItem:!0,inert:!canEdit,variant:"panel",children:""!==localValue?localValue:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("span",{className:"text-tertiary font-normal",children:["No ",name," ",optional?"(optional)":""]})})})}},"../../frontend/src/lib/components/Scenes/SceneTextarea.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{a:()=>SceneTextarea});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib_lemon_ui_LemonMarkdown__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMarkdown/index.ts"),lib_ui_Button_ButtonPrimitives__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/ui/Button/ButtonPrimitives.tsx"),lib_ui_TextareaPrimitive_TextareaPrimitive__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/ui/TextareaPrimitive/TextareaPrimitive.tsx"),_layout_scenes_SceneLayout__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/layout/scenes/SceneLayout.tsx"),_SceneLoadingSkeleton__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/components/Scenes/SceneLoadingSkeleton.tsx"),_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/components/Scenes/utils.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SceneTextarea(_ref){let{defaultValue="",onSave,dataAttrKey,optional=!1,canEdit=!0,isLoading=!1,markdown=!1,name}=_ref,[localValue,setLocalValue]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(defaultValue),[localIsEditing,setLocalIsEditing]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),[hasChanged,setHasChanged]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),[error,setError]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null),nameCapitalized=name.charAt(0).toUpperCase()+name.slice(1);return((0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{setHasChanged(localValue!==defaultValue),0!==localValue.length||optional?setError(null):setError(`${nameCapitalized} is required`)},[localValue,defaultValue,optional,nameCapitalized]),(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{isLoading||localIsEditing||setLocalValue(defaultValue)},[isLoading,defaultValue,localIsEditing]),isLoading)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_SceneLoadingSkeleton__WEBPACK_IMPORTED_MODULE_5__.T,{}):localIsEditing?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("form",{onSubmit:e=>{e.preventDefault(),onSave(localValue),setHasChanged(!1),setLocalIsEditing(!1)},name:`page-${name}-form`,className:"flex flex-col gap-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_layout_scenes_SceneLayout__WEBPACK_IMPORTED_MODULE_4__.ZV,{htmlFor:`page-${name}-input`,title:nameCapitalized,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_ui_TextareaPrimitive_TextareaPrimitive__WEBPACK_IMPORTED_MODULE_3__.L,{value:localValue,onChange:e=>{setLocalValue(e.target.value)},placeholder:optional?`${nameCapitalized} (optional)`:nameCapitalized,id:`page-${name}-input`,"data-attr":`${dataAttrKey}-${name}-input`,autoFocus:!0,error:!!error,markdown:markdown})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_utils__WEBPACK_IMPORTED_MODULE_6__.B,{name:name,onCancel:()=>{setLocalValue(defaultValue),setLocalIsEditing(!1)},hasChanged:hasChanged,error:error,dataAttrKey:dataAttrKey,isLoading:isLoading})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_layout_scenes_SceneLayout__WEBPACK_IMPORTED_MODULE_4__.ZV,{title:nameCapitalized,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_ui_Button_ButtonPrimitives__WEBPACK_IMPORTED_MODULE_2__.hL,{className:"flex gap-1 items-center break-words line-clamp-5",onClick:()=>setLocalIsEditing(!0),tooltip:canEdit?`Edit ${name}`:`${nameCapitalized} is read-only`,autoHeight:!0,menuItem:!0,inert:!canEdit,variant:"panel",children:""!==defaultValue?markdown?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonMarkdown__WEBPACK_IMPORTED_MODULE_1__.j,{lowKeyHeadings:!0,children:defaultValue}):defaultValue:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("span",{className:"text-tertiary font-normal",children:["No ",name," ",optional?"(optional)":""]})})})}},"../../products/llm_analytics/frontend/components/JSONEditor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{q:()=>JSONEditor});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib_monaco_CodeEditor__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/monaco/CodeEditor.tsx"),_datasets_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../products/llm_analytics/frontend/datasets/utils.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let JSONEditor=react__WEBPACK_IMPORTED_MODULE_0__.memo(_ref=>{let{onChange,lineHeight=20,defaultNumberOfLines=3,maxNumberOfLines=24,value="",readOnly=!1,autoFocus=!1}=_ref,defaultHeight=lineHeight*(Math.max(defaultNumberOfLines,(value?.toString()||"").split(/\r\n|\r|\n/).length)+1),[height,setHeight]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(defaultHeight),updateHeight=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(val=>{val?setHeight(lineHeight*(Math.min(Math.max(val.split(/\r\n|\r|\n/).length,defaultNumberOfLines),maxNumberOfLines)+1)):setHeight(lineHeight*(defaultNumberOfLines+1))},[defaultNumberOfLines,lineHeight,maxNumberOfLines]);(0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)(()=>{(0,_datasets_utils__WEBPACK_IMPORTED_MODULE_3__.B7)(value)||height===defaultHeight||updateHeight(value)},[value,height,defaultHeight,updateHeight]);let onTextChange=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(val=>{updateHeight(val),onChange&&onChange(val)},[onChange,defaultNumberOfLines,lineHeight,maxNumberOfLines,updateHeight]),options=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(()=>({readOnly:readOnly,lineHeight:lineHeight,minimap:{enabled:!1},scrollbar:{alwaysConsumeMouseWheel:!1},padding:{bottom:0,top:10},overviewRulerLanes:0,hideCursorInOverviewRuler:!0,overviewRulerBorder:!1,glyphMargin:!0,folding:!1,lineNumbers:"off",lineDecorationsWidth:0,lineNumbersMinChars:0,renderLineHighlight:"none",cursorStyle:"line",scrollBeyondLastLine:!1,quickSuggestions:!1,contextmenu:!1}),[lineHeight,readOnly]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(lib_monaco_CodeEditor__WEBPACK_IMPORTED_MODULE_1__.p,{className:"rounded [&_.monaco-editor]:rounded [&_.monaco-diff-editor]:rounded [&_.overflow-guard]:rounded",language:"json",height:height,value:value,options:options,onChange:onTextChange,autoFocus:autoFocus})});JSONEditor.displayName="JSONEditor"},"../../products/llm_analytics/frontend/datasets/DatasetItemModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Q:()=>DatasetItemModal});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonModal=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonModal/LemonModal.tsx"),JSONEditor=__webpack_require__("../../products/llm_analytics/frontend/components/JSONEditor.tsx"),api=__webpack_require__("../../frontend/src/lib/api.ts"),utils=__webpack_require__("../../products/llm_analytics/frontend/datasets/utils.ts");let FORM_DEFAULT_VALUE={input:utils.Kc,output:utils.Kc,metadata:utils.Kc},datasetItemModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","llm-analytics","datasetItemModalLogic"]),(0,index_esm.props)({datasetId:"",partialDatasetItem:null,closeModal:()=>{}}),(0,index_esm.key)(_ref=>{let{datasetId,partialDatasetItem}=_ref;return`dataset-item-${datasetId}-${partialDatasetItem?.id||"new"}`}),(0,index_esm.actions)({setShouldCloseModal:shouldCloseModal=>({shouldCloseModal}),setRefetchDatasetItems:refetchDatasetItems=>({refetchDatasetItems})}),(0,index_esm.reducers)(()=>({shouldCloseModal:[!0,{setShouldCloseModal:(_,_ref2)=>{let{shouldCloseModal}=_ref2;return shouldCloseModal}}],refetchDatasetItems:[!1,{setRefetchDatasetItems:(_,_ref3)=>{let{refetchDatasetItems}=_ref3;return refetchDatasetItems}}]})),(0,lib.forms)(_ref4=>{let{props,actions,values}=_ref4;return{datasetItemForm:{defaults:FORM_DEFAULT_VALUE,errors:_ref5=>{let{input,output,metadata}=_ref5;return{input:(0,utils.Fh)(input)?void 0:"Input must contain a valid JSON object",output:(0,utils.Fh)(output)?void 0:"Output must contain a valid JSON object",metadata:(0,utils.Fh)(metadata)?void 0:"Metadata must contain a valid JSON object"}},submit:async formValues=>{try{if(props.partialDatasetItem?.id){let updatedItem=await api.ZP.datasetItems.update(props.partialDatasetItem.id,{...props.partialDatasetItem,input:(0,utils.B7)(formValues.input),output:(0,utils.B7)(formValues.output),metadata:(0,utils.B7)(formValues.metadata)});src.UJ.success("Dataset item updated successfully"),props.closeModal(!0),actions.setDatasetItemFormValues(getDatasetItemFormDefaults(updatedItem))}else await api.ZP.datasetItems.create({...props.partialDatasetItem,dataset:props.datasetId,input:(0,utils.B7)(formValues.input),output:(0,utils.B7)(formValues.output),metadata:(0,utils.B7)(formValues.metadata)}),src.UJ.success("Dataset item created successfully"),values.shouldCloseModal?props.closeModal(!0):(actions.setRefetchDatasetItems(!0),actions.setDatasetItemFormValues(FORM_DEFAULT_VALUE)),actions.setShouldCloseModal(!0)}catch(error){console.error(error),src.UJ.error("Failed to save a dataset item.")}}}}}),(0,index_esm.defaults)(_ref6=>{let{props}=_ref6;return{datasetItemForm:props.partialDatasetItem?getDatasetItemFormDefaults(props.partialDatasetItem):FORM_DEFAULT_VALUE}}),(0,index_esm.propsChanged)(_ref7=>{let{props,actions}=_ref7;!props.partialDatasetItem&&props.isModalOpen&&actions.resetDatasetItemForm(),props.isModalOpen&&actions.setRefetchDatasetItems(!1)})]);function getDatasetItemFormDefaults(partialDatasetItem){return{input:(0,utils.pP)(partialDatasetItem.input)||utils.Kc,output:(0,utils.pP)(partialDatasetItem.output)||utils.Kc,metadata:(0,utils.pP)(partialDatasetItem.metadata)||utils.Kc}}var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let DatasetItemModal=react.memo(function DatasetItemModal(_ref){let{isOpen,onClose,partialDatasetItem,datasetId,displayBulkCreationButton,title}=_ref,logicProps={datasetId,partialDatasetItem,closeModal:onClose,isModalOpen:isOpen},{isDatasetItemFormSubmitting,refetchDatasetItems}=(0,index_esm.useValues)(datasetItemModalLogic(logicProps)),{submitDatasetItemForm,setShouldCloseModal}=(0,index_esm.useActions)(datasetItemModalLogic(logicProps));return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isOpen,onClose:()=>onClose(refetchDatasetItems),maxWidth:"40rem",simple:!0,className:"w-full",children:(0,jsx_runtime.jsxs)(lib.Form,{logic:datasetItemModalLogic,props:logicProps,formKey:"datasetItemForm",enableFormOnSubmit:!0,className:"flex flex-col overflow-y-hidden",children:[(0,jsx_runtime.jsx)(LemonModal.R6,{children:(0,jsx_runtime.jsx)("h3",{children:null!=title?title:partialDatasetItem?.id?"Edit dataset item":"New dataset item"})}),(0,jsx_runtime.jsxs)(LemonModal.TL,{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"input",label:"Input",children:(0,jsx_runtime.jsx)(JSONEditor.q,{})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"output",label:"Output",children:(0,jsx_runtime.jsx)(JSONEditor.q,{})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"metadata",label:"Metadata",children:(0,jsx_runtime.jsx)(JSONEditor.q,{})})]}),(0,jsx_runtime.jsxs)(LemonModal.oC,{children:[displayBulkCreationButton&&!partialDatasetItem?.id&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",loading:isDatasetItemFormSubmitting,htmlType:"submit",onClick:e=>{e.preventDefault(),setShouldCloseModal(!1),submitDatasetItemForm()},children:"Save and add another"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",htmlType:"submit",loading:isDatasetItemFormSubmitting,children:"Save"})]})]})})})},"../../products/llm_analytics/frontend/datasets/LLMAnalyticsDatasetScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMAnalyticsDatasetScene:()=>LLMAnalyticsDatasetScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),HighlightedJSONViewer=__webpack_require__("../../frontend/src/lib/components/HighlightedJSONViewer.tsx"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonDialog=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonDialog/index.ts"),LemonSkeleton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),columnUtils=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),ButtonPrimitives=__webpack_require__("../../frontend/src/lib/ui/Button/ButtonPrimitives.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),SceneLayout=__webpack_require__("../../frontend/src/layout/scenes/SceneLayout.tsx"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),SceneTextInput=__webpack_require__("../../frontend/src/lib/components/Scenes/SceneTextInput.tsx"),SceneTextarea=__webpack_require__("../../frontend/src/lib/components/Scenes/SceneTextarea.tsx"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),utils=__webpack_require__("../../products/llm_analytics/frontend/utils.ts"),DatasetItemModal=__webpack_require__("../../products/llm_analytics/frontend/datasets/DatasetItemModal.tsx"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),JSONEditor=__webpack_require__("../../products/llm_analytics/frontend/components/JSONEditor.tsx"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),sceneLogic=__webpack_require__("../../frontend/src/scenes/sceneLogic.tsx"),llmAnalyticsDatasetsLogic=__webpack_require__("../../products/llm_analytics/frontend/datasets/llmAnalyticsDatasetsLogic.ts"),datasets_utils=__webpack_require__("../../products/llm_analytics/frontend/datasets/utils.ts");let DatasetTab=function(DatasetTab){return DatasetTab.Items="items",DatasetTab.Metadata="metadata",DatasetTab}({});function isDataset(dataset){return null!==dataset&&"id"in dataset}function cleanFilters(values){return{page:parseInt(String(values.page))||1,limit:parseInt(String(values.limit))||50}}let llmAnalyticsDatasetLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","llm-analytics","llmAnalyticsDatasetLogic"]),(0,index_esm.props)({datasetId:"new"}),(0,index_esm.key)(_ref=>{let{datasetId}=_ref;return`dataset-${datasetId}`}),(0,index_esm.actions)({setDataset:dataset=>({dataset}),editDataset:editing=>({editing}),deleteDataset:!0,setActiveTab:tab=>({tab}),onUnmount:!0,setFilters:function(filters){let debounce=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return{filters,debounce}},deleteDatasetItem:itemId=>({itemId}),triggerDatasetItemModal:open=>({open}),setSelectedDatasetItem:datasetItem=>({datasetItem}),closeModalAndRefetchDatasetItems:refetchDatasetItems=>({refetchDatasetItems}),setDeletingDataset:deleting=>({deleting})}),(0,index_esm.reducers)({dataset:[null,{loadDatasetSuccess:(_,_ref2)=>{let{dataset}=_ref2;return dataset},setDataset:(_,_ref3)=>{let{dataset}=_ref3;return dataset}}],isEditingDataset:[!1,{editDataset:(_,_ref4)=>{let{editing}=_ref4;return editing}}],activeTab:[DatasetTab.Items,{setActiveTab:(_,_ref5)=>{let{tab}=_ref5;return tab}}],rawFilters:[null,{setFilters:(state,_ref6)=>{let{filters}=_ref6;return cleanFilters({...state,...filters,..."page"in filters?{}:{page:1}})}}],isDatasetItemModalOpen:[!1,{triggerDatasetItemModal:(_,_ref7)=>{let{open}=_ref7;return open},closeModalAndRefetchDatasetItems:()=>!1}],selectedDatasetItem:[null,{setSelectedDatasetItem:(_,_ref8)=>{let{datasetItem}=_ref8;return datasetItem},triggerDatasetItemModal:(state,_ref9)=>{let{open}=_ref9;return open?state:null},closeModalAndRefetchDatasetItems:()=>null}],isDeletingDataset:[!1,{setDeletingDataset:(_,_ref10)=>{let{deleting}=_ref10;return deleting},deleteDataset:()=>!0}]}),(0,kea_loaders_lib.loaders)(_ref11=>{let{props,values}=_ref11;return{dataset:{__default:null,loadDataset:()=>api.ZP.datasets.get(props.datasetId)},datasetItems:[{results:[],count:0,offset:0},{loadDatasetItems:async function(){let debounce=arguments.length>0&&void 0!==arguments[0]&&arguments[0],breakpoint=arguments.length>1?arguments[1]:void 0;debounce&&values.datasetItems.results.length>0&&await breakpoint(300);let{filters}=values;return sceneLogic.k.findMounted()?.values.activeSceneId==="LLMAnalyticsDataset"&&"POP"!==kea_router_lib.router.values.lastMethod&&values.datasetItems.results.length>0&&values.rawFilters?.page!==filters.page&&window.scrollTo(0,0),await api.ZP.datasetItems.list({dataset:props.datasetId,offset:Math.max(0,(filters.page-1)*50),limit:50})}}]}}),(0,lib.forms)(_ref12=>{let{actions,props}=_ref12;return{datasetForm:{defaults:{name:"",description:"",metadata:""},errors:_ref13=>{let{name,metadata}=_ref13;return{name:name?.trim()?void 0:"Dataset name is required",metadata:(0,datasets_utils.Fh)(metadata)?void 0:"Dataset metadata must contain a valid JSON object or be empty"}},submit:async formValues=>{let isNew="new"===props.datasetId;try{let savedDataset;isNew?(savedDataset=await api.ZP.datasets.create({name:formValues.name,description:formValues.description,metadata:(0,datasets_utils.B7)(formValues.metadata)}),LemonToast.UJ.success("Dataset created successfully"),kea_router_lib.router.actions.replace(urls.j.llmAnalyticsDataset(savedDataset.id))):(savedDataset=await api.ZP.datasets.update(props.datasetId,{...formValues,metadata:(0,datasets_utils.B7)(formValues.metadata)}),LemonToast.UJ.success("Dataset updated successfully")),actions.setDataset(savedDataset),actions.editDataset(!1),actions.setDatasetFormValues(getDatasetFormDefaults(savedDataset))}catch(error){let message=error?.detail||"Failed to save dataset";throw LemonToast.UJ.error(message),error}}}}}),(0,index_esm.selectors)({isNewDataset:[()=>[(_,props)=>props],props=>"new"===props.datasetId],isDatasetMissing:[s=>[s.dataset,s.datasetLoading],(dataset,datasetLoading)=>!datasetLoading&&null===dataset],shouldDisplaySkeleton:[s=>[s.dataset,s.datasetLoading],(dataset,datasetLoading)=>!dataset&&datasetLoading],filters:[s=>[s.rawFilters],rawFilters=>cleanFilters(rawFilters||{})],datasetItemsCount:[s=>[s.datasetItems],datasetItems=>datasetItems.count],pagination:[s=>[s.filters,s.datasetItemsCount],(filters,count)=>({controlled:!0,pageSize:filters.limit,currentPage:filters.page,entryCount:count})],breadcrumbs:[s=>[s.dataset],dataset=>[{name:"LLM Analytics",path:urls.j.llmAnalyticsDashboard(),key:"LLMAnalytics"},{name:"Datasets",path:urls.j.llmAnalyticsDatasets(),key:"LLMAnalyticsDatasets"},{name:dataset&&"name"in dataset?dataset.name:"New Dataset",key:"LLMAnalyticsDataset"}]]}),(0,index_esm.listeners)(_ref14=>{let{actions,props,values,selectors,asyncActions}=_ref14;return{deleteDataset:async()=>{if("new"!==props.datasetId){try{await api.ZP.datasets.update(props.datasetId,{deleted:!0}),LemonToast.UJ.info(`${values.dataset?.name||"Dataset"} has been deleted.`,{button:{label:"Undo",dataAttr:"undo-delete-dataset",action:async()=>{await api.ZP.datasets.update(props.datasetId,{deleted:!1})}}}),kea_router_lib.router.actions.replace(urls.j.llmAnalyticsDatasets())}catch{LemonToast.UJ.error("Failed to delete dataset")}actions.setDeletingDataset(!1)}},onUnmount:()=>{if("new"===props.datasetId)actions.setDatasetFormValues(DEFAULT_DATASET_FORM_VALUES);else{let existingDataset=findExistingDataset(props.datasetId);existingDataset?actions.setDatasetFormValues(getDatasetFormDefaults(existingDataset)):actions.setDatasetFormValues(DEFAULT_DATASET_FORM_VALUES)}},deleteDatasetItem:async _ref15=>{let{itemId}=_ref15;if("new"!==props.datasetId)try{await api.ZP.datasetItems.update(itemId,{deleted:!0}),LemonToast.UJ.info(`Dataset item ${(0,utils.ol)(itemId)} has been deleted.`,{button:{label:"Undo",dataAttr:"undo-delete-dataset-item",action:async()=>{await api.ZP.datasetItems.update(itemId,{deleted:!1}),await asyncActions.loadDatasetItems(!1)}}}),await asyncActions.loadDatasetItems(!1)}catch{LemonToast.UJ.error("Failed to delete dataset item")}},loadDatasetSuccess:_ref16=>{let{dataset}=_ref16;values.isEditingDataset||actions.setDatasetFormValues(getDatasetFormDefaults(dataset))},loadDatasetItemsSuccess:_ref17=>{let{datasetItems}=_ref17;if(kea_router_lib.router.values.searchParams.item){let item=datasetItems.results.find(item=>item.id===kea_router_lib.router.values.searchParams.item);item&&values.selectedDatasetItem!==item&&(actions.setSelectedDatasetItem(item),actions.triggerDatasetItemModal(!0))}},setFilters:async(_ref18,_,__,previousState)=>{let{debounce}=_ref18,oldFilters=selectors.filters(previousState),{filters}=values;(0,lib_utils.h0)(oldFilters,filters)||await asyncActions.loadDatasetItems(debounce)},setActiveTab:_ref19=>{let{tab}=_ref19;tab===DatasetTab.Items&&"new"!==props.datasetId&&actions.loadDatasetItems(!0)},closeModalAndRefetchDatasetItems:_ref20=>{let{refetchDatasetItems}=_ref20;refetchDatasetItems&&actions.loadDatasetItems()}}}),(0,kea_router_lib.urlToAction)(_ref21=>{let{actions,values}=_ref21;return{[urls.j.llmAnalyticsDataset(":id")]:(_,searchParams)=>{searchParams.tab&&Object.values(DatasetTab).includes(searchParams.tab)&&searchParams.tab!==values.activeTab&&actions.setActiveTab(searchParams.tab);let newFilters=cleanFilters(searchParams);if(null!==values.rawFilters&&(0,lib_utils.h0)(values.filters,newFilters)||actions.setFilters(newFilters,!1),searchParams.item){let item=values.datasetItems.results.find(item=>item.id===searchParams.item);item&&(actions.setSelectedDatasetItem(item),actions.triggerDatasetItemModal(!0))}}}}),(0,kea_router_lib.actionToUrl)(_ref22=>{let{values}=_ref22;return{closeModalAndRefetchDatasetItems:()=>{let nextSearchParams={...kea_router_lib.router.values.searchParams,item:void 0};return[urls.j.llmAnalyticsDataset(isDataset(values.dataset)?values.dataset.id:"new"),nextSearchParams,{},{replace:!1}]}}}),(0,index_esm.defaults)(_ref23=>{let{props}=_ref23;if("new"===props.datasetId)return{dataset:DEFAULT_DATASET_FORM_VALUES,datasetForm:DEFAULT_DATASET_FORM_VALUES};let existingDataset=findExistingDataset(props.datasetId);return existingDataset?{dataset:existingDataset,datasetForm:getDatasetFormDefaults(existingDataset)}:{dataset:null,datasetForm:DEFAULT_DATASET_FORM_VALUES}}),(0,index_esm.afterMount)(_ref24=>{let{actions,values}=_ref24;values.isNewDataset||(actions.loadDataset(),actions.loadDatasetItems())})]),DEFAULT_DATASET_FORM_VALUES={name:"",description:"",metadata:"{\n  \n}"};function getDatasetFormDefaults(dataset){return{name:dataset.name,description:dataset.description||"",metadata:(0,datasets_utils.pP)(dataset.metadata)||datasets_utils.Kc}}function findExistingDataset(datasetId){return llmAnalyticsDatasetsLogic.x.findMounted()?.values.datasets.results.find(dataset=>dataset.id===datasetId)}var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function EditDatasetForm(){var _datasetForm$metadata;let{datasetForm}=(0,index_esm.useValues)(llmAnalyticsDatasetLogic),{setDatasetFormValue}=(0,index_esm.useActions)(llmAnalyticsDatasetLogic);return(0,jsx_runtime.jsx)("div",{className:"max-w-160",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4 flex-2",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",htmlFor:"dataset-name",children:(0,jsx_runtime.jsx)(src.DF,{"data-attr":"dataset-name",value:datasetForm.name,onChange:value=>setDatasetFormValue("name",value),placeholder:"Enter dataset name","data-testid":"edit-dataset-name-input"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"description",label:"Description",showOptional:!0,children:(0,jsx_runtime.jsx)(src._V,{className:"ph-ignore-input",placeholder:"Describe what this dataset contains",value:datasetForm.description,onChange:value=>setDatasetFormValue("description",value),"data-testid":"edit-dataset-description-input"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"metadata",label:"Metadata",htmlFor:"dataset-metadata",showOptional:!0,help:"Additional key-value pairs to store with the dataset",children:(0,jsx_runtime.jsx)(JSONEditor.q,{value:null!==(_datasetForm$metadata=datasetForm.metadata)&&void 0!==_datasetForm$metadata?_datasetForm$metadata:void 0,onChange:code=>{setDatasetFormValue("metadata",code)}})})]})})}var JSONViewer=__webpack_require__("../../frontend/src/lib/components/JSONViewer.tsx"),themeLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts");let MemoizedJSONViewer=react.memo(_ref=>{let{json}=_ref,{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b);return(0,jsx_runtime.jsx)(HighlightedJSONViewer.Q,{src:json,theme:isDarkModeOn?JSONViewer.r.LIGHT:JSONViewer.r.DARK})}),JSONColumn=_ref2=>{let{children}=_ref2;return children?(0,jsx_runtime.jsx)(src.u,{placement:"bottom",title:(0,jsx_runtime.jsx)(MemoizedJSONViewer,{json:children}),className:"overflow-auto",containerClassName:"max-w-xl",children:(0,jsx_runtime.jsx)("pre",{className:"line-clamp-1 p-0 m-0 max-w-48 text-ellipsis",children:JSON.stringify(children)})}):(0,jsx_runtime.jsx)("span",{children:"—"})};var Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts");function RefreshButton(_ref){let{onClick,isRefreshing}=_ref;return(0,jsx_runtime.jsx)("div",{className:"relative",children:(0,jsx_runtime.jsx)(src.Jp,{onClick:onClick,type:"secondary",icon:isRefreshing?(0,jsx_runtime.jsx)(Spinner.$,{textColored:!0}):(0,jsx_runtime.jsx)(icons.tr,{}),size:"small",disabledReason:isRefreshing?"Refreshing...":void 0,children:(0,jsx_runtime.jsx)("span",{children:isRefreshing?"Refreshing...":"Refresh"})})})}let RESOURCE_TYPE="dataset",scene={component:LLMAnalyticsDatasetScene,logic:llmAnalyticsDatasetLogic,paramsToProps:_ref=>{let{params:{id}}=_ref;return{datasetId:id&&"new"!==id?id:"new"}}};function LLMAnalyticsDatasetScene(){let{shouldDisplaySkeleton,datasetLoading,isDatasetFormSubmitting,isEditingDataset,isDatasetMissing,isNewDataset,datasetForm,dataset,isDeletingDataset}=(0,index_esm.useValues)(llmAnalyticsDatasetLogic),{submitDatasetForm,loadDataset,editDataset,deleteDataset,setDatasetFormValue,triggerDatasetItemModal,onUnmount}=(0,index_esm.useActions)(llmAnalyticsDatasetLogic),displayEditForm=isNewDataset||isEditingDataset;return((0,react.useEffect)(()=>()=>onUnmount(),[onUnmount]),isDatasetMissing)?(0,jsx_runtime.jsx)(NotFound.T,{object:"dataset"}):shouldDisplaySkeleton?(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(LemonSkeleton.y,{active:!0,className:"h-4 w-2/5"}),(0,jsx_runtime.jsx)(LemonSkeleton.y,{active:!0,className:"h-4 w-full"}),(0,jsx_runtime.jsx)(LemonSkeleton.y,{active:!0,className:"h-4 w-full"}),(0,jsx_runtime.jsx)(LemonSkeleton.y,{active:!0,className:"h-4 w-3/5"})]}):(0,jsx_runtime.jsx)(lib.Form,{id:"dataset-form",formKey:"datasetForm",logic:llmAnalyticsDatasetLogic,children:(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:shouldDisplaySkeleton?void 0:displayEditForm?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary","data-attr":"cancel-dataset",onClick:()=>{isEditingDataset?(editDataset(!1),loadDataset()):kea_router_lib.router.actions.push(urls.j.llmAnalyticsDatasets())},disabledReason:isDatasetFormSubmitting?"Saving…":void 0,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary","data-attr":"save-dataset",onClick:submitDatasetForm,loading:isDatasetFormSubmitting,children:isNewDataset?"Create dataset":"Save"})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>editDataset(!0),loading:!1,"data-attr":"edit-dataset",children:"Edit"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>triggerDatasetItemModal(!0),"data-attr":"add-dataset-item",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),children:"Add item"})]})}),(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:datasetForm.name,resourceType:{type:"llm_analytics"},isLoading:datasetLoading}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),isDataset(dataset)&&(0,jsx_runtime.jsxs)(SceneLayout.kI,{children:[(0,jsx_runtime.jsxs)(SceneLayout.be,{children:[(0,jsx_runtime.jsx)(SceneTextInput.O,{name:"name",defaultValue:datasetForm.name,onSave:value=>{setDatasetFormValue("name",value),submitDatasetForm()},dataAttrKey:RESOURCE_TYPE,isLoading:datasetLoading}),(0,jsx_runtime.jsx)(SceneTextarea.a,{name:"description",defaultValue:datasetForm.description,onSave:value=>{setDatasetFormValue("description",value),submitDatasetForm()},dataAttrKey:RESOURCE_TYPE,optional:!0,isLoading:datasetLoading})]}),(0,jsx_runtime.jsx)(SceneLayout.bI,{}),(0,jsx_runtime.jsxs)(SceneLayout.kf,{children:[(0,jsx_runtime.jsx)(SceneLayout.bI,{}),(0,jsx_runtime.jsxs)(ButtonPrimitives.hL,{onClick:()=>{LemonDialog.LemonDialog.open({title:"Permanently delete dataset?",description:"This action cannot be undone.",primaryButton:{children:"Delete",type:"primary",status:"danger","data-attr":"confirm-delete-dataset",onClick:deleteDataset},secondaryButton:{children:"Close",type:"secondary"}})},variant:"danger",menuItem:!0,"data-attr":`${RESOURCE_TYPE}-delete`,disabledReasons:{"Dataset is loading":datasetLoading,"Dataset is being deleted":isDeletingDataset},children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),"Delete"]})]})]}),displayEditForm?(0,jsx_runtime.jsx)(EditDatasetForm,{}):isDataset(dataset)?(0,jsx_runtime.jsx)(DatasetTabs,{dataset:dataset}):null]})})}function DatasetTabs(_ref2){let{dataset}=_ref2,{activeTab,isDatasetItemModalOpen,selectedDatasetItem}=(0,index_esm.useValues)(llmAnalyticsDatasetLogic),{closeModalAndRefetchDatasetItems}=(0,index_esm.useActions)(llmAnalyticsDatasetLogic),{searchParams}=(0,index_esm.useValues)(kea_router_lib.router),tabs=[{key:DatasetTab.Items,label:"Items",content:(0,jsx_runtime.jsx)(DatasetItems,{dataset:dataset}),link:(0,kea_router_lib.combineUrl)(urls.j.llmAnalyticsDataset(dataset.id),{...searchParams,tab:DatasetTab.Items}).url},{key:DatasetTab.Metadata,label:"Metadata",content:(0,jsx_runtime.jsx)(DatasetMetadata,{dataset:dataset}),link:(0,kea_router_lib.combineUrl)(urls.j.llmAnalyticsDataset(dataset.id),{...searchParams,tab:DatasetTab.Metadata}).url}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("p",{className:"m-0",children:dataset.description||(0,jsx_runtime.jsx)("span",{className:"italic",children:"Description (optional)"})})}),(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,"data-attr":"dataset-tabs",tabs:tabs}),(0,jsx_runtime.jsx)(DatasetItemModal.Q,{isOpen:isDatasetItemModalOpen,onClose:closeModalAndRefetchDatasetItems,partialDatasetItem:selectedDatasetItem,datasetId:dataset.id,displayBulkCreationButton:!0})]})}function DatasetItems(_ref3){let{dataset}=_ref3,{datasetItems,datasetItemsLoading,pagination}=(0,index_esm.useValues)(llmAnalyticsDatasetLogic),{deleteDatasetItem,loadDatasetItems}=(0,index_esm.useActions)(llmAnalyticsDatasetLogic),{searchParams}=(0,index_esm.useValues)(kea_router_lib.router),columns=[{title:"ID",dataIndex:"id",key:"id",width:"10%",render:function renderID(_,item){return(0,jsx_runtime.jsx)(src.rU,{to:urls.j.llmAnalyticsDataset(dataset.id,{...searchParams,item:item.id}),children:(0,utils.ol)(item.id)})}},{title:"Trace",dataIndex:"ref_trace_id",key:"ref_trace_id",width:"10%",render:function renderRefTraceId(_,item){return item.ref_trace_id&&item.ref_source_id&&item.ref_timestamp?(0,jsx_runtime.jsx)(src.rU,{to:urls.j.llmAnalyticsTrace(item.ref_trace_id,{event:item.ref_source_id,timestamp:item.ref_timestamp}),children:(0,utils.ol)(item.ref_trace_id)}):(0,jsx_runtime.jsx)("span",{children:"—"})}},{title:"Input",dataIndex:"input",key:"input",width:"30%",render:function renderInput(_,item){return(0,jsx_runtime.jsx)(JSONColumn,{children:item.input})}},{title:"Output",dataIndex:"output",key:"output",width:"30%",render:function renderOutput(_,item){return(0,jsx_runtime.jsx)(JSONColumn,{children:item.output})}},{title:"Metadata",dataIndex:"metadata",key:"metadata",width:"25%",render:function renderMetadata(_,item){return(0,jsx_runtime.jsx)(JSONColumn,{children:item.metadata})}},{title:"Created by",dataIndex:"created_by",render:function renderCreatedBy(_,item){let{created_by}=item;return(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center flex-nowrap",children:created_by&&(0,jsx_runtime.jsx)(src.YY,{user:created_by,size:"md",showName:!0})})}},(0,columnUtils.rw)(),(0,columnUtils.yI)(),{width:0,render:function renderMore(_,item){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.llmAnalyticsDataset(dataset.id,{...searchParams,item:item.id}),"data-attr":`dataset-item-${item.id}-dropdown-edit`,fullWidth:!0,children:"Edit"}),(0,jsx_runtime.jsx)(src.Jp,{status:"danger",onClick:()=>deleteDatasetItem(item.id),"data-attr":`dataset-item-${item.id}-dropdown-delete`,fullWidth:!0,children:"Delete"})]})})}}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-center",children:(0,jsx_runtime.jsx)(RefreshButton,{onClick:()=>{loadDatasetItems(!0)},isRefreshing:datasetItemsLoading})}),(0,jsx_runtime.jsx)(src.p2,{className:"my-4"}),(0,jsx_runtime.jsx)(LemonTable.g,{loading:datasetItemsLoading,columns:columns,dataSource:datasetItems?.results||[],rowKey:"id",pagination:pagination,nouns:["dataset item","dataset items"],emptyState:"No items in this dataset yet."})]})}function DatasetMetadata(_ref4){let{dataset}=_ref4;return(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-4 max-w-160",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)("h3",{className:"text-sm font-semibold m-0",children:"Metadata"}),dataset.metadata?(0,jsx_runtime.jsx)("div",{className:"bg-bg-light p-4 rounded border overflow-x-auto",children:(0,jsx_runtime.jsx)(HighlightedJSONViewer.Q,{src:dataset.metadata})}):(0,jsx_runtime.jsx)("p",{className:"text-muted m-0",children:"No metadata available."})]})})}},"../../products/llm_analytics/frontend/datasets/llmAnalyticsDatasetsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>DATASETS_PER_PAGE,x:()=>llmAnalyticsDatasetsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),_lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/api.ts"),_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),_lib_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils.tsx"),_scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/sceneLogic.tsx"),_scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/urls.ts");let DATASETS_PER_PAGE=30;function cleanFilters(values){return{page:parseInt(String(values.page))||1,search:String(values.search||""),order_by:values.order_by||"-created_at"}}let llmAnalyticsDatasetsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","llm-analytics","llmAnalyticsDatasetsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:function(filters){let merge=!(arguments.length>1)||void 0===arguments[1]||arguments[1],debounce=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return{filters,merge,debounce}},loadDatasets:function(){let debounce=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return{debounce}},deleteDataset:datasetId=>({datasetId})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({rawFilters:[null,{setFilters:(state,_ref)=>{let{filters,merge}=_ref;return cleanFilters({...merge&&state||{},...filters,..."page"in filters?{}:{page:1}})}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values}=_ref2;return{datasets:[{results:[],count:0,offset:0},{loadDatasets:async(_ref3,breakpoint)=>{let{debounce}=_ref3;debounce&&values.datasets.results.length>0&&await breakpoint(300);let{filters}=values,params={search:filters.search,order_by:filters.order_by,offset:Math.max(0,(filters.page-1)*DATASETS_PER_PAGE),limit:DATASETS_PER_PAGE};return _scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_6__.k.findMounted()?.values.activeSceneId==="LLMAnalyticsDatasets"&&"POP"!==kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.lastMethod&&values.datasets.results.length>0&&values.rawFilters?.page!==filters.page&&window.scrollTo(0,0),await _lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.datasets.list(params)}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({filters:[s=>[s.rawFilters],rawFilters=>cleanFilters(rawFilters||{})],count:[s=>[s.datasets],datasets=>datasets.count],sorting:[s=>[s.filters],filters=>filters.order_by?filters.order_by.startsWith("-")?{columnKey:filters.order_by.slice(1),order:-1}:{columnKey:filters.order_by,order:1}:{columnKey:"updated_at",order:-1}],pagination:[s=>[s.filters,s.count],(filters,count)=>({controlled:!0,pageSize:DATASETS_PER_PAGE,currentPage:filters.page,entryCount:count})],datasetCountLabel:[s=>[s.filters,s.count],(filters,count)=>{let start=(filters.page-1)*DATASETS_PER_PAGE+1,end=Math.min(filters.page*DATASETS_PER_PAGE,count);return 0===count?"0 datasets":`${start}-${end} of ${count} dataset${1===count?"":"s"}`}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{asyncActions,values,selectors}=_ref4;return{setFilters:async(_ref5,_,__,previousState)=>{let{debounce}=_ref5,oldFilters=selectors.filters(previousState),{filters}=values;(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(oldFilters,filters)||await asyncActions.loadDatasets(debounce)},deleteDataset:async _ref6=>{let{datasetId}=_ref6;try{let datasetName=values.datasets.results.find(dataset=>dataset.id===datasetId)?.name;await _lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.datasets.update(datasetId,{deleted:!0}),_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.info(`${datasetName||"Dataset"} has been deleted.`),await asyncActions.loadDatasets(!1)}catch{_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Failed to delete dataset")}}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.actionToUrl)(_ref7=>{let{values}=_ref7;return{setFilters:()=>{let nextValues=cleanFilters(values.filters),urlValues=cleanFilters(kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.searchParams);if(!(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(nextValues,urlValues))return[_scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.llmAnalyticsDatasets(),nextValues,{},{replace:!1}]}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.urlToAction)(_ref8=>{let{actions,values}=_ref8;return{[_scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.llmAnalyticsDatasets()]:(_,searchParams)=>{let newFilters=cleanFilters(searchParams);null!==values.rawFilters&&(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(values.filters,newFilters)||actions.setFilters(newFilters,!1)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref9=>{let{actions}=_ref9;actions.loadDatasets()})])},"../../products/llm_analytics/frontend/datasets/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B7:()=>coerceJsonToObject,Fh:()=>isStringJsonObject,Kc:()=>EMPTY_JSON,pP:()=>prettifyJson});let EMPTY_JSON="{\n  \n}";function coerceJsonToObject(maybeJson){if(!maybeJson)return null;try{let parsedObject=JSON.parse(maybeJson);if("object"==typeof parsedObject&&Object.keys(parsedObject).length>0)return parsedObject;return null}catch{return null}}function isStringJsonObject(maybeJson){if(!maybeJson)return!0;try{let parsedObject=JSON.parse(maybeJson);if("object"!=typeof parsedObject||null===parsedObject)return!1}catch{return!1}return!0}function prettifyJson(json){let stringified=json?JSON.stringify(json,null,2):null;return"{}"===stringified&&(stringified=EMPTY_JSON),stringified}}}]);