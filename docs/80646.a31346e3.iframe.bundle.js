"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[80646],{"../../frontend/src/lib/components/Cards/InsightCard/QueryCard.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>QueryCard});var clsx__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib_components_Cards_CardMeta__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/components/Cards/CardMeta.tsx"),lib_lemon_ui_LemonMenu_LemonMenu__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/LemonMenu.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_ErrorBoundary__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/layout/ErrorBoundary/index.ts"),_layout_navigation_3000_themeLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),_queries_Query_Query__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),_InsightDetails__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/InsightDetails.tsx"),_InsightMeta__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/InsightMeta.tsx"),_TopHeading__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/TopHeading.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let QueryCard=react__WEBPACK_IMPORTED_MODULE_1__.forwardRef(function QueryCard(_ref,ref){let{query,title,description,context,highlighted,ribbonColor,className,sceneSource,attachTo,uniqueKey,...divProps}=_ref,{theme}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_layout_navigation_3000_themeLogic__WEBPACK_IMPORTED_MODULE_6__.b),[areDetailsShown,setAreDetailsShown]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:(0,clsx__WEBPACK_IMPORTED_MODULE_12__.default)("InsightCard border",highlighted&&"InsightCard--highlighted",className),"data-attr":"insight-card",...divProps,style:{...divProps?.style,...theme?.boxStyle},ref:ref,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(_layout_ErrorBoundary__WEBPACK_IMPORTED_MODULE_5__.S,{exceptionProps:{feature:"insight"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_components_Cards_CardMeta__WEBPACK_IMPORTED_MODULE_2__.I,{ribbonColor:ribbonColor,setAreDetailsShown:setAreDetailsShown,areDetailsShown:areDetailsShown,topHeading:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_TopHeading__WEBPACK_IMPORTED_MODULE_10__.l,{query:query}),content:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_InsightMeta__WEBPACK_IMPORTED_MODULE_9__.Q,{title:title,description:description}),metaDetails:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_InsightDetails__WEBPACK_IMPORTED_MODULE_8__.Mz,{query:query}),samplingFactor:"samplingFactor"in query&&"number"==typeof query.samplingFactor?query.samplingFactor:void 0,moreButtons:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonMenu_LemonMenu__WEBPACK_IMPORTED_MODULE_3__.tN,{items:[{label:"Open as new insight",to:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.insightNew({query,sceneSource})}]}),showEditingControls:!0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"InsightCard__viz",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_queries_Query_Query__WEBPACK_IMPORTED_MODULE_7__.A,{attachTo:attachTo,query:query,readOnly:!0,embedded:!0,context:context,uniqueKey:uniqueKey})})]})})})},"../../products/customer_analytics/frontend/CustomerAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CustomerAnalyticsScene:()=>CustomerAnalyticsScene,scene:()=>scene});var sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes=__webpack_require__("../../frontend/src/scenes/scenes.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),ActionFilter=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),ActionFilterRow=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),utils=__webpack_require__("../../frontend/src/queries/utils.ts"),api=__webpack_require__("../../frontend/src/lib/api.ts"),tabAwareScene=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareScene.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),src_types=__webpack_require__("../../frontend/src/types.ts");let customerAnalyticsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","customerAnalytics","customerAnalyticsScene"]),(0,tabAwareScene.P)(),(0,index_esm.connect)(()=>({values:[teamLogic.teamLogic,["currentTeamId","currentTeam"]],actions:[teamLogic.teamLogic,["updateCurrentTeam"]]})),(0,index_esm.actions)({setActivityEventSelection:filters=>({filters}),saveActivityEvent:!0,toggleEventConfigModal:isOpen=>({isOpen})}),(0,index_esm.reducers)({activityEventSelection:[null,{setActivityEventSelection:(_,_ref)=>{let{filters}=_ref;return filters}}],isEventConfigModalOpen:[!1,{toggleEventConfigModal:(state,_ref2)=>{let{isOpen}=_ref2;return void 0!==isOpen?isOpen:!state}}]}),(0,index_esm.selectors)({tabId:[()=>[(_,props)=>props.tabId],tabIdProp=>tabIdProp],breadcrumbs:[()=>[],()=>[{key:sceneTypes.x.CustomerAnalytics,name:scenes.lc[sceneTypes.x.CustomerAnalytics].name,path:urls.j.customerAnalytics(),iconType:scenes.lc[sceneTypes.x.CustomerAnalytics].iconType||"default_icon_type"}]],activityEventSelectionWithDefault:[s=>[s.activityEventSelection,s.activityEvent],(activityEventSelection,activityEvent)=>null!=activityEventSelection?activityEventSelection:{insight:src_types.dw.TRENDS,events:[{id:activityEvent,type:src_types.DC.EVENTS,order:0}]}],hasActivityEventChanged:[s=>[s.activityEventSelection],activityEventSelection=>null!==activityEventSelection],customerAnalyticsEvents:[s=>[s.currentTeam],currentTeam=>currentTeam?.extra_settings?.customer_analytics_events||{}],activityEvent:[s=>[s.customerAnalyticsEvents],customerAnalyticsEvents=>customerAnalyticsEvents?.activity_event||"$pageview"],dauSeries:[s=>[s.activityEvent],activityEvent=>({kind:schema_general.OH.EventsNode,math:src_types.vN.UniqueUsers,event:activityEvent||null,properties:[]})],wauSeries:[s=>[s.activityEvent],activityEvent=>({kind:schema_general.OH.EventsNode,math:src_types.vN.WeeklyActiveUsers,event:activityEvent||null,properties:[]})],mauSeries:[s=>[s.activityEvent],activityEvent=>({kind:schema_general.OH.EventsNode,math:src_types.vN.MonthlyActiveUsers,event:activityEvent||null,properties:[]})],activeUsersInsights:[s=>[s.dauSeries,s.wauSeries,s.mauSeries],(dauSeries,wauSeries,mauSeries)=>[{name:"Active Users (DAU/WAU/MAU)",needsConfig:!1,className:"row-span-2 h-[576px]",query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[dauSeries,wauSeries,mauSeries],interval:"day",dateRange:{date_from:"-90d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.ActionsLineGraph,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,smoothingIntervals:1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"Weekly Active Users",needsConfig:!1,className:"h-[284px]",query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[wauSeries],interval:"day",dateRange:{date_from:"-7d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.BoldNumber,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,smoothingIntervals:1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},compareFilter:{compare:!0},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"Monthly Active Users",needsConfig:!1,className:"h-[284px]",query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[mauSeries],interval:"day",dateRange:{date_to:null,date_from:"-30d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.BoldNumber,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,smoothingIntervals:1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},compareFilter:{compare:!0},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}}]]}),(0,index_esm.listeners)(_ref3=>{let{actions,values}=_ref3;return{saveActivityEvent:async()=>{let selectedEvent=values.activityEventSelectionWithDefault.events?.[0]?.id;if(selectedEvent&&"string"==typeof selectedEvent){let currentTeam=values.currentTeam;try{currentTeam=await api.ZP.get("api/environments/@current")}catch{}let currentSettings=currentTeam?.extra_settings||{},extra_settings={...currentSettings,customer_analytics_events:{...currentSettings.customer_analytics_events,activity_event:selectedEvent}};actions.updateCurrentTeam({extra_settings}),actions.setActivityEventSelection(null)}},toggleEventConfigModal:_ref4=>{let{isOpen}=_ref4;(!1===isOpen||void 0===isOpen&&values.isEventConfigModalOpen)&&actions.setActivityEventSelection(null)}}})]);var CardMeta=__webpack_require__("../../frontend/src/lib/components/Cards/CardMeta.tsx"),InsightMeta=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/InsightMeta.tsx"),QueryCard=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/QueryCard.tsx"),TopHeading=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/TopHeading.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function CustomerAnalyticsQueryCard(_ref){let{insight,tabId}=_ref;return insight?.needsConfig?(0,jsx_runtime.jsxs)(src.Mi,{hoverEffect:!1,className:"h-[400px] p-0",children:[(0,jsx_runtime.jsx)(CardMeta.I,{topHeading:(0,jsx_runtime.jsx)(TopHeading.l,{query:insight.query}),content:(0,jsx_runtime.jsx)(InsightMeta.Q,{title:insight.name,description:insight.description})}),(0,jsx_runtime.jsx)(src.Vp,{type:"warning",children:"This insight requires configuration."})]}):(0,jsx_runtime.jsx)(QueryCard.w,{uniqueKey:`${insight.name}-${tabId}`,title:insight.name,description:insight.description,query:insight.query,context:{refresh:"force_blocking"},className:insight?.className||"",attachTo:customerAnalyticsSceneLogic})}function EventConfigModal(){let{isEventConfigModalOpen,activityEventSelectionWithDefault,hasActivityEventChanged}=(0,index_esm.useValues)(customerAnalyticsSceneLogic),{toggleEventConfigModal,setActivityEventSelection,saveActivityEvent}=(0,index_esm.useActions)(customerAnalyticsSceneLogic),handleClose=()=>{toggleEventConfigModal(!1)};return(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isEventConfigModalOpen,onClose:handleClose,title:"Configure activity event",width:600,hasUnsavedInput:hasActivityEventChanged,children:[(0,jsx_runtime.jsxs)(src.fQ.Content,{children:[(0,jsx_runtime.jsx)("p",{className:"mb-4",children:"Select which event defines user activity for your customer analytics dashboard."}),(0,jsx_runtime.jsx)(ActionFilter.T,{filters:activityEventSelectionWithDefault,setFilters:setActivityEventSelection,typeKey:"customer-analytics-event-config-modal",mathAvailability:ActionFilterRow.Qq.None,hideDeleteBtn:!0,hideRename:!0,hideDuplicate:!0,hideFilter:!0,entitiesLimit:1,actionsTaxonomicGroupTypes:[types.t.Events]})]}),(0,jsx_runtime.jsxs)(src.fQ.Footer,{children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:handleClose,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{saveActivityEvent(),toggleEventConfigModal(!1)},disabledReason:hasActivityEventChanged?null:"No changes",children:"Save activity event"})]})]})}function ActiveUsersInsights(){let{activityEvent,activityEventSelectionWithDefault,activeUsersInsights,hasActivityEventChanged,tabId}=(0,index_esm.useValues)(customerAnalyticsSceneLogic),{setActivityEventSelection,saveActivityEvent,toggleEventConfigModal}=(0,index_esm.useActions)(customerAnalyticsSceneLogic),isActivityEventPageview="$pageview"===activityEvent;return(0,jsx_runtime.jsxs)("div",{className:"space-y-2 mb-0",children:[isActivityEventPageview&&(0,jsx_runtime.jsxs)(src.Vp,{type:"warning",children:["You are currently using pageview event to define user activity. Consider using a more specific event, so that you're tracking activity accurately.",(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center gap-4 mt-2 max-w-160",children:[(0,jsx_runtime.jsx)(ActionFilter.T,{filters:activityEventSelectionWithDefault,setFilters:setActivityEventSelection,typeKey:"customer-analytics-activity-event",mathAvailability:ActionFilterRow.Qq.None,hideDeleteBtn:!0,hideRename:!0,hideDuplicate:!0,hideFilter:!0,entitiesLimit:1,actionsTaxonomicGroupTypes:[types.t.Events],buttonCopy:"Change event"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",disabledReason:hasActivityEventChanged?null:"No changes",onClick:saveActivityEvent,children:"Save activity event"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 ml-1",children:[(0,jsx_runtime.jsx)("h2",{className:"m-0",children:"Active Users"}),!isActivityEventPageview&&(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),size:"small",noPadding:!0,onClick:()=>toggleEventConfigModal(),tooltip:"Configure activity event"})]}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-[3fr_1fr] gap-2",children:activeUsersInsights.map((insight,index)=>(0,jsx_runtime.jsx)(CustomerAnalyticsQueryCard,{insight:insight,tabId:tabId},index))}),(0,jsx_runtime.jsx)("h2",{className:"ml-1 -mb-2",children:"Power Users"}),(0,jsx_runtime.jsx)(PowerUsersTable,{}),(0,jsx_runtime.jsx)(EventConfigModal,{})]})}function PowerUsersTable(){let{activityEvent,tabId}=(0,index_esm.useValues)(customerAnalyticsSceneLogic),query={kind:schema_general.OH.DataTableNode,source:{kind:schema_general.OH.HogQLQuery,query:(0,utils.zP)`
                SELECT person_id,
                       count() as event_count
                FROM events
                WHERE event = ${activityEvent}
                  and timestamp
                    > now() - interval '30 days'
                GROUP BY person_id
                ORDER BY event_count DESC
                    LIMIT 10
            `},columns:["person_id","event_count"]};return(0,jsx_runtime.jsx)(Query.A,{uniqueKey:`power-users-${tabId}`,attachTo:customerAnalyticsSceneLogic,query:{...query,showTimings:!1,showOpenEditorButton:!1},context:{columns:{person_id:{title:"Person",render:_ref=>{let{value}=_ref;return(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-2",children:(0,jsx_runtime.jsx)(src.rU,{target:"_blank",to:urls.j.personByUUID(value),children:value})})}},event_count:{title:"Event Count",render:_ref2=>{let{value}=_ref2;return(0,jsx_runtime.jsx)("strong",{children:value})}}}}})}let scene={component:CustomerAnalyticsScene,logic:customerAnalyticsSceneLogic};function CustomerAnalyticsScene(_ref){let{tabId}=_ref;if(!tabId)throw Error("CustomerAnalyticsScene was rendered with no tabId");return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:scenes.lc[sceneTypes.x.CustomerAnalytics].name,description:scenes.lc[sceneTypes.x.CustomerAnalytics].description,resourceType:{type:scenes.lc[sceneTypes.x.CustomerAnalytics].iconType||"default_icon_type"}}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:(0,jsx_runtime.jsx)(ActiveUsersInsights,{})})]})}}}]);
//# sourceMappingURL=80646.a31346e3.iframe.bundle.js.map