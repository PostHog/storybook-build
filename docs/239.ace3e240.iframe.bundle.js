(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{"./frontend/src/scenes/experiments/Experiment.tsx":function(Te,Z,i){"use strict";i.r(Z),i.d(Z,"scene",function(){return un}),i.d(Z,"Experiment_",function(){return je}),i.d(Z,"CodeLanguageSelect",function(){return Ot});var Me=i("./node_modules/core-js/modules/es.symbol.js"),_t=i("./node_modules/core-js/modules/es.symbol.description.js"),lt=i("./node_modules/core-js/modules/es.array.concat.js"),At=i("./node_modules/core-js/modules/es.array.filter.js"),ot=i("./node_modules/core-js/modules/es.array.map.js"),kt=i("./node_modules/core-js/modules/es.array.reduce.js"),ct=i("./node_modules/core-js/modules/es.function.name.js"),Ut=i("./node_modules/core-js/modules/es.number.constructor.js"),mt=i("./node_modules/core-js/modules/es.number.to-fixed.js"),Yt=i("./node_modules/core-js/modules/es.object.keys.js"),dt=i("./node_modules/core-js/modules/es.object.to-string.js"),Vt=i("./node_modules/core-js/modules/es.regexp.to-string.js"),Ve=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),pe=i.n(Ve),Be=i("./node_modules/@babel/runtime/helpers/slicedToArray.js"),H=i.n(Be),_=i("./node_modules/antd/es/form/index.js"),E=i("./node_modules/antd/es/row/index.js"),g=i("./node_modules/antd/es/col/index.js"),ne=i("./node_modules/antd/es/input/index.js"),fe=i("./node_modules/antd/es/tooltip/index.js"),J=i("./node_modules/antd/es/button/index.js"),R=i("./node_modules/antd/es/select/index.js"),Q=i("./node_modules/antd/es/card/index.js"),le=i("./node_modules/antd/es/tag/index.js"),De=i("./node_modules/antd/es/collapse/index.js"),Ce=i("./node_modules/antd/es/progress/index.js"),M=i("./node_modules/kea/lib/index.esm.js"),Fe=i("./frontend/src/lib/components/PageHeader.tsx"),ve=i("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),q=i("./frontend/src/lib/components/PropertyFilters/utils.ts"),S=i("./frontend/src/lib/components/TaxonomicFilter/types.ts"),Y=i("./node_modules/react/index.js"),e=i.n(Y),P=i("./frontend/src/scenes/funnels/funnelLogic.ts"),A=i("./frontend/src/scenes/insights/ActionFilter/ActionFilter.tsx"),k=i("./frontend/src/scenes/insights/insightLogic.ts"),u=i("./frontend/src/types.ts"),V=i("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),ge=i.n(V),Bt=i("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss"),ut=i.n(Bt),$e={};$e.insert="head",$e.singleton=!1;var Yn=ge()(ut.a,$e),Vn=ut.a.locals||{},Bn=i("./node_modules/core-js/modules/es.array.fill.js"),$n=i("./node_modules/core-js/modules/es.array.find.js"),zn=i("./node_modules/core-js/modules/es.array.find-index.js"),Kn=i("./node_modules/core-js/modules/es.array.iterator.js"),Wn=i("./node_modules/core-js/modules/es.array.splice.js"),Gn=i("./node_modules/core-js/modules/es.number.epsilon.js"),Hn=i("./node_modules/core-js/modules/es.object.values.js"),Jn=i("./node_modules/core-js/modules/web.dom-collections.iterator.js"),$t=i("./node_modules/@babel/runtime/regenerator/index.js"),O=i.n($t),Xn=i("./node_modules/regenerator-runtime/runtime.js"),zt=i("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),B=i.n(zt),Kt=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ae=i.n(Kt),oe=i("./frontend/src/lib/api.ts"),T=i("./frontend/src/lib/dayjs.ts"),$=i("./frontend/src/lib/utils.tsx"),Wt=["furry","amusing","charming","tame","swift","clever","pleasant","tiny","wild","herbivorous","admirable","adorable","agile","beautiful","bossy","candid","cold","colorful","cuddly","curious","cute","energetic","fast","feisty","fierce","fluffy","friendly","fuzzy","grumpy","hairy","heavy","large","lazy","loud","lovable","loving","enchanted","maternal","sweet","messy","nocturnal","noisy","nosy","picky","playful","quick","sassy","scaly","short","shy","slow","small","smart","soft","strong","tall","tenacious","glorious","warm","cheerful","gracious"],Gt=["aardvark","albatross","alligator","alpaca","ant","anteater","antelope","ape","armadillo","donkey","baboon","badger","barracuda","bat","bear","beaver","bee","bison","boar","buffalo","butterfly","camel","capybara","caribou","cassowary","cat","caterpillar","cattle","chamois","cheetah","chicken","chimpanzee","chinchilla","chough","clam","cobra","cockroach","cod","cormorant","coyote","crab","crane","crocodile","crow","curlew","deer","dinosaur","dog","dogfish","dolphin","dotterel","dove","dragonfly","duck","dugong","dunlin","eagle","echidna","eel","eland","elephant","elk","emu","falcon","ferret","finch","firefox","fish","flamingo","fly","fox","frog","gaur","gazelle","gerbil","giraffe","gnat","gnu","goat","goldfinch","goldfish","goose","gorilla","goshawk","grasshopper","grouse","guanaco","gull","hamster","hare","hawk","hedgehog","heron","herring","hippopotamus","hornet","horse","human","hummingbird","hyena","ibex","ibis","jackal","jaguar","jay","jellyfish","kangaroo","kingfisher","koala","kookabura","kouprey","kudu","lapwing","lark","lemur","leopard","lion","llama","lobster","locust","loris","louse","lyrebird","magpie","mallard","manatee","mandrill","mantis","marten","meerkat","mink","mole","mongoose","monkey","moose","mosquito","mouse","mule","narwhal","newt","nightingale","octopus","okapi","opossum","oryx","ostrich","otter","owl","oyster","panther","parrot","partridge","peafowl","pelican","penguin","pheasant","pig","pigeon","pony","porcupine","porpoise","quail","quelea","quetzal","rabbit","raccoon","rail","ram","rat","raven","reindeer","rhinoceros","rook","salamander","salmon","sandpiper","sardine","scorpion","seahorse","seal","shark","sheep","shrew","skunk","snail","snake","sparrow","spider","spoonbill","squid","squirrel","starling","stingray","stinkbug","stork","swallow","swan","tapir","tarsier","termite","tiger","toad","trout","turkey","turtle","viper","vulture","wallaby","walrus","wasp","weasel","whale","wildcat","wolf","wolverine","wombat","woodcock","woodpecker","worm","wren","yak","zebra"];function pt(){return"".concat(Object($.j)(Object($.ub)(Wt))," ").concat(Object($.j)(Object($.ub)(Gt)))}var Pe=i("./frontend/src/scenes/insights/utils/cleanFilters.ts"),ze=i("./frontend/src/scenes/teamLogic.ts"),Ee=i("./frontend/src/scenes/urls.ts"),Le=i("./node_modules/kea-router/lib/index.js"),Ht=i("./frontend/src/scenes/experiments/experimentsLogic.ts"),ce=i("./frontend/src/lib/constants.tsx"),Ke=i("./frontend/src/scenes/trends/trendsLogic.ts"),he=i("./frontend/src/lib/utils/eventUsageLogic.ts"),Jt=i("./frontend/src/scenes/userLogic.ts"),ft=i("./frontend/src/lib/components/Tooltip.tsx"),xe=i("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),Xt=i("./frontend/src/models/groupsModel.ts"),We=i("./frontend/src/lib/components/lemonToast.tsx");function vt(t,n){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,r)}return a}function y(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?vt(Object(a),!0).forEach(function(r){pe()(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):vt(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}var ye=14,be=Object(M.kea)({props:{},key:function(n){return n.experimentId||"new"},path:function(n){return["scenes","experiment","experimentLogic",n]},connect:{values:[ze.a,["currentTeamId"],Jt.a,["hasAvailableFeature"],Xt.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]],actions:[Ht.a,["updateExperiments","addToExperiments"]]},actions:{setExperiment:function(n){return{experiment:n}},createExperiment:function(n,a,r){return{draft:n,runningTime:a,sampleSize:r}},setExperimentInsightId:function(n){return{shortId:n}},createNewExperimentInsight:function(n){return{filters:n}},setFilters:function(n){return{filters:n}},setNewExperimentData:function(n){return{experimentData:n}},updateExperimentGroup:function(n,a){return{variant:n,idx:a}},removeExperimentGroup:function(n){return{idx:n}},setExperimentInsightType:function(n){return{insightType:n}},setEditExperiment:function(n){return{editing:n}},setSecondaryMetrics:function(n){return{secondaryMetrics:n}},resetNewExperiment:!0,launchExperiment:!0,endExperiment:!0,addExperimentGroup:!0,archiveExperiment:!0},reducers:{newExperimentData:[null,{setNewExperimentData:function(n,a){var r=a.experimentData;if(r.filters){var o=y(y({},n==null?void 0:n.filters),r.filters);return y(y(y({},n),r),{},{filters:o})}if(r.parameters){var d=y(y({},n==null?void 0:n.parameters),r.parameters);return y(y(y({},n),r),{},{parameters:d})}return y(y({},n),r)},updateExperimentGroup:function(n,a){var r,o=a.variant,d=a.idx,c=ae()((n==null||(r=n.parameters)===null||r===void 0?void 0:r.feature_flag_variants)||[]);return c[d]=y(y({},c[d]),o),y(y({},n),{},{parameters:y(y({},n==null?void 0:n.parameters),{},{feature_flag_variants:c})})},addExperimentGroup:function(n){var a;if(!(n==null||(a=n.parameters)===null||a===void 0)&&a.feature_flag_variants){var r=gt(n.parameters.feature_flag_variants.length+1),o=n.parameters.feature_flag_variants.map(function(d,c){return y(y({},d),{},{rollout_percentage:r[c]})});return y(y({},n),{},{parameters:y(y({},n.parameters),{},{feature_flag_variants:[].concat(ae()(o),[{key:"test_group_".concat(n.parameters.feature_flag_variants.length),rollout_percentage:r[r.length-1]}])})})}return n},removeExperimentGroup:function(n,a){var r,o,d=a.idx;if(!n)return n;var c=ae()(((r=n.parameters)===null||r===void 0?void 0:r.feature_flag_variants)||[]);c.splice(d,1);var s=gt(((n==null||(o=n.parameters)===null||o===void 0?void 0:o.feature_flag_variants)||[]).length-1),p=c.map(function(m,b){return y(y({},m),{},{rollout_percentage:s[b]})});return y(y({},n),{},{parameters:y(y({},n.parameters),{},{feature_flag_variants:p})})},setSecondaryMetrics:function(n,a){var r=a.secondaryMetrics,o=r.map(function(d){return d});return y(y({},n),{},{secondary_metrics:o})},resetNewExperiment:function(){return{parameters:{feature_flag_variants:[{key:"control",rollout_percentage:50},{key:"test",rollout_percentage:50}]}}}}],experimentInsightType:[u.s.FUNNELS,{setExperimentInsightType:function(n,a){var r=a.insightType;return r}}],experimentInsightId:[null,{setExperimentInsightId:function(n,a){var r=a.shortId;return r}}],editingExistingExperiment:[!1,{setEditExperiment:function(n,a){var r=a.editing;return r}}]},listeners:function(n){var a=n.values,r=n.props,o=n.actions;return{createExperiment:function(){var d=B()(O.a.mark(function s(p){var m,b,v,I,h,f,l,z,X,ee;return O.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(b=p.draft,v=p.runningTime,I=p.sampleSize,h=null,f=!!r.experimentId&&r.experimentId!=="new",x.prev=3,!f){x.next=14;break}return x.next=7,oe.a.update("api/projects/".concat(a.currentTeamId,"/experiments/").concat(r.experimentId),y(y({},a.newExperimentData),{},{parameters:y(y({},(l=a.newExperimentData)===null||l===void 0?void 0:l.parameters),{},{recommended_running_time:v,recommended_sample_size:I})},!b&&{start_date:Object(T.a)()}));case 7:if(h=x.sent,!(!((z=h)===null||z===void 0)&&z.id)){x.next=12;break}return o.updateExperiments(h),Le.router.actions.push(Ee.a.experiment(h.id)),x.abrupt("return");case 12:x.next=18;break;case 14:return x.next=16,oe.a.create("api/projects/".concat(a.currentTeamId,"/experiments"),y(y({},a.newExperimentData),{},{parameters:y(y({},(X=a.newExperimentData)===null||X===void 0?void 0:X.parameters),{},{recommended_running_time:v,recommended_sample_size:I})},!b&&{start_date:Object(T.a)()}));case 16:h=x.sent,h&&he.f.actions.reportExperimentCreated(h);case 18:x.next=24;break;case 20:return x.prev=20,x.t0=x.catch(3),We.a.error(x.t0.detail||"Failed to create experiment"),x.abrupt("return");case 24:!((m=h)===null||m===void 0)&&m.id&&(ee=h.id,Le.router.actions.push(Ee.a.experiment(ee)),o.addToExperiments(h),We.a.success("Experiment ".concat(f?"updated":"created"),{button:{label:"View it",action:function(){Le.router.actions.push(Ee.a.experiment(ee))}}}));case 25:case"end":return x.stop()}},s,null,[[3,20]])}));function c(s){return d.apply(this,arguments)}return c}(),createNewExperimentInsight:function(){var d=B()(O.a.mark(function s(p){var m,b,v,I;return O.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return m=p.filters,a.experimentInsightType===u.s.FUNNELS?b=Object(Pe.a)(y({insight:u.s.FUNNELS,funnel_viz_type:u.o.Steps,display:u.d.FunnelViz,date_from:Object(T.a)().subtract(ye,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:ce.q.horizontal},m)):b=Object(Pe.a)(y({insight:u.s.TRENDS,date_from:Object(T.a)().subtract(ye,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},m)),v={name:pt(),description:"",tags:[],filters:b,result:null},f.next=5,oe.a.create("api/projects/".concat(a.currentTeamId,"/insights"),v);case 5:I=f.sent,o.setExperimentInsightId(I.short_id),o.setNewExperimentData({filters:y({},v.filters)});case 8:case"end":return f.stop()}},s)}));function c(s){return d.apply(this,arguments)}return c}(),setFilters:function(c){var s=c.filters;if(a.experimentInsightType===u.s.FUNNELS){var p;(p=P.a.findMounted({dashboardItemId:a.experimentInsightId}))===null||p===void 0||p.actions.setFilters(s)}else{var m;(m=Ke.a.findMounted({dashboardItemId:a.experimentInsightId}))===null||m===void 0||m.actions.setFilters(s)}},loadExperimentSuccess:function(){var d=B()(O.a.mark(function s(p){var m;return O.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:m=p.experimentData,m&&he.f.actions.reportExperimentViewed(m),o.setExperimentInsightType((m==null?void 0:m.filters.insight)||u.s.FUNNELS),m!=null&&m.start_date?(o.resetNewExperiment(),o.loadExperimentResults(r.experimentId),o.loadSecondaryMetricResults(r.experimentId)):(o.setNewExperimentData(y({},m)),o.createNewExperimentInsight(m==null?void 0:m.filters));case 4:case"end":return v.stop()}},s)}));function c(s){return d.apply(this,arguments)}return c}(),launchExperiment:function(){var d=B()(O.a.mark(function s(){var p;return O.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:p=Object(T.a)(),o.updateExperiment({start_date:p.format("YYYY-MM-DDTHH:mm")}),a.experimentData&&he.f.actions.reportExperimentLaunched(a.experimentData,p);case 3:case"end":return b.stop()}},s)}));function c(){return d.apply(this,arguments)}return c}(),endExperiment:function(){var d=B()(O.a.mark(function s(){var p,m,b;return O.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:m=Object(T.a)(),o.updateExperiment({end_date:m.format("YYYY-MM-DDTHH:mm")}),b=m.diff((p=a.experimentData)===null||p===void 0?void 0:p.start_date,"second"),a.experimentData&&he.f.actions.reportExperimentCompleted(a.experimentData,m,b,a.areResultsSignificant);case 4:case"end":return I.stop()}},s)}));function c(){return d.apply(this,arguments)}return c}(),archiveExperiment:function(){var d=B()(O.a.mark(function s(){return O.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:o.updateExperiment({archived:!0}),a.experimentData&&he.f.actions.reportExperimentArchived(a.experimentData);case 2:case"end":return m.stop()}},s)}));function c(){return d.apply(this,arguments)}return c}(),setExperimentInsightType:function(){if(r.experimentId==="new"||a.editingExistingExperiment)o.createNewExperimentInsight();else{var c;o.createNewExperimentInsight((c=a.experimentData)===null||c===void 0?void 0:c.filters)}},updateExperimentSuccess:function(){var d=B()(O.a.mark(function s(p){var m;return O.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:m=p.experimentData,o.updateExperiments(m);case 2:case"end":return v.stop()}},s)}));function c(s){return d.apply(this,arguments)}return c}()}},loaders:function(n){var a=n.values,r=n.props;return{experimentData:[null,{loadExperiment:function(){var o=B()(O.a.mark(function c(){var s;return O.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(r.experimentId&&r.experimentId!=="new")){m.next=5;break}return m.next=3,oe.a.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(r.experimentId));case 3:return s=m.sent,m.abrupt("return",s);case 5:return m.abrupt("return",null);case 6:case"end":return m.stop()}},c)}));function d(){return o.apply(this,arguments)}return d}(),updateExperiment:function(){var o=B()(O.a.mark(function c(s){var p;return O.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,oe.a.update("api/projects/".concat(a.currentTeamId,"/experiments/").concat(r.experimentId),s);case 2:return p=b.sent,b.abrupt("return",p);case 4:case"end":return b.stop()}},c)}));function d(c){return o.apply(this,arguments)}return d}()}],experimentResults:[null,{loadExperimentResults:function(){var o=B()(O.a.mark(function c(s,p){var m;return O.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,p(10);case 2:return v.prev=2,v.next=5,oe.a.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(r.experimentId,"/results"));case 5:return m=v.sent,v.abrupt("return",y(y({},m),{},{itemID:Math.random().toString(36).substring(2,15)}));case 9:if(v.prev=9,v.t0=v.catch(2),v.t0.code!=="no_data"){v.next=13;break}return v.abrupt("return",null);case 13:return We.a.error(v.t0.detail||"Failed to load experiment results"),v.abrupt("return",null);case 15:case"end":return v.stop()}},c,null,[[2,9]])}));function d(c,s){return o.apply(this,arguments)}return d}()}],secondaryMetricResults:[null,{loadSecondaryMetricResults:function(){var o=B()(O.a.mark(function c(s,p){var m,b,v,I;return O.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,p(10);case 2:m=[],b=0;case 4:if(!(b<(((v=a.experimentData)===null||v===void 0?void 0:v.secondary_metrics.length)||0))){f.next=12;break}return f.next=7,oe.a.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(r.experimentId,"/secondary_results?id=").concat(b));case 7:I=f.sent,m.push(I.result);case 9:b++,f.next=4;break;case 12:return f.abrupt("return",m);case 13:case"end":return f.stop()}},c)}));function d(c,s){return o.apply(this,arguments)}return d}()}]}},selectors:{breadcrumbs:[function(t){return[t.experimentData,function(n,a){return a.experimentId}]},function(t,n){return[{name:"Experiments",path:Ee.a.experiments()},{name:(t==null?void 0:t.name)||"New Experiment",path:Ee.a.experiment(n||"new")}]}],variants:[function(t){return[t.newExperimentData,t.experimentData]},function(t,n){var a,r;if(n!=null&&n.start_date){var o;return(n==null||(o=n.parameters)===null||o===void 0?void 0:o.feature_flag_variants)||[]}return(t==null||(a=t.parameters)===null||a===void 0?void 0:a.feature_flag_variants)||(n==null||(r=n.parameters)===null||r===void 0?void 0:r.feature_flag_variants)||[]}],taxonomicGroupTypesForSelection:[function(t){return[t.newExperimentData,t.groupsTaxonomicTypes]},function(t,n){var a;return(t==null||(a=t.filters)===null||a===void 0?void 0:a.aggregation_group_type_index)!=null&&n.length>0?[n[t.filters.aggregation_group_type_index]]:[S.a.PersonProperties,S.a.Cohorts]}],parsedSecondaryMetrics:[function(t){return[t.newExperimentData,t.experimentData]},function(t,n){var a=(t==null?void 0:t.secondary_metrics)||(n==null?void 0:n.secondary_metrics)||[];return a}],minimumDetectableChange:[function(t){return[t.newExperimentData]},function(t){var n;return(t==null||(n=t.parameters)===null||n===void 0?void 0:n.minimum_detectable_effect)||5}],minimumSampleSizePerVariant:[function(t){return[t.minimumDetectableChange]},function(t){return function(n){return Math.ceil(1600*n*(1-n/100)/(t*t))}}],areResultsSignificant:[function(t){return[t.experimentResults]},function(t){return(t==null?void 0:t.significant)||!1}],significanceBannerDetails:[function(t){return[t.experimentResults]},function(t){if((t==null?void 0:t.significance_code)===u.E.HighLoss){var n;return e.a.createElement(e.a.Fragment,null,"This is because the expected loss in conversion is greater than 1%",e.a.createElement(ft.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(n=((t==null?void 0:t.expected_loss)||0)*100)===null||n===void 0?void 0:n.toFixed(2),"%")},e.a.createElement(xe.a,{style:{padding:"4px 2px"}})),".")}if((t==null?void 0:t.significance_code)===u.E.HighPValue){var a;return e.a.createElement(e.a.Fragment,null,"This is because the p value is greater than 0.05",e.a.createElement(ft.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(t==null||(a=t.p_value)===null||a===void 0?void 0:a.toFixed(3))||1,".")},e.a.createElement(xe.a,{style:{padding:"4px 2px"}})),".")}return(t==null?void 0:t.significance_code)===u.E.LowWinProbability?"This is because the win probability of all test variants combined is less than 90%.":(t==null?void 0:t.significance_code)===u.E.NotEnoughExposure?"This is because we need at least 100 people per variant to declare significance.":""}],recommendedExposureForCountData:[function(t){return[t.minimumDetectableChange]},function(t){return function(n){var a=n*t/100,r=n,o=a+n;return parseFloat((4/Math.pow(Math.sqrt(r/ye)-Math.sqrt(o/ye),2)).toFixed(1))}}],expectedRunningTime:[function(){return[]},function(){return function(t,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ye;return parseFloat((n/(t/a)).toFixed(1))}}],conversionRateForVariant:[function(t){return[t.experimentResults]},function(t){return function(n){var a="Can't find variant";if(!t)return a;var r=(t==null?void 0:t.insight).find(function(o){var d,c;return((d=o[0])===null||d===void 0||(c=d.breakdown_value)===null||c===void 0?void 0:c[0])===n});return r?(r[r.length-1].count/r[0].count*100).toFixed(1):a}}],getIndexForVariant:[function(t){return[t.experimentResults]},function(t){return function(n,a){if(!t)return 0;var r=-1;return a===u.s.FUNNELS?r=ae()(t==null?void 0:t.insight).sort(function(o,d){var c,s;return((c=d[0])===null||c===void 0?void 0:c.count)-((s=o[0])===null||s===void 0?void 0:s.count)}).findIndex(function(o){var d,c;return((d=o[0])===null||d===void 0||(c=d.breakdown_value)===null||c===void 0?void 0:c[0])===n}):r=(t==null?void 0:t.insight).findIndex(function(o){return o.breakdown_value===n}),r===-1?0:r}}],countDataForVariant:[function(t){return[t.experimentResults]},function(t){return function(n){var a="Can't find variant";if(!t)return a;var r=(t==null?void 0:t.insight).find(function(o){return o.breakdown_value===n});return r?r.count.toString():a}}],highestProbabilityVariant:[function(t){return[t.experimentResults]},function(t){if(t){var n=Math.max.apply(Math,ae()(Object.values(t.probability)));return Object.keys(t.probability).find(function(a){return Math.abs(t.probability[a]-n)<Number.EPSILON})}}],areTrendResultsConfusing:[function(t){return[t.experimentResults,t.highestProbabilityVariant]},function(t,n){if(!t)return!1;var a=(t==null?void 0:t.insight).reduce(function(r,o){return o.count>r.count?o:r},{count:0,breakdown_value:""});return a.count?a.breakdown_value!==n:!1}]},urlToAction:function(n){var a=n.actions,r=n.values,o=n.props;return{"/experiments/:id":function(c){var s=c.id;if(!r.hasAvailableFeature(u.c.EXPERIMENTATION)){Le.router.actions.push("/experiments");return}if(s){var p=s==="new"?"new":parseInt(s);p==="new"&&(a.createNewExperimentInsight(),a.resetNewExperiment(),a.setSecondaryMetrics([])),a.setEditExperiment(!1),p!=="new"&&p===o.experimentId&&a.loadExperiment()}}}}});function gt(t){var n=Math.round(100/t),a=n*t,r=a-100,o=new Array(t).fill(n);return o[t-1]=n-r,o}var Ge=i("./frontend/src/scenes/insights/InsightContainer.tsx"),me=i("./frontend/src/lib/components/icons.tsx"),Et=i("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),Qt=i("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),Re=i("./node_modules/@ant-design/icons/es/icons/CaretDownOutlined.js"),Zt=i("./node_modules/@ant-design/icons/es/icons/SaveOutlined.js"),ht=i("./node_modules/@ant-design/icons/es/icons/CloseOutlined.js"),qt=i("./frontend/src/lib/components/CopyToClipboard.tsx"),He=i("./frontend/src/lib/components/Spinner/Spinner.tsx"),xt=i("./frontend/src/scenes/funnels/funnelUtils.ts"),en=i("./node_modules/antd/es/modal/index.js"),yt=i("./frontend/src/lib/api.mock.ts");function bt(t,n){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,r)}return a}function de(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?bt(Object(a),!0).forEach(function(r){pe()(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):bt(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}var wt=14,Je={name:"",filters:{insight:u.s.TRENDS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}]}},tn={name:"",filters:{insight:u.s.FUNNELS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}],layout:ce.q.horizontal}},nn=Object(M.kea)({props:{},path:["scenes","experiment","secondaryMetricsLogic"],connect:{values:[ze.a,["currentTeamId"]]},actions:{setSecondaryMetrics:function(n){return{secondaryMetrics:n}},createNewMetric:!0,addNewMetric:function(n){return{metric:n}},updateMetricFilters:function(n){return{filters:n}},setFilters:function(n){return{filters:n}},setPreviewInsightId:function(n){return{shortId:n}},createPreviewInsight:function(n){return{filters:n}},showModal:!0,hideModal:!1,changeInsightType:function(n){return{type:n}},setCurrentMetricName:function(n){return{name:n}},deleteMetric:function(n){return{metricId:n}}},loaders:function(n){var a=n.values;return{experiments:[[],{loadExperiments:function(){var r=B()(O.a.mark(function d(){var c;return O.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,yt.c.get("api/projects/".concat(a.currentTeamId,"/experiments"));case 2:return c=p.sent,p.abrupt("return",c.results);case 4:case"end":return p.stop()}},d)}));function o(){return r.apply(this,arguments)}return o}()}]}},reducers:function(n){var a=n.props;return{previewInsightId:[null,{setPreviewInsightId:function(o,d){var c=d.shortId;return c}}],metrics:[a.initialMetrics,{addNewMetric:function(o,d){var c=d.metric;return[].concat(ae()(o),[de({},c)])},deleteMetric:function(o,d){var c=d.metricId;return o.filter(function(s,p){return p!==c})}}],modalVisible:[!1,{showModal:function(){return!0},hideModal:function(){return!1}}],currentMetricName:["",{setCurrentMetricName:function(o,d){var c=d.name;return c}}],currentMetric:[Je,{changeInsightType:function(o,d){var c=d.type;return c===u.s.TRENDS?Je:o.filters.insight===u.s.TRENDS?tn:Je},updateMetricFilters:function(o,d){var c=d.filters;return de(de({},o),{},{filters:c})}}]}},listeners:function(n){var a=n.actions,r=n.values,o=n.props;return{createPreviewInsight:function(){var d=B()(O.a.mark(function s(p){var m,b,v,I;return O.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return m=p.filters,(m==null?void 0:m.insight)===u.s.FUNNELS?b=Object(Pe.a)(de({insight:u.s.FUNNELS,funnel_viz_type:u.o.Steps,display:u.d.FunnelViz,date_from:Object(T.a)().subtract(wt,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:ce.q.horizontal},m)):b=Object(Pe.a)(de({insight:u.s.TRENDS,date_from:Object(T.a)().subtract(wt,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},m)),v={name:pt(),description:"",tags:[],filters:b,result:null},f.next=5,yt.c.create("api/projects/".concat(ze.a.values.currentTeamId,"/insights"),v);case 5:I=f.sent,a.setPreviewInsightId(I.short_id);case 7:case"end":return f.stop()}},s)}));function c(s){return d.apply(this,arguments)}return c}(),setFilters:function(c){var s=c.filters;if(s.insight===u.s.FUNNELS){var p;(p=P.a.findMounted({dashboardItemId:r.previewInsightId}))===null||p===void 0||p.actions.setFilters(s)}else{var m;(m=Ke.a.findMounted({dashboardItemId:r.previewInsightId}))===null||m===void 0||m.actions.setFilters(s)}},createNewMetric:function(){a.addNewMetric(de(de({},r.currentMetric),{},{name:r.currentMetricName})),o.onMetricsChange(r.metrics),a.changeInsightType(u.s.TRENDS),a.setCurrentMetricName("")},deleteMetric:function(){o.onMetricsChange(r.metrics)},changeInsightType:function(){return a.createPreviewInsight(r.currentMetric.filters)}}},events:function(n){var a=n.actions;return{afterMount:function(){a.createPreviewInsight()}}}});function Nt(t,n){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,r)}return a}function re(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?Nt(Object(a),!0).forEach(function(r){pe()(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Nt(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function _e(t){var n=t.onMetricsChange,a=t.initialMetrics,r=nn({onMetricsChange:n,initialMetrics:a}),o=Object(M.useValues)(r),d=o.previewInsightId,c=o.metrics,s=o.modalVisible,p=o.currentMetric,m=Object(M.useActions)(r),b=m.createNewMetric,v=m.updateMetricFilters,I=m.setFilters,h=m.showModal,f=m.hideModal,l=m.changeInsightType,z=m.setCurrentMetricName,X=m.deleteMetric,ee=Object(M.useValues)(Object(k.b)({dashboardItemId:d,syncWithUrl:!1})),ue=ee.insightProps,x=Object(M.useValues)(Object(P.a)(ue)),ie=x.isStepsEmpty,se=x.filterSteps;return e.a.createElement(e.a.Fragment,null,e.a.createElement(en.a,{title:"Add secondary metric",visible:s,destroyOnClose:!0,onCancel:f,onOk:function(){b(),f()},okText:"Save",style:{minWidth:600}},e.a.createElement(_.a,{layout:"vertical",initialValues:{name:"",type:u.s.TRENDS},onValuesChange:function(D){D.name&&z(D.name)}},e.a.createElement(_.a.Item,{name:"name",label:"Name"},e.a.createElement(ne.a,null)),e.a.createElement(_.a.Item,{name:"type",label:"Type"},e.a.createElement(R.a,{style:{display:"flex"},value:p.filters.insight,onChange:function(){l()},suffixIcon:e.a.createElement(Re.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(R.a.Option,{value:u.s.TRENDS},e.a.createElement(g.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(R.a.Option,{value:u.s.FUNNELS},e.a.createElement(g.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel")))))),e.a.createElement(_.a.Item,{name:"query",label:"Query"},e.a.createElement(Q.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},p.filters.insight===u.s.FUNNELS&&e.a.createElement(A.a,{filters:p.filters,setFilters:function(D){var K=re(re({},p.filters),{},{insight:u.s.FUNNELS},D);v(K),I(K)},typeKey:"funnel-preview-metric",hideMathSelector:!0,hideDeleteBtn:se.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!ie,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[S.a.EventProperties,S.a.PersonProperties,S.a.Cohorts,S.a.Elements],rowClassName:"action-filters-bordered"}),p.filters.insight===u.s.TRENDS&&e.a.createElement(A.a,{entitiesLimit:1,horizontalUI:!0,filters:p.filters,setFilters:function(D){var K=re(re({},p.filters),{},{insight:u.s.TRENDS},D);v(K),I(K)},typeKey:"trend-preview-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[S.a.EventProperties,S.a.PersonProperties,S.a.Cohorts,S.a.Elements]}))),e.a.createElement(_.a.Item,{name:"metric-preview",label:"Metric preview"},e.a.createElement(M.BindLogic,{logic:k.b,props:ue},e.a.createElement(Ge.a,{disableHeader:!0,disableTable:!0}))))),e.a.createElement(E.a,null,e.a.createElement(g.a,null,c.map(function(j,D){return e.a.createElement(E.a,{key:D,className:"mt"},e.a.createElement(E.a,{align:"middle",className:"full-width border-all",style:{padding:8}},e.a.createElement("div",{style:{fontWeight:500}},"Name")," ",e.a.createElement("div",{className:"metric-name"},j.name?j.name:"".concat(j.filters.insight," metric")),e.a.createElement(Et.a,{className:"text-danger",style:{padding:8},onClick:function(){return X(D)}})),e.a.createElement(Q.a,{className:"full-width",style:{borderTop:"none"},bodyStyle:{padding:0}},j.filters.insight===u.s.FUNNELS&&e.a.createElement(A.a,{filters:j.filters,setFilters:function(te){var U=re(re({},j.filters),{},{insight:u.s.FUNNELS},te);v(U),I(U)},typeKey:"funnel-preview-".concat(D),hideMathSelector:!0,hideDeleteBtn:se.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!ie,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[S.a.EventProperties,S.a.PersonProperties,S.a.Cohorts,S.a.Elements],rowClassName:"action-filters-bordered",readOnly:!0}),j.filters.insight===u.s.TRENDS&&e.a.createElement(A.a,{horizontalUI:!0,filters:j.filters,setFilters:function(te){var U=re(re({},j.filters),{},{insight:u.s.TRENDS},te);v(U),I(U)},typeKey:"trend-preview-".concat(D),buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[S.a.EventProperties,S.a.PersonProperties,S.a.Cohorts,S.a.Elements],readOnly:!0})))}),c&&!(c.length>2)&&e.a.createElement(g.a,null,e.a.createElement("div",{className:"mb-05 mt"},e.a.createElement(J.a,{style:{color:"var(--primary)",minWidth:240},onClick:h},"Add metric"))))))}try{_e.displayName="SecondaryMetrics",_e.__docgenInfo={description:"",displayName:"SecondaryMetrics",props:{onMetricsChange:{defaultValue:null,description:"",name:"onMetricsChange",required:!0,type:{name:"(metrics: SecondaryExperimentMetric[]) => void"}},initialMetrics:{defaultValue:null,description:"",name:"initialMetrics",required:!0,type:{name:"SecondaryExperimentMetric[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"]={docgenInfo:_e.__docgenInfo,name:"SecondaryMetrics",path:"frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"})}catch(t){}var jt=i("./frontend/src/lib/colors.ts"),an=i("./frontend/src/lib/components/EntityFilterInfo.tsx"),rn=i("./frontend/src/lib/components/EditableField/EditableField.tsx"),sn=i("./frontend/src/lib/components/Link.tsx"),ln=i("./frontend/src/lib/logic/featureFlagLogic.ts"),on=i("./node_modules/antd/es/slider/index.js"),cn=i("./node_modules/antd/es/input-number/index.js"),mn=i("./frontend/src/lib/components/InsightLabel/index.tsx"),St=i("./frontend/src/lib/components/PropertyFilters/components/PropertyFilterButton.tsx");function dn(){var t=Object(Y.useState)(!1),n=H()(t,2),a=n[0],r=n[1],o=Object(Y.useState)(!1),d=H()(o,2),c=d[0],s=d[1];return e.a.createElement(Q.a,{className:"experiment-workflow",title:e.a.createElement("span",{className:"card-secondary"},"Experiment workflow")},e.a.createElement(E.a,null,e.a.createElement(g.a,{className:"exp-workflow-step step-completed full-width"},e.a.createElement(E.a,{align:"middle"},e.a.createElement(me.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}),e.a.createElement("b",{className:"ml-05"},"Create experiment")),e.a.createElement("div",{className:"ml-2"},"Set variants, select participants, and add secondary metrics"))),e.a.createElement(E.a,null,e.a.createElement(g.a,{className:"full-width exp-workflow-step ".concat(a?"step-completed":""),onClick:function(){return r(!a)}},e.a.createElement(E.a,{align:"middle"},a?e.a.createElement(me.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(me.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-05"},"Validate experiment")),e.a.createElement("div",{className:"ml-2"},"Once you've written your code, it's a good idea to test that each variant behaves as you'd expect."))),e.a.createElement(E.a,null,e.a.createElement(g.a,{className:"full-width exp-workflow-step ".concat(c?"step-completed":""),onClick:function(){return s(!c)}},e.a.createElement(E.a,{align:"middle"},c?e.a.createElement(me.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(me.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-05"},"Launch experiment")),e.a.createElement("div",{className:"ml-2"},"Run your experiment, monitor results, and decide when to terminate your experiment."))))}function we(t){var n,a,r,o,d,c,s=t.experiment,p=t.trendCount,m=t.funnelConversionRate,b=t.trendExposure,v=t.funnelSampleSize,I=t.funnelEntrants,h=(s==null?void 0:s.id)||"new",f=Object(M.useValues)(be({experimentId:h})),l=f.experimentInsightType,z=f.editingExistingExperiment,X=f.minimumDetectableChange,ee=f.expectedRunningTime,ue=f.aggregationLabel,x=Object(M.useActions)(be({experimentId:h})),ie=x.setNewExperimentData,se=l===u.s.FUNNELS&&100-m<50?100-m:50,j=Object(T.a)().diff(Object(T.a)(s==null?void 0:s.start_date),"hour"),D=0;s!=null&&s.start_date?D=ee(I||1,v||0,j):D=ee(I||1,v||0);var K=Object(T.a)(s==null?void 0:s.start_date).add(D,"hour"),te=!(s!=null&&s.end_date)&&j>=24&&I&&v,U=Object($.s)(s==null||(n=s.filters)===null||n===void 0?void 0:n.properties);return e.a.createElement(E.a,null,e.a.createElement(g.a,{span:!(s!=null&&s.start_date)&&h!=="new"&&!z?12:24},h==="new"&&e.a.createElement(E.a,{className:"experiment-preview-row"},e.a.createElement("div",null,e.a.createElement("div",null,e.a.createElement("b",null,"Experiment preview")),e.a.createElement("div",{className:"text-muted"},"Here are the baseline metrics for your experiment. Adjust your minimum detectible threshold to adjust for the smallest conversion value you\u2019ll accept, and the experiment duration."," "))),(h==="new"||z)&&e.a.createElement(E.a,{className:"mb"},e.a.createElement(g.a,{span:24},e.a.createElement("div",null,e.a.createElement("b",null,"Minimum acceptable improvement"),e.a.createElement(fe.a,{title:"Minimum acceptable improvement is a calculation that estimates the smallest significant improvement you are willing to accept."},e.a.createElement(xe.a,{style:{marginLeft:4}}))),e.a.createElement(E.a,{className:"mde-slider"},e.a.createElement(g.a,{span:8},e.a.createElement(on.a,{defaultValue:5,value:X,min:1,max:se,trackStyle:{background:"var(--primary)"},handleStyle:{background:"var(--primary)"},onChange:function(L){ie({parameters:{minimum_detectable_effect:L}})},tipFormatter:function(L){return"".concat(L,"%")}})),e.a.createElement(cn.a,{min:1,max:se,defaultValue:5,formatter:function(L){return"".concat(L,"%")},style:{margin:"0 16px"},value:X,onChange:function(L){ie({parameters:{minimum_detectable_effect:L}})}})))),e.a.createElement(E.a,{className:"experiment-preview-row ".concat(s!=null&&s.start_date?"mr":"")},l===u.s.TRENDS?e.a.createElement(e.a.Fragment,null,!(s!=null&&s.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Baseline Count"),e.a.createElement("div",{className:"l4"},p)),e.a.createElement(g.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Count"),e.a.createElement("div",{className:"l4"},p+Math.ceil(p*(X/100))))),e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",b)," days"))):e.a.createElement(e.a.Fragment,null,!(s!=null&&s.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Baseline Conversion Rate"),e.a.createElement("div",{className:"l4"},m.toFixed(1),"%")),e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Conversion Rate"),e.a.createElement("div",{className:"l4"},(m+X).toFixed(1),"%"))),e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended Sample Size"),e.a.createElement("div",{className:"pb"},e.a.createElement("span",{className:"l4"},"~",v)," persons")),!(s!=null&&s.start_date)&&e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",D)," days"))),e.a.createElement(E.a,{className:"full-width mt"},e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Experiment variants"),e.a.createElement("ul",{className:"variants-list"},s==null||(a=s.parameters)===null||a===void 0||(r=a.feature_flag_variants)===null||r===void 0?void 0:r.map(function(C,L){return e.a.createElement("li",{key:L},C.key)}))),e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Participants"),e.a.createElement("div",null,U!=null&&U.length?e.a.createElement("div",null,U==null?void 0:U.map(function(C){return e.a.createElement(St.c,{key:C.key,item:C})})):e.a.createElement(e.a.Fragment,null,"100% of"," ",(s==null||(o=s.filters)===null||o===void 0?void 0:o.aggregation_group_type_index)!=null?Object($.j)(ue(s.filters.aggregation_group_type_index).plural):"users")))),e.a.createElement(E.a,null,h!=="new"&&!z&&e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{className:"mr"},e.a.createElement("div",{className:"card-secondary mt"},"Start date"),s!=null&&s.start_date?e.a.createElement("span",null,Object(T.a)(s==null?void 0:s.start_date).format("D MMM YYYY")):e.a.createElement("span",{className:"description"},"Not started yet")),l===u.s.FUNNELS&&te?e.a.createElement(g.a,{className:"mr"},e.a.createElement("div",{className:"card-secondary mt"},"Expected end date"),e.a.createElement("span",null,K.isAfter(Object(T.a)())?K.format("D MMM YYYY"):Object(T.a)().format("D MMM YYYY"))):null),(s==null?void 0:s.end_date)&&e.a.createElement(g.a,{className:"ml"},e.a.createElement("div",{className:"card-secondary mt"},"Completed date"),e.a.createElement("span",null,Object(T.a)(s==null?void 0:s.end_date).format("D MMM YYYY"))))),h!=="new"&&!z&&e.a.createElement(E.a,{className:"experiment-preview-row"},e.a.createElement(g.a,null,e.a.createElement("div",{className:"card-secondary mb-05"},l===u.s.FUNNELS?"Conversion goal steps":"Trend goal"),[].concat(ae()((s==null||(d=s.filters)===null||d===void 0?void 0:d.events)||[]),ae()((s==null||(c=s.filters)===null||c===void 0?void 0:c.actions)||[])).sort(function(C,L){return(C.order||0)-(L.order||0)}).map(function(C,L){var Se;return e.a.createElement(g.a,{key:L,className:"mb-05"},e.a.createElement(E.a,{style:{marginBottom:4}},e.a.createElement("div",{className:"preview-conversion-goal-num"},l===u.s.FUNNELS?(C.order||0)+1:L+1),e.a.createElement("b",null,e.a.createElement(mn.b,{action:C,showCountedByTag:l===u.s.TRENDS,hideIcon:!0}))),(Se=C.properties)===null||Se===void 0?void 0:Se.map(function(ke){return e.a.createElement(St.c,{key:ke.key,item:ke})}))})))),h!=="new"&&!z&&!(s!=null&&s.start_date)&&e.a.createElement(g.a,{span:12,className:"pl"},e.a.createElement(dn,null)))}try{we.displayName="ExperimentPreview",we.__docgenInfo={description:"",displayName:"ExperimentPreview",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}},trendCount:{defaultValue:null,description:"",name:"trendCount",required:!0,type:{name:"number"}},trendExposure:{defaultValue:null,description:"",name:"trendExposure",required:!1,type:{name:"number"}},funnelSampleSize:{defaultValue:null,description:"",name:"funnelSampleSize",required:!1,type:{name:"number"}},funnelConversionRate:{defaultValue:null,description:"",name:"funnelConversionRate",required:!0,type:{name:"number"}},funnelEntrants:{defaultValue:null,description:"",name:"funnelEntrants",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"]={docgenInfo:we.__docgenInfo,name:"ExperimentPreview",path:"frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"})}catch(t){}var Ae=i("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx");function Ne(t){var n,a,r,o=t.experiment,d=Object(Y.useState)("control"),c=H()(d,2),s=c[0],p=c[1];return e.a.createElement(Q.a,{title:e.a.createElement("span",{className:"card-secondary"},"Feature flag usage and implementation"),className:"experiment-implementation-details"},e.a.createElement(E.a,{justify:"space-between",className:"mb-05"},e.a.createElement("div",null,e.a.createElement("span",{className:"mr-05"},"Variant group"),e.a.createElement(R.a,{onChange:p,defaultValue:"control",suffixIcon:e.a.createElement(Re.a,null)},o==null||(n=o.parameters)===null||n===void 0||(a=n.feature_flag_variants)===null||a===void 0?void 0:a.map(function(m,b){return e.a.createElement(R.a.Option,{key:b,value:m.key},m.key)}))),e.a.createElement("div",null,e.a.createElement(Ot,null))),e.a.createElement("b",null,"Implement your experiment in code"),e.a.createElement(Ae.a,{language:Ae.b.JavaScript,wrap:!0},"if (posthog.getFeatureFlag('".concat((r=o==null?void 0:o.feature_flag_key)!==null&&r!==void 0?r:"","') === '").concat(s,`') {
    // where '`).concat(s,`' is the variant, run your code here
}`)),e.a.createElement("b",null,"Test that it works"),e.a.createElement(Ae.a,{language:Ae.b.JavaScript},"posthog.feature_flags.override({'".concat(o==null?void 0:o.feature_flag_key,"': '").concat(s,"'})")),e.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://posthog.com/docs/user-guides/feature-flags"},e.a.createElement(E.a,{align:"middle"},"Experiment implementation guide",e.a.createElement(me.IconOpenInNew,{className:"ml-05"}))))}try{Ne.displayName="ExperimentImplementationDetails",Ne.__docgenInfo={description:"",displayName:"ExperimentImplementationDetails",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"]={docgenInfo:Ne.__docgenInfo,name:"ExperimentImplementationDetails",path:"frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"})}catch(t){}function It(t,n){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,r)}return a}function Xe(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?It(Object(a),!0).forEach(function(r){pe()(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):It(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}var un={component:je,logic:be,paramsToProps:function(n){var a=n.params.id;return{experimentId:a==="new"?"new":parseInt(a)}}};function je(){var t,n,a,r,o,d,c,s,p,m,b,v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},I=v.id,h=Object(M.useValues)(be({experimentId:I})),f=h.newExperimentData,l=h.experimentData,z=h.experimentInsightId,X=h.minimumSampleSizePerVariant,ee=h.recommendedExposureForCountData,ue=h.variants,x=h.experimentResults,ie=h.countDataForVariant,se=h.editingExistingExperiment,j=h.experimentInsightType,D=h.experimentResultsLoading,K=h.parsedSecondaryMetrics,te=h.areResultsSignificant,U=h.conversionRateForVariant,C=h.getIndexForVariant,L=h.significanceBannerDetails,Se=h.areTrendResultsConfusing,ke=h.taxonomicGroupTypesForSelection,pn=h.groupTypes,fn=h.aggregationLabel,Qe=h.secondaryMetricResults,vn=h.experimentDataLoading,W=Object(M.useActions)(be({experimentId:I})),Ie=W.setNewExperimentData,gn=W.createExperiment,En=W.launchExperiment,Ue=W.setFilters,hn=W.setEditExperiment,xn=W.endExperiment,yn=W.addExperimentGroup,bn=W.updateExperiment,wn=W.updateExperimentGroup,Nn=W.removeExperimentGroup,jn=W.setSecondaryMetrics,Sn=W.setExperimentInsightType,In=W.archiveExperiment,On=Object(M.useValues)(ln.a),Ze=On.featureFlags,Tn=_.a.useForm(),Mn=H()(Tn,1),Dn=Mn[0],Cn=Object(Y.useState)(!0),Tt=H()(Cn,2),qe=Tt[0],et=Tt[1],Fn=Object(M.useValues)(Object(k.b)({dashboardItemId:z})),tt=Fn.insightProps,Oe=Object(M.useValues)(Object(P.a)(tt)),Pn=Oe.isStepsEmpty,Ln=Oe.filterSteps,Mt=Oe.filters,nt=Oe.results,Rn=Oe.conversionMetrics,Dt=Object(M.useValues)(Object(Ke.a)(tt)),at=Dt.filters,_n=Dt.results,rt=Rn.totalRate*100,An=X(rt),Ct=An*ue.length,it=(t=_n[0])===null||t===void 0?void 0:t.count,Ft=nt==null||(n=nt[0])===null||n===void 0?void 0:n.count,Pt=ee(it),Ye=j===u.s.FUNNELS&&(x==null?void 0:x.insight)?x.insight.reduce(function(w,N){var F;return((F=N[0])===null||F===void 0?void 0:F.count)+w},0):0,kn=j===u.s.FUNNELS?(Ye||0)/((l==null||(a=l.parameters)===null||a===void 0?void 0:a.recommended_sample_size)||1)*100:Object(T.a)().diff(l==null?void 0:l.start_date,"day")/((l==null||(r=l.parameters)===null||r===void 0?void 0:r.recommended_running_time)||1)*100,Un={running:"green",draft:"default",complete:"purple"},Lt=function(){if(l!=null&&l.start_date){if(!(l!=null&&l.end_date))return"running"}else return"draft";return"complete"};return e.a.createElement(e.a.Fragment,null,I==="new"||se?e.a.createElement(e.a.Fragment,null,e.a.createElement(E.a,{align:"middle",justify:"space-between",style:{borderBottom:"1px solid var(--border)",marginBottom:"1rem",paddingBottom:8}},e.a.createElement(Fe.a,{title:"New Experiment"})),e.a.createElement(_.a,{name:"new-experiment",layout:"vertical",className:"experiment-form",form:Dn,onValuesChange:function(N){return Ie(N)},initialValues:{name:f==null?void 0:f.name,feature_flag_key:f==null?void 0:f.feature_flag_key,description:f==null?void 0:f.description},onFinish:function(){return gn(!0,Pt,Ct)},requiredMark:!1,scrollToFirstError:!0},e.a.createElement("div",null,e.a.createElement(M.BindLogic,{logic:k.b,props:tt},e.a.createElement(E.a,null,e.a.createElement(g.a,{span:12,style:{paddingRight:24}},e.a.createElement(E.a,{className:"full-width"},e.a.createElement(_.a.Item,{label:"Name",name:"name",rules:[{required:!0,message:"You have to enter a name."}]},e.a.createElement(ne.a,{"data-attr":"experiment-name",className:"ph-ignore-input"})),e.a.createElement(_.a.Item,{style:{paddingLeft:16},label:e.a.createElement("div",null,"Feature flag key"," ",e.a.createElement(fe.a,{title:"Enter a unique key. This will create a new feature flag which will be associated with this experiment."},e.a.createElement(xe.a,null))),name:"feature_flag_key",rules:[{required:!0,message:"You have to enter a feature flag key name."}]},e.a.createElement(ne.a,{"data-attr":"experiment-feature-flag-key",disabled:se}))),e.a.createElement(_.a.Item,{label:e.a.createElement("div",null,"Description ",e.a.createElement("span",{className:"text-muted"},"(optional)")),name:"description"},e.a.createElement(ne.a.TextArea,{"data-attr":"experiment-description",className:"ph-ignore-input",placeholder:"Adding a helpful description can ensure others know what this experiment is about."})),(f==null||(o=f.parameters)===null||o===void 0?void 0:o.feature_flag_variants)&&e.a.createElement(g.a,null,e.a.createElement("label",null,e.a.createElement("b",null,"Experiment variants")),e.a.createElement("div",{className:"text-muted"},"Participants are divided into variant groups evenly. All experiments must consist of a control group and at least one test group. Experiments may have at most 3 test groups."),e.a.createElement(g.a,{className:"variants"},f.parameters.feature_flag_variants.map(function(w,N){return e.a.createElement(_.a,{key:"".concat(w,"-").concat(N),initialValues:{key:w.key},onValuesChange:function(G){wn(G,N)},validateTrigger:["onChange","onBlur"]},e.a.createElement(E.a,{className:"feature-flag-variant"},e.a.createElement(_.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}]},e.a.createElement(ne.a,{disabled:N===0,"data-attr":"feature-flag-variant-key","data-key-index":N.toString(),className:"ph-ignore-input",style:{minWidth:300},placeholder:"example-variant-".concat(N+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),e.a.createElement("div",{className:"float-right"},!(N===0||N===1)&&e.a.createElement(fe.a,{title:"Delete this variant",placement:"bottomLeft"},e.a.createElement(J.a,{type:"link",icon:e.a.createElement(Et.a,null),onClick:function(){return Nn(N)},style:{color:"var(--danger)",float:"right"}})))))}),f.parameters.feature_flag_variants.length<4&&e.a.createElement("div",null,e.a.createElement(J.a,{style:{color:"var(--primary)",border:"none",boxShadow:"none",marginTop:"2rem",paddingLeft:0},icon:e.a.createElement(Qt.a,null),onClick:function(){return yn()}},"Add test variant")))),e.a.createElement(E.a,{className:"person-selection"},e.a.createElement("span",null,e.a.createElement("b",null,"Select Participants")),e.a.createElement("span",null,e.a.createElement("b",null,"Participant Type"),e.a.createElement(R.a,{value:(f==null||(d=f.filters)===null||d===void 0?void 0:d.aggregation_group_type_index)!=null?f.filters.aggregation_group_type_index:-1,onChange:function(N){var F,G=N!==-1?N:void 0;G!=(f==null||(F=f.filters)===null||F===void 0?void 0:F.aggregation_group_type_index)&&(Ue({properties:[],aggregation_group_type_index:G}),Ie({filters:{aggregation_group_type_index:G,properties:[]}}))},style:{marginLeft:8},"data-attr":"participant-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]}},e.a.createElement(R.a.Option,{key:-1,value:-1},"Users"),pn.map(function(w){return e.a.createElement(R.a.Option,{key:w.group_type_index,value:w.group_type_index},Object($.j)(fn(w.group_type_index).plural))}))),e.a.createElement(g.a,null,e.a.createElement("div",{className:"text-muted"},"Select the entities who will participate in this experiment. If no filters are set, 100% of participants will be targeted."),e.a.createElement(ve.a,{pageKey:"experiment-participants-property",propertyFilters:j===u.s.FUNNELS?Object($.s)(Mt.properties):Object($.s)(at.properties),onChange:function(N){Ie({filters:{properties:N}}),Ue({properties:N.filter(q.b)})},style:{marginTop:"1rem"},taxonomicGroupTypes:ke}))),e.a.createElement(E.a,{className:"metrics-selection"},e.a.createElement(g.a,{style:{paddingRight:8}},e.a.createElement("div",{className:"mb-05"},e.a.createElement("b",null,"Goal type"),e.a.createElement("div",{className:"text-muted"},j===u.s.TRENDS?"Track counts of a specific event or action":"Track how many persons complete a sequence of actions and or events")),e.a.createElement(R.a,{style:{display:"flex"},value:j,onChange:Sn,suffixIcon:e.a.createElement(Re.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(R.a.Option,{value:u.s.TRENDS},e.a.createElement(g.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(R.a.Option,{value:u.s.FUNNELS},e.a.createElement(g.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel"))))),e.a.createElement("div",{className:"mb mt"},e.a.createElement("b",null,"Experiment goal"),j===u.s.TRENDS&&e.a.createElement("div",{className:"text-muted"},"Trend-based experiments can have at most one graph series. This metric is used to track the progress of your experiment.")),e.a.createElement(E.a,null,e.a.createElement(Q.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},j===u.s.FUNNELS&&e.a.createElement(A.a,{filters:Mt,setFilters:function(N){Ie({filters:N}),Ue(N)},typeKey:"EditFunnel-action",hideMathSelector:!0,hideDeleteBtn:Ln.length===1,buttonCopy:"Add funnel step",buttonType:"link",showSeriesIndicator:!Pn,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[S.a.EventProperties,S.a.PersonProperties,S.a.Cohorts,S.a.Elements],rowClassName:"action-filters-bordered"}),j===u.s.TRENDS&&e.a.createElement(A.a,{horizontalUI:!0,filters:at,setFilters:function(N){Ie({filters:N}),Ue(N)},typeKey:"experiment-trends",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[S.a.EventProperties,S.a.PersonProperties,S.a.Cohorts,S.a.Elements],customRowPrefix:at.insight===u.s.LIFECYCLE?e.a.createElement(e.a.Fragment,null,"Showing ",e.a.createElement("b",null,"Unique users")," who did"):void 0}))))),Ze[ce.o.EXPERIMENTS_SECONDARY_METRICS]&&e.a.createElement(E.a,{className:"mt"},e.a.createElement(g.a,null,e.a.createElement("div",null,e.a.createElement("b",null,"Secondary metrics"),e.a.createElement("span",{className:"text-muted ml-05"},"(optional)")),e.a.createElement("div",{className:"text-muted",style:{marginTop:4}},"Use secondary metrics to monitor metrics related to your experiment goal. You can add up to three secondary metrics."," ")),e.a.createElement(_e,{onMetricsChange:function(N){return jn(N)},initialMetrics:K}))),e.a.createElement(g.a,{span:12},e.a.createElement(Q.a,{className:"experiment-preview"},e.a.createElement(we,{experiment:f,trendCount:it,trendExposure:Pt,funnelSampleSize:Ct,funnelEntrants:Ft,funnelConversionRate:rt}),e.a.createElement(Ge.a,{disableHeader:j===u.s.TRENDS,disableTable:!0})))))),e.a.createElement(J.a,{icon:e.a.createElement(Zt.a,null),className:"float-right",type:"primary",htmlType:"submit"},"Save"))):!vn&&l?e.a.createElement("div",{className:"view-experiment"},e.a.createElement(E.a,{className:"draft-header"},e.a.createElement(E.a,{justify:"space-between",align:"middle",className:"full-width pb"},e.a.createElement(g.a,null,e.a.createElement(E.a,null,e.a.createElement(Fe.a,{style:{margin:0,paddingRight:8},title:"".concat(l==null?void 0:l.name)}),e.a.createElement(qt.a,{explicitValue:l.feature_flag_key,iconStyle:{color:"var(--text-muted-alt)"}},e.a.createElement("span",{className:"text-muted"},l.feature_flag_key)),e.a.createElement(le.a,{style:{alignSelf:"center",marginLeft:"1rem"},color:Un[Lt()]},e.a.createElement("b",{className:"uppercase"},Lt())),x&&l.end_date&&e.a.createElement(le.a,{style:{alignSelf:"center"},color:te?"green":"geekblue"},e.a.createElement("b",{className:"uppercase"},te?"Significant Results":"Results not significant"))),e.a.createElement("span",{className:"exp-description"},l.start_date?e.a.createElement(rn.a,{multiline:!0,name:"description",value:l.description||"",placeholder:"Description (optional)",onSave:function(N){return bn({description:N})},maxLength:400,"data-attr":"experiment-description",compactButtons:!0}):e.a.createElement(e.a.Fragment,null,l.description||"There is no description for this experiment."))),l&&!l.start_date&&e.a.createElement("div",null,e.a.createElement(J.a,{className:"mr-05",onClick:function(){return hn(!0)}},"Edit"),e.a.createElement(J.a,{type:"primary",onClick:function(){return En()}},"Launch")),l&&l.start_date&&!l.end_date&&e.a.createElement(J.a,{className:"stop-experiment",onClick:function(){return xn()}},"Stop experiment"),(l==null?void 0:l.end_date)&&Object(T.a)().isSameOrAfter(Object(T.a)(l.end_date),"day")&&!l.archived&&e.a.createElement(J.a,{className:"archive-experiment",onClick:function(){return In()}},e.a.createElement("b",null,"Archive experiment")))),e.a.createElement(E.a,null,qe&&x&&te&&!l.end_date&&e.a.createElement(E.a,{align:"middle",className:"significant-results"},e.a.createElement(g.a,{span:19,style:{color:"#497342"}},"Your results are ",e.a.createElement("b",null,"statistically significant"),"."," ",l.end_date?"":"You can end this experiment now or let it run to completion."),e.a.createElement(g.a,{span:5},e.a.createElement(J.a,{style:{color:"#497342"},onClick:function(){return et(!1)}},"Dismiss"))),qe&&x&&!te&&!l.end_date&&e.a.createElement(E.a,{align:"middle",className:"not-significant-results"},e.a.createElement(g.a,{span:23,style:{color:"#2D2D2D"}},e.a.createElement("b",null,"Your results are not statistically significant"),". ",L," ",l!=null&&l.end_date?"":"We don't recommend ending this experiment yet."," ","See our"," ",e.a.createElement("a",{href:"https://posthog.com/docs/user-guides/experimentation#funnel-experiment-calculations"}," ","experimentation guide"," "),"for more information."," "),e.a.createElement(g.a,{span:1},e.a.createElement(ht.a,{className:"close-button",onClick:function(){return et(!1)}}))),qe&&l.end_date&&e.a.createElement(E.a,{align:"middle",className:"feature-flag-mods"},e.a.createElement(g.a,{span:23},e.a.createElement("b",null,"Your experiment is complete.")," We recommend removing the feature flag from your code completely, instead of relying on this distribution:"," ",e.a.createElement(sn.a,{to:l.feature_flag?Ee.a.featureFlag(l.feature_flag):void 0},e.a.createElement("b",null,"Adjust feature flag distribution."))),e.a.createElement(g.a,{span:1},e.a.createElement(ht.a,{className:"close-button",onClick:function(){return et(!1)}})))),e.a.createElement(E.a,null,e.a.createElement(De.a,{className:"full-width",defaultActiveKey:"experiment-details"},e.a.createElement(De.a.Panel,{header:e.a.createElement("b",null,"Experiment details"),key:"experiment-details"},e.a.createElement(E.a,null,e.a.createElement(g.a,{span:l!=null&&l.start_date?12:24},e.a.createElement(we,{experiment:l,trendCount:it,trendExposure:l==null?void 0:l.parameters.recommended_running_time,funnelSampleSize:l==null?void 0:l.parameters.recommended_sample_size,funnelConversionRate:rt,funnelEntrants:l!=null&&l.start_date?Ye:Ft})),!x&&l.start_date&&e.a.createElement(g.a,{span:12},e.a.createElement(Ne,{experiment:l})),(x||((c=l.secondary_metrics)===null||c===void 0?void 0:c.length)>0)&&e.a.createElement(g.a,{className:"secondary-progress",span:l!=null&&l.start_date?12:24},Ze[ce.o.EXPERIMENTS_SECONDARY_METRICS]&&!!(l!=null&&l.secondary_metrics.length)&&e.a.createElement(g.a,{className:"border-bottom"},e.a.createElement(E.a,{align:"middle",justify:"space-between",className:"mb-05"},e.a.createElement("div",{className:"card-secondary"},"Secondary metrics"),l==null||(s=l.parameters)===null||s===void 0||(p=s.feature_flag_variants)===null||p===void 0?void 0:p.map(function(w,N){return e.a.createElement("li",{key:N,style:{color:"".concat(j===u.s.FUNNELS?Object(xt.k)(C(w.key,u.s.FUNNELS)+1):Object(jt.c)("white")[C(w.key,u.s.TRENDS)])},className:"pr"},e.a.createElement("span",{className:"text-default"},Object($.j)(w.key)))})),Ze[ce.o.EXPERIMENTS_SECONDARY_METRICS]&&(l.start_date?e.a.createElement(e.a.Fragment,null,l.secondary_metrics.map(function(w,N){var F,G;return e.a.createElement(E.a,{className:"border-top",key:N,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement("div",null,Object($.j)(w.name)),l==null||(F=l.parameters)===null||F===void 0||(G=F.feature_flag_variants)===null||G===void 0?void 0:G.map(function(Rt,st){return e.a.createElement("div",{key:st},Qe==null?void 0:Qe[N][Rt.key])}))})):e.a.createElement(e.a.Fragment,null,l.secondary_metrics.map(function(w,N){var F,G;return e.a.createElement(E.a,{className:"border-top",key:N,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement("div",null,Object($.j)(w.name)),l==null||(F=l.parameters)===null||F===void 0||(G=F.feature_flag_variants)===null||G===void 0?void 0:G.map(function(Rt,st){return e.a.createElement("div",{key:st},"--")}))})))),x&&e.a.createElement(g.a,{className:"mt"},e.a.createElement("div",{className:"mb-05"},e.a.createElement("b",null,"Experiment progress")),e.a.createElement(Ce.a,{strokeWidth:20,showInfo:!1,percent:kn,strokeColor:"var(--success)"}),j===u.s.TRENDS&&l.start_date&&e.a.createElement(E.a,{justify:"space-between",className:"mt-05"},l.end_date?e.a.createElement("div",null,"Ran for",e.a.createElement("b",null,Object(T.a)(l.end_date).diff(l.start_date,"day"))," ","days"):e.a.createElement("div",null,e.a.createElement("b",null,Object(T.a)().diff(l.start_date,"day"))," ","days running"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,l==null||(m=l.parameters)===null||m===void 0?void 0:m.recommended_running_time)," ","days")),j===u.s.FUNNELS&&e.a.createElement(E.a,{justify:"space-between",className:"mt-05"},l.end_date?e.a.createElement("div",null,"Saw ",e.a.createElement("b",null,Ye)," participants"):e.a.createElement("div",null,e.a.createElement("b",null,Ye)," participants seen"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,l==null||(b=l.parameters)===null||b===void 0?void 0:b.recommended_sample_size)," ","participants"))))))),!(l!=null&&l.start_date)&&e.a.createElement("div",{className:"mt full-width"},e.a.createElement(Ne,{experiment:l}))),e.a.createElement("div",{className:"experiment-result"},x?e.a.createElement(e.a.Fragment,null,e.a.createElement(E.a,{justify:"space-around",style:{flexFlow:"nowrap"}},Object.keys(x.probability).sort(function(w,N){return x.probability[N]-x.probability[w]}).map(function(w,N){return e.a.createElement(g.a,{key:N,className:"pr"},e.a.createElement("div",null,e.a.createElement("b",null,Object($.j)(w))),j===u.s.TRENDS?e.a.createElement(E.a,null,e.a.createElement("b",{style:{paddingRight:4}},e.a.createElement(E.a,null,"action"in x.insight[0]&&e.a.createElement(an.a,{filter:x.insight[0].action}),e.a.createElement("span",{style:{paddingLeft:4}},"count:")))," ",ie(w)," ",Se&&N===0&&e.a.createElement(fe.a,{placement:"right",title:"It might seem confusing that the best variant has lower absolute count, but this can happen when fewer people are exposed to this variant, so its relative count is higher."},e.a.createElement(xe.a,{style:{padding:"4px 2px"}}))):e.a.createElement(E.a,null,e.a.createElement("b",{style:{paddingRight:4}},"Conversion rate:")," ",U(w),"%"),e.a.createElement(Ce.a,{percent:Number((x.probability[w]*100).toFixed(1)),size:"small",showInfo:!1,strokeColor:j===u.s.FUNNELS?Object(xt.k)(C(w,u.s.FUNNELS)+1):Object(jt.c)("white")[C(w,u.s.TRENDS)]}),e.a.createElement("div",null,"Probability that this variant is the best:"," ",e.a.createElement("b",null,(x.probability[w]*100).toFixed(1),"%")))}))):D&&e.a.createElement("div",{className:"text-center"},e.a.createElement(He.a,null)),x?e.a.createElement(M.BindLogic,{logic:k.b,props:{dashboardItemId:x.itemID,cachedInsight:{short_id:x.itemID,filters:Xe(Xe(Xe({},x.filters),{},{insight:j,display:l.filters.display},j===u.s.FUNNELS&&{layout:ce.q.vertical,funnel_viz_type:u.o.Steps}),j===u.s.TRENDS&&{display:u.d.ActionsLineGraphCumulative}),result:x.insight},doNotLoad:!0}},e.a.createElement("div",{className:"mt"},e.a.createElement(Ge.a,{disableHeader:j===u.s.TRENDS,disableTable:j===u.s.FUNNELS}))):l.start_date&&e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"no-experiment-results"},D?e.a.createElement(He.a,null):e.a.createElement("div",{className:"text-center"},e.a.createElement("b",null,"There are no results for this experiment yet."),e.a.createElement("div",{className:"text-default"},"Double check your feature flag implementation if you're still not seeing results.")))))):e.a.createElement(He.a,null))}function Ot(){return e.a.createElement(R.a,{defaultValue:"JavaScript",suffixIcon:e.a.createElement(Re.a,null)},e.a.createElement(R.a.Option,{value:"JavaScript"},e.a.createElement(E.a,{align:"middle"},e.a.createElement(me.IconJavascript,{style:{marginRight:6}})," JavaScript")))}try{je.displayName="Experiment_",je.__docgenInfo={description:"",displayName:"Experiment_",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:'number | "new"'}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/Experiment.tsx#Experiment_"]={docgenInfo:je.__docgenInfo,name:"Experiment_",path:"frontend/src/scenes/experiments/Experiment.tsx#Experiment_"})}catch(t){}},"./frontend/src/scenes/experiments/experimentsLogic.ts":function(Te,Z,i){"use strict";i.d(Z,"a",function(){return M});var Me=i("./node_modules/core-js/modules/es.array.concat.js"),_t=i.n(Me),lt=i("./node_modules/core-js/modules/es.array.filter.js"),At=i.n(lt),ot=i("./node_modules/core-js/modules/es.array.iterator.js"),kt=i.n(ot),ct=i("./node_modules/core-js/modules/es.array.map.js"),Ut=i.n(ct),mt=i("./node_modules/core-js/modules/es.object.to-string.js"),Yt=i.n(mt),dt=i("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Vt=i.n(dt),Ve=i("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),pe=i.n(Ve),Be=i("./node_modules/@babel/runtime/regenerator/index.js"),H=i.n(Be),_=i("./node_modules/regenerator-runtime/runtime.js"),E=i.n(_),g=i("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ne=i.n(g),fe=i("./node_modules/kea/lib/index.esm.js"),J=i("./frontend/src/lib/api.mock.ts"),R=i("./frontend/src/scenes/teamLogic.ts"),Q=i("./frontend/src/types.ts"),le=i("./frontend/src/lib/utils.tsx"),De=i("./frontend/src/scenes/userLogic.ts"),Ce=i("./frontend/src/lib/components/lemonToast.tsx"),M=Object(fe.kea)({path:["scenes","experiments","experimentsLogic"],connect:{values:[R.a,["currentTeamId"],De.a,["hasAvailableFeature"]]},actions:{},loaders:function(ve){var q=ve.values,S=ve.actions;return{experiments:[[],{loadExperiments:function(){var Y=ne()(H.a.mark(function P(A){var k;return H.a.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(q.hasAvailableFeature(Q.c.EXPERIMENTATION)){V.next=2;break}return V.abrupt("return",[]);case 2:return V.next=4,J.c.get("api/projects/".concat(q.currentTeamId,"/experiments?").concat(A||""));case 4:return k=V.sent,V.abrupt("return",k.results);case 6:case"end":return V.stop()}},P)}));function e(P){return Y.apply(this,arguments)}return e}(),deleteExperiment:function(){var Y=ne()(H.a.mark(function P(A){return H.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,J.c.delete("api/projects/".concat(q.currentTeamId,"/experiments/").concat(A));case 2:return Ce.a.info("Experiment removed"),u.abrupt("return",q.experiments.filter(function(V){return V.id!==A}));case 4:case"end":return u.stop()}},P)}));function e(P){return Y.apply(this,arguments)}return e}(),addToExperiments:function(e){return[].concat(pe()(q.experiments),[e])},updateExperiments:function(e){return q.experiments.map(function(P){return P.id===e.id?e:P})}}],tab:[Q.h.All,{setExperimentsFilters:function(){var Y=ne()(H.a.mark(function P(A){var k,u;return H.a.wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return k=A.tab,u=k===Q.h.Yours?Object(le.Bb)({user:!0}):Object(le.Bb)({archived:!0}),k===Q.h.All?S.loadExperiments(Object(le.Bb)({all:!0})):S.loadExperiments(u),ge.abrupt("return",k);case 4:case"end":return ge.stop()}},P)}));function e(P){return Y.apply(this,arguments)}return e}()}]}},events:function(ve){var q=ve.actions;return{afterMount:function(){q.loadExperiments(Object(le.Bb)({all:!0}))}}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss":function(Te,Z,i){var Me=i("./node_modules/css-loader/dist/runtime/api.js");Z=Me(!1),Z.push([Te.i,'.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.experiment-form .metrics-selection{width:100%;border-top:1px solid rgba(0,0,0,.15);padding-top:1rem}.experiment-form .metrics-selection .action-filters-bordered .draggable-action-filter{border-bottom:1px solid rgba(0,0,0,.15);padding:1rem .25rem;margin-top:0}.experiment-form .metrics-selection .action-filters-bordered .row-action-btn{color:#35416b}.experiment-form .person-selection{width:100%;border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;margin-top:1rem;align-items:center;justify-content:space-between}.experiment-form .insights-graph-container{margin-bottom:1rem;background-color:#fff}.experiment-form .insights-graph-container .ant-card-head{border-bottom:1px solid rgba(0,0,0,.15);min-height:unset;background-color:#fff;padding-left:1rem;padding-right:1rem}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title{padding:.5rem 0}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter{font-size:14px}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter:not(:last-child),.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter span.head-title-item{margin-right:.5rem}.experiment-form .insights-graph-container .display-config-inner{display:flex;align-items:center;justify-content:space-between;overflow-x:auto}.experiment-form .insights-graph-container .ant-card-body{padding:0}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left{width:100%}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right{width:100%;height:min(calc(90vh - 16rem),36rem);max-width:300px;padding:0 1rem 1rem 0;display:flex;align-items:center}.experiment-form .insights-graph-container .graph-container{width:calc(100% - 48px);height:calc(100% - 48px);margin-top:2rem}.experiment-form .insights-graph-header{margin-top:0!important;margin-bottom:0!important;padding-left:1rem;padding-right:1rem;min-height:48px}.experiment-form .experiment-preview{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.experiment-form .experiment-preview .mde-slider .ant-slider-handle{border:none}.experiment-form .experiment-preview .mde-slider .ant-slider-rail{background-color:#e5ebff}.experiment-form .variants{border:1px solid rgba(0,0,0,.15);border-radius:4px;padding-left:1rem;margin-top:.5rem;margin-bottom:1rem;padding-bottom:1rem}.experiment-form .variants .ant-form-horizontal{min-height:32px}.experiment-form .variants .feature-flag-variant{margin-top:20px}.experiment-form .variants .feature-flag-variant .ant-form-item-explain{z-index:1}.experiment-form .variants .feature-flag-variant .ant-form-item-explain-error{padding-top:.5rem;padding-bottom:.5rem;background-color:#fff}.experiment-form .ant-input-number-disabled,.experiment-form .ant-input[disabled]{color:#000}.view-experiment .draft-header{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.view-experiment .stop-experiment{background-color:#f96132;color:#fff}.view-experiment .archive-experiment{color:#f96132}.view-experiment .exp-description{font-style:italic;color:rgba(0,0,0,.5)}.view-experiment .participants{background-color:#fff}.view-experiment .participants .ant-collapse-header{padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem}.view-experiment .variants-list{list-style:none;margin:0;padding:0}.view-experiment .variants-list li{display:inline}.view-experiment .variants-list li:after{content:", "}.view-experiment .variants-list li:last-child:after{content:""}.view-experiment .experiment-result{padding-top:1rem}.view-experiment .significant-results{padding:.5rem;width:100%;background:rgba(119,185,108,.1);border-radius:4px;text-align:center;margin-bottom:1rem}.view-experiment .not-significant-results{padding:.5rem;width:100%;background:rgba(83,117,255,.1);border-radius:4px;margin-bottom:1rem}.view-experiment .feature-flag-mods{padding:.5rem;width:100%;background:#f6ebf8;border-radius:4px;margin-bottom:1rem}.view-experiment .ant-collapse-content-box{display:flex;flex-flow:column}.view-experiment .secondary-progress{margin-top:.5rem}.view-experiment .secondary-progress li:before{content:"\u2022";display:inline-block;font-weight:900;margin-right:4px}.view-experiment .no-experiment-results{display:flex;justify-content:center;align-items:center;margin-top:1rem;background-color:#fafaf9;border:1px solid rgba(0,0,0,.15);width:100%;min-height:320px;font-size:24px}.preview-conversion-goal-num{height:24px;width:24px;text-align:center;background-color:#fafaf9;color:#35416b;font-weight:700;margin-right:.5rem}.experiment-preview-row{border-bottom:1px solid rgba(0,0,0,.15);padding-bottom:1rem;margin-bottom:1rem}.experiment-preview-row:last-child{border-bottom:none;padding-bottom:0;margin-bottom:0}.metric-name{border:1px solid rgba(0,0,0,.15);border-radius:4px;padding:8px 8px 8px 16px;margin-left:.5rem;flex:1}.experiment-implementation-details,.experiment-workflow{border-color:#d9d9d9}.experiment-implementation-details .ant-card-head,.experiment-workflow .ant-card-head{padding-left:1rem;padding-right:1rem;border:none}.experiment-implementation-details .ant-card-head-title,.experiment-workflow .ant-card-head-title{border-bottom:1px solid rgba(0,0,0,.15)}.experiment-implementation-details .exp-workflow-step,.experiment-workflow .exp-workflow-step{margin-bottom:.5rem;padding:.5rem;border-radius:4px}.experiment-implementation-details .exp-workflow-step:hover,.experiment-workflow .exp-workflow-step:hover{cursor:pointer}.experiment-implementation-details .step-completed,.experiment-workflow .step-completed{background-color:#e5ebff}',""]),Te.exports=Z}}]);
