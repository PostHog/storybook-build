var ms=Object.defineProperty,gs=Object.defineProperties;var fs=Object.getOwnPropertyDescriptors;var $e=Object.getOwnPropertySymbols;var yt=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable;var xt=(S,g,n)=>g in S?ms(S,g,{enumerable:!0,configurable:!0,writable:!0,value:n}):S[g]=n,F=(S,g)=>{for(var n in g||(g={}))yt.call(g,n)&&xt(S,n,g[n]);if($e)for(var n of $e(g))Rt.call(g,n)&&xt(S,n,g[n]);return S},I=(S,g)=>gs(S,fs(g));var Ft=(S,g)=>{var n={};for(var u in S)yt.call(S,u)&&g.indexOf(u)<0&&(n[u]=S[u]);if(S!=null&&$e)for(var u of $e(S))g.indexOf(u)<0&&Rt.call(S,u)&&(n[u]=S[u]);return n};var K=(S,g,n)=>new Promise((u,N)=>{var X=D=>{try{j(n.next(D))}catch(w){N(w)}},p=D=>{try{j(n.throw(D))}catch(w){N(w)}},j=D=>D.done?u(D.value):Promise.resolve(D.value).then(X,p);j((n=n.apply(S,g)).next())});(window.webpackJsonp=window.webpackJsonp||[]).push([[273],{"./frontend/src/scenes/feature-flags/FeatureFlag.tsx":function(S,g,n){"use strict";n.r(g),n.d(g,"scene",function(){return ds}),n.d(g,"FeatureFlag",function(){return ve});var u=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),N=n("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.0/node_modules/kea-forms/lib/index.js"),X=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/divider/index.js"),p=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/row/index.js"),j=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/col/index.js"),D=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/card/index.js"),w=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/skeleton/index.js"),P=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),b=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/popconfirm/index.js"),O=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/radio/index.js"),E=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/select/index.js"),v=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/input-number/index.js"),i=n("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),T=n("./frontend/src/lib/utils.tsx"),A=n("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),R=n("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/LockOutlined.js"),m=n("./frontend/src/types.ts"),x=n("./frontend/src/lib/api.ts"),J=n("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),C=n("./frontend/src/scenes/urls.ts"),W=n("./frontend/src/scenes/teamLogic.tsx"),Z=n("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),ie=n("./frontend/src/models/groupsModel.ts"),ce=n("./frontend/src/lib/components/TaxonomicFilter/types.ts"),Ve=n("./frontend/src/lib/components/lemonToast.tsx"),nt=n("./frontend/src/lib/utils/eventUsageLogic.ts"),at=n("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),Et=n("./frontend/src/scenes/insights/utils/cleanFilters.ts"),ot=n("./frontend/src/lib/dayjs.ts"),St=n("./frontend/src/scenes/insights/sharedUtils.ts"),rt=n("./frontend/src/scenes/organization/Settings/Permissions/Roles/rolesLogic.tsx");const ze=Object(i.kea)([Object(i.path)(["scenes","feature-flags","featureFlagPermissionsLogic"]),Object(i.props)({}),Object(i.key)(t=>`${t.flagId}`),Object(i.connect)({values:[rt.a,["roles"]]}),Object(i.actions)({setModalOpen:t=>({visible:t}),setRolesToAdd:t=>({roleIds:t})}),Object(i.reducers)({permissionModalVisible:[!1,{setModalOpen:(t,s)=>{let{visible:o}=s;return o}}],rolesToAdd:[[],{setRolesToAdd:(t,s)=>{let{roleIds:o}=s;return o}}]}),Object(at.loaders)(t=>{let{props:s,values:o,actions:a}=t;return{unfilteredAddableRoles:[[],{loadPossibleRolesToAdd:()=>K(this,null,function*(){return(yield x.b.roles.list({feature_flags_access_level:m.a.READ})).results||[]})}],associatedRoles:[[],{loadAssociatedRoles:()=>K(this,null,function*(){return s.flagId?(yield x.b.resourceAccessPermissions.featureFlags.list(s.flagId)).results||[]:[]}),addAssociatedRoles:r=>K(this,null,function*(){const{rolesToAdd:l}=o,c=s.flagId||r;if(c){const h=yield Promise.all(l.map(_=>K(this,null,function*(){return yield x.b.resourceAccessPermissions.featureFlags.create(c,_)})));return a.setRolesToAdd([]),[...o.associatedRoles,...h]}const d=[];for(const h of l){const _=o.roles.find(f=>h===f.id);_!=null&&_.id&&d.push(_)}return nt.e.actions.reportRoleCustomAddedToAResource(m.T.FEATURE_FLAGS,l.length),d.map(h=>({id:h.id,role:h,feature_flag:null,updated_at:"",added_at:""}))}),deleteAssociatedRole:r=>K(this,null,function*(){var l;let{roleId:c}=r;const d=(l=o.associatedRoles.find(_=>_.role.id===c))===null||l===void 0?void 0:l.id,h=o.associatedRoles.filter(_=>_.id!==d);return s.flagId?d&&(yield x.b.resourceAccessPermissions.featureFlags.delete(s.flagId,d)):a.setRolesToAdd(h.map(_=>_.id)),h})}]}}),Object(i.selectors)({derivedRoles:[t=>[t.associatedRoles],t=>t.map(s=>s.role)],addableRoles:[t=>[t.unfilteredAddableRoles,t.associatedRoles],(t,s)=>{const o=[];for(const a of t)s.some(r=>r.role.id===a.id)||o.push(a);return o}]}),Object(i.afterMount)(t=>{let{actions:s}=t;s.loadPossibleRolesToAdd(),s.loadAssociatedRoles()})]);var Fe=n("./frontend/src/scenes/userLogic.ts");const At=()=>({operator:"gt",threshold_type:m.U.Sentry,threshold:50,threshold_metric:F({},Object(Et.a)({insight:m.F.TRENDS,date_from:Object(ot.a)().subtract(7,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(ot.a)().endOf("d").format("YYYY-MM-DDTHH:mm")}))}),We={id:null,created_at:null,key:"",name:"",filters:{groups:[{properties:[],rollout_percentage:null,variant:null}],multivariate:null},deleted:!1,active:!0,created_by:null,is_simple_flag:!1,rollout_percentage:null,ensure_experience_continuity:!1,experiment_set:null,rollback_conditions:[],performed_rollback:!1,can_edit:!0,tags:[]},It={key:"",name:"",rollout_percentage:0},Tt={variants:[{key:"",name:"",rollout_percentage:100}]},Lt=t=>({events:[{id:"$feature_flag_called",name:"$feature_flag_called",type:"events",properties:He(t)}]}),He=t=>[{key:"$feature/"+t,type:m.N.Event,value:["false"],operator:m.P.IsNot},{key:"$feature/"+t,type:m.N.Event,value:"is_set",operator:m.P.IsSet},{key:"$feature_flag",type:m.N.Event,value:t,operator:m.P.Exact}],oe=Object(i.kea)([Object(i.path)(["scenes","feature-flags","featureFlagLogic"]),Object(i.props)({}),Object(i.key)(t=>{let{id:s}=t;return s!=null?s:"unknown"}),Object(i.connect)({values:[W.a,["currentTeamId"],ie.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"],Fe.a,["hasAvailableFeature"]]}),Object(i.actions)({setFeatureFlag:t=>({featureFlag:t}),setFeatureFlagMissing:!0,addConditionSet:!0,addRollbackCondition:!0,setAggregationGroupTypeIndex:t=>({value:t}),removeConditionSet:t=>({index:t}),removeRollbackCondition:t=>({index:t}),duplicateConditionSet:t=>({index:t}),updateConditionSet:(t,s,o,a)=>({index:t,newRolloutPercentage:s,newProperties:o,newVariant:a}),deleteFeatureFlag:t=>({featureFlag:t}),setMultivariateEnabled:t=>({enabled:t}),setMultivariateOptions:t=>({multivariateOptions:t}),addVariant:!0,duplicateVariant:t=>({index:t}),removeVariant:t=>({index:t}),editFeatureFlag:t=>({editing:t}),distributeVariantsEqually:!0,setFilters:t=>({filters:t}),loadInsightAtIndex:(t,s)=>({index:t,filters:s}),setInsightResultAtIndex:(t,s)=>({index:t,average:s}),loadAllInsightsForFlag:!0,setAffectedUsers:(t,s)=>({index:t,count:s}),setTotalUsers:t=>({count:t}),triggerFeatureFlagUpdate:t=>({payload:t})}),Object(N.forms)(t=>{let{actions:s,values:o}=t;return{featureFlag:{defaults:F({},We),errors:a=>{var r,l,c;let{key:d,filters:h}=a;return{key:d?(r=d.match)!==null&&r!==void 0&&r.call(d,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key",filters:{multivariate:{variants:h==null||(l=h.multivariate)===null||l===void 0||(c=l.variants)===null||c===void 0?void 0:c.map(_=>{var f;let{key:y}=_;return{key:y?(f=y.match)!==null&&f!==void 0&&f.call(y,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key"}})},groups:o.propertySelectErrors}}},submit:a=>{s.saveFeatureFlag(a)}}}}),Object(i.reducers)({featureFlag:[F({},We),{setFeatureFlag:(t,s)=>{let{featureFlag:o}=s;if(o.filters.groups){const a=o.filters.groups.map(r=>r.properties?I(F({},r),{properties:Object(T.r)(r.properties)}):r);return I(F({},o),{filters:I(F({},o==null?void 0:o.filters),{groups:a})})}return o},addConditionSet:t=>{if(!t)return t;const s=[...t==null?void 0:t.filters.groups,{properties:[],rollout_percentage:null,variant:null}];return I(F({},t),{filters:I(F({},t.filters),{groups:s})})},addRollbackCondition:t=>t&&I(F({},t),{rollback_conditions:[...t.rollback_conditions,At()]}),removeRollbackCondition:(t,s)=>{let{index:o}=s;if(!t)return t;const a=[...t.rollback_conditions];return a.splice(o,1),I(F({},t),{rollback_conditions:a})},updateConditionSet:(t,s)=>{let{index:o,newRolloutPercentage:a,newProperties:r,newVariant:l}=s;if(!t)return t;const c=[...t==null?void 0:t.filters.groups];return a!==void 0&&(c[o]=I(F({},c[o]),{rollout_percentage:a})),r!==void 0&&(c[o]=I(F({},c[o]),{properties:r})),l!==void 0&&(c[o]=I(F({},c[o]),{variant:l})),I(F({},t),{filters:I(F({},t.filters),{groups:c})})},removeConditionSet:(t,s)=>{let{index:o}=s;if(!t)return t;const a=[...t.filters.groups];return a.splice(o,1),I(F({},t),{filters:I(F({},t.filters),{groups:a})})},duplicateConditionSet:(t,s)=>{let{index:o}=s;if(!t)return t;const a=t.filters.groups.concat([t.filters.groups[o]]);return I(F({},t),{filters:I(F({},t.filters),{groups:a})})},setMultivariateOptions:(t,s)=>{let{multivariateOptions:o}=s;return t&&I(F({},t),{filters:I(F({},t.filters),{multivariate:o})})},addVariant:t=>{var s;if(!t)return t;const o=[...((s=t.filters.multivariate)===null||s===void 0?void 0:s.variants)||[]];return I(F({},t),{filters:I(F({},t.filters),{multivariate:I(F({},t.filters.multivariate||{}),{variants:[...o,It]})})})},removeVariant:(t,s)=>{var o;let{index:a}=s;if(!t)return t;const r=[...((o=t.filters.multivariate)===null||o===void 0?void 0:o.variants)||[]];return r.splice(a,1),I(F({},t),{filters:I(F({},t.filters),{multivariate:I(F({},t.filters.multivariate),{variants:r})})})},distributeVariantsEqually:t=>{var s;if(!t)return t;const o=[...((s=t.filters.multivariate)===null||s===void 0?void 0:s.variants)||[]],a=o.length;if(a>0&&a<=100){const r=Math.round(100/a),c=r*a-100;o.forEach((d,h)=>{o[h]=I(F({},d),{rollout_percentage:r})}),o[a-1]=I(F({},o[a-1]),{rollout_percentage:r-c})}return I(F({},t),{filters:I(F({},t.filters),{multivariate:I(F({},t.filters.multivariate),{variants:o})})})},setAggregationGroupTypeIndex:(t,s)=>{let{value:o}=s;return!t||t.filters.aggregation_group_type_index==o?t:I(F({},t),{filters:I(F({},t.filters),{aggregation_group_type_index:o,groups:[{properties:[],rollout_percentage:null,variant:null}]})})}}],featureFlagMissing:[!1,{setFeatureFlagMissing:()=>!0}],isEditingFlag:[!1,{editFeatureFlag:(t,s)=>{let{editing:o}=s;return o}}],insightRollingAverages:[{},{setInsightResultAtIndex:(t,s)=>{let{index:o,average:a}=s;return I(F({},t),{[`${o}`]:a})}}],affectedUsers:[{},{setAffectedUsers:(t,s)=>{let{index:o,count:a}=s;return I(F({},t),{[o]:a})},resetFeatureFlag:()=>({0:-1}),loadFeatureFlag:()=>({0:-1})}],totalUsers:[null,{setTotalUsers:(t,s)=>{let{count:o}=s;return o}}]}),Object(at.loaders)(t=>{let{values:s,props:o,actions:a}=t;return{featureFlag:{loadFeatureFlag:()=>K(this,null,function*(){if(o.id&&o.id!=="new")try{return yield x.b.get(`api/projects/${s.currentTeamId}/feature_flags/${o.id}`)}catch(r){throw a.setFeatureFlagMissing(),r}return We}),saveFeatureFlag:r=>K(this,null,function*(){const _=r,{created_at:l,id:c}=_,d=Ft(_,["created_at","id"]);try{if(r.id)return yield x.b.update(`api/projects/${s.currentTeamId}/feature_flags/${r.id}`,d);{const f=yield x.b.create(`api/projects/${s.currentTeamId}/feature_flags`,d);if(s.roleBasedAccessEnabled){var h;(h=ze({flagId:null}))===null||h===void 0||h.actions.addAssociatedRoles(f.id)}return f}}catch(f){throw(f.code==="behavioral_cohort_found"||f.code==="cohort_does_not_exist")&&nt.e.actions.reportFailedToCreateFeatureFlagWithCohort(f.code,f.detail),f}})},recentInsights:[[],{loadRecentInsights:()=>K(this,null,function*(){return o.id&&o.id!=="new"&&s.featureFlag.key?(yield x.b.get(`api/projects/${s.currentTeamId}/insights/?feature_flag=${s.featureFlag.key}&order=-created_at`)).results:[]})}],sentryStats:[{},{loadSentryStats:()=>K(this,null,function*(){return yield x.b.get("api/sentry_stats/")})}]}}),Object(i.listeners)(t=>{let{actions:s,values:o}=t;return{saveFeatureFlagSuccess:a=>{var r;let{featureFlag:l}=a;Ve.d.success("Feature flag saved"),(r=Z.b.findMounted())===null||r===void 0||r.actions.updateFlag(l),J.router.actions.replace(C.a.featureFlag(l.id)),s.editFeatureFlag(!1)},deleteFeatureFlag:a=>K(this,null,function*(){let{featureFlag:r}=a;Object(T.x)({endpoint:`projects/${o.currentTeamId}/feature_flags`,object:{name:r.name,id:r.id},callback:()=>{var l,c;r.id&&((l=Z.b.findMounted())===null||l===void 0||l.actions.deleteFlag(r.id)),(c=Z.b.findMounted())===null||c===void 0||c.actions.loadFeatureFlags(),J.router.actions.push(C.a.featureFlags())}})}),setMultivariateEnabled:a=>K(this,null,function*(){let{enabled:r}=a;r?s.setMultivariateOptions(Tt):s.setMultivariateOptions(null)}),loadFeatureFlagSuccess:()=>K(this,null,function*(){s.loadRecentInsights(),s.loadAllInsightsForFlag()}),loadInsightAtIndex:a=>K(this,null,function*(){let{index:r,filters:l}=a;if(l){var c,d;const _=(c=(yield x.b.get(`api/projects/${o.currentTeamId}/insights/trend/?${Object(T.Ib)(Object(St.a)(l))}`)).result)===null||c===void 0||(d=c[0])===null||d===void 0?void 0:d.data,f=Math.round(Object(T.Hb)(_)/7);s.setInsightResultAtIndex(r,f)}}),loadAllInsightsForFlag:()=>{var a;(a=o.featureFlag.rollback_conditions)===null||a===void 0||a.forEach((r,l)=>{r.threshold_metric&&s.loadInsightAtIndex(l,r.threshold_metric)})},addRollbackCondition:()=>{const a=o.featureFlag.rollback_conditions.length-1;s.loadInsightAtIndex(a,o.featureFlag.rollback_conditions[a].threshold_metric)},updateConditionSet:(a,r)=>K(this,null,function*(){var l,c,d;let{index:h,newProperties:_}=a;if(_&&s.setAffectedUsers(h,void 0),!_||_.some(y=>y.value===null||y.value===void 0||Array.isArray(y.value)&&y.value.length===0))return;yield r(1e3);const f=yield x.b.create(`api/projects/${o.currentTeamId}/feature_flags/user_blast_radius`,{condition:{properties:_},group_type_index:(l=(c=o.featureFlag)===null||c===void 0||(d=c.filters)===null||d===void 0?void 0:d.aggregation_group_type_index)!==null&&l!==void 0?l:null});s.setAffectedUsers(h,f.users_affected),s.setTotalUsers(f.total_users)}),addConditionSet:()=>{s.setAffectedUsers(o.featureFlag.filters.groups.length-1,-1)},editFeatureFlag:a=>K(this,null,function*(){var r,l,c;let{editing:d}=a;if(!d)return;const h=[];(r=o.featureFlag)===null||r===void 0||(l=r.filters)===null||l===void 0||(c=l.groups)===null||c===void 0||c.forEach((f,y)=>{s.setAffectedUsers(y,void 0);const B=f.properties;if(!B||(B==null?void 0:B.length)===0||B.some(Q=>Q.value===null||Q.value===void 0||Array.isArray(Q.value)&&Q.value.length===0))h.push(Promise.resolve({users_affected:-1,total_users:-1}));else{var L,k,q;const Q=x.b.create(`api/projects/${o.currentTeamId}/feature_flags/user_blast_radius`,{condition:f,group_type_index:(L=(k=o.featureFlag)===null||k===void 0||(q=k.filters)===null||q===void 0?void 0:q.aggregation_group_type_index)!==null&&L!==void 0?L:null});h.push(Q)}}),(yield Promise.all(h)).forEach((f,y)=>{s.setAffectedUsers(y,f.users_affected),f.total_users!==-1&&s.setTotalUsers(f.total_users)})}),triggerFeatureFlagUpdate:a=>K(this,null,function*(){let{payload:r}=a;if(o.featureFlag){var l;const c=yield x.b.update(`api/projects/${o.currentTeamId}/feature_flags/${o.featureFlag.id}`,r);s.setFeatureFlag(c),(l=Z.b.findMounted())===null||l===void 0||l.actions.updateFlag(c)}})}}),Object(i.selectors)({sentryErrorCount:[t=>[t.sentryStats],t=>t.total_count],sentryIntegrationEnabled:[t=>[t.sentryStats],t=>!!t.sentry_integration_enabled],props:[()=>[(t,s)=>s],t=>t],multivariateEnabled:[t=>[t.featureFlag],t=>!!(t!=null&&t.filters.multivariate)],roleBasedAccessEnabled:[t=>[t.hasAvailableFeature],t=>t(m.e.ROLE_BASED_ACCESS)],variants:[t=>[t.featureFlag],t=>{var s;return(t==null||(s=t.filters.multivariate)===null||s===void 0?void 0:s.variants)||[]}],nonEmptyVariants:[t=>[t.variants],t=>t.filter(s=>{let{key:o}=s;return!!o})],variantRolloutSum:[t=>[t.variants],t=>t.reduce((s,o)=>{let{rollout_percentage:a}=o;return s+a},0)],areVariantRolloutsValid:[t=>[t.variants,t.variantRolloutSum],(t,s)=>t.every(o=>{let{rollout_percentage:a}=o;return a>=0&&a<=100})&&s===100],aggregationTargetName:[t=>[t.featureFlag,t.groupTypes,t.aggregationLabel],(t,s,o)=>t&&t.filters.aggregation_group_type_index!=null&&s.length>0?o(t.filters.aggregation_group_type_index).plural:"users"],taxonomicGroupTypes:[t=>[t.featureFlag,t.groupsTaxonomicTypes],(t,s)=>t&&t.filters.aggregation_group_type_index!=null&&s.length>0?[s[t.filters.aggregation_group_type_index]]:[ce.a.PersonProperties,ce.a.Cohorts]],breadcrumbs:[t=>[t.featureFlag],t=>[{name:"Feature Flags",path:C.a.featureFlags()},...t?[{name:t.key||"Unnamed"}]:[]]],propertySelectErrors:[t=>[t.featureFlag],t=>{var s,o;return t==null||(s=t.filters)===null||s===void 0||(o=s.groups)===null||o===void 0?void 0:o.map(a=>{let{properties:r}=a;return{properties:r==null?void 0:r.map(l=>({value:l.value===null||l.value===void 0||Array.isArray(l.value)&&l.value.length===0?"Property filters can't be empty":void 0}))}})}],computeBlastRadiusPercentage:[t=>[t.affectedUsers,t.totalUsers],(t,s)=>(o,a)=>{let r=o;if(o==null&&(r=100),t[a]===-1||s===-1||!s)return r;let l=s;return l===0&&(l=1),r*(t[a]/l)}],approximateTotalBlastRadius:[t=>[t.computeBlastRadiusPercentage,t.featureFlag],(t,s)=>{if(!s||!s.filters.groups)return 0;let o=0;return s.filters.groups.forEach((a,r)=>{o+=t(a.rollout_percentage,r)}),Math.min(o,100)}]}),Object(J.urlToAction)(t=>{var s;let{actions:o,props:a}=t;return{[C.a.featureFlag((s=a.id)!==null&&s!==void 0?s:"new")]:(r,l,c,d)=>{let{method:h}=d;h==="PUSH"&&(a.id?o.loadFeatureFlag():o.resetFeatureFlag())}}}),Object(i.afterMount)(t=>{var s;let{props:o,actions:a}=t;const r=(s=Z.b.findMounted())===null||s===void 0?void 0:s.values.featureFlags.find(l=>l.id===o.id);r?(a.setFeatureFlag(r),a.loadRecentInsights(),a.loadAllInsightsForFlag()):o.id!=="new"&&a.loadFeatureFlag(),a.loadSentryStats()})]);var Ge=n("./frontend/src/lib/logic/featureFlagLogic.ts"),$=n("./frontend/src/lib/components/icons.tsx"),de=n("./frontend/src/lib/components/LemonDivider/index.ts"),ne=n("./frontend/src/lib/components/CodeSnippet/index.tsx"),e=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const me="?utm_medium=in-product&utm_campaign=feature-flag";function Ee(t){let{flagKey:s}=t;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ne.a,{language:ne.b.JavaScript,wrap:!0,children:`const isMyFlagEnabledForUser = await client.isFeatureEnabled('${s}', 'user distinct id')

if (isMyFlagEnabledForUser) {
    // Do something differently for this user
}`})})}function Se(t){let{flagKey:s}=t;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ne.a,{language:ne.b.JavaScript,wrap:!0,children:`if\xA0(posthog.isFeatureEnabled('${s!=null?s:""}')) {
    // run your activation code here
}`})})}function Ae(t){let{flagKey:s}=t;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ne.a,{language:ne.b.PHP,wrap:!0,children:`if (PostHog::isFeatureEnabled('${s}', 'some distinct id')) {
    // do something here
}`})})}function Ie(t){let{flagKey:s}=t;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ne.a,{language:ne.b.Go,wrap:!0,children:`isFlagEnabledForUser, err := client.IsFeatureEnabled(
                    FeatureFlagPayload{
                        Key:        '${s}',
                        DistinctId: "distinct-id",
                    })

if (isFlagEnabledForUser) {
  // Do something differently for this user
}`})})}function Te(t){let{flagKey:s}=t;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ne.a,{language:ne.b.Ruby,wrap:!0,children:`is_my_flag_enabled = posthog.is_feature_enabled('${s}', 'user distinct id')

if is_my_flag_enabled
  # Do something differently for this user
end`})})}function Le(t){let{flagKey:s}=t;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ne.a,{language:ne.b.Python,wrap:!0,children:`if posthog.feature_enabled("${s}", "user_distinct_id"):
    runAwesomeFeature()
`})})}function Pt(){const{currentTeam:t}=Object(i.useValues)(W.a);return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ne.a,{language:ne.b.Bash,wrap:!0,children:`curl ${window.location.origin}/decide/ \\
-X POST -H 'Content-Type: application/json' \\
-d '{
    "api_key": "${t?t.api_token:"[project_api_key]"}",
    "distinct_id": "[user distinct id]"
}'
                `})})}try{Ee.displayName="NodeJSSnippet",Ee.__docgenInfo={description:"",displayName:"NodeJSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#NodeJSSnippet"]={docgenInfo:Ee.__docgenInfo,name:"NodeJSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#NodeJSSnippet"})}catch(t){}try{Se.displayName="JSSnippet",Se.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:Se.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(t){}try{Ae.displayName="PHPSnippet",Ae.__docgenInfo={description:"",displayName:"PHPSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PHPSnippet"]={docgenInfo:Ae.__docgenInfo,name:"PHPSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PHPSnippet"})}catch(t){}try{Ie.displayName="GolangSnippet",Ie.__docgenInfo={description:"",displayName:"GolangSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#GolangSnippet"]={docgenInfo:Ie.__docgenInfo,name:"GolangSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#GolangSnippet"})}catch(t){}try{Te.displayName="RubySnippet",Te.__docgenInfo={description:"",displayName:"RubySnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#RubySnippet"]={docgenInfo:Te.__docgenInfo,name:"RubySnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#RubySnippet"})}catch(t){}try{Le.displayName="PythonSnippet",Le.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:Le.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(t){}var Ct=n("./node_modules/.pnpm/style-loader@2.0.0_webpack@4.46.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),lt=n.n(Ct),Mt=n("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlagInstructions.scss"),it=n.n(Mt),Ye={};Ye.insert="head",Ye.singleton=!1;var js=lt()(it.a,Ye),bs=it.a.locals||{};const ge="https://posthog.com/docs/",je="#feature-flags",Je=[{value:"JavaScript",documentationLink:`${ge}integrations/js-integration${me}${je}`,Icon:$.IconJavascript,Snippet:Se},{value:"Node.js",documentationLink:`${ge}integrations/node-integration${me}${je}`,Icon:$.IconNodeJS,Snippet:Ee},{value:"PHP",documentationLink:`${ge}integrations/php-integration${me}${je}`,Icon:$.IconPHP,Snippet:Ae},{value:"Ruby",documentationLink:`${ge}integrations/ruby-integration${me}${je}`,Icon:$.IconRuby,Snippet:Te},{value:"Golang",documentationLink:`${ge}integrations/go-integration${me}${je}`,Icon:$.IconGolang,Snippet:Ie},{value:"Python",documentationLink:`${ge}integrations/python-integration${me}${je}`,Icon:$.IconPython,Snippet:Le},{value:"API",documentationLink:`${ge}api/feature-flags${me}`,Icon:$.IconOpenInNew,Snippet:Pt}];function Nt(t){let{selectedOptionValue:s,selectOption:o}=t;return Object(e.jsxs)(p.a,{className:"FeatureFlagInstructionsHeader",justify:"space-between",align:"middle",children:[Object(e.jsxs)("div",{className:"FeatureFlagInstructionsHeader__header-title",children:[Object(e.jsx)($.IconFlag,{className:"FeatureFlagInstructionsHeader__header-title__icon"}),Object(e.jsx)("b",{children:"Learn how to use feature flags in your code"})]}),Object(e.jsx)(E.a,{"data-attr":"feature-flag-instructions-select",value:s,style:{width:140},onChange:o,children:Je.map((a,r)=>{let{value:l,Icon:c}=a;return Object(e.jsx)(E.a.Option,{"data-attr":"feature-flag-instructions-select-option-"+l,value:l,children:Object(e.jsxs)("div",{className:"FeatureFlagInstructionsHeader__option",children:[Object(e.jsx)("div",{className:"FeatureFlagInstructionsHeader__option__icon",children:Object(e.jsx)(c,{})}),Object(e.jsx)("div",{children:l})]})},r)})})]})}function Dt(t){let{documenrationLink:s}=t;return Object(e.jsxs)("div",{className:"mt-4",children:["Need more information?"," ",Object(e.jsxs)("a",{"data-attr":"feature-flag-doc-link",target:"_blank",rel:"noopener",href:s,children:["Check the docs ",Object(e.jsx)($.IconOpenInNew,{})]})]})}function he(t){let{featureFlagKey:s}=t;const[o]=Je,[a,r]=Object(u.useState)(o),l=c=>{const d=Je.find(h=>h.value===c);d&&r(d)};return Object(e.jsxs)(D.a,{size:"small",children:[Object(e.jsx)(Nt,{selectedOptionValue:a.value,selectOption:l}),Object(e.jsx)(de.a,{}),Object(e.jsx)("div",{className:"mt mb",children:Object(e.jsx)(a.Snippet,{"data-attr":"feature-flag-instructions-snippet",flagKey:s})}),Object(e.jsx)(de.a,{}),Object(e.jsx)(Dt,{documenrationLink:a.documentationLink})]})}try{he.displayName="FeatureFlagInstructions",he.__docgenInfo={description:"",displayName:"FeatureFlagInstructions",props:{featureFlagKey:{defaultValue:null,description:"",name:"featureFlagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagInstructions.tsx#FeatureFlagInstructions"]={docgenInfo:he.__docgenInfo,name:"FeatureFlagInstructions",path:"frontend/src/scenes/feature-flags/FeatureFlagInstructions.tsx#FeatureFlagInstructions"})}catch(t){}var ct=n("./frontend/src/lib/components/PageHeader.tsx"),Kt=n("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss"),dt=n.n(Kt),Qe={};Qe.insert="head",Qe.singleton=!1;var hs=lt()(dt.a,Qe),Os=dt.a.locals||{},Bt=n("./frontend/src/lib/components/Tooltip.tsx"),kt=n("./node_modules/.pnpm/rc-select@13.1.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/rc-select/es/index.js"),Pe=n("./frontend/src/lib/components/Link.tsx"),Ce=n("./frontend/src/lib/introductions/groupsAccessLogic.ts");function Me(t){let{value:s}=t;const{groupsAccessStatus:o}=Object(i.useValues)(Ce.b);return[Ce.a.HasAccess,Ce.a.HasGroupTypes,Ce.a.NoAccess].includes(o)?Object(e.jsxs)(kt.c.Option,{value:s,disabled:!0,style:{height:"100%",width:"100%",overflow:"hidden",textOverflow:"ellipsis",backgroundColor:"var(--side)",color:"var(--muted)"},children:[Object(e.jsx)(R.a,{style:{marginRight:6,color:"var(--warning)"}}),"Unique groups \u2013"," ",Object(e.jsx)(Pe.a,{to:"https://posthog.com/docs/user-guides/group-analytics?utm_medium=in-product&utm_campaign=group-analytics-learn-more",target:"_blank","data-attr":"group-analytics-learn-more",className:"font-semibold",children:"Learn more"})]},"groups"):null}try{Me.displayName="GroupsIntroductionOption",Me.__docgenInfo={description:"",displayName:"GroupsIntroductionOption",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/introductions/GroupsIntroductionOption.tsx#GroupsIntroductionOption"]={docgenInfo:Me.__docgenInfo,name:"GroupsIntroductionOption",path:"frontend/src/lib/introductions/GroupsIntroductionOption.tsx#GroupsIntroductionOption"})}catch(t){}var se=n("./frontend/src/lib/components/LemonButton/index.ts"),ae=n("./frontend/src/lib/forms/Field.tsx"),Ut=n("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx"),Ne=n("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),ut=n("./frontend/src/lib/components/LemonCheckbox/index.ts"),wt=n("./frontend/src/scenes/events/EventBufferNotice.tsx"),pt=n("./frontend/src/lib/components/AlertMessage/index.ts"),Oe=n("./frontend/src/lib/components/Spinner/Spinner.tsx"),mt=n("./frontend/src/lib/components/CopyToClipboard.tsx"),De=n("./frontend/src/lib/components/Lettermark/Lettermark.tsx"),le=n("./frontend/src/lib/constants.tsx"),gt=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),$t=n("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),Vt=n("./frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),zt=n("./frontend/src/lib/components/DefinitionPopup/utils.ts"),ft=n("./frontend/src/lib/components/CompactList/CompactList.tsx"),Wt=n("./frontend/src/scenes/project-homepage/RecentInsights.tsx");function Ht(){const{recentInsights:t,recentInsightsLoading:s,featureFlag:o}=Object(i.useValues)(oe);return Object(e.jsx)(ft.a,{title:"Insights that use this feature flag",loading:s,emptyMessage:{title:"You have no insights that use this feature flag",description:"Explore this feature flag's insights by creating one below.",buttonText:"Create insight",buttonTo:C.a.insightNew({events:[{id:"$pageview",name:"$pageview",type:"events",math:"dau"}],breakdown_type:"event",breakdown:`$feature/${o.key}`})},items:t.slice(0,5),renderRow:(a,r)=>Object(e.jsx)(Wt.a,{insight:a},r)})}var Gt=n("./frontend/src/lib/components/NotFound/index.tsx"),Yt=n("./frontend/src/models/cohortsModel.ts"),G=n("./frontend/@posthog/lemon-ui/src/index.ts"),Jt=n("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),Qt=n("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx");function _e(t){let{readOnly:s}=t;const{featureFlag:o,sentryIntegrationEnabled:a,sentryErrorCount:r,insightRollingAverages:l}=Object(i.useValues)(oe),{addRollbackCondition:c,removeRollbackCondition:d,loadInsightAtIndex:h}=Object(i.useActions)(oe),{user:_}=Object(i.useValues)(Fe.a);return Object(e.jsxs)("div",{children:[Object(e.jsxs)("div",{className:"mb-2",children:[Object(e.jsx)("b",{children:"Auto rollback"}),Object(e.jsx)(G.LemonTag,{type:"warning",className:"uppercase ml-2",children:"Beta"}),!s&&Object(e.jsx)("div",{className:"mt-2",children:"Specify the conditions in which this feature flag will automatically roll back."})]}),s&&o.rollback_conditions&&o.rollback_conditions.map((f,y)=>{var B,L,k;return Object(e.jsxs)(e.Fragment,{children:[y>0&&Object(e.jsx)("div",{className:"condition-set-separator",children:"OR"}),f.threshold_type==="insight"&&(B=f.threshold_metric)!==null&&B!==void 0&&(L=B.events)!==null&&L!==void 0&&(k=L[0])!==null&&k!==void 0&&k.name?Object(e.jsxs)("div",{className:"mb-4 border rounded p-4",children:[Object(e.jsx)("b",{children:`${Object(T.i)(f.threshold_type)} based rollback`}),Object(e.jsx)(G.LemonDivider,{className:"my-3"}),Object(e.jsxs)(p.a,{align:"middle",children:[l[y]&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("b",{children:f.threshold_metric.events[0].name}),"\xA0 trailing average is ",l[y],"."]}),"\xA0Trigger when trailing average of \xA0",Object(e.jsx)("b",{children:f.threshold_metric.events[0].name}),"\xA0 is\xA0",f.operator&&T.J[f.operator]," ",f.threshold]})]}):Object(e.jsxs)("div",{className:"mb-4 border rounded p-4",children:[Object(e.jsx)("b",{children:`${Object(T.i)(f.threshold_type)} based rollback`}),Object(e.jsx)(G.LemonDivider,{className:"my-3"}),Object(e.jsxs)(p.a,{align:"middle",children:["Trigger when there is a\xA0",Object(e.jsxs)("b",{children:[f.threshold,"%"]}),"\xA0increase in errors"]})]})]})}),!s&&o.rollback_conditions&&o.rollback_conditions.map((f,y)=>Object(e.jsxs)(e.Fragment,{children:[y>0&&Object(e.jsx)("div",{className:"condition-set-separator",children:"OR"}),Object(e.jsx)("div",{className:"mb-4 border rounded p-4",children:Object(e.jsxs)(N.Group,{name:["rollback_conditions",y],children:[Object(e.jsxs)(p.a,{align:"middle",justify:"space-between",children:[Object(e.jsxs)(p.a,{children:[Object(e.jsx)("div",{className:"mt-3 mr-3",children:Object(e.jsx)("b",{children:"Rollback Condition Type"})}),Object(e.jsx)(ae.a,{name:"threshold_type",children:B=>{let{value:L,onChange:k}=B;return Object(e.jsx)(G.LemonSelect,{value:L,onChange:k,options:[{value:m.U.Sentry,label:"Error Based"},{value:m.U.Insight,label:"Metric Based"}]})}})]}),Object(e.jsx)(G.LemonButton,{icon:Object(e.jsx)($.IconDelete,{}),status:"muted",noPadding:!0,onClick:()=>{d(y)}})]}),Object(e.jsx)(G.LemonDivider,{className:"my-3"}),o.rollback_conditions[y].threshold_type=="insight"?Object(e.jsxs)("div",{className:"flex gap-2 items-center mt-4",children:[Object(e.jsx)(ae.a,{name:"threshold_metric",children:B=>{let{value:L,onChange:k}=B;return Object(e.jsx)(Jt.a,{filters:L,setFilters:q=>{k(F({},q)),h(y,q)},typeKey:"feature-flag-rollback-trends-"+y,buttonCopy:"Add graph series",showSeriesIndicator:!1,showNestedArrow:!0,hideRename:!0,entitiesLimit:1,mathAvailability:Qt.b.None,propertiesTaxonomicGroupTypes:[ce.a.EventProperties,ce.a.PersonProperties,ce.a.EventFeatureFlags,ce.a.Cohorts,ce.a.Elements]})}}),Object(e.jsxs)("span",{children:["trailing 7 day average is\xA0",l[y]!==void 0?Object(e.jsx)("b",{children:l[y]}):Object(e.jsx)(Oe.a,{}),". Trigger when trailing average is"]}),Object(e.jsx)(ae.a,{name:"operator",children:B=>{let{value:L,onChange:k}=B;return Object(e.jsx)(G.LemonSelect,{value:L,onChange:k,options:[{label:"greater than",value:"gt"},{label:"less than",value:"lt"}]})}}),Object(e.jsx)(ae.a,{name:"threshold",children:Object(e.jsx)(G.LemonInput,{min:0,type:"number"})})]}):a?Object(e.jsx)("div",{children:Object(e.jsxs)(p.a,{align:"middle",children:[r?Object(e.jsxs)("span",{children:[Object(e.jsxs)("b",{children:[Object(T.R)(r)," "]})," sentry errors in the past 24 hours."," "]}):Object(e.jsx)(Oe.a,{}),Object(e.jsx)("span",{children:"\xA0Trigger when there is a"}),Object(e.jsx)(ae.a,{name:"threshold",className:"ml-3 mr-3",children:B=>{let{value:L,onChange:k}=B;return Object(e.jsx)(G.LemonInput,{value:L,suffix:Object(e.jsx)(e.Fragment,{children:"%"}),type:"number",min:0,onChange:k})}}),Object(e.jsx)(ae.a,{name:"operator",className:"mr-3",children:B=>{let{value:L,onChange:k}=B;return Object(e.jsx)(G.LemonSelect,{options:[{label:"increase",value:"gt"},{label:"decrease",value:"lt"}],value:L,onChange:k})}}),Object(e.jsxs)("span",{children:["to"," ",r?Object(e.jsx)("b",{children:Object(T.R)(Math.round(r*(1+(o.rollback_conditions[y].threshold||0)/100)))}):Object(e.jsx)(Oe.a,{})," ","errors."]}),Object(e.jsx)("div",{})]})}):_!=null&&_.is_staff?Object(e.jsxs)("div",{className:"mt-4",children:[Object(e.jsx)("b",{children:"This feature requires an active Sentry integration."}),Object(e.jsx)("br",{}),Object(e.jsx)(G.Link,{to:C.a.instanceSettings(),children:"Go to Instance Settings"})," and update the"," ",Object(e.jsx)("code",{children:'"SENTRY_"'})," properties from your Sentry account to enable."]}):Object(e.jsx)("p",{className:"text-muted",children:"This PostHog instance is not configured for Sentry. Please contact the instance owner to configure it."})]})})]})),!s&&Object(e.jsx)(G.LemonButton,{type:"secondary",onClick:()=>{c()},children:"Add condition"})]})}try{_e.displayName="FeatureFlagAutoRollback",_e.__docgenInfo={description:"",displayName:"FeatureFlagAutoRollback",props:{readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagAutoRollout.tsx#FeatureFlagAutoRollback"]={docgenInfo:_e.__docgenInfo,name:"FeatureFlagAutoRollback",path:"frontend/src/scenes/feature-flags/FeatureFlagAutoRollout.tsx#FeatureFlagAutoRollback"})}catch(t){}var Xt=n("./frontend/src/scenes/project-homepage/RecentRecordings.tsx"),Zt=n("./frontend/src/scenes/session-recordings/player/modal/SessionPlayerModal.tsx"),qt=n("./frontend/src/scenes/session-recordings/playlist/sessionRecordingsListLogic.ts");const Ke=t=>({events:Lt(t).events});function Be(t){let{flagKey:s}=t;const{currentTeam:o}=Object(i.useValues)(W.a),a=Object(qt.e)({key:`feature-flag-${s}`,filters:Ke(s)}),{sessionRecordings:r,sessionRecordingsResponseLoading:l,filters:c}=Object(i.useValues)(a);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Zt.a,{}),Object(e.jsx)(ft.a,{title:"Recordings with current feature flag",viewAllURL:C.a.sessionRecordings(void 0,c),loading:l,emptyMessage:o!=null&&o.session_recording_opt_in?{title:"There are no recordings for this project",description:"Make sure you have the javascript snippet setup in your website.",buttonText:"Learn more",buttonTo:"https://posthog.com/docs/user-guides/recordings"}:{title:"Recordings are not enabled for this project",description:"Once recordings are enabled, new recordings will display here.",buttonText:"Enable recordings",buttonTo:C.a.projectSettings()+"#recordings"},items:r.slice(0,5),renderRow:(d,h)=>Object(e.jsx)(Xt.b,{recording:d},h)})]})}try{Be.displayName="FeatureFlagRecordings",Be.__docgenInfo={description:"",displayName:"FeatureFlagRecordings",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#FeatureFlagRecordings"]={docgenInfo:Be.__docgenInfo,name:"FeatureFlagRecordings",path:"frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#FeatureFlagRecordings"})}catch(t){}try{Ke.displayName="filtersForFlag",Ke.__docgenInfo={description:"",displayName:"filtersForFlag",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#filtersForFlag"]={docgenInfo:Ke.__docgenInfo,name:"filtersForFlag",path:"frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#filtersForFlag"})}catch(t){}var es=n("./frontend/src/scenes/billing/billingLogic.ts"),ts=n("./frontend/src/scenes/events/index.ts"),ss=n("./frontend/src/lib/components/PropertyFilters/utils.ts"),ns=n("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),jt=n("./frontend/src/lib/components/TitleWithIcon.tsx"),bt=n("./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx");function ke(t){return t.map(s=>({key:s.id,label:`${s.name}`,labelComponent:Object(e.jsx)("span",{children:Object(e.jsx)("b",{children:`${s.name}`})})}))}function Xe(t){let{title:s,visible:o,onClose:a,rolesToAdd:r,addableRoles:l,onChange:c,addableRolesLoading:d,onAdd:h,roles:_,deleteAssociatedRole:f,canEdit:y}=t;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(G.LemonModal,{title:s,isOpen:o,onClose:a,children:Object(e.jsx)(be,{resourceType:m.T.FEATURE_FLAGS,onChange:c,rolesToAdd:r,addableRoles:l,addableRolesLoading:d,onAdd:h,roles:_,deleteAssociatedRole:f,canEdit:y})})})}function be(t){let{rolesToAdd:s,addableRoles:o,onChange:a,addableRolesLoading:r,onAdd:l,roles:c,deleteAssociatedRole:d,resourceType:h,canEdit:_}=t;const{allPermissions:f,shouldShowPermissionsTable:y}=Object(i.useValues)(bt.b),{roles:B}=Object(i.useValues)(rt.a),L=f.find(ee=>ee.resource===h),k=B.filter(ee=>ee.feature_flags_access_level===m.a.WRITE),q=[{title:"Role",dataIndex:"name",key:"name",render:function(te,U){return Object(e.jsx)(e.Fragment,{children:U.name==="Organization default"?Object(e.jsx)(jt.a,{icon:Object(e.jsx)(G.LemonButton,{icon:Object(e.jsx)($.IconSettings,{}),to:`${C.a.organizationSettings()}?tab=role_based_access`,status:"stealth",targetBlank:!0,size:"small",noPadding:!0,tooltip:"Organization-wide permissions for roles can be managed in the organization settings.",className:"ml-1"}),children:"All users by default"}):U.name})}},{title:"Access",dataIndex:"feature_flags_access_level",key:"feature_flags_access_level",render:function(te,U){return Object(e.jsxs)("div",{className:"flex flex-row justify-between",children:[U.feature_flags_access_level===m.a.WRITE?"Edit":"View",U.deletable&&Object(e.jsx)(G.LemonButton,{icon:Object(e.jsx)($.IconDelete,{}),onClick:()=>d(U.id),tooltip:"Remove custom role from feature flag",tooltipPlacement:"bottomLeft",status:"primary-alt",type:"tertiary",size:"small"})]})}}],Q=[{id:"",name:"Organization default",feature_flags_access_level:L?L.access_level:m.a.WRITE,created_by:null,created_at:""},...k,...c.map(ee=>I(F({},ee),{feature_flags_access_level:m.a.WRITE,deletable:!0}))];return Object(e.jsxs)(e.Fragment,{children:[!y&&Object(e.jsxs)(e.Fragment,{children:[L&&Object(e.jsx)(as,{resourceLevel:L}),Object(e.jsx)(os,{roles:k})]}),y&&Object(e.jsx)(G.LemonTable,{dataSource:Q,columns:q,className:"mt-4"}),!y&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{className:"mt-4",children:"Roles"}),c.length>0?Object(e.jsx)("div",{className:"pb-2 rounded overflow-y-auto",style:{maxHeight:300},children:c.map(ee=>Object(e.jsx)(rs,{role:ee,deleteRole:te=>d(te)},ee.id))}):Object(e.jsx)("div",{className:"text-muted mb-2",children:"No roles added yet"})]}),_&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{className:"mt-4",children:"Custom edit roles"}),Object(e.jsxs)("div",{className:"flex gap-2",children:[Object(e.jsx)("div",{className:"flex-1",children:Object(e.jsx)(ns.a,{placeholder:"Search for roles to add\u2026",loading:r,onChange:a,value:s,filterOption:!0,mode:"multiple","data-attr":"resource-permissioning-select",options:ke(o)})}),Object(e.jsx)(G.LemonButton,{type:"primary",loading:!1,disabled:s.length===0,onClick:l,children:"Add"})]})]})]})}function as(t){let{resourceLevel:s}=t;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(jt.a,{icon:Object(e.jsx)(G.LemonButton,{icon:Object(e.jsx)($.IconSettings,{}),to:`${C.a.organizationSettings()}?tab=role_based_access`,status:"stealth",targetBlank:!0,size:"small",noPadding:!0,className:"ml-1"}),children:Object(e.jsx)("h5",{children:"Organization default"})}),Object(e.jsx)("b",{children:bt.a[s.access_level]})]})}function os(t){let{roles:s}=t;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{className:"mt-4",children:"Roles with edit access"}),Object(e.jsx)(p.a,{children:s.map(o=>Object(e.jsxs)("span",{className:"simple-tag tag-light-blue text-primary-alt mr-2",children:[Object(e.jsx)("b",{children:o.name})," "]},o.id))})]})}function rs(t){let{role:s,deleteRole:o}=t;return Object(e.jsxs)("div",{className:"flex items-center justify-between h-8",children:[Object(e.jsx)("b",{children:s.name}),o&&Object(e.jsx)(G.LemonButton,{icon:Object(e.jsx)($.IconDelete,{}),onClick:()=>o(s.id),tooltip:"Remove role from permission",tooltipPlacement:"bottomLeft",status:"primary-alt",type:"tertiary",size:"small"})]})}try{ke.displayName="roleLemonSelectOptions",ke.__docgenInfo={description:"",displayName:"roleLemonSelectOptions",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/ResourcePermissionModal.tsx#roleLemonSelectOptions"]={docgenInfo:ke.__docgenInfo,name:"roleLemonSelectOptions",path:"frontend/src/scenes/ResourcePermissionModal.tsx#roleLemonSelectOptions"})}catch(t){}try{Xe.displayName="ResourcePermissionModal",Xe.__docgenInfo={description:"",displayName:"ResourcePermissionModal",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},addableRoles:{defaultValue:null,description:"",name:"addableRoles",required:!0,type:{name:"RoleType[]"}},addableRolesLoading:{defaultValue:null,description:"",name:"addableRolesLoading",required:!0,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: string[]) => void"}},rolesToAdd:{defaultValue:null,description:"",name:"rolesToAdd",required:!0,type:{name:"string[]"}},onAdd:{defaultValue:null,description:"",name:"onAdd",required:!0,type:{name:"() => void"}},roles:{defaultValue:null,description:"",name:"roles",required:!0,type:{name:"RoleType[]"}},deleteAssociatedRole:{defaultValue:null,description:"",name:"deleteAssociatedRole",required:!0,type:{name:"(id: string) => void"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"Resource"}},canEdit:{defaultValue:null,description:"",name:"canEdit",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermissionModal"]={docgenInfo:Xe.__docgenInfo,name:"ResourcePermissionModal",path:"frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermissionModal"})}catch(t){}try{be.displayName="ResourcePermission",be.__docgenInfo={description:"",displayName:"ResourcePermission",props:{addableRoles:{defaultValue:null,description:"",name:"addableRoles",required:!0,type:{name:"RoleType[]"}},addableRolesLoading:{defaultValue:null,description:"",name:"addableRolesLoading",required:!0,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: string[]) => void"}},rolesToAdd:{defaultValue:null,description:"",name:"rolesToAdd",required:!0,type:{name:"string[]"}},onAdd:{defaultValue:null,description:"",name:"onAdd",required:!0,type:{name:"() => void"}},roles:{defaultValue:null,description:"",name:"roles",required:!0,type:{name:"RoleType[]"}},deleteAssociatedRole:{defaultValue:null,description:"",name:"deleteAssociatedRole",required:!0,type:{name:"(id: string) => void"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"Resource"}},canEdit:{defaultValue:null,description:"",name:"canEdit",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermission"]={docgenInfo:be.__docgenInfo,name:"ResourcePermission",path:"frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermission"})}catch(t){}var ht=n("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),Ze=n("./frontend/src/queries/schema.ts"),ls=n("./frontend/src/queries/Query/Query.tsx"),is=n("./frontend/src/queries/nodes/DataTable/utils.ts"),qe=n("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),cs=n("./frontend/src/models/tagsModel.ts");const ds={component:ve,logic:oe,paramsToProps:t=>{let{params:{id:s}}=t;return{id:s&&s!=="new"?parseInt(s):"new"}}};function Ot(t){setTimeout(()=>{var s;return(s=document.querySelector(`.variant-form-list input[data-key-index="${t}"]`))===null||s===void 0?void 0:s.focus()},50)}function ve(){var t;let{id:s}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{props:o,featureFlag:a,featureFlagLoading:r,featureFlagMissing:l,isEditingFlag:c}=Object(i.useValues)(oe),{featureFlags:d}=Object(i.useValues)(Ge.a),{deleteFeatureFlag:h,editFeatureFlag:_,loadFeatureFlag:f,triggerFeatureFlagUpdate:y}=Object(i.useActions)(oe),{addableRoles:B,unfilteredAddableRolesLoading:L,rolesToAdd:k,derivedRoles:q}=Object(i.useValues)(ze({flagId:a.id})),{setRolesToAdd:Q,addAssociatedRoles:ee,deleteAssociatedRole:te}=Object(i.useActions)(ze({flagId:a.id})),{tags:U}=Object(i.useValues)(cs.a),{hasAvailableFeature:xe}=Object(i.useValues)(Fe.a),[ye,Re]=Object(u.useState)(!1),[fe,M]=Object(u.useState)(Z.a.OVERVIEW),V=s==="new"||s===void 0;return l?Object(e.jsx)(Gt.a,{object:"feature flag"}):r?Object(e.jsx)(Oe.b,{}):Object(e.jsx)(e.Fragment,{children:Object(e.jsx)("div",{className:"feature-flag",children:V||c?Object(e.jsxs)(N.Form,{logic:oe,props:o,formKey:"featureFlag",enableFormOnSubmit:!0,className:"space-y-4",children:[Object(e.jsx)(ct.a,{title:V?"New feature flag":a.key||"Untitled",buttons:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)(se.a,{"data-attr":"cancel-feature-flag",type:"secondary",onClick:()=>{c?(_(!1),f()):J.router.actions.push(C.a.featureFlags())},disabled:r,children:"Cancel"}),Object(e.jsx)(se.a,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:r,disabled:r,children:"Save"})]})}),Object(e.jsx)(X.a,{}),a.experiment_set&&((t=a.experiment_set)===null||t===void 0?void 0:t.length)>0&&Object(e.jsxs)(pt.a,{type:"warning",children:["This feature flag is linked to an experiment. It's recommended to only make changes to this flag"," ",Object(e.jsx)(Pe.a,{to:C.a.experiment(a.experiment_set[0]),children:"using the experiment creation screen."})]}),Object(e.jsx)(wt.a,{additionalInfo:", meaning it can take around 60 seconds for some flags to update for recently-identified persons. To sidestep this, you can choose to override server properties when requesting the feature flag"}),Object(e.jsxs)(p.a,{gutter:16,style:{marginBottom:32},children:[Object(e.jsxs)(j.a,{span:12,className:"space-y-4",children:[Object(e.jsx)(ae.a,{name:"key",label:"Key",help:ye&&s!=="new"?Object(e.jsxs)("span",{className:"text-warning",children:[Object(e.jsx)("b",{children:"Warning! "}),"Changing this key will",Object(e.jsxs)("a",{href:`https://posthog.com/docs/features/feature-flags${me}#feature-flag-persistence`,target:"_blank",rel:"noopener",children:[" ","affect the persistence of your flag ",Object(e.jsx)($.IconOpenInNew,{})]})]}):void 0,children:z=>{let{value:Y,onChange:re}=z;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ne.a,{value:Y,onChange:ue=>{ue!==Y&&Re(!0),re(ue)},"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}),Object(e.jsx)("span",{style:{fontSize:13},className:"text-muted",children:"Feature flag keys must be unique"})]})}}),Object(e.jsx)(ae.a,{name:"name",label:"Description",children:Object(e.jsx)(Ut.a,{className:"ph-ignore-input","data-attr":"feature-flag-description",defaultValue:a.name||""})}),xe(m.e.TAGGING)&&Object(e.jsx)(ae.a,{name:"tags",label:"Tags",children:z=>{let{value:Y,onChange:re}=z;return Object(e.jsx)(qe.a,{tags:Y,onChange:(ue,pe)=>re(pe),saving:r,tagsAvailable:U.filter(ue=>{var pe;return!((pe=a.tags)!==null&&pe!==void 0&&pe.includes(ue))}),className:"insight-metadata-tags"})}}),Object(e.jsx)(ae.a,{name:"ensure_experience_continuity",children:z=>{let{value:Y,onChange:re}=z;return Object(e.jsxs)("div",{className:"border rounded p-4",children:[Object(e.jsx)(ut.a,{id:"continuity-checkbox",label:"Persist flag across authentication steps",onChange:()=>re(!Y),fullWidth:!0,checked:Y}),Object(e.jsxs)("div",{className:"text-muted text-sm pl-7",children:["If your feature flag is applied prior to an identify or authentication event, use this to ensure that feature flags are not reset after a person is identified. This ensures the experience for the anonymous person is carried forward to the authenticated person."," ",Object(e.jsxs)(Pe.a,{to:"https://posthog.com/manual/feature-flags#persisting-feature-flags-across-authentication-steps",target:"_blank",children:["Learn more ",Object(e.jsx)($.IconOpenInNew,{})]})]})]})}}),Object(e.jsx)(ae.a,{name:"active",children:z=>{let{value:Y,onChange:re}=z;return Object(e.jsx)("div",{className:"border rounded p-4",children:Object(e.jsx)(ut.a,{id:"flag-enabled-checkbox",label:"Enable feature flag",onChange:()=>re(!Y),checked:Y})})}})]}),Object(e.jsx)(j.a,{span:12,children:Object(e.jsx)(he,{featureFlagKey:a.key||"my-flag"})})]}),Object(e.jsx)(X.a,{}),Object(e.jsx)(_t,{}),Object(e.jsx)(X.a,{}),Object(e.jsx)(vt,{}),Object(e.jsx)(X.a,{}),d[le.i.AUTO_ROLLBACK_FEATURE_FLAGS]&&Object(e.jsx)(_e,{}),V&&d[le.i.ROLE_BASED_ACCESS]&&Object(e.jsx)(D.a,{title:"Permissions",className:"mb-4",children:Object(e.jsx)(ht.a,{feature:m.e.ROLE_BASED_ACCESS,children:Object(e.jsx)(be,{resourceType:m.T.FEATURE_FLAGS,onChange:z=>Q(z),rolesToAdd:k,addableRoles:B,addableRolesLoading:L,onAdd:()=>ee(),roles:q,deleteAssociatedRole:z=>te({roleId:z}),canEdit:a.can_edit})})}),Object(e.jsx)(de.a,{className:"mt-8"}),Object(e.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[Object(e.jsx)(se.a,{"data-attr":"cancel-feature-flag",type:"secondary",onClick:()=>{c?(_(!1),f()):J.router.actions.push(C.a.featureFlags())},disabled:r,children:"Cancel"}),Object(e.jsx)(se.a,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:r,disabled:r,children:"Save"})]})]}):Object(e.jsx)(e.Fragment,{children:r?Object(e.jsx)(w.a,{active:!0}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(ct.a,{title:Object(e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.key||"Untitled",Object(e.jsx)(mt.a,{explicitValue:a.key,iconStyle:{color:"var(--muted-alt)"}}),Object(e.jsx)("div",{className:"flex",children:a.active?Object(e.jsx)(gt.a,{type:"success",className:"uppercase",children:"Enabled"}):Object(e.jsx)(gt.a,{type:"default",className:"uppercase",children:"Disabled"})})]}),description:Object(e.jsx)(e.Fragment,{children:a.name?Object(e.jsx)("span",{style:{fontStyle:"normal"},children:a.name}):"There is no description for this feature flag."}),caption:Object(e.jsx)(e.Fragment,{children:(a==null?void 0:a.tags)&&Object(e.jsx)(e.Fragment,{children:a.can_edit?Object(e.jsx)(qe.a,{tags:a.tags,onChange:(z,Y)=>{y({tags:Y})},saving:r,tagsAvailable:U.filter(z=>{var Y;return!((Y=a.tags)!==null&&Y!==void 0&&Y.includes(z))}),className:"insight-metadata-tags"}):a.tags.length?Object(e.jsx)(qe.a,{tags:a.tags,saving:r,staticOnly:!0,className:"insight-metadata-tags"}):null})}),buttons:Object(e.jsx)(e.Fragment,{children:Object(e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[Object(e.jsx)(se.a,{"data-attr":"delete-feature-flag",status:"danger",type:"secondary",onClick:()=>{h(a)},disabled:r||!a.can_edit,children:"Delete feature flag"}),Object(e.jsx)(se.a,{"data-attr":"edit-feature-flag",type:"secondary",tooltip:d[le.i.ROLE_BASED_ACCESS]&&!a.can_edit&&"You have only 'View' access for this feature flag. To make changes, please contact the flag's creator.",onClick:()=>{_(!0)},disabled:r||!a.can_edit,children:"Edit"})]})})}),Object(e.jsxs)(P.a,{activeKey:fe,destroyInactiveTabPane:!0,onChange:z=>M(z),children:[Object(e.jsx)(P.a.TabPane,{tab:"Overview",children:Object(e.jsxs)(p.a,{children:[Object(e.jsxs)(j.a,{span:13,children:[Object(e.jsx)(_t,{readOnly:!0}),Object(e.jsx)(vt,{readOnly:!0}),d[le.i.AUTO_ROLLBACK_FEATURE_FLAGS]&&Object(e.jsx)(_e,{readOnly:!0})]}),Object(e.jsxs)(j.a,{span:11,className:"pl-4",children:[Object(e.jsx)(Ht,{}),Object(e.jsx)("div",{className:"my-4"}),d[le.i.RECORDINGS_ON_FEATURE_FLAGS]?Object(e.jsx)(Be,{flagKey:a.key||"my-flag"}):Object(e.jsx)(he,{featureFlagKey:a.key||"my-flag"})]})]})},"overview"),d[le.i.EXPOSURES_ON_FEATURE_FLAGS]&&a.key&&s&&Object(e.jsx)(P.a.TabPane,{tab:"Exposures",children:Object(e.jsx)(us,{id:s,featureFlagKey:a.key})},"exposure"),a.id&&Object(e.jsx)(P.a.TabPane,{tab:"History",children:Object(e.jsx)($t.a,{scope:Vt.a.FEATURE_FLAG,id:a.id})},"history"),d[le.i.ROLE_BASED_ACCESS]&&a.can_edit&&Object(e.jsx)(P.a.TabPane,{tab:"Permissions",children:Object(e.jsx)(ht.a,{feature:m.e.ROLE_BASED_ACCESS,children:Object(e.jsx)(be,{resourceType:m.T.FEATURE_FLAGS,onChange:z=>Q(z),rolesToAdd:k,addableRoles:B,addableRolesLoading:L,onAdd:()=>ee(),roles:q,deleteAssociatedRole:z=>te({roleId:z}),canEdit:a.can_edit})})},"permissions")]})]})})})})}function us(t){let{id:s,featureFlagKey:o}=t;const{featureFlags:a}=Object(i.useValues)(Ge.a);return a[le.i.DATA_EXPLORATION_LIVE_EVENTS]?Object(e.jsx)(ls.a,{query:{kind:Ze.a.DataTableNode,source:{kind:Ze.a.EventsQuery,select:Object(is.a)(Ze.a.EventsQuery),event:"$feature_flag_called",properties:He(o)},full:!0,showEventFilter:!1,showPropertyFilter:!1}}):Object(e.jsx)(ts.b,{fixedFilters:{event_filter:"$feature_flag_called",properties:He(o)},sceneUrl:C.a.featureFlag(s),fetchMonths:3,pageKey:`feature-flag-${o}}`,showEventFilter:!1,showPropertyFilter:!1})}function _t(t){let{readOnly:s}=t;const{multivariateEnabled:o,variants:a,areVariantRolloutsValid:r,featureFlagLoading:l,variantRolloutSum:c,nonEmptyVariants:d,aggregationTargetName:h,featureFlag:_}=Object(i.useValues)(oe),{distributeVariantsEqually:f,addVariant:y,removeVariant:B,setMultivariateEnabled:L}=Object(i.useActions)(oe),[k,q]=Object(u.useState)(!1),{hasAvailableFeature:Q}=Object(i.useValues)(Fe.a),{upgradeLink:ee}=Object(i.useValues)(es.a);return Object(e.jsxs)(e.Fragment,{children:[s?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex flex-col mb-4",children:[Object(e.jsx)("span",{className:"card-secondary",children:"Type"}),Object(e.jsx)("span",{children:_.filters.multivariate?"Multiple variants with rollout percentages (A/B/C test)":"Release toggle (boolean)"}),Object(e.jsx)("span",{className:"card-secondary mt-4",children:"Flag persistence"}),Object(e.jsxs)("span",{children:["This flag"," ",Object(e.jsxs)("b",{children:[_.ensure_experience_continuity?"persists":"does not persist"," "]}),"across authentication events."]})]}),Object(e.jsx)(de.a,{className:"my-3"}),_.filters.multivariate&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("div",{className:"mb-2",children:Object(e.jsx)("b",{children:"Variant keys"})}),Object(e.jsxs)("div",{className:"border rounded p-4 mb-4",children:[Object(e.jsxs)(p.a,{className:"font-semibold",children:[Object(e.jsx)(j.a,{span:10,children:"Key"}),Object(e.jsx)(j.a,{span:11,children:"Description"}),Object(e.jsx)(j.a,{span:3,children:"Rollout"})]}),Object(e.jsx)(de.a,{className:"my-3"}),a.map((te,U)=>Object(e.jsxs)("div",{children:[Object(e.jsxs)(p.a,{children:[Object(e.jsxs)(j.a,{span:10,children:[Object(e.jsx)(De.a,{name:T.c[U],color:De.b.Gray}),Object(e.jsx)(mt.a,{tooltipMessage:null,description:"key",style:{marginLeft:"0.5rem"},iconStyle:{color:"var(--muted-alt)"},children:te.key})]}),Object(e.jsx)(j.a,{span:12,children:te.name||"There is no description for this variant key"}),Object(e.jsxs)(j.a,{span:2,children:[te.rollout_percentage,"%"]})]}),U!==a.length-1&&Object(e.jsx)(de.a,{className:"my-3"})]},U))]})]})]}):Object(e.jsxs)("div",{className:"mb-8",children:[Object(e.jsx)("h3",{className:"l4",children:"Served value"}),Object(e.jsx)("div",{className:"mb-2",children:Object(e.jsx)(b.a,{placement:"top",title:"Change value type? The variants below will be lost.",disabled:l,visible:k,onConfirm:()=>{L(!1),q(!1)},onCancel:()=>q(!1),okText:"OK",cancelText:"Cancel",children:Object(e.jsx)(O.a.Group,{options:[{label:"Release toggle (boolean)",value:!1},{label:Object(e.jsx)(Bt.a,{title:Q(m.e.MULTIVARIATE_FLAGS)?"":"This feature is not available on your current plan.",children:Object(e.jsxs)("div",{children:[!Q(m.e.MULTIVARIATE_FLAGS)&&Object(e.jsx)(Pe.a,{to:ee,target:"_blank",children:Object(e.jsx)(R.a,{style:{marginRight:4,color:"var(--warning)"}})}),"Multiple variants with rollout percentages (A/B test)"]})}),value:!0,disabled:!Q(m.e.MULTIVARIATE_FLAGS)}],onChange:te=>{const{value:U}=te.target;U===!1&&d.length?q(!0):(L(U),Ot(0))},value:o,optionType:"button"})})}),Object(e.jsxs)("div",{className:"text-muted mb-4",children:[Object(T.i)(h)," will be served"," ",o?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("strong",{children:"a variant key"})," according to the below distribution"]}):Object(e.jsx)("strong",{children:Object(e.jsx)("code",{children:"true"})})," ","if they match one or more release condition groups."]})]}),!s&&o&&Object(e.jsxs)("div",{className:"feature-flag-variants",children:[Object(e.jsx)("h3",{className:"l4",children:"Variant keys"}),Object(e.jsx)("span",{children:"The rollout percentage of feature flag variants must add up to 100%"}),Object(e.jsxs)("div",{className:"variant-form-list space-y-2",children:[Object(e.jsxs)(p.a,{gutter:8,className:"label-row",children:[Object(e.jsx)(j.a,{span:1}),Object(e.jsx)(j.a,{span:6,children:"Variant key"}),Object(e.jsx)(j.a,{span:12,children:"Description"}),Object(e.jsxs)(j.a,{span:4,children:["Rollout",Object(e.jsx)(se.a,{type:"tertiary",onClick:f,children:"(Redistribute)"})]})]}),a.map((te,U)=>Object(e.jsx)(N.Group,{name:["filters","multivariate","variants",U],children:Object(e.jsxs)(p.a,{gutter:8,align:"middle",children:[Object(e.jsx)(j.a,{span:1,children:Object(e.jsx)(De.a,{name:T.c[U],color:De.b.Gray})}),Object(e.jsx)(j.a,{span:6,children:Object(e.jsx)(ae.a,{name:"key",children:Object(e.jsx)(Ne.a,{"data-attr":"feature-flag-variant-key","data-key-index":U.toString(),className:"ph-ignore-input",placeholder:`example-variant-${U+1}`,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})}),Object(e.jsx)(j.a,{span:12,children:Object(e.jsx)(ae.a,{name:"name",children:Object(e.jsx)(Ne.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"})})}),Object(e.jsx)(j.a,{span:3,children:Object(e.jsx)(ae.a,{name:"rollout_percentage",children:xe=>{let{value:ye,onChange:Re}=xe;return Object(e.jsx)(Ne.a,{type:"number",min:0,max:100,value:ye,onChange:fe=>{if(fe!=null){const M=parseInt(fe.toString());isNaN(M)||Re(M)}}})}})}),Object(e.jsx)(j.a,{span:2,children:Object(e.jsx)(p.a,{children:a.length>1&&Object(e.jsx)(se.a,{icon:Object(e.jsx)($.IconDelete,{}),status:"primary-alt","data-attr":`delete-prop-filter-${U}`,noPadding:!0,onClick:()=>B(U)})})})]})},U)),a.length>0&&!r&&Object(e.jsxs)("p",{className:"text-danger",children:["Percentage rollouts for variants must sum to 100 (currently ",c,")."]}),Object(e.jsx)(se.a,{type:"secondary",onClick:()=>{const te=a.length;y(),Ot(te)},icon:Object(e.jsx)($.IconPlus,{}),center:!0,children:"Add variant"})]})]})]})}function vt(t){var s,o;let{readOnly:a}=t;const{showGroupsOptions:r,aggregationLabel:l}=Object(i.useValues)(ie.a),{aggregationTargetName:c,featureFlag:d,groupTypes:h,taxonomicGroupTypes:_,nonEmptyVariants:f,propertySelectErrors:y,computeBlastRadiusPercentage:B,affectedUsers:L,totalUsers:k}=Object(i.useValues)(oe),{setAggregationGroupTypeIndex:q,updateConditionSet:Q,duplicateConditionSet:ee,removeConditionSet:te,addConditionSet:U}=Object(i.useActions)(oe),{cohortsById:xe}=Object(i.useValues)(Yt.a),{featureFlags:ye}=Object(i.useValues)(Ge.a),Re=Me({value:-2}),fe=M=>!!M.find(V=>V.type==="cohort"||!le.l.includes(V.key||""));return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"feature-flag-form-row",children:[Object(e.jsx)("div",{"data-attr":"feature-flag-release-conditions",children:a?Object(e.jsx)("div",{className:"mb-2",children:Object(e.jsx)("b",{children:"Release conditions"})}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h3",{className:"l4",children:"Release conditions"}),Object(e.jsxs)("div",{className:"text-muted mb-4",children:["Specify the ",c," to which you want to release this flag. Note that condition sets are rolled out independently of each other."]})]})}),!a&&r&&Object(e.jsxs)("div",{className:"centered",children:["Match by",Object(e.jsxs)(E.a,{value:((s=d.filters)===null||s===void 0?void 0:s.aggregation_group_type_index)!=null?(o=d.filters)===null||o===void 0?void 0:o.aggregation_group_type_index:-1,onChange:M=>{q(M!==-1?M:null)},style:{marginLeft:8},"data-attr":"feature-flag-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]},children:[Object(e.jsx)(E.a.Option,{value:-1,children:"Users"},-1),h.map(M=>Object(e.jsx)(E.a.Option,{value:M.group_type_index,children:Object(T.i)(l(M.group_type_index).plural)},M.group_type_index)),Re]})]})]}),Object(e.jsx)(p.a,{gutter:16,children:d.filters.groups.map((M,V)=>{var z,Y,re,ue,pe,et,tt;return Object(e.jsxs)(j.a,{span:24,md:24,children:[V>0&&Object(e.jsx)("div",{className:"condition-set-separator",children:"OR"}),Object(e.jsxs)("div",{className:"mb-4 border rounded p-4",children:[Object(e.jsxs)(p.a,{align:"middle",justify:"space-between",children:[Object(e.jsxs)(p.a,{align:"middle",children:[Object(e.jsxs)("span",{className:"simple-tag tag-light-blue font-medium mr-2",children:["Set ",V+1]}),Object(e.jsx)("div",{children:(z=M.properties)!==null&&z!==void 0&&z.length?Object(e.jsx)(e.Fragment,{children:a?Object(e.jsxs)(e.Fragment,{children:["Match ",Object(e.jsx)("b",{children:c})," against ",Object(e.jsx)("b",{children:"all"})," criteria"]}):Object(e.jsxs)(e.Fragment,{children:["Matching ",Object(e.jsx)("b",{children:c})," against the criteria"]})}):Object(e.jsxs)(e.Fragment,{children:["Condition set will match ",Object(e.jsxs)("b",{children:["all ",c]})]})})]}),!a&&Object(e.jsxs)(p.a,{children:[Object(e.jsx)(se.a,{icon:Object(e.jsx)($.IconCopy,{}),status:"muted",noPadding:!0,onClick:()=>ee(V)}),d.filters.groups.length>1&&Object(e.jsx)(se.a,{icon:Object(e.jsx)($.IconDelete,{}),status:"muted",noPadding:!0,onClick:()=>te(V)})]})]}),Object(e.jsx)(de.a,{className:"my-3"}),!a&&fe(M.properties)&&Object(e.jsxs)(pt.a,{type:"info",className:"mt-3 mb-3",children:["These properties aren't immediately available on first page load for unidentified persons. This feature flag requires that at least one event is sent prior to becoming available to your product or website."," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/integrate/client/js#bootstrapping-flags",target:"_blank",children:[" ","Learn more about how to make feature flags available instantly."]})]}),a?Object(e.jsx)(e.Fragment,{children:M.properties.map((H,Ue)=>Object(e.jsx)(e.Fragment,{children:Object(e.jsxs)("div",{className:"feature-flag-property-display",children:[Ue===0?Object(e.jsx)(se.a,{icon:Object(e.jsx)($.IconSubArrowRight,{className:"arrow-right"}),status:"muted",size:"small"}):Object(e.jsx)(se.a,{icon:Object(e.jsx)("span",{className:"text-sm",children:"&"}),status:"muted",size:"small"}),Object(e.jsxs)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:[H.type==="cohort"?"Cohort":H.key," "]}),Object(ss.d)(H)?Object(e.jsxs)("span",{children:[Object(zt.a)(H.operator)," "]}):null,[...Array.isArray(H.value)?H.value:[H.value]].map((we,ps)=>{var st;return Object(e.jsx)("span",{className:"simple-tag tag-light-blue text-primary-alt display-value",children:H.type==="cohort"?we&&((st=xe[we])===null||st===void 0?void 0:st.name)||`ID ${we}`:we},ps)})]},Ue)}))}):Object(e.jsx)("div",{children:Object(e.jsx)(A.a,{orFiltering:!0,pageKey:`feature-flag-${d.id}-${V}-${d.filters.groups.length}-${(Y=d.filters.aggregation_group_type_index)!==null&&Y!==void 0?Y:""}`,propertyFilters:M==null?void 0:M.properties,logicalRowDivider:!0,addButton:Object(e.jsx)(se.a,{icon:Object(e.jsx)($.IconPlusMini,{}),noPadding:!0,children:"Add condition"}),onChange:H=>Q(V,void 0,H),taxonomicGroupTypes:_,hasRowOperator:!1,sendAllKeyUpdates:!0,errorMessages:y!=null&&(re=y[V])!==null&&re!==void 0&&(ue=re.properties)!==null&&ue!==void 0&&ue.some(H=>!!H.value)?y[V].properties.map((H,Ue)=>H.value?Object(e.jsxs)("div",{className:"text-danger flex items-center gap-1 text-sm",children:[Object(e.jsx)($.IconErrorOutline,{className:"text-xl"})," ",H.value]},Ue):Object(e.jsx)(e.Fragment,{})):null})}),(!a||a&&((pe=M.properties)===null||pe===void 0?void 0:pe.length)>0)&&Object(e.jsx)(de.a,{className:"my-3"}),a?Object(e.jsxs)("div",{children:["Rolled out to"," ",Object(e.jsxs)("b",{children:[M.rollout_percentage!=null?M.rollout_percentage:100,"%"]})," of"," ",Object(e.jsx)("b",{children:c})," in this set."," "]}):Object(e.jsx)("div",{className:"feature-flag-form-row",children:Object(e.jsxs)("div",{className:"centered",children:["Roll out to"," ",Object(e.jsx)(v.a,{style:{width:100,marginLeft:8,marginRight:8},onChange:H=>{Q(V,H)},value:M.rollout_percentage!=null?M.rollout_percentage:100,min:0,max:100,addonAfter:"%"})," ","of ",Object(e.jsx)("b",{children:c})," in this set."," ",ye[le.i.FEATURE_FLAG_ROLLOUT_UX]&&Object(e.jsxs)(e.Fragment,{children:["Will match approximately"," ",L[V]!==void 0?Object(e.jsx)("b",{children:`${B(M.rollout_percentage,V).toPrecision(2)*1}% `}):Object(e.jsx)(Oe.a,{className:"mr-1"})," ",L[V]&&L[V]>=0&&k?`(${Object(T.R)(Math.floor(L[V]*((et=M.rollout_percentage)!==null&&et!==void 0?et:100)/100))} / ${Object(T.R)(k)})`:""," ","of total ",c,"."]})]})}),f.length>0&&Object(e.jsxs)(e.Fragment,{children:[(!a||a&&((tt=M.properties)===null||tt===void 0?void 0:tt.length)>0)&&Object(e.jsx)(de.a,{className:"my-3"}),a?Object(e.jsxs)("div",{children:["All ",Object(e.jsx)("b",{children:c})," in this set"," ",M.variant?Object(e.jsxs)(e.Fragment,{children:[" ","will be in variant ",Object(e.jsx)("b",{children:M.variant})]}):Object(e.jsx)(e.Fragment,{children:"have no variant override"})]}):Object(e.jsx)("div",{className:"feature-flag-form-row",children:Object(e.jsxs)("div",{className:"centered",children:[Object(e.jsx)("b",{children:"Optional override:"})," Set variant for all"," ",Object(e.jsx)("b",{children:c})," in this set to"," ",Object(e.jsx)(G.LemonSelect,{placeholder:"Select variant",allowClear:!0,value:M.variant,onChange:H=>Q(V,void 0,void 0,H),options:f.map(H=>({label:H.key,value:H.key})),"data-attr":"feature-flags-variant-override-select"})]})})]})]})]},`${V}-${d.filters.groups.length}`)})}),!a&&Object(e.jsx)(se.a,{type:"secondary",className:"mt-0",onClick:U,icon:Object(e.jsx)($.IconPlus,{}),children:"Add condition set"})]})}try{ve.displayName="FeatureFlag",ve.__docgenInfo={description:"",displayName:"FeatureFlag",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"]={docgenInfo:ve.__docgenInfo,name:"FeatureFlag",path:"frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"})}catch(t){}},"./frontend/src/scenes/organization/Settings/Permissions/Roles/rolesLogic.tsx":function(S,g,n){"use strict";n.d(g,"a",function(){return P});var u=n("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),N=n("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),X=n.n(N),p=n("./frontend/src/lib/api.ts"),j=n("./frontend/src/lib/utils/eventUsageLogic.ts"),D=n("./frontend/src/scenes/project/Settings/teamMembersLogic.tsx"),w=n("./frontend/src/types.ts");const P=Object(u.kea)([Object(u.path)(["scenes","organization","rolesLogic"]),Object(u.connect)({values:[D.b,["allMembers"]]}),Object(u.actions)({setCreateRoleModalShown:b=>({shown:b}),setRoleInFocus:b=>({role:b}),setRoleMembersInFocus:b=>({roleMembers:b}),setRoleMembersToAdd:b=>({uuids:b}),openCreateRoleModal:!0,setPermission:(b,O)=>({resource:b,access:O}),clearPermission:!0,updateRole:b=>({role:b})}),Object(u.reducers)({createRoleModalShown:[!1,{setCreateRoleModalShown:(b,O)=>{let{shown:E}=O;return E}}],roleInFocus:[null,{setRoleInFocus:(b,O)=>{let{role:E}=O;return E}}],roleMembersInFocus:[[],{setRoleMembersInFocus:(b,O)=>{let{roleMembers:E}=O;return E}}],roleMembersToAdd:[[],{setRoleMembersToAdd:(b,O)=>{let{uuids:E}=O;return E}}],roles:[[],{updateRole:(b,O)=>{let{role:E}=O;return b.map(v=>v.id==E.id?E:v)}}]}),Object(N.loaders)(b=>{let{values:O,actions:E}=b;return{roles:{loadRoles:()=>K(this,null,function*(){const v=yield p.b.roles.list();return(v==null?void 0:v.results)||[]}),createRole:v=>K(this,null,function*(){const{roles:i,roleMembersToAdd:T}=O,A=yield p.b.roles.create(v);return yield E.addRoleMembers({role:A,membersToAdd:T}),j.e.actions.reportRoleCreated(v),E.setRoleMembersInFocus([]),E.setRoleMembersToAdd([]),E.clearPermission(),E.setCreateRoleModalShown(!1),[A,...i]}),deleteRole:v=>K(this,null,function*(){return yield p.b.roles.delete(v.id),O.roles.filter(i=>i.id!==v.id)})},roleMembersInFocus:[[],{loadRoleMembers:v=>K(this,null,function*(){let{roleId:i}=v;const T=yield p.b.roles.members.list(i);return(T==null?void 0:T.results)||[]}),addRoleMembers:v=>K(this,null,function*(){let{role:i,membersToAdd:T}=v;const A=yield Promise.all(T.map(R=>K(this,null,function*(){return yield p.b.roles.members.create(i.id,R)})));return E.setRoleMembersToAdd([]),[...O.roleMembersInFocus,...A]}),deleteRoleMember:v=>K(this,null,function*(){let{roleMemberUuid:i}=v;return O.roleInFocus&&(yield p.b.roles.members.delete(O.roleInFocus.id,i)),O.roleMembersInFocus.filter(T=>T.id!==i)})}]}}),Object(u.listeners)(b=>{let{actions:O,values:E}=b;return{setRoleInFocus:v=>{let{role:i}=v;i&&O.loadRoleMembers({roleId:i.id}),O.setCreateRoleModalShown(!0)},openCreateRoleModal:()=>{O.setRoleInFocus(null),O.setRoleMembersInFocus([]),O.setCreateRoleModalShown(!0)},setCreateRoleModalShown:()=>{E.roleInFocus?O.setPermission(w.T.FEATURE_FLAGS,E.roleInFocus.feature_flags_access_level):O.setPermission(w.T.FEATURE_FLAGS,w.a.WRITE)},deleteRoleSuccess:()=>{O.setCreateRoleModalShown(!1)}}}),Object(u.selectors)({addableMembers:[b=>[b.allMembers,b.roleMembersInFocus],(b,O)=>{const E=[];for(const v of b)O.some(i=>i.user.uuid===v.user.uuid)||E.push(v.user);return E.sort((v,i)=>v.first_name.localeCompare(i.first_name)),E}]}),Object(u.afterMount)(b=>{let{actions:O}=b;O.loadRoles()})])},"./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx":function(S,g,n){"use strict";n.d(g,"a",function(){return v}),n.d(g,"b",function(){return T});var u=n("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),N=n("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),X=n.n(N),p=n("./frontend/src/lib/api.ts"),j=n("./frontend/src/types.ts"),D=n("./frontend/src/lib/logic/featureFlagLogic.ts"),w=n("./frontend/src/lib/constants.tsx"),P=n("./frontend/src/scenes/organization/Settings/Permissions/Roles/rolesLogic.tsx"),b=n("./frontend/@posthog/lemon-ui/src/index.ts"),O=n("./frontend/src/lib/utils/eventUsageLogic.ts");const E={[j.T.FEATURE_FLAGS]:"Feature Flags"},v={[j.a.WRITE]:"View & Edit",[j.a.READ]:"View Only"},i={[j.T.FEATURE_FLAGS]:"feature_flags_access_level"},T=Object(u.kea)([Object(u.path)(["scenes","organization","Settings","Permissions","permissionsLogic"]),Object(u.connect)({values:[D.a,["featureFlags"],P.a,["roles"]],actions:[P.a,["updateRole"]]}),Object(u.actions)({updatePermission:(A,R,m,x)=>({checked:A,role:R,resourceId:m,resourceType:x})}),Object(N.loaders)(A=>{let{values:R}=A;return{organizationResourcePermissions:[[],{loadOrganizationResourcePermissions:()=>K(this,null,function*(){const m=yield p.b.resourcePermissions.list();return(m==null?void 0:m.results)||[]}),updateOrganizationResourcePermission:m=>K(this,null,function*(){let{id:x,resource:J,access_level:C}=m;if(x){const W=yield p.b.resourcePermissions.update(x,{access_level:C});return R.organizationResourcePermissions.map(Z=>Z.id==W.id?W:Z)}else{const W=yield p.b.resourcePermissions.create({resource:J,access_level:C});return[...R.organizationResourcePermissions,W]}})}]}}),Object(u.listeners)(A=>{let{actions:R}=A;return{updatePermission:m=>K(this,null,function*(){let{checked:x,role:J,resourceId:C,resourceType:W}=m;const Z=x?j.a.WRITE:j.a.READ;if(J.id){const ie=yield p.b.roles.update(J.id,{[i[W]]:Z});ie&&(R.updateRole(ie),b.lemonToast.success(`${J.name} role ${W} edit access updated`))}else R.updateOrganizationResourcePermission({id:C,resource:W,access_level:Z});O.e.actions.reportResourceAccessLevelUpdated(W,J.name,Z)}),updateOrganizationResourcePermissionSuccess:()=>{b.lemonToast.success("Organizational edit access updated")}}}),Object(u.selectors)({organizationResourcePermissionsMap:[A=>[A.organizationResourcePermissions],A=>A.reduce((R,m)=>I(F({},R),{[m.resource]:m}),{})],allPermissions:[A=>[A.organizationResourcePermissionsMap],A=>Object.keys(E).map(R=>{var m,x;return{id:((m=A[R])===null||m===void 0?void 0:m.id)||null,resource:R,name:E[R],access_level:((x=A[R])===null||x===void 0?void 0:x.access_level)||j.a.WRITE}})],shouldShowPermissionsTable:[A=>[A.featureFlags],A=>A[w.i.ROLE_BASED_ACCESS]==="control"],resourceRolesAccess:[A=>[A.allPermissions,A.roles],(A,R)=>{const m=A.map(x=>({[x.resource]:{organization_default:x.access_level,id:x.id}}));for(const x of R)for(const J of m){const C=Object.keys(J)[0];J[C][`${x.name}`]=x[i[C]]}return m}]}),Object(u.afterMount)(A=>{let{actions:R}=A;R.loadOrganizationResourcePermissions()})])},"./frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx":function(S,g,n){"use strict";n.d(g,"a",function(){return D});var u=n("./frontend/@posthog/lemon-ui/src/index.ts"),N=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),X=n.n(N),p=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js"),j=n.n(p);function D(w){let{to:P,onClick:b,title:O,subtitle:E,prefix:v,suffix:i}=w;return Object(p.jsx)(u.LemonButton,{fullWidth:!0,to:P,onClick:b,children:Object(p.jsxs)("div",{className:"flex items-center justify-between h-10 overflow-hidden gap-2 flex-1",children:[v?Object(p.jsx)("span",{className:"shrink-0",children:v}):null,Object(p.jsxs)("div",{className:"truncate space-y-1 flex-1",children:[Object(p.jsx)("div",{className:"text-primary font-semibold truncate",children:O}),Object(p.jsx)("div",{className:"truncate text-default font-normal",children:E})]}),i?Object(p.jsx)("span",{className:"shrink-0",children:i}):null]})})}try{D.displayName="ProjectHomePageCompactListItem",D.__docgenInfo={description:"",displayName:"ProjectHomePageCompactListItem",props:{to:{defaultValue:null,description:"URL to link to.",name:"to",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},subtitle:{defaultValue:null,description:"",name:"subtitle",required:!0,type:{name:"string"}},prefix:{defaultValue:null,description:"",name:"prefix",required:!1,type:{name:"ReactNode"}},suffix:{defaultValue:null,description:"",name:"suffix",required:!1,type:{name:"ReactNode"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx#ProjectHomePageCompactListItem"]={docgenInfo:D.__docgenInfo,name:"ProjectHomePageCompactListItem",path:"frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx#ProjectHomePageCompactListItem"})}catch(w){}},"./frontend/src/scenes/project-homepage/ProjectHomepage.scss":function(S,g,n){"use strict";var u=n("./node_modules/.pnpm/style-loader@2.0.0_webpack@4.46.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),N=n.n(u),X=n("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/project-homepage/ProjectHomepage.scss"),p=n.n(X),j={};j.insert="head",j.singleton=!1;var D=N()(p.a,j),w=p.a.locals||{}},"./frontend/src/scenes/project-homepage/RecentInsights.tsx":function(S,g,n){"use strict";n.d(g,"a",function(){return T}),n.d(g,"b",function(){return A});var u=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),N=n.n(u),X=n("./frontend/src/scenes/project-homepage/ProjectHomepage.scss"),p=n("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),j=n("./frontend/src/lib/dayjs.ts"),D=n("./frontend/src/lib/components/CompactList/CompactList.tsx"),w=n("./frontend/src/scenes/urls.ts"),P=n("./frontend/src/scenes/saved-insights/SavedInsights.tsx"),b=n("./frontend/src/scenes/project-homepage/projectHomepageLogic.tsx"),O=n("./frontend/src/lib/utils/eventUsageLogic.ts"),E=n("./frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx"),v=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js"),i=n.n(v);function T(R){let{insight:m}=R;const{reportInsightOpenedFromRecentInsightList:x}=Object(p.useActions)(O.e);return Object(v.jsx)(E.a,{title:m.name||m.derived_name||"Insight",subtitle:`Last modified ${Object(j.a)(m.last_modified_at).fromNow()}`,prefix:Object(v.jsx)(P.InsightIcon,{insight:m}),to:w.a.insightView(m.short_id),onClick:()=>{x()}})}function A(){const{recentInsights:R,recentInsightsLoading:m}=Object(p.useValues)(b.a),{loadRecentInsights:x}=Object(p.useActions)(b.a);return Object(u.useEffect)(()=>{x()},[]),Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(D.a,{title:"Your recently viewed insights",viewAllURL:w.a.savedInsights(),loading:m,emptyMessage:{title:"You have no recently viewed insights",description:"Explore this project's insights by clicking below.",buttonText:"View insights",buttonTo:w.a.savedInsights()},items:R.slice(0,5),renderRow:(J,C)=>Object(v.jsx)(T,{insight:J},C)})})}try{T.displayName="InsightRow",T.__docgenInfo={description:"",displayName:"InsightRow",props:{insight:{defaultValue:null,description:"",name:"insight",required:!0,type:{name:"InsightModel"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/project-homepage/RecentInsights.tsx#InsightRow"]={docgenInfo:T.__docgenInfo,name:"InsightRow",path:"frontend/src/scenes/project-homepage/RecentInsights.tsx#InsightRow"})}catch(R){}},"./frontend/src/scenes/project-homepage/RecentRecordings.tsx":function(S,g,n){"use strict";n.d(g,"b",function(){return x}),n.d(g,"a",function(){return J});var u=n("./frontend/src/lib/dayjs.ts"),N=n("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),X=n("./frontend/src/scenes/project-homepage/ProjectHomepage.scss"),p=n("./frontend/src/lib/components/CompactList/CompactList.tsx"),j=n("./frontend/src/lib/components/ProfilePicture/index.ts"),D=n("./frontend/src/scenes/persons/PersonHeader.tsx"),w=n("./frontend/src/scenes/session-recordings/playlist/sessionRecordingsListLogic.ts"),P=n("./frontend/src/scenes/urls.ts"),b=n("./frontend/src/lib/utils/eventUsageLogic.ts"),O=n("./frontend/src/lib/utils.tsx"),E=n("./frontend/src/lib/components/icons.tsx"),v=n("./frontend/src/scenes/session-recordings/player/modal/SessionPlayerModal.tsx"),i=n("./frontend/src/scenes/teamLogic.tsx"),T=n("./frontend/src/scenes/session-recordings/player/modal/sessionPlayerModalLogic.ts"),A=n("./frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx"),R=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js"),m=n.n(R);function x(C){let{recording:W}=C;const{openSessionPlayer:Z}=Object(N.useActions)(T.a),{reportRecordingOpenedFromRecentRecordingList:ie}=Object(N.useActions)(b.e);return Object(R.jsx)(A.a,{title:Object(D.b)(W.person),subtitle:`Recorded ${Object(u.a)(W.start_time).fromNow()}`,prefix:Object(R.jsx)(j.b,{name:Object(D.b)(W.person)}),suffix:Object(R.jsxs)("div",{className:"flex items-center justify-end text-default",children:[Object(R.jsx)("span",{children:Object(O.P)(W.recording_duration)}),Object(R.jsx)(E.IconPlayCircle,{className:"text-2xl ml-2"})]}),onClick:()=>{Z({id:W.id,matching_events:W.matching_events}),ie()}})}function J(){const{currentTeam:C}=Object(N.useValues)(i.a),W=Object(w.e)({key:"projectHomepage"}),{sessionRecordings:Z,sessionRecordingsResponseLoading:ie}=Object(N.useValues)(W);return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(v.a,{}),Object(R.jsx)(p.a,{title:"Recent recordings",viewAllURL:P.a.sessionRecordings(),loading:ie,emptyMessage:C!=null&&C.session_recording_opt_in?{title:"There are no recordings for this project",description:"Make sure you have the javascript snippet setup in your website.",buttonText:"Learn more",buttonTo:"https://posthog.com/docs/user-guides/recordings"}:{title:"Recordings are not enabled for this project",description:"Once recordings are enabled, new recordings will display here.",buttonText:"Enable recordings",buttonTo:P.a.projectSettings()+"#recordings"},items:Z.slice(0,5),renderRow:(ce,Ve)=>Object(R.jsx)(x,{recording:ce},Ve)})]})}try{x.displayName="RecordingRow",x.__docgenInfo={description:"",displayName:"RecordingRow",props:{recording:{defaultValue:null,description:"",name:"recording",required:!0,type:{name:"SessionRecordingType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/project-homepage/RecentRecordings.tsx#RecordingRow"]={docgenInfo:x.__docgenInfo,name:"RecordingRow",path:"frontend/src/scenes/project-homepage/RecentRecordings.tsx#RecordingRow"})}catch(C){}},"./frontend/src/scenes/project-homepage/projectHomepageLogic.tsx":function(S,g,n){"use strict";n.d(g,"a",function(){return w});var u=n("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),N=n("./frontend/src/scenes/teamLogic.tsx"),X=n("./frontend/src/types.ts"),p=n("./frontend/src/lib/api.ts"),j=n("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),D=n.n(j);const w=Object(u.kea)([Object(u.path)(["scenes","project-homepage","projectHomepageLogic"]),Object(u.connect)({values:[N.a,["currentTeamId","currentTeam"]]}),Object(u.selectors)({primaryDashboardId:[()=>[N.a.selectors.currentTeam],P=>P==null?void 0:P.primary_dashboard],dashboardLogicProps:[P=>[P.primaryDashboardId],P=>({id:P!=null?P:void 0,placement:X.n.ProjectHomepage})]}),Object(j.loaders)(P=>{let{values:b}=P;return{recentInsights:[[],{loadRecentInsights:()=>K(this,null,function*(){return yield p.b.get(`api/projects/${b.currentTeamId}/insights/my_last_viewed`)})}],persons:[[],{loadPersons:()=>K(this,null,function*(){return(yield p.b.persons.list()).results})}]}}),Object(u.afterMount)(P=>{let{actions:b}=P;b.loadPersons()})])},"./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/LockOutlined.js":function(S,g,n){"use strict";var u=n("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),N=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"},p=X,j=n("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/components/AntdIcon.js"),D=function(b,O){return N.createElement(j.a,Object(u.a)(Object(u.a)({},b),{},{ref:O,icon:p}))};D.displayName="LockOutlined";var w=g.a=N.forwardRef(D)},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss":function(S,g,n){var u=n("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js");g=u(!1),g.push([S.i,".variant-form-list{font-size:13px;border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-top:16px}.variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}.feature-flag-property-display{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;gap:.5rem;margin-top:.5rem}.feature-flag-property-display .arrow-right{margin-right:-8px;margin-top:.25rem}.feature-flag-property-display .display-value{word-break:break-all}.condition-set-separator{color:var(--primary-alt);font-size:12px;font-weight:var(--font-semibold);margin-left:.5rem;margin-bottom:.5rem}.feature-flag-form-row{display:flex;justify-content:space-between;align-items:center;width:100%}.feature-flag-form-row .centered{display:flex;align-items:center;white-space:pre-wrap}",""]),S.exports=g},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlagInstructions.scss":function(S,g,n){var u=n("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js");g=u(!1),g.push([S.i,".FeatureFlagInstructionsHeader{flex-wrap:nowrap}.FeatureFlagInstructionsHeader .FeatureFlagInstructionsHeader__header-title{display:flex;justify-items:center}.FeatureFlagInstructionsHeader .FeatureFlagInstructionsHeader__header-title .FeatureFlagInstructionsHeader__header-title__icon{color:var(--text-muted-alt);margin-right:12px;font-size:1.6em}.FeatureFlagInstructionsHeader__option{display:flex;justify-items:center}.FeatureFlagInstructionsHeader__option .FeatureFlagInstructionsHeader__option__icon{margin-top:2px;margin-right:8px}",""]),S.exports=g},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/project-homepage/ProjectHomepage.scss":function(S,g,n){var u=n("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js");g=u(!1),g.push([S.i,".project-homepage .homepage-dashboard-header{display:flex;justify-content:space-between;align-items:center}.project-homepage .homepage-dashboard-header .dashboard-title-container{display:flex;flex-direction:row;align-items:center}.project-homepage .homepage-dashboard-header .dashboard-title-container .ant-skeleton{width:300px}.project-homepage .homepage-dashboard-header .dashboard-title-container .ant-skeleton h3{margin:0}.project-homepage .top-list-container-horizontal{display:flex}.project-homepage .top-list-container-horizontal .top-list{margin-bottom:1.5rem;width:33%}.project-homepage .top-list-container-horizontal .spacer{width:1rem}.project-homepage .top-list-container-vertical{margin-bottom:1.5rem}.project-homepage .top-list-container-vertical .spacer{height:1rem}.project-homepage .empty-state-container{background-color:var(--side);width:100%;justify-content:center;align-items:center;padding:4rem;display:flex;flex-direction:column}",""]),S.exports=g}}]);
