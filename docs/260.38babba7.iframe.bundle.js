(window.webpackJsonp=window.webpackJsonp||[]).push([[260],{"./frontend/src/scenes/annotations/index.tsx":function(mn,U,n){"use strict";n.r(U),n.d(U,"scene",function(){return cn}),n.d(U,"Annotations",function(){return V});var W=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),H=n.n(W),Q=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),O=n.n(Q),X=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),S=n.n(X),Z=n("./node_modules/@babel/runtime/regenerator/index.js"),x=n.n(Z),j=n("./node_modules/react/index.js"),t=n.n(j),I=n("./node_modules/kea/lib/index.esm.js"),B=n("./frontend/src/models/annotationsModel.ts"),q=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),F=n.n(q),fn=n("./node_modules/core-js/modules/es.array.concat.js"),vn=n("./node_modules/core-js/modules/es.array.iterator.js"),pn=n("./node_modules/core-js/modules/es.object.to-string.js"),An=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),P=n("./frontend/src/lib/api.ts"),J=n("./frontend/src/lib/utils.tsx"),z=n("./frontend/src/scenes/teamLogic.tsx"),w=Object(I.kea)({path:["scenes","annotations","logic"],loaders:function(o){var e=o.actions;return{annotations:{__default:[],loadAnnotations:function(){var m=O()(x.a.mark(function d(){var l;return x.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,P.b.get("api/projects/".concat(z.a.values.currentTeamId,"/annotations/?").concat(Object(J.Cb)({order:"-updated_at"})));case 2:return l=r.sent,e.setNext(l.next),r.abrupt("return",l.results);case 5:case"end":return r.stop()}},d)}));function c(){return m.apply(this,arguments)}return c}()}}},reducers:function(){return{annotations:[[],{appendAnnotations:function(e,m){var c=m.annotations;return[].concat(F()(e),F()(c))}}],next:[null,{setNext:function(e,m){var c=m.next;return c}}],loadingNext:[!1,{loadAnnotationsNext:function(){return!0},appendAnnotations:function(){return!1}}]}},actions:function(){return{updateAnnotation:function(e,m){return{id:e,content:m}},deleteAnnotation:function(e){return{id:e}},restoreAnnotation:function(e){return{id:e}},loadAnnotationsNext:function(){return!0},setNext:function(e){return{next:e}},appendAnnotations:function(e){return{annotations:e}}}},listeners:function(o){var e=o.actions,m=o.values;return H()({updateAnnotation:function(){var c=O()(x.a.mark(function l(v){var r,y;return x.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return r=v.id,y=v.content,g.next=3,P.b.update("api/projects/".concat(z.a.values.currentTeamId,"/annotations/").concat(r),{content:y});case 3:e.loadAnnotations();case 4:case"end":return g.stop()}},l)}));function d(l){return c.apply(this,arguments)}return d}(),restoreAnnotation:function(){var c=O()(x.a.mark(function l(v){var r;return x.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r=v.id,i.next=3,P.b.update("api/projects/".concat(z.a.values.currentTeamId,"/annotations/").concat(r),{deleted:!1});case 3:e.loadAnnotations();case 4:case"end":return i.stop()}},l)}));function d(l){return c.apply(this,arguments)}return d}(),deleteAnnotation:function(d){var l=d.id;Object(J.x)({endpoint:"projects/".concat(z.a.values.currentTeamId,"/annotations"),object:{name:"Annotation",id:l},callback:function(){return e.loadAnnotations()}})},loadAnnotationsNext:function(){var c=O()(x.a.mark(function l(){var v,r;return x.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(v=[],!m.next){i.next=7;break}return i.next=4,P.b.get(m.next);case 4:r=i.sent,e.setNext(r.next),v=r.results;case 7:e.appendAnnotations(v);case 8:case"end":return i.stop()}},l)}));function d(){return c.apply(this,arguments)}return d}()},B.a.actionTypes.createGlobalAnnotationSuccess,function(){e.loadAnnotations()})},events:function(o){var e=o.actions;return{afterMount:function(){return e.loadAnnotations()}}}}),_=n("./frontend/src/lib/components/PageHeader.tsx"),T=n("./frontend/src/types.ts"),D=n("./frontend/src/lib/dayjs.ts"),nn=n("./frontend/src/lib/components/Spinner/Spinner.tsx"),tn=n("./frontend/src/lib/components/LemonTable/index.ts"),en=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),an=n("./frontend/src/lib/components/TimezoneAware/index.tsx"),N=n("./frontend/src/lib/components/LemonButton/index.ts"),on=n("./frontend/src/lib/components/DatePicker.tsx"),rn=n("./frontend/src/lib/components/LemonModal/index.ts"),sn=n("./frontend/src/lib/components/LemonSelect.tsx"),ln=n("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx"),L=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),cn={component:V,logic:w};function V(){var a=Object(I.useValues)(w),o=a.annotations,e=a.annotationsLoading,m=a.next,c=a.loadingNext,d=Object(I.useActions)(w),l=d.updateAnnotation,v=d.deleteAnnotation,r=d.loadAnnotationsNext,y=d.restoreAnnotation,i=Object(I.useActions)(B.a),g=i.createGlobalAnnotation,Y=Object(j.useState)(!1),C=S()(Y,2),G=C[0],R=C[1],$=Object(j.useState)(null),M=S()($,2),b=M[0],k=M[1],h=[{title:"Annotation",key:"annotation",width:"30%",render:function(f,s){return t.a.createElement("div",{className:"ph-no-capture"},s.content)}},{title:"For date",dataIndex:"date_marker",render:function(f,s){return t.a.createElement("span",null,Object(D.a)(s.date_marker).format("MMMM DD, YYYY"))},sorter:function(f,s){return Object(D.a)(f.date_marker).diff(s.date_marker)}},Object(en.b)(),{title:"Last updated",dataIndex:"updated_at",render:function(f,s){return t.a.createElement(an.b,{time:s.updated_at})},sorter:function(f,s){return Object(D.a)(f.date_marker).diff(s.date_marker)}},{title:"Status",render:function(f,s){return s.deleted?t.a.createElement(L.a,{type:"danger"},"Deleted"):t.a.createElement(L.a,{type:"success"},"Active")}},{title:"Scope",render:function(f,s){return s.scope===T.c.Insight?t.a.createElement(L.a,{className:"border",style:{color:"#096dd9",background:"#e6f7ff",borderColor:"#91d5ff"}},"Insight"):s.scope===T.c.Project?t.a.createElement(L.a,{className:"border",style:{color:"#531dab",background:"#f9f0ff",borderColor:"#d3adf7"}},"Project"):s.scope===T.c.Organization?t.a.createElement(L.a,{className:"border",style:{color:"#c41d7f",background:"#fff0f6",borderColor:"#ffadd2"}},"Organization"):t.a.createElement(L.a,null,"Unknown (",s.scope,")")}}];function p(){R(!1),setTimeout(function(){return k(null)},500)}return t.a.createElement("div",null,t.a.createElement(_.a,{title:"Annotations",caption:"Here you can add organization- and project-wide annotations. Dashboard-specific ones can be added directly in the dashboard.",buttons:t.a.createElement(N.a,{type:"primary","data-attr":"create-annotation","data-tooltip":"annotations-new-button",onClick:function(){return R(!0)}},"New annotation")}),t.a.createElement("div",null,t.a.createElement(tn.a,{"data-attr":"annotations-table","data-tooltip":"annotations-table",rowKey:"id",rowClassName:"cursor-pointer",dataSource:o,columns:h,loading:e,onRow:function(f){return{onClick:function(){k(f),R(!0)}}},emptyState:"No annotations yet"}),t.a.createElement("div",{className:"flex flex-row justify-center mt-8"},m&&t.a.createElement(N.a,{type:"primary",icon:c?t.a.createElement(nn.a,{size:"sm"}):null,onClick:function(){r()}},"Load more annotations"))),t.a.createElement(dn,{visible:G,onCancel:function(){p()},onSubmit:function(){var u=O()(x.a.mark(function f(s,K,un){return x.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(A.t0=b,!A.t0){A.next=5;break}return A.next=4,b;case 4:A.t0=A.sent;case 5:if(!A.t0){A.next=9;break}l(b.id,s),A.next=10;break;case 9:g(s,K.format("YYYY-MM-DD"),void 0,un);case 10:p();case 11:case"end":return A.stop()}},f)}));return function(f,s,K){return u.apply(this,arguments)}}(),onDelete:function(){b&&v(b.id),p()},onRestore:function(){b&&y(b.id),p()},annotation:b}))}var E;(function(a){a[a.CREATE=0]="CREATE",a[a.EDIT=1]="EDIT"})(E||(E={}));function dn(a){var o,e,m=Object(j.useState)(T.c.Project),c=S()(m,2),d=c[0],l=c[1],v=Object(j.useState)(""),r=S()(v,2),y=r[0],i=r[1],g=Object(j.useState)(E.CREATE),Y=S()(g,2),C=Y[0],G=Y[1],R=Object(j.useState)(Object(D.a)()),$=S()(R,2),M=$[0],b=$[1];Object(j.useEffect)(function(){a.annotation?(G(E.EDIT),i(a.annotation.content)):(G(E.CREATE),i(""))},[a.annotation]);var k=function(p,u,f){a.onSubmit(p,u,f),i(""),b(Object(D.a)()),l(T.c.Project)};return t.a.createElement(rn.a,{isOpen:a.visible,footer:t.a.createElement(t.a.Fragment,null,C===E.EDIT?t.a.createElement("div",{className:"flex-1"},(o=a.annotation)!==null&&o!==void 0&&o.deleted?t.a.createElement(N.a,{type:"secondary",status:"primary-alt",onClick:a.onRestore,"data-attr":"restore-annotation"},"Restore annotation"):t.a.createElement(N.a,{type:"secondary",status:"danger",onClick:a.onDelete,"data-attr":"delete-annotation"},"Delete annotation")):null,t.a.createElement(N.a,{key:"create-annotation-cancel",type:"secondary",onClick:function(){return a.onCancel()}},"Cancel"),t.a.createElement(N.a,{type:"primary",key:"create-annotation-submit","data-attr":"create-annotation-submit",onClick:function(){k(y,M,d)}},C===E.CREATE?"Submit":"Update")),onClose:a.onCancel,title:C===E.CREATE?"Create annotation":"Edit annotation"},C===E.CREATE?t.a.createElement("span",null,"This annotation will appear on all"," ",t.a.createElement("div",{className:"inline-flex"},t.a.createElement(sn.a,{size:"small",dropdownMaxContentWidth:!0,options:(e={},H()(e,T.c.Project,{label:"project"}),H()(e,T.c.Organization,{label:"organization"}),e),onChange:function(p){p&&l(p)},value:d}))," ","insights"):null,C===E.CREATE&&t.a.createElement("div",null,t.a.createElement("div",{className:"my-2 flex flex-row items-center"},"Date:\xA0",t.a.createElement(on.a,{getPopupContainer:function(p){return p.parentElement},value:M,onChange:function(p){return b(p)},allowClear:!1}))),t.a.createElement("div",null,"Annotation text:"),t.a.createElement(ln.a,{"data-attr":"create-annotation-input",maxLength:300,className:"mt-1",rows:4,value:y,onChange:i}))}}}]);
