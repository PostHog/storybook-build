"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[16936],{"../../frontend/src/scenes/data-warehouse/settings/source/Schemas.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>Schemas});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.20.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),product_intents=__webpack_require__("../../frontend/src/lib/utils/product-intents.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),utils=__webpack_require__("../../frontend/src/scenes/data-warehouse/utils.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),types=__webpack_require__("../../frontend/src/types.ts"),SyncMethodForm=__webpack_require__("../../frontend/src/scenes/data-warehouse/external/forms/SyncMethodForm.tsx"),dataWarehouseSettingsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let dataWarehouseSourcesTableSyncMethodModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","settings","DataWarehouseSourcesTableSyncMethodModalLogic"]),(0,index_esm.props)({schema:{}}),(0,index_esm.key)(props=>props.schema.id),(0,index_esm.connect)(()=>({actions:[dataWarehouseSettingsLogic.T,["updateSchema","updateSchemaSuccess","updateSchemaFailure","loadSources"]]})),(0,index_esm.actions)({openSyncMethodModal:schema=>({schema}),closeSyncMethodModal:!0}),(0,kea_loaders_lib.loaders)({schemaIncrementalFields:[null,{loadSchemaIncrementalFields:async schemaId=>await api.ZP.externalDataSchemas.incremental_fields(schemaId),resetSchemaIncrementalFields:()=>null}]}),(0,index_esm.reducers)({syncMethodModalIsOpen:[!1,{openSyncMethodModal:()=>!0,closeSyncMethodModal:()=>!1}],currentSyncMethodModalSchema:[null,{openSyncMethodModal:(_,_ref)=>{let{schema}=_ref;return schema},closeSyncMethodModal:()=>null}],saveButtonIsLoading:[!1,{updateSchema:()=>!0,updateSchemaFailure:()=>!1,updateSchemaSuccess:()=>!1}]}),(0,index_esm.listeners)(_ref2=>{let{actions}=_ref2;return{updateSchemaSuccess:()=>{actions.loadSources(null),actions.resetSchemaIncrementalFields(),actions.closeSyncMethodModal()}}})]);var dataWarehouseSourceSettingsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/source/dataWarehouseSourceSettingsLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let REVENUE_ENABLED_SOURCES=["Stripe"],Schemas=_ref=>{var _source$schemas;let{id}=_ref,{source,sourceLoading}=(0,index_esm.useValues)((0,dataWarehouseSourceSettingsLogic.j)({id})),{addProductIntentForCrossSell}=(0,index_esm.useActions)(teamLogic.teamLogic);return(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:dataWarehouseSourceSettingsLogic.j,props:{id},children:[(0,jsx_runtime.jsx)(SchemaTable,{schemas:null!==(_source$schemas=source?.schemas)&&void 0!==_source$schemas?_source$schemas:[],isLoading:sourceLoading}),source?.source_type&&REVENUE_ENABLED_SOURCES.includes(source.source_type)&&(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsxs)(src.Jp,{type:"primary",className:"mt-2",tooltip:"This source is feeding data into our Revenue analytics product - currently in beta.",onClick:()=>{addProductIntentForCrossSell({from:types.Md.PRODUCT_ANALYTICS,to:types.Md.DATA_WAREHOUSE,intent_context:product_intents.kp.DATA_WAREHOUSE_SOURCES_TABLE}),lib.router.actions.push(urls.j.revenueAnalytics())},children:["See data in Revenue analytics",(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"warning",size:"small",children:"BETA"})]})})]})},StatusTagSetting={Running:"primary",Completed:"success",Error:"danger",Failed:"danger","Billing limits":"danger"},SchemaTable=_ref2=>{let{schemas,isLoading}=_ref2,{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),{updateSchema,reloadSchema,resyncSchema,deleteTable,setIsProjectTime}=(0,index_esm.useActions)(dataWarehouseSourceSettingsLogic.j),{isProjectTime,source}=(0,index_esm.useValues)(dataWarehouseSourceSettingsLogic.j),{schemaReloadingById}=(0,index_esm.useValues)(dataWarehouseSettingsLogic.T),[initialLoad,setInitialLoad]=(0,react.useState)(!0);return(0,react.useEffect)(()=>{initialLoad&&!isLoading&&setInitialLoad(!1)},[isLoading]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.g3,{dataSource:schemas,loading:initialLoad,disableTableWhileLoading:!1,columns:[{title:"Schema Name",key:"name",render:function RenderName(_,schema){return(0,jsx_runtime.jsx)("span",{children:schema.name})}},{title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Anchor Time"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("span",{children:"UTC"}),currentTeam?.timezone!=="UTC"&&currentTeam?.timezone!=="GMT"&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.f4,{size:"xsmall",checked:isProjectTime,onChange:setIsProjectTime}),(0,jsx_runtime.jsx)("span",{children:currentTeam?.timezone||"UTC"})]})]})]}),tooltip:"The sync frequency will be offset from the anchor time. This will not apply to sync intervals one hour or less.",key:"sync_time_of_day",render:function RenderSyncTimeOfDayLocal(_,schema){let utcTime=schema.sync_time_of_day||"00:00:00",localTime=isProjectTime?dayjs.Bv.utc(`${(0,dayjs.Bv)().format("YYYY-MM-DD")}T${utcTime}`).local().tz(currentTeam?.timezone||"UTC").format("HH:mm:00"):utcTime;return(0,jsx_runtime.jsx)(src.DF,{type:"time",size:"xsmall",disabled:!schema.should_sync||"5min"===schema.sync_frequency||"30min"===schema.sync_frequency||"1hour"===schema.sync_frequency,value:localTime.substring(0,5),onChange:value=>{let newValue=`${value}:00`,utcValue=isProjectTime?(0,dayjs.Bv)(`${(0,dayjs.Bv)().format("YYYY-MM-DD")}T${newValue}`).tz(currentTeam?.timezone||"UTC").utc().format("HH:mm:00"):newValue;updateSchema({...schema,sync_time_of_day:utcValue})},suffix:(0,jsx_runtime.jsx)(src.u,{title:(0,utils.HZ)(utcTime,schema.sync_frequency),children:schema.should_sync&&(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt"})})})}},{title:"Sync Frequency",key:"frequency",className:"px-1",render:function RenderFrequency(_,schema){return(0,jsx_runtime.jsx)(src.Yv,{className:"my-1",size:"xsmall",disabled:!schema.should_sync,value:schema.sync_frequency||"6hour",onChange:value=>updateSchema({...schema,sync_frequency:value}),options:[{value:"5min",label:"5 mins"},{value:"30min",label:"30 mins"},{value:"1hour",label:"1 hour"},{value:"6hour",label:"6 hours"},{value:"12hour",label:"12 hours"},{value:"24hour",label:"Daily"},{value:"7day",label:"Weekly"},{value:"30day",label:"Monthly"}]})}},{title:"Sync method",key:"incremental",className:"px-1",render:function RenderIncremental(_,schema){let{openSyncMethodModal}=(0,index_esm.useActions)(dataWarehouseSourcesTableSyncMethodModalLogic({schema}));return schema.sync_type?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{className:"my-1",size:"xsmall",type:"secondary",onClick:()=>openSyncMethodModal(schema),children:"incremental"==schema.sync_type?"Incremental":"Full refresh"}),(0,jsx_runtime.jsx)(SyncMethodModal,{schema:schema})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{className:"my-1",type:"primary",size:"xsmall",onClick:()=>openSyncMethodModal(schema),children:"Set up"}),(0,jsx_runtime.jsx)(SyncMethodModal,{schema:schema})]})}},{title:"Enabled",key:"should_sync",render:function RenderShouldSync(_,schema){return(0,jsx_runtime.jsx)(src.f4,{disabledReason:null===schema.sync_type?"You must set up the sync method first":void 0,checked:schema.should_sync,onChange:active=>{updateSchema({...schema,should_sync:active})}})}},{title:"Synced Table",key:"table",render:function RenderTable(_,schema){if(schema.table){let query=(0,utils.wi)(schema.table.name,schema.table.columns);return(0,jsx_runtime.jsx)(src.rU,{to:urls.j.sqlEditor(query.source.query),children:(0,jsx_runtime.jsx)("code",{children:schema.table.name})})}return"Completed"===schema.status?(0,jsx_runtime.jsx)("div",{children:"No rows to query"}):(0,jsx_runtime.jsx)("div",{children:"Not yet synced"})}},{title:"Last Synced At",key:"last_synced_at",render:function Render(_,schema){return schema.last_synced_at?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(TZLabel.w,{time:schema.last_synced_at,formatDate:"MMM DD, YYYY",formatTime:"HH:mm"})}):null}},{title:"Rows Synced",key:"rows_synced",render:function Render(_,schema){return schema.table?schema.table.row_count.toLocaleString():"Completed"===schema.status?0:""}},{title:"Status",key:"status",render:(_,schema)=>{if(!schema.status)return null;let tagContent=(0,jsx_runtime.jsx)(src.oe,{type:StatusTagSetting[schema.status]||"default",children:schema.status});return schema.latest_error&&"Error"===schema.status?(0,jsx_runtime.jsx)(src.u,{title:schema.latest_error,children:tagContent}):tagContent}},{key:"actions",width:0,render:function RenderActions(_,schema){return schemaReloadingById[schema.id]?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.$j,{})}):(0,jsx_runtime.jsx)("div",{className:"flex flex-row justify-end",children:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.u,{title:schema.incremental?"Sync incremental data since the last run.":"Sync all data.",children:(0,jsx_runtime.jsx)(src.Jp,{type:"tertiary",size:"xsmall",fullWidth:!0,id:"data-warehouse-schema-reload",onClick:()=>{reloadSchema(schema)},children:"Sync now"},`reload-data-warehouse-schema-${schema.id}`)}),schema.incremental&&(0,jsx_runtime.jsx)(src.u,{title:"Completely resync incrementally loaded data. Only recommended if there is an issue with data quality in previously imported data.",children:(0,jsx_runtime.jsx)(src.Jp,{type:"tertiary",size:"xsmall",fullWidth:!0,id:"data-warehouse-schema-resync",onClick:()=>{resyncSchema(schema)},status:"danger",children:"Delete table and resync"},`resync-data-warehouse-schema-${schema.id}`)}),schema.table&&(0,jsx_runtime.jsx)(src.u,{title:`Delete this table from PostHog. ${source?.source_type?`This will not delete the data in ${source.source_type}`:""}`,children:(0,jsx_runtime.jsx)(src.Jp,{status:"danger",id:"data-warehouse-schema-delete",type:"tertiary",fullWidth:!0,size:"xsmall",onClick:()=>{window.confirm(`Are you sure you want to delete the table ${schema?.table?.name} from PostHog?`)&&deleteTable(schema)},children:"Delete table from PostHog"})})]})})})})}}]})})},SyncMethodModal=_ref3=>{var _currentSyncMethodMod,_currentSyncMethodMod2,_currentSyncMethodMod3;let{schema}=_ref3,{syncMethodModalIsOpen,currentSyncMethodModalSchema,schemaIncrementalFields,schemaIncrementalFieldsLoading,saveButtonIsLoading}=(0,index_esm.useValues)(dataWarehouseSourcesTableSyncMethodModalLogic({schema})),{closeSyncMethodModal,loadSchemaIncrementalFields,resetSchemaIncrementalFields,updateSchema}=(0,index_esm.useActions)(dataWarehouseSourcesTableSyncMethodModalLogic({schema}));(0,react.useEffect)(()=>{currentSyncMethodModalSchema?.id&&(resetSchemaIncrementalFields(),loadSchemaIncrementalFields(currentSyncMethodModalSchema.id))},[currentSyncMethodModalSchema?.id]);let schemaLoading=schemaIncrementalFieldsLoading||!schemaIncrementalFields,showForm=!schemaLoading&&schemaIncrementalFields;return currentSyncMethodModalSchema?(0,jsx_runtime.jsxs)(src.fQ,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Sync method for ",(0,jsx_runtime.jsx)("span",{className:"font-mono",children:currentSyncMethodModalSchema.name})]}),isOpen:syncMethodModalIsOpen,onClose:closeSyncMethodModal,footer:schemaLoading&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.yW.Button,{}),(0,jsx_runtime.jsx)(src.yW.Button,{})]}),children:[schemaLoading&&(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(src.yW,{className:"w-1/2 h-4"}),(0,jsx_runtime.jsx)(src.yW.Row,{repeat:3})]}),showForm&&(0,jsx_runtime.jsx)(SyncMethodForm.m,{saveButtonIsLoading:saveButtonIsLoading,schema:{table:currentSyncMethodModalSchema.name,should_sync:currentSyncMethodModalSchema.should_sync,sync_type:currentSyncMethodModalSchema.sync_type,sync_time_of_day:null!==(_currentSyncMethodMod=currentSyncMethodModalSchema.sync_time_of_day)&&void 0!==_currentSyncMethodMod?_currentSyncMethodMod:"00:00:00",incremental_field:null!==(_currentSyncMethodMod2=currentSyncMethodModalSchema.incremental_field)&&void 0!==_currentSyncMethodMod2?_currentSyncMethodMod2:null,incremental_field_type:null!==(_currentSyncMethodMod3=currentSyncMethodModalSchema.incremental_field_type)&&void 0!==_currentSyncMethodMod3?_currentSyncMethodMod3:null,incremental_available:!!schemaIncrementalFields.length,incremental_fields:schemaIncrementalFields},onClose:()=>{resetSchemaIncrementalFields(),closeSyncMethodModal()},onSave:(syncType,incrementalField,incrementalFieldType)=>{var _currentSyncMethodMod4,_currentSyncMethodMod5;"full_refresh"===syncType?updateSchema({...currentSyncMethodModalSchema,should_sync:!0,sync_type:syncType,incremental_field:null,incremental_field_type:null,sync_time_of_day:null!==(_currentSyncMethodMod4=currentSyncMethodModalSchema.sync_time_of_day)&&void 0!==_currentSyncMethodMod4?_currentSyncMethodMod4:"00:00:00"}):updateSchema({...currentSyncMethodModalSchema,should_sync:!0,sync_type:syncType,incremental_field:incrementalField,incremental_field_type:incrementalFieldType,sync_time_of_day:null!==(_currentSyncMethodMod5=currentSyncMethodModalSchema.sync_time_of_day)&&void 0!==_currentSyncMethodMod5?_currentSyncMethodMod5:"00:00:00"})}})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}},"../../frontend/src/scenes/data-warehouse/settings/source/dataWarehouseSourceSettingsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>dataWarehouseSourceSettingsLogic});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/api.ts"),posthog_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.248.1_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),scenes_data_warehouse_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx");let dataWarehouseSourceSettingsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","data-warehouse","settings","source","dataWarehouseSourceSettingsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.key)(_ref=>{let{id}=_ref;return id}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({setSourceId:id=>({id}),reloadSchema:schema=>({schema}),resyncSchema:schema=>({schema}),deleteTable:schema=>({schema}),setCanLoadMoreJobs:canLoadMoreJobs=>({canLoadMoreJobs}),setIsProjectTime:isProjectTime=>({isProjectTime})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_3__.loaders)(_ref2=>{let{actions,values}=_ref2;return{source:[null,{loadSource:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.get(values.sourceId),updateSchema:async(schema,breakpoint)=>{await breakpoint(500);let clonedSource=JSON.parse(JSON.stringify(values.source)),schemaIndex=clonedSource.schemas.findIndex(n=>n.id===schema.id);clonedSource.schemas[schemaIndex]=schema,actions.loadSourceSuccess(clonedSource);let updatedSchema=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSchemas.update(schema.id,{...schema}),source=values.source;return void 0!==schemaIndex&&(source.schemas[schemaIndex]=updatedSchema),source},updateSource:async source=>{let updatedSource=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.update(values.sourceId,source);return actions.loadSourceSuccess(updatedSource),updatedSource}}],jobs:[[],{loadJobs:async()=>0===values.jobs.length?await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.jobs(values.sourceId,null,null):[...await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.jobs(values.sourceId,null,values.jobs[0].created_at),...values.jobs],loadMoreJobs:async()=>{if(values.jobs.length>=0){let lastJobCreatedAt=values.jobs[values.jobs.length-1].created_at,oldJobs=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.jobs(values.sourceId,lastJobCreatedAt,null);return 0===oldJobs.length?(actions.setCanLoadMoreJobs(!1),values.jobs):[...values.jobs,...oldJobs]}return values.jobs}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)(_ref3=>{let{props}=_ref3;return{sourceId:[props.id,{setSourceId:(_,_ref4)=>{let{id}=_ref4;return id}}],canLoadMoreJobs:[!0,{setCanLoadMoreJobs:(_,_ref5)=>{let{canLoadMoreJobs}=_ref5;return canLoadMoreJobs},setSourceId:()=>!0}],isProjectTime:[!1,{setIsProjectTime:(_,_ref6)=>{let{isProjectTime}=_ref6;return isProjectTime}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.selectors)({sourceFieldConfig:[s=>[s.source],source=>source?scenes_data_warehouse_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_6__.l2[source.source_type]:null]}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_2__.forms)(_ref7=>{let{values,actions}=_ref7;return{sourceConfig:{defaults:{},errors:sourceValues=>{var _values$sourceFieldCo;return(0,scenes_data_warehouse_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_6__.HM)(null!==(_values$sourceFieldCo=values.sourceFieldConfig?.fields)&&void 0!==_values$sourceFieldCo?_values$sourceFieldCo:[],sourceValues)},submit:async _ref8=>{let{payload={}}=_ref8,newJobInputs={...values.source?.job_inputs,...payload},sourceFieldConfig=values.sourceFieldConfig;if(sourceFieldConfig?.fields){for(let field of sourceFieldConfig.fields)if("file-upload"===field.type&&payload[field.name])try{let loadedFile=await new Promise((resolve,reject)=>{let fileReader=new FileReader;fileReader.onload=e=>resolve(e.target?.result),fileReader.onerror=e=>reject(e),fileReader.readAsText(payload[field.name][0])});newJobInputs[field.name]=JSON.parse(loadedFile)}catch(e){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("File is not valid");return}}try{let updatedSource=await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSources.update(values.sourceId,{job_inputs:newJobInputs});actions.loadSourceSuccess(updatedSource),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.success("Source updated")}catch(e){e.message?_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error(e.message):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Cant update source at this time")}}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)(_ref9=>{let{values,actions,cache}=_ref9;return{loadSourceSuccess:()=>{clearTimeout(cache.sourceRefreshTimeout),cache.sourceRefreshTimeout=setTimeout(()=>{actions.loadSource()},5e3)},loadSourceFailure:()=>{clearTimeout(cache.sourceRefreshTimeout),cache.sourceRefreshTimeout=setTimeout(()=>{actions.loadSource()},5e3)},loadJobsSuccess:()=>{clearTimeout(cache.jobsRefreshTimeout),cache.jobsRefreshTimeout=setTimeout(()=>{actions.loadJobs()},5e3)},loadJobsFailure:()=>{clearTimeout(cache.jobsRefreshTimeout),cache.jobsRefreshTimeout=setTimeout(()=>{actions.loadJobs()},5e3)},reloadSchema:async _ref10=>{let{schema}=_ref10,clonedSource=JSON.parse(JSON.stringify(values.source)),schemaIndex=clonedSource.schemas.findIndex(n=>n.id===schema.id);clonedSource.status="Running",clonedSource.schemas[schemaIndex].status="Running",actions.loadSourceSuccess(clonedSource);try{await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSchemas.reload(schema.id),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("schema reloaded",{sourceType:clonedSource.source_type})}catch(e){e.message?_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error(e.message):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Cant reload schema at this time")}},resyncSchema:async _ref11=>{let{schema}=_ref11,clonedSource=JSON.parse(JSON.stringify(values.source)),schemaIndex=clonedSource.schemas.findIndex(n=>n.id===schema.id);clonedSource.status="Running",clonedSource.schemas[schemaIndex].status="Running",actions.loadSourceSuccess(clonedSource);try{await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSchemas.resync(schema.id),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("schema resynced",{sourceType:clonedSource.source_type})}catch(e){e.message?_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error(e.message):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Cant refresh schema at this time")}},deleteTable:async _ref12=>{let{schema}=_ref12,clonedSource=JSON.parse(JSON.stringify(values.source)),schemaIndex=clonedSource.schemas.findIndex(n=>n.id===schema.id);if(-1===schemaIndex){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Schema not found");return}clonedSource.schemas[schemaIndex].table=void 0,clonedSource.schemas[schemaIndex].status=void 0,clonedSource.schemas[schemaIndex].last_synced_at=void 0,actions.loadSourceSuccess(clonedSource);try{await lib_api__WEBPACK_IMPORTED_MODULE_4__.ZP.externalDataSchemas.delete_data(schema.id),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("schema data deleted",{sourceType:clonedSource.source_type}),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.success(`Data for ${schema.name} has been deleted`)}catch(e){e.message?_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error(e.message):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Can't delete data at this time")}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.afterMount)(_ref13=>{let{actions}=_ref13;actions.loadSource(),actions.loadJobs()})])}}]);