(window.webpackJsonp=window.webpackJsonp||[]).push([[280,298],{"./frontend/src/scenes/early-access-features/EarlyAccessFeature.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"EarlyAccessFeature",(function(){return EarlyAccessFeature})),__webpack_require__.d(__webpack_exports__,"FlagSelector",(function(){return FlagSelector}));var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),earlyAccessFeaturesLogic=__webpack_require__("./frontend/src/scenes/early-access-features/earlyAccessFeaturesLogic.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");const NEW_EARLY_ACCESS_FEATURE={name:"",description:"",stage:types.o.Draft,documentation_url:"",feature_flag_id:void 0},earlyAccessFeatureLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","features","featureLogic"]),Object(index_esm.props)({}),Object(index_esm.key)((_ref=>{let{id:id}=_ref;return id})),Object(index_esm.connect)((()=>({values:[teamLogic.b,["currentTeamId"],earlyAccessFeaturesLogic.a,["earlyAccessFeatures"]],actions:[earlyAccessFeaturesLogic.a,["loadEarlyAccessFeatures","loadEarlyAccessFeaturesSuccess"]]}))),Object(index_esm.actions)({toggleImplementOptInInstructionsModal:!0,cancel:!0,editFeature:editing=>({editing:editing}),updateStage:stage=>({stage:stage}),deleteEarlyAccessFeature:earlyAccessFeatureId=>({earlyAccessFeatureId:earlyAccessFeatureId}),setActiveTab:activeTab=>({activeTab:activeTab})}),Object(kea_loaders_lib.loaders)((_ref2=>{let{props:props}=_ref2;return{earlyAccessFeature:{loadEarlyAccessFeature:async()=>{if(props.id&&"new"!==props.id){return await api.b.earlyAccessFeatures.get(props.id)}return NEW_EARLY_ACCESS_FEATURE},saveEarlyAccessFeature:async updatedEarlyAccessFeature=>{let result;return"new"===props.id?(result=await api.b.earlyAccessFeatures.create(updatedEarlyAccessFeature),kea_router_lib.router.actions.replace(urls.a.earlyAccessFeature(result.id))):result=await api.b.earlyAccessFeatures.update(props.id,updatedEarlyAccessFeature),result}}}})),Object(lib.forms)((_ref3=>{let{actions:actions}=_ref3;return{earlyAccessFeature:{defaults:{...NEW_EARLY_ACCESS_FEATURE},errors:payload=>({name:payload.name?void 0:"Feature name must be set"}),submit:async payload=>{actions.saveEarlyAccessFeature(payload)}}}})),Object(index_esm.reducers)({isEditingFeature:[!1,{editFeature:(_,_ref4)=>{let{editing:editing}=_ref4;return editing}}],implementOptInInstructionsModal:[!1,{toggleImplementOptInInstructionsModal:state=>!state}],activeTab:[types.p.OptedIn,{setActiveTab:(_,_ref5)=>{let{activeTab:activeTab}=_ref5;return activeTab}}]}),Object(index_esm.selectors)({mode:[(_,p)=>[p.id],id=>"new"===id?"edit":"view"],breadcrumbs:[s=>[s.earlyAccessFeature],earlyAccessFeature=>[{name:"Early Access Management",path:urls.a.earlyAccessFeatures()},...null!=earlyAccessFeature&&earlyAccessFeature.name?[{name:earlyAccessFeature.name}]:[]]]}),Object(index_esm.listeners)((_ref6=>{let{actions:actions,values:values,props:props}=_ref6;return{cancel:()=>{"id"in values.earlyAccessFeature||(actions.resetEarlyAccessFeature(),kea_router_lib.router.actions.push(urls.a.earlyAccessFeatures())),actions.editFeature(!1)},updateStage:async _ref7=>{let{stage:stage}=_ref7;"id"in values.earlyAccessFeature&&await api.b.earlyAccessFeatures.update(props.id,{...values.earlyAccessFeature,stage:stage}),actions.loadEarlyAccessFeature(),actions.loadEarlyAccessFeatures()},saveEarlyAccessFeatureSuccess:_ref8=>{let{earlyAccessFeature:earlyAccessFeature}=_ref8;src.lemonToast.success("Early Access Feature saved"),actions.loadEarlyAccessFeatures(),earlyAccessFeature.id&&kea_router_lib.router.actions.replace(urls.a.earlyAccessFeature(earlyAccessFeature.id)),actions.editFeature(!1)},deleteEarlyAccessFeature:async _ref9=>{let{earlyAccessFeatureId:earlyAccessFeatureId}=_ref9;try{await api.b.earlyAccessFeatures.delete(earlyAccessFeatureId),src.lemonToast.info("Early access feature deleted. Remember to delete corresponding feature flag if necessary"),actions.loadEarlyAccessFeaturesSuccess(values.earlyAccessFeatures.filter((feature=>feature.id!==earlyAccessFeatureId))),kea_router_lib.router.actions.push(urls.a.earlyAccessFeatures())}catch(e){src.lemonToast.error(`Error deleting Early Access Feature: ${e}`)}}}})),Object(kea_router_lib.urlToAction)((_ref10=>{var _props$id;let{actions:actions,props:props}=_ref10;return{[urls.a.earlyAccessFeature(null!==(_props$id=props.id)&&void 0!==_props$id?_props$id:"new")]:(_,__,___,_ref11)=>{let{method:method}=_ref11;"PUSH"===method&&(props.id?actions.loadEarlyAccessFeature():actions.resetEarlyAccessFeature())}}})),Object(index_esm.afterMount)((async _ref12=>{let{props:props,actions:actions}=_ref12;"new"!==props.id&&await actions.loadEarlyAccessFeature(),"new"===props.id&&actions.resetEarlyAccessFeature()}))]);var icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),Popover=__webpack_require__("./frontend/src/lib/lemon-ui/Popover/index.ts"),TaxonomicFilter=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/TaxonomicFilter.tsx"),TaxonomicFilter_types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),featureFlagLogic=__webpack_require__("./frontend/src/scenes/feature-flags/featureFlagLogic.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.tsx"),early_access_feature_demo=__webpack_require__.p+"images/early-access-feature-demo.8931b5833f0ea2443173aef331bedf12.png",preflightLogic=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function InstructionsModal(_ref){let{onClose:onClose,visible:visible,featureFlag:featureFlag}=_ref;const{preflight:preflight}=Object(index_esm.useValues)(preflightLogic.a),panels=null!=preflight&&preflight.cloud?Object(jsx_runtime.jsx)(src.LemonCollapse,{className:"mt-2",defaultActiveKey:"1",panels:[{key:"1",header:"Option 1: Widget Site App",content:Object(jsx_runtime.jsxs)("div",{children:["Give your users a"," ",Object(jsx_runtime.jsx)(src.Link,{to:"https://app.posthog.com/project/apps/574",children:"prebuilt widget"})," to opt-in to features",Object(jsx_runtime.jsx)("img",{style:{maxHeight:"100%",maxWidth:"100%",marginTop:10},src:early_access_feature_demo})]})},{key:"2",header:"Option 2: Custom implementation",content:Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("b",{children:"Opt user in"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(FeatureEnrollInstructions,{featureFlag:featureFlag})}),Object(jsx_runtime.jsx)("b",{children:"Opt user out"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(FeatureUnenrollInstructions,{featureFlag:featureFlag})}),Object(jsx_runtime.jsx)("b",{children:"Retrieve Previews"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(RetrievePreviewsInstructions,{})})]})}]}):Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("b",{children:"Opt user in"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(FeatureEnrollInstructions,{featureFlag:featureFlag})}),Object(jsx_runtime.jsx)("b",{children:"Opt user out"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(FeatureUnenrollInstructions,{featureFlag:featureFlag})}),Object(jsx_runtime.jsx)("b",{children:"Retrieve Previews"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(RetrievePreviewsInstructions,{})})]});return Object(jsx_runtime.jsx)(src.LemonModal,{title:"How to implement opt-in feature flags",isOpen:visible,onClose:onClose,width:640,children:Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("div",{className:"mb-2",children:"Implement manual release condition toggles to give your users the ability choose which features they want to try"}),panels]})})}function FeatureEnrollInstructions(_ref2){let{featureFlag:featureFlag}=_ref2;return Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:`posthog.updateEarlyAccessFeatureEnrollment("${featureFlag.key}", true)\n`})}function FeatureUnenrollInstructions(_ref3){let{featureFlag:featureFlag}=_ref3;return Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:`posthog.updateEarlyAccessFeatureEnrollment("${featureFlag.key}", false)\n`})}function RetrievePreviewsInstructions(){return Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:"posthog.getEarlyAccessFeatures((previewItemData) => {\n    // do something with early access feature\n})\n"})}try{InstructionsModal.displayName="InstructionsModal",InstructionsModal.__docgenInfo={description:"",displayName:"InstructionsModal",props:{featureFlag:{defaultValue:null,description:"",name:"featureFlag",required:!0,type:{name:"FeatureFlagType"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/early-access-features/InstructionsModal.tsx#InstructionsModal"]={docgenInfo:InstructionsModal.__docgenInfo,name:"InstructionsModal",path:"frontend/src/scenes/early-access-features/InstructionsModal.tsx#InstructionsModal"})}catch(__react_docgen_typescript_loader_error){}var LemonDialog=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDialog/index.ts"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),schema=__webpack_require__("./frontend/src/queries/schema.ts");const scene={component:EarlyAccessFeature,logic:earlyAccessFeatureLogic,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{id:id&&"new"!==id?id:"new"}}};function EarlyAccessFeature(){let{id:id}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{earlyAccessFeature:earlyAccessFeature,earlyAccessFeatureLoading:earlyAccessFeatureLoading,isEarlyAccessFeatureSubmitting:isEarlyAccessFeatureSubmitting,isEditingFeature:isEditingFeature}=Object(index_esm.useValues)(earlyAccessFeatureLogic),{submitEarlyAccessFeatureRequest:submitEarlyAccessFeatureRequest,cancel:cancel,editFeature:editFeature,updateStage:updateStage,deleteEarlyAccessFeature:deleteEarlyAccessFeature,toggleImplementOptInInstructionsModal:toggleImplementOptInInstructionsModal}=Object(index_esm.useActions)(earlyAccessFeatureLogic),isNewEarlyAccessFeature="new"===id||void 0===id;return Object(jsx_runtime.jsxs)(lib.Form,{formKey:"earlyAccessFeature",logic:earlyAccessFeatureLogic,children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:isNewEarlyAccessFeature?"New Feature Release":earlyAccessFeature.name,buttons:earlyAccessFeatureLoading?void 0:earlyAccessFeature.stage!=types.o.GeneralAvailability&&(isNewEarlyAccessFeature||isEditingFeature)?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:()=>cancel(),disabledReason:isEarlyAccessFeatureSubmitting?"Saving…":void 0,children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",htmlType:"submit",onClick:()=>{submitEarlyAccessFeatureRequest(earlyAccessFeature)},loading:isEarlyAccessFeatureSubmitting,children:isNewEarlyAccessFeature?"Save as draft":"Save"})]}):Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"delete-feature",status:"danger",type:"secondary",onClick:()=>{LemonDialog.a.open({title:"Permanently delete feature?",description:"Doing so will remove any opt in conditions from the feature flag.",primaryButton:{children:"Delete",type:"primary",status:"danger",onClick:()=>{deleteEarlyAccessFeature(null==earlyAccessFeature?void 0:earlyAccessFeature.id)}},secondaryButton:{children:"Close",type:"secondary"}})},children:"Delete"}),earlyAccessFeature.stage==types.o.Beta&&Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"archive-feature",type:"secondary",onClick:()=>updateStage(types.o.Archived),children:"Archive"}),Object(jsx_runtime.jsx)(src.LemonDivider,{vertical:!0}),Object(jsx_runtime.jsx)("div",{className:"flex flex-row justify-between",children:Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:toggleImplementOptInInstructionsModal,sideIcon:Object(jsx_runtime.jsx)(icons.Ab,{}),children:"Implement public opt-in"},"help-button")}),earlyAccessFeature.stage==types.o.Archived&&Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"reactive-feature",type:"secondary",onClick:()=>updateStage(types.o.Beta),children:"Reactivate Beta"}),earlyAccessFeature.stage==types.o.Draft&&Object(jsx_runtime.jsx)(src.LemonButton,{onClick:()=>updateStage(types.o.Beta),tooltip:"Make beta feature available",type:"primary",children:"Release Beta"}),Object(jsx_runtime.jsx)(src.LemonDivider,{vertical:!0}),earlyAccessFeature.stage!=types.o.GeneralAvailability&&Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",htmlType:"submit",onClick:()=>editFeature(!0),loading:!1,children:"Edit"})]}),delimited:!0}),Object(jsx_runtime.jsxs)("div",{className:Object(clsx_m.default)("flex flex-wrap gap-6",isEditingFeature||isNewEarlyAccessFeature?"max-w-160":null),children:[Object(jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4 flex-2 min-w-60",children:[isNewEarlyAccessFeature&&Object(jsx_runtime.jsx)(Field.a,{name:"name",label:"Name",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"feature-name"})}),"feature_flag"in earlyAccessFeature?Object(jsx_runtime.jsx)(Field.b,{label:"Connected Feature flag",children:Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:()=>earlyAccessFeature.feature_flag&&kea_router_lib.router.actions.push(urls.a.featureFlag(earlyAccessFeature.feature_flag.id)),icon:Object(jsx_runtime.jsx)(icons.nb,{}),children:earlyAccessFeature.feature_flag.key})})}):Object(jsx_runtime.jsx)(Field.a,{name:"feature_flag_id",label:"Link feature flag (optional)",info:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"A feature flag will be generated from feature name if not provided"}),children:_ref2=>{let{value:value,onChange:onChange}=_ref2;return Object(jsx_runtime.jsxs)("div",{className:"flex",children:[Object(jsx_runtime.jsx)(FlagSelector,{value:value,onChange:onChange}),value&&Object(jsx_runtime.jsx)(src.LemonButton,{className:"ml-2",icon:Object(jsx_runtime.jsx)(icons.G,{}),size:"small",status:"stealth",onClick:()=>onChange(void 0),"aria-label":"close"})]})}}),isEditingFeature||isNewEarlyAccessFeature?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{}):Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("b",{children:"Stage"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(src.LemonTag,{type:"beta"===earlyAccessFeature.stage?"warning":"general-availability"===earlyAccessFeature.stage?"success":"default",className:"mt-2 uppercase",children:earlyAccessFeature.stage})})]}),isEditingFeature||isNewEarlyAccessFeature?Object(jsx_runtime.jsx)(Field.a,{name:"description",label:"Description",showOptional:!0,children:Object(jsx_runtime.jsx)(src.LemonTextArea,{className:"ph-ignore-input",placeholder:"Help your users understand the feature"})}):Object(jsx_runtime.jsxs)("div",{className:"mb-2",children:[Object(jsx_runtime.jsx)("b",{children:"Description"}),Object(jsx_runtime.jsx)("div",{children:earlyAccessFeature.description?earlyAccessFeature.description:Object(jsx_runtime.jsx)("span",{className:"text-muted",children:"No description"})})]}),isEditingFeature||isNewEarlyAccessFeature?Object(jsx_runtime.jsx)(Field.a,{name:"documentation_url",label:"Documentation URL",showOptional:!0,children:Object(jsx_runtime.jsx)(src.LemonInput,{autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}):Object(jsx_runtime.jsxs)("div",{className:"mb-2",children:[Object(jsx_runtime.jsx)("b",{children:"Documentation Url"}),Object(jsx_runtime.jsx)("div",{children:earlyAccessFeature.documentation_url?earlyAccessFeature.documentation_url:Object(jsx_runtime.jsx)("span",{className:"text-muted",children:"No documentation url"})})]})]}),!isEditingFeature&&!isNewEarlyAccessFeature&&"id"in earlyAccessFeature&&Object(jsx_runtime.jsx)("div",{className:"flex-3 min-w-60",children:Object(jsx_runtime.jsx)(PersonList,{earlyAccessFeature:earlyAccessFeature})})]})]})}function FlagSelector(_ref3){let{value:value,onChange:onChange,readOnly:readOnly}=_ref3;const[visible,setVisible]=Object(react.useState)(!1),{featureFlag:featureFlag}=Object(index_esm.useValues)(Object(featureFlagLogic.b)({id:value||"link"})),taxonomicFilterLogicProps={groupType:TaxonomicFilter_types.a.FeatureFlags,value:value,onChange:(_,__,item)=>{"id"in item&&item.id&&onChange(item.id),setVisible(!1)},taxonomicGroupTypes:[TaxonomicFilter_types.a.FeatureFlags],optionsFromProp:void 0,popoverEnabled:!0,selectFirstItem:!0,taxonomicFilterLogicKey:"flag-selectorz"};return Object(jsx_runtime.jsx)(Popover.a,{overlay:Object(jsx_runtime.jsx)(TaxonomicFilter.a,{...taxonomicFilterLogicProps}),visible:visible,placement:"right-start",fallbackPlacements:["bottom"],onClickOutside:()=>setVisible(!1),children:readOnly?Object(jsx_runtime.jsx)("div",{children:featureFlag.key}):Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:()=>setVisible(!visible),children:featureFlag.key?featureFlag.key:"Select flag"})})}function PersonList(_ref4){let{earlyAccessFeature:earlyAccessFeature}=_ref4;const{implementOptInInstructionsModal:implementOptInInstructionsModal,activeTab:activeTab}=Object(index_esm.useValues)(earlyAccessFeatureLogic),{toggleImplementOptInInstructionsModal:toggleImplementOptInInstructionsModal,setActiveTab:setActiveTab}=Object(index_esm.useActions)(earlyAccessFeatureLogic),{featureFlag:featureFlag}=Object(index_esm.useValues)(Object(featureFlagLogic.b)({id:earlyAccessFeature.feature_flag.id||"link"})),key="$feature_enrollment/"+earlyAccessFeature.feature_flag.key;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LemonTabs.a,{activeKey:activeTab,onChange:newKey=>setActiveTab(newKey),tabs:[{key:types.p.OptedIn,label:"Opted-In Users",content:Object(jsx_runtime.jsx)(PersonsTableByFilter,{properties:[{key:key,type:types.T.Person,operator:types.V.Exact,value:["true"]}],emptyState:Object(jsx_runtime.jsxs)("div",{children:["No manual opt-ins. Manually opted-in people will appear here. Start by"," ",Object(jsx_runtime.jsx)("a",{onClick:toggleImplementOptInInstructionsModal,children:"implementing public opt-in"})]})})},{key:types.p.OptedOut,label:"Opted-Out Users",content:Object(jsx_runtime.jsx)(PersonsTableByFilter,{properties:[{key:key,type:types.T.Person,operator:types.V.Exact,value:["false"]}],emptyState:Object(jsx_runtime.jsxs)("div",{children:["No manual opt-outs. Manually opted-out people will appear here. Start by"," ",Object(jsx_runtime.jsx)("a",{onClick:toggleImplementOptInInstructionsModal,children:"implementing public opt-out"})]})})}]}),Object(jsx_runtime.jsx)(InstructionsModal,{featureFlag:featureFlag,visible:implementOptInInstructionsModal,onClose:toggleImplementOptInInstructionsModal})]})}function PersonsTableByFilter(_ref5){let{properties:properties,emptyState:emptyState}=_ref5;return Object(jsx_runtime.jsx)(Query.a,{query:{kind:schema.a.DataTableNode,columns:["*","person"],source:{kind:schema.a.PersonsNode,fixedProperties:properties},full:!0},context:{emptyState:emptyState}})}try{EarlyAccessFeature.displayName="EarlyAccessFeature",EarlyAccessFeature.__docgenInfo={description:"",displayName:"EarlyAccessFeature",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/early-access-features/EarlyAccessFeature.tsx#EarlyAccessFeature"]={docgenInfo:EarlyAccessFeature.__docgenInfo,name:"EarlyAccessFeature",path:"frontend/src/scenes/early-access-features/EarlyAccessFeature.tsx#EarlyAccessFeature"})}catch(__react_docgen_typescript_loader_error){}try{FlagSelector.displayName="FlagSelector",FlagSelector.__docgenInfo={description:"",displayName:"FlagSelector",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"number | undefined"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: any) => void"}},readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/early-access-features/EarlyAccessFeature.tsx#FlagSelector"]={docgenInfo:FlagSelector.__docgenInfo,name:"FlagSelector",path:"frontend/src/scenes/early-access-features/EarlyAccessFeature.tsx#FlagSelector"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/early-access-features/earlyAccessFeaturesLogic.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return earlyAccessFeaturesLogic}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/urls.ts");const earlyAccessFeaturesLogic=Object(kea__WEBPACK_IMPORTED_MODULE_0__.kea)([Object(kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","features","featuresLogic"]),Object(kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({earlyAccessFeatures:{__default:[],loadEarlyAccessFeatures:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.earlyAccessFeatures.list()).results}}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{name:"Early Access Management",path:scenes_urls__WEBPACK_IMPORTED_MODULE_3__.a.earlyAccessFeatures()}]]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((async _ref=>{let{actions:actions}=_ref;await actions.loadEarlyAccessFeatures()}))])},"./frontend/src/scenes/surveys/Survey.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"SurveyComponent",(function(){return SurveyComponent})),__webpack_require__.d(__webpack_exports__,"SurveyForm",(function(){return SurveyForm})),__webpack_require__.d(__webpack_exports__,"SurveyReleaseSummary",(function(){return SurveyReleaseSummary}));var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),surveysLogic=__webpack_require__("./frontend/src/scenes/surveys/surveysLogic.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),pluginsLogic=__webpack_require__("./frontend/src/scenes/plugins/pluginsLogic.ts"),eventUsageLogic=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const defaultSurveyAppearance={backgroundColor:"white",submitButtonColor:"#2C2C2C",textColor:"black",submitButtonText:"Submit",descriptionTextColor:"black"},NEW_SURVEY={id:"new",name:"",description:"",questions:[{type:types.kb.Open,question:"",link:null}],type:types.lb.Popover,linked_flag_id:void 0,targeting_flag_filters:void 0,linked_flag:null,targeting_flag:null,start_date:null,end_date:null,conditions:null,archived:!1,appearance:defaultSurveyAppearance},getSurveyDataQuery=survey=>({kind:schema.a.DataTableNode,source:{kind:schema.a.EventsQuery,select:["*","properties.$survey_response","timestamp","person"],orderBy:["timestamp DESC"],where:[`event == 'survey sent' or event == '${survey.name} survey sent'`],after:survey.created_at,properties:[{type:types.T.Event,key:"$survey_id",operator:types.V.Exact,value:survey.id}]},propertiesViaUrl:!0,showExport:!0,showReload:!0,showColumnConfigurator:!0,showEventFilter:!0,showPropertyFilter:!0}),getSurveyMetricsQueries=surveyId=>{const surveysShownHogqlQuery=`select count() as 'survey shown' from events where event == 'survey shown' and properties.$survey_id == '${surveyId}'`,surveysDismissedHogqlQuery=`select count() as 'survey dismissed' from events where event == 'survey dismissed' and properties.$survey_id == '${surveyId}'`;return{surveysShown:{kind:schema.a.DataTableNode,source:{kind:schema.a.HogQLQuery,query:surveysShownHogqlQuery}},surveysDismissed:{kind:schema.a.DataTableNode,source:{kind:schema.a.HogQLQuery,query:surveysDismissedHogqlQuery}}}},surveyLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","surveys","surveyLogic"]),Object(index_esm.props)({}),Object(index_esm.key)((_ref=>{let{id:id}=_ref;return id})),Object(index_esm.connect)((()=>({actions:[surveysLogic.b,["loadSurveys"],eventUsageLogic.d,["reportSurveyCreated","reportSurveyLaunched","reportSurveyEdited","reportSurveyArchived","reportSurveyStopped","reportSurveyViewed"]],values:[pluginsLogic.b,["installedPlugins"]]}))),Object(index_esm.actions)({editingSurvey:editing=>({editing:editing}),setTargetingFlagFilters:groups=>({groups:groups}),updateTargetingFlagFilters:(index,properties)=>({index:index,properties:properties}),addConditionSet:!0,removeConditionSet:index=>({index:index}),launchSurvey:!0,stopSurvey:!0,archiveSurvey:!0,setDataTableQuery:query=>({query:query}),setSurveyMetricsQueries:surveyMetricsQueries=>({surveyMetricsQueries:surveyMetricsQueries})}),Object(kea_loaders_lib.loaders)((_ref2=>{let{props:props,actions:actions}=_ref2;return{survey:{loadSurvey:async()=>{if(props.id&&"new"!==props.id){const survey=await api.b.surveys.get(props.id);return actions.reportSurveyViewed(survey),survey}return{...NEW_SURVEY}},createSurvey:async surveyPayload=>await api.b.surveys.create(surveyPayload),updateSurvey:async surveyPayload=>await api.b.surveys.update(props.id,surveyPayload),launchSurvey:async()=>{const startDate=Object(dayjs.a)();return await api.b.surveys.update(props.id,{start_date:startDate.toISOString()})},stopSurvey:async()=>await api.b.surveys.update(props.id,{end_date:Object(dayjs.a)().toISOString()})}}})),Object(index_esm.listeners)((_ref3=>{let{actions:actions}=_ref3;return{loadSurveySuccess:_ref4=>{var _survey$targeting_fla,_survey$targeting_fla2;let{survey:survey}=_ref4;survey.start_date&&"new"!==survey.id&&(actions.setDataTableQuery(getSurveyDataQuery(survey)),actions.setSurveyMetricsQueries(getSurveyMetricsQueries(survey.id))),null!==(_survey$targeting_fla=survey.targeting_flag)&&void 0!==_survey$targeting_fla&&null!==(_survey$targeting_fla2=_survey$targeting_fla.filters)&&void 0!==_survey$targeting_fla2&&_survey$targeting_fla2.groups&&actions.setTargetingFlagFilters(survey.targeting_flag.filters.groups)},createSurveySuccess:_ref5=>{let{survey:survey}=_ref5;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," created"]})),actions.loadSurveys(),kea_router_lib.router.actions.replace(urls.a.survey(survey.id)),actions.reportSurveyCreated(survey)},updateSurveySuccess:_ref6=>{let{survey:survey}=_ref6;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," updated"]})),actions.editingSurvey(!1),actions.reportSurveyEdited(survey),actions.loadSurveys()},launchSurveySuccess:_ref7=>{let{survey:survey}=_ref7;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," launched"]})),actions.setSurveyMetricsQueries(getSurveyMetricsQueries(survey.id)),actions.setDataTableQuery(getSurveyDataQuery(survey)),actions.loadSurveys(),actions.reportSurveyLaunched(survey)},stopSurveySuccess:_ref8=>{let{survey:survey}=_ref8;actions.loadSurveys(),actions.reportSurveyStopped(survey)},archiveSurvey:async()=>{actions.updateSurvey({archived:!0})}}})),Object(index_esm.reducers)({isEditingSurvey:[!1,{editingSurvey:(_,_ref9)=>{let{editing:editing}=_ref9;return editing}}],targetingFlagFilters:[null,{setTargetingFlagFilters:(_,_ref10)=>{let{groups:groups}=_ref10;return{groups:groups}},updateTargetingFlagFilters:(state,_ref11)=>{let{index:index,properties:properties}=_ref11;if(null!=state&&state.groups){const groups=[...state.groups];return void 0!==properties&&(groups[index]={...groups[index],properties:properties,rollout_percentage:100}),{...state,groups:groups}}return state},removeConditionSet:(state,_ref12)=>{let{index:index}=_ref12;const groups=[...(null==state?void 0:state.groups)||[]];return groups.splice(index,1),{...state,groups:groups}},addConditionSet:state=>{if(null!=state&&state.groups){const groups=[...state.groups,{properties:[],rollout_percentage:0,variant:null}];return{...state,groups:groups}}return{groups:[{properties:[],rollout_percentage:0,variant:null}]}}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref13)=>{let{query:query}=_ref13;return query}}],surveyMetricsQueries:[null,{setSurveyMetricsQueries:(_,_ref14)=>{let{surveyMetricsQueries:surveyMetricsQueries}=_ref14;return surveyMetricsQueries}}]}),Object(index_esm.selectors)({isSurveyRunning:[s=>[s.survey],survey=>!(!survey.start_date||survey.end_date)],propertySelectErrors:[s=>[s.survey],survey=>{var _survey$targeting_fla3,_survey$targeting_fla4;return null===(_survey$targeting_fla3=survey.targeting_flag_filters)||void 0===_survey$targeting_fla3||null===(_survey$targeting_fla4=_survey$targeting_fla3.groups)||void 0===_survey$targeting_fla4?void 0:_survey$targeting_fla4.map((_ref15=>{let{properties:properties}=_ref15;return{properties:null==properties?void 0:properties.map((property=>({value:null===property.value||void 0===property.value||Array.isArray(property.value)&&0===property.value.length?"Property filters can't be empty":void 0})))}}))}],breadcrumbs:[s=>[s.survey],survey=>[{name:"Surveys",path:urls.a.surveys()},...null!=survey&&survey.name?[{name:survey.name}]:[]]],surveyPlugin:[s=>[s.installedPlugins],installedPlugins=>installedPlugins.find((plugin=>"Surveys app"===plugin.name))]}),Object(lib.forms)((_ref16=>{let{actions:actions,props:props,values:values}=_ref16;return{survey:{defaults:{...NEW_SURVEY},errors:_ref17=>{let{name:name,questions:questions}=_ref17;return{name:!name&&"Please enter a name.",questions:questions.map((question=>({question:!question.question&&"Please enter a question.",...question.type===types.kb.Link?{link:!question.link&&"Please enter a url for the link."}:{}})))}},submit:async surveyPayload=>{const surveyPayloadWithTargetingFlagFilters={...surveyPayload,...values.targetingFlagFilters?{targeting_flag_filters:values.targetingFlagFilters}:{}};props.id&&"new"!==props.id?actions.updateSurvey(surveyPayloadWithTargetingFlagFilters):actions.createSurvey(surveyPayloadWithTargetingFlagFilters)}}}})),Object(kea_router_lib.urlToAction)((_ref18=>{var _props$id;let{actions:actions,props:props}=_ref18;return{[urls.a.survey(null!==(_props$id=props.id)&&void 0!==_props$id?_props$id:"new")]:(_,__,___,_ref19)=>{let{method:method}=_ref19;"PUSH"===method&&(props.id?actions.loadSurvey():actions.resetSurvey())}}})),Object(index_esm.afterMount)((async _ref20=>{let{props:props,actions:actions}=_ref20;"new"!==props.id&&await actions.loadSurvey(),"new"===props.id&&actions.resetSurvey()}))]);try{getSurveyDataQuery.displayName="getSurveyDataQuery",getSurveyDataQuery.__docgenInfo={description:"",displayName:"getSurveyDataQuery",props:{id:{defaultValue:null,description:"UUID",name:"id",required:!0,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"popover"'},{value:'"button"'},{value:'"full_screen"'},{value:'"email"'}]}},linked_flag_id:{defaultValue:null,description:"",name:"linked_flag_id",required:!0,type:{name:"number | null"}},linked_flag:{defaultValue:null,description:"",name:"linked_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag:{defaultValue:null,description:"",name:"targeting_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag_filters:{defaultValue:null,description:"",name:"targeting_flag_filters",required:!0,type:{name:'Pick<FeatureFlagFilters, "groups"> | undefined'}},conditions:{defaultValue:null,description:"",name:"conditions",required:!0,type:{name:"{ url: string; selector: string; is_headless?: boolean | undefined; } | null"}},appearance:{defaultValue:null,description:"",name:"appearance",required:!0,type:{name:"SurveyAppearance"}},questions:{defaultValue:null,description:"",name:"questions",required:!0,type:{name:"SurveyQuestion[]"}},created_at:{defaultValue:null,description:"",name:"created_at",required:!0,type:{name:"string"}},created_by:{defaultValue:null,description:"",name:"created_by",required:!0,type:{name:"UserBasicType | null"}},start_date:{defaultValue:null,description:"",name:"start_date",required:!0,type:{name:"string | null"}},end_date:{defaultValue:null,description:"",name:"end_date",required:!0,type:{name:"string | null"}},archived:{defaultValue:null,description:"",name:"archived",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyDataQuery"]={docgenInfo:getSurveyDataQuery.__docgenInfo,name:"getSurveyDataQuery",path:"frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyDataQuery"})}catch(__react_docgen_typescript_loader_error){}try{getSurveyMetricsQueries.displayName="getSurveyMetricsQueries",getSurveyMetricsQueries.__docgenInfo={description:"",displayName:"getSurveyMetricsQueries",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyMetricsQueries"]={docgenInfo:getSurveyMetricsQueries.__docgenInfo,name:"getSurveyMetricsQueries",path:"frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyMetricsQueries"})}catch(__react_docgen_typescript_loader_error){}var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),EarlyAccessFeature=__webpack_require__("./frontend/src/scenes/early-access-features/EarlyAccessFeature.tsx"),PropertyFilters=__webpack_require__("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),TaxonomicFilter_types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),CohortCriteriaRowBuilder=__webpack_require__("./frontend/src/scenes/cohorts/CohortFilters/CohortCriteriaRowBuilder.tsx"),utils=__webpack_require__("./frontend/src/lib/components/PropertyFilters/utils.ts"),DefinitionPopover_utils=__webpack_require__("./frontend/src/lib/components/DefinitionPopover/utils.ts"),apps_common_src=__webpack_require__("./frontend/@posthog/apps-common/src/index.ts"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.tsx"),EditableField=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),lib_utils=__webpack_require__("./frontend/src/lib/utils.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@4.46.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),SurveyAppearance=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@4.46.0/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/surveys/SurveyAppearance.scss"),SurveyAppearance_default=__webpack_require__.n(SurveyAppearance),options={insert:"head",singleton:!1};injectStylesIntoStyleTag_default()(SurveyAppearance_default.a,options),SurveyAppearance_default.a.locals;function SurveyAppearance_SurveyAppearance(_ref){let{type:type,question:question,appearance:appearance,description:description,link:link,readOnly:readOnly,onAppearanceChange:onAppearanceChange}=_ref;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("h3",{className:"mb-4 text-center",children:"Preview"}),Object(jsx_runtime.jsx)(BaseAppearance,{type:type,question:question,description:description,appearance:appearance,link:link}),!readOnly&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[Object(jsx_runtime.jsx)("div",{className:"mt-2",children:"Background color"}),Object(jsx_runtime.jsx)(src.LemonInput,{value:null==appearance?void 0:appearance.backgroundColor,onChange:backgroundColor=>onAppearanceChange({...appearance,backgroundColor:backgroundColor})}),Object(jsx_runtime.jsx)("div",{className:"mt-2",children:"Question text color"}),Object(jsx_runtime.jsx)(src.LemonInput,{value:null==appearance?void 0:appearance.textColor,onChange:textColor=>onAppearanceChange({...appearance,textColor:textColor})}),Object(jsx_runtime.jsx)("div",{className:"mt-2",children:"Submit button color"}),Object(jsx_runtime.jsx)(src.LemonInput,{value:null==appearance?void 0:appearance.submitButtonColor,onChange:submitButtonColor=>onAppearanceChange({...appearance,submitButtonColor:submitButtonColor})}),Object(jsx_runtime.jsx)("div",{className:"mt-2",children:"Description text color"}),Object(jsx_runtime.jsx)(src.LemonInput,{value:(null==appearance?void 0:appearance.descriptionTextColor)||defaultSurveyAppearance.descriptionTextColor,onChange:descriptionTextColor=>onAppearanceChange({...appearance,descriptionTextColor:descriptionTextColor})}),Object(jsx_runtime.jsx)("div",{className:"mt-2",children:"Submit button text"}),Object(jsx_runtime.jsx)(src.LemonInput,{value:(null==appearance?void 0:appearance.submitButtonText)||defaultSurveyAppearance.submitButtonText,onChange:submitButtonText=>onAppearanceChange({...appearance,submitButtonText:submitButtonText})})]})]})}const posthogLogoSVG=Object(jsx_runtime.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"12",viewBox:"0 0 50 30",fill:"none",children:[Object(jsx_runtime.jsx)("path",{d:"M10.8914 17.2057c-.3685.7371-1.42031.7371-1.78884 0L8.2212 15.443c-.14077-.2815-.14077-.6129 0-.8944l.88136-1.7627c.36853-.7371 1.42034-.7371 1.78884 0l.8814 1.7627c.1407.2815.1407.6129 0 .8944l-.8814 1.7627zM10.8914 27.2028c-.3685.737-1.42031.737-1.78884 0L8.2212 25.44c-.14077-.2815-.14077-.6129 0-.8944l.88136-1.7627c.36853-.7371 1.42034-.7371 1.78884 0l.8814 1.7627c.1407.2815.1407.6129 0 .8944l-.8814 1.7628z",fill:"##6A6B69"}),Object(jsx_runtime.jsx)("path",{d:"M0 23.4082c0-.8909 1.07714-1.3371 1.70711-.7071l4.58338 4.5834c.62997.63.1838 1.7071-.7071 1.7071H.999999c-.552284 0-.999999-.4477-.999999-1v-4.5834zm0-4.8278c0 .2652.105357.5196.292893.7071l9.411217 9.4112c.18753.1875.44189.2929.70709.2929h5.1692c.8909 0 1.3371-1.0771.7071-1.7071L1.70711 12.7041C1.07714 12.0741 0 12.5203 0 13.4112v5.1692zm0-9.99701c0 .26521.105357.51957.292893.7071L19.7011 28.6987c.1875.1875.4419.2929.7071.2929h5.1692c.8909 0 1.3371-1.0771.7071-1.7071L1.70711 2.70711C1.07715 2.07715 0 2.52331 0 3.41421v5.16918zm9.997 0c0 .26521.1054.51957.2929.7071l17.994 17.99401c.63.63 1.7071.1838 1.7071-.7071v-5.1692c0-.2652-.1054-.5196-.2929-.7071l-17.994-17.994c-.63-.62996-1.7071-.18379-1.7071.70711v5.16918zm11.7041-5.87628c-.63-.62997-1.7071-.1838-1.7071.7071v5.16918c0 .26521.1054.51957.2929.7071l7.997 7.99701c.63.63 1.7071.1838 1.7071-.7071v-5.1692c0-.2652-.1054-.5196-.2929-.7071l-7.997-7.99699z",fill:"#6A6B69"}),Object(jsx_runtime.jsx)("path",{d:"M42.5248 23.5308l-9.4127-9.4127c-.63-.63-1.7071-.1838-1.7071.7071v13.1664c0 .5523.4477 1 1 1h14.5806c.5523 0 1-.4477 1-1v-1.199c0-.5523-.4496-.9934-.9973-1.0647-1.6807-.2188-3.2528-.9864-4.4635-2.1971zm-6.3213 2.2618c-.8829 0-1.5995-.7166-1.5995-1.5996 0-.8829.7166-1.5995 1.5995-1.5995.883 0 1.5996.7166 1.5996 1.5995 0 .883-.7166 1.5996-1.5996 1.5996z",fill:"#6A6B69"}),Object(jsx_runtime.jsx)("path",{d:"M0 27.9916c0 .5523.447715 1 1 1h4.58339c.8909 0 1.33707-1.0771.70711-1.7071l-4.58339-4.5834C1.07714 22.0711 0 22.5173 0 23.4082v4.5834zM9.997 10.997L1.70711 2.70711C1.07714 2.07714 0 2.52331 0 3.41421v5.16918c0 .26521.105357.51957.292893.7071L9.997 18.9946V10.997zM1.70711 12.7041C1.07714 12.0741 0 12.5203 0 13.4112v5.1692c0 .2652.105357.5196.292893.7071L9.997 28.9916V20.994l-8.28989-8.2899z",fill:"#6A6B69"}),Object(jsx_runtime.jsx)("path",{d:"M19.994 11.4112c0-.2652-.1053-.5196-.2929-.7071l-7.997-7.99699c-.6299-.62997-1.70709-.1838-1.70709.7071v5.16918c0 .26521.10539.51957.29289.7071l9.7041 9.70411v-7.5834zM9.99701 28.9916h5.58339c.8909 0 1.3371-1.0771.7071-1.7071L9.99701 20.994v7.9976zM9.99701 10.997v7.5834c0 .2652.10539.5196.29289.7071l9.7041 9.7041v-7.5834c0-.2652-.1053-.5196-.2929-.7071L9.99701 10.997z",fill:"#6a6b69"})]});function BaseAppearance(_ref2){let{type:type,question:question,appearance:appearance,description:description,link:link}=_ref2;return Object(jsx_runtime.jsx)("form",{className:"survey-form",style:{backgroundColor:appearance.backgroundColor},children:Object(jsx_runtime.jsxs)("div",{className:"survey-box",children:[Object(jsx_runtime.jsx)("div",{className:"cancel-btn-wrapper",children:Object(jsx_runtime.jsx)("button",{className:"form-cancel",type:"button",style:{backgroundColor:appearance.backgroundColor},children:"X"})}),Object(jsx_runtime.jsxs)("div",{className:"question-textarea-wrapper",children:[Object(jsx_runtime.jsx)("div",{className:"survey-question",style:{color:appearance.textColor},children:question}),description&&Object(jsx_runtime.jsx)("div",{className:"description",style:{color:appearance.descriptionTextColor},children:description}),type===types.kb.Open&&Object(jsx_runtime.jsx)("textarea",{className:"survey-textarea",name:"survey",rows:4})]}),Object(jsx_runtime.jsxs)("div",{className:"bottom-section",children:[Object(jsx_runtime.jsx)("div",{className:"buttons",children:Object(jsx_runtime.jsx)("button",{className:"form-submit",type:"button",onClick:()=>{link&&type===types.kb.Link&&window.open(link)},style:{backgroundColor:appearance.submitButtonColor},children:appearance.submitButtonText||"Submit"})}),Object(jsx_runtime.jsxs)("div",{className:"footer-branding",children:["powered by ",posthogLogoSVG," PostHog"]})]})]})})}try{SurveyAppearance_SurveyAppearance.displayName="SurveyAppearance",SurveyAppearance_SurveyAppearance.__docgenInfo={description:"",displayName:"SurveyAppearance",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"open"'},{value:'"multiple_single"'},{value:'"multiple_multi"'},{value:'"nps"'},{value:'"rating"'},{value:'"link"'}]}},question:{defaultValue:null,description:"",name:"question",required:!0,type:{name:"string"}},appearance:{defaultValue:null,description:"",name:"appearance",required:!0,type:{name:"SurveyAppearance"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string | null"}},link:{defaultValue:null,description:"",name:"link",required:!1,type:{name:"string | null"}},readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}},onAppearanceChange:{defaultValue:null,description:"",name:"onAppearanceChange",required:!0,type:{name:"(appearance: SurveyAppearance) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/SurveyAppearance.tsx#SurveyAppearance"]={docgenInfo:SurveyAppearance_SurveyAppearance.__docgenInfo,name:"SurveyAppearance",path:"frontend/src/scenes/surveys/SurveyAppearance.tsx#SurveyAppearance"})}catch(__react_docgen_typescript_loader_error){}function SurveyView(_ref){var _survey$targeting_fla;let{id:id}=_ref;const{survey:survey,dataTableQuery:dataTableQuery,surveyLoading:surveyLoading,surveyPlugin:surveyPlugin,surveyMetricsQueries:surveyMetricsQueries}=Object(index_esm.useValues)(surveyLogic),{editingSurvey:editingSurvey,updateSurvey:updateSurvey,launchSurvey:launchSurvey,stopSurvey:stopSurvey,archiveSurvey:archiveSurvey}=Object(index_esm.useActions)(surveyLogic),{deleteSurvey:deleteSurvey}=Object(index_esm.useActions)(surveysLogic.b),{editPlugin:editPlugin}=Object(index_esm.useActions)(pluginsLogic.b),[tabKey,setTabKey]=Object(react.useState)(survey.start_date?"results":"overview");return Object(react.useEffect)((()=>{survey.start_date&&setTabKey("results")}),[survey.start_date]),Object(jsx_runtime.jsx)("div",{children:surveyLoading?Object(jsx_runtime.jsx)(LemonSkeleton.a,{}):Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:survey.name,buttons:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(More.a,{overlay:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!survey.end_date&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"edit-survey",fullWidth:!0,onClick:()=>editingSurvey(!0),children:"Edit"}),Object(jsx_runtime.jsx)(src.LemonDivider,{})]}),Object(jsx_runtime.jsx)(src.LemonButton,{status:"danger",onClick:()=>deleteSurvey(id),children:"Delete survey"})]})}),Object(jsx_runtime.jsx)(src.LemonDivider,{vertical:!0}),survey.start_date?survey.end_date&&!survey.archived?Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:()=>archiveSurvey(),children:"Archive"}):!survey.archived&&Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",status:"danger",onClick:()=>stopSurvey(),children:"Stop"}):Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>{launchSurvey()},children:"Launch"})]}),caption:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:survey&&!!survey.description&&Object(jsx_runtime.jsx)(EditableField.a,{multiline:!0,name:"description",value:survey.description||"",placeholder:"Description (optional)",onSave:value=>updateSurvey({id:id,description:value}),saveOnBlur:!0,compactButtons:!0})})}),Object(jsx_runtime.jsx)(LemonTabs.a,{activeKey:tabKey,onChange:key=>setTabKey(key),tabs:[{content:Object(jsx_runtime.jsxs)("div",{className:"flex flex-row",children:[Object(jsx_runtime.jsxs)("div",{className:"flex flex-col w-full",children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Type"}),Object(jsx_runtime.jsx)("span",{children:Object(lib_utils.i)(survey.questions[0].type)}),Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Question"}),survey.questions.map(((q,idx)=>Object(jsx_runtime.jsx)("span",{children:q.question},idx))),survey.questions[0].type===types.kb.Link&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Link url"}),Object(jsx_runtime.jsx)("span",{children:survey.questions[0].link})]}),Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Linked feature flag"}),survey.linked_flag?Object(jsx_runtime.jsx)(src.Link,{to:urls.a.featureFlag(survey.linked_flag.id),children:survey.linked_flag.key}):Object(jsx_runtime.jsx)("span",{children:"None"}),Object(jsx_runtime.jsxs)("div",{className:"flex flex-row gap-8",children:[survey.start_date&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Start date"}),Object(jsx_runtime.jsx)(apps_common_src.TZLabel,{time:survey.start_date})]}),survey.end_date&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"End date"}),Object(jsx_runtime.jsx)(apps_common_src.TZLabel,{time:survey.end_date})]})]}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsx)("span",{className:"card-secondary",children:"Release summary"}),Object(jsx_runtime.jsx)(SurveyReleaseSummary,{id:id,survey:survey,targetingFlagFilters:null===(_survey$targeting_fla=survey.targeting_flag)||void 0===_survey$targeting_fla?void 0:_survey$targeting_fla.filters})]}),Object(jsx_runtime.jsxs)("div",{className:"w-full flex flex-col items-center",children:[Object(jsx_runtime.jsx)(src.LemonCollapse,{className:"w-full",panels:[{key:"1",header:"Survey setup help",content:Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[Object(jsx_runtime.jsx)("span",{className:"font-medium mb-2",children:"Option 1: Enable the surveys app (recommended)"}),Object(jsx_runtime.jsxs)("div",{className:"flex gap-2 items-start",children:[Object(jsx_runtime.jsx)(src.LemonCheckbox,{})," Add the following option to your PostHog instance:"]}),Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:OPT_IN_SNIPPET}),Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[Object(jsx_runtime.jsx)(src.LemonCheckbox,{})," ",Object(jsx_runtime.jsx)(src.LemonButton,{onClick:()=>(null==surveyPlugin?void 0:surveyPlugin.id)&&editPlugin(surveyPlugin.id),children:"Enable and save the surveys app"})]})]}),Object(jsx_runtime.jsxs)("div",{className:"flex flex-col mt-3",children:[Object(jsx_runtime.jsx)("span",{className:"font-medium",children:"Option 2: Create your own custom survey UI with our headless API"}),Object(jsx_runtime.jsx)(src.Link,{to:"https://posthog.com/docs/surveys/manual",target:"_blank",children:"See documentation"})]})]})}]}),Object(jsx_runtime.jsx)("div",{className:"mt-6",children:Object(jsx_runtime.jsx)(SurveyAppearance_SurveyAppearance,{type:survey.questions[0].type,appearance:survey.appearance||defaultSurveyAppearance,question:survey.questions[0].question,description:survey.questions[0].description,link:survey.questions[0].link,readOnly:!0,onAppearanceChange:()=>{}})})]})]}),key:"overview",label:"Overview"},survey.start_date?{content:Object(jsx_runtime.jsxs)("div",{children:[surveyMetricsQueries&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-row gap-4 mb-4",children:[Object(jsx_runtime.jsx)("div",{className:"flex-1",children:Object(jsx_runtime.jsx)(Query.a,{query:surveyMetricsQueries.surveysShown})}),Object(jsx_runtime.jsx)("div",{className:"flex-1",children:Object(jsx_runtime.jsx)(Query.a,{query:surveyMetricsQueries.surveysDismissed})})]}),surveyLoading?Object(jsx_runtime.jsx)(LemonSkeleton.a,{}):Object(jsx_runtime.jsx)(Query.a,{query:dataTableQuery})]}),key:"results",label:"Results"}:null]})]})})}const OPT_IN_SNIPPET="posthog.init('YOUR_PROJECT_API_KEY', {\n    api_host: 'YOUR API HOST',\n    opt_in_site_apps: true // <--- Add this line\n})";try{SurveyView.displayName="SurveyView",SurveyView.__docgenInfo={description:"",displayName:"SurveyView",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/SurveyView.tsx#SurveyView"]={docgenInfo:SurveyView.__docgenInfo,name:"SurveyView",path:"frontend/src/scenes/surveys/SurveyView.tsx#SurveyView"})}catch(__react_docgen_typescript_loader_error){}var cohortsModel=__webpack_require__("./frontend/src/models/cohortsModel.ts");const scene={component:SurveyComponent,logic:surveyLogic,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{id:id}}};function SurveyComponent(){let{id:id}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{isEditingSurvey:isEditingSurvey}=Object(index_esm.useValues)(surveyLogic),showSurveyForm="new"===id||isEditingSurvey;return Object(jsx_runtime.jsx)("div",{children:id?Object(jsx_runtime.jsx)(index_esm.BindLogic,{logic:surveyLogic,props:{id:id},children:showSurveyForm?Object(jsx_runtime.jsx)(SurveyForm,{id:id}):Object(jsx_runtime.jsx)(SurveyView,{id:id})}):Object(jsx_runtime.jsx)(LemonSkeleton.a,{})})}function SurveyForm(_ref2){let{id:id}=_ref2;const{survey:survey,surveyLoading:surveyLoading,isEditingSurvey:isEditingSurvey,propertySelectErrors:propertySelectErrors,targetingFlagFilters:targetingFlagFilters}=Object(index_esm.useValues)(surveyLogic),{loadSurvey:loadSurvey,editingSurvey:editingSurvey,updateTargetingFlagFilters:updateTargetingFlagFilters,removeConditionSet:removeConditionSet,addConditionSet:addConditionSet}=Object(index_esm.useActions)(surveyLogic);return Object(jsx_runtime.jsxs)(lib.Form,{formKey:"survey",logic:surveyLogic,className:"space-y-4",enableFormOnSubmit:!0,children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:"new"===id?"New survey":survey.name,buttons:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-survey",type:"secondary",loading:surveyLoading,onClick:()=>{isEditingSurvey?(editingSurvey(!1),loadSurvey()):kea_router_lib.router.actions.push(urls.a.surveys())},children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:surveyLoading,children:"new"===id?"Save as draft":"Save"})]})}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsxs)("div",{className:"flex flex-row gap-4",children:[Object(jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 max-w-160",children:[Object(jsx_runtime.jsx)(Field.a,{name:"name",label:"Name",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"survey-name"})}),Object(jsx_runtime.jsx)(Field.a,{name:"description",label:"Description (optional)",children:Object(jsx_runtime.jsx)(src.LemonTextArea,{"data-attr":"survey-description"})}),Object(jsx_runtime.jsx)(Field.a,{name:"linked_flag_id",label:"Link feature flag (optional)",info:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Connecting to a feature flag will automatically enable this survey for everyone in the feature flag."}),children:_ref3=>{let{value:value,onChange:onChange}=_ref3;return Object(jsx_runtime.jsxs)("div",{className:"flex",children:[Object(jsx_runtime.jsx)(EarlyAccessFeature.FlagSelector,{value:value,onChange:onChange}),value&&Object(jsx_runtime.jsx)(src.LemonButton,{className:"ml-2",icon:Object(jsx_runtime.jsx)(icons.z,{}),size:"small",status:"stealth",onClick:()=>onChange(void 0),"aria-label":"close"})]})}}),survey.questions.map(((question,index)=>Object(jsx_runtime.jsxs)(lib.Group,{name:`questions.${index}`,children:[Object(jsx_runtime.jsx)(Field.a,{name:"type",label:"Type",className:"w-max",children:Object(jsx_runtime.jsx)(src.LemonSelect,{options:[{label:"Open text",value:types.kb.Open},{label:"Link",value:types.kb.Link}]})}),Object(jsx_runtime.jsx)(Field.a,{name:"question",label:"Question",children:Object(jsx_runtime.jsx)(src.LemonInput,{value:question.question})}),Object(jsx_runtime.jsx)(Field.a,{name:"description",label:"Question description (optional)",children:Object(jsx_runtime.jsx)(src.LemonTextArea,{value:question.description||""})}),question.type===types.kb.Link&&Object(jsx_runtime.jsx)(Field.a,{name:"link",label:"Link",info:"Make sure to include https:// in the url.",children:Object(jsx_runtime.jsx)(src.LemonInput,{value:question.link||"",placeholder:"https://posthog.com"})})]},index))),Object(jsx_runtime.jsxs)(Field.b,{label:"Targeting (optional)",className:"mt-4",children:[Object(jsx_runtime.jsx)("span",{className:"text-muted",children:"Choose when the survey appears based on url, selector, and user properties."}),Object(jsx_runtime.jsx)("span",{children:Object(jsx_runtime.jsx)("b",{children:"Warning: If there are no targeting options set, the survey will display on all domains to everyone."})}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsx)(Field.a,{name:"conditions",children:_ref4=>{let{value:value,onChange:onChange}=_ref4;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(Field.b,{label:"Url",children:Object(jsx_runtime.jsx)(src.LemonInput,{value:null==value?void 0:value.url,onChange:urlVal=>onChange({...value,url:urlVal}),placeholder:"ex: https://app.posthog.com"})}),Object(jsx_runtime.jsx)(CohortCriteriaRowBuilder.b,{logicalOperator:types.v.And}),Object(jsx_runtime.jsx)(Field.b,{label:"Selector",children:Object(jsx_runtime.jsx)(src.LemonInput,{value:null==value?void 0:value.selector,onChange:selectorVal=>onChange({...value,selector:selectorVal}),placeholder:"ex: .className or #id"})})]})}}),Object(jsx_runtime.jsx)(CohortCriteriaRowBuilder.b,{logicalOperator:types.v.And}),Object(jsx_runtime.jsx)(Field.b,{label:"User properties",children:((null==targetingFlagFilters?void 0:targetingFlagFilters.groups)||[]).map(((group,index)=>{var _propertySelectErrors,_propertySelectErrors2;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[index>0&&Object(jsx_runtime.jsx)("div",{className:"text-primary-alt font-semibold text-xs ml-2",children:"OR"}),Object(jsx_runtime.jsxs)("div",{className:"border rounded p-4",children:[Object(jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[Object(jsx_runtime.jsxs)("div",{children:["Matching ",Object(jsx_runtime.jsx)("b",{children:"users"})," against the criteria"]}),Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)(icons.S,{}),status:"muted",size:"small",noPadding:!0,onClick:()=>removeConditionSet(index)})]}),Object(jsx_runtime.jsx)(src.LemonDivider,{className:"my-3"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(PropertyFilters.a,{orFiltering:!0,pageKey:`survey-${id}-targeting-${index}`,propertyFilters:group.properties,logicalRowDivider:!0,addButton:Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)(icons.uc,{}),sideIcon:null,noPadding:!0,children:"Add condition"}),onChange:properties=>updateTargetingFlagFilters(index,properties),taxonomicGroupTypes:[TaxonomicFilter_types.a.PersonProperties,TaxonomicFilter_types.a.Cohorts],hasRowOperator:!1,sendAllKeyUpdates:!0,errorMessages:null!=propertySelectErrors&&null!==(_propertySelectErrors=propertySelectErrors[index])&&void 0!==_propertySelectErrors&&null!==(_propertySelectErrors2=_propertySelectErrors.properties)&&void 0!==_propertySelectErrors2&&_propertySelectErrors2.some((message=>!!message.value))?propertySelectErrors[index].properties.map(((message,index)=>message.value?Object(jsx_runtime.jsxs)("div",{className:"text-danger flex items-center gap-1 text-sm",children:[Object(jsx_runtime.jsx)(icons.bb,{className:"text-xl"})," ",message.value]},index):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{}))):null})})]})]})}))}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",className:"mt-0 w-max",onClick:addConditionSet,icon:Object(jsx_runtime.jsx)(icons.tc,{}),children:"Add condition set"})]})]}),Object(jsx_runtime.jsx)(src.LemonDivider,{vertical:!0}),Object(jsx_runtime.jsx)("div",{className:"flex flex-col flex-1 items-center",children:Object(jsx_runtime.jsx)(Field.a,{name:"appearance",label:"",children:_ref5=>{let{value:value,onChange:onChange}=_ref5;return Object(jsx_runtime.jsx)(SurveyAppearance_SurveyAppearance,{type:survey.questions[0].type,question:survey.questions[0].question,description:survey.questions[0].description,onAppearanceChange:appearance=>{onChange(appearance)},link:survey.questions[0].link,appearance:value||defaultSurveyAppearance})}})})]}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsx)(src.LemonCollapse,{panels:[{key:"1",header:"Release summary",content:Object(jsx_runtime.jsx)(SurveyReleaseSummary,{id:id,survey:survey,targetingFlagFilters:targetingFlagFilters})}]}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-survey",type:"secondary",loading:surveyLoading,onClick:()=>{isEditingSurvey?(editingSurvey(!1),loadSurvey()):kea_router_lib.router.actions.push(urls.a.surveys())},children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:surveyLoading,children:"new"===id?"Save as draft":"Save"})]})]})}function SurveyReleaseSummary(_ref6){var _survey$conditions,_survey$conditions2,_survey$linked_flag,_survey$linked_flag2,_survey$linked_flag3,_survey$conditions3,_survey$conditions4,_targetingFlagFilters,_targetingFlagFilters2,_targetingFlagFilters3,_targetingFlagFilters4;let{id:id,survey:survey,targetingFlagFilters:targetingFlagFilters}=_ref6;const{cohortsById:cohortsById}=Object(index_esm.useValues)(cohortsModel.a);return Object(jsx_runtime.jsxs)("div",{className:"flex flex-col mt-2 gap-2",children:[Object(jsx_runtime.jsx)("div",{children:survey.linked_flag_id||null!==(_survey$conditions=survey.conditions)&&void 0!==_survey$conditions&&_survey$conditions.url||null!==(_survey$conditions2=survey.conditions)&&void 0!==_survey$conditions2&&_survey$conditions2.selector||targetingFlagFilters?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["This survey ",survey.start_date?"is":"will be"," released to users who match ",Object(jsx_runtime.jsx)("b",{children:"all"})," of the following:"]}):Object(jsx_runtime.jsx)(src.LemonTag,{type:"highlight",children:Object(jsx_runtime.jsxs)("span",{className:"text-sm",children:["This survey ",survey.start_date?"is":"will be"," released to everyone"]})})}),survey.linked_flag_id&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-row font-medium gap-1",children:[Object(jsx_runtime.jsx)("span",{children:"Feature flag enabled for:"})," ","new"!==id?null!==(_survey$linked_flag=survey.linked_flag)&&void 0!==_survey$linked_flag&&_survey$linked_flag.id?Object(jsx_runtime.jsx)(src.Link,{to:urls.a.featureFlag(null===(_survey$linked_flag2=survey.linked_flag)||void 0===_survey$linked_flag2?void 0:_survey$linked_flag2.id),children:null===(_survey$linked_flag3=survey.linked_flag)||void 0===_survey$linked_flag3?void 0:_survey$linked_flag3.key}):null:Object(jsx_runtime.jsx)(EarlyAccessFeature.FlagSelector,{value:survey.linked_flag_id,readOnly:!0,onChange:()=>{}})]}),(null===(_survey$conditions3=survey.conditions)||void 0===_survey$conditions3?void 0:_survey$conditions3.url)&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-row font-medium gap-1",children:[Object(jsx_runtime.jsx)("span",{children:"Url contains:"})," ",Object(jsx_runtime.jsx)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:survey.conditions.url})]}),(null===(_survey$conditions4=survey.conditions)||void 0===_survey$conditions4?void 0:_survey$conditions4.selector)&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-row font-medium gap-1",children:[Object(jsx_runtime.jsx)("span",{children:"Selector matches:"})," ",Object(jsx_runtime.jsx)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:survey.conditions.selector})]}),((null==targetingFlagFilters||null===(_targetingFlagFilters=targetingFlagFilters.groups)||void 0===_targetingFlagFilters||null===(_targetingFlagFilters2=_targetingFlagFilters[0])||void 0===_targetingFlagFilters2||null===(_targetingFlagFilters3=_targetingFlagFilters2.properties)||void 0===_targetingFlagFilters3?void 0:_targetingFlagFilters3.length)||0)>0&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-row font-medium gap-1",children:[Object(jsx_runtime.jsx)("span",{children:"User conditions:"})," "]}),null==targetingFlagFilters||null===(_targetingFlagFilters4=targetingFlagFilters.groups)||void 0===_targetingFlagFilters4?void 0:_targetingFlagFilters4.map(((group,index)=>{var _group$properties;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[index>0&&Object(jsx_runtime.jsx)("div",{className:"text-primary-alt font-semibold text-xs ml-2 py-1",children:"OR"}),null===(_group$properties=group.properties)||void 0===_group$properties?void 0:_group$properties.map(((property,idx)=>{var _cohortsById$property;return Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsxs)("div",{className:"feature-flag-property-display",children:[0===idx?Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)(icons.bd,{className:"arrow-right"}),status:"muted",size:"small"}):Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)("span",{className:"text-sm",children:"&"}),status:"muted",size:"small"}),Object(jsx_runtime.jsxs)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:["cohort"===property.type?"Cohort":property.key," "]}),Object(utils.e)(property)?Object(jsx_runtime.jsxs)("span",{children:[Object(DefinitionPopover_utils.a)(property.operator)," "]}):null,"cohort"===property.type?Object(jsx_runtime.jsx)("a",{href:urls.a.cohort(property.value),target:"_blank",rel:"noopener",className:"simple-tag tag-light-blue text-primary-alt display-value",children:property.value&&(null===(_cohortsById$property=cohortsById[property.value])||void 0===_cohortsById$property?void 0:_cohortsById$property.name)||`ID ${property.value}`}):[...Array.isArray(property.value)?property.value:[property.value]].map(((val,idx)=>Object(jsx_runtime.jsx)("span",{className:"simple-tag tag-light-blue text-primary-alt display-value",children:val},idx)))]},idx)})}))]})}))]})}try{SurveyComponent.displayName="SurveyComponent",SurveyComponent.__docgenInfo={description:"",displayName:"SurveyComponent",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#SurveyComponent"]={docgenInfo:SurveyComponent.__docgenInfo,name:"SurveyComponent",path:"frontend/src/scenes/surveys/Survey.tsx#SurveyComponent"})}catch(__react_docgen_typescript_loader_error){}try{SurveyForm.displayName="SurveyForm",SurveyForm.__docgenInfo={description:"",displayName:"SurveyForm",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#SurveyForm"]={docgenInfo:SurveyForm.__docgenInfo,name:"SurveyForm",path:"frontend/src/scenes/surveys/Survey.tsx#SurveyForm"})}catch(__react_docgen_typescript_loader_error){}try{SurveyReleaseSummary.displayName="SurveyReleaseSummary",SurveyReleaseSummary.__docgenInfo={description:"",displayName:"SurveyReleaseSummary",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},survey:{defaultValue:null,description:"",name:"survey",required:!0,type:{name:"Survey | NewSurvey"}},targetingFlagFilters:{defaultValue:null,description:"",name:"targetingFlagFilters",required:!1,type:{name:'Pick<FeatureFlagFilters, "groups"> | null'}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#SurveyReleaseSummary"]={docgenInfo:SurveyReleaseSummary.__docgenInfo,name:"SurveyReleaseSummary",path:"frontend/src/scenes/surveys/Survey.tsx#SurveyReleaseSummary"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/surveys/surveysLogic.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getSurveyStatus})),__webpack_require__.d(__webpack_exports__,"b",(function(){return surveysLogic}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/types.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/urls.ts"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea_router__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js");function getSurveyStatus(survey){return survey.start_date?survey.end_date?_types__WEBPACK_IMPORTED_MODULE_3__.Q.Complete:_types__WEBPACK_IMPORTED_MODULE_3__.Q.Running:_types__WEBPACK_IMPORTED_MODULE_3__.Q.Draft}const surveysLogic=Object(kea__WEBPACK_IMPORTED_MODULE_0__.kea)([Object(kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","surveys","surveysLogic"]),Object(kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)((_ref=>{let{values:values}=_ref;return{surveys:{__default:[],loadSurveys:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.surveys.list()).results,deleteSurvey:async id=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.surveys.delete(id),values.surveys.filter((survey=>survey.id!==id)))}}})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((()=>({deleteSurveySuccess:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.lemonToast.success("Survey deleted"),kea_router__WEBPACK_IMPORTED_MODULE_6__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_4__.a.surveys())}}))),Object(kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{name:"Surveys",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.a.surveys()}]],nonArchivedSurveys:[s=>[s.surveys],surveys=>surveys.filter((survey=>!survey.archived))],archivedSurveys:[s=>[s.surveys],surveys=>surveys.filter((survey=>survey.archived))]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((async _ref2=>{let{actions:actions}=_ref2;await actions.loadSurveys()}))]);try{getSurveyStatus.displayName="getSurveyStatus",getSurveyStatus.__docgenInfo={description:"",displayName:"getSurveyStatus",props:{id:{defaultValue:null,description:"UUID",name:"id",required:!0,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"popover"'},{value:'"button"'},{value:'"full_screen"'},{value:'"email"'}]}},linked_flag_id:{defaultValue:null,description:"",name:"linked_flag_id",required:!0,type:{name:"number | null"}},linked_flag:{defaultValue:null,description:"",name:"linked_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag:{defaultValue:null,description:"",name:"targeting_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag_filters:{defaultValue:null,description:"",name:"targeting_flag_filters",required:!0,type:{name:'Pick<FeatureFlagFilters, "groups"> | undefined'}},conditions:{defaultValue:null,description:"",name:"conditions",required:!0,type:{name:"{ url: string; selector: string; is_headless?: boolean | undefined; } | null"}},appearance:{defaultValue:null,description:"",name:"appearance",required:!0,type:{name:"SurveyAppearance"}},questions:{defaultValue:null,description:"",name:"questions",required:!0,type:{name:"SurveyQuestion[]"}},created_at:{defaultValue:null,description:"",name:"created_at",required:!0,type:{name:"string"}},created_by:{defaultValue:null,description:"",name:"created_by",required:!0,type:{name:"UserBasicType | null"}},start_date:{defaultValue:null,description:"",name:"start_date",required:!0,type:{name:"string | null"}},end_date:{defaultValue:null,description:"",name:"end_date",required:!0,type:{name:"string | null"}},archived:{defaultValue:null,description:"",name:"archived",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveysLogic.tsx#getSurveyStatus"]={docgenInfo:getSurveyStatus.__docgenInfo,name:"getSurveyStatus",path:"frontend/src/scenes/surveys/surveysLogic.tsx#getSurveyStatus"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@4.46.0/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/surveys/SurveyAppearance.scss":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,'.survey-form{color:#000;font-weight:400;font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;text-align:left;z-index:99999;flex-direction:column;background:#fff;border:1px solid #f0f0f0;border-radius:8px;padding-top:5px;max-width:300px;box-shadow:-6px 0 16px -8px rgba(0,0,0,.08),-9px 0 28px 0 rgba(0,0,0,.05),-12px 0 48px 16px rgba(0,0,0,.03)}.survey-form .button{width:64px;height:64px;border-radius:100%;text-align:center;line-height:60px;font-size:32px;border:none;cursor:pointer}.survey-form .button:hover{filter:brightness(1.2)}.survey-form .form-submit[disabled]{opacity:.6;filter:grayscale(100%);cursor:not-allowed}.survey-form .survey-box{padding:.5rem 1rem;display:flex;flex-direction:column}.survey-form .survey-question{padding-top:4px;padding-bottom:4px;text-align:center;font-size:16px;color:"black"}.survey-form .question-textarea-wrapper{display:flex;flex-direction:column;padding-bottom:4px}.survey-form .survey-textarea{color:#2d2d2d;font-size:14px;font-family:-apple-system,BlinkMacSystemFont,Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;background:#fff;color:#000;border:1px solid;padding-left:10px;padding-right:10px;padding-top:10px;border-radius:6px;margin:.5rem}.survey-form .buttons{display:flex;justify-content:center}.survey-form .footer-branding{color:#6a6b69;font-size:10.5px;padding-top:.5rem;text-align:center}.survey-form .form-submit{box-sizing:border-box;margin:0;font-family:inherit;overflow:visible;text-transform:none;line-height:1.5715;position:relative;display:inline-block;font-weight:400;white-space:nowrap;text-align:center;border:1px solid transparent;cursor:pointer;transition:all .3s cubic-bezier(.645,.045,.355,1);-webkit-user-select:none;-moz-user-select:none;user-select:none;touch-action:manipulation;height:32px;padding:4px 15px;font-size:14px;border-radius:4px;outline:0;background:#2c2c2c;color:#e5e7e0;text-shadow:0 -1px 0 rgba(0,0,0,.12);box-shadow:0 2px 0 rgba(0,0,0,.045)}.survey-form .form-submit:hover{filter:brightness(1.2)}.survey-form .form-cancel{background:#fff;float:right;border:none;cursor:pointer}.survey-form .bottom-section{padding-bottom:.5rem}.survey-form .description{font-size:14px;margin-top:.75rem;margin-bottom:.75rem;text-align:center}',""]),module.exports=exports}}]);