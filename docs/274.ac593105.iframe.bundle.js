var Me=Object.defineProperty,Le=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var Z=(u,m,e)=>m in u?Me(u,m,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[m]=e,k=(u,m)=>{for(var e in m||(m={}))Re.call(m,e)&&Z(u,e,m[e]);if(Y)for(var e of Y(m))Ce.call(m,e)&&Z(u,e,m[e]);return u},q=(u,m)=>Le(u,Te(m));var J=(u,m,e)=>new Promise((j,v)=>{var a=f=>{try{s(e.next(f))}catch(c){v(c)}},i=f=>{try{s(e.throw(f))}catch(c){v(c)}},s=f=>f.done?j(f.value):Promise.resolve(f.value).then(a,i);s((e=e.apply(u,m)).next())});(window.webpackJsonp=window.webpackJsonp||[]).push([[274],{"./frontend/src/scenes/instance/DeadLetterQueue/DeadLetterQueue.tsx":function(u,m,e){"use strict";e.r(m),e.d(m,"scene",function(){return ye}),e.d(m,"DeadLetterQueue",function(){return G});var j=e("./frontend/src/lib/components/PageHeader.tsx"),v=e("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),a=e("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),i=e("./frontend/src/lib/api.ts"),s=e("./frontend/src/scenes/userLogic.ts"),f=e("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js");let c;(function(n){n.Metrics="metrics",n.Management="management",n.Settings="settings"})(c||(c={}));const g=Object(a.kea)([Object(a.path)(["scenes","instance","DeadLetterQueue","deadLetterQueueLogic"]),Object(a.actions)({setActiveTab:n=>({tabKey:n}),loadMoreRows:n=>({key:n}),addRowsToMetric:(n,t)=>({key:n,rows:t})}),Object(a.reducers)({activeTab:[c.Metrics,{setActiveTab:(n,t)=>{let{tabKey:d}=t;return d}}],rowsPerMetric:[{},{addRowsToMetric:(n,t)=>{let{key:d,rows:o}=t;return q(k({},n),{[d]:[...n[d]||[],...o]})},loadDeadLetterQueueMetricsSuccess:(n,t)=>{let{deadLetterQueueMetrics:d}=t;const o={};for(const l of d)l.subrows&&(o[l.key]=l.subrows.rows);return o}}]}),Object(f.loaders)({deadLetterQueueMetrics:[[],{loadDeadLetterQueueMetrics:()=>J(this,null,function*(){var n;return(n=s.a.values.user)!==null&&n!==void 0&&n.is_staff?(yield i.b.get("api/dead_letter_queue")).results:[]})}]}),Object(a.listeners)(n=>{let{values:t,actions:d}=n;return{loadMoreRows:o=>J(this,null,function*(){var l;let{key:h}=o;const b=((l=t.rowsPerMetric[h])===null||l===void 0?void 0:l.length)+1;if(b){const p=yield i.b.get(`api/dead_letter_queue/${h}?offset=${b}`);d.addRowsToMetric(h,p.subrows.rows)}})}}),Object(a.selectors)({singleValueMetrics:[n=>[n.deadLetterQueueMetrics],n=>n.filter(t=>!t.subrows)],tableMetrics:[n=>[n.deadLetterQueueMetrics],n=>n.filter(t=>!!t.subrows)]}),Object(a.afterMount)(n=>{let{actions:t}=n;t.loadDeadLetterQueueMetrics()})]);var y=e("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/row/index.js"),S=e("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/col/index.js"),z=e("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),C=e("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/extends.js"),O=e("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),D=e("./node_modules/.pnpm/classnames@2.3.1/node_modules/classnames/index.js"),P=e.n(D),Q=e("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/config-provider/context.js"),A=e("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/skeleton/index.js"),F=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/padEnd.js"),w=e.n(F),$=function(t){var d=t.value,o=t.formatter,l=t.precision,h=t.decimalSeparator,b=t.groupSeparator,p=b===void 0?"":b,x=t.prefixCls,M;if(typeof o=="function")M=o(d);else{var T=String(d),L=T.match(/^(-?)(\d*)(\.(\d+))?$/);if(!L||T==="-")M=T;else{var E=L[1],N=L[2]||"0",R=L[4]||"";N=N.replace(/\B(?=(\d{3})+(?!\d))/g,p),typeof l=="number"&&(R=w()(R,l,"0").slice(0,l)),R&&(R="".concat(h).concat(R)),M=[O.createElement("span",{key:"int",className:"".concat(x,"-content-value-int")},E,N),R&&O.createElement("span",{key:"decimal",className:"".concat(x,"-content-value-decimal")},R)]}}return O.createElement("span",{className:"".concat(x,"-content-value")},M)},U=$,I=function(t){var d=t.prefixCls,o=t.className,l=t.style,h=t.valueStyle,b=t.value,p=b===void 0?0:b,x=t.title,M=t.valueRender,T=t.prefix,L=t.suffix,E=t.loading,N=t.direction,R=t.onMouseEnter,W=t.onMouseLeave,X=O.createElement(U,Object(C.a)({},t,{value:p})),Oe=P()(d,Object(z.a)({},"".concat(d,"-rtl"),N==="rtl"),o);return O.createElement("div",{className:Oe,style:l,onMouseEnter:R,onMouseLeave:W},x&&O.createElement("div",{className:"".concat(d,"-title")},x),O.createElement(A.a,{paragraph:!1,loading:E},O.createElement("div",{style:h,className:"".concat(d,"-content")},T&&O.createElement("span",{className:"".concat(d,"-content-prefix")},T),M?M(X):X,L&&O.createElement("span",{className:"".concat(d,"-content-suffix")},L))))};I.defaultProps={decimalSeparator:".",groupSeparator:",",loading:!1};var _=Object(Q.c)({prefixCls:"statistic"})(I),V=_,ee=e("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),te=e("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/createClass.js"),ne=e("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/inherits.js"),oe=e("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/createSuper.js"),se=e("./node_modules/.pnpm/@babel+runtime@7.20.1/node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),ae=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/padStart.js"),de=e.n(ae),re=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function le(n,t){var d=n,o=/\[[^\]]*]/g,l=(t.match(o)||[]).map(function(x){return x.slice(1,-1)}),h=t.replace(o,"[]"),b=re.reduce(function(x,M){var T=Object(se.a)(M,2),L=T[0],E=T[1];if(x.indexOf(L)!==-1){var N=Math.floor(d/E);return d-=N*E,x.replace(new RegExp("".concat(L,"+"),"g"),function(R){var W=R.length;return de()(N.toString(),W,"0")})}return x},h),p=0;return b.replace(o,function(){var x=l[p];return p+=1,x})}function ue(n,t){var d=t.format,o=d===void 0?"":d,l=new Date(n).getTime(),h=Date.now(),b=Math.max(l-h,0);return le(b,o)}var ie=e("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/_util/reactNode.js"),ce=1e3/30;function H(n){return new Date(n).getTime()}var B=function(n){Object(ne.a)(d,n);var t=Object(oe.a)(d);function d(){var o;return Object(ee.a)(this,d),o=t.apply(this,arguments),o.syncTimer=function(){var l=o.props.value,h=H(l);h>=Date.now()?o.startTimer():o.stopTimer()},o.startTimer=function(){if(!o.countdownId){var l=o.props,h=l.onChange,b=l.value,p=H(b);o.countdownId=window.setInterval(function(){o.forceUpdate(),h&&p>Date.now()&&h(p-Date.now())},ce)}},o.stopTimer=function(){var l=o.props,h=l.onFinish,b=l.value;if(o.countdownId){clearInterval(o.countdownId),o.countdownId=void 0;var p=H(b);h&&p<Date.now()&&h()}},o.formatCountdown=function(l,h){var b=o.props.format;return ue(l,Object(C.a)(Object(C.a)({},h),{format:b}))},o.valueRender=function(l){return Object(ie.a)(l,{title:void 0})},o}return Object(te.a)(d,[{key:"componentDidMount",value:function(){this.syncTimer()}},{key:"componentDidUpdate",value:function(){this.syncTimer()}},{key:"componentWillUnmount",value:function(){this.stopTimer()}},{key:"render",value:function(){return O.createElement(V,Object(C.a)({valueRender:this.valueRender},this.props,{formatter:this.formatCountdown}))}}]),d}(O.Component);B.defaultProps={format:"HH:mm:ss"};var me=B;V.Countdown=me;var fe=V,K=e("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/divider/index.js"),pe=e("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/button/index.js"),ve=e("./frontend/src/lib/components/LemonTable/index.ts"),je=e("./frontend/src/lib/components/LemonButton/index.ts"),he=e("./frontend/src/lib/components/Spinner/Spinner.tsx"),be=e("./frontend/src/lib/components/icons.tsx"),r=e("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const xe=10;function ge(){const{user:n}=Object(a.useValues)(s.a),{singleValueMetrics:t,tableMetrics:d,deadLetterQueueMetricsLoading:o,rowsPerMetric:l}=Object(a.useValues)(g),{loadDeadLetterQueueMetrics:h,loadMoreRows:b}=Object(a.useActions)(g);return n!=null&&n.is_staff?Object(r.jsxs)("div",{children:[Object(r.jsx)("br",{}),Object(r.jsx)("div",{className:"mb-4 float-right",children:Object(r.jsx)(je.a,{icon:o?Object(r.jsx)(he.a,{}):Object(r.jsx)(be.IconRefresh,{}),onClick:h,type:"secondary",size:"small",children:"Refresh"})}),Object(r.jsx)(y.a,{gutter:32,children:t.map(p=>Object(r.jsx)(S.a,{children:Object(r.jsx)(fe,{title:p.metric,value:(p.value||"0").toLocaleString("en-US"),loading:o})},p.key))}),Object(r.jsx)(K.a,{}),d.map(p=>{var x,M;return Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:p.metric}),Object(r.jsx)(ve.a,{columns:[{title:(x=p.subrows)===null||x===void 0?void 0:x.columns[0],dataIndex:"key"},{title:(M=p.subrows)===null||M===void 0?void 0:M.columns[1],dataIndex:"value"}],dataSource:l[p.key].map(T=>{let[L,E]=T;return{key:L,value:E}})||[],loading:o,defaultSorting:{columnKey:"value",order:-1},embedded:!0}),Object(r.jsx)("div",{style:{margin:"1rem",textAlign:"center"},children:Object(r.jsx)(pe.a,{disabled:l[p.key].length%xe!==0,onClick:()=>b(p.key),children:"Load more values"})}),Object(r.jsx)(K.a,{})]},p.key)})]}):Object(r.jsx)(r.Fragment,{})}const ye={component:G,logic:g},{TabPane:Se}=v.a;function G(){const{user:n}=Object(a.useValues)(s.a),{activeTab:t}=Object(a.useValues)(g),{setActiveTab:d}=Object(a.useActions)(g);return n!=null&&n.is_staff?Object(r.jsxs)("div",{children:[Object(r.jsx)(j.a,{title:"Dead Letter Queue",caption:Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("p",{children:"Manage your instance's dead letter queue."})})}),Object(r.jsx)(v.a,{activeKey:t,onChange:o=>d(o),children:Object(r.jsx)(Se,{tab:"Metrics"},c.Metrics)}),t===c.Metrics?Object(r.jsx)(ge,{}):null]}):Object(r.jsx)(j.a,{title:"Dead Letter Queue",caption:Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("p",{children:"Only users with staff access can manage the dead letter queue. Please contact your instance admin."}),Object(r.jsxs)("p",{children:["If you're an admin and don't have access, set ",Object(r.jsx)("code",{children:"is_staff=true"})," for your user on the PostgreSQL ",Object(r.jsx)("code",{children:"posthog_user"})," table."]})]})})}},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_asciiSize.js":function(u,m,e){var j=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseProperty.js"),v=j("length");u.exports=v},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseRepeat.js":function(u,m){var e=9007199254740991,j=Math.floor;function v(a,i){var s="";if(!a||i<1||i>e)return s;do i%2&&(s+=a),i=j(i/2),i&&(a+=a);while(i);return s}u.exports=v},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_createPadding.js":function(u,m,e){var j=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseRepeat.js"),v=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseToString.js"),a=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_castSlice.js"),i=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_hasUnicode.js"),s=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringSize.js"),f=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringToArray.js"),c=Math.ceil;function g(y,S){S=S===void 0?" ":v(S);var z=S.length;if(z<2)return z?j(S,y):S;var C=j(S,c(y/s(S)));return i(S)?a(f(C),0,y).join(""):C.slice(0,y)}u.exports=g},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringSize.js":function(u,m,e){var j=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_asciiSize.js"),v=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_hasUnicode.js"),a=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_unicodeSize.js");function i(s){return v(s)?a(s):j(s)}u.exports=i},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_unicodeSize.js":function(u,m){var e="\\ud800-\\udfff",j="\\u0300-\\u036f",v="\\ufe20-\\ufe2f",a="\\u20d0-\\u20ff",i=j+v+a,s="\\ufe0e\\ufe0f",f="["+e+"]",c="["+i+"]",g="\\ud83c[\\udffb-\\udfff]",y="(?:"+c+"|"+g+")",S="[^"+e+"]",z="(?:\\ud83c[\\udde6-\\uddff]){2}",C="[\\ud800-\\udbff][\\udc00-\\udfff]",O="\\u200d",D=y+"?",P="["+s+"]?",Q="(?:"+O+"(?:"+[S,z,C].join("|")+")"+P+D+")*",A=P+D+Q,F="(?:"+[S+c+"?",c,z,C,f].join("|")+")",w=RegExp(g+"(?="+g+")|"+F+A,"g");function $(U){for(var I=w.lastIndex=0;w.test(U);)++I;return I}u.exports=$},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/padEnd.js":function(u,m,e){var j=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_createPadding.js"),v=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringSize.js"),a=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toInteger.js"),i=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toString.js");function s(f,c,g){f=i(f),c=a(c);var y=c?v(f):0;return c&&y<c?f+j(c-y,g):f}u.exports=s},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/padStart.js":function(u,m,e){var j=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_createPadding.js"),v=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stringSize.js"),a=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toInteger.js"),i=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toString.js");function s(f,c,g){f=i(f),c=a(c);var y=c?v(f):0;return c&&y<c?j(c-y,g)+f:f}u.exports=s},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toFinite.js":function(u,m,e){var j=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toNumber.js"),v=1/0,a=17976931348623157e292;function i(s){if(!s)return s===0?s:0;if(s=j(s),s===v||s===-v){var f=s<0?-1:1;return f*a}return s===s?s:0}u.exports=i},"./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toInteger.js":function(u,m,e){var j=e("./node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/toFinite.js");function v(a){var i=j(a),s=i%1;return i===i?s?i-s:i:0}u.exports=v}}]);
