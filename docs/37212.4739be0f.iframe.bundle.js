"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[37212],{"./frontend/src/scenes/data-warehouse/redirect/DataWarehouseRedirectScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DataWarehouseRedirectScene:()=>DataWarehouseRedirectScene,default:()=>__WEBPACK_DEFAULT_EXPORT__,scene:()=>scene});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:DataWarehouseRedirectScene,logic:_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_1__.So};function DataWarehouseRedirectScene(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"text-left flex flex-col",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Spinner,{})})}let __WEBPACK_DEFAULT_EXPORT__=DataWarehouseRedirectScene},"./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>dataWarehouseSettingsLogic,d:()=>humanFriendlyDataWarehouseSettingsTabName});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),posthog_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/posthog-js@1.144.1/node_modules/posthog-js/dist/module.js"),scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/data-management/database/databaseTableListLogic.ts"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/urls.ts"),_types__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/types.ts");let humanFriendlyDataWarehouseSettingsTabName=tab=>{switch(tab){case _types__WEBPACK_IMPORTED_MODULE_9__.EP.Managed:return"Managed";case _types__WEBPACK_IMPORTED_MODULE_9__.EP.SelfManaged:return"Self managed"}},dataWarehouseSettingsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-warehouse","settings","dataWarehouseSettingsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__.A,["dataWarehouseTables"]],actions:[scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__.A,["loadDatabase"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({deleteSource:source=>({source}),reloadSource:source=>({source}),reloadSchema:schema=>({schema}),resyncSchema:schema=>({schema}),sourceLoadingFinished:source=>({source}),schemaLoadingFinished:schema=>({schema}),abortAnyRunningQuery:!0,setCurrentTab:function(){let tab=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_types__WEBPACK_IMPORTED_MODULE_9__.EP.Managed;return{tab}},deleteSelfManagedTable:tableId=>({tableId})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{cache,actions,values}=_ref;return{dataWarehouseSources:[null,{loadSources:async(_,breakpoint)=>{await breakpoint(300),actions.abortAnyRunningQuery(),cache.abortController=new AbortController;let methodOptions={signal:cache.abortController.signal},res=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSources.list(methodOptions);return breakpoint(),cache.abortController=null,res},updateSource:async source=>{let updatedSource=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSources.update(source.id,source);return{...values.dataWarehouseSources,results:values.dataWarehouseSources?.results.map(s=>s.id===updatedSource.id?source:s)||[]}}}],schemas:[null,{updateSchema:async schema=>{var _values$dataWarehouse;let clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse?_values$dataWarehouse:[])),sourceIndex=clonedSources.findIndex(n=>n.schemas.find(m=>m.id===schema.id)),schemaIndex=clonedSources[sourceIndex].schemas.findIndex(n=>n.id===schema.id);return clonedSources[sourceIndex].schemas[schemaIndex]=schema,actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources}),await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSchemas.update(schema.id,schema),actions.loadSources(null),null}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(_ref2=>{let{cache}=_ref2;return{dataWarehouseSourcesLoading:[!1,{loadSources:()=>!0,loadSourcesFailure:()=>null!==cache.abortController,loadSourcesSuccess:()=>null!==cache.abortController}],sourceReloadingById:[{},{reloadSource:(state,_ref3)=>{let{source}=_ref3;return{...state,[source.id]:!0}},deleteSource:(state,_ref4)=>{let{source}=_ref4;return{...state,[source.id]:!0}},sourceLoadingFinished:(state,_ref5)=>{let{source}=_ref5;return{...state,[source.id]:!1}}}],schemaReloadingById:[{},{reloadSchema:(state,_ref6)=>{let{schema}=_ref6;return{...state,[schema.id]:!0}},resyncSchema:(state,_ref7)=>{let{schema}=_ref7;return{...state,[schema.id]:!0}},schemaLoadingFinished:(state,_ref8)=>{let{schema}=_ref8;return{...state,[schema.id]:!1}}}],currentTab:[_types__WEBPACK_IMPORTED_MODULE_9__.EP.Managed,{setCurrentTab:(_,_ref9)=>{let{tab}=_ref9;return tab}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_7__.x.DataWarehouse,name:"Data Warehouse",path:scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.dataWarehouse()},{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_7__.x.DataWarehouseSettings,name:"Data Warehouse Settings",path:scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.dataWarehouseSettings()}]],selfManagedTables:[s=>[s.dataWarehouseTables],dataWarehouseTables=>dataWarehouseTables.filter(table=>!table.source)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref10=>{let{actions,values,cache}=_ref10;return{deleteSelfManagedTable:async _ref11=>{let{tableId}=_ref11;await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dataWarehouseTables.delete(tableId),actions.loadDatabase()},loadSourcesSuccess:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout(()=>{actions.loadSources(null)},1e4)},loadSourcesFailure:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout(()=>{actions.loadSources(null)},1e4)},deleteSource:async _ref12=>{let{source}=_ref12;await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSources.delete(source.id),actions.loadSources(null),actions.sourceLoadingFinished(source),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("source deleted",{sourceType:source.source_type})},reloadSource:async _ref13=>{var _values$dataWarehouse2;let{source}=_ref13,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse2=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse2?_values$dataWarehouse2:[])),sourceIndex=clonedSources.findIndex(n=>n.id===source.id);clonedSources[sourceIndex].status="Running",clonedSources[sourceIndex].schemas=clonedSources[sourceIndex].schemas.map(n=>n.should_sync?{...n,status:"Running"}:n),actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources});try{await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSources.reload(source.id),actions.loadSources(null),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("source reloaded",{sourceType:source.source_type})}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Cant refresh source at this time")}actions.sourceLoadingFinished(source)},reloadSchema:async _ref14=>{var _values$dataWarehouse3;let{schema}=_ref14,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse3=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse3?_values$dataWarehouse3:[])),sourceIndex=clonedSources.findIndex(n=>n.schemas.find(m=>m.id===schema.id)),schemaIndex=clonedSources[sourceIndex].schemas.findIndex(n=>n.id===schema.id);clonedSources[sourceIndex].status="Running",clonedSources[sourceIndex].schemas[schemaIndex].status="Running",actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources});try{await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSchemas.reload(schema.id),actions.schemaLoadingFinished(schema),actions.loadSources(null),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("schema reloaded",{sourceType:clonedSources[sourceIndex].source_type})}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Cant reload schema at this time")}},resyncSchema:async _ref15=>{var _values$dataWarehouse4;let{schema}=_ref15,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse4=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse4?_values$dataWarehouse4:[])),sourceIndex=clonedSources.findIndex(n=>n.schemas.find(m=>m.id===schema.id)),schemaIndex=clonedSources[sourceIndex].schemas.findIndex(n=>n.id===schema.id);clonedSources[sourceIndex].status="Running",clonedSources[sourceIndex].schemas[schemaIndex].status="Running",actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources});try{await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSchemas.resync(schema.id),actions.schemaLoadingFinished(schema),actions.loadSources(null),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("schema resynced",{sourceType:clonedSources[sourceIndex].source_type})}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Cant refresh schema at this time")}},abortAnyRunningQuery:()=>{cache.abortController&&(cache.abortController.abort(),cache.abortController=null)},updateSchema:schema=>{posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("schema updated",{shouldSync:schema.should_sync,syncType:schema.sync_type})}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref16=>{let{actions}=_ref16;actions.loadSources(null)}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.actionToUrl)(_ref17=>{let{values}=_ref17;return{setCurrentTab:()=>[scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.dataWarehouseSettings(values.currentTab)]}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.urlToAction)(_ref18=>{let{actions,values}=_ref18;return{"/data-warehouse/settings/:tab":_ref19=>{let{tab}=_ref19;tab!==values.currentTab&&actions.setCurrentTab(tab)}}})])}}]);