"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[12458],{"../../frontend/src/scenes/data-warehouse/DataWarehouseScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DataWarehouseScene:()=>DataWarehouseScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes=__webpack_require__("../../frontend/src/scenes/scenes.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.296.1/node_modules/posthog-js/dist/module.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),billingLogic=__webpack_require__("../../frontend/src/scenes/billing/billingLogic.tsx"),databaseTableListLogic=__webpack_require__("../../frontend/src/scenes/data-management/database/databaseTableListLogic.ts"),externalDataSourcesLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/externalDataSourcesLogic.ts"),dataWarehouseViewsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/saved_queries/dataWarehouseViewsLogic.tsx");let DataWarehouseTab=function(DataWarehouseTab){return DataWarehouseTab.OVERVIEW="overview",DataWarehouseTab.SOURCES="sources",DataWarehouseTab.VIEWS="views",DataWarehouseTab}({}),dataWarehouseSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","dataWarehouseSceneLogic"]),(0,index_esm.connect)(()=>({values:[databaseTableListLogic.A,["dataWarehouseTables","views","databaseLoading"],externalDataSourcesLogic.W,["dataWarehouseSources","dataWarehouseSourcesLoading"],billingLogic.billingLogic,["billingPeriodUTC","billing"],dataWarehouseViewsLogic.$,["dataWarehouseSavedQueryMapById"]],actions:[databaseTableListLogic.A,["loadDatabase"],externalDataSourcesLogic.W,["loadSources","loadSourcesSuccess"],billingLogic.billingLogic,["loadBilling"]]})),(0,index_esm.actions)({loadMoreRunningActivity:!0,loadMoreCompletedActivity:!0,setActivityRunningCurrentPage:page=>({page}),setActivityCompletedCurrentPage:page=>({page}),checkAutoLoadMoreRunning:!0,checkAutoLoadMoreCompleted:!0,setActiveTab:tab=>({tab})}),(0,lib.loaders)(()=>({totalRowsStats:[{},{loadTotalRowsStats:async()=>await api.ZP.dataWarehouse.totalRowsStats()}],runningActivityResponse:[null,{loadRunningActivityResponse:async()=>await api.ZP.dataWarehouse.runningActivity({limit:20,offset:0,cutoff_days:30})}],completedActivityResponse:[null,{loadCompletedActivityResponse:async()=>await api.ZP.dataWarehouse.completedActivity({limit:20,offset:0,cutoff_days:30})}],jobStats:[null,{loadJobStats:async _ref=>{let{days}=_ref;return await api.ZP.dataWarehouse.jobStats({days})}}]})),(0,index_esm.reducers)(()=>({activeTab:[DataWarehouseTab.OVERVIEW,{setActiveTab:(_,_ref2)=>{let{tab}=_ref2;return tab}}],activityRunningCurrentPage:[1,{setActivityRunningCurrentPage:(_,_ref3)=>{let{page}=_ref3;return page},loadRunningActivityResponse:()=>1}],activityCompletedCurrentPage:[1,{setActivityCompletedCurrentPage:(_,_ref4)=>{let{page}=_ref4;return page},loadCompletedActivityResponse:()=>1}],runningActivityMoreLoading:[!1,{loadMoreRunningActivity:()=>!0,loadRunningActivityResponseSuccess:()=>!1}],completedActivityMoreLoading:[!1,{loadMoreCompletedActivity:()=>!0,loadCompletedActivityResponseSuccess:()=>!1}]})),(0,index_esm.selectors)({recentActivityRunning:[s=>[s.runningActivityResponse],response=>response?.results||[]],recentActivityCompleted:[s=>[s.completedActivityResponse],response=>response?.results||[]],recentActivityRunningHasMore:[s=>[s.runningActivityResponse],response=>!!response?.next],recentActivityCompletedHasMore:[s=>[s.completedActivityResponse],response=>!!response?.next],selfManagedTables:[s=>[s.dataWarehouseTables],dataWarehouseTables=>dataWarehouseTables.filter(table=>!table.source)],activityRunningPaginationState:[s=>[s.recentActivityRunning,s.activityRunningCurrentPage],(recentActivityRunning,activityRunningCurrentPage)=>{let totalData=recentActivityRunning.length,pageCount=Math.max(Math.ceil(totalData/8),1),startIndex=(activityRunningCurrentPage-1)*8,endIndex=Math.min(startIndex+8,totalData),dataSourcePage=recentActivityRunning.slice(startIndex,endIndex);return{currentPage:activityRunningCurrentPage,pageCount,dataSourcePage,currentStartIndex:startIndex,currentEndIndex:endIndex,entryCount:totalData,isOnLastPage:activityRunningCurrentPage===pageCount,hasDataOnCurrentPage:dataSourcePage.length>0}}],activityCompletedPaginationState:[s=>[s.recentActivityCompleted,s.activityCompletedCurrentPage],(recentActivityCompleted,activityCompletedCurrentPage)=>{let totalData=recentActivityCompleted.length,pageCount=Math.max(Math.ceil(totalData/8),1),startIndex=(activityCompletedCurrentPage-1)*8,endIndex=Math.min(startIndex+8,totalData),dataSourcePage=recentActivityCompleted.slice(startIndex,endIndex);return{currentPage:activityCompletedCurrentPage,pageCount,dataSourcePage,currentStartIndex:startIndex,currentEndIndex:endIndex,entryCount:totalData,isOnLastPage:activityCompletedCurrentPage===pageCount,hasDataOnCurrentPage:dataSourcePage.length>0}}],tablesLoading:[s=>[s.databaseLoading,s.dataWarehouseSourcesLoading],(databaseLoading,dataWarehouseSourcesLoading)=>databaseLoading||dataWarehouseSourcesLoading],materializedViews:[s=>[s.views,s.dataWarehouseSavedQueryMapById],(views,dataWarehouseSavedQueryMapById)=>views.filter(view=>dataWarehouseSavedQueryMapById[view.id]?.is_materialized)],dataWarehouseProduct:[s=>[s.billing],billing=>billing?.products?.find(product=>"data_warehouse"===product.type)||null]}),(0,index_esm.listeners)(_ref5=>{let{values,actions,cache}=_ref5;return{setActivityRunningCurrentPage:()=>{actions.checkAutoLoadMoreRunning()},setActivityCompletedCurrentPage:()=>{actions.checkAutoLoadMoreCompleted()},checkAutoLoadMoreRunning:()=>{let{isOnLastPage,hasDataOnCurrentPage}=values.activityRunningPaginationState,{recentActivityRunningHasMore,runningActivityResponseLoading}=values;isOnLastPage&&hasDataOnCurrentPage&&recentActivityRunningHasMore&&!runningActivityResponseLoading&&actions.loadMoreRunningActivity()},checkAutoLoadMoreCompleted:()=>{let{isOnLastPage,hasDataOnCurrentPage}=values.activityCompletedPaginationState,{recentActivityCompletedHasMore,completedActivityResponseLoading}=values;isOnLastPage&&hasDataOnCurrentPage&&recentActivityCompletedHasMore&&!completedActivityResponseLoading&&actions.loadMoreCompletedActivity()},loadMoreRunningActivity:async()=>{try{let currentData=values.recentActivityRunning,response=await api.ZP.dataWarehouse.runningActivity({limit:20,offset:currentData.length,cutoff_days:30}),newData=[...currentData,...response.results||[]],newResponse={...response,results:newData};actions.loadRunningActivityResponseSuccess(newResponse)}catch(error){dist_module.ZP.captureException(error)}},loadMoreCompletedActivity:async()=>{try{let currentData=values.recentActivityCompleted,response=await api.ZP.dataWarehouse.completedActivity({limit:20,offset:currentData.length,cutoff_days:30}),newData=[...currentData,...response.results||[]],newResponse={...response,results:newData};actions.loadCompletedActivityResponseSuccess(newResponse)}catch(error){dist_module.ZP.captureException(error)}},loadSourcesSuccess:()=>{cache.disposables.dispose("refreshTimeout"),kea_router_lib.router.values.location.pathname.includes("data-warehouse")&&cache.disposables.add(()=>{let timerId=setTimeout(()=>{actions.loadSources(null)},1e4);return()=>clearTimeout(timerId)},"refreshTimeout")}}}),(0,index_esm.afterMount)(_ref6=>{let{actions}=_ref6;actions.loadSources(null),actions.loadRunningActivityResponse(),actions.loadCompletedActivityResponse(),actions.loadTotalRowsStats(),actions.loadJobStats({days:7}),actions.loadBilling()})]);var TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),PaginationControl=__webpack_require__("../../frontend/src/lib/lemon-ui/PaginationControl/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function formatPrice(price){let numPrice="string"==typeof price?parseFloat(price):price;return 0===numPrice?"Free":`$${numPrice.toFixed(6).replace(/\.?0+$/,"")}`}function getTierName(tier,index,tiers){if(0===index&&tier.up_to)return`First ${(0,utils.JP)(tier.up_to)} rows`;let previousTier=index>0?tiers[index-1]:null,start=previousTier?.up_to?(0,utils.JP)(previousTier.up_to):"0";return tier.up_to?`${start} - ${(0,utils.JP)(tier.up_to)} rows`:`${start}+ rows`}function TierGauge(_ref){let{tier,index,tiers,unit}=_ref,tierName=getTierName(tier,index,tiers),unitPrice=parseFloat(tier.unit_amount_usd||"0"),currentCost=parseFloat(tier.current_amount_usd||"0"),previousTier=index>0?tiers[index-1]:null,tierStart=previousTier?.up_to||0,tierCapacity=tier.up_to?tier.up_to-tierStart:Math.max(tier.current_usage,tier.projected_usage||0),currentPercentage=0===tierCapacity?0:Math.min(100,tier.current_usage/tierCapacity*100),projectedPercentage=null!==tier.projected_usage&&tierCapacity>0?Math.min(100,tier.projected_usage/tierCapacity*100):currentPercentage,hasProjected=null!==tier.projected_usage&&tier.projected_usage!==tier.current_usage,projectedCost=parseFloat(tier.projected_amount_usd||"0");return(0,jsx_runtime.jsxs)("div",{className:"border rounded-lg p-4 bg-bg-light hover:bg-bg-3000 transition-colors",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm mb-1",children:tierName}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:0===unitPrice?"Free tier":(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[formatPrice(unitPrice)," per ",unit]})})]}),(0,jsx_runtime.jsxs)("div",{className:"text-right",children:[(0,jsx_runtime.jsxs)("div",{className:"text-xl font-semibold",children:["$",currentCost.toFixed(2)]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-muted",children:[(0,utils.JP)(tier.current_usage)," rows"]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"relative h-2 bg-border-light rounded overflow-hidden mb-3",children:[(0,jsx_runtime.jsx)(Tooltip.u,{title:`Current: ${(0,utils.JP)(tier.current_usage)} rows ($${currentCost.toFixed(2)})`,placement:"top",children:(0,jsx_runtime.jsx)("div",{className:"absolute top-0 left-0 bottom-0 rounded z-[2] transition-all duration-700",style:{width:`${currentPercentage}%`,background:"var(--brand-blue)",transitionTimingFunction:"cubic-bezier(0.15, 0.15, 0.2, 1)"}})}),hasProjected&&(0,jsx_runtime.jsx)(Tooltip.u,{title:`Projected: ${(0,utils.JP)(tier.projected_usage||0)} rows ($${projectedCost.toFixed(2)})`,placement:"top",children:(0,jsx_runtime.jsx)("div",{className:"absolute top-0 left-0 bottom-0 rounded opacity-50 z-[1] transition-all duration-700",style:{width:`${projectedPercentage}%`,background:"repeating-linear-gradient(-45deg, var(--data-color-1), var(--data-color-1) 0.5rem, var(--data-color-1-hover) 0.5rem, var(--data-color-1-hover) 1rem)",transitionTimingFunction:"cubic-bezier(0.15, 0.15, 0.2, 1)"}})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1 mt-2 text-sm",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{background:"var(--brand-blue)"}}),(0,jsx_runtime.jsxs)("span",{className:"font-medium",children:[(0,utils.JP)(tier.current_usage)," rows"]})]}),hasProjected&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"w-2.5 h-2.5 rounded-full flex-shrink-0",style:{background:"repeating-linear-gradient(-45deg, var(--data-color-1), var(--data-color-1) 0.125rem, var(--data-color-1-hover) 0.125rem, var(--data-color-1-hover) 0.25rem)"}}),(0,jsx_runtime.jsxs)("span",{className:"text-muted",children:["Projected: ",(0,utils.JP)(tier.projected_usage||0)," rows · $",projectedCost.toFixed(2)]})]})]})]})]})}function DataWarehouseTierBreakdown(_ref2){let{product}=_ref2;return product.tiers&&0!==product.tiers.length?(0,jsx_runtime.jsx)("div",{className:"space-y-3",children:product.tiers.map((tier,index)=>(0,jsx_runtime.jsx)(TierGauge,{tier:tier,index:index,tiers:product.tiers,unit:product.unit||"row"},index))}):(0,jsx_runtime.jsx)("div",{className:"text-muted",children:"No tier data available"})}function FreeRowsDisplay(_ref){let{addon}=_ref,currentUsage=addon.current_usage;return(0,jsx_runtime.jsx)("div",{className:"border rounded-lg p-4 mb-3 bg-bg-light",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center justify-between",children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm mb-1",children:"Free historical rows"})}),(0,jsx_runtime.jsx)("div",{className:"text-xl font-semibold ",children:`${(0,utils.JP)(currentUsage)}`})]})})}function DataWarehousePricingCard(_ref2){let{product}=_ref2;if(!product||!product.tiers||0===product.tiers.length)return(0,jsx_runtime.jsx)(src.Mi,{className:"hover:transform-none",children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Cost breakdown"}),(0,jsx_runtime.jsxs)("div",{className:"py-8 text-center text-muted",children:[(0,jsx_runtime.jsx)("div",{className:"mb-2",children:"No billing data available"}),(0,jsx_runtime.jsx)("div",{className:"text-xs",children:"Cost breakdown will appear when you have usage data"})]})]})});let currentTotal=parseFloat(product.current_amount_usd||"0"),projectedTotal=parseFloat(product.projected_amount_usd||"0"),hasProjected=projectedTotal!==currentTotal,historicalAddon=product.addons?.find(addon=>"data_warehouse_historical"===addon.type);return(0,jsx_runtime.jsxs)(src.Mi,{className:"hover:transform-none",children:[(0,jsx_runtime.jsxs)("div",{className:"pb-4",children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Cost breakdown"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between py-3 px-4 bg-bg-3000 rounded border",children:[(0,jsx_runtime.jsxs)("div",{className:"text-center flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted mb-1",children:"Current period"}),(0,jsx_runtime.jsxs)("div",{className:"text-2xl font-bold",children:["$",currentTotal.toFixed(2)]})]}),hasProjected&&(0,jsx_runtime.jsxs)("div",{className:"text-center flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted mb-1",children:"Projected total"}),(0,jsx_runtime.jsxs)("div",{className:"text-2xl font-bold text-muted-3000",children:["$",projectedTotal.toFixed(2)]})]})]})]}),historicalAddon&&(0,jsx_runtime.jsx)(FreeRowsDisplay,{addon:historicalAddon}),(0,jsx_runtime.jsx)(DataWarehouseTierBreakdown,{product:product})]})}var react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),LineGraph=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Charts/LineGraph.tsx"),types=__webpack_require__("../../frontend/src/types.ts");function JobStatsChart(_ref){let{jobStats}=_ref,{xData,yData}=(0,react.useMemo)(()=>{if(!jobStats?.breakdown)return{xData:null,yData:[]};let timestamps=Object.keys(jobStats.breakdown).sort(),successData=timestamps.map(ts=>jobStats.breakdown[ts].successful),failedData=timestamps.map(ts=>jobStats.breakdown[ts].failed),isHourly=1===jobStats.days,labels=timestamps.map(ts=>{let d=new Date(ts);return isHourly?d.toLocaleTimeString("en-US",{hour:"numeric",hour12:!0}):d.toLocaleDateString("en-US",{month:"short",day:"numeric"})});return{xData:{column:{name:"timestamp",type:{name:"STRING",isNumerical:!1},label:"Time",dataIndex:0},data:labels},yData:[{column:{name:"successful",type:{name:"INTEGER",isNumerical:!0},label:"Successful",dataIndex:0},data:successData,settings:{display:{color:getComputedStyle(document.body).getPropertyValue("--success").trim()||"#388600",displayType:"bar"}}},{column:{name:"failed",type:{name:"INTEGER",isNumerical:!0},label:"Failed",dataIndex:1},data:failedData,settings:{display:{color:getComputedStyle(document.body).getPropertyValue("--danger").trim()||"#db3707",displayType:"bar"}}}]}},[jobStats]);return jobStats?.breakdown?(0,jsx_runtime.jsx)(LineGraph.x,{className:"h-full min-h-80",xData:xData,yData:yData,visualizationType:types.Qb.ActionsStackedBar,chartSettings:{stackBars100:!1}}):(0,jsx_runtime.jsx)("div",{className:"relative h-full min-h-48 flex items-center justify-center",children:"No data available"})}var icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),data_warehouse_utils=__webpack_require__("../../frontend/src/scenes/data-warehouse/utils.ts");function StatusIcon(_ref){let{status}=_ref;return status?status===types.mZ.Failed?(0,jsx_runtime.jsx)(icons.uR,{className:"text-danger"}):status===types.mZ.BillingLimits||status===types.mZ.BillingLimitTooLow?(0,jsx_runtime.jsx)(icons.qV,{className:"text-warning"}):status===types.mZ.Running?(0,jsx_runtime.jsx)(icons.JK,{className:"animate-spin"}):status===types.mZ.Completed?(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"text-success"}):(0,jsx_runtime.jsx)(icons.i4,{className:"text-muted"}):(0,jsx_runtime.jsx)(icons.i4,{className:"text-muted"})}function StatusTag(_ref2){let{status}=_ref2;if(!status)return(0,jsx_runtime.jsx)(src.oe,{size:"small",type:"muted",className:"px-1 rounded-lg",children:"—"});let type=data_warehouse_utils.IM[status]||"muted";return(0,jsx_runtime.jsx)(src.oe,{size:"medium",type:type,className:"px-1 rounded-lg",children:status})}function OverviewTab(){var _totalRowsStats$total,_dataWarehouseSources,_materializedViews$le,_jobStats$days;let{activityRunningPaginationState,activityCompletedPaginationState,totalRowsStats,totalRowsStatsLoading,tablesLoading,jobStats,jobStatsLoading,runningActivityResponse,completedActivityResponse,dataWarehouseSources,materializedViews,dataWarehouseProduct}=(0,index_esm.useValues)(dataWarehouseSceneLogic),{setActivityRunningCurrentPage,setActivityCompletedCurrentPage,loadJobStats}=(0,index_esm.useActions)(dataWarehouseSceneLogic),activityRunningPagination={currentPage:activityRunningPaginationState.currentPage,pageCount:activityRunningPaginationState.pageCount,dataSourcePage:activityRunningPaginationState.dataSourcePage,currentStartIndex:activityRunningPaginationState.currentStartIndex,currentEndIndex:activityRunningPaginationState.currentEndIndex,entryCount:activityRunningPaginationState.entryCount,setCurrentPage:setActivityRunningCurrentPage,pagination:{pageSize:8}},activityCompletedPagination={currentPage:activityCompletedPaginationState.currentPage,pageCount:activityCompletedPaginationState.pageCount,dataSourcePage:activityCompletedPaginationState.dataSourcePage,currentStartIndex:activityCompletedPaginationState.currentStartIndex,currentEndIndex:activityCompletedPaginationState.currentEndIndex,entryCount:activityCompletedPaginationState.entryCount,setCurrentPage:setActivityCompletedCurrentPage,pagination:{pageSize:8}},activityColumns=[{title:"Activity",key:"name",render:(_,activity)=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(StatusIcon,{status:activity.status}),(0,jsx_runtime.jsx)("span",{children:activity.name}),(0,jsx_runtime.jsx)(src.oe,{size:"medium",type:"muted",className:"px-1 rounded-lg ml-1",children:activity.type})]})},{title:"When",key:"created_at",tooltip:"Time when this job was created",render:(_,activity)=>(0,jsx_runtime.jsx)(TZLabel.w,{time:activity.created_at})},{title:"Rows",key:"rows",align:"right",tooltip:"Number of rows processed in this job",render:(_,activity)=>null!==activity.rows?activity.rows.toLocaleString():"0"},{title:"Status",key:"status",align:"right",render:(_,activity)=>(0,jsx_runtime.jsx)(StatusTag,{status:activity.status})}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,jsx_runtime.jsxs)(src.Mi,{className:"p-4 hover:transform-none",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-1",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"Rows processed"}),(0,jsx_runtime.jsx)(src.u,{title:"Total rows processed this month by all data sources and materialized views",placement:"bottom",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted mt-0.5"})})]}),(0,jsx_runtime.jsx)("div",{className:"text-2xl font-semibold mt-1 flex items-center gap-2",children:totalRowsStatsLoading&&!totalRowsStats?.total_rows?(0,jsx_runtime.jsx)(src.$j,{className:"text-muted"}):(null!==(_totalRowsStats$total=totalRowsStats?.total_rows)&&void 0!==_totalRowsStats$total?_totalRowsStats$total:0).toLocaleString()})]}),(0,jsx_runtime.jsxs)(src.Mi,{className:"p-4 hover:transform-none",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"Data sources"}),jobStats&&jobStats.external_data_jobs.running>0&&(0,jsx_runtime.jsxs)(src.oe,{type:"primary",size:"small",children:[jobStats.external_data_jobs.running," syncing"]})]}),(0,jsx_runtime.jsx)("div",{className:"text-2xl font-semibold mt-1 flex items-center gap-2",children:tablesLoading&&!dataWarehouseSources?(0,jsx_runtime.jsx)(src.$j,{className:"text-muted"}):null!==(_dataWarehouseSources=dataWarehouseSources?.results?.length)&&void 0!==_dataWarehouseSources?_dataWarehouseSources:0})]}),(0,jsx_runtime.jsxs)(src.Mi,{className:"p-4 hover:transform-none",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"Materialized views"}),jobStats&&jobStats.modeling_jobs.running>0&&(0,jsx_runtime.jsxs)(src.oe,{type:"primary",size:"small",children:[jobStats.modeling_jobs.running," syncing"]})]}),(0,jsx_runtime.jsx)("div",{className:"text-2xl font-semibold mt-1 flex items-center gap-2",children:tablesLoading&&!materializedViews?(0,jsx_runtime.jsx)(src.$j,{className:"text-muted"}):null!==(_materializedViews$le=materializedViews?.length)&&void 0!==_materializedViews$le?_materializedViews$le:0})]})]}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mt-4",children:[(0,jsx_runtime.jsx)("div",{className:"lg:col-span-1",children:(0,jsx_runtime.jsx)(DataWarehousePricingCard,{product:dataWarehouseProduct})}),(0,jsx_runtime.jsx)("div",{className:"lg:col-span-2",children:(0,jsx_runtime.jsxs)(src.Mi,{className:"p-4 hover:transform-none min-h-96 flex flex-col h-full",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-4 flex-shrink-0",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-start gap-1",children:(0,jsx_runtime.jsx)("div",{className:"text-lg font-medium",children:"Sync success rate"})}),jobStatsLoading&&(0,jsx_runtime.jsx)(src.$j,{className:"text-muted"})]}),(0,jsx_runtime.jsx)(src.P4,{size:"xsmall",value:null!==(_jobStats$days=jobStats?.days)&&void 0!==_jobStats$days?_jobStats$days:7,onChange:value=>loadJobStats({days:value}),options:[{value:1,label:"24h"},{value:7,label:"7d"},{value:30,label:"30d"}]})]}),jobStats&&(0,jsx_runtime.jsx)("div",{className:"flex-1 min-h-0",children:(0,jsx_runtime.jsx)(JobStatsChart,{jobStats:jobStats})})]})})]}),(0,jsx_runtime.jsx)("div",{className:"mt-6 mb-2",children:(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"Source and materialization jobs"})}),(0,jsx_runtime.jsxs)(src.Mi,{className:"hover:transform-none mt-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 pb-2",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium text-lg",children:"Currently running"}),tablesLoading&&null!==runningActivityResponse&&(0,jsx_runtime.jsx)(src.$j,{className:"text-muted"})]}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:activityRunningPagination.dataSourcePage,columns:activityColumns,rowKey:r=>`${r.type}-${r.name}-${r.created_at}`,loading:tablesLoading&&null===runningActivityResponse,loadingSkeletonRows:3,emptyState:"No currently running activities"}),activityRunningPagination.entryCount>0&&(0,jsx_runtime.jsx)("div",{className:"px-4 pb-4",children:(0,jsx_runtime.jsx)(PaginationControl.R,{...activityRunningPagination,nouns:["activity","activities"]})})]}),(0,jsx_runtime.jsxs)(src.Mi,{className:"hover:transform-none mt-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 pb-2",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium text-lg",children:"Recently completed"}),tablesLoading&&null!==completedActivityResponse&&(0,jsx_runtime.jsx)(src.$j,{className:"text-muted"})]}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:activityCompletedPagination.dataSourcePage,columns:activityColumns,rowKey:r=>`${r.type}-${r.name}-${r.created_at}`,loading:tablesLoading&&null===completedActivityResponse,loadingSkeletonRows:3,emptyState:"No recently completed activities"}),activityCompletedPagination.entryCount>0&&(0,jsx_runtime.jsx)("div",{className:"px-4 pb-4",children:(0,jsx_runtime.jsx)(PaginationControl.R,{...activityCompletedPagination,nouns:["activity","activities"]})})]})]})}var SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneSection.tsx"),DataWarehouseManagedSourcesTable=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/DataWarehouseManagedSourcesTable.tsx"),DataWarehouseSelfManagedSourcesTable=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/DataWarehouseSelfManagedSourcesTable.tsx");function SourcesTab(){return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsx)(SceneSection.S,{title:"Managed data warehouse sources",description:"PostHog can connect to external sources and automatically import data from them into the PostHog data warehouse",children:(0,jsx_runtime.jsx)(DataWarehouseManagedSourcesTable.l,{})}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(SceneSection.S,{title:"Self-managed data warehouse sources",description:"Connect to your own data sources, making them queryable in PostHog",children:(0,jsx_runtime.jsx)(DataWarehouseSelfManagedSourcesTable.T,{})})]})}var More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts");let viewsTabLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","scene","viewsTabLogic"]),(0,index_esm.connect)(()=>({values:[dataWarehouseViewsLogic.$,["dataWarehouseSavedQueries","dataWarehouseSavedQueriesLoading"]],actions:[dataWarehouseViewsLogic.$,["deleteDataWarehouseSavedQuery","runDataWarehouseSavedQuery"]]})),(0,index_esm.actions)({setSearchTerm:searchTerm=>({searchTerm}),deleteView:viewId=>({viewId}),runMaterialization:viewId=>({viewId}),loadDependenciesForViews:viewIds=>({viewIds}),loadRunHistoryForViews:viewIds=>({viewIds}),setMaterializedViewsPage:page=>({page}),setViewsPage:page=>({page}),loadVisibleData:!0}),(0,index_esm.reducers)({searchTerm:["",{setSearchTerm:(_,_ref)=>{let{searchTerm}=_ref;return searchTerm}}],materializedViewsCurrentPage:[1,{setMaterializedViewsPage:(_,_ref2)=>{let{page}=_ref2;return page},setSearchTerm:()=>1}],viewsCurrentPage:[1,{setViewsPage:(_,_ref3)=>{let{page}=_ref3;return page},setSearchTerm:()=>1}]}),(0,lib.loaders)(_ref4=>{let{values}=_ref4;return{dependenciesMap:[{},{loadDependenciesForViews:async _ref5=>{let{viewIds}=_ref5,viewsToLoad=viewIds.filter(id=>!values.dependenciesMap[id]);if(0===viewsToLoad.length)return values.dependenciesMap;let results=await Promise.all(viewsToLoad.map(async viewId=>{try{let data=await api.ZP.dataWarehouseSavedQueries.dependencies(viewId);return{viewId,data}}catch(error){return console.error(`Failed to load dependencies for view ${viewId}:`,error),{viewId,data:{upstream_count:0,downstream_count:0}}}})),newMap={...values.dependenciesMap};return results.forEach(_ref6=>{let{viewId,data}=_ref6;newMap[viewId]=data}),newMap}}],runHistoryMap:[{},{loadRunHistoryForViews:async _ref7=>{let{viewIds}=_ref7,viewsToLoad=viewIds.filter(id=>!values.runHistoryMap[id]);if(0===viewsToLoad.length)return values.runHistoryMap;let results=await Promise.all(viewsToLoad.map(async viewId=>{try{let data=await api.ZP.dataWarehouseSavedQueries.runHistory(viewId);return{viewId,data:data.run_history}}catch(error){return console.error(`Failed to load run history for view ${viewId}:`,error),{viewId,data:[]}}})),newMap={...values.runHistoryMap};return results.forEach(_ref8=>{let{viewId,data}=_ref8;newMap[viewId]=data}),newMap}}]}}),(0,index_esm.selectors)({viewsLoading:[s=>[s.dataWarehouseSavedQueriesLoading],loading=>loading],enrichedQueries:[s=>[s.dataWarehouseSavedQueries,s.dependenciesMap,s.runHistoryMap],(queries,dependenciesMap,runHistoryMap)=>queries.map(query=>({...query,upstream_dependency_count:dependenciesMap[query.id]?.upstream_count,downstream_dependency_count:dependenciesMap[query.id]?.downstream_count,run_history:runHistoryMap[query.id]}))],filteredViews:[s=>[s.enrichedQueries,s.searchTerm],(queries,searchTerm)=>{let views=queries.filter(q=>!q.is_materialized);return searchTerm?views.filter(v=>v.name.toLowerCase().includes(searchTerm.toLowerCase())):views}],filteredMaterializedViews:[s=>[s.enrichedQueries,s.searchTerm],(queries,searchTerm)=>{let views=queries.filter(q=>q.is_materialized);return searchTerm?views.filter(v=>v.name.toLowerCase().includes(searchTerm.toLowerCase())):views}],visibleMaterializedViews:[s=>[s.filteredMaterializedViews,s.materializedViewsCurrentPage],(views,currentPage)=>{let startIndex=(currentPage-1)*10;return views.slice(startIndex,startIndex+10)}],visibleViews:[s=>[s.filteredViews,s.viewsCurrentPage],(views,currentPage)=>{let startIndex=(currentPage-1)*10;return views.slice(startIndex,startIndex+10)}]}),(0,index_esm.listeners)(_ref9=>{let{actions,values}=_ref9;return{deleteView:_ref10=>{let{viewId}=_ref10;src.dn.open({title:"Delete view?",description:"Are you sure you want to delete this view? This action cannot be undone.",primaryButton:{children:"Delete",status:"danger",onClick:()=>{actions.deleteDataWarehouseSavedQuery(viewId),LemonToast.U.success("View deleted successfully")}},secondaryButton:{children:"Cancel"}})},runMaterialization:_ref11=>{let{viewId}=_ref11;actions.runDataWarehouseSavedQuery(viewId)},loadDataWarehouseSavedQueriesSuccess:()=>{actions.loadVisibleData()},setMaterializedViewsPage:()=>{actions.loadVisibleData()},setViewsPage:()=>{actions.loadVisibleData()},setSearchTerm:()=>{actions.loadVisibleData()},loadVisibleData:()=>{let visibleMaterializedViewIds=values.visibleMaterializedViews.map(v=>v.id),allVisibleIds=[...visibleMaterializedViewIds,...values.visibleViews.map(v=>v.id)];allVisibleIds.length>0&&actions.loadDependenciesForViews(allVisibleIds),visibleMaterializedViewIds.length>0&&actions.loadRunHistoryForViews(visibleMaterializedViewIds)}}}),(0,index_esm.afterMount)(_ref12=>{let{actions,values}=_ref12;values.dataWarehouseSavedQueries.length>0&&actions.loadVisibleData()})]),STATUS_TAG_SETTINGS={Running:"primary",Completed:"success",Failed:"danger",Cancelled:"muted",Modified:"warning"},getDisabledReason=view=>{if(null!==view.managed_viewset_kind)return`Cannot delete a view that belongs to a managed viewset. You can turn the viewset off in the ${urls.j.dataWarehouseManagedViewsets()} page.`};function RunHistoryDisplay(_ref){let{runHistory,loading}=_ref;if(loading)return(0,jsx_runtime.jsx)(src.$j,{className:"text-sm"});if(!runHistory||0===runHistory.length)return(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"-"});let displayRuns=runHistory.slice(0,5);return(0,jsx_runtime.jsx)("div",{className:"flex gap-1",children:displayRuns.map((run,index)=>{let friendlyTime=run.timestamp?(0,utils.bo)(run.timestamp):"";return(0,jsx_runtime.jsx)(src.u,{title:`${run.status}${friendlyTime?` - ${friendlyTime}`:""}`,placement:"top",children:(0,jsx_runtime.jsx)("div",{className:`w-4 h-4 rounded-sm ${"Completed"===run.status?"bg-success":"bg-danger"}`})},index)})})}function DependencyCount(_ref2){let{count,loading}=_ref2;return loading||void 0===count?(0,jsx_runtime.jsx)(src.$j,{className:"text-sm"}):(0,jsx_runtime.jsx)("span",{children:count})}function ViewsTab(){let{filteredViews,filteredMaterializedViews,viewsLoading,searchTerm,dependenciesMapLoading,runHistoryMapLoading,materializedViewsCurrentPage,viewsCurrentPage}=(0,index_esm.useValues)(viewsTabLogic),{setSearchTerm,deleteView,runMaterialization,setMaterializedViewsPage,setViewsPage}=(0,index_esm.useActions)(viewsTabLogic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(filteredViews.length>0||filteredMaterializedViews.length>0||searchTerm)&&(0,jsx_runtime.jsx)("div",{className:"flex gap-2 justify-between items-center",children:(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search views...",onChange:setSearchTerm,value:searchTerm})}),filteredMaterializedViews.length>0&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Materialized views"}),(0,jsx_runtime.jsx)("p",{className:"text-muted mb-2",children:"Materialized views are refreshed on a schedule and stored as tables for faster query performance."}),(0,jsx_runtime.jsx)(src.g3,{dataSource:filteredMaterializedViews,loading:viewsLoading,columns:[{title:"Name",key:"name",render:(_,view)=>null!==view.managed_viewset_kind?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["You cannot edit the definition for a view that belongs to a managed viewset. You can enable/disable the viewset in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:urls.j.dataWarehouseManagedViewsets(),children:"Managed Viewsets"})," ","page."]}),children:(0,jsx_runtime.jsx)("span",{className:"font-bold text-primary",children:view.name})}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsxs)("span",{className:"text-muted text-xs",children:["Created by the"," ",(0,jsx_runtime.jsx)(src.rU,{to:urls.j.dataWarehouseManagedViewsets(),className:"text-muted",children:(0,jsx_runtime.jsx)("code",{children:view.managed_viewset_kind})})," ","managed viewset"]})]}):(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.sqlEditor(void 0,view.id),title:view.name,description:"Materialized view"})},{title:"Last run",key:"last_run_at",render:(_,view)=>view.last_run_at?(0,jsx_runtime.jsx)(TZLabel.w,{time:view.last_run_at,formatDate:"MMM DD, YYYY",formatTime:"HH:mm"}):"Never"},{title:"Status",key:"status",render:(_,view)=>{if(!view.status)return null;let tagContent=(0,jsx_runtime.jsx)(src.oe,{type:STATUS_TAG_SETTINGS[view.status]||"default",children:view.status});return view.latest_error&&"Failed"===view.status?(0,jsx_runtime.jsx)(src.u,{title:view.latest_error,children:tagContent}):tagContent}},{title:"Run history",key:"run_history",tooltip:"Recent run status (up to 5 most recent)",render:(_,view)=>(0,jsx_runtime.jsx)(RunHistoryDisplay,{runHistory:view.run_history,loading:runHistoryMapLoading})},{title:"Upstream",key:"upstream_count",tooltip:"Number of immediate upstream dependencies",render:(_,view)=>(0,jsx_runtime.jsx)(DependencyCount,{count:view.upstream_dependency_count,loading:dependenciesMapLoading})},{title:"Downstream",key:"downstream_count",tooltip:"Number of immediate downstream dependencies",render:(_,view)=>(0,jsx_runtime.jsx)(DependencyCount,{count:view.downstream_dependency_count,loading:dependenciesMapLoading})},{key:"actions",width:0,render:(_,view)=>(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>runMaterialization(view.id),children:"Run now"}),(0,jsx_runtime.jsx)(src.Jp,{status:"danger",onClick:()=>deleteView(view.id),disabledReason:getDisabledReason(view),children:"Delete"})]})})}],pagination:{pageSize:10,currentPage:materializedViewsCurrentPage,onForward:()=>{setMaterializedViewsPage(materializedViewsCurrentPage+1)},onBackward:()=>{setMaterializedViewsPage(materializedViewsCurrentPage-1)}}})]}),filteredViews.length>0&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Views"}),(0,jsx_runtime.jsx)("p",{className:"text-muted mb-2",children:"Views are virtual tables created from SQL queries. They are computed on-the-fly when queried."}),(0,jsx_runtime.jsx)(src.g3,{dataSource:filteredViews,loading:viewsLoading,columns:[{title:"Name",key:"name",render:(_,view)=>null!==view.managed_viewset_kind?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["You cannot edit the definition for a view that belongs to a managed viewset. You can enable/disable the viewset in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:urls.j.dataWarehouseManagedViewsets(),children:"Managed Viewsets"})," ","page."]}),children:(0,jsx_runtime.jsx)("span",{className:"font-bold text-primary",children:view.name})}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsxs)("span",{className:"text-muted text-xs",children:["Created by the"," ",(0,jsx_runtime.jsx)(src.rU,{to:urls.j.dataWarehouseManagedViewsets(),className:"text-muted",children:(0,jsx_runtime.jsx)("code",{children:view.managed_viewset_kind})})," ","managed viewset"]})]}):(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.sqlEditor(void 0,view.id),title:view.name})},{title:"Created",key:"created_at",render:(_,view)=>view.created_at?(0,jsx_runtime.jsx)(TZLabel.w,{time:view.created_at,formatDate:"MMM DD, YYYY",formatTime:"HH:mm"}):"-"},{title:"Upstream",key:"upstream_count",tooltip:"Number of immediate upstream dependencies",render:(_,view)=>(0,jsx_runtime.jsx)(DependencyCount,{count:view.upstream_dependency_count,loading:dependenciesMapLoading})},{title:"Downstream",key:"downstream_count",tooltip:"Number of immediate downstream dependencies",render:(_,view)=>(0,jsx_runtime.jsx)(DependencyCount,{count:view.downstream_dependency_count,loading:dependenciesMapLoading})},{key:"actions",width:0,render:(_,view)=>(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.Jp,{status:"danger",onClick:()=>deleteView(view.id),disabledReason:getDisabledReason(view),children:"Delete"})})})}],pagination:{pageSize:10,currentPage:viewsCurrentPage,onForward:()=>{setViewsPage(viewsCurrentPage+1)},onBackward:()=>{setViewsPage(viewsCurrentPage-1)}}})]}),!viewsLoading&&0===filteredViews.length&&0===filteredMaterializedViews.length&&(0,jsx_runtime.jsxs)("div",{className:"text-center py-12",children:[(0,jsx_runtime.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"No views found"}),searchTerm?(0,jsx_runtime.jsx)("p",{className:"text-muted",children:"No views match your search. Try adjusting your search term."}):(0,jsx_runtime.jsx)("p",{className:"text-muted",children:"Create your first view to transform and organize your data warehouse tables."}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",to:urls.j.sqlEditor(),className:"inline-block",children:"Create view"})]})]})}let scene={component:DataWarehouseScene,logic:dataWarehouseSceneLogic};function DataWarehouseScene(){let{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{activeTab}=(0,index_esm.useValues)(dataWarehouseSceneLogic),{setActiveTab}=(0,index_esm.useActions)(dataWarehouseSceneLogic);return featureFlags[constants.y8.DATA_WAREHOUSE_SCENE]?(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:scenes.lc[sceneTypes.x.DataWarehouse].name,description:scenes.lc[sceneTypes.x.DataWarehouse].description,resourceType:{type:scenes.lc[sceneTypes.x.DataWarehouse].iconType||"default_icon_type"},actions:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",to:urls.j.sqlEditor(),size:"small",children:"Create view"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",to:urls.j.dataWarehouseSourceNew(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),size:"small",children:"New source"})]})}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeTab,onChange:newKey=>setActiveTab(newKey),sceneInset:!0,tabs:[{key:DataWarehouseTab.OVERVIEW,label:"Overview",content:(0,jsx_runtime.jsx)(OverviewTab,{})},{key:DataWarehouseTab.SOURCES,label:"Sources",content:(0,jsx_runtime.jsx)(SourcesTab,{})},{key:DataWarehouseTab.VIEWS,label:"Views",content:(0,jsx_runtime.jsx)(ViewsTab,{})}]})]}):(0,jsx_runtime.jsx)(NotFound.T,{object:"Data warehouse"})}},"../../frontend/src/scenes/data-warehouse/settings/DataWarehouseSelfManagedSourcesTable.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>DataWarehouseSelfManagedSourcesTable});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),scenes_data_warehouse_settings_DataWarehouseSourceIcon__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/DataWarehouseSourceIcon.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DataWarehouseSelfManagedSourcesTable(){let{filteredSelfManagedTables,searchTerm}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_5__.T),{deleteSelfManagedTable,refreshSelfManagedTableSchema,setSearchTerm}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_5__.T);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex gap-2 justify-between items-center mb-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.DF,{type:"search",placeholder:"Search...",onChange:setSearchTerm,value:searchTerm})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.g3,{id:"self-managed-sources",dataSource:filteredSelfManagedTables,pagination:{pageSize:10},columns:[{width:0,render:(_,item)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(scenes_data_warehouse_settings_DataWarehouseSourceIcon__WEBPACK_IMPORTED_MODULE_3__.Ug,{type:(0,scenes_data_warehouse_settings_DataWarehouseSourceIcon__WEBPACK_IMPORTED_MODULE_3__.Zi)(item.url_pattern)})},{title:"Source",dataIndex:"name",key:"name",render:(_,item)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_2__.i,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.dataWarehouseSource(`self-managed-${item.id}`),title:item.name})},{key:"actions",render:(_,item)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex flex-row justify-end",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{"data-attr":`refresh-data-warehouse-${item.name}`,onClick:()=>refreshSelfManagedTableSchema(item.id),children:"Update schema from source"},`refresh-data-warehouse-${item.name}`),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{status:"danger","data-attr":`delete-data-warehouse-${item.name}`,onClick:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.dn.open({title:"Delete table?",description:"Table deletion cannot be undone. All views and joins related to this table will be deleted.",primaryButton:{children:"Delete",status:"danger",onClick:()=>{deleteSelfManagedTable(item.id)}},secondaryButton:{children:"Cancel"}})},children:"Delete"},`delete-data-warehouse-${item.name}`)]})}]})]})}}}]);