"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[40392],{"../../products/llm_analytics/frontend/datasets/LLMAnalyticsDatasetsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMAnalyticsDatasetsScene:()=>LLMAnalyticsDatasetsScene,scene:()=>scene});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),lib_lemon_ui_Link__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),lib_lemon_ui_ProfilePicture__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_scenes_components_SceneContent__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),_layout_scenes_components_SceneDivider__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),_layout_scenes_components_SceneTitleSection__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),_lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),_lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),_lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../products/llm_analytics/frontend/datasets/llmAnalyticsDatasetsLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:LLMAnalyticsDatasetsScene,logic:_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.x};function LLMAnalyticsDatasetsScene(){let{setFilters,deleteDataset}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.x),{datasets,datasetsLoading,sorting,pagination,filters,datasetCountLabel}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.x),columns=[{title:"Name",dataIndex:"name",key:"name",width:"20%",render:function renderName(_,dataset){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_Link__WEBPACK_IMPORTED_MODULE_3__.r,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.llmAnalyticsDataset(dataset.id),"data-testid":"dataset-link",children:dataset.name})}},{title:"Description",dataIndex:"description",key:"description",width:"50%",render:function renderDescription(description){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{className:"text-muted",children:description||(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("i",{children:"â€“"})})}},{title:"CreatedÂ by",dataIndex:"created_by",render:function renderCreatedBy(_,item){let{created_by}=item;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"flex flex-row items-center flex-nowrap",children:created_by&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_ProfilePicture__WEBPACK_IMPORTED_MODULE_4__.Y,{user:created_by,size:"md",showName:!0})})}},(0,_lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_11__.rw)(),(0,_lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_11__.yI)(),{width:0,render:function renderMore(_,dataset){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_2__.T,{overlay:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.llmAnalyticsDataset(dataset.id),"data-attr":`dataset-item-${dataset.id}-dropdown-view`,fullWidth:!0,children:"View"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{status:"danger",onClick:()=>deleteDataset(dataset.id),"data-attr":`dataset-item-${dataset.id}-dropdown-delete`,fullWidth:!0,children:"Delete"})]})})}}];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_layout_scenes_components_SceneContent__WEBPACK_IMPORTED_MODULE_6__._,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_layout_scenes_components_SceneTitleSection__WEBPACK_IMPORTED_MODULE_8__.s,{name:"Datasets",resourceType:{type:"llm_analytics"},actions:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{type:"primary",to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.llmAnalyticsDataset("new"),"data-testid":"create-dataset-button",size:"small",children:"New dataset"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_layout_scenes_components_SceneDivider__WEBPACK_IMPORTED_MODULE_7__.V,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex gap-x-4 gap-y-2 items-center flex-wrap py-4 -mt-4 mb-4 border-b justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_9__.D,{type:"search",placeholder:"Search datasets...",value:filters.search,onChange:value=>setFilters({search:value}),className:"max-w-md","data-testid":"search-datasets-input"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"text-muted-alt",children:datasetCountLabel})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_10__.g,{loading:datasetsLoading,columns:columns,dataSource:datasets.results,pagination:pagination,noSortingCancellation:!0,sorting:sorting,onSort:newSorting=>setFilters({order_by:newSorting?`${-1===newSorting.order?"-":""}${newSorting.columnKey}`:void 0}),rowKey:"id",loadingSkeletonRows:_llmAnalyticsDatasetsLogic__WEBPACK_IMPORTED_MODULE_12__.R,nouns:["dataset","datasets"]})]})}},"../../products/llm_analytics/frontend/datasets/llmAnalyticsDatasetsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>DATASETS_PER_PAGE,x:()=>llmAnalyticsDatasetsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),_lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/api.ts"),_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),_lib_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils.tsx"),_scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/sceneLogic.tsx"),_scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/urls.ts");let DATASETS_PER_PAGE=30;function cleanFilters(values){return{page:parseInt(String(values.page))||1,search:String(values.search||""),order_by:values.order_by||"-created_at"}}let llmAnalyticsDatasetsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","llm-analytics","llmAnalyticsDatasetsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:function(filters){let merge=!(arguments.length>1)||void 0===arguments[1]||arguments[1],debounce=!(arguments.length>2)||void 0===arguments[2]||arguments[2];return{filters,merge,debounce}},loadDatasets:function(){let debounce=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return{debounce}},deleteDataset:datasetId=>({datasetId})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({rawFilters:[null,{setFilters:(state,_ref)=>{let{filters,merge}=_ref;return cleanFilters({...merge&&state||{},...filters,..."page"in filters?{}:{page:1}})}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values}=_ref2;return{datasets:[{results:[],count:0,offset:0},{loadDatasets:async(_ref3,breakpoint)=>{let{debounce}=_ref3;debounce&&values.datasets.results.length>0&&await breakpoint(300);let{filters}=values,params={search:filters.search,order_by:filters.order_by,offset:Math.max(0,(filters.page-1)*DATASETS_PER_PAGE),limit:DATASETS_PER_PAGE};return _scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_6__.k.findMounted()?.values.activeSceneId==="LLMAnalyticsDatasets"&&"POP"!==kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.lastMethod&&values.datasets.results.length>0&&values.rawFilters?.page!==filters.page&&window.scrollTo(0,0),await _lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.datasets.list(params)}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({filters:[s=>[s.rawFilters],rawFilters=>cleanFilters(rawFilters||{})],count:[s=>[s.datasets],datasets=>datasets.count],sorting:[s=>[s.filters],filters=>filters.order_by?filters.order_by.startsWith("-")?{columnKey:filters.order_by.slice(1),order:-1}:{columnKey:filters.order_by,order:1}:{columnKey:"updated_at",order:-1}],pagination:[s=>[s.filters,s.count],(filters,count)=>({controlled:!0,pageSize:DATASETS_PER_PAGE,currentPage:filters.page,entryCount:count})],datasetCountLabel:[s=>[s.filters,s.count],(filters,count)=>{let start=(filters.page-1)*DATASETS_PER_PAGE+1,end=Math.min(filters.page*DATASETS_PER_PAGE,count);return 0===count?"0 datasets":`${start}-${end} of ${count} dataset${1===count?"":"s"}`}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{asyncActions,values,selectors}=_ref4;return{setFilters:async(_ref5,_,__,previousState)=>{let{debounce}=_ref5,oldFilters=selectors.filters(previousState),{filters}=values;(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(oldFilters,filters)||await asyncActions.loadDatasets(debounce)},deleteDataset:async _ref6=>{let{datasetId}=_ref6;try{let datasetName=values.datasets.results.find(dataset=>dataset.id===datasetId)?.name;await _lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.datasets.update(datasetId,{deleted:!0}),_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.info(`${datasetName||"Dataset"} has been deleted.`),await asyncActions.loadDatasets(!1)}catch{_lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Failed to delete dataset")}}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.actionToUrl)(_ref7=>{let{values}=_ref7;return{setFilters:()=>{let nextValues=cleanFilters(values.filters),urlValues=cleanFilters(kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.searchParams);if(!(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(nextValues,urlValues))return[_scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.llmAnalyticsDatasets(),nextValues,{},{replace:!1}]}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.urlToAction)(_ref8=>{let{actions,values}=_ref8;return{[_scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.llmAnalyticsDatasets()]:(_,searchParams)=>{let newFilters=cleanFilters(searchParams);null!==values.rawFilters&&(0,_lib_utils__WEBPACK_IMPORTED_MODULE_5__.h0)(values.filters,newFilters)||actions.setFilters(newFilters,!1)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref9=>{let{actions}=_ref9;actions.loadDatasets()})])}}]);