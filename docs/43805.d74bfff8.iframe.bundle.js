"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[43805],{"../../frontend/src/lib/components/heatmaps/HeatMapsSettings.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>HeatmapsSettings});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.6_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonLabel__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/index.ts"),lib_lemon_ui_LemonSegmentedButton__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSegmentedButton/index.ts"),lib_lemon_ui_LemonSelect__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSelect/index.ts"),lib_lemon_ui_LemonSlider__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSlider/index.ts"),react__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_toolbar_elements_heatmapLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/toolbar/elements/heatmapLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ScrollDepthJSWarning=()=>{let{scrollDepthPosthogJsError}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_toolbar_elements_heatmapLogic__WEBPACK_IMPORTED_MODULE_8__.XP);return scrollDepthPosthogJsError?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("p",{className:"my-2 bg-danger-highlight border border-danger rounded p-2",children:"version"===scrollDepthPosthogJsError?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:"This feature requires a newer version of posthog-js"}):"disabled"===scrollDepthPosthogJsError?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:["Your posthog-js config has ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("i",{children:"disable_scroll_properties"})," set - these properties are required for scroll depth calculations to work."]}):null}):null},SectionSetting=_ref=>{let{children,title,info}=_ref,[showInfo,setShowInfo]=(0,react__WEBPACK_IMPORTED_MODULE_7__.useState)(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div",{className:"deprecated-space-y-2 mb-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"flex items-center gap-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(lib_lemon_ui_LemonLabel__WEBPACK_IMPORTED_MODULE_3__.H,{className:"flex-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("span",{children:title}),info&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__.J,{icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconInfo,{}),size:"xsmall",active:showInfo,onClick:()=>setShowInfo(!showInfo),noPadding:!0})]})}),showInfo?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"text-sm",children:info}):null,children]})},HeatmapsSettings=_ref2=>{var _heatmapFilters$type,_heatmapFilters$aggre,_heatmapFilters$viewp,_heatmapFilters$viewp2;let{heatmapFilters,patchHeatmapFilters,viewportRange,heatmapColorPalette,setHeatmapColorPalette,heatmapFixedPositionMode,setHeatmapFixedPositionMode}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(SectionSetting,{title:"Heatmap type",info:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:['Select the kind of heatmap you want to view. Clicks, rageclicks, and mouse moves options will show different "heat" based on the number of interactions at that area of the page. Scroll depth will show how far down the page users have reached.',(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("br",{}),"Scroll depth uses additional information from Pageview and Pageleave events to indicate how far down the page users have scrolled."]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div",{className:"flex gap-2 justify-between items-center",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(lib_lemon_ui_LemonSelect__WEBPACK_IMPORTED_MODULE_5__.Yv,{onChange:e=>patchHeatmapFilters({type:e}),value:null!==(_heatmapFilters$type=heatmapFilters.type)&&void 0!==_heatmapFilters$type?_heatmapFilters$type:void 0,options:[{value:"click",label:"Clicks"},{value:"rageclick",label:"Rageclicks"},{value:"deadclick",label:"Dead clicks"},{value:"mousemove",label:"Mouse moves"},{value:"scrolldepth",label:"Scroll depth"}],size:"small"}),"scrolldepth"===heatmapFilters.type&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(ScrollDepthJSWarning,{})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(SectionSetting,{title:"Aggregation",info:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:"Heatmaps can be aggregated by total count or unique visitors. Total count will show the total number of interactions on the page, while unique visitors will only count each visitor once."}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{className:"flex gap-2 justify-between items-center",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(lib_lemon_ui_LemonSegmentedButton__WEBPACK_IMPORTED_MODULE_4__.P,{onChange:e=>patchHeatmapFilters({aggregation:e}),value:null!==(_heatmapFilters$aggre=heatmapFilters.aggregation)&&void 0!==_heatmapFilters$aggre?_heatmapFilters$aggre:"total_count",options:[{value:"total_count",label:"Total count"},{value:"unique_visitors",label:"Unique visitors"}],size:"small"})})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(SectionSetting,{title:"Viewport accuracy",info:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:["The viewport accuracy setting will determine how closely the loaded data will be to your current viewport.",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("br",{}),"For example if you set this to 100%, only visitors whose viewport width is identical to yours will be included in the heatmap.",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("br",{}),"At 90% you will see data from viewports that are 10% smaller or larger than yours."]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div",{className:"flex gap-2 justify-between items-center",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(lib_lemon_ui_LemonSlider__WEBPACK_IMPORTED_MODULE_6__.j,{className:"flex-1",min:0,max:1,step:.01,value:null!==(_heatmapFilters$viewp=heatmapFilters.viewportAccuracy)&&void 0!==_heatmapFilters$viewp?_heatmapFilters$viewp:0,onChange:value=>patchHeatmapFilters({viewportAccuracy:value})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("code",{className:"w-[12rem] text-right text-xs whitsepace-nowrap",children:`${Math.round((null!==(_heatmapFilters$viewp2=heatmapFilters.viewportAccuracy)&&void 0!==_heatmapFilters$viewp2?_heatmapFilters$viewp2:1)*100)}% (${viewportRange.min}px - ${viewportRange.max}px)`})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(SectionSetting,{title:"Color palette",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(lib_lemon_ui_LemonSelect__WEBPACK_IMPORTED_MODULE_5__.Yv,{size:"small",options:_toolbar_elements_heatmapLogic__WEBPACK_IMPORTED_MODULE_8__.Rp,value:heatmapColorPalette,onChange:setHeatmapColorPalette})}),"scrolldepth"!==heatmapFilters.type&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(SectionSetting,{title:"Fixed positioning calculation",info:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:["PostHog JS will attempt to detect fixed elements such as headers or modals and will therefore show those heatmap areas, ignoring the scroll value.",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("br",{}),"You can choose to show these areas as fixed, include them with scrolled data or hide them altogether."]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(lib_lemon_ui_LemonSegmentedButton__WEBPACK_IMPORTED_MODULE_4__.P,{onChange:setHeatmapFixedPositionMode,value:heatmapFixedPositionMode,options:[{value:"fixed",label:"Show fixed"},{value:"relative",label:"Show scrolled"},{value:"hidden",label:"Hide"}],size:"small"})})]})}},"../../frontend/src/toolbar/elements/heatmapLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Rp:()=>HEATMAP_COLOR_PALETTE_OPTIONS,XP:()=>heatmapLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.5_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),kea_window_values__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/kea-window-values@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-window-values/lib/index.js"),lib_actionUtils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/actionUtils.ts"),lib_components_IframedToolbarBrowser_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/components/IframedToolbarBrowser/utils.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/lib/utils.tsx"),lib_utils_semver__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../frontend/src/lib/utils/semver.ts"),query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("../../node_modules/.pnpm/query-selector-shadow-dom@1.0.0/node_modules/query-selector-shadow-dom/src/querySelectorDeep.js"),_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/toolbar/stats/currentPageLogic.ts"),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/toolbar/toolbarConfigLogic.ts"),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/toolbar/toolbarPosthogJS.ts"),_toolbar_utils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/toolbar/utils.ts"),_types__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../frontend/src/types.ts");let doesVersionSupportScrollDepth=(0,lib_utils_semver__WEBPACK_IMPORTED_MODULE_13__.Ff)("1.99"),emptyElementsStatsPages={next:void 0,previous:void 0,results:[]},HEATMAP_COLOR_PALETTE_OPTIONS=[{value:"default",label:"Default (multicolor)"},{value:"red",label:"Red (monocolor)"},{value:"green",label:"Green (monocolor)"},{value:"blue",label:"Blue (monocolor)"}],heatmapLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","elements","heatmapLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_8__.z,["href","wildcardHref"],_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__.W,["posthog"]],actions:[_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_8__.z,["setHref","setWildcardHref"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({getElementStats:url=>({url}),enableHeatmap:!0,disableHeatmap:!0,setShiftPressed:shiftPressed=>({shiftPressed}),setCommonFilters:filters=>({filters}),setHeatmapFilters:filters=>({filters}),patchHeatmapFilters:filters=>({filters}),toggleClickmapsEnabled:enabled=>({enabled}),loadMoreElementStats:!0,setMatchLinksByHref:matchLinksByHref=>({matchLinksByHref}),loadHeatmap:type=>({type}),loadAllEnabled:function(){let delayMs=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{delayMs}},maybeLoadClickmap:function(){let delayMs=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{delayMs}},maybeLoadHeatmap:function(){let delayMs=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{delayMs}},fetchHeatmapApi:params=>({params}),setHeatmapScrollY:scrollY=>({scrollY}),setHeatmapFixedPositionMode:mode=>({mode}),setHeatmapColorPalette:Palette=>({Palette})}),(0,kea_window_values__WEBPACK_IMPORTED_MODULE_4__.windowValues)(()=>({windowWidth:window1=>window1.innerWidth,windowHeight:window1=>window1.innerHeight})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({matchLinksByHref:[!1,{setMatchLinksByHref:(_,_ref)=>{let{matchLinksByHref}=_ref;return matchLinksByHref}}],canLoadMoreElementStats:[!0,{getElementStatsSuccess:(_,_ref2)=>{let{elementStats}=_ref2;return null!==elementStats.next},getElementStatsFailure:()=>!0}],heatmapEnabled:[!1,{enableHeatmap:()=>!0,disableHeatmap:()=>!1,getElementStatsFailure:()=>!1}],shiftPressed:[!1,{setShiftPressed:(_,_ref3)=>{let{shiftPressed}=_ref3;return shiftPressed}}],commonFilters:[{date_from:"-7d"},{setCommonFilters:(_,_ref4)=>{let{filters}=_ref4;return filters}}],heatmapFilters:[lib_components_IframedToolbarBrowser_utils__WEBPACK_IMPORTED_MODULE_6__._f,{persist:!0},{setHeatmapFilters:(_,_ref5)=>{let{filters}=_ref5;return filters},patchHeatmapFilters:(state,_ref6)=>{let{filters}=_ref6;return{...state,...filters}}}],clickmapsEnabled:[!1,{persist:!0},{toggleClickmapsEnabled:(state,_ref7)=>{let{enabled}=_ref7;return void 0===enabled?!state:enabled}}],heatmapScrollY:[0,{setHeatmapScrollY:(_,_ref8)=>{let{scrollY}=_ref8;return scrollY}}],heatmapFixedPositionMode:["fixed",{setHeatmapFixedPositionMode:(_,_ref9)=>{let{mode}=_ref9;return mode}}],heatmapColorPalette:["default",{persist:!0},{setHeatmapColorPalette:(_,_ref10)=>{let{Palette}=_ref10;return Palette}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref11=>{let{values}=_ref11;return{elementStats:[null,{resetElementStats:()=>emptyElementsStatsPages,getElementStats:async(_ref12,breakpoint)=>{let{url}=_ref12,{href,wildcardHref}=values,defaultUrl="";if(!url){let params={properties:[wildcardHref===href?{key:"$current_url",value:href,operator:_types__WEBPACK_IMPORTED_MODULE_12__.WV.Exact,type:_types__WEBPACK_IMPORTED_MODULE_12__.FT.Event}:{key:"$current_url",value:`^${wildcardHref.split("*").map(lib_actionUtils__WEBPACK_IMPORTED_MODULE_5__.yI).join(".*")}$`,operator:_types__WEBPACK_IMPORTED_MODULE_12__.WV.Regex,type:_types__WEBPACK_IMPORTED_MODULE_12__.FT.Event}],date_from:values.commonFilters.date_from,date_to:values.commonFilters.date_to};defaultUrl=`/api/element/stats/${(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.encodeParams)({...params,paginate_response:!0},"?")}`}let response=await (0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__.O)(url||defaultUrl,"GET",void 0,url?"use-as-provided":"full");if(403===response.status)return _toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__.W.actions.authenticate(),emptyElementsStatsPages;let paginatedResults=await response.json();if(breakpoint(),!Array.isArray(paginatedResults.results))throw Error("Error loading HeatMap data!");return{results:[...url&&values.elementStats?.results||[],...paginatedResults.results||[]],next:paginatedResults.next,previous:paginatedResults.previous}}}],rawHeatmap:[null,{loadHeatmap:async()=>{let{href,wildcardHref}=values,{date_from,date_to}=values.commonFilters,{type,aggregation}=values.heatmapFilters,response=await (0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__.O)(`/api/heatmap/${(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.encodeParams)({type,date_from,date_to,url_exact:wildcardHref===href?href:void 0,url_pattern:wildcardHref!==href?wildcardHref:void 0,viewport_width_min:values.viewportRange.min,viewport_width_max:values.viewportRange.max,aggregation},"?")}`,"GET");if(403===response.status&&_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__.W.actions.authenticate(),200!==response.status)throw Error("API error");return await response.json()}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(_ref13=>{let{cache}=_ref13;return{dateRange:[s=>[s.commonFilters],commonFilters=>(0,lib_utils__WEBPACK_IMPORTED_MODULE_7__.Kl)(commonFilters.date_from,commonFilters.date_to,"Last 7 days")],elements:[s=>[s.elementStats,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__.W.selectors.dataAttributes,s.href,s.matchLinksByHref],(elementStats,dataAttributes,href,matchLinksByHref)=>{cache.pageElements=cache.lastHref==href?cache.pageElements:(0,query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_14__.n8)("*",document),cache.selectorToElements=cache.lastHref==href?cache.selectorToElements:{},cache.lastHref=href;let elements=[];return elementStats?.results.forEach(event=>{let combinedSelector,lastSelector;for(let i=0;i<event.elements.length;i++){let element=event.elements[i],selector=lib_actionUtils__WEBPACK_IMPORTED_MODULE_5__.nr(matchLinksByHref?element:{...element,href:void 0},dataAttributes)||"*";combinedSelector=lastSelector?`${selector} > ${lastSelector}`:selector;try{let domElements=cache.selectorToElements?.[combinedSelector];if(void 0===domElements&&(domElements=Array.from(query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_14__.Jp(combinedSelector,document,cache.pageElements)),cache.selectorToElements[combinedSelector]=domElements),1===domElements.length){let e=event.elements[i];if(0!==i||!e.tag_name||e.attr_class||e.attr_id||e.href||e.text||1!==e.nth_child||1!==e.nth_of_type||e.attributes["attr__data-attr"])return elements.push({element:domElements[0],count:event.count,selector:selector,hash:event.hash,type:event.type}),null}if(0===domElements.length){if(i===event.elements.length-1)return null;if(i>0&&lastSelector){lastSelector=lastSelector?`* > ${lastSelector}`:"*";continue}}}catch(error){break}lastSelector=combinedSelector}}),elements}],countedElements:[s=>[s.elements,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__.W.selectors.dataAttributes,s.clickmapsEnabled],(elements,dataAttributes,clickmapsEnabled)=>{if(!clickmapsEnabled)return[];let normalisedElements=new Map;(elements||[]).forEach(countedElement=>{let trimmedElement=(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_11__.OS)(countedElement.element);if(trimmedElement){if(normalisedElements.has(trimmedElement)){let existing=normalisedElements.get(trimmedElement);existing&&(existing.count+=countedElement.count,existing.clickCount+="$rageclick"===countedElement.type?0:countedElement.count,existing.rageclickCount+="$rageclick"===countedElement.type?countedElement.count:0)}else normalisedElements.set(trimmedElement,{...countedElement,clickCount:"$rageclick"===countedElement.type?0:countedElement.count,rageclickCount:"$rageclick"===countedElement.type?countedElement.count:0,element:trimmedElement,actionStep:(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_11__.bE)(trimmedElement,dataAttributes)})}});let countedElements=Array.from(normalisedElements.values());return countedElements.sort((a,b)=>b.count-a.count),countedElements.map((e,i)=>({...e,position:i+1}))}],elementCount:[s=>[s.countedElements],countedElements=>countedElements.length],clickCount:[s=>[s.countedElements],countedElements=>countedElements?countedElements.map(e=>e.count).reduce((a,b)=>a+b,0):0],highestClickCount:[s=>[s.countedElements],countedElements=>countedElements?countedElements.map(e=>e.count).reduce((a,b)=>b>a?b:a,0):0],heatmapElements:[s=>[s.rawHeatmap],rawHeatmap=>{if(!rawHeatmap)return[];let elements=[];return rawHeatmap?.results.forEach(element=>{"scroll_depth_bucket"in element?elements.push({count:element.cumulative_count,xPercentage:0,targetFixed:!1,y:element.scroll_depth_bucket}):elements.push({count:element.count,xPercentage:element.pointer_relative_x,targetFixed:element.pointer_target_fixed,y:element.pointer_y})}),elements}],viewportRange:[s=>[s.heatmapFilters,s.windowWidth],(heatmapFilters,windowWidth)=>(0,lib_components_IframedToolbarBrowser_utils__WEBPACK_IMPORTED_MODULE_6__.f6)(heatmapFilters,windowWidth)],heatmapTooltipLabel:[s=>[s.heatmapFilters],heatmapFilters=>"unique_visitors"===heatmapFilters.aggregation?"visitors":heatmapFilters.type+"s"],scrollDepthPosthogJsError:[s=>[s.posthog],posthog=>{var _ref14,_posthog$version;if(!posthog)return null;let posthogVersion=null!==(_ref14=null!==(_posthog$version=posthog?.version)&&void 0!==_posthog$version?_posthog$version:posthog?._calculate_event_properties("test",{},new Date)?.$lib_version)&&void 0!==_ref14?_ref14:"0.0.0";if(!posthog?.scrollManager?.scrollY)return"version";let isSupported=doesVersionSupportScrollDepth(posthogVersion),isDisabled=posthog?.config.disable_scroll_properties;return isSupported?isDisabled?"disabled":null:"version"}],heatmapJsData:[s=>[s.heatmapElements,s.heatmapScrollY,s.windowWidth,s.heatmapFixedPositionMode],(heatmapElements,heatmapScrollY,windowWidth,heatmapFixedPositionMode)=>{let data=heatmapElements.reduce((acc,element)=>{if("hidden"===heatmapFixedPositionMode&&element.targetFixed)return acc;let y=Math.round(element.targetFixed&&"fixed"===heatmapFixedPositionMode?element.y:element.y-heatmapScrollY);return[...acc,{x:Math.round(element.xPercentage*windowWidth),y,value:element.count}]},[]);return{min:0,max:data.reduce((max,_ref15)=>{let{value}=_ref15;return Math.max(max,value)},0),data}}]}}),(0,kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__.Vt)(_ref16=>{let{actions}=_ref16;return{viewportRange:()=>{actions.maybeLoadHeatmap(500)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref17=>{let{actions,values}=_ref17;return{fetchHeatmapApi:async()=>{let{href,wildcardHref}=values,{date_from,date_to}=values.commonFilters,{type,aggregation}=values.heatmapFilters,response=await (0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__.O)(`/api/heatmap/${(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.encodeParams)({type,date_from,date_to,url_exact:wildcardHref===href?href:void 0,url_pattern:wildcardHref!==href?wildcardHref:void 0,viewport_width_min:values.viewportRange.min,viewport_width_max:values.viewportRange.max,aggregation},"?")}`,"GET");if(403===response.status&&_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_9__.W.actions.authenticate(),200!==response.status)throw Error("API error");return await response.json()},enableHeatmap:()=>{actions.loadAllEnabled(),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_10__.T.capture("toolbar mode triggered",{mode:"heatmap",enabled:!0})},disableHeatmap:()=>{actions.resetElementStats(),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_10__.T.capture("toolbar mode triggered",{mode:"heatmap",enabled:!1})},loadAllEnabled:async(_ref18,breakpoint)=>{let{delayMs}=_ref18;await breakpoint(delayMs),actions.maybeLoadHeatmap(),actions.maybeLoadClickmap()},maybeLoadClickmap:async(_ref19,breakpoint)=>{let{delayMs}=_ref19;await breakpoint(delayMs),values.heatmapEnabled&&values.clickmapsEnabled&&actions.getElementStats()},maybeLoadHeatmap:async(_ref20,breakpoint)=>{let{delayMs}=_ref20;await breakpoint(delayMs),values.heatmapEnabled&&values.heatmapFilters.enabled&&values.heatmapFilters.type&&actions.loadHeatmap(values.heatmapFilters.type)},setHref:()=>{actions.loadAllEnabled()},setWildcardHref:()=>{actions.loadAllEnabled(1e3)},setCommonFilters:()=>{actions.loadAllEnabled(200)},toggleClickmapsEnabled:()=>{values.clickmapsEnabled&&actions.getElementStats()},loadMoreElementStats:()=>{values.elementStats?.next&&actions.getElementStats(values.elementStats.next)},patchHeatmapFilters:_ref21=>{let{filters}=_ref21;filters.type&&actions.loadHeatmapSuccess({results:[]}),actions.maybeLoadHeatmap(200)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref22=>{let{actions,values,cache}=_ref22;actions.loadAllEnabled(),cache.keyDownListener=event=>{event.shiftKey&&!values.shiftPressed&&actions.setShiftPressed(!0)},cache.keyUpListener=event=>{!event.shiftKey&&values.shiftPressed&&actions.setShiftPressed(!1)},window.addEventListener("keydown",cache.keyDownListener),window.addEventListener("keyup",cache.keyUpListener),cache.scrollCheckTimer=setInterval(()=>{var _values$posthog$scrol;let scrollY=null!==(_values$posthog$scrol=values.posthog?.scrollManager?.scrollY())&&void 0!==_values$posthog$scrol?_values$posthog$scrol:0;values.heatmapScrollY!==scrollY&&actions.setHeatmapScrollY(scrollY)},100)}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.beforeUnmount)(_ref23=>{let{cache}=_ref23;window.removeEventListener("keydown",cache.keyDownListener),window.removeEventListener("keyup",cache.keyUpListener),clearInterval(cache.scrollCheckTimer)})])},"../../frontend/src/toolbar/stats/currentPageLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{z:()=>currentPageLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js");let replaceWithWildcard=part=>part.match(/^([a-f]|[0-9]){8}-([a-f]|[0-9]){4}-([a-f]|[0-9]){4}-([a-f]|[0-9]){4}-([a-f]|[0-9]){12}$/)||part.match(/^[0-9]+$/)||part.length>24?"*":part;function withoutPostHogInit(href){try{let firstHash=href.indexOf("#");if(-1===firstHash)return href;return href.replace(/__posthog=\{[^}]*}[^#]*/,"").replace("##","#").replace(/#$/,"")}catch{return href}}let currentPageLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","stats","currentPageLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)(()=>({setHref:href=>({href}),setWildcardHref:href=>({href}),autoWildcardHref:!0})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(()=>({href:[window.location.href,{setHref:(_,_ref)=>{let{href}=_ref;return withoutPostHogInit(href)}}],wildcardHref:[window.location.href,{setHref:(_,_ref2)=>{let{href}=_ref2;return withoutPostHogInit(href)},setWildcardHref:(_,_ref3)=>{let{href}=_ref3;return withoutPostHogInit(href)}}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions,values}=_ref4;return{autoWildcardHref:()=>{let url=values.wildcardHref,urlParts=url.split("?");if(url=urlParts[0].split("/").map(part=>replaceWithWildcard(part)).join("/"),urlParts.length>1){let queryParams=urlParts[1].split("&");for(let i=0;i<queryParams.length;i++){let[key,value]=queryParams[i].split("=");queryParams[i]=`${key}=${replaceWithWildcard(value)}`}url=`${url}?${queryParams.join("&")}`}actions.setWildcardHref(url)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref5=>{let{actions,values,cache}=_ref5;values.href&&values.href.includes("#__posthog=")&&actions.setHref(withoutPostHogInit(values.href)),cache.interval=window.setInterval(()=>{window.location.href!==values.href&&actions.setHref(window.location.href)},500)}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.beforeUnmount)(_ref6=>{let{cache}=_ref6;window.clearInterval(cache.interval)})])}}]);