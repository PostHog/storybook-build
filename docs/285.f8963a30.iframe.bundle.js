(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{"./frontend/src/scenes/feature-flags/FeatureFlag.tsx":function(fe,A,t){"use strict";t.r(A),t.d(A,"scene",function(){return wn}),t.d(A,"FeatureFlag",function(){return mt});var k=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),H=t.n(k),be=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),L=t.n(be),_e=t("./node_modules/core-js/modules/es.function.name.js"),Ae=t("./node_modules/core-js/modules/es.array.map.js"),re=t("./node_modules/core-js/modules/es.object.to-string.js"),Ce=t("./node_modules/core-js/modules/es.regexp.to-string.js"),Me=t("./node_modules/core-js/modules/es.array.find.js"),Ue=t("./node_modules/core-js/modules/es.array.includes.js"),ae=t("./node_modules/core-js/modules/es.string.includes.js"),Pe=t("./node_modules/core-js/modules/es.array.concat.js"),oe=t("./node_modules/react/index.js"),ye=t("./node_modules/kea-forms/lib/index.js"),ve=t("./node_modules/antd/es/divider/index.js"),y=t("./node_modules/antd/es/row/index.js"),U=t("./node_modules/antd/es/col/index.js"),N=t("./node_modules/antd/es/skeleton/index.js"),Fe=t("./node_modules/antd/es/tabs/index.js"),ce=t("./node_modules/antd/es/popconfirm/index.js"),P=t("./node_modules/antd/es/radio/index.js"),Y=t("./node_modules/antd/es/input-number/index.js"),F=t("./node_modules/antd/es/select/index.js"),f=t("./node_modules/kea/lib/index.esm.js"),C=t("./frontend/src/lib/utils.tsx"),z=t("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Ee=t("./node_modules/@ant-design/icons/es/icons/LockOutlined.js"),ee=t("./node_modules/core-js/modules/es.object.keys.js"),qe=t("./node_modules/core-js/modules/es.symbol.js"),te=t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Ge=t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),at=t("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),gt=t.n(at),et=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ne=t.n(et),Ye=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),We=t.n(Ye),ot=t("./node_modules/@babel/runtime/regenerator/index.js"),M=t.n(ot),Lt=t("./node_modules/core-js/modules/es.regexp.exec.js"),jt=t("./node_modules/core-js/modules/es.string.match.js"),J=t("./node_modules/core-js/modules/es.array.splice.js"),Q=t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Z=t("./node_modules/core-js/modules/es.array.iterator.js"),se=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),we=t("./node_modules/core-js/modules/es.string.replace.js"),Ke=t("./node_modules/core-js/modules/es.array.slice.js"),tt=t("./node_modules/core-js/modules/es.array.filter.js"),S=t("./frontend/src/types.ts"),Oe=t("./frontend/src/lib/api.ts"),ie=t("./node_modules/kea-router/lib/index.js"),le=t("./frontend/src/scenes/urls.ts"),it=t("./frontend/src/scenes/teamLogic.tsx"),G=t("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),ze=t("./frontend/src/models/groupsModel.ts"),Te=t("./frontend/src/lib/components/TaxonomicFilter/types.ts"),St=t("./frontend/src/lib/components/lemonToast.tsx"),Dt=t("./frontend/src/lib/utils/eventUsageLogic.ts"),lt=t("./node_modules/kea-loaders/lib/index.js"),pt=t("./frontend/src/scenes/insights/utils/cleanFilters.ts"),ct=t("./frontend/src/lib/dayjs.ts"),Kt=t("./frontend/src/scenes/insights/sharedUtils.ts"),j=["created_at","id"];function g(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function o(s){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?g(Object(r),!0).forEach(function(a){We()(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}var _=function(){return{operator:"gt",threshold_type:S.V.Sentry,threshold:50,threshold_metric:o({},Object(pt.a)({insight:S.F.TRENDS,date_from:Object(ct.a)().subtract(7,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(ct.a)().endOf("d").format("YYYY-MM-DDTHH:mm")}))}},I={id:null,created_at:null,key:"",name:"",filters:{groups:[{properties:[],rollout_percentage:null,variant:void 0}],multivariate:null},deleted:!1,active:!0,created_by:null,is_simple_flag:!1,rollout_percentage:null,ensure_experience_continuity:!1,experiment_set:null,rollback_conditions:[],performed_rollback:!1,can_edit:!0},D={key:"",name:"",rollout_percentage:0},W={variants:[{key:"",name:"",rollout_percentage:100}]},K=function(n){return{events:[{id:"$feature_flag_called",name:"$feature_flag_called",type:"events",properties:O(n)}]}},O=function(n){return[{key:"$feature/"+n,type:S.N.Event,value:["false"],operator:S.P.IsNot},{key:"$feature/"+n,type:S.N.Event,value:"is_set",operator:S.P.IsSet},{key:"$feature_flag",type:S.N.Event,value:n,operator:S.P.Exact}]},E=Object(f.kea)([Object(f.path)(["scenes","feature-flags","featureFlagLogic"]),Object(f.props)({}),Object(f.key)(function(s){var n=s.id;return n!=null?n:"unknown"}),Object(f.connect)({values:[it.a,["currentTeamId","sentryIntegrationEnabled"],ze.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]]}),Object(f.actions)({setFeatureFlag:function(n){return{featureFlag:n}},setFeatureFlagMissing:!0,addConditionSet:!0,addRollbackCondition:!0,setAggregationGroupTypeIndex:function(n){return{value:n}},removeConditionSet:function(n){return{index:n}},removeRollbackCondition:function(n){return{index:n}},duplicateConditionSet:function(n){return{index:n}},updateConditionSet:function(n,r,a,l){return{index:n,newRolloutPercentage:r,newProperties:a,newVariant:l}},deleteFeatureFlag:function(n){return{featureFlag:n}},setMultivariateEnabled:function(n){return{enabled:n}},setMultivariateOptions:function(n){return{multivariateOptions:n}},addVariant:!0,duplicateVariant:function(n){return{index:n}},removeVariant:function(n){return{index:n}},editFeatureFlag:function(n){return{editing:n}},distributeVariantsEqually:!0,setFilters:function(n){return{filters:n}},loadInsightAtIndex:function(n,r){return{index:n,filters:r}},setInsightResultAtIndex:function(n,r){return{index:n,average:r}},loadAllInsightsForFlag:!0}),Object(ye.forms)(function(s){var n=s.actions;return{featureFlag:{defaults:o({},I),errors:function(a){var l,i,u,d=a.key,m=a.filters;return{key:d?(l=d.match)!==null&&l!==void 0&&l.call(d,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key",filters:{multivariate:{variants:m==null||(i=m.multivariate)===null||i===void 0||(u=i.variants)===null||u===void 0?void 0:u.map(function(c){var v,x=c.key;return{key:x?(v=x.match)!==null&&v!==void 0&&v.call(x,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key"}})}}}},submit:function(a){n.saveFeatureFlag(a)}}}}),Object(f.reducers)({featureFlag:[o({},I),{setFeatureFlag:function(n,r){var a=r.featureFlag;if(a.filters.groups){var l=a.filters.groups.map(function(i){return i.properties?o(o({},i),{},{properties:Object(C.r)(i.properties)}):i});return o(o({},a),{},{filters:o(o({},a==null?void 0:a.filters),{},{groups:l})})}return a},addConditionSet:function(n){if(!n)return n;var r=[].concat(H()(n==null?void 0:n.filters.groups),[{properties:[],rollout_percentage:null}]);return o(o({},n),{},{filters:o(o({},n.filters),{},{groups:r})})},addRollbackCondition:function(n){return n&&o(o({},n),{},{rollback_conditions:[].concat(H()(n.rollback_conditions),[_()])})},removeRollbackCondition:function(n,r){var a=r.index;if(!n)return n;var l=H()(n.rollback_conditions);return l.splice(a,1),o(o({},n),{},{rollback_conditions:l})},updateConditionSet:function(n,r){var a=r.index,l=r.newRolloutPercentage,i=r.newProperties,u=r.newVariant;if(!n)return n;var d=H()(n==null?void 0:n.filters.groups);return l!==void 0&&(d[a]=o(o({},d[a]),{},{rollout_percentage:l})),i!==void 0&&(d[a]=o(o({},d[a]),{},{properties:i})),u!==void 0&&(d[a]=o(o({},d[a]),{},{variant:u})),o(o({},n),{},{filters:o(o({},n.filters),{},{groups:d})})},removeConditionSet:function(n,r){var a=r.index;if(!n)return n;var l=H()(n.filters.groups);return l.splice(a,1),o(o({},n),{},{filters:o(o({},n.filters),{},{groups:l})})},duplicateConditionSet:function(n,r){var a=r.index;if(!n)return n;var l=n.filters.groups.concat([n.filters.groups[a]]);return o(o({},n),{},{filters:o(o({},n.filters),{},{groups:l})})},setMultivariateOptions:function(n,r){var a=r.multivariateOptions;return n&&o(o({},n),{},{filters:o(o({},n.filters),{},{multivariate:a})})},addVariant:function(n){var r;if(!n)return n;var a=H()(((r=n.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]);return o(o({},n),{},{filters:o(o({},n.filters),{},{multivariate:o(o({},n.filters.multivariate||{}),{},{variants:[].concat(H()(a),[D])})})})},removeVariant:function(n,r){var a,l=r.index;if(!n)return n;var i=H()(((a=n.filters.multivariate)===null||a===void 0?void 0:a.variants)||[]);return i.splice(l,1),o(o({},n),{},{filters:o(o({},n.filters),{},{multivariate:o(o({},n.filters.multivariate),{},{variants:i})})})},distributeVariantsEqually:function(n){var r;if(!n)return n;var a=H()(((r=n.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]),l=a.length;if(l>0&&l<=100){var i=Math.round(100/l),u=i*l,d=u-100;a.forEach(function(m,c){a[c]=o(o({},m),{},{rollout_percentage:i})}),a[l-1]=o(o({},a[l-1]),{},{rollout_percentage:i-d})}return o(o({},n),{},{filters:o(o({},n.filters),{},{multivariate:o(o({},n.filters.multivariate),{},{variants:a})})})},setAggregationGroupTypeIndex:function(n,r){var a=r.value;return!n||n.filters.aggregation_group_type_index==a?n:o(o({},n),{},{filters:o(o({},n.filters),{},{aggregation_group_type_index:a,groups:[{properties:[],rollout_percentage:null}]})})}}],featureFlagMissing:[!1,{setFeatureFlagMissing:function(){return!0}}],isEditingFlag:[!1,{editFeatureFlag:function(n,r){var a=r.editing;return a}}],insightRollingAverages:[{},{setInsightResultAtIndex:function(n,r){var a=r.index,l=r.average;return o(o({},n),{},We()({},"".concat(a),l))}}]}),Object(lt.loaders)(function(s){var n=s.values,r=s.props,a=s.actions;return{featureFlag:{loadFeatureFlag:function(){var l=ne()(M.a.mark(function u(){return M.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(r.id&&r.id!=="new")){m.next=11;break}return m.prev=1,m.next=4,Oe.b.get("api/projects/".concat(n.currentTeamId,"/feature_flags/").concat(r.id));case 4:return m.abrupt("return",m.sent);case 7:throw m.prev=7,m.t0=m.catch(1),a.setFeatureFlagMissing(),m.t0;case 11:return m.abrupt("return",I);case 12:case"end":return m.stop()}},u,null,[[1,7]])}));function i(){return l.apply(this,arguments)}return i}(),saveFeatureFlag:function(){var l=ne()(M.a.mark(function u(d){var m,c,v,x;return M.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(m=d.created_at,c=d.id,v=gt()(d,j),p.prev=1,d.id){p.next=9;break}return p.next=5,Oe.b.create("api/projects/".concat(n.currentTeamId,"/feature_flags"),v);case 5:return x=p.sent,p.abrupt("return",x);case 9:return p.next=11,Oe.b.update("api/projects/".concat(n.currentTeamId,"/feature_flags/").concat(d.id),v);case 11:return p.abrupt("return",p.sent);case 12:p.next=18;break;case 14:throw p.prev=14,p.t0=p.catch(1),(p.t0.code==="behavioral_cohort_found"||p.t0.code==="cohort_does_not_exist")&&Dt.e.actions.reportFailedToCreateFeatureFlagWithCohort(p.t0.code,p.t0.detail),p.t0;case 18:case"end":return p.stop()}},u,null,[[1,14]])}));function i(u){return l.apply(this,arguments)}return i}()},recentInsights:[[],{loadRecentInsights:function(){var l=ne()(M.a.mark(function u(){var d;return M.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(r.id&&r.id!=="new"&&n.featureFlag.key)){c.next=5;break}return c.next=3,Oe.b.get("api/projects/".concat(n.currentTeamId,"/insights/?feature_flag=").concat(n.featureFlag.key,"&order=-created_at"));case 3:return d=c.sent,c.abrupt("return",d.results);case 5:return c.abrupt("return",[]);case 6:case"end":return c.stop()}},u)}));function i(){return l.apply(this,arguments)}return i}()}],sentryErrorCount:[void 0,{loadSentryErrorCount:function(){var l=ne()(M.a.mark(function u(){var d;return M.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Oe.b.get("api/sentry_errors/");case 2:return d=c.sent,c.abrupt("return",d.total_count);case 4:case"end":return c.stop()}},u)}));function i(){return l.apply(this,arguments)}return i}()}]}}),Object(f.listeners)(function(s){var n=s.actions,r=s.values;return{saveFeatureFlagSuccess:function(l){var i,u=l.featureFlag;St.d.success("Feature flag saved"),(i=G.b.findMounted())===null||i===void 0||i.actions.updateFlag(u),ie.router.actions.replace(le.a.featureFlag(u.id)),n.editFeatureFlag(!1)},deleteFeatureFlag:function(){var a=ne()(M.a.mark(function i(u){var d;return M.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:d=u.featureFlag,Object(C.x)({endpoint:"projects/".concat(r.currentTeamId,"/feature_flags"),object:{name:d.name,id:d.id},callback:function(){var x,h;d.id&&((x=G.b.findMounted())===null||x===void 0||x.actions.deleteFlag(d.id)),(h=G.b.findMounted())===null||h===void 0||h.actions.loadFeatureFlags(),ie.router.actions.push(le.a.featureFlags())}});case 2:case"end":return c.stop()}},i)}));function l(i){return a.apply(this,arguments)}return l}(),setMultivariateEnabled:function(){var a=ne()(M.a.mark(function i(u){var d;return M.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:d=u.enabled,d?n.setMultivariateOptions(W):n.setMultivariateOptions(null);case 2:case"end":return c.stop()}},i)}));function l(i){return a.apply(this,arguments)}return l}(),loadFeatureFlagSuccess:function(){var a=ne()(M.a.mark(function i(){return M.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:n.loadRecentInsights(),n.loadAllInsightsForFlag();case 2:case"end":return d.stop()}},i)}));function l(){return a.apply(this,arguments)}return l}(),loadInsightAtIndex:function(){var a=ne()(M.a.mark(function i(u){var d,m,c,v,x,h,p,V;return M.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(d=u.index,m=u.filters,!m){R.next=9;break}return R.next=4,Oe.b.get("api/projects/".concat(r.currentTeamId,"/insights/trend/?").concat(Object(C.Fb)(Object(Kt.a)(m))));case 4:x=R.sent,h=(c=x.result)===null||c===void 0||(v=c[0])===null||v===void 0?void 0:v.data,p=h.slice(0,7),V=Math.round(Object(C.Eb)(p)/7),n.setInsightResultAtIndex(d,V);case 9:case"end":return R.stop()}},i)}));function l(i){return a.apply(this,arguments)}return l}(),loadAllInsightsForFlag:function(){var l;(l=r.featureFlag.rollback_conditions)===null||l===void 0||l.forEach(function(i,u){i.threshold_metric&&n.loadInsightAtIndex(u,i.threshold_metric)})},addRollbackCondition:function(){var l=r.featureFlag.rollback_conditions.length-1;n.loadInsightAtIndex(l,r.featureFlag.rollback_conditions[l].threshold_metric)}}}),Object(f.selectors)({props:[function(){return[function(s,n){return n}]},function(s){return s}],multivariateEnabled:[function(s){return[s.featureFlag]},function(s){return!!(s!=null&&s.filters.multivariate)}],variants:[function(s){return[s.featureFlag]},function(s){var n;return(s==null||(n=s.filters.multivariate)===null||n===void 0?void 0:n.variants)||[]}],nonEmptyVariants:[function(s){return[s.variants]},function(s){return s.filter(function(n){var r=n.key;return!!r})}],variantRolloutSum:[function(s){return[s.variants]},function(s){return s.reduce(function(n,r){var a=r.rollout_percentage;return n+a},0)}],areVariantRolloutsValid:[function(s){return[s.variants,s.variantRolloutSum]},function(s,n){return s.every(function(r){var a=r.rollout_percentage;return a>=0&&a<=100})&&n===100}],aggregationTargetName:[function(s){return[s.featureFlag,s.groupTypes,s.aggregationLabel]},function(s,n,r){return s&&s.filters.aggregation_group_type_index!=null&&n.length>0?r(s.filters.aggregation_group_type_index).plural:"users"}],taxonomicGroupTypes:[function(s){return[s.featureFlag,s.groupsTaxonomicTypes]},function(s,n){return s&&s.filters.aggregation_group_type_index!=null&&n.length>0?[n[s.filters.aggregation_group_type_index]]:[Te.a.PersonProperties,Te.a.Cohorts]}],breadcrumbs:[function(s){return[s.featureFlag]},function(s){return[{name:"Feature Flags",path:le.a.featureFlags()}].concat(H()(s?[{name:s.key||"Unnamed"}]:[]))}]}),Object(ie.urlToAction)(function(s){var n,r=s.actions,a=s.props;return We()({},le.a.featureFlag((n=a.id)!==null&&n!==void 0?n:"new"),function(l,i,u,d){var m=d.method;m==="PUSH"&&(a.id?r.loadFeatureFlag():r.resetFeatureFlag())})}),Object(f.afterMount)(function(s){var n,r=s.props,a=s.actions,l=(n=G.b.findMounted())===null||n===void 0?void 0:n.values.featureFlags.find(function(i){return i.id===r.id});l?(a.setFeatureFlag(l),a.loadRecentInsights(),a.loadAllInsightsForFlag()):r.id!=="new"&&a.loadFeatureFlag(),a.loadSentryErrorCount()})]),$=t("./frontend/src/lib/logic/featureFlagLogic.ts"),Ve=t("./node_modules/antd/es/card/index.js"),T=t("./frontend/src/lib/components/icons.tsx"),Le=t("./frontend/src/lib/components/LemonDivider/index.ts"),ge=t("./frontend/src/lib/components/CodeSnippet/index.tsx"),e=t("./node_modules/react/jsx-runtime.js"),he="?utm_medium=in-product&utm_campaign=feature-flag";function _t(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ge.a,{language:ge.b.JavaScript,wrap:!0,children:"const isMyFlagEnabledForUser = await client.isFeatureEnabled('".concat(n,`', 'user distinct id')

if (isMyFlagEnabledForUser) {
    // Do something differently for this user
}`)})})}function vt(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ge.a,{language:ge.b.JavaScript,wrap:!0,children:"if\xA0(posthog.isFeatureEnabled('".concat(n!=null?n:"",`')) {
    // run your activation code here
}`)})})}function Ot(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ge.a,{language:ge.b.PHP,wrap:!0,children:"if (PostHog::isFeatureEnabled('".concat(n,`', 'some distinct id')) {
    // do something here
}`)})})}function ht(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ge.a,{language:ge.b.Go,wrap:!0,children:`isFlagEnabledForUser, err := client.IsFeatureEnabled(
                    FeatureFlagPayload{
                        Key:        '`.concat(n,`',
                        DistinctId: "distinct-id",
                    })

if (isFlagEnabledForUser) {
  // Do something differently for this user
}`)})})}function bt(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ge.a,{language:ge.b.Ruby,wrap:!0,children:"is_my_flag_enabled = posthog.is_feature_enabled('".concat(n,`', 'user distinct id')

if is_my_flag_enabled
  # Do something differently for this user
end`)})})}function yt(s){var n=s.flagKey;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ge.a,{language:ge.b.Python,wrap:!0,children:'if\xA0posthog.feature_enabled("'.concat(n,`", "user_distinct_id"):
    runAwesomeFeature()
`)})})}function on(){var s=Object(f.useValues)(it.a),n=s.currentTeam;return Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(ge.a,{language:ge.b.Bash,wrap:!0,children:"curl ".concat(window.location.origin,`/decide/ \\
-X POST -H 'Content-Type: application/json' \\
-d '{
    "api_key": "`).concat(n?n.api_token:"[project_api_key]",`",
    "distinct_id": "[user distinct id]"
}'
                `)})})}try{_t.displayName="NodeJSSnippet",_t.__docgenInfo={description:"",displayName:"NodeJSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#NodeJSSnippet"]={docgenInfo:_t.__docgenInfo,name:"NodeJSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#NodeJSSnippet"})}catch(s){}try{vt.displayName="JSSnippet",vt.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:vt.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(s){}try{Ot.displayName="PHPSnippet",Ot.__docgenInfo={description:"",displayName:"PHPSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PHPSnippet"]={docgenInfo:Ot.__docgenInfo,name:"PHPSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PHPSnippet"})}catch(s){}try{ht.displayName="GolangSnippet",ht.__docgenInfo={description:"",displayName:"GolangSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#GolangSnippet"]={docgenInfo:ht.__docgenInfo,name:"GolangSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#GolangSnippet"})}catch(s){}try{bt.displayName="RubySnippet",bt.__docgenInfo={description:"",displayName:"RubySnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#RubySnippet"]={docgenInfo:bt.__docgenInfo,name:"RubySnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#RubySnippet"})}catch(s){}try{yt.displayName="PythonSnippet",yt.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:yt.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(s){}var ln=t("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Vt=t.n(ln),cn=t("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlagInstructions.scss"),wt=t.n(cn),Bt={};Bt.insert="head",Bt.singleton=!1;var Hn=Vt()(wt.a,Bt),Gn=wt.a.locals||{},Je="https://posthog.com/docs/",nt="#feature-flags",Ut=[{value:"JavaScript",documentationLink:"".concat(Je,"integrations/js-integration").concat(he).concat(nt),Icon:T.IconJavascript,Snippet:vt},{value:"Node.js",documentationLink:"".concat(Je,"integrations/node-integration").concat(he).concat(nt),Icon:T.IconNodeJS,Snippet:_t},{value:"PHP",documentationLink:"".concat(Je,"integrations/php-integration").concat(he).concat(nt),Icon:T.IconPHP,Snippet:Ot},{value:"Ruby",documentationLink:"".concat(Je,"integrations/ruby-integration").concat(he).concat(nt),Icon:T.IconRuby,Snippet:bt},{value:"Golang",documentationLink:"".concat(Je,"integrations/go-integration").concat(he).concat(nt),Icon:T.IconGolang,Snippet:ht},{value:"Python",documentationLink:"".concat(Je,"integrations/python-integration").concat(he).concat(nt),Icon:T.IconPython,Snippet:yt},{value:"API",documentationLink:"".concat(Je,"api/feature-flags").concat(he),Icon:T.IconOpenInNew,Snippet:on}];function dn(s){var n=s.selectedOptionValue,r=s.selectOption;return Object(e.jsxs)(y.a,{className:"FeatureFlagInstructionsHeader",justify:"space-between",align:"middle",children:[Object(e.jsxs)("div",{className:"FeatureFlagInstructionsHeader__header-title",children:[Object(e.jsx)(T.IconFlag,{className:"FeatureFlagInstructionsHeader__header-title__icon"}),Object(e.jsx)("b",{children:"Learn how to use feature flags in your code"})]}),Object(e.jsx)(F.a,{"data-attr":"feature-flag-instructions-select",value:n,style:{width:140},onChange:r,children:Ut.map(function(a,l){var i=a.value,u=a.Icon;return Object(e.jsx)(F.a.Option,{"data-attr":"feature-flag-instructions-select-option-"+i,value:i,children:Object(e.jsxs)("div",{className:"FeatureFlagInstructionsHeader__option",children:[Object(e.jsx)("div",{className:"FeatureFlagInstructionsHeader__option__icon",children:Object(e.jsx)(u,{})}),Object(e.jsx)("div",{children:i})]})},l)})})]})}function un(s){var n=s.documenrationLink;return Object(e.jsxs)("div",{className:"mt-4",children:["Need more information?"," ",Object(e.jsxs)("a",{"data-attr":"feature-flag-doc-link",target:"_blank",rel:"noopener",href:n,children:["Check the docs ",Object(e.jsx)(T.IconOpenInNew,{})]})]})}function dt(s){var n=s.featureFlagKey,r=Ut[0],a=Object(oe.useState)(r),l=L()(a,2),i=l[0],u=l[1],d=function(c){var v=Ut.find(function(x){return x.value===c});v&&u(v)};return Object(e.jsxs)(Ve.a,{size:"small",children:[Object(e.jsx)(dn,{selectedOptionValue:i.value,selectOption:d}),Object(e.jsx)(Le.a,{}),Object(e.jsx)("div",{className:"mt mb",children:Object(e.jsx)(i.Snippet,{"data-attr":"feature-flag-instructions-snippet",flagKey:n})}),Object(e.jsx)(Le.a,{}),Object(e.jsx)(un,{documenrationLink:i.documentationLink})]})}try{dt.displayName="FeatureFlagInstructions",dt.__docgenInfo={description:"",displayName:"FeatureFlagInstructions",props:{featureFlagKey:{defaultValue:null,description:"",name:"featureFlagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagInstructions.tsx#FeatureFlagInstructions"]={docgenInfo:dt.__docgenInfo,name:"FeatureFlagInstructions",path:"frontend/src/scenes/feature-flags/FeatureFlagInstructions.tsx#FeatureFlagInstructions"})}catch(s){}var $t=t("./frontend/src/lib/components/PageHeader.tsx"),mn=t("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss"),Ht=t.n(mn),Nt={};Nt.insert="head",Nt.singleton=!1;var Yn=Vt()(Ht.a,Nt),zn=Ht.a.locals||{},fn=t("./frontend/src/lib/components/Tooltip.tsx"),gn=t("./node_modules/rc-select/es/index.js"),Et=t("./frontend/src/lib/components/Link.tsx"),xt=t("./frontend/src/lib/introductions/groupsAccessLogic.ts");function Rt(s){var n=s.value,r=Object(f.useValues)(xt.b),a=r.groupsAccessStatus;return[xt.a.HasAccess,xt.a.HasGroupTypes,xt.a.NoAccess].includes(a)?Object(e.jsxs)(gn.c.Option,{value:n,disabled:!0,style:{height:"100%",width:"100%",overflow:"hidden",textOverflow:"ellipsis",backgroundColor:"var(--side)",color:"var(--muted)"},children:[Object(e.jsx)(Ee.a,{style:{marginRight:6,color:"var(--warning)"}}),"Unique groups \u2013"," ",Object(e.jsx)(Et.a,{to:"https://posthog.com/docs/user-guides/group-analytics?utm_medium=in-product&utm_campaign=group-analytics-learn-more",target:"_blank","data-attr":"group-analytics-learn-more",className:"font-semibold",children:"Learn more"})]},"groups"):null}try{Rt.displayName="GroupsIntroductionOption",Rt.__docgenInfo={description:"",displayName:"GroupsIntroductionOption",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/introductions/GroupsIntroductionOption.tsx#GroupsIntroductionOption"]={docgenInfo:Rt.__docgenInfo,name:"GroupsIntroductionOption",path:"frontend/src/lib/introductions/GroupsIntroductionOption.tsx#GroupsIntroductionOption"})}catch(s){}var Gt=t("./frontend/src/scenes/userLogic.ts"),je=t("./frontend/src/lib/components/LemonButton/index.ts"),Ie=t("./frontend/src/lib/forms/Field.tsx"),jn=t("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx"),Wt=t("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),Yt=t("./frontend/src/lib/components/LemonCheckbox/index.ts"),pn=t("./frontend/src/scenes/events/EventBufferNotice.tsx"),zt=t("./frontend/src/lib/components/AlertMessage/index.ts"),Pt=t("./frontend/src/lib/components/Spinner/Spinner.tsx"),Jt=t("./frontend/src/lib/components/CopyToClipboard.tsx"),Ft=t("./frontend/src/lib/components/Lettermark/Lettermark.tsx"),$e=t("./frontend/src/lib/constants.tsx"),Xt=t("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),_n=t("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),vn=t("./frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),On=t("./frontend/src/lib/components/DefinitionPopup/utils.ts"),Qt=t("./frontend/src/lib/components/CompactList/CompactList.tsx"),hn=t("./frontend/src/scenes/project-homepage/RecentInsights.tsx");function bn(){var s=Object(f.useValues)(E),n=s.recentInsights,r=s.recentInsightsLoading,a=s.featureFlag;return Object(e.jsx)(Qt.a,{title:"Insights that use this feature flag",loading:r,emptyMessage:{title:"You have no insights that use this feature flag",description:"Explore this feature flag's insights by creating one below.",buttonText:"Create insight",buttonTo:le.a.insightNew({events:[{id:"$pageview",name:"$pageview",type:"events",math:"dau"}],breakdown_type:"event",breakdown:"$feature/".concat(a.key)})},items:n.slice(0,5),renderRow:function(i,u){return Object(e.jsx)(hn.a,{insight:i},u)}})}var yn=t("./frontend/src/lib/components/NotFound/index.tsx"),En=t("./frontend/src/models/cohortsModel.ts"),de=t("./frontend/@posthog/lemon-ui/src/index.ts"),xn=t("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),Rn=t("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx");function Zt(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(s,l).enumerable})),r.push.apply(r,a)}return r}function Pn(s){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zt(Object(r),!0).forEach(function(a){We()(s,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):Zt(Object(r)).forEach(function(a){Object.defineProperty(s,a,Object.getOwnPropertyDescriptor(r,a))})}return s}function ut(s){var n=s.readOnly,r=Object(f.useValues)(E),a=r.featureFlag,l=r.sentryIntegrationEnabled,i=r.sentryErrorCount,u=r.insightRollingAverages,d=Object(f.useActions)(E),m=d.addRollbackCondition,c=d.removeRollbackCondition,v=d.loadInsightAtIndex,x=Object(f.useValues)(Gt.a),h=x.user;return Object(e.jsxs)("div",{children:[Object(e.jsxs)("div",{className:"mb-2",children:[Object(e.jsx)("b",{children:"Auto rollback"}),Object(e.jsx)(de.LemonTag,{type:"warning",className:"uppercase ml-2",children:"Beta"}),!n&&Object(e.jsx)("div",{className:"mt-2",children:"Specify the conditions in which this feature flag will automatically roll back."})]}),n&&a.rollback_conditions&&a.rollback_conditions.map(function(p,V){var w,R,B;return Object(e.jsxs)(e.Fragment,{children:[V>0&&Object(e.jsx)("div",{className:"condition-set-separator",children:"OR"}),p.threshold_type==="insight"&&(w=p.threshold_metric)!==null&&w!==void 0&&(R=w.events)!==null&&R!==void 0&&(B=R[0])!==null&&B!==void 0&&B.name?Object(e.jsxs)("div",{className:"mb-4 border rounded p-4",children:[Object(e.jsx)("b",{children:"".concat(Object(C.i)(p.threshold_type)," based rollback")}),Object(e.jsx)(de.LemonDivider,{className:"my-3"}),Object(e.jsxs)(y.a,{align:"middle",children:[u[V]&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("b",{children:p.threshold_metric.events[0].name}),"\xA0 trailing average is ",u[V],"."]}),"\xA0Trigger when trailing average of \xA0",Object(e.jsx)("b",{children:p.threshold_metric.events[0].name}),"\xA0 is\xA0",p.operator&&C.I[p.operator]," ",p.threshold]})]}):Object(e.jsxs)("div",{className:"mb-4 border rounded p-4",children:[Object(e.jsx)("b",{children:"".concat(Object(C.i)(p.threshold_type)," based rollback")}),Object(e.jsx)(de.LemonDivider,{className:"my-3"}),Object(e.jsxs)(y.a,{align:"middle",children:["Trigger when there is a\xA0",Object(e.jsxs)("b",{children:[p.threshold,"%"]}),"\xA0increase in errors"]})]})]})}),!n&&a.rollback_conditions&&a.rollback_conditions.map(function(p,V){return Object(e.jsxs)(e.Fragment,{children:[V>0&&Object(e.jsx)("div",{className:"condition-set-separator",children:"OR"}),Object(e.jsx)("div",{className:"mb-4 border rounded p-4",children:Object(e.jsxs)(ye.Group,{name:["rollback_conditions",V],children:[Object(e.jsxs)(y.a,{align:"middle",justify:"space-between",children:[Object(e.jsxs)(y.a,{children:[Object(e.jsx)("div",{className:"mt-3 mr-3",children:Object(e.jsx)("b",{children:"Rollback Condition Type"})}),Object(e.jsx)(Ie.a,{name:"threshold_type",children:function(R){var B=R.value,ue=R.onChange;return Object(e.jsx)(de.LemonSelect,{value:B,onChange:ue,options:[{value:S.V.Sentry,label:"Error Based"},{value:S.V.Insight,label:"Metric Based"}]})}})]}),Object(e.jsx)(de.LemonButton,{icon:Object(e.jsx)(T.IconDelete,{}),status:"muted",noPadding:!0,onClick:function(){c(V)}})]}),Object(e.jsx)(de.LemonDivider,{className:"my-3"}),a.rollback_conditions[V].threshold_type=="insight"?Object(e.jsxs)("div",{className:"flex gap-2 items-center mt-4",children:[Object(e.jsx)(Ie.a,{name:"threshold_metric",children:function(R){var B=R.value,ue=R.onChange;return Object(e.jsx)(xn.a,{filters:B,setFilters:function(Ne){ue(Pn({},Ne)),v(V,Ne)},typeKey:"feature-flag-rollback-trends-"+V,buttonCopy:"Add graph series",showSeriesIndicator:!1,showNestedArrow:!0,hideRename:!0,entitiesLimit:1,mathAvailability:Rn.b.None,propertiesTaxonomicGroupTypes:[Te.a.EventProperties,Te.a.PersonProperties,Te.a.EventFeatureFlags,Te.a.Cohorts,Te.a.Elements]})}}),Object(e.jsxs)("span",{children:["trailing 7 day average is\xA0",u[V]!==void 0?Object(e.jsx)("b",{children:u[V]}):Object(e.jsx)(Pt.a,{}),". Trigger when trailing average is"]}),Object(e.jsx)(Ie.a,{name:"operator",children:function(R){var B=R.value,ue=R.onChange;return Object(e.jsx)(de.LemonSelect,{value:B,onChange:ue,options:[{label:"greater than",value:"gt"},{label:"less than",value:"lt"}]})}}),Object(e.jsx)(Ie.a,{name:"threshold",children:Object(e.jsx)(de.LemonInput,{min:0,type:"number"})})]}):l?Object(e.jsx)("div",{children:Object(e.jsxs)(y.a,{align:"middle",children:[i?Object(e.jsxs)("span",{children:[Object(e.jsxs)("b",{children:[Object(C.P)(i)," "]})," sentry errors in the past 24 hours."," "]}):Object(e.jsx)(Pt.a,{}),Object(e.jsx)("span",{children:"\xA0Trigger when there is a"}),Object(e.jsx)(Ie.a,{name:"threshold",className:"ml-3 mr-3",children:function(R){var B=R.value,ue=R.onChange;return Object(e.jsx)(de.LemonInput,{value:B,suffix:Object(e.jsx)(e.Fragment,{children:"%"}),type:"number",min:0,onChange:ue})}}),Object(e.jsx)(Ie.a,{name:"operator",className:"mr-3",children:function(R){var B=R.value,ue=R.onChange;return Object(e.jsx)(de.LemonSelect,{options:[{label:"increase",value:"gt"},{label:"decrease",value:"lt"}],value:B,onChange:ue})}}),Object(e.jsxs)("span",{children:["to"," ",i?Object(e.jsx)("b",{children:Object(C.P)(Math.round(i*(1+(a.rollback_conditions[V].threshold||0)/100)))}):Object(e.jsx)(Pt.a,{})," ","errors."]}),Object(e.jsx)("div",{})]})}):h!=null&&h.is_staff?Object(e.jsxs)("div",{className:"mt-4",children:[Object(e.jsx)("b",{children:"This feature requires an active Sentry integration."}),Object(e.jsx)("br",{}),Object(e.jsx)(de.Link,{to:le.a.instanceSettings(),children:"Go to Instance Settings"})," and update the"," ",Object(e.jsx)("code",{children:'"SENTRY_"'})," properties from your Sentry account to enable."]}):Object(e.jsx)("p",{className:"text-muted",children:"This PostHog instance is not configured for Sentry. Please contact the instance owner to configure it."})]})})]})}),!n&&Object(e.jsx)(de.LemonButton,{type:"secondary",onClick:function(){m()},children:"Add condition"})]})}try{ut.displayName="FeatureFlagAutoRollback",ut.__docgenInfo={description:"",displayName:"FeatureFlagAutoRollback",props:{readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagAutoRollout.tsx#FeatureFlagAutoRollback"]={docgenInfo:ut.__docgenInfo,name:"FeatureFlagAutoRollback",path:"frontend/src/scenes/feature-flags/FeatureFlagAutoRollout.tsx#FeatureFlagAutoRollback"})}catch(s){}var Fn=t("./frontend/src/scenes/project-homepage/RecentRecordings.tsx"),In=t("./frontend/src/scenes/session-recordings/player/modal/SessionPlayerModal.tsx"),An=t("./frontend/src/scenes/session-recordings/playlist/sessionRecordingsListLogic.ts"),It=function(n){return{events:K(n).events}};function At(s){var n=s.flagKey,r=Object(f.useValues)(it.a),a=r.currentTeam,l=Object(An.d)({key:"feature-flag-".concat(n),filters:It(n)}),i=Object(f.useValues)(l),u=i.sessionRecordings,d=i.sessionRecordingsResponseLoading,m=i.filters;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(In.a,{}),Object(e.jsx)(Qt.a,{title:"Recordings with current feature flag",viewAllURL:le.a.sessionRecordings(void 0,m),loading:d,emptyMessage:a!=null&&a.session_recording_opt_in?{title:"There are no recordings for this project",description:"Make sure you have the javascript snippet setup in your website.",buttonText:"Learn more",buttonTo:"https://posthog.com/docs/user-guides/recordings"}:{title:"Recordings are not enabled for this project",description:"Once recordings are enabled, new recordings will display here.",buttonText:"Enable recordings",buttonTo:le.a.projectSettings()+"#recordings"},items:u.slice(0,5),renderRow:function(v,x){return Object(e.jsx)(Fn.b,{recording:v},x)}})]})}try{At.displayName="FeatureFlagRecordings",At.__docgenInfo={description:"",displayName:"FeatureFlagRecordings",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#FeatureFlagRecordings"]={docgenInfo:At.__docgenInfo,name:"FeatureFlagRecordings",path:"frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#FeatureFlagRecordings"})}catch(s){}try{It.displayName="filtersForFlag",It.__docgenInfo={description:"",displayName:"filtersForFlag",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#filtersForFlag"]={docgenInfo:It.__docgenInfo,name:"filtersForFlag",path:"frontend/src/scenes/feature-flags/FeatureFlagRecordingsCard.tsx#filtersForFlag"})}catch(s){}var Cn=t("./frontend/src/scenes/billing/billingLogic.ts"),Mn=t("./frontend/src/scenes/events/index.ts"),Tn=t("./frontend/src/lib/components/PropertyFilters/utils.ts"),Jn=t("./node_modules/core-js/modules/es.promise.js"),Xn=t("./node_modules/core-js/modules/es.string.iterator.js"),Qn=t("./node_modules/core-js/modules/es.array.from.js"),Zn=t("./node_modules/core-js/modules/es.symbol.description.js"),kn=t("./node_modules/core-js/modules/es.symbol.iterator.js");function Ln(s,n){var r=typeof Symbol!="undefined"&&s[Symbol.iterator]||s["@@iterator"];if(!r){if(Array.isArray(s)||(r=Sn(s))||n&&s&&typeof s.length=="number"){r&&(s=r);var a=0,l=function(){};return{s:l,n:function(){return a>=s.length?{done:!0}:{done:!1,value:s[a++]}},e:function(c){throw c},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,u=!1,d;return{s:function(){r=r.call(s)},n:function(){var c=r.next();return i=c.done,c},e:function(c){u=!0,d=c},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(u)throw d}}}}function Sn(s,n){if(!!s){if(typeof s=="string")return kt(s,n);var r=Object.prototype.toString.call(s).slice(8,-1);if(r==="Object"&&s.constructor&&(r=s.constructor.name),r==="Map"||r==="Set")return Array.from(s);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kt(s,n)}}function kt(s,n){(n==null||n>s.length)&&(n=s.length);for(var r=0,a=new Array(n);r<n;r++)a[r]=s[r];return a}var qt=Object(f.kea)([Object(f.path)(["scenes","feature-flags","featureFlagPermissionsLogic"]),Object(f.props)({}),Object(f.key)(function(s){return"".concat(s.flagId)}),Object(f.actions)({setModalOpen:function(n){return{visible:n}},setRolesToAdd:function(n){return{roleIds:n}}}),Object(f.reducers)({permissionModalVisible:[!1,{setModalOpen:function(n,r){var a=r.visible;return a}}],rolesToAdd:[[],{setRolesToAdd:function(n,r){var a=r.roleIds;return a}}]}),Object(lt.loaders)(function(s){var n=s.props,r=s.values,a=s.actions;return{unfilteredAddableRoles:[[],{loadPossibleRolesToAdd:function(){var l=ne()(M.a.mark(function u(){var d;return M.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Oe.b.roles.list({feature_flags_access_level:S.a.READ});case 2:return d=c.sent,c.abrupt("return",d.results||[]);case 4:case"end":return c.stop()}},u)}));function i(){return l.apply(this,arguments)}return i}()}],associatedRoles:[[],{loadAssociatedRoles:function(){var l=ne()(M.a.mark(function u(){var d;return M.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!n.flagId){c.next=7;break}return c.next=3,Oe.b.resourceAccessPermissions.featureFlags.list(n.flagId);case 3:return d=c.sent,c.abrupt("return",d.results||[]);case 7:return c.abrupt("return",[]);case 8:case"end":return c.stop()}},u)}));function i(){return l.apply(this,arguments)}return i}(),addAssociatedRoles:function(){var l=ne()(M.a.mark(function u(d){var m,c,v;return M.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(m=r.rolesToAdd,c=n.flagId||d,!c){h.next=8;break}return h.next=5,Promise.all(m.map(function(){var p=ne()(M.a.mark(function V(w){return M.a.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,Oe.b.resourceAccessPermissions.featureFlags.create(c,w);case 2:return B.abrupt("return",B.sent);case 3:case"end":return B.stop()}},V)}));return function(V){return p.apply(this,arguments)}}()));case 5:return v=h.sent,a.setRolesToAdd([]),h.abrupt("return",[].concat(H()(r.associatedRoles),H()(v)));case 8:return h.abrupt("return",r.associatedRoles);case 9:case"end":return h.stop()}},u)}));function i(u){return l.apply(this,arguments)}return i}(),deleteAssociatedRole:function(){var l=ne()(M.a.mark(function u(d){var m,c,v;return M.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(c=d.roleId,v=(m=r.associatedRoles.find(function(p){return p.role.id===c}))===null||m===void 0?void 0:m.id,!n.flagId){h.next=7;break}if(h.t0=v,!h.t0){h.next=7;break}return h.next=7,Oe.b.resourceAccessPermissions.featureFlags.delete(n.flagId,v);case 7:return h.abrupt("return",r.associatedRoles.filter(function(p){return p.id!==v}));case 8:case"end":return h.stop()}},u)}));function i(u){return l.apply(this,arguments)}return i}()}]}}),Object(f.selectors)({derivedRoles:[function(s){return[s.associatedRoles]},function(s){return s.map(function(n){return n.role})}],addableRoles:[function(s){return[s.unfilteredAddableRoles,s.associatedRoles]},function(s,n){var r=[],a=Ln(s),l;try{var i=function(){var d=l.value;n.some(function(m){return m.role.id===d.id})||r.push(d)};for(a.s();!(l=a.n()).done;)i()}catch(u){a.e(u)}finally{a.f()}return r}]}),Object(f.afterMount)(function(s){var n=s.actions;n.loadPossibleRolesToAdd(),n.loadAssociatedRoles()})]),Dn=t("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),en=t("./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx"),Kn=t("./frontend/src/scenes/organization/Settings/Roles/rolesLogic.tsx"),Bn=t("./frontend/src/scenes/organizationLogic.tsx");function Ct(s){return s.map(function(n){return{key:n.id,label:"".concat(n.name),labelComponent:Object(e.jsx)("span",{children:Object(e.jsx)("b",{children:"".concat(n.name)})})}})}function Mt(s){var n=s.title,r=s.visible,a=s.onClose,l=s.rolesToAdd,i=s.addableRoles,u=s.onChange,d=s.addableRolesLoading,m=s.onAdd,c=s.roles,v=s.deleteAssociatedRole,x=s.isNewResource,h=s.resourceType,p=Object(f.useValues)(en.b),V=p.allPermissions,w=Object(f.useValues)(Kn.a),R=w.roles,B=Object(f.useValues)(Bn.a),ue=B.isAdminOrOwner,Be=V.find(function(me){return me.resource===h}),Ne=R.filter(function(me){return me.feature_flags_access_level===S.a.WRITE});return Object(e.jsxs)(de.LemonModal,{title:n,isOpen:r,onClose:a,children:[Be&&Object(e.jsx)(Un,{resourceLevel:Be}),Object(e.jsx)(Nn,{roles:Ne}),ue&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(de.LemonDivider,{className:"mt-4"}),Object(e.jsx)("h5",{className:"mt-4",children:"Custom edit roles"}),Object(e.jsxs)("div",{className:"flex gap-2",children:[Object(e.jsx)("div",{className:"flex-1",children:Object(e.jsx)(Dn.a,{placeholder:"Search for roles to add\u2026",loading:d,onChange:u,value:l,filterOption:!0,mode:"multiple","data-attr":"resource-permissioning-select",options:Ct(i)})}),!x&&Object(e.jsx)(de.LemonButton,{type:"primary",loading:!1,disabled:l.length===0,onClick:m,children:"Add"})]})]}),!x&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{className:"mt-4",children:"Roles"}),c.length>0?Object(e.jsx)("div",{className:"pb-2 rounded overflow-y-auto",style:{maxHeight:300},children:c.map(function(me){return Object(e.jsx)(Wn,{role:me,deleteRole:function(Qe){return v(Qe)}},me.id)})}):Object(e.jsx)("div",{className:"text-muted mb-2",children:"No roles added yet"})]})]})}function Un(s){var n=s.resourceLevel;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{children:"Organization Default"}),Object(e.jsx)("b",{children:en.a[n.access_level]})]})}function Nn(s){var n=s.roles;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{className:"mt-4",children:"Roles with edit access"}),Object(e.jsx)(y.a,{children:n.map(function(r){return Object(e.jsxs)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:[Object(e.jsx)("b",{children:r.name})," "]},r.id)})})]})}function Wn(s){var n=s.role,r=s.deleteRole;return Object(e.jsxs)("div",{className:"flex items-center justify-between h-8",children:[Object(e.jsx)("b",{children:n.name}),r&&Object(e.jsx)(de.LemonButton,{icon:Object(e.jsx)(T.IconDelete,{}),onClick:function(){return r(n.id)},tooltip:"Remove role from permission",status:"primary-alt",type:"tertiary",size:"small"})]})}try{Ct.displayName="roleLemonSelectOptions",Ct.__docgenInfo={description:"",displayName:"roleLemonSelectOptions",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/ResourcePermissionModal.tsx#roleLemonSelectOptions"]={docgenInfo:Ct.__docgenInfo,name:"roleLemonSelectOptions",path:"frontend/src/scenes/ResourcePermissionModal.tsx#roleLemonSelectOptions"})}catch(s){}try{Mt.displayName="ResourcePermissionModal",Mt.__docgenInfo={description:"",displayName:"ResourcePermissionModal",props:{title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},visible:{defaultValue:null,description:"",name:"visible",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},addableRoles:{defaultValue:null,description:"",name:"addableRoles",required:!0,type:{name:"RoleType[]"}},addableRolesLoading:{defaultValue:null,description:"",name:"addableRolesLoading",required:!0,type:{name:"boolean"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: string[]) => void"}},rolesToAdd:{defaultValue:null,description:"",name:"rolesToAdd",required:!0,type:{name:"string[]"}},onAdd:{defaultValue:null,description:"",name:"onAdd",required:!0,type:{name:"() => void"}},roles:{defaultValue:null,description:"",name:"roles",required:!0,type:{name:"RoleType[]"}},deleteAssociatedRole:{defaultValue:null,description:"",name:"deleteAssociatedRole",required:!0,type:{name:"(id: string) => void"}},isNewResource:{defaultValue:null,description:"",name:"isNewResource",required:!0,type:{name:"boolean"}},resourceType:{defaultValue:null,description:"",name:"resourceType",required:!0,type:{name:"Resource"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermissionModal"]={docgenInfo:Mt.__docgenInfo,name:"ResourcePermissionModal",path:"frontend/src/scenes/ResourcePermissionModal.tsx#ResourcePermissionModal"})}catch(s){}var Vn=t("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),wn={component:mt,logic:E,paramsToProps:function(n){var r=n.params.id;return{id:r&&r!=="new"?parseInt(r):"new"}}};function tn(s){setTimeout(function(){var n;return(n=document.querySelector('.variant-form-list input[data-key-index="'.concat(s,'"]')))===null||n===void 0?void 0:n.focus()},50)}function mt(){var s,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.id,a=Object(f.useValues)(E),l=a.props,i=a.featureFlag,u=a.featureFlagLoading,d=a.featureFlagMissing,m=a.isEditingFlag,c=Object(f.useValues)($.a),v=c.featureFlags,x=Object(f.useActions)(E),h=x.deleteFeatureFlag,p=x.editFeatureFlag,V=x.loadFeatureFlag,w=Object(f.useValues)(qt({flagId:i.id})),R=w.permissionModalVisible,B=w.addableRoles,ue=w.unfilteredAddableRolesLoading,Be=w.rolesToAdd,Ne=w.derivedRoles,me=Object(f.useActions)(qt({flagId:i.id})),Xe=me.setModalOpen,Qe=me.setRolesToAdd,Se=me.addAssociatedRoles,b=me.deleteAssociatedRole,q=Object(oe.useState)(!1),xe=L()(q,2),Ze=xe[0],ke=xe[1],st=Object(oe.useState)(G.a.OVERVIEW),X=L()(st,2),De=X[0],rt=X[1],Tt=r==="new"||r===void 0;return d?Object(e.jsx)(yn.a,{object:"feature flag"}):u?Object(e.jsx)(Pt.b,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("div",{className:"feature-flag",children:Tt||m?Object(e.jsxs)(ye.Form,{logic:E,props:l,formKey:"featureFlag",enableFormOnSubmit:!0,className:"space-y-4",children:[Object(e.jsx)($t.a,{title:Tt?"New feature flag":i.key||"Untitled",buttons:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)(je.a,{"data-attr":"cancel-feature-flag",type:"secondary",onClick:function(){m?(p(!1),V()):ie.router.actions.push(le.a.featureFlags())},disabled:u,children:"Cancel"}),Object(e.jsx)(je.a,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:u,disabled:u,children:"Save"})]})}),Object(e.jsx)(ve.a,{}),i.experiment_set&&((s=i.experiment_set)===null||s===void 0?void 0:s.length)>0&&Object(e.jsxs)(zt.a,{type:"warning",children:["This feature flag is linked to an experiment. It's recommended to only make changes to this flag"," ",Object(e.jsx)(Et.a,{to:le.a.experiment(i.experiment_set[0]),children:"using the experiment creation screen."})]}),Object(e.jsx)(pn.a,{additionalInfo:", meaning it can take around 60 seconds for some flags to update for recently-identified persons. To sidestep this, you can choose to override server properties when requesting the feature flag"}),Object(e.jsxs)(y.a,{gutter:16,style:{marginBottom:32},children:[Object(e.jsxs)(U.a,{span:12,className:"space-y-4",children:[Object(e.jsx)(Ie.a,{name:"key",label:"Key",help:Ze&&r!=="new"?Object(e.jsxs)("span",{className:"text-warning",children:[Object(e.jsx)("b",{children:"Warning! "}),"Changing this key will",Object(e.jsxs)("a",{href:"https://posthog.com/docs/features/feature-flags".concat(he,"#feature-flag-persistence"),target:"_blank",rel:"noopener",children:[" ","affect the persistence of your flag ",Object(e.jsx)(T.IconOpenInNew,{})]})]}):void 0,children:function(Re){var He=Re.value,ft=Re.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Wt.a,{value:He,onChange:function(an){an!==He&&ke(!0),ft(an)},"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}),Object(e.jsx)("span",{style:{fontSize:13},className:"text-muted",children:"Feature flag keys must be unique"})]})}}),Object(e.jsx)(Ie.a,{name:"name",label:"Description",children:Object(e.jsx)(jn.a,{className:"ph-ignore-input","data-attr":"feature-flag-description",defaultValue:i.name||""})}),Object(e.jsx)(Ie.a,{name:"ensure_experience_continuity",children:function(Re){var He=Re.value,ft=Re.onChange;return Object(e.jsxs)("div",{className:"border rounded p-4",children:[Object(e.jsx)(Yt.a,{id:"continuity-checkbox",label:"Persist flag across authentication steps",onChange:function(){return ft(!He)},fullWidth:!0,checked:He}),Object(e.jsxs)("div",{className:"text-muted text-sm pl-7",children:["If your feature flag is applied prior to an identify or authentication event, use this to ensure that feature flags are not reset after a person is identified. This ensures the experience for the anonymous person is carried forward to the authenticated person."," ",Object(e.jsxs)(Et.a,{to:"https://posthog.com/manual/feature-flags#persisting-feature-flags-across-authentication-steps",target:"_blank",children:["Learn more ",Object(e.jsx)(T.IconOpenInNew,{})]})]})]})}}),Object(e.jsx)(Ie.a,{name:"active",children:function(Re){var He=Re.value,ft=Re.onChange;return Object(e.jsx)("div",{className:"border rounded p-4",children:Object(e.jsx)(Yt.a,{id:"flag-enabled-checkbox",label:"Enable feature flag",onChange:function(){return ft(!He)},checked:He})})}})]}),Object(e.jsx)(U.a,{span:12,children:Object(e.jsx)(dt,{featureFlagKey:i.key||"my-flag"})})]}),Object(e.jsx)(ve.a,{}),Object(e.jsx)(nn,{}),Object(e.jsx)(ve.a,{}),Object(e.jsx)(sn,{}),Object(e.jsx)(ve.a,{}),v[$e.i.AUTO_ROLLBACK_FEATURE_FLAGS]&&Object(e.jsx)(ut,{}),Object(e.jsx)(Le.a,{className:"mt-8"}),Object(e.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[Object(e.jsx)(je.a,{"data-attr":"cancel-feature-flag",type:"secondary",onClick:function(){m?(p(!1),V()):ie.router.actions.push(le.a.featureFlags())},disabled:u,children:"Cancel"}),Object(e.jsx)(je.a,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:u,disabled:u,children:"Save"})]})]}):Object(e.jsx)(e.Fragment,{children:u?Object(e.jsx)(N.a,{active:!0}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)($t.a,{title:Object(e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[i.key||"Untitled",Object(e.jsx)(Jt.a,{explicitValue:i.key,iconStyle:{color:"var(--muted-alt)"}}),Object(e.jsx)("div",{className:"flex",children:i.active?Object(e.jsx)(Xt.a,{type:"success",className:"uppercase",children:"Enabled"}):Object(e.jsx)(Xt.a,{type:"default",className:"uppercase",children:"Disabled"})})]}),description:Object(e.jsx)(e.Fragment,{children:i.name?Object(e.jsx)("span",{style:{fontStyle:"normal"},children:i.name}):"There is no description for this feature flag."}),buttons:Object(e.jsx)(e.Fragment,{children:Object(e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[Object(e.jsx)(je.a,{"data-attr":"delete-feature-flag",status:"danger",type:"secondary",onClick:function(){h(i)},disabled:u||!i.can_edit,children:"Delete feature flag"}),Object(e.jsx)(je.a,{"data-attr":"edit-feature-flag",type:"secondary",tooltip:v[$e.i.ROLE_BASED_ACCESS]&&!i.can_edit&&"You have only 'View' access for this feature flag. To make changes, please contact the flag's creator.",onClick:function(){p(!0)},disabled:u||!i.can_edit,children:"Edit"})]})})}),Object(e.jsxs)(Fe.a,{activeKey:De,destroyInactiveTabPane:!0,onChange:function(Re){return rt(Re)},children:[Object(e.jsx)(Fe.a.TabPane,{tab:"Overview",children:Object(e.jsxs)(y.a,{children:[Object(e.jsxs)(U.a,{span:13,children:[Object(e.jsx)(nn,{readOnly:!0}),Object(e.jsx)(sn,{readOnly:!0}),v[$e.i.AUTO_ROLLBACK_FEATURE_FLAGS]&&Object(e.jsx)(ut,{readOnly:!0})]}),Object(e.jsxs)(U.a,{span:11,className:"pl-4",children:[Object(e.jsx)(bn,{}),Object(e.jsx)("div",{className:"my-4"}),v[$e.i.RECORDINGS_ON_FEATURE_FLAGS]?Object(e.jsx)(At,{flagKey:i.key||"my-flag"}):Object(e.jsx)(dt,{featureFlagKey:i.key||"my-flag"})]})]})},"overview"),v[$e.i.EXPOSURES_ON_FEATURE_FLAGS]&&i.key&&r&&Object(e.jsx)(Fe.a.TabPane,{tab:"Exposures",children:Object(e.jsx)($n,{id:r,featureFlagKey:i.key})},"exposure"),i.id&&Object(e.jsx)(Fe.a.TabPane,{tab:"History",children:Object(e.jsx)(_n.a,{scope:vn.a.FEATURE_FLAG,id:i.id})},"history"),v[$e.i.ROLE_BASED_ACCESS]&&Object(e.jsx)(Fe.a.TabPane,{tab:"Permissions",children:Object(e.jsx)(Vn.a,{feature:S.e.ROLE_BASED_ACCESS,children:i.can_edit&&Object(e.jsx)(je.a,{type:"secondary",onClick:function(){return Xe(!0)},className:"mb-4",children:"Set permissions"})})},"permissions")]})]})})}),Object(e.jsx)(Mt,{resourceType:S.U.FEATURE_FLAGS,isNewResource:r==="new",onChange:function(Re){return Qe(Re)},rolesToAdd:Be,addableRoles:B,addableRolesLoading:ue,onClose:function(){return Xe(!1)},title:"Feature Flag Permissions",onAdd:function(){return Se()},visible:R,roles:Ne,deleteAssociatedRole:function(Re){return b({roleId:Re})}})]})}function $n(s){var n=s.id,r=s.featureFlagKey;return Object(e.jsx)(Mn.b,{fixedFilters:{event_filter:"$feature_flag_called",properties:O(r)},sceneUrl:le.a.featureFlag(n),fetchMonths:3,pageKey:"feature-flag-".concat(r,"}"),showEventFilter:!1,showPropertyFilter:!1})}function nn(s){var n=s.readOnly,r=Object(f.useValues)(E),a=r.multivariateEnabled,l=r.variants,i=r.areVariantRolloutsValid,u=r.featureFlagLoading,d=r.variantRolloutSum,m=r.nonEmptyVariants,c=r.aggregationTargetName,v=r.featureFlag,x=Object(f.useActions)(E),h=x.distributeVariantsEqually,p=x.addVariant,V=x.removeVariant,w=x.setMultivariateEnabled,R=Object(oe.useState)(!1),B=L()(R,2),ue=B[0],Be=B[1],Ne=Object(f.useValues)(Gt.a),me=Ne.hasAvailableFeature,Xe=Object(f.useValues)(Cn.b),Qe=Xe.upgradeLink;return Object(e.jsxs)(e.Fragment,{children:[n?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex flex-col mb-4",children:[Object(e.jsx)("span",{className:"card-secondary",children:"Type"}),Object(e.jsx)("span",{children:v.filters.multivariate?"Multiple variants with rollout percentages (A/B/C test)":"Release toggle (boolean)"}),Object(e.jsx)("span",{className:"card-secondary mt-4",children:"Flag persistence"}),Object(e.jsxs)("span",{children:["This flag"," ",Object(e.jsxs)("b",{children:[v.ensure_experience_continuity?"persists":"does not persist"," "]}),"across authentication events."]})]}),Object(e.jsx)(Le.a,{className:"my-3"}),v.filters.multivariate&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("div",{className:"mb-2",children:Object(e.jsx)("b",{children:"Variant keys"})}),Object(e.jsxs)("div",{className:"border rounded p-4 mb-4",children:[Object(e.jsxs)(y.a,{className:"font-semibold",children:[Object(e.jsx)(U.a,{span:10,children:"Key"}),Object(e.jsx)(U.a,{span:11,children:"Description"}),Object(e.jsx)(U.a,{span:3,children:"Rollout"})]}),Object(e.jsx)(Le.a,{className:"my-3"}),l.map(function(Se,b){return Object(e.jsxs)("div",{children:[Object(e.jsxs)(y.a,{children:[Object(e.jsxs)(U.a,{span:10,children:[Object(e.jsx)(Ft.a,{name:C.c[b],color:Ft.b.Gray}),Object(e.jsx)(Jt.a,{tooltipMessage:null,description:"key",style:{marginLeft:"0.5rem"},iconStyle:{color:"var(--muted-alt)"},children:Se.key})]}),Object(e.jsx)(U.a,{span:12,children:Se.name||"There is no description for this variant key"}),Object(e.jsxs)(U.a,{span:2,children:[Se.rollout_percentage,"%"]})]}),b!==l.length-1&&Object(e.jsx)(Le.a,{className:"my-3"})]},b)})]})]})]}):Object(e.jsxs)("div",{className:"mb-8",children:[Object(e.jsx)("h3",{className:"l4",children:"Served value"}),Object(e.jsx)("div",{className:"mb-2",children:Object(e.jsx)(ce.a,{placement:"top",title:"Change value type? The variants below will be lost.",disabled:u,visible:ue,onConfirm:function(){w(!1),Be(!1)},onCancel:function(){return Be(!1)},okText:"OK",cancelText:"Cancel",children:Object(e.jsx)(P.a.Group,{options:[{label:"Release toggle (boolean)",value:!1},{label:Object(e.jsx)(fn.a,{title:me(S.e.MULTIVARIATE_FLAGS)?"":"This feature is not available on your current plan.",children:Object(e.jsxs)("div",{children:[!me(S.e.MULTIVARIATE_FLAGS)&&Object(e.jsx)(Et.a,{to:Qe,target:"_blank",children:Object(e.jsx)(Ee.a,{style:{marginRight:4,color:"var(--warning)"}})}),"Multiple variants with rollout percentages (A/B test)"]})}),value:!0,disabled:!me(S.e.MULTIVARIATE_FLAGS)}],onChange:function(b){var q=b.target.value;q===!1&&m.length?Be(!0):(w(q),tn(0))},value:a,optionType:"button"})})}),Object(e.jsxs)("div",{className:"text-muted mb-4",children:[Object(C.i)(c)," will be served"," ",a?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("strong",{children:"a variant key"})," according to the below distribution"]}):Object(e.jsx)("strong",{children:Object(e.jsx)("code",{children:"true"})})," ","if they match one or more release condition groups."]})]}),!n&&a&&Object(e.jsxs)("div",{className:"feature-flag-variants",children:[Object(e.jsx)("h3",{className:"l4",children:"Variant keys"}),Object(e.jsx)("span",{children:"The rollout percentage of feature flag variants must add up to 100%"}),Object(e.jsxs)("div",{className:"variant-form-list space-y-2",children:[Object(e.jsxs)(y.a,{gutter:8,className:"label-row",children:[Object(e.jsx)(U.a,{span:1}),Object(e.jsx)(U.a,{span:6,children:"Variant key"}),Object(e.jsx)(U.a,{span:12,children:"Description"}),Object(e.jsxs)(U.a,{span:4,children:["Rollout",Object(e.jsx)(je.a,{type:"tertiary",onClick:h,children:"(Redistribute)"})]})]}),l.map(function(Se,b){return Object(e.jsx)(ye.Group,{name:["filters","multivariate","variants",b],children:Object(e.jsxs)(y.a,{gutter:8,align:"middle",children:[Object(e.jsx)(U.a,{span:1,children:Object(e.jsx)(Ft.a,{name:C.c[b],color:Ft.b.Gray})}),Object(e.jsx)(U.a,{span:6,children:Object(e.jsx)(Ie.a,{name:"key",children:Object(e.jsx)(Wt.a,{"data-attr":"feature-flag-variant-key","data-key-index":b.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(b+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})}),Object(e.jsx)(U.a,{span:12,children:Object(e.jsx)(Ie.a,{name:"name",children:Object(e.jsx)(Wt.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"})})}),Object(e.jsx)(U.a,{span:3,children:Object(e.jsx)(Ie.a,{name:"rollout_percentage",children:function(xe){var Ze=xe.value,ke=xe.onChange;return Object(e.jsx)(Y.a,{min:0,max:100,value:Ze,onChange:function(X){if(X!=null){var De=parseInt(X.toString());isNaN(De)||ke(De)}},style:{width:"100%",borderColor:i?void 0:"var(--danger)"}})}})}),Object(e.jsx)(U.a,{span:2,children:Object(e.jsx)(y.a,{children:l.length>1&&Object(e.jsx)(je.a,{icon:Object(e.jsx)(T.IconDelete,{}),status:"primary-alt","data-attr":"delete-prop-filter-".concat(b),noPadding:!0,onClick:function(){return V(b)}})})})]})},b)}),l.length>0&&!i&&Object(e.jsxs)("p",{className:"text-danger",children:["Percentage rollouts for variants must sum to 100 (currently ",d,")."]}),Object(e.jsx)(je.a,{type:"secondary",onClick:function(){var b=l.length;p(),tn(b)},icon:Object(e.jsx)(T.IconPlus,{}),center:!0,children:"Add variant"})]})]})]})}function sn(s){var n,r,a=s.readOnly,l=Object(f.useValues)(ze.a),i=l.showGroupsOptions,u=l.aggregationLabel,d=Object(f.useValues)(E),m=d.aggregationTargetName,c=d.featureFlag,v=d.groupTypes,x=d.taxonomicGroupTypes,h=d.nonEmptyVariants,p=Object(f.useActions)(E),V=p.setAggregationGroupTypeIndex,w=p.updateConditionSet,R=p.duplicateConditionSet,B=p.removeConditionSet,ue=p.addConditionSet,Be=Object(f.useValues)(En.a),Ne=Be.cohortsById,me=Object(f.useValues)($.a),Xe=me.featureFlags,Qe=Rt({value:-2}),Se=function(q){return!!q.find(function(xe){return xe.type==="cohort"||!$e.l.includes(xe.key||"")})};return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"feature-flag-form-row",children:[Object(e.jsx)("div",{"data-attr":"feature-flag-release-conditions",children:a?Object(e.jsx)("div",{className:"mb-2",children:Object(e.jsx)("b",{children:"Release conditions"})}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h3",{className:"l4",children:"Release conditions"}),Object(e.jsxs)("div",{className:"text-muted mb-4",children:["Specify the ",m," to which you want to release this flag. Note that condition sets are rolled out independently of each other."]})]})}),!a&&i&&Object(e.jsxs)("div",{className:"centered",children:["Match by",Object(e.jsxs)(F.a,{value:((n=c.filters)===null||n===void 0?void 0:n.aggregation_group_type_index)!=null?(r=c.filters)===null||r===void 0?void 0:r.aggregation_group_type_index:-1,onChange:function(q){var xe=q!==-1?q:null;V(xe)},style:{marginLeft:8},"data-attr":"feature-flag-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]},children:[Object(e.jsx)(F.a.Option,{value:-1,children:"Users"},-1),v.map(function(b){return Object(e.jsx)(F.a.Option,{value:b.group_type_index,children:Object(C.i)(u(b.group_type_index).plural)},b.group_type_index)}),Qe]})]})]}),Object(e.jsx)(y.a,{gutter:16,children:c.filters.groups.map(function(b,q){var xe,Ze,ke,st;return Object(e.jsxs)(U.a,{span:24,md:24,children:[q>0&&Object(e.jsx)("div",{className:"condition-set-separator",children:"OR"}),Object(e.jsxs)("div",{className:"mb-4 border rounded p-4",children:[Object(e.jsxs)(y.a,{align:"middle",justify:"space-between",children:[Object(e.jsxs)(y.a,{align:"middle",children:[Object(e.jsxs)("span",{className:"simple-tag tag-light-blue font-medium mr-2",children:["Set ",q+1]}),Object(e.jsx)("div",{children:(xe=b.properties)!==null&&xe!==void 0&&xe.length?Object(e.jsx)(e.Fragment,{children:a?Object(e.jsxs)(e.Fragment,{children:["Match ",Object(e.jsx)("b",{children:m})," against ",Object(e.jsx)("b",{children:"all"})," criteria"]}):Object(e.jsxs)(e.Fragment,{children:["Matching ",Object(e.jsx)("b",{children:m})," against the criteria"]})}):Object(e.jsxs)(e.Fragment,{children:["Condition set will match ",Object(e.jsxs)("b",{children:["all ",m]})]})})]}),!a&&Object(e.jsxs)(y.a,{children:[Object(e.jsx)(je.a,{icon:Object(e.jsx)(T.IconCopy,{}),status:"muted",noPadding:!0,onClick:function(){return R(q)}}),c.filters.groups.length>1&&Object(e.jsx)(je.a,{icon:Object(e.jsx)(T.IconDelete,{}),status:"muted",noPadding:!0,onClick:function(){return B(q)}})]})]}),Object(e.jsx)(Le.a,{className:"my-3"}),!a&&Se(b.properties)&&Object(e.jsxs)(zt.a,{type:"info",className:"mt-3 mb-3",children:["These properties aren't immediately available on first page load for unidentified persons. This feature flag requires that at least one event is sent prior to becoming available to your product or website."," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/integrate/client/js#bootstrapping-flags",target:"_blank",children:[" ","Learn more about how to make feature flags available instantly."]})]}),a?Object(e.jsx)(e.Fragment,{children:b.properties.map(function(X,De){return Object(e.jsx)(e.Fragment,{children:Object(e.jsxs)("div",{className:"feature-flag-property-display",children:[De===0?Object(e.jsx)(je.a,{icon:Object(e.jsx)(T.IconSubArrowRight,{className:"arrow-right"}),status:"muted",size:"small"}):Object(e.jsx)(je.a,{icon:Object(e.jsx)("span",{className:"text-sm",children:"&"}),status:"muted",size:"small"}),Object(e.jsxs)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:[X.type==="cohort"?"Cohort":X.key," "]}),Object(Tn.d)(X)?Object(e.jsxs)("span",{children:[Object(On.a)(X.operator)," "]}):null,H()(Array.isArray(X.value)?X.value:[X.value]).map(function(rt,Tt){var pe;return Object(e.jsx)("span",{className:"simple-tag tag-light-blue text-primary-alt display-value",children:X.type==="cohort"?rt&&((pe=Ne[rt])===null||pe===void 0?void 0:pe.name)||"ID ".concat(rt):rt},Tt)})]})})})}):Object(e.jsx)("div",{children:Object(e.jsx)(z.a,{orFiltering:!0,pageKey:"feature-flag-".concat(c.id,"-").concat(q,"-").concat(c.filters.groups.length,"-").concat((Ze=c.filters.aggregation_group_type_index)!==null&&Ze!==void 0?Ze:""),propertyFilters:b==null?void 0:b.properties,logicalRowDivider:!0,addButton:Object(e.jsx)(je.a,{icon:Object(e.jsx)(T.IconPlusMini,{}),noPadding:!0,children:"Add condition"}),onChange:function(De){return w(q,void 0,De)},taxonomicGroupTypes:x,hasRowOperator:!1})}),(!a||a&&((ke=b.properties)===null||ke===void 0?void 0:ke.length)>0)&&Object(e.jsx)(Le.a,{className:"my-3"}),a?Object(e.jsxs)("div",{children:["Rolled out to"," ",Object(e.jsxs)("b",{children:[b.rollout_percentage!=null?b.rollout_percentage:100,"%"]})," of"," ",Object(e.jsx)("b",{children:m})," in this set"]}):Object(e.jsx)("div",{className:"feature-flag-form-row",children:Object(e.jsxs)("div",{className:"centered",children:["Roll out to"," ",Object(e.jsx)(Y.a,{style:{width:100,marginLeft:8,marginRight:8},onChange:function(De){w(q,De)},value:b.rollout_percentage!=null?b.rollout_percentage:100,min:0,max:100,addonAfter:"%"})," ","of ",Object(e.jsx)("b",{children:m})," in this set"]})}),Xe[$e.i.VARIANT_OVERRIDES]&&h.length>0&&Object(e.jsxs)(e.Fragment,{children:[(!a||a&&((st=b.properties)===null||st===void 0?void 0:st.length)>0)&&Object(e.jsx)(Le.a,{className:"my-3"}),a?Object(e.jsxs)("div",{children:["All ",Object(e.jsx)("b",{children:m})," in this set"," ",b.variant?Object(e.jsxs)(e.Fragment,{children:[" ","will be in variant ",Object(e.jsx)("b",{children:b.variant})]}):Object(e.jsx)(e.Fragment,{children:"have no variant override"})]}):Object(e.jsx)("div",{className:"feature-flag-form-row",children:Object(e.jsxs)("div",{className:"centered",children:[Object(e.jsx)("b",{children:"Optional override:"})," Set variant for all"," ",Object(e.jsx)("b",{children:m})," in this set to"," ",Object(e.jsx)(de.LemonSelect,{placeholder:"Select variant",allowClear:!0,value:b.variant,onChange:function(De){return w(q,void 0,void 0,De||void 0)},options:h.map(function(X){return{label:X.key,value:X.key}}),"data-attr":"feature-flags-variant-override-select"})]})})]})]})]},"".concat(q,"-").concat(c.filters.groups.length))})}),!a&&Object(e.jsx)(je.a,{type:"secondary",className:"mt-0",onClick:ue,icon:Object(e.jsx)(T.IconPlus,{}),children:"Add condition set"})]})}try{mt.displayName="FeatureFlag",mt.__docgenInfo={description:"",displayName:"FeatureFlag",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"]={docgenInfo:mt.__docgenInfo,name:"FeatureFlag",path:"frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"})}catch(s){}},"./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx":function(fe,A,t){"use strict";t.d(A,"a",function(){return Lt}),t.d(A,"b",function(){return jt});var k=t("./node_modules/core-js/modules/es.symbol.js"),H=t.n(k),be=t("./node_modules/core-js/modules/es.array.filter.js"),L=t.n(be),_e=t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Ae=t.n(_e),re=t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ce=t.n(re),Me=t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Ue=t.n(Me),ae=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Pe=t.n(ae),oe=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ye=t.n(oe),ve=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),y=t.n(ve),U=t("./node_modules/@babel/runtime/regenerator/index.js"),N=t.n(U),Fe=t("./node_modules/core-js/modules/es.array.iterator.js"),ce=t.n(Fe),P=t("./node_modules/core-js/modules/es.object.to-string.js"),Y=t.n(P),F=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),f=t.n(F),C=t("./node_modules/core-js/modules/es.array.map.js"),z=t.n(C),Ee=t("./node_modules/core-js/modules/es.array.concat.js"),ee=t.n(Ee),qe=t("./node_modules/core-js/modules/es.object.keys.js"),te=t.n(qe),Ge=t("./node_modules/kea/lib/index.esm.js"),at=t("./node_modules/kea-loaders/lib/index.js"),gt=t.n(at),et=t("./frontend/src/lib/api.ts"),ne=t("./frontend/src/types.ts"),Ye;function We(J,Q){var Z=Object.keys(J);if(Object.getOwnPropertySymbols){var se=Object.getOwnPropertySymbols(J);Q&&(se=se.filter(function(we){return Object.getOwnPropertyDescriptor(J,we).enumerable})),Z.push.apply(Z,se)}return Z}function ot(J){for(var Q=1;Q<arguments.length;Q++){var Z=arguments[Q]!=null?arguments[Q]:{};Q%2?We(Object(Z),!0).forEach(function(se){y()(J,se,Z[se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(Z)):We(Object(Z)).forEach(function(se){Object.defineProperty(J,se,Object.getOwnPropertyDescriptor(Z,se))})}return J}var M=y()({},ne.U.FEATURE_FLAGS,"Feature Flags"),Lt=(Ye={},y()(Ye,ne.a.WRITE,"View & Edit"),y()(Ye,ne.a.READ,"View Only"),Ye),jt=Object(Ge.kea)([Object(Ge.path)(["scenes","organization","Settings","Permissions","permissionsLogic"]),Object(at.loaders)(function(J){var Q=J.values;return{organizationResourcePermissions:[[],{loadOrganizationResourcePermissions:function(){var Z=ye()(N.a.mark(function we(){var Ke;return N.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,et.b.resourcePermissions.list();case 2:return Ke=S.sent,S.abrupt("return",(Ke==null?void 0:Ke.results)||[]);case 4:case"end":return S.stop()}},we)}));function se(){return Z.apply(this,arguments)}return se}(),updateOrganizationResourcePermission:function(){var Z=ye()(N.a.mark(function we(Ke){var tt,S,Oe,ie,le;return N.a.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(tt=Ke.id,S=Ke.resource,Oe=Ke.access_level,!tt){G.next=8;break}return G.next=4,et.b.resourcePermissions.update(tt,{access_level:Oe});case 4:return ie=G.sent,G.abrupt("return",Q.organizationResourcePermissions.map(function(ze){return ze.id==ie.id?ie:ze}));case 8:return G.next=10,et.b.resourcePermissions.create({resource:S,access_level:Oe});case 10:return le=G.sent,G.abrupt("return",[].concat(Pe()(Q.organizationResourcePermissions),[le]));case 12:case"end":return G.stop()}},we)}));function se(we){return Z.apply(this,arguments)}return se}()}]}}),Object(Ge.selectors)({organizationResourcePermissionsMap:[function(J){return[J.organizationResourcePermissions]},function(J){return J.reduce(function(Q,Z){return ot(ot({},Q),{},y()({},Z.resource,Z))},{})}],allPermissions:[function(J){return[J.organizationResourcePermissionsMap]},function(J){return Object.keys(M).map(function(Q){var Z,se;return{id:((Z=J[Q])===null||Z===void 0?void 0:Z.id)||null,resource:Q,name:M[Q],access_level:((se=J[Q])===null||se===void 0?void 0:se.access_level)||ne.a.WRITE}})}]}),Object(Ge.afterMount)(function(J){var Q=J.actions;Q.loadOrganizationResourcePermissions()})])},"./frontend/src/scenes/organization/Settings/Roles/rolesLogic.tsx":function(fe,A,t){"use strict";t.d(A,"a",function(){return Kt});var k=t("./node_modules/core-js/modules/es.object.keys.js"),H=t.n(k),be=t("./node_modules/core-js/modules/es.symbol.js"),L=t.n(be),_e=t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Ae=t.n(_e),re=t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ce=t.n(re),Me=t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Ue=t.n(Me),ae=t("./node_modules/core-js/modules/es.array.slice.js"),Pe=t.n(ae),oe=t("./node_modules/core-js/modules/es.function.name.js"),ye=t.n(oe),ve=t("./node_modules/core-js/modules/es.array.from.js"),y=t.n(ve),U=t("./node_modules/core-js/modules/es.regexp.exec.js"),N=t.n(U),Fe=t("./node_modules/core-js/modules/es.symbol.description.js"),ce=t.n(Fe),P=t("./node_modules/core-js/modules/es.symbol.iterator.js"),Y=t.n(P),F=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),f=t.n(F),C=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),z=t.n(C),Ee=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),ee=t.n(Ee),qe=t("./node_modules/@babel/runtime/regenerator/index.js"),te=t.n(qe),Ge=t("./node_modules/core-js/modules/es.array.map.js"),at=t.n(Ge),gt=t("./node_modules/core-js/modules/es.array.iterator.js"),et=t.n(gt),ne=t("./node_modules/core-js/modules/es.object.to-string.js"),Ye=t.n(ne),We=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),ot=t.n(We),M=t("./node_modules/core-js/modules/es.array.concat.js"),Lt=t.n(M),jt=t("./node_modules/core-js/modules/es.array.filter.js"),J=t.n(jt),Q=t("./node_modules/core-js/modules/es.promise.js"),Z=t.n(Q),se=t("./node_modules/core-js/modules/es.string.iterator.js"),we=t.n(se),Ke=t("./node_modules/core-js/modules/es.object.assign.js"),tt=t.n(Ke),S=t("./node_modules/core-js/modules/es.array.sort.js"),Oe=t.n(S),ie=t("./node_modules/kea/lib/index.esm.js"),le=t("./node_modules/kea-loaders/lib/index.js"),it=t.n(le),G=t("./frontend/src/lib/api.ts"),ze=t("./frontend/src/scenes/project/Settings/teamMembersLogic.tsx"),Te=t("./frontend/src/types.ts");function St(j,g){var o=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!o){if(Array.isArray(j)||(o=Dt(j))||g&&j&&typeof j.length=="number"){o&&(j=o);var _=0,I=function(){};return{s:I,n:function(){return _>=j.length?{done:!0}:{done:!1,value:j[_++]}},e:function(E){throw E},f:I}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D=!0,W=!1,K;return{s:function(){o=o.call(j)},n:function(){var E=o.next();return D=E.done,E},e:function(E){W=!0,K=E},f:function(){try{!D&&o.return!=null&&o.return()}finally{if(W)throw K}}}}function Dt(j,g){if(!!j){if(typeof j=="string")return lt(j,g);var o=Object.prototype.toString.call(j).slice(8,-1);if(o==="Object"&&j.constructor&&(o=j.constructor.name),o==="Map"||o==="Set")return Array.from(j);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return lt(j,g)}}function lt(j,g){(g==null||g>j.length)&&(g=j.length);for(var o=0,_=new Array(g);o<g;o++)_[o]=j[o];return _}function pt(j,g){var o=Object.keys(j);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(j);g&&(_=_.filter(function(I){return Object.getOwnPropertyDescriptor(j,I).enumerable})),o.push.apply(o,_)}return o}function ct(j){for(var g=1;g<arguments.length;g++){var o=arguments[g]!=null?arguments[g]:{};g%2?pt(Object(o),!0).forEach(function(_){ee()(j,_,o[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(o)):pt(Object(o)).forEach(function(_){Object.defineProperty(j,_,Object.getOwnPropertyDescriptor(o,_))})}return j}var Kt=Object(ie.kea)([Object(ie.path)(["scenes","organization","rolesLogic"]),Object(ie.connect)({values:[ze.b,["plainMembers"]]}),Object(ie.actions)({setCreateRoleModalShown:function(g){return{shown:g}},setRoleInFocus:function(g){return{role:g}},setRoleMembersInFocus:function(g){return{roleMembers:g}},setRoleMembersToAdd:function(g){return{uuids:g}},openCreateRoleModal:!0,setPermission:function(g,o){return{resource:g,access:o}},setPermissionInPlace:function(g,o){return{resource:g,access:o}},clearPermission:!0,updateRole:function(g){return{role:g}}}),Object(ie.reducers)({createRoleModalShown:[!1,{setCreateRoleModalShown:function(g,o){var _=o.shown;return _}}],roleInFocus:[null,{setRoleInFocus:function(g,o){var _=o.role;return _}}],roleMembersInFocus:[[],{setRoleMembersInFocus:function(g,o){var _=o.roleMembers;return _}}],roleMembersToAdd:[[],{setRoleMembersToAdd:function(g,o){var _=o.uuids;return _}}],permissionsToSet:[{},{setPermission:function(g,o){var _=o.resource,I=o.access;return ct(ct({},g),{},ee()({},"".concat(_),I))},clearPermission:function(){return{}}}],roles:[[],{updateRole:function(g,o){var _=o.role;return g.map(function(I){return I.id==_.id?_:I})}}]}),Object(le.loaders)(function(j){var g=j.values,o=j.actions;return{roles:{loadRoles:function(){var _=z()(te.a.mark(function D(){var W;return te.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,G.b.roles.list();case 2:return W=O.sent,O.abrupt("return",(W==null?void 0:W.results)||[]);case 4:case"end":return O.stop()}},D)}));function I(){return _.apply(this,arguments)}return I}(),createRole:function(){var _=z()(te.a.mark(function D(W){var K,O,E,$;return te.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return K=g.roles,O=g.roleMembersToAdd,E=g.permissionsToSet,T.next=3,G.b.roles.create(W,E[Te.U.FEATURE_FLAGS]);case 3:return $=T.sent,T.next=6,o.addRoleMembers({role:$,membersToAdd:O});case 6:return o.setRoleMembersInFocus([]),o.setRoleMembersToAdd([]),o.clearPermission(),o.setCreateRoleModalShown(!1),T.abrupt("return",[$].concat(f()(K)));case 11:case"end":return T.stop()}},D)}));function I(D){return _.apply(this,arguments)}return I}(),deleteRole:function(){var _=z()(te.a.mark(function D(W){return te.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,G.b.roles.delete(W.id);case 2:return O.abrupt("return",g.roles.filter(function(E){return E.id!==W.id}));case 3:case"end":return O.stop()}},D)}));function I(D){return _.apply(this,arguments)}return I}()},roleMembersInFocus:[[],{loadRoleMembers:function(){var _=z()(te.a.mark(function D(W){var K,O;return te.a.wrap(function($){for(;;)switch($.prev=$.next){case 0:return K=W.roleId,$.next=3,G.b.roles.members.list(K);case 3:return O=$.sent,$.abrupt("return",(O==null?void 0:O.results)||[]);case 5:case"end":return $.stop()}},D)}));function I(D){return _.apply(this,arguments)}return I}(),addRoleMembers:function(){var _=z()(te.a.mark(function D(W){var K,O,E;return te.a.wrap(function(Ve){for(;;)switch(Ve.prev=Ve.next){case 0:return K=W.role,O=W.membersToAdd,Ve.next=3,Promise.all(O.map(function(){var T=z()(te.a.mark(function Le(ge){return te.a.wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return he.next=2,G.b.roles.members.create(K.id,ge);case 2:return he.abrupt("return",he.sent);case 3:case"end":return he.stop()}},Le)}));return function(Le){return T.apply(this,arguments)}}()));case 3:return E=Ve.sent,o.setRoleMembersToAdd([]),Ve.abrupt("return",[].concat(f()(g.roleMembersInFocus),f()(E)));case 6:case"end":return Ve.stop()}},D)}));function I(D){return _.apply(this,arguments)}return I}(),deleteRoleMember:function(){var _=z()(te.a.mark(function D(W){var K;return te.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(K=W.roleMemberUuid,E.t0=g.roleInFocus,!E.t0){E.next=5;break}return E.next=5,G.b.roles.members.delete(g.roleInFocus.id,K);case 5:return E.abrupt("return",g.roleMembersInFocus.filter(function($){return $.id!==K}));case 6:case"end":return E.stop()}},D)}));function I(D){return _.apply(this,arguments)}return I}()}]}}),Object(ie.listeners)(function(j){var g=j.actions,o=j.values;return{setRoleInFocus:function(I){var D=I.role;D&&g.loadRoleMembers({roleId:D.id}),g.setCreateRoleModalShown(!0)},openCreateRoleModal:function(){g.setRoleInFocus(null),g.setRoleMembersInFocus([]),g.setCreateRoleModalShown(!0)},setCreateRoleModalShown:function(){o.roleInFocus?g.setPermission(Te.U.FEATURE_FLAGS,o.roleInFocus.feature_flags_access_level):g.setPermission(Te.U.FEATURE_FLAGS,Te.a.WRITE)},setPermissionInPlace:function(){var _=z()(te.a.mark(function D(W){var K,O;return te.a.wrap(function($){for(;;)switch($.prev=$.next){case 0:if(K=W.access,!o.roleInFocus){$.next=9;break}if($.t0=K,!$.t0){$.next=6;break}return $.next=6,G.b.roles.update(o.roleInFocus.id,{feature_flags_access_level:K});case 6:O=Object.assign({},o.roleInFocus),O.feature_flags_access_level=K,g.updateRole(O);case 9:case"end":return $.stop()}},D)}));function I(D){return _.apply(this,arguments)}return I}()}}),Object(ie.selectors)({addableMembers:[function(j){return[j.plainMembers,j.roleMembersInFocus]},function(j,g){var o=[],_=St(j),I;try{var D=function(){var K=I.value;g.some(function(O){return O.user.uuid===K.user.uuid})||o.push(K.user)};for(_.s();!(I=_.n()).done;)D()}catch(W){_.e(W)}finally{_.f()}return o.sort(function(W,K){return W.first_name.localeCompare(K.first_name)}),o}]}),Object(ie.afterMount)(function(j){var g=j.actions;g.loadRoles()})])},"./frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx":function(fe,A,t){"use strict";t.d(A,"a",function(){return Ae});var k=t("./frontend/@posthog/lemon-ui/src/index.ts"),H=t("./node_modules/react/index.js"),be=t.n(H),L=t("./node_modules/react/jsx-runtime.js"),_e=t.n(L);function Ae(re){var Ce=re.to,Me=re.onClick,Ue=re.title,ae=re.subtitle,Pe=re.prefix,oe=re.suffix;return Object(L.jsx)(k.LemonButton,{fullWidth:!0,to:Ce,onClick:Me,children:Object(L.jsxs)("div",{className:"flex items-center justify-between h-10 overflow-hidden gap-2 flex-1",children:[Pe?Object(L.jsx)("span",{className:"shrink-0",children:Pe}):null,Object(L.jsxs)("div",{className:"truncate space-y-1 flex-1",children:[Object(L.jsx)("div",{className:"text-primary font-semibold truncate",children:Ue}),Object(L.jsx)("div",{className:"truncate text-default font-normal",children:ae})]}),oe?Object(L.jsx)("span",{className:"shrink-0",children:oe}):null]})})}try{Ae.displayName="ProjectHomePageCompactListItem",Ae.__docgenInfo={description:"",displayName:"ProjectHomePageCompactListItem",props:{to:{defaultValue:null,description:"URL to link to.",name:"to",required:!1,type:{name:"string"}},title:{defaultValue:null,description:"",name:"title",required:!0,type:{name:"string"}},subtitle:{defaultValue:null,description:"",name:"subtitle",required:!0,type:{name:"string"}},prefix:{defaultValue:null,description:"",name:"prefix",required:!1,type:{name:"ReactNode"}},suffix:{defaultValue:null,description:"",name:"suffix",required:!1,type:{name:"ReactNode"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx#ProjectHomePageCompactListItem"]={docgenInfo:Ae.__docgenInfo,name:"ProjectHomePageCompactListItem",path:"frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx#ProjectHomePageCompactListItem"})}catch(re){}},"./frontend/src/scenes/project-homepage/ProjectHomepage.scss":function(fe,A,t){"use strict";var k=t("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),H=t.n(k),be=t("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/project-homepage/ProjectHomepage.scss"),L=t.n(be),_e={};_e.insert="head",_e.singleton=!1;var Ae=H()(L.a,_e),re=L.a.locals||{}},"./frontend/src/scenes/project-homepage/RecentInsights.tsx":function(fe,A,t){"use strict";t.d(A,"a",function(){return N}),t.d(A,"b",function(){return Fe});var k=t("./node_modules/core-js/modules/es.function.name.js"),H=t.n(k),be=t("./node_modules/core-js/modules/es.array.slice.js"),L=t.n(be),_e=t("./node_modules/react/index.js"),Ae=t.n(_e),re=t("./frontend/src/scenes/project-homepage/ProjectHomepage.scss"),Ce=t("./node_modules/kea/lib/index.esm.js"),Me=t("./frontend/src/lib/dayjs.ts"),Ue=t("./frontend/src/lib/components/CompactList/CompactList.tsx"),ae=t("./frontend/src/scenes/urls.ts"),Pe=t("./frontend/src/scenes/saved-insights/SavedInsights.tsx"),oe=t("./frontend/src/scenes/project-homepage/projectHomepageLogic.tsx"),ye=t("./frontend/src/lib/utils/eventUsageLogic.ts"),ve=t("./frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx"),y=t("./node_modules/react/jsx-runtime.js"),U=t.n(y);function N(ce){var P=ce.insight,Y=Object(Ce.useActions)(ye.e),F=Y.reportInsightOpenedFromRecentInsightList;return Object(y.jsx)(ve.a,{title:P.name||P.derived_name||"Insight",subtitle:"Last modified ".concat(Object(Me.a)(P.last_modified_at).fromNow()),prefix:Object(y.jsx)(Pe.InsightIcon,{insight:P}),to:ae.a.insightView(P.short_id),onClick:function(){F()}})}function Fe(){var ce=Object(Ce.useValues)(oe.a),P=ce.recentInsights,Y=ce.recentInsightsLoading,F=Object(Ce.useActions)(oe.a),f=F.loadRecentInsights;return Object(_e.useEffect)(function(){f()},[]),Object(y.jsx)(y.Fragment,{children:Object(y.jsx)(Ue.a,{title:"Your recently viewed insights",viewAllURL:ae.a.savedInsights(),loading:Y,emptyMessage:{title:"You have no recently viewed insights",description:"Explore this project's insights by clicking below.",buttonText:"View insights",buttonTo:ae.a.savedInsights()},items:P.slice(0,5),renderRow:function(z,Ee){return Object(y.jsx)(N,{insight:z},Ee)}})})}try{N.displayName="InsightRow",N.__docgenInfo={description:"",displayName:"InsightRow",props:{insight:{defaultValue:null,description:"",name:"insight",required:!0,type:{name:"InsightModel"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/project-homepage/RecentInsights.tsx#InsightRow"]={docgenInfo:N.__docgenInfo,name:"InsightRow",path:"frontend/src/scenes/project-homepage/RecentInsights.tsx#InsightRow"})}catch(ce){}},"./frontend/src/scenes/project-homepage/RecentRecordings.tsx":function(fe,A,t){"use strict";t.d(A,"b",function(){return ce}),t.d(A,"a",function(){return P});var k=t("./node_modules/core-js/modules/es.array.slice.js"),H=t.n(k),be=t("./frontend/src/lib/dayjs.ts"),L=t("./node_modules/kea/lib/index.esm.js"),_e=t("./frontend/src/scenes/project-homepage/ProjectHomepage.scss"),Ae=t("./frontend/src/lib/components/CompactList/CompactList.tsx"),re=t("./frontend/src/lib/components/ProfilePicture/index.ts"),Ce=t("./frontend/src/scenes/persons/PersonHeader.tsx"),Me=t("./frontend/src/scenes/session-recordings/playlist/sessionRecordingsListLogic.ts"),Ue=t("./frontend/src/scenes/urls.ts"),ae=t("./frontend/src/lib/utils/eventUsageLogic.ts"),Pe=t("./frontend/src/lib/utils.tsx"),oe=t("./frontend/src/lib/components/icons.tsx"),ye=t("./frontend/src/scenes/session-recordings/player/modal/SessionPlayerModal.tsx"),ve=t("./frontend/src/scenes/teamLogic.tsx"),y=t("./frontend/src/scenes/session-recordings/player/modal/sessionPlayerModalLogic.ts"),U=t("./frontend/src/scenes/project-homepage/ProjectHomePageCompactListItem.tsx"),N=t("./node_modules/react/jsx-runtime.js"),Fe=t.n(N);function ce(Y){var F=Y.recording,f=Object(L.useActions)(y.a),C=f.openSessionPlayer,z=Object(L.useActions)(ae.e),Ee=z.reportRecordingOpenedFromRecentRecordingList;return Object(N.jsx)(U.a,{title:Object(Ce.b)(F.person),subtitle:"Recorded ".concat(Object(be.a)(F.start_time).fromNow()),prefix:Object(N.jsx)(re.b,{name:Object(Ce.b)(F.person)}),suffix:Object(N.jsxs)("div",{className:"flex items-center justify-end text-default",children:[Object(N.jsx)("span",{children:Object(Pe.O)(F.recording_duration)}),Object(N.jsx)(oe.IconPlayCircle,{className:"text-2xl ml-2"})]}),onClick:function(){C({id:F.id,matching_events:F.matching_events}),Ee()}})}function P(){var Y=Object(L.useValues)(ve.a),F=Y.currentTeam,f=Object(Me.d)({key:"projectHomepage"}),C=Object(L.useValues)(f),z=C.sessionRecordings,Ee=C.sessionRecordingsResponseLoading;return Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(ye.a,{}),Object(N.jsx)(Ae.a,{title:"Recent recordings",viewAllURL:Ue.a.sessionRecordings(),loading:Ee,emptyMessage:F!=null&&F.session_recording_opt_in?{title:"There are no recordings for this project",description:"Make sure you have the javascript snippet setup in your website.",buttonText:"Learn more",buttonTo:"https://posthog.com/docs/user-guides/recordings"}:{title:"Recordings are not enabled for this project",description:"Once recordings are enabled, new recordings will display here.",buttonText:"Enable recordings",buttonTo:Ue.a.projectSettings()+"#recordings"},items:z.slice(0,5),renderRow:function(qe,te){return Object(N.jsx)(ce,{recording:qe},te)}})]})}try{ce.displayName="RecordingRow",ce.__docgenInfo={description:"",displayName:"RecordingRow",props:{recording:{defaultValue:null,description:"",name:"recording",required:!0,type:{name:"SessionRecordingType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/project-homepage/RecentRecordings.tsx#RecordingRow"]={docgenInfo:ce.__docgenInfo,name:"RecordingRow",path:"frontend/src/scenes/project-homepage/RecentRecordings.tsx#RecordingRow"})}catch(Y){}},"./frontend/src/scenes/project-homepage/projectHomepageLogic.tsx":function(fe,A,t){"use strict";t.d(A,"a",function(){return ce});var k=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),H=t.n(k),be=t("./node_modules/@babel/runtime/regenerator/index.js"),L=t.n(be),_e=t("./node_modules/core-js/modules/es.array.iterator.js"),Ae=t.n(_e),re=t("./node_modules/core-js/modules/es.object.to-string.js"),Ce=t.n(re),Me=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Ue=t.n(Me),ae=t("./node_modules/kea/lib/index.esm.js"),Pe=t("./frontend/src/scenes/teamLogic.tsx"),oe=t("./frontend/src/scenes/dashboard/dashboardLogic.tsx"),ye=t("./frontend/src/types.ts"),ve=t("./frontend/src/lib/api.ts"),y=t("./node_modules/kea-subscriptions/lib/index.js"),U=t.n(y),N=t("./node_modules/kea-loaders/lib/index.js"),Fe=t.n(N),ce=Object(ae.kea)([Object(ae.path)(["scenes","project-homepage","projectHomepageLogic"]),Object(ae.connect)({values:[Pe.a,["currentTeamId","currentTeam"]]}),Object(ae.selectors)({primaryDashboardId:[function(){return[Pe.a.selectors.currentTeam]},function(P){return P==null?void 0:P.primary_dashboard}],dashboardLogic:[function(P){return[P.primaryDashboardId]},function(P){return Object(oe.c)({id:P!=null?P:void 0,placement:ye.n.ProjectHomepage})}]}),Object(N.loaders)(function(P){var Y=P.values;return{recentInsights:[[],{loadRecentInsights:function(){var F=H()(L.a.mark(function C(){var z;return L.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.next=2,ve.b.get("api/projects/".concat(Y.currentTeamId,"/insights/?my_last_viewed=true&order=-my_last_viewed_at"));case 2:return z=ee.sent,ee.abrupt("return",z.results);case 4:case"end":return ee.stop()}},C)}));function f(){return F.apply(this,arguments)}return f}()}],persons:[[],{loadPersons:function(){var F=H()(L.a.mark(function C(){var z;return L.a.wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return ee.next=2,ve.b.persons.list();case 2:return z=ee.sent,ee.abrupt("return",z.results);case 4:case"end":return ee.stop()}},C)}));function f(){return F.apply(this,arguments)}return f}()}]}}),Object(y.subscriptions)(function(P){var Y=P.cache;return{dashboardLogic:function(f){var C;(C=Y.unmount)===null||C===void 0||C.call(Y),Y.unmount=f?f.mount():null}}}),Object(ae.afterMount)(function(P){var Y,F=P.cache,f=P.actions;(Y=F.unmount)===null||Y===void 0||Y.call(F),f.loadRecentInsights(),f.loadPersons()})])},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss":function(fe,A,t){var k=t("./node_modules/css-loader/dist/runtime/api.js");A=k(!1),A.push([fe.i,".variant-form-list{font-size:13px;border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-top:16px}.variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}.feature-flag-property-display{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;gap:.5rem;margin-top:.5rem}.feature-flag-property-display .arrow-right{margin-right:-8px;margin-top:.25rem}.feature-flag-property-display .display-value{word-break:break-all}.condition-set-separator{color:var(--primary-alt);font-size:12px;font-weight:var(--font-semibold);margin-left:.5rem;margin-bottom:.5rem}.feature-flag-form-row{display:flex;justify-content:space-between;align-items:center;width:100%}.feature-flag-form-row .centered{display:flex;align-items:center;white-space:pre-wrap}",""]),fe.exports=A},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlagInstructions.scss":function(fe,A,t){var k=t("./node_modules/css-loader/dist/runtime/api.js");A=k(!1),A.push([fe.i,".FeatureFlagInstructionsHeader{flex-wrap:nowrap}.FeatureFlagInstructionsHeader .FeatureFlagInstructionsHeader__header-title{display:flex;justify-items:center}.FeatureFlagInstructionsHeader .FeatureFlagInstructionsHeader__header-title .FeatureFlagInstructionsHeader__header-title__icon{color:var(--text-muted-alt);margin-right:12px;font-size:1.6em}.FeatureFlagInstructionsHeader__option{display:flex;justify-items:center}.FeatureFlagInstructionsHeader__option .FeatureFlagInstructionsHeader__option__icon{margin-top:2px;margin-right:8px}",""]),fe.exports=A},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/project-homepage/ProjectHomepage.scss":function(fe,A,t){var k=t("./node_modules/css-loader/dist/runtime/api.js");A=k(!1),A.push([fe.i,".project-homepage .homepage-dashboard-header{display:flex;justify-content:space-between;align-items:center}.project-homepage .homepage-dashboard-header .dashboard-title-container{display:flex;flex-direction:row;align-items:center}.project-homepage .homepage-dashboard-header .dashboard-title-container .ant-skeleton{width:300px}.project-homepage .homepage-dashboard-header .dashboard-title-container .ant-skeleton h3{margin:0}.project-homepage .top-list-container-horizontal{display:flex}.project-homepage .top-list-container-horizontal .top-list{margin-bottom:1.5rem;width:33%}.project-homepage .top-list-container-horizontal .spacer{width:1rem}.project-homepage .top-list-container-vertical{margin-bottom:1.5rem}.project-homepage .top-list-container-vertical .spacer{height:1rem}.project-homepage .empty-state-container{background-color:var(--side);width:100%;justify-content:center;align-items:center;padding:4rem;display:flex;flex-direction:column}",""]),fe.exports=A}}]);
