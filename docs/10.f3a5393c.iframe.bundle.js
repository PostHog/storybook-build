(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(J,g,r){"use strict";r.r(g),r.d(g,"AppMetricsTab",function(){return u}),r.d(g,"appMetricsSceneLogic",function(){return G});var L=r("./node_modules/@babel/runtime/helpers/slicedToArray.js"),y=r.n(L),U=r("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),f=r.n(U),R=r("./node_modules/@babel/runtime/regenerator/index.js"),d=r.n(R),B=r("./node_modules/core-js/modules/es.array.iterator.js"),N=r.n(B),K=r("./node_modules/core-js/modules/es.object.to-string.js"),z=r.n(K),W=r("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Q=r.n(W),h=r("./node_modules/core-js/modules/es.array.concat.js"),V=r.n(h),F=r("./node_modules/core-js/modules/es.function.name.js"),X=r.n(F),x=r("./node_modules/core-js/modules/es.array.includes.js"),Y=r.n(x),H=r("./node_modules/core-js/modules/es.string.includes.js"),Z=r.n(H),$=r("./node_modules/core-js/modules/es.array.filter.js"),w=r.n($),S=r("./node_modules/core-js/modules/es.number.constructor.js"),k=r.n(S),E=r("./node_modules/kea/lib/index.esm.js"),O=r("./node_modules/kea-loaders/lib/index.js"),q=r.n(O),v=r("./frontend/src/scenes/urls.ts"),m=r("./frontend/src/lib/api.ts"),D=r("./frontend/src/scenes/teamLogic.tsx"),j=r("./node_modules/kea-router/lib/index.js"),ee=r.n(j),M=r("./frontend/src/lib/utils.tsx"),u;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.HistoricalExports="historical_exports"})(u||(u={}));var P="-30d",T=[u.ProcessEvent,u.OnEvent,u.ExportEvents],G=Object(E.kea)([Object(E.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(E.props)({}),Object(E.key)(function(t){return t.pluginConfigId}),Object(E.actions)({setActiveTab:function(s){return{tab:s}},setDateFrom:function(s){return{dateFrom:s}},openErrorDetailsDrawer:function(s,e,n){return{errorType:s,category:e,jobId:n}},closeErrorDetailsDrawer:!0}),Object(E.reducers)({activeTab:[null,{setActiveTab:function(s,e){var n=e.tab;return n}}],dateFrom:[P,{setDateFrom:function(s,e){var n=e.dateFrom;return n}}],errorDetailsDrawerError:[null,{openErrorDetailsDrawer:function(s,e){var n=e.errorType;return n},closeErrorDetailsDrawer:function(){return null}}]}),Object(O.loaders)(function(t){var s=t.values,e=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var n=f()(d.a.mark(function i(){return d.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,m.b.get("api/projects/".concat(D.a.values.currentTeamId,"/plugin_configs/").concat(e.pluginConfigId));case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},i)}));function o(){return n.apply(this,arguments)}return o}()}],appMetricsResponse:[null,{loadMetrics:function(){var n=f()(d.a.mark(function i(){var a;return d.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return a=Object(M.Eb)({category:s.activeTab,date_from:s.dateFrom}),_.next=3,m.b.get("api/projects/".concat(D.a.values.currentTeamId,"/app_metrics/").concat(e.pluginConfigId,"?").concat(a));case 3:return _.abrupt("return",_.sent);case 4:case"end":return _.stop()}},i)}));function o(){return n.apply(this,arguments)}return o}()}],historicalExports:[[],{loadHistoricalExports:function(){var n=f()(d.a.mark(function i(){var a,l;return d.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,m.b.get("api/projects/".concat(D.a.values.currentTeamId,"/app_metrics/").concat(e.pluginConfigId,"/historical_exports"));case 2:return a=c.sent,l=a.results,c.abrupt("return",l);case 5:case"end":return c.stop()}},i)}));function o(){return n.apply(this,arguments)}return o}()}],errorDetails:[[],{openErrorDetailsDrawer:function(){var n=f()(d.a.mark(function i(a){var l,_,c,b,I,A;return d.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l=a.category,_=a.jobId,c=a.errorType,b=Object(M.Eb)({category:l,job_id:_,error_type:c}),p.next=4,m.b.get("api/projects/".concat(D.a.values.currentTeamId,"/app_metrics/").concat(e.pluginConfigId,"/error_details?").concat(b));case 4:return I=p.sent,A=I.result,p.abrupt("return",A);case 7:case"end":return p.stop()}},i)}));function o(i){return n.apply(this,arguments)}return o}()}]}}),Object(E.selectors)(function(t){var s=t.values;return{breadcrumbs:[function(e){return[e.pluginConfig,function(n,o){return o.pluginConfigId}]},function(e,n){var o;return[{name:"Apps",path:v.a.projectApps()},{name:e==null||(o=e.plugin_info)===null||o===void 0?void 0:o.name,path:v.a.appMetrics(n)}]}],showTab:[function(){return[]},function(){return function(e){var n;if(s.pluginConfigLoading||!s.pluginConfig)return!1;var o=((n=s.pluginConfig.plugin_info.capabilities)===null||n===void 0?void 0:n.methods)||[];return e===u.HistoricalExports?o.includes("exportEvents"):e===u.OnEvent&&o.includes("exportEvents")?!1:o.includes(e)}}]}}),Object(E.listeners)(function(t){var s=t.values,e=t.actions;return{loadPluginConfigSuccess:function(){if(!s.activeTab){var o=T.filter(function(l){return s.showTab(l)}),i=y()(o,1),a=i[0];e.setActiveTab(a)}},setActiveTab:function(o){var i=o.tab;i===u.HistoricalExports?e.loadHistoricalExports():e.loadMetrics()},setDateFrom:function(){e.loadMetrics()}}}),Object(j.actionToUrl)(function(t){var s=t.values,e=t.props;return{setActiveTab:function(){return C(s,e)},setDateFrom:function(){return C(s,e)}}}),Object(j.urlToAction)(function(t){var s=t.values,e=t.actions,n=t.props;return{"/app/:pluginConfigId/:page":function(i,a){n.pluginConfigId===Number(i.pluginConfigId)&&(s.pluginConfig||e.loadPluginConfig(),i.page===u.HistoricalExports?e.setActiveTab(u.HistoricalExports):(a.tab&&T.includes(a.tab)&&e.setActiveTab(a.tab),a.from&&e.setDateFrom(a.from)))}}})]);function C(t,s){if(t.activeTab===u.HistoricalExports)return v.a.appHistoricalExports(s.pluginConfigId);var e={};return t.activeTab&&(e.tab=t.activeTab),t.dateFrom!==P&&(e.from=t.dateFrom),v.a.appMetrics(s.pluginConfigId,e)}}}]);
