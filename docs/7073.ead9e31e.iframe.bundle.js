"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[7073],{"./frontend/src/scenes/pipeline/PipelineApp.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PipelineApp:()=>PipelineApp,scene:()=>scene});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/LemonTabs.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),PluginLogs=__webpack_require__("./frontend/src/scenes/plugins/plugin/PluginLogs.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),Chart=__webpack_require__("./frontend/src/lib/Chart.ts"),colors=__webpack_require__("./frontend/src/lib/colors.ts"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonLabel=__webpack_require__("./frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),LemonSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),appMetricsLogic=__webpack_require__("./frontend/src/scenes/pipeline/appMetricsLogic.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AppMetrics(_ref){let{pluginConfigId}=_ref;const logic=(0,appMetricsLogic.t)({pluginConfigId}),{appMetricsResponse,appMetricsResponseLoading,dateFrom}=(0,index_esm.useValues)(logic),{setDateFrom}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,jsx_runtime.jsx)(MetricsOverview,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{value:dateFrom,onChange:newValue=>setDateFrom(newValue),options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Delivery trends"}),(0,jsx_runtime.jsx)(AppMetricsGraph,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Errors"}),(0,jsx_runtime.jsx)(ErrorsOverview,{pluginConfigId})]})]})}function MetricsOverview(_ref2){let{metrics,metricsLoading}=_ref2;return metricsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-20 h-4 mb-2",repeat:4}):(0,jsx_runtime.jsx)("div",{className:"space-y-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:["Events Processed successfully",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Total number of events processed successfully",children:(0,jsx_runtime.jsx)(icons.aUG,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.successes)})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:["Events Failed",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Total number of events that threw an error during processing",children:(0,jsx_runtime.jsx)(icons.aUG,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.failures)})]})]})})}function renderNumber(value){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value?(0,utils.Lc)(value):value})}function AppMetricsGraph(_ref3){let{metrics,metricsLoading}=_ref3;const canvasRef=(0,react.useRef)(null);return(0,react.useEffect)((()=>{let chart;if(canvasRef.current&&metrics&&!(0,utils.es)())return chart=new Chart.k(canvasRef.current?.getContext("2d"),{type:"line",data:{labels:metrics.dates,datasets:[{label:"events processed successfully",data:metrics.successes,borderColor:"",...colorConfig("data-color-1")},{label:"events failed",data:metrics.failures,...colorConfig("data-color-5")}]},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}}),()=>{chart?.destroy()}}),[metrics]),metricsLoading||!metrics?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"AppMetricsGraph border rounded p-6"}):(0,jsx_runtime.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:(0,jsx_runtime.jsx)("canvas",{ref:canvasRef})})}function colorConfig(baseColorVar){const mainColor=(0,colors.cM)(baseColorVar);return{borderColor:mainColor,hoverBorderColor:(0,utils._$)(mainColor,-20),hoverBackgroundColor:(0,utils._$)(mainColor,-20),backgroundColor:mainColor,fill:!1,borderWidth:2,pointRadius:0}}function ErrorsOverview(_ref4){let{pluginConfigId}=_ref4;const logic=(0,appMetricsLogic.t)({pluginConfigId}),{appMetricsResponse,appMetricsResponseLoading}=(0,index_esm.useValues)(logic),{openErrorDetailsModal}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ErrorDetailsModal,{pluginConfigId}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:appMetricsResponse?.errors||[],loading:appMetricsResponseLoading,columns:[{title:"Error type",dataIndex:"error_type",render:function RenderErrorType(_,errorSummary){return(0,jsx_runtime.jsx)(Link.r,{title:"View details",className:"font-semibold",onClick:event=>{event.preventDefault(),openErrorDetailsModal(errorSummary.error_type)},children:errorSummary.error_type})},sorter:(a,b)=>a.error_type.localeCompare(b.error_type)},{title:"Count",dataIndex:"count",align:"right",sorter:(a,b)=>a.count-b.count},{title:"Last seen",dataIndex:"last_seen",render:function RenderCreatedAt(lastSeen){return(0,jsx_runtime.jsx)("div",{className:"whitespace-nowrap text-right",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:lastSeen})})},align:"right",sorter:(a,b)=>new Date(a.last_seen||0)>new Date(b.last_seen||0)?1:-1}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:(0,jsx_runtime.jsxs)("div",{className:"",children:[(0,jsx_runtime.jsx)("b",{children:"No errors! ðŸ¥³"}),(0,jsx_runtime.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})]})}function ErrorDetailsModal(_ref5){let{pluginConfigId}=_ref5;const logic=(0,appMetricsLogic.t)({pluginConfigId}),{errorDetails,errorDetailsModalError,errorDetailsLoading}=(0,index_esm.useValues)(logic),{closeErrorDetailsModal}=(0,index_esm.useActions)(logic),[page,setPage]=(0,react.useState)(0),activeErrorDetails=errorDetails[page];return(0,jsx_runtime.jsx)(LemonModal.f,{isOpen:!!errorDetailsModalError,onClose:closeErrorDetailsModal,title:errorDetailsModalError,width:"min(50vw, 80rem)",description:(0,jsx_runtime.jsx)("span",{children:activeErrorDetails?.error_details?.error.message?.substring(0,200)}),footer:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("span",{children:[page+1," of ",errorDetails.length," sample",errorDetails.length>1?"s":""]}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.ed9,{}),onClick:()=>setPage(page-1),disabledReason:0==page?"First page":void 0}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.VG8,{}),onClick:()=>setPage(page+1),disabledReason:page==errorDetails.length-1?"Last page":void 0})]})}),children:!errorDetailsModalError||errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"When:"})," ",(0,jsx_runtime.jsx)(TZLabel.w,{time:activeErrorDetails.timestamp,showSeconds:!0})]}),activeErrorDetails.error_details.eventCount&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Event Count"}),(0,jsx_runtime.jsx)("div",{children:activeErrorDetails.error_details.eventCount})]}),activeErrorDetails.error_details.error.message&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Error message",defaultIsExpanded:!0,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.message})}),activeErrorDetails.error_details.event&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Event payload",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JSON,children:JSON.stringify(activeErrorDetails.error_details.event,null,2)})}),activeErrorDetails.error_details.error.stack&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Stack trace",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.stack})})]})})}function CollapsibleSection(props){const[isExpanded,setIsExpanded]=(0,react.useState)(props.defaultIsExpanded);return(0,jsx_runtime.jsxs)("div",{className:"bg-mid border rounded",children:[(0,jsx_runtime.jsx)(LemonButton.J,{fullWidth:!0,onClick:()=>setIsExpanded(!isExpanded),sideIcon:isExpanded?(0,jsx_runtime.jsx)(icons.GZ,{}):(0,jsx_runtime.jsx)(icons.So7,{}),title:isExpanded?"Show less":"Show more",className:"bg-mid",children:props.title}),isExpanded&&(0,jsx_runtime.jsx)("div",{className:"bg-bg-light p-2",children:props.children})]})}var kea_forms_lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),LemonMarkdown=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMarkdown/index.ts"),configUtils=__webpack_require__("./frontend/src/scenes/pipeline/configUtils.ts"),PluginField=__webpack_require__("./frontend/src/scenes/plugins/edit/PluginField.tsx"),sceneTypes=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),destinationsLogic=__webpack_require__("./frontend/src/scenes/pipeline/destinationsLogic.tsx");const pipelineAppLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)((_ref=>{let{id}=_ref;return id})),(0,index_esm.path)((id=>["scenes","pipeline","pipelineAppLogic",id])),(0,index_esm.connect)((()=>({values:[destinationsLogic.w,["plugins","pluginConfigs"]]}))),(0,index_esm.actions)({setCurrentTab:function(){return{tab:arguments.length>0&&void 0!==arguments[0]?arguments[0]:types.YU.Configuration}},setKind:kind=>({kind})}),(0,index_esm.reducers)({currentTab:[types.YU.Configuration,{setCurrentTab:(_,_ref2)=>{let{tab}=_ref2;return tab}}]}),(0,index_esm.selectors)((()=>({breadcrumbs:[(s,p)=>[p.id,p.kind,s.maybePluginConfig],(id,kind,maybePluginConfig)=>[{key:sceneTypes.x.Pipeline,name:"Data pipeline",path:urls.j.pipeline()},{key:kind,name:(0,utils.fm)(kind)},{key:[sceneTypes.x.PipelineApp,id],name:maybePluginConfig?.name||"Unknown"}]],appType:[(_,p)=>[p.id],id=>"number"==typeof id?"webhook":"batch_export"],maybePluginConfig:[(s,p)=>[s.pluginConfigs,s.appType,p.id],(pluginConfigs,appType,maybePluginConfigId)=>"webhook"!==appType?null:pluginConfigs[maybePluginConfigId]||null],maybePlugin:[s=>[s.plugins,s.maybePluginConfig],(plugins,maybePluginConfig)=>maybePluginConfig&&plugins[maybePluginConfig.plugin]||null]}))),(0,kea_forms_lib.forms)({configuration:{submit:()=>{}}}),(0,lib.actionToUrl)((_ref3=>{let{values,props}=_ref3;return{setCurrentTab:()=>[urls.j.pipelineApp(props.kind,props.id,values.currentTab)]}})),(0,lib.urlToAction)((_ref4=>{let{actions,values}=_ref4;return{"/pipeline/:kind/:id/:tab":_ref5=>{let{tab}=_ref5;tab!==values.currentTab&&Object.values(types.YU).includes(tab)&&actions.setCurrentTab(tab)}}}))]);function PipelineAppConfiguration(){const{appType}=(0,index_esm.useValues)(pipelineAppLogic);return"webhook"===appType?(0,jsx_runtime.jsx)(src.LemonWidget,{title:"Configuration",children:(0,jsx_runtime.jsx)(WebhookAppConfiguration,{})}):(0,jsx_runtime.jsx)("p",{children:"Unsupported app type"})}function WebhookAppConfiguration(){const{maybePlugin,maybePluginConfig,configuration}=(0,index_esm.useValues)(pipelineAppLogic),{resetConfiguration,setConfigurationValues}=(0,index_esm.useActions)(pipelineAppLogic),[invisibleFields,setInvisibleFields]=(0,react.useState)([]),[requiredFields,setRequiredFields]=(0,react.useState)([]),updateInvisibleAndRequiredFields=()=>{setInvisibleFields(maybePlugin?(0,configUtils.zl)((fieldName=>configuration[fieldName]),maybePlugin):[]),setRequiredFields(maybePlugin?(0,configUtils.fY)((fieldName=>configuration[fieldName]),maybePlugin):[])};if((0,react.useEffect)((()=>{maybePlugin&&maybePluginConfig?setConfigurationValues({...maybePluginConfig.config||(0,configUtils.NM)(maybePlugin),__enabled:maybePluginConfig.enabled}):resetConfiguration(),updateInvisibleAndRequiredFields()}),[maybePlugin?.id,maybePlugin?.config_schema]),!maybePlugin)return(0,jsx_runtime.jsx)("div",{className:"space-y-3 m-3",children:Array(3).fill(null).map(((_,index)=>(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"h-4 w-48"}),(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"h-9"})]},index)))});const fields=(0,configUtils.fN)(maybePlugin.config_schema).map(((fieldConfig,index)=>(0,jsx_runtime.jsx)(react.Fragment,{children:fieldConfig.key&&fieldConfig.type&&(0,configUtils.Zs)(fieldConfig)&&!invisibleFields.includes(fieldConfig.key)?(0,jsx_runtime.jsx)(Field.g,{label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[fieldConfig.secret&&(0,jsx_runtime.jsx)(src.Tooltip,{placement:"topLeft",title:"This field is write-only. Its value won't be visible after saving.",children:(0,jsx_runtime.jsx)(icons._V1,{className:"ml-1.5"})}),fieldConfig.markdown&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{children:fieldConfig.markdown}),fieldConfig.name||fieldConfig.key]}),help:fieldConfig.hint&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"mt-0.5",children:fieldConfig.hint}),name:fieldConfig.key,showOptional:!fieldConfig.required&&!requiredFields.includes(fieldConfig.key),children:(0,jsx_runtime.jsx)(PluginField.B,{fieldConfig,onChange:updateInvisibleAndRequiredFields})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:fieldConfig.type?(0,jsx_runtime.jsxs)("p",{className:"text-danger",children:["Invalid config field ",(0,jsx_runtime.jsx)("i",{children:fieldConfig.name||fieldConfig.key}),"."]}):null})},fieldConfig.key||`__key__${index}`)));return(0,jsx_runtime.jsx)(kea_forms_lib.Form,{logic:pipelineAppLogic,formKey:"configuration",className:"space-y-3 my-2 mx-3",children:fields})}const scene={component:PipelineApp,logic:pipelineAppLogic,paramsToProps:_ref=>{let{params:{kind,id}}=_ref;const numericId=id?parseInt(id):void 0;return{kind,id:numericId&&!isNaN(numericId)?numericId:id}}};function PipelineApp(){let{kind,id}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h);if(!featureFlags[constants.y8.PIPELINE_UI])return(0,jsx_runtime.jsx)("p",{children:"Pipeline 3000 not available yet"});if(!Object.values(types.OJ).includes(kind))return(0,jsx_runtime.jsx)(NotFound.T,{object:"pipeline app"});const{currentTab}=(0,index_esm.useValues)(pipelineAppLogic),confId=id?parseInt(id):void 0;if(!confId)return(0,jsx_runtime.jsx)(src.Spinner,{});const tabToContent={[types.YU.Configuration]:(0,jsx_runtime.jsx)(PipelineAppConfiguration,{}),[types.YU.Metrics]:(0,jsx_runtime.jsx)(AppMetrics,{pluginConfigId:confId}),[types.YU.Logs]:(0,jsx_runtime.jsx)(PluginLogs.b,{pluginConfigId:confId})};return(0,jsx_runtime.jsxs)("div",{className:"pipeline-app-scene",children:[(0,jsx_runtime.jsx)(PageHeader.m,{}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,onChange:tab=>lib.router.actions.push(urls.j.pipelineApp(kind,confId,tab)),tabs:Object.values(types.YU).map((tab=>({label:(0,utils.fm)(tab),key:tab,content:tabToContent[tab]})))})]})}},"./frontend/src/scenes/pipeline/appMetricsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{t:()=>appMetricsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/utils.tsx"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");const appMetricsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)((_ref=>{let{pluginConfigId}=_ref;return pluginConfigId})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)((id=>["scenes","pipeline","appMetricsLogic",id])),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic,["currentTeamId"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setDateFrom:dateFrom=>({dateFrom}),openErrorDetailsModal:errorType=>({errorType}),closeErrorDetailsModal:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)((_ref2=>{let{values,props}=_ref2;return{appMetricsResponse:[null,{loadMetrics:async()=>{const params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({date_from:values.dateFrom});return await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}?${params}`)}}],errorDetails:[[],{openErrorDetailsModal:async _ref3=>{let{errorType}=_ref3;const params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({error_type:errorType}),{result}=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}/error_details?${params}`);return result}}]}})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({dateFrom:["-7d",{setDateFrom:(_,_ref4)=>{let{dateFrom}=_ref4;return dateFrom}}],errorDetailsModalError:[null,{openErrorDetailsModal:(_,_ref5)=>{let{errorType}=_ref5;return errorType},closeErrorDetailsModal:()=>null}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((_ref6=>{let{actions}=_ref6;return{setDateFrom:()=>{actions.loadMetrics()}}})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref7=>{let{actions}=_ref7;actions.loadMetrics()}))])},"./frontend/src/scenes/pipeline/destinationsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>pipelineDestinationsLogic});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_plugins_access__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/plugins/access.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/urls.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");const pipelineDestinationsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","pipeline","destinationsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_5__.teamLogic,["currentTeamId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_7__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({toggleEnabled:(destination,enabled)=>({destination,enabled})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_2__.loaders)((_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>{const results=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.loadPaginatedResults("api/organizations/@current/pipeline_destinations"),plugins={};for(const plugin of results)plugins[plugin.id]=plugin;return plugins}}],pluginConfigs:[{},{loadPluginConfigs:async()=>{const pluginConfigs={},results=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/pipeline_destination_configs`);for(const pluginConfig of results)pluginConfigs[pluginConfig.id]={...pluginConfig,name:pluginConfig.name||values.plugins[pluginConfig.plugin]?.name||"Unknown app",description:pluginConfig.description||values.plugins[pluginConfig.plugin]?.description};return pluginConfigs},toggleEnabledWebhook:async _ref2=>{let{destination,enabled}=_ref2;if("batch_export"===destination.type)return values.pluginConfigs;if(!values.canConfigurePlugins)return values.pluginConfigs;const{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[destination.id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_9__.SO)("plugin "+(enabled?"enabled":"disabled"),plugin,pluginConfig);const response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.update(`api/plugin_config/${destination.id}`,{enabled});return{...pluginConfigs,[destination.id]:response}}}],batchExportConfigs:[{},{loadBatchExports:async()=>{const results=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/batch_exports`);return Object.fromEntries(results.map((batchExport=>[batchExport.id,batchExport])))},toggleEnabledBatchExport:async _ref3=>{let{destination,enabled}=_ref3;const batchExport=values.batchExportConfigs[destination.id];return enabled?await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.batchExports.pause(destination.id):await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.batchExports.unpause(destination.id),(0,_utils__WEBPACK_IMPORTED_MODULE_9__.hO)("batch export "+(enabled?"enabled":"disabled"),batchExport),{...values.batchExportConfigs,[destination.id]:{...batchExport,paused:!enabled}}}}]}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading,s.batchExportConfigsLoading],(pluginsLoading,pluginConfigsLoading,batchExportConfigsLoading)=>pluginsLoading||pluginConfigsLoading||batchExportConfigsLoading],enabledPluginConfigs:[s=>[s.pluginConfigs],pluginConfigs=>Object.values(pluginConfigs).filter((pc=>pc.enabled))],disabledPluginConfigs:[s=>[s.pluginConfigs],pluginConfigs=>Object.values(pluginConfigs).filter((pc=>!pc.enabled))],displayablePluginConfigs:[s=>[s.pluginConfigs,s.plugins],(pluginConfigs,plugins)=>Object.values(pluginConfigs).sort(((a,b)=>Number(b.enabled)-Number(a.enabled))).map((pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})))],destinations:[s=>[s.pluginConfigs,s.plugins,s.batchExportConfigs],(pluginConfigs,plugins,batchExportConfigs)=>[...Object.values(pluginConfigs).map((pluginConfig=>({type:"webhook",frequency:"realtime",id:pluginConfig.id,name:pluginConfig.name,description:pluginConfig.description,enabled:pluginConfig.enabled,config_url:scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.pipelineApp(_types__WEBPACK_IMPORTED_MODULE_8__.OJ.Destinations,pluginConfig.id,_types__WEBPACK_IMPORTED_MODULE_8__.YU.Configuration),metrics_url:scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.pipelineApp(_types__WEBPACK_IMPORTED_MODULE_8__.OJ.Destinations,pluginConfig.id,_types__WEBPACK_IMPORTED_MODULE_8__.YU.Metrics),logs_url:scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.pipelineApp(_types__WEBPACK_IMPORTED_MODULE_8__.OJ.Destinations,pluginConfig.id,_types__WEBPACK_IMPORTED_MODULE_8__.YU.Logs),app_source_code_url:"",plugin:plugins[pluginConfig.plugin],success_rates:{"24h":void 0===pluginConfig.delivery_rate_24h?null:pluginConfig.delivery_rate_24h,"7d":null},updated_at:pluginConfig.updated_at}))),...Object.values(batchExportConfigs).map((batchExport=>({type:"batch_export",frequency:batchExport.interval,id:batchExport.id,name:batchExport.name,description:`${batchExport.destination.type} batch export`,enabled:!batchExport.paused,config_url:scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.pipelineApp(_types__WEBPACK_IMPORTED_MODULE_8__.OJ.Destinations,batchExport.id,_types__WEBPACK_IMPORTED_MODULE_8__.YU.Configuration),metrics_url:scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.pipelineApp(_types__WEBPACK_IMPORTED_MODULE_8__.OJ.Destinations,batchExport.id,_types__WEBPACK_IMPORTED_MODULE_8__.YU.Metrics),logs_url:scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.pipelineApp(_types__WEBPACK_IMPORTED_MODULE_8__.OJ.Destinations,batchExport.id,_types__WEBPACK_IMPORTED_MODULE_8__.YU.Logs),success_rates:{"24h":[5,17],"7d":[12,100043]},updated_at:batchExport.created_at})))].sort(((a,b)=>Number(b.enabled)-Number(a.enabled)))],canConfigurePlugins:[s=>[s.user],user=>(0,scenes_plugins_access__WEBPACK_IMPORTED_MODULE_4__.z9)(user?.organization)],shouldShowProductIntroduction:[s=>[s.user],user=>!user?.has_seen_product_intro_for?.[_types__WEBPACK_IMPORTED_MODULE_8__.Md.PIPELINE_DESTINATIONS]]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)((_ref4=>{let{actions,values}=_ref4;return{toggleEnabled:async _ref5=>{let{destination,enabled}=_ref5;values.canConfigurePlugins?"webhook"===destination.type?actions.toggleEnabledWebhook({destination,enabled}):actions.toggleEnabledBatchExport({destination,enabled}):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("You don't have permission to enable or disable destinations")}}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.afterMount)((_ref6=>{let{actions}=_ref6;actions.loadPlugins(),actions.loadPluginConfigs(),actions.loadBatchExports()}))])},"./frontend/src/scenes/plugins/edit/PluginField.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>PluginField});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),CodeEditors=__webpack_require__("./frontend/src/lib/components/CodeEditors.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),AutoSizer=__webpack_require__("./node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),configUtils=__webpack_require__("./frontend/src/scenes/pipeline/configUtils.ts"),upload=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@18.2.0_react@18.2.0/node_modules/antd/es/upload/index.js"),es_button=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@18.2.0_react@18.2.0/node_modules/antd/es/button/index.js"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function UploadField(_ref){let{value,onChange}=_ref;return(0,jsx_runtime.jsx)(upload.Z,{multiple:!1,fileList:value?.size?[value]:[],beforeUpload:file=>(onChange?.(file),!1),onRemove:()=>(onChange?.(null),!1),className:"ph-ignore-input",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(icons.bn5,{}),children:"Click to upload"})})}function JsonConfigField(props){return(0,jsx_runtime.jsx)(AutoSizer.q,{disableWidth:!0,className:"min-h-60",children:_ref=>{let{height}=_ref;return(0,jsx_runtime.jsx)(CodeEditors.p,{className:"border",language:"json",value:props.value,onChange:v=>props.onChange(null!=v?v:""),height,options:{minimap:{enabled:!1}}})}})}function PluginField(_ref2){let{value,onChange,fieldConfig}=_ref2;const[editingSecret,setEditingSecret]=(0,react.useState)(!1);return!fieldConfig.secret||editingSecret||!value||value!==configUtils.ue&&value.name!==configUtils.ue?"attachment"===fieldConfig.type?(0,jsx_runtime.jsx)(UploadField,{value,onChange}):"string"===fieldConfig.type?(0,jsx_runtime.jsx)(src.LemonInput,{value,onChange,autoFocus:editingSecret,className:"ph-no-capture"}):"json"===fieldConfig.type?(0,jsx_runtime.jsx)(JsonConfigField,{value,onChange,autoFocus:editingSecret,className:"ph-no-capture"}):"choice"===fieldConfig.type?(0,jsx_runtime.jsx)(src.LemonSelect,{fullWidth:!0,value,className:"ph-no-capture",onChange,options:fieldConfig.choices.map((choice=>({label:choice,value:choice})))}):(0,jsx_runtime.jsxs)("strong",{className:"text-danger",children:['Unknown field type "',(0,jsx_runtime.jsx)("code",{children:fieldConfig.type}),'".',(0,jsx_runtime.jsx)("br",{}),"You may need to upgrade PostHog!"]}):(0,jsx_runtime.jsxs)(src.LemonButton,{type:"secondary",icon:(0,jsx_runtime.jsx)(icons.yl5,{}),onClick:()=>{onChange(fieldConfig.default||""),setEditingSecret(!0)},children:["Reset secret ","attachment"===fieldConfig.type?"attachment":"field"]})}},"./frontend/src/scenes/plugins/plugin/PluginLogs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{b:()=>PluginLogs});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),types=__webpack_require__("./frontend/src/types.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");const pluginLogsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)((_ref=>{let{pluginConfigId}=_ref;return pluginConfigId})),(0,index_esm.path)((key=>["scenes","plugins","plugin","pluginLogsLogic",key])),(0,index_esm.connect)({values:[teamLogic.teamLogic,["currentTeamId"]]}),(0,index_esm.actions)({clearPluginLogsBackground:!0,markLogsEnd:!0,setPluginLogsTypes:typeFilters=>({typeFilters}),setSearchTerm:searchTerm=>({searchTerm})}),(0,lib.loaders)((_ref2=>{let{props:{pluginConfigId},values,actions,cache}=_ref2;return{pluginLogs:{__default:[],loadPluginLogs:async()=>{const results=await api.ZP.pluginLogs.search(pluginConfigId,values.currentTeamId,values.searchTerm,values.typeFilters);return cache.pollingInterval||(cache.pollingInterval=setInterval(actions.loadPluginLogsBackgroundPoll,2e3)),actions.clearPluginLogsBackground(),results},loadPluginLogsMore:async()=>{const results=await api.ZP.pluginLogs.search(pluginConfigId,values.currentTeamId,values.searchTerm,values.typeFilters,values.trailingEntry);return results.length<constants.F2&&actions.markLogsEnd(),[...values.pluginLogs,...results]},revealBackground:()=>{const newArray=[...values.pluginLogsBackground,...values.pluginLogs];return actions.clearPluginLogsBackground(),newArray}},pluginLogsBackground:{__default:[],loadPluginLogsBackgroundPoll:async()=>{if(values.pluginLogsLoading)return values.pluginLogsBackground;return[...await api.ZP.pluginLogs.search(pluginConfigId,values.currentTeamId,values.searchTerm,values.typeFilters,null,values.leadingEntry),...values.pluginLogsBackground]}}}})),(0,index_esm.reducers)({pluginLogsTypes:[Object.values(types.oX).filter((type=>"DEBUG"!==type)),{setPluginLogsTypes:(_,_ref3)=>{let{typeFilters}=_ref3;return typeFilters.map((tf=>tf))}}],pluginLogsBackground:[[],{clearPluginLogsBackground:()=>[]}],searchTerm:["",{setSearchTerm:(_,_ref4)=>{let{searchTerm}=_ref4;return searchTerm}}],typeFilters:[Object.values(types.oX).filter((type=>"DEBUG"!==type)),{setPluginLogsTypes:(_,_ref5)=>{let{typeFilters}=_ref5;return typeFilters||[]}}],isThereMoreToLoad:[!0,{loadPluginLogsSuccess:(_,_ref6)=>{let{pluginLogs}=_ref6;return pluginLogs.length>=constants.F2},markLogsEnd:()=>!1}]}),(0,index_esm.selectors)((_ref7=>{let{selectors}=_ref7;return{leadingEntry:[()=>[selectors.pluginLogs,selectors.pluginLogsBackground],(pluginLogs,pluginLogsBackground)=>pluginLogsBackground.length?pluginLogsBackground[0]:pluginLogs.length?pluginLogs[0]:null],trailingEntry:[()=>[selectors.pluginLogs,selectors.pluginLogsBackground],(pluginLogs,pluginLogsBackground)=>pluginLogs.length?pluginLogs[pluginLogs.length-1]:pluginLogsBackground.length?pluginLogsBackground[pluginLogsBackground.length-1]:null]}})),(0,index_esm.listeners)((_ref8=>{let{actions}=_ref8;return{setPluginLogsTypes:()=>{actions.loadPluginLogs()},setSearchTerm:async(_ref9,breakpoint)=>{let{searchTerm}=_ref9;searchTerm&&await breakpoint(1e3),actions.loadPluginLogs()}}})),(0,index_esm.events)((_ref10=>{let{actions,cache}=_ref10;return{afterMount:()=>{actions.loadPluginLogs()},beforeUnmount:()=>{clearInterval(cache.pollingInterval)}}}))]);var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const columns=[{title:"Timestamp",key:"timestamp",dataIndex:"timestamp",render:timestamp=>(0,dayjs.Bv)(timestamp).format("YYYY-MM-DD HH:mm:ss.SSS UTC")},{title:"Source",dataIndex:"source",key:"source"},{title:"Type",key:"type",dataIndex:"type",render:function PluginLogEntryTypeDisplay(type){let color;switch(type){case types.oX.Debug:color="text-muted";break;case types.oX.Log:color="text-default";break;case types.oX.Info:color="text-primary";break;case types.oX.Warn:color="text-warning";break;case types.oX.Error:color="text-danger"}return(0,jsx_runtime.jsx)("span",{className:color,children:type})}},{title:"Message",key:"message",dataIndex:"message",render:message=>(0,jsx_runtime.jsx)("code",{className:"whitespace-pre-wrap",children:message})}];function PluginLogs(_ref){let{pluginConfigId}=_ref;const logic=pluginLogsLogic({pluginConfigId}),{pluginLogs,pluginLogsLoading,pluginLogsBackground,isThereMoreToLoad,pluginLogsTypes}=(0,index_esm.useValues)(logic),{revealBackground,loadPluginLogsMore,setPluginLogsTypes,setSearchTerm}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"ph-no-capture space-y-2 flex-1",children:[(0,jsx_runtime.jsx)(src.LemonInput,{type:"search",placeholder:"Search for messages containingâ€¦",fullWidth:!0,onChange:setSearchTerm,allowClear:!0}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4",children:[(0,jsx_runtime.jsx)("span",{children:"Show logs of type:Â "}),Object.values(types.oX).map((type=>(0,jsx_runtime.jsx)(src.LemonCheckbox,{label:type,checked:pluginLogsTypes.includes(type),onChange:checked=>{const newPluginLogsTypes=checked?[...pluginLogsTypes,type]:pluginLogsTypes.filter((t=>t!=type));setPluginLogsTypes(newPluginLogsTypes)}},type)))]}),(0,jsx_runtime.jsx)(src.LemonButton,{onClick:revealBackground,loading:pluginLogsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:pluginLogsBackground.length?void 0:"There's nothing to load",children:pluginLogsBackground.length?`Load ${(0,utils._6)(pluginLogsBackground.length,"newer entry","newer entries")}`:"No new entries"}),(0,jsx_runtime.jsx)(src.LemonTable,{dataSource:pluginLogs,columns,loading:pluginLogsLoading,size:"small",className:"ph-no-capture",rowKey:"id",pagination:{pageSize:200,hideOnSinglePage:!0}}),!!pluginLogs.length&&(0,jsx_runtime.jsx)(src.LemonButton,{onClick:loadPluginLogsMore,loading:pluginLogsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:isThereMoreToLoad?void 0:"There's nothing more to load",children:isThereMoreToLoad?`Load up to ${constants.F2} older entries`:"No older entries"})]})}}}]);