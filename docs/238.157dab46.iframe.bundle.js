(window.webpackJsonp=window.webpackJsonp||[]).push([[238],{"./frontend/src/scenes/actions/Action.tsx":function(G,O,a){"use strict";a.r(O),a.d(O,"scene",function(){return vt}),a.d(O,"Action",function(){return te});var H=a("./node_modules/core-js/modules/es.array.concat.js"),K=a("./node_modules/react/index.js"),e=a.n(K),ve=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),T=a.n(ve),p=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),J=a.n(p),Pe=a("./node_modules/core-js/modules/es.array.map.js"),De=a("./node_modules/core-js/modules/es.array.filter.js"),fe=a("./node_modules/core-js/modules/es.object.to-string.js"),ae=a("./node_modules/core-js/modules/es.object.keys.js"),He=a("./node_modules/core-js/modules/es.symbol.js"),Je=a("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Re=a("./node_modules/core-js/modules/web.dom-collections.for-each.js"),ge=a("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),P=a("./frontend/src/lib/utils.tsx"),he=a("./frontend/src/lib/components/Link.tsx"),h=a("./node_modules/kea/lib/index.esm.js"),D=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),$=a.n(D),Ee=a("./node_modules/@babel/runtime/regenerator/index.js"),C=a.n(Ee),ye=a("./node_modules/core-js/modules/es.function.name.js"),Fe=a("./node_modules/core-js/modules/es.array.iterator.js"),X=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),oe=a("./node_modules/core-js/modules/es.regexp.exec.js"),be=a("./node_modules/core-js/modules/es.string.split.js"),R=a("./frontend/src/lib/api.ts"),re=a("./frontend/src/models/actionsModel.ts"),x=a("./frontend/src/lib/components/lemonToast.tsx"),Ae=a("./node_modules/kea-loaders/lib/index.js"),je=a("./node_modules/kea-forms/lib/index.js"),w=a("./node_modules/kea-router/lib/index.js"),j=a("./frontend/src/scenes/urls.ts"),Q=a("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts"),Oe=a("./frontend/src/lib/logic/featureFlagLogic.ts"),L=a("./frontend/src/lib/constants.tsx"),Y=Object(h.kea)({props:{},key:function(t){return t.id||"new"},path:function(t){return["scenes","actions","actionLogic",t]},actions:function(){return{checkIsFinished:function(o){return{action:o}},setPollTimeout:function(o){return{pollTimeout:o}},setIsComplete:function(o){return{isComplete:o}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(o,r){var s=r.pollTimeout;return s}}],isComplete:[!1,{setIsComplete:function(o,r){var s=r.isComplete;return s}}]}},selectors:{shouldSimplifyActions:[function(){return[Oe.a.selectors.featureFlags]},function(n){return!!n[L.h.SIMPLIFY_ACTIONS]}],breadcrumbs:[function(n){return[n.action,n.shouldSimplifyActions]},function(n,t){return[].concat(J()(t?[{name:"Data Management",path:j.a.eventDefinitions()},{name:"Events",path:j.a.eventDefinitions()}]:[{name:"Data Management",path:j.a.actions()}]),[{name:(n==null?void 0:n.name)||"Unnamed",path:n?j.a.action(n.id):void 0}])}]},loaders:function(t){var o=t.actions,r=t.props;return{action:{loadAction:function(){var s=$()(C.a.mark(function d(){var g;return C.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(o.setIsComplete(!1),r.id){i.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return i.next=5,R.b.actions.get(r.id);case 5:return g=i.sent,o.checkIsFinished(g),i.abrupt("return",g);case 8:case"end":return i.stop()}},d)}));function c(){return s.apply(this,arguments)}return c}()}}},listeners:function(t){var o=t.actions,r=t.values;return{checkIsFinished:function(c){var d=c.action;d.is_calculating?o.setPollTimeout(setTimeout(function(){return o.loadAction()},1e3)):(o.setIsComplete(new Date),r.pollTimeout&&clearTimeout(r.pollTimeout))}}},events:function(t){var o=t.values,r=t.actions,s=t.props;return{afterMount:function(){s.id&&r.loadAction()},beforeUnmount:function(){o.pollTimeout&&clearTimeout(o.pollTimeout)}}}});function Z(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),o.push.apply(o,r)}return o}function F(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?Z(Object(o),!0).forEach(function(r){T()(n,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Z(Object(o)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))})}return n}var se=Object(h.kea)([Object(h.path)(["scenes","actions","actionEditLogic"]),Object(h.props)({}),Object(h.key)(function(n){return n.id||"new"}),Object(h.actions)({setAction:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:t,options:o}},setCreateNew:function(t){return{createNew:t}},actionAlreadyExists:function(t){return{actionId:t}},deleteAction:!0}),Object(h.connect)(function(n){return{values:[Y({id:n.id}),["shouldSimplifyActions"]],actions:[re.a,["loadActions"],Q.c,["loadEventDefinitions"]]}}),Object(h.reducers)({createNew:[!1,{setCreateNew:function(t,o){var r=o.createNew;return r}}]}),Object(je.forms)(function(n){var t=n.actions,o=n.props;return{action:{defaults:F({},o.action),errors:function(s){var c=s.name;return{name:c?null:"You need to set a name"}},submit:function(s){t.saveAction(s)}}}}),Object(Ae.loaders)(function(n){var t=n.props,o=n.values,r=n.actions;return{actionCount:{loadActionCount:function(){var s=$()(C.a.mark(function d(){return C.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!t.id){l.next=6;break}return l.next=3,R.b.actions.getCount(t.id);case 3:l.t0=l.sent,l.next=7;break;case 6:l.t0=0;case 7:return l.abrupt("return",l.t0);case 8:case"end":return l.stop()}},d)}));function c(){return s.apply(this,arguments)}return c}()},action:[F({},t.action),{setAction:function(c){var d=c.action,g=c.options.merge;return g?F(F({},o.action),d):d},saveAction:function(){var s=$()(C.a.mark(function d(g,l){var i,E;return C.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(i=F({},g),i.steps=i.steps?i.steps.filter(function(me){return me.event}):[],u.prev=2,!i.id){u.next=9;break}return u.next=6,R.b.actions.update(i.id,i,t.temporaryToken);case 6:i=u.sent,u.next=12;break;case 9:return u.next=11,R.b.actions.create(i,t.temporaryToken);case 11:i=u.sent;case 12:l(),u.next=22;break;case 15:if(u.prev=15,u.t0=u.catch(2),u.t0.code!=="unique"){u.next=21;break}return E=u.t0.detail.split(" ").pop(),dt(E,o.shouldSimplifyActions),u.abrupt("return",i);case 21:throw u.t0;case 22:return x.d.success("".concat(o.shouldSimplifyActions?"Event":"Action"," saved")),t.onSave(i),o.shouldSimplifyActions?r.loadEventDefinitions(null):r.loadActions(),u.abrupt("return",i);case 26:case"end":return u.stop()}},d,null,[[2,15]])}));function c(d,g){return s.apply(this,arguments)}return c}()}]}}),Object(h.listeners)(function(n){var t=n.values,o=n.actions;return{deleteAction:function(){Object(P.x)({endpoint:R.b.actions.determineDeleteEndpoint(),object:t.action,callback:function(){w.router.actions.push(t.shouldSimplifyActions?j.a.eventDefinitions():j.a.actions()),t.shouldSimplifyActions?o.loadEventDefinitions(null):o.loadActions()}})}}}),Object(h.afterMount)(function(n){var t=n.actions,o=n.props;o.id?t.loadActionCount():t.setAction({name:"",steps:[{isNew:Object(P.Eb)()}]},{merge:!1})})]),ze=a("./frontend/src/scenes/actions/Actions.scss"),Se=a("./frontend/src/scenes/actions/EventName.tsx"),Ce=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),le=a.n(Ce),I=a("./frontend/src/scenes/teamLogic.tsx"),v=a("./node_modules/antd/es/button/index.js"),q=a("./node_modules/antd/es/modal/index.js"),z=a("./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx"),S=a("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts");function B(n){var t,o=n.actionId,r=n.style,s=n.children,c=Object(K.useState)(!1),d=le()(c,2),g=d[0],l=d[1],i=Object(h.useValues)(I.a),E=i.currentTeam;return e.a.createElement(e.a.Fragment,null,e.a.createElement(v.a,{href:Object(S.b)(E==null||(t=E.app_urls)===null||t===void 0?void 0:t[0],o),style:r,size:"small",onClick:function(u){u.preventDefault(),l(!0)}},s),e.a.createElement(q.a,{visible:g,title:o?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:e.a.createElement(v.a,{onClick:function(){return l(!1)}},"Close"),onCancel:function(){return l(!1)}},e.a.createElement(z.a,{actionId:o,pageKey:"app-editor-link"})))}try{B.displayName="AppEditorLink",B.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:B.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(n){}var Te=a("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),ie=a("./frontend/src/lib/components/Tooltip.tsx"),M=a("./frontend/src/scenes/actions/hints.tsx"),W=a("./node_modules/antd/es/typography/index.js"),_=a("./node_modules/antd/es/col/index.js"),xe=a("./node_modules/antd/es/card/index.js"),ce=a("./node_modules/antd/es/input/index.js"),Xe=a("./node_modules/antd/es/space/index.js"),N=a("./node_modules/antd/es/radio/index.js"),Qe=a("./node_modules/@ant-design/icons/es/icons/ExportOutlined.js"),Be=a("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js");function Me(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),o.push.apply(o,r)}return o}function A(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?Me(Object(o),!0).forEach(function(r){T()(n,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Me(Object(o)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))})}return n}var Ve=W.a.Text,Ke="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function de(n){var t=n.step,o=n.actionId,r=n.isOnlyStep,s=n.index,c=n.identifier,d=n.onDelete,g=n.onChange,l=function(E){g(E)};return e.a.createElement(_.a,{span:24,md:12},e.a.createElement(xe.a,{className:"action-step",style:{overflow:"visible"}},s>0&&e.a.createElement("div",{className:"stateful-badge pos-center-end or"},"OR"),e.a.createElement("div",null,!r&&e.a.createElement("div",{className:"remove-wrapper"},e.a.createElement("button",{type:"button","aria-label":"delete",onClick:d},e.a.createElement("span",{"aria-hidden":"true"},"\xD7"))),e.a.createElement("div",{className:"mb"},e.a.createElement("b",null,"Match Group #",s+1)),e.a.createElement(qe,{step:t,sendStep:l}),e.a.createElement("div",{style:{marginTop:t.event==="$pageview"?20:8,paddingBottom:0}},t.event==="$autocapture"&&e.a.createElement(Ze,{step:t,sendStep:l,actionId:o}),t.event!=null&&t.event!=="$autocapture"&&t.event!=="$pageview"&&e.a.createElement("div",{style:{marginTop:"2rem"}},e.a.createElement("label",null,e.a.createElement("b",null,"Event name: ")),e.a.createElement(Se.a,{value:t.event,onChange:function(E){return l(A(A({},t),{},{event:E||""}))}}),e.a.createElement("br",null),e.a.createElement("small",null,e.a.createElement("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer"},"See documentation")," ","on how to send custom events in lots of languages.")),t.event==="$pageview"&&e.a.createElement("div",null,e.a.createElement(ee,{step:t,sendStep:l,item:"url",extra_options:e.a.createElement($e,{step:t,sendStep:l}),label:"URL"}),t.url_matching&&t.url_matching in M.a&&e.a.createElement("small",{style:{display:"block",marginTop:-12}},M.a[t.url_matching])),t.event&&e.a.createElement("div",{className:"action-property-filters"},e.a.createElement("h3",{className:"l3"},"Filters"),(!t.properties||t.properties.length===0)&&e.a.createElement("div",{className:"text-muted"},"This match group has no additional filters."),e.a.createElement(Te.a,{propertyFilters:t.properties,pageKey:c,eventNames:t.event?[t.event]:[],onChange:function(E){l(A(A({},t),{},{properties:E}))},showConditionBadge:!0}))))))}function ee(n){var t=function(r){return n.sendStep(A(A({},n.step),{},T()({},n.item,r.target.value||null)))};return e.a.createElement("div",{className:"mb"},e.a.createElement("label",{style:{fontWeight:"bold"}},n.label," ",n.extra_options),n.caption&&e.a.createElement("div",{className:"action-step-caption"},n.caption),n.item==="selector"?e.a.createElement(ce.a.TextArea,{allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}):e.a.createElement(ce.a,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}))}function Ze(n){var t=n.step,o=n.actionId,r=n.sendStep,s=function(){return e.a.createElement("div",{className:"text-center"},e.a.createElement("span",{className:"stateful-badge and"},"AND"))};return e.a.createElement("div",null,e.a.createElement("span",null,e.a.createElement(B,{actionId:o,style:{margin:"1rem 0"}},"Select element on site ",e.a.createElement(Qe.a,null)),e.a.createElement("a",{href:"".concat(Ke,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8}},"See documentation.")," "),e.a.createElement(ee,{step:t,sendStep:r,item:"href",label:"Link target equals",caption:e.a.createElement(e.a.Fragment,null,"If your element is a link, the location that the link opens (",e.a.createElement("code",null,"href")," tag)")}),e.a.createElement(s,null),e.a.createElement(ee,{step:t,sendStep:r,item:"text",label:"Text equals",caption:"Text content inside your element"}),e.a.createElement(s,null),e.a.createElement(ee,{step:t,sendStep:r,item:"selector",label:e.a.createElement(e.a.Fragment,null,"HTML selector matches",e.a.createElement(ie.a,{title:"Click here to learn more about supported selectors"},e.a.createElement("a",{href:"".concat(Ke,"#matching-selectors"),target:"_blank",rel:"noopener"},e.a.createElement(Be.a,{style:{marginLeft:4}})))),placeholder:'button[data-attr="my-id"]',caption:e.a.createElement(Xe.b,{direction:"vertical"},e.a.createElement(Ve,{style:{color:"var(--muted)"}},"CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",e.a.createElement(Ve,{code:!0},'[data-attr="signup"]')))}),e.a.createElement("div",{style:{marginBottom:18}},e.a.createElement(s,null)),e.a.createElement(ee,{step:t,sendStep:r,item:"url",extra_options:e.a.createElement($e,{step:t,sendStep:r}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(t==null?void 0:t.url_matching)&&t.url_matching in M.a&&e.a.createElement("small",{style:{display:"block",marginTop:-12}},M.a[t.url_matching]))}function qe(n){var t=n.step,o=n.sendStep,r=function(c){var d=c.target.value;d==="$autocapture"?o(A(A({},t),{},{event:"$autocapture"})):d==="event"?o(A(A({},t),{},{event:""})):d==="$pageview"&&o(A(A({},t),{},{event:"$pageview",url:t.url}))};return e.a.createElement("div",{className:"type-switcher"},e.a.createElement(N.a.Group,{buttonStyle:"solid",onChange:r,value:t.event==="$autocapture"||t.event==="$pageview"||t.event===void 0?t.event:"event"},e.a.createElement(N.a.Button,{value:"$autocapture"},"Autocapture"),e.a.createElement(N.a.Button,{value:"event"},"Event"),e.a.createElement(N.a.Button,{value:"$pageview"},"Page view")))}function $e(n){var t=n.step,o=n.sendStep,r=function(c){o(A(A({},t),{},{url_matching:c.target.value}))};return e.a.createElement(N.a.Group,{buttonStyle:"solid",onChange:r,value:t.url_matching||"contains",size:"small"},e.a.createElement(N.a.Button,{value:"contains"},"contains"),e.a.createElement(N.a.Button,{value:"regex"},"matches regex"),e.a.createElement(N.a.Button,{value:"exact"},"matches exactly"))}try{de.displayName="ActionStep",de.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:de.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(n){}var _e=a("./node_modules/antd/es/row/index.js"),et=a("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),tt=a("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),nt=a("./frontend/src/lib/components/PageHeader.tsx"),we=a("./frontend/src/lib/components/EditableField/EditableField.tsx"),at=a("./frontend/src/types.ts"),ot=a("./frontend/src/scenes/userLogic.ts"),rt=a("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),st=a("./frontend/src/lib/forms/VerticalForm.tsx"),V=a("./frontend/src/lib/forms/Field.tsx"),Le=a("./frontend/src/lib/components/LemonButton/index.ts"),lt=a("./frontend/src/lib/components/LemonCheckbox/index.ts"),it=a("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function Ye(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),o.push.apply(o,r)}return o}function ct(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?Ye(Object(o),!0).forEach(function(r){T()(n,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Ye(Object(o)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))})}return n}function ue(n){var t=n.action,o=n.id,r=n.onSave,s=n.temporaryToken,c={id:o,action:t,onSave:function(m){return r(m)},temporaryToken:s},d=se(c),g=Object(h.useValues)(d),l=g.action,i=g.actionLoading,E=g.actionCount,k=g.actionCountLoading,u=g.shouldSimplifyActions,me=Object(h.useActions)(d),We=me.submitAction,ft=me.deleteAction,gt=Object(h.useValues)(I.a),Ie=gt.currentTeam,ht=Object(h.useValues)(ot.a),Et=ht.hasAvailableFeature,Ne=Ie==null?void 0:Ie.slack_incoming_webhook,ke=function(){return e.a.createElement(Le.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",style:{marginRight:8},onClick:function(){ft()}},"Delete")},Ge=function(){return e.a.createElement(Le.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",style:{marginRight:8},onClick:function(){w.router.actions.push(u?j.a.eventDefinitions():j.a.actions())}},"Cancel")};return e.a.createElement("div",{className:"action-edit-container"},e.a.createElement(st.a,{logic:se,props:c,formKey:"action",enableFormOnSubmit:!0},e.a.createElement(nt.a,{title:e.a.createElement(V.a,{name:"name"},function(f){var m=f.value,b=f.onChange;return e.a.createElement(we.a,{name:"name",value:m||"",placeholder:"Name this ".concat(u?"event":"action"),onChange:o?void 0:b,onSave:function(U){b(U),We()},mode:o?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(o?"edit":"create"),className:"action-name"})}),caption:e.a.createElement(e.a.Fragment,null,e.a.createElement(V.a,{name:"description",showOptional:!0},function(f){var m=f.value,b=f.onChange;return e.a.createElement(we.a,{multiline:!0,name:"description",value:m||"",placeholder:"Description (optional)",onChange:o?void 0:b,onSave:function(U){b(U),We()},mode:o?void 0:"edit",autoFocus:!!o,"data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!Et(at.d.INGESTION_TAXONOMY)})}),e.a.createElement(V.a,{name:"tags",showOptional:!0},function(f){var m=f.value,b=f.onChange;return e.a.createElement(rt.a,{tags:m!=null?m:[],onChange:function(U,Ue){return b(Ue)},className:"action-tags",saving:i})})),buttons:o?ke():Ge()}),o&&e.a.createElement("div",{className:"input-set"},e.a.createElement("div",null,e.a.createElement("span",{className:"text-muted mb-05"},k&&e.a.createElement(et.a,null),E!==null&&E>-1&&e.a.createElement(e.a.Fragment,null,"This ",u?"event":"action"," matches"," ",e.a.createElement("b",null,Object(P.q)(E))," raw events in the last 3 months")))),e.a.createElement("div",{style:{overflow:"visible"}},e.a.createElement("h2",{className:"subtitle"},"Match groups"),e.a.createElement("div",null,"Your ",u?"event":"action"," will be triggered whenever"," ",e.a.createElement("b",null,"any of your match groups")," are received."," ",e.a.createElement("a",{href:"https://posthog.com/docs/features/actions",target:"_blank"},e.a.createElement(Be.a,null))),e.a.createElement(V.a,{name:"steps"},function(f){var m=f.onChange;return e.a.createElement("div",{style:{textAlign:"right",marginBottom:12}},e.a.createElement(v.a,{onClick:function(){return m([].concat(J()(l.steps||[]),[{isNew:Object(P.Eb)()}]))},size:"small"},"Add another match group"))}),e.a.createElement(V.a,{name:"steps"},function(f){var m=f.value,b=f.onChange;return e.a.createElement(_e.a,{gutter:[24,24]},e.a.createElement(e.a.Fragment,null,m==null?void 0:m.map(function(y,U){return e.a.createElement(de,{key:y.id||y.isNew,identifier:String(y.id||y.isNew),index:U,step:y,actionId:l.id||0,isOnlyStep:!!m&&m.length===1,onDelete:function(){var pe=y.id?"id":"isNew";b(m==null?void 0:m.filter(function(ne){return ne[pe]!==y[pe]}))},onChange:function(pe){b(m==null?void 0:m.map(function(ne){return y.id&&ne.id==y.id||y.isNew&&ne.isNew===y.isNew?ct({id:y.id,isNew:y.isNew},pe):ne}))}})})),e.a.createElement(_.a,{span:24,md:12},e.a.createElement("div",{className:"match-group-add-skeleton",onClick:function(){b([].concat(J()(l.steps||[]),[{isNew:Object(P.Eb)()}]))}},e.a.createElement(tt.a,{style:{fontSize:28,color:"#666666"}}))))})),e.a.createElement("div",null,e.a.createElement("div",{style:{marginTop:"2rem"}},e.a.createElement("h2",{className:"subtitle"},"Match groups"),e.a.createElement(V.a,{name:"post_to_slack"},function(f){var m=f.value,b=f.onChange;return e.a.createElement(lt.a,{id:"webhook-checkbox",checked:!!m,onChange:function(U){return b(U.target.checked)},rowProps:{fullWidth:!0},disabled:!Ne,label:e.a.createElement(e.a.Fragment,null,"Post to webhook when this ",u?"event":"action"," is triggered.",e.a.createElement(he.a,{to:"/project/settings#webhook",style:{marginLeft:4}},Ne?"Configure":"Enable"," this integration in Setup."))})}),l.post_to_slack&&e.a.createElement(e.a.Fragment,null,e.a.createElement(V.a,{name:"slack_message_format"},function(f){var m=f.value,b=f.onChange;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",null,"Message format (optional)"),e.a.createElement(it.a,{placeholder:"Default: [action.name] triggered by [person]",value:m,onChange:b,disabled:!Ne||!l.post_to_slack,"data-attr":"edit-slack-message-format"}),e.a.createElement("small",null,e.a.createElement("a",{href:"https://posthog.com/docs/integrations/message-formatting/",target:"_blank",rel:"noopener noreferrer"},"See documentation on how to format webhook messages.")))})))),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},o?ke():Ge(),e.a.createElement(Le.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:i},"Save"))))}function dt(n,t){x.d.error(e.a.createElement(e.a.Fragment,null,t?"Event":"Action"," with this name already exists."," ",e.a.createElement("a",{href:j.a.action(n)},"Click here to edit.")))}try{ue.displayName="ActionEdit",ue.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:ue.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(n){}var ut=a("./frontend/src/scenes/events/index.ts"),mt=a("./frontend/src/lib/dayjs.ts"),pt=a("./frontend/src/lib/components/Spinner/Spinner.tsx"),vt={logic:Y,component:te,paramsToProps:function(t){var o=t.params.id;return{id:parseInt(o)}}};function te(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.id,o={action_id:t},r=Object(h.useActions)(w.router),s=r.push,c=Object(h.useValues)(Y),d=c.action,g=c.isComplete,l=c.shouldSimplifyActions,i=Object(h.useActions)(Y),E=i.loadAction;return e.a.createElement(e.a.Fragment,null,(!t||d)&&e.a.createElement(ue,{id:t,action:d,onSave:function(u){t||s(j.a.action(u.id)),E()}}),t&&(g?e.a.createElement("div",null,e.a.createElement("h2",{className:"subtitle"},"Matching events"),e.a.createElement("p",null,"This is the list of ",e.a.createElement("strong",null,"recent")," raw events that match this"," ",l?"event":"action",".",d!=null&&d.last_calculated_at?e.a.createElement(e.a.Fragment,null," ","Last calculated: ",e.a.createElement("b",null,Object(mt.a)(d.last_calculated_at).fromNow()),"."):""),e.a.createElement(ut.a,{fixedFilters:o,sceneUrl:j.a.action(t),fetchMonths:3,pageKey:"action-".concat(t,"-").concat(JSON.stringify(o)),showEventFilter:!1})):e.a.createElement("div",null,e.a.createElement("h2",{className:"subtitle"},"Matching events"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(pt.a,{style:{marginRight:12}}),"Calculating action, please hold on."))))}try{te.displayName="Action",te.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:te.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(n){}},"./frontend/src/scenes/events/index.ts":function(G,O,a){"use strict";var H=a("./frontend/src/scenes/events/EventDetails.tsx"),K=a("./frontend/src/scenes/events/EventElements.tsx"),e=a("./frontend/src/scenes/events/EventsTable.tsx");a.d(O,"a",function(){return e.a});var ve=a("./frontend/src/scenes/events/eventsTableLogic.ts")},"./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx":function(G,O,a){"use strict";a.d(O,"a",function(){return X});var H=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),K=a.n(H),e=a("./node_modules/core-js/modules/es.regexp.exec.js"),ve=a("./node_modules/core-js/modules/es.string.match.js"),T=a("./node_modules/react/index.js"),p=a.n(T),J=a("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Pe=a.n(J),De=a("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss"),fe=a.n(De),ae={};ae.insert="head",ae.singleton=!1;var He=Pe()(fe.a,ae),Je=fe.a.locals||{},Re=a("./node_modules/clsx/dist/clsx.m.js"),ge=a("./node_modules/kea/lib/index.esm.js"),P=a("./frontend/src/lib/components/LemonTable/index.ts"),he=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),h=a("./node_modules/@ant-design/icons/es/icons/CheckCircleFilled.js"),D=a("./frontend/src/lib/components/LemonButton/index.ts"),$=a("./node_modules/antd/es/input/index.js"),Ee=a("./node_modules/antd/es/button/index.js"),C=a("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts"),ye=a("./frontend/src/lib/utils.tsx"),Fe=a("./frontend/src/lib/components/LemonButton/More.tsx");function X(oe){var be=oe.pageKey,R=oe.actionId,re=Object(C.c)({actionId:R}),x=Object(ge.useValues)(re),Ae=x.appUrlsKeyed,je=x.suggestionsLoading,w=x.searchTerm,j=x.launchUrl,Q=x.appUrls,Oe=x.editUrlIndex,L=Object(ge.useActions)(re),Y=L.addUrl,Z=L.removeUrl,F=L.setSearchTerm,se=L.updateUrl,ze=L.newUrl,Se=L.setEditUrlIndex,Ce=[{title:"URLs",dataIndex:"url",key:"url",render:function(I,v){var q=Object(T.useState)(v.url),z=K()(q,2),S=z[0],B=z[1],Te=Object(T.useState)(""),ie=K()(Te,2),M=ie[0],W=ie[1];Object(T.useEffect)(function(){return B(v.url)},[v]);var _=function(){if(W(""),S===C.a&&Z(v.originalIndex),S.indexOf("*")>-1&&!S.match(/^(.*)\*[^\*]*\.[^\*]+\.[^\*]+$/)){W("You can only wildcard subdomains. If you wildcard the domain or TLD, people might be able to gain access to your PostHog data.");return}if(!Object(ye.gb)(S)){W("Please type a valid URL or domain.");return}if(Q.indexOf(S)>-1&&Q.indexOf(S,v.originalIndex)!==v.originalIndex&&Q.indexOf(S,v.originalIndex+1)!==v.originalIndex){W("This URL is already registered.");return}se(v.originalIndex,S)};return v.type==="suggestion"||I!==C.a&&Oe!==v.originalIndex?p.a.createElement("div",{className:Object(Re.a)("authorized-url-col",v.type)},v.type==="authorized"&&p.a.createElement(h.a,{style:{marginRight:4}}),I,v.type==="suggestion"&&p.a.createElement(he.a,null,"Suggestion")):p.a.createElement("div",null,p.a.createElement("div",{style:{display:"flex"}},p.a.createElement($.a,{value:S,onChange:function(ce){return B(ce.target.value)},onPressEnter:_,autoFocus:!0,placeholder:"Enter a URL or wildcard subdomain (e.g. https://*.posthog.com)"}),p.a.createElement(Ee.a,{type:"primary",onClick:_},"Save")),M&&p.a.createElement("span",{className:"text-small text-danger"},M))}},{title:"",key:"actions",render:function(I,v,q){return p.a.createElement("div",{className:"actions-col"},v.type==="suggestion"?p.a.createElement(D.a,{type:"secondary",onClick:function(){return Y(v.url)}},"Apply suggestion"):p.a.createElement(p.a.Fragment,null,p.a.createElement(D.a,{type:"highlighted",href:j(v.url),className:"mr"},"Open with Toolbar"),p.a.createElement(Fe.a,{overlay:p.a.createElement(p.a.Fragment,null,p.a.createElement(D.a,{fullWidth:!0,type:"stealth",onClick:function(){return Se(v.originalIndex)}},"Edit authorized URL"),p.a.createElement(D.a,{fullWidth:!0,style:{color:"var(--danger)"},type:"stealth",onClick:function(){return Z(q)}},"Remove authorized URL"))})))}}];return p.a.createElement("div",null,p.a.createElement("div",{className:"flex-center mb"},p.a.createElement("div",{style:{flexGrow:1}},p.a.createElement($.a.Search,{allowClear:!0,enterButton:!0,placeholder:"Search for authorized URLs",style:{maxWidth:480},value:w,onChange:function(I){F(I.target.value)},autoFocus:be==="toolbar-launch"&&!Object(ye.Y)()})),p.a.createElement(D.a,{type:"primary",onClick:ze},"Add",be==="toolbar-launch"&&" authorized domain")),p.a.createElement(P.a,{className:"authorized-urls-table",columns:Ce,dataSource:Ae,emptyState:w?"There are no authorized URLs that match your search.":"There are no authorized URLs or domains. Add one to get started.",loading:je}))}try{X.displayName="AuthorizedUrlsTable",X.__docgenInfo={description:"",displayName:"AuthorizedUrlsTable",props:{pageKey:{defaultValue:null,description:"",name:"pageKey",required:!1,type:{name:"string"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"]={docgenInfo:X.__docgenInfo,name:"AuthorizedUrlsTable",path:"frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"})}catch(oe){}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss":function(G,O,a){var H=a("./node_modules/css-loader/dist/runtime/api.js");O=H(!1),O.push([G.i,".authorized-urls-table .authorized-url-col{display:flex;align-items:center}.authorized-urls-table .authorized-url-col .LemonTag{margin-left:6px}.authorized-urls-table .authorized-url-col.suggestion{color:var(--text-muted-alt)}.authorized-urls-table .authorized-url-col.authorized{color:var(--success)}.authorized-urls-table .actions-col{display:flex;align-items:center;justify-content:flex-end}",""]),G.exports=O}}]);
