(window.webpackJsonp=window.webpackJsonp||[]).push([[249],{4727:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Annotations",(function(){return Annotations}));var ModalMode,regenerator=__webpack_require__(6),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(68),__webpack_require__(11)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),slicedToArray=__webpack_require__(13),slicedToArray_default=__webpack_require__.n(slicedToArray),react=__webpack_require__(0),react_default=__webpack_require__.n(react),index_esm=__webpack_require__(1),es_input=__webpack_require__(500),tag=__webpack_require__(1236),es_button=__webpack_require__(133),modal=__webpack_require__(1238),dropdown=__webpack_require__(899),menu=__webpack_require__(342),row=__webpack_require__(343),annotationsModel=__webpack_require__(872),defineProperty=(__webpack_require__(39),__webpack_require__(45),__webpack_require__(40),__webpack_require__(51),__webpack_require__(3)),defineProperty_default=__webpack_require__.n(defineProperty),toConsumableArray=__webpack_require__(14),toConsumableArray_default=__webpack_require__.n(toConsumableArray),api=__webpack_require__(20),utils=__webpack_require__(10),teamLogic=__webpack_require__(29),annotationsTableLogic=Object(index_esm.kea)({path:["scenes","annotations","logic"],loaders:function loaders(_ref){var _loadAnnotations,actions=_ref.actions;return{annotations:{__default:[],loadAnnotations:(_loadAnnotations=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var response;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,api.a.get("api/projects/".concat(teamLogic.a.values.currentTeamId,"/annotations/?").concat(Object(utils.ub)({order:"-updated_at"})));case 2:return response=_context.sent,actions.setNext(response.next),_context.abrupt("return",response.results);case 5:case"end":return _context.stop()}}),_callee)}))),function loadAnnotations(){return _loadAnnotations.apply(this,arguments)})}}},reducers:function reducers(){return{annotations:[[],{appendAnnotations:function appendAnnotations(state,_ref2){var annotations=_ref2.annotations;return[].concat(toConsumableArray_default()(state),toConsumableArray_default()(annotations))}}],next:[null,{setNext:function setNext(_,_ref3){return _ref3.next}}],loadingNext:[!1,{loadAnnotationsNext:function loadAnnotationsNext(){return!0},appendAnnotations:function appendAnnotations(){return!1}}]}},actions:function actions(){return{updateAnnotation:function updateAnnotation(id,content){return{id:id,content:content}},deleteAnnotation:function deleteAnnotation(id){return{id:id}},restoreAnnotation:function restoreAnnotation(id){return{id:id}},loadAnnotationsNext:function loadAnnotationsNext(){return!0},setNext:function setNext(next){return{next:next}},appendAnnotations:function appendAnnotations(annotations){return{annotations:annotations}}}},listeners:function listeners(_ref4){var _loadAnnotationsNext,_restoreAnnotation,_updateAnnotation,actions=_ref4.actions,values=_ref4.values;return defineProperty_default()({updateAnnotation:(_updateAnnotation=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(_ref5){var id,content;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return id=_ref5.id,content=_ref5.content,_context2.next=3,api.a.update("api/projects/".concat(teamLogic.a.values.currentTeamId,"/annotations/").concat(id),{content:content});case 3:actions.loadAnnotations();case 4:case"end":return _context2.stop()}}),_callee2)}))),function updateAnnotation(_x){return _updateAnnotation.apply(this,arguments)}),restoreAnnotation:(_restoreAnnotation=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(_ref6){var id;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return id=_ref6.id,_context3.next=3,api.a.update("api/projects/".concat(teamLogic.a.values.currentTeamId,"/annotations/").concat(id),{deleted:!1});case 3:actions.loadAnnotations();case 4:case"end":return _context3.stop()}}),_callee3)}))),function restoreAnnotation(_x2){return _restoreAnnotation.apply(this,arguments)}),deleteAnnotation:function deleteAnnotation(_ref7){var id=_ref7.id;Object(utils.s)({endpoint:"projects/".concat(teamLogic.a.values.currentTeamId,"/annotations"),object:{name:"Annotation",id:id},callback:function callback(){return actions.loadAnnotations()}})},loadAnnotationsNext:(_loadAnnotationsNext=asyncToGenerator_default()(regenerator_default.a.mark((function _callee4(){var results,response;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(results=[],!values.next){_context4.next=7;break}return _context4.next=4,api.a.get(values.next);case 4:response=_context4.sent,actions.setNext(response.next),results=response.results;case 7:actions.appendAnnotations(results);case 8:case"end":return _context4.stop()}}),_callee4)}))),function loadAnnotationsNext(){return _loadAnnotationsNext.apply(this,arguments)})},annotationsModel.a.actionTypes.createGlobalAnnotationSuccess,(function(){actions.loadAnnotations()}))},events:function events(_ref9){var actions=_ref9.actions;return{afterMount:function afterMount(){return actions.loadAnnotations()}}}}),ProjectOutlined=__webpack_require__(4278),DeploymentUnitOutlined=__webpack_require__(4301),DownOutlined=__webpack_require__(630),DeleteOutlined=__webpack_require__(4229),RedoOutlined=__webpack_require__(4258),constants=__webpack_require__(22),PageHeader=__webpack_require__(344),PlusOutlined=__webpack_require__(1857),types=__webpack_require__(5),dayjs=__webpack_require__(1156),dayjs_default=__webpack_require__.n(dayjs),generatePicker=__webpack_require__(707),generatePicker_default=__webpack_require__.n(generatePicker),lib_dayjs=__webpack_require__(42),Spinner=__webpack_require__(180),LemonTable=__webpack_require__(346),columnUtils=__webpack_require__(1239),TimezoneAware=__webpack_require__(309),DatePicker=generatePicker_default()(dayjs_default.a),TextArea=es_input.a.TextArea,scene={component:Annotations,logic:annotationsTableLogic};function Annotations(){var _useValues=Object(index_esm.useValues)(annotationsTableLogic),annotations=_useValues.annotations,annotationsLoading=_useValues.annotationsLoading,next=_useValues.next,loadingNext=_useValues.loadingNext,_useActions=Object(index_esm.useActions)(annotationsTableLogic),updateAnnotation=_useActions.updateAnnotation,deleteAnnotation=_useActions.deleteAnnotation,loadAnnotationsNext=_useActions.loadAnnotationsNext,restoreAnnotation=_useActions.restoreAnnotation,createGlobalAnnotation=Object(index_esm.useActions)(annotationsModel.a).createGlobalAnnotation,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),open=_useState2[0],setOpen=_useState2[1],_useState3=Object(react.useState)(null),_useState4=slicedToArray_default()(_useState3,2),selectedAnnotation=_useState4[0],setSelected=_useState4[1],columns=[{title:"Annotation",key:"annotation",width:"30%",render:function RenderAnnotation(_,annotation){return react_default.a.createElement("div",{className:"ph-no-capture",style:{width:"auto",maxWidth:250}},annotation.content)}},{title:"For date",dataIndex:"date_marker",render:function RenderDateMarker(_,annotation){return react_default.a.createElement("span",null,Object(lib_dayjs.a)(annotation.date_marker).format("MMMM DD, YYYY"))},sorter:function sorter(a,b){return Object(lib_dayjs.a)(a.date_marker).diff(b.date_marker)}},Object(columnUtils.b)(),{title:"Last updated",dataIndex:"updated_at",render:function RenderLastUpdated(_,annotation){return react_default.a.createElement(TimezoneAware.b,{time:annotation.updated_at})},sorter:function sorter(a,b){return Object(lib_dayjs.a)(a.date_marker).diff(b.date_marker)}},{title:"Status",render:function RenderStatus(_,annotation){return annotation.deleted?react_default.a.createElement(tag.a,{color:"red"},"Deleted"):react_default.a.createElement(tag.a,{color:"green"},"Active")}},{title:"Scope",render:function RenderType(_,annotation){return annotation.scope===types.b.Insight?react_default.a.createElement(tag.a,{color:"blue"},"Insight"):annotation.scope===types.b.Project?react_default.a.createElement(tag.a,{color:"purple"},"Project"):annotation.scope===types.b.Organization?react_default.a.createElement(tag.a,{color:"pink"},"Organization"):react_default.a.createElement(tag.a,null,"Unknown (",annotation.scope,")")}}];function closeModal(){setOpen(!1),setTimeout((function(){return setSelected(null)}),500)}return react_default.a.createElement("div",null,react_default.a.createElement(PageHeader.a,{title:"Annotations",caption:"Here you can add organization- and project-wide annotations. Dashboard-specific ones can be added directly in the dashboard.",buttons:react_default.a.createElement(es_button.a,{type:"primary","data-attr":"create-annotation",onClick:function onClick(){return setOpen(!0)},icon:react_default.a.createElement(PlusOutlined.a,null)},"New Annotation")}),react_default.a.createElement("div",null,react_default.a.createElement(LemonTable.a,{"data-attr":"annotations-table",rowKey:"id",rowClassName:"cursor-pointer",dataSource:annotations,columns:columns,loading:annotationsLoading,onRow:function onRow(annotation){return{onClick:function onClick(){setSelected(annotation),setOpen(!0)}}},emptyState:"No annotations yet"}),react_default.a.createElement("div",{style:{visibility:next?"visible":"hidden",margin:"2rem auto 5rem",textAlign:"center"}},loadingNext?react_default.a.createElement(Spinner.a,{size:"sm"}):react_default.a.createElement(es_button.a,{type:"primary",onClick:function onClick(){loadAnnotationsNext()}},"Load more annotations"))),react_default.a.createElement(CreateAnnotationModal,{visible:open,onCancel:function onCancel(){closeModal()},onSubmit:function(){var _ref=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(input,selectedDate){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_context.t0=selectedAnnotation,!_context.t0){_context.next=5;break}return _context.next=4,selectedAnnotation;case 4:_context.t0=_context.sent;case 5:if(!_context.t0){_context.next=9;break}updateAnnotation(selectedAnnotation.id,input),_context.next=10;break;case 9:createGlobalAnnotation(input,selectedDate.format("YYYY-MM-DD"));case 10:closeModal();case 11:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}(),onDelete:function onDelete(){selectedAnnotation&&deleteAnnotation(selectedAnnotation.id),closeModal()},onRestore:function onRestore(){selectedAnnotation&&restoreAnnotation(selectedAnnotation.id),closeModal()},annotation:selectedAnnotation}))}function CreateAnnotationModal(props){var _props$annotation,_useState5=Object(react.useState)(types.b.Project),_useState6=slicedToArray_default()(_useState5,2),scope=_useState6[0],setScope=_useState6[1],_useState7=Object(react.useState)(""),_useState8=slicedToArray_default()(_useState7,2),textInput=_useState8[0],setTextInput=_useState8[1],_useState9=Object(react.useState)(ModalMode.CREATE),_useState10=slicedToArray_default()(_useState9,2),modalMode=_useState10[0],setModalMode=_useState10[1],_useState11=Object(react.useState)(Object(lib_dayjs.a)()),_useState12=slicedToArray_default()(_useState11,2),selectedDate=_useState12[0],setDate=_useState12[1];Object(react.useEffect)((function(){props.annotation?(setModalMode(ModalMode.EDIT),setTextInput(props.annotation.content)):(setModalMode(ModalMode.CREATE),setTextInput(""))}),[props.annotation]);return react_default.a.createElement(modal.a,{footer:[react_default.a.createElement(es_button.a,{key:"create-annotation-cancel",onClick:function onClick(){return props.onCancel()}},"Cancel"),react_default.a.createElement(es_button.a,{type:"primary",key:"create-annotation-submit","data-attr":"create-annotation-submit",onClick:function onClick(){!function _onSubmit(input,date){props.onSubmit(input,date),setTextInput(""),setDate(Object(lib_dayjs.a)()),setScope(types.b.Project)}(textInput,selectedDate)}},modalMode===ModalMode.CREATE?"Submit":"Update")],closable:!1,visible:props.visible,onCancel:props.onCancel,title:modalMode===ModalMode.CREATE?"Create annotation":"Edit ennotation"},modalMode===ModalMode.CREATE?react_default.a.createElement("span",null,"This annotation will appear on all",react_default.a.createElement(dropdown.a,{overlay:react_default.a.createElement(menu.a,{activeKey:scope,onSelect:function onSelect(e){return setScope(e.key)}},react_default.a.createElement(menu.a.Item,{key:types.b.Project,icon:react_default.a.createElement(ProjectOutlined.a,null)},"Project"),react_default.a.createElement(menu.a.Item,{key:types.b.Organization,icon:react_default.a.createElement(DeploymentUnitOutlined.a,null)},"Organization"))},react_default.a.createElement(es_button.a,{style:{marginLeft:8,marginRight:8}},constants.D.get(scope)," ",react_default.a.createElement(DownOutlined.a,null)))," ","charts"):react_default.a.createElement(row.a,{justify:"space-between"},react_default.a.createElement("span",null,"Change existing annotation text"),(null===(_props$annotation=props.annotation)||void 0===_props$annotation?void 0:_props$annotation.deleted)?react_default.a.createElement(RedoOutlined.a,{className:"button-border clickable",onClick:function onClick(){props.onRestore()}}):react_default.a.createElement(DeleteOutlined.a,{className:"text-danger",onClick:function onClick(){props.onDelete()}})),react_default.a.createElement("br",null),modalMode===ModalMode.CREATE&&react_default.a.createElement("div",null,"Date:",react_default.a.createElement(DatePicker,{style:{marginTop:16,marginLeft:8,marginBottom:16},getPopupContainer:function getPopupContainer(trigger){return trigger.parentElement},value:selectedDate,onChange:function onChange(date){return setDate(date)},allowClear:!1})),react_default.a.createElement(TextArea,{"data-attr":"create-annotation-input",maxLength:300,style:{marginBottom:12,marginTop:5},rows:4,value:textInput,onChange:function onChange(e){return setTextInput(e.target.value)}}))}!function(ModalMode){ModalMode[ModalMode.CREATE=0]="CREATE",ModalMode[ModalMode.EDIT=1]="EDIT"}(ModalMode||(ModalMode={}))}}]);