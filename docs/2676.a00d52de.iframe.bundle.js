"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[2676],{"../../products/revenue_analytics/frontend/RevenueAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{RevenueAnalyticsScene:()=>RevenueAnalyticsScene,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.7_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),types=__webpack_require__("../../frontend/src/types.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),currency=__webpack_require__("../../frontend/src/lib/utils/geography/currency.ts"),databaseTableListLogic=__webpack_require__("../../frontend/src/scenes/data-management/database/databaseTableListLogic.ts"),dataWarehouseSceneLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/dataWarehouseSceneLogic.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),revenueEventsSettingsLogic=__webpack_require__("../../products/revenue_analytics/frontend/settings/revenueEventsSettingsLogic.ts");let RevenueAnalyticsQuery=function(RevenueAnalyticsQuery){return RevenueAnalyticsQuery[RevenueAnalyticsQuery.OVERVIEW=0]="OVERVIEW",RevenueAnalyticsQuery[RevenueAnalyticsQuery.GROSS_REVENUE=1]="GROSS_REVENUE",RevenueAnalyticsQuery[RevenueAnalyticsQuery.REVENUE_GROWTH_RATE=2]="REVENUE_GROWTH_RATE",RevenueAnalyticsQuery[RevenueAnalyticsQuery.REVENUE_CHURN=3]="REVENUE_CHURN",RevenueAnalyticsQuery}({}),REVENUE_ANALYTICS_DATA_COLLECTION_NODE_ID="revenue-analytics",buildDashboardItemId=queryType=>`new-AdHoc.revenue-analytics.${queryType}`,INITIAL_DATE_FROM="-30d",INITIAL_INTERVAL=(0,utils.Rx)(INITIAL_DATE_FROM,null),teamId=window.POSTHOG_APP_CONTEXT?.current_team?.id,persistConfig={persist:!0,prefix:`${teamId}__`},revenueAnalyticsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","revenueAnalytics","frontend","revenueAnalyticsLogic"]),(0,index_esm.connect)(()=>({values:[dataWarehouseSceneLogic.M,["dataWarehouseTablesBySourceType"],databaseTableListLogic.A,["managedViews"],revenueEventsSettingsLogic.d,["baseCurrency"]]})),(0,index_esm.actions)({setDates:(dateFrom,dateTo)=>({dateFrom,dateTo}),setInterval:interval=>({interval}),setDatesAndInterval:(dateFrom,dateTo,interval)=>({dateFrom,dateTo,interval})}),(0,index_esm.reducers)({dateFilter:[{dateFrom:INITIAL_DATE_FROM,dateTo:null,interval:INITIAL_INTERVAL},persistConfig,{setDates:(_,_ref)=>{let{dateTo,dateFrom}=_ref;return{dateTo,dateFrom,interval:(0,utils.Rx)(dateFrom,dateTo)}},setInterval:(_ref2,_ref3)=>{let{dateFrom:oldDateFrom,dateTo:oldDateTo}=_ref2,{interval}=_ref3,{dateFrom,dateTo}=(0,utils.pQ)(interval,oldDateFrom,oldDateTo);return{dateTo,dateFrom,interval}},setDatesAndInterval:(_,_ref4)=>{let{dateTo,dateFrom,interval}=_ref4;return dateFrom||dateTo||(dateFrom=INITIAL_DATE_FROM,dateTo=null),{dateTo,dateFrom,interval:interval||(0,utils.Rx)(dateFrom,dateTo)}}}]}),(0,index_esm.selectors)({breadcrumbs:[()=>[],()=>[{key:"RevenueAnalytics",name:"Revenue analytics",path:urls.j.revenueAnalytics()}]],hasRevenueTables:[s=>[s.dataWarehouseTablesBySourceType],dataWarehouseTablesBySourceType=>!!dataWarehouseTablesBySourceType.Stripe?.length],queries:[s=>[s.dateFilter,s.managedViews,s.baseCurrency],(dateFilter,managedViews,baseCurrency)=>{let{dateFrom,dateTo,interval}=dateFilter,dateRange={date_from:dateFrom,date_to:dateTo};return{[RevenueAnalyticsQuery.OVERVIEW]:{kind:schema_general.OH.RevenueAnalyticsOverviewQuery,dateRange},[RevenueAnalyticsQuery.GROSS_REVENUE]:{kind:schema_general.OH.InsightVizNode,embedded:!1,hidePersonsModal:!0,hideTooltipOnScroll:!0,source:{kind:schema_general.OH.TrendsQuery,series:managedViews.map(view=>({kind:schema_general.OH.DataWarehouseNode,id:view.name,name:view.name,custom_name:managedViews.length>1?`Gross revenue for ${view.name}`:"Gross revenue",id_field:"id",timestamp_field:"timestamp",distinct_id_field:"id",table_name:view.name,math:types.O4.Sum,math_property:"amount"})),interval,dateRange,trendsFilter:{display:managedViews.length>1?types.Qb.ActionsAreaGraph:types.Qb.ActionsLineGraph,aggregationAxisFormat:"numeric",aggregationAxisPrefix:(0,currency.jK)(baseCurrency).symbol}}},[RevenueAnalyticsQuery.REVENUE_GROWTH_RATE]:{kind:schema_general.OH.RevenueAnalyticsGrowthRateQuery,dateRange},[RevenueAnalyticsQuery.REVENUE_CHURN]:{kind:schema_general.OH.RevenueAnalyticsChurnRateQuery,dateRange}}}]})]);var react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let QUERY_ID=RevenueAnalyticsQuery.GROSS_REVENUE,INSIGHT_PROPS={dashboardItemId:buildDashboardItemId(QUERY_ID),loadPriority:QUERY_ID,dataNodeCollectionId:REVENUE_ANALYTICS_DATA_COLLECTION_NODE_ID},GrossRevenueTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic),query=queries[QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...INSIGHT_PROPS,query}}),[query]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold",children:"Gross Revenue"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-gray-500",children:"Gross revenue is the total amount of revenue generated from all sources, including all products and services."}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})]})},OverviewTile_QUERY_ID=RevenueAnalyticsQuery.OVERVIEW,OverviewTile_INSIGHT_PROPS={dashboardItemId:buildDashboardItemId(OverviewTile_QUERY_ID),loadPriority:OverviewTile_QUERY_ID,dataNodeCollectionId:REVENUE_ANALYTICS_DATA_COLLECTION_NODE_ID},OverviewTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic),query=queries[OverviewTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...OverviewTile_INSIGHT_PROPS,query}}),[query]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:["TODO: ",JSON.stringify({query,context})]})},RevenueChurnTile_QUERY_ID=RevenueAnalyticsQuery.REVENUE_CHURN,RevenueChurnTile_INSIGHT_PROPS={dashboardItemId:buildDashboardItemId(RevenueChurnTile_QUERY_ID),loadPriority:RevenueChurnTile_QUERY_ID,dataNodeCollectionId:REVENUE_ANALYTICS_DATA_COLLECTION_NODE_ID},RevenueChurnTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic),query=queries[RevenueChurnTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...RevenueChurnTile_INSIGHT_PROPS,query}}),[query]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:["TODO: ",JSON.stringify({query,context})]})},RevenueGrowthRateTile_QUERY_ID=RevenueAnalyticsQuery.REVENUE_GROWTH_RATE,RevenueGrowthRateTile_INSIGHT_PROPS={dashboardItemId:buildDashboardItemId(RevenueGrowthRateTile_QUERY_ID),loadPriority:RevenueGrowthRateTile_QUERY_ID,dataNodeCollectionId:REVENUE_ANALYTICS_DATA_COLLECTION_NODE_ID},RevenueGrowthRateTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic),query=queries[RevenueGrowthRateTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...RevenueGrowthRateTile_INSIGHT_PROPS,query}}),[query]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:["TODO: ",JSON.stringify({query,context})]})},scene={component:RevenueAnalyticsScene,logic:revenueAnalyticsLogic};function RevenueAnalyticsScene(){let{hasRevenueTables}=(0,index_esm.useValues)(revenueAnalyticsLogic),{updateHasSeenProductIntroFor}=(0,index_esm.useActions)(userLogic.userLogic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ProductIntroduction.C,{isEmpty:!hasRevenueTables,productName:"Revenue Analytics",productKey:types.Md.REVENUE_ANALYTICS,titleOverride:"Connect your first revenue source",thingName:"revenue",description:"Track and analyze your revenue metrics to understand your business performance and growth.",actionElementOverride:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>{updateHasSeenProductIntroFor(types.Md.REVENUE_ANALYTICS,!0),lib.router.actions.push(urls.j.pipelineNodeNew(types.We.Source,{kind:"stripe"}))},"data-attr":"create-revenue-source",children:"Connect revenue source"}),(0,jsx_runtime.jsxs)("span",{className:"text-xs text-muted-alt",children:["Only Stripe is supported currently. ",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)(src.rU,{target:"_blank",to:"https://github.com/PostHog/posthog/issues/new?assignees=&labels=enhancement,feature/revenue-analytics%2C+feature&projects=&template=feature_request.yml&title=New%20revenue%20source:%20%3Cinsert%20source%3E",children:"Request more revenue integrations."})]})]})}),hasRevenueTables&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(RevenueAnalyticsFilters,{}),(0,jsx_runtime.jsx)(RevenueAnalyticsTables,{})]})]})}let RevenueAnalyticsFilters=()=>{let{dateFilter:{dateTo,dateFrom}}=(0,index_esm.useValues)(revenueAnalyticsLogic),{setDates}=(0,index_esm.useActions)(revenueAnalyticsLogic);return(0,jsx_runtime.jsx)("div",{className:"flex flex-row",children:(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:dateFrom,dateTo:dateTo,onChange:setDates})})},RevenueAnalyticsTables=()=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsx)(OverviewTile,{}),(0,jsx_runtime.jsx)(GrossRevenueTile,{}),(0,jsx_runtime.jsx)(RevenueGrowthRateTile,{}),(0,jsx_runtime.jsx)(RevenueChurnTile,{})]})}}]);