"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[63826],{"../../frontend/src/scenes/web-analytics/tiles/WebAnalyticsTile.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{bP:()=>WebQuery,FM:()=>webAnalyticsDataTableQueryContext});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),colors=__webpack_require__("../../frontend/src/lib/colors.ts"),IntervalFilter=__webpack_require__("../../frontend/src/lib/components/IntervalFilter/index.ts"),PathCleanFilterItem=__webpack_require__("../../frontend/src/lib/components/PathCleanFilters/PathCleanFilterItem.tsx"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),PropertyIcon=__webpack_require__("../../frontend/src/lib/components/PropertyIcon.tsx"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonSwitch=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSwitch/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),NewActionButton=__webpack_require__("../../frontend/src/scenes/actions/NewActionButton.tsx"),WorldMap=__webpack_require__("../../frontend/src/scenes/insights/views/WorldMap/index.ts"),countryCodes=__webpack_require__("../../frontend/src/scenes/insights/views/WorldMap/countryCodes.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),webAnalyticsLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/webAnalyticsLogic.tsx"),actionsModel=__webpack_require__("../../frontend/src/models/actionsModel.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),types=__webpack_require__("../../frontend/src/types.ts"),authorizedUrlListLogic=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),product_intents=__webpack_require__("../../frontend/src/lib/utils/product-intents.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let VALID_BREAKDOWN_VALUES=new Set([schema_general.GI.Page,schema_general.GI.InitialPage,schema_general.GI.ExitPage,schema_general.GI.ExitClick]),HeatmapButton=_ref=>{let{breakdownBy,value}=_ref,{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h),{domainFilter:webAnalyticsSelectedDomain}=(0,index_esm.useValues)(webAnalyticsLogic.WG);if(""===value||!VALID_BREAKDOWN_VALUES.has(breakdownBy)||!webAnalyticsSelectedDomain||"all"===webAnalyticsSelectedDomain)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let url=`${webAnalyticsSelectedDomain}${value}`.replace(/\/\//g,"/"),to=featureFlags[constants.y8.HEATMAPS_UI]?urls.j.heatmaps(`pageURL=${url}`):(0,authorizedUrlListLogic.Kc)(url,{userIntent:"heatmaps"});return(0,jsx_runtime.jsx)(src.Jp,{to:to,icon:(0,jsx_runtime.jsx)(icons.X,{}),type:"tertiary",size:"xsmall",tooltip:"View heatmap for this page",className:"no-underline",targetBlank:!0,onClick:e=>{e.stopPropagation(),(0,product_intents.uX)({from:types.Md.WEB_ANALYTICS,to:types.Md.HEATMAPS,intent_context:product_intents.kp.WEB_ANALYTICS_INSIGHT})}})},BREAKDOWN_TYPE_MAP={[schema_general.GI.DeviceType]:types.FT.Person,[schema_general.GI.InitialPage]:types.FT.Session,[schema_general.GI.ExitPage]:types.FT.Session,[schema_general.GI.Page]:types.FT.Event,[schema_general.GI.Browser]:types.FT.Person,[schema_general.GI.OS]:types.FT.Person,[schema_general.GI.InitialChannelType]:types.FT.Session,[schema_general.GI.InitialReferringDomain]:types.FT.Session,[schema_general.GI.InitialUTMSource]:types.FT.Session,[schema_general.GI.InitialUTMCampaign]:types.FT.Session,[schema_general.GI.InitialUTMMedium]:types.FT.Session,[schema_general.GI.InitialUTMContent]:types.FT.Session,[schema_general.GI.InitialUTMTerm]:types.FT.Session},BREAKDOWN_KEY_MAP={[schema_general.GI.DeviceType]:"$device_type",[schema_general.GI.InitialPage]:"$entry_pathname",[schema_general.GI.ExitPage]:"$end_pathname",[schema_general.GI.Page]:"$pathname",[schema_general.GI.Browser]:"$browser",[schema_general.GI.OS]:"$os",[schema_general.GI.InitialChannelType]:"$channel_type",[schema_general.GI.InitialReferringDomain]:"$entry_referring_domain",[schema_general.GI.InitialUTMSource]:"$entry_utm_source",[schema_general.GI.InitialUTMCampaign]:"$entry_utm_campaign",[schema_general.GI.InitialUTMMedium]:"$entry_utm_medium",[schema_general.GI.InitialUTMContent]:"$entry_utm_content",[schema_general.GI.InitialUTMTerm]:"$entry_utm_term"},ReplayButton=_ref=>{let{date_from,date_to,breakdownBy,value}=_ref,sharedButtonProps={icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconRewindPlay,{}),type:"tertiary",size:"xsmall",tooltip:"View recordings",className:"no-underline",targetBlank:!0,onClick:e=>{e.stopPropagation(),(0,product_intents.uX)({from:types.Md.WEB_ANALYTICS,to:types.Md.SESSION_REPLAY,intent_context:product_intents.kp.WEB_ANALYTICS_INSIGHT})}};if(""===value)return(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from,date_to})});if(breakdownBy===schema_general.GI.Viewport)return(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from:date_from,date_to:date_to,filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:"$viewport_width",type:types.FT.Event,value:[value[0]],operator:types.WV.Exact},{key:"$viewport_height",type:types.FT.Event,value:[value[1]],operator:types.WV.Exact}]}]}})});if(breakdownBy===schema_general.GI.InitialUTMSourceMediumCampaign){let values=value.split(" / ");return(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from:date_from,date_to:date_to,filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:"$entry_utm_source",type:types.FT.Session,value:[values[0]||""],operator:types.WV.Exact},{key:"$entry_utm_medium",type:types.FT.Session,value:[values[1]||""],operator:types.WV.Exact},{key:"$entry_utm_campaign",type:types.FT.Session,value:[values[2]||""],operator:types.WV.Exact}]}]}})})}let type=BREAKDOWN_TYPE_MAP[breakdownBy]||types.FT.Person,key=BREAKDOWN_KEY_MAP[breakdownBy];return key&&type?(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from:date_from,date_to:date_to,filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:key,type:type,value:[value],operator:types.WV.Exact}]}]}})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},toUtcOffsetFormat=value=>{if(0===value)return"UTC";let integerPart=Math.floor(value),decimalPartAsMinutes=60*(value-integerPart),formattedMinutes=decimalPartAsMinutes>0?`:${decimalPartAsMinutes}`:"";return`UTC${integerPart>0?"+":"-"}${integerPart}${formattedMinutes}`},VariationCell=function(){let{isPercentage,reverseColors}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isPercentage:!1,reverseColors:!1},formatNumber=value=>{var _value$toLocaleString;return isPercentage?`${(100*value).toFixed(1)}%`:null!==(_value$toLocaleString=value?.toLocaleString())&&void 0!==_value$toLocaleString?_value$toLocaleString:"(empty)"};return function Cell(_ref){let{value}=_ref,{compareFilter}=(0,index_esm.useValues)(webAnalyticsLogic.WG);if(!value)return null;if(!Array.isArray(value))return(0,jsx_runtime.jsx)("span",{children:String(value)});let[current,previous]=value,pctChangeFromPrevious=0===previous&&0===current?0:null!==current&&compareFilter&&!1!==compareFilter.compare?null===previous||0===previous?1/0:current/previous-1:null,trend=null===pctChangeFromPrevious?null:0===pctChangeFromPrevious?{Icon:icons.cs,color:(0,colors.cM)("muted")}:pctChangeFromPrevious>0?{Icon:posthog_icons_es.IconTrending,color:reverseColors?(0,colors.cM)("danger"):(0,colors.cM)("success")}:{Icon:icons.j4,color:reverseColors?(0,colors.cM)("success"):(0,colors.cM)("danger")},tooltip=null!==pctChangeFromPrevious?`${current>=previous?"Increased":"Decreased"} by ${(0,utils.e9)(Math.abs(pctChangeFromPrevious),0)} since last period (from ${formatNumber(previous)} to ${formatNumber(current)})`:null;return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)({"pr-4":!trend}),children:(0,jsx_runtime.jsx)(src.u,{title:tooltip,children:(0,jsx_runtime.jsxs)("span",{children:[formatNumber(current),"Â ",trend&&(0,jsx_runtime.jsx)("span",{style:{color:trend.color},children:(0,jsx_runtime.jsx)(trend.Icon,{color:trend.color,className:"ml-1"})})]})})})}},SortableCell=(name,orderByField)=>function SortableCell(){let{tablesOrderBy}=(0,index_esm.useValues)(webAnalyticsLogic.WG),{setTablesOrderBy}=(0,index_esm.useActions)(webAnalyticsLogic.WG),isSortedByMyField=tablesOrderBy?.[0]===orderByField,isAscending=tablesOrderBy?.[1]==="ASC",onClick=(0,react.useCallback)(()=>{!isSortedByMyField||isAscending?setTablesOrderBy(orderByField,"DESC"):setTablesOrderBy(orderByField,"ASC")},[isAscending,isSortedByMyField,setTablesOrderBy]);return(0,jsx_runtime.jsxs)("span",{onClick:onClick,className:"group cursor-pointer inline-flex items-center",children:[name,(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronDown,{fontSize:"20px",className:(0,clsx_m.default)("-mr-1 ml-1 text-muted-alt opacity-0 group-hover:opacity-100",{"text-primary opacity-100":isSortedByMyField,"rotate-180":isSortedByMyField&&isAscending})})]})},webStatsBreakdownToPropertyName=breakdownBy=>{switch(breakdownBy){case schema_general.GI.Page:return{key:"$pathname",type:types.FT.Event};case schema_general.GI.InitialPage:return{key:"$entry_pathname",type:types.FT.Session};case schema_general.GI.ExitPage:return{key:"$end_pathname",type:types.FT.Session};case schema_general.GI.ExitClick:return{key:"$last_external_click_url",type:types.FT.Session};case schema_general.GI.ScreenName:return{key:"$screen_name",type:types.FT.Event};case schema_general.GI.InitialChannelType:return{key:"$channel_type",type:types.FT.Session};case schema_general.GI.InitialReferringDomain:return{key:"$entry_referring_domain",type:types.FT.Session};case schema_general.GI.InitialUTMSource:return{key:"$entry_utm_source",type:types.FT.Session};case schema_general.GI.InitialUTMCampaign:return{key:"$entry_utm_campaign",type:types.FT.Session};case schema_general.GI.InitialUTMMedium:return{key:"$entry_utm_medium",type:types.FT.Session};case schema_general.GI.InitialUTMContent:return{key:"$entry_utm_content",type:types.FT.Session};case schema_general.GI.InitialUTMTerm:return{key:"$entry_utm_term",type:types.FT.Session};case schema_general.GI.Browser:return{key:"$browser",type:types.FT.Event};case schema_general.GI.OS:return{key:"$os",type:types.FT.Event};case schema_general.GI.Viewport:return{key:"$viewport",type:types.FT.Event};case schema_general.GI.DeviceType:return{key:"$device_type",type:types.FT.Event};case schema_general.GI.Country:return{key:"$geoip_country_code",type:types.FT.Event};case schema_general.GI.Region:return{key:"$geoip_subdivision_1_code",type:types.FT.Event};case schema_general.GI.City:return{key:"$geoip_city_name",type:types.FT.Event};case schema_general.GI.Timezone:return{key:"$timezone",type:types.FT.Event};case schema_general.GI.Language:return{key:"$geoip_language",type:types.FT.Event};case schema_general.GI.InitialUTMSourceMediumCampaign:return;default:throw new utils.q0(breakdownBy)}},webAnalyticsDataTableQueryContext={columns:{breakdown_value:{renderTitle:props=>{let{query}=props,{source}=query;if(source.kind!==schema_general.OH.WebStatsTableQuery)return null;let{breakdownBy}=source;switch(breakdownBy){case schema_general.GI.Page:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Path"});case schema_general.GI.InitialPage:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Initial Path"});case schema_general.GI.ExitPage:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"End Path"});case schema_general.GI.ExitClick:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Exit Click"});case schema_general.GI.ScreenName:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Screen Name"});case schema_general.GI.InitialChannelType:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Initial Channel Type"});case schema_general.GI.InitialReferringDomain:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Referring Domain"});case schema_general.GI.InitialUTMSource:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Source"});case schema_general.GI.InitialUTMCampaign:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Campaign"});case schema_general.GI.InitialUTMMedium:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Medium"});case schema_general.GI.InitialUTMTerm:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Term"});case schema_general.GI.InitialUTMContent:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Content"});case schema_general.GI.Browser:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Browser"});case schema_general.GI.OS:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"OS"});case schema_general.GI.Viewport:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Viewport"});case schema_general.GI.DeviceType:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Device Type"});case schema_general.GI.Country:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Country"});case schema_general.GI.Region:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Region"});case schema_general.GI.City:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"City"});case schema_general.GI.Timezone:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Timezone"});case schema_general.GI.Language:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Language"});case schema_general.GI.InitialUTMSourceMediumCampaign:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Source / Medium / Campaign"});default:throw new utils.q0(breakdownBy)}},render:props=>{let{value,query}=props,{source}=query;if(source.kind!==schema_general.OH.WebStatsTableQuery)return null;let{breakdownBy}=source;switch(breakdownBy){case schema_general.GI.ExitPage:case schema_general.GI.InitialPage:case schema_general.GI.Page:{if("string"!=typeof value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value});let decoded=(0,utils.fB)(value);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:source.doPathCleaning?(0,PathCleanFilterItem.Z)(decoded):decoded})}case schema_general.GI.Viewport:if(Array.isArray(value)){let[width,height]=value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[width,"x",height]})}break;case schema_general.GI.Country:if("string"==typeof value)return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,WorldMap.q9)(value)," ",WorldMap.XJ[value]||value]});break;case schema_general.GI.Region:if(Array.isArray(value)){let[countryCode,regionCode,regionName]=value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,WorldMap.q9)(countryCode)," ",WorldMap.XJ[countryCode]||countryCode," -"," ",regionName||regionCode]})}break;case schema_general.GI.City:if(Array.isArray(value)){let[countryCode,cityName]=value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,WorldMap.q9)(countryCode)," ",WorldMap.XJ[countryCode]||countryCode," - ",cityName]})}break;case schema_general.GI.Timezone:if("number"==typeof value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:toUtcOffsetFormat(value)});break;case schema_general.GI.Language:if("string"==typeof value){var _countryCode$match$,_countryCodeToFlag;let[languageCode,countryCode]=value.split("-"),parsedCountryCode=null!==(_countryCode$match$=countryCode?.match(/([A-Z]{2})/)?.[0])&&void 0!==_countryCode$match$?_countryCode$match$:"";return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[null!==(_countryCodeToFlag=(0,WorldMap.q9)(parsedCountryCode))&&void 0!==_countryCodeToFlag?_countryCodeToFlag:(0,countryCodes.RD)(languageCode),"Â ",countryCodes.lY[languageCode]||languageCode]})}break;case schema_general.GI.DeviceType:if("string"==typeof value)return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(PropertyIcon.V,{property:"$device_type",value:value}),(0,jsx_runtime.jsx)("span",{children:value})]});break;case schema_general.GI.Browser:if("string"==typeof value)return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(PropertyIcon.V,{property:"$browser",value:value}),(0,jsx_runtime.jsx)("span",{children:value})]});break;case schema_general.GI.OS:if("string"==typeof value)return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(PropertyIcon.V,{property:"$os",value:value}),(0,jsx_runtime.jsx)("span",{children:value})]})}return"string"==typeof value?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value}):null}},bounce_rate:{renderTitle:SortableCell("Bounce Rate",schema_general.nV.BounceRate),render:VariationCell({isPercentage:!0,reverseColors:!0}),align:"right"},views:{renderTitle:SortableCell("Views",schema_general.nV.Views),render:VariationCell(),align:"right"},clicks:{renderTitle:SortableCell("Clicks",schema_general.nV.Clicks),render:VariationCell(),align:"right"},visitors:{renderTitle:SortableCell("Visitors",schema_general.nV.Visitors),render:VariationCell(),align:"right"},average_scroll_percentage:{renderTitle:SortableCell("Average Scroll",schema_general.nV.AverageScrollPercentage),render:VariationCell({isPercentage:!0}),align:"right"},scroll_gt80_percentage:{renderTitle:SortableCell("Deep Scroll Rate",schema_general.nV.ScrollGt80Percentage),render:VariationCell({isPercentage:!0}),align:"right"},total_conversions:{renderTitle:SortableCell("Total Conversions",schema_general.nV.TotalConversions),render:VariationCell(),align:"right"},unique_conversions:{renderTitle:SortableCell("Unique Conversions",schema_general.nV.UniqueConversions),render:VariationCell(),align:"right"},conversion_rate:{renderTitle:SortableCell("Conversion Rate",schema_general.nV.ConversionRate),render:VariationCell({isPercentage:!0}),align:"right"},converting_users:{renderTitle:SortableCell("Converting Users",schema_general.nV.ConvertingUsers),render:VariationCell(),align:"right"},action_name:{title:"Action"},cross_sell:{title:" ",render:_ref2=>{var _record$;let{record,query}=_ref2,dateRange=query.source?.dateRange,breakdownBy=query.source?.breakdownBy,value=null!==(_record$=record[0])&&void 0!==_record$?_record$:"";return(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center justify-end",children:[(0,jsx_runtime.jsx)(ReplayButton,{date_from:dateRange?.date_from,date_to:dateRange?.date_to,breakdownBy:breakdownBy,value:value}),(0,jsx_runtime.jsx)(HeatmapButton,{breakdownBy:breakdownBy,value:value})]})},align:"right"}}},WebStatsTrendTile=_ref3=>{let{query,showIntervalTile,insightProps}=_ref3,{togglePropertyFilter,setInterval}=(0,index_esm.useActions)(webAnalyticsLogic.WG),{hasCountryFilter,dateFilter:{interval}}=(0,index_esm.useValues)(webAnalyticsLogic.WG),worldMapPropertyName=webStatsBreakdownToPropertyName(schema_general.GI.Country)?.key,onWorldMapClick=(0,react.useCallback)(breakdownValue=>{worldMapPropertyName&&togglePropertyFilter(types.FT.Event,worldMapPropertyName,breakdownValue,{geographyTab:hasCountryFilter?void 0:webAnalyticsLogic.QX.REGIONS})},[togglePropertyFilter,worldMapPropertyName,hasCountryFilter]),context=(0,react.useMemo)(()=>({...webAnalyticsDataTableQueryContext,onDataPointClick(_ref4,data){let{breakdown}=_ref4;"string"===breakdown&&data&&(data.count>0||data.aggregated_value>0)&&onWorldMapClick(breakdown)},insightProps:{...insightProps,query}}),[onWorldMapClick,insightProps]);return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[showIntervalTile&&(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center",children:[(0,jsx_runtime.jsx)("span",{className:"mr-2",children:"Group by"}),(0,jsx_runtime.jsx)(IntervalFilter.T,{interval:interval,onIntervalChange:setInterval,options:[{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}]})]})}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})]})},WebStatsTableTile=_ref5=>{let{query,breakdownBy,insightProps,control}=_ref5,{togglePropertyFilter}=(0,index_esm.useActions)(webAnalyticsLogic.WG),{key,type}=webStatsBreakdownToPropertyName(breakdownBy)||{},onClick=(0,react.useCallback)(breakdownValue=>{key&&type&&togglePropertyFilter(type,key,breakdownValue)},[togglePropertyFilter,type,key]),context=(0,react.useMemo)(()=>({...webAnalyticsDataTableQueryContext,insightProps,rowProps:record=>{if(!key||!type||breakdownBy===schema_general.GI.Language||breakdownBy===schema_general.GI.Timezone)return{};let breakdownValue=getBreakdownValue(record,breakdownBy);return void 0===breakdownValue?{}:{onClick:()=>onClick(breakdownValue)}}}),[onClick,insightProps]);return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[null!=control&&(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:control}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})]})},getBreakdownValue=(record,breakdownBy)=>{if("object"!=typeof record||!record||!("result"in record))return;let result=record.result;if(!Array.isArray(result))return;let breakdownValue=result[0];switch(breakdownBy){case schema_general.GI.Country:if(Array.isArray(breakdownValue))return breakdownValue[0];break;case schema_general.GI.Region:case schema_general.GI.City:if(Array.isArray(breakdownValue))return breakdownValue[1]}return null===breakdownValue?null:"string"==typeof breakdownValue?breakdownValue:void 0},WebGoalsTile=_ref6=>{let{query,insightProps}=_ref6,{actions,actionsLoading}=(0,index_esm.useValues)(actionsModel.D),{updateHasSeenProductIntroFor}=(0,index_esm.useActions)(userLogic.userLogic);return actionsLoading?null:actions.length?(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row-reverse p-2",children:(0,jsx_runtime.jsx)(LemonButton.J,{to:urls.j.actions(),sideIcon:(0,jsx_runtime.jsx)(icons.pF,{}),type:"secondary",size:"small",children:"Manage actions"})}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})]}):(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Actions",productKey:types.Md.ACTIONS,thingName:"action",isEmpty:!0,description:"Use actions to combine events that you want to have tracked together or to make detailed Autocapture events easier to reuse.",docsURL:"https://posthog.com/docs/data/actions",actionElementOverride:(0,jsx_runtime.jsx)(NewActionButton.O,{onSelectOption:()=>updateHasSeenProductIntroFor(types.Md.ACTIONS,!0)})})},WebExternalClicksTile=_ref7=>{let{query,insightProps}=_ref7,{shouldStripQueryParams}=(0,index_esm.useValues)(webAnalyticsLogic.WG),{setShouldStripQueryParams}=(0,index_esm.useActions)(webAnalyticsLogic.WG);return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center deprecated-space-x-2",children:(0,jsx_runtime.jsx)(LemonSwitch.f,{label:"Strip query parameters",checked:shouldStripQueryParams,onChange:setShouldStripQueryParams,className:"h-full"})})}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})]})},WebVitalsPathBreakdownTile=_ref8=>{let{query,insightProps}=_ref8,{isPathCleaningEnabled}=(0,index_esm.useValues)(webAnalyticsLogic.WG),{setIsPathCleaningEnabled}=(0,index_esm.useActions)(webAnalyticsLogic.WG);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center gap-1 m-2",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold",children:"Path Breakdown"}),!isPathCleaningEnabled&&(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("span",{children:["Path Breakdown is more useful when path cleaning is turned on."," ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>setIsPathCleaningEnabled(!0),children:"Enable it."})]}),interactive:!0,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{className:"mb-2",fontSize:"18"})})]}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})]})},WebQuery=_ref9=>{let{query,showIntervalSelect,control,insightProps}=_ref9;return query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.WebStatsTableQuery?(0,jsx_runtime.jsx)(WebStatsTableTile,{query:query,breakdownBy:query.source.breakdownBy,insightProps:insightProps,control:control}):query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.WebExternalClicksTableQuery?(0,jsx_runtime.jsx)(WebExternalClicksTile,{query:query,insightProps:insightProps}):query.kind===schema_general.OH.InsightVizNode?(0,jsx_runtime.jsx)(WebStatsTrendTile,{query:query,showIntervalTile:showIntervalSelect,insightProps:insightProps}):query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.WebGoalsQuery?(0,jsx_runtime.jsx)(WebGoalsTile,{query:query,insightProps:insightProps}):query.kind===schema_general.OH.WebVitalsPathBreakdownQuery?(0,jsx_runtime.jsx)(WebVitalsPathBreakdownTile,{query:query,insightProps:insightProps}):(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})}}}]);