(window.webpackJsonp=window.webpackJsonp||[]).push([[238],{"./frontend/src/lib/components/RestrictedArea.tsx":function(ye,z,t){"use strict";t.d(z,"b",function(){return S}),t.d(z,"a",function(){return k});var U=t("./node_modules/core-js/modules/es.array.concat.js"),N=t.n(U),Q=t("./node_modules/kea/lib/index.esm.js"),O=t("./node_modules/react/index.js"),e=t.n(O),R=t("./frontend/src/scenes/organizationLogic.tsx"),_=t("./frontend/src/lib/constants.tsx"),le=t("./frontend/src/lib/components/Tooltip.tsx"),q=t("./frontend/src/lib/utils/permissioning.ts"),w=t("./frontend/src/scenes/teamLogic.tsx"),S;(function(M){M.Organization="organization",M.Project="project"})(S||(S={}));function k(M){var ce=M.Component,ee=M.minimumAccessLevel,de=M.scope,X=de===void 0?S.Organization:de,B=Object(Q.useValues)(R.a),v=B.currentOrganization,ne=Object(Q.useValues)(w.a),F=ne.currentTeam,W=Object(O.useMemo)(function(){var T;if(X===S.Project){if(!F)return"Loading current project\u2026";T=F.effective_membership_level}else{if(!v)return"Loading current organization\u2026";T=v.membership_level}return T===null?"You don't have access to the current ".concat(X,"."):T<ee?ee===_.n.Owner?"This area is restricted to the ".concat(X," owner."):"This area is restricted to ".concat(X," ").concat(q.b.get(ee),"s and up. Your level is ").concat(q.b.get(T),"."):null},[v]);return W?e.a.createElement(le.a,{title:W,placement:"topLeft",delayMs:0},e.a.createElement("span",null,e.a.createElement(ce,{isRestricted:!0,restrictionReason:W}))):e.a.createElement(ce,{isRestricted:!1,restrictionReason:null})}try{k.displayName="RestrictedArea",k.__docgenInfo={description:"",displayName:"RestrictedArea",props:{Component:{defaultValue:null,description:"",name:"Component",required:!0,type:{name:"(props: RestrictedComponentProps) => Element"}},minimumAccessLevel:{defaultValue:null,description:"",name:"minimumAccessLevel",required:!0,type:{name:"enum",value:[{value:"1"},{value:"8"},{value:"15"},{value:"1"},{value:"8"}]}},scope:{defaultValue:{value:"RestrictionScope.Organization"},description:"",name:"scope",required:!1,type:{name:"enum",value:[{value:'"organization"'},{value:'"project"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"]={docgenInfo:k.__docgenInfo,name:"RestrictedArea",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"})}catch(M){}try{S.Organization.displayName="RestrictionScope.Organization",S.Organization.__docgenInfo={description:"Current organization-wide membership level will be used.",displayName:"RestrictionScope.Organization",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"]={docgenInfo:S.Organization.__docgenInfo,name:"RestrictionScope.Organization",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"})}catch(M){}try{S.Project.displayName="RestrictionScope.Project",S.Project.__docgenInfo={description:"Effective level for the current project will be used.",displayName:"RestrictionScope.Project",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"]={docgenInfo:S.Project.__docgenInfo,name:"RestrictionScope.Project",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"})}catch(M){}},"./frontend/src/lib/hooks/useAnchor.ts":function(ye,z,t){"use strict";t.d(z,"a",function(){return Q});var U=t("./node_modules/react/index.js"),N=t.n(U);function Q(O){Object(U.useEffect)(function(){if(O&&document.getElementById(O.substr(1))){var e=document.getElementById(O.substr(1));if(!e)return;e.classList.add("highlighted");var R=e.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:R-50-32,behavior:"smooth"})}},[O])}},"./frontend/src/scenes/organization/Settings/index.tsx":function(ye,z,t){"use strict";t.r(z),t.d(z,"scene",function(){return fn}),t.d(z,"OrganizationSettings",function(){return Ie});var U=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),N=t.n(U),Q=t("./node_modules/core-js/modules/es.function.name.js"),O=t("./node_modules/react/index.js"),e=t.n(O),R=t("./node_modules/antd/es/input/index.js"),_=t("./node_modules/antd/es/button/index.js"),le=t("./node_modules/antd/es/switch/index.js"),q=t("./node_modules/antd/es/card/index.js"),w=t("./node_modules/antd/es/divider/index.js"),S=t("./frontend/src/lib/components/PageHeader.tsx"),k=t("./node_modules/core-js/modules/es.array.iterator.js"),M=t("./node_modules/core-js/modules/es.object.to-string.js"),ce=t("./node_modules/core-js/modules/es.string.iterator.js"),ee=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),de=t("./node_modules/core-js/modules/web.url.js"),X=t("./node_modules/core-js/modules/web.url-search-params.js"),B=t("./node_modules/antd/es/modal/index.js"),v=t("./node_modules/kea/lib/index.esm.js"),ne=t("./node_modules/@ant-design/icons/es/icons/ExclamationCircleOutlined.js"),F=t("./frontend/src/lib/components/CopyToClipboard.tsx"),W=t("./frontend/src/lib/components/ProfilePicture/index.ts"),T=t("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),ze=t("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),ue=t("./frontend/src/lib/components/LemonTable/index.ts"),he=t("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),Oe=t("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),j=t("./frontend/src/lib/components/LemonButton/index.ts"),x=t("./frontend/src/lib/components/icons.tsx");function Te(a,n){var o=new URL("/signup/".concat(a),document.baseURI).href;return n.is_expired?e.a.createElement("b",null,"Expired! Delete and recreate"):e.a.createElement(F.a,{"data-attr":"invite-link",description:"invite link"},o)}function Pe(a){return function(o,r){return e.a.createElement(j.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:e.a.createElement(x.IconClose,null),status:"danger",onClick:function(){r.is_expired?a(r):B.a.confirm({title:"Do you want to cancel the invite for ".concat(r.target_email,"?"),icon:e.a.createElement(ne.a,null),okText:"Yes, cancel invite",okType:"danger",onOk:function(){a(r)},cancelText:"No, keep invite"})}})}}function Ne(){var a=Object(v.useValues)(T.a),n=a.invites,o=a.invitesLoading,r=Object(v.useActions)(T.a),i=r.deleteInvite,l=r.showInviteModal,s=Object(v.useValues)(Oe.a),c=s.preflight,f=[{key:"user_profile_picture",render:function(d,u){return e.a.createElement(W.b,{name:u.first_name,email:u.target_email})},width:32},{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(d,u){return u.target_email?e.a.createElement("div",{className:"flex items-center"},u.target_email,u.first_name?" (".concat(u.first_name,")"):""):e.a.createElement("i",null,"no one")},width:"20%"},Object(he.b)(),Object(he.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(d,u){return Te(u.id,u)}},{title:"",key:"actions",width:24,render:Pe(i)}];return e.a.createElement("div",null,e.a.createElement("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"}},"Pending Invites",e.a.createElement(j.a,{type:"primary",onClick:l,"data-attr":"invite-teammate-button"},"Invite team member")),!(c!=null&&c.email_service_available)&&e.a.createElement(ze.a,null),e.a.createElement(ue.a,{dataSource:n,columns:f,rowKey:"id",loading:o,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."}))}var En=t("./node_modules/core-js/modules/es.array.filter.js"),yn=t("./node_modules/core-js/modules/es.array.map.js"),hn=t("./node_modules/core-js/modules/es.array.concat.js"),On=t("./node_modules/core-js/modules/es.regexp.exec.js"),bn=t("./node_modules/core-js/modules/es.string.search.js"),me=t("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),be=t("./node_modules/@ant-design/icons/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),we={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"},Be=we,Fe=t("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),Se=function(n,o){return O.createElement(Fe.a,Object(be.a)(Object(be.a)({},n),{},{ref:o,icon:Be}))};Se.displayName="SwapOutlined";var Ke=O.forwardRef(Se),b=t("./frontend/src/lib/constants.tsx"),V=t("./frontend/src/scenes/organizationLogic.tsx"),je=t("./frontend/src/scenes/userLogic.ts"),Y=t("./frontend/src/lib/utils/permissioning.ts"),Ue=t("./frontend/src/lib/components/TimezoneAware/index.tsx"),Ae=t("./frontend/src/lib/components/LemonButton/More.tsx"),fe=t("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),We=t("./frontend/src/lib/components/LemonDivider/index.ts"),Ce=t("./frontend/@posthog/lemon-ui/src/index.ts");function Ye(a,n){var o,r=Object(v.useValues)(je.a),i=r.user,l=Object(v.useValues)(V.a),s=l.currentOrganization,c=Object(v.useActions)(me.a),f=c.removeMember,m=c.changeMemberAccessLevel;if(!i)return null;var d=(o=s==null?void 0:s.membership_level)!==null&&o!==void 0?o:-1,u=(d>=b.n.Admin&&n.level<=d||n.user.uuid===i.uuid)&&n.level!==b.n.Owner,y=s?s.membership_level:null,g=Y.c.filter(function(E){return!Object(Y.a)(y,i,n,E)}),I=Object(Y.a)(y,i,n,g);return e.a.createElement(Ae.a,{overlay:e.a.createElement(e.a.Fragment,null,I?e.a.createElement("div",null,I):g.map(function(E){return e.a.createElement(j.a,{status:"stealth",fullWidth:!0,key:"".concat(n.user.uuid,"-level-").concat(E),onClick:function(p){if(p.preventDefault(),!i)throw Error;if(E===b.n.Owner){var h;B.a.confirm({centered:!0,title:"Transfer organization ownership to ".concat(n.user.first_name,"?"),content:"You will no longer be the owner of ".concat((h=i.organization)===null||h===void 0?void 0:h.name,". After the transfer you will become an administrator."),icon:e.a.createElement(Ke,null),okType:"danger",okText:"Transfer Ownership",onOk:function(){m(n,E)}})}else m(n,E)},"data-test-level":E},E===b.n.Owner?e.a.createElement(e.a.Fragment,null,"Transfer organization ownership"):E>n.level?e.a.createElement(e.a.Fragment,null,"Upgrade to ",Y.b.get(E)):e.a.createElement(e.a.Fragment,null,"Downgrade to ",Y.b.get(E)))}),u?e.a.createElement(e.a.Fragment,null,e.a.createElement(We.a,null),e.a.createElement(j.a,{status:"danger","data-attr":"delete-org-membership",onClick:function(){var C;if(!i)throw Error;B.a.confirm({title:"".concat(n.user.uuid==i.uuid?"Leave":"Remove ".concat(n.user.first_name," from")," organization ").concat((C=i.organization)===null||C===void 0?void 0:C.name,"?"),icon:e.a.createElement(ne.a,null),okText:n.user.uuid==i.uuid?"Leave":"Remove",okType:"danger",cancelText:"Cancel",onOk:function(){f(n)}})},fullWidth:!0},n.user.uuid!==i.uuid?"Remove from organization":"Leave organization")):null)})}function te(a){var n=a.user,o=Object(v.useValues)(me.a),r=o.filteredMembers,i=o.membersLoading,l=o.search,s=Object(v.useActions)(me.a),c=s.setSearch,f=[{key:"user_profile_picture",render:function(d,u){return e.a.createElement(W.b,{name:u.user.first_name,email:u.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(d,u){return u.user.uuid==n.uuid?"".concat(u.user.first_name," (me)"):u.user.first_name},sorter:function(d,u){return d.user.first_name.localeCompare(u.user.first_name)}},{title:"Email",key:"user_email",render:function(d,u){return u.user.email},sorter:function(d,u){return d.user.email.localeCompare(u.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(d,u){var y;return e.a.createElement(fe.a,{"data-attr":"membership-level"},u.level===b.n.Owner?"Organization owner":"Project ".concat((y=Y.b.get(u.level))!==null&&y!==void 0?y:"unknown (".concat(u.level,")")))},sorter:function(d,u){return d.level-u.level}},{title:"Joined",dataIndex:"joined_at",key:"joined_at",render:function(d){return e.a.createElement("div",{className:"whitespace-nowrap"},e.a.createElement(Ue.b,{time:d}))},sorter:function(d,u){return d.joined_at.localeCompare(u.joined_at)}},{key:"actions",width:0,render:Ye}];return e.a.createElement(e.a.Fragment,null,e.a.createElement("h2",{className:"subtitle"},"Members"),e.a.createElement(Ce.LemonInput,{type:"search",placeholder:"Search for members",value:l,onChange:c}),e.a.createElement(ue.a,{dataSource:r,columns:f,rowKey:"id",style:{marginTop:"1rem"},loading:i,"data-attr":"org-members-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}}))}try{te.displayName="Members",te.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:te.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(a){}var $e=t("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),Ze=t("./node_modules/antd/lib/typography/Paragraph.js"),Ge=t.n(Ze);function ae(a){var n=a.isVisible,o=a.setIsVisible,r=Object(v.useValues)(V.a),i=r.currentOrganization,l=r.organizationBeingDeleted,s=Object(v.useActions)(V.a),c=s.deleteOrganization,f=Object(O.useState)(!1),m=N()(f,2),d=m[0],u=m[1],y=!!i&&(l==null?void 0:l.id)===i.id;return e.a.createElement(B.a,{title:"Delete the entire organization?",okText:"Delete ".concat(i?i.name:"the current organization"),onOk:i?function(){return c(i)}:void 0,okType:"primary",okButtonProps:{"data-attr":"delete-organization-ok",loading:y,disabled:!d,className:"btn-danger"},onCancel:function(){return o(!1)},cancelButtonProps:{disabled:y},visible:n},e.a.createElement("p",null,"Organization deletion ",e.a.createElement("b",null,"cannot be undone"),". You will lose all data, ",e.a.createElement("b",null,"including all events"),", related to all projects within this organization."),e.a.createElement("p",null,"Please type"," ",e.a.createElement("strong",null,i?i.name:"this organization's name")," to confirm."),e.a.createElement(R.a,{type:"text",onChange:function(I){if(i){var E=I.target.value;u(E.toLowerCase()===i.name.toLowerCase())}}}))}function re(a){var n=a.isRestricted,o=Object(v.useValues)(V.a),r=o.currentOrganization,i=Object(O.useState)(!1),l=N()(i,2),s=l[0],c=l[1];return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{style:{color:"var(--danger)"}},e.a.createElement("h2",{style:{color:"var(--danger)"},className:"subtitle"},"Danger Zone"),e.a.createElement("div",{className:"mt-4"},!n&&e.a.createElement(Ge.a,{type:"danger"},"This is ",e.a.createElement("b",null,"irreversible"),". Please be certain."),e.a.createElement(_.a,{type:"primary",onClick:function(){return c(!0)},className:"mr-2 btn-danger","data-attr":"delete-project-button",icon:e.a.createElement($e.a,null),disabled:n},"Delete ",(r==null?void 0:r.name)||"the current organization"))),e.a.createElement(ae,{isVisible:s,setIsVisible:c}))}try{ae.displayName="DeleteOrganizationModal",ae.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isVisible:{defaultValue:null,description:"",name:"isVisible",required:!0,type:{name:"boolean"}},setIsVisible:{defaultValue:null,description:"",name:"setIsVisible",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:ae.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(a){}try{re.displayName="DangerZone",re.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:re.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(a){}var ie=t("./frontend/src/lib/components/RestrictedArea.tsx"),He=t("./frontend/src/lib/hooks/useAnchor.ts"),Je=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),oe=t.n(Je),ve=t("./frontend/src/lib/components/Tooltip.tsx"),Sn=t("./node_modules/core-js/modules/es.object.keys.js"),jn=t("./node_modules/core-js/modules/es.symbol.js"),An=t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Cn=t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ln=t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Qe=t("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),ke=t.n(Qe),Xe=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),_e=t.n(Xe),qe=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),$=t.n(qe),en=t("./node_modules/@babel/runtime/regenerator/index.js"),A=t.n(en),Dn=t("./node_modules/core-js/modules/es.array.sort.js"),Mn=t("./node_modules/core-js/modules/es.array.find.js"),xn=t("./node_modules/core-js/modules/es.array.includes.js"),Vn=t("./node_modules/core-js/modules/es.string.includes.js"),In=t("./node_modules/core-js/modules/es.string.match.js"),Z=t("./frontend/src/lib/api.ts"),se=t("./frontend/src/lib/components/lemonToast.tsx"),Le=t("./frontend/src/types.ts"),De=t("./node_modules/kea-forms/lib/index.js"),nn=t("./node_modules/kea-loaders/lib/index.js"),tn=["id"];function Me(a,n){var o=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);n&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),o.push.apply(o,r)}return o}function ge(a){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?Me(Object(o),!0).forEach(function(r){_e()(a,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):Me(Object(o)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(o,r))})}return a}var D=Object(v.kea)([Object(v.path)(["scenes","organization","verifiedDomainsLogic"]),Object(v.connect)({values:[V.a,["currentOrganization"]]}),Object(v.actions)({replaceDomain:function(n){return{domain:n}},setAddModalShown:function(n){return{shown:n}},setConfigureSAMLModalId:function(n){return{id:n}},setVerifyModal:function(n){return{id:n}}}),Object(v.reducers)({verifiedDomains:[[],{replaceDomain:function(n,o){var r=o.domain,i=[].concat(oe()(n.filter(function(l){var s=l.id;return s!==r.id})),[r]);return i.sort(function(l,s){return l.domain.localeCompare(s.domain)}),i}}],addModalShown:[!1,{setAddModalShown:function(n,o){var r=o.shown;return r},addVerifiedDomainSuccess:function(){return!1}}],configureSAMLModalId:[null,{setConfigureSAMLModalId:function(n,o){var r=o.id;return r}}],verifyModal:[null,{setVerifyModal:function(n,o){var r=o.id;return r}}]}),Object(nn.loaders)(function(a){var n=a.values,o=a.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var r=$()(A.a.mark(function l(){var s;return A.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Z.b.get("api/organizations/".concat((s=n.currentOrganization)===null||s===void 0?void 0:s.id,"/domains"));case 2:return f.abrupt("return",f.sent.results);case 3:case"end":return f.stop()}},l)}));function i(){return r.apply(this,arguments)}return i}(),addVerifiedDomain:function(){var r=$()(A.a.mark(function l(s){var c,f;return A.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,Z.b.create("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains"),{domain:s});case 2:return f=d.sent,d.abrupt("return",[f].concat(oe()(n.verifiedDomains)));case 4:case"end":return d.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}(),deleteVerifiedDomain:function(){var r=$()(A.a.mark(function l(s){var c;return A.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,Z.b.delete("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s));case 2:return m.abrupt("return",oe()(n.verifiedDomains.filter(function(d){return d.id!==s})));case 3:case"end":return m.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}()}],updatingDomain:[!1,{updateDomain:function(){var r=$()(A.a.mark(function l(s){var c,f;return A.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,Z.b.update("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s.id),ge(ge({},s),{},{id:void 0}));case 2:return f=d.sent,se.d.success("Domain updated successfully! Changes will take immediately."),o.replaceDomain(f),d.abrupt("return",!1);case 6:case"end":return d.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}(),verifyDomain:function(){var r=$()(A.a.mark(function l(){var s,c;return A.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,Z.b.create("api/organizations/".concat((s=n.currentOrganization)===null||s===void 0?void 0:s.id,"/domains/").concat(n.verifyModal,"/verify"));case 2:return c=m.sent,c.is_verified?se.d.success("Domain verified successfully."):se.d.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),o.replaceDomain(c),o.setVerifyModal(null),m.abrupt("return",!1);case 7:case"end":return m.stop()}},l)}));function i(){return r.apply(this,arguments)}return i}()}]}}),Object(v.listeners)(function(a){var n=a.actions,o=a.values;return{setConfigureSAMLModalId:function(i){var l=i.id,s=o.verifiedDomains.find(function(d){var u=d.id;return u===l});if(l&&s){var c=s.saml_acs_url,f=s.saml_entity_id,m=s.saml_x509_cert;n.setSamlConfigValues({saml_acs_url:c,saml_entity_id:f,saml_x509_cert:m,id:l})}}}}),Object(v.selectors)({domainBeingVerified:[function(a){return[a.verifiedDomains,a.verifyModal]},function(a,n){return n&&a.find(function(o){var r=o.id;return r===n})||null}],isSSOEnforcementAvailable:[function(a){return[a.currentOrganization]},function(a){var n;return(n=a==null?void 0:a.available_features.includes(Le.d.SSO_ENFORCEMENT))!==null&&n!==void 0?n:!1}],isSAMLAvailable:[function(a){return[a.currentOrganization]},function(a){var n;return(n=a==null?void 0:a.available_features.includes(Le.d.SAML))!==null&&n!==void 0?n:!1}]}),Object(v.afterMount)(function(a){var n=a.actions;return n.loadVerifiedDomains()}),Object(De.forms)(function(a){var n=a.actions,o=a.values;return{samlConfig:{defaults:{},errors:function(i){return{saml_acs_url:i.saml_acs_url&&!i.saml_acs_url.match(b.v)?"Please enter a valid URL, including https://":void 0}},submit:function(){var r=$()(A.a.mark(function l(s,c){var f,m,d,u;return A.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(m=s.id,d=ke()(s,tn),m){g.next=3;break}return g.abrupt("return");case 3:return g.next=5,Z.b.update("api/organizations/".concat((f=o.currentOrganization)===null||f===void 0?void 0:f.id,"/domains/").concat(s.id),ge({},d));case 5:u=g.sent,c(),n.replaceDomain(u),n.setConfigureSAMLModalId(null),n.setSamlConfigValues({}),se.d.success("SAML configuration for ".concat(u.domain," updated successfully."));case 11:case"end":return g.stop()}},l)}));function i(l,s){return r.apply(this,arguments)}return i}()}}})]),pe=t("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),G=t("./frontend/src/lib/components/LemonModal/index.ts");function an(){var a=Object(v.useValues)(D),n=a.addModalShown,o=a.verifiedDomainsLoading,r=Object(v.useActions)(D),i=r.setAddModalShown,l=r.addVerifiedDomain,s=Object(O.useState)(""),c=N()(s,2),f=c[0],m=c[1],d=Object(O.useState)(!1),u=N()(d,2),y=u[0],g=u[1],I=!f||!f.match(b.c),E=function(){m(""),g(!1)},C=function(){i(!1),E()},p=function(){g(!0),I||(l(f),E())};return e.a.createElement(G.a,{onClose:C,isOpen:n,title:"Add authentication domain",footer:e.a.createElement(j.a,{type:"primary",disabled:f===""||y&&I||o,onClick:p},"Add domain")},e.a.createElement(Ce.LemonInput,{placeholder:"posthog.com",autoFocus:!0,value:f,onChange:m,onPressEnter:p}),y&&I&&e.a.createElement("span",{className:"text-danger text-xs"},"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"))}var rn=t("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx");function on(){var a=Object(v.useValues)(D),n=a.domainBeingVerified,o=a.updatingDomainLoading,r=Object(v.useActions)(D),i=r.setVerifyModal,l=r.verifyDomain,s="_posthog-challenge.".concat(n==null?void 0:n.domain,".");return e.a.createElement(G.a,{isOpen:!!n,onClose:function(){return i(null)},title:"Verify your domain",description:e.a.createElement(e.a.Fragment,null,e.a.createElement(fe.a,null,(n==null?void 0:n.domain)||""),e.a.createElement("p",null,"To verify your domain, you need to add a record to your DNS zone.")),footer:e.a.createElement(e.a.Fragment,null,e.a.createElement(j.a,{type:"secondary",onClick:function(){return i(null)}},"Verify later"),e.a.createElement(j.a,{type:"primary",disabled:o,onClick:l},"Verify"))},e.a.createElement("div",null,e.a.createElement("ol",null,e.a.createElement("li",null,"Sign in to your DNS provider."),e.a.createElement("li",null,"Add the following ",e.a.createElement("b",null,"TXT")," record.",e.a.createElement("div",{className:"my-4"},e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-name"},"Name"),e.a.createElement("div",{className:"flex items-center"},e.a.createElement(R.a,{disabled:!0,value:s,name:"record-name"}),e.a.createElement(F.a,{explicitValue:s,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"Value or content"),e.a.createElement("div",{className:"flex items-center"},e.a.createElement(R.a,{disabled:!0,value:n==null?void 0:n.verification_challenge,name:"record-value"}),e.a.createElement(F.a,{explicitValue:n==null?void 0:n.verification_challenge,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"TTL"),e.a.createElement("div",{className:"flex items-center"},e.a.createElement(R.a,{disabled:!0,value:"Default or 3600",name:"record-value"}),e.a.createElement(F.a,{explicitValue:"3600",style:{marginLeft:4}}))))),e.a.createElement("li",null,"Press verify below."))))}var xe=t("./frontend/src/lib/components/Link.tsx"),sn=t("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),Ee=t("./frontend/src/lib/forms/Field.tsx"),ln=t("./frontend/src/lib/components/AlertMessage/index.ts"),Ve=t("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),cn=t("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx");function dn(){var a=Object(v.useValues)(D),n=a.configureSAMLModalId,o=a.isSamlConfigSubmitting,r=a.samlConfig,i=Object(v.useActions)(D),l=i.setConfigureSAMLModalId,s=r.saml_acs_url&&r.saml_entity_id&&r.saml_x509_cert,c=function(){l(null)};return e.a.createElement(G.a,{onClose:c,isOpen:!!n,title:"",simple:!0},e.a.createElement(De.Form,{logic:D,formKey:"samlConfig",enableFormOnSubmit:!0,className:"LemonModal__layout "},e.a.createElement(G.a.Header,null,e.a.createElement("h3",null,"Configure SAML authentication and provisioning")),e.a.createElement(G.a.Content,{className:"space-y-2"},e.a.createElement(Ee.a,{name:"saml_acs_url",label:"SAML ACS URL"},e.a.createElement(Ve.a,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})),e.a.createElement(Ee.a,{name:"saml_entity_id",label:"SAML Entity ID"},e.a.createElement(Ve.a,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})),e.a.createElement(Ee.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate"},e.a.createElement(cn.a,{className:"ph-ignore-input",minRows:10,placeholder:`Enter the public certificate of your IdP. Keep all line breaks.
-----BEGIN CERTIFICATE-----
MIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL
-----END CERTIFICATE-----`})),!s&&e.a.createElement(ln.a,{type:"info",style:{marginBottom:16}},"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft.")),e.a.createElement(G.a.Footer,null,e.a.createElement(j.a,{loading:o,type:"primary",htmlType:"submit"},"Save settings"))))}var H={marginRight:4,fontSize:"1.15em",paddingTop:2};function un(){var a=Object(v.useValues)(D),n=a.verifiedDomainsLoading,o=a.updatingDomainLoading,r=Object(v.useActions)(D),i=r.setAddModalShown;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"flex items-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("div",{id:"domain-whitelist"})," ",e.a.createElement("h2",{id:"authentication-domains",className:"subtitle"},"Authentication domains"),e.a.createElement("p",{className:"text-muted-alt"},"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains.")),e.a.createElement(j.a,{type:"primary",onClick:function(){return i(!0)},disabled:n||o},"Add domain")),e.a.createElement(mn,null))}function mn(){var a=Object(v.useValues)(D),n=a.verifiedDomains,o=a.verifiedDomainsLoading,r=a.currentOrganization,i=a.updatingDomainLoading,l=a.isSSOEnforcementAvailable,s=a.isSAMLAvailable,c=Object(v.useActions)(D),f=c.updateDomain,m=c.deleteVerifiedDomain,d=c.setVerifyModal,u=c.setConfigureSAMLModalId,y=Object(v.useValues)(Oe.a),g=y.preflight,I=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function(C,p){var h=p.domain;return e.a.createElement(fe.a,{style:{textTransform:"lowercase"}},h)}}].concat(oe()(g!=null&&g.cloud?[{key:"is_verified",title:e.a.createElement(e.a.Fragment,null,"Verification",e.a.createElement(ve.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO)."},e.a.createElement(pe.a,{style:{marginLeft:4}}))),render:function(C,p){var h=p.is_verified,L=p.verified_at;return h?e.a.createElement("div",{className:"flex items-center text-success"},e.a.createElement(x.IconCheckmark,{style:H})," Verified"):L?e.a.createElement("div",{className:"flex items-center text-danger"},e.a.createElement(x.IconExclamation,{style:H})," Verification expired"):e.a.createElement("div",{className:"flex items-center text-warning"},e.a.createElement(x.IconWarningAmber,{style:H})," Pending verification")}}]:[]),[{key:"jit_provisioning_enabled",title:e.a.createElement(e.a.Fragment,null,"Automatic provisioning"," ",e.a.createElement(ve.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((r==null?void 0:r.name)||"this organization"," if it does not exist.")},e.a.createElement(pe.a,null))),render:function(C,p){var h=p.jit_provisioning_enabled,L=p.id,P=p.is_verified;return P?e.a.createElement("div",{className:"flex items-center"},e.a.createElement(sn.a,{checked:h,disabled:i||!P,onChange:function(J){return f({id:L,jit_provisioning_enabled:J})},label:e.a.createElement("span",{className:"font-normal"},h?"Enabled":"Disabled")})):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable automatic provisioning")}},{key:"sso_enforcement",title:e.a.createElement(e.a.Fragment,null,"Enforce SSO"," ",e.a.createElement(ve.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider."},e.a.createElement(pe.a,null))),render:function(C,p,h){var L=p.sso_enforcement,P=p.is_verified,K=p.id,J=p.has_saml;return l?P?e.a.createElement(rn.a,{value:L,loading:i,onChange:function(pn){return f({id:K,sso_enforcement:pn})},samlAvailable:J}):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):h===0?e.a.createElement(xe.a,{to:Object(b.B)(g==null?void 0:g.cloud).url,target:Object(b.B)(g==null?void 0:g.cloud).target,className:"flex items-center"},e.a.createElement(x.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"):e.a.createElement(e.a.Fragment,null)}},{key:"saml",title:"SAML",render:function(C,p,h){var L=p.is_verified,P=p.saml_acs_url,K=p.saml_entity_id,J=p.saml_x509_cert,Re=p.has_saml;return s?L?e.a.createElement(e.a.Fragment,null,Re?e.a.createElement("div",{className:"flex items-center text-success"},e.a.createElement(x.IconCheckmark,{style:H})," SAML enabled"):P||K||J?e.a.createElement("div",{className:"flex items-center text-warning"},e.a.createElement(x.IconWarningAmber,{style:H})," SAML partially configured"):e.a.createElement("div",{className:"flex items-center"},e.a.createElement(x.IconOffline,{style:H})," SAML not set up")):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):h===0?e.a.createElement(xe.a,{to:Object(b.B)(g==null?void 0:g.cloud).url,target:Object(b.B)(g==null?void 0:g.cloud).target,className:"flex items-center"},e.a.createElement(x.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"):e.a.createElement(e.a.Fragment,null)}},{key:"actions",width:32,align:"center",render:function(C,p){var h=p.is_verified,L=p.id,P=p.domain;return h?e.a.createElement(Ae.a,{overlay:e.a.createElement(e.a.Fragment,null,e.a.createElement(j.a,{status:"stealth",onClick:function(){return u(L)},fullWidth:!0,disabled:!s,title:s?void 0:"Upgrade to enable SAML"},"Configure SAML"),e.a.createElement(j.a,{status:"danger",onClick:function(){return B.a.confirm({title:"Remove ".concat(P,"?"),icon:null,okText:"Remove domain",okType:"primary",okButtonProps:{className:"btn-danger"},content:e.a.createElement("div",null,"This cannot be undone. If you have SAML configured or SSO enforced, it will be immediately disabled."),onOk:function(){m(L)},cancelText:"Cancel"})},fullWidth:!0},e.a.createElement(x.IconDelete,null)," Remove domain")),style:{display:"inline-block"}}):e.a.createElement(j.a,{type:"primary",onClick:function(){return d(L)}},"Verify")}}]);return e.a.createElement("div",null,e.a.createElement(ue.a,{dataSource:n,columns:I,loading:o,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),e.a.createElement(an,null),e.a.createElement(dn,null),e.a.createElement(on,null))}var fn={component:Ie,logic:V.a};function vn(a){var n=a.isRestricted,o=Object(v.useValues)(V.a),r=o.currentOrganization,i=o.currentOrganizationLoading,l=Object(v.useActions)(V.a),s=l.updateOrganization,c=Object(O.useState)((r==null?void 0:r.name)||""),f=N()(c,2),m=f[0],d=f[1];return e.a.createElement("div",null,e.a.createElement("h2",{id:"name",className:"subtitle"},"Display Name"),e.a.createElement(R.a,{value:m,onChange:function(y){d(y.target.value)},style:{maxWidth:"40rem",marginBottom:"1rem",display:"block"},disabled:n}),e.a.createElement(_.a,{type:"primary",onClick:function(y){y.preventDefault(),s({name:m})},disabled:n||!m||!r||m===r.name,loading:i},"Rename Organization"))}function gn(a){var n=a.isRestricted,o=Object(v.useValues)(V.a),r=o.currentOrganization,i=o.currentOrganizationLoading,l=Object(v.useActions)(V.a),s=l.updateOrganization;return e.a.createElement("div",null,e.a.createElement("h2",{id:"notification-preferences",className:"subtitle"},"Notification Preferences"),e.a.createElement("div",null,e.a.createElement(le.a,{id:"is-member-join-email-enabled-switch","data-attr":"is-member-join-email-enabled-switch",onChange:function(f){s({is_member_join_email_enabled:f})},checked:r==null?void 0:r.is_member_join_email_enabled,loading:i,disabled:n||!r}),e.a.createElement("label",{style:{marginLeft:"10px"},htmlFor:"is-member-join-email-enabled-switch"},"Email all current members when a new member joins")))}function Ie(){var a=Object(v.useValues)(je.a),n=a.user;return Object(He.a)(location.hash),e.a.createElement(e.a.Fragment,null,e.a.createElement(S.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),e.a.createElement(q.a,null,e.a.createElement(ie.a,{Component:vn,minimumAccessLevel:b.n.Admin}),e.a.createElement(w.a,null),e.a.createElement(Ne,null),e.a.createElement(w.a,null),n&&e.a.createElement(te,{user:n}),e.a.createElement(w.a,null),e.a.createElement(ie.a,{Component:un,minimumAccessLevel:b.n.Admin}),e.a.createElement(w.a,null),e.a.createElement(ie.a,{Component:gn,minimumAccessLevel:b.n.Admin}),e.a.createElement(w.a,null),e.a.createElement(ie.a,{Component:re,minimumAccessLevel:b.n.Owner})))}}}]);
