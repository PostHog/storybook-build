"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[26577],{"./frontend/src/scenes/data-warehouse/editor/EditorScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EditorScene:()=>EditorScene});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.9.1_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),CopyToClipboard=__webpack_require__("./frontend/src/lib/components/CopyToClipboard.tsx"),DatabaseTableTree=__webpack_require__("./frontend/src/lib/components/DatabaseTableTree/DatabaseTableTree.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),Sidebar=__webpack_require__("./frontend/src/layout/navigation-3000/components/Sidebar.tsx"),navigationLogic=__webpack_require__("./frontend/src/layout/navigation-3000/navigationLogic.tsx"),editorSceneLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/editor/editorSceneLogic.ts"),resizerLogic=__webpack_require__("./frontend/src/lib/components/Resizer/resizerLogic.ts");let editorSizingLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","editorSizingLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(props=>({values:[(0,resizerLogic.Z)(props.sourceNavigatorResizerProps),["desiredSize as sourceNavigatorDesiredSize"],(0,resizerLogic.Z)(props.queryPaneResizerProps),["desiredSize as queryPaneDesiredSize"]]})),(0,index_esm.selectors)({editorSceneRef:[()=>[(_,props)=>props.editorSceneRef],editorSceneRef=>editorSceneRef],sourceNavigatorWidth:[s=>[s.sourceNavigatorDesiredSize],desiredSize=>Math.max(desiredSize||350,100)],queryPaneHeight:[s=>[s.queryPaneDesiredSize],queryPaneDesiredSize=>Math.max(queryPaneDesiredSize||600,100)],queryTabsWidth:[s=>[s.queryPaneDesiredSize],desiredSize=>desiredSize||350],sourceNavigatorResizerProps:[()=>[(_,props)=>props.sourceNavigatorResizerProps],sourceNavigatorResizerProps=>sourceNavigatorResizerProps],queryPaneResizerProps:[()=>[(_,props)=>props.queryPaneResizerProps],queryPaneResizerProps=>queryPaneResizerProps]})]);var lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.2.0_kea@3.1.5/node_modules/kea-router/lib/index.js"),multitabEditorLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/editor/multitabEditorLogic.tsx"),Resizer=__webpack_require__("./frontend/src/lib/components/Resizer/Resizer.tsx"),CodeEditor=__webpack_require__("./frontend/src/lib/monaco/CodeEditor.tsx"),AutoSizer=__webpack_require__("./node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function QueryPane(props){let{queryPaneHeight,queryPaneResizerProps}=(0,index_esm.useValues)(editorSizingLogic);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"relative flex flex-col w-full bg-bg-3000",style:{height:`${queryPaneHeight}px`},ref:queryPaneResizerProps.containerRef,children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(AutoSizer.q,{children:_ref=>{let{height,width}=_ref;return(0,jsx_runtime.jsx)(CodeEditor.p,{className:"border",language:"hogQL",value:props.queryInput,height:height,width:width,...props.codeEditorProps,options:{minimap:{enabled:!1},wordWrap:"on",scrollBeyondLastLine:!1,automaticLayout:!0,fixedOverflowWidgets:!0,suggest:{showInlineDetails:!0},quickSuggestionsDelay:300}})}})}),(0,jsx_runtime.jsx)(Resizer.w,{...queryPaneResizerProps})]})})}var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js");function QueryTabs(_ref){let{models,onClear,onClick,onAdd,activeModelUri}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-row overflow-scroll hide-scrollbar h-10",children:[models.map(model=>(0,jsx_runtime.jsx)(QueryTabComponent,{model:model,onClear:models.length>1?onClear:void 0,onClick:onClick,active:activeModelUri?.uri.path===model.uri.path},model.uri.path)),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>onAdd(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{fontSize:14})})]})}function QueryTabComponent(_ref2){var _model$view$name;let{model,active,onClear,onClick}=_ref2;return(0,jsx_runtime.jsxs)("button",{onClick:()=>onClick?.(model),className:(0,clsx_m.default)("space-y-px rounded-t p-1 flex flex-row items-center gap-1 hover:bg-[var(--bg-light)] cursor-pointer",active?"bg-[var(--bg-light)] border":"bg-bg-3000",onClear?"pl-3 pr-2":"px-3"),children:[null!==(_model$view$name=model.view?.name)&&void 0!==_model$view$name?_model$view$name:"Untitled",onClear&&(0,jsx_runtime.jsx)(src.Jp,{onClick:e=>{e.stopPropagation(),onClear(model)},size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{})})]})}__webpack_require__("./node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0/node_modules/react-data-grid/lib/styles.css");var bundle=__webpack_require__("./node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0/node_modules/react-data-grid/lib/bundle.js"),KeyboardShortcut=__webpack_require__("./frontend/src/layout/navigation-3000/components/KeyboardShortcut.tsx"),themeLogic=__webpack_require__("./frontend/src/layout/navigation-3000/themeLogic.ts"),dataNodeLogic=__webpack_require__("./frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),dataWarehouseViewsLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/saved_queries/dataWarehouseViewsLogic.tsx"),ResultsTab=function(ResultsTab){return ResultsTab.Results="results",ResultsTab.Visualization="visualization",ResultsTab}(ResultsTab||{});function ResultPane(_ref){let{onQueryInputChange,onSave,saveDisabledReason,logicKey,query}=_ref,codeEditorKey=`hogQLQueryEditor/${lib.router.values.location.pathname}`,{editingView,queryInput}=(0,index_esm.useValues)((0,multitabEditorLogic.tg)({key:codeEditorKey})),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),{response,responseLoading}=(0,index_esm.useValues)((0,dataNodeLogic.M)({key:logicKey,query:{kind:schema.OH.HogQLQuery,query},doNotLoad:!query})),{dataWarehouseSavedQueriesLoading}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{updateDataWarehouseSavedQuery}=(0,index_esm.useActions)(dataWarehouseViewsLogic.$),columns=(0,react.useMemo)(()=>{var _response$columns$map;return null!==(_response$columns$map=response?.columns?.map(column=>({key:column,name:column,resizable:!0})))&&void 0!==_response$columns$map?_response$columns$map:[]},[response]),rows=(0,react.useMemo)(()=>response?.results?response?.results?.map(row=>{let rowObject={};return response.columns.forEach((column,i)=>{rowObject[column]=row[i]}),rowObject}):[],[response]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full flex-1 bg-bg-3000",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between align-center py-2 px-4 w-full h-[55px]",children:[(0,jsx_runtime.jsx)(src.TP,{activeKey:ResultsTab.Results,onChange:()=>{},tabs:[{key:ResultsTab.Results,label:"Results"}]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-1",children:[editingView?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.Jp,{loading:dataWarehouseSavedQueriesLoading,type:"secondary",onClick:()=>updateDataWarehouseSavedQuery({id:editingView.id,query:{kind:schema.OH.HogQLQuery,query:queryInput}}),children:"Update"})}):(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>onSave(),disabledReason:saveDisabledReason,children:"Save"}),(0,jsx_runtime.jsxs)(src.Jp,{loading:responseLoading,type:"primary",onClick:()=>onQueryInputChange(),children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:"Run"}),(0,jsx_runtime.jsx)(KeyboardShortcut.e,{command:!0,enter:!0})]})]})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-1 relative bg-dark justify-center items-center",children:responseLoading?(0,jsx_runtime.jsx)(src.$j,{className:"text-3xl"}):response?(0,jsx_runtime.jsx)("div",{className:"flex-1 absolute top-0 left-0 right-0 bottom-0",children:(0,jsx_runtime.jsx)(bundle.ZP,{className:isDarkModeOn?"rdg-dark h-full":"rdg-light h-full",columns:columns,rows:rows})}):(0,jsx_runtime.jsx)("span",{className:"text-muted mt-3",children:"Query results will appear here"})})]})}function QueryWindow(){let[monacoAndEditor,setMonacoAndEditor]=(0,react.useState)(null),[monaco,editor]=null!=monacoAndEditor?monacoAndEditor:[],codeEditorKey=`hogQLQueryEditor/${lib.router.values.location.pathname}`,logic=(0,multitabEditorLogic.tg)({key:codeEditorKey,monaco,editor}),{allTabs,activeModelUri,queryInput,activeQuery,activeTabKey,hasErrors,error,isValidView,editingView}=(0,index_esm.useValues)(logic),{selectTab,deleteTab,createTab,setQueryInput,runQuery,saveAsView}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 flex-col h-full",children:[(0,jsx_runtime.jsx)(QueryTabs,{models:allTabs,onClick:selectTab,onClear:deleteTab,onAdd:createTab,activeModelUri:activeModelUri}),editingView&&(0,jsx_runtime.jsx)("div",{className:"h-7 bg-warning-highlight p-1",children:(0,jsx_runtime.jsxs)("span",{children:[' Editing view "',editingView.name,'"']})}),(0,jsx_runtime.jsx)(QueryPane,{queryInput:queryInput,promptError:null,codeEditorProps:{onChange:v=>{setQueryInput(null!=v?v:"")},onMount:(editor,monaco)=>{setMonacoAndEditor([monaco,editor])},onPressCmdEnter:(value,selectionType)=>{value&&"selection"===selectionType?runQuery(value):runQuery()}}}),(0,jsx_runtime.jsx)(ResultPane,{logicKey:activeTabKey,query:null!=activeQuery?activeQuery:"",onQueryInputChange:runQuery,onSave:saveAsView,saveDisabledReason:hasErrors?null!=error?error:"Query has errors":isValidView?"":"Some fields may need an alias"})]})}function EditorScene(){let ref=(0,react.useRef)(null),navigatorRef=(0,react.useRef)(null),queryPaneRef=(0,react.useRef)(null),{activeNavbarItem}=(0,index_esm.useValues)(navigationLogic.f),{sidebarOverlayOpen}=(0,index_esm.useValues)(editorSceneLogic.h);return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:editorSizingLogic,props:{editorSceneRef:ref,navigatorRef,sourceNavigatorResizerProps:{containerRef:navigatorRef,logicKey:"source-navigator",placement:"right"},queryPaneResizerProps:{containerRef:queryPaneRef,logicKey:"query-pane",placement:"bottom"}},children:(0,jsx_runtime.jsxs)("div",{className:"w-full h-full flex flex-row overflow-hidden",ref:ref,children:[activeNavbarItem&&(0,jsx_runtime.jsx)(Sidebar.Y,{navbarItem:activeNavbarItem,sidebarOverlay:(0,jsx_runtime.jsx)(EditorSidebarOverlay,{}),sidebarOverlayProps:{isOpen:sidebarOverlayOpen}},activeNavbarItem.identifier),(0,jsx_runtime.jsx)(QueryWindow,{})]})})}let EditorSidebarOverlay=()=>{let{setSidebarOverlayOpen}=(0,index_esm.useActions)(editorSceneLogic.h),{sidebarOverlayTreeItems,selectedSchema}=(0,index_esm.useValues)(editorSceneLogic.h);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsxs)("header",{className:"flex flex-row h-10 border-b shrink-0 p-1 gap-2",children:[(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowLeft,{}),onClick:()=>setSidebarOverlayOpen(!1)}),selectedSchema?.name&&(0,jsx_runtime.jsx)(CopyToClipboard.D,{className:"font-mono",tooltipMessage:null,description:"schema",iconStyle:{color:"var(--muted-alt)"},explicitValue:selectedSchema?.name,children:selectedSchema?.name})]}),(0,jsx_runtime.jsx)(DatabaseTableTree.E,{items:sidebarOverlayTreeItems})]})}}}]);