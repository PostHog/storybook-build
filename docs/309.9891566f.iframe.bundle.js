(window.webpackJsonp=window.webpackJsonp||[]).push([[309],{"./frontend/src/scenes/instance/Licenses/index.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Licenses",(function(){return Licenses}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),antd__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/form/index.js"),antd__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/alert/index.js"),antd__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/input/index.js"),antd__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/button/index.js"),_licenseLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/instance/Licenses/licenseLogic.ts"),kea__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib_utils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/lib/utils.tsx"),lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),scenes_organizationLogic__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/scenes/organizationLogic.tsx"),lib_dayjs__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/lib/dayjs.ts"),lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./frontend/src/scenes/billing/billingLogic.ts"),kea_router__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),scenes_urls__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./frontend/src/scenes/urls.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const scene={component:Licenses,logic:_licenseLogic__WEBPACK_IMPORTED_MODULE_6__.b};function ConfirmCancelModal(_ref){let{licenses:licenses,isOpen:isOpen,onCancel:onCancel,onOk:onOk}=_ref;const{currentOrganization:currentOrganization}=Object(kea__WEBPACK_IMPORTED_MODULE_7__.useValues)(scenes_organizationLogic__WEBPACK_IMPORTED_MODULE_12__.a),{billingVersion:billingVersion}=Object(kea__WEBPACK_IMPORTED_MODULE_7__.useValues)(scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_15__.a),hasAnotherValidLicense=licenses.filter((license=>Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_13__.a)().isBefore(license.valid_until))).length>1,nonDemoProjects=((null==currentOrganization?void 0:currentOrganization.teams)||[]).filter((team=>!team.is_demo)).sort(((a,b)=>a.id-b.id)),willDeleteProjects=!hasAnotherValidLicense&&nonDemoProjects.slice(1,nonDemoProjects.length).length>0;return Object(react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{"v2"===billingVersion&&kea_router__WEBPACK_IMPORTED_MODULE_16__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_17__.a.organizationBilling())}),[billingVersion]),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_14__.a,{isOpen:isOpen,onClose:onCancel,title:"Are you sure you want to deactivate your license?",footer:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment,{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_11__.a,{form:"new-dashboard-form",type:"secondary","data-attr":"deactivate-license-cancel",className:"mr-2",onClick:onCancel,children:"Cancel"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_11__.a,{"data-attr":"deactivate-license-proceed",type:"primary",status:"danger",onClick:onOk,children:willDeleteProjects?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment,{children:["Deactivate license & delete ",nonDemoProjects.length," project(s)"]}):"Deactivate license"})]}),children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("ul",{className:"pl-3 list-disc",children:[hasAnotherValidLicense?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("li",{children:["You will ",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("strong",{children:"keep"})," all premium features available with your other valid license."]}):Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("li",{children:["You will ",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("strong",{children:"IMMEDIATELY"})," lose access to all premium features such as"," ",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("strong",{children:"multiple projects"}),", ",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("strong",{children:"single sign on"}),","," ",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("strong",{children:"group analytics"}),", ",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("strong",{children:"multivariate feature flags"})," and many more."]}),willDeleteProjects&&Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("li",{children:["We will ",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("strong",{className:"text-danger",children:"DELETE"})," the following projects:",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("ul",{className:"pl-6 list-disc mb-2",children:nonDemoProjects.map((team=>Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("li",{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("strong",{children:team.name})},team.id)))}),"To keep one of these projects instead, remove all other projects first."]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("li",{children:"You will immediately be billed for usage in the current period, if any."})]})})}function Licenses(){const[form]=antd__WEBPACK_IMPORTED_MODULE_2__.a.useForm(),{licenses:licenses,licensesLoading:licensesLoading,error:error,showConfirmCancel:showConfirmCancel}=Object(kea__WEBPACK_IMPORTED_MODULE_7__.useValues)(_licenseLogic__WEBPACK_IMPORTED_MODULE_6__.b),{createLicense:createLicense,deleteLicense:deleteLicense,setShowConfirmCancel:setShowConfirmCancel}=Object(kea__WEBPACK_IMPORTED_MODULE_7__.useActions)(_licenseLogic__WEBPACK_IMPORTED_MODULE_6__.b),columns=[{title:"Active",render:function renderActive(_,license){return Object(_licenseLogic__WEBPACK_IMPORTED_MODULE_6__.a)(license)?"expired":"active"}},{title:"Valid until",render:function renderActive(_,license){return Object(lib_utils__WEBPACK_IMPORTED_MODULE_8__.O)(license.valid_until)}},{title:"Plan",dataIndex:"plan"},{title:"License added on",render:function renderActive(_,license){return Object(lib_utils__WEBPACK_IMPORTED_MODULE_8__.O)(license.created_at)}},{width:0,render:function renderActive(_,license){return Object(lib_dayjs__WEBPACK_IMPORTED_MODULE_13__.a)().isAfter(license.valid_until)?null:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_1__.a,{overlay:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment,{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_11__.a,{status:"danger",onClick:()=>setShowConfirmCancel(license),fullWidth:!0,children:"Deactivate license"})})})}}];return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(ConfirmCancelModal,{licenses:licenses,isOpen:!!showConfirmCancel,onCancel:()=>setShowConfirmCancel(null),onOk:()=>showConfirmCancel?deleteLicense(showConfirmCancel):null}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_9__.a,{title:"Licenses",caption:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment,{children:["Here you can add and manage your PostHog enterprise licenses. When you activate a license key, enterprise functionality will be enabled immediately. Contact"," ",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("a",{href:"mailto:sales@posthog.com",children:"sales@posthog.com"})," to buy a license or if you have any issues with a license."]})}),error&&Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(antd__WEBPACK_IMPORTED_MODULE_3__.a,{message:error.detail||Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("span",{children:"Could not validate license key. Please try again or contact us."}),type:"error",style:{marginBottom:"1em"}}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(antd__WEBPACK_IMPORTED_MODULE_2__.a,{form:form,name:"horizontal_login",layout:"inline",onFinish:values=>createLicense({key:values.key}),style:{marginBottom:"1rem"},children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(antd__WEBPACK_IMPORTED_MODULE_2__.a.Item,{name:"key",rules:[{required:!0,message:"Please input a license key!"}],children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(antd__WEBPACK_IMPORTED_MODULE_4__.a,{placeholder:"License key",style:{minWidth:400}})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(antd__WEBPACK_IMPORTED_MODULE_2__.a.Item,{shouldUpdate:!0,children:()=>Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(antd__WEBPACK_IMPORTED_MODULE_5__.a,{type:"primary",htmlType:"submit",disabled:!form.isFieldsTouched(!0)||!!form.getFieldsError().filter((_ref2=>{let{errors:errors}=_ref2;return errors.length})).length,children:"Activate License Key"})})]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_10__.a,{"data-attr":"license-table",size:"small",rowKey:"id",rowClassName:"cursor-pointer",dataSource:licenses,columns:columns,loading:licensesLoading})]})}}}]);