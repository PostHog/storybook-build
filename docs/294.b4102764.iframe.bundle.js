(window.webpackJsonp=window.webpackJsonp||[]).push([[294],{"./frontend/src/lib/hooks/useAnchor.ts":function(en,se,n){"use strict";n.d(se,"a",function(){return Me});var ue=n("./node_modules/react/index.js"),te=n.n(ue);function Me(Z){Object(ue.useEffect)(function(){if(Z&&document.getElementById(Z.substr(1))){var oe=document.getElementById(Z.substr(1));if(!oe)return;oe.classList.add("highlighted");var ze=oe.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:ze-50-32,behavior:"smooth"})}},[Z])}},"./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx":function(en,se,n){"use strict";n.d(se,"a",function(){return $e}),n.d(se,"b",function(){return P});var ue=n("./node_modules/core-js/modules/es.symbol.js"),te=n.n(ue),Me=n("./node_modules/core-js/modules/es.array.filter.js"),Z=n.n(Me),oe=n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),ze=n.n(oe),We=n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),on=n.n(We),Ve=n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),an=n.n(Ve),Ne=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),g=n.n(Ne),me=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),Oe=n.n(me),Ee=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),je=n.n(Ee),ae=n("./node_modules/@babel/runtime/regenerator/index.js"),fe=n.n(ae),De=n("./node_modules/core-js/modules/es.array.iterator.js"),W=n.n(De),V=n("./node_modules/core-js/modules/es.object.to-string.js"),xe=n.n(V),e=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Pe=n.n(e),Be=n("./node_modules/core-js/modules/es.array.map.js"),ee=n.n(Be),Fe=n("./node_modules/core-js/modules/es.array.concat.js"),we=n.n(Fe),Ge=n("./node_modules/core-js/modules/es.object.keys.js"),z=n.n(Ge),be=n("./node_modules/kea/lib/index.esm.js"),ge=n("./node_modules/kea-loaders/lib/index.js"),U=n.n(ge),N=n("./frontend/src/lib/api.ts"),ie=n("./frontend/src/types.ts"),Q;function Ae(L,A){var R=Object.keys(L);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(L);A&&(S=S.filter(function(w){return Object.getOwnPropertyDescriptor(L,w).enumerable})),R.push.apply(R,S)}return R}function pe(L){for(var A=1;A<arguments.length;A++){var R=arguments[A]!=null?arguments[A]:{};A%2?Ae(Object(R),!0).forEach(function(S){je()(L,S,R[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(R)):Ae(Object(R)).forEach(function(S){Object.defineProperty(L,S,Object.getOwnPropertyDescriptor(R,S))})}return L}var ve=je()({},ie.U.FEATURE_FLAGS,"Feature Flags"),$e=(Q={},je()(Q,ie.a.WRITE,"View & Edit"),je()(Q,ie.a.READ,"View Only"),Q),P=Object(be.kea)([Object(be.path)(["scenes","organization","Settings","Permissions","permissionsLogic"]),Object(ge.loaders)(function(L){var A=L.values;return{organizationResourcePermissions:[[],{loadOrganizationResourcePermissions:function(){var R=Oe()(fe.a.mark(function w(){var X;return fe.a.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,N.b.resourcePermissions.list();case 2:return X=F.sent,F.abrupt("return",(X==null?void 0:X.results)||[]);case 4:case"end":return F.stop()}},w)}));function S(){return R.apply(this,arguments)}return S}(),updateOrganizationResourcePermission:function(){var R=Oe()(fe.a.mark(function w(X){var he,F,_e,H,Re;return fe.a.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(he=X.id,F=X.resource,_e=X.access_level,!he){K.next=8;break}return K.next=4,N.b.resourcePermissions.update(he,{access_level:_e});case 4:return H=K.sent,K.abrupt("return",A.organizationResourcePermissions.map(function(Ue){return Ue.id==H.id?H:Ue}));case 8:return K.next=10,N.b.resourcePermissions.create({resource:F,access_level:_e});case 10:return Re=K.sent,K.abrupt("return",[].concat(g()(A.organizationResourcePermissions),[Re]));case 12:case"end":return K.stop()}},w)}));function S(w){return R.apply(this,arguments)}return S}()}]}}),Object(be.selectors)({organizationResourcePermissionsMap:[function(L){return[L.organizationResourcePermissions]},function(L){return L.reduce(function(A,R){return pe(pe({},A),{},je()({},R.resource,R))},{})}],allPermissions:[function(L){return[L.organizationResourcePermissionsMap]},function(L){return Object.keys(ve).map(function(A){var R,S;return{id:((R=L[A])===null||R===void 0?void 0:R.id)||null,resource:A,name:ve[A],access_level:((S=L[A])===null||S===void 0?void 0:S.access_level)||ie.a.WRITE}})}]}),Object(be.afterMount)(function(L){var A=L.actions;A.loadOrganizationResourcePermissions()})])},"./frontend/src/scenes/organization/Settings/Roles/rolesLogic.tsx":function(en,se,n){"use strict";n.d(se,"a",function(){return rn});var ue=n("./node_modules/core-js/modules/es.object.keys.js"),te=n.n(ue),Me=n("./node_modules/core-js/modules/es.symbol.js"),Z=n.n(Me),oe=n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),ze=n.n(oe),We=n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),on=n.n(We),Ve=n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),an=n.n(Ve),Ne=n("./node_modules/core-js/modules/es.array.slice.js"),g=n.n(Ne),me=n("./node_modules/core-js/modules/es.function.name.js"),Oe=n.n(me),Ee=n("./node_modules/core-js/modules/es.array.from.js"),je=n.n(Ee),ae=n("./node_modules/core-js/modules/es.regexp.exec.js"),fe=n.n(ae),De=n("./node_modules/core-js/modules/es.symbol.description.js"),W=n.n(De),V=n("./node_modules/core-js/modules/es.symbol.iterator.js"),xe=n.n(V),e=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Pe=n.n(e),Be=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ee=n.n(Be),Fe=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),we=n.n(Fe),Ge=n("./node_modules/@babel/runtime/regenerator/index.js"),z=n.n(Ge),be=n("./node_modules/core-js/modules/es.array.map.js"),ge=n.n(be),U=n("./node_modules/core-js/modules/es.array.iterator.js"),N=n.n(U),ie=n("./node_modules/core-js/modules/es.object.to-string.js"),Q=n.n(ie),Ae=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),pe=n.n(Ae),ve=n("./node_modules/core-js/modules/es.array.concat.js"),$e=n.n(ve),P=n("./node_modules/core-js/modules/es.array.filter.js"),L=n.n(P),A=n("./node_modules/core-js/modules/es.promise.js"),R=n.n(A),S=n("./node_modules/core-js/modules/es.string.iterator.js"),w=n.n(S),X=n("./node_modules/core-js/modules/es.object.assign.js"),he=n.n(X),F=n("./node_modules/core-js/modules/es.array.sort.js"),_e=n.n(F),H=n("./node_modules/kea/lib/index.esm.js"),Re=n("./node_modules/kea-loaders/lib/index.js"),ln=n.n(Re),K=n("./frontend/src/lib/api.ts"),Ue=n("./frontend/src/scenes/project/Settings/teamMembersLogic.tsx"),Ce=n("./frontend/src/types.ts");function nn(a,d){var l=typeof Symbol!="undefined"&&a[Symbol.iterator]||a["@@iterator"];if(!l){if(Array.isArray(a)||(l=sn(a))||d&&a&&typeof a.length=="number"){l&&(a=l);var _=0,E=function(){};return{s:E,n:function(){return _>=a.length?{done:!0}:{done:!1,value:a[_++]}},e:function(x){throw x},f:E}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D=!0,h=!1,y;return{s:function(){l=l.call(a)},n:function(){var x=l.next();return D=x.done,x},e:function(x){h=!0,y=x},f:function(){try{!D&&l.return!=null&&l.return()}finally{if(h)throw y}}}}function sn(a,d){if(!!a){if(typeof a=="string")return Ye(a,d);var l=Object.prototype.toString.call(a).slice(8,-1);if(l==="Object"&&a.constructor&&(l=a.constructor.name),l==="Map"||l==="Set")return Array.from(a);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return Ye(a,d)}}function Ye(a,d){(d==null||d>a.length)&&(d=a.length);for(var l=0,_=new Array(d);l<d;l++)_[l]=a[l];return _}function Ze(a,d){var l=Object.keys(a);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(a);d&&(_=_.filter(function(E){return Object.getOwnPropertyDescriptor(a,E).enumerable})),l.push.apply(l,_)}return l}function le(a){for(var d=1;d<arguments.length;d++){var l=arguments[d]!=null?arguments[d]:{};d%2?Ze(Object(l),!0).forEach(function(_){we()(a,_,l[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):Ze(Object(l)).forEach(function(_){Object.defineProperty(a,_,Object.getOwnPropertyDescriptor(l,_))})}return a}var rn=Object(H.kea)([Object(H.path)(["scenes","organization","rolesLogic"]),Object(H.connect)({values:[Ue.b,["plainMembers"]]}),Object(H.actions)({setCreateRoleModalShown:function(d){return{shown:d}},setRoleInFocus:function(d){return{role:d}},setRoleMembersInFocus:function(d){return{roleMembers:d}},setRoleMembersToAdd:function(d){return{uuids:d}},openCreateRoleModal:!0,setPermission:function(d,l){return{resource:d,access:l}},setPermissionInPlace:function(d,l){return{resource:d,access:l}},clearPermission:!0,updateRole:function(d){return{role:d}}}),Object(H.reducers)({createRoleModalShown:[!1,{setCreateRoleModalShown:function(d,l){var _=l.shown;return _}}],roleInFocus:[null,{setRoleInFocus:function(d,l){var _=l.role;return _}}],roleMembersInFocus:[[],{setRoleMembersInFocus:function(d,l){var _=l.roleMembers;return _}}],roleMembersToAdd:[[],{setRoleMembersToAdd:function(d,l){var _=l.uuids;return _}}],permissionsToSet:[{},{setPermission:function(d,l){var _=l.resource,E=l.access;return le(le({},d),{},we()({},"".concat(_),E))},clearPermission:function(){return{}}}],roles:[[],{updateRole:function(d,l){var _=l.role;return d.map(function(E){return E.id==_.id?_:E})}}]}),Object(Re.loaders)(function(a){var d=a.values,l=a.actions;return{roles:{loadRoles:function(){var _=ee()(z.a.mark(function D(){var h;return z.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,K.b.roles.list();case 2:return h=O.sent,O.abrupt("return",(h==null?void 0:h.results)||[]);case 4:case"end":return O.stop()}},D)}));function E(){return _.apply(this,arguments)}return E}(),createRole:function(){var _=ee()(z.a.mark(function D(h){var y,O,x,I;return z.a.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return y=d.roles,O=d.roleMembersToAdd,x=d.permissionsToSet,k.next=3,K.b.roles.create(h,x[Ce.U.FEATURE_FLAGS]);case 3:return I=k.sent,k.next=6,l.addRoleMembers({role:I,membersToAdd:O});case 6:return l.setRoleMembersInFocus([]),l.setRoleMembersToAdd([]),l.clearPermission(),l.setCreateRoleModalShown(!1),k.abrupt("return",[I].concat(Pe()(y)));case 11:case"end":return k.stop()}},D)}));function E(D){return _.apply(this,arguments)}return E}(),deleteRole:function(){var _=ee()(z.a.mark(function D(h){return z.a.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,K.b.roles.delete(h.id);case 2:return O.abrupt("return",d.roles.filter(function(x){return x.id!==h.id}));case 3:case"end":return O.stop()}},D)}));function E(D){return _.apply(this,arguments)}return E}()},roleMembersInFocus:[[],{loadRoleMembers:function(){var _=ee()(z.a.mark(function D(h){var y,O;return z.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return y=h.roleId,I.next=3,K.b.roles.members.list(y);case 3:return O=I.sent,I.abrupt("return",(O==null?void 0:O.results)||[]);case 5:case"end":return I.stop()}},D)}));function E(D){return _.apply(this,arguments)}return E}(),addRoleMembers:function(){var _=ee()(z.a.mark(function D(h){var y,O,x;return z.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return y=h.role,O=h.membersToAdd,ce.next=3,Promise.all(O.map(function(){var k=ee()(z.a.mark(function Le(J){return z.a.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,K.b.roles.members.create(y.id,J);case 2:return G.abrupt("return",G.sent);case 3:case"end":return G.stop()}},Le)}));return function(Le){return k.apply(this,arguments)}}()));case 3:return x=ce.sent,l.setRoleMembersToAdd([]),ce.abrupt("return",[].concat(Pe()(d.roleMembersInFocus),Pe()(x)));case 6:case"end":return ce.stop()}},D)}));function E(D){return _.apply(this,arguments)}return E}(),deleteRoleMember:function(){var _=ee()(z.a.mark(function D(h){var y;return z.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(y=h.roleMemberUuid,x.t0=d.roleInFocus,!x.t0){x.next=5;break}return x.next=5,K.b.roles.members.delete(d.roleInFocus.id,y);case 5:return x.abrupt("return",d.roleMembersInFocus.filter(function(I){return I.id!==y}));case 6:case"end":return x.stop()}},D)}));function E(D){return _.apply(this,arguments)}return E}()}]}}),Object(H.listeners)(function(a){var d=a.actions,l=a.values;return{setRoleInFocus:function(E){var D=E.role;D&&d.loadRoleMembers({roleId:D.id}),d.setCreateRoleModalShown(!0)},openCreateRoleModal:function(){d.setRoleInFocus(null),d.setRoleMembersInFocus([]),d.setCreateRoleModalShown(!0)},setCreateRoleModalShown:function(){l.roleInFocus?d.setPermission(Ce.U.FEATURE_FLAGS,l.roleInFocus.feature_flags_access_level):d.setPermission(Ce.U.FEATURE_FLAGS,Ce.a.WRITE)},setPermissionInPlace:function(){var _=ee()(z.a.mark(function D(h){var y,O;return z.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(y=h.access,!l.roleInFocus){I.next=9;break}if(I.t0=y,!I.t0){I.next=6;break}return I.next=6,K.b.roles.update(l.roleInFocus.id,{feature_flags_access_level:y});case 6:O=Object.assign({},l.roleInFocus),O.feature_flags_access_level=y,d.updateRole(O);case 9:case"end":return I.stop()}},D)}));function E(D){return _.apply(this,arguments)}return E}()}}),Object(H.selectors)({addableMembers:[function(a){return[a.plainMembers,a.roleMembersInFocus]},function(a,d){var l=[],_=nn(a),E;try{var D=function(){var y=E.value;d.some(function(O){return O.user.uuid===y.user.uuid})||l.push(y.user)};for(_.s();!(E=_.n()).done;)D()}catch(h){_.e(h)}finally{_.f()}return l.sort(function(h,y){return h.first_name.localeCompare(y.first_name)}),l}]}),Object(H.afterMount)(function(a){var d=a.actions;d.loadRoles()})])},"./frontend/src/scenes/organization/Settings/index.tsx":function(en,se,n){"use strict";n.r(se),n.d(se,"scene",function(){return Cn}),n.d(se,"OrganizationSettings",function(){return un});var ue=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),te=n.n(ue),Me=n("./node_modules/core-js/modules/es.function.name.js"),Z=n("./node_modules/react/index.js"),oe=n("./frontend/src/lib/components/PageHeader.tsx"),ze=n("./node_modules/core-js/modules/es.array.iterator.js"),We=n("./node_modules/core-js/modules/es.object.to-string.js"),on=n("./node_modules/core-js/modules/es.string.iterator.js"),Ve=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),an=n("./node_modules/core-js/modules/web.url.js"),Ne=n("./node_modules/core-js/modules/web.url-search-params.js"),g=n("./node_modules/kea/lib/index.esm.js"),me=n("./frontend/src/lib/components/CopyToClipboard.tsx"),Oe=n("./frontend/src/lib/components/ProfilePicture/index.ts"),Ee=n("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),je=n("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),ae=n("./frontend/src/lib/components/LemonTable/index.ts"),fe=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),De=n("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),W=n("./frontend/src/lib/components/LemonButton/index.ts"),V=n("./frontend/src/lib/components/icons.tsx"),xe=n("./frontend/src/lib/components/LemonDialog/index.ts"),e=n("./node_modules/react/jsx-runtime.js");function Pe(r,s){var i=new URL("/signup/".concat(r),document.baseURI).href;return s.is_expired?Object(e.jsx)("b",{children:"Expired! Delete and recreate"}):Object(e.jsx)(me.a,{"data-attr":"invite-link",description:"invite link",children:i})}function Be(r){return function(i,t){return Object(e.jsx)(W.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:Object(e.jsx)(V.IconClose,{}),status:"danger",onClick:function(){t.is_expired?r(t):xe.a.open({title:"Do you want to cancel the invite for ".concat(t.target_email,"?"),primaryButton:{children:"Yes, cancel invite",status:"danger",onClick:function(){return r(t)}},secondaryButton:{children:"No, keep invite"}})}})}}function ee(){var r=Object(g.useValues)(Ee.a),s=r.invites,i=r.invitesLoading,t=Object(g.useActions)(Ee.a),o=t.deleteInvite,m=t.showInviteModal,c=Object(g.useValues)(De.a),j=c.preflight,b=[{key:"user_profile_picture",render:function(f,v){return Object(e.jsx)(Oe.b,{name:v.first_name,email:v.target_email})},width:32},{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(f,v){return v.target_email?Object(e.jsxs)("div",{className:"flex items-center",children:[v.target_email,v.first_name?" (".concat(v.first_name,")"):""]}):Object(e.jsx)("i",{children:"no one"})},width:"20%"},Object(fe.b)(),Object(fe.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(f,v){return Pe(v.id,v)}},{title:"",key:"actions",width:24,render:Be(o)}];return Object(e.jsxs)("div",{children:[Object(e.jsxs)("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"},children:["Pending Invites",Object(e.jsx)(W.a,{type:"primary",onClick:m,"data-attr":"invite-teammate-button",children:"Invite team member"})]}),!(j!=null&&j.email_service_available)&&Object(e.jsx)(je.a,{}),Object(e.jsx)(ae.a,{dataSource:s,columns:b,rowKey:"id",loading:i,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."})]})}var Fe=n("./node_modules/core-js/modules/es.array.filter.js"),we=n("./node_modules/core-js/modules/es.array.map.js"),Ge=n("./node_modules/core-js/modules/es.array.concat.js"),z=n("./node_modules/core-js/modules/es.regexp.exec.js"),be=n("./node_modules/core-js/modules/es.string.search.js"),ge=n("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),U=n("./frontend/src/lib/constants.tsx"),N=n("./frontend/src/scenes/organizationLogic.tsx"),ie=n("./frontend/src/scenes/userLogic.ts"),Q=n("./frontend/src/lib/utils/permissioning.ts"),Ae=n("./frontend/src/lib/components/TZLabel/index.tsx"),pe=n("./frontend/src/lib/components/LemonButton/More.tsx"),ve=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),$e=n("./frontend/src/lib/components/LemonDivider/index.ts"),P=n("./frontend/@posthog/lemon-ui/src/index.ts");function L(r,s){var i,t=Object(g.useValues)(ie.a),o=t.user,m=Object(g.useValues)(N.a),c=m.currentOrganization,j=Object(g.useActions)(ge.a),b=j.removeMember,u=j.changeMemberAccessLevel;if(!o)return null;var f=(i=c==null?void 0:c.membership_level)!==null&&i!==void 0?i:-1,v=(f>=U.p.Admin&&s.level<=f||s.user.uuid===o.uuid)&&s.level!==U.p.Owner,C=c?c.membership_level:null,p=Q.c.filter(function(T){return!Object(Q.a)(C,o,s,T)}),q=Object(Q.a)(C,o,s,p);return Object(e.jsx)(pe.a,{overlay:Object(e.jsxs)(e.Fragment,{children:[q?Object(e.jsx)("div",{children:q}):p.map(function(T){return Object(e.jsx)(W.a,{status:"stealth",fullWidth:!0,onClick:function(M){if(M.preventDefault(),!o)throw Error;if(T===U.p.Owner){var B;xe.a.open({title:"Transfer organization ownership to ".concat(s.user.first_name,"?"),description:"You will no longer be the owner of ".concat((B=o.organization)===null||B===void 0?void 0:B.name,". After the transfer you will become an administrator."),primaryButton:{status:"danger",children:"Transfer Ownership",onClick:function(){return u(s,T)}},secondaryButton:{children:"Cancel"}})}else u(s,T)},"data-test-level":T,children:T===U.p.Owner?Object(e.jsx)(e.Fragment,{children:"Transfer organization ownership"}):T>s.level?Object(e.jsxs)(e.Fragment,{children:["Upgrade to ",Q.b.get(T)]}):Object(e.jsxs)(e.Fragment,{children:["Downgrade to ",Q.b.get(T)]})},"".concat(s.user.uuid,"-level-").concat(T))}),v?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)($e.a,{}),Object(e.jsx)(W.a,{status:"danger","data-attr":"delete-org-membership",onClick:function(){var $;if(!o)throw Error;xe.a.open({title:"".concat(s.user.uuid==o.uuid?"Leave":"Remove ".concat(s.user.first_name," from")," organization ").concat(($=o.organization)===null||$===void 0?void 0:$.name,"?"),primaryButton:{children:s.user.uuid==o.uuid?"Leave":"Remove",status:"danger",onClick:function(){return b(s)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0,children:s.user.uuid!==o.uuid?"Remove from organization":"Leave organization"})]}):null]})})}function A(r){var s=r.user,i=Object(g.useValues)(ge.a),t=i.filteredMembers,o=i.membersLoading,m=i.search,c=Object(g.useActions)(ge.a),j=c.setSearch,b=[{key:"user_profile_picture",render:function(f,v){return Object(e.jsx)(Oe.b,{name:v.user.first_name,email:v.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(f,v){return v.user.uuid==s.uuid?"".concat(v.user.first_name," (me)"):v.user.first_name},sorter:function(f,v){return f.user.first_name.localeCompare(v.user.first_name)}},{title:"Email",key:"user_email",render:function(f,v){return v.user.email},sorter:function(f,v){return f.user.email.localeCompare(v.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(f,v){var C;return Object(e.jsx)(ve.a,{"data-attr":"membership-level",children:v.level===U.p.Owner?"Organization owner":"Project ".concat((C=Q.b.get(v.level))!==null&&C!==void 0?C:"unknown (".concat(v.level,")"))})},sorter:function(f,v){return f.level-v.level}},{title:"Joined",dataIndex:"joined_at",key:"joined_at",render:function(f){return Object(e.jsx)("div",{className:"whitespace-nowrap",children:Object(e.jsx)(Ae.a,{time:f})})},sorter:function(f,v){return f.joined_at.localeCompare(v.joined_at)}},{key:"actions",width:0,render:L}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Members"}),Object(e.jsx)(P.LemonInput,{type:"search",placeholder:"Search for members",value:m,onChange:j}),Object(e.jsx)(ae.a,{dataSource:t,columns:b,rowKey:"id",style:{marginTop:"1rem"},loading:o,"data-attr":"org-members-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}})]})}try{A.displayName="Members",A.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:A.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(r){}function R(r){var s=r.isOpen,i=r.setIsOpen,t=Object(g.useValues)(N.a),o=t.currentOrganization,m=t.organizationBeingDeleted,c=Object(g.useActions)(N.a),j=c.deleteOrganization,b=Object(Z.useState)(!1),u=te()(b,2),f=u[0],v=u[1],C=!!o&&(m==null?void 0:m.id)===o.id;return Object(e.jsxs)(P.LemonModal,{title:"Delete the entire organization?",onClose:C?void 0:function(){return i(!1)},footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(P.LemonButton,{disabled:C,type:"secondary",onClick:function(){return i(!1)},children:"Cancel"}),Object(e.jsx)(P.LemonButton,{type:"primary",disabled:!f,loading:C,"data-attr":"delete-organization-ok",status:"danger",onClick:o?function(){return j(o)}:void 0,children:"Delete ".concat(o?o.name:"the current organization")})]}),isOpen:s,children:[Object(e.jsxs)("p",{children:["Organization deletion ",Object(e.jsx)("b",{children:"cannot be undone"}),". You will lose all data, ",Object(e.jsx)("b",{children:"including all events"}),", related to all projects within this organization."]}),Object(e.jsxs)("p",{children:["Please type"," ",Object(e.jsx)("strong",{children:o?o.name:"this organization's name"})," to confirm."]}),Object(e.jsx)(P.LemonInput,{type:"text",onChange:function(q){o&&v(q.toLowerCase()===o.name.toLowerCase())}})]})}function S(r){var s=r.isRestricted,i=Object(g.useValues)(N.a),t=i.currentOrganization,o=Object(Z.useState)(!1),m=te()(o,2),c=m[0],j=m[1];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"text-danger",children:[Object(e.jsx)("h2",{className:"text-danger subtitle",children:"Danger Zone"}),Object(e.jsxs)("div",{className:"mt-4",children:[!s&&Object(e.jsxs)("p",{className:"text-danger",children:["This is ",Object(e.jsx)("b",{children:"irreversible"}),". Please be certain."]}),Object(e.jsxs)(P.LemonButton,{status:"danger",type:"secondary",onClick:function(){return j(!0)},"data-attr":"delete-organization-button",icon:Object(e.jsx)(V.IconDelete,{}),disabled:s,children:["Delete ",(t==null?void 0:t.name)||"the current organization"]})]})]}),Object(e.jsx)(R,{isOpen:c,setIsOpen:j})]})}try{R.displayName="DeleteOrganizationModal",R.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},setIsOpen:{defaultValue:null,description:"",name:"setIsOpen",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:R.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(r){}try{S.displayName="DangerZone",S.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:S.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(r){}var w=n("./frontend/src/lib/components/RestrictedArea.tsx"),X=n("./frontend/src/lib/hooks/useAnchor.ts"),he=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),F=n.n(he),_e=n("./frontend/src/lib/components/Tooltip.tsx"),H=n("./node_modules/core-js/modules/es.object.keys.js"),Re=n("./node_modules/core-js/modules/es.symbol.js"),ln=n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),K=n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ue=n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Ce=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),nn=n.n(Ce),sn=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),Ye=n.n(sn),Ze=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),le=n.n(Ze),rn=n("./node_modules/@babel/runtime/regenerator/index.js"),a=n.n(rn),d=n("./node_modules/core-js/modules/es.array.sort.js"),l=n("./node_modules/core-js/modules/es.array.find.js"),_=n("./node_modules/core-js/modules/es.array.includes.js"),E=n("./node_modules/core-js/modules/es.string.includes.js"),D=n("./node_modules/core-js/modules/es.string.match.js"),h=n("./frontend/src/lib/api.ts"),y=n("./frontend/src/lib/components/lemonToast.tsx"),O=n("./frontend/src/types.ts"),x=n("./node_modules/kea-forms/lib/index.js"),I=n("./node_modules/kea-loaders/lib/index.js"),ce=["id"];function k(r,s){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);s&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),i.push.apply(i,t)}return i}function Le(r){for(var s=1;s<arguments.length;s++){var i=arguments[s]!=null?arguments[s]:{};s%2?k(Object(i),!0).forEach(function(t){Ye()(r,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):k(Object(i)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(i,t))})}return r}var J=Object(g.kea)([Object(g.path)(["scenes","organization","verifiedDomainsLogic"]),Object(g.connect)({values:[N.a,["currentOrganization"]]}),Object(g.actions)({replaceDomain:function(s){return{domain:s}},setAddModalShown:function(s){return{shown:s}},setConfigureSAMLModalId:function(s){return{id:s}},setVerifyModal:function(s){return{id:s}}}),Object(g.reducers)({verifiedDomains:[[],{replaceDomain:function(s,i){var t=i.domain,o=[].concat(F()(s.filter(function(m){var c=m.id;return c!==t.id})),[t]);return o.sort(function(m,c){return m.domain.localeCompare(c.domain)}),o}}],addModalShown:[!1,{setAddModalShown:function(s,i){var t=i.shown;return t},addVerifiedDomainSuccess:function(){return!1}}],configureSAMLModalId:[null,{setConfigureSAMLModalId:function(s,i){var t=i.id;return t}}],verifyModal:[null,{setVerifyModal:function(s,i){var t=i.id;return t}}]}),Object(I.loaders)(function(r){var s=r.values,i=r.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var t=le()(a.a.mark(function m(){var c;return a.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,h.b.get("api/organizations/".concat((c=s.currentOrganization)===null||c===void 0?void 0:c.id,"/domains"));case 2:return b.abrupt("return",b.sent.results);case 3:case"end":return b.stop()}},m)}));function o(){return t.apply(this,arguments)}return o}(),addVerifiedDomain:function(){var t=le()(a.a.mark(function m(c){var j,b;return a.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,h.b.create("api/organizations/".concat((j=s.currentOrganization)===null||j===void 0?void 0:j.id,"/domains"),{domain:c});case 2:return b=f.sent,f.abrupt("return",[b].concat(F()(s.verifiedDomains)));case 4:case"end":return f.stop()}},m)}));function o(m){return t.apply(this,arguments)}return o}(),deleteVerifiedDomain:function(){var t=le()(a.a.mark(function m(c){var j;return a.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,h.b.delete("api/organizations/".concat((j=s.currentOrganization)===null||j===void 0?void 0:j.id,"/domains/").concat(c));case 2:return u.abrupt("return",F()(s.verifiedDomains.filter(function(f){return f.id!==c})));case 3:case"end":return u.stop()}},m)}));function o(m){return t.apply(this,arguments)}return o}()}],updatingDomain:[!1,{updateDomain:function(){var t=le()(a.a.mark(function m(c){var j,b;return a.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,h.b.update("api/organizations/".concat((j=s.currentOrganization)===null||j===void 0?void 0:j.id,"/domains/").concat(c.id),Le(Le({},c),{},{id:void 0}));case 2:return b=f.sent,y.d.success("Domain updated successfully! Changes will take immediately."),i.replaceDomain(b),f.abrupt("return",!1);case 6:case"end":return f.stop()}},m)}));function o(m){return t.apply(this,arguments)}return o}(),verifyDomain:function(){var t=le()(a.a.mark(function m(){var c,j;return a.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,h.b.create("api/organizations/".concat((c=s.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s.verifyModal,"/verify"));case 2:return j=u.sent,j.is_verified?y.d.success("Domain verified successfully."):y.d.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),i.replaceDomain(j),i.setVerifyModal(null),u.abrupt("return",!1);case 7:case"end":return u.stop()}},m)}));function o(){return t.apply(this,arguments)}return o}()}]}}),Object(g.listeners)(function(r){var s=r.actions,i=r.values;return{setConfigureSAMLModalId:function(o){var m=o.id,c=i.verifiedDomains.find(function(f){var v=f.id;return v===m});if(m&&c){var j=c.saml_acs_url,b=c.saml_entity_id,u=c.saml_x509_cert;s.setSamlConfigValues({saml_acs_url:j,saml_entity_id:b,saml_x509_cert:u,id:m})}}}}),Object(g.selectors)({domainBeingVerified:[function(r){return[r.verifiedDomains,r.verifyModal]},function(r,s){return s&&r.find(function(i){var t=i.id;return t===s})||null}],isSSOEnforcementAvailable:[function(r){return[r.currentOrganization]},function(r){var s;return(s=r==null?void 0:r.available_features.includes(O.e.SSO_ENFORCEMENT))!==null&&s!==void 0?s:!1}],isSAMLAvailable:[function(r){return[r.currentOrganization]},function(r){var s;return(s=r==null?void 0:r.available_features.includes(O.e.SAML))!==null&&s!==void 0?s:!1}]}),Object(g.afterMount)(function(r){var s=r.actions;return s.loadVerifiedDomains()}),Object(x.forms)(function(r){var s=r.actions,i=r.values;return{samlConfig:{defaults:{},errors:function(o){return{saml_acs_url:o.saml_acs_url&&!o.saml_acs_url.match(U.w)?"Please enter a valid URL, including https://":void 0}},submit:function(){var t=le()(a.a.mark(function m(c,j){var b,u,f,v;return a.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(u=c.id,f=nn()(c,ce),u){p.next=3;break}return p.abrupt("return");case 3:return p.next=5,h.b.update("api/organizations/".concat((b=i.currentOrganization)===null||b===void 0?void 0:b.id,"/domains/").concat(c.id),Le({},f));case 5:v=p.sent,j(),s.replaceDomain(v),s.setConfigureSAMLModalId(null),s.setSamlConfigValues({}),y.d.success("SAML configuration for ".concat(v.domain," updated successfully."));case 11:case"end":return p.stop()}},m)}));function o(m,c){return t.apply(this,arguments)}return o}()}}})]),He=n("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),G=n("./frontend/src/lib/components/LemonModal/index.ts");function mn(){var r=Object(g.useValues)(J),s=r.addModalShown,i=r.verifiedDomainsLoading,t=Object(g.useActions)(J),o=t.setAddModalShown,m=t.addVerifiedDomain,c=Object(Z.useState)(""),j=te()(c,2),b=j[0],u=j[1],f=Object(Z.useState)(!1),v=te()(f,2),C=v[0],p=v[1],q=!b||!b.match(U.e),T=function(){u(""),p(!1)},$=function(){o(!1),T()},M=function(){p(!0),q||(m(b),T())};return Object(e.jsxs)(G.a,{onClose:$,isOpen:s,title:"Add authentication domain",footer:Object(e.jsx)(W.a,{type:"primary",disabled:b===""||C&&q||i,onClick:M,children:"Add domain"}),children:[Object(e.jsx)(P.LemonInput,{placeholder:"posthog.com",autoFocus:!0,value:b,onChange:u,onPressEnter:M}),C&&q&&Object(e.jsx)("span",{className:"text-danger text-xs",children:"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"})]})}var jn=n("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx"),Se=n("./frontend/src/lib/forms/Field.tsx");function fn(){var r=Object(g.useValues)(J),s=r.domainBeingVerified,i=r.updatingDomainLoading,t=Object(g.useActions)(J),o=t.setVerifyModal,m=t.verifyDomain,c="_posthog-challenge.".concat(s==null?void 0:s.domain,".");return Object(e.jsx)(G.a,{isOpen:!!s,onClose:function(){return o(null)},title:"Verify your domain",description:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(ve.a,{className:"uppercase",children:(s==null?void 0:s.domain)||""}),Object(e.jsx)("p",{children:"To verify your domain, you need to add a record to your DNS zone."})]}),footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(W.a,{type:"secondary",onClick:function(){return o(null)},children:"Verify later"}),Object(e.jsx)(W.a,{type:"primary",disabled:i,onClick:m,children:"Verify"})]}),children:Object(e.jsx)("div",{children:Object(e.jsxs)("ol",{children:[Object(e.jsx)("li",{children:"Sign in to your DNS provider."}),Object(e.jsxs)("li",{children:["Add the following ",Object(e.jsx)("b",{children:"TXT"})," record.",Object(e.jsxs)("div",{className:"my-4 space-y-2",children:[Object(e.jsx)(Se.b,{label:"Name",children:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:c}),Object(e.jsx)(me.a,{explicitValue:c})]})}),Object(e.jsx)(Se.b,{label:"Value or content",children:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:s==null?void 0:s.verification_challenge}),Object(e.jsx)(me.a,{explicitValue:s==null?void 0:s.verification_challenge})]})}),Object(e.jsx)(Se.b,{label:"TTL",children:Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:"Default or 3600"}),Object(e.jsx)(me.a,{explicitValue:"3600"})]})})]})]}),Object(e.jsx)("li",{children:"Press verify below."})]})})})}var cn=n("./frontend/src/lib/components/Link.tsx"),vn=n("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),_n=n("./frontend/src/lib/components/AlertMessage/index.ts"),dn=n("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),On=n("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx");function bn(){var r=Object(g.useValues)(J),s=r.configureSAMLModalId,i=r.isSamlConfigSubmitting,t=r.samlConfig,o=Object(g.useActions)(J),m=o.setConfigureSAMLModalId,c=t.saml_acs_url&&t.saml_entity_id&&t.saml_x509_cert,j=function(){m(null)};return Object(e.jsx)(G.a,{onClose:j,isOpen:!!s,title:"",simple:!0,children:Object(e.jsxs)(x.Form,{logic:J,formKey:"samlConfig",enableFormOnSubmit:!0,className:"LemonModal__layout ",children:[Object(e.jsx)(G.a.Header,{children:Object(e.jsx)("h3",{children:"Configure SAML authentication and provisioning"})}),Object(e.jsxs)(G.a.Content,{className:"space-y-2",children:[Object(e.jsx)(Se.a,{name:"saml_acs_url",label:"SAML ACS URL",children:Object(e.jsx)(dn.a,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})}),Object(e.jsx)(Se.a,{name:"saml_entity_id",label:"SAML Entity ID",children:Object(e.jsx)(dn.a,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})}),Object(e.jsx)(Se.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate",children:Object(e.jsx)(On.a,{className:"ph-ignore-input",minRows:10,placeholder:`Enter the public certificate of your IdP. Keep all line breaks.
-----BEGIN CERTIFICATE-----
MIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL
-----END CERTIFICATE-----`})}),!c&&Object(e.jsx)(_n.a,{type:"info",children:"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft."})]}),Object(e.jsx)(G.a.Footer,{children:Object(e.jsx)(W.a,{loading:i,type:"primary",htmlType:"submit",children:"Save settings"})})]})})}var Ie={marginRight:4,fontSize:"1.15em",paddingTop:2};function gn(){var r=Object(g.useValues)(J),s=r.verifiedDomainsLoading,i=r.updatingDomainLoading,t=Object(g.useActions)(J),o=t.setAddModalShown;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsxs)("div",{style:{flexGrow:1},children:[Object(e.jsx)("div",{id:"domain-whitelist"})," ",Object(e.jsx)("h2",{id:"authentication-domains",className:"subtitle",children:"Authentication domains"}),Object(e.jsx)("p",{className:"text-muted-alt",children:"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains."})]}),Object(e.jsx)(W.a,{type:"primary",onClick:function(){return o(!0)},disabled:s||i,children:"Add domain"})]}),Object(e.jsx)(pn,{})]})}function pn(){var r=Object(g.useValues)(J),s=r.verifiedDomains,i=r.verifiedDomainsLoading,t=r.currentOrganization,o=r.updatingDomainLoading,m=r.isSSOEnforcementAvailable,c=r.isSAMLAvailable,j=Object(g.useActions)(J),b=j.updateDomain,u=j.deleteVerifiedDomain,f=j.setVerifyModal,v=j.setConfigureSAMLModalId,C=Object(g.useValues)(De.a),p=C.preflight,q=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function($,M){var B=M.domain;return Object(e.jsx)(ve.a,{children:B})}}].concat(F()(p!=null&&p.cloud?[{key:"is_verified",title:Object(e.jsxs)(e.Fragment,{children:["Verification",Object(e.jsx)(_e.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO).",children:Object(e.jsx)(He.a,{style:{marginLeft:4}})})]}),render:function($,M){var B=M.is_verified,Y=M.verified_at;return B?Object(e.jsxs)("div",{className:"flex items-center text-success",children:[Object(e.jsx)(V.IconCheckmark,{style:Ie})," Verified"]}):Y?Object(e.jsxs)("div",{className:"flex items-center text-danger",children:[Object(e.jsx)(V.IconExclamation,{style:Ie})," Verification expired"]}):Object(e.jsxs)("div",{className:"flex items-center text-warning",children:[Object(e.jsx)(V.IconWarning,{style:Ie})," Pending verification"]})}}]:[]),[{key:"jit_provisioning_enabled",title:Object(e.jsxs)(e.Fragment,{children:["Automatic provisioning"," ",Object(e.jsx)(_e.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((t==null?void 0:t.name)||"this organization"," if it does not exist."),children:Object(e.jsx)(He.a,{})})]}),render:function($,M){var B=M.jit_provisioning_enabled,Y=M.id,ne=M.is_verified;return ne?Object(e.jsx)("div",{className:"flex items-center",children:Object(e.jsx)(vn.a,{checked:B,disabled:o||!ne,onChange:function(de){return b({id:Y,jit_provisioning_enabled:de})},label:Object(e.jsx)("span",{className:"font-normal",children:B?"Enabled":"Disabled"})})}):Object(e.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable automatic provisioning"})}},{key:"sso_enforcement",title:Object(e.jsxs)(e.Fragment,{children:["Enforce SSO"," ",Object(e.jsx)(_e.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider.",children:Object(e.jsx)(He.a,{})})]}),render:function($,M,B){var Y=M.sso_enforcement,ne=M.is_verified,re=M.id,de=M.has_saml;return m?ne?Object(e.jsx)(jn.a,{value:Y,loading:o,onChange:function(tn){return b({id:re,sso_enforcement:tn})},samlAvailable:de}):Object(e.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):B===0?Object(e.jsxs)(cn.a,{to:Object(U.D)(p==null?void 0:p.cloud).url,target:Object(U.D)(p==null?void 0:p.cloud).target,className:"flex items-center",children:[Object(e.jsx)(V.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"]}):Object(e.jsx)(e.Fragment,{})}},{key:"saml",title:"SAML",render:function($,M,B){var Y=M.is_verified,ne=M.saml_acs_url,re=M.saml_entity_id,de=M.saml_x509_cert,qe=M.has_saml;return c?Y?Object(e.jsx)(e.Fragment,{children:qe?Object(e.jsxs)("div",{className:"flex items-center text-success",children:[Object(e.jsx)(V.IconCheckmark,{style:Ie})," SAML enabled"]}):ne||re||de?Object(e.jsxs)("div",{className:"flex items-center text-warning",children:[Object(e.jsx)(V.IconWarning,{style:Ie})," SAML partially configured"]}):Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsx)(V.IconOffline,{style:Ie})," SAML not set up"]})}):Object(e.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):B===0?Object(e.jsxs)(cn.a,{to:Object(U.D)(p==null?void 0:p.cloud).url,target:Object(U.D)(p==null?void 0:p.cloud).target,className:"flex items-center",children:[Object(e.jsx)(V.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"]}):Object(e.jsx)(e.Fragment,{})}},{key:"actions",width:32,align:"center",render:function($,M){var B=M.is_verified,Y=M.id,ne=M.domain;return B?Object(e.jsx)(pe.a,{overlay:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(W.a,{status:"stealth",onClick:function(){return v(Y)},fullWidth:!0,disabled:!c,title:c?void 0:"Upgrade to enable SAML",children:"Configure SAML"}),Object(e.jsxs)(W.a,{status:"danger",onClick:function(){return xe.a.open({title:"Remove ".concat(ne,"?"),description:"This cannot be undone. If you have SAML configured or SSO enforced,it will be immediately disabled.",primaryButton:{status:"danger",children:"Remove domain",onClick:function(){return u(Y)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0,children:[Object(e.jsx)(V.IconDelete,{})," Remove domain"]})]}),style:{display:"inline-block"}}):Object(e.jsx)(W.a,{type:"primary",onClick:function(){return f(Y)},children:"Verify"})}}]);return Object(e.jsxs)("div",{children:[Object(e.jsx)(ae.a,{dataSource:s,columns:q,loading:i,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),Object(e.jsx)(mn,{}),Object(e.jsx)(bn,{}),Object(e.jsx)(fn,{})]})}var hn=n("./node_modules/antd/es/row/index.js"),yn=n("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),Mn=n("./frontend/src/lib/components/Spinner/Spinner.tsx"),En=n("./frontend/src/lib/components/UserSelectItem.tsx"),Je=n("./frontend/src/scenes/organization/Settings/Roles/rolesLogic.tsx");function Dn(){var r=Object(g.useValues)(Je.a),s=r.roleInFocus,i=r.createRoleModalShown,t=r.roleMembersToAdd,o=r.roleMembersInFocusLoading,m=r.addableMembers,c=r.rolesLoading,j=r.roleMembersInFocus,b=r.permissionsToSet,u=Object(g.useActions)(Je.a),f=u.setCreateRoleModalShown,v=u.setRoleMembersToAdd,C=u.createRole,p=u.deleteRoleMember,q=u.addRoleMembers,T=u.setPermission,$=u.setPermissionInPlace,M=Object(g.useValues)(N.a),B=M.isAdminOrOwner,Y=Object(Z.useState)(""),ne=te()(Y,2),re=ne[0],de=ne[1],qe=function(){f(!1),v([])},tn=function(){C(re),de("")},In=function(Te){Te&&(T(O.U.FEATURE_FLAGS,Te),$(O.U.FEATURE_FLAGS,Te))},Ke=!s;return Object(e.jsxs)(G.a,{onClose:qe,isOpen:i,title:Ke?"Create role":"Edit ".concat(s.name," role"),footer:Ke&&Object(e.jsx)(W.a,{type:"primary",disabled:c,onClick:tn,children:c?Object(e.jsx)(Mn.a,{monocolor:!0}):"Create role"}),children:[Ke&&Object(e.jsxs)("div",{className:"mb-5",children:[Object(e.jsx)("h5",{children:"Role Name"}),Object(e.jsx)(P.LemonInput,{placeholder:"Product",autoFocus:!0,value:re,onChange:de})]}),B&&Object(e.jsxs)("div",{className:"mb-5",children:[Object(e.jsx)("h5",{children:"Members"}),Object(e.jsxs)("div",{className:"flex gap-2",children:[Object(e.jsx)("div",{className:"flex-1",children:Object(e.jsx)(yn.a,{placeholder:"Search for team members to add\u2026",value:t,loading:o,onChange:function(Te){return v(Te)},filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:Object(En.a)(m,"uuid")})}),!Ke&&Object(e.jsx)(W.a,{type:"primary",loading:o,disabled:t.length===0,onClick:function(){return q({role:s,membersToAdd:t})},children:"Add"})]})]}),!Ke&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("h5",{children:"Role Members"}),j.length>0?Object(e.jsx)("div",{className:"mt-2 pb-2 rounded overflow-y-auto",style:{maxHeight:300},children:j.map(function(ye){return Object(e.jsx)(xn,{member:ye,deleteMember:function(Tn){return p({roleMemberUuid:Tn})},isAdminOrOwner:!!B},ye.id)})}):Object(e.jsx)("div",{className:"text-muted mb-2",children:"No members added yet"})]}),Object(e.jsx)(P.LemonDivider,{}),Object(e.jsx)("h5",{className:"mt-4",children:"Permissions"}),Object(e.jsxs)(hn.a,{justify:"space-between",align:"middle",children:[Object(e.jsx)("b",{className:"",children:"Feature Flags"}),Object(e.jsx)(P.LemonSelect,{disabled:!B,value:b[O.U.FEATURE_FLAGS],onChange:In,options:[{value:O.a.WRITE,label:"View & Edit"},{value:O.a.READ,label:"View Only"}]})]})]})}function xn(r){var s=r.member,i=r.deleteMember,t=r.isAdminOrOwner,o=s.user;return Object(e.jsxs)("div",{className:"flex items-center justify-between mt-2 h-8",children:[Object(e.jsx)(Oe.b,{email:o.email,name:o.first_name,size:"md",showName:!0}),t&&i&&Object(e.jsx)(W.a,{icon:Object(e.jsx)(V.IconDelete,{}),onClick:function(){return i(s.id)},tooltip:"Remove user from role",status:"primary-alt",type:"tertiary",size:"small"})]})}function Qe(r){var s=r.isRestricted,i=Object(g.useValues)(Je.a),t=i.roles,o=i.rolesLoading,m=Object(g.useActions)(Je.a),c=m.setRoleInFocus,j=m.openCreateRoleModal,b=m.deleteRole,u=[{key:"name",title:"Role",dataIndex:"name",render:function(v,C){return Object(e.jsx)("div",{className:"row-name text-primary cursor-pointer",onClick:function(){c(C)},children:C.name})}},{key:"actions",width:0,sticky:!0,render:function(v,C){return Object(e.jsx)(pe.a,{overlay:s?"You don't have permission to delete roles":Object(e.jsx)(P.LemonButton,{onClick:function(){return b(C)},status:"danger",children:"Delete"})})}}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsxs)("div",{style:{flexGrow:1},children:[Object(e.jsx)("h2",{id:"roles",className:"subtitle",children:"Roles"}),Object(e.jsx)("p",{className:"text-muted-alt",children:"Create roles to provide fine-grained permissions to users across posthog resources"})]}),!s&&Object(e.jsx)(P.LemonButton,{type:"primary",onClick:j,"data-attr":"create-role-button",children:"Create role"})]}),Object(e.jsx)(ae.a,{dataSource:t,columns:u,rowKey:function(){return"id"},style:{marginTop:"1rem"},loading:o,"data-attr":"org-roles-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}}),Object(e.jsx)(Dn,{})]})}try{Qe.displayName="Roles",Qe.__docgenInfo={description:"",displayName:"Roles",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Roles/Roles.tsx#Roles"]={docgenInfo:Qe.__docgenInfo,name:"Roles",path:"frontend/src/scenes/organization/Settings/Roles/Roles.tsx#Roles"})}catch(r){}var Pn=n("./frontend/src/lib/utils.tsx"),Xe=n("./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx");function ke(r){var s=r.isRestricted,i=Object(g.useValues)(Xe.b),t=i.allPermissions,o=Object(g.useActions)(Xe.b),m=o.updateOrganizationResourcePermission,c=[{key:"name",title:"Resource",dataIndex:"name",render:function(b,u){return Object(e.jsx)("b",{children:Object(Pn.i)(u.resource)})}},{key:"access_level",title:"Access Level",dataIndex:"access_level",render:function(b,u){return Object(e.jsx)(P.LemonSelect,{disabled:s,value:u.access_level,onChange:function(v){return m({id:u.id,resource:u.resource,access_level:v})},options:[{value:O.a.WRITE,label:Xe.a[O.a.WRITE]},{value:O.a.READ,label:Xe.a[O.a.READ]}]})}}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)("div",{className:"flex items-center",children:Object(e.jsxs)("div",{style:{flexGrow:1},children:[Object(e.jsx)("h2",{id:"roles",className:"subtitle",children:"Permission Defaults"}),Object(e.jsx)("p",{className:"text-muted-alt",children:"Add organizational default permission levels for posthog resources. Use roles to apply permissions to specific sets of users."})]})}),Object(e.jsx)(ae.a,{dataSource:t,columns:c,rowKey:function(){return"id"},style:{marginTop:"1rem"},loading:!1,"data-attr":"org-permissions-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}})]})}try{ke.displayName="Permissions",ke.__docgenInfo={description:"",displayName:"Permissions",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Permissions/Permissions.tsx#Permissions"]={docgenInfo:ke.__docgenInfo,name:"Permissions",path:"frontend/src/scenes/organization/Settings/Permissions/Permissions.tsx#Permissions"})}catch(r){}var An=n("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),Rn=n("./frontend/src/lib/logic/featureFlagLogic.ts"),Cn={component:un,logic:N.a};function Ln(r){var s=r.isRestricted,i=Object(g.useValues)(N.a),t=i.currentOrganization,o=i.currentOrganizationLoading,m=Object(g.useActions)(N.a),c=m.updateOrganization,j=Object(Z.useState)((t==null?void 0:t.name)||""),b=te()(j,2),u=b[0],f=b[1];return Object(e.jsxs)("div",{style:{maxWidth:"40rem"},children:[Object(e.jsx)("h2",{id:"name",className:"subtitle mt-0",children:"Display Name"}),Object(e.jsx)(P.LemonInput,{className:"mb-4",value:u,onChange:f,disabled:s}),Object(e.jsx)(P.LemonButton,{type:"primary",onClick:function(C){C.preventDefault(),c({name:u})},disabled:s||!u||!t||u===t.name,loading:o,children:"Rename Organization"})]})}function Sn(r){var s=r.isRestricted,i=Object(g.useValues)(N.a),t=i.currentOrganization,o=Object(g.useActions)(N.a),m=o.updateOrganization;return Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{id:"notification-preferences",className:"subtitle",children:"Notification Preferences"}),Object(e.jsx)("div",{children:Object(e.jsx)(P.LemonSwitch,{"data-attr":"is-member-join-email-enabled-switch",onChange:function(j){m({is_member_join_email_enabled:j})},checked:!!(t!=null&&t.is_member_join_email_enabled),disabled:s||!t,label:"Email all current members when a new member joins",bordered:!0})})]})}function un(){var r=Object(g.useValues)(ie.a),s=r.user,i=Object(g.useValues)(Rn.a),t=i.featureFlags;return Object(X.a)(location.hash),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(oe.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),Object(e.jsxs)("div",{className:"border rounded p-6",children:[Object(e.jsx)(w.a,{Component:Ln,minimumAccessLevel:U.p.Admin}),Object(e.jsx)(P.LemonDivider,{className:"my-6"}),Object(e.jsx)(ee,{}),Object(e.jsx)(P.LemonDivider,{className:"my-6"}),t[U.i.ROLE_BASED_ACCESS]&&Object(e.jsxs)(An.a,{feature:O.e.ROLE_BASED_ACCESS,children:[Object(e.jsx)(w.a,{Component:ke,minimumAccessLevel:U.p.Admin}),Object(e.jsx)(P.LemonDivider,{className:"my-6"}),Object(e.jsx)(w.a,{Component:Qe,minimumAccessLevel:U.p.Admin}),Object(e.jsx)(P.LemonDivider,{className:"my-6"})]}),s&&Object(e.jsx)(A,{user:s}),Object(e.jsx)(P.LemonDivider,{className:"my-6"}),Object(e.jsx)(w.a,{Component:gn,minimumAccessLevel:U.p.Admin}),Object(e.jsx)(P.LemonDivider,{className:"my-6"}),Object(e.jsx)(w.a,{Component:Sn,minimumAccessLevel:U.p.Admin}),Object(e.jsx)(P.LemonDivider,{className:"my-6"}),Object(e.jsx)(w.a,{Component:S,minimumAccessLevel:U.p.Owner})]})]})}}}]);
