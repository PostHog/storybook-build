(window.webpackJsonp=window.webpackJsonp||[]).push([[7,10],{"./frontend/src/scenes/apps/ErrorDetailsModal.tsx":function(w,P,e){"use strict";e.r(P),e.d(P,"ErrorDetailsModal",function(){return J});var S=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),U=e.n(S),I=e("./node_modules/react/index.js"),L=e.n(I),B=e("./node_modules/kea/lib/index.esm.js"),u=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),R=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),H=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),W=e("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),y=e("./frontend/src/lib/components/LemonButton/index.ts"),b=e("./frontend/src/lib/components/icons.tsx"),N=e("./frontend/src/lib/components/LemonModal/index.ts"),O=e("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),s=e("./node_modules/react/jsx-runtime.js"),$=e.n(s);function J(){var p,D,M=Object(B.useValues)(u.appMetricsSceneLogic),E=M.errorDetails,T=M.errorDetailsModalError,A=M.errorDetailsLoading,G=Object(B.useActions)(u.appMetricsSceneLogic),v=G.closeErrorDetailsModal,K=Object(I.useState)(0),F=U()(K,2),m=F[0],g=F[1],i=E[m];return Object(s.jsx)(N.a,{isOpen:!!T,onClose:v,title:T,width:"min(50vw, 80rem)",description:Object(s.jsx)("span",{children:i==null||(p=i.error_details)===null||p===void 0||(D=p.error.message)===null||D===void 0?void 0:D.substring(0,200)}),footer:Object(s.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:A?Object(s.jsx)(R.a,{className:"1-10"}):Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("span",{children:[m+1," of ",E.length," sample",E.length>1?"s":""]}),Object(s.jsx)(y.a,{icon:Object(s.jsx)(b.IconChevronLeft,{}),onClick:function(){return g(m-1)},disabled:m==0}),Object(s.jsx)(y.a,{icon:Object(s.jsx)(b.IconChevronRight,{}),onClick:function(){return g(m+1)},disabled:m==E.length-1})]})}),children:!T||A?Object(s.jsx)(R.a,{className:"h-10"}):Object(s.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[Object(s.jsxs)("div",{children:[Object(s.jsx)(W.a,{children:"When:"})," ",Object(s.jsx)(H.b,{time:i.timestamp,showSeconds:!0})]}),i.error_details.eventCount&&Object(s.jsxs)("div",{children:[Object(s.jsx)(W.a,{children:"Event Count"}),Object(s.jsx)("div",{children:i.error_details.eventCount})]}),i.error_details.error.message&&Object(s.jsx)(h,{title:"Error message",defaultIsExpanded:!0,children:Object(s.jsx)(O.a,{wrap:!0,language:O.b.JavaScript,children:i.error_details.error.message})}),i.error_details.event&&Object(s.jsx)(h,{title:"Event payload",defaultIsExpanded:!1,children:Object(s.jsx)(O.a,{wrap:!0,language:O.b.JSON,children:JSON.stringify(i.error_details.event,null,2)})}),i.error_details.error.stack&&Object(s.jsx)(h,{title:"Stack trace",defaultIsExpanded:!1,children:Object(s.jsx)(O.a,{wrap:!0,language:O.b.JavaScript,children:i.error_details.error.stack})})]})})}function h(p){var D=Object(I.useState)(p.defaultIsExpanded),M=U()(D,2),E=M[0],T=M[1];return Object(s.jsxs)("div",{className:"bg-mid border rounded",children:[Object(s.jsx)(y.a,{status:"stealth",fullWidth:!0,onClick:function(){return T(!E)},sideIcon:E?Object(s.jsx)(b.IconUnfoldLess,{}):Object(s.jsx)(b.IconUnfoldMore,{}),title:E?"Show less":"Show more",className:"bg-mid",children:p.title}),E&&Object(s.jsx)("div",{className:"bg-light p-2",children:p.children})]})}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(w,P,e){"use strict";e.r(P),e.d(P,"AppMetricsTab",function(){return _}),e.d(P,"appMetricsSceneLogic",function(){return q});var S=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),U=e.n(S),I=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),L=e.n(I),B=e("./node_modules/@babel/runtime/regenerator/index.js"),u=e.n(B),R=e("./node_modules/core-js/modules/es.array.iterator.js"),H=e.n(R),W=e("./node_modules/core-js/modules/es.object.to-string.js"),y=e.n(W),b=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),N=e.n(b),O=e("./node_modules/core-js/modules/es.array.concat.js"),s=e.n(O),$=e("./node_modules/core-js/modules/es.function.name.js"),J=e.n($),h=e("./node_modules/core-js/modules/es.array.includes.js"),p=e.n(h),D=e("./node_modules/core-js/modules/es.string.includes.js"),M=e.n(D),E=e("./node_modules/core-js/modules/es.array.filter.js"),T=e.n(E),A=e("./node_modules/core-js/modules/es.number.constructor.js"),G=e.n(A),v=e("./node_modules/kea/lib/index.esm.js"),K=e("./node_modules/kea-loaders/lib/index.js"),F=e.n(K),m=e("./frontend/src/scenes/urls.ts"),g=e("./frontend/src/lib/api.ts"),i=e("./frontend/src/scenes/teamLogic.tsx"),x=e("./node_modules/kea-router/lib/index.js"),ee=e.n(x),z=e("./frontend/src/lib/utils.tsx"),_;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.ScheduledTask="scheduledTask",t.HistoricalExports="historical_exports"})(_||(_={}));var V="-30d",Q=[_.ProcessEvent,_.OnEvent,_.ExportEvents,_.ScheduledTask],q=Object(v.kea)([Object(v.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(v.props)({}),Object(v.key)(function(t){return t.pluginConfigId}),Object(v.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}},openErrorDetailsModal:function(o,r,n){return{errorType:o,category:r,jobId:n}},closeErrorDetailsModal:!0}),Object(v.reducers)({activeTab:[null,{setActiveTab:function(o,r){var n=r.tab;return n}}],dateFrom:[V,{setDateFrom:function(o,r){var n=r.dateFrom;return n}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(o,r){var n=r.errorType;return n},closeErrorDetailsModal:function(){return null}}]}),Object(K.loaders)(function(t){var o=t.values,r=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var n=L()(u.a.mark(function c(){return u.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,g.b.get("api/projects/".concat(i.a.values.currentTeamId,"/plugin_configs/").concat(r.pluginConfigId));case 2:return d.abrupt("return",d.sent);case 3:case"end":return d.stop()}},c)}));function a(){return n.apply(this,arguments)}return a}()}],appMetricsResponse:[null,{loadMetrics:function(){var n=L()(u.a.mark(function c(){var l;return u.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return l=Object(z.Eb)({category:o.activeTab,date_from:o.dateFrom}),j.next=3,g.b.get("api/projects/".concat(i.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"?").concat(l));case 3:return j.abrupt("return",j.sent);case 4:case"end":return j.stop()}},c)}));function a(){return n.apply(this,arguments)}return a}()}],historicalExports:[[],{loadHistoricalExports:function(){var n=L()(u.a.mark(function c(){var l,d;return u.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,g.b.get("api/projects/".concat(i.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/historical_exports"));case 2:return l=f.sent,d=l.results,f.abrupt("return",d);case 5:case"end":return f.stop()}},c)}));function a(){return n.apply(this,arguments)}return a}()}],errorDetails:[[],{openErrorDetailsModal:function(){var n=L()(u.a.mark(function c(l){var d,j,f,Y,Z,k;return u.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return d=l.category,j=l.jobId,f=l.errorType,Y=Object(z.Eb)({category:d,job_id:j,error_type:f}),C.next=4,g.b.get("api/projects/".concat(i.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/error_details?").concat(Y));case 4:return Z=C.sent,k=Z.result,C.abrupt("return",k);case 7:case"end":return C.stop()}},c)}));function a(c){return n.apply(this,arguments)}return a}()}]}}),Object(v.selectors)(function(t){var o=t.values;return{breadcrumbs:[function(r){return[r.pluginConfig,function(n,a){return a.pluginConfigId}]},function(r,n){var a;return[{name:"Apps",path:m.a.projectApps()},{name:r==null||(a=r.plugin_info)===null||a===void 0?void 0:a.name,path:m.a.appMetrics(n)}]}],showTab:[function(){return[]},function(){return function(r){if(o.pluginConfigLoading||!o.pluginConfig||!o.pluginConfig.plugin_info.capabilities)return!1;var n=o.pluginConfig.plugin_info.capabilities,a=n.methods.includes("exportEvents");return r===_.HistoricalExports?a:r===_.OnEvent&&a?!1:r===_.ScheduledTask?!a&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(c){return n.scheduled_tasks.includes(c)}):n.methods.includes(r)}}]}}),Object(v.listeners)(function(t){var o=t.values,r=t.actions;return{loadPluginConfigSuccess:function(){if(!o.activeTab){var a=Q.filter(function(d){return o.showTab(d)}),c=U()(a,1),l=c[0];r.setActiveTab(l)}},setActiveTab:function(a){var c=a.tab;c===_.HistoricalExports?r.loadHistoricalExports():r.loadMetrics()},setDateFrom:function(){r.loadMetrics()}}}),Object(x.actionToUrl)(function(t){var o=t.values,r=t.props;return{setActiveTab:function(){return X(o,r)},setDateFrom:function(){return X(o,r)}}}),Object(x.urlToAction)(function(t){var o=t.values,r=t.actions,n=t.props;return{"/app/:pluginConfigId/:page":function(c,l){n.pluginConfigId===Number(c.pluginConfigId)&&(o.pluginConfig||r.loadPluginConfig(),c.page===_.HistoricalExports?r.setActiveTab(_.HistoricalExports):(l.tab&&Q.includes(l.tab)&&r.setActiveTab(l.tab),l.from&&r.setDateFrom(l.from)))}}})]);function X(t,o){if(t.activeTab===_.HistoricalExports)return m.a.appHistoricalExports(o.pluginConfigId);var r={};return t.activeTab&&(r.tab=t.activeTab),t.dateFrom!==V&&(r.from=t.dateFrom),m.a.appMetrics(o.pluginConfigId,r)}}}]);
