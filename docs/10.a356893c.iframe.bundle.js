(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(H,g,e){"use strict";e.r(g),e.d(g,"AppMetricsTab",function(){return l}),e.d(g,"appMetricsSceneLogic",function(){return F});var I=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),A=e.n(I),L=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),v=e.n(L),y=e("./node_modules/@babel/runtime/regenerator/index.js"),d=e.n(y),B=e("./node_modules/core-js/modules/es.array.iterator.js"),S=e.n(B),R=e("./node_modules/core-js/modules/es.object.to-string.js"),G=e.n(R),U=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),J=e.n(U),K=e("./node_modules/core-js/modules/es.array.concat.js"),N=e.n(K),W=e("./node_modules/core-js/modules/es.function.name.js"),z=e.n(W),h=e("./node_modules/core-js/modules/es.array.includes.js"),Q=e.n(h),x=e("./node_modules/core-js/modules/es.string.includes.js"),V=e.n(x),$=e("./node_modules/core-js/modules/es.array.filter.js"),X=e.n($),E=e("./node_modules/kea/lib/index.esm.js"),O=e("./node_modules/kea-loaders/lib/index.js"),Y=e.n(O),f=e("./frontend/src/scenes/urls.ts"),D=e("./frontend/src/lib/api.ts"),m=e("./frontend/src/scenes/teamLogic.tsx"),j=e("./node_modules/kea-router/lib/index.js"),Z=e.n(j),M=e("./frontend/src/lib/utils.tsx"),l;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.HistoricalExports="historical_exports"})(l||(l={}));var P=[l.ProcessEvent,l.OnEvent,l.ExportEvents],F=Object(E.kea)([Object(E.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(E.props)({}),Object(E.key)(function(t){return t.pluginConfigId}),Object(E.actions)({setActiveTab:function(a){return{tab:a}},setDateFrom:function(a){return{dateFrom:a}},openErrorDetailsDrawer:function(a,r,n){return{errorType:a,category:r,jobId:n}},closeErrorDetailsDrawer:!0}),Object(E.reducers)({activeTab:[null,{setActiveTab:function(a,r){var n=r.tab;return n}}],dateFrom:["-30d",{setDateFrom:function(a,r){var n=r.dateFrom;return n}}],errorDetailsDrawerError:[null,{openErrorDetailsDrawer:function(a,r){var n=r.errorType;return n},closeErrorDetailsDrawer:function(){return null}}]}),Object(O.loaders)(function(t){var a=t.values,r=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var n=v()(d.a.mark(function o(){return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,D.b.get("api/projects/".concat(m.a.values.currentTeamId,"/plugin_configs/").concat(r.pluginConfigId));case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},o)}));function s(){return n.apply(this,arguments)}return s}()}],appMetricsResponse:[null,{loadMetrics:function(){var n=v()(d.a.mark(function o(){var u;return d.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return u=Object(M.Eb)({category:a.activeTab,date_from:a.dateFrom}),c.next=3,D.b.get("api/projects/".concat(m.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"?").concat(u));case 3:return c.abrupt("return",c.sent);case 4:case"end":return c.stop()}},o)}));function s(){return n.apply(this,arguments)}return s}()}],historicalExports:[[],{loadHistoricalExports:function(){var n=v()(d.a.mark(function o(){var u,i;return d.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,D.b.get("api/projects/".concat(m.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/historical_exports"));case 2:return u=_.sent,i=u.results,_.abrupt("return",i);case 5:case"end":return _.stop()}},o)}));function s(){return n.apply(this,arguments)}return s}()}],errorDetails:[[],{openErrorDetailsDrawer:function(){var n=v()(d.a.mark(function o(u){var i,c,_,T,b,C;return d.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return i=u.category,c=u.jobId,_=u.errorType,T=Object(M.Eb)({category:i,job_id:c,error_type:_}),p.next=4,D.b.get("api/projects/".concat(m.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/error_details?").concat(T));case 4:return b=p.sent,C=b.result,p.abrupt("return",C);case 7:case"end":return p.stop()}},o)}));function s(o){return n.apply(this,arguments)}return s}()}]}}),Object(E.selectors)(function(t){var a=t.values;return{breadcrumbs:[function(r){return[r.pluginConfig,function(n,s){return s.pluginConfigId}]},function(r,n){var s;return[{name:"Apps",path:f.a.projectApps()},{name:r==null||(s=r.plugin_info)===null||s===void 0?void 0:s.name,path:f.a.appMetrics(n)}]}],showTab:[function(){return[]},function(){return function(r){var n;if(a.pluginConfigLoading||!a.pluginConfig)return!1;var s=((n=a.pluginConfig.plugin_info.capabilities)===null||n===void 0?void 0:n.methods)||[];return r===l.HistoricalExports?s.includes("exportEvents"):r===l.OnEvent&&s.includes("exportEvents")?!1:s.includes(r)}}]}}),Object(E.listeners)(function(t){var a=t.values,r=t.actions;return{loadPluginConfigSuccess:function(){if(!a.activeTab){var s=P.filter(function(i){return a.showTab(i)}),o=A()(s,1),u=o[0];r.setActiveTab(u)}},setActiveTab:function(s){var o=s.tab;o===l.HistoricalExports?r.loadHistoricalExports():r.loadMetrics()},setDateFrom:function(){r.loadMetrics()}}}),Object(j.actionToUrl)(function(t){var a=t.values,r=t.props;return{setActiveTab:function(){var s;return a.activeTab===l.HistoricalExports?f.a.appHistoricalExports(r.pluginConfigId):f.a.appMetrics(r.pluginConfigId,(s=a.activeTab)!==null&&s!==void 0?s:void 0)}}}),Object(j.urlToAction)(function(t){var a=t.values,r=t.actions;return{"/app/:pluginConfigId/:page":function(s,o){a.pluginConfig||r.loadPluginConfig(),s.page===l.HistoricalExports?r.setActiveTab(l.HistoricalExports):o.tab&&P.includes(o.tab)&&r.setActiveTab(o.tab)}}})])}}]);
