"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[7858],{"./frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{v:function(){return DashboardTemplateEditor}});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),_monaco_editor_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@monaco-editor+react@4.4.6_monaco-editor@0.39.0_react-dom@16.14.0_react@16.14.0/node_modules/@monaco-editor/react/lib/es/index.js"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),kea__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/dashboard/dashboardTemplateEditorLogic.ts"),lib_components_CodeEditors__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/components/CodeEditors.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function DashboardTemplateEditor(_ref){let{inline:inline=!1}=_ref;const monaco=(0,_monaco_editor_react__WEBPACK_IMPORTED_MODULE_1__.Ik)(),{closeDashboardTemplateEditor:closeDashboardTemplateEditor,createDashboardTemplate:createDashboardTemplate,updateDashboardTemplate:updateDashboardTemplate,setEditorValue:setEditorValue,updateValidationErrors:updateValidationErrors}=(0,kea__WEBPACK_IMPORTED_MODULE_3__.useActions)(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_4__.X),{isOpenNewDashboardTemplateModal:isOpenNewDashboardTemplateModal,editorValue:editorValue,validationErrors:validationErrors,templateSchema:templateSchema,id:id}=(0,kea__WEBPACK_IMPORTED_MODULE_3__.useValues)(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_4__.X);return(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((()=>{if(!monaco)return;const schemas=[];templateSchema&&schemas.push({uri:"http://internal/node-schema.json",fileMatch:["*"],schema:templateSchema}),monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:schemas})}),[monaco,templateSchema]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonModal,{title:id?"Edit dashboard template":"New dashboard template",isOpen:isOpenNewDashboardTemplateModal,width:1e3,onClose:()=>{closeDashboardTemplateEditor()},inline:inline,footer:id?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{type:"primary","data-attr":"update-dashboard-template-button",onClick:()=>{updateDashboardTemplate({id:id})},disabledReason:validationErrors.length?`There are ${validationErrors.length} errors to resolve: ${validationErrors.map((e=>" "+e))}`:void 0,children:"Update template"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{type:"primary","data-attr":"create-dashboard-template-button",onClick:()=>{createDashboardTemplate()},disabledReason:validationErrors.length?`There are ${validationErrors.length} errors to resolve:${validationErrors.map((e=>" "+e))}`:void 0,children:"Create new template"}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_components_CodeEditors__WEBPACK_IMPORTED_MODULE_5__.p,{className:"border",language:"json",value:editorValue,onChange:v=>{setEditorValue(null!=v?v:"")},onValidate:markers=>{updateValidationErrors(markers)},height:600})})}try{DashboardTemplateEditor.displayName="DashboardTemplateEditor",DashboardTemplateEditor.__docgenInfo={description:"",displayName:"DashboardTemplateEditor",props:{inline:{defaultValue:{value:"false"},description:"",name:"inline",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx#DashboardTemplateEditor"]={docgenInfo:DashboardTemplateEditor.__docgenInfo,name:"DashboardTemplateEditor",path:"frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx#DashboardTemplateEditor"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/dashboard/dashboardTemplateEditorLogic.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{X:function(){return dashboardTemplateEditorLogic}});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts"),_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/dashboard/dashboards/templates/dashboardTemplatesLogic.tsx"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts");const dashboardTemplateEditorLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","dashboard","dashboardTemplateEditorLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)({logic:[_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__.R],values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_5__.h,["featureFlags"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({setEditorValue:value=>({value:value}),setDashboardTemplate:dashboardTemplate=>({dashboardTemplate:dashboardTemplate}),clear:!0,setDashboardTemplateId:id=>({id:id}),openDashboardTemplateEditor:!0,closeDashboardTemplateEditor:!0,updateValidationErrors:markers=>({markers:markers})}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)({editorValue:["",{setEditorValue:(_,_ref)=>{let{value:value}=_ref;return value},clear:()=>""}],dashboardTemplate:[null,{clear:()=>null,setDashboardTemplate:(_,_ref2)=>{let{dashboardTemplate:dashboardTemplate}=_ref2;return dashboardTemplate}}],validationErrors:[[],{updateValidationErrors:(_,_ref3)=>{let{markers:markers}=_ref3;return markers&&0!==markers.length?markers.map((marker=>marker.message)):[]},clear:()=>[]}],id:[null,{setDashboardTemplateId:(_,_ref4)=>{let{id:id}=_ref4;return id},clear:()=>null}],isOpenNewDashboardTemplateModal:[!1,{openDashboardTemplateEditor:()=>!0,closeDashboardTemplateEditor:()=>!1}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_2__.loaders)((_ref5=>{let{values:values}=_ref5;return{dashboardTemplate:[void 0,{createDashboardTemplate:async()=>{if(!values.dashboardTemplate)return void _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("Unable to create dashboard template");const response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.create(values.dashboardTemplate);return _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success("Dashboard template created"),response},getDashboardTemplate:async id=>await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.get(id),updateDashboardTemplate:async _ref6=>{let{id:id,dashboardTemplateUpdates:dashboardTemplateUpdates}=_ref6,response=null;if(dashboardTemplateUpdates)response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.update(id,dashboardTemplateUpdates);else{if(!values.dashboardTemplate)return void _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("Unable to update dashboard template");response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.update(id,values.dashboardTemplate)}return _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success("Dashboard template updated"),response},deleteDashboardTemplate:async id=>(await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.delete(id),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success("Dashboard template deleted"),null)}],templateSchema:[null,{getTemplateSchema:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.getSchema()}]}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)((_ref7=>{let{values:values,actions:actions}=_ref7;return{createDashboardTemplateSuccess:async()=>{actions.closeDashboardTemplateEditor(),_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__.R.actions.getAllTemplates()},updateDashboardTemplateSuccess:async()=>{actions.closeDashboardTemplateEditor(),_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__.R.actions.getAllTemplates()},deleteDashboardTemplateSuccess:async()=>{_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__.R.actions.getAllTemplates()},closeDashboardTemplateEditor:()=>{actions.clear()},setDashboardTemplateId:_ref8=>{let{id:id}=_ref8;id&&actions.getDashboardTemplate(id)},getDashboardTemplateSuccess:async _ref9=>{let{dashboardTemplate:dashboardTemplate}=_ref9;dashboardTemplate&&actions.setEditorValue(JSON.stringify(dashboardTemplate))},setEditorValue:async(_ref10,breakpoint)=>{let{value:value}=_ref10;if(await breakpoint(500),0==values.validationErrors.length&&value?.length)try{const dashboardTemplate=JSON.parse(value);actions.setDashboardTemplate(dashboardTemplate)}catch(error){console.error("error",error),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("Unable to parse dashboard template")}},updateValidationErrors:async _ref11=>{let{markers:markers}=_ref11;markers?.length||actions.setEditorValue(values.editorValue)},setDashboardTemplate:async _ref12=>{let{dashboardTemplate:dashboardTemplate}=_ref12;dashboardTemplate&&actions.setEditorValue(JSON.stringify(dashboardTemplate,null,4))}}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.afterMount)((_ref13=>{let{actions:actions}=_ref13;actions.getTemplateSchema()}))])},"./frontend/src/scenes/dashboard/DashboardTemplateEditor.stories.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CreateTemplate:function(){return CreateTemplate},EditTemplate:function(){return EditTemplate}});var _DashboardTemplateEditor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx"),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/scenes/dashboard/dashboardTemplateEditorLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const meta={title:"Scenes-App/Dashboards",component:_DashboardTemplateEditor__WEBPACK_IMPORTED_MODULE_0__.v,parameters:{testOptions:{waitForLoadersToDisappear:!0}}};__webpack_exports__.default=meta;const CreateTemplate=()=>(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.mount(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.clear(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.openDashboardTemplateEditor(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.setEditorValue(JSON.stringify({id:"123",template_name:"My Template"},null,4)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"bg-default p-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_DashboardTemplateEditor__WEBPACK_IMPORTED_MODULE_0__.v,{inline:!0})})),EditTemplate=()=>(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.mount(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.setDashboardTemplateId("123"),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.openDashboardTemplateEditor(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.setEditorValue(JSON.stringify({id:"123",template_name:"My Template"},null,4)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"bg-default p-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_DashboardTemplateEditor__WEBPACK_IMPORTED_MODULE_0__.v,{inline:!0})}));CreateTemplate.parameters={...CreateTemplate.parameters,docs:{...CreateTemplate.parameters?.docs,source:{originalSource:"(): JSX.Element => {\n  dashboardTemplateEditorLogic.mount();\n  dashboardTemplateEditorLogic.actions.clear();\n  dashboardTemplateEditorLogic.actions.openDashboardTemplateEditor();\n  dashboardTemplateEditorLogic.actions.setEditorValue(JSON.stringify({\n    id: '123',\n    template_name: 'My Template'\n  }, null, 4));\n  return <div className=\"bg-default p-4\">\n            <DashboardTemplateEditor inline={true} />\n        </div>;\n}",...CreateTemplate.parameters?.docs?.source}}},EditTemplate.parameters={...EditTemplate.parameters,docs:{...EditTemplate.parameters?.docs,source:{originalSource:"(): JSX.Element => {\n  dashboardTemplateEditorLogic.mount();\n  dashboardTemplateEditorLogic.actions.setDashboardTemplateId('123');\n  dashboardTemplateEditorLogic.actions.openDashboardTemplateEditor();\n  dashboardTemplateEditorLogic.actions.setEditorValue(JSON.stringify({\n    id: '123',\n    template_name: 'My Template'\n  }, null, 4));\n  return <div className=\"bg-default p-4\">\n            <DashboardTemplateEditor inline={true} />\n        </div>;\n}",...EditTemplate.parameters?.docs?.source}}}}}]);