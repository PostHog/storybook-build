(window.webpackJsonp=window.webpackJsonp||[]).push([[303],{"./frontend/src/scenes/exports/ViewExport.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Export",(function(){return Export}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),_api__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/scenes/exports/api.ts"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const Export=()=>{const{currentLocation:currentLocation}=Object(kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(kea_router__WEBPACK_IMPORTED_MODULE_2__.router),exportId=currentLocation.pathname.split("/").pop();if(void 0===exportId)throw Error("exportId is undefined");const{currentTeamId:currentTeamId}=Object(_api__WEBPACK_IMPORTED_MODULE_1__.b)(),{loading:loading,export_:export_,error:error}=Object(_api__WEBPACK_IMPORTED_MODULE_1__.d)(currentTeamId,exportId);return void 0===export_?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h1",{children:"Export"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"Fetching export..."})]}):error?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h1",{children:"Export"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:["Error fetching export: ",error]})]}):Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h1",{children:"Export"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("strong",{children:"ID:"})," ",export_.id]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("strong",{children:"Type:"})," ",export_.destination.type]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("strong",{children:"Frequency:"})," ",export_.interval]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("strong",{children:"Status:"})," ",export_.status]}),loading?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"Loading..."}):null,Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(ExportRuns,{exportId:exportId})]})},ExportRuns=_ref=>{let{exportId:exportId}=_ref;const{currentTeamId:currentTeamId}=Object(_api__WEBPACK_IMPORTED_MODULE_1__.b)(),{loading:loading,exportRuns:exportRuns,error:error}=Object(_api__WEBPACK_IMPORTED_MODULE_1__.f)(currentTeamId,exportId);return void 0===exportRuns?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h1",{children:"Export Runs"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"Fetching export runs..."})]}):error?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h1",{children:"Export Runs"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:["Error fetching export runs: ",error]})]}):Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h1",{children:"Export Runs"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("table",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("thead",{children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("tr",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("th",{children:"Status"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("th",{children:"Start time"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("th",{children:"End time"})]})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("tbody",{children:exportRuns.map((exportRun=>Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("tr",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("td",{children:"Running"===exportRun.status?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"running"}):"Completed"===exportRun.status?"✅":"❌"}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("td",{children:exportRun.data_interval_start}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("td",{children:exportRun.data_interval_end})]},exportRun.id)))})]}),loading?Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"Loading..."}):null]})}},"./frontend/src/scenes/exports/api.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return useCurrentTeamId})),__webpack_require__.d(__webpack_exports__,"g",(function(){return useExports})),__webpack_require__.d(__webpack_exports__,"a",(function(){return useCreateExport})),__webpack_require__.d(__webpack_exports__,"c",(function(){return useDeleteExport})),__webpack_require__.d(__webpack_exports__,"e",(function(){return useExportAction})),__webpack_require__.d(__webpack_exports__,"d",(function(){return useExport})),__webpack_require__.d(__webpack_exports__,"f",(function(){return useExportRuns}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),_teamLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),_lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts");const useCurrentTeamId=()=>{const{currentTeamId:currentTeamId}=Object(kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_teamLogic__WEBPACK_IMPORTED_MODULE_1__.b);if(null==currentTeamId)throw Error("currentTeamId should not be undefined");return{currentTeamId:currentTeamId}},useExports=teamId=>{const[state,setExports]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)({loading:!0,exports:void 0,error:void 0}),updateCallback=Object(react__WEBPACK_IMPORTED_MODULE_2__.useCallback)((signal=>{fetch(`/api/projects/${teamId}/batch_exports/`,{signal:signal}).then((response=>response.json())).then((data=>{setExports({loading:!1,exports:data.results,error:void 0})})).catch((error=>{setExports({loading:!1,exports:void 0,error:error})}))}),[teamId]);return Object(react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((()=>{const controller=new AbortController,signal=controller.signal;return updateCallback(signal),()=>controller.abort()}),[teamId]),{exportsState:state,updateCallback:updateCallback}},useCreateExport=()=>{const[state,setState]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)({loading:!1,error:null});return{createExport:Object(react__WEBPACK_IMPORTED_MODULE_2__.useCallback)(((teamId,exportData)=>(setState({loading:!0,error:null}),_lib_api__WEBPACK_IMPORTED_MODULE_3__.b.createResponse(`/api/projects/${teamId}/batch_exports/`,exportData).then((response=>{if(!response.ok){const error=new Error(response.statusText);throw setState({loading:!1,error:error}),error}setState({loading:!1,error:null})})))),[]),...state}},useDeleteExport=(teamId,exportId)=>{const[state,setState]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)({deleting:!1,error:null});return{deleteExport:Object(react__WEBPACK_IMPORTED_MODULE_2__.useCallback)((()=>(setState({deleting:!0,error:null}),_lib_api__WEBPACK_IMPORTED_MODULE_3__.b.delete(`/api/projects/${teamId}/batch_exports/${exportId}`).then((response=>{if(!response.ok){const error=new Error(response.statusText);throw setState({deleting:!1,error:error}),error}setState({deleting:!1,error:null})})))),[teamId,exportId]),...state}},useExportAction=(teamId,exportId,action)=>{const[state,setState]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)({loading:!1,error:null});return{executeExportAction:Object(react__WEBPACK_IMPORTED_MODULE_2__.useCallback)((()=>(setState({loading:!0,error:null}),_lib_api__WEBPACK_IMPORTED_MODULE_3__.b.createResponse(`/api/projects/${teamId}/batch_exports/${exportId}/${action}`,{}).then((response=>{if(!response.ok){const error=new Error(response.statusText);throw setState({loading:!1,error:error}),error}setState({loading:!1,error:null})})))),[teamId,exportId,action]),...state}},useExport=(teamId,exportId)=>{const[loading,setLoading]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(!0),[export_,setExport]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(),[error,setError]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)();return Object(react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((()=>{const controller=new AbortController,signal=controller.signal;return setLoading(!0),setError(void 0),fetch(`/api/projects/${teamId}/batch_exports/${exportId}`,{signal:signal}).then((res=>res.json())).then((data=>{setExport(data),setLoading(!1)})).catch((error=>{setError(error),setLoading(!1)})),()=>controller.abort()}),[teamId,exportId]),{loading:loading,export_:export_,error:error}},useExportRuns=(teamId,exportId)=>{const[loading,setLoading]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(!0),[exportRuns,setExportRuns]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(),[error,setError]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)();return Object(react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((()=>{const controller=new AbortController,signal=controller.signal;return setLoading(!0),setError(void 0),fetch(`/api/projects/${teamId}/batch_exports/${exportId}/runs`,{signal:signal}).then((res=>res.json())).then((data=>{setExportRuns(data.results),setLoading(!1)})).catch((error=>{setError(error),setLoading(!1)})),()=>controller.abort()}),[teamId,exportId]),{loading:loading,exportRuns:exportRuns,error:error}}}}]);