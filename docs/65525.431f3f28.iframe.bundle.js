"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[65525],{"../../frontend/src/lib/components/SceneDashboardChoice/SceneDashboardChoiceModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{q:()=>SceneDashboardChoiceModal});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_components_SceneDashboardChoice_SceneIcon__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/components/SceneDashboardChoice/SceneIcon.tsx"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonModal/index.ts"),lib_lemon_ui_LemonRow__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonRow/index.ts"),lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_models_dashboardsModel__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/models/dashboardsModel.tsx"),_sceneDashboardChoiceModalLogic__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/lib/components/SceneDashboardChoice/sceneDashboardChoiceModalLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SceneDashboardChoiceModal(_ref){let{scene}=_ref,modalLogic=(0,_sceneDashboardChoiceModalLogic__WEBPACK_IMPORTED_MODULE_10__.F)({scene}),{isOpen,currentDashboardId,dashboards,searchTerm}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(modalLogic),{closeSceneDashboardChoiceModal,setSceneDashboardChoice,setSearchTerm}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(modalLogic),{dashboardsLoading}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_models_dashboardsModel__WEBPACK_IMPORTED_MODULE_9__.h);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_5__.f,{isOpen:isOpen,onClose:closeSceneDashboardChoiceModal,title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:["Select a default dashboard for ",_sceneDashboardChoiceModalLogic__WEBPACK_IMPORTED_MODULE_10__.o[scene]]}),footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",{className:(0,lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_12__.cn)("flex gap-2 w-full",currentDashboardId?"justify-between":"justify-end"),children:[currentDashboardId?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_4__.J,{type:"secondary","data-attr":"scene-dashboard-choice-new-tab",onClick:()=>{setSceneDashboardChoice(null),setSearchTerm(""),closeSceneDashboardChoiceModal()},children:'Reset to "new tab"'}):null,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_4__.J,{type:"secondary","data-attr":"close-scene-dashboard-choice-modal",onClick:closeSceneDashboardChoiceModal,children:"Close"})]}),children:dashboardsLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"deprecated-space-y-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_7__.y.Row,{repeat:4})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.DF,{type:"search",placeholder:"Search for dashboards",onChange:setSearchTerm,value:null!=searchTerm?searchTerm:void 0,fullWidth:!0,allowClear:!0,className:"mb-4"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.p2,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"deprecated-space-y-2 min-h-100",children:dashboards.map(dashboard=>{let isCurrentChoice=dashboard.id===currentDashboardId,rowContents=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",{className:"flex flex-1 items-center justify-between overflow-hidden",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",{className:"flex-1 flex flex-col justify-center overflow-hidden",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("strong",{children:dashboard.name}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span",{className:"text-text-3000 font-normal text-ellipsis",children:dashboard.description})]}),isCurrentChoice?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_components_SceneDashboardChoice_SceneIcon__WEBPACK_IMPORTED_MODULE_3__.m,{scene:scene,size:"small"})," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span",{children:"Default"})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("strong",{className:"set-default-text",children:"Set as default"})]});return isCurrentChoice?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonRow__WEBPACK_IMPORTED_MODULE_6__.Q,{fullWidth:!0,status:"muted",className:"dashboard-row",children:rowContents},dashboard.id):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_4__.J,{fullWidth:!0,className:"dashboard-row",onClick:()=>{setSceneDashboardChoice(dashboard.id),setSearchTerm(""),closeSceneDashboardChoiceModal(),kea_router__WEBPACK_IMPORTED_MODULE_1__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.projectHomepage())},children:rowContents},dashboard.id)})})]})})}},"../../frontend/src/lib/components/SceneDashboardChoice/SceneIcon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>SceneIcon});var clsx__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),_posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SceneIcon(props){let className=(0,clsx__WEBPACK_IMPORTED_MODULE_3__.default)("text-warning","small"===props.size?"text-lg":"text-3xl");return props.scene===scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_1__.x.ProjectHomepage?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconHome,{className:className}):props.scene===scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_1__.x.Group||props.scene===scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_1__.x.Person?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconPerson,{className:className}):null}},"../../frontend/src/lib/components/SceneDashboardChoice/sceneDashboardChoiceModalLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>sceneDashboardChoiceModalLogic,o:()=>sceneDescription});var fuse_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),posthog_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.282.0/node_modules/posthog-js/dist/module.js"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/utils/eventUsageLogic.ts"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_models_dashboardsModel__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/models/dashboardsModel.tsx");let sceneDescription={[scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.Person]:"persons",[scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.Group]:"groups",[scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.ProjectHomepage]:"this project"},sceneDashboardChoiceModalLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(key=>["lib","components","SceneDashboardChoice","sceneDashboardChoiceModalLogic",key||"unknown"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>`${props.scene}`),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({logic:[lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_2__.vx],actions:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic,["updateCurrentTeam"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_5__.userLogic,["setUserScenePersonalisation"]],values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic,["currentTeam"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_5__.userLogic,["user"],_models_dashboardsModel__WEBPACK_IMPORTED_MODULE_6__.h,["nameSortedDashboards"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({showSceneDashboardChoiceModal:()=>!0,closeSceneDashboardChoiceModal:()=>!0,setSceneDashboardChoice:dashboardId=>({dashboardId}),setSearchTerm:searchTerm=>({searchTerm})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({searchTerm:[null,{setSearchTerm:(_,_ref)=>{let{searchTerm}=_ref;return searchTerm}}],isOpen:[!1,{showSceneDashboardChoiceModal:()=>!0,closeSceneDashboardChoiceModal:()=>!1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(_ref2=>{let{props}=_ref2;return{currentDashboardId:[s=>[s.currentTeam,s.user],(currentTeam,user)=>{var _user$scene_personali,_ref3,_currentTeam$primary_;let currentDashboard=null!==(_user$scene_personali=user?.scene_personalisation?.find(choice=>choice.scene===props.scene)?.dashboard)&&void 0!==_user$scene_personali?_user$scene_personali:null;return currentDashboard||props.scene!==scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.ProjectHomepage||(currentDashboard=null!==(_currentTeam$primary_=currentTeam?.primary_dashboard)&&void 0!==_currentTeam$primary_?_currentTeam$primary_:null),null!==(_ref3="number"==typeof currentDashboard?currentDashboard:currentDashboard?.id)&&void 0!==_ref3?_ref3:null}],dashboards:[s=>[s.searchTerm,s.nameSortedDashboards],(searchTerm,dashboards)=>(dashboards=dashboards.filter(d=>!d.deleted).sort((a,b)=>{var _a$name,_b$name;return(null!==(_a$name=a.name)&&void 0!==_a$name?_a$name:"Untitled").localeCompare(null!==(_b$name=b.name)&&void 0!==_b$name?_b$name:"Untitled")}),searchTerm)?new fuse_js__WEBPACK_IMPORTED_MODULE_7__.Z(dashboards,{keys:["key","name","description","tags"],threshold:.3}).search(searchTerm).map(result=>result.item):dashboards]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions,props}=_ref4;return{setSceneDashboardChoice:async _ref5=>{let{dashboardId}=_ref5;props.scene===scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.ProjectHomepage?(actions.updateCurrentTeam({primary_dashboard:null!=dashboardId?dashboardId:null}),posthog_js__WEBPACK_IMPORTED_MODULE_1__.ZP.capture("primary dashboard changed")):(actions.setUserScenePersonalisation(props.scene,null!=dashboardId?dashboardId:0),posthog_js__WEBPACK_IMPORTED_MODULE_1__.ZP.capture("scene dashboard choice set",{scene:props.scene,dashboardId:dashboardId}))},showSceneDashboardChoiceModal:async()=>{props.scene===scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.ProjectHomepage?posthog_js__WEBPACK_IMPORTED_MODULE_1__.ZP.capture("primary dashboard modal opened"):posthog_js__WEBPACK_IMPORTED_MODULE_1__.ZP.capture("scene dashboard choice modal opened",{scene:props.scene})}}})])},"../../frontend/src/scenes/new-tab/NewTabScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{NewTabScene:()=>NewTabScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),SceneDashboardChoiceModal=__webpack_require__("../../frontend/src/lib/components/SceneDashboardChoice/SceneDashboardChoiceModal.tsx"),sceneDashboardChoiceModalLogic=__webpack_require__("../../frontend/src/lib/components/SceneDashboardChoice/sceneDashboardChoiceModalLogic.ts"),ScrollableShadows=__webpack_require__("../../frontend/src/lib/components/ScrollableShadows/ScrollableShadows.tsx"),ButtonPrimitives=__webpack_require__("../../frontend/src/lib/ui/Button/ButtonPrimitives.tsx"),ListBox=__webpack_require__("../../frontend/src/lib/ui/ListBox/ListBox.tsx"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),tabAwareActionToUrl=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareActionToUrl.ts"),tabAwareUrlToAction=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareUrlToAction.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),getAppContext=__webpack_require__("../../frontend/src/lib/utils/getAppContext.ts"),GroupActorDisplay=__webpack_require__("../../frontend/src/scenes/persons/GroupActorDisplay.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),defaultTree=__webpack_require__("../../frontend/src/layout/panel-layout/ProjectTree/defaultTree.tsx"),ProjectTree_utils=__webpack_require__("../../frontend/src/layout/panel-layout/ProjectTree/utils.tsx"),groupsModel=__webpack_require__("../../frontend/src/models/groupsModel.ts"),types=__webpack_require__("../../frontend/src/types.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let NEW_TAB_COMMANDS_ITEMS=[{value:"all",displayName:"All"},{value:"create-new",displayName:"Create new"},{value:"apps",displayName:"Apps"},{value:"data-management",displayName:"Data management"},{value:"recents",displayName:"Recents files"},{value:"persons",displayName:"Persons"},{value:"groups",displayName:"Groups"},{value:"eventDefinitions",displayName:"Events"},{value:"propertyDefinitions",displayName:"Properties"},{value:"askAI",displayName:"Posthog AI"}];function getIconForFileSystemItem(fs){return"icon"in fs&&fs.icon?(0,jsx_runtime.jsx)(defaultTree.ee,{type:fs.type,colorOverride:fs.iconColor,children:fs.icon}):(0,defaultTree.PO)("iconType"in fs?fs.iconType:fs.type,fs.iconColor)}let sortByLastViewedAt=items=>items.map((item,originalIndex)=>({item,originalIndex})).toSorted((a,b)=>{let parseTime=value=>{if(!value)return 0;let parsed=Date.parse(value);return Number.isFinite(parsed)?parsed:0},diff=parseTime(b.item.lastViewedAt)-parseTime(a.item.lastViewedAt);return 0!==diff?diff:a.originalIndex-b.originalIndex}).map(_ref=>{let{item}=_ref;return item});function matchesRecentsSearch(entry,searchChunks){var _entry$type$toLowerCa;if(0===searchChunks.length)return!0;let nameLower=((0,ProjectTree_utils.uo)(entry.path).pop()||entry.path).toLowerCase(),typeLower=null!==(_entry$type$toLowerCa=entry.type?.toLowerCase())&&void 0!==_entry$type$toLowerCa?_entry$type$toLowerCa:"";return searchChunks.every(chunk=>nameLower.includes(chunk)||typeLower.includes(chunk)||"recents".includes(chunk))}let newTabSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","new-tab","newTabSceneLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(()=>({values:[featureFlagLogic.featureFlagLogic,["featureFlags"],groupsModel.$,["groupTypes","aggregationLabel"]]})),(0,index_esm.key)(props=>props.tabId||"default"),(0,index_esm.actions)({setSearch:search=>({search}),selectNext:!0,selectPrevious:!0,onSubmit:!0,setSelectedCategory:category=>({category}),loadRecents:options=>{var _options$offset;return{offset:null!==(_options$offset=options?.offset)&&void 0!==_options$offset?_options$offset:0}},loadMoreRecents:!0,debouncedPersonSearch:searchTerm=>({searchTerm}),debouncedEventDefinitionSearch:searchTerm=>({searchTerm}),debouncedPropertyDefinitionSearch:searchTerm=>({searchTerm}),debouncedGroupSearch:searchTerm=>({searchTerm}),setNewTabSceneDataInclude:include=>({include}),toggleNewTabSceneDataInclude:item=>({item}),triggerSearchForIncludedItems:!0,refreshDataAfterToggle:!0,showMoreInSection:section=>({section}),setSectionItemLimit:(section,limit)=>({section,limit}),resetSectionLimits:!0,askAI:searchTerm=>({searchTerm}),logCreateNewItem:href=>({href}),loadInitialGroups:!0,setFirstNoResultsSearchPrefix:(dataset,prefix)=>({dataset,prefix})}),(0,kea_loaders_lib.loaders)(_ref2=>{let{values,actions}=_ref2;return{sceneLogViews:[[],{loadSceneLogViews:async()=>await api.ZP.fileSystemLogView.list({type:"scene"})}],newLogViews:[[],{loadNewLogViews:async()=>await api.ZP.fileSystemLogView.list({type:"create-new"})}],recents:[()=>{if("sessionStorage"in window)try{let value=window.sessionStorage.getItem(`newTab-recentItems-${(0,getAppContext.ev)()}`),recents=value?JSON.parse(value):null;if(recents)return recents}catch{}return{results:[],hasMore:!1,startTime:null,endTime:null}},{loadRecents:async(_ref3,breakpoint)=>{let{offset}=_ref3;values.recentsLoading&&await breakpoint(250);let searchTerm=values.search.trim(),noResultsPrefix=values.firstNoResultsSearchPrefixes.recents,requestedOffset=null!=offset?offset:0,isAppending=requestedOffset>0&&values.recents.searchTerm===searchTerm&&values.recents.results.length>0,effectiveOffset=isAppending?requestedOffset:0;if(0===effectiveOffset&&searchTerm&&noResultsPrefix&&searchTerm.length>noResultsPrefix.length&&searchTerm.startsWith(noResultsPrefix))return{searchTerm,results:[],hasMore:!1,lastCount:0};let pageLimit=0===effectiveOffset?5:10,response=await api.ZP.fileSystem.list({search:searchTerm,limit:pageLimit+1,orderBy:"-last_viewed_at",notType:"folder",offset:effectiveOffset});breakpoint();let searchChunks=searchTerm.toLowerCase().split(" ").filter(s=>s),filteredCount=searchTerm?response.results.filter(item=>matchesRecentsSearch(item,searchChunks)).length:response.results.length,newResults=response.results.slice(0,pageLimit),combinedResults=isAppending&&values.recents.searchTerm===searchTerm?[...values.recents.results,...newResults]:newResults,recents={searchTerm,results:combinedResults,hasMore:response.results.length>pageLimit,lastCount:newResults.length};if(0===effectiveOffset&&(searchTerm?actions.setFirstNoResultsSearchPrefix("recents",0===filteredCount?searchTerm:null):actions.setFirstNoResultsSearchPrefix("recents",null)),"sessionStorage"in window&&""===searchTerm&&0===effectiveOffset)try{window.sessionStorage.setItem(`newTab-recentItems-${(0,getAppContext.ev)()}`,JSON.stringify(recents))}catch{}return recents}}],personSearchResults:[[],{loadPersonSearchResults:async(_ref4,breakpoint)=>{let{searchTerm}=_ref4;if(""===searchTerm.trim())return[];let response=await api.ZP.persons.list({search:searchTerm.trim(),limit:5});return breakpoint(),response.results},loadInitialPersons:async(_,breakpoint)=>{let response=await api.ZP.persons.list({limit:5});return breakpoint(),actions.setFirstNoResultsSearchPrefix("persons",null),response.results}}],eventDefinitionSearchResults:[[],{loadEventDefinitionSearchResults:async(_ref5,breakpoint)=>{var _response$results;let{searchTerm}=_ref5,trimmed=searchTerm.trim();await breakpoint(200);let response=await api.ZP.eventDefinitions.list({search:trimmed||void 0,limit:5});return breakpoint(),null!==(_response$results=response.results)&&void 0!==_response$results?_response$results:[]},loadInitialEventDefinitions:async(_,breakpoint)=>{var _response$results2;let response=await api.ZP.eventDefinitions.list({limit:5});return breakpoint(),actions.setFirstNoResultsSearchPrefix("eventDefinitions",null),null!==(_response$results2=response.results)&&void 0!==_response$results2?_response$results2:[]}}],propertyDefinitionSearchResults:[[],{loadPropertyDefinitionSearchResults:async(_ref6,breakpoint)=>{var _response$results3;let{searchTerm}=_ref6,trimmed=searchTerm.trim();await breakpoint(200);let response=await api.ZP.propertyDefinitions.list({search:trimmed||void 0,limit:5});return breakpoint(),null!==(_response$results3=response.results)&&void 0!==_response$results3?_response$results3:[]},loadInitialPropertyDefinitions:async(_,breakpoint)=>{var _response$results4;let response=await api.ZP.propertyDefinitions.list({limit:5});return breakpoint(),actions.setFirstNoResultsSearchPrefix("propertyDefinitions",null),null!==(_response$results4=response.results)&&void 0!==_response$results4?_response$results4:[]}}],groupSearchResults:[{},{loadGroupSearchResults:async(_ref7,breakpoint)=>{let{searchTerm}=_ref7,trimmed=searchTerm.trim();if(""===trimmed)return actions.setFirstNoResultsSearchPrefix("groups",null),{};let noResultsPrefix=values.firstNoResultsSearchPrefixes.groups;if(trimmed&&noResultsPrefix&&trimmed.length>noResultsPrefix.length&&trimmed.startsWith(noResultsPrefix))return{};let groupTypesList=Array.from(values.groupTypes.values());if(0===groupTypesList.length)return actions.setFirstNoResultsSearchPrefix("groups",null),{};await breakpoint(200);let responses=await Promise.all(groupTypesList.map(groupType=>api.ZP.groups.list({group_type_index:groupType.group_type_index,search:trimmed,limit:5})));breakpoint();let resultEntries=responses.map((response,index)=>{var _response$results5;return[groupTypesList[index].group_type_index,(null!==(_response$results5=response.results)&&void 0!==_response$results5?_response$results5:[]).slice(0,5)]}),combinedResultsCount=resultEntries.reduce((count,_ref8)=>{let[,groupResults]=_ref8;return count+groupResults.length},0);return trimmed&&0===combinedResultsCount&&actions.setFirstNoResultsSearchPrefix("groups",trimmed),Object.fromEntries(resultEntries)},loadInitialGroups:async(_,breakpoint)=>{let groupTypesList=Array.from(values.groupTypes.values());if(0===groupTypesList.length)return{};await breakpoint(200);let responses=await Promise.all(groupTypesList.map(groupType=>api.ZP.groups.list({group_type_index:groupType.group_type_index,search:"",limit:5})));return breakpoint(),actions.setFirstNoResultsSearchPrefix("groups",null),Object.fromEntries(responses.map((response,index)=>[groupTypesList[index].group_type_index,response.results.slice(0,5)]))}}]}}),(0,index_esm.reducers)({search:["",{setSearch:(_,_ref9)=>{let{search}=_ref9;return search}}],selectedCategory:["all",{setSelectedCategory:(_,_ref10)=>{let{category}=_ref10;return category}}],newTabSceneDataInclude:[["all"],{setNewTabSceneDataInclude:(_,_ref11)=>{let{include}=_ref11;return include},toggleNewTabSceneDataInclude:(state,_ref12)=>{let{item}=_ref12;if("all"===item)return state.includes("all")?state.filter(i=>"all"!==i):["all"];if(state.includes(item)){let newState=state.filter(i=>i!==item);return 0===newState.length?["all"]:newState}return[...state.filter(i=>"all"!==i),item]}}],personSearchPending:[!1,{debouncedPersonSearch:()=>!0,loadPersonSearchResults:()=>!1,loadPersonSearchResultsSuccess:()=>!1,loadPersonSearchResultsFailure:()=>!1}],eventDefinitionSearchPending:[!1,{debouncedEventDefinitionSearch:()=>!0,loadEventDefinitionSearchResults:()=>!1,loadEventDefinitionSearchResultsSuccess:()=>!1,loadEventDefinitionSearchResultsFailure:()=>!1}],propertyDefinitionSearchPending:[!1,{debouncedPropertyDefinitionSearch:()=>!0,loadPropertyDefinitionSearchResults:()=>!1,loadPropertyDefinitionSearchResultsSuccess:()=>!1,loadPropertyDefinitionSearchResultsFailure:()=>!1}],groupSearchPending:[!1,{debouncedGroupSearch:()=>!0,loadGroupSearchResults:()=>!1,loadGroupSearchResultsSuccess:()=>!1,loadGroupSearchResultsFailure:()=>!1}],rawSelectedIndex:[0,{selectNext:state=>state+1,selectPrevious:state=>state-1,setSearch:()=>0,setSelectedCategory:()=>0}],sectionItemLimits:[{},{showMoreInSection:(state,_ref13)=>{var _state$section;let{section}=_ref13;return{...state,[section]:"recents"===section?null!==(_state$section=state[section])&&void 0!==_state$section?_state$section:5:1/0}},setSectionItemLimit:(state,_ref14)=>{let{section,limit}=_ref14;return{...state,[section]:limit}},resetSectionLimits:()=>({}),setSearch:()=>({}),toggleNewTabSceneDataInclude:()=>({})}],firstNoResultsSearchPrefixes:[{recents:null,persons:null,groups:null,eventDefinitions:null,propertyDefinitions:null},{setFirstNoResultsSearchPrefix:(state,_ref15)=>{let{dataset,prefix}=_ref15;return{...state,[dataset]:prefix}},setSearch:(state,_ref16)=>{let{search}=_ref16;return""===search.trim()?{recents:null,persons:null,groups:null,eventDefinitions:null,propertyDefinitions:null}:state}}]}),(0,index_esm.selectors)(_ref17=>{let{actions}=_ref17;return{sceneLogViewsByRef:[s=>[s.sceneLogViews],sceneLogViews=>sceneLogViews.reduce((acc,_ref18)=>{let{ref,viewed_at}=_ref18,current=acc[ref];return(!current||Date.parse(viewed_at)>Date.parse(current))&&(acc[ref]=viewed_at),acc},{})],newLogViewsByRef:[s=>[s.newLogViews],newLogViews=>newLogViews.reduce((acc,_ref19)=>{let{ref,viewed_at}=_ref19,current=acc[ref];return(!current||Date.parse(viewed_at)>Date.parse(current))&&(acc[ref]=viewed_at),acc},{})],isSearching:[s=>[s.recentsLoading,s.personSearchResultsLoading,s.personSearchPending,s.eventDefinitionSearchResultsLoading,s.eventDefinitionSearchPending,s.propertyDefinitionSearchResultsLoading,s.propertyDefinitionSearchPending,s.groupSearchResultsLoading,s.groupSearchPending,s.search],(recentsLoading,personSearchResultsLoading,personSearchPending,eventDefinitionSearchResultsLoading,eventDefinitionSearchPending,propertyDefinitionSearchResultsLoading,propertyDefinitionSearchPending,groupSearchResultsLoading,groupSearchPending,search)=>(recentsLoading||personSearchResultsLoading||personSearchPending||eventDefinitionSearchResultsLoading||eventDefinitionSearchPending||propertyDefinitionSearchResultsLoading||propertyDefinitionSearchPending||groupSearchResultsLoading||groupSearchPending)&&""!==search.trim()],categoryLoadingStates:[s=>[s.recentsLoading,s.personSearchResultsLoading,s.personSearchPending,s.eventDefinitionSearchResultsLoading,s.eventDefinitionSearchPending,s.propertyDefinitionSearchResultsLoading,s.propertyDefinitionSearchPending,s.groupSearchResultsLoading,s.groupSearchPending],(recentsLoading,personSearchResultsLoading,personSearchPending,eventDefinitionSearchResultsLoading,eventDefinitionSearchPending,propertyDefinitionSearchResultsLoading,propertyDefinitionSearchPending,groupSearchResultsLoading,groupSearchPending)=>({all:!1,"create-new":!1,apps:!1,"data-management":!1,recents:recentsLoading,persons:personSearchResultsLoading||personSearchPending,groups:groupSearchResultsLoading||groupSearchPending,eventDefinitions:eventDefinitionSearchResultsLoading||eventDefinitionSearchPending,propertyDefinitions:propertyDefinitionSearchResultsLoading||propertyDefinitionSearchPending,askAI:!1})],projectTreeSearchItems:[s=>[s.recents],recents=>recents.results.map(item=>{var _item$last_viewed_at;let name=(0,ProjectTree_utils.uo)(item.path).pop();return{id:item.path,name:name||item.path,category:"recents",href:item.href||"#",lastViewedAt:null!==(_item$last_viewed_at=item.last_viewed_at)&&void 0!==_item$last_viewed_at?_item$last_viewed_at:null,icon:getIconForFileSystemItem({type:item.type,iconType:item.type,path:item.path}),record:item}})],personSearchItems:[s=>[s.personSearchResults],personSearchResults=>personSearchResults.map(person=>{let personId=person.distinct_ids?.[0]||person.uuid||"unknown",displayName=person.properties?.email||personId;return{id:`person-${person.uuid}`,name:`${displayName}`,category:"persons",href:urls.j.personByUUID(person.uuid||""),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPerson,{}),record:{type:"person",path:`Person: ${displayName}`,href:urls.j.personByUUID(person.uuid||"")}}})],eventDefinitionSearchItems:[s=>[s.eventDefinitionSearchResults],eventDefinitionSearchResults=>eventDefinitionSearchResults.map(eventDef=>({id:`event-definition-${eventDef.id}`,name:eventDef.name,category:"eventDefinitions",href:urls.j.eventDefinition(eventDef.id),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconApps,{}),record:{type:"event-definition",path:`Event: ${eventDef.name}`,href:urls.j.eventDefinition(eventDef.id)}}))],propertyDefinitionSearchItems:[s=>[s.propertyDefinitionSearchResults],propertyDefinitionSearchResults=>propertyDefinitionSearchResults.map(propDef=>({id:`property-definition-${propDef.id}`,name:propDef.name,category:"propertyDefinitions",href:urls.j.propertyDefinition(propDef.id),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconApps,{}),record:{type:"property-definition",path:`Property: ${propDef.name}`,href:urls.j.propertyDefinition(propDef.id)}}))],groupSearchItems:[s=>[s.groupSearchResults,s.aggregationLabel],(groupSearchResults,aggregationLabel)=>{let items=[];for(let[groupTypeIndexString,groups]of Object.entries(groupSearchResults)){let groupTypeIndex=parseInt(groupTypeIndexString,10),noun=aggregationLabel(groupTypeIndex).singular;groups.forEach(group=>{let display=(0,GroupActorDisplay.O)(group.group_key,group.group_properties||{}),href=urls.j.group(groupTypeIndex,group.group_key);items.push({id:`group-${groupTypeIndex}-${group.group_key}`,name:`${noun}: ${display}`,displayName:display,category:"groups",href,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPeople,{}),record:{type:"group",path:`${noun}: ${display}`,href,groupTypeIndex,groupKey:group.group_key,groupNoun:noun,groupDisplayName:display}})})}return items}],aiSearchItems:[s=>[s.search],search=>{let searchTerm=search.trim(),items=[],askDirectQuestionToAiItem={id:"ask-ai",name:searchTerm?`Ask: ${searchTerm}`:"Ask Posthog AI anything...",category:"askAI",href:urls.j.max(void 0,searchTerm),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconSparkles,{}),record:{type:"ai",path:searchTerm?`Ask Posthog AI: ${searchTerm}`:"Ask Posthog AI",href:"#",searchTerm:searchTerm||"",onClick:()=>actions.askAI(searchTerm)}},openAiInTabItem={id:"open-ai",name:"Open",category:"askAI",href:urls.j.max(void 0,void 0),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowRight,{}),record:{type:"ai",path:"Open",href:"#",searchTerm:""}};return searchTerm&&items.push(askDirectQuestionToAiItem),items.push(openAiInTabItem),items}],getSectionItemLimit:[s=>[s.sectionItemLimits,s.newTabSceneDataInclude],(sectionItemLimits,newTabSceneDataInclude)=>{let singleSelectedCategory=1===newTabSceneDataInclude.length&&"all"!==newTabSceneDataInclude[0]?newTabSceneDataInclude[0]:null;return section=>{let manualLimit=sectionItemLimits[section];return void 0!==manualLimit?manualLimit:singleSelectedCategory&&section===singleSelectedCategory?15:5}}],itemsGrid:[s=>[s.featureFlags,s.projectTreeSearchItems,s.aiSearchItems,s.sceneLogViewsByRef,s.newLogViewsByRef],(featureFlags,projectTreeSearchItems,aiSearchItems,sceneLogViewsByRef,newLogViewsByRef)=>{let registerSceneKey=(map,key,sceneKey)=>{!(!key||!sceneKey||map.has(key))&&map.set(key,sceneKey)},sceneKeyByType=new Map,getSceneKeyForFs=fs=>{if(fs.sceneKey)return fs.sceneKey;if(fs.type){let direct=sceneKeyByType.get(fs.type);if(direct)return direct;let baseType=fs.type.split("/")?.[0];if(baseType){let base=sceneKeyByType.get(baseType);if(base)return base}}if("iconType"in fs&&fs.iconType){let fromIcon=sceneKeyByType.get(fs.iconType);if(fromIcon)return fromIcon}return null},getLastViewedAt=sceneKey=>{var _sceneLogViewsByRef$s;return sceneKey&&null!==(_sceneLogViewsByRef$s=sceneLogViewsByRef[sceneKey])&&void 0!==_sceneLogViewsByRef$s?_sceneLogViewsByRef$s:null},getLastViewedAtForHref=href=>{var _newLogViewsByRef$hre;return href&&null!==(_newLogViewsByRef$hre=newLogViewsByRef[href])&&void 0!==_newLogViewsByRef$hre?_newLogViewsByRef$hre:null},defaultProducts=(0,defaultTree.UC)(),defaultData=(0,defaultTree.T7)();defaultProducts.forEach(fs=>{fs.sceneKey&&(registerSceneKey(sceneKeyByType,fs.type,fs.sceneKey),fs.type?.includes("/")&&registerSceneKey(sceneKeyByType,fs.type.split("/")[0],fs.sceneKey),"iconType"in fs&&registerSceneKey(sceneKeyByType,fs.iconType,fs.sceneKey))}),defaultData.forEach(fs=>{fs.sceneKey&&(registerSceneKey(sceneKeyByType,fs.type,fs.sceneKey),fs.type?.includes("/")&&registerSceneKey(sceneKeyByType,fs.type.split("/")[0],fs.sceneKey),"iconType"in fs&&registerSceneKey(sceneKeyByType,fs.iconType,fs.sceneKey))});let newInsightItems=(0,defaultTree.eq)().filter(_ref20=>{let{path}=_ref20;return path.startsWith("Insight/")}).map((fs,index)=>({id:`new-insight-${index}`,name:"New "+fs.path.substring(8),category:"create-new",href:fs.href,flag:fs.flag,icon:getIconForFileSystemItem(fs),record:fs,lastViewedAt:getLastViewedAtForHref(fs.href)})).filter(_ref21=>{let{flag}=_ref21;return!flag||featureFlags[flag]}),newDataItems=(0,defaultTree.eq)().filter(_ref22=>{let{path}=_ref22;return path.startsWith("Data/")}).map((fs,index)=>({id:`new-data-${index}`,name:"New "+(0,utils.fm)(fs.path.substring(5).toLowerCase()),category:"create-new",href:fs.href,flag:fs.flag,icon:getIconForFileSystemItem(fs),record:fs,lastViewedAt:getLastViewedAtForHref(fs.href)})).filter(_ref23=>{let{flag}=_ref23;return!flag||featureFlags[flag]}),newOtherItems=(0,defaultTree.eq)().filter(_ref24=>{let{path}=_ref24;return!path.startsWith("Insight/")&&!path.startsWith("Data/")}).map((fs,index)=>({id:`new-other-${index}`,name:"New "+fs.path,category:"create-new",href:fs.href,flag:fs.flag,icon:getIconForFileSystemItem(fs),record:fs,lastViewedAt:getLastViewedAtForHref(fs.href)})).filter(_ref25=>{let{flag}=_ref25;return!flag||featureFlags[flag]}),sortedProducts=sortByLastViewedAt([...[...defaultProducts,...(0,defaultTree.We)()].map((fs,index)=>({id:`product-${index}`,name:fs.path,category:"apps",href:fs.href,flag:fs.flag,icon:getIconForFileSystemItem(fs),record:fs,lastViewedAt:getLastViewedAt(getSceneKeyForFs(fs))})).filter(_ref26=>{let{flag}=_ref26;return!flag||featureFlags[flag]}).toSorted((a,b)=>a.name.localeCompare(b.name)),{id:"product-activity",name:"Activity",category:"apps",href:urls.j.activity(types.ZO.ExploreEvents),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconActivity,{}),record:{type:"link",path:"Activity",href:urls.j.activity(types.ZO.ExploreEvents)},lastViewedAt:getLastViewedAtForHref(urls.j.activity(types.ZO.ExploreEvents))}]),sortedData=sortByLastViewedAt([...defaultData.map((fs,index)=>({id:`data-${index}`,name:fs.path,category:"data-management",href:fs.href,flag:fs.flag,icon:getIconForFileSystemItem(fs),record:fs})).filter(_ref27=>{let{flag}=_ref27;return!flag||featureFlags[flag]}),{id:"data-settings",name:"Project settings",category:"data-management",href:urls.j.settings(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),record:{type:"link",path:"Project settings",href:urls.j.settings()},lastViewedAt:getLastViewedAtForHref(urls.j.settings())},{id:"data-toolbar",name:"Toolbar",category:"data-management",href:urls.j.toolbarLaunch(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconToolbar,{}),record:{type:"link",path:"Toolbar",href:urls.j.toolbarLaunch()},lastViewedAt:getLastViewedAtForHref(urls.j.toolbarLaunch())}]),sortedNewInsightItems=sortByLastViewedAt(newInsightItems),sortedNewDataItems=sortByLastViewedAt(newDataItems),sortedNewOtherItems=sortByLastViewedAt(newOtherItems);return sortByLastViewedAt([...aiSearchItems,...projectTreeSearchItems,{id:"new-sql-query",name:"New SQL query",category:"create-new",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDatabase,{}),href:"/sql",record:{type:"query",path:"New SQL query"},lastViewedAt:getLastViewedAtForHref("/sql")},...sortedNewInsightItems,...sortedNewOtherItems,...sortedProducts,...sortedData,...sortedNewDataItems,{id:"new-hog-program",name:"New Hog program",category:"create-new",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconHogQL,{}),href:"/debug/hog",record:{type:"hog",path:"New Hog program"},lastViewedAt:getLastViewedAtForHref("/debug/hog")}])}],filteredItemsGrid:[s=>[s.itemsGrid,s.search,s.selectedCategory],(itemsGrid,search,selectedCategory)=>{let filtered=itemsGrid;if("all"!==selectedCategory&&(filtered=filtered.filter(item=>item.category===selectedCategory)),!String(search).trim())return filtered;let lowerSearchChunks=search.toLowerCase().split(" ").map(s=>s.trim()).filter(s=>s);return filtered.filter(item=>0===lowerSearchChunks.filter(lowerSearch=>!`${item.category} ${item.name}`.toLowerCase().includes(lowerSearch)).length)}],groupedFilteredItems:[s=>[s.filteredItemsGrid],filteredItemsGrid=>filteredItemsGrid.reduce((acc,item)=>(acc[item.category]||(acc[item.category]=[]),acc[item.category].push(item),acc),{})],newTabSceneDataGroupedItems:[s=>[s.itemsGrid,s.search,s.newTabSceneDataInclude,s.personSearchItems,s.groupSearchItems,s.eventDefinitionSearchItems,s.propertyDefinitionSearchItems,s.aiSearchItems,s.getSectionItemLimit],(itemsGrid,search,newTabSceneDataInclude,personSearchItems,groupSearchItems,eventDefinitionSearchItems,propertyDefinitionSearchItems,aiSearchItems,getSectionItemLimit)=>{let searchLower=search.toLowerCase().trim(),filterBySearch=items=>{if(!searchLower)return items;let searchChunks=searchLower.split(" ").filter(s=>s);return items.filter(item=>searchChunks.every(chunk=>item.name.toLowerCase().includes(chunk)||item.category.toLowerCase().includes(chunk)||item.record?.type?.toLowerCase().includes(chunk)))},showAll=newTabSceneDataInclude.includes("all"),filteredPersonItems=filterBySearch(personSearchItems),filteredGroupItems=filterBySearch(groupSearchItems),filteredEventDefinitionItems=filterBySearch(eventDefinitionSearchItems),filteredPropertyDefinitionItems=filterBySearch(propertyDefinitionSearchItems),filteredAiSearchItems=filterBySearch(aiSearchItems),grouped={};if(showAll||newTabSceneDataInclude.includes("persons")){let limit=getSectionItemLimit("persons");grouped.persons=filteredPersonItems.slice(0,limit)}if(showAll||newTabSceneDataInclude.includes("groups")){let limit=getSectionItemLimit("groups");grouped.groups=filteredGroupItems.slice(0,limit)}if(showAll||newTabSceneDataInclude.includes("eventDefinitions")){let limit=getSectionItemLimit("eventDefinitions");grouped.eventDefinitions=filteredEventDefinitionItems.slice(0,limit)}if(showAll||newTabSceneDataInclude.includes("propertyDefinitions")){let limit=getSectionItemLimit("propertyDefinitions");grouped.propertyDefinitions=filteredPropertyDefinitionItems.slice(0,limit)}if(showAll||newTabSceneDataInclude.includes("create-new")){let limit=getSectionItemLimit("create-new");grouped["create-new"]=sortByLastViewedAt(filterBySearch(itemsGrid.filter(item=>"create-new"===item.category))).slice(0,limit)}if(showAll||newTabSceneDataInclude.includes("apps")){let limit=getSectionItemLimit("apps");grouped.apps=sortByLastViewedAt(filterBySearch(itemsGrid.filter(item=>"apps"===item.category))).slice(0,limit)}if(showAll||newTabSceneDataInclude.includes("data-management")){let limit=getSectionItemLimit("data-management");grouped["data-management"]=sortByLastViewedAt(filterBySearch(itemsGrid.filter(item=>"data-management"===item.category))).slice(0,limit)}if(showAll||newTabSceneDataInclude.includes("recents")){let limit=getSectionItemLimit("recents");grouped.recents=filterBySearch(itemsGrid.filter(item=>"recents"===item.category)).slice(0,limit)}if(showAll||newTabSceneDataInclude.includes("askAI")){let limit=getSectionItemLimit("askAI");grouped.askAI=filteredAiSearchItems.slice(0,limit)}return grouped}],newTabSceneDataGroupedItemsFullData:[s=>[s.itemsGrid,s.search,s.newTabSceneDataInclude,s.personSearchItems,s.groupSearchItems,s.eventDefinitionSearchItems,s.propertyDefinitionSearchItems,s.aiSearchItems],(itemsGrid,search,newTabSceneDataInclude,personSearchItems,groupSearchItems,eventDefinitionSearchItems,propertyDefinitionSearchItems,aiSearchItems)=>{let searchLower=search.toLowerCase().trim(),filterBySearch=items=>{if(!searchLower)return items;let searchChunks=searchLower.split(" ").filter(s=>s);return items.filter(item=>searchChunks.every(chunk=>item.name.toLowerCase().includes(chunk)||item.category.toLowerCase().includes(chunk)))},showAll=newTabSceneDataInclude.includes("all"),filteredPersonItems=filterBySearch(personSearchItems),filteredGroupItems=filterBySearch(groupSearchItems),filteredEventDefinitionItems=filterBySearch(eventDefinitionSearchItems),filteredPropertyDefinitionItems=filterBySearch(propertyDefinitionSearchItems),filteredAiSearchItems=filterBySearch(aiSearchItems),fullCounts={};return(showAll||newTabSceneDataInclude.includes("persons"))&&(fullCounts.persons=filteredPersonItems.length),(showAll||newTabSceneDataInclude.includes("groups"))&&(fullCounts.groups=filteredGroupItems.length),(showAll||newTabSceneDataInclude.includes("eventDefinitions"))&&(fullCounts.eventDefinitions=filteredEventDefinitionItems.length),(showAll||newTabSceneDataInclude.includes("propertyDefinitions"))&&(fullCounts.propertyDefinitions=filteredPropertyDefinitionItems.length),(showAll||newTabSceneDataInclude.includes("create-new"))&&(fullCounts["create-new"]=filterBySearch(itemsGrid.filter(item=>"create-new"===item.category)).length),(showAll||newTabSceneDataInclude.includes("apps"))&&(fullCounts.apps=filterBySearch(itemsGrid.filter(item=>"apps"===item.category)).length),(showAll||newTabSceneDataInclude.includes("data-management"))&&(fullCounts["data-management"]=filterBySearch(itemsGrid.filter(item=>"data-management"===item.category)).length),(showAll||newTabSceneDataInclude.includes("recents"))&&(fullCounts.recents=filterBySearch(itemsGrid.filter(item=>"recents"===item.category)).length),(showAll||newTabSceneDataInclude.includes("askAI"))&&(fullCounts.askAI=filteredAiSearchItems.length),fullCounts}],allCategories:[s=>[s.newTabSceneDataGroupedItems,s.newTabSceneDataInclude,s.categoryLoadingStates,s.search,s.firstNoResultsSearchPrefixes],(newTabSceneDataGroupedItems,newTabSceneDataInclude,categoryLoadingStates,search,firstNoResultsSearchPrefixes)=>{let orderedSections=[],showAll=newTabSceneDataInclude.includes("all");["recents","create-new","apps","data-management"].forEach(section=>{(showAll||newTabSceneDataInclude.includes(section))&&orderedSections.push(section)}),(showAll||newTabSceneDataInclude.includes("persons"))&&orderedSections.push("persons"),(showAll||newTabSceneDataInclude.includes("groups"))&&orderedSections.push("groups"),(showAll||newTabSceneDataInclude.includes("eventDefinitions"))&&orderedSections.push("eventDefinitions"),(showAll||newTabSceneDataInclude.includes("propertyDefinitions"))&&orderedSections.push("propertyDefinitions"),(showAll||newTabSceneDataInclude.includes("askAI"))&&orderedSections.push("askAI");let trimmedSearch=search.trim(),hasPrefixNoResults=dataset=>{let prefix=firstNoResultsSearchPrefixes[dataset];return!!prefix&&""!==trimmedSearch&&trimmedSearch.length>prefix.length&&trimmedSearch.startsWith(prefix)},[categoriesWithResults,emptyCategories]=orderedSections.map(section=>{let items=newTabSceneDataGroupedItems[section]||[],isLoading=categoryLoadingStates[section]||!1,shouldHideForPrefix="recents"===section&&hasPrefixNoResults("recents")||"persons"===section&&hasPrefixNoResults("persons")||"eventDefinitions"===section&&hasPrefixNoResults("eventDefinitions")||"propertyDefinitions"===section&&hasPrefixNoResults("propertyDefinitions");return{key:section,items,isLoading:!shouldHideForPrefix&&isLoading,shouldHideForPrefix}}).filter(_ref28=>{let{items,isLoading,shouldHideForPrefix}=_ref28;return!showAll||!shouldHideForPrefix&&(items.length>0||isLoading)}).map(_ref29=>{let{shouldHideForPrefix,...rest}=_ref29;return rest}).reduce((acc,category)=>(0===category.items.length?acc[1].push(category):acc[0].push(category),acc),[[],[]]);return[...categoriesWithResults,...emptyCategories]}],firstCategoryWithResults:[s=>[s.allCategories],allCategories=>{for(let{key,items}of allCategories)if(items.length>0)return key;return null}],selectedIndex:[s=>[s.rawSelectedIndex,s.filteredItemsGrid],(rawSelectedIndex,filteredItemsGrid)=>0===filteredItemsGrid.length?null:(rawSelectedIndex%filteredItemsGrid.length+filteredItemsGrid.length)%filteredItemsGrid.length],selectedItem:[s=>[s.selectedIndex,s.filteredItemsGrid],(selectedIndex,filteredItemsGrid)=>null!==selectedIndex&&selectedIndex<filteredItemsGrid.length?filteredItemsGrid[selectedIndex]:null]}}),(0,index_esm.listeners)(_ref30=>{let{actions,values}=_ref30;return{loadMoreRecents:()=>{if(values.recentsLoading)return;let currentLimit=values.getSectionItemLimit("recents");Number.isFinite(currentLimit)&&actions.setSectionItemLimit("recents",currentLimit+10),values.recents.hasMore&&actions.loadRecents({offset:values.recents.results.length})},logCreateNewItem:async _ref31=>{let{href}=_ref31;if(href){try{await api.ZP.fileSystemLogView.create({type:"create-new",ref:href})}catch(error){console.error("Failed to log create new item usage:",error)}actions.loadNewLogViews()}},triggerSearchForIncludedItems:()=>{let searchTerm=values.search.trim();(values.newTabSceneDataInclude.includes("all")?["persons","groups","eventDefinitions","propertyDefinitions","askAI"]:values.newTabSceneDataInclude).forEach(item=>{""!==searchTerm?"persons"===item?actions.debouncedPersonSearch(searchTerm):"groups"===item?actions.debouncedGroupSearch(searchTerm):"eventDefinitions"===item?actions.debouncedEventDefinitionSearch(searchTerm):"propertyDefinitions"===item&&actions.debouncedPropertyDefinitionSearch(searchTerm):"persons"===item?actions.loadInitialPersons({}):"groups"===item?actions.loadInitialGroups():"eventDefinitions"===item?actions.loadInitialEventDefinitions({}):"propertyDefinitions"===item&&actions.loadInitialPropertyDefinitions({})})},onSubmit:()=>{let selected=values.selectedItem;selected&&("askAI"===selected.category&&selected.record?.searchTerm?actions.askAI(selected.record.searchTerm):selected.href&&("create-new"===selected.category&&actions.logCreateNewItem(selected.href),lib.router.actions.push(selected.href)))},setSearch:()=>{actions.loadRecents(),actions.triggerSearchForIncludedItems()},toggleNewTabSceneDataInclude:_ref32=>{let{item}=_ref32;values.newTabSceneDataInclude.includes(item)?(actions.setSelectedCategory("all"),"persons"===item?actions.loadPersonSearchResultsSuccess([]):"eventDefinitions"===item?actions.loadEventDefinitionSearchResultsSuccess([]):"propertyDefinitions"===item?actions.loadPropertyDefinitionSearchResultsSuccess([]):"groups"===item&&actions.loadGroupSearchResultsSuccess({})):actions.setSelectedCategory(item)},setNewTabSceneDataInclude:()=>{actions.triggerSearchForIncludedItems()},refreshDataAfterToggle:()=>{actions.triggerSearchForIncludedItems()},debouncedPersonSearch:async(_ref33,breakpoint)=>{let{searchTerm}=_ref33,trimmed=searchTerm.trim(),noResultsPrefix=values.firstNoResultsSearchPrefixes.persons;if(trimmed&&noResultsPrefix&&trimmed.length>noResultsPrefix.length&&trimmed.startsWith(noResultsPrefix)){actions.loadPersonSearchResultsSuccess([]);return}await breakpoint(300);try{let response=await api.ZP.persons.list({search:trimmed,limit:5});breakpoint(),actions.loadPersonSearchResultsSuccess(response.results),trimmed&&actions.setFirstNoResultsSearchPrefix("persons",0===response.results.length?trimmed:null)}catch(error){(0,index_esm.isBreakpoint)(error)||(console.error("Person search failed:",error),actions.loadPersonSearchResultsFailure(error))}},debouncedEventDefinitionSearch:async(_ref34,breakpoint)=>{let{searchTerm}=_ref34,trimmed=searchTerm.trim(),noResultsPrefix=values.firstNoResultsSearchPrefixes.eventDefinitions;if(trimmed&&noResultsPrefix&&trimmed.length>noResultsPrefix.length&&trimmed.startsWith(noResultsPrefix)){actions.loadEventDefinitionSearchResultsSuccess([]);return}await breakpoint(300);try{var _response$results6,_response$results7;let response=await api.ZP.eventDefinitions.list({search:trimmed,limit:5});breakpoint(),actions.loadEventDefinitionSearchResultsSuccess(null!==(_response$results6=response.results)&&void 0!==_response$results6?_response$results6:[]),trimmed&&actions.setFirstNoResultsSearchPrefix("eventDefinitions",0===(null!==(_response$results7=response.results)&&void 0!==_response$results7?_response$results7:[]).length?trimmed:null)}catch(error){(0,index_esm.isBreakpoint)(error)||(console.error("Event definition search failed:",error),actions.loadEventDefinitionSearchResultsFailure(error))}},debouncedPropertyDefinitionSearch:async(_ref35,breakpoint)=>{let{searchTerm}=_ref35,trimmed=searchTerm.trim(),noResultsPrefix=values.firstNoResultsSearchPrefixes.propertyDefinitions;if(trimmed&&noResultsPrefix&&trimmed.length>noResultsPrefix.length&&trimmed.startsWith(noResultsPrefix)){actions.loadPropertyDefinitionSearchResultsSuccess([]);return}await breakpoint(300);try{var _response$results8,_response$results9;let response=await api.ZP.propertyDefinitions.list({search:trimmed,limit:5});breakpoint(),actions.loadPropertyDefinitionSearchResultsSuccess(null!==(_response$results8=response.results)&&void 0!==_response$results8?_response$results8:[]),trimmed&&actions.setFirstNoResultsSearchPrefix("propertyDefinitions",0===(null!==(_response$results9=response.results)&&void 0!==_response$results9?_response$results9:[]).length?trimmed:null)}catch(error){(0,index_esm.isBreakpoint)(error)||(console.error("Property definition search failed:",error),actions.loadPropertyDefinitionSearchResultsFailure(error))}},debouncedGroupSearch:async(_ref36,breakpoint)=>{let{searchTerm}=_ref36,trimmed=searchTerm.trim(),noResultsPrefix=values.firstNoResultsSearchPrefixes.groups;if(trimmed&&noResultsPrefix&&trimmed.length>noResultsPrefix.length&&trimmed.startsWith(noResultsPrefix)){actions.loadGroupSearchResultsSuccess({});return}await breakpoint(300),actions.loadGroupSearchResults({searchTerm})}}}),(0,tabAwareActionToUrl.N)(_ref37=>{let{values}=_ref37,buildParams=()=>{let includeItems=values.newTabSceneDataInclude.filter(item=>"all"!==item),includeParam=includeItems.length>0?includeItems.join(","):void 0;return{search:values.search||void 0,category:void 0,include:includeParam}};return{setSearch:()=>[lib.router.values.location.pathname,buildParams()],setSelectedCategory:()=>[lib.router.values.location.pathname,buildParams()],setNewTabSceneDataInclude:()=>[lib.router.values.location.pathname,buildParams()],toggleNewTabSceneDataInclude:()=>[lib.router.values.location.pathname,buildParams()]}}),(0,tabAwareUrlToAction.O)(_ref38=>{let{actions,values}=_ref38;return{[urls.j.newTab()]:(_,searchParams)=>{if(searchParams.search&&searchParams.search!==values.search&&(actions.setSearch(String(searchParams.search)),values.newTabSceneDataInclude.length>0)){let searchTerm=String(searchParams.search).trim();""!==searchTerm&&(values.newTabSceneDataInclude.includes("all")?["persons","groups","eventDefinitions","propertyDefinitions"]:values.newTabSceneDataInclude).forEach(item=>{"persons"===item?actions.debouncedPersonSearch(searchTerm):"groups"===item?actions.debouncedGroupSearch(searchTerm):"eventDefinitions"===item?actions.debouncedEventDefinitionSearch(searchTerm):"propertyDefinitions"===item&&actions.debouncedPropertyDefinitionSearch(searchTerm)})}let includeFromUrlRaw=searchParams.include?searchParams.include.split(",").filter(item=>["all","create-new","apps","data-management","recents","persons","groups","eventDefinitions","propertyDefinitions","askAI"].includes(item)):null;if(null!==includeFromUrlRaw&&values.newTabSceneDataInclude.slice().sort().join(",")!==includeFromUrlRaw.slice().sort().join(",")){actions.setNewTabSceneDataInclude(includeFromUrlRaw);let searchTerm=searchParams.search?String(searchParams.search).trim():"";(includeFromUrlRaw.includes("all")?["persons","groups","eventDefinitions","propertyDefinitions","askAI"]:includeFromUrlRaw).forEach(item=>{""!==searchTerm?"persons"===item?actions.debouncedPersonSearch(searchTerm):"groups"===item?actions.debouncedGroupSearch(searchTerm):"eventDefinitions"===item?actions.debouncedEventDefinitionSearch(searchTerm):"propertyDefinitions"===item&&actions.debouncedPropertyDefinitionSearch(searchTerm):"persons"===item?actions.loadInitialPersons({}):"groups"===item?actions.loadInitialGroups():"eventDefinitions"===item?actions.loadInitialEventDefinitions({}):"propertyDefinitions"===item&&actions.loadInitialPropertyDefinitions({})})}!searchParams.search&&values.search&&actions.setSearch(""),(searchParams.include||1===values.newTabSceneDataInclude.length)&&(searchParams.include||values.newTabSceneDataInclude.includes("all"))||actions.setNewTabSceneDataInclude(["all"])}}}),(0,index_esm.afterMount)(_ref39=>{let{actions,values}=_ref39;actions.loadSceneLogViews(),actions.loadNewLogViews(),actions.loadRecents(),values.newTabSceneDataInclude.includes("all")&&(actions.loadInitialPersons({}),actions.loadInitialGroups(),actions.loadInitialEventDefinitions({}),actions.loadInitialPropertyDefinitions({}))})]);var sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),ContextMenu=__webpack_require__("../../frontend/src/lib/ui/ContextMenu/ContextMenu.tsx"),DropdownMenu=__webpack_require__("../../frontend/src/lib/ui/DropdownMenu/DropdownMenu.tsx"),Label=__webpack_require__("../../frontend/src/lib/ui/Label/Label.tsx"),WrappingLoadingSkeleton=__webpack_require__("../../frontend/src/lib/ui/WrappingLoadingSkeleton/WrappingLoadingSkeleton.tsx"),SearchHighlight=__webpack_require__("../../frontend/src/layout/navigation-3000/components/SearchHighlight.tsx"),MenuItems=__webpack_require__("../../frontend/src/layout/panel-layout/ProjectTree/menus/MenuItems.tsx");function NoResultsFound(_ref){let{handleAskAi}=_ref,{setSearch}=(0,index_esm.useActions)(newTabSceneLogic);return(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-4 px-2 py-2 bg-glass-bg-3000 rounded-lg",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsxs)("p",{className:"text-tertiary mb-2",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})," No results found"]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-1",children:[(0,jsx_runtime.jsxs)(ListBox.w.Item,{asChild:!0,className:"list-none",children:[(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{size:"sm",onClick:()=>setSearch(""),variant:"panel",children:"Clear search"})," "]}),"or"," ",(0,jsx_runtime.jsx)(ListBox.w.Item,{asChild:!0,children:(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{size:"sm",onClick:()=>handleAskAi(),variant:"panel",children:"Ask Posthog AI"})})]})]})})}let getCategoryDisplayName=category=>({"create-new":"Create new",apps:"Apps","data-management":"Data management",recents:"Recents",persons:"Persons",groups:"Groups",eventDefinitions:"Events",propertyDefinitions:"Properties",askAI:"Posthog AI"})[category]||category,formatRelativeTimeShort=date=>{if(!date)return"";let parsedDate=(0,dayjs.Bv)(date);if(!parsedDate.isValid())return"";let now=(0,dayjs.Bv)();if(60>Math.max(0,now.diff(parsedDate,"second")))return"just now";let minutes=now.diff(parsedDate,"minute");if(minutes<60)return`${minutes} min ago`;let hours=now.diff(parsedDate,"hour");if(hours<24)return`${hours} hr${1===hours?"":"s"} ago`;let days=now.diff(parsedDate,"day");if(days<30)return`${days} day${1===days?"":"s"} ago`;let months=now.diff(parsedDate,"month")||1;if(months<12)return`${months} mo${1===months?"":"s"} ago`;let years=now.diff(parsedDate,"year")||1;return`${years} yr${1===years?"":"s"} ago`};function convertToTreeDataItem(item){return{...item,record:{...item.record,href:item.href,path:item.name}}}function Category(_ref){let{tabId,items,category,columnIndex,isFirstCategoryWithResults,isLoading}=_ref,groupRef=(0,react.useRef)(null),pendingFocusIndexRef=(0,react.useRef)(null),isFirstCategory=0===columnIndex,{filteredItemsGrid,search,newTabSceneDataGroupedItemsFullData,getSectionItemLimit,newTabSceneDataInclude,recents,recentsLoading}=(0,index_esm.useValues)(newTabSceneLogic({tabId})),{showMoreInSection,logCreateNewItem,loadMoreRecents}=(0,index_esm.useActions)(newTabSceneLogic({tabId})),{groupTypes}=(0,index_esm.useValues)(groupsModel.$),previousRecentsLoadingRef=(0,react.useRef)(recentsLoading);return(0,react.useEffect)(()=>{let wasLoading=previousRecentsLoadingRef.current;if(previousRecentsLoadingRef.current=recentsLoading,"recents"!==category){pendingFocusIndexRef.current=null;return}if(wasLoading&&!recentsLoading&&null!==pendingFocusIndexRef.current){let indexToFocus=pendingFocusIndexRef.current;pendingFocusIndexRef.current=null;let restoreFocus=()=>{groupRef.current?.resumeFocus(indexToFocus)||setTimeout(()=>{groupRef.current?.resumeFocus(indexToFocus)},50)};"function"==typeof requestAnimationFrame?requestAnimationFrame(restoreFocus):setTimeout(restoreFocus,0)}},[category,recentsLoading]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-0 @xl/main-content:flex @xl/main-content:flex-row @xl/main-content:gap-x-4",children:[(0,jsx_runtime.jsx)("div",{className:"mb-2 @xl/main-content:min-w-[200px]",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-baseline gap-0",children:[(0,jsx_runtime.jsx)(Label._,{intent:"menu",className:"px-2",children:getCategoryDisplayName(category)}),isLoading&&(0,jsx_runtime.jsx)(src.$j,{size:"small"}),!["persons","groups","eventDefinitions","propertyDefinitions"].includes(category)&&0===items.length&&!newTabSceneDataInclude.includes("all")&&(0,jsx_runtime.jsx)(src.oe,{className:"text-xs text-tertiary",size:"small",children:"No results found"})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col @xl/main-content:grow min-w-0 empty:hidden gap-1",children:[0===items.length?"recents"===category&&isLoading?(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-2 text-tertiary text-balance",children:(0,jsx_runtime.jsx)(WrappingLoadingSkeleton.x,{children:(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{size:"sm",children:"Loading items..."})})}):null:(0,jsx_runtime.jsxs)(ListBox.w.Group,{ref:groupRef,groupId:`category-${category}`,children:[items.map((item,index)=>{var _ref2,_item$lastViewedAt,_item$icon;let isCreateNew="create-new"===item.category,focusFirst=isFirstCategoryWithResults&&0===index||filteredItemsGrid.length>0&&isFirstCategory&&0===index,lastViewedAt=null!==(_ref2=null!==(_item$lastViewedAt=item.lastViewedAt)&&void 0!==_item$lastViewedAt?_item$lastViewedAt:item.record?.last_viewed_at)&&void 0!==_ref2?_ref2:null,record=item.record,groupNoun="groups"===item.category?record?.groupNoun||item.name.split(":")[0]:null,groupDisplayName="groups"===item.category?"string"==typeof item.displayName?item.displayName:item.name.split(":").slice(1).join(":").trim():null,highlightText=text=>search?(0,jsx_runtime.jsx)(SearchHighlight.r,{string:text,substring:search}):text;return(0,jsx_runtime.jsxs)(ButtonPrimitives.HL,{className:"group w-full border-0",children:[(0,jsx_runtime.jsxs)(ContextMenu.xV,{children:[(0,jsx_runtime.jsx)(ContextMenu.W4,{asChild:!0,children:(0,jsx_runtime.jsx)(ListBox.w.Item,{asChild:!0,focusFirst:focusFirst,row:index,column:columnIndex,focusKey:item.id,index:index,children:(0,jsx_runtime.jsxs)(Link.r,{to:item.href||"#",className:"w-full",buttonProps:{size:"sm",hasSideActionRight:!0},onClick:e=>{e.preventDefault(),item.href&&(isCreateNew&&logCreateNewItem(item.href),lib.router.actions.push(item.href))},children:[(0,jsx_runtime.jsx)("span",{className:"text-sm",children:null!==(_item$icon=item.icon)&&void 0!==_item$icon?_item$icon:item.name[0]}),(0,jsx_runtime.jsxs)("span",{className:"flex min-w-0 items-center gap-2",children:[groupNoun?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:"text-sm truncate text-primary",children:highlightText(groupDisplayName&&groupDisplayName.length>0?groupDisplayName:item.name)}),(0,jsx_runtime.jsx)(src.oe,{size:"small",type:"muted",className:"shrink-0",children:highlightText((0,utils.fm)(groupNoun.trim()))})]}):(0,jsx_runtime.jsx)("span",{className:"text-sm truncate text-primary",children:search?(0,jsx_runtime.jsx)(SearchHighlight.r,{string:item.name,substring:search}):item.displayName||item.name}),lastViewedAt?(0,jsx_runtime.jsx)("span",{className:"text-xs text-muted whitespace-nowrap",children:formatRelativeTimeShort(lastViewedAt)}):null]})]})})}),(0,jsx_runtime.jsx)(ContextMenu.h_,{loop:!0,className:"max-w-[250px]",children:(0,jsx_runtime.jsx)(ContextMenu.Xl,{children:(0,jsx_runtime.jsx)(MenuItems.s,{item:convertToTreeDataItem(item),type:"context",root:"project://",onlyTree:!1,showSelectMenuOption:!1})})})]}),(0,jsx_runtime.jsxs)(DropdownMenu.h_,{children:[(0,jsx_runtime.jsx)(DropdownMenu.$F,{asChild:!0,children:(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{size:"xs",iconOnly:!0,isSideActionRight:!0,className:"opacity-0 group-hover:opacity-100 group-has-[button[data-state=open]]:opacity-100 mt-px",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{className:"size-3"})})}),(0,jsx_runtime.jsx)(DropdownMenu.AW,{loop:!0,align:"end",side:"bottom",className:"max-w-[250px]",children:(0,jsx_runtime.jsx)(DropdownMenu.Qk,{children:(0,jsx_runtime.jsx)(MenuItems.s,{item:convertToTreeDataItem(item),type:"dropdown",root:"project://",onlyTree:!1,showSelectMenuOption:!1})})})]})]},item.id)}),(()=>{let currentLimit=getSectionItemLimit(category),fullCount=newTabSceneDataGroupedItemsFullData[category]||0,isRecentsSection="recents"===category;return(isRecentsSection&&recents.hasMore||fullCount>currentLimit)&&(0,jsx_runtime.jsx)(ListBox.w.Item,{asChild:!0,focusKey:`show-all-${category}`,index:items.length,children:(0,jsx_runtime.jsxs)(ButtonPrimitives.hL,{size:"sm",disabled:isRecentsSection&&recentsLoading,onClick:()=>{let showAllIndex=items.length;isRecentsSection?(pendingFocusIndexRef.current=showAllIndex,loadMoreRecents()):(showMoreInSection(category),setTimeout(()=>{groupRef.current?.resumeFocus(showAllIndex)},0))},className:"w-full text-tertiary data-[focused=true]:text-primary",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowRight,{className:"rotate-90"}),isRecentsSection?" Load more...":` Show all (${fullCount-currentLimit} more)`]})})})()]}),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["persons"===category&&(0,jsx_runtime.jsx)(ListBox.w.Item,{asChild:!0,children:(0,jsx_runtime.jsxs)(Link.r,{to:urls.j.persons(),buttonProps:{size:"sm",className:"w-full text-tertiary data-[focused=true]:text-primary"},children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{})," See all persons"]})}),"eventDefinitions"===category&&(0,jsx_runtime.jsx)(ListBox.w.Item,{asChild:!0,children:(0,jsx_runtime.jsxs)(Link.r,{to:urls.j.eventDefinitions(),buttonProps:{size:"sm",className:"w-full text-tertiary data-[focused=true]:text-primary"},children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{})," See all events"]})}),"groups"===category&&groupTypes.size>0&&(0,jsx_runtime.jsx)(ListBox.w.Item,{asChild:!0,children:(0,jsx_runtime.jsxs)(Link.r,{to:urls.j.groups(Array.from(groupTypes.keys())[0]),buttonProps:{size:"sm",className:"w-full text-tertiary data-[focused=true]:text-primary"},children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{})," See all groups"]})}),"propertyDefinitions"===category&&(0,jsx_runtime.jsx)(ListBox.w.Item,{asChild:!0,children:(0,jsx_runtime.jsxs)(Link.r,{to:urls.j.propertyDefinitions(),buttonProps:{size:"sm",className:"w-full text-tertiary data-[focused=true]:text-primary"},children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{})," See all properties"]})})]})]})]},category),(0,jsx_runtime.jsx)("div",{className:"h-px w-full bg-border-primary"})]})}function Results(_ref3){let{tabId,listboxRef,handleAskAi}=_ref3,{search,isSearching,newTabSceneDataInclude,allCategories,firstCategoryWithResults}=(0,index_esm.useValues)(newTabSceneLogic({tabId})),hasResults=allCategories.some(category=>category.items.length>0),shouldShowGlobalNoResults=newTabSceneDataInclude.includes("all")&&""!==search.trim()&&!hasResults&&!isSearching;return(0,react.useEffect)(()=>{!isSearching&&hasResults&&firstCategoryWithResults&&listboxRef.current?.focusFirstItem()},[isSearching,hasResults,firstCategoryWithResults,listboxRef]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[allCategories.map((_ref4,columnIndex)=>{let{key:category,items,isLoading}=_ref4;return(0,jsx_runtime.jsx)(Category,{tabId:tabId,items:items,category:category,columnIndex:columnIndex,isFirstCategoryWithResults:category===firstCategoryWithResults,isLoading:isLoading},category)}),shouldShowGlobalNoResults&&(0,jsx_runtime.jsx)(NoResultsFound,{handleAskAi:handleAskAi})]})}var icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),TextInputPrimitive=__webpack_require__("../../frontend/src/lib/ui/TextInputPrimitive/TextInputPrimitive.tsx"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),KeyboardShortcut=__webpack_require__("../../frontend/src/layout/navigation-3000/components/KeyboardShortcut.tsx");let SearchInput=(0,react.forwardRef)(function SearchInput(_ref,ref){let{commands,placeholder="Type / to see commands...",value="",onChange,onCommandSelect,selectedCommands=[],onSelectedCommandsChange,activeCommands=[],onClearAll}=_ref,[inputValue,setInputValue]=(0,react.useState)(value),[showDropdown,setShowDropdown]=(0,react.useState)(!1),[filteredCommands,setFilteredCommands]=(0,react.useState)(commands),inputRef=(0,react.useRef)(null),[focusedTagIndex,setFocusedTagIndex]=(0,react.useState)(null),[expandedTags,setExpandedTags]=(0,react.useState)(!1);(0,react.useImperativeHandle)(ref,()=>({focus:()=>{inputRef.current&&inputRef.current.focus()},getInputRef:()=>inputRef}),[]),(0,react.useEffect)(()=>{setInputValue(value)},[value]),(0,react.useEffect)(()=>{setFilteredCommands(commands)},[commands]);let handleInputChange=newValue=>{if(setInputValue(newValue),onChange?.(newValue),null!==focusedTagIndex&&setFocusedTagIndex(null),expandedTags&&setExpandedTags(!1),"/"===newValue)setFilteredCommands(commands),setShowDropdown(!0);else if(showDropdown&&newValue.startsWith("/")&&newValue.length>1){let searchTerm=newValue.substring(1).toLowerCase();setFilteredCommands(commands.filter(cmd=>cmd.displayName.toLowerCase().includes(searchTerm)))}else showDropdown&&!newValue.startsWith("/")&&setShowDropdown(!1)},selectCommand=command=>{let newSelectedCommands=selectedCommands.some(cmd=>cmd.value===command.value)?selectedCommands.filter(cmd=>cmd.value!==command.value):[...selectedCommands,command];onSelectedCommandsChange?.(newSelectedCommands),onCommandSelect?.(command),inputValue.startsWith("/")&&(setInputValue(""),onChange?.("")),setExpandedTags(!1),setFocusedTagIndex(null),setShowDropdown(!1),setTimeout(()=>{inputRef.current&&inputRef.current.focus()},150)};return(0,jsx_runtime.jsx)("div",{className:"relative w-full",children:(0,jsx_runtime.jsxs)("div",{className:(0,css_classes.cn)((0,TextInputPrimitive.G)({variant:"default",size:"lg"}),"flex gap-1 focus-within:border-secondary items-center h-8 rounded-lg"),children:[(0,jsx_runtime.jsxs)(DropdownMenu.h_,{open:showDropdown,onOpenChange:open=>{setShowDropdown(open)},children:[(0,jsx_runtime.jsx)(DropdownMenu.$F,{asChild:!0,children:(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{variant:"outline",className:`ml-[calc(var(--button-padding-x-sm)+1px)] font-mono text-tertiary ${-1===focusedTagIndex?"ring-2 ring-accent":""}`,iconOnly:!0,size:"sm",tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Click to show commands/filters, or type ",(0,jsx_runtime.jsx)(KeyboardShortcut.e,{forwardslash:!0})]}),tooltipPlacement:"bottom",children:"/"})}),(0,jsx_runtime.jsx)(DropdownMenu.AW,{align:"start",className:"min-w-[200px]",onCloseAutoFocus:e=>{e.preventDefault(),setTimeout(()=>{inputRef.current&&inputRef.current.focus()},100)},children:(0,jsx_runtime.jsxs)(DropdownMenu.Qk,{children:[(0,jsx_runtime.jsx)(Label._,{intent:"menu",className:"px-2",children:"Filters"}),(0,jsx_runtime.jsx)(DropdownMenu.VD,{}),filteredCommands.map(command=>{let isActive=activeCommands.includes(command.value);return(0,jsx_runtime.jsx)(DropdownMenu.Xi,{asChild:!0,children:(0,jsx_runtime.jsxs)(ButtonPrimitives.hL,{className:"group flex items-center text-left",onClick:()=>selectCommand(command),fullWidth:!0,menuItem:!0,children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-center",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{className:(0,css_classes.cn)("hidden size-4 group-hover:block group-hover:opacity-10",{"opacity-10":!isActive,"block text-success group-hover:opacity-100":isActive})}),(0,jsx_runtime.jsx)(icons.R1,{className:(0,css_classes.cn)("hidden size-4 group-hover:hidden",{block:!isActive})})]}),(0,jsx_runtime.jsx)("div",{className:"font-medium text-primary",children:command.displayName})]})},command.value)})]})})]}),0===selectedCommands.length?null:1===selectedCommands.length||expandedTags?selectedCommands.map((command,index)=>(0,jsx_runtime.jsxs)(ButtonPrimitives.hL,{className:`text-primary ${focusedTagIndex===index?"ring-2 ring-accent":""}`,size:"sm",variant:"outline",onClick:()=>{selectCommand(command),setShowDropdown(!1),setExpandedTags(!1),setFocusedTagIndex(null)},children:[command.displayName,(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{className:"size-3 ml-1 text-tertiary"})]},command.value)):(0,jsx_runtime.jsxs)(ButtonPrimitives.hL,{className:"text-primary",size:"sm",variant:"outline",onClick:()=>setShowDropdown(!0),children:[selectedCommands.length," filters",(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronRight,{className:"ml-1 rotate-90 text-tertiary"})]}),(0,jsx_runtime.jsx)(TextInputPrimitive.w,{id:"command-input",ref:inputRef,value:inputValue,onChange:e=>handleInputChange(e.target.value),onKeyDown:e=>{switch(e.key){case"/":if(!showDropdown&&""===inputValue){e.preventDefault(),setFilteredCommands(commands),setShowDropdown(!0);return}break;case"Backspace":""===inputValue&&(e.preventDefault(),e.stopPropagation(),0===selectedCommands.length?setShowDropdown(!0):expandedTags?null!==focusedTagIndex&&(selectCommand(selectedCommands[focusedTagIndex]),setExpandedTags(!1),setFocusedTagIndex(null)):(setExpandedTags(!0),setFocusedTagIndex(selectedCommands.length-1)));break;case"ArrowLeft":let cursorPosition=inputRef.current?.selectionStart||0;""===inputValue?(e.preventDefault(),e.stopPropagation(),0===selectedCommands.length?setShowDropdown(!0):!expandedTags&&selectedCommands.length>0?(setExpandedTags(!0),setFocusedTagIndex(selectedCommands.length-1)):expandedTags&&null!==focusedTagIndex&&(focusedTagIndex>0?setFocusedTagIndex(focusedTagIndex-1):setFocusedTagIndex(-1))):""!==inputValue&&0===cursorPosition&&(e.preventDefault(),e.stopPropagation(),setExpandedTags(!0),setFocusedTagIndex(-1),setShowDropdown(!0));break;case"ArrowRight":""===inputValue&&expandedTags&&null!==focusedTagIndex&&(e.preventDefault(),e.stopPropagation(),-1===focusedTagIndex?setFocusedTagIndex(0):focusedTagIndex<selectedCommands.length-1?setFocusedTagIndex(focusedTagIndex+1):(setFocusedTagIndex(null),setExpandedTags(!1)));break;case"Enter":""===inputValue&&expandedTags&&null!==focusedTagIndex&&(e.preventDefault(),e.stopPropagation(),-1===focusedTagIndex?setShowDropdown(!0):(selectCommand(selectedCommands[focusedTagIndex]),setExpandedTags(!1),setFocusedTagIndex(null)));break;case"ArrowDown":""===inputValue&&expandedTags&&-1===focusedTagIndex&&(e.preventDefault(),e.stopPropagation(),setShowDropdown(!0));break;case"Escape":(showDropdown||expandedTags)&&(e.preventDefault(),e.stopPropagation(),setExpandedTags(!1),setFocusedTagIndex(null),setShowDropdown(!1))}},placeholder:placeholder,autoFocus:!0,autoComplete:"off",className:"pl-1 w-full border-none flex-1 h-full min-h-full rounded-r-lg",size:"lg",suffix:(""!==inputValue||selectedCommands.length>0)&&(0,jsx_runtime.jsx)(ListBox.w.Item,{asChild:!0,children:(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{iconOnly:!0,onClick:()=>{setInputValue(""),onChange?.(""),setExpandedTags(!1),setFocusedTagIndex(null),setShowDropdown(!1),onClearAll?.(),inputRef.current?.focus()},"aria-label":"Clear input and filters",size:"sm",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{})})})})]})})}),scene={component:NewTabScene,logic:newTabSceneLogic};function NewTabScene(){let{tabId,source}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},commandInputRef=(0,react.useRef)(null),listboxRef=(0,react.useRef)(null),{search,newTabSceneDataInclude}=(0,index_esm.useValues)(newTabSceneLogic({tabId})),{setSearch,toggleNewTabSceneDataInclude,refreshDataAfterToggle}=(0,index_esm.useActions)(newTabSceneLogic({tabId})),{showSceneDashboardChoiceModal}=(0,index_esm.useActions)((0,sceneDashboardChoiceModalLogic.F)({scene:sceneTypes.x.ProjectHomepage})),selectedCommands=newTabSceneDataInclude.filter(commandValue=>"all"!==commandValue).map(commandValue=>NEW_TAB_COMMANDS_ITEMS.find(cmd=>cmd.value===commandValue)||{value:commandValue,displayName:commandValue});return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)(ListBox.w,{ref:listboxRef,className:"w-full grid grid-rows-[auto_1fr] flex-col h-[calc(100vh-var(--scene-layout-header-height))]",virtualFocus:!0,autoSelectFirst:!0,children:[(0,jsx_runtime.jsx)("div",{className:"sr-only",children:(0,jsx_runtime.jsx)("p",{children:"Welcome to the new tab, type / to see commands... or type a search term, you can navigate all interactive elements with the keyboard"})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"px-2 @lg/main-content:px-8 pt-2 @lg/main-content:pt-8 mx-auto w-full max-w-[1200px] ",children:(0,jsx_runtime.jsx)(SearchInput,{ref:commandInputRef,commands:NEW_TAB_COMMANDS_ITEMS,value:search,onChange:value=>{"/"!==value&&setSearch(value)},placeholder:"Search or ask an AI question",activeCommands:newTabSceneDataInclude,selectedCommands:selectedCommands,onCommandSelect:command=>{"all"===command.value?newTabSceneDataInclude.includes("all")?newTabSceneDataInclude.forEach(selectedCommand=>{toggleNewTabSceneDataInclude(selectedCommand)}):toggleNewTabSceneDataInclude("all"):toggleNewTabSceneDataInclude(command.value),refreshDataAfterToggle()},onClearAll:()=>{newTabSceneDataInclude.forEach(command=>{toggleNewTabSceneDataInclude(command)}),refreshDataAfterToggle()}})}),(0,jsx_runtime.jsx)("div",{className:"border-b",children:(0,jsx_runtime.jsx)("div",{className:"max-w-[1200px] mx-auto w-full px-2 @lg/main-content:px-10 pb-2",children:(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-x-2 gap-y-2 flex-wrap",children:"homepage"===source?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{size:"xxs","data-attr":"project-home-customize-homepage",className:"ml-auto text-xs",onClick:showSceneDashboardChoiceModal,children:"Customize homepage"}),(0,jsx_runtime.jsx)(SceneDashboardChoiceModal.q,{scene:sceneTypes.x.ProjectHomepage})]}):null})})})]}),(0,jsx_runtime.jsx)(ScrollableShadows.D,{direction:"vertical",className:"flex flex-col gap-4 overflow-auto h-full",innerClassName:"pt-4",styledScrollbars:!0,children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col flex-1 max-w-[1200px] mx-auto w-full gap-4 px-4 @lg/main-content:px-8 group/colorful-product-icons colorful-product-icons-true",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-2 mb-32",children:(0,jsx_runtime.jsx)(Results,{tabId:tabId||"",listboxRef:listboxRef,handleAskAi:question=>{let nextQuestion=(null!=question?question:search).trim();lib.router.actions.push(urls.j.max(void 0,nextQuestion))}})})})})]})})}}}]);