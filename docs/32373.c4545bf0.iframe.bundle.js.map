{"version":3,"file":"32373.c4545bf0.iframe.bundle.js","mappings":";AAwCA;AAAA;AASA;AAAA;AAuBA;AAOA;AACA;AACA;AACA;AACA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://@posthog/storybook/../../products/endpoints/frontend/endpoint-tabs/EndpointPlayground.tsx"],"sourcesContent":["import { useActions, useValues } from 'kea'\nimport { useEffect } from 'react'\n\nimport { LemonButton, LemonDivider, LemonLabel, LemonSelect } from '@posthog/lemon-ui'\n\nimport { CodeSnippet, Language } from 'lib/components/CodeSnippet'\nimport { LemonField } from 'lib/lemon-ui/LemonField'\nimport { IconPlayCircle } from 'lib/lemon-ui/icons'\nimport { CodeEditorInline } from 'lib/monaco/CodeEditorInline'\n\nimport { SceneSection } from '~/layout/scenes/components/SceneSection'\nimport { EndpointType } from '~/types'\n\nimport { CodeExampleTab, endpointLogic } from '../endpointLogic'\nimport { endpointSceneLogic, generateEndpointPayload } from '../endpointSceneLogic'\n\ninterface EndpointPlaygroundProps {\n    tabId: string\n}\n\nfunction formatPayloadForCodeExample(payload: Record<string, any>): string {\n    const entries = Object.entries(payload)\n    if (entries.length === 0) {\n        return ''\n    }\n\n    return entries\n        .map(([key, value], index) => {\n            const isLast = index === entries.length - 1\n            const comma = isLast ? '' : ','\n\n            // Format nested objects\n            if (typeof value === 'object' && value !== null && Object.keys(value).length === 0) {\n                return `    \"${key}\": {}${comma}  // Add ${key} here`\n            }\n\n            // Format variables specially\n            if (key === 'variables' && typeof value === 'object') {\n                const varEntries = Object.entries(value)\n                if (varEntries.length === 0) {\n                    return `    \"${key}\": {\\n      // No variables defined\\n    }${comma}`\n                }\n                const formattedVars = varEntries\n                    .map(([varKey, varValue], varIndex) => {\n                        const isLastVar = varIndex === varEntries.length - 1\n                        const varComma = isLastVar ? '' : ','\n                        return `      \"${varKey}\": ${JSON.stringify(varValue)}${varComma}`\n                    })\n                    .join('\\n')\n                return `    \"${key}\": {\\n${formattedVars}\\n    }${comma}`\n            }\n\n            return `    \"${key}\": ${JSON.stringify(value, null, 2).replace(/\\n/g, '\\n    ')}${comma}`\n        })\n        .join('\\n')\n}\n\nfunction getEndpointUrl(endpointPath: string): string {\n    return `${window.location.origin}${endpointPath}`\n}\n\nfunction generateTerminalExample(endpoint: EndpointType, selectedVersion: number | null): string {\n    const payload = generateEndpointPayload(endpoint)\n    const hasPayload = Object.keys(payload).length > 0\n    const versionParam =\n        selectedVersion !== null && selectedVersion !== endpoint.current_version\n            ? `    \"version\": ${selectedVersion}`\n            : ''\n\n    // If no payload and no version, omit the -d flag entirely\n    if (!hasPayload && !versionParam) {\n        return `curl -X POST ${getEndpointUrl(endpoint.endpoint_path)} \\\\\n  -H \"Authorization: Bearer $POSTHOG_PERSONAL_API_KEY\"`\n    }\n\n    const payloadBody = formatPayloadForCodeExample(payload)\n    const dataContent = [payloadBody, versionParam].filter(Boolean).join(',\\n')\n\n    return `curl -X POST ${getEndpointUrl(endpoint.endpoint_path)} \\\\\n  -H \"Authorization: Bearer $POSTHOG_PERSONAL_API_KEY\" \\\\\n  -H \"Content-Type: application/json\" \\\\\n  -d '{\n${dataContent}\n  }'`\n}\n\nfunction generatePythonExample(endpoint: EndpointType, selectedVersion: number | null): string {\n    const payload = generateEndpointPayload(endpoint)\n    const hasPayload = Object.keys(payload).length > 0\n    const versionParam =\n        selectedVersion !== null && selectedVersion !== endpoint.current_version\n            ? `    \"version\": ${selectedVersion}`\n            : ''\n\n    // If no payload and no version, omit payload variable entirely\n    if (!hasPayload && !versionParam) {\n        return `import requests\n\nurl = \"${getEndpointUrl(endpoint.endpoint_path)}\"\n\nheaders = {\n    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'\n}\n\nresponse = requests.post(url, headers=headers)\nprint(response.json())`\n    }\n\n    const payloadBody = formatPayloadForCodeExample(payload)\n    const dataContent = [payloadBody, versionParam].filter(Boolean).join(',\\n')\n\n    return `import requests\nimport json\n\nurl = \"${getEndpointUrl(endpoint.endpoint_path)}\"\n\nheaders = {\n    'Content-Type': 'application/json',\n    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'\n}\n\npayload = {\n${dataContent}\n}\n\nresponse = requests.post(url, headers=headers, data=json.dumps(payload))\nprint(response.json())`\n}\n\nfunction generateNodeExample(endpoint: EndpointType, selectedVersion: number | null): string {\n    const payload = generateEndpointPayload(endpoint)\n    const hasPayload = Object.keys(payload).length > 0\n    const versionParam =\n        selectedVersion !== null && selectedVersion !== endpoint.current_version\n            ? `    \"version\": ${selectedVersion}`\n            : ''\n\n    // If no payload and no version, omit payload variable and body entirely\n    if (!hasPayload && !versionParam) {\n        return `const fetch = require('node-fetch');\n\nconst url = '${getEndpointUrl(endpoint.endpoint_path)}';\n\nconst headers = {\n    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'\n};\n\nfetch(url, {\n    method: 'POST',\n    headers: headers\n})\n.then(response => response.json())\n.then(data => console.log(data))\n.catch(error => console.error('Error:', error));`\n    }\n\n    const payloadBody = formatPayloadForCodeExample(payload)\n    const dataContent = [payloadBody, versionParam].filter(Boolean).join(',\\n')\n\n    return `const fetch = require('node-fetch');\n\nconst url = '${getEndpointUrl(endpoint.endpoint_path)}';\n\nconst headers = {\n    'Content-Type': 'application/json',\n    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'\n};\n\nconst payload = {\n${dataContent}\n};\n\nfetch(url, {\n    method: 'POST',\n    headers: headers,\n    body: JSON.stringify(payload)\n})\n.then(response => response.json())\n.then(data => console.log(data))\n.catch(error => console.error('Error:', error));`\n}\n\nexport function EndpointPlayground({ tabId }: EndpointPlaygroundProps): JSX.Element {\n    const { endpoint } = useValues(endpointLogic({ tabId }))\n    const { payloadJson, endpointResult, endpointResultLoading } = useValues(endpointSceneLogic({ tabId }))\n    const { setPayloadJson, loadEndpointResult } = useActions(endpointSceneLogic({ tabId }))\n    const { setActiveCodeExampleTab, setSelectedCodeExampleVersion } = useActions(endpointLogic({ tabId }))\n    const { activeCodeExampleTab, selectedCodeExampleVersion } = useValues(endpointLogic({ tabId }))\n\n    const handleExecute = (): void => {\n        if (!endpoint?.name) {\n            return\n        }\n\n        let data: any = {}\n        try {\n            data = payloadJson && payloadJson.trim() !== '' ? JSON.parse(payloadJson) : {}\n        } catch (error) {\n            console.error('Invalid JSON:', error)\n            return\n        }\n\n        loadEndpointResult({ name: endpoint.name, data })\n    }\n\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent): void => {\n            if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {\n                e.preventDefault()\n                e.stopPropagation()\n                handleExecute()\n            }\n        }\n\n        window.addEventListener('keydown', handleKeyDown, true)\n        return () => window.removeEventListener('keydown', handleKeyDown, true)\n    }, [endpoint?.name, payloadJson, handleExecute])\n\n    if (!endpoint) {\n        return <></>\n    }\n\n    const getCodeExample = (tab: CodeExampleTab): string => {\n        switch (tab) {\n            case 'terminal':\n                return generateTerminalExample(endpoint, selectedCodeExampleVersion)\n            case 'python':\n                return generatePythonExample(endpoint, selectedCodeExampleVersion)\n            case 'nodejs':\n                return generateNodeExample(endpoint, selectedCodeExampleVersion)\n            default:\n                return generateTerminalExample(endpoint, selectedCodeExampleVersion)\n        }\n    }\n\n    const getLanguage = (tab: CodeExampleTab): Language => {\n        switch (tab) {\n            case 'terminal':\n                return Language.Bash\n            case 'python':\n                return Language.Python\n            case 'nodejs':\n                return Language.JavaScript\n            default:\n                return Language.Bash\n        }\n    }\n\n    // Generate version options\n    const versionOptions = Array.from({ length: endpoint.current_version }, (_, i) => {\n        const version = i + 1\n        return {\n            value: version,\n            label: version === endpoint.current_version ? `v${version} (Current)` : `v${version}`,\n        }\n    })\n\n    return (\n        <SceneSection\n            title=\"Playground\"\n            actions={\n                <LemonButton\n                    type=\"primary\"\n                    size=\"small\"\n                    icon={<IconPlayCircle />}\n                    onClick={handleExecute}\n                    loading={endpointResultLoading}\n                    tooltip=\"Cmd/Ctrl + Enter\"\n                >\n                    Execute endpoint\n                </LemonButton>\n            }\n        >\n            <div className=\"flex gap-4\">\n                <div className=\"flex-1 flex flex-col gap-2\">\n                    <LemonField.Pure label=\"Request payload\" info=\"Edit the JSON payload to send to the endpoint\" />\n\n                    <CodeEditorInline\n                        embedded\n                        language=\"json\"\n                        value={payloadJson}\n                        onChange={(value) => setPayloadJson(value ?? '')}\n                        maxHeight={400}\n                    />\n                </div>\n\n                <div className=\"flex-3 flex flex-col gap-2\">\n                    <LemonField.Pure label=\"API response\" />\n                    <CodeEditorInline\n                        embedded\n                        language=\"json\"\n                        value={endpointResult || 'Execute endpoint to see API response.'}\n                        maxHeight={400}\n                        options={{ readOnly: true, lineNumbers: 'on', folding: true }}\n                    />\n                </div>\n            </div>\n\n            <LemonDivider className=\"my-4\" />\n\n            <div className=\"flex flex-col gap-4\">\n                <LemonLabel>Example usage</LemonLabel>\n                <div className=\"flex gap-2\">\n                    <LemonSelect\n                        options={versionOptions}\n                        onChange={setSelectedCodeExampleVersion}\n                        value={selectedCodeExampleVersion || endpoint.current_version}\n                        placeholder=\"Select version\"\n                    />\n                    <LemonSelect\n                        options={[\n                            { value: 'terminal', label: 'Terminal' },\n                            { value: 'python', label: 'Python' },\n                            { value: 'nodejs', label: 'Node.js' },\n                        ]}\n                        onChange={(val) => {\n                            if (val) {\n                                setActiveCodeExampleTab(val as CodeExampleTab)\n                            }\n                        }}\n                        value={activeCodeExampleTab}\n                    />\n                </div>\n                <div>\n                    <CodeSnippet language={getLanguage(activeCodeExampleTab)} wrap={true}>\n                        {getCodeExample(activeCodeExampleTab)}\n                    </CodeSnippet>\n                </div>\n            </div>\n        </SceneSection>\n    )\n}\n"],"names":[],"sourceRoot":""}