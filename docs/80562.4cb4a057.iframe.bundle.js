"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[80562],{"../../frontend/src/lib/components/CyclotronJob/CyclotronJobTemplateSuggestions.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>CyclotronJobTemplateSuggestionsButton});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),fuse_esm=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),dist_module=__webpack_require__("../hogvm/typescript/dist/module.js");let HOG_USAGE_EXAMPLES=[{key:"ternary",example:"$1 = true ? 'Yes' : 'No'",description:"Ternary operation (if this then that else other)"},{key:"default",example:"$1 ?? 'Default value'",description:"Default value (if this is null or undefined, use this)"}],HOG_STL_EXAMPLES=Object.entries(dist_module.iG).map(_ref=>{let[key,value]=_ref;return{key,example:value.example,description:value.description}}),LIQUID_USAGE_EXAMPLES=[{key:"property",example:"{{ person.properties.email }}",description:"Access a property of an event or person"},{key:"if",example:"{% if condition %} Yes {% else %} No {% endif %}",description:"Conditional (if this then that else other)"},{key:"date",example:"{{ person.properties.signed_up_at | date: '%Y-%m-%d' }}",description:"Format a timestamp"},{key:"join",example:"{{ 'John, Paul, George, Ringo' | split: ', ' | join: ' and ' }}",description:"Join an array of values into a string"},{key:"default",example:"{{ person.properties.created_at | default: 'Default value' }}",description:"Default value (if value is null or undefined, use this)"}],cyclotronJobTemplateSuggestionsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref2=>{let{templating}=_ref2;return templating}),(0,index_esm.path)(key=>["components","cyclotron-jobs","cyclotronJobTemplateSuggestionsLogic",key]),(0,index_esm.actions)({setSearch:search=>({search})}),(0,index_esm.reducers)({search:["",{setSearch:(_,_ref3)=>{let{search}=_ref3;return search}}]}),(0,index_esm.selectors)({allOptions:[(_,p)=>[p.templating],templating=>"hog"===templating?[...HOG_USAGE_EXAMPLES,...HOG_STL_EXAMPLES]:LIQUID_USAGE_EXAMPLES],optionsFuse:[s=>[s.allOptions],allOptions=>new fuse_esm.Z(allOptions,{keys:["description","example"],threshold:.3})],optionsFiltered:[s=>[s.allOptions,s.optionsFuse,s.search],(allOptions,optionsFuse,search)=>search?optionsFuse.search(search).map(result=>result.item):allOptions]})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function CyclotronJobTemplateSuggestionsItem(_ref){let{option,onSelect}=_ref;return(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,role:"menuitem",size:"small",onClick:()=>onSelect(option),children:(0,jsx_runtime.jsxs)("div",{className:"flex-col flex-1",children:[(0,jsx_runtime.jsx)("code",{className:"text-sm font-semibold font-monospace",children:option.example}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-secondary",children:option.description})]})})}function CyclotronJobTemplateSuggestions(_ref2){let{templating,setTemplatingEngine,onOptionSelect}=_ref2,logic=cyclotronJobTemplateSuggestionsLogic({templating}),{search,optionsFiltered}=(0,index_esm.useValues)(logic),{setSearch}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex overflow-hidden flex-col flex-1 gap-1 max-w-100",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1 p-2 flex-0",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-1",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search templating options",autoFocus:!0,value:search,onChange:setSearch,fullWidth:!0}),setTemplatingEngine?(0,jsx_runtime.jsx)(src.Yv,{value:templating,onChange:setTemplatingEngine,options:[{label:"Hog",value:"hog"},{label:"Liquid",value:"liquid"}],tooltip:"Change the templating language"}):null]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-secondary",children:["Below are a list of available functions for templating your inputs using ",(0,jsx_runtime.jsx)("b",{children:templating}),"."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/cdp/destinations/customizing-destinations#customizing-payload",children:"Learn more"})]})]}),(0,jsx_runtime.jsxs)("ul",{className:"flex overflow-y-auto flex-col flex-1 gap-px p-2 border-t max-w-100",children:[optionsFiltered.map(value=>(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestionsItem,{option:value,onSelect:onOptionSelect})},value.key)),"liquid"===templating?(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",sideIcon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{}),to:"https://liquidjs.com/filters/overview.html",targetBlank:!0,children:"Liquid documentation"})}):null]})]})}function CyclotronJobTemplateSuggestionsButton(_ref3){let{onOptionSelect,...props}=_ref3,[showPopover,setShowPopover]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(src.Qw,{closeOnClickInside:!1,visible:showPopover,matchWidth:!1,actionable:!0,onVisibilityChange:visible=>setShowPopover(visible),overlay:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestions,{...props,onOptionSelect:option=>{onOptionSelect(option),setShowPopover(!1)}}),overflowHidden:!0,children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode,{}),tooltip:"Supports templating - click to see available options"})})}},"../../frontend/src/scenes/hog-functions/email-templater/EmailTemplater.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>EmailTemplater});var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),dist=__webpack_require__("../../node_modules/.pnpm/react-email-editor@1.7.11_react@18.2.0/node_modules/react-email-editor/dist/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),CyclotronJobTemplateSuggestions=__webpack_require__("../../frontend/src/lib/components/CyclotronJob/CyclotronJobTemplateSuggestions.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),integrationsLogic=__webpack_require__("../../frontend/src/lib/integrations/integrationsLogic.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),CodeEditorInline=__webpack_require__("../../frontend/src/lib/monaco/CodeEditorInline.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");let unsubscribeLinkToolCustomJs=`
unlayer.registerTool({ 
    name: 'unsubscribe_link',
    label: 'Unsubscribe',
    icon: 'fa-hand-pointer',
    supportedDisplayModes: ['email'],
    position: 15,
    options: {
        unsubscribe_link: {
            // Property Group
            title: 'Unsubscribe link content', 
            position: 1, 
            collapsed: false,
            options: {
                unsubscribe_link_content: {
                    label: 'Content',
                    defaultValue: \`<div>Don't want to receive these emails? <a href="{{ unsubscribe_url }}">Unsubscribe</a></div>\`,
                    widget: 'rich_text',
                },
            },
        },
    },
    values: {},
    renderer: {
        Viewer: unlayer.createViewer({
            render(values) {
                return \`\${values.unsubscribe_link_content}\`
            },
        }),
        exporters: {
            email: function (values) {
                return \`\${values.unsubscribe_link_content}\`
            },
        },
    },
})
`;var kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),types=__webpack_require__("../../frontend/src/types.ts");let emailTemplaterLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.path)(["scenes","hog-functions","email-templater","emailTemplaterLogic"]),(0,index_esm.connect)(()=>({values:[preflightLogic.preflightLogic,["preflight"]]})),(0,index_esm.actions)({setEmailEditorRef:emailEditorRef=>({emailEditorRef}),onEmailEditorReady:!0,setIsModalOpen:isModalOpen=>({isModalOpen}),applyTemplate:template=>({template}),closeWithConfirmation:!0,setTemplatingEngine:templating=>({templating})}),(0,index_esm.reducers)({emailEditorRef:[null,{setEmailEditorRef:(_,_ref)=>{let{emailEditorRef}=_ref;return emailEditorRef}}],isEmailEditorReady:[!1,{setIsModalOpen:()=>!1,onEmailEditorReady:()=>!0}],isModalOpen:[!1,{setIsModalOpen:(_,_ref2)=>{let{isModalOpen}=_ref2;return isModalOpen}}],appliedTemplate:[null,{applyTemplate:(_,_ref3)=>{let{template}=_ref3;return template}}],templatingEngine:["liquid",{setTemplatingEngine:(_,_ref4)=>{let{templating}=_ref4;return templating}}]}),(0,kea_loaders_lib.loaders)(()=>({templates:[[],{loadTemplates:async()=>(await api.ZP.messaging.getTemplates()).results}],personPropertyDefinitions:[[],{loadPersonPropertyDefinitions:async()=>(await api.ZP.propertyDefinitions.list({type:types.ll.Person,limit:1e3})).results}]})),(0,index_esm.selectors)({logicProps:[()=>[(_,props)=>props],props=>props],mergeTags:[s=>[s.personPropertyDefinitions],personPropertyDefinitions=>{let tags={unsubscribe_url:{name:"Unsubscribe URL",value:"{{unsubscribe_url}}",sample:"https://example.com/unsubscribe/12345"}};return personPropertyDefinitions.forEach(property=>{tags[property.name]={name:property.name,value:`{{person.properties["${property.name}"]}}`,sample:property.example||`Sample ${property.name}`}}),tags}],unlayerEditorProjectId:[s=>[s.preflight],preflight=>{if(preflight.realm===types.B_.Cloud||preflight.is_debug)return 275430}]}),(0,lib.forms)(_ref5=>{let{actions,values,props}=_ref5;return{emailTemplate:{defaults:props.defaultValue,submit:async formValues=>{if(!formValues)return;let editor=values.emailEditorRef?.editor;if(!editor||!values.isEmailEditorReady)return;let[htmlData,textData]=await Promise.all([new Promise(res=>editor.exportHtml(res)),new Promise(res=>editor.exportPlainText(res))]),finalValues={...formValues,html:escapeHTMLStringCurlies(htmlData.html),text:textData.text,design:htmlData.design};props.onChange(finalValues),actions.setIsModalOpen(!1)}}}}),(0,index_esm.listeners)(_ref6=>{let{props,values,actions}=_ref6;return{onEmailEditorReady:()=>{props.value?.design&&values.emailEditorRef?.editor?.loadDesign(props.value.design)},setEmailTemplateValue:_ref7=>{let{name,value}=_ref7;if(values.isModalOpen||"html"===name)return;let key=Array.isArray(name)?name[0]:name;props.onChange({...props.value,[key]:value})},setEmailTemplateValues:_ref8=>{let{values}=_ref8;props.onChange({...props.value,...values})},applyTemplate:_ref9=>{let{template}=_ref9,emailTemplateContent=template.content.email;actions.setEmailTemplateValues(emailTemplateContent)},closeWithConfirmation:()=>{values.emailTemplateChanged?src.dn.open({title:"Discard changes",description:"Are you sure you want to discard your changes?",primaryButton:{onClick:()=>{var _props$value;actions.resetEmailTemplate(null!==(_props$value=props.value)&&void 0!==_props$value?_props$value:void 0),actions.setIsModalOpen(!1)},children:"Discard"},secondaryButton:{children:"Keep editing"}}):actions.setIsModalOpen(!1)}}}),(0,index_esm.propsChanged)((_ref10,oldProps)=>{let{actions,props}=_ref10;props.value&&!(0,utils.h0)(props.value,oldProps.value)&&actions.resetEmailTemplate(props.value)}),(0,index_esm.afterMount)(_ref11=>{let{actions,props}=_ref11;props.value&&actions.resetEmailTemplate(props.value),actions.loadTemplates(),actions.loadPersonPropertyDefinitions()})]);function escapeHTMLStringCurlies(htmlString){let doc=new DOMParser().parseFromString(htmlString,"text/html");function escapeCurlyBraces(text){return text.replace(/{/g,"\\{")}function processNode(node){node.nodeType===Node.ELEMENT_NODE?"STYLE"===node.tagName||"SCRIPT"===node.tagName?node.textContent=escapeCurlyBraces(node.textContent||""):Array.from(node.childNodes).forEach(processNode):node.nodeType===Node.COMMENT_NODE&&(node.nodeValue=escapeCurlyBraces(node.nodeValue||""))}return processNode(doc.head),processNode(doc.body),new XMLSerializer().serializeToString(doc)}var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let EMAIL_META_FIELDS={FROM:{key:"from",label:"From",optional:!1},PREHEADER:{key:"preheader",label:"Preheader",optional:!0,helpText:"This is the preview text that appears below the subject line in an inbox."},TO:{key:"to",label:"To",optional:!1},SUBJECT:{key:"subject",label:"Subject",optional:!1}},EMAIL_TYPE_SUPPORTED_FIELDS={email:[EMAIL_META_FIELDS.FROM,EMAIL_META_FIELDS.TO,EMAIL_META_FIELDS.SUBJECT],native_email:[EMAIL_META_FIELDS.FROM,EMAIL_META_FIELDS.TO,EMAIL_META_FIELDS.SUBJECT,EMAIL_META_FIELDS.PREHEADER],native_email_template:[EMAIL_META_FIELDS.SUBJECT,EMAIL_META_FIELDS.PREHEADER]};function DestinationEmailTemplaterForm(_ref){let{mode}=_ref,{logicProps,mergeTags}=(0,index_esm.useValues)(emailTemplaterLogic),{setEmailEditorRef,onEmailEditorReady,setIsModalOpen}=(0,index_esm.useActions)(emailTemplaterLogic);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)(lib.Form,{className:"flex overflow-hidden flex-col flex-1 rounded border",logic:emailTemplaterLogic,props:logicProps,formKey:"emailTemplate",children:[EMAIL_TYPE_SUPPORTED_FIELDS[logicProps.type].map(field=>(0,jsx_runtime.jsx)(LemonField.D,{name:field.key,className:"gap-1 pl-2 border-b shrink-0",renderError:()=>null,children:_ref2=>{let{value,onChange,error}=_ref2;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.HQ,{className:error?"text-danger":"",info:field.helpText,showOptional:field.optional,children:field.label}),(0,jsx_runtime.jsx)(CodeEditorInline.s,{embedded:!0,className:"flex-1",globals:logicProps.variables,value:value,onChange:onChange})]})}},field.key)),"full"===mode?(0,jsx_runtime.jsx)(dist.default,{ref:r=>setEmailEditorRef(r),onReady:()=>onEmailEditorReady(),minHeight:20,options:{mergeTags,displayMode:"email",features:{preview:!0,imageEditor:!0,stockImages:!1}}}):(0,jsx_runtime.jsx)(LemonField.D,{name:"html",className:"flex relative flex-col",children:_ref3=>{let{value}=_ref3;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex absolute inset-0 justify-center items-end p-2 opacity-0 transition-opacity hover:opacity-100",children:[(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 opacity-50 bg-surface-primary"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",size:"small",onClick:()=>setIsModalOpen(!0),children:"Click to modify content"})]}),(0,jsx_runtime.jsx)("iframe",{srcDoc:value,className:"flex-1"})]})}})]})})}function NativeEmailIntegrationChoice(_ref4){let{onChange,value}=_ref4,{integrationsLoading,integrations}=(0,index_esm.useValues)(integrationsLogic.a),integrationsOfKind=integrations?.filter(x=>"email"===x.kind);return integrationsLoading||integrationsOfKind?.length!==0?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.Yv,{className:"m-1 flex-1",type:"tertiary",placeholder:"Choose email sender",loading:integrationsLoading,options:[{title:"Email senders",options:(integrationsOfKind||[]).map(integration=>({label:integration.display_name,value:integration.id}))},{options:[{label:"Add new email sender",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{}),value:-1}]}],value:value?.integrationId,size:"small",fullWidth:!0,onChange:integrationId=>{var _integration$config$e;if(-1===integrationId){window.open(urls.j.workflows("channels"),"_blank");return}let integration=integrationsOfKind?.find(x=>x.id===integrationId);onChange({integrationId,email:null!==(_integration$config$e=integration?.config?.email_address)&&void 0!==_integration$config$e?_integration$config$e:"default@example.com"})}})}):(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 justify-end items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"No email senders configured yet"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"tertiary",to:urls.j.workflows("channels"),targetBlank:!0,className:"m-1",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{}),children:"Connect email sender"})]})}function LiquidSupportedText(_ref5){let{value,onChange,globals}=_ref5,{templatingEngine}=(0,index_esm.useValues)(emailTemplaterLogic),{setTemplatingEngine}=(0,index_esm.useActions)(emailTemplaterLogic);return(0,jsx_runtime.jsxs)("span",{className:"flex grow group relative justify-between",children:[(0,jsx_runtime.jsx)("span",{className:"absolute top-0 right-2 z-20 p-px opacity-0 transition-opacity group-hover:opacity-100",children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestions.T,{templating:templatingEngine,setTemplatingEngine:setTemplatingEngine,value:value,onOptionSelect:option=>{onChange?.(`${value||""}${option.example}`)}})}),(0,jsx_runtime.jsx)(CodeEditorInline.s,{embedded:!0,className:"flex-1",globals:globals,value:value,onChange:onChange})]})}function NativeEmailTemplaterForm(_ref6){let{mode}=_ref6,{unlayerEditorProjectId,logicProps,appliedTemplate,templates,templatesLoading,mergeTags}=(0,index_esm.useValues)(emailTemplaterLogic),{setEmailEditorRef,onEmailEditorReady,setIsModalOpen,applyTemplate}=(0,index_esm.useActions)(emailTemplaterLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),isWorkflowsProductEnabled=featureFlags[constants.y8.WORKFLOWS];return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)(lib.Form,{className:"flex overflow-hidden flex-col flex-1 rounded border",logic:emailTemplaterLogic,props:logicProps,formKey:"emailTemplate",children:[EMAIL_TYPE_SUPPORTED_FIELDS[logicProps.type].map(field=>(0,jsx_runtime.jsx)(LemonField.D,{name:field.key,className:"gap-1 pl-2 border-b shrink-0",renderError:()=>null,showOptional:field.optional,children:_ref7=>{let{value,onChange,error}=_ref7;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.HQ,{className:error?"text-danger":"",info:field.helpText,showOptional:field.optional,children:field.label}),"from"===field.key?(0,jsx_runtime.jsx)(NativeEmailIntegrationChoice,{value:value,onChange:onChange}):"to"===field.key?(0,jsx_runtime.jsx)(LiquidSupportedText,{value:value?.email,onChange:email=>onChange({...value,email}),globals:logicProps.variables}):(0,jsx_runtime.jsx)(LiquidSupportedText,{value:value,onChange:onChange,globals:logicProps.variables})]})}},field.key)),"full"===mode?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isWorkflowsProductEnabled&&(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center px-2 py-1 border-b",children:[(0,jsx_runtime.jsx)("span",{className:"flex-1",children:"Start from a template (optional)"}),(0,jsx_runtime.jsx)(src.Yv,{size:"xsmall",placeholder:"Choose template",loading:templatesLoading,value:appliedTemplate?.id,options:templates.map(template=>({label:template.name,value:template.id})),onChange:id=>{let template=templates.find(t=>t.id===id);template&&applyTemplate(template)},"data-attr":"email-template-selector",disabledReason:templates.length>0?void 0:"No templates created yet"})]}),(0,jsx_runtime.jsx)(dist.default,{ref:r=>setEmailEditorRef(r),onReady:()=>onEmailEditorReady(),minHeight:20,options:{mergeTags,displayMode:"email",features:{preview:!0,imageEditor:!0,stockImages:!1},projectId:unlayerEditorProjectId,customJS:isWorkflowsProductEnabled?[unsubscribeLinkToolCustomJs]:[]}})]}):(0,jsx_runtime.jsx)(LemonField.D,{name:"html",className:"flex relative flex-col",children:_ref8=>{let{value}=_ref8;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("flex absolute inset-0 justify-center items-center p-2 opacity-0 transition-opacity hover:opacity-100",value?"opacity-0":"opacity-100"),children:[(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 opacity-50 bg-surface-primary"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",size:"small",onClick:()=>setIsModalOpen(!0),children:"Click to modify content"})]}),(0,jsx_runtime.jsx)("iframe",{srcDoc:value,className:"flex-1"})]})}})]})})}function EmailTemplaterForm(_ref9){let{mode}=_ref9,{logicProps}=(0,index_esm.useValues)(emailTemplaterLogic);switch(logicProps.type){case"email":return(0,jsx_runtime.jsx)(DestinationEmailTemplaterForm,{mode:mode});case"native_email_template":case"native_email":return(0,jsx_runtime.jsx)(NativeEmailTemplaterForm,{mode:mode})}}function EmailTemplaterModal(){let{isModalOpen,isEmailEditorReady,emailTemplateChanged}=(0,index_esm.useValues)(emailTemplaterLogic),{closeWithConfirmation,submitEmailTemplate}=(0,index_esm.useActions)(emailTemplaterLogic);return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isModalOpen,width:"90vw",onClose:()=>closeWithConfirmation(),hasUnsavedInput:emailTemplateChanged,children:(0,jsx_runtime.jsx)("div",{className:"h-[80vh] flex",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"shrink-0",children:(0,jsx_runtime.jsx)("h2",{children:"Editing email template"})}),(0,jsx_runtime.jsx)(EmailTemplaterForm,{mode:"full"}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center mt-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>closeWithConfirmation(),children:"Discard changes"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>submitEmailTemplate(),disabledReason:isEmailEditorReady?void 0:"Loading email editor...",children:"Save"})]})]})})})}function EmailTemplater(props){return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:emailTemplaterLogic,props:props,children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,jsx_runtime.jsx)(EmailTemplaterForm,{mode:"preview"}),(0,jsx_runtime.jsx)(EmailTemplaterModal,{})]})})}}}]);
//# sourceMappingURL=80562.4cb4a057.iframe.bundle.js.map