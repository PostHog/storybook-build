(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[60676],{"./frontend/src/scenes/batch_exports/BatchExportsListScene.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BatchExportsList:function(){return BatchExportsList},BatchExportsListScene:function(){return BatchExportsListScene},scene:function(){return scene}});var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts");const batchExportsListLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","batch_exports","batchExportsListLogic"]),(0,index_esm.actions)({loadBatchExports:offset=>({offset:offset})}),(0,index_esm.reducers)({offset:[0,{loadBatchExports:(_,_ref)=>{let{offset:offset}=_ref;return offset||0}}]}),(0,lib.loaders)((_ref2=>{let{values:values}=_ref2;return{batchExportConfigs:[null,{loadBatchExports:async(_ref3,breakpoint)=>{let{offset:offset}=_ref3;await breakpoint(100);return await api.ZP.batchExports.list({offset:offset||0,limit:10})},pause:async batchExport=>{await api.ZP.batchExports.pause(batchExport.id),src.lemonToast.success("Batch export paused. No future runs will be scheduled");const found=values.batchExportConfigs?.results.find((config=>config.id===batchExport.id));return found&&(found.paused=!0),values.batchExportConfigs},unpause:async batchExport=>{await api.ZP.batchExports.unpause(batchExport.id),src.lemonToast.success("Batch export unpaused. Future runs will be scheduled");const found=values.batchExportConfigs?.results.find((config=>config.id===batchExport.id));return found&&(found.paused=!1),values.batchExportConfigs}}]}})),(0,index_esm.listeners)((_ref4=>{let{actions:actions,values:values,cache:cache}=_ref4;return{loadBatchExportsSuccess:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout((()=>{actions.loadBatchExports(values.offset)}),1e4)}}})),(0,index_esm.beforeUnmount)((_ref5=>{let{cache:cache}=_ref5;clearTimeout(cache.refreshTimeout)})),(0,index_esm.afterMount)((_ref6=>{let{actions:actions}=_ref6;actions.loadBatchExports()})),(0,index_esm.selectors)((_ref7=>{let{actions:actions}=_ref7;return{pagination:[s=>[s.offset,s.batchExportConfigs],(offset,configs)=>{var _configs$count;return{controlled:!0,pageSize:10,currentPage:Math.floor(offset/10)+1,entryCount:null!==(_configs$count=configs?.count)&&void 0!==_configs$count?_configs$count:0,onBackward:()=>actions.loadBatchExports(offset-10),onForward:()=>actions.loadBatchExports(offset+10)}}]}}))]);var LemonMenu=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMenu/index.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),components=__webpack_require__("./frontend/src/scenes/batch_exports/components.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const scene={component:BatchExportsListScene};function BatchExportsListScene(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:"Batch Exports",buttons:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",to:urls.j.batchExportNew(),children:"Create export workflow"})})}),(0,jsx_runtime.jsx)("p",{children:"Batch exports allow you to export your data to a destination of your choice."}),(0,jsx_runtime.jsx)(BatchExportsList,{})]})}function BatchExportsList(){var _batchExportConfigs$r;const{batchExportConfigs:batchExportConfigs,batchExportConfigsLoading:batchExportConfigsLoading,pagination:pagination}=(0,index_esm.useValues)(batchExportsListLogic),{unpause:unpause,pause:pause}=(0,index_esm.useActions)(batchExportsListLogic);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.LemonTable,{dataSource:null!==(_batchExportConfigs$r=batchExportConfigs?.results)&&void 0!==_batchExportConfigs$r?_batchExportConfigs$r:[],loading:batchExportConfigsLoading,pagination:pagination,columns:[{title:"Name",key:"name",width:0,render:function RenderName(_,batchExport){return(0,jsx_runtime.jsx)(src.Link,{className:"font-semibold truncate",to:urls.j.batchExport(batchExport.id),children:batchExport.name})}},{title:"Latest runs",key:"runs",render:function RenderStatus(_,batchExport){return(0,jsx_runtime.jsx)("div",{className:"flex gap-2",children:[...batchExport.latest_runs||[]].reverse()?.map((run=>(0,jsx_runtime.jsx)(src.LemonButton,{to:urls.j.batchExport(batchExport.id),status:"stealth",className:"flex gap-1",noPadding:!0,children:(0,jsx_runtime.jsx)(components.pP,{runs:[run]})},run.id)))})}},{title:"Destination",key:"destination",render:function RenderType(_,batchExport){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:batchExport.destination.type})}},{title:"Frequency",key:"frequency",dataIndex:"interval"},{title:"Status",key:"status",width:0,render:function RenderStatus(_,batchExport){return(0,jsx_runtime.jsx)(components.$o,{batchExportConfig:batchExport})}},{width:0,render:function Render(_,batchExport){const menuItems=[{label:"View",to:urls.j.batchExport(batchExport.id)},{label:"Edit",to:urls.j.batchExportEdit(batchExport.id)},{label:batchExport.paused?"Resume":"Pause",status:batchExport.paused?"primary":"danger",onClick:()=>{batchExport.paused?unpause(batchExport):pause(batchExport)}}];return(0,jsx_runtime.jsx)(LemonMenu.d,{items:menuItems,placement:"left",children:(0,jsx_runtime.jsx)(src.LemonButton,{size:"small",status:"stealth",noPadding:!0,icon:(0,jsx_runtime.jsx)(icons.YRX,{})})})}}]})})}},"./frontend/src/scenes/batch_exports/components.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{pP:function(){return BatchExportRunIcon},$o:function(){return BatchExportTag}});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),BatchExports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/batch_exports/BatchExports.scss"),BatchExports_default=__webpack_require__.n(BatchExports),options={insert:"head",singleton:!1},jsx_runtime=(injectStylesIntoStyleTag_default()(BatchExports_default(),options),BatchExports_default().locals,__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js"));function BatchExportTag(_ref){let{batchExportConfig:batchExportConfig}=_ref;return(0,jsx_runtime.jsx)(Tooltip.u,{title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:batchExportConfig.paused?"This export is paused - no future export runs will be scheduled ":"This export is active - new runs will be triggered at the configured interval."}),children:(0,jsx_runtime.jsx)(src.LemonTag,{type:batchExportConfig.paused?"default":"primary",children:batchExportConfig.paused?"Paused":"Active"})})}const colorForStatus=status=>{switch(status){case"Completed":return"success";case"ContinuedAsNew":case"Running":case"Starting":return"primary";case"Cancelled":case"Terminated":case"TimedOut":return"warning";case"Failed":return"danger";default:return"default"}};function BatchExportRunIcon(_ref2){let{runs:runs,showLabel:showLabel=!1}=_ref2;const latestRun=runs[0],color=colorForStatus(latestRun.status);return(0,jsx_runtime.jsx)(Tooltip.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Run status: ",latestRun.status,runs.length>1&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("br",{}),"Attempts: ",runs.length]})]}),children:(0,jsx_runtime.jsx)("span",{className:(0,clsx_m.default)(`BatchExportRunIcon h-6 p-2 border-2 flex items-center justify-center rounded-full font-semibold text-xs border-${color} text-${color}-dark select-none`,"primary"===color&&"BatchExportRunIcon--pulse",showLabel?"":"w-6"),children:showLabel?(0,jsx_runtime.jsx)("span",{className:"text-center",children:latestRun.status}):runs.length})})}try{BatchExportTag.displayName="BatchExportTag",BatchExportTag.__docgenInfo={description:"",displayName:"BatchExportTag",props:{batchExportConfig:{defaultValue:null,description:"",name:"batchExportConfig",required:!0,type:{name:"BatchExportConfiguration"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/batch_exports/components.tsx#BatchExportTag"]={docgenInfo:BatchExportTag.__docgenInfo,name:"BatchExportTag",path:"frontend/src/scenes/batch_exports/components.tsx#BatchExportTag"})}catch(__react_docgen_typescript_loader_error){}try{BatchExportRunIcon.displayName="BatchExportRunIcon",BatchExportRunIcon.__docgenInfo={description:"",displayName:"BatchExportRunIcon",props:{runs:{defaultValue:null,description:"",name:"runs",required:!0,type:{name:"BatchExportRun[]"}},showLabel:{defaultValue:{value:"false"},description:"",name:"showLabel",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/batch_exports/components.tsx#BatchExportRunIcon"]={docgenInfo:BatchExportRunIcon.__docgenInfo,name:"BatchExportRunIcon",path:"frontend/src/scenes/batch_exports/components.tsx#BatchExportRunIcon"})}catch(__react_docgen_typescript_loader_error){}try{colorForStatus.displayName="colorForStatus",colorForStatus.__docgenInfo={description:"",displayName:"colorForStatus",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/batch_exports/components.tsx#colorForStatus"]={docgenInfo:colorForStatus.__docgenInfo,name:"colorForStatus",path:"frontend/src/scenes/batch_exports/components.tsx#colorForStatus"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/batch_exports/BatchExports.scss":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".BatchExportRunIcon--pulse{outline:2px solid transparent;outline-offset:0;animation:pulse 2s ease-out infinite}@keyframes pulse{0%{outline-offset:0;outline-color:var(--primary-light)}80%{outline-offset:20px;outline-color:transparent}to{outline-offset:20px;outline-color:transparent}}",""]),module.exports=exports}}]);