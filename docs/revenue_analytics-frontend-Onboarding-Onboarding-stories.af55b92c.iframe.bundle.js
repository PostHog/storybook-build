"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[7700,35894],{"../../products/revenue_analytics/frontend/Onboarding/Onboarding.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Onboarding:()=>Onboarding,OnboardingAddSource:()=>OnboardingAddSource,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var lib_constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/lib/constants.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_mocks_browser__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/mocks/browser.tsx"),_mocks_fixtures_api_projects_team_id_external_data_sources_externalDataSource_json__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/mocks/fixtures/api/projects/team_id/external_data_sources/externalDataSource.json"),_mocks_handlers__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/mocks/handlers.ts");let __WEBPACK_DEFAULT_EXPORT__={component:__webpack_require__("../../products/revenue_analytics/frontend/Onboarding/Onboarding.tsx").T,title:"Scenes-App/Revenue Analytics/Onboarding",parameters:{layout:"fullscreen",viewMode:"story",mockDate:"2023-02-01",featureFlags:[lib_constants__WEBPACK_IMPORTED_MODULE_0__.y8.REVENUE_ANALYTICS],pageUrl:scenes_urls__WEBPACK_IMPORTED_MODULE_1__.j.revenueAnalytics(),testOptions:{waitForLoadersToDisappear:!0}},decorators:[(0,_mocks_browser__WEBPACK_IMPORTED_MODULE_2__.x8)({get:{"/api/environments/:team_id/external_data_sources/":()=>[200,{..._mocks_handlers__WEBPACK_IMPORTED_MODULE_4__.vv,results:[_mocks_fixtures_api_projects_team_id_external_data_sources_externalDataSource_json__WEBPACK_IMPORTED_MODULE_3__]}]}})]},Onboarding={},OnboardingAddSource={args:{initialSetupView:"add-source"}};Onboarding.parameters={...Onboarding.parameters,docs:{...Onboarding.parameters?.docs,source:{originalSource:"{}",...Onboarding.parameters?.docs?.source}}},OnboardingAddSource.parameters={...OnboardingAddSource.parameters,docs:{...OnboardingAddSource.parameters?.docs,source:{originalSource:"{\n  args: {\n    initialSetupView: 'add-source'\n  }\n}",...OnboardingAddSource.parameters?.docs?.source}}};let __namedExportsOrder=["Onboarding","OnboardingAddSource"]},"../../frontend/src/lib/components/FilterBar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>FilterBar});var clsx__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_posthog_icons__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_hooks_useFeatureFlag__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/hooks/useFeatureFlag.ts"),lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let FilterBar=_ref=>{let{top,left,right}=_ref,[expanded,setExpanded]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),newSceneLayout=(0,lib_hooks_useFeatureFlag__WEBPACK_IMPORTED_MODULE_3__.y)("NEW_SCENE_LAYOUT");return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:(0,lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_5__.cn)("sticky z-20 bg-primary border-b py-2 top-[var(--breadcrumbs-height-compact)] space-y-2",newSceneLayout&&"top-0 -mx-4 px-4"),children:[top,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"flex items-start shrink-0",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"flex flex-1 flex-row gap-2 items-center",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"flex flex-row gap-1 items-center flex-1 md:flex-none",children:left}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.Jp,{type:"secondary",size:"small",className:"sm:hidden",onClick:()=>setExpanded(expanded=>!expanded),icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_1__.IconFilter,{})})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"hidden sm:flex gap-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(FoldableFilters,{children:right})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:(0,clsx__WEBPACK_IMPORTED_MODULE_6__.default)("flex sm:hidden flex-col gap-2 overflow-hidden transition-all duration-200",expanded?"max-h-[500px]":"max-h-0"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(FoldableFilters,{children:right})})]})]})},FoldableFilters=_ref2=>{let{children}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"flex flex-row md:flex-row-reverse flex-wrap gap-2 md:[&>*]:grow-0 [&>*]:grow w-full",children:children})}},"../../products/revenue_analytics/frontend/Onboarding/Onboarding.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>Onboarding});var ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),RevenueAnalyticsScene=__webpack_require__("../../products/revenue_analytics/frontend/RevenueAnalyticsScene.tsx"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),NewSourceWizard=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/NewSourceWizard.tsx"),DataWarehouseSourceIcon=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/DataWarehouseSourceIcon.tsx"),EventConfigurationModal=__webpack_require__("../../products/revenue_analytics/frontend/settings/EventConfigurationModal.tsx"),revenueAnalyticsSettingsLogic=__webpack_require__("../../products/revenue_analytics/frontend/settings/revenueAnalyticsSettingsLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let REVENUE_SOURCE_TYPES=["Stripe","Chargebee","Polar","RevenueCat"],AVAILABLE_REVENUE_SOURCE_TYPES=new Set(["Stripe"]);function InlineSetup(_ref){let{initialSetupView}=_ref,{events,enabledDataWarehouseSources}=(0,index_esm.useValues)(revenueAnalyticsSettingsLogic.m),hasEvents=events.length>0,hasSources=enabledDataWarehouseSources.length>0,[currentView,setCurrentView]=(0,react.useState)(null!=initialSetupView?initialSetupView:"overview"),[selectedSource,setSelectedSource]=(0,react.useState)(null),[showEventModal,setShowEventModal]=(0,react.useState)(!1),revenueSources=REVENUE_SOURCE_TYPES.map(source_type=>({id:source_type,description:`Import revenue data from ${source_type}`,isAvailable:AVAILABLE_REVENUE_SOURCE_TYPES.has(source_type),isConnected:enabledDataWarehouseSources.some(source=>source.source_type===source_type)})),handleSourceSelect=sourceId=>{revenueSources.find(s=>s.id===sourceId)&&(setSelectedSource(sourceId),setCurrentView("add-source"))};return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsx)(src.Mi,{hoverEffect:!1,children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold mb-1",children:"Revenue Analytics Setup"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted-alt",children:"Configure your revenue tracking to get started"})]}),(hasEvents||hasSources)&&(0,jsx_runtime.jsx)(src.Jp,{type:"primary",size:"small",onClick:()=>window.location.reload(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{}),children:"View Dashboard"})]}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border border-primary",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-bg-light border border-primary",children:hasEvents?(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"w-6 h-6"}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPieChart,{className:"w-6 h-6 text-muted"})}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium text-sm",children:hasEvents?`${events.length} Event${1!==events.length?"s":""} Configured`:"No Events Configured"}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted-alt mt-0.5",children:hasEvents?"Revenue events are set up":"Configure events to track revenue"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border border-primary",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-bg-light border border-primary",children:hasSources?(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"w-6 h-6"}):(0,jsx_runtime.jsx)(posthog_icons_es.IconDatabase,{className:"w-6 h-6 text-muted"})}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium text-sm",children:hasSources?"Revenue source connected":"No revenue sources connected"}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted-alt mt-0.5",children:hasSources?"Revenue data source is set up":"Connect Stripe to import revenue data"})]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-2 border-t border-primary",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>setShowEventModal(!0),size:"small","data-attr":"add-revenue-event",children:"Add Revenue Event"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>{setSelectedSource(null),setCurrentView("add-source")},size:"small","data-attr":"add-revenue-source",children:"Connect Revenue Source"})]})]})}),"add-source"===currentView&&!selectedSource&&(0,jsx_runtime.jsx)(src.Mi,{hoverEffect:!1,children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-white border border-primary",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconDatabase,{className:"w-7 h-7",style:{color:"var(--primary-3000)"}})}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"text-lg font-semibold",children:"Connect Revenue Source"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted-alt",children:"Choose a revenue platform to import data from"})]})]}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:revenueSources.map(source=>(0,jsx_runtime.jsxs)("div",{className:(0,css_classes.cn)("relative p-4 rounded-lg border-2",source.isAvailable?source.isConnected?"border-primary bg-primary-lightest":"border-primary bg-bg-light":"border-primary bg-bg-light opacity-60",source.isAvailable?"cursor-pointer":"cursor-not-allowed"),onClick:source.isAvailable?()=>handleSourceSelect(source.id):void 0,children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,jsx_runtime.jsx)(DataWarehouseSourceIcon.Ug,{type:source.id,size:"small",disableTooltip:!0}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h5",{className:"font-medium text-sm",children:source.id}),!source.isAvailable&&(0,jsx_runtime.jsx)("span",{className:"text-xs text-warning bg-warning-light p-1 rounded-full",children:"Coming Soon"}),source.isConnected&&(0,jsx_runtime.jsx)("span",{className:"text-xs text-white p-1 rounded-full",style:{backgroundColor:"var(--primary-3000)"},children:"Connected"})]})]}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted-alt",children:source.description})]},source.id))}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>setCurrentView("overview"),children:"Cancel"})})]})}),"add-source"===currentView&&selectedSource&&(0,jsx_runtime.jsx)(src.Mi,{hoverEffect:!1,children:(0,jsx_runtime.jsx)(NewSourceWizard.NewSourcesWizard,{onComplete:()=>{setCurrentView("overview"),setSelectedSource(null)},allowedSources:revenueSources.map(source=>source.id),initialSource:selectedSource})}),(0,jsx_runtime.jsx)("div",{className:"text-center",children:(0,jsx_runtime.jsxs)("p",{className:"text-xs text-muted-alt",children:["Need help? Check our"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/revenue-analytics",target:"_blank",children:"documentation"})]})}),showEventModal&&(0,jsx_runtime.jsx)(EventConfigurationModal.e,{onClose:()=>{setShowEventModal(!1)}})]})}let Onboarding=_ref=>{let{initialSetupView}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsx)(ProductIntroduction.C,{isEmpty:!0,productName:RevenueAnalyticsScene.PRODUCT_NAME,productKey:RevenueAnalyticsScene.PRODUCT_KEY,thingName:RevenueAnalyticsScene.PRODUCT_THING_NAME,description:RevenueAnalyticsScene.PRODUCT_DESCRIPTION,titleOverride:"Get started with Revenue Analytics"}),(0,jsx_runtime.jsx)(InlineSetup,{initialSetupView:initialSetupView})]})}},"../../products/revenue_analytics/frontend/RevenueAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PRODUCT_DESCRIPTION:()=>PRODUCT_DESCRIPTION,PRODUCT_KEY:()=>PRODUCT_KEY,PRODUCT_NAME:()=>PRODUCT_NAME,PRODUCT_THING_NAME:()=>PRODUCT_THING_NAME,RevenueAnalyticsScene:()=>RevenueAnalyticsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),useFeatureFlag=__webpack_require__("../../frontend/src/lib/hooks/useFeatureFlag.ts"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),dataNodeCollectionLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeCollectionLogic.ts"),types=__webpack_require__("../../frontend/src/types.ts"),Onboarding=__webpack_require__("../../products/revenue_analytics/frontend/Onboarding/Onboarding.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),DateFilter_types=__webpack_require__("../../frontend/src/lib/components/DateFilter/types.ts"),FilterBar=__webpack_require__("../../frontend/src/lib/components/FilterBar.tsx"),PropertyFilters=__webpack_require__("../../frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),utils=__webpack_require__("../../frontend/src/lib/components/PropertyFilters/utils.ts"),TaxonomicFilter=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/TaxonomicFilter.tsx"),TaxonomicFilter_types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),BreakdownTag=__webpack_require__("../../frontend/src/scenes/insights/filters/BreakdownFilter/BreakdownTag.tsx"),Reload=__webpack_require__("../../frontend/src/queries/nodes/DataNode/Reload.tsx"),revenueAnalyticsLogic=__webpack_require__("../../products/revenue_analytics/frontend/revenueAnalyticsLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let DATE_FILTER_DATE_OPTIONS=[{key:DateFilter_types.Q2,values:[]},{key:"Month to date",values:["mStart"],getFormattedDate:date=>date.startOf("m").format(lib_utils.zT),defaultInterval:"day"},{key:"This month",values:["mStart","mEnd"],getFormattedDate:date=>(0,lib_utils._Q)(date.startOf("m"),date.endOf("m")),defaultInterval:"day"},{key:"Last month",values:["-1mStart","-1mEnd"],getFormattedDate:date=>(0,lib_utils._Q)(date.subtract(1,"month").startOf("month"),date.subtract(1,"month").endOf("month")),defaultInterval:"day"},{key:"This year",values:["yStart","yEnd"],getFormattedDate:date=>(0,lib_utils._Q)(date.startOf("y"),date.endOf("y")),defaultInterval:"month"},{key:"Year to date",values:["yStart"],getFormattedDate:date=>(0,lib_utils._Q)(date.startOf("y"),date.endOf("y")),defaultInterval:"month"},{key:"Previous year",values:["-1yStart","-1yEnd"],getFormattedDate:date=>(0,lib_utils._Q)(date.subtract(1,"year").startOf("y"),date.subtract(1,"year").endOf("y")),defaultInterval:"month"},{key:"All time",values:["all"],defaultInterval:"month"}],DISPLAY_MODE_OPTIONS=[{value:"line",label:"Line chart",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconLineGraph,{})},{value:"area",label:"Area chart",icon:(0,jsx_runtime.jsx)(icons.Ii,{})},{value:"bar",label:"Bar chart",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGraph,{})}],RevenueAnalyticsFilters=()=>{let{dateFilter:{dateTo,dateFrom},insightsDisplayMode}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{setDates,setInsightsDisplayMode}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km);return(0,jsx_runtime.jsx)(FilterBar.f,{left:(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:dateFrom,dateTo:dateTo,onChange:setDates,dateOptions:DATE_FILTER_DATE_OPTIONS,size:"small"}),right:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.u,{title:"Refresh data",children:(0,jsx_runtime.jsx)(Reload.H,{iconOnly:!0})}),(0,jsx_runtime.jsx)(src.Yv,{value:insightsDisplayMode,onChange:setInsightsDisplayMode,options:DISPLAY_MODE_OPTIONS,size:"small"}),(0,jsx_runtime.jsx)(RevenueAnalyticsPropertyFilters,{}),(0,jsx_runtime.jsx)(RevenueAnalyticsBreakdownBy,{})]})})},RevenueAnalyticsPropertyFilters=()=>{let{revenueAnalyticsFilter}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{setRevenueAnalyticsFilters}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km),[displayFilters,setDisplayFilters]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(src.J2,{visible:displayFilters,onClickOutside:()=>setDisplayFilters(!1),placement:"bottom",className:"max-w-200",overlay:(0,jsx_runtime.jsx)("div",{className:"p-2",children:(0,jsx_runtime.jsx)(PropertyFilters.t,{disablePopover:!0,taxonomicGroupTypes:[TaxonomicFilter_types.t.RevenueAnalyticsProperties],onChange:filters=>setRevenueAnalyticsFilters(filters.filter(utils.YN)),propertyFilters:revenueAnalyticsFilter,pageKey:"revenue-analytics",buttonSize:"small"})}),children:(0,jsx_runtime.jsx)(src.Jp,{"data-attr":"show-revenue-analytics-filters",icon:(0,jsx_runtime.jsx)(icons.Xd,{count:revenueAnalyticsFilter.length,showZero:!1,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconFilter,{})}),type:"secondary",size:"small",onClick:()=>setDisplayFilters(displayFilters=>!displayFilters),children:"Filters"})})},RevenueAnalyticsBreakdownBy=()=>{let{breakdownProperties}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-1",children:[breakdownProperties.map(breakdown=>(0,jsx_runtime.jsx)(EditableBreakdownTag,{breakdown:breakdown},breakdown.property)),(0,jsx_runtime.jsx)(AddBreakdownButton,{})]})},AddBreakdownButton=()=>{let[open,setOpen]=(0,react.useState)(!1),{breakdownProperties}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{addBreakdown}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km);return(0,jsx_runtime.jsx)(BreakdownPopover,{open:open,setOpen:setOpen,onSelect:breakdown=>addBreakdown(breakdown),children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),"data-attr":"add-breakdown-button",onClick:()=>setOpen(!open),sideIcon:null,disabledReason:breakdownProperties.length>=2?"You can only have up to 2 breakdowns":void 0,size:"small",children:"Add breakdown"})})},EditableBreakdownTag=_ref=>{let{breakdown}=_ref,{removeBreakdown}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km);return(0,jsx_runtime.jsx)(BreakdownTag.d,{breakdown:breakdown.property,breakdownType:breakdown.type,onClose:()=>removeBreakdown(breakdown)})},BreakdownPopover=_ref2=>{let{open,setOpen,onSelect,children}=_ref2;return(0,jsx_runtime.jsx)(src.J2,{style:{minHeight:"200px"},overlay:(0,jsx_runtime.jsx)(TaxonomicFilter.I,{groupType:TaxonomicFilter_types.t.RevenueAnalyticsProperties,onChange:(_taxonomicGroup,value)=>{onSelect({property:value,type:"revenue_analytics"}),setOpen(!1)},taxonomicGroupTypes:[TaxonomicFilter_types.t.RevenueAnalyticsProperties]}),visible:open,onClickOutside:()=>setOpen(!1),children:children})};var revenueAnalyticsSettingsLogic=__webpack_require__("../../products/revenue_analytics/frontend/settings/revenueAnalyticsSettingsLogic.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx");let QUERY_ID=revenueAnalyticsLogic.nf.GROSS_REVENUE,INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(QUERY_ID),loadPriority:QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},GrossRevenueTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),query=queries[QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...INSIGHT_PROPS,query},emptyStateHeading:"No gross revenue data available",emptyStateDetail:"Please try adjusting your query or filters. Also, make sure your revenue events are properly configured in the settings."}),[query]);return(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})},OverviewTile_QUERY_ID=revenueAnalyticsLogic.nf.OVERVIEW,OverviewTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(OverviewTile_QUERY_ID),loadPriority:OverviewTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},OverviewTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),query=queries[OverviewTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...OverviewTile_INSIGHT_PROPS,query}}),[query]);return(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})},MetricsTile_QUERY_ID=revenueAnalyticsLogic.nf.METRICS,MetricsTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(MetricsTile_QUERY_ID),loadPriority:MetricsTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},EMPTY_STATE_DETAIL_WITH_EVENTS=(0,jsx_runtime.jsxs)("span",{children:["Please try adjusting your query or filters. If you're using revenue events then make sure you've configured what the ",(0,jsx_runtime.jsx)("code",{children:"subscription_id"})," property is to properly track subscriptions/customer churn metrics."]}),MetricsTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{events}=(0,index_esm.useValues)(revenueAnalyticsSettingsLogic.m),query=queries[MetricsTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...MetricsTile_INSIGHT_PROPS,query},emptyStateHeading:"No data available",emptyStateDetail:events.length>0?EMPTY_STATE_DETAIL_WITH_EVENTS:"Please try adjusting your query or filters."}),[query,events.length]);return(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})},MRRTile_QUERY_ID=revenueAnalyticsLogic.nf.MRR,MRRTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(MRRTile_QUERY_ID),loadPriority:MRRTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},MRRTile_EMPTY_STATE_DETAIL_WITH_EVENTS=(0,jsx_runtime.jsxs)("span",{children:["Please try adjusting your query or filters. If you're using revenue events then make sure you've configured what the ",(0,jsx_runtime.jsx)("code",{children:"subscription_id"})," property is to properly track subscriptions/MRR."]}),MRRTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{events}=(0,index_esm.useValues)(revenueAnalyticsSettingsLogic.m),query=queries[MRRTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...MRRTile_INSIGHT_PROPS,query},emptyStateHeading:"No MRR data available",emptyStateDetail:events.length>0?MRRTile_EMPTY_STATE_DETAIL_WITH_EVENTS:"Please try adjusting your query or filters."}),[query,events.length]);return(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})};var geography_currency=__webpack_require__("../../frontend/src/lib/utils/geography/currency.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx");let TopCustomersTile_QUERY_ID=revenueAnalyticsLogic.nf.TOP_CUSTOMERS,TopCustomersTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(TopCustomersTile_QUERY_ID),loadPriority:TopCustomersTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},TopCustomersTile=()=>{let{baseCurrency}=(0,index_esm.useValues)(teamLogic.teamLogic),{queries,topCustomersDisplayMode,disabledGrowthModeSelection}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{setTopCustomersDisplayMode}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km),query=queries[TopCustomersTile_QUERY_ID],columns=(0,react.useMemo)(()=>({name:{title:"Name"},customer_id:{title:(0,jsx_runtime.jsxs)("span",{children:["Customer ID"," ",(0,jsx_runtime.jsx)(src.u,{title:"As seen in your Data Warehouse",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]})},month:{title:" ",width:"0px",render:()=>null},amount:{title:"Amount",render:_ref=>{let{value}=_ref;return(0,jsx_runtime.jsx)(AmountCell,{value:value,currency:baseCurrency})}}}),[baseCurrency]),context=(0,react.useMemo)(()=>({columns,insightProps:{...TopCustomersTile_INSIGHT_PROPS,query}}),[columns,query]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,jsx_runtime.jsxs)("h3",{className:"text-lg font-semibold",children:["Top customersÂ ",(0,jsx_runtime.jsx)(src.u,{title:"Top customers by revenue in the selected period.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]}),(0,jsx_runtime.jsx)(src.P4,{value:topCustomersDisplayMode,onChange:setTopCustomersDisplayMode,options:[{value:"line",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconLineGraph,{}),disabledReason:disabledGrowthModeSelection?"Select data that spans multiple months to see growth rate as a line graph":void 0},{value:"table",icon:(0,jsx_runtime.jsx)(icons.p$,{})}],size:"small"})]}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})]})},AmountCell=_ref2=>{let{value,currency}=_ref2,{symbol,isPrefix}=(0,geography_currency.jK)(currency);return(0,jsx_runtime.jsxs)("span",{children:[isPrefix?symbol:null,(0,lib_utils.Lc)(value,2,2),isPrefix?null:" "+symbol]})},scene={component:RevenueAnalyticsScene,logic:revenueAnalyticsLogic.Km,settingSectionId:"environment-revenue-analytics"},PRODUCT_NAME="Revenue Analytics",PRODUCT_KEY=types.Md.REVENUE_ANALYTICS,PRODUCT_DESCRIPTION="Track and analyze your revenue metrics to understand your business performance and growth.",PRODUCT_THING_NAME="revenue source";function RevenueAnalyticsScene(){let{dataWarehouseSources}=(0,index_esm.useValues)(revenueAnalyticsSettingsLogic.m),{revenueEnabledDataWarehouseSources}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),newSceneLayout=(0,useFeatureFlag.y)("NEW_SCENE_LAYOUT"),sourceRunningForTheFirstTime=revenueEnabledDataWarehouseSources?.find(source=>"Running"===source.status&&!source.last_run_at);return null===dataWarehouseSources?(0,jsx_runtime.jsx)(src.t2,{sceneLevel:!0}):(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeCollectionLogic.y,props:{key:revenueAnalyticsLogic.hP},children:(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:PRODUCT_NAME,description:PRODUCT_DESCRIPTION,resourceType:{type:"revenue_analytics"}}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsxs)(src.Vp,{type:"info",action:{children:"Send feedback",id:"revenue-analytics-feedback-button"},className:(0,css_classes.cn)(!newSceneLayout&&"mb-2"),children:[(0,jsx_runtime.jsx)("p",{children:"Revenue Analytics is in beta. Please let us know what you'd like to see here and/or report any issues directly to us!"}),(0,jsx_runtime.jsx)("p",{children:"At this stage, Revenue Analytics is optimized for small/medium-sized companies. If you process more than 20,000 transactions/month you might have performance issues."}),(0,jsx_runtime.jsx)("p",{children:"Similarly, at this stage we're optimized for customers running on a subscription model (mostly SaaS). If you're running a business where your revenue is not coming from recurring payments, you might find Revenue analytics to be less useful/more empty than expected."})]}),sourceRunningForTheFirstTime&&(0,jsx_runtime.jsxs)(src.Vp,{type:"success",dismissKey:`revenue-analytics-sync-in-progress-banner-${sourceRunningForTheFirstTime.id}`,action:{children:"Refresh",onClick:()=>window.location.reload()},className:(0,css_classes.cn)(!newSceneLayout&&"mb-2"),children:["One of your revenue data warehouse sources is running for the first time. ",(0,jsx_runtime.jsx)("br",{}),"This means you might not see all of your revenue data yet. ",(0,jsx_runtime.jsx)("br",{}),"We display partial data - most recent months first - while the initial sync is running. ",(0,jsx_runtime.jsx)("br",{}),"Refresh the page to see the latest data."]}),(0,jsx_runtime.jsx)(RevenueAnalyticsSceneContent,{})]})})}let RevenueAnalyticsSceneContent=()=>{let{hasRevenueTables,hasRevenueEvents}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),newSceneLayout=(0,useFeatureFlag.y)("NEW_SCENE_LAYOUT");return null===hasRevenueTables?(0,jsx_runtime.jsx)(src.t2,{sceneLevel:!0}):hasRevenueTables||hasRevenueEvents?(0,jsx_runtime.jsxs)("div",{className:(0,css_classes.cn)("RevenueAnalyticsDashboard",newSceneLayout&&"-mt-2"),children:[(0,jsx_runtime.jsx)(RevenueAnalyticsFilters,{}),(0,jsx_runtime.jsx)(RevenueAnalyticsTables,{})]}):(0,jsx_runtime.jsx)(Onboarding.T,{})},RevenueAnalyticsTables=()=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4 mt-4",children:[(0,jsx_runtime.jsx)(OverviewTile,{}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,jsx_runtime.jsx)(MRRTile,{}),(0,jsx_runtime.jsx)(GrossRevenueTile,{}),(0,jsx_runtime.jsx)(MetricsTile,{}),(0,jsx_runtime.jsx)(TopCustomersTile,{})]})]})}}]);