"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[52066],{"../../node_modules/.pnpm/ansi-colors@4.1.3/node_modules/ansi-colors/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{var process=__webpack_require__("../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js");let isObject=val=>null!==val&&"object"==typeof val&&!Array.isArray(val),ANSI_REGEX=/[\u001b\u009b][[\]#;?()]*(?:(?:(?:[^\W_]*;?[^\W_]*)\u0007)|(?:(?:[0-9]{1,4}(;[0-9]{0,4})*)?[~0-9=<>cf-nqrtyA-PRZ]))/g,hasColor=()=>void 0!==process&&"0"!==process.env.FORCE_COLOR,create=()=>{let colors={enabled:hasColor(),visible:!0,styles:{},keys:{}},ansi=style=>{let open=style.open=`\u001b[${style.codes[0]}m`,close=style.close=`\u001b[${style.codes[1]}m`,regex=style.regex=RegExp(`\\u001b\\[${style.codes[1]}m`,"g");return style.wrap=(input,newline)=>{input.includes(close)&&(input=input.replace(regex,close+open));let output=open+input+close;return newline?output.replace(/\r*\n/g,`${close}$&${open}`):output},style},wrap=(style,input,newline)=>"function"==typeof style?style(input):style.wrap(input,newline),style=(input,stack)=>{if(""===input||null==input)return"";if(!1===colors.enabled)return input;if(!1===colors.visible)return"";let str=""+input,nl=str.includes("\n"),n=stack.length;for(n>0&&stack.includes("unstyle")&&(stack=[...new Set(["unstyle",...stack])].reverse());n-- >0;)str=wrap(colors.styles[stack[n]],str,nl);return str},define=(name,codes,type)=>{colors.styles[name]=ansi({name,codes}),(colors.keys[type]||(colors.keys[type]=[])).push(name),Reflect.defineProperty(colors,name,{configurable:!0,enumerable:!0,set(value){colors.alias(name,value)},get(){let color=input=>style(input,color.stack);return Reflect.setPrototypeOf(color,colors),color.stack=this.stack?this.stack.concat(name):[name],color}})};return define("reset",[0,0],"modifier"),define("bold",[1,22],"modifier"),define("dim",[2,22],"modifier"),define("italic",[3,23],"modifier"),define("underline",[4,24],"modifier"),define("inverse",[7,27],"modifier"),define("hidden",[8,28],"modifier"),define("strikethrough",[9,29],"modifier"),define("black",[30,39],"color"),define("red",[31,39],"color"),define("green",[32,39],"color"),define("yellow",[33,39],"color"),define("blue",[34,39],"color"),define("magenta",[35,39],"color"),define("cyan",[36,39],"color"),define("white",[37,39],"color"),define("gray",[90,39],"color"),define("grey",[90,39],"color"),define("bgBlack",[40,49],"bg"),define("bgRed",[41,49],"bg"),define("bgGreen",[42,49],"bg"),define("bgYellow",[43,49],"bg"),define("bgBlue",[44,49],"bg"),define("bgMagenta",[45,49],"bg"),define("bgCyan",[46,49],"bg"),define("bgWhite",[47,49],"bg"),define("blackBright",[90,39],"bright"),define("redBright",[91,39],"bright"),define("greenBright",[92,39],"bright"),define("yellowBright",[93,39],"bright"),define("blueBright",[94,39],"bright"),define("magentaBright",[95,39],"bright"),define("cyanBright",[96,39],"bright"),define("whiteBright",[97,39],"bright"),define("bgBlackBright",[100,49],"bgBright"),define("bgRedBright",[101,49],"bgBright"),define("bgGreenBright",[102,49],"bgBright"),define("bgYellowBright",[103,49],"bgBright"),define("bgBlueBright",[104,49],"bgBright"),define("bgMagentaBright",[105,49],"bgBright"),define("bgCyanBright",[106,49],"bgBright"),define("bgWhiteBright",[107,49],"bgBright"),colors.ansiRegex=ANSI_REGEX,colors.hasColor=colors.hasAnsi=str=>(colors.ansiRegex.lastIndex=0,"string"==typeof str&&""!==str&&colors.ansiRegex.test(str)),colors.alias=(name,color)=>{let fn="string"==typeof color?colors[color]:color;if("function"!=typeof fn)throw TypeError("Expected alias to be the name of an existing color (string) or a function");fn.stack||(Reflect.defineProperty(fn,"name",{value:name}),colors.styles[name]=fn,fn.stack=[name]),Reflect.defineProperty(colors,name,{configurable:!0,enumerable:!0,set(value){colors.alias(name,value)},get(){let color=input=>style(input,color.stack);return Reflect.setPrototypeOf(color,colors),color.stack=this.stack?this.stack.concat(fn.stack):fn.stack,color}})},colors.theme=custom=>{if(!isObject(custom))throw TypeError("Expected theme to be an object");for(let name of Object.keys(custom))colors.alias(name,custom[name]);return colors},colors.alias("unstyle",str=>"string"==typeof str&&""!==str?(colors.ansiRegex.lastIndex=0,str.replace(colors.ansiRegex,"")):""),colors.alias("noop",str=>str),colors.none=colors.clear=colors.noop,colors.stripColor=colors.unstyle,colors.symbols=__webpack_require__("../../node_modules/.pnpm/ansi-colors@4.1.3/node_modules/ansi-colors/symbols.js"),colors.define=define,colors};module.exports=create(),module.exports.create=create},"../../node_modules/.pnpm/ansi-colors@4.1.3/node_modules/ansi-colors/symbols.js":(module,__unused_webpack_exports,__webpack_require__)=>{var process=__webpack_require__("../../node_modules/.pnpm/process@0.11.10/node_modules/process/browser.js");let isHyper=void 0!==process&&"Hyper"===process.env.TERM_PROGRAM,isWindows=void 0!==process&&"win32"===process.platform,isLinux=void 0!==process&&"linux"===process.platform,common={ballotDisabled:"☒",ballotOff:"☐",ballotOn:"☑",bullet:"•",bulletWhite:"◦",fullBlock:"█",heart:"❤",identicalTo:"≡",line:"─",mark:"※",middot:"·",minus:"－",multiplication:"×",obelus:"÷",pencilDownRight:"✎",pencilRight:"✏",pencilUpRight:"✐",percent:"%",pilcrow2:"❡",pilcrow:"¶",plusMinus:"±",question:"?",section:"§",starsOff:"☆",starsOn:"★",upDownArrow:"↕"},windows=Object.assign({},common,{check:"√",cross:"×",ellipsisLarge:"...",ellipsis:"...",info:"i",questionSmall:"?",pointer:">",pointerSmall:"»",radioOff:"( )",radioOn:"(*)",warning:"‼"}),other=Object.assign({},common,{ballotCross:"✘",check:"✔",cross:"✖",ellipsisLarge:"⋯",ellipsis:"…",info:"ℹ",questionFull:"？",questionSmall:"﹖",pointer:isLinux?"▸":"❯",pointerSmall:isLinux?"‣":"›",radioOff:"◯",radioOn:"◉",warning:"⚠"});module.exports=isWindows&&!isHyper?windows:other,Reflect.defineProperty(module.exports,"common",{enumerable:!1,value:common}),Reflect.defineProperty(module.exports,"windows",{enumerable:!1,value:windows}),Reflect.defineProperty(module.exports,"other",{enumerable:!1,value:other})},"../../products/logs/frontend/LogsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LogsScene:()=>LogsScene,scene:()=>scene});var ansi_colors=__webpack_require__("../../node_modules/.pnpm/ansi-colors@4.1.3/node_modules/ansi-colors/index.js"),ansi_colors_default=__webpack_require__.n(ansi_colors),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.33.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),Sparkline=__webpack_require__("../../frontend/src/lib/components/Sparkline.tsx"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),fast_deep_equal=__webpack_require__("../../node_modules/.pnpm/fast-deep-equal@3.1.3/node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),utils=__webpack_require__("../../products/error_tracking/frontend/utils.ts"),api=__webpack_require__("../../frontend/src/lib/api.ts"),universalFiltersLogic=__webpack_require__("../../frontend/src/lib/components/UniversalFilters/universalFiltersLogic.ts"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts");let RELATIVE_DATE_REGEX=/(^-?)(\d+)([hdwmy])$/,zoomDateRelative=(date,multiplier)=>{if(!date)return null;let match=date.match(RELATIVE_DATE_REGEX);if(match){let[,sign,amount,unit]=match,newAmount=parseInt(amount)*multiplier;return`${sign}${newAmount}${unit}`}return null},zoomDateRange=(dateRange,multiplier)=>{var _dateStringToDayJs,_dateStringToDayJs2;if(dateRange.date_from&&!dateRange.date_to){let newDateFrom=zoomDateRelative(dateRange.date_from,multiplier);if(newDateFrom)return{date_from:newDateFrom,date_to:null}}let start=dateRange.date_from&&null!==(_dateStringToDayJs=(0,lib_utils.FZ)(dateRange.date_from))&&void 0!==_dateStringToDayJs?_dateStringToDayJs:(0,dayjs.Bv)().subtract(1,"hour"),diffMins=(dateRange.date_to&&null!==(_dateStringToDayJs2=(0,lib_utils.FZ)(dateRange.date_to))&&void 0!==_dateStringToDayJs2?_dateStringToDayJs2:(0,dayjs.Bv)()).diff(start,"minutes"),centerDate=start.add(.5*diffMins,"minutes"),newStart=centerDate.subtract(.5*diffMins*multiplier,"minutes"),newEnd=centerDate.add(.5*diffMins*multiplier,"minutes");return{date_from:newStart.format("YYYY-MM-DDTHH:mm:ss.SSSZ"),date_to:newEnd.format("YYYY-MM-DDTHH:mm:ss.SSSZ")}},DEFAULT_DATE_RANGE={date_from:"-1h",date_to:null},DEFAULT_SEVERITY_LEVELS=[],DEFAULT_SERVICE_NAMES=[],logsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","logs","frontend","logsLogic"]),(0,kea_router_lib.urlToAction)(_ref=>{let{actions,values}=_ref;return{"*":(_,params)=>{params.dateRange&&!fast_deep_equal_default()(params.dateRange,values.dateRange)&&actions.setDateRange(params.dateRange),params.filterGroup&&!fast_deep_equal_default()(params.filterGroup,values.filterGroup)&&actions.setFilterGroup(params.filterGroup,!1),params.searchTerm&&!fast_deep_equal_default()(params.searchTerm,values.searchTerm)&&actions.setSearchTerm(params.searchTerm),params.severityLevels&&!fast_deep_equal_default()(params.severityLevels,values.severityLevels)&&actions.setSeverityLevels(params.severityLevels),params.serviceNames&&!fast_deep_equal_default()(params.serviceNames,values.serviceNames)&&actions.setServiceNames(params.serviceNames)}}}),(0,kea_router_lib.actionToUrl)(_ref2=>{let{actions,values}=_ref2,buildURL=()=>(0,utils.qI)(kea_router_lib.router,params=>((0,utils.aM)(params,"searchTerm",values.searchTerm,""),(0,utils.aM)(params,"filterGroup",values.filterGroup,universalFiltersLogic.Y),(0,utils.aM)(params,"dateRange",values.dateRange,DEFAULT_DATE_RANGE),(0,utils.aM)(params,"severityLevels",values.severityLevels,DEFAULT_SEVERITY_LEVELS),(0,utils.aM)(params,"serviceNames",values.serviceNames,DEFAULT_SERVICE_NAMES),actions.runQuery(300),params));return{setDateRange:()=>buildURL(),setFilterGroup:()=>buildURL(),setSearchTerm:()=>buildURL(),setSeverityLevels:()=>buildURL(),setServiceNames:()=>buildURL()}}),(0,index_esm.actions)({runQuery:debounce=>({debounce}),cancelInProgressLogs:logsAbortController=>({logsAbortController}),cancelInProgressSparkline:sparklineAbortController=>({sparklineAbortController}),setLogsAbortController:logsAbortController=>({logsAbortController}),setSparklineAbortController:sparklineAbortController=>({sparklineAbortController}),setDateRange:dateRange=>({dateRange}),setOrderBy:orderBy=>({orderBy}),setSearchTerm:searchTerm=>({searchTerm}),setSeverityLevels:severityLevels=>({severityLevels}),setServiceNames:serviceNames=>({serviceNames}),setWrapBody:wrapBody=>({wrapBody}),setFilterGroup:function(filterGroup){let openFilterOnInsert=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return{filterGroup,openFilterOnInsert}},toggleAttributeBreakdown:key=>({key}),setExpandedAttributeBreaksdowns:expandedAttributeBreaksdowns=>({expandedAttributeBreaksdowns}),zoomDateRange:multiplier=>({multiplier})}),(0,index_esm.reducers)({dateRange:[DEFAULT_DATE_RANGE,{persist:!0},{setDateRange:(_,_ref3)=>{let{dateRange}=_ref3;return dateRange}}],orderBy:["latest",{persist:!0},{setOrderBy:(_,_ref4)=>{let{orderBy}=_ref4;return orderBy}}],searchTerm:["",{persist:!0},{setSearchTerm:(_,_ref5)=>{let{searchTerm}=_ref5;return searchTerm}}],severityLevels:[DEFAULT_SEVERITY_LEVELS,{persist:!0},{setSeverityLevels:(_,_ref6)=>{let{severityLevels}=_ref6;return severityLevels}}],serviceNames:[DEFAULT_SERVICE_NAMES,{persist:!0},{setServiceNames:(_,_ref7)=>{let{serviceNames}=_ref7;return serviceNames}}],filterGroup:[universalFiltersLogic.Y,{persist:!1},{setFilterGroup:(_,_ref8)=>{let{filterGroup}=_ref8;return filterGroup}}],wrapBody:[!0,{setWrapBody:(_,_ref9)=>{let{wrapBody}=_ref9;return wrapBody}}],logsAbortController:[null,{setLogsAbortController:(_,_ref10)=>{let{logsAbortController}=_ref10;return logsAbortController}}],sparklineAbortController:[null,{setSparklineAbortController:(_,_ref11)=>{let{sparklineAbortController}=_ref11;return sparklineAbortController}}],hasRunQuery:[!1,{fetchLogsSuccess:()=>!0,fetchLogsFailure:()=>!0}],logsLoading:[!1,{fetchLogs:()=>!0,fetchLogsSuccess:()=>!1,fetchLogsFailure:()=>!0}],sparklineLoading:[!1,{fetchSparkline:()=>!0,fetchSparklineSuccess:()=>!1,fetchSparklineFailure:()=>!0}],openFilterOnInsert:[!1,{setFilterGroup:(_,_ref12)=>{let{openFilterOnInsert}=_ref12;return openFilterOnInsert}}],expandedAttributeBreaksdowns:[[],{setExpandedAttributeBreaksdowns:(_,_ref13)=>{let{expandedAttributeBreaksdowns}=_ref13;return expandedAttributeBreaksdowns}}]}),(0,lib.loaders)(_ref14=>{let{values,actions}=_ref14;return{logs:[[],{fetchLogs:async()=>{let logsController=new AbortController,signal=logsController.signal;actions.cancelInProgressLogs(logsController);let response=await api.ZP.logs.query({query:{limit:99,offset:values.logs.length,orderBy:values.orderBy,dateRange:values.dateRange,searchTerm:values.searchTerm,filterGroup:values.filterGroup,severityLevels:values.severityLevels,serviceNames:values.serviceNames},signal});return actions.setLogsAbortController(null),response.results.forEach(row=>{Object.keys(row.attributes).forEach(key=>{let value=row.attributes[key];row.attributes[key]="string"==typeof value?value:JSON.stringify(value)})}),response.results}}],sparkline:[[],{fetchSparkline:async()=>{let sparklineController=new AbortController,signal=sparklineController.signal;actions.cancelInProgressSparkline(sparklineController);let response=await api.ZP.logs.sparkline({query:{orderBy:values.orderBy,dateRange:values.dateRange,searchTerm:values.searchTerm,filterGroup:values.filterGroup,severityLevels:values.severityLevels,serviceNames:values.serviceNames},signal});return actions.setSparklineAbortController(null),response}}]}}),(0,index_esm.selectors)(()=>({sparklineData:[s=>[s.sparkline],sparkline=>{let lastTime="",i=-1,labels=[];return{data:Object.entries(sparkline.reduce((accumulator,currentItem)=>{currentItem.time!==lastTime&&(labels.push((0,lib_utils.bo)(currentItem.time)),lastTime=currentItem.time,i++);let key=currentItem.level;return accumulator[key]||(accumulator[key]=Array(sparkline.length)),accumulator[key][i]=currentItem.count,accumulator},{})).map(_ref15=>{let[level,data]=_ref15;return{name:level,values:data,color:({fatal:"danger-dark",error:"danger",warn:"warning",info:"brand-blue",debug:"muted",trace:"muted-alt"})[level]}}).filter(series=>series.values.reduce((a,b)=>a+b)>0),labels}}]})),(0,index_esm.listeners)(_ref16=>{let{values,actions}=_ref16;return{runQuery:async(_ref17,breakpoint)=>{let{debounce}=_ref17;debounce&&await breakpoint(debounce),actions.fetchLogs(),actions.fetchSparkline()},cancelInProgressLogs:_ref18=>{let{logsAbortController}=_ref18;null!==values.logsAbortController&&values.logsAbortController.abort("new query started"),actions.setLogsAbortController(logsAbortController)},cancelInProgressSparkline:_ref19=>{let{sparklineAbortController}=_ref19;null!==values.sparklineAbortController&&values.sparklineAbortController.abort("new query started"),actions.setSparklineAbortController(sparklineAbortController)},toggleAttributeBreakdown:_ref20=>{let{key}=_ref20,breakdowns=[...values.expandedAttributeBreaksdowns],index=breakdowns.indexOf(key);index>=0?breakdowns.splice(index,1):breakdowns.push(key),actions.setExpandedAttributeBreaksdowns(breakdowns)},zoomDateRange:_ref21=>{let{multiplier}=_ref21,newDateRange=zoomDateRange(values.dateRange,multiplier);actions.setDateRange(newDateRange)}}})]),attributeBreakdownLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.attribute),(0,index_esm.path)(key=>["products","logs","frontend","logsAttributeBreakdownsLogic",key]),(0,index_esm.connect)(()=>({values:[logsLogic,["logs"]]})),(0,index_esm.selectors)(_ref=>{let{props}=_ref;return{logCount:[s=>[s.logs],logs=>logs.length],attributeValues:[s=>[s.logs],logs=>logs.filter(l=>props.attribute in l.attributes).map(l=>l.attributes[props.attribute])],breakdowns:[s=>[s.attributeValues],attributeValues=>attributeValues.reduce((acc,value)=>(acc[value]=(acc[value]||0)+1,acc),{})]}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let AttributeBreakdowns=_ref=>{let{attribute,addFilter}=_ref,logic=attributeBreakdownLogic({attribute}),{attributeValues,logCount,breakdowns}=(0,index_esm.useValues)(logic),dataSource=Object.entries(breakdowns).sort((_ref2,_ref3)=>{let[,c1]=_ref2,[,c2]=_ref3;return c2-c1}).slice(0,10).map(_ref4=>{let[value,count]=_ref4;return{value,count,percentage:(count/attributeValues.length*100).toFixed(0)}});return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col p-2 gap-y-2",children:[attributeValues.length," of the ",logCount," logs have the label ",attribute,(0,jsx_runtime.jsx)(src.g3,{hideScrollbar:!0,dataSource:dataSource,size:"small",columns:[{key:"actions",width:0,render:(_,record)=>(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-0",children:[(0,jsx_runtime.jsx)(src.Jp,{tooltip:"Add as filter",size:"xsmall",onClick:()=>addFilter(attribute,record.value),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSquare,{})}),(0,jsx_runtime.jsx)(src.Jp,{tooltip:"Exclude as filter",size:"xsmall",onClick:()=>addFilter(attribute,record.value,types.WV.IsNot),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconMinusSquare,{})})]})},{title:"Count",key:"count",dataIndex:"count",width:0},{title:"Percentage",key:"percentage",dataIndex:"percentage",width:0,render:value=>`${value}%`},{title:"Value",key:"value",dataIndex:"value"}]})]})};var TaxonomicFilter_types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),UniversalFilters=__webpack_require__("../../frontend/src/lib/components/UniversalFilters/UniversalFilters.tsx"),UniversalFilters_utils=__webpack_require__("../../frontend/src/lib/components/UniversalFilters/utils.ts");let AttributesFilter=()=>{let{filterGroup}=(0,index_esm.useValues)(logsLogic),{setFilterGroup}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsx)(UniversalFilters.Z,{rootKey:"logs",group:filterGroup,taxonomicGroupTypes:[TaxonomicFilter_types.t.LogAttributes],onChange:filterGroup=>setFilterGroup(filterGroup),children:(0,jsx_runtime.jsx)(NestedFilterGroup,{})})},NestedFilterGroup=()=>{let{openFilterOnInsert}=(0,index_esm.useValues)(logsLogic),{filterGroup}=(0,index_esm.useValues)(universalFiltersLogic.d),{replaceGroupValue,removeGroupValue}=(0,index_esm.useActions)(universalFiltersLogic.d);return(0,jsx_runtime.jsx)("div",{className:"flex gap-1 items-center flex-wrap",children:filterGroup.values.map((filterOrGroup,index)=>(0,UniversalFilters_utils.pU)(filterOrGroup)?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)(UniversalFilters.Z.Group,{index:index,group:filterOrGroup,children:[(0,jsx_runtime.jsx)(UniversalFilters.Z.AddFilterButton,{className:"bg-surface-primary",size:"small",type:"secondary"}),(0,jsx_runtime.jsx)(NestedFilterGroup,{})]},index)}):(0,jsx_runtime.jsx)(UniversalFilters.Z.Value,{index:index,filter:filterOrGroup,initiallyOpen:openFilterOnInsert,onRemove:()=>removeGroupValue(index),onChange:value=>replaceGroupValue(index,value),className:"h-[33px]"},index))})};var DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx");let dateMapping=[{key:__webpack_require__("../../frontend/src/lib/components/DateFilter/types.ts").Q2,values:[]},{key:"Last 30 minutes",values:["-30M"],getFormattedDate:date=>date.subtract(30,"minute").format(lib_utils.a1),defaultInterval:"minute"},{key:"Last 1 hours",values:["-1h"],getFormattedDate:date=>(0,lib_utils._Q)(date.subtract(1,"h"),date.endOf("d")),defaultInterval:"hour"},{key:"Last 4 hours",values:["-4h"],getFormattedDate:date=>(0,lib_utils._Q)(date.subtract(4,"h"),date.endOf("d")),defaultInterval:"hour"},{key:"Last 24 hours",values:["-24h"],getFormattedDate:date=>(0,lib_utils._Q)(date.subtract(24,"h"),date.endOf("d")),defaultInterval:"hour"},{key:"Last 7 days",values:["-7d"],getFormattedDate:date=>(0,lib_utils._Q)(date.subtract(7,"d"),date.endOf("d")),defaultInterval:"day"},{key:"Last 30 days",values:["-30d"],getFormattedDate:date=>(0,lib_utils._Q)(date.subtract(30,"d"),date.endOf("d")),defaultInterval:"day"}],DateRangeFilter=()=>{let{dateRange}=(0,index_esm.useValues)(logsLogic),{setDateRange}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsx)("span",{className:"rounded bg-surface-primary",children:(0,jsx_runtime.jsx)(DateFilter.f,{size:"small",dateFrom:dateRange.date_from,dateTo:dateRange.date_to,dateOptions:dateMapping,onChange:(changedDateFrom,changedDateTo)=>{setDateRange({date_from:changedDateFrom,date_to:changedDateTo})},allowTimePrecision:!0,allowedRollingDateOptions:["minutes","hours","days","weeks","months"]})})},SearchTermFilter=()=>{let{searchTerm}=(0,index_esm.useValues)(logsLogic),{setSearchTerm}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsx)("span",{className:"rounded bg-surface-primary",children:(0,jsx_runtime.jsx)(src.DF,{size:"small",value:searchTerm,onChange:value=>setSearchTerm(value),placeholder:"Search logs..."})})};var PropertyValue=__webpack_require__("../../frontend/src/lib/components/PropertyFilters/components/PropertyValue.tsx"),projectLogic=__webpack_require__("../../frontend/src/scenes/projectLogic.ts");let ServiceFilter=()=>{let{serviceNames,dateRange}=(0,index_esm.useValues)(logsLogic),{currentProjectId}=(0,index_esm.useValues)(projectLogic.K),{setServiceNames}=(0,index_esm.useActions)(logsLogic),endpoint=(0,kea_router_lib.combineUrl)(`api/environments/${currentProjectId}/logs/values`,{key:"service.name",dateRange}).url;return(0,jsx_runtime.jsx)("span",{className:"rounded bg-surface-primary min-w-[150px]",children:(0,jsx_runtime.jsx)(PropertyValue.O,{size:"small",endpoint:endpoint,operator:types.WV.Exact,propertyKey:"service_name",type:types.FT.Log,value:serviceNames,onSet:setServiceNames,placeholder:"Service name",preloadValues:!0})})},options={trace:"Trace",info:"Info",debug:"Debug",warn:"Warn",error:"Error",fatal:"Fatal"},SeverityLevelsFilter=()=>{let{severityLevels}=(0,index_esm.useValues)(logsLogic),{setSeverityLevels}=(0,index_esm.useActions)(logsLogic),onClick=level=>{let levels=[...severityLevels],index=levels.indexOf(level);index>-1?levels.splice(index,1):levels.push(level),setSeverityLevels(levels)},displayLevels=severityLevels.length>0?severityLevels.map(l=>(0,lib_utils.fm)(l)).join(", "):"All levels";return(0,jsx_runtime.jsx)("span",{className:"rounded bg-surface-primary",children:(0,jsx_runtime.jsx)(src.d6,{closeOnClickInside:!1,items:Object.entries(options).map(_ref=>{let[key,label]=_ref;return{label,onClick:()=>onClick(key),active:severityLevels.includes(key)}}),children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFilter,{}),size:"small",type:"secondary",className:"whitespace-nowrap",children:displayLevels})})})},scene={component:LogsScene};function LogsScene(){let{wrapBody,logs,sparklineData,logsLoading,sparklineLoading}=(0,index_esm.useValues)(logsLogic),{runQuery}=(0,index_esm.useActions)(logsLogic);return(0,react.useEffect)(()=>{runQuery()},[runQuery]),(0,jsx_runtime.jsxs)(SceneContent._,{className:"h-screen",children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:"Logs",resourceType:{type:"logs"}}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(Filters,{}),(0,jsx_runtime.jsxs)("div",{className:"relative h-40 flex flex-col",children:[sparklineData.data.length>0?(0,jsx_runtime.jsx)(Sparkline.b,{labels:sparklineData.labels,data:sparklineData.data,className:"w-full flex-1"}):sparklineLoading?null:(0,jsx_runtime.jsx)("div",{className:"flex-1text-muted text-center",children:"No data"}),sparklineLoading&&(0,jsx_runtime.jsx)(src.t2,{})]}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(DisplayOptions,{}),(0,jsx_runtime.jsx)("div",{className:"flex-1 overflow-y-auto border rounded bg-white",children:(0,jsx_runtime.jsx)(src.g3,{hideScrollbar:!0,dataSource:logs,loading:logsLoading,size:"small",embedded:!0,columns:[{title:"Timestamp",key:"timestamp",dataIndex:"timestamp",width:0,render:timestamp=>(0,jsx_runtime.jsx)(TZLabel.w,{time:timestamp+"Z"})},{title:"Level",key:"severity_text",dataIndex:"severity_text",width:0,render:(_,record)=>(0,jsx_runtime.jsx)(LogTag,{level:record.severity_text})},{title:"Message",key:"body",dataIndex:"body",render:body=>(0,jsx_runtime.jsx)("div",{className:(0,css_classes.cn)(wrapBody?"":"whitespace-nowrap"),children:ansi_colors_default().unstyle(body)})}],expandable:{noIndent:!0,expandedRowRender:log=>(0,jsx_runtime.jsx)(ExpandedLog,{log:log})}})})]})}let ExpandedLog=_ref=>{let{log}=_ref,{filterGroup,expandedAttributeBreaksdowns}=(0,index_esm.useValues)(logsLogic),{setFilterGroup,toggleAttributeBreakdown}=(0,index_esm.useActions)(logsLogic),rows=Object.entries(log.attributes).map(_ref2=>{let[key,value]=_ref2;return{key,value}}),addFilter=function(key,value){let operator=arguments.length>2&&void 0!==arguments[2]?arguments[2]:types.WV.Exact,newGroup={...filterGroup.values[0]};newGroup.values.push({key,value:[value],operator:operator,type:types.FT.Log}),setFilterGroup({...filterGroup,values:[newGroup]},!1)};return(0,jsx_runtime.jsx)(src.g3,{embedded:!0,showHeader:!1,columns:[{key:"actions",width:0,render:(_,record)=>(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-0",children:[(0,jsx_runtime.jsx)(src.Jp,{tooltip:"Add as filter",size:"xsmall",onClick:()=>addFilter(record.key,record.value),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSquare,{})}),(0,jsx_runtime.jsx)(src.Jp,{tooltip:"Exclude as filter",size:"xsmall",onClick:()=>addFilter(record.key,record.value,types.WV.IsNot),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconMinusSquare,{})}),(0,jsx_runtime.jsx)(src.Jp,{tooltip:"Show breakdown",size:"xsmall",onClick:()=>toggleAttributeBreakdown(record.key),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconFilter,{})})]})},{title:"Key",key:"key",dataIndex:"key",width:0},{title:"Value",key:"value",dataIndex:"value"}],dataSource:rows,expandable:{noIndent:!0,showRowExpansionToggle:!1,isRowExpanded:record=>expandedAttributeBreaksdowns.includes(record.key),expandedRowRender:record=>(0,jsx_runtime.jsx)(AttributeBreakdowns,{attribute:record.key,addFilter:addFilter})}})},LogTag=_ref3=>{let{level}=_ref3;return(0,jsx_runtime.jsx)(src.oe,{type:{debug:"completion",info:"caution",warn:"warning",error:"danger"}[level],children:level})},Filters=()=>{let{logsLoading}=(0,index_esm.useValues)(logsLogic),{runQuery,zoomDateRange}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-y-1.5",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between gap-y-2 flex-wrap-reverse",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-1 gap-y-2 flex-wrap",children:[(0,jsx_runtime.jsx)(SeverityLevelsFilter,{}),(0,jsx_runtime.jsx)(ServiceFilter,{}),(0,jsx_runtime.jsx)(AttributesFilter,{})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-1",children:[(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconMinusSquare,{}),type:"secondary",onClick:()=>zoomDateRange(2)}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSquare,{}),type:"secondary",onClick:()=>zoomDateRange(.5)}),(0,jsx_runtime.jsx)(DateRangeFilter,{}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(icons.tr,{}),type:"secondary",onClick:()=>runQuery(),loading:logsLoading,children:logsLoading?"Loading...":"Search"})]})]}),(0,jsx_runtime.jsx)(SearchTermFilter,{})]})},DisplayOptions=()=>{let{orderBy,wrapBody}=(0,index_esm.useValues)(logsLogic),{setOrderBy,setWrapBody}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-2",children:[(0,jsx_runtime.jsx)(src.P4,{value:orderBy,onChange:setOrderBy,options:[{value:"earliest",label:"Earliest"},{value:"latest",label:"Latest"}],size:"small"}),(0,jsx_runtime.jsx)(src.Hw,{checked:wrapBody,bordered:!0,onChange:setWrapBody,label:"Wrap message",size:"small"})]})}}}]);