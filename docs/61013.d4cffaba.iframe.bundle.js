"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[61013],{"../../frontend/src/scenes/groups/Groups.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Groups:()=>Groups,GroupsScene:()=>GroupsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),groupsAccessLogic=__webpack_require__("../../frontend/src/lib/introductions/groupsAccessLogic.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),GroupsIntroduction=__webpack_require__("../../frontend/src/scenes/groups/GroupsIntroduction.tsx"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),groupsModel=__webpack_require__("../../frontend/src/models/groupsModel.ts"),utils=__webpack_require__("../../frontend/src/queries/nodes/DataTable/utils.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.257.0_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js");let INITIAL_GROUPS_FILTER=[],persistConfig=groupTypeIndex=>({persist:!0,prefix:`${window.POSTHOG_APP_CONTEXT?.current_team?.id}__group_${groupTypeIndex}__`}),groupsListLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.groupTypeIndex),(0,index_esm.path)(["groups","groupsListLogic"]),(0,index_esm.connect)(()=>({values:[teamLogic.teamLogic,["currentTeamId"],groupsModel.$,["groupTypes","aggregationLabel"],groupsAccessLogic.e,["groupsEnabled"]]})),(0,index_esm.actions)(()=>({setQuery:query=>({query}),setQueryWasModified:queryWasModified=>({queryWasModified}),setGroupFilters:filters=>({filters})})),(0,index_esm.reducers)(_ref=>{let{props}=_ref;return{query:[(_,props)=>({kind:schema_general.OH.DataTableNode,source:{kind:schema_general.OH.GroupsQuery,select:void 0,group_type_index:props.groupTypeIndex},full:!0,showEventFilter:!1,showPersistentColumnConfigurator:!0,propertiesViaUrl:!0}),{setQuery:(_,_ref2)=>{let{query}=_ref2;return query}}],groupFilters:[INITIAL_GROUPS_FILTER,persistConfig(props.groupTypeIndex),{setGroupFilters:(_,_ref3)=>{let{filters}=_ref3;return filters},setQuery:(state,_ref4)=>{let{query}=_ref4;return query.source.kind===schema_general.OH.GroupsQuery&&query.source.properties?query.source.properties:state}}],queryWasModified:[!1,{setQueryWasModified:(_,_ref5)=>{let{queryWasModified}=_ref5;return queryWasModified}}]}}),(0,index_esm.listeners)(_ref6=>{let{actions}=_ref6;return{setQuery:()=>{actions.setQueryWasModified(!0)}}}),(0,lib.actionToUrl)(_ref7=>{let{values,props}=_ref7;return{setQuery:()=>{let searchParams={};return values.query.source.kind===schema_general.OH.GroupsQuery&&values.query.source.properties?.length&&(searchParams[`properties_${props.groupTypeIndex}`]=JSON.stringify(values.query.source.properties)),[lib.router.values.location.pathname,searchParams,void 0,{replace:!0}]},setGroupFilters:()=>{let searchParams={};return values.groupFilters?.length&&(searchParams[`properties_${props.groupTypeIndex}`]=JSON.stringify(values.groupFilters)),[lib.router.values.location.pathname,searchParams,void 0,{replace:!0}]}}}),(0,lib.urlToAction)(_ref8=>{let{actions,values,props}=_ref8;return{[`/groups/${props.groupTypeIndex}`]:(_,searchParams)=>{if(values.query.source.kind!==schema_general.OH.GroupsQuery)return;let properties=searchParams[`properties_${props.groupTypeIndex}`];if(properties)try{let parsedProperties=JSON.parse(properties);parsedProperties&&Array.isArray(parsedProperties)&&actions.setQuery({...values.query,source:{...values.query.source,properties:parsedProperties}})}catch(error){dist_module.ZP.captureException("Failed to parse properties",error)}else actions.setQuery({...values.query,source:{...values.query.source,properties:values.groupFilters}})}}}),(0,index_esm.afterMount)(_ref9=>{let{actions,values}=_ref9;if(values.query.source.kind===schema_general.OH.GroupsQuery&&void 0===values.query.source.select){let defaultColumns=values.groupTypes.get(values.query.source.group_type_index)?.default_columns;actions.setQuery({...values.query,source:{...values.query.source,select:null!=defaultColumns?defaultColumns:(0,utils.Qi)(schema_general.OH.GroupsQuery)}}),actions.setQueryWasModified(!1)}})]);var groupsSceneLogic=__webpack_require__("../../frontend/src/scenes/groups/groupsSceneLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function Groups(_ref){let{groupTypeIndex}=_ref,{groupTypeName,groupTypeNamePlural}=(0,index_esm.useValues)(groupsSceneLogic.C),{query,queryWasModified}=(0,index_esm.useValues)(groupsListLogic({groupTypeIndex})),{setQuery}=(0,index_esm.useActions)(groupsListLogic({groupTypeIndex})),{groupsAccessStatus}=(0,index_esm.useValues)(groupsAccessLogic.e);if(void 0===groupTypeIndex)throw Error("groupTypeIndex is undefined");return groupsAccessStatus==groupsAccessLogic.Q.HasAccess||groupsAccessStatus==groupsAccessLogic.Q.HasGroupTypes||groupsAccessStatus==groupsAccessLogic.Q.NoAccess?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(GroupsIntroduction.S,{})}):(0,jsx_runtime.jsx)(Query.A,{query:query,setQuery:setQuery,context:{refresh:"blocking",emptyStateHeading:queryWasModified?`No ${groupTypeNamePlural} found`:`No ${groupTypeNamePlural} exist because none have been identified`,emptyStateDetail:queryWasModified?"Try changing the date range or property filters.":(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Go to the"," ",(0,jsx_runtime.jsx)(Link.r,{to:"https://posthog.com/docs/product-analytics/group-analytics#how-to-create-groups",children:"group analytics docs"})," ","to learn what needs to be done"]}),columns:{group_name:{title:groupTypeName}},groupTypeLabel:groupTypeNamePlural},dataAttr:"groups-table"})}function GroupsScene(){let{groupTypeIndex}=(0,index_esm.useValues)(groupsSceneLogic.C);return(0,jsx_runtime.jsx)(Groups,{groupTypeIndex:groupTypeIndex})}let scene={component:GroupsScene,logic:groupsSceneLogic.C}},"../../frontend/src/scenes/groups/groupsSceneLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>groupsSceneLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/introductions/groupsAccessLogic.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/utils.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_models_groupsModel__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/models/groupsModel.ts");let groupsSceneLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","groups","groupsSceneLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[_models_groupsModel__WEBPACK_IMPORTED_MODULE_5__.$,["aggregationLabel","groupTypes","groupTypesLoading","groupsAccessStatus"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setGroupTypeIndex:groupTypeIndex=>({groupTypeIndex}),setTabKey:tabKey=>({tabKey})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({groupTypeIndex:[0,{setGroupTypeIndex:(_,_ref)=>{let{groupTypeIndex}=_ref;return groupTypeIndex}}],tabKey:["persons",{setTabKey:(_,_ref2)=>{let{tabKey}=_ref2;return tabKey}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({tabs:[()=>[],()=>[]],activeTab:[s=>[s.tabs,s.tabKey],(tabs,tabKey)=>{var _tabs$find;return null!==(_tabs$find=tabs.find(x=>x.key===tabKey))&&void 0!==_tabs$find?_tabs$find:null}],groupTypeName:[s=>[s.aggregationLabel,s.groupTypeIndex],(aggregationLabel,groupTypeIndex)=>aggregationLabel(groupTypeIndex).singular],groupTypeNamePlural:[s=>[s.aggregationLabel,s.groupTypeIndex],(aggregationLabel,groupTypeIndex)=>aggregationLabel(groupTypeIndex).plural],breadcrumbs:[s=>[s.groupTypeIndex,s.groupTypeNamePlural,s.showGroupsIntroductionPage],(groupTypeIndex,groupTypeNamePlural,showGroupsIntroductionPage)=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.Groups,name:showGroupsIntroductionPage?"Groups":(0,lib_utils__WEBPACK_IMPORTED_MODULE_2__.fm)(groupTypeNamePlural),path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.groups(groupTypeIndex)}]],showGroupsIntroductionPage:[s=>[s.groupsAccessStatus],groupsAccessStatus=>[lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_1__.Q.HasAccess,lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_1__.Q.HasGroupTypes,lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_1__.Q.NoAccess].includes(groupsAccessStatus)]})])}}]);