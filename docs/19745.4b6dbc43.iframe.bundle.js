"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[19745],{"./frontend/src/scenes/pipeline/PipelineNodeNew.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PipelineNodeNew:()=>PipelineNodeNew,scene:()=>scene});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.8.4_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-router@3.2.0_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),lib_components_PayGateMini_PayGateMini__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),react__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),scenes_data_warehouse_new_NewSourceWizard__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/data-warehouse/new/NewSourceWizard.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/scenes/urls.ts"),_types__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/types.ts"),_destinations_NewDestinations__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/scenes/pipeline/destinations/NewDestinations.tsx"),_frontendAppsLogic__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/scenes/pipeline/frontendAppsLogic.tsx"),_hogfunctions_HogFunctionConfiguration__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./frontend/src/scenes/pipeline/hogfunctions/HogFunctionConfiguration.tsx"),_PipelineBatchExportConfiguration__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./frontend/src/scenes/pipeline/PipelineBatchExportConfiguration.tsx"),_PipelineNode__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./frontend/src/scenes/pipeline/PipelineNode.tsx"),_pipelineNodeNewLogic__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./frontend/src/scenes/pipeline/pipelineNodeNewLogic.tsx"),_PipelinePluginConfiguration__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./frontend/src/scenes/pipeline/PipelinePluginConfiguration.tsx"),_transformationsLogic__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./frontend/src/scenes/pipeline/transformationsLogic.tsx"),_types__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let paramsToProps=_ref=>{let{params:{stage,id}}=_ref,numericId=id&&/^\d+$/.test(id)?parseInt(id):void 0,pluginId=numericId&&!isNaN(numericId)?numericId:null,hogFunctionId=pluginId?null:id?.startsWith("hog-")?id.slice(4):null,batchExportDestination=hogFunctionId?null:null!=id?id:null;return{stage:_PipelineNode__WEBPACK_IMPORTED_MODULE_16__.PIPELINE_TAB_TO_NODE_STAGE[stage+"s"]||null,pluginId,batchExportDestination,hogFunctionId}},scene={component:PipelineNodeNew,logic:_pipelineNodeNewLogic__WEBPACK_IMPORTED_MODULE_17__.Q,paramsToProps};function convertPluginToTableEntry(plugin){return{backend:_types__WEBPACK_IMPORTED_MODULE_20__.b.Plugin,id:plugin.id,name:plugin.name,description:plugin.description||"",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_utils__WEBPACK_IMPORTED_MODULE_21__.Wf,{plugin:plugin}),url:plugin.url}}function PipelineNodeNew(){let params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stage,pluginId,batchExportDestination,hogFunctionId}=paramsToProps({params});if(!stage)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__.T,{object:"pipeline app stage"});if(pluginId){let res=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_PipelinePluginConfiguration__WEBPACK_IMPORTED_MODULE_18__.s,{stage:stage,pluginId:pluginId});return stage===_types__WEBPACK_IMPORTED_MODULE_11__.We.Destination?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_PayGateMini_PayGateMini__WEBPACK_IMPORTED_MODULE_4__.E,{feature:_types__WEBPACK_IMPORTED_MODULE_11__.P$.DATA_PIPELINES,children:res}):res}return batchExportDestination?stage!==_types__WEBPACK_IMPORTED_MODULE_11__.We.Destination?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__.T,{object:batchExportDestination}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_PayGateMini_PayGateMini__WEBPACK_IMPORTED_MODULE_4__.E,{feature:_types__WEBPACK_IMPORTED_MODULE_11__.P$.DATA_PIPELINES,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_PipelineBatchExportConfiguration__WEBPACK_IMPORTED_MODULE_15__.B,{service:batchExportDestination})}):hogFunctionId?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_hogfunctions_HogFunctionConfiguration__WEBPACK_IMPORTED_MODULE_14__.g,{templateId:hogFunctionId}):stage===_types__WEBPACK_IMPORTED_MODULE_11__.We.Transformation?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(TransformationOptionsTable,{}):stage===_types__WEBPACK_IMPORTED_MODULE_11__.We.Destination?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_destinations_NewDestinations__WEBPACK_IMPORTED_MODULE_12__.n,{}):stage===_types__WEBPACK_IMPORTED_MODULE_11__.We.SiteApp?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(SiteAppOptionsTable,{}):stage===_types__WEBPACK_IMPORTED_MODULE_11__.We.Source?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(scenes_data_warehouse_new_NewSourceWizard__WEBPACK_IMPORTED_MODULE_9__.NewSourceWizardScene,{}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__.T,{object:"pipeline new options"})}function TransformationOptionsTable(){let{plugins,loading}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_transformationsLogic__WEBPACK_IMPORTED_MODULE_19__.P),targets=Object.values(plugins).map(convertPluginToTableEntry);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(NodeOptionsTable,{stage:_types__WEBPACK_IMPORTED_MODULE_11__.We.Transformation,targets:targets,loading:loading})}function SiteAppOptionsTable(){let{plugins,loading}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_frontendAppsLogic__WEBPACK_IMPORTED_MODULE_13__.$),targets=Object.values(plugins).map(convertPluginToTableEntry);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(NodeOptionsTable,{stage:_types__WEBPACK_IMPORTED_MODULE_11__.We.SiteApp,targets:targets,loading:loading})}function NodeOptionsTable(_ref2){let{stage,targets,loading}=_ref2,{hashParams}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(kea_router__WEBPACK_IMPORTED_MODULE_2__.router),{loadPlugins}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)(_pipelineNodeNewLogic__WEBPACK_IMPORTED_MODULE_17__.Q);return(0,react__WEBPACK_IMPORTED_MODULE_8__.useEffect)(()=>{loadPlugins()},[]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.Fragment,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_6__.g,{dataSource:targets,size:"small",loading:loading,columns:[{title:"App",width:0,render:function RenderAppInfo(_,target){return target.icon}},{title:"Name",sticky:!0,render:function RenderName(_,target){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_7__.i,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_10__.j.pipelineNodeNew(stage,target.id),title:target.name,description:target.description})}},{title:"Actions",width:100,align:"right",render:function RenderActions(_,target){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"primary","data-attr":`new-${stage}-${target.id}`,icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconPlusSmall,{}),to:(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.combineUrl)(scenes_urls__WEBPACK_IMPORTED_MODULE_10__.j.pipelineNodeNew(stage,target.id),{},hashParams).url,children:"Create"})}}]})})}},"./frontend/src/scenes/pipeline/destinations/DestinationsFilters.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>DestinationsFilters});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_destinationsFiltersLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/pipeline/destinations/destinationsFiltersLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DestinationsFilters(_ref){var _filters$search,_filters$kind;let{hideSearch,hideShowPaused,hideKind}=_ref,{filters}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_destinationsFiltersLogic__WEBPACK_IMPORTED_MODULE_3__.T),{setFilters,openFeedbackDialog}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)(_destinationsFiltersLogic__WEBPACK_IMPORTED_MODULE_3__.T);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"space-y-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"flex items-center gap-2",children:[!hideSearch&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{type:"search",placeholder:"Search...",value:null!==(_filters$search=filters.search)&&void 0!==_filters$search?_filters$search:"",onChange:e=>setFilters({search:e})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.rU,{className:"text-sm font-semibold",subtle:!0,onClick:()=>openFeedbackDialog(),children:"Can't find what you're looking for?"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"flex-1"}),"boolean"!=typeof hideShowPaused&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Hw,{label:"Show paused",bordered:!0,size:"small",checked:filters.showPaused,onChange:e=>setFilters({showPaused:null!=e?e:void 0})}),!hideKind&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Yv,{type:"secondary",size:"small",options:[{label:"All kinds",value:null},{label:"Realtime",value:_types__WEBPACK_IMPORTED_MODULE_2__.b.HogFunction},{label:"Batch exports",value:_types__WEBPACK_IMPORTED_MODULE_2__.b.BatchExport}].filter(Boolean),value:null!==(_filters$kind=filters.kind)&&void 0!==_filters$kind?_filters$kind:null,onChange:e=>setFilters({kind:null!=e?e:null})})]})})}},"./frontend/src/scenes/pipeline/destinations/NewDestinations.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>DestinationOptionsTable,n:()=>NewDestinations});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.8.4_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),PayGateButton=__webpack_require__("./frontend/src/lib/components/PayGateMini/PayGateButton.tsx"),PayGateMini=__webpack_require__("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),LemonTableLink=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),types=__webpack_require__("./frontend/src/types.ts"),pipelineAccessLogic=__webpack_require__("./frontend/src/scenes/pipeline/pipelineAccessLogic.tsx"),DestinationsFilters=__webpack_require__("./frontend/src/scenes/pipeline/destinations/DestinationsFilters.tsx"),destinationsFiltersLogic=__webpack_require__("./frontend/src/scenes/pipeline/destinations/destinationsFiltersLogic.tsx"),DestinationTag=__webpack_require__("./frontend/src/scenes/pipeline/destinations/DestinationTag.tsx"),fuse_esm=__webpack_require__("./node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.2.0_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),utils=__webpack_require__("./frontend/src/scenes/pipeline/batch-exports/utils.ts"),HogFunctionIcon=__webpack_require__("./frontend/src/scenes/pipeline/hogfunctions/HogFunctionIcon.tsx"),pipeline_types=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),pipeline_utils=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let newDestinationsLogic=(0,index_esm.kea)([(0,index_esm.path)(()=>["scenes","pipeline","destinations","newDestinationsLogic"]),(0,index_esm.connect)({values:[userLogic.userLogic,["user"],featureFlagLogic.h,["featureFlags"],destinationsFiltersLogic.T,["filters"]]}),(0,index_esm.actions)({openFeedbackDialog:!0}),(0,lib.loaders)({hogFunctionTemplates:[{},{loadHogFunctionTemplates:async()=>{let templates=await api.ZP.hogFunctions.listTemplates();return templates.results.reduce((acc,template)=>(acc[template.id]=template,acc),{})}}]}),(0,index_esm.selectors)(()=>({loading:[s=>[s.hogFunctionTemplatesLoading],hogFunctionTemplatesLoading=>hogFunctionTemplatesLoading],batchExportServiceNames:[s=>[s.user,s.featureFlags],(user,featureFlags)=>{let httpEnabled=featureFlags[constants.y8.BATCH_EXPORTS_POSTHOG_HTTP]||user?.is_impersonated||user?.is_staff,services=types.e2.filter(service=>!!httpEnabled||"HTTP"!==service);return services}],destinations:[s=>[s.hogFunctionTemplates,s.batchExportServiceNames,kea_router_lib.router.selectors.hashParams],(hogFunctionTemplates,batchExportServiceNames,hashParams)=>[...Object.values(hogFunctionTemplates).map(hogFunction=>({icon:(0,jsx_runtime.jsx)(HogFunctionIcon._,{size:"small",src:hogFunction.icon_url}),name:hogFunction.name,description:hogFunction.description,backend:pipeline_types.b.HogFunction,url:(0,kea_router_lib.combineUrl)(urls.j.pipelineNodeNew(types.We.Destination,`hog-${hogFunction.id}`),{},hashParams).url,status:hogFunction.status})),...batchExportServiceNames.map(service=>({icon:(0,jsx_runtime.jsx)(pipeline_utils.oe,{type:service}),name:(0,utils.x)(service),description:`${service} batch export`,backend:pipeline_types.b.BatchExport,url:urls.j.pipelineNodeNew(types.We.Destination,`${service}`)}))]],destinationsFuse:[s=>[s.destinations],destinations=>new fuse_esm.Z(destinations||[],{keys:["name","description"],threshold:.3})],filteredDestinations:[s=>[s.filters,s.destinations,s.destinationsFuse],(filters,destinations,destinationsFuse)=>{let{search,kind}=filters;return(search?destinationsFuse.search(search).map(x=>x.item):destinations).filter(dest=>!kind||dest.backend===kind)}],hiddenDestinations:[s=>[s.destinations,s.filteredDestinations],(destinations,filteredDestinations)=>destinations.filter(dest=>!filteredDestinations.includes(dest))]})),(0,index_esm.afterMount)(_ref=>{let{actions}=_ref;actions.loadHogFunctionTemplates()})]);function NewDestinations(){return(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)(PayGateMini.E,{feature:types.P$.DATA_PIPELINES}),(0,jsx_runtime.jsx)(DestinationsFilters.B,{hideShowPaused:!0}),(0,jsx_runtime.jsx)(DestinationOptionsTable,{})]})}function DestinationOptionsTable(){let{loading,filteredDestinations,hiddenDestinations}=(0,index_esm.useValues)(newDestinationsLogic),{canEnableDestination}=(0,index_esm.useValues)(pipelineAccessLogic.g),{resetFilters}=(0,index_esm.useActions)(destinationsFiltersLogic.T);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.g3,{dataSource:filteredDestinations,size:"small",loading:loading,columns:[{title:"App",width:0,render:(_,target)=>target.icon},{title:"Name",sticky:!0,key:"name",sorter:(a,b)=>a.name.localeCompare(b.name),render:function RenderName(_,target){return(0,jsx_runtime.jsx)(LemonTableLink.i,{to:canEnableDestination(target)?target.url:void 0,title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[target.name,target.status&&(0,jsx_runtime.jsx)(DestinationTag.F,{status:target.status})]}),description:target.description})}},{width:100,align:"right",render:function RenderActions(_,target){return canEnableDestination(target)?(0,jsx_runtime.jsx)(src.Jp,{type:"primary","data-attr":`new-${types.We.Destination}`,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),to:target.url,fullWidth:!0,children:"Create"}):(0,jsx_runtime.jsx)("span",{className:"whitespace-nowrap",children:(0,jsx_runtime.jsx)(PayGateButton.R,{feature:types.P$.DATA_PIPELINES,type:"secondary"})})}}]}),hiddenDestinations.length>0&&(0,jsx_runtime.jsxs)("div",{className:"text-muted-alt",children:[hiddenDestinations.length," hidden. ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>resetFilters(),children:"Show all"})]})]})}}}]);