"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[12666],{"../../products/embedded_analytics/frontend/QueryEndpoints.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{QueryEndpoints:()=>QueryEndpoints,QueryEndpointsTable:()=>QueryEndpointsTable});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),lib_lemon_ui_LemonDivider__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonDivider/index.ts"),lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),lib_lemon_ui_LemonTag__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTag/index.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_queryEndpointLogic__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../products/embedded_analytics/frontend/queryEndpointLogic.tsx"),_queryEndpointsLogic__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../products/embedded_analytics/frontend/queryEndpointsLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function QueryEndpoints(_ref){let{tabId}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.Fragment,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(QueryEndpointsTable,{tabId:tabId})})}let QueryEndpointsTable=_ref2=>{let{tabId}=_ref2,{setFilters}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)((0,_queryEndpointsLogic__WEBPACK_IMPORTED_MODULE_13__.N)({tabId})),{queryEndpoints,queryEndpointsLoading,filters}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)((0,_queryEndpointsLogic__WEBPACK_IMPORTED_MODULE_13__.N)({tabId})),{deleteQueryEndpoint,deactivateQueryEndpoint}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)((0,_queryEndpointLogic__WEBPACK_IMPORTED_MODULE_12__.$)({tabId})),columns=[{title:"Name",key:"name",dataIndex:"name",width:"25%",render:function Render(_,record){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_7__.i,{title:record.name,description:record.description})},sorter:(a,b)=>a.name.localeCompare(b.name)},(0,lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_8__.rw)(),(0,lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_8__.JB)(),(0,lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_8__.pD)("last_executed_at","Last executed at"),{title:"Endpoint path",key:"endpoint_path",dataIndex:"endpoint_path",render:(_,record)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__.J,{type:"secondary",size:"xsmall",onClick:()=>{navigator.clipboard.writeText(record.endpoint_path),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_10__.UJ.success("Endpoint URL copied to clipboard")},className:"font-mono text-xs",children:record.endpoint_path})},{title:"Status",key:"is_active",dataIndex:"is_active",align:"center",render:(_,record)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("span",{children:record.is_active?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonTag__WEBPACK_IMPORTED_MODULE_9__.o,{type:"success",children:"Active"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonTag__WEBPACK_IMPORTED_MODULE_9__.o,{type:"danger",children:"Inactive"})}),sorter:(a,b)=>Number(b.is_active)-Number(a.is_active)},{key:"actions",width:0,render:(_,record)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_3__.T,{overlay:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__.J,{onClick:()=>{kea_router__WEBPACK_IMPORTED_MODULE_1__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_11__.j.embeddedAnalyticsUsage({requestNameFilter:[record.name]}))},fullWidth:!0,children:"View usage"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonDivider__WEBPACK_IMPORTED_MODULE_4__.p,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__.J,{onClick:()=>{deactivateQueryEndpoint(record.name)},fullWidth:!0,status:"alt",children:"Deactivate query endpoint"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__.J,{onClick:()=>{deleteQueryEndpoint(record.name)},fullWidth:!0,status:"danger",children:"Delete query endpoint"})]})})}];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div",{className:"flex justify-between gap-2 flex-wrap",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_5__.D,{type:"search",className:"w-1/3",placeholder:"Search for query endpoints",onChange:x=>setFilters({search:x}),value:filters.search})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_6__.g,{"data-attr":"query-endpoints-table",pagination:{pageSize:20},dataSource:queryEndpoints,rowKey:"id",rowClassName:record=>record._highlight?"highlighted":null,columns:columns,loading:queryEndpointsLoading,emptyState:"No query endpoints matching your filters!",nouns:["query endpoint","query endpoints"]})]})}},"../../products/embedded_analytics/frontend/queryEndpointLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>queryEndpointLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),lib_utils_kea_logic_builders__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/utils/kea-logic-builders.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let queryEndpointLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","embedded_analytics","frontend","queryEndpointLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.tabId),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setQueryEndpointName:queryEndpointName=>({queryEndpointName}),setQueryEndpointDescription:queryEndpointDescription=>({queryEndpointDescription}),setActiveCodeExampleTab:tab=>({tab}),createQueryEndpoint:request=>({request}),createQueryEndpointSuccess:response=>({response}),createQueryEndpointFailure:error=>({error}),deleteQueryEndpoint:name=>({name}),deleteQueryEndpointSuccess:response=>({response}),deleteQueryEndpointFailure:error=>({error}),deactivateQueryEndpoint:name=>({name}),deactivateQueryEndpointSuccess:response=>({response}),deactivateQueryEndpointFailure:error=>({error})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({queryEndpointName:[null,{setQueryEndpointName:(_,_ref)=>{let{queryEndpointName}=_ref;return queryEndpointName}}],queryEndpointDescription:[null,{setQueryEndpointDescription:(_,_ref2)=>{let{queryEndpointDescription}=_ref2;return queryEndpointDescription}}],activeCodeExampleTab:["terminal",{setActiveCodeExampleTab:(_,_ref3)=>{let{tab}=_ref3;return tab}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions}=_ref4;return{createQueryEndpoint:async _ref5=>{let{request}=_ref5;try{let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.queryEndpoint.create(request);actions.createQueryEndpointSuccess(response)}catch(error){console.error("Failed to create query endpoint:",error),actions.createQueryEndpointFailure(error)}},createQueryEndpointSuccess:()=>{actions.setQueryEndpointName(""),actions.setQueryEndpointDescription(""),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.Fragment,{children:["Query endpoint created successfully!",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("br",{}),"You will be redirected to the query endpoints page."]}),{onClose:()=>{kea_router__WEBPACK_IMPORTED_MODULE_1__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.embeddedAnalyticsQueryEndpoints())}})},createQueryEndpointFailure:_ref6=>{let{error}=_ref6;console.error("Failed to create query endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Failed to create query endpoint")},deleteQueryEndpoint:async _ref7=>{let{name}=_ref7;try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.queryEndpoint.delete(name),actions.deleteQueryEndpointSuccess(name)}catch(error){console.error("Failed to delete query endpoint:",error),actions.deleteQueryEndpointFailure(error)}},deleteQueryEndpointSuccess:()=>{lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success("Query endpoint deleted successfully")},deleteQueryEndpointFailure:_ref8=>{let{error}=_ref8;console.error("Failed to delete query endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Failed to delete query endpoint")},deactivateQueryEndpoint:async _ref9=>{let{name}=_ref9;try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.queryEndpoint.update(name,{query:{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_6__.OH.HogQLQuery,query:""},is_active:!1}),actions.deactivateQueryEndpointSuccess({})}catch(error){console.error("Failed to deactivate query endpoint:",error),actions.deactivateQueryEndpointFailure(error)}},deactivateQueryEndpointSuccess:()=>{lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success("Query endpoint deactivated successfully")},deactivateQueryEndpointFailure:_ref10=>{let{error}=_ref10;console.error("Failed to deactivate query endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Failed to deactivate query endpoint")}}}),(0,lib_utils_kea_logic_builders__WEBPACK_IMPORTED_MODULE_4__.Y)()])},"../../products/embedded_analytics/frontend/queryEndpointsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>queryEndpointsLogic});var fuse_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts");let queryEndpointsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","embedded_analytics","frontend","queryEndpointsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.tabId),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:filters=>({filters})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{queryEndpoints:[[],{loadQueryEndpoints:async()=>{let haystack=(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.queryEndpoint.list()).results||[];if(haystack.length>0){let names=haystack.map(endpoint=>endpoint.name),lastExecutionTimes=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.queryEndpoint.getLastExecutionTimes(names);haystack=haystack.map(endpoint=>({...endpoint,last_executed_at:lastExecutionTimes[endpoint.name]}))}return values.filters.search&&(haystack=new fuse_js__WEBPACK_IMPORTED_MODULE_3__.Z(haystack,{keys:["name","description","query.query"],threshold:.3}).search(values.filters.search).map(result=>result.item)),haystack}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({filters:[{search:""},{setFilters:(state,_ref2)=>{let{filters}=_ref2;return{...state,...filters}}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref3=>{let{actions}=_ref3;return{setFilters:()=>{actions.loadQueryEndpoints()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadQueryEndpoints()})])}}]);