(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{"./frontend/src/scenes/actions/Action.tsx":function(ie,D,e){"use strict";e.r(D),e.d(D,"scene",function(){return dt}),e.d(D,"Action",function(){return Le});var ee=e("./node_modules/core-js/modules/es.array.concat.js"),te=e("./node_modules/react/index.js"),t=e.n(te),xe=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),N=e.n(xe),f=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ce=e.n(f),Je=e("./node_modules/core-js/modules/es.array.map.js"),Re=e("./node_modules/core-js/modules/es.array.filter.js"),Be=e("./node_modules/core-js/modules/es.object.to-string.js"),de=e("./node_modules/core-js/modules/es.object.keys.js"),ge=e("./node_modules/core-js/modules/es.symbol.js"),Xe=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),ue=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),he=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),R=e("./frontend/src/lib/utils.tsx"),je=e("./frontend/src/lib/components/Link.tsx"),h=e("./node_modules/kea/lib/index.esm.js"),$=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ne=e.n($),ye=e("./node_modules/@babel/runtime/regenerator/index.js"),W=e.n(ye),Oe=e("./node_modules/core-js/modules/es.function.name.js"),we=e("./node_modules/core-js/modules/es.array.iterator.js"),ae=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),_e=e("./node_modules/core-js/modules/es.regexp.exec.js"),Ae=e("./node_modules/core-js/modules/es.string.split.js"),J=e("./frontend/src/lib/api.ts"),re=e("./frontend/src/models/actionsModel.ts"),z=e("./frontend/src/lib/components/lemonToast.tsx"),be=e("./node_modules/kea-loaders/lib/index.js"),Ke=e("./node_modules/kea-forms/lib/index.js");function oe(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),r.push.apply(r,o)}return r}function X(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?oe(Object(r),!0).forEach(function(o){N()(a,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(r,o))})}return a}var w=Object(h.kea)([Object(h.path)(["scenes","actions","actionEditLogic"]),Object(h.props)({}),Object(h.key)(function(a){return a.id||"new"}),Object(h.actions)({setAction:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:n,options:r}},setCreateNew:function(n){return{createNew:n}},actionAlreadyExists:function(n){return{actionId:n}}}),Object(h.reducers)({createNew:[!1,{setCreateNew:function(n,r){var o=r.createNew;return o}}]}),Object(Ke.forms)(function(a){var n=a.actions,r=a.props;return{action:{defaults:X({},r.action),errors:function(c){var u=c.name;return{name:u?null:"You need to set a name"}},submit:function(c){n.saveAction(c)}}}}),Object(be.loaders)(function(a){var n=a.props,r=a.values;return{actionCount:{loadActionCount:function(){var o=ne()(W.a.mark(function u(){return W.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!n.id){v.next=6;break}return v.next=3,J.b.actions.getCount(n.id);case 3:v.t0=v.sent,v.next=7;break;case 6:v.t0=0;case 7:return v.abrupt("return",v.t0);case 8:case"end":return v.stop()}},u)}));function c(){return o.apply(this,arguments)}return c}()},action:[X({},n.action),{setAction:function(c){var u=c.action,p=c.options.merge;return p?X(X({},r.action),u):u},saveAction:function(){var o=ne()(W.a.mark(function u(p,v){var d,b;return W.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(d=X({},p),d.steps=d.steps?d.steps.filter(function(Ie){return Ie.event}):[],g.prev=2,!d.id){g.next=9;break}return g.next=6,J.b.actions.update(d.id,d,n.temporaryToken);case 6:d=g.sent,g.next=12;break;case 9:return g.next=11,J.b.actions.create(d,n.temporaryToken);case 11:d=g.sent;case 12:v(),g.next=22;break;case 15:if(g.prev=15,g.t0=g.catch(2),g.t0.code!=="unique"){g.next=21;break}return b=g.t0.detail.split(" ").pop(),Ge(b),g.abrupt("return",d);case 21:throw g.t0;case 22:return z.d.success("Action saved"),n.onSave(d),re.a.actions.loadActions(),g.abrupt("return",d);case 26:case"end":return g.stop()}},u,null,[[2,15]])}));function c(u,p){return o.apply(this,arguments)}return c}()}]}}),Object(h.afterMount)(function(a){var n=a.actions,r=a.props;r.id?n.loadActionCount():n.setAction({name:"",steps:[{isNew:Object(R.Db)()}]},{merge:!1})})]),Qe=e("./frontend/src/scenes/actions/Actions.scss"),F=e("./frontend/src/scenes/actions/EventName.tsx"),Ne=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),me=e.n(Ne),Te=e("./frontend/src/scenes/teamLogic.tsx"),se=e("./node_modules/antd/es/button/index.js"),We=e("./node_modules/antd/es/modal/index.js"),Ce=e("./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx"),ze=e("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts");function Y(a){var n,r=a.actionId,o=a.style,c=a.children,u=Object(te.useState)(!1),p=me()(u,2),v=p[0],d=p[1],b=Object(h.useValues)(Te.a),L=b.currentTeam;return t.a.createElement(t.a.Fragment,null,t.a.createElement(se.a,{href:Object(ze.b)(L==null||(n=L.app_urls)===null||n===void 0?void 0:n[0],r),style:o,size:"small",onClick:function(Ie){Ie.preventDefault(),d(!0)}},c),t.a.createElement(We.a,{visible:v,title:r?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:t.a.createElement(se.a,{onClick:function(){return d(!1)}},"Close"),onCancel:function(){return d(!1)}},t.a.createElement(Ce.a,{actionId:r,pageKey:"app-editor-link"})))}try{Y.displayName="AppEditorLink",Y.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:Y.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(a){}var Q=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),j=e("./frontend/src/lib/components/Tooltip.tsx"),G=e("./frontend/src/scenes/actions/hints.tsx"),H=e("./node_modules/antd/es/typography/index.js"),M=e("./node_modules/antd/es/col/index.js"),pe=e("./node_modules/antd/es/card/index.js"),Pe=e("./node_modules/antd/es/input/index.js"),ve=e("./node_modules/antd/es/space/index.js"),x=e("./node_modules/antd/es/radio/index.js"),Z=e("./node_modules/@ant-design/icons/es/icons/ExportOutlined.js"),V=e("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js");function fe(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),r.push.apply(r,o)}return r}function T(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?fe(Object(r),!0).forEach(function(o){N()(a,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(r,o))})}return a}var Ue=H.a.Text,Ze="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function le(a){var n=a.step,r=a.actionId,o=a.isOnlyStep,c=a.index,u=a.identifier,p=a.onDelete,v=a.onChange,d=function(L){v(L)};return t.a.createElement(M.a,{span:24,md:12},t.a.createElement(pe.a,{className:"action-step",style:{overflow:"visible"}},c>0&&t.a.createElement("div",{className:"stateful-badge pos-center-end or"},"OR"),t.a.createElement("div",null,!o&&t.a.createElement("div",{className:"remove-wrapper"},t.a.createElement("button",{type:"button","aria-label":"delete",onClick:p},t.a.createElement("span",{"aria-hidden":"true"},"\xD7"))),t.a.createElement("div",{className:"mb"},t.a.createElement("b",null,"Match Group #",c+1)),t.a.createElement(Se,{step:n,sendStep:d}),t.a.createElement("div",{style:{marginTop:n.event==="$pageview"?20:8,paddingBottom:0}},n.event==="$autocapture"&&t.a.createElement(Fe,{step:n,sendStep:d,actionId:r}),n.event!=null&&n.event!=="$autocapture"&&n.event!=="$pageview"&&t.a.createElement("div",{style:{marginTop:"2rem"}},t.a.createElement("label",null,t.a.createElement("b",null,"Event name: ")),t.a.createElement(F.a,{value:n.event,onChange:function(L){return d(T(T({},n),{},{event:L||""}))}}),t.a.createElement("br",null),t.a.createElement("small",null,t.a.createElement("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer"},"See documentation")," ","on how to send custom events in lots of languages.")),n.event==="$pageview"&&t.a.createElement("div",null,t.a.createElement(k,{step:n,sendStep:d,item:"url",extra_options:t.a.createElement(Ve,{step:n,sendStep:d}),label:"URL"}),n.url_matching&&n.url_matching in G.a&&t.a.createElement("small",{style:{display:"block",marginTop:-12}},G.a[n.url_matching])),n.event&&t.a.createElement("div",{className:"action-property-filters"},t.a.createElement("h3",{className:"l3"},"Filters"),(!n.properties||n.properties.length===0)&&t.a.createElement("div",{className:"text-muted"},"This match group has no additional filters."),t.a.createElement(Q.a,{propertyFilters:n.properties,pageKey:u,eventNames:n.event?[n.event]:[],onChange:function(L){d(T(T({},n),{},{properties:L}))},showConditionBadge:!0}))))))}function k(a){var n=function(o){return a.sendStep(T(T({},a.step),{},N()({},a.item,o.target.value||null)))};return t.a.createElement("div",{className:"mb"},t.a.createElement("label",{style:{fontWeight:"bold"}},a.label," ",a.extra_options),a.caption&&t.a.createElement("div",{className:"action-step-caption"},a.caption),a.item==="selector"?t.a.createElement(Pe.a.TextArea,{allowClear:!0,onChange:n,value:a.step[a.item]||"",placeholder:a.placeholder}):t.a.createElement(Pe.a,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:n,value:a.step[a.item]||"",placeholder:a.placeholder}))}function Fe(a){var n=a.step,r=a.actionId,o=a.sendStep,c=function(){return t.a.createElement("div",{className:"text-center"},t.a.createElement("span",{className:"stateful-badge and"},"AND"))};return t.a.createElement("div",null,t.a.createElement("span",null,t.a.createElement(Y,{actionId:r,style:{margin:"1rem 0"}},"Select element on site ",t.a.createElement(Z.a,null)),t.a.createElement("a",{href:"".concat(Ze,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8}},"See documentation.")," "),t.a.createElement(k,{step:n,sendStep:o,item:"href",label:"Link target equals",caption:t.a.createElement(t.a.Fragment,null,"If your element is a link, the location that the link opens (",t.a.createElement("code",null,"href")," tag)")}),t.a.createElement(c,null),t.a.createElement(k,{step:n,sendStep:o,item:"text",label:"Text equals",caption:"Text content inside your element"}),t.a.createElement(c,null),t.a.createElement(k,{step:n,sendStep:o,item:"selector",label:t.a.createElement(t.a.Fragment,null,"HTML selector matches",t.a.createElement(j.a,{title:"Click here to learn more about supported selectors"},t.a.createElement("a",{href:"".concat(Ze,"#matching-selectors"),target:"_blank",rel:"noopener"},t.a.createElement(V.a,{style:{marginLeft:4}})))),placeholder:'button[data-attr="my-id"]',caption:t.a.createElement(ve.b,{direction:"vertical"},t.a.createElement(Ue,{style:{color:"var(--muted)"}},"CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",t.a.createElement(Ue,{code:!0},'[data-attr="signup"]')))}),t.a.createElement("div",{style:{marginBottom:18}},t.a.createElement(c,null)),t.a.createElement(k,{step:n,sendStep:o,item:"url",extra_options:t.a.createElement(Ve,{step:n,sendStep:o}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(n==null?void 0:n.url_matching)&&n.url_matching in G.a&&t.a.createElement("small",{style:{display:"block",marginTop:-12}},G.a[n.url_matching]))}function Se(a){var n=a.step,r=a.sendStep,o=function(u){var p=u.target.value;p==="$autocapture"?r(T(T({},n),{},{event:"$autocapture"})):p==="event"?r(T(T({},n),{},{event:""})):p==="$pageview"&&r(T(T({},n),{},{event:"$pageview",url:n.url}))};return t.a.createElement("div",{className:"type-switcher"},t.a.createElement(x.a.Group,{buttonStyle:"solid",onChange:o,value:n.event==="$autocapture"||n.event==="$pageview"||n.event===void 0?n.event:"event"},t.a.createElement(x.a.Button,{value:"$autocapture"},"Autocapture"),t.a.createElement(x.a.Button,{value:"event"},"Custom event"),t.a.createElement(x.a.Button,{value:"$pageview"},"Page view")))}function Ve(a){var n=a.step,r=a.sendStep,o=function(u){r(T(T({},n),{},{url_matching:u.target.value}))};return t.a.createElement(x.a.Group,{buttonStyle:"solid",onChange:o,value:n.url_matching||"contains",size:"small"},t.a.createElement(x.a.Button,{value:"contains"},"contains"),t.a.createElement(x.a.Button,{value:"regex"},"matches regex"),t.a.createElement(x.a.Button,{value:"exact"},"matches exactly"))}try{le.displayName="ActionStep",le.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:le.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(a){}var O=e("./node_modules/antd/es/row/index.js"),i=e("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),s=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),l=e("./node_modules/kea-router/lib/index.js"),E=e("./frontend/src/lib/components/PageHeader.tsx"),y=e("./frontend/src/scenes/urls.ts"),I=e("./frontend/src/lib/components/EditableField/EditableField.tsx"),C=e("./frontend/src/types.ts"),U=e("./frontend/src/scenes/userLogic.ts"),B=e("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),Ee=e("./frontend/src/lib/forms/VerticalForm.tsx"),A=e("./frontend/src/lib/forms/Field.tsx"),K=e("./frontend/src/lib/components/LemonButton/index.ts"),De=e("./frontend/src/lib/components/LemonCheckbox/index.ts"),$e=e("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function nt(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),r.push.apply(r,o)}return r}function st(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?nt(Object(r),!0).forEach(function(o){N()(a,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):nt(Object(r)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(r,o))})}return a}function Ye(a){var n=a.action,r=a.id,o=a.onSave,c=a.temporaryToken,u={id:r,action:n,onSave:function(m){return o(m)},temporaryToken:c},p=w(u),v=Object(h.useValues)(p),d=v.action,b=v.actionLoading,L=v.actionCount,g=v.actionCountLoading,Ie=Object(h.useActions)(p),at=Ie.submitAction,ut=Object(h.useActions)(re.a),mt=ut.loadActions,pt=Object(h.useValues)(Te.a),qe=pt.currentTeam,vt=Object(h.useValues)(U.a),ft=vt.hasAvailableFeature,et=qe==null?void 0:qe.slack_incoming_webhook,rt=function(){return t.a.createElement(K.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",style:{marginRight:8},onClick:function(){Object(R.x)({endpoint:J.b.actions.determineDeleteEndpoint(),object:d,callback:function(){l.router.actions.push(y.a.actions()),mt()}})}},"Delete")},ot=function(){return t.a.createElement(K.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",style:{marginRight:8},onClick:function(){l.router.actions.push(y.a.actions())}},"Cancel")};return t.a.createElement("div",{className:"action-edit-container"},t.a.createElement(Ee.a,{logic:w,props:u,formKey:"action",enableFormOnSubmit:!0},t.a.createElement(E.a,{title:t.a.createElement(A.a,{name:"name"},function(_){var m=_.value,S=_.onChange;return t.a.createElement(I.a,{name:"name",value:m||"",placeholder:"Name this action",onChange:r?void 0:S,onSave:function(q){S(q),at()},mode:r?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(r?"edit":"create"),className:"action-name"})}),caption:t.a.createElement(t.a.Fragment,null,t.a.createElement(A.a,{name:"description",showOptional:!0},function(_){var m=_.value,S=_.onChange;return t.a.createElement(I.a,{multiline:!0,name:"description",value:m||"",placeholder:"Description (optional)",onChange:r?void 0:S,onSave:function(q){S(q),at()},mode:r?void 0:"edit",autoFocus:!!r,"data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!ft(C.d.INGESTION_TAXONOMY)})}),t.a.createElement(A.a,{name:"tags",showOptional:!0},function(_){var m=_.value,S=_.onChange;return t.a.createElement(B.a,{tags:m!=null?m:[],onChange:function(q,tt){return S(tt)},className:"action-tags",saving:b})})),buttons:r?rt():ot()}),r&&t.a.createElement("div",{className:"input-set"},t.a.createElement("div",null,t.a.createElement("span",{className:"text-muted mb-05"},g&&t.a.createElement(i.a,null),L!==null&&L>-1&&t.a.createElement(t.a.Fragment,null,"This action matches ",t.a.createElement("b",null,Object(R.q)(L))," events in the last 3 months")))),t.a.createElement("div",{style:{overflow:"visible"}},t.a.createElement("h2",{className:"subtitle"},"Match groups"),t.a.createElement("div",null,"Your action will be triggered whenever ",t.a.createElement("b",null,"any of your match groups")," are received."," ",t.a.createElement("a",{href:"https://posthog.com/docs/features/actions",target:"_blank"},t.a.createElement(V.a,null))),t.a.createElement(A.a,{name:"steps"},function(_){var m=_.onChange;return t.a.createElement("div",{style:{textAlign:"right",marginBottom:12}},t.a.createElement(se.a,{onClick:function(){return m([].concat(ce()(d.steps||[]),[{isNew:Object(R.Db)()}]))},size:"small"},"Add another match group"))}),t.a.createElement(A.a,{name:"steps"},function(_){var m=_.value,S=_.onChange;return t.a.createElement(O.a,{gutter:[24,24]},t.a.createElement(t.a.Fragment,null,m==null?void 0:m.map(function(P,q){return t.a.createElement(le,{key:P.id||P.isNew,identifier:String(P.id||P.isNew),index:q,step:P,actionId:d.id||0,isOnlyStep:!!m&&m.length===1,onDelete:function(){var He=P.id?"id":"isNew";S(m==null?void 0:m.filter(function(Me){return Me[He]!==P[He]}))},onChange:function(He){S(m==null?void 0:m.map(function(Me){return P.id&&Me.id==P.id||P.isNew&&Me.isNew===P.isNew?st({id:P.id,isNew:P.isNew},He):Me}))}})})),t.a.createElement(M.a,{span:24,md:12},t.a.createElement("div",{className:"match-group-add-skeleton",onClick:function(){S([].concat(ce()(d.steps||[]),[{isNew:Object(R.Db)()}]))}},t.a.createElement(s.a,{style:{fontSize:28,color:"#666666"}}))))})),t.a.createElement("div",null,t.a.createElement("div",{style:{marginTop:"2rem"}},t.a.createElement("h2",{className:"subtitle"},"Match groups"),t.a.createElement(A.a,{name:"post_to_slack"},function(_){var m=_.value,S=_.onChange;return t.a.createElement(De.a,{id:"webhook-checkbox",checked:!!m,onChange:function(q){return S(q.target.checked)},rowProps:{fullWidth:!0},disabled:!et,label:t.a.createElement(t.a.Fragment,null,"Post to webhook when this action is triggered.",t.a.createElement(je.a,{to:"/project/settings#webhook",style:{marginLeft:4}},et?"Configure":"Enable"," this integration in Setup."))})}),d.post_to_slack&&t.a.createElement(t.a.Fragment,null,t.a.createElement(A.a,{name:"slack_message_format"},function(_){var m=_.value,S=_.onChange;return t.a.createElement(t.a.Fragment,null,t.a.createElement("div",null,"Message format (optional)"),t.a.createElement($e.a,{placeholder:"Default: [action.name] triggered by [person]",value:m,onChange:S,disabled:!et||!d.post_to_slack,"data-attr":"edit-slack-message-format"}),t.a.createElement("small",null,t.a.createElement("a",{href:"https://posthog.com/docs/integrations/message-formatting/",target:"_blank",rel:"noopener noreferrer"},"See documentation on how to format webhook messages.")))})))),t.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r?rt():ot(),t.a.createElement(K.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:b},"Save"))))}function Ge(a){z.d.error(t.a.createElement(t.a.Fragment,null,"Action with this name already exists. ",t.a.createElement("a",{href:y.a.action(a)},"Click here to edit.")))}try{Ye.displayName="ActionEdit",Ye.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:Ye.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(a){}try{Ge.displayName="duplicateActionErrorToast",Ge.__docgenInfo={description:"",displayName:"duplicateActionErrorToast",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#duplicateActionErrorToast"]={docgenInfo:Ge.__docgenInfo,name:"duplicateActionErrorToast",path:"frontend/src/scenes/actions/ActionEdit.tsx#duplicateActionErrorToast"})}catch(a){}var lt=e("./frontend/src/scenes/events/index.ts"),it=e("./frontend/src/lib/dayjs.ts"),ct=e("./frontend/src/lib/components/Spinner/Spinner.tsx"),ke=Object(h.kea)({props:{},key:function(n){return n.id||"new"},path:function(n){return["scenes","actions","actionLogic",n]},actions:function(){return{checkIsFinished:function(r){return{action:r}},setPollTimeout:function(r){return{pollTimeout:r}},setIsComplete:function(r){return{isComplete:r}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(r,o){var c=o.pollTimeout;return c}}],isComplete:[!1,{setIsComplete:function(r,o){var c=o.isComplete;return c}}]}},selectors:{breadcrumbs:[function(a){return[a.action]},function(a){return[{name:"Data Management",path:y.a.actions()},{name:(a==null?void 0:a.name)||"Unnamed",path:a?y.a.action(a.id):void 0}]}]},loaders:function(n){var r=n.actions,o=n.props;return{action:{loadAction:function(){var c=ne()(W.a.mark(function p(){var v;return W.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(r.setIsComplete(!1),o.id){b.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return b.next=5,J.b.actions.get(o.id);case 5:return v=b.sent,r.checkIsFinished(v),b.abrupt("return",v);case 8:case"end":return b.stop()}},p)}));function u(){return c.apply(this,arguments)}return u}()}}},listeners:function(n){var r=n.actions,o=n.values;return{checkIsFinished:function(u){var p=u.action;p.is_calculating?r.setPollTimeout(setTimeout(function(){return r.loadAction()},1e3)):(r.setIsComplete(new Date),o.pollTimeout&&clearTimeout(o.pollTimeout))}}},events:function(n){var r=n.values,o=n.actions,c=n.props;return{afterMount:function(){c.id&&o.loadAction()},beforeUnmount:function(){r.pollTimeout&&clearTimeout(r.pollTimeout)}}}}),dt={logic:ke,component:Le,paramsToProps:function(n){var r=n.params.id;return{id:parseInt(r)}}};function Le(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=a.id,r={action_id:n},o=Object(h.useActions)(l.router),c=o.push,u=Object(h.useValues)(ke),p=u.action,v=u.isComplete,d=Object(h.useActions)(ke),b=d.loadAction;return t.a.createElement(t.a.Fragment,null,(!n||p)&&t.a.createElement(Ye,{id:n,action:p,onSave:function(g){n||c(y.a.action(g.id)),b()}}),n&&(v?t.a.createElement("div",null,t.a.createElement("h2",{className:"subtitle"},"Matching events"),t.a.createElement("p",null,"This is the list of ",t.a.createElement("strong",null,"recent")," events that match this action.",p!=null&&p.last_calculated_at?t.a.createElement(t.a.Fragment,null," ","Last calculated: ",t.a.createElement("b",null,Object(it.a)(p.last_calculated_at).fromNow()),"."):""),t.a.createElement(lt.a,{fixedFilters:r,sceneUrl:y.a.action(n),fetchMonths:3,pageKey:"action-".concat(n,"-").concat(JSON.stringify(r))})):t.a.createElement("div",null,t.a.createElement("h2",{className:"subtitle"},"Matching events"),t.a.createElement("div",{className:"flex-center"},t.a.createElement(ct.a,{style:{marginRight:12}}),"Calculating action, please hold on."))))}try{Le.displayName="Action",Le.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:Le.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(a){}},"./frontend/src/scenes/events/index.ts":function(ie,D,e){"use strict";var ee=e("./frontend/src/scenes/events/EventDetails.tsx"),te=e("./frontend/src/scenes/events/EventElements.tsx"),t=e("./frontend/src/scenes/events/EventsTable.tsx");e.d(D,"a",function(){return t.a});var xe=e("./frontend/src/scenes/events/eventsTableLogic.ts")},"./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx":function(ie,D,e){"use strict";e.d(D,"a",function(){return ae});var ee=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),te=e.n(ee),t=e("./node_modules/core-js/modules/es.regexp.exec.js"),xe=e("./node_modules/core-js/modules/es.string.match.js"),N=e("./node_modules/react/index.js"),f=e.n(N),ce=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Je=e.n(ce),Re=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss"),Be=e.n(Re),de={};de.insert="head",de.singleton=!1;var ge=Je()(Be.a,de),Xe=Be.a.locals||{},ue=e("./node_modules/clsx/dist/clsx.m.js"),he=e("./node_modules/kea/lib/index.esm.js"),R=e("./frontend/src/lib/components/LemonTable/index.ts"),je=e("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),h=e("./node_modules/@ant-design/icons/es/icons/CheckCircleFilled.js"),$=e("./frontend/src/lib/components/LemonButton/index.ts"),ne=e("./node_modules/antd/es/input/index.js"),ye=e("./node_modules/antd/es/button/index.js"),W=e("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts"),Oe=e("./frontend/src/lib/utils.tsx"),we=e("./frontend/src/lib/components/LemonButton/More.tsx");function ae(_e){var Ae=_e.pageKey,J=_e.actionId,re=Object(W.c)({actionId:J}),z=Object(he.useValues)(re),be=z.appUrlsKeyed,Ke=z.suggestionsLoading,oe=z.searchTerm,X=z.launchUrl,w=z.appUrls,Qe=z.editUrlIndex,F=Object(he.useActions)(re),Ne=F.addUrl,me=F.removeUrl,Te=F.setSearchTerm,se=F.updateUrl,We=F.newUrl,Ce=F.setEditUrlIndex,ze=[{title:"URLs",dataIndex:"url",key:"url",render:function(Q,j){var G=Object(N.useState)(j.url),H=te()(G,2),M=H[0],pe=H[1],Pe=Object(N.useState)(""),ve=te()(Pe,2),x=ve[0],Z=ve[1];Object(N.useEffect)(function(){return pe(j.url)},[j]);var V=function(){if(Z(""),M===W.a&&me(j.originalIndex),M.indexOf("*")>-1&&!M.match(/^(.*)\*[^\*]*\.[^\*]+\.[^\*]+$/)){Z("You can only wildcard subdomains. If you wildcard the domain or TLD, people might be able to gain access to your PostHog data.");return}if(!Object(Oe.fb)(M)){Z("Please type a valid URL or domain.");return}if(w.indexOf(M)>-1&&w.indexOf(M,j.originalIndex)!==j.originalIndex&&w.indexOf(M,j.originalIndex+1)!==j.originalIndex){Z("This URL is already registered.");return}se(j.originalIndex,M)};return j.type==="suggestion"||Q!==W.a&&Qe!==j.originalIndex?f.a.createElement("div",{className:Object(ue.a)("authorized-url-col",j.type)},j.type==="authorized"&&f.a.createElement(h.a,{style:{marginRight:4}}),Q,j.type==="suggestion"&&f.a.createElement(je.a,null,"Suggestion")):f.a.createElement("div",null,f.a.createElement("div",{style:{display:"flex"}},f.a.createElement(ne.a,{value:M,onChange:function(T){return pe(T.target.value)},onPressEnter:V,autoFocus:!0,placeholder:"Enter a URL or wildcard subdomain (e.g. https://*.posthog.com)"}),f.a.createElement(ye.a,{type:"primary",onClick:V},"Save")),x&&f.a.createElement("span",{className:"text-small text-danger"},x))}},{title:"",key:"actions",render:function(Q,j,G){return f.a.createElement("div",{className:"actions-col"},j.type==="suggestion"?f.a.createElement($.a,{type:"secondary",onClick:function(){return Ne(j.url)}},"Apply suggestion"):f.a.createElement(f.a.Fragment,null,f.a.createElement($.a,{type:"highlighted",href:X(j.url),className:"mr"},"Open with Toolbar"),f.a.createElement(we.a,{overlay:f.a.createElement(f.a.Fragment,null,f.a.createElement($.a,{fullWidth:!0,type:"stealth",onClick:function(){return Ce(j.originalIndex)}},"Edit authorized URL"),f.a.createElement($.a,{fullWidth:!0,style:{color:"var(--danger)"},type:"stealth",onClick:function(){return me(G)}},"Remove authorized URL"))})))}}];return f.a.createElement("div",null,f.a.createElement("div",{className:"flex-center mb"},f.a.createElement("div",{style:{flexGrow:1}},f.a.createElement(ne.a.Search,{allowClear:!0,enterButton:!0,placeholder:"Search for authorized URLs",style:{maxWidth:480},value:oe,onChange:function(Q){Te(Q.target.value)},autoFocus:Ae==="toolbar-launch"&&!Object(Oe.X)()})),f.a.createElement($.a,{type:"primary",onClick:We},"Add",Ae==="toolbar-launch"&&" authorized domain")),f.a.createElement(R.a,{className:"authorized-urls-table",columns:ze,dataSource:be,emptyState:oe?"There are no authorized URLs that match your search.":"There are no authorized URLs or domains. Add one to get started.",loading:Ke}))}try{ae.displayName="AuthorizedUrlsTable",ae.__docgenInfo={description:"",displayName:"AuthorizedUrlsTable",props:{pageKey:{defaultValue:null,description:"",name:"pageKey",required:!1,type:{name:"string"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"]={docgenInfo:ae.__docgenInfo,name:"AuthorizedUrlsTable",path:"frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"})}catch(_e){}},"./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts":function(ie,D,e){"use strict";e.d(D,"b",function(){return Fe}),e.d(D,"a",function(){return Se}),e.d(D,"c",function(){return Ve});var ee=e("./node_modules/core-js/modules/es.object.keys.js"),te=e.n(ee),t=e("./node_modules/core-js/modules/es.symbol.js"),xe=e.n(t),N=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),f=e.n(N),ce=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Je=e.n(ce),Re=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Be=e.n(Re),de=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ge=e.n(de),Xe=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ue=e.n(Xe),he=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),R=e.n(he),je=e("./node_modules/@babel/runtime/regenerator/index.js"),h=e.n(je),$=e("./node_modules/core-js/modules/es.array.concat.js"),ne=e.n($),ye=e("./node_modules/core-js/modules/es.array.iterator.js"),W=e.n(ye),Oe=e("./node_modules/core-js/modules/es.object.to-string.js"),we=e.n(Oe),ae=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),_e=e.n(ae),Ae=e("./node_modules/core-js/modules/es.array.slice.js"),J=e.n(Ae),re=e("./node_modules/core-js/modules/es.array.map.js"),z=e.n(re),be=e("./node_modules/core-js/modules/es.array.filter.js"),Ke=e.n(be),oe=e("./node_modules/core-js/modules/es.string.iterator.js"),X=e.n(oe),w=e("./node_modules/core-js/modules/web.url.js"),Qe=e.n(w),F=e("./node_modules/core-js/modules/web.url-search-params.js"),Ne=e.n(F),me=e("./node_modules/core-js/modules/es.regexp.to-string.js"),Te=e.n(me),se=e("./node_modules/core-js/modules/es.array.includes.js"),We=e.n(se),Ce=e("./node_modules/core-js/modules/es.string.includes.js"),ze=e.n(Ce),Y=e("./node_modules/core-js/modules/es.object.assign.js"),Q=e.n(Y),j=e("./node_modules/core-js/modules/es.array.splice.js"),G=e.n(j),H=e("./node_modules/core-js/modules/es.regexp.exec.js"),M=e.n(H),pe=e("./node_modules/core-js/modules/es.string.search.js"),Pe=e.n(pe),ve=e("./node_modules/kea/lib/index.esm.js"),x=e("./frontend/src/lib/api.ts"),Z=e("./frontend/src/lib/utils.tsx"),V=e("./frontend/src/scenes/teamLogic.tsx"),fe=e("./frontend/src/lib/dayjs.ts"),T=e("./node_modules/fuse.js/dist/fuse.esm.js"),Ue=e("./node_modules/kea-router/lib/index.js"),Ze=e.n(Ue);function le(O,i){var s=Object.keys(O);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(O);i&&(l=l.filter(function(E){return Object.getOwnPropertyDescriptor(O,E).enumerable})),s.push.apply(s,l)}return s}function k(O){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?le(Object(s),!0).forEach(function(l){R()(O,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(s)):le(Object(s)).forEach(function(l){Object.defineProperty(O,l,Object.getOwnPropertyDescriptor(s,l))})}return O}function Fe(O,i,s){var l=k(k({userIntent:s?void 0:i?"edit-action":"add-action"},i?{actionId:i}:{}),O?{appUrl:O}:{});return"/api/user/redirect_to_site/"+Object(Ue.encodeParams)(l,"?")}var Se="https://",Ve=Object(ve.kea)({path:function(i){return["lib","components","AppEditorLink","appUrlsLogic",i]},key:function(i){return"".concat(i.pageKey).concat(i.actionId)||"global"},props:{},connect:{values:[V.a,["currentTeam","currentTeamId"]],actions:[V.a,["updateCurrentTeam"]]},actions:function(){return{setAppUrls:function(s){return{appUrls:s}},addUrl:function(s,l){return{url:s,launch:l}},newUrl:!0,removeUrl:function(s){return{index:s}},updateUrl:function(s,l){return{index:s,url:l}},launchAtUrl:function(s){return{url:s}},setSearchTerm:function(s){return{term:s}},setEditUrlIndex:function(s){return{originalIndex:s}}}},loaders:function(i){var s=i.values;return{suggestions:{__default:[],loadSuggestions:function(){var l=ue()(h.a.mark(function y(){var I,C,U,B;return h.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return C={events:[{id:"$pageview",name:"$pageview",type:"events"}],breakdown:"$current_url",date_from:Object(fe.a)().subtract(3,"days").toISOString()},A.next=3,x.b.get("api/projects/".concat(s.currentTeamId,"/insights/trend/?").concat(Object(Z.Ab)(C)));case 3:if(U=A.sent.result,!(U&&((I=U[0])===null||I===void 0?void 0:I.count)===0)){A.next=6;break}return A.abrupt("return",[]);case 6:return B=[],A.abrupt("return",(U||[]).filter(function(K){if(!K.breakdown_value)return!1;try{var De=new URL(K.breakdown_value.toString()).hostname;return B.indexOf(De)>-1||s.appUrls.filter(function($e){return $e.indexOf(De)>-1}).length>0?void 0:(B.push(De),!0)}catch($e){return!1}}).map(function(K){return K.breakdown_value}).slice(0,20));case 8:case"end":return A.stop()}},y)}));function E(){return l.apply(this,arguments)}return E}()}}},events:function(i){var s=i.actions,l=i.values;return{afterMount:function(){s.loadSuggestions(),l.currentTeam&&s.setAppUrls(l.currentTeam.app_urls)}}},reducers:function(){return{appUrls:[[],{setAppUrls:function(s,l){var E=l.appUrls;return E},addUrl:function(s,l){var E=l.url;return s.concat([E])},newUrl:function(s){return s.includes(Se)?s:[Se].concat(s)},updateUrl:function(s,l){var E=l.index,y=l.url;return Object.assign(ge()(s),R()({},E,y))},removeUrl:function(s,l){var E=l.index,y=ge()(s);return y.splice(E,1),y}}],suggestions:[[],{addUrl:function(s,l){var E=l.url;return ge()(s).filter(function(y){return E!==y})}}],searchTerm:["",{setSearchTerm:function(s,l){var E=l.term;return E}}],editUrlIndex:[null,{setEditUrlIndex:function(s,l){var E=l.originalIndex;return E},removeUrl:function(s,l){var E=l.index;return s&&E<s?s-1:E===s?null:s}}]}},listeners:function(i){var s,l=i.sharedListeners,E=i.values,y=i.actions;return s={addUrl:[l.saveAppUrls,function(){var I=ue()(h.a.mark(function C(U){var B,Ee;return h.a.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:B=U.url,Ee=U.launch,Ee&&y.launchAtUrl(B);case 2:case"end":return K.stop()}},C)}));return function(C){return I.apply(this,arguments)}}()],removeUrl:l.saveAppUrls,updateUrl:[l.saveAppUrls,function(){return y.setEditUrlIndex(null)}]},R()(s,V.a.actionTypes.loadCurrentTeamSuccess,function(){var I=ue()(h.a.mark(function C(U){var B;return h.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:B=U.currentTeam,B&&y.setAppUrls(B.app_urls);case 2:case"end":return A.stop()}},C)}));return function(C){return I.apply(this,arguments)}}()),R()(s,"launchAtUrl",function(C){var U=C.url;window.location.href=E.launchUrl(U)}),s},sharedListeners:function(i){var s=i.values;return{saveAppUrls:function(){V.a.actions.updateCurrentTeam({app_urls:s.appUrls})}}},selectors:function(i){var s=i.props;return{appUrlsKeyed:[function(l){return[l.appUrls,l.suggestions,l.searchTerm]},function(l,E,y){var I=l.map(function(C,U){return{url:C,type:"authorized",originalIndex:U}}).concat(E.map(function(C,U){return{url:C,type:"suggestion",originalIndex:U}}));return y?new T.a(I,{keys:["url"],threshold:.3}).search(y).map(function(C){return C.item}):I}],launchUrl:[function(){return[]},function(){return function(l){return Fe(l,s.actionId,!s.actionId)}}]}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss":function(ie,D,e){var ee=e("./node_modules/css-loader/dist/runtime/api.js");D=ee(!1),D.push([ie.i,".authorized-urls-table .authorized-url-col{display:flex;align-items:center}.authorized-urls-table .authorized-url-col .lemon-tag{margin-left:6px}.authorized-urls-table .authorized-url-col.suggestion{color:var(--text-muted-alt)}.authorized-urls-table .authorized-url-col.authorized{color:var(--success)}.authorized-urls-table .actions-col{display:flex;align-items:center;justify-content:flex-end}",""]),ie.exports=D}}]);
