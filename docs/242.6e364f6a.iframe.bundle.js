(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{4479:function(module,exports,__webpack_require__){(exports=__webpack_require__(48)(!1)).push([module.i,'.mixin-gradient-overlay{width:100%;height:3rem;background:linear-gradient(0deg,#fff,transparent)}.mixin-gradient-overlay,.mixin-gradient-overlay-right{content:"";position:absolute;pointer-events:none;bottom:0}.mixin-gradient-overlay-right{width:3rem;height:100%;background:linear-gradient(270deg,#fff,transparent)}.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.experiment-form .ant-carousel .slick-dots li{background-color:rgba(0,0,0,.15)}.experiment-form .ant-carousel .slick-dots li.slick-active button{background-color:#a0b2ff;height:100%}',""]),module.exports=exports},4729:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Experiment",(function(){return Experiment_Experiment}));__webpack_require__(249),__webpack_require__(266),__webpack_require__(33),__webpack_require__(63);var slicedToArray=__webpack_require__(13),slicedToArray_default=__webpack_require__.n(slicedToArray),SaveOutlined=__webpack_require__(4482),SaveOutlined_default=__webpack_require__.n(SaveOutlined),es_form=__webpack_require__(452),carousel=__webpack_require__(4715),input=__webpack_require__(556),es_button=__webpack_require__(129),row=__webpack_require__(340),col=__webpack_require__(248),index_esm=__webpack_require__(1),PageHeader=__webpack_require__(341),PropertyFilters=__webpack_require__(430),types=__webpack_require__(36),react=__webpack_require__(0),react_default=__webpack_require__.n(react),userLogic=__webpack_require__(65),injectStylesIntoStyleTag=__webpack_require__(17),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Experiment=__webpack_require__(4479),Experiment_default=__webpack_require__.n(Experiment),options={insert:"head",singleton:!1},regenerator=(injectStylesIntoStyleTag_default()(Experiment_default.a,options),Experiment_default.a.locals,__webpack_require__(41),__webpack_require__(45),__webpack_require__(38),__webpack_require__(50),__webpack_require__(6)),regenerator_default=__webpack_require__.n(regenerator),defineProperty=__webpack_require__(5),defineProperty_default=__webpack_require__.n(defineProperty),asyncToGenerator=(__webpack_require__(69),__webpack_require__(11)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),api=__webpack_require__(22),teamLogic=__webpack_require__(29);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var experimentLogic=Object(index_esm.kea)({path:["scenes","experiment","experimentLogic"],connect:{values:[teamLogic.a,["currentTeamId"]]},actions:{setExperimentId:function setExperimentId(experimentId){return{experimentId:experimentId}},setNewExperimentData:function setNewExperimentData(experimentData){return{experimentData:experimentData}},createDraftExperiment:!0,createExperiment:!0},reducers:{experimentId:[null,{setExperimentId:function setExperimentId(_,_ref){return _ref.experimentId}}],newExperimentData:[null,{setNewExperimentData:function setNewExperimentData(_,_ref2){return _ref2.experimentData}}]},listeners:function listeners(_ref3){var _createExperiment,values=_ref3.values;return{createExperiment:(_createExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,api.a.create("api/projects/".concat(values.currentTeamId,"/experiments"),_objectSpread({},values.newExperimentData));case 2:case"end":return _context.stop()}}),_callee)}))),function createExperiment(){return _createExperiment.apply(this,arguments)})}},loaders:function loaders(_ref4){var _loadExperiment,values=_ref4.values;return{experimentData:[null,{loadExperiment:(_loadExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(){var response;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!values.experimentId||"new"===values.experimentId){_context2.next=6;break}return _context2.next=3,api.a.get("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId));case 3:return response=_context2.sent,console.log(response),_context2.abrupt("return",response);case 6:return _context2.abrupt("return",null);case 7:case"end":return _context2.stop()}}),_callee2)}))),function loadExperiment(){return _loadExperiment.apply(this,arguments)})}]}},urlToAction:function urlToAction(_ref5){var actions=_ref5.actions,values=_ref5.values;return{"/experiments/:id":function experimentsId(_ref6){var id=_ref6.id;if(console.log("exp id: ",id),id){var parsedId="new"===id?"new":parseInt(id);parsedId!==values.experimentId&&actions.setExperimentId(parsedId),"new"!==parsedId&&actions.loadExperiment()}}}}}),scene={component:Experiment_Experiment,logic:experimentLogic};function Experiment_Experiment(){var _newExperimentData$fi,_newExperimentData$fi2,_experimentData$creat,user=Object(index_esm.useValues)(userLogic.a).user,_useValues2=Object(index_esm.useValues)(experimentLogic),newExperimentData=_useValues2.newExperimentData,experimentId=_useValues2.experimentId,experimentData=_useValues2.experimentData,_useActions=Object(index_esm.useActions)(experimentLogic),setNewExperimentData=_useActions.setNewExperimentData,createExperiment=_useActions.createExperiment,createDraftExperiment=_useActions.createDraftExperiment,carouselRef=Object(react.useRef)(null),handleNext=function handleNext(){return carouselRef.current.next()},_Form$useForm=es_form.a.useForm(),form=slicedToArray_default()(_Form$useForm,1)[0];return"new"===experimentId?react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(PageHeader.a,{title:"New Experiment"}),react_default.a.createElement(es_form.a,{name:"new-experiment",layout:"vertical",className:"experiment-form",form:form,onFinish:function onFinish(values){return setNewExperimentData(values)}},react_default.a.createElement(carousel.a,{ref:carouselRef},react_default.a.createElement("div",null,react_default.a.createElement(es_form.a.Item,{label:"Name",name:"name"},react_default.a.createElement(input.a,{"data-attr":"experiment-name",className:"ph-ignore-input"})),react_default.a.createElement(es_form.a.Item,{label:"Feature flag key",name:"feature_flag_key"},react_default.a.createElement(input.a,{"data-attr":"experiment-feature-flag-key"})),react_default.a.createElement(es_form.a.Item,{label:"Description",name:"description"},react_default.a.createElement(input.a.TextArea,{"data-attr":"experiment-description",className:"ph-ignore-input",placeholder:"Adding a helpful description can ensure others know what this experiment is about."})),react_default.a.createElement(es_form.a.Item,{className:"text-right"},react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(SaveOutlined_default.a,null),htmlType:"submit",type:"primary",onClick:handleNext},"Save and continue"))),react_default.a.createElement("div",null,react_default.a.createElement(es_form.a.Item,{label:"Person selection"},react_default.a.createElement(es_form.a.Item,{name:"filters"},react_default.a.createElement("label",null,"Select the users who will participate in this experiment."),react_default.a.createElement("div",{style:{flex:3,marginRight:5}},react_default.a.createElement(PropertyFilters.b,{endpoint:"person",pageKey:"1234",onChange:function onChange(personProperties){form.setFieldsValue({filters:{properties:personProperties}})},propertyFilters:[],style:{margin:"1rem 0 0"},taxonomicGroupTypes:[types.a.PersonProperties,types.a.CohortsWithAllUsers],popoverPlacement:"top",taxonomicPopoverPlacement:"auto"})))),react_default.a.createElement(es_form.a.Item,{className:"text-right"},react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(SaveOutlined_default.a,null),htmlType:"submit",type:"primary",onClick:handleNext},"Save and preview")),react_default.a.createElement(es_button.a,{onClick:function handlePrev(){return carouselRef.current.prev()}},"Go back")),newExperimentData&&react_default.a.createElement("div",{className:"confirmation"},react_default.a.createElement(PageHeader.a,{title:newExperimentData.name}),react_default.a.createElement("div",null,null==newExperimentData?void 0:newExperimentData.description),react_default.a.createElement("div",null,"Owner: ",null==user?void 0:user.first_name),react_default.a.createElement("div",null,"Feature flag key: ",null==newExperimentData?void 0:newExperimentData.feature_flag_key),react_default.a.createElement(row.a,null,react_default.a.createElement(col.a,null,react_default.a.createElement(row.a,null,"Person allocation"),react_default.a.createElement(row.a,null,"The following users will participate in the experiment"),react_default.a.createElement("ul",null,null===(_newExperimentData$fi=newExperimentData.filters)||void 0===_newExperimentData$fi||null===(_newExperimentData$fi2=_newExperimentData$fi.properties)||void 0===_newExperimentData$fi2?void 0:_newExperimentData$fi2.map((function(filter,idx){return react_default.a.createElement("li",{key:idx},"Users with ",filter.key," ",filter.operator," ",Array.isArray(filter.value)?filter.value.map((function(val){return"".concat(val,", ")})):filter.value)}))))),react_default.a.createElement(es_button.a,{onClick:createDraftExperiment},"Save as draft"),react_default.a.createElement(es_button.a,{type:"primary",onClick:createExperiment},"Save and launch"))))):experimentData?react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("div",null,react_default.a.createElement(PageHeader.a,{title:experimentData.name}),react_default.a.createElement("div",null,null==experimentData?void 0:experimentData.description),react_default.a.createElement("div",null,"Owner: ",null===(_experimentData$creat=experimentData.created_by)||void 0===_experimentData$creat?void 0:_experimentData$creat.first_name),react_default.a.createElement("div",null,"Feature flag key: ",null==experimentData?void 0:experimentData.feature_flag_key))):react_default.a.createElement("div",null,"Loading...")}}}]);