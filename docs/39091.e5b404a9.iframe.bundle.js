"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[39091],{"../../frontend/src/lib/components/Cards/InsightCard/QueryCard.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>QueryCard});var clsx__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib_components_Cards_CardMeta__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/components/Cards/CardMeta.tsx"),lib_lemon_ui_LemonMenu_LemonMenu__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/LemonMenu.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_ErrorBoundary__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/layout/ErrorBoundary/index.ts"),_layout_navigation_3000_themeLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),_queries_Query_Query__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),_InsightDetails__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/InsightDetails.tsx"),_InsightMeta__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/InsightMeta.tsx"),_TopHeading__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/TopHeading.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let QueryCard=react__WEBPACK_IMPORTED_MODULE_1__.forwardRef(function QueryCard(_ref,ref){let{query,title,description,context,highlighted,ribbonColor,className,sceneSource,attachTo,uniqueKey,...divProps}=_ref,{theme}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_layout_navigation_3000_themeLogic__WEBPACK_IMPORTED_MODULE_6__.b),[areDetailsShown,setAreDetailsShown]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:(0,clsx__WEBPACK_IMPORTED_MODULE_12__.default)("InsightCard border",highlighted&&"InsightCard--highlighted",className),"data-attr":"insight-card",...divProps,style:{...divProps?.style,...theme?.boxStyle},ref:ref,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(_layout_ErrorBoundary__WEBPACK_IMPORTED_MODULE_5__.S,{exceptionProps:{feature:"insight"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_components_Cards_CardMeta__WEBPACK_IMPORTED_MODULE_2__.I,{ribbonColor:ribbonColor,setAreDetailsShown:setAreDetailsShown,areDetailsShown:areDetailsShown,topHeading:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_TopHeading__WEBPACK_IMPORTED_MODULE_10__.l,{query:query}),content:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_InsightMeta__WEBPACK_IMPORTED_MODULE_9__.Q,{title:title,description:description}),metaDetails:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_InsightDetails__WEBPACK_IMPORTED_MODULE_8__.Mz,{query:query}),samplingFactor:"samplingFactor"in query&&"number"==typeof query.samplingFactor?query.samplingFactor:void 0,moreButtons:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonMenu_LemonMenu__WEBPACK_IMPORTED_MODULE_3__.tN,{items:[{label:"Open as new insight",to:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.insightNew({query,sceneSource})}]}),showEditingControls:!0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"InsightCard__viz",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_queries_Query_Query__WEBPACK_IMPORTED_MODULE_7__.A,{attachTo:attachTo,query:query,readOnly:!0,embedded:!0,context:context,uniqueKey:uniqueKey})})]})})})},"../../products/customer_analytics/frontend/CustomerAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CustomerAnalyticsScene:()=>CustomerAnalyticsScene,scene:()=>scene});var sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes=__webpack_require__("../../frontend/src/scenes/scenes.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),ActionFilter=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),ActionFilterRow=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),src_types=__webpack_require__("../../frontend/src/types.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),filtersToQueryNode=__webpack_require__("../../frontend/src/queries/nodes/InsightQuery/utils/filtersToQueryNode.ts"),queryNodeToFilter=__webpack_require__("../../frontend/src/queries/nodes/InsightQuery/utils/queryNodeToFilter.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx");let customerAnalyticsConfigLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","customerAnalytics","customerAnalyticsConfigModel"]),(0,index_esm.actions)({loadConfig:!0,updateEvents:events=>({events})}),(0,index_esm.connect)(()=>({values:[teamLogic.teamLogic,["customerAnalyticsConfig"]],actions:[teamLogic.teamLogic,["updateCurrentTeam"]]})),(0,index_esm.selectors)({activityEvent:[s=>[s.customerAnalyticsConfig],config=>config.activity_event],signupEvent:[s=>[s.customerAnalyticsConfig],config=>config.signup_event],signupPageviewEvent:[s=>[s.customerAnalyticsConfig],config=>config.signup_pageview_event],subscriptionEvent:[s=>[s.customerAnalyticsConfig],config=>config.subscription_event],paymentEvent:[s=>[s.customerAnalyticsConfig],config=>config.payment_event]}),(0,index_esm.listeners)(_ref=>{let{actions}=_ref;return{updateEvents:_ref2=>{let{events}=_ref2,customer_analytics_config={...events};actions.updateCurrentTeam({customer_analytics_config})}}})]),eventConfigModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","customerAnalytics","components","insights","eventConfigModal"]),(0,index_esm.connect)(()=>({values:[customerAnalyticsConfigLogic,["activityEvent","signupEvent","signupPageviewEvent","subscriptionEvent","paymentEvent"]],actions:[customerAnalyticsConfigLogic,["updateEvents"]]})),(0,index_esm.actions)({addEventToHighlight:event=>({event}),clearEventsToHighlight:!0,clearFilterSelections:!0,setActivityEventSelection:filters=>({filters}),setSignupEventSelection:filters=>({filters}),setSignupPageviewEventSelection:filters=>({filters}),setPaymentEventSelection:filters=>({filters}),setSubscriptionEventSelection:filters=>({filters}),saveEvents:!0,toggleModalOpen:isOpen=>({isOpen})}),(0,index_esm.reducers)({activityEventSelection:[null,{setActivityEventSelection:(_,_ref)=>{let{filters}=_ref;return filters},clearFilterSelections:()=>null}],signupEventSelection:[null,{setSignupEventSelection:(_,_ref2)=>{let{filters}=_ref2;return filters},clearFilterSelections:()=>null}],signupPageviewEventSelection:[null,{setSignupPageviewEventSelection:(_,_ref3)=>{let{filters}=_ref3;return filters},clearFilterSelections:()=>null}],paymentEventSelection:[null,{setPaymentEventSelection:(_,_ref4)=>{let{filters}=_ref4;return filters},clearFilterSelections:()=>null}],subscriptionEventSelection:[null,{setSubscriptionEventSelection:(_,_ref5)=>{let{filters}=_ref5;return filters},clearFilterSelections:()=>null}],isOpen:[!1,{toggleModalOpen:(state,_ref6)=>{let{isOpen}=_ref6;return void 0!==isOpen?isOpen:!state}}],eventsToHighlight:[[],{addEventToHighlight:(state,_ref7)=>{let{event}=_ref7;return[...state,event]},clearEventsToHighlight:()=>[]}]}),(0,index_esm.selectors)(_ref8=>{let{actions}=_ref8;return{activityEventFilters:[s=>[s.activityEvent,s.activityEventSelection],(activityEvent,activityEventSelection)=>activityEventSelection||{insight:src_types.dw.TRENDS,...(0,queryNodeToFilter.sB)(activityEvent?[activityEvent]:[])}],signupEventFilters:[s=>[s.signupEvent,s.signupEventSelection],(signupEvent,signupEventSelection)=>signupEventSelection||((0,utils.Qr)(signupEvent)?null:{insight:src_types.dw.TRENDS,...(0,queryNodeToFilter.sB)([signupEvent])})],signupPageviewEventFilters:[s=>[s.signupPageviewEvent,s.signupPageviewEventSelection],(signupPageviewEvent,signupPageviewEventSelection)=>signupPageviewEventSelection||((0,utils.Qr)(signupPageviewEvent)?null:{insight:src_types.dw.TRENDS,...(0,queryNodeToFilter.sB)([signupPageviewEvent])})],paymentEventFilters:[s=>[s.paymentEvent,s.paymentEventSelection],(paymentEvent,paymentEventSelection)=>paymentEventSelection||((0,utils.Qr)(paymentEvent)?null:{insight:src_types.dw.TRENDS,...(0,queryNodeToFilter.sB)([paymentEvent])})],subscriptionEventFilters:[s=>[s.subscriptionEvent,s.subscriptionEventSelection],(subscriptionEvent,subscriptionEventSelection)=>subscriptionEventSelection||((0,utils.Qr)(subscriptionEvent)?null:{insight:src_types.dw.TRENDS,...(0,queryNodeToFilter.sB)([subscriptionEvent])})],hasChanges:[s=>[s.activityEventSelection,s.signupEventSelection,s.signupPageviewEventSelection,s.paymentEventSelection,s.subscriptionEventSelection],(activityEventSelection,signupEventSelection,signupPageviewEventSelection,paymentEventSelection,subscriptionEventSelection)=>null!==activityEventSelection||null!==signupEventSelection||null!==signupPageviewEventSelection||null!==paymentEventSelection||null!==subscriptionEventSelection],eventSelectors:[s=>[s.activityEventFilters,s.signupEventFilters,s.signupPageviewEventFilters,s.paymentEventFilters,s.subscriptionEventFilters],(activityEventFilters,signupEventFilters,signupPageviewEventFilters,paymentEventFilters,subscriptionEventFilters)=>[{title:"Activity event",caption:"Defines what is considered user activity for active users and engagement calculations",filters:activityEventFilters,setFilters:actions.setActivityEventSelection},{title:"Signup event",caption:"Tracks when users complete registration or account creation",filters:signupEventFilters,setFilters:actions.setSignupEventSelection},{title:"Signup pageview event",caption:"Tracks when users view the signup page",filters:signupPageviewEventFilters,setFilters:actions.setSignupPageviewEventSelection},{title:"Payment event",caption:"Tracks when users complete payment transactions",filters:paymentEventFilters,setFilters:actions.setPaymentEventSelection},{title:"Subscription event",caption:"Tracks when users subscribe to a plan",filters:subscriptionEventFilters,setFilters:actions.setSubscriptionEventSelection}]]}}),(0,index_esm.listeners)(_ref9=>{let{actions,values}=_ref9;return{saveEvents:()=>{let events={};values.activityEventSelection&&(events.activity_event=(0,filtersToQueryNode.NG)(values.activityEventSelection,!0,ActionFilterRow.Qq.None)[0]),values.signupEventSelection&&(events.signup_event=(0,filtersToQueryNode.NG)(values.signupEventSelection,!0,ActionFilterRow.Qq.None)[0]),values.signupPageviewEventSelection&&(events.signup_pageview_event=(0,filtersToQueryNode.NG)(values.signupPageviewEventSelection,!0,ActionFilterRow.Qq.None)[0]),values.paymentEventSelection&&(events.payment_event=(0,filtersToQueryNode.NG)(values.paymentEventSelection,!0,ActionFilterRow.Qq.None)[0]),values.subscriptionEventSelection&&(events.subscription_event=(0,filtersToQueryNode.NG)(values.subscriptionEventSelection,!0,ActionFilterRow.Qq.None)[0]),actions.updateEvents(events)},toggleModalOpen:_ref10=>{let{isOpen}=_ref10;(!1===isOpen||void 0===isOpen&&values.isOpen)&&(actions.setActivityEventSelection(null),actions.setSignupEventSelection(null),actions.setSignupPageviewEventSelection(null),actions.setPaymentEventSelection(null),actions.setSubscriptionEventSelection(null))}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function EventConfigModal(){let{eventSelectors,hasChanges,isOpen}=(0,index_esm.useValues)(eventConfigModalLogic),{saveEvents,toggleModalOpen,clearFilterSelections,clearEventsToHighlight}=(0,index_esm.useActions)(eventConfigModalLogic),onClose=()=>{toggleModalOpen(!1),clearFilterSelections(),clearEventsToHighlight()};return(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isOpen,onClose:onClose,title:"Configure customer analytics events",width:800,hasUnsavedInput:hasChanges,children:[(0,jsx_runtime.jsxs)(src.fQ.Header,{children:[(0,jsx_runtime.jsx)("p",{className:"mb-2",children:"Configure the events or actions that define different user behaviors for your customer analytics dashboard"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 text-muted text-xs",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-base"}),(0,jsx_runtime.jsxs)("span",{children:["To track multiple events as activity, you can"," ",(0,jsx_runtime.jsx)(src.rU,{to:urls.j.createAction(),target:"_blank",children:"create an action"})," ","that combines them."]})]})]}),(0,jsx_runtime.jsx)(src.fQ.Content,{children:(0,jsx_runtime.jsx)("div",{className:"space-y-4",children:eventSelectors.map((eventSelector,index)=>(0,jsx_runtime.jsx)(EventSelector,{...eventSelector},index))})}),(0,jsx_runtime.jsxs)(src.fQ.Footer,{children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:onClose,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{saveEvents(),toggleModalOpen(!1),clearEventsToHighlight()},disabledReason:hasChanges?null:"No changes",children:"Save events"})]})]})}function EventSelector(_ref){let{filters,setFilters,title,caption}=_ref,{eventsToHighlight}=(0,index_esm.useValues)(eventConfigModalLogic),highlight=eventsToHighlight.includes(title)?"border rounded border-dashed border-danger":"";return(0,jsx_runtime.jsxs)("div",{className:`p-2 ${highlight}`,children:[(0,jsx_runtime.jsxs)("div",{className:"ml-1",children:[(0,jsx_runtime.jsx)(src.HQ,{children:title}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted-alt",children:caption})]}),filters?(0,jsx_runtime.jsx)(ActionFilter.T,{hideRename:!0,hideDuplicate:!0,hideFilter:!0,propertyFiltersPopover:!0,filters:filters,setFilters:setFilters,typeKey:`customer-analytics-${title.toLowerCase()}`,mathAvailability:ActionFilterRow.Qq.None,actionsTaxonomicGroupTypes:[types.t.Events,types.t.Actions],buttonCopy:"Select event or action",entitiesLimit:1}):(0,jsx_runtime.jsx)(src.Jp,{type:"tertiary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),onClick:()=>{setFilters({events:[{id:"$pageview",name:"$pageview",type:src_types.DC.EVENTS}]})},children:"Select event or action"})]})}var constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),CardMeta=__webpack_require__("../../frontend/src/lib/components/Cards/CardMeta.tsx"),InsightMeta=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/InsightMeta.tsx"),QueryCard=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/QueryCard.tsx"),TopHeading=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/TopHeading.tsx"),tabAwareScene=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareScene.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts");let customerAnalyticsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","customerAnalytics","customerAnalyticsScene"]),(0,tabAwareScene.P)(),(0,index_esm.connect)(()=>({values:[customerAnalyticsConfigLogic,["customerAnalyticsConfig","activityEvent","signupEvent","signupPageviewEvent","subscriptionEvent","paymentEvent"]]})),(0,index_esm.selectors)({tabId:[()=>[(_,props)=>props.tabId],tabIdProp=>tabIdProp],breadcrumbs:[()=>[],()=>[{key:sceneTypes.x.CustomerAnalytics,name:scenes.lc[sceneTypes.x.CustomerAnalytics].name,path:urls.j.customerAnalytics(),iconType:scenes.lc[sceneTypes.x.CustomerAnalytics].iconType||"default_icon_type"}]],dauSeries:[s=>[s.activityEvent],activityEvent=>activityEvent?{...activityEvent,math:src_types.vN.UniqueUsers}:null],wauSeries:[s=>[s.activityEvent],activityEvent=>activityEvent?{...activityEvent,math:src_types.vN.WeeklyActiveUsers}:null],mauSeries:[s=>[s.activityEvent],activityEvent=>activityEvent?{...activityEvent,math:src_types.vN.MonthlyActiveUsers}:null],signupSeries:[s=>[s.signupEvent],signupEvent=>0===Object.keys(signupEvent).length?null:{...signupEvent,math:src_types.vN.UniqueUsers}],signupPageviewSeries:[s=>[s.signupPageviewEvent],signupPageviewEvent=>0===Object.keys(signupPageviewEvent).length?null:{...signupPageviewEvent,math:src_types.vN.UniqueUsers}],subscriptionSeries:[s=>[s.subscriptionEvent],subscriptionEvent=>0===Object.keys(subscriptionEvent).length?null:{...subscriptionEvent,math:src_types.vN.UniqueUsers}],paymentSeries:[s=>[s.paymentEvent],paymentEvent=>0===Object.keys(paymentEvent).length?null:{...paymentEvent,math:src_types.vN.UniqueUsers}],activeUsersInsights:[s=>[s.dauSeries,s.wauSeries,s.mauSeries],(dauSeries,wauSeries,mauSeries)=>dauSeries&&wauSeries&&mauSeries?[{name:"Active Users (DAU/WAU/MAU)",className:"row-span-2 h-[576px]",query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[dauSeries,wauSeries,mauSeries],interval:"day",dateRange:{date_from:"-90d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.ActionsLineGraph,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,smoothingIntervals:1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"Weekly Active Users",className:"h-[284px]",query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[wauSeries],interval:"day",dateRange:{date_from:"-7d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.BoldNumber,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,smoothingIntervals:1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},compareFilter:{compare:!0},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"Monthly Active Users",className:"h-[284px]",query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[mauSeries],interval:"day",dateRange:{date_to:null,date_from:"-30d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.BoldNumber,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,smoothingIntervals:1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},compareFilter:{compare:!0},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}}]:[]],sessionInsights:[()=>[],()=>[{name:"Unique sessions (last 1h)",description:"Events without session IDs are excluded.",className:"h-[284px]",query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[{kind:schema_general.OH.EventsNode,math:src_types.vN.UniqueSessions,name:"All events",event:null}],interval:"minute",dateRange:{date_to:"",date_from:"-1h",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.BoldNumber,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},compareFilter:{compare:!0},breakdownFilter:void 0,filterTestAccounts:!0}}},{name:"Unique users (last 1h)",description:"Number of unique users recently.",className:"h-[284px]",query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[{kind:schema_general.OH.EventsNode,math:src_types.vN.UniqueUsers,name:"All events",event:null}],interval:"hour",dateRange:{date_to:"",date_from:"-1h",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.BoldNumber,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},compareFilter:{compare:!0},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"Average session duration (last 1h)",description:"Average session duration for recent sessions.",className:"h-[284px]",query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[{kind:schema_general.OH.EventsNode,math:src_types.O4.Average,name:"$pageview",event:"$pageview",math_property:"$session_duration"}],interval:"minute",dateRange:{date_to:"",date_from:"-1h",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.BoldNumber,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,showPercentStackView:!1,aggregationAxisFormat:"duration",showAlertThresholdLines:!1},compareFilter:{compare:!0},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}}]],signupInsights:[s=>[s.signupSeries,s.paymentSeries,s.subscriptionSeries,s.signupPageviewSeries,s.dauSeries],(signupSeries,paymentSeries,subscriptionSeries,signupPageviewSeries,dauSeries)=>[{name:"User Signups",requiredSeries:{signupSeries},query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[signupSeries],interval:"day",dateRange:{date_to:null,date_from:"-30d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.BoldNumber,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,smoothingIntervals:1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},compareFilter:{compare:!0},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"Total Paying Customers",requiredSeries:{paymentSeries},query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[paymentSeries],interval:"day",dateRange:{date_to:null,date_from:"-30d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.BoldNumber,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},compareFilter:{compare:!0},filterTestAccounts:!0}}},{name:"User signups and subscriptions",requiredSeries:{signupSeries,subscriptionSeries},query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[signupSeries,subscriptionSeries],interval:"day",dateRange:{date_from:"-90d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.ActionsLineGraph,showLegend:!1,yAxisScaleType:"linear",showMultipleYAxes:!1,showValuesOnSeries:!1,smoothingIntervals:7,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"New Signups (Weekly)",requiredSeries:{signupSeries},query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[signupSeries],interval:"week",dateRange:{date_to:null,date_from:"-180d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.ActionsAreaGraph,showLegend:!1,yAxisScaleType:"linear",showValuesOnSeries:!1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"Cumulative Signups (Adoption)",requiredSeries:{signupSeries},query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,series:[signupSeries],interval:"day",dateRange:{date_from:"-90d",explicitDate:!1},properties:[],trendsFilter:{display:src_types.Qb.ActionsLineGraphCumulative,showLegend:!1,showTrendLines:!1,yAxisScaleType:"linear",showMultipleYAxes:!1,showValuesOnSeries:!1,showPercentStackView:!1,aggregationAxisFormat:"numeric",showAlertThresholdLines:!1},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"Signup Conversion Rate",requiredSeries:{signupSeries,signupPageviewSeries},query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.FunnelsQuery,series:[signupPageviewSeries,signupSeries],interval:"week",dateRange:{date_from:"-30d",explicitDate:!1},properties:[],funnelsFilter:{layout:constants.xp.vertical,exclusions:[],funnelVizType:src_types.Ui.Trends,funnelOrderType:src_types.kO.ORDERED,funnelStepReference:src_types.XF.total,funnelWindowInterval:14,breakdownAttributionType:src_types.q9.FirstTouch,funnelWindowIntervalUnit:src_types.ih.Day},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}},{name:"Which customers are highly engaged?",requiredSeries:{dauSeries},query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.LifecycleQuery,series:[dauSeries],interval:"week",dateRange:{date_from:"-30d",explicitDate:!1},properties:[],lifecycleFilter:{showLegend:!1},filterTestAccounts:!0,aggregation_group_type_index:0}}},{name:"Free to Paid User Conversion",requiredSeries:{signupSeries,paymentSeries},query:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.FunnelsQuery,series:[signupSeries,paymentSeries],dateRange:{date_from:"-90d",explicitDate:!1},properties:[],funnelsFilter:{layout:constants.xp.horizontal,exclusions:[],funnelVizType:src_types.Ui.Steps,funnelOrderType:src_types.kO.ORDERED,funnelStepReference:src_types.XF.total,funnelWindowInterval:6,breakdownAttributionType:src_types.q9.FirstTouch,funnelWindowIntervalUnit:src_types.ih.Week},breakdownFilter:{breakdown_type:"event"},filterTestAccounts:!0}}}]]})]),SERIES_TO_EVENT_NAME_MAPPING={dauSeries:"Activity event",mauSeries:"Activity event",wauSeries:"Activity event",signupSeries:"Signup event",signupPageviewSeries:"Signup pageview event",subscriptionSeries:"Subscription event",subscriptionPageviewSeries:"Subscription pageview event",paymentSeries:"Payment event"};function anyValueIsNull(object){return Object.values(object).some(value=>null===value)}function getEmptySeriesNames(requiredSeries){return Object.entries(requiredSeries).filter(_ref=>{let[,value]=_ref;return!value}).map(_ref2=>{let[key]=_ref2;return key})}function CustomerAnalyticsQueryCard(_ref3){let{insight,tabId}=_ref3,{addEventToHighlight,toggleModalOpen}=(0,index_esm.useActions)(eventConfigModalLogic);if(insight?.requiredSeries&&anyValueIsNull(insight.requiredSeries)){let missingSeries=insight?.requiredSeries?getEmptySeriesNames(insight.requiredSeries):[];return(0,jsx_runtime.jsxs)(src.Mi,{hoverEffect:!1,className:"h-[400px] p-0",children:[(0,jsx_runtime.jsx)(CardMeta.I,{topHeading:(0,jsx_runtime.jsx)(TopHeading.l,{query:insight.query}),content:(0,jsx_runtime.jsx)(InsightMeta.Q,{title:insight.name,description:insight.description})}),(0,jsx_runtime.jsxs)(src.Vp,{type:"warning",children:["This insight requires configuration.",(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center gap-4 mt-2 max-w-160",children:(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{missingSeries.forEach(seriesName=>{addEventToHighlight(SERIES_TO_EVENT_NAME_MAPPING[seriesName])}),toggleModalOpen()},children:"Configure events"})})]})]})}return(0,jsx_runtime.jsx)(QueryCard.w,{uniqueKey:`${insight.name}-${tabId}`,title:insight.name,description:insight.description,query:insight.query,context:{refresh:"force_blocking"},className:insight?.className||"",attachTo:customerAnalyticsSceneLogic})}function SessionInsights(){let{sessionInsights,tabId}=(0,index_esm.useValues)(customerAnalyticsSceneLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("h2",{className:"mb-0 ml-1",children:"Session insights"}),featureFlags[constants.y8.SESSIONS_EXPLORER]&&(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",noPadding:!0,targetBlank:!0,to:urls.j.activity(src_types.ZO.ExploreSessions),tooltip:"Open session explorer"})]}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-3 gap-2",children:sessionInsights.map((insight,index)=>(0,jsx_runtime.jsx)(CustomerAnalyticsQueryCard,{insight:insight,tabId:tabId},index))})]})}var Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),queries_utils=__webpack_require__("../../frontend/src/queries/utils.ts");function ActiveUsersInsights(){let{activityEvent,activeUsersInsights,tabId}=(0,index_esm.useValues)(customerAnalyticsSceneLogic),{toggleModalOpen}=(0,index_esm.useActions)(eventConfigModalLogic),isOnlyPageview=(0,queries_utils.cT)(activityEvent)&&"$pageview"===activityEvent.event;return(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[isOnlyPageview&&(0,jsx_runtime.jsxs)(src.Vp,{type:"warning",children:["You are currently using the pageview event to define user activity. Consider using a more specific event or action to track activity accurately.",(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center gap-4 mt-2 max-w-160",children:(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>toggleModalOpen(),children:"Configure activity event"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 ml-1",children:[(0,jsx_runtime.jsx)("h2",{className:"m-0",children:"Active Users"}),!isOnlyPageview&&(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),size:"small",noPadding:!0,onClick:()=>toggleModalOpen(),tooltip:"Configure dashboard"})]}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-[3fr_1fr] gap-2",children:activeUsersInsights.map((insight,index)=>(0,jsx_runtime.jsx)(CustomerAnalyticsQueryCard,{insight:insight,tabId:tabId},index))}),(0,jsx_runtime.jsx)(PowerUsersTable,{})]})}function PowerUsersTable(){let{dauSeries,tabId}=(0,index_esm.useValues)(customerAnalyticsSceneLogic),query={kind:schema_general.OH.DataTableNode,hiddenColumns:["id","person.$delete","event_distinct_ids"],showSourceQueryOptions:!1,source:{kind:schema_general.OH.ActorsQuery,select:["person","event_count"],source:{kind:schema_general.OH.InsightActorsQuery,source:{kind:schema_general.OH.TrendsQuery,series:[dauSeries],dateRange:{date_from:"-30d"},interval:"day",trendsFilter:{display:src_types.Qb.ActionsTable}},series:0},orderBy:["event_count DESC"],limit:10}};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 -mb-2",children:[(0,jsx_runtime.jsx)("h2",{className:"mb-0 ml-1",children:"Power Users"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",noPadding:!0,targetBlank:!0,to:urls.j.persons(),tooltip:"Open people list"})]}),(0,jsx_runtime.jsx)(Query.A,{uniqueKey:`power-users-${tabId}`,attachTo:customerAnalyticsSceneLogic,query:{...query,showTimings:!1,showOpenEditorButton:!1},context:{columns:{event_count:{title:"Event count"}}}})]})}function SignupInsights(){let{signupInsights,tabId}=(0,index_esm.useValues)(customerAnalyticsSceneLogic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-2",children:(0,jsx_runtime.jsx)("h2",{className:"mb-0 ml-1",children:"Signup insights"})}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-[1fr_1fr_2fr] gap-2",children:signupInsights.slice(0,3).map((insight,index)=>(0,jsx_runtime.jsx)(CustomerAnalyticsQueryCard,{insight:insight,tabId:tabId},index))}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-3 gap-2",children:signupInsights.slice(3,6).map((insight,index)=>(0,jsx_runtime.jsx)(CustomerAnalyticsQueryCard,{insight:insight,tabId:tabId},index))}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-2 gap-2",children:signupInsights.slice(6).map((insight,index)=>(0,jsx_runtime.jsx)(CustomerAnalyticsQueryCard,{insight:insight,tabId:tabId},index))})]})}let scene={component:CustomerAnalyticsScene,logic:customerAnalyticsSceneLogic};function CustomerAnalyticsScene(_ref){let{tabId}=_ref;if(!tabId)throw Error("CustomerAnalyticsScene was rendered with no tabId");return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:scenes.lc[sceneTypes.x.CustomerAnalytics].name,description:scenes.lc[sceneTypes.x.CustomerAnalytics].description,resourceType:{type:scenes.lc[sceneTypes.x.CustomerAnalytics].iconType||"default_icon_type"}}),(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)(ActiveUsersInsights,{}),(0,jsx_runtime.jsx)(SignupInsights,{}),(0,jsx_runtime.jsx)(SessionInsights,{}),(0,jsx_runtime.jsx)(EventConfigModal,{})]})]})}}}]);