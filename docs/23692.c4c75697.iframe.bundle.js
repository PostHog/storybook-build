(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[23692],{"../../products/messaging/frontend/Campaigns/campaignLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{y:()=>campaignLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_api__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_components_CyclotronJob_CyclotronJobInputsValidation__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/components/CyclotronJob/CyclotronJobInputsValidation.ts"),lib_lemon_ui_LemonToast__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_campaignSceneLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../products/messaging/frontend/Campaigns/campaignSceneLogic.ts"),_hogflows_steps_types__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../products/messaging/frontend/Campaigns/hogflows/steps/types.ts");let NEW_CAMPAIGN={id:"new",name:"",actions:[{id:"trigger_node",type:"trigger",name:"Trigger",description:"User performs an action to start the campaign",created_at:0,updated_at:0,config:{type:"event",filters:{}}},{id:"exit_node",type:"exit",name:"Exit",description:"User moved through the campaign without errors",config:{reason:"Default exit"},created_at:0,updated_at:0}],edges:[{from:"trigger_node",to:"exit_node",type:"continue"}],trigger:{type:"event",filters:{events:[],actions:[]}},trigger_masking:{ttl:0,hash:"",threshold:0},conversion:{window_minutes:0,filters:[]},exit_condition:"exit_only_at_end",version:1,status:"draft",team_id:-1,created_at:"",updated_at:""},campaignLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","messaging","frontend","Campaigns","campaignLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({id:"new"}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.id||"new"),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setCampaignActionConfig:(actionId,config)=>({actionId,config}),setCampaignAction:(actionId,action)=>({actionId,action}),setCampaignActionEdges:(actionId,edges)=>({actionId,edges}),setCampaignInfo:campaign=>({campaign}),discardChanges:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_2__.loaders)(_ref=>{let{props}=_ref;return{originalCampaign:[null,{loadCampaign:async()=>props.id&&"new"!==props.id?lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.hogFlows.getHogFlow(props.id):{...NEW_CAMPAIGN},saveCampaign:async updates=>props.id&&"new"!==props.id?lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.hogFlows.updateHogFlow(props.id,updates):lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.hogFlows.createHogFlow(updates)}]}}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_2__.lazyLoaders)(()=>({hogFunctionTemplatesById:[{},{loadHogFunctionTemplatesById:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.hogFunctions.listTemplates({types:["destination"]})).results.reduce((acc,template)=>(acc[template.id]=template,acc),{})}]})),(0,kea_forms__WEBPACK_IMPORTED_MODULE_1__.forms)(_ref2=>{let{actions,values}=_ref2;return{campaign:{defaults:NEW_CAMPAIGN,errors:_ref3=>{let{name,trigger,actions}=_ref3;return{name:name?void 0:"Name is required",trigger:{type:"event"===trigger.type?void 0:"Invalid trigger type",filters:0===trigger.filters.events.length&&0===trigger.filters.actions.length?"At least one event or action is required":void 0},actions:actions.some(action=>{var _values$actionValidat;return!(null===(_values$actionValidat=values.actionValidationErrorsById[action.id]?.valid)||void 0===_values$actionValidat||_values$actionValidat)})?"Some fields need work":void 0}},submit:async values=>{values&&actions.saveCampaign(values)}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({logicProps:[()=>[(_,props)=>props],props=>props],campaignLoading:[s=>[s.originalCampaignLoading],originalCampaignLoading=>originalCampaignLoading],edgesByActionId:[s=>[s.campaign],campaign=>campaign.edges.reduce((acc,edge)=>(acc[edge.from]||(acc[edge.from]=[]),acc[edge.from].push(edge),acc[edge.to]||(acc[edge.to]=[]),acc[edge.to].push(edge),acc),{})],actionValidationErrorsById:[s=>[s.campaign,s.hogFunctionTemplatesById],(campaign,hogFunctionTemplatesById)=>campaign.actions.reduce((acc,action)=>{let result={valid:!0,schema:null,errors:{}},schemaValidation=_hogflows_steps_types__WEBPACK_IMPORTED_MODULE_10__.HZ.safeParse(action);if(schemaValidation.success){if((0,_hogflows_steps_types__WEBPACK_IMPORTED_MODULE_10__.Mc)(action)){let template=hogFunctionTemplatesById[action.config.template_id];if(template){var _template$inputs_sche;let configValidation=lib_components_CyclotronJob_CyclotronJobInputsValidation__WEBPACK_IMPORTED_MODULE_6__.H.validate(action.config.inputs,null!==(_template$inputs_sche=template.inputs_schema)&&void 0!==_template$inputs_sche?_template$inputs_sche:[]);result.valid=configValidation.valid,result.errors=configValidation.errors}else result.valid=!1,result.errors={_template_id:"Template not found"}}}else result.valid=!1,result.schema=schemaValidation.error;return acc[action.id]=result,acc},{})]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions,values}=_ref4;return{loadCampaignSuccess:async _ref5=>{let{originalCampaign}=_ref5;actions.resetCampaign(originalCampaign)},saveCampaignSuccess:async _ref6=>{let{originalCampaign}=_ref6;lib_lemon_ui_LemonToast__WEBPACK_IMPORTED_MODULE_7__.U.success("Campaign saved"),originalCampaign.id&&kea_router__WEBPACK_IMPORTED_MODULE_3__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.messagingCampaign(originalCampaign.id,_campaignSceneLogic__WEBPACK_IMPORTED_MODULE_9__.c.findMounted()?.values.currentTab)),actions.resetCampaign(originalCampaign)},discardChanges:()=>{values.originalCampaign&&_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.dn.open({title:"Discard changes",description:"Are you sure?",primaryButton:{children:"Discard",onClick:()=>{var _values$originalCampa;return actions.resetCampaign(null!==(_values$originalCampa=values.originalCampaign)&&void 0!==_values$originalCampa?_values$originalCampa:NEW_CAMPAIGN)}},secondaryButton:{children:"Cancel"}})},setCampaignInfo:async _ref7=>{let{campaign}=_ref7;actions.setCampaignValues(campaign)},setCampaignActionConfig:async _ref8=>{let{actionId,config}=_ref8,action=values.campaign.actions.find(action=>action.id===actionId);action&&(action.config={...action.config,...config},actions.setCampaignValues({actions:[...values.campaign.actions]}))},setCampaignAction:async _ref9=>{let{actionId,action}=_ref9,newActions=values.campaign.actions.map(a=>a.id===actionId?action:a);actions.setCampaignValues({actions:newActions})},setCampaignActionEdges:async _ref10=>{var _values$edgesByAction;let{actionId,edges}=_ref10,actionEdges=null!==(_values$edgesByAction=values.edgesByActionId[actionId])&&void 0!==_values$edgesByAction?_values$edgesByAction:[],newEdges=values.campaign.edges.filter(e=>!actionEdges.includes(e));actions.setCampaignValues({edges:[...newEdges,...edges]})}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref11=>{let{actions}=_ref11;actions.loadCampaign()})])},"../../products/messaging/frontend/Campaigns/campaignSceneLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{c:()=>campaignSceneLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/urls.ts");let campaignSceneLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","messaging","frontend","campaignSceneLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({id:"new"}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setCurrentTab:tab=>({tab})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({currentTab:["overview",{setCurrentTab:(_,_ref)=>{let{tab}=_ref;return tab}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[(_,props)=>props.id],id=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_2__.x.Messaging,name:"Messaging",path:scenes_urls__WEBPACK_IMPORTED_MODULE_3__.j.messaging("campaigns")},{key:[scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_2__.x.Messaging,"campaigns"],name:"Campaigns",path:scenes_urls__WEBPACK_IMPORTED_MODULE_3__.j.messaging("campaigns")},{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_2__.x.MessagingCampaign,name:"new"==id?"New campaign":"Manage campaign"}]]}),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.actionToUrl)(_ref2=>{let{props,values}=_ref2;return{setCurrentTab:()=>[scenes_urls__WEBPACK_IMPORTED_MODULE_3__.j.messagingCampaign(props.id||"new",values.currentTab),kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.searchParams,kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.hashParams]}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.urlToAction)(_ref3=>{let{actions,values}=_ref3;return{"/messaging/campaigns/:id/:tab":_ref4=>{let{tab}=_ref4;tab!==values.currentTab&&actions.setCurrentTab(tab)}}})])},"../../products/messaging/frontend/Campaigns/hogflows/constants.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$f:()=>BOTTOM_HANDLE_POSITION,M8:()=>NODE_HEIGHT,S2:()=>NODE_GAP,Wh:()=>NODE_EDGE_GAP,Z8:()=>TOP_HANDLE_POSITION,l1:()=>MINIMUM_EDGE_SPACING,mn:()=>NODE_LAYER_GAP,nK:()=>NODE_WIDTH});let NODE_WIDTH=110,NODE_HEIGHT=34,NODE_GAP=50,MINIMUM_EDGE_SPACING=160,NODE_EDGE_GAP=159,NODE_LAYER_GAP=75,TOP_HANDLE_POSITION={x:55,y:0},BOTTOM_HANDLE_POSITION={x:55,y:34}},"../../products/messaging/frontend/Campaigns/hogflows/filters/HogFlowFilters.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{K:()=>HogFlowFilters});var lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),scenes_insights_filters_ActionFilter_ActionFilter__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),scenes_insights_filters_ActionFilter_ActionFilterRow_ActionFilterRow__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function HogFlowFilters(_ref){let{filters,setFilters,typeKey,buttonCopy}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(scenes_insights_filters_ActionFilter_ActionFilter__WEBPACK_IMPORTED_MODULE_1__.T,{filters:null!=filters?filters:{},setFilters:setFilters,typeKey:null!=typeKey?typeKey:"hogflow-filters",mathAvailability:scenes_insights_filters_ActionFilter_ActionFilterRow_ActionFilterRow__WEBPACK_IMPORTED_MODULE_2__.Qq.None,hideRename:!0,hideDuplicate:!0,showNestedArrow:!1,actionsTaxonomicGroupTypes:[lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_0__.t.Events,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_0__.t.Actions],propertiesTaxonomicGroupTypes:[lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_0__.t.EventProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_0__.t.EventFeatureFlags,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_0__.t.Elements,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_0__.t.PersonProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_0__.t.HogQLExpression],propertyFiltersPopover:!0,addFilterDefaultOptions:{id:"$pageview",name:"$pageview",type:"events"},buttonProps:{type:"secondary"},buttonCopy:null!=buttonCopy?buttonCopy:"Add filter"})}},"../../products/messaging/frontend/Campaigns/hogflows/hogFlowEditorLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{O:()=>HOG_FLOW_EDITOR_MODES,s:()=>hogFlowEditorLogic});var esm=__webpack_require__("../../node_modules/.pnpm/@xyflow+system@0.0.57/node_modules/@xyflow/system/dist/esm/index.js"),dist_esm=__webpack_require__("../../node_modules/.pnpm/@xyflow+react@12.6.0_@types+react@17.0.52_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@xyflow/react/dist/esm/index.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),kea_subscriptions_lib=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.7_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),appMetricsLogic=__webpack_require__("../../frontend/src/lib/components/AppMetrics/appMetricsLogic.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),optOutCategoriesLogic=__webpack_require__("../../products/messaging/frontend/OptOuts/optOutCategoriesLogic.ts"),campaignLogic=__webpack_require__("../../products/messaging/frontend/Campaigns/campaignLogic.ts"),elk_bundled=__webpack_require__("../../node_modules/.pnpm/elkjs@0.10.0/node_modules/elkjs/lib/elk.bundled.js"),elk_bundled_default=__webpack_require__.n(elk_bundled),constants=__webpack_require__("../../products/messaging/frontend/Campaigns/hogflows/constants.ts");let getElkPortSide=position=>{switch(position){case esm.Ly.Top:return"NORTH";case esm.Ly.Bottom:return"SOUTH";case esm.Ly.Left:return"WEST";case esm.Ly.Right:return"EAST"}},elk=new(elk_bundled_default()),getFormattedNodes=async(nodes,edges)=>{let graph={id:"root",layoutOptions:{"elk.algorithm":"layered","elk.layered.spacing.nodeNodeBetweenLayers":`${constants.mn}`,"elk.spacing.nodeNode":`${constants.S2}`,"elk.spacing.edgeEdge":`${constants.Wh}`,"elk.spacing.edgeNode":`${constants.Wh}`,"elk.direction":"DOWN","elk.layered.nodePlacement.strategy":"SIMPLE","elk.alignment":"CENTER","elk.layered.nodePlacement.bk.fixedAlignment":"BALANCED","elk.padding":"[left=0, top=0, right=0, bottom=0]"},children:nodes.map(node=>{let handles=node.handles?.sort((a,b)=>(a.id||"").localeCompare(b.id||"")).map(h=>({id:h.id||`${node.id}_${h.type}`,properties:{side:getElkPortSide(h.position)}}))||[];return{...node,width:constants.nK,height:constants.M8,targetPosition:"top",sourcePosition:"bottom",properties:{"org.eclipse.elk.portConstraints":"FIXED_ORDER"},ports:[...handles]}}),edges:edges.map(edge=>({...edge,id:edge.id,sources:[edge.sourceHandle||edge.source],targets:[edge.targetHandle||edge.target]}))},layoutedGraph=await elk.layout(graph),triggerNode=layoutedGraph.children?.find(node=>"trigger_node"===node.id),offsetX=triggerNode?.x||0,offsetY=triggerNode?.y||0;return layoutedGraph.children?.forEach(node=>{node.x=(node.x||0)-offsetX,node.y=(node.y||0)-offsetY}),layoutedGraph.children?.map(node=>({...node,position:{x:node.x,y:node.y}}))};var HogFlowSteps=__webpack_require__("../../products/messaging/frontend/Campaigns/hogflows/steps/HogFlowSteps.tsx"),SmartEdge=__webpack_require__("../../products/messaging/frontend/Campaigns/hogflows/steps/SmartEdge.tsx");let getEdgeId=edge=>{var _edge$index;return`${edge.from}->${edge.to} ${null!==(_edge$index=edge.index)&&void 0!==_edge$index?_edge$index:""}`.trim()},HOG_FLOW_EDITOR_MODES=["build","test","metrics","logs"],hogFlowEditorLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.path)(key=>["scenes","hogflows","hogFlowEditorLogic",key]),(0,index_esm.key)(props=>`${props.id}`),(0,index_esm.connect)(props=>({values:[(0,campaignLogic.y)(props),["campaign","edgesByActionId","hogFunctionTemplatesById"],(0,optOutCategoriesLogic.O)(),["categories","categoriesLoading"]],actions:[(0,campaignLogic.y)(props),["setCampaignInfo","setCampaignActionConfig","setCampaignAction","setCampaignActionEdges"],(0,optOutCategoriesLogic.O)(),["loadCategories"]]})),(0,index_esm.actions)({onEdgesChange:edges=>({edges}),onNodesChange:nodes=>({nodes}),onNodesDelete:deleted=>({deleted}),setNodes:nodes=>({nodes}),setDropzoneNodes:dropzoneNodes=>({dropzoneNodes}),setNodesRaw:nodes=>({nodes}),setEdges:edges=>({edges}),setSelectedNodeId:selectedNodeId=>({selectedNodeId}),resetFlowFromHogFlow:hogFlow=>({hogFlow}),setReactFlowInstance:reactFlowInstance=>({reactFlowInstance}),onDragStart:!0,onDragOver:event=>({event}),onDrop:event=>({event}),setNewDraggingNode:newDraggingNode=>({newDraggingNode}),setHighlightedDropzoneNodeId:highlightedDropzoneNodeId=>({highlightedDropzoneNodeId}),setMode:mode=>({mode}),loadActionMetricsById:(params,timezone)=>({params,timezone})}),(0,index_esm.reducers)(()=>({mode:["build",{setMode:(_,_ref)=>{let{mode}=_ref;return mode}}],nodes:[[],{setNodesRaw:(_,_ref2)=>{let{nodes}=_ref2;return nodes}}],dropzoneNodes:[[],{setDropzoneNodes:(_,_ref3)=>{let{dropzoneNodes}=_ref3;return dropzoneNodes}}],highlightedDropzoneNodeId:[null,{setHighlightedDropzoneNodeId:(_,_ref4)=>{let{highlightedDropzoneNodeId}=_ref4;return highlightedDropzoneNodeId}}],edges:[[],{setEdges:(_,_ref5)=>{let{edges}=_ref5;return edges}}],selectedNodeId:[null,{setSelectedNodeId:(_,_ref6)=>{let{selectedNodeId}=_ref6;return selectedNodeId}}],newDraggingNode:[null,{setNewDraggingNode:(_,_ref7)=>{let{newDraggingNode}=_ref7;return newDraggingNode}}],reactFlowInstance:[null,{setReactFlowInstance:(_,_ref8)=>{let{reactFlowInstance}=_ref8;return reactFlowInstance}}]})),(0,index_esm.selectors)({nodesById:[s=>[s.nodes],nodes=>nodes.reduce((acc,node)=>(acc[node.id]=node,acc),{})],selectedNode:[s=>[s.nodes,s.selectedNodeId],(nodes,selectedNodeId)=>{var _nodes$find;return null!==(_nodes$find=nodes.find(node=>node.id===selectedNodeId))&&void 0!==_nodes$find?_nodes$find:null}],selectedNodeCanBeDeleted:[s=>[s.selectedNode,s.nodes,s.edges],(selectedNode,nodes,edges)=>{if(!selectedNode)return!1;let outgoingNodes=(0,esm.xA)(selectedNode,nodes,edges);return 1===outgoingNodes.length||1===new Set(outgoingNodes.map(node=>node.id)).size}]}),(0,lib.lazyLoaders)(()=>({actionMetricsById:[null,{loadActionMetricsById:async(_ref9,breakpoint)=>{let{params,timezone}=_ref9;await breakpoint(10);let response=await (0,appMetricsLogic.p)(params,timezone);await breakpoint(10);let res={};return Object.values(response).forEach(value=>{let[instanceId,metricName]=value.breakdowns;instanceId&&metricName&&(res[instanceId]=res[instanceId]||{actionId:instanceId,succeeded:0,failed:0,filtered:0},metricName in res[instanceId]&&(res[instanceId][metricName]=value.total))}),res}}]})),(0,index_esm.listeners)(_ref10=>{let{values,actions}=_ref10;return{onEdgesChange:_ref11=>{let{edges}=_ref11;actions.setEdges((0,dist_esm.yn)(edges,values.edges))},onNodesChange:_ref12=>{let{nodes}=_ref12;actions.setNodes((0,dist_esm.Fb)(nodes,values.nodes))},resetFlowFromHogFlow:_ref13=>{let{hogFlow}=_ref13;try{let edges=hogFlow.edges.map(edge=>{let isOnlyEdgeForNode=1===hogFlow.edges.filter(e=>e.from===edge.from).length;return{source:edge.from,target:edge.to,id:getEdgeId(edge),type:"smart",deletable:!1,reconnectable:!1,selectable:!1,focusable:!1,markerEnd:{type:esm.QZ.ArrowClosed},data:{edge,label:isOnlyEdgeForNode?void 0:"continue"===edge.type?"No match":`If condition #${(edge.index||0)+1} matches`},labelShowBg:!1,targetHandle:`target_${edge.to}`,sourceHandle:"continue"===edge.type?`continue_${edge.from}`:`branch_${edge.from}_${edge.index}`}}),handlesByIdByNodeId={};edges.forEach(edge=>{var _edge$sourceHandle,_edge$targetHandle;handlesByIdByNodeId[edge.source]||(handlesByIdByNodeId[edge.source]={}),handlesByIdByNodeId[edge.target]||(handlesByIdByNodeId[edge.target]={}),handlesByIdByNodeId[edge.source][null!==(_edge$sourceHandle=edge.sourceHandle)&&void 0!==_edge$sourceHandle?_edge$sourceHandle:""]={id:edge.sourceHandle,type:"source",position:esm.Ly.Bottom,...constants.$f},handlesByIdByNodeId[edge.target][null!==(_edge$targetHandle=edge.targetHandle)&&void 0!==_edge$targetHandle?_edge$targetHandle:""]={id:edge.targetHandle,type:"target",position:esm.Ly.Top,...constants.Z8}});let nodes=hogFlow.actions.map(action=>{var _handlesByIdByNodeId$;return!(0,HogFlowSteps.d)(action,values.hogFunctionTemplatesById)&&action.type.startsWith("function_")&&(action.type="function"),{id:action.id,type:"action",data:action,position:{x:0,y:0},handles:Object.values(null!==(_handlesByIdByNodeId$=handlesByIdByNodeId[action.id])&&void 0!==_handlesByIdByNodeId$?_handlesByIdByNodeId$:{}),deletable:!["trigger","exit"].includes(action.type),selectable:!["exit"].includes(action.type),draggable:!1,connectable:!1}});actions.setEdges(edges),actions.setNodes(nodes)}catch(error){console.error("Error resetting flow from hog flow",error),src.UJ.error("Error updating workflow")}},setNodes:async _ref14=>{let{nodes}=_ref14,formattedNodes=await getFormattedNodes(nodes,values.edges);actions.setNodesRaw(formattedNodes)},onNodesDelete:_ref15=>{let{deleted}=_ref15;deleted.some(node=>node.id===values.selectedNodeId)&&actions.setSelectedNodeId(null);let deletedNodeIds=deleted.map(node=>node.id),updatedEdges=values.campaign.edges.map(hogFlowEdge=>{if(deletedNodeIds.includes(hogFlowEdge.to)){let deletedNode=deleted.find(node=>node.id===hogFlowEdge.to);if(deletedNode){let outgoers=(0,esm.xA)(deletedNode,values.nodes,values.edges);if(outgoers.length>0)return{...hogFlowEdge,to:outgoers[0].id}}}return hogFlowEdge}).filter(hogFlowEdge=>!deletedNodeIds.includes(hogFlowEdge.from)&&!deletedNodeIds.includes(hogFlowEdge.to)),updatedActions=values.campaign.actions.filter(action=>!deletedNodeIds.includes(action.id));actions.setCampaignInfo({actions:updatedActions,edges:updatedEdges})},onDragStart:()=>{let{nodes,edges}=values,dropzoneNodes=[];edges.forEach(edge=>{let sourceNode=nodes.find(n=>n.id===edge.source),targetNode=nodes.find(n=>n.id===edge.target);if(sourceNode&&targetNode){let sourceHandle=sourceNode.handles?.find(h=>h.id===edge.sourceHandle),targetHandle=targetNode.handles?.find(h=>h.id===edge.targetHandle),[,labelX,labelY]=(0,SmartEdge.$q)({sourceX:sourceNode.position.x+(sourceHandle?.x||0),sourceY:sourceNode.position.y+(sourceHandle?.y||0),targetX:targetNode.position.x+(targetHandle?.x||0),targetY:targetNode.position.y+(targetHandle?.y||0),edges,currentEdgeId:edge.id});dropzoneNodes.push({id:`dropzone_edge_${edge.id}`,type:"dropzone",position:{x:labelX-constants.nK/2,y:labelY-constants.M8/2},data:{edge},draggable:!1,selectable:!1})}}),actions.setDropzoneNodes(dropzoneNodes)},onDragOver:_ref16=>{let{event}=_ref16;event.preventDefault(),event.dataTransfer.dropEffect="move"},onDrop:_ref17=>{let{event}=_ref17;event.preventDefault();let dropzoneNode=values.dropzoneNodes.find(x=>x.id===values.highlightedDropzoneNodeId);if(values.newDraggingNode&&dropzoneNode){var _partialNewAction$bra;let edgeToInsertNodeInto=dropzoneNode?.data.edge,partialNewAction=values.newDraggingNode,newAction={id:`action_${partialNewAction.type}_${(0,utils.Vj)()}`,type:partialNewAction.type,name:partialNewAction.name,description:partialNewAction.description,config:partialNewAction.config,created_at:Date.now(),updated_at:Date.now()},step=(0,HogFlowSteps.d)(newAction,values.hogFunctionTemplatesById),branchEdges=null!==(_partialNewAction$bra=partialNewAction.branchEdges)&&void 0!==_partialNewAction$bra?_partialNewAction$bra:0;if(!step)throw Error(`Step not found for action type: ${newAction}`);let edgeToBeReplacedIndex=values.campaign.edges.findIndex(edge=>getEdgeId(edge)===edgeToInsertNodeInto.id);if(-1===edgeToBeReplacedIndex)throw Error("Edge to be replaced not found");let newEdges=[...values.campaign.edges],edgeToBeReplaced=values.campaign.edges[edgeToBeReplacedIndex];newEdges.splice(edgeToBeReplacedIndex,1),newEdges.push({...edgeToBeReplaced,to:newAction.id});for(let i=0;i<branchEdges;i++)newEdges.push({...edgeToBeReplaced,index:i,type:"branch",from:newAction.id});newEdges.push({...edgeToBeReplaced,from:newAction.id});let oldActions=values.campaign.actions,newActions=[...oldActions.slice(0,-1),newAction,oldActions[oldActions.length-1]];actions.setCampaignInfo({actions:newActions,edges:newEdges}),actions.setNewDraggingNode(null),actions.setSelectedNodeId(newAction.id)}actions.setDropzoneNodes([])}}}),(0,kea_subscriptions_lib.Vt)(_ref18=>{let{actions}=_ref18;return{campaign:hogFlow=>{hogFlow&&actions.resetFlowFromHogFlow(hogFlow)}}}),(0,kea_router_lib.actionToUrl)(_ref19=>{let{values}=_ref19,syncProperty=(key,value)=>[kea_router_lib.router.values.location.pathname,{...kea_router_lib.router.values.searchParams,[key]:value},kea_router_lib.router.values.hashParams];return{setSelectedNodeId:()=>{var _values$selectedNodeI;return syncProperty("node",null!==(_values$selectedNodeI=values.selectedNodeId)&&void 0!==_values$selectedNodeI?_values$selectedNodeI:null)},setMode:()=>syncProperty("mode",values.mode)}}),(0,kea_router_lib.urlToAction)(_ref20=>{let{actions}=_ref20;return{[urls.j.messagingCampaign(":id",":tab")]:(_,search)=>{let{node,mode}=search;actions.setSelectedNodeId(null!=node?node:null),mode&&HOG_FLOW_EDITOR_MODES.includes(mode)&&actions.setMode(mode)}}})])},"../../products/messaging/frontend/Campaigns/hogflows/steps/HogFlowSteps.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{d:()=>getHogFlowStep,i:()=>useHogFlowStep});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.28.1_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),themeLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),campaignLogic=__webpack_require__("../../products/messaging/frontend/Campaigns/campaignLogic.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonLabel=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/index.ts"),HogFlowFilters=__webpack_require__("../../products/messaging/frontend/Campaigns/hogflows/filters/HogFlowFilters.tsx"),hogFlowEditorLogic=__webpack_require__("../../products/messaging/frontend/Campaigns/hogflows/hogFlowEditorLogic.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function StepConditionalBranchConfiguration(_ref){let{node}=_ref,action=node.data,{conditions}=action.config,{edgesByActionId}=(0,index_esm.useValues)(hogFlowEditorLogic.s),{setCampaignAction,setCampaignActionEdges}=(0,index_esm.useActions)(hogFlowEditorLogic.s),nodeEdges=edgesByActionId[action.id],[branchEdges,nonBranchEdges]=(0,react.useMemo)(()=>{let branchEdges=[],nonBranchEdges=[];return nodeEdges.forEach(edge=>{"branch"===edge.type&&edge.from===action.id?branchEdges.push(edge):nonBranchEdges.push(edge)}),[branchEdges.sort((a,b)=>{var _a$index,_b$index;return(null!==(_a$index=a.index)&&void 0!==_a$index?_a$index:0)-(null!==(_b$index=b.index)&&void 0!==_b$index?_b$index:0)}),nonBranchEdges]},[nodeEdges,action.id]),setConditions=conditions=>{setCampaignAction(action.id,{...action,config:{...action.config,conditions}})},addCondition=()=>{let continueEdge=nodeEdges.find(edge=>"continue"===edge.type&&edge.from===action.id);if(!continueEdge)throw Error("Continue edge not found");setConditions([...conditions,{filters:{events:[{id:"$pageview",name:"$pageview",type:"events"}]}}]),setCampaignActionEdges(action.id,[...branchEdges,{from:action.id,to:continueEdge.to,type:"branch",index:conditions.length},...nonBranchEdges])},removeCondition=index=>{let newBranchEdges=branchEdges.filter((_,i)=>i!==index).map((edge,i)=>({...edge,index:i}));setConditions(conditions.filter((_,i)=>i!==index)),setCampaignActionEdges(action.id,[...newBranchEdges,...nonBranchEdges])};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[conditions.map((condition,index)=>{var _condition$filters;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 p-2 rounded border",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsxs)(LemonLabel.H,{children:["Condition ",index+1]}),(0,jsx_runtime.jsx)(LemonButton.J,{size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:()=>removeCondition(index)})]}),(0,jsx_runtime.jsx)(HogFlowFilters.K,{filters:null!==(_condition$filters=condition.filters)&&void 0!==_condition$filters?_condition$filters:{},setFilters:filters=>setConditions(conditions.map((condition,i)=>i===index?{filters}:condition)),typeKey:`campaign-trigger-${index}`})]},index)}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>addCondition(),children:"Add condition"})]})}var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts");let DURATION_REGEX=/^(\d*\.?\d+)([dhm])$/;function HogFlowDuration(_ref){var _value$match;let{value,onChange}=_ref,[,numberValueString,unit]=null!==(_value$match=value.match(DURATION_REGEX))&&void 0!==_value$match?_value$match:["","10","m"],numberValue=parseFloat(numberValueString);return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.DF,{type:"number",value:numberValue,onChange:v=>onChange(`${v}${unit}`)}),(0,jsx_runtime.jsx)(src.Yv,{options:[{label:"Minute(s)",value:"m"},{label:"Hour(s)",value:"h"},{label:"Day(s)",value:"d"}],value:unit,onChange:v=>onChange(`${numberValue}${v}`)})]})}function StepDelayConfiguration(_ref){let{node}=_ref,action=node.data,{delay_duration}=action.config,{setCampaignActionConfig}=(0,index_esm.useActions)(hogFlowEditorLogic.s);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("p",{className:"mb-0",children:"Wait for a specified duration."}),(0,jsx_runtime.jsx)(HogFlowDuration,{value:delay_duration,onChange:value=>setCampaignActionConfig(action.id,{delay_duration:value})})]})}function StepExitConfiguration(_){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col",children:(0,jsx_runtime.jsx)("p",{className:"mb-1 text-lg font-semibold",children:"Exit"})})})}var lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),CyclotronJobInputs=__webpack_require__("../../frontend/src/lib/components/CyclotronJob/CyclotronJobInputs.tsx"),hogFunctionConfigurationLogic=__webpack_require__("../../frontend/src/scenes/hog-functions/configuration/hogFunctionConfigurationLogic.tsx");let hogFunctionStepLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","Campaigns","hogflows","steps"]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{node}=_ref;return`${node?.id}_${node?.data.config.template_id}`}),(0,lib.forms)(_ref2=>{let{props}=_ref2;return{configuration:{defaults:{inputs:props.node?.data?.config?.inputs||{}}}}}),(0,index_esm.propsChanged)(_ref3=>{var _values$configuration,_templateToConfigurat;let{actions,props,values}=_ref3,{template}=props;template&&0===Object.keys(null!==(_values$configuration=values.configuration.inputs)&&void 0!==_values$configuration?_values$configuration:{}).length&&actions.setConfigurationValues({inputs:null!==(_templateToConfigurat=(0,hogFunctionConfigurationLogic.oT)(template).inputs)&&void 0!==_templateToConfigurat?_templateToConfigurat:{}})})]);function StepFunctionConfiguration(_ref){var _template$inputs_sche;let{node}=_ref,{hogFunctionTemplatesById,hogFunctionTemplatesByIdLoading,actionValidationErrorsById}=(0,index_esm.useValues)(campaignLogic.y),{setCampaignActionConfig}=(0,index_esm.useActions)(hogFlowEditorLogic.s),template=hogFunctionTemplatesById[node.data.config.template_id],stepLogic=hogFunctionStepLogic({node,template}),{configuration,configurationValidationErrors}=(0,index_esm.useValues)(stepLogic),validationResult=actionValidationErrorsById[node.id];return((0,react.useEffect)(()=>{setCampaignActionConfig(node.id,{inputs:configuration.inputs})},[configuration.inputs,template,setCampaignActionConfig,node.id]),hogFunctionTemplatesByIdLoading)?(0,jsx_runtime.jsx)("div",{className:"flex justify-center items-center",children:(0,jsx_runtime.jsx)(src.$j,{})}):template?(0,jsx_runtime.jsxs)(lib.Form,{logic:hogFunctionStepLogic,props:{node},formKey:"configuration",className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(CyclotronJobInputs.c,{errors:validationResult?.errors,configuration:{inputs:node.data.config.inputs,inputs_schema:null!==(_template$inputs_sche=template?.inputs_schema)&&void 0!==_template$inputs_sche?_template$inputs_sche:[]},showSource:!1,sampleGlobalsWithInputs:null,onInputChange:(key,value)=>{setCampaignActionConfig(node.id,{inputs:{...node.data.config.inputs,[key]:value}})}}),(0,jsx_runtime.jsx)("div",{className:"text-danger flex items-center gap-1 text-sm",children:configurationValidationErrors?.inputs&&(0,jsx_runtime.jsx)("div",{children:Object.entries(configurationValidationErrors.inputs).map(_ref2=>{let[key,value]=_ref2;return(0,jsx_runtime.jsx)("div",{children:value},key)})})})]}):(0,jsx_runtime.jsx)("div",{children:"Template not found!"})}function StepRandomCohortBranchConfiguration(_ref){let{node}=_ref,action=node.data,{cohorts}=action.config,{edgesByActionId}=(0,index_esm.useValues)(hogFlowEditorLogic.s),{setCampaignAction,setCampaignActionEdges}=(0,index_esm.useActions)(hogFlowEditorLogic.s),nodeEdges=edgesByActionId[action.id],[branchEdges,nonBranchEdges]=(0,react.useMemo)(()=>{let branchEdges=[],nonBranchEdges=[];return nodeEdges.forEach(edge=>{"branch"===edge.type&&edge.from===action.id?branchEdges.push(edge):nonBranchEdges.push(edge)}),[branchEdges.sort((a,b)=>{var _a$index,_b$index;return(null!==(_a$index=a.index)&&void 0!==_a$index?_a$index:0)-(null!==(_b$index=b.index)&&void 0!==_b$index?_b$index:0)}),nonBranchEdges]},[nodeEdges,action.id]),setCohorts=cohorts=>{setCampaignAction(action.id,{...action,config:{...action.config,cohorts}})},addCohort=()=>{let continueEdge=nodeEdges.find(edge=>"continue"===edge.type&&edge.from===action.id);if(!continueEdge)throw Error("Continue edge not found");setCohorts([...cohorts,{percentage:25}]),setCampaignActionEdges(action.id,[...branchEdges,{from:action.id,to:continueEdge.to,type:"branch",index:cohorts.length},...nonBranchEdges])},removeCohort=index=>{let newBranchEdges=branchEdges.filter((_,i)=>i!==index).map((edge,i)=>({...edge,index:i}));setCohorts(cohorts.filter((_,i)=>i!==index)),setCampaignActionEdges(action.id,[...newBranchEdges,...nonBranchEdges])},updateCohortPercentage=(index,percentage)=>{setCohorts(cohorts.map((cohort,i)=>i===index?{percentage}:cohort))},totalPercentage=cohorts.reduce((sum,cohort)=>sum+cohort.percentage,0);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[cohorts.map((cohort,index)=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 p-2 rounded border",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsxs)(LemonLabel.H,{children:["Cohort ",index+1]}),(0,jsx_runtime.jsx)(LemonButton.J,{size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:()=>removeCohort(index)})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("input",{type:"number",min:"0",max:"100",value:cohort.percentage,onChange:e=>updateCohortPercentage(index,parseInt(e.target.value)||0),className:"w-20 px-2 py-1 border rounded"}),(0,jsx_runtime.jsx)("span",{children:"%"})]})]},index)),100!==totalPercentage&&(0,jsx_runtime.jsxs)("div",{className:"text-sm text-orange-600",children:["Total percentage: ",totalPercentage,"% (should equal 100%)"]}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>addCohort(),children:"Add cohort"})]})}function StepTriggerConfiguration(_ref){let{node}=_ref,action=node.data,{filters}=action.config,{setCampaignActionConfig}=(0,index_esm.useActions)(hogFlowEditorLogic.s);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-col",children:(0,jsx_runtime.jsx)("p",{className:"mb-0",children:"Choose which events or actions will enter a user into the campaign."})}),(0,jsx_runtime.jsx)(HogFlowFilters.K,{filters:null!=filters?filters:{},setFilters:filters=>setCampaignActionConfig(action.id,{filters}),typeKey:"campaign-trigger",buttonCopy:"Add trigger event"})]})}function StepWaitUntilConditionConfiguration(_ref){var _condition$filters;let{node}=_ref,action=node.data,{condition,max_wait_duration}=action.config,{setCampaignActionConfig}=(0,index_esm.useActions)(hogFlowEditorLogic.s);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Wait time"}),(0,jsx_runtime.jsx)(HogFlowDuration,{value:max_wait_duration,onChange:value=>{setCampaignActionConfig(action.id,{max_wait_duration:value})}})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Conditions to wait for"}),(0,jsx_runtime.jsx)(HogFlowFilters.K,{filters:null!==(_condition$filters=condition.filters)&&void 0!==_condition$filters?_condition$filters:{},setFilters:filters=>setCampaignActionConfig(action.id,{condition:{filters}}),typeKey:"campaign-wait-until-condition"})]})]})}var utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx");let DEFAULT_TIME_RANGE=["09:00","17:00"],DEFAULT_WEEKDAYS=["monday","tuesday","wednesday","thursday","friday"],DATE_OPTIONS=[{value:"any",label:"Any day"},{value:"weekday",label:"Weekdays"},{value:"weekend",label:"Weekends"},{value:"custom",label:"Specific days"}],TIME_OPTIONS=[{value:"any",label:"Any time"},{value:"custom",label:"Specific time range"}],WEEKDAY_OPTIONS=[{key:"monday",label:"Monday"},{key:"tuesday",label:"Tuesday"},{key:"wednesday",label:"Wednesday"},{key:"thursday",label:"Thursday"},{key:"friday",label:"Friday"},{key:"saturday",label:"Saturday"},{key:"sunday",label:"Sunday"}],TIME_RANGE_OPTIONS=Array.from({length:24},(_,i)=>({value:`${i.toString().padStart(2,"0")}:00`,label:`${i.toString().padStart(2,"0")}:00`})),isCustomDay=day=>Array.isArray(day),isCustomTime=time=>Array.isArray(time),getDaySelectValue=day=>"any"===day||"weekday"===day||"weekend"===day?day:"custom",convertStringToDayConfig=value=>{switch(value){case"any":case"weekday":case"weekend":return value;case"custom":return DEFAULT_WEEKDAYS;default:return"any"}},getUpdatedDayConfig=value=>({day:convertStringToDayConfig(value)}),getUpdatedTimeConfig=value=>"custom"===value?{time:DEFAULT_TIME_RANGE}:{time:value},getUpdatedTimeRangeConfig=(newTime,index,currentTime)=>{let updatedTime=[...currentTime];return updatedTime[index]=newTime,{time:updatedTime}};function StepWaitUntilTimeWindowConfiguration(_ref){let{node}=_ref,action=node.data,{timezone,day,time}=action.config,{setCampaignActionConfig}=(0,index_esm.useActions)(hogFlowEditorLogic.s),{preflight}=(0,index_esm.useValues)(preflightLogic.preflightLogic),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),timezoneOptions=Object.entries(preflight?.available_timezones||{}).map(_ref2=>{let[tz,offset]=_ref2;return{key:tz,label:(0,utils.wF)(tz,offset)}}),isCustomDate=isCustomDay(day),isCustomTimeRange=isCustomTime(time);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap",children:[(0,jsx_runtime.jsx)(DayConfiguration,{day:day,isCustomDate:isCustomDate,onDayChange:value=>{let config=getUpdatedDayConfig(value);setCampaignActionConfig(action.id,config)},onCustomDaysChange:newDays=>setCampaignActionConfig(action.id,{day:[...newDays]})}),(0,jsx_runtime.jsx)(src.p2,{vertical:!0}),(0,jsx_runtime.jsx)(TimeConfiguration,{time:time,isCustomTime:isCustomTimeRange,onTimeChange:value=>{let config=getUpdatedTimeConfig(value);setCampaignActionConfig(action.id,config)},onTimeRangeChange:(newTime,index)=>{if(isCustomTimeRange){let config=getUpdatedTimeRangeConfig(newTime,index,time);setCampaignActionConfig(action.id,config)}}})]}),(0,jsx_runtime.jsx)(TimezoneConfiguration,{timezone:timezone,currentTeamTimezone:currentTeam?.timezone,timezoneOptions:timezoneOptions,onTimezoneChange:newTimezone=>{if(!preflight?.available_timezones)throw Error("No timezones are available");setCampaignActionConfig(action.id,{timezone:newTimezone[0]})}})]})}function DayConfiguration(_ref3){let{day,isCustomDate,onDayChange,onCustomDaysChange}=_ref3;return(0,jsx_runtime.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Days of week"}),(0,jsx_runtime.jsx)(src.Yv,{value:getDaySelectValue(day),onChange:onDayChange,options:DATE_OPTIONS,"data-attr":"date-select"}),isCustomDate&&Array.isArray(day)&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Custom days"}),(0,jsx_runtime.jsx)(src.nt,{value:day,onChange:newDays=>onCustomDaysChange(newDays),options:WEEKDAY_OPTIONS,mode:"multiple","data-attr":"custom-days-select"})]})]})}function TimeConfiguration(_ref4){let{time,isCustomTime,onTimeChange,onTimeRangeChange}=_ref4;return(0,jsx_runtime.jsxs)("div",{className:"flex-1 flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Time of day"}),(0,jsx_runtime.jsx)(src.Yv,{value:isCustomTime?"custom":time,onChange:onTimeChange,options:TIME_OPTIONS,"data-attr":"time-select"}),isCustomTime&&Array.isArray(time)&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Start time"}),(0,jsx_runtime.jsx)(src.Yv,{value:time[0],onChange:value=>onTimeRangeChange(value,0),options:TIME_RANGE_OPTIONS,"data-attr":"start-time-select"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"End time"}),(0,jsx_runtime.jsx)(src.Yv,{value:time[1],onChange:value=>onTimeRangeChange(value,1),options:TIME_RANGE_OPTIONS,"data-attr":"end-time-select"})]})]})]})}function TimezoneConfiguration(_ref5){let{timezone,currentTeamTimezone,timezoneOptions,onTimezoneChange}=_ref5;return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Timezone"}),(0,jsx_runtime.jsx)(src.nt,{mode:"single",placeholder:"Select a time zone",value:[timezone||currentTeamTimezone||"UTC"],popoverClassName:"z-[1000]",onChange:onTimezoneChange,options:timezoneOptions,"data-attr":"timezone-select"})]})}let HogFlowStepConfigs={conditional_branch:{type:"conditional_branch",icon:()=>(0,jsx_runtime.jsx)(posthog_icons_es.IconDecisionTree,{}),color:(_,isDarkModeOn)=>isDarkModeOn?"#35C46F":"#005841",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepConditionalBranchConfiguration,{node:node})},delay:{type:"delay",icon:()=>(0,jsx_runtime.jsx)(posthog_icons_es.IconClock,{}),color:()=>"#a20031",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepDelayConfiguration,{node:node})},exit:{type:"exit",icon:()=>(0,jsx_runtime.jsx)(posthog_icons_es.IconLeave,{}),color:()=>"#4b4b4b",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepExitConfiguration,{node:node})},random_cohort_branch:{type:"random_cohort_branch",icon:()=>(0,jsx_runtime.jsx)(posthog_icons_es.IconPercentage,{}),color:(_,isDarkModeOn)=>isDarkModeOn?"#D6247B":"#9a004d",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepRandomCohortBranchConfiguration,{node:node})},trigger:{type:"trigger",icon:()=>(0,jsx_runtime.jsx)(posthog_icons_es.IconBolt,{}),color:(_,isDarkModeOn)=>isDarkModeOn?"#35C46F":"#005841",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepTriggerConfiguration,{node:node})},wait_until_condition:{type:"wait_until_condition",icon:()=>(0,jsx_runtime.jsx)(posthog_icons_es.IconHourglass,{}),color:()=>"#ffaa00",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepWaitUntilConditionConfiguration,{node:node})},wait_until_time_window:{type:"wait_until_time_window",icon:()=>(0,jsx_runtime.jsx)(posthog_icons_es.IconDay,{}),color:()=>"#FF653F",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepWaitUntilTimeWindowConfiguration,{node:node})},function_email:{type:"function_email",icon:()=>(0,jsx_runtime.jsx)(posthog_icons_es.IconLetter,{}),color:(_,isDarkModeOn)=>"#2F80FA",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepFunctionConfiguration,{node:node})},function_sms:{type:"function_sms",icon:()=>(0,jsx_runtime.jsx)(icons.i5,{}),color:()=>"#f22f46",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepFunctionConfiguration,{node:node})},function:{type:"function",icon:(action,hogFunctionTemplatesById)=>{if("template-email"===action.config.template_id)return(0,jsx_runtime.jsx)(posthog_icons_es.IconLetter,{});if("template-webhook"===action.config.template_id)return(0,jsx_runtime.jsx)(posthog_icons_es.IconWebhooks,{});let template=hogFunctionTemplatesById[action.config.template_id];return template?.icon_url?(0,jsx_runtime.jsx)("img",{className:"LemonIcon rounded",src:template.icon_url,alt:template.name}):(0,jsx_runtime.jsx)(posthog_icons_es.IconBolt,{})},color:(action,isDarkModeOn)=>"template-email"===action.config.template_id?"#2F80FA":"template-webhook"===action.config.template_id?isDarkModeOn?"#B52AD9":"#6500ae":isDarkModeOn?"#F8BE2A":"#F44D01",renderConfiguration:node=>(0,jsx_runtime.jsx)(StepFunctionConfiguration,{node:node})}};function getHogFlowStep(action,hogFunctionTemplatesById){let isDarkModeOn=arguments.length>2&&void 0!==arguments[2]&&arguments[2],type=action.type,builder=HogFlowStepConfigs[type];if(builder)return{type,icon:builder.icon(action,hogFunctionTemplatesById),color:builder.color(action,isDarkModeOn),renderConfiguration:builder.renderConfiguration}}function useHogFlowStep(action){let{hogFunctionTemplatesById}=(0,index_esm.useValues)(campaignLogic.y),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b);return(0,react.useMemo)(()=>{if(action)return getHogFlowStep(action,hogFunctionTemplatesById,isDarkModeOn)},[action,hogFunctionTemplatesById,isDarkModeOn])}},"../../products/messaging/frontend/Campaigns/hogflows/steps/SmartEdge.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$q:()=>getSmartStepPath,No:()=>REACT_FLOW_EDGE_TYPES});var _xyflow_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/@xyflow+react@12.6.0_@types+react@17.0.52_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@xyflow/react/dist/esm/index.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),_constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../products/messaging/frontend/Campaigns/hogflows/constants.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function getSmartStepPath(_ref){let segment1EndY,segment3EndY,pathCommands,{sourceX,sourceY,targetX,targetY,edges,currentEdgeId,borderRadius=5}=_ref,horizontalOffset=(()=>{if(!currentEdgeId||0===edges.length)return 0;let currentEdge=edges.find(edge=>edge.id===currentEdgeId);if(!currentEdge)return 0;let conflictingEdges=edges.filter(edge=>edge.source===currentEdge.source),horizontalOffset=0;if(conflictingEdges.length>0){let sortedEdges=conflictingEdges.sort((a,b)=>{let aEdgeData=a.data.edge,bEdgeData=b.data.edge;return"branch"===aEdgeData.type&&"branch"===bEdgeData.type?(aEdgeData.index||0)-(bEdgeData.index||0):"continue"===aEdgeData.type?1:-1}),edgeIndex=sortedEdges.findIndex(edge=>edge.id===currentEdgeId);horizontalOffset=(edgeIndex-(sortedEdges.length-1)/2)*_constants__WEBPACK_IMPORTED_MODULE_1__.l1}return horizontalOffset})();targetY-sourceY>=0?(segment1EndY=sourceY+10,segment3EndY=targetY-10):(segment1EndY=sourceY-10,segment3EndY=targetY+10);let branchX=sourceX+horizontalOffset,svgPath=(10>Math.abs(sourceX-targetX)&&0===horizontalOffset?[`M ${sourceX} ${sourceY}`,`L ${targetX} ${targetY}`]:10>Math.abs(targetX-branchX)?[`M ${sourceX} ${sourceY}`,`L ${sourceX} ${segment1EndY-borderRadius}`,`Q ${sourceX} ${segment1EndY} ${sourceX+(branchX>sourceX?borderRadius:-borderRadius)} ${segment1EndY}`,`L ${branchX-(branchX>sourceX?borderRadius:-borderRadius)} ${segment1EndY}`,`Q ${branchX} ${segment1EndY} ${branchX} ${segment1EndY+borderRadius}`,`L ${targetX} ${targetY}`]:Math.abs(targetX-sourceX)>10&&0===horizontalOffset?[`M ${sourceX} ${sourceY}`,`L ${sourceX} ${segment3EndY-borderRadius}`,`Q ${sourceX} ${segment3EndY} ${sourceX+(targetX>sourceX?borderRadius:-borderRadius)} ${segment3EndY}`,`L ${targetX-(targetX>sourceX?borderRadius:-borderRadius)} ${segment3EndY}`,`Q ${targetX} ${segment3EndY} ${targetX} ${segment3EndY+borderRadius}`,`L ${targetX} ${targetY}`]:[`M ${sourceX} ${sourceY}`,`L ${sourceX} ${segment1EndY-borderRadius}`,`Q ${sourceX} ${segment1EndY} ${sourceX+(branchX>sourceX?borderRadius:-borderRadius)} ${segment1EndY}`,`L ${branchX-(branchX>sourceX?borderRadius:-borderRadius)} ${segment1EndY}`,`Q ${branchX} ${segment1EndY} ${branchX} ${segment1EndY+borderRadius}`,`L ${branchX} ${segment3EndY-borderRadius}`,`Q ${branchX} ${segment3EndY} ${branchX-(branchX>targetX?borderRadius:-borderRadius)} ${segment3EndY}`,`L ${targetX+(branchX>targetX?borderRadius:-borderRadius)} ${segment3EndY}`,`Q ${targetX} ${segment3EndY} ${targetX} ${segment3EndY+borderRadius}`,`L ${targetX} ${targetY}`]).join(" "),labelY=segment1EndY+(segment3EndY-segment1EndY)/2,offsetX=Math.abs(branchX-sourceX),offsetY=Math.abs(labelY-sourceY);return[svgPath,branchX,labelY,offsetX,offsetY]}function EdgeLabel(_ref2){let{transform,label}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{style:{transform},size:"small",className:"nodrag nopan absolute text-[0.45rem] font-sans font-medium",type:"muted",children:label})}function findXAtY(path,targetY,totalLength){let step=totalLength/1e3;for(let distance=0;distance<=totalLength;distance+=step){let point=path.getPointAtLength(distance);if(1>=Math.abs(point.y-targetY))return point.x}return null}function getPointAtYValue(pathString,distance,targetY){let svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),path=document.createElementNS("http://www.w3.org/2000/svg","path");path.setAttribute("d",pathString),svg.appendChild(path),document.body.appendChild(svg);try{let yValue;let totalLength=path.getTotalLength();if(void 0!==targetY)yValue=targetY;else{let percentageDistance=.25*totalLength,effectiveDistance=Math.max(distance,percentageDistance),clampedDistance=Math.min(effectiveDistance,totalLength);yValue=path.getPointAtLength(clampedDistance).y}let xAtY=findXAtY(path,yValue,totalLength);return{x:null!==xAtY?xAtY:0,y:yValue}}finally{document.body.removeChild(svg)}}let REACT_FLOW_EDGE_TYPES={smart:function SmartEdge(_ref3){let{id,sourceX,sourceY,targetX,targetY,sourcePosition,targetPosition,markerEnd,markerStart,data,...props}=_ref3,[edgePath]=getSmartStepPath({sourceX,sourceY,targetX,targetY,edges:(0,_xyflow_react__WEBPACK_IMPORTED_MODULE_3__.Mi)(),currentEdgeId:id}),labelPoint=getPointAtYValue(edgePath,20,sourceY+20);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_xyflow_react__WEBPACK_IMPORTED_MODULE_3__.u5,{...props,path:edgePath,markerEnd:markerEnd,markerStart:markerStart}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_xyflow_react__WEBPACK_IMPORTED_MODULE_3__.XQ,{children:data?.label&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(EdgeLabel,{transform:`translate(-50%, -50%) translate(${labelPoint.x}px,${labelPoint.y}px)`,label:data?.label||""})})]})}}},"../../products/messaging/frontend/Campaigns/hogflows/steps/types.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{HZ:()=>HogFlowActionSchema,Mc:()=>isFunctionAction,Os:()=>isOptOutEligibleAction});var zod__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/zod@3.24.1/node_modules/zod/lib/index.mjs");let _commonActionFields={id:zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),name:zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),description:zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),on_error:zod__WEBPACK_IMPORTED_MODULE_0__.z.enum(["continue","abort","complete","branch"]).optional().nullable(),created_at:zod__WEBPACK_IMPORTED_MODULE_0__.z.number(),updated_at:zod__WEBPACK_IMPORTED_MODULE_0__.z.number(),filters:zod__WEBPACK_IMPORTED_MODULE_0__.z.any()},CyclotronInputSchema=zod__WEBPACK_IMPORTED_MODULE_0__.z.object({value:zod__WEBPACK_IMPORTED_MODULE_0__.z.any(),templating:zod__WEBPACK_IMPORTED_MODULE_0__.z.enum(["hog","liquid"]).optional(),secret:zod__WEBPACK_IMPORTED_MODULE_0__.z.boolean().optional(),bytecode:zod__WEBPACK_IMPORTED_MODULE_0__.z.any().optional(),order:zod__WEBPACK_IMPORTED_MODULE_0__.z.number().optional()}),HogFlowActionSchema=zod__WEBPACK_IMPORTED_MODULE_0__.z.discriminatedUnion("type",[zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("trigger"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("event"),filters:zod__WEBPACK_IMPORTED_MODULE_0__.z.any()})}),zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("conditional_branch"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({conditions:zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.object({filters:zod__WEBPACK_IMPORTED_MODULE_0__.z.any()})),delay_duration:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional()})}),zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("random_cohort_branch"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({cohorts:zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.object({percentage:zod__WEBPACK_IMPORTED_MODULE_0__.z.number()}))})}),zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("delay"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({delay_duration:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(2)})}),zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("wait_until_condition"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({condition:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({filters:zod__WEBPACK_IMPORTED_MODULE_0__.z.any()}),max_wait_duration:zod__WEBPACK_IMPORTED_MODULE_0__.z.string()})}),zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("wait_until_time_window"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({timezone:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().nullable(),day:zod__WEBPACK_IMPORTED_MODULE_0__.z.union([zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("any"),zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("weekday"),zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("weekend"),zod__WEBPACK_IMPORTED_MODULE_0__.z.array(zod__WEBPACK_IMPORTED_MODULE_0__.z.enum(["monday","tuesday","wednesday","thursday","friday","saturday","sunday"]))]),time:zod__WEBPACK_IMPORTED_MODULE_0__.z.union([zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("any"),zod__WEBPACK_IMPORTED_MODULE_0__.z.tuple([zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),zod__WEBPACK_IMPORTED_MODULE_0__.z.string()])])})}),zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("function"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({template_uuid:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().uuid().optional(),template_id:zod__WEBPACK_IMPORTED_MODULE_0__.z.string(),inputs:zod__WEBPACK_IMPORTED_MODULE_0__.z.record(CyclotronInputSchema)})}),zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("function_email"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({message_category_id:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().uuid().optional(),template_uuid:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),template_id:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("template-email"),inputs:zod__WEBPACK_IMPORTED_MODULE_0__.z.record(CyclotronInputSchema)})}),zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("function_sms"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({message_category_id:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().uuid().optional(),template_uuid:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().uuid().optional(),template_id:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("template-twilio"),inputs:zod__WEBPACK_IMPORTED_MODULE_0__.z.record(CyclotronInputSchema)})}),zod__WEBPACK_IMPORTED_MODULE_0__.z.object({..._commonActionFields,type:zod__WEBPACK_IMPORTED_MODULE_0__.z.literal("exit"),config:zod__WEBPACK_IMPORTED_MODULE_0__.z.object({reason:zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional()})})]),isOptOutEligibleAction=action=>["function_email","function_sms"].includes(action.type),isFunctionAction=action=>["function","function_sms","function_email"].includes(action.type)},"../../products/messaging/frontend/OptOuts/optOutCategoriesLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{O:()=>optOutCategoriesLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts");let optOutCategoriesLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","messaging","frontend","OptOuts","optOutCategoriesLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadCategories:!0,deleteCategory:id=>({id}),openNewCategoryModal:!0,closeNewCategoryModal:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({categories:{__default:[],loadCategories:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.messaging.getCategories({category_type:"marketing"})).results||[]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({categories:[[],{loadCategoriesSuccess:(_,_ref)=>{let{categories}=_ref;return categories}}],isNewCategoryModalOpen:[!1,{openNewCategoryModal:()=>!0,closeNewCategoryModal:()=>!1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref2=>{let{actions}=_ref2;return{deleteCategory:async _ref3=>{let{id}=_ref3;try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.messaging.updateCategory(id,{deleted:!0}),actions.loadCategories()}catch(error){console.error("Failed to delete category:",error)}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadCategories()})])},"../../node_modules/.pnpm/elkjs@0.10.0/node_modules/elkjs/lib sync recursive":module=>{function webpackEmptyContext(req){var e=Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id="../../node_modules/.pnpm/elkjs@0.10.0/node_modules/elkjs/lib sync recursive",module.exports=webpackEmptyContext}}]);