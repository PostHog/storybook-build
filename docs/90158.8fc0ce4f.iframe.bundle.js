"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[90158,26023],{"../../frontend/src/scenes/experiments/Experiments.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EXPERIMENTS_PRODUCT_DESCRIPTION:()=>EXPERIMENTS_PRODUCT_DESCRIPTION,Experiments:()=>Experiments,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),dist=__webpack_require__("../../node_modules/.pnpm/ts-pattern@4.3.0/node_modules/ts-pattern/dist/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),AccessControlAction=__webpack_require__("../../frontend/src/lib/components/AccessControlAction.tsx"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),MemberSelect=__webpack_require__("../../frontend/src/lib/components/MemberSelect.tsx"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),hedgehogs=__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonDivider=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonDivider/index.ts"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),columnUtils=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),deleteWithUndo=__webpack_require__("../../frontend/src/lib/utils/deleteWithUndo.tsx"),stringWithWBR=__webpack_require__("../../frontend/src/lib/utils/stringWithWBR.tsx"),MaxTool=__webpack_require__("../../frontend/src/scenes/max/MaxTool.tsx"),useMaxTool=__webpack_require__("../../frontend/src/scenes/max/useMaxTool.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),types=__webpack_require__("../../frontend/src/types.ts"),DuplicateExperimentModal=__webpack_require__("../../frontend/src/scenes/experiments/DuplicateExperimentModal.tsx"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),experimentsLogic=__webpack_require__("../../frontend/src/scenes/experiments/experimentsLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function ExperimentVelocityStats(){let{experimentsStats,experimentsStatsLoading}=(0,index_esm.useValues)(experimentsLogic.OK);if(experimentsStatsLoading)return(0,jsx_runtime.jsx)("div",{className:"p-4 border rounded bg-bg-light flex items-center justify-center",style:{minHeight:100},children:(0,jsx_runtime.jsx)(src.$j,{})});let{launched_last_30d,percent_change,active_experiments,completed_last_30d}=experimentsStats;if(launched_last_30d<=3)return null;let isPositive=percent_change>0,isNegative=percent_change<0,arrow=isPositive?(0,jsx_runtime.jsx)(posthog_icons_es.IconTrending,{fontSize:"16"}):isNegative?(0,jsx_runtime.jsx)(icons.j4,{fontSize:"16"}):"";return(0,jsx_runtime.jsxs)("div",{className:"px-3 py-2 border rounded bg-bg-light flex items-center gap-3",children:[(0,jsx_runtime.jsxs)("div",{className:"metric-cell-header font-semibold flex items-center gap-1",children:["Velocity (last 30d)",(0,jsx_runtime.jsx)(src.u,{title:"Shows your team's experimentation velocity: how many experiments you're launching, running, and completing. Launched count is compared to the previous 30 days to track growth.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt",fontSize:"16"})})]}),(0,jsx_runtime.jsx)("div",{className:"h-4 w-px bg-border"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,jsx_runtime.jsx)("span",{className:"text-base font-semibold ",children:launched_last_30d}),(0,jsx_runtime.jsx)("span",{children:"launched"}),0!==percent_change&&(0,jsx_runtime.jsxs)("span",{className:`metric-cell font-bold ${isPositive?"text-success":isNegative?"text-danger":"text-text-secondary"}`,children:[arrow," ",Math.abs(percent_change),"%"]})]}),(0,jsx_runtime.jsx)("div",{children:"•"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,jsx_runtime.jsx)("span",{className:"text-base font-semibold",children:active_experiments}),(0,jsx_runtime.jsx)("span",{className:"",children:"active"})]}),(0,jsx_runtime.jsx)("div",{children:"•"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,jsx_runtime.jsx)("span",{className:"text-base font-bold",children:completed_last_30d}),(0,jsx_runtime.jsx)("span",{children:"completed"})]})]})}var components=__webpack_require__("../../frontend/src/scenes/experiments/ExperimentView/components.tsx"),LemonLabel=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/index.ts"),RestrictedArea=__webpack_require__("../../frontend/src/lib/components/RestrictedArea.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSelect/index.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx");let formatHourString=hour=>(0,dayjs.Bv)().hour(hour).format("HH:00"),hourOptions=Array.from({length:24},(_,hour)=>({value:hour.toString(),label:formatHourString(hour)})),utcToLocalHour=(utcTimeString,projectTimezone)=>{if(!utcTimeString)return dayjs.Bv.utc().hour(2).tz(projectTimezone).hour();let[hour]=utcTimeString.split(":").map(Number);return dayjs.Bv.utc().hour(hour).tz(projectTimezone).hour()},localHourToUtcString=(localHour,projectTimezone)=>(0,dayjs.Bv)().tz(projectTimezone).hour(localHour).minute(0).second(0).millisecond(0).utc().format("HH:mm:ss");function ExperimentRecalculationTime(){let{currentTeam,currentTeamLoading,timezone:projectTimezone}=(0,index_esm.useValues)(teamLogic.teamLogic),{updateCurrentTeam}=(0,index_esm.useActions)(teamLogic.teamLogic),restrictionReason=(0,RestrictedArea.U)({minimumAccessLevel:constants.Dk.Admin}),currentLocalHour=utcToLocalHour(currentTeam?.experiment_recalculation_time,projectTimezone);return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,jsx_runtime.jsx)(src.HQ,{className:"text-base",children:"Daily recalculation time"}),(0,jsx_runtime.jsxs)("p",{className:"text-secondary",children:["Select the time of day when experiment metrics should be recalculated. This time is in your project's timezone (",projectTimezone,")."]}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:(0,jsx_runtime.jsx)(LemonSelect.Yv,{value:currentLocalHour.toString(),onChange:value=>{updateCurrentTeam({experiment_recalculation_time:localHourToUtcString(parseInt(value,10),projectTimezone)})},options:hourOptions,disabledReason:restrictionReason||(currentTeamLoading?"Loading...":void 0),"data-attr":"team-experiment-recalculation-time",placeholder:"Select recalculation time"})})]})})}var OrgExperimentStatsMethod=__webpack_require__("../../frontend/src/scenes/settings/organization/OrgExperimentStatsMethod.tsx");function ExperimentsSettings(){return(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{className:"text-base",children:"Default statistical method"}),(0,jsx_runtime.jsx)("p",{className:"text-secondary mt-2",children:"Choose the default statistical method for experiment analysis. This setting applies to all new experiments in your organization and can be overridden per experiment."}),(0,jsx_runtime.jsx)(OrgExperimentStatsMethod.y,{})]}),(0,jsx_runtime.jsx)(ExperimentRecalculationTime,{})]})}var LemonSlider=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSlider/index.ts"),holdoutsLogic=__webpack_require__("../../frontend/src/scenes/experiments/holdoutsLogic.tsx");function Holdouts(){let{holdouts,holdoutsLoading,holdout}=(0,index_esm.useValues)(holdoutsLogic.o),{createHoldout,deleteHoldout,setHoldout,updateHoldout}=(0,index_esm.useActions)(holdoutsLogic.o),[isHoldoutModalOpen,setIsHoldoutModalOpen]=(0,react.useState)(!1),[editingHoldout,setEditingHoldout]=(0,react.useState)(null),openEditModal=holdout=>{setEditingHoldout(holdout),setHoldout(holdout),setIsHoldoutModalOpen(!0)},closeModal=()=>{setIsHoldoutModalOpen(!1),setEditingHoldout(null)},columns=[{title:"Name",dataIndex:"name",key:"name",render:name=>(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:name})},{title:"Description",dataIndex:"description",key:"description"},{title:"Rollout Percentage",dataIndex:"filters",key:"rollout",render:filters=>{let percentage=filters?.[0]?.rollout_percentage||0;return(0,jsx_runtime.jsxs)("div",{children:[percentage," %"]})}},{title:"Actions",key:"actions",render:(_,record)=>(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{}),onClick:()=>openEditModal(record)}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),size:"xsmall",status:"danger",onClick:()=>{src.dn.open({title:"Delete this holdout?",content:(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Are you sure you want to delete the holdout ",(0,jsx_runtime.jsxs)("b",{children:['"',record.name,'"']}),"? This action cannot be undone."]}),primaryButton:{children:"Delete",type:"primary",status:"danger",onClick:()=>deleteHoldout(record.id),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})}})]})}];return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsx)(src.fQ,{isOpen:isHoldoutModalOpen,onClose:closeModal,title:editingHoldout?"Edit holdout":"Add holdout",footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:closeModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{editingHoldout?updateHoldout(editingHoldout.id,holdout):createHoldout(),closeModal()},disabledReason:holdout.name?holdout.filters?.[0]?.rollout_percentage===void 0||holdout.filters?.[0]?.rollout_percentage===null?"Rollout percentage is required":holdout.filters[0].rollout_percentage<0||holdout.filters[0].rollout_percentage>100?"Rollout percentage should be between 0 and 100":void 0:"Name is required",children:editingHoldout?"Update":"Save"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Name"}),(0,jsx_runtime.jsx)(src.DF,{value:holdout.name,onChange:name=>setHoldout({name}),placeholder:"e.g. 'Frontend holdout group 1'"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Description"}),(0,jsx_runtime.jsx)(src.DF,{value:holdout.description||"",onChange:description=>setHoldout({description})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:(0,jsx_runtime.jsx)("div",{children:"Specify the percentage population that should be included in this holdout group. This is stable across experiments."})})}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-1",children:["Roll out to"," ",(0,jsx_runtime.jsx)(LemonSlider.j,{value:holdout.filters?.[0]?.rollout_percentage||100,onChange:rollout_percentage=>setHoldout({filters:[{properties:[],rollout_percentage}]}),min:0,max:100,step:1,className:"ml-1.5 w-20"}),(0,jsx_runtime.jsx)(src.DF,{"data-attr":"rollout-percentage",type:"number",className:"ml-2 mr-1.5 max-w-30",value:holdout.filters?.[0]?.rollout_percentage||100,onChange:rollout_percentage=>setHoldout({filters:[{properties:[],rollout_percentage}]}),min:0,max:100,step:"any",suffix:(0,jsx_runtime.jsx)("span",{children:"%"})}),"of ",(0,jsx_runtime.jsx)("b",{children:"total users."})]})]})]})}),(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:(0,jsx_runtime.jsx)("div",{children:"Holdouts are stable groups of users excluded from experiment variations.They act as a baseline, helping you see how users behave without any changes applied. This lets you directly compare their behavior to those exposed to the experiment variations. Once a holdout is configured, you can apply it to an experiment during creation."})})}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{setEditingHoldout(null),setHoldout({...holdoutsLogic.x}),setIsHoldoutModalOpen(!0)},"data-attr":"add-holdout",children:"New holdout"})}),(0,jsx_runtime.jsx)(src.g3,{emptyState:(0,jsx_runtime.jsx)("div",{className:"py-4 text-secondary text-sm text-center",children:"You have not created any holdouts yet."}),loading:holdoutsLoading,dataSource:holdouts,columns:columns})]})}var SharedMetrics=__webpack_require__("../../frontend/src/scenes/experiments/SharedMetrics/SharedMetrics.tsx"),utils=__webpack_require__("../../frontend/src/scenes/experiments/utils.ts");let scene={component:Experiments,logic:experimentsLogic.OK},EXPERIMENTS_PRODUCT_DESCRIPTION="Experiments help you test changes to your product to see which changes will lead to optimal results. Automatic statistical calculations let you see if the results are valid or if they are likely just a chance occurrence.",ExperimentSurveyButton=_ref=>{let{experiment}=_ref,{user}=(0,index_esm.useValues)(userLogic.userLogic),{openMax}=(0,useMaxTool.$)((0,components.b)(experiment,user));return experiment.feature_flag?(0,jsx_runtime.jsx)(LemonButton.J,{onClick:openMax||void 0,size:"small",fullWidth:!0,"data-attr":"create-survey",disabled:!openMax,children:"Create survey"}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},getExperimentDuration=experiment=>experiment.end_date?(0,dayjs.Bv)(experiment.end_date).diff((0,dayjs.Bv)(experiment.start_date),"day"):experiment.start_date?(0,dayjs.Bv)().diff((0,dayjs.Bv)(experiment.start_date),"day"):void 0,ExperimentsTableFilters=_ref2=>{var _filters$status,_filters$created_by_i;let{tab,filters,onFiltersChange}=_ref2;return(0,jsx_runtime.jsxs)("div",{className:"flex justify-between gap-2 flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-6",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search experiments",onChange:search=>onFiltersChange({search,page:1}),value:filters.search||""}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[types.F7.Archived!==tab&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)("b",{children:"Status"})}),(0,jsx_runtime.jsx)(src.Yv,{size:"small",onChange:status=>{if("all"===status){let{status:_,...restFilters}=filters;onFiltersChange({...restFilters,page:1},!0)}else onFiltersChange({status:status,page:1})},options:[{label:"All",value:"all"},{label:"Draft",value:types.mN.Draft},{label:"Running",value:types.mN.Running},{label:"Complete",value:types.mN.Complete}],value:null!==(_filters$status=filters.status)&&void 0!==_filters$status?_filters$status:"all",dropdownMatchSelectWidth:!1,dropdownMaxContentWidth:!0})]}),(0,jsx_runtime.jsx)("span",{className:"ml-1",children:(0,jsx_runtime.jsx)("b",{children:"Created by"})}),(0,jsx_runtime.jsx)(MemberSelect.a,{defaultLabel:"Any user",value:null!==(_filters$created_by_i=filters.created_by_id)&&void 0!==_filters$created_by_i?_filters$created_by_i:null,onChange:user=>{if(user)onFiltersChange({created_by_id:user.id,page:1});else{let{created_by_id,...restFilters}=filters;onFiltersChange({...restFilters,page:1},!0)}}})]})]}),(0,jsx_runtime.jsx)(ExperimentVelocityStats,{})]})},ExperimentsTable=_ref3=>{let{openDuplicateModal}=_ref3,{currentProjectId,experiments,experimentsLoading,tab,shouldShowEmptyState,filters,count,pagination}=(0,index_esm.useValues)(experimentsLogic.OK),{loadExperiments,archiveExperiment,setExperimentsFilters}=(0,index_esm.useActions)(experimentsLogic.OK),page=filters.page||1,startCount=0===count?0:(page-1)*experimentsLogic.ew+1,endCount=page*experimentsLogic.ew<count?page*experimentsLogic.ew:count,columns=[{title:"Name",dataIndex:"name",className:"ph-no-capture",sticky:!0,width:"40%",render:function Render(_,experiment){return(0,jsx_runtime.jsx)(LemonTableLink.i,{to:experiment.id?urls.j.experiment(experiment.id):void 0,title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,stringWithWBR.Z)(experiment.name,17),"web"===experiment.type&&(0,jsx_runtime.jsx)(src.oe,{type:"default",className:"ml-1",children:"No-code"}),(0,utils.cH)(experiment)&&(0,jsx_runtime.jsx)(src.u,{title:"This experiment uses the legacy engine, so some features and improvements may be missing.",docLink:"https://posthog.com/docs/experiments/new-experimentation-engine",children:(0,jsx_runtime.jsx)(src.oe,{type:"warning",className:"ml-1",children:"Legacy"})})]}),description:experiment.description})}},(0,columnUtils.JB)(),(0,columnUtils.rw)(),(0,columnUtils.pD)("start_date","Started"),{title:"Duration",key:"duration",render:function Render(_,experiment){let duration=getExperimentDuration(experiment);return(0,jsx_runtime.jsx)("div",{children:void 0!==duration?`${duration} day${1!==duration?"s":""}`:"—"})},sorter:(a,b)=>{var _getExperimentDuratio,_getExperimentDuratio2;return(null!==(_getExperimentDuratio=getExperimentDuration(a))&&void 0!==_getExperimentDuratio?_getExperimentDuratio:-1)>(null!==(_getExperimentDuratio2=getExperimentDuration(b))&&void 0!==_getExperimentDuratio2?_getExperimentDuratio2:-1)?1:-1},align:"right"},{title:"Status",key:"status",render:function Render(_,experiment){return(0,jsx_runtime.jsx)(components.Nj,{status:(0,experimentsLogic.Ot)(experiment)})},align:"center",sorter:(a,b)=>{let statusA=(0,experimentsLogic.Ot)(a),statusB=(0,experimentsLogic.Ot)(b),score={draft:1,running:2,complete:3};return score[statusA]>score[statusB]?1:-1}},{width:0,render:function Render(_,experiment){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{to:urls.j.experiment(`${experiment.id}`),size:"small",fullWidth:!0,children:"View"}),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>openDuplicateModal(experiment),size:"small",fullWidth:!0,children:"Duplicate"}),(0,jsx_runtime.jsx)(ExperimentSurveyButton,{experiment:experiment}),!experiment.archived&&experiment?.end_date&&(0,dayjs.Bv)().isSameOrAfter((0,dayjs.Bv)(experiment.end_date),"day")&&(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Experiment,minAccessLevel:types.W$.Editor,userAccessLevel:experiment.user_access_level,children:(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>{src.dn.open({title:"Archive this experiment?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"This action will move the experiment to the archived tab. It can be restored at any time."}),primaryButton:{children:"Archive",type:"primary",onClick:()=>archiveExperiment(experiment.id),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},"data-attr":`experiment-${experiment.id}-dropdown-archive`,fullWidth:!0,children:"Archive experiment"})}),(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Experiment,minAccessLevel:types.W$.Editor,userAccessLevel:experiment.user_access_level,children:(0,jsx_runtime.jsx)(LemonButton.J,{status:"danger",onClick:()=>{src.dn.open({title:"Delete this experiment?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"Experiment with its settings will be deleted, but event data will be preserved."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>{(0,deleteWithUndo.S)({endpoint:`projects/${currentProjectId}/experiments`,object:{name:experiment.name,id:experiment.id},callback:()=>{loadExperiments()}})},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},"data-attr":`experiment-${experiment.id}-dropdown-remove`,fullWidth:!0,children:"Delete experiment"})})]})})}}];return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,dist.EQ)(tab).with(types.F7.All,()=>(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Experiment,minAccessLevel:types.W$.Editor,children:(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Experiments",productKey:schema_general.Md.EXPERIMENTS,thingName:"experiment",description:EXPERIMENTS_PRODUCT_DESCRIPTION,docsURL:"https://posthog.com/docs/experiments",action:()=>lib.router.actions.push(urls.j.experiment("new")),isEmpty:shouldShowEmptyState,customHog:hedgehogs.ExperimentsHog,className:"my-0"})})).with(types.F7.Archived,()=>(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Experiment,minAccessLevel:types.W$.Editor,children:(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Experiments",productKey:schema_general.Md.EXPERIMENTS,thingName:"archived experiment",description:EXPERIMENTS_PRODUCT_DESCRIPTION,docsURL:"https://posthog.com/docs/experiments",isEmpty:shouldShowEmptyState,className:"my-0"})})).otherwise(()=>null),(0,jsx_runtime.jsx)(ExperimentsTableFilters,{tab:tab,filters:filters,onFiltersChange:setExperimentsFilters}),(0,jsx_runtime.jsx)(LemonDivider.p,{className:"my-0"}),count?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:`${startCount}${endCount-startCount>1?"-"+endCount:""} of ${count} experiment${1===count?"":"s"}`})}):null,(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:experiments.results,columns:columns,rowKey:"id",loading:experimentsLoading,defaultSorting:{columnKey:"created_at",order:-1},noSortingCancellation:!0,pagination:pagination,nouns:["experiment","experiments"],"data-attr":"experiment-table",emptyState:"No results for this filter, change filter or create a new experiment.",onSort:newSorting=>setExperimentsFilters({order:newSorting?`${-1===newSorting.order?"-":""}${newSorting.columnKey}`:void 0,page:1})})]})};function Experiments(){let{tab}=(0,index_esm.useValues)(experimentsLogic.OK),{setExperimentsTab,loadExperiments}=(0,index_esm.useActions)(experimentsLogic.OK),[duplicateModalExperiment,setDuplicateModalExperiment]=(0,react.useState)(null);return(0,useMaxTool.$)({identifier:"create_feature_flag",initialMaxPrompt:"Create a feature flag for ",suggestions:[],callback:()=>{},active:!0,context:{}}),(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:"Experiments",resourceType:{type:"experiment"},actions:tab!==types.F7.SharedMetrics&&tab!==types.F7.Holdouts?(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Experiment,minAccessLevel:types.W$.Editor,children:(0,jsx_runtime.jsx)(MaxTool.Z,{identifier:"create_experiment",initialMaxPrompt:"Create an experiment for ",suggestions:["Create an experiment to test…","Set up an A/B test with a 70/30 split between control and test for…"],callback:toolOutput=>{if(toolOutput?.error||!toolOutput?.experiment_id){src.UJ.error(`Failed to create experiment: ${toolOutput?.error||"Unknown error"}`);return}loadExperiments(),lib.router.actions.push(urls.j.experiment(toolOutput.experiment_id))},position:"bottom-right",active:!0,context:{},children:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",type:"primary","data-attr":"create-experiment",to:urls.j.experiment("new"),children:(0,jsx_runtime.jsx)("span",{className:"pr-3",children:"New experiment"})})})}):void 0}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tab,onChange:newKey=>setExperimentsTab(newKey),sceneInset:!0,tabs:[{key:types.F7.All,label:"All experiments",content:(0,jsx_runtime.jsx)(ExperimentsTable,{openDuplicateModal:setDuplicateModalExperiment})},{key:types.F7.Archived,label:"Archived experiments",content:(0,jsx_runtime.jsx)(ExperimentsTable,{openDuplicateModal:setDuplicateModalExperiment})},{key:types.F7.Holdouts,label:"Holdout groups",content:(0,jsx_runtime.jsx)(Holdouts,{})},{key:types.F7.SharedMetrics,label:"Shared metrics",content:(0,jsx_runtime.jsx)(SharedMetrics.SharedMetrics,{})},{key:types.F7.History,label:"History",content:(0,jsx_runtime.jsx)(ActivityLog.DA,{scope:types.jc.EXPERIMENT})},{key:types.F7.Settings,label:"Settings",content:(0,jsx_runtime.jsx)(ExperimentsSettings,{})}]}),duplicateModalExperiment&&(0,jsx_runtime.jsx)(DuplicateExperimentModal.B,{isOpen:!0,onClose:()=>setDuplicateModalExperiment(null),experiment:duplicateModalExperiment})]})}},"../../frontend/src/scenes/experiments/SharedMetrics/SharedMetrics.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SharedMetrics:()=>SharedMetrics,scene:()=>scene});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),_posthog_icons__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_components_ObjectTags_ObjectTags__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),lib_utils_stringWithWBR__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/lib/utils/stringWithWBR.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/scenes/urls.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),_types__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../frontend/src/scenes/experiments/utils.ts"),_sharedMetricsLogic__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../frontend/src/scenes/experiments/SharedMetrics/sharedMetricsLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:SharedMetrics,logic:_sharedMetricsLogic__WEBPACK_IMPORTED_MODULE_13__.G};function SharedMetrics(){let{sharedMetrics,sharedMetricsLoading}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_sharedMetricsLogic__WEBPACK_IMPORTED_MODULE_13__.G),{hasAvailableFeature}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(scenes_userLogic__WEBPACK_IMPORTED_MODULE_9__.userLogic),columns=[{key:"name",title:"Name",render:(_,sharedMetric)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_5__.i,{to:sharedMetric.id?scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.experimentsSharedMetric(sharedMetric.id):void 0,title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.Fragment,{children:[(0,lib_utils_stringWithWBR__WEBPACK_IMPORTED_MODULE_7__.Z)(sharedMetric.name,17),(0,_utils__WEBPACK_IMPORTED_MODULE_12__.l2)(sharedMetric)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.u,{title:"This metric uses the legacy engine, so some features and improvements may be missing.",docLink:"https://posthog.com/docs/experiments/new-experimentation-engine",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.oe,{type:"warning",className:"ml-1",children:"Legacy"})})]})}),sorter:(a,b)=>a.name.localeCompare(b.name)},{key:"description",title:"Description",dataIndex:"description"},...hasAvailableFeature(_types__WEBPACK_IMPORTED_MODULE_11__.P$.TAGGING)?[{title:"Tags",dataIndex:"tags",render:function Render(tags){return tags?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(lib_components_ObjectTags_ObjectTags__WEBPACK_IMPORTED_MODULE_4__.D,{tags:tags,staticOnly:!0}):null}}]:[],{title:"Type",key:"type",render:(_,metric)=>metric.query.kind===_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_10__.OH.ExperimentMetric?metric.query.metric_type:metric.query.kind===_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_10__.OH.ExperimentTrendsQuery?"Trend":"Funnel"},(0,lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_6__.JB)(),(0,lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_6__.rw)(),{key:"actions",title:"Actions",render:(_,sharedMetric)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)("div",{className:"flex gap-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{className:"max-w-72",type:"secondary",size:"xsmall",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconPencil,{}),onClick:()=>{kea_router__WEBPACK_IMPORTED_MODULE_1__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.experimentsSharedMetric(sharedMetric.id))}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{className:"max-w-72",type:"secondary",size:"xsmall",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconCopy,{}),onClick:()=>{kea_router__WEBPACK_IMPORTED_MODULE_1__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.experimentsSharedMetric(sharedMetric.id,"duplicate"))}})]})}];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Vp,{type:"info",children:"Shared metrics let you create reusable metrics that you can quickly add to any experiment. They are ideal for tracking key metrics like conversion rates or revenue across different experiments without having to set them up each time."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div",{className:"flex justify-end",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{size:"small",type:"primary",to:scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.experimentsSharedMetric("new"),children:"New shared metric"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.g3,{columns:columns,dataSource:sharedMetrics||[],loading:sharedMetricsLoading,emptyState:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_14__.jsx)("div",{children:"You haven't created any shared metrics yet."})})]})}}}]);