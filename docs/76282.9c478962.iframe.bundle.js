"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[76282],{"./frontend/src/scenes/data-warehouse/external/forms/SourceForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>SourceFormComponent,Z:()=>SourceFormContainer});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5/node_modules/kea-forms/lib/index.js"),LemonField=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),sourceWizardLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx"),IntegrationChoice=__webpack_require__("./frontend/src/scenes/pipeline/hogfunctions/integrations/IntegrationChoice.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DataWarehouseIntegrationChoice(_ref){let{sourceConfig,...props}=_ref;return(0,jsx_runtime.jsx)(IntegrationChoice.a,{...props,integration:sourceConfig.name.toLowerCase(),redirectUrl:`/data-warehouse/new?kind=${sourceConfig.name.toLowerCase()}`})}let sourceFieldToElement=(field,sourceConfig,lastValue)=>{if("switch-group"===field.type)return(0,jsx_runtime.jsx)(LemonField.D,{name:[field.name,"enabled"],label:field.label,children:_ref=>{let{value,onChange}=_ref;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!!field.caption&&(0,jsx_runtime.jsx)("p",{children:field.caption}),(0,jsx_runtime.jsx)(src.f4,{checked:null==value?lastValue?.enabled:value,onChange:onChange}),value&&(0,jsx_runtime.jsx)(lib.Group,{name:field.name,children:field.fields.map(field=>sourceFieldToElement(field,sourceConfig,lastValue?.[field.name]))})]})}},field.name);if("select"===field.type){let hasOptionFields=!!field.options.filter(n=>{var _n$fields$length;return(null!==(_n$fields$length=n.fields?.length)&&void 0!==_n$fields$length?_n$fields$length:0)>0}).length;return(0,jsx_runtime.jsx)(LemonField.D,{name:hasOptionFields?[field.name,"selection"]:field.name,label:field.label,children:_ref2=>{let{value,onChange}=_ref2;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Yv,{options:field.options,value:null==value?lastValue?.[field.name]:value||field.defaultValue,onChange:onChange}),(0,jsx_runtime.jsx)(lib.Group,{name:field.name,children:field.options.find(n=>n.value===(null!=value?value:field.defaultValue))?.fields?.map(field=>sourceFieldToElement(field,sourceConfig,lastValue?.[field.name]))})]})}},field.name)}return"textarea"===field.type?(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:(0,jsx_runtime.jsx)(src._V,{className:"ph-ignore-input","data-attr":field.name,placeholder:field.placeholder,minRows:4,defaultValue:lastValue})},field.name):"oauth"===field.type?(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref3=>{let{value,onChange}=_ref3;return(0,jsx_runtime.jsx)(DataWarehouseIntegrationChoice,{sourceConfig:sourceConfig,value:value,onChange:onChange},field.name)}},field.name):"file-upload"===field.type?(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref4=>{let{value,onChange}=_ref4;return(0,jsx_runtime.jsx)("div",{className:"bg-[white] p-2 border rounded-[var(--radius)]",children:(0,jsx_runtime.jsx)(src.mH,{value:value,accept:field.fileFormat,multiple:!1,onChange:onChange})})}},field.name):(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:(0,jsx_runtime.jsx)(src.DF,{className:"ph-ignore-input","data-attr":field.name,placeholder:field.placeholder,type:field.type,defaultValue:lastValue})},field.name)};function SourceFormContainer(props){return(0,jsx_runtime.jsx)(lib.Form,{logic:sourceWizardLogic.So,formKey:"sourceConnectionDetails",enableFormOnSubmit:!0,children:(0,jsx_runtime.jsx)(SourceFormComponent,{...props})})}function SourceFormComponent(_ref5){let{sourceConfig,showPrefix=!0,jobInputs}=_ref5;return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(lib.Group,{name:"payload",children:sourceWizardLogic.l2[sourceConfig.name].fields.map(field=>sourceFieldToElement(field,sourceConfig,jobInputs?.[field.name]))}),showPrefix&&(0,jsx_runtime.jsx)(LemonField.D,{name:"prefix",label:"Table Prefix (optional)",children:(0,jsx_runtime.jsx)(src.DF,{className:"ph-ignore-input","data-attr":"prefix",placeholder:"internal_"})})]})}},"./frontend/src/scenes/data-warehouse/external/forms/SyncMethodForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>SyncMethodForm});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonRadio/index.ts"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let getIncrementalSyncSupported=schema=>schema.incremental_available?0===schema.incremental_fields.length?{disabled:!0,disabledReason:"No incremental fields found on table"}:{disabled:!1}:{disabled:!0,disabledReason:"Incremental replication isn't supported on this table"},hasInputChanged=(newSchemaSyncType,newSchemaIncrementalField,originalSchemaSyncType,originalSchemaIncrementalField)=>originalSchemaSyncType!==newSchemaSyncType||"incremental"===newSchemaSyncType&&newSchemaIncrementalField!==originalSchemaIncrementalField,getSaveDisabledReason=(syncType,incrementalField)=>syncType?"incremental"!==syncType||incrementalField?void 0:"You must select an incremental field":"You must select a sync method before saving",SyncMethodForm=_ref=>{var _schema$sync_type,_schema$incremental_f,_schema$sync_type2,_schema$incremental_f2,_schema$incremental_f4;let{schema,onClose,onSave,saveButtonIsLoading,showRefreshMessageOnChange}=_ref,[originalSchemaSyncType]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$sync_type=schema.sync_type)&&void 0!==_schema$sync_type?_schema$sync_type:null),[originalSchemaIncrementalField]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$incremental_f=schema.incremental_field)&&void 0!==_schema$incremental_f?_schema$incremental_f:null),[radioValue,setRadioValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$sync_type2=schema.sync_type)&&void 0!==_schema$sync_type2?_schema$sync_type2:void 0),[incrementalFieldValue,setIncrementalFieldValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$incremental_f2=schema.incremental_field)&&void 0!==_schema$incremental_f2?_schema$incremental_f2:null);(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{var _schema$sync_type3,_schema$incremental_f3;setRadioValue(null!==(_schema$sync_type3=schema.sync_type)&&void 0!==_schema$sync_type3?_schema$sync_type3:void 0),setIncrementalFieldValue(null!==(_schema$incremental_f3=schema.incremental_field)&&void 0!==_schema$incremental_f3?_schema$incremental_f3:null)},[schema.table]);let incrementalSyncSupported=getIncrementalSyncSupported(schema),inputChanged=hasInputChanged(null!=radioValue?radioValue:null,incrementalFieldValue,originalSchemaSyncType,originalSchemaIncrementalField);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__._,{radioPosition:"top",value:radioValue,options:[{value:"incremental",disabledReason:incrementalSyncSupported.disabled&&incrementalSyncSupported.disabledReason||void 0,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-6 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-2.5",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h2",{className:"mb-0 mr-2",children:"Incremental replication"}),!incrementalSyncSupported.disabled&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{type:"success",children:"Recommended"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"When using incremental replication, we'll store the max value of the below field on each sync and only sync rows with greater or equal value on the next run."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:["You should pick a field that increments or updates each time the row is updated, such as a ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("code",{children:"updated_at"})," timestamp."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Yv,{value:incrementalFieldValue,onChange:newValue=>setIncrementalFieldValue(newValue),options:null!==(_schema$incremental_f4=schema.incremental_fields.map(n=>({value:n.field,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{className:"leading-5",children:n.label}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{className:"ml-2",type:"success",children:n.type})]})})))&&void 0!==_schema$incremental_f4?_schema$incremental_f4:[],disabledReason:incrementalSyncSupported.disabled?"":void 0})]})},{value:"full_refresh",label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-6 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-2.5",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h2",{className:"mb-0 mr-2",children:"Full table replication"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"We'll replicate the whole table on every sync. This can take longer to sync and increase your monthly billing."})]})}],onChange:newValue=>setRadioValue(newValue)}),inputChanged&&showRefreshMessageOnChange&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"text-danger",children:"Note: Changing the sync type or incremental replication field will trigger a full table refresh"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"flex flex-row justify-end w-full",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{className:"mr-3",type:"secondary",onClick:onClose,children:"Close"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{type:"primary",loading:saveButtonIsLoading,disabledReason:getSaveDisabledReason(radioValue,incrementalFieldValue),onClick:()=>{if("incremental"===radioValue){let fieldSelected=schema.incremental_fields.find(n=>n.field===incrementalFieldValue);if(!fieldSelected){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Selected field for incremental replication not found");return}onSave("incremental",incrementalFieldValue,fieldSelected.field_type)}else onSave("full_refresh",null,null)},children:"Save"})]})]})}},"./frontend/src/scenes/data-warehouse/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{w:()=>defaultQuery});var _queries_schema__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/queries/schema.ts");let defaultQuery=(table,columns)=>({kind:_queries_schema__WEBPACK_IMPORTED_MODULE_0__.OH.DataVisualizationNode,source:{kind:_queries_schema__WEBPACK_IMPORTED_MODULE_0__.OH.HogQLQuery,query:`SELECT ${columns.filter(_ref=>{let{table,fields,chain,schema_valid}=_ref;return!table&&!fields&&!chain&&schema_valid}).map(_ref2=>{let{name}=_ref2;return name})} FROM ${"numbers"===table?"numbers(0, 10)":table} LIMIT 100`}})}}]);