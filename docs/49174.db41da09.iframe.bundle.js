(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[49174,38775],{"../../frontend/src/scenes/groups/Groups.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Groups:()=>Groups,GroupsScene:()=>GroupsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),groupsAccessLogic=__webpack_require__("../../frontend/src/lib/introductions/groupsAccessLogic.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),GroupsIntroduction=__webpack_require__("../../frontend/src/scenes/groups/GroupsIntroduction.tsx"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),groupsModel=__webpack_require__("../../frontend/src/models/groupsModel.ts"),utils=__webpack_require__("../../frontend/src/queries/nodes/DataTable/utils.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.257.0_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js");let INITIAL_SORTING=[],INITIAL_GROUPS_FILTER=[],persistConfig=groupTypeIndex=>({persist:!0,prefix:`${window.POSTHOG_APP_CONTEXT?.current_team?.id}__group_${groupTypeIndex}__`}),groupsListLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.groupTypeIndex),(0,index_esm.path)(["groups","groupsListLogic"]),(0,index_esm.connect)(()=>({values:[teamLogic.teamLogic,["currentTeamId"],groupsModel.$,["groupTypes","aggregationLabel"],groupsAccessLogic.e,["groupsEnabled"]]})),(0,index_esm.actions)(()=>({setQuery:query=>({query}),setQueryWasModified:queryWasModified=>({queryWasModified}),setGroupFilters:filters=>({filters})})),(0,index_esm.reducers)(_ref=>{let{props}=_ref;return{query:[(_,props)=>({kind:schema_general.OH.DataTableNode,source:{kind:schema_general.OH.GroupsQuery,select:void 0,group_type_index:props.groupTypeIndex},full:!0,showEventFilter:!1,showPersistentColumnConfigurator:!0,propertiesViaUrl:!0}),{setQuery:(_,_ref2)=>{let{query}=_ref2;return query}}],groupFilters:[INITIAL_GROUPS_FILTER,persistConfig(props.groupTypeIndex),{setGroupFilters:(_,_ref3)=>{let{filters}=_ref3;return filters},setQuery:(state,_ref4)=>{let{query}=_ref4;return query.source.kind===schema_general.OH.GroupsQuery&&query.source.properties?query.source.properties:state}}],sorting:[INITIAL_SORTING,persistConfig(props.groupTypeIndex),{setQuery:(state,_ref5)=>{let{query}=_ref5;return query.source.kind===schema_general.OH.GroupsQuery&&void 0!==query.source.orderBy?query.source.orderBy:state}}],queryWasModified:[!1,{setQueryWasModified:(_,_ref6)=>{let{queryWasModified}=_ref6;return queryWasModified}}]}}),(0,index_esm.listeners)(_ref7=>{let{actions}=_ref7;return{setQuery:()=>{actions.setQueryWasModified(!0)}}}),(0,lib.actionToUrl)(_ref8=>{let{values,props}=_ref8;return{setQuery:()=>{let searchParams={};return values.query.source.kind===schema_general.OH.GroupsQuery&&values.query.source.properties?.length&&(searchParams[`properties_${props.groupTypeIndex}`]=JSON.stringify(values.query.source.properties)),[lib.router.values.location.pathname,searchParams,void 0,{replace:!0}]},setGroupFilters:()=>{let searchParams={};return values.groupFilters?.length&&(searchParams[`properties_${props.groupTypeIndex}`]=JSON.stringify(values.groupFilters)),[lib.router.values.location.pathname,searchParams,void 0,{replace:!0}]}}}),(0,lib.urlToAction)(_ref9=>{let{actions,values,props}=_ref9;return{[`/groups/${props.groupTypeIndex}`]:(_,searchParams)=>{if(values.query.source.kind!==schema_general.OH.GroupsQuery)return;let properties=searchParams[`properties_${props.groupTypeIndex}`];if(properties)try{let parsedProperties=JSON.parse(properties);parsedProperties&&Array.isArray(parsedProperties)&&actions.setQuery({...values.query,source:{...values.query.source,properties:parsedProperties,orderBy:values.sorting}})}catch(error){dist_module.ZP.captureException("Failed to parse properties",error)}else actions.setQuery({...values.query,source:{...values.query.source,properties:values.groupFilters,orderBy:values.sorting}})}}}),(0,index_esm.afterMount)(_ref10=>{let{actions,values}=_ref10;if(values.query.source.kind===schema_general.OH.GroupsQuery&&void 0===values.query.source.select){let defaultColumns=values.groupTypes.get(values.query.source.group_type_index)?.default_columns;actions.setQuery({...values.query,source:{...values.query.source,select:null!=defaultColumns?defaultColumns:(0,utils.Qi)(schema_general.OH.GroupsQuery)}}),actions.setQueryWasModified(!1)}})]);var groupsSceneLogic=__webpack_require__("../../frontend/src/scenes/groups/groupsSceneLogic.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),CopyToClipboard=__webpack_require__("../../frontend/src/lib/components/CopyToClipboard.tsx"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),stringWithWBR=__webpack_require__("../../frontend/src/lib/utils/stringWithWBR.tsx"),billing_utils=__webpack_require__("../../frontend/src/scenes/billing/billing-utils.ts"),PersonDisplay=__webpack_require__("../../frontend/src/scenes/persons/PersonDisplay.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function getCRMColumns(groupTypeName,groupTypeIndex){return{group_name:{title:groupTypeName,render:function renderGroupName(_ref){var _sourceQuery$select$i;let{query,record,value}=_ref,sourceQuery=query.source,groupKey=record[null!==(_sourceQuery$select$i=sourceQuery?.select?.indexOf("key"))&&void 0!==_sourceQuery$select$i?_sourceQuery$select$i:-1];return(0,jsx_runtime.jsxs)("div",{className:"min-w-40",children:[(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.group(groupTypeIndex,groupKey),title:value}),(0,jsx_runtime.jsx)(CopyToClipboard.D,{explicitValue:groupKey,iconStyle:{color:"var(--accent)"},description:"group id",children:(0,stringWithWBR.Z)(groupKey,100)})]})}},arr:{render:renderCurrency},mrr:{render:renderCurrency},"forecasted mrr":{render:renderCurrency},owner:{render:renderPerson},"survey responses":{render:renderLink},"feature flags":{render:renderLink},"mobile recordings":{render:renderLink},"data warehouse":{render:renderLink},events:{render:renderLink}}}function renderCurrency(_ref2){let{value}=_ref2;return!value||isNaN(Number(value))?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"—"}):(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.revenueAnalytics(),title:(0,billing_utils.oB)(value)})}function renderPerson(_ref3){let{value}=_ref3;return value&&"string"==typeof value?(0,jsx_runtime.jsx)(PersonDisplay.I,{withIcon:!0,displayName:value}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"—"})}function renderLink(_ref4){let{value,columnName}=_ref4;if(!value||isNaN(Number(value)))return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"—"});switch(columnName){case"survey responses":return(0,jsx_runtime.jsx)("div",{className:"min-w-30",children:(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.surveys(),title:value,description:"in the last 7d"})});case"feature flags":return(0,jsx_runtime.jsx)("div",{className:"min-w-30",children:(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.featureFlags(),title:value,description:"evals in the last 7d"})});case"mobile recordings":return(0,jsx_runtime.jsx)("div",{className:"min-w-30",children:(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.replay(),title:value,description:"in the last 7d"})});case"data warehouse":return(0,jsx_runtime.jsx)("div",{className:"min-w-30",children:(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.sqlEditor(),title:value,description:"rows synced in the last 7d"})});case"events":return(0,jsx_runtime.jsx)("div",{className:"min-w-30",children:(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.activity(),title:value,description:"in the last 7d"})});default:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"—"})}}function Groups(_ref){let{groupTypeIndex}=_ref,{groupTypeName,groupTypeNamePlural}=(0,index_esm.useValues)(groupsSceneLogic.C),{query,queryWasModified}=(0,index_esm.useValues)(groupsListLogic({groupTypeIndex})),{setQuery}=(0,index_esm.useActions)(groupsListLogic({groupTypeIndex})),{groupsAccessStatus}=(0,index_esm.useValues)(groupsAccessLogic.e),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic);if(void 0===groupTypeIndex)throw Error("groupTypeIndex is undefined");if(groupsAccessStatus==groupsAccessLogic.Q.HasAccess||groupsAccessStatus==groupsAccessLogic.Q.HasGroupTypes||groupsAccessStatus==groupsAccessLogic.Q.NoAccess)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(GroupsIntroduction.S,{})});let columns={group_name:{title:groupTypeName}},hiddenColumns=[];return featureFlags[constants.y8.CRM_ITERATION_ONE]&&(columns=getCRMColumns(groupTypeName,groupTypeIndex),hiddenColumns.push("key")),(0,jsx_runtime.jsx)(Query.A,{query:{...query,hiddenColumns},setQuery:setQuery,context:{refresh:"blocking",emptyStateHeading:queryWasModified?`No ${groupTypeNamePlural} found`:`No ${groupTypeNamePlural} exist because none have been identified`,emptyStateDetail:queryWasModified?"Try changing the date range or property filters.":(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Go to the"," ",(0,jsx_runtime.jsx)(Link.r,{to:"https://posthog.com/docs/product-analytics/group-analytics#how-to-create-groups",children:"group analytics docs"})," ","to learn what needs to be done"]}),columns,groupTypeLabel:groupTypeNamePlural},dataAttr:"groups-table"})}function GroupsScene(){let{groupTypeIndex}=(0,index_esm.useValues)(groupsSceneLogic.C);return(0,jsx_runtime.jsx)(Groups,{groupTypeIndex:groupTypeIndex})}let scene={component:GroupsScene,logic:groupsSceneLogic.C}},"../../frontend/src/scenes/groups/groupsSceneLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{C:()=>groupsSceneLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/introductions/groupsAccessLogic.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/utils.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_models_groupsModel__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/models/groupsModel.ts");let groupsSceneLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","groups","groupsSceneLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[_models_groupsModel__WEBPACK_IMPORTED_MODULE_5__.$,["aggregationLabel","groupTypes","groupTypesLoading","groupsAccessStatus"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setGroupTypeIndex:groupTypeIndex=>({groupTypeIndex}),setTabKey:tabKey=>({tabKey})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({groupTypeIndex:[0,{setGroupTypeIndex:(_,_ref)=>{let{groupTypeIndex}=_ref;return groupTypeIndex}}],tabKey:["persons",{setTabKey:(_,_ref2)=>{let{tabKey}=_ref2;return tabKey}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({tabs:[()=>[],()=>[]],activeTab:[s=>[s.tabs,s.tabKey],(tabs,tabKey)=>{var _tabs$find;return null!==(_tabs$find=tabs.find(x=>x.key===tabKey))&&void 0!==_tabs$find?_tabs$find:null}],groupTypeName:[s=>[s.aggregationLabel,s.groupTypeIndex],(aggregationLabel,groupTypeIndex)=>aggregationLabel(groupTypeIndex).singular],groupTypeNamePlural:[s=>[s.aggregationLabel,s.groupTypeIndex],(aggregationLabel,groupTypeIndex)=>aggregationLabel(groupTypeIndex).plural],breadcrumbs:[s=>[s.groupTypeIndex,s.groupTypeNamePlural,s.showGroupsIntroductionPage],(groupTypeIndex,groupTypeNamePlural,showGroupsIntroductionPage)=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.Groups,name:showGroupsIntroductionPage?"Groups":(0,lib_utils__WEBPACK_IMPORTED_MODULE_2__.fm)(groupTypeNamePlural),path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.groups(groupTypeIndex)}]],showGroupsIntroductionPage:[s=>[s.groupsAccessStatus],groupsAccessStatus=>[lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_1__.Q.HasAccess,lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_1__.Q.HasGroupTypes,lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_1__.Q.NoAccess].includes(groupsAccessStatus)]})])},"../../frontend/src/scenes/persons-management/PersonsManagementScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PersonsManagementScene:()=>PersonsManagementScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),groupsModel=__webpack_require__("../../frontend/src/models/groupsModel.ts"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),groupsAccessLogic=__webpack_require__("../../frontend/src/lib/introductions/groupsAccessLogic.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Cohorts=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/cohorts/Cohorts.scss"),Cohorts_default=__webpack_require__.n(Cohorts),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(Cohorts_default(),options),Cohorts_default().locals;var hedgehogs=__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonDivider=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonDivider/index.ts"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),types=__webpack_require__("../../frontend/src/types.ts"),cohortsModel=__webpack_require__("../../frontend/src/models/cohortsModel.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function Cohorts_Cohorts(){let{cohorts,cohortsLoading,pagination,cohortFilters}=(0,index_esm.useValues)(cohortsModel.Qo),{deleteCohort,exportCohortPersons,setCohortFilters}=(0,index_esm.useActions)(cohortsModel.Qo),{searchParams}=(0,index_esm.useValues)(lib.router),[searchTerm,setSearchTerm]=(0,react.useState)(cohortFilters.search||""),columns=[{title:"Name",dataIndex:"name",width:"30%",sorter:(a,b)=>(a.name||"").localeCompare(b.name||""),render:function Render(name,_ref){let{id,description}=_ref;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonTableLink.i,{to:(0,lib.combineUrl)(urls.j.cohort(id),searchParams).url,title:name?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:name}):"Untitled",description:description})})}},{title:"Users in cohort",align:"right",render:function RenderCount(_,cohort){return cohort.count?.toLocaleString()},dataIndex:"count",sorter:(a,b)=>(a.count||0)-(b.count||0)},(0,columnUtils.JB)(),(0,columnUtils.rw)(),{title:"Last calculated",tooltip:"PostHog calculates what users belong to each cohort. This is then used when filtering on cohorts in the Trends page etc. Calculating happens every 24 hours, or whenever a cohort is updated",render:function RenderCalculation(_,cohort){return cohort.is_static?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"N/A"}):cohort.is_calculating?(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:["in progress ",(0,jsx_runtime.jsx)(Spinner.$,{className:"ml-2"})]}):(0,dayjs.Bv)(cohort.last_calculation).fromNow()}},{width:0,render:function RenderActions(_,cohort){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{to:urls.j.cohort(cohort.id),fullWidth:!0,children:"Edit"}),(0,jsx_runtime.jsx)(LemonButton.J,{to:(0,lib.combineUrl)(urls.j.replay(),{filters:{properties:[{key:"id",label:cohort.name,type:"cohort",value:cohort.id}]}}).url,fullWidth:!0,children:"View session recordings"}),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>exportCohortPersons(cohort.id,["distinct_ids.0","id","name","properties.email"]),tooltip:"Export specific columns for users belonging to this cohort in CSV format. Includes distinct id, internal id, email, and name",fullWidth:!0,children:"Export important columns for users"}),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>exportCohortPersons(cohort.id),tooltip:"Export all users belonging to this cohort in CSV format.",fullWidth:!0,children:"Export all columns for users"}),(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(LemonButton.J,{status:"danger",onClick:()=>{deleteCohort({id:cohort.id,name:cohort.name,deleted:!0})},fullWidth:!0,children:"Delete cohort"})]})})}}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Cohorts",productKey:types.Md.COHORTS,thingName:"cohort",description:"Use cohorts to group people together, such as users who used your app in the last week, or people who viewed the signup page but didn’t convert.",isEmpty:0==cohorts.count&&!cohortsLoading&&!searchTerm,docsURL:"https://posthog.com/docs/data/cohorts",action:()=>lib.router.actions.push(urls.j.cohort("new")),customHog:hedgehogs.ListHog}),(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-center mb-4 gap-2",children:(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search for cohorts",onChange:search=>{setSearchTerm(search),setCohortFilters({search:search||void 0,page:1})},value:searchTerm})}),(0,jsx_runtime.jsx)(LemonTable.g,{columns:columns,loading:cohortsLoading,rowKey:"id",pagination:pagination,dataSource:cohorts.results,nouns:["cohort","cohorts"],"data-attr":"cohorts-table"})]})}var Groups=__webpack_require__("../../frontend/src/scenes/groups/Groups.tsx"),groupsSceneLogic=__webpack_require__("../../frontend/src/scenes/groups/groupsSceneLogic.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.26.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),api=__webpack_require__("../../frontend/src/lib/api.ts"),DataTable_utils=__webpack_require__("../../frontend/src/queries/nodes/DataTable/utils.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts");let personsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","persons","personsSceneLogic"]),(0,index_esm.actions)({setQuery:query=>({query}),resetDeletedDistinctId:distinct_id=>({distinct_id})}),(0,index_esm.reducers)({query:[{kind:schema_general.OH.DataTableNode,source:{kind:schema_general.OH.ActorsQuery,select:[...(0,DataTable_utils.Qi)(schema_general.OH.ActorsQuery),"person.$delete"]},full:!0,propertiesViaUrl:!0},{setQuery:(_,_ref)=>{let{query}=_ref;return query}}]}),(0,index_esm.listeners)({resetDeletedDistinctId:async _ref2=>{let{distinct_id}=_ref2;await api.ZP.persons.resetPersonDistinctId(distinct_id),src.UJ.success("Distinct ID reset. It may take a few minutes to process.")}})]);var teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx");function Persons(){let{query}=(0,index_esm.useValues)(personsSceneLogic),{setQuery}=(0,index_esm.useActions)(personsSceneLogic),{resetDeletedDistinctId}=(0,index_esm.useAsyncActions)(personsSceneLogic),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsx)(src.d6,{items:[{label:"Reset a deleted person...",onClick:()=>src.dn.openForm({width:"30rem",title:"Reset deleted person",description:`Once a person is deleted, the "distinct_id" associated with them can no longer be used. 
                                            You can use this tool to reset the "distinct_id" for a person so that new events associated with it will create a new Person profile.`,initialValues:{distinct_id:""},content:(0,jsx_runtime.jsx)(LemonField.D,{name:"distinct_id",label:"Distinct ID to reset",children:(0,jsx_runtime.jsx)(src.DF,{type:"text",autoFocus:!0})}),errors:{distinct_id:distinct_id=>distinct_id?void 0:"This is required"},onSubmit:async _ref=>{let{distinct_id}=_ref;return await resetDeletedDistinctId(distinct_id)}})}],children:(0,jsx_runtime.jsx)(src.Jp,{"aria-label":"more",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{}),size:"small"})})}),(0,jsx_runtime.jsx)(Query.A,{query:query,setQuery:setQuery,context:{refresh:"blocking",emptyStateHeading:currentTeam?.ingested_event?"There are no matching persons for this query":"No persons exist because no events have been ingested",emptyStateDetail:currentTeam?.ingested_event?"Try changing the date range or property filters.":(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Go to the"," ",(0,jsx_runtime.jsx)(Link.r,{to:urls.j.onboarding(types.Md.PRODUCT_ANALYTICS,types.Hr.INSTALL),"data-attr":"real_project_with_no_events-ingestion_link",children:"onboarding wizard"})," ","to get things moving"]})},dataAttr:"persons-table"})]})}var featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx");let personsManagementSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","persons-management","personsManagementSceneLogic"]),(0,index_esm.connect)(()=>({actions:[groupsSceneLogic.C,["setGroupTypeIndex"]],values:[groupsModel.$,["aggregationLabel","groupTypes","groupTypesLoading","groupsAccessStatus"],featureFlagLogic.featureFlagLogic,["featureFlags"]]})),(0,index_esm.actions)({setTabKey:tabKey=>({tabKey})}),(0,index_esm.reducers)({tabKey:["persons",{setTabKey:(_,_ref)=>{let{tabKey}=_ref;return tabKey}}]}),(0,index_esm.selectors)({tabs:[s=>[s.groupTabs],groupTabs=>[{key:"persons",url:urls.j.persons(),label:"People",content:(0,jsx_runtime.jsx)(Persons,{}),tooltipDocLink:"https://posthog.com/docs/data/persons"},{key:"cohorts",url:urls.j.cohorts(),label:"Cohorts",content:(0,jsx_runtime.jsx)(Cohorts_Cohorts,{}),buttons:(0,jsx_runtime.jsx)(src.Jp,{type:"primary","data-attr":"new-cohort",onClick:()=>lib.router.actions.push(urls.j.cohort("new")),children:"New cohort"}),tooltipDocLink:"https://posthog.com/docs/data/cohorts"},...groupTabs]],activeTab:[s=>[s.tabs,s.tabKey],(tabs,tabKey)=>{var _tabs$find;return null!==(_tabs$find=tabs.find(x=>x.key===tabKey))&&void 0!==_tabs$find?_tabs$find:null}],crmFeatureFlag:[s=>[s.featureFlags],featureFlags=>featureFlags[constants.y8.CRM_ITERATION_ONE]],groupTabs:[s=>[s.groupTypes,s.groupsAccessStatus,s.aggregationLabel,s.crmFeatureFlag],(groupTypes,groupsAccessStatus,aggregationLabel,crmFeatureFlag)=>[groupsAccessLogic.Q.HasAccess,groupsAccessLogic.Q.HasGroupTypes,groupsAccessLogic.Q.NoAccess].includes(groupsAccessStatus)?[{key:"groups-0",label:"Groups",url:urls.j.groups(0),content:(0,jsx_runtime.jsx)(Groups.Groups,{groupTypeIndex:0})}]:Array.from(groupTypes.values()).map(_ref2=>{let{group_type_index}=_ref2;return{key:`groups-${group_type_index}`,label:(0,utils.fm)(aggregationLabel(group_type_index).plural),url:urls.j.groups(group_type_index),content:(0,jsx_runtime.jsx)(Groups.Groups,{groupTypeIndex:group_type_index}),buttons:crmFeatureFlag?(0,jsx_runtime.jsxs)(src.Jp,{type:"primary","data-attr":`new-group-${group_type_index}`,onClick:()=>lib.router.actions.push(urls.j.group(group_type_index,"new",!1)),children:["New ",aggregationLabel(group_type_index).singular]}):null}})],breadcrumbs:[s=>[s.tabs,s.activeTab],(tabs,activeTab)=>[{key:sceneTypes.x.PersonsManagement,name:"People",path:tabs[0].url},activeTab?{key:activeTab.key,name:activeTab.label,path:activeTab.url}:{key:"loading",name:"Loading..."}]]}),(0,lib.actionToUrl)(_ref3=>{let{values}=_ref3;return{setTabKey:_ref4=>{let{tabKey}=_ref4,tabUrl=values.tabs.find(x=>x.key===tabKey)?.url;if(!tabUrl&&values.groupTypesLoading){let groupMatch=tabKey.match(/^groups-(\d+)$/);groupMatch&&(tabUrl=urls.j.groups(parseInt(groupMatch[1])))}return tabUrl?[tabUrl,lib.router.values.searchParams,lib.router.values.hashParams,{replace:!0}]:values.tabs[0].url}}}),(0,lib.urlToAction)(_ref5=>{let{actions}=_ref5,urlToAction={[urls.j.persons()]:()=>{actions.setTabKey("persons")},[urls.j.cohorts()]:()=>{actions.setTabKey("cohorts")}};return urlToAction[urls.j.groups(":key")]=_ref6=>{let{key}=_ref6;actions.setTabKey(`groups-${key}`),actions.setGroupTypeIndex(parseInt(key))},urlToAction})]);function PersonsManagementScene(){let{tabs,activeTab,tabKey}=(0,index_esm.useValues)(personsManagementSceneLogic),{setTabKey}=(0,index_esm.useActions)(personsManagementSceneLogic),{showGroupsOptions}=(0,index_esm.useValues)(groupsModel.$),lemonTabs=tabs.map(tab=>({key:tab.key,label:(0,jsx_runtime.jsx)("span",{"data-attr":`persons-management-${tab.key}-tab`,children:tab.label}),content:tab.content,tooltipDocLink:tab.tooltipDocLink}));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{caption:showGroupsOptions?"A catalog of identified persons, groups, and your created cohorts.":"A catalog of identified persons and your created cohorts.",buttons:activeTab?.buttons}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tabKey,onChange:t=>setTabKey(t),tabs:lemonTabs})]})}let scene={component:PersonsManagementScene,logic:personsManagementSceneLogic}},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/cohorts/Cohorts.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".cohort-recalculating{background-color:var(--bg-primary);border-radius:var(--radius);margin-top:1rem;padding:.5rem 1rem}.cohort-csv-dragger{border-color:var(--accent);border-radius:var(--radius);border-style:dashed;border-width:2px;height:155px!important;margin-top:1rem}.cohort-csv-dragger:hover{border-color:var(--primary-3000-hover)}",""]),module.exports=exports}}]);
//# sourceMappingURL=49174.db41da09.iframe.bundle.js.map