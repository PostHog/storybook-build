(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[5623],{"./frontend/src/scenes/insights/InsightScene.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{InsightScene:function(){return InsightScene},scene:function(){return scene}});var insightSceneLogic=__webpack_require__("./frontend/src/scenes/insights/insightSceneLogic.tsx"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Insight=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/insights/Insight.scss"),Insight_default=__webpack_require__.n(Insight),options={insert:"head",singleton:!1},react=(injectStylesIntoStyleTag_default()(Insight_default(),options),Insight_default().locals,__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js")),insightLogic=__webpack_require__("./frontend/src/scenes/insights/insightLogic.ts"),commandPaletteLogic=__webpack_require__("./frontend/src/lib/components/CommandPalette/commandPaletteLogic.tsx"),compareFilterLogic=__webpack_require__("./frontend/src/lib/components/CompareFilter/compareFilterLogic.ts"),RiseOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/RiseOutlined.js"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),sharedUtils=__webpack_require__("./frontend/src/scenes/insights/sharedUtils.ts"),insightDateFilterLogic=__webpack_require__("./frontend/src/scenes/insights/filters/InsightDateFilter/insightDateFilterLogic.ts");const insightCommandLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)((0,sharedUtils.bk)("new")),(0,index_esm.path)((key=>["scenes","insights","insightCommandLogic",key])),(0,index_esm.connect)((props=>[commandPaletteLogic.M,(0,compareFilterLogic.B)(props),(0,insightDateFilterLogic.u)(props)])),(0,index_esm.events)((_ref=>{let{props:props}=_ref;return{afterMount:()=>{const funnelCommands=[{key:"insight-graph",resolver:[{icon:RiseOutlined.Z,display:'Toggle "Compare Previous" on Graph',executor:()=>{(0,compareFilterLogic.B)(props).actions.toggleCompare()}},...utils.bE.map((_ref2=>{let{key:key,values:values}=_ref2;return{icon:RiseOutlined.Z,display:`Set Time Range to ${key}`,executor:()=>{(0,insightDateFilterLogic.u)(props).actions.setDates(values[0],values[1])}}}))],scope:"insights"}];for(const command of funnelCommands)commandPaletteLogic.M.actions.registerCommand(command)},beforeUnmount:()=>{commandPaletteLogic.M.actions.deregisterScope("insights")}}}))]);var insightDataLogic=__webpack_require__("./frontend/src/scenes/insights/insightDataLogic.ts"),types=__webpack_require__("./frontend/src/types.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip.tsx"),featureFlagLogic=(__webpack_require__("./node_modules/.pnpm/core-js@3.32.0/node_modules/core-js/modules/es.regexp.flags.js"),__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts")),es=__webpack_require__("./node_modules/.pnpm/posthog-js@1.78.5/node_modules/posthog-js/dist/es.js"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),insightVizDataLogic=__webpack_require__("./frontend/src/scenes/insights/insightVizDataLogic.ts"),queries_utils=__webpack_require__("./frontend/src/queries/utils.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts");const funnelsCueLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)((0,sharedUtils.bk)("new")),(0,index_esm.path)((key=>["scenes","insights","InsightTabs","TrendTab","FunnelsCue",key])),(0,index_esm.connect)((props=>({values:[(0,insightLogic.zm)(props),["isFirstLoad"],(0,insightVizDataLogic.Z)(props),["query"],featureFlagLogic.h,["featureFlags"]],actions:[(0,insightVizDataLogic.Z)(props),["setQuery"],featureFlagLogic.h,["setFeatureFlags"]]}))),(0,index_esm.actions)({optOut:userOptedOut=>({userOptedOut:userOptedOut}),setShouldShow:show=>({show:show}),setPermanentOptOut:!0,displayAsFunnel:!0}),(0,index_esm.reducers)({_shouldShow:[!1,{setShouldShow:(_,_ref)=>{let{show:show}=_ref;return show}}],permanentOptOut:[!1,{setPermanentOptOut:()=>!0}]}),(0,index_esm.listeners)((_ref2=>{let{actions:actions,values:values}=_ref2;return{optOut:async _ref3=>{let{userOptedOut:userOptedOut}=_ref3;es.ZP.capture("funnel cue 7301 - terminated",{user_opted_out:userOptedOut}),es.ZP.people.set({funnels_cue_3701_opt_out:!0}),actions.setPermanentOptOut()},setQuery:_ref4=>{let{query:query}=_ref4;(0,queries_utils.KN)(query)&&(!values.isFirstLoad&&(0,queries_utils.kX)(query?.source)&&(query.source.series||[]).length>=3?(actions.setShouldShow(!0),!values.permanentOptOut&&es.ZP.capture("funnel cue 7301 - shown",{step_count:query.source.series.length})):values.shown&&(0,queries_utils.Wl)(query?.source)?actions.optOut(!1):actions.setShouldShow(!1))},setFeatureFlags:async _ref5=>{let{flags:flags}=_ref5;flags[constants.y8.FUNNELS_CUE_OPT_OUT]&&actions.setPermanentOptOut()},displayAsFunnel:()=>{if(!(0,queries_utils.KN)(values.query)||!(0,queries_utils.kX)(values.query?.source))return;const query=JSON.parse(JSON.stringify(values.query));query.source.kind=schema.O.FunnelsQuery,actions.setQuery(query)}}})),(0,index_esm.selectors)({shown:[s=>[s._shouldShow,s.permanentOptOut],(shouldShow,permanentOptout)=>shouldShow&&!permanentOptout]}),(0,index_esm.events)((_ref6=>{let{actions:actions,values:values}=_ref6;return{afterMount:async()=>{values.featureFlags[constants.y8.FUNNELS_CUE_OPT_OUT]&&actions.setPermanentOptOut()}}}))]);var LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function FunnelsCue(){const{insightProps:insightProps}=(0,index_esm.useValues)(insightLogic.zm),{shown:shown}=(0,index_esm.useValues)(funnelsCueLogic(insightProps)),{optOut:optOut,displayAsFunnel:displayAsFunnel}=(0,index_esm.useActions)(funnelsCueLogic(insightProps));return shown?(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",action:{onClick:displayAsFunnel,status:"primary",children:"Try this insight as a funnel"},onClose:()=>optOut(!0),className:"mb-4",children:"Looks like you have multiple events. A funnel can help better visualize your user’s progression across each event."}):null}var SavedInsights=__webpack_require__("./frontend/src/scenes/saved-insights/SavedInsights.tsx"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),insightNavLogic=__webpack_require__("./frontend/src/scenes/insights/InsightNav/insightNavLogic.tsx"),insights_utils=__webpack_require__("./frontend/src/scenes/insights/utils.tsx");function InsightsNav(){const{insightProps:insightProps}=(0,index_esm.useValues)(insightLogic.zm),{activeView:activeView,tabs:tabs}=(0,index_esm.useValues)((0,insightNavLogic.C)(insightProps)),{setActiveView:setActiveView}=(0,index_esm.useActions)((0,insightNavLogic.C)(insightProps));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(FunnelsCue,{}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeView,onChange:newKey=>setActiveView(newKey),tabs:tabs.map((_ref=>{let{label:label,type:type,dataAttr:dataAttr}=_ref;return{key:type,label:(0,jsx_runtime.jsx)(Link.r,{to:insights_utils.Uz[type],preventClick:!0,"data-attr":dataAttr,children:(0,jsx_runtime.jsx)(Tooltip.u,{placement:"top",title:SavedInsights.INSIGHT_TYPES_METADATA[type].description,children:label})})}}))})]})}var LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.tsx");function InsightSkeleton(){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"my-6 space-y-4",children:[(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-1/4"}),(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-1/2",repeat:3}),(0,jsx_runtime.jsx)(LemonSkeleton.y,{}),(0,jsx_runtime.jsxs)("div",{className:"border rounded p-6 flex items-center gap-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1 space-y-2",children:(0,jsx_runtime.jsx)(LemonSkeleton.y.Row,{repeat:3})}),(0,jsx_runtime.jsx)("div",{className:"flex-1 space-y-2",children:(0,jsx_runtime.jsx)(LemonSkeleton.y.Row,{repeat:3})})]}),(0,jsx_runtime.jsx)("div",{className:"border rounded p-6",style:{minHeight:600}})]})})}var Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),EditableField=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonDivider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDivider/index.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),SubscriptionsModal=__webpack_require__("./frontend/src/lib/components/Subscriptions/SubscriptionsModal.tsx"),ExportButton=__webpack_require__("./frontend/src/lib/components/ExportButton/ExportButton.tsx"),dashboardsModel=__webpack_require__("./frontend/src/models/dashboardsModel.tsx");function AddToDashboard(_ref){let{insight:insight,setOpenModal:setOpenModal}=_ref;const{rawDashboards:rawDashboards}=(0,index_esm.useValues)(dashboardsModel.h),dashboards=insight.dashboard_tiles?.map((tile=>rawDashboards[tile.dashboard_id])).filter((d=>!!d))||[];return(0,jsx_runtime.jsx)("span",{className:"save-to-dashboard","data-attr":"save-to-dashboard-button",children:(0,jsx_runtime.jsx)(LemonButton.Jp,{onClick:()=>setOpenModal(!0),type:"secondary",icon:(0,jsx_runtime.jsx)(icons.Xd9,{count:dashboards.length,showZero:!1,children:(0,jsx_runtime.jsx)(icons.Hbl,{})}),children:0===dashboards.length?"Add to dashboard":"Manage dashboards"})})}try{AddToDashboard.displayName="AddToDashboard",AddToDashboard.__docgenInfo={description:"",displayName:"AddToDashboard",props:{insight:{defaultValue:null,description:"",name:"insight",required:!0,type:{name:"Partial<InsightModel>"}},setOpenModal:{defaultValue:null,description:"",name:"setOpenModal",required:!0,type:{name:"(open: boolean) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AddToDashboard/AddToDashboard.tsx#AddToDashboard"]={docgenInfo:AddToDashboard.__docgenInfo,name:"AddToDashboard",path:"frontend/src/lib/components/AddToDashboard/AddToDashboard.tsx#AddToDashboard"})}catch(__react_docgen_typescript_loader_error){}function InsightSaveButton(_ref){let{saveAs:saveAs,saveInsight:saveInsight,isSaved:isSaved,insightSaving:insightSaving,insightChanged:insightChanged,addingToDashboard:addingToDashboard}=_ref;const disabled=isSaved&&!insightChanged,saveAsAvailable=isSaved&&!addingToDashboard;return(0,jsx_runtime.jsx)(LemonButton.QR,{type:"primary",onClick:()=>saveInsight(!0),"data-attr":"insight-save-button",disabled:disabled,loading:!disabled&&insightSaving,sideAction:{dropdown:{placement:"bottom-end",overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!disabled&&(0,jsx_runtime.jsxs)(LemonButton.Jp,{onClick:()=>saveInsight(!1),"data-attr":"insight-save-and-continue",status:"stealth",fullWidth:!0,children:[addingToDashboard?"Save, add to dashboard":"Save"," & continue editing"]}),saveAsAvailable&&(0,jsx_runtime.jsx)(LemonButton.Jp,{onClick:saveAs,"data-attr":"insight-save-as-new-insight",status:"stealth",fullWidth:!0,children:"Save as…"})]})},disabled:disabled&&!saveAsAvailable,"data-attr":"insight-save-dropdown"},children:disabled?"No changes to be saved":addingToDashboard?"Save & add to dashboard":"Save"})}try{InsightSaveButton.displayName="InsightSaveButton",InsightSaveButton.__docgenInfo={description:"",displayName:"InsightSaveButton",props:{saveAs:{defaultValue:null,description:"",name:"saveAs",required:!0,type:{name:"() => void"}},saveInsight:{defaultValue:null,description:"",name:"saveInsight",required:!0,type:{name:"(redirectToViewMode?: boolean | undefined) => void"}},isSaved:{defaultValue:null,description:"",name:"isSaved",required:!0,type:{name:"boolean | undefined"}},insightSaving:{defaultValue:null,description:"",name:"insightSaving",required:!0,type:{name:"boolean"}},insightChanged:{defaultValue:null,description:"",name:"insightChanged",required:!0,type:{name:"boolean"}},addingToDashboard:{defaultValue:null,description:"",name:"addingToDashboard",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/insights/InsightSaveButton.tsx#InsightSaveButton"]={docgenInfo:InsightSaveButton.__docgenInfo,name:"InsightSaveButton",path:"frontend/src/scenes/insights/InsightSaveButton.tsx#InsightSaveButton"})}catch(__react_docgen_typescript_loader_error){}var ObjectTags=__webpack_require__("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),UserActivityIndicator=__webpack_require__("./frontend/src/lib/components/UserActivityIndicator/UserActivityIndicator.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),savedInsightsLogic=__webpack_require__("./frontend/src/scenes/saved-insights/savedInsightsLogic.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),groupsModel=__webpack_require__("./frontend/src/models/groupsModel.ts"),cohortsModel=__webpack_require__("./frontend/src/models/cohortsModel.ts"),mathsLogic=__webpack_require__("./frontend/src/scenes/trends/mathsLogic.tsx"),tagsModel=__webpack_require__("./frontend/src/models/tagsModel.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),SharingModal=__webpack_require__("./frontend/src/lib/components/Sharing/SharingModal.tsx"),summarizeInsight=__webpack_require__("./frontend/src/scenes/insights/summarizeInsight.ts"),eventUsageLogic=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts"),newDashboardLogic=__webpack_require__("./frontend/src/scenes/dashboard/newDashboardLogic.ts"),fuse_esm=__webpack_require__("./node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),lemonToast=__webpack_require__("./frontend/src/lib/lemon-ui/lemonToast.tsx");const addToDashboardModalLogic=(0,index_esm.kea)({path:["lib","components","AddToDashboard","saveToDashboardModalLogic"],props:{},key:_ref=>{let{insight:insight}=_ref;if(!insight.short_id)throw Error("must provide an insight with a short id");return insight.short_id},connect:props=>({actions:[(0,insightLogic.zm)({dashboardItemId:props.insight.short_id,cachedInsight:props.insight}),["updateInsight","updateInsightSuccess","updateInsightFailure"],eventUsageLogic.vx,["reportSavedInsightToDashboard","reportRemovedInsightFromDashboard","reportCreatedDashboardFromModal"],newDashboardLogic.Z,["showNewDashboardModal"]]}),actions:{addNewDashboard:!0,setDashboardId:id=>({id:id}),setSearchQuery:query=>({query:query}),setInsight:insight=>({insight:insight}),setScrollIndex:index=>({index:index}),addToDashboard:(insight,dashboardId)=>({insight:insight,dashboardId:dashboardId}),removeFromDashboard:(insight,dashboardId)=>({insight:insight,dashboardId:dashboardId})},reducers:{_dashboardId:[null,{setDashboardId:(_,_ref2)=>{let{id:id}=_ref2;return id}}],searchQuery:["",{setSearchQuery:(_,_ref3)=>{let{query:query}=_ref3;return query}}],scrollIndex:[-1,{setScrollIndex:(_,_ref4)=>{let{index:index}=_ref4;return index}}],dashboardWithActiveAPICall:[null,{addToDashboard:(_,_ref5)=>{let{dashboardId:dashboardId}=_ref5;return dashboardId},removeFromDashboard:(_,_ref6)=>{let{dashboardId:dashboardId}=_ref6;return dashboardId},updateInsightSuccess:()=>null,updateInsightFailure:()=>null}]},selectors:{dashboardId:[s=>[s._dashboardId,dashboardsModel.h.selectors.lastDashboardId,dashboardsModel.h.selectors.nameSortedDashboards,(_,props)=>props.fromDashboard],(_dashboardId,lastDashboardId,dashboards,fromDashboard)=>_dashboardId||fromDashboard||lastDashboardId||(dashboards.length>0?dashboards[0].id:null)],dashboardsFuse:[()=>[dashboardsModel.h.selectors.nameSortedDashboards],nameSortedDashboards=>new fuse_esm.Z(nameSortedDashboards||[],{keys:["name","description","tags"],threshold:.3})],filteredDashboards:[s=>[s.searchQuery,s.dashboardsFuse,dashboardsModel.h.selectors.nameSortedDashboards],(searchQuery,dashboardsFuse,nameSortedDashboards)=>searchQuery.length?dashboardsFuse.search(searchQuery).map((r=>r.item)):nameSortedDashboards],currentDashboards:[(s,p)=>[s.filteredDashboards,p.insight],(filteredDashboards,insight)=>filteredDashboards.filter((d=>insight.dashboard_tiles?.map((dt=>dt.dashboard_id))?.includes(d.id)))],availableDashboards:[s=>[s.filteredDashboards,s.currentDashboards],(filteredDashboards,currentDashboards)=>filteredDashboards.filter((d=>!currentDashboards?.map((cd=>cd.id)).includes(d.id)))],orderedDashboards:[s=>[s.currentDashboards,s.availableDashboards],(currentDashboards,availableDashboards)=>[...currentDashboards,...availableDashboards]]},listeners:_ref7=>{let{actions:actions,values:values,props:props}=_ref7;return{setDashboardId:_ref8=>{let{id:id}=_ref8;dashboardsModel.h.actions.setLastDashboardId(id)},addNewDashboard:async()=>{actions.showNewDashboardModal()},[dashboardsModel.h.actionTypes.addDashboardSuccess]:async _ref9=>{let{dashboard:dashboard}=_ref9;actions.reportCreatedDashboardFromModal(),actions.setDashboardId(dashboard.id),actions.addToDashboard(props.insight,dashboard.id),actions.setScrollIndex(values.orderedDashboards.findIndex((d=>d.id===dashboard.id)))},addToDashboard:async _ref10=>{let{insight:insight,dashboardId:dashboardId}=_ref10;actions.updateInsight({...insight,dashboards:[...insight.dashboards||[],dashboardId]},(()=>{actions.reportSavedInsightToDashboard(),dashboardsModel.h.actions.tileAddedToDashboard(dashboardId),lemonToast.UJ.success("Insight added to dashboard",{button:{label:"View dashboard",action:()=>lib.router.actions.push(urls.j.dashboard(dashboardId))}})}))},removeFromDashboard:async _ref11=>{let{insight:insight,dashboardId:dashboardId}=_ref11;actions.updateInsight({...insight,dashboards:(insight.dashboards||[]).filter((d=>d!==dashboardId)),dashboard_tiles:(insight.dashboard_tiles||[]).filter((dt=>dt.dashboard_id!==dashboardId))},(()=>{actions.reportRemovedInsightFromDashboard(),lemonToast.UJ.success("Insight removed from dashboard")}))}}}});var AddToDashboard_AddToDashboard=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/lib/components/AddToDashboard/AddToDashboard.scss"),AddToDashboard_default=__webpack_require__.n(AddToDashboard_AddToDashboard),AddToDashboard_options={insert:"head",singleton:!1},LemonInput=(injectStylesIntoStyleTag_default()(AddToDashboard_default(),AddToDashboard_options),AddToDashboard_default().locals,__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx")),List=__webpack_require__("./node_modules/.pnpm/react-virtualized@9.22.5_react-dom@16.14.0_react@16.14.0/node_modules/react-virtualized/dist/es/List/index.js"),AutoSizer=__webpack_require__("./node_modules/.pnpm/react-virtualized@9.22.5_react-dom@16.14.0_react@16.14.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts");const DashboardRelationRow=_ref=>{let{style:style,isHighlighted:isHighlighted,isAlreadyOnDashboard:isAlreadyOnDashboard,dashboard:dashboard,insight:insight,canEditInsight:canEditInsight}=_ref;const logic=addToDashboardModalLogic({insight:insight,fromDashboard:insight.dashboards?.[0]||void 0}),{addToDashboard:addToDashboard,removeFromDashboard:removeFromDashboard}=(0,index_esm.useActions)(logic),{dashboardWithActiveAPICall:dashboardWithActiveAPICall}=(0,index_esm.useValues)(logic),{currentTeam:currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),isPrimary=dashboard.id===currentTeam?.primary_dashboard;return(0,jsx_runtime.jsxs)("div",{"data-attr":"dashboard-list-item",style:style,className:(0,clsx_m.default)("flex items-center space-x-2",isHighlighted&&"highlighted"),children:[(0,jsx_runtime.jsx)(Link.r,{to:urls.j.dashboard(dashboard.id),className:"overflow-hidden text-ellipsis whitespace-nowrap",title:dashboard.name,children:dashboard.name||"Untitled"}),isPrimary&&(0,jsx_runtime.jsx)(Tooltip.u,{title:"Primary dashboards are shown on the project home page",children:(0,jsx_runtime.jsx)(icons.Bhv,{className:"text-warning text-base"})}),(0,jsx_runtime.jsx)("span",{className:"grow"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"secondary",status:isAlreadyOnDashboard?"danger":"primary",loading:dashboardWithActiveAPICall===dashboard.id,disabledReason:canEditInsight?dashboardWithActiveAPICall?"Loading...":"":"You don't have permission to edit this dashboard",size:"small",onClick:e=>{e.preventDefault(),isAlreadyOnDashboard?removeFromDashboard(insight,dashboard.id):addToDashboard(insight,dashboard.id)},children:isAlreadyOnDashboard?"Remove from dashboard":"Add to dashboard"})]})};function AddToDashboardModal(_ref2){let{isOpen:isOpen,closeModal:closeModal,insight:insight,canEditInsight:canEditInsight}=_ref2;const logic=addToDashboardModalLogic({insight:insight,fromDashboard:insight.dashboards?.[0]||void 0}),{searchQuery:searchQuery,currentDashboards:currentDashboards,orderedDashboards:orderedDashboards,scrollIndex:scrollIndex}=(0,index_esm.useValues)(logic),{setSearchQuery:setSearchQuery,addNewDashboard:addNewDashboard}=(0,index_esm.useActions)(logic),renderItem=_ref3=>{let{index:rowIndex,style:style}=_ref3;return(0,jsx_runtime.jsx)(DashboardRelationRow,{dashboard:orderedDashboards[rowIndex],insight:insight,canEditInsight:canEditInsight,isHighlighted:rowIndex===scrollIndex,isAlreadyOnDashboard:currentDashboards.some((currentDashboard=>currentDashboard.id===orderedDashboards[rowIndex].id)),style:style},rowIndex)};return(0,jsx_runtime.jsx)(LemonModal.f,{onClose:closeModal,isOpen:isOpen,title:"Add to dashboard",footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"secondary",onClick:addNewDashboard,disabledReason:canEditInsight?void 0:"You do not have permission to add this Insight to dashboards",children:"Add to a new dashboard"})}),(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"secondary",onClick:closeModal,children:"Close"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-2 w-md max-w-full",children:[(0,jsx_runtime.jsx)(LemonInput.D,{"data-attr":"dashboard-searchfield",type:"search",fullWidth:!0,placeholder:"Search for dashboards...",value:searchQuery,onChange:newValue=>setSearchQuery(newValue)}),(0,jsx_runtime.jsxs)("div",{className:"text-muted-alt",children:["This insight is referenced on"," ",(0,jsx_runtime.jsx)("strong",{className:"text-default",children:insight.dashboard_tiles?.length})," ",(0,utils._6)(insight.dashboard_tiles?.length||0,"dashboard","dashboards",!1)]}),(0,jsx_runtime.jsx)("div",{style:{minHeight:420},children:(0,jsx_runtime.jsx)(AutoSizer.q,{children:_ref4=>{let{height:height,width:width}=_ref4;return(0,jsx_runtime.jsx)(List.aV,{width:width,height:height,rowCount:orderedDashboards.length,overscanRowCount:100,rowHeight:40,rowRenderer:renderItem,scrollToIndex:scrollIndex})}})})]})})}try{AddToDashboardModal.displayName="AddToDashboardModal",AddToDashboardModal.__docgenInfo={description:"",displayName:"AddToDashboardModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},closeModal:{defaultValue:null,description:"",name:"closeModal",required:!0,type:{name:"() => void"}},insight:{defaultValue:null,description:"",name:"insight",required:!0,type:{name:"Partial<InsightModel>"}},canEditInsight:{defaultValue:null,description:"",name:"canEditInsight",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AddToDashboard/AddToDashboardModal.tsx#AddToDashboardModal"]={docgenInfo:AddToDashboardModal.__docgenInfo,name:"AddToDashboardModal",path:"frontend/src/lib/components/AddToDashboard/AddToDashboardModal.tsx#AddToDashboardModal"})}catch(__react_docgen_typescript_loader_error){}var NewDashboardModal=__webpack_require__("./frontend/src/scenes/dashboard/NewDashboardModal.tsx");function InsightPageHeader(_ref){var _insight$tags;let{insightLogicProps:insightLogicProps}=_ref;const{insightMode:insightMode,subscriptionId:subscriptionId}=(0,index_esm.useValues)(insightSceneLogic.T),{setInsightMode:setInsightMode}=(0,index_esm.useActions)(insightSceneLogic.T),logic=(0,insightLogic.zm)(insightLogicProps),{insightProps:insightProps,filters:filters,canEditInsight:canEditInsight,insight:insight,insightChanged:insightChanged,insightSaving:insightSaving,hasDashboardItemId:hasDashboardItemId,exporterResourceParams:exporterResourceParams}=(0,index_esm.useValues)(logic),{setInsightMetadata:setInsightMetadata,saveAs:saveAs}=(0,index_esm.useActions)(logic),{duplicateInsight:duplicateInsight,loadInsights:loadInsights}=(0,index_esm.useActions)(savedInsightsLogic.w),{query:query,queryChanged:queryChanged,showQueryEditor:showQueryEditor}=(0,index_esm.useValues)((0,insightDataLogic.S)(insightProps)),{saveInsight:saveQueryBasedInsight,toggleQueryEditorPanel:toggleQueryEditorPanel}=(0,index_esm.useActions)((0,insightDataLogic.S)(insightProps));(0,index_esm.useMountedLogic)(insightCommandLogic(insightProps));const{hasAvailableFeature:hasAvailableFeature}=(0,index_esm.useValues)(userLogic.userLogic),{aggregationLabel:aggregationLabel}=(0,index_esm.useValues)(groupsModel.$),{cohortsById:cohortsById}=(0,index_esm.useValues)(cohortsModel.Q),{mathDefinitions:mathDefinitions}=(0,index_esm.useValues)(mathsLogic.fx),{tags:tags}=(0,index_esm.useValues)(tagsModel.x),{currentTeamId:currentTeamId}=(0,index_esm.useValues)(teamLogic.teamLogic),{push:push}=(0,index_esm.useActions)(lib.router),[addToDashboardModalOpen,setAddToDashboardModalOpenModal]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[hasDashboardItemId&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SubscriptionsModal.r,{isOpen:insightMode===types.LO.Subscriptions,closeModal:()=>push(urls.j.insightView(insight.short_id)),insightShortId:insight.short_id,subscriptionId:subscriptionId}),(0,jsx_runtime.jsx)(SharingModal.PA,{title:"Insight Sharing",isOpen:insightMode===types.LO.Sharing,closeModal:()=>push(urls.j.insightView(insight.short_id)),insightShortId:insight.short_id,insight:insight,previewIframe:!0}),(0,jsx_runtime.jsx)(AddToDashboardModal,{isOpen:addToDashboardModalOpen,closeModal:()=>setAddToDashboardModalOpenModal(!1),insight:insight,canEditInsight:canEditInsight}),(0,jsx_runtime.jsx)(NewDashboardModal.OI,{})]}),(0,jsx_runtime.jsx)(PageHeader.m,{title:(0,jsx_runtime.jsx)(EditableField.f,{name:"name",value:insight.name||"",placeholder:(0,summarizeInsight.t)(query,filters,{aggregationLabel:aggregationLabel,cohortsById:cohortsById,mathDefinitions:mathDefinitions}),onSave:value=>setInsightMetadata({name:value}),saveOnBlur:!0,maxLength:400,mode:canEditInsight?void 0:"view","data-attr":"insight-name",notice:canEditInsight?void 0:{icon:(0,jsx_runtime.jsx)(icons._V1,{}),tooltip:"You don't have edit permissions on any of the dashboards this insight belongs to. Ask a dashboard collaborator with edit access to add you."}}),buttons:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[hasDashboardItemId&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",onClick:()=>duplicateInsight(insight,!0),fullWidth:!0,"data-attr":"duplicate-insight-from-insight-view",children:"Duplicate"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",onClick:()=>setInsightMetadata({favorited:!insight.favorited}),fullWidth:!0,children:insight.favorited?"Remove from favorites":"Add to favorites"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",onClick:()=>setAddToDashboardModalOpenModal(!0),fullWidth:!0,children:"Add to dashboard"}),(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",onClick:()=>insight.short_id?push(urls.j.insightSharing(insight.short_id)):null,fullWidth:!0,children:"Share or embed"}),insight.short_id&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SubscriptionsModal.T,{insightShortId:insight.short_id}),exporterResourceParams?(0,jsx_runtime.jsx)(ExportButton.j,{fullWidth:!0,items:[{export_format:types.P5.PNG,insight:insight.id},{export_format:types.P5.CSV,export_context:exporterResourceParams}]}):null,(0,queries_utils.KN)(query)?(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",onClick:()=>{hasDashboardItemId&&insightMode!==types.LO.Edit&&(setInsightMode(types.LO.Edit,null),!1!==showQueryEditor)||toggleQueryEditorPanel()},fullWidth:!0,children:showQueryEditor?"Hide source":"View source"}):null,(0,jsx_runtime.jsx)(LemonDivider.p,{})]}),(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"danger",onClick:()=>(0,utils.S5)({object:insight,endpoint:`projects/${currentTeamId}/insights`,callback:()=>{loadInsights(),push(urls.j.savedInsights())}}),fullWidth:!0,children:"Delete insight"})]})}),(0,jsx_runtime.jsx)(LemonDivider.p,{vertical:!0})]}),insightMode===types.LO.Edit&&hasDashboardItemId&&(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"secondary",onClick:()=>setInsightMode(types.LO.View,null),children:"Cancel"}),insightMode!==types.LO.Edit&&hasDashboardItemId&&(0,jsx_runtime.jsx)(AddToDashboard,{insight:insight,setOpenModal:setAddToDashboardModalOpenModal}),insightMode!==types.LO.Edit?canEditInsight&&(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"primary",onClick:()=>setInsightMode(types.LO.Edit,null),"data-attr":"insight-edit-button",children:"Edit"}):(0,jsx_runtime.jsx)(InsightSaveButton,{saveAs:saveAs,saveInsight:saveQueryBasedInsight,isSaved:hasDashboardItemId,addingToDashboard:!!insight.dashboards?.length&&!insight.id,insightSaving:insightSaving,insightChanged:insightChanged||queryChanged})]}),caption:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!(!canEditInsight&&!insight.description)&&(0,jsx_runtime.jsx)(EditableField.f,{multiline:!0,name:"description",value:insight.description||"",placeholder:"Description (optional)",onSave:value=>setInsightMetadata({description:value}),saveOnBlur:!0,maxLength:400,mode:canEditInsight?void 0:"view","data-attr":"insight-description",compactButtons:!0,paywall:!hasAvailableFeature(types.P$.DASHBOARD_COLLABORATION)}),canEditInsight?(0,jsx_runtime.jsx)(ObjectTags.D,{tags:null!==(_insight$tags=insight.tags)&&void 0!==_insight$tags?_insight$tags:[],saving:insightSaving,onChange:(_,tags)=>setInsightMetadata({tags:null!=tags?tags:[]}),tagsAvailable:tags,className:"insight-metadata-tags","data-attr":"insight-tags"}):insight.tags?.length?(0,jsx_runtime.jsx)(ObjectTags.D,{tags:insight.tags,saving:insightSaving,className:"insight-metadata-tags","data-attr":"insight-tags",staticOnly:!0}):null,(0,jsx_runtime.jsx)(UserActivityIndicator.F,{at:insight.last_modified_at,by:insight.last_modified_by,className:"mt-2"})]}),tabbedPage:insightMode===types.LO.Edit})]})}try{InsightPageHeader.displayName="InsightPageHeader",InsightPageHeader.__docgenInfo={description:"",displayName:"InsightPageHeader",props:{insightLogicProps:{defaultValue:null,description:"",name:"insightLogicProps",required:!0,type:{name:"InsightLogicProps"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/insights/InsightPageHeader.tsx#InsightPageHeader"]={docgenInfo:InsightPageHeader.__docgenInfo,name:"InsightPageHeader",path:"frontend/src/scenes/insights/InsightPageHeader.tsx#InsightPageHeader"})}catch(__react_docgen_typescript_loader_error){}function Insight_Insight(_ref){let{insightId:insightId}=_ref;const{insightMode:insightMode,insight:insight}=(0,index_esm.useValues)(insightSceneLogic.T),logic=(0,insightLogic.zm)({dashboardItemId:insightId||"new",cachedInsight:insight?.short_id===insightId?insight:null}),{insightProps:insightProps,insightLoading:insightLoading,filtersKnown:filtersKnown}=(0,index_esm.useValues)(logic),{reportInsightViewedForRecentInsights:reportInsightViewedForRecentInsights}=(0,index_esm.useActions)(logic),{query:query,isQueryBasedInsight:isQueryBasedInsight,showQueryEditor:showQueryEditor}=(0,index_esm.useValues)((0,insightDataLogic.S)(insightProps));if((0,index_esm.useMountedLogic)(insightCommandLogic(insightProps)),(0,react.useEffect)((()=>{reportInsightViewedForRecentInsights()}),[insightId]),"new"!==insightId&&insightLoading&&!filtersKnown)return(0,jsx_runtime.jsx)(InsightSkeleton,{});const actuallyShowQueryEditor=insightMode===types.LO.Edit&&(isQueryBasedInsight&&!(0,queries_utils.KJ)(query)||!isQueryBasedInsight&&showQueryEditor);return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:insightLogic.zm,props:insightProps,children:(0,jsx_runtime.jsxs)("div",{className:"insights-page",children:[(0,jsx_runtime.jsx)(InsightPageHeader,{insightLogicProps:insightProps}),insightMode===types.LO.Edit&&(0,jsx_runtime.jsx)(InsightsNav,{}),(0,jsx_runtime.jsx)(Query.A,{query:(0,queries_utils.KN)(query)?{...query,full:!0}:query,readOnly:insightMode!==types.LO.Edit,context:{showOpenEditorButton:!1,showQueryEditor:actuallyShowQueryEditor,showQueryHelp:insightMode===types.LO.Edit&&!(0,queries_utils.KJ)(query),insightProps:insightProps}})]})})}try{Insight_Insight.displayName="Insight",Insight_Insight.__docgenInfo={description:"",displayName:"Insight",props:{insightId:{defaultValue:null,description:"",name:"insightId",required:!0,type:{name:'"new" | InsightShortId'}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/insights/Insight.tsx#Insight"]={docgenInfo:Insight_Insight.__docgenInfo,name:"Insight",path:"frontend/src/scenes/insights/Insight.tsx#Insight"})}catch(__react_docgen_typescript_loader_error){}var NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx");function InsightScene(){const{insightId:insightId,insight:insight,insightLogicRef:insightLogicRef}=(0,index_esm.useValues)(insightSceneLogic.T);return"new"===insightId||insightId&&insight?.id&&insight?.short_id?(0,jsx_runtime.jsx)(Insight_Insight,{insightId:insightId}):insightLogicRef?.logic?.values?.insightLoading?(0,jsx_runtime.jsx)(InsightSkeleton,{}):(0,jsx_runtime.jsx)(NotFound.T,{object:"insight"})}const scene={component:InsightScene,logic:insightSceneLogic.T}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/lib/components/AddToDashboard/AddToDashboard.scss":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,"",""]),module.exports=exports},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/insights/Insight.scss":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".insights-page .insight-wrapper.insight-wrapper--singlecolumn{position:relative}@media screen and (min-width:1200px){.insights-page .insight-wrapper.insight-wrapper--singlecolumn{display:flex;overflow:hidden}.insights-page .insight-wrapper.insight-wrapper--singlecolumn .insights-container{flex:1;overflow-x:auto}}.insights-page .insights-graph-container{margin-bottom:1rem}.insights-page .insights-graph-container .ant-card-head{border-bottom:1px solid var(--border);min-height:unset;background-color:var(--bg-light);padding-left:1rem;padding-right:1rem}.insights-page .insights-graph-container .ant-card-body,.insights-page .insights-graph-container .ant-card-head .ant-card-head-title{padding:0}.insights-page .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left{width:100%}.insights-page .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right{height:min(90vh - 16rem,36rem);max-width:45%;min-width:300px;width:-moz-fit-content;width:fit-content;padding:0 1rem 1rem 0;display:flex;align-items:center}.insights-page .insights-graph-container .LineGraph{width:calc(100% - 3rem);height:calc(100% - 3rem)}.insights-page .insight-title-container{display:flex;align-items:center}.insights-page .insight-title-container .insight-title-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.insights-page .retention-date-picker{background-color:transparent;border:0}.insights-page .retention-date-picker input::-moz-placeholder{color:var(--default)}.insights-page .retention-date-picker input::placeholder{color:var(--default)}.insights-page .insights-graph-header{margin-top:0!important;margin-bottom:0!important;padding-left:1rem;padding-right:1rem;min-height:48px}.insight-metadata-tags{margin-top:.5rem}.insight-metadata-tags .ant-tag{margin-top:0}",""]),module.exports=exports}}]);