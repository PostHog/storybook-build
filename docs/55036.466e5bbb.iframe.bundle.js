"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[55036],{"../../products/messaging/frontend/MessagingScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MessagingScene:()=>MessagingScene,messagingSceneLogic:()=>messagingSceneLogic,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.26.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),useFeatureFlag=__webpack_require__("../../frontend/src/lib/hooks/useFeatureFlag.ts"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let campaignsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","campaignsLogic"]),(0,index_esm.actions)({deleteCampaign:campaign=>({campaign}),loadCampaigns:()=>({})}),(0,kea_loaders_lib.loaders)(_ref=>{let{values}=_ref;return{campaigns:[[],{loadCampaigns:async()=>(await api.ZP.hogFlows.getHogFlows()).results,deleteCampaign:async _ref2=>{let{campaign}=_ref2;return await api.ZP.hogFlows.deleteHogFlow(campaign.id),values.campaigns.filter(c=>c.id!==campaign.id)}}]}}),(0,index_esm.afterMount)(_ref3=>{let{actions}=_ref3;actions.loadCampaigns()})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function CampaignsTable(){(0,index_esm.useMountedLogic)(campaignsLogic);let{campaigns,campaignsLoading}=(0,index_esm.useValues)(campaignsLogic),{deleteCampaign}=(0,index_esm.useActions)(campaignsLogic),columns=[{title:"Name",render:(_,item)=>(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.messagingCampaign(item.id),title:item.name,description:item.status})},{title:"Status",render:(_,item)=>(0,jsx_runtime.jsx)(src.oe,{type:"active"===item.status?"success":"default",children:(0,utils.fm)(item.status)})},{width:0,render:function Render(_,campaign){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"campaign-delete",fullWidth:!0,status:"danger",onClick:()=>deleteCampaign(campaign),children:"Delete"})})})}}];return(0,jsx_runtime.jsx)("div",{className:"campaigns-section",children:(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:campaigns,loading:campaignsLoading,columns:columns})})}var LemonMenu=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/index.ts"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),UserActivityIndicator=__webpack_require__("../../frontend/src/lib/components/UserActivityIndicator/UserActivityIndicator.tsx"),kea_forms_lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),integrationsLogic=__webpack_require__("../../frontend/src/lib/integrations/integrationsLogic.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts");let emailSetupModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","EmailSetup","emailSetupModalLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{integration}=_ref;return integration?`messaging-sender-setup-${integration.id}`:"messaging-sender-setup-new"}),(0,index_esm.connect)(()=>({values:[integrationsLogic.a,["integrations","integrationsLoading"]],actions:[integrationsLogic.a,["loadIntegrations"]]})),(0,kea_forms_lib.forms)(_ref2=>{let{actions}=_ref2;return{emailSender:{defaults:{domain:""},errors:_ref3=>{let domainError,{domain}=_ref3;return domain||(domainError="Domain is required"),/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(domain)||(domainError="Invalid domain format"),{domain:domainError}},submit:async()=>{actions.submitDomain()}}}}),(0,kea_loaders_lib.loaders)(_ref4=>{let{actions,values}=_ref4;return{integration:{submitDomain:async()=>{let integration=await api.ZP.integrations.create({kind:"email",config:{domain:values.emailSender.domain}});return actions.loadIntegrations(),integration},setIntegration:integration=>integration},verification:{verifyDomain:async()=>api.ZP.integrations.verifyEmail(values.integration.id)}}}),(0,index_esm.selectors)({dnsRecords:[s=>[s.verification],verification=>verification?.status||null]}),(0,index_esm.listeners)(_ref5=>{let{props,values,actions}=_ref5;return{setIntegrationSuccess:()=>{actions.verifyDomain()},submitDomainSuccess:()=>{actions.verifyDomain()},verifyDomainSuccess:_ref6=>{let{verification}=_ref6;"success"===verification.status&&(LemonToast.U.success("Domain verified successfully!"),actions.loadIntegrations(),props.onComplete(values.integration.id))}}}),(0,index_esm.afterMount)(_ref7=>{let{props,actions}=_ref7;props.integration&&actions.setIntegration(props.integration)})]),EmailSetupModal=props=>{let{integration,integrationLoading,verification,verificationLoading}=(0,index_esm.useValues)(emailSetupModalLogic(props)),{verifyDomain,submitEmailSender}=(0,index_esm.useActions)(emailSetupModalLogic(props)),modalContent=(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});return modalContent=integration?(0,jsx_runtime.jsxs)("div",{className:"space-y-2 max-w-[60rem]",children:[(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted",children:"These DNS records verify ownership of your domain. This ensures your emails are delivered to inboxes and not marked as spam."}),(0,jsx_runtime.jsx)("p",{className:"font-semibold mb-2",children:"Note: It can take up to 48 hours for DNS changes to propagate."}),(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto",children:(0,jsx_runtime.jsxs)("table",{className:"w-full border-collapse",children:[(0,jsx_runtime.jsx)("thead",{children:(0,jsx_runtime.jsxs)("tr",{className:"border-b",children:[(0,jsx_runtime.jsx)("th",{className:"py-2 text-left",children:"Type"}),(0,jsx_runtime.jsx)("th",{className:"py-2 text-left",children:"Hostname"}),(0,jsx_runtime.jsx)("th",{className:"py-2 text-left",children:"Value"}),(0,jsx_runtime.jsx)("th",{className:"py-2 text-left",children:"Status"})]})}),(0,jsx_runtime.jsx)("tbody",{children:verification?.dnsRecords?.map((record,index)=>jsx_runtime.jsxs("tr",{className:"border-b",children:[jsx_runtime.jsx("td",{className:"py-2",children:record.recordType}),jsx_runtime.jsx("td",{className:"py-2 max-w-[8rem]",children:jsx_runtime.jsxs("div",{className:"flex items-center gap-1 text-wrap break-all justify-between",children:[jsx_runtime.jsx("span",{children:record.recordHostname}),jsx_runtime.jsx(src.Jp,{size:"small",icon:jsx_runtime.jsx(posthog_icons_es.IconCopy,{}),onClick:()=>{navigator.clipboard.writeText(record.recordHostname),src.UJ.success("Hostname copied to clipboard")},tooltip:"Copy hostname"})]})}),jsx_runtime.jsx("td",{className:"py-2 max-w-[8rem]",children:jsx_runtime.jsxs("div",{className:"flex items-center gap-1 text-wrap break-all justify-between",children:[jsx_runtime.jsx("span",{children:record.recordValue}),jsx_runtime.jsx(src.Jp,{size:"small",icon:jsx_runtime.jsx(posthog_icons_es.IconCopy,{}),onClick:()=>{navigator.clipboard.writeText(record.recordValue),src.UJ.success("Value copied to clipboard")},tooltip:"Copy value"})]})}),jsx_runtime.jsx("td",{className:"py-2 w-[10rem]",children:verificationLoading?jsx_runtime.jsx(src.$j,{className:"text-lg"}):"pending"===record.status?jsx_runtime.jsxs("div",{className:"flex items-center gap-1",children:[jsx_runtime.jsx(posthog_icons_es.IconWarning,{className:"size-6 text-warning"})," Not present"]}):jsx_runtime.jsxs("div",{className:"flex items-center gap-1",children:[jsx_runtime.jsx(posthog_icons_es.IconCheckCircle,{className:"size-6 text-success"})," Verified"]})})]},index))})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:verifyDomain,disabledReason:verificationLoading?"Verifying...":void 0,loading:verificationLoading,children:"Verify DNS records"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>props.onComplete(integration.id),tooltip:"You will not be able to send emails until you verify the DNS records",children:"Finish later"})]})]}):(0,jsx_runtime.jsx)(kea_forms_lib.Form,{logic:emailSetupModalLogic,formKey:"emailSender",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"domain",label:"Domain",children:(0,jsx_runtime.jsx)(src.DF,{type:"text",placeholder:"example.com",disabled:integrationLoading})}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(src.Jp,{type:"primary",htmlType:"submit",disabledReason:integrationLoading?"Creating sender domain...":void 0,loading:integrationLoading,onClick:submitEmailSender,children:"Continue"})})]})}),(0,jsx_runtime.jsx)(src.fQ,{title:"Configure email sender domain",width:"auto",onClose:props.onComplete,children:modalContent})};var icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts");let slackSetupModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","SlackSetup","slackSetupModalLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(()=>({values:[integrationsLogic.a,["integrations","integrationsLoading","slackAvailable"],userLogic.userLogic,["user"]],actions:[integrationsLogic.a,["loadIntegrations"]]})),(0,kea_forms_lib.forms)(_ref=>{let{props,actions,values}=_ref;return{slackIntegration:{defaults:{botToken:"",channelId:""},errors:_ref2=>{let{botToken,channelId}=_ref2;return{botToken:botToken?void 0:"Bot Token is required",channelId:channelId?void 0:"Channel ID is required"}},submit:async()=>{try{let integration=await api.ZP.integrations.create({kind:"slack",config:{bot_token:values.slackIntegration.botToken,channel_id:values.slackIntegration.channelId}});actions.loadIntegrations(),LemonToast.U.success("Slack integration created successfully!"),props.onComplete(integration.id)}catch(error){throw LemonToast.U.error("Failed to create Slack integration"),error}}}}})]),SlackSetupModal=props=>{let logic=slackSetupModalLogic(props),{slackAvailable}=(0,index_esm.useValues)(logic);return(0,jsx_runtime.jsx)(src.fQ,{title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(icons.gx,{}),(0,jsx_runtime.jsx)("span",{children:"Configure Slack integration"})]}),onClose:()=>props.onComplete(),footer:(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>props.onComplete(),children:"Close"})}),children:(0,jsx_runtime.jsx)("div",{className:"max-w-[400px]",children:slackAvailable?(0,jsx_runtime.jsx)(src.rU,{to:api.ZP.integrations.authorizeUrl({kind:"slack"}),disableClientSideRouting:!0,children:(0,jsx_runtime.jsx)("img",{alt:"Connect to Slack workspace",height:"40",width:"139",src:"https://platform.slack-edge.com/img/add_to_slack.png",srcSet:"https://platform.slack-edge.com/img/add_to_slack.png 1x, https://platform.slack-edge.com/img/add_to_slack@2x.png 2x"})}):(0,jsx_runtime.jsx)("p",{className:"text-secondary",children:"This PostHog instance is not configured for Slack. Please contact the instance owner to configure it."})})})};var zod_lib=__webpack_require__("../../node_modules/.pnpm/zod@3.24.1/node_modules/zod/lib/index.mjs");let twilioSetupModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","TwilioSetup","twilioSetupModalLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(()=>({values:[integrationsLogic.a,["integrations","integrationsLoading"]],actions:[integrationsLogic.a,["loadIntegrations"]]})),(0,kea_forms_lib.forms)(_ref=>{let{props,actions,values}=_ref;return{twilioIntegration:{defaults:{accountSid:"",authToken:"",phoneNumber:""},errors:_ref2=>{let{accountSid,authToken,phoneNumber}=_ref2;return{accountSid:accountSid.trim()?void 0:"Account SID is required",authToken:authToken.trim()?void 0:"Auth Token is required",phoneNumber:phoneNumber?zod_lib.z.string().regex(/^\+[1-9]\d{1,14}$/,"Invalid E.164 phone number format.").safeParse(phoneNumber).error?"Invalid E.164 phone number format.":void 0:"Phone Number is required"}},submit:async()=>{try{let integration=await api.ZP.integrations.create({kind:"twilio",config:{account_sid:values.twilioIntegration.accountSid,auth_token:values.twilioIntegration.authToken,phone_number:values.twilioIntegration.phoneNumber}});actions.loadIntegrations(),LemonToast.U.success("Twilio channel created successfully!"),props.onComplete(integration.id)}catch(error){throw LemonToast.U.error(error.detail||"Failed to create Twilio channel"),error}}}}})]),TwilioSetupModal=props=>{let{isTwilioIntegrationSubmitting}=(0,index_esm.useValues)(twilioSetupModalLogic(props)),{submitTwilioIntegration}=(0,index_esm.useActions)(twilioSetupModalLogic(props));return(0,jsx_runtime.jsx)(src.fQ,{title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(icons.i5,{}),(0,jsx_runtime.jsx)("span",{children:"Configure Twilio SMS channel"})]}),onClose:props.onComplete,children:(0,jsx_runtime.jsx)(kea_forms_lib.Form,{logic:twilioSetupModalLogic,formKey:"twilioIntegration",children:(0,jsx_runtime.jsxs)("div",{className:"gap-4 flex flex-col",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"accountSid",label:"Account SID",children:(0,jsx_runtime.jsx)(src.DF,{type:"text",placeholder:"ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"authToken",label:"Auth token",children:(0,jsx_runtime.jsx)(src.DF,{type:"password"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"phoneNumber",label:"Phone Number",info:"Must be an SMS/MMS enabled phone number owned by your Twilio account",help:"Must be E.164 format, e.g. +1234567890",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"+1234567890"})}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(src.Jp,{type:"primary",htmlType:"submit",loading:isTwilioIntegrationSubmitting,onClick:submitTwilioIntegration,children:"Connect"})})]})})})};function ChannelSetupModal(_ref){let{isOpen,channelType,integration,onComplete}=_ref;if(!isOpen||!channelType)return null;let modalProps={integration,onComplete};switch(channelType){case"email":return(0,jsx_runtime.jsx)(EmailSetupModal,{...modalProps});case"slack":return(0,jsx_runtime.jsx)(SlackSetupModal,{...modalProps});case"twilio":return(0,jsx_runtime.jsx)(TwilioSetupModal,{...modalProps});default:return null}}let messageChannelsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","messageChannelsLogic"]),(0,index_esm.connect)(()=>({values:[integrationsLogic.a,["integrations","integrationsLoading"]],actions:[integrationsLogic.a,["deleteIntegration"]]})),(0,index_esm.actions)({openNewChannelModal:(integration,channelType)=>({integration,channelType}),closeNewChannelModal:!0}),(0,index_esm.reducers)(()=>({isNewChannelModalOpen:[!1,{openNewChannelModal:()=>!0,closeNewChannelModal:()=>!1}],selectedIntegration:[null,{openNewChannelModal:(_,_ref)=>{let{integration}=_ref;return integration||null},closeNewChannelModal:()=>null}],channelType:["email",{openNewChannelModal:(_,_ref2)=>{let{channelType}=_ref2;return channelType||"email"},closeNewChannelModal:()=>"email"}]}))]);var icons_icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/icons.tsx");let messageChannelLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","messageChannelLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{integration}=_ref;return`${integration?.kind}-${integration?.id}`}),(0,index_esm.selectors)(()=>({displayName:[()=>[(_,props)=>props],_ref2=>{let{integration}=_ref2;switch(integration?.kind){case"email":return integration.config.domain;case"twilio":return integration.config.phone_number;default:return integration.display_name}}],isVerificationRequired:[()=>[(_,props)=>props],_ref3=>{let{integration}=_ref3;return["email","twilio"].includes(integration?.kind)}],isVerified:[()=>[(_,props)=>props],_ref4=>{let{integration}=_ref4;return integration?.kind!=="email"||!0===integration.config.mailjet_verified}]}))]);function MessageChannel(_ref){let{integration}=_ref,{openNewChannelModal,deleteIntegration}=(0,index_esm.useActions)(messageChannelsLogic),{displayName,isVerified,isVerificationRequired}=(0,index_esm.useValues)(messageChannelLogic({integration})),onDeleteClick=integration=>{src.dn.open({title:"Do you want to disconnect this channel?",description:"This cannot be undone. Any messages configured to use this channel will remain but will stop working.",primaryButton:{children:"Yes, disconnect",status:"danger",onClick:()=>deleteIntegration(integration.id)},secondaryButton:{children:"No thanks"}})};return(0,jsx_runtime.jsx)("div",{className:"rounded border bg-surface-primary",children:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center p-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex gap-4 items-center ml-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-[1px]",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)("strong",{children:displayName}),isVerificationRequired&&(0,jsx_runtime.jsx)(src.u,{title:isVerified?"This channel is ready to use":"You cannot send messages from this channel until it has been verified",children:(0,jsx_runtime.jsx)(src.oe,{type:isVerified?"success":"warning",children:isVerified?"Verified":"Unverified"})})]}),integration.created_by?(0,jsx_runtime.jsx)(UserActivityIndicator.F,{at:integration.created_at,by:integration.created_by,prefix:"Created",className:"text-secondary"}):null]})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[!isVerified&&(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{openNewChannelModal(integration,integration.kind)},icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{}),children:"Verify"}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",status:"danger",onClick:()=>onDeleteClick(integration),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),children:"Remove"})]})]})})}function MessageChannelSection(_ref2){let{title,icon,integrations}=_ref2;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[icon,(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:title})]}),0===integrations.length&&(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"None configured yet"}),integrations.map(integration=>(0,jsx_runtime.jsx)(MessageChannel,{integration:integration},integration.id))]})}function MessageChannels(){var _integrations$filter,_integrations$filter2,_integrations$filter3,_integrations$filter4;let{isNewChannelModalOpen,selectedIntegration,integrations,integrationsLoading,channelType}=(0,index_esm.useValues)(messageChannelsLogic),{openNewChannelModal,closeNewChannelModal}=(0,index_esm.useActions)(messageChannelsLogic),messagingIntegrationTypes=["email","slack","twilio","webhook"],allMessagingIntegrations=null!==(_integrations$filter=integrations?.filter(integration=>messagingIntegrationTypes.includes(integration.kind)))&&void 0!==_integrations$filter?_integrations$filter:[],emailIntegrations=null!==(_integrations$filter2=integrations?.filter(integration=>"email"===integration.kind))&&void 0!==_integrations$filter2?_integrations$filter2:[],slackIntegrations=null!==(_integrations$filter3=integrations?.filter(integration=>"slack"===integration.kind))&&void 0!==_integrations$filter3?_integrations$filter3:[],twilioIntegrations=null!==(_integrations$filter4=integrations?.filter(integration=>"twilio"===integration.kind))&&void 0!==_integrations$filter4?_integrations$filter4:[],showProductIntroduction=!integrationsLoading&&!allMessagingIntegrations.length,menuItems=[{label:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconLetter,{})," Email"]}),onClick:()=>openNewChannelModal(void 0,"email")},{label:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(icons_icons.IconSlack,{})," Slack"]}),onClick:()=>openNewChannelModal(void 0,"slack")},{label:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(icons_icons.IconTwilio,{})," Twilio"]}),onClick:()=>openNewChannelModal(void 0,"twilio")}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsx)("div",{className:"flex items-center m-2 shrink-0",children:(0,jsx_runtime.jsx)(LemonMenu.d,{items:menuItems,children:(0,jsx_runtime.jsx)(src.Jp,{"data-attr":"new-channel-button",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),size:"small",type:"primary",children:"New channel"})})})}),(0,jsx_runtime.jsx)(ChannelSetupModal,{isOpen:isNewChannelModalOpen,channelType:channelType,integration:selectedIntegration||void 0,onComplete:()=>closeNewChannelModal()}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[integrationsLoading&&!integrations?.length&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.yW,{className:"h-20"}),(0,jsx_runtime.jsx)(src.yW,{className:"h-20"}),(0,jsx_runtime.jsx)(src.yW,{className:"h-20"})]}),showProductIntroduction&&(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Messaging channel",thingName:"channel integration",description:"Configure channels to send messages from.",docsURL:"https://posthog.com/docs/messaging",action:()=>openNewChannelModal(void 0,"email"),isEmpty:!0}),allMessagingIntegrations.length>0&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(MessageChannelSection,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconLetter,{className:"text-xl"}),title:"Email addresses",integrations:emailIntegrations}),(0,jsx_runtime.jsx)(MessageChannelSection,{icon:(0,jsx_runtime.jsx)(icons_icons.IconSlack,{className:"text-xl"}),title:"Slack apps",integrations:slackIntegrations}),(0,jsx_runtime.jsx)(MessageChannelSection,{icon:(0,jsx_runtime.jsx)(icons_icons.IconTwilio,{className:"text-xl"}),title:"Phone numbers",integrations:twilioIntegrations})]})]})]})}var columnUtils=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),deleteWithUndo=__webpack_require__("../../frontend/src/lib/utils/deleteWithUndo.tsx");let messageTemplatesLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","library","messageTemplatesLogic"]),(0,kea_loaders_lib.loaders)(_ref=>{let{values,actions}=_ref;return{templates:[[],{loadTemplates:async()=>(await api.ZP.messaging.getTemplates()).results,deleteTemplate:async template=>(await (0,deleteWithUndo.S)({endpoint:"environments/@current/messaging/templates",object:{id:template.id,name:template.name},callback:undo=>{undo&&actions.loadTemplates()}}),values.templates.filter(t=>t.id!==template.id)),createTemplate:async _ref2=>{let{template}=_ref2;try{let newTemplate=await api.ZP.messaging.createTemplate(template);return LemonToast.U.success("Template created successfully"),[...values.templates,newTemplate]}catch{return LemonToast.U.error("Failed to create template"),values.templates}},updateTemplate:async _ref3=>{let{templateId,template}=_ref3;try{let updatedTemplate=await api.ZP.messaging.updateTemplate(templateId,template);return LemonToast.U.success("Template updated successfully"),values.templates.map(t=>t.id===templateId?updatedTemplate:t)}catch{return LemonToast.U.error("Failed to update template"),values.templates}}}]}}),(0,index_esm.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadTemplates()})]);function MessageTemplatesTable(){(0,index_esm.useMountedLogic)(messageTemplatesLogic);let{templates,templatesLoading}=(0,index_esm.useValues)(messageTemplatesLogic),{deleteTemplate}=(0,index_esm.useActions)(messageTemplatesLogic),columns=[{title:"Name",render:(_,item)=>(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.messagingLibraryTemplate(item.id),title:item.name,description:item.description})},(0,columnUtils.JB)(),(0,columnUtils.rw)(),{width:0,render:function Render(_,message){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"message-template-delete",fullWidth:!0,status:"danger",onClick:()=>deleteTemplate(message),children:"Delete"})})})}}];return(0,jsx_runtime.jsx)("div",{className:"templates-section",children:(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:templates,loading:templatesLoading,columns:columns})})}let MESSAGING_SCENE_TABS=["campaigns","library","channels"],messagingSceneLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.path)(()=>["scenes","messaging","messagingSceneLogic"]),(0,index_esm.actions)({setCurrentTab:tab=>({tab})}),(0,index_esm.reducers)(()=>({currentTab:["campaigns",{setCurrentTab:(_,_ref)=>{let{tab}=_ref;return tab}}]})),(0,index_esm.selectors)({logicProps:[()=>[(_,props)=>props],props=>props],breadcrumbs:[()=>[(_,props)=>props],_ref2=>{let{tab}=_ref2;return[{key:sceneTypes.x.Messaging,name:"Messaging"},{key:[sceneTypes.x.Messaging,tab],name:(0,utils.fm)(tab.replaceAll("_"," "))}]}]}),(0,index_esm.listeners)({setCurrentTab:_ref3=>{let{tab}=_ref3;lib.router.actions.push(urls.j.messaging(tab))}}),(0,lib.urlToAction)(_ref4=>{let{actions,values}=_ref4;return{[urls.j.messaging(":tab")]:_ref5=>{let{tab}=_ref5,possibleTab=null!=tab?tab:"campaigns";(possibleTab=MESSAGING_SCENE_TABS.includes(possibleTab)?possibleTab:"campaigns")!==values.currentTab&&actions.setCurrentTab(possibleTab)}}})]),scene={component:MessagingScene,logic:messagingSceneLogic,paramsToProps:_ref7=>{let{params:{tab}}=_ref7;return{tab}}};function MessagingScene(){let{currentTab}=(0,index_esm.useValues)(messagingSceneLogic),{setCurrentTab}=(0,index_esm.useActions)(messagingSceneLogic);if(!(0,useFeatureFlag.y)("MESSAGING"))return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col justify-center items-center h-full",children:[(0,jsx_runtime.jsx)("h1",{className:"text-2xl font-bold",children:"Coming soon!"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted-foreground",children:"We're working on bringing messaging to PostHog. Stay tuned for updates!"})]});let tabs=[{label:"Campaigns",key:"campaigns",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Create automated messaging campaigns triggered by events",buttons:(0,jsx_runtime.jsx)(src.Jp,{"data-attr":"new-campaign",to:urls.j.messagingCampaignNew(),type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),children:"New campaign"})}),(0,jsx_runtime.jsx)(CampaignsTable,{})]})},{label:"Library",key:"library",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Create and manage messages",buttons:(0,jsx_runtime.jsx)(src.Jp,{"data-attr":"new-message-button",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),size:"small",type:"primary",to:urls.j.messagingLibraryTemplateNew(),children:"New template"})}),(0,jsx_runtime.jsx)(MessageTemplatesTable,{})]})},{label:"Channels",key:"channels",content:(0,jsx_runtime.jsx)(MessageChannels,{})}];return(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,tabs:tabs,onChange:setCurrentTab})}}}]);