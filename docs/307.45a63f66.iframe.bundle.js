var Ye=Object.defineProperty,He=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var le=(g,d,s)=>d in g?Ye(g,d,{enumerable:!0,configurable:!0,writable:!0,value:s}):g[d]=s,b=(g,d)=>{for(var s in d||(d={}))Ge.call(d,s)&&le(g,s,d[s]);if(ce)for(var s of ce(d))Je.call(d,s)&&le(g,s,d[s]);return g},S=(g,d)=>He(g,Qe(d));var U=(g,d,s)=>new Promise((C,L)=>{var l=O=>{try{F(s.next(O))}catch(k){L(k)}},N=O=>{try{F(s.throw(O))}catch(k){L(k)}},F=O=>O.done?C(O.value):Promise.resolve(O.value).then(l,N);F((s=s.apply(g,d)).next())});(window.webpackJsonp=window.webpackJsonp||[]).push([[307],{"./frontend/src/scenes/actions/Action.tsx":function(g,d,s){"use strict";s.r(d),s.d(d,"scene",function(){return Re}),s.d(d,"Action",function(){return V});var C=s("./frontend/src/lib/utils.tsx"),L=s("./frontend/src/lib/components/Link.tsx"),l=s("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),N=s("./frontend/src/lib/api.ts"),F=s("./frontend/src/models/actionsModel.ts"),O=s("./frontend/src/lib/components/lemonToast.tsx"),k=s("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),W=s("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.0/node_modules/kea-forms/lib/index.js"),R=s("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),v=s("./frontend/src/scenes/urls.ts"),re=s("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts"),Z=s("./frontend/src/models/tagsModel.ts"),e=s("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const q=Object(l.kea)([Object(l.path)(["scenes","actions","actionEditLogic"]),Object(l.props)({}),Object(l.key)(n=>n.id||"new"),Object(l.connect)({actions:[Z.a,["loadTags"]]}),Object(l.actions)({setAction:function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:n,options:t}},setCreateNew:n=>({createNew:n}),actionAlreadyExists:n=>({actionId:n}),deleteAction:!0}),Object(l.connect)({actions:[F.a,["loadActions"],re.c,["loadEventDefinitions"]]}),Object(l.reducers)({createNew:[!1,{setCreateNew:(n,t)=>{let{createNew:a}=t;return a}}]}),Object(W.forms)(n=>{let{actions:t,props:a}=n;return{action:{defaults:b({},a.action),errors:o=>{let{name:i}=o;return{name:i?null:"You need to set a name"}},submit:o=>{t.saveAction(o)}}}}),Object(k.loaders)(n=>{let{props:t,values:a,actions:o}=n;return{actionCount:{loadActionCount:()=>U(this,null,function*(){return t.id?yield N.b.actions.getCount(t.id):0})},action:[b({},t.action),{setAction:i=>{let{action:j,options:{merge:r}}=i;return r?b(b({},a.action),j):j},saveAction:(i,j)=>U(this,null,function*(){let r=b({},i);r.steps=r.steps?r.steps.filter(u=>u.event):[];try{r.id?r=yield N.b.actions.update(r.id,r,t.temporaryToken):r=yield N.b.actions.create(r,t.temporaryToken),j()}catch(u){if(u.code==="unique"){const x=u.detail.split(" ").pop();return O.d.error(Object(e.jsxs)(e.Fragment,{children:["Action with this name already exists."," ",Object(e.jsx)(L.a,{to:v.a.action(x),children:"Click here to edit."})]})),r}throw u}return O.d.success("Action saved"),t.onSave(r),o.loadEventDefinitions(null),o.loadActions(),o.loadTags(),r})}]}}),Object(l.listeners)(n=>{let{values:t,actions:a}=n;return{deleteAction:()=>{Object(C.x)({endpoint:N.b.actions.determineDeleteEndpoint(),object:t.action,callback:()=>{R.router.actions.push(v.a.actions()),a.loadActions()}})}}}),Object(l.afterMount)(n=>{let{actions:t,props:a}=n;a.id?t.loadActionCount():t.setAction({name:"",steps:[{isNew:Object(C.Lb)()}]},{merge:!1})})]);var Xe=s("./frontend/src/scenes/actions/Actions.scss"),de=s("./frontend/src/scenes/actions/EventName.tsx"),ue=s("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),me=s("./frontend/src/lib/components/Tooltip.tsx"),M=s("./frontend/src/scenes/actions/hints.tsx"),_=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/col/index.js"),y=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/radio/index.js"),ee=s("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),T=s("./frontend/@posthog/lemon-ui/src/index.ts"),K=s("./frontend/src/lib/components/icons.tsx"),je=s("./frontend/src/lib/components/LemonDialog/index.ts"),he=s("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),pe=s("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),Y=s("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),be=s("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),xe=s("./frontend/src/lib/components/AlertMessage/index.ts");const te="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function $(n){let{step:t,actionId:a,isOnlyStep:o,index:i,identifier:j,onDelete:r,onChange:u}=n;const x=f=>{u(f)};return Object(e.jsx)(_.a,{span:24,md:12,children:Object(e.jsxs)("div",{className:"rounded border p-4 relative h-full",children:[i>0&&Object(e.jsx)("div",{className:"stateful-badge pos-center-end or",children:"OR"}),Object(e.jsxs)("div",{className:"space-y-4",children:[Object(e.jsxs)("div",{className:"flex items-center justify-between",children:[Object(e.jsxs)("b",{children:["Match Group #",i+1]}),!o&&Object(e.jsx)(T.LemonButton,{status:"primary-alt",icon:Object(e.jsx)(K.IconClose,{}),size:"small","aria-label":"delete",onClick:r})]}),Object(e.jsx)(ve,{step:t,sendStep:x}),t.event==="$autocapture"&&Object(e.jsx)(Oe,{step:t,sendStep:x,actionId:a}),t.event!=null&&t.event!=="$autocapture"&&t.event!=="$pageview"&&Object(e.jsxs)("div",{className:"space-y-1",children:[Object(e.jsx)(Y.a,{children:"Event name"}),Object(e.jsx)(de.a,{value:t.event,onChange:f=>x(S(b({},t),{event:f||""}))}),Object(e.jsxs)("small",{children:[Object(e.jsx)(T.Link,{to:"https://posthog.com/docs/libraries",target:"_blank",children:"See documentation"})," ","on how to send custom events in lots of languages."]})]}),t.event==="$pageview"&&Object(e.jsxs)("div",{children:[Object(e.jsx)(w,{step:t,sendStep:x,item:"url",extra_options:Object(e.jsx)(ne,{step:t,sendStep:x}),label:"URL"}),t.url_matching&&t.url_matching in M.a&&Object(e.jsx)("small",{children:M.a[t.url_matching]})]}),t.event&&Object(e.jsxs)("div",{className:"mt-6 space-y-2",children:[Object(e.jsx)("h3",{children:"Filters"}),(!t.properties||t.properties.length===0)&&Object(e.jsx)("div",{className:"text-muted",children:"This match group has no additional filters."}),Object(e.jsx)(ue.a,{propertyFilters:t.properties,pageKey:j,eventNames:t.event?[t.event]:[],onChange:f=>{x(S(b({},t),{properties:f}))},showConditionBadge:!0})]})]})]})})}const ge=(n,t)=>{n.includes("#")?t('The ID selector "#example" does not match in PostHog actions. Use `[id="example"]` instead'):t(null)};function w(n){const t=i=>n.sendStep(S(b({},n.step),{[n.item]:i||null})),[a,o]=Object(be.useState)(null);return Object(e.jsxs)("div",{className:"space-y-1",children:[Object(e.jsxs)(Y.a,{children:[n.label," ",n.extra_options]}),n.caption&&Object(e.jsx)("div",{className:"action-step-caption",children:n.caption}),n.item==="selector"?Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(T.LemonTextArea,{onChange:i=>{ge(i,o),t(i)},value:n.step[n.item]||"",placeholder:n.placeholder}),Object(e.jsx)("div",{className:a?"visible":"hidden",children:Object(e.jsx)(xe.a,{type:"warning",children:a})})]}):Object(e.jsx)(T.LemonInput,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder})]})}const H=()=>Object(e.jsx)("div",{className:"text-center my-2",children:Object(e.jsx)("span",{className:"stateful-badge and",children:"AND"})});function Oe(n){let{step:t,actionId:a,sendStep:o}=n;const i=()=>{je.a.open({title:"Select an element",description:a?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",content:Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(he.a,{actionId:a,type:pe.a.TOOLBAR_URLS})}),primaryButton:{children:"Close",type:"secondary"}})};return Object(e.jsxs)("div",{className:"space-y-4",children:[Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)(T.LemonButton,{size:"small",type:"secondary",onClick:i,sideIcon:Object(e.jsx)(K.IconOpenInApp,{}),children:"Select element on site"}),Object(e.jsx)(T.Link,{to:`${te}#autocapture-based-actions`,target:"_blank",children:"See documentation."})]}),Object(e.jsx)(w,{step:t,sendStep:o,item:"href",label:"Link target equals",caption:Object(e.jsxs)(e.Fragment,{children:["If your element is a link, the location that the link opens (",Object(e.jsx)("code",{children:"href"})," tag)"]})}),Object(e.jsx)(H,{}),Object(e.jsx)(w,{step:t,sendStep:o,item:"text",label:"Text equals",caption:"Text content inside your element"}),Object(e.jsx)(H,{}),Object(e.jsx)(w,{step:t,sendStep:o,item:"selector",label:Object(e.jsxs)(e.Fragment,{children:["HTML selector matches",Object(e.jsx)(me.a,{title:"Click here to learn more about supported selectors",children:Object(e.jsx)(T.Link,{to:`${te}#matching-selectors`,target:"_blank",children:Object(e.jsx)(ee.a,{})})})]}),placeholder:'button[data-attr="my-id"]',caption:Object(e.jsxs)("span",{children:["CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",Object(e.jsx)("code",{className:"code",children:'[data-attr="signup"]'})]})}),Object(e.jsx)(H,{}),Object(e.jsx)(w,{step:t,sendStep:o,item:"url",extra_options:Object(e.jsx)(ne,{step:t,sendStep:o}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(t==null?void 0:t.url_matching)&&t.url_matching in M.a&&Object(e.jsx)("small",{children:M.a[t.url_matching]})]})}function ve(n){let{step:t,sendStep:a}=n;const o=i=>{const j=i.target.value;j==="$autocapture"?a(S(b({},t),{event:"$autocapture"})):j==="event"?a(S(b({},t),{event:""})):j==="$pageview"&&a(S(b({},t),{event:"$pageview",url:t.url}))};return Object(e.jsx)("div",{className:"type-switcher",children:Object(e.jsxs)(y.a.Group,{buttonStyle:"solid",onChange:o,value:t.event==="$autocapture"||t.event==="$pageview"||t.event===void 0?t.event:"event",children:[Object(e.jsx)(y.a.Button,{value:"$autocapture",children:"Autocapture"}),Object(e.jsx)(y.a.Button,{value:"event",children:"Custom event"}),Object(e.jsx)(y.a.Button,{value:"$pageview",children:"Page view"})]})})}function ne(n){let{step:t,sendStep:a}=n;const o=i=>{a(S(b({},t),{url_matching:i.target.value}))};return Object(e.jsxs)(y.a.Group,{buttonStyle:"solid",onChange:o,value:t.url_matching||"contains",size:"small",children:[Object(e.jsx)(y.a.Button,{value:"contains",children:"contains"}),Object(e.jsx)(y.a.Button,{value:"regex",children:"matches regex"}),Object(e.jsx)(y.a.Button,{value:"exact",children:"matches exactly"})]})}try{$.displayName="ActionStep",$.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:$.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(n){}var fe=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/row/index.js"),ye=s("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),Ae=s("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),Se=s("./frontend/src/lib/components/PageHeader.tsx"),Ce=s("./frontend/src/scenes/teamLogic.tsx"),se=s("./frontend/src/lib/components/EditableField/EditableField.tsx"),Le=s("./frontend/src/types.ts"),Ne=s("./frontend/src/scenes/userLogic.ts"),Te=s("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),E=s("./frontend/src/lib/forms/Field.tsx"),D=s("./frontend/src/lib/components/LemonButton/index.ts"),Ee=s("./frontend/src/lib/components/LemonCheckbox/index.ts"),Ie=s("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function z(n){let{action:t,id:a,onSave:o,temporaryToken:i}=n;const j={id:a,action:t,onSave:h=>o(h),temporaryToken:i},r=q(j),{action:u,actionLoading:x,actionCount:f,actionCountLoading:Me}=Object(l.useValues)(r),{submitAction:ae,deleteAction:$e}=Object(l.useActions)(r),{currentTeam:J}=Object(l.useValues)(Ce.a),{hasAvailableFeature:ze}=Object(l.useValues)(Ne.a),{tags:Ue}=Object(l.useValues)(Z.a),X=J==null?void 0:J.slack_incoming_webhook,oe=()=>Object(e.jsx)(D.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",onClick:()=>{$e()},children:"Delete"}),ie=()=>Object(e.jsx)(D.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",onClick:()=>{R.router.actions.push(v.a.actions())},children:"Cancel"});return Object(e.jsx)("div",{className:"action-edit-container",children:Object(e.jsxs)(W.Form,{logic:q,props:j,formKey:"action",enableFormOnSubmit:!0,children:[Object(e.jsx)(Se.a,{title:Object(e.jsx)(E.a,{name:"name",children:h=>{let{value:c,onChange:p}=h;return Object(e.jsx)(se.a,{name:"name",value:c||"",placeholder:"Name this action",onChange:a?void 0:p,onSave:m=>{p(m),ae()},mode:a?void 0:"edit",minLength:1,maxLength:400,"data-attr":`action-name-${a?"edit":"create"}`,className:"action-name"})}}),caption:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(E.a,{name:"description",children:h=>{let{value:c,onChange:p}=h;return Object(e.jsx)(se.a,{multiline:!0,name:"description",value:c||"",placeholder:"Description (optional)",onChange:a?void 0:p,onSave:m=>{p(m),ae()},mode:a?void 0:"edit","data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!ze(Le.e.INGESTION_TAXONOMY)})}}),Object(e.jsx)(E.a,{name:"tags",children:h=>{let{value:c,onChange:p}=h;return Object(e.jsx)(Te.a,{tags:c!=null?c:[],onChange:(m,A)=>p(A),className:"action-tags",saving:x,tagsAvailable:Ue.filter(m=>{var A;return!((A=u.tags)!==null&&A!==void 0&&A.includes(m))})})}})]}),buttons:Object(e.jsxs)(e.Fragment,{children:[a?Object(e.jsx)(D.a,{type:"secondary",to:Object(R.combineUrl)(v.a.sessionRecordings(),{filters:{actions:[{id:a,type:"actions",order:0,name:u.name}]}}).url,sideIcon:Object(e.jsx)(K.IconPlayCircle,{}),"data-attr":"action-view-recordings",children:"View recordings"}):null,a?oe():ie()]})}),a&&Object(e.jsx)("div",{className:"input-set",children:Object(e.jsx)("div",{children:Object(e.jsxs)("span",{className:"text-muted mb-2",children:[Me&&Object(e.jsx)(ye.a,{}),f!==null&&f>-1&&Object(e.jsxs)(e.Fragment,{children:["This action matches ",Object(e.jsx)("b",{children:Object(C.p)(f)})," events in the last 3 months"]})]})})}),Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Match groups"}),Object(e.jsxs)("div",{children:["Your action will be triggered whenever ",Object(e.jsx)("b",{children:"any of your match groups"})," are received."," ",Object(e.jsx)(L.a,{to:"https://posthog.com/docs/features/actions",target:"_blank",children:Object(e.jsx)(ee.a,{})})]}),Object(e.jsx)(E.a,{name:"steps",children:h=>{let{onChange:c}=h;return Object(e.jsx)("div",{className:"flex justify-end mb-2",children:Object(e.jsx)(D.a,{onClick:()=>c([...u.steps||[],{isNew:Object(C.Lb)()}]),size:"small",type:"secondary",children:"Add another match group"})})}}),Object(e.jsx)(E.a,{name:"steps",children:h=>{let{value:c,onChange:p}=h;return Object(e.jsxs)(fe.a,{gutter:[24,24],children:[Object(e.jsx)(e.Fragment,{children:c.map((m,A)=>{const Ke=String(JSON.stringify(m));return Object(e.jsx)($,{identifier:Ke,index:A,step:m,actionId:u.id||0,isOnlyStep:!!c&&c.length===1,onDelete:()=>{var B;const I=m.id?"id":"isNew";p((B=c==null?void 0:c.filter(P=>P[I]!==m[I]))!==null&&B!==void 0?B:[])},onChange:B=>{var I;p((I=c==null?void 0:c.map(P=>m.id&&P.id==m.id||m.isNew&&P.isNew===m.isNew?b({id:m.id,isNew:m.isNew},B):P))!==null&&I!==void 0?I:[])}},A)})}),Object(e.jsx)(_.a,{span:24,md:12,children:Object(e.jsx)("div",{className:"match-group-add-skeleton",onClick:()=>{p([...u.steps||[],{isNew:Object(C.Lb)()}])},children:Object(e.jsx)(Ae.a,{style:{fontSize:28,color:"#666666"}})})})]})}})]}),Object(e.jsxs)("div",{className:"my-8",children:[Object(e.jsx)(E.a,{name:"post_to_slack",children:h=>{let{value:c,onChange:p}=h;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ee.a,{id:"webhook-checkbox",checked:!!c,onChange:p,disabled:!X,label:Object(e.jsx)(e.Fragment,{children:"Post to webhook when this action is triggered."})}),Object(e.jsx)("p",{className:"pl-7",children:Object(e.jsxs)(L.a,{to:"/project/settings#webhook",children:[X?"Configure":"Enable"," this integration in Project Settings."]})})]})}}),u.post_to_slack&&Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(E.a,{name:"slack_message_format",children:h=>{let{value:c,onChange:p}=h;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Y.a,{showOptional:!0,children:"Message format"}),Object(e.jsx)(Ie.a,{placeholder:"Default: [action.name] triggered by [person]",value:c,onChange:p,disabled:!X||!u.post_to_slack,"data-attr":"edit-slack-message-format"}),Object(e.jsx)("small",{children:Object(e.jsx)(L.a,{to:"https://posthog.com/docs/integrate/webhooks/message-formatting",target:"_blank",children:"See documentation on how to format webhook messages."})})]})}})})]}),Object(e.jsxs)("div",{className:"flex justify-end gap-2",children:[a?oe():ie(),Object(e.jsx)(D.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:x,children:"Save"})]})]})})}try{z.displayName="ActionEdit",z.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:z.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(n){}var Fe=s("./frontend/src/scenes/events/index.ts"),ke=s("./frontend/src/lib/dayjs.ts"),we=s("./frontend/src/lib/components/Spinner/Spinner.tsx");const Q=Object(l.kea)({props:{},key:n=>n.id||"new",path:n=>["scenes","actions","actionLogic",n],actions:()=>({checkIsFinished:n=>({action:n}),setPollTimeout:n=>({pollTimeout:n}),setIsComplete:n=>({isComplete:n})}),reducers:()=>({pollTimeout:[null,{setPollTimeout:(n,t)=>{let{pollTimeout:a}=t;return a}}],isComplete:[!1,{setIsComplete:(n,t)=>{let{isComplete:a}=t;return a}}]}),selectors:{breadcrumbs:[n=>[n.action],n=>[{name:"Data Management",path:v.a.eventDefinitions()},{name:"Actions",path:v.a.actions()},{name:(n==null?void 0:n.name)||"Unnamed",path:n?v.a.action(n.id):void 0}]]},loaders:n=>{let{actions:t,props:a}=n;return{action:{loadAction:()=>U(this,null,function*(){if(t.setIsComplete(!1),!a.id)throw new Error("Cannot fetch an unsaved action from the API.");const o=yield N.b.actions.get(a.id);return t.checkIsFinished(o),o})}}},listeners:n=>{let{actions:t,values:a}=n;return{checkIsFinished:o=>{let{action:i}=o;i.is_calculating?t.setPollTimeout(setTimeout(()=>t.loadAction(),1e3)):(t.setIsComplete(new Date),a.pollTimeout&&clearTimeout(a.pollTimeout))}}},events:n=>{let{values:t,actions:a,props:o}=n;return{afterMount:()=>{o.id&&a.loadAction()},beforeUnmount:()=>{t.pollTimeout&&clearTimeout(t.pollTimeout)}}}});var De=s("./frontend/src/queries/Query/Query.tsx"),G=s("./frontend/src/queries/schema.ts"),Ve=s("./frontend/src/lib/logic/featureFlagLogic.ts"),Be=s("./frontend/src/lib/constants.tsx"),Pe=s("./frontend/src/queries/nodes/DataTable/utils.ts");const Re={logic:Q,component:V,paramsToProps:n=>{let{params:{id:t}}=n;return{id:parseInt(t)}}};function V(){let{id:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={action_id:n},{push:a}=Object(l.useActions)(R.router),{action:o,isComplete:i}=Object(l.useValues)(Q),{loadAction:j}=Object(l.useActions)(Q),{featureFlags:r}=Object(l.useValues)(Ve.a),u=r[Be.i.DATA_EXPLORATION_LIVE_EVENTS];return Object(e.jsxs)(e.Fragment,{children:[(!n||o)&&Object(e.jsx)(z,{id:n,action:o,onSave:x=>{n||a(v.a.action(x.id)),j()}}),n&&(i?Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("p",{children:["This is the list of ",Object(e.jsx)("strong",{children:"recent"})," events that match this action.",o!=null&&o.last_calculated_at?Object(e.jsxs)(e.Fragment,{children:[" ","Last calculated: ",Object(e.jsx)("b",{children:Object(ke.a)(o.last_calculated_at).fromNow()}),"."]}):""]}),Object(e.jsx)("div",{className:"pt-4 border-t"}),u?Object(e.jsx)(De.a,{query:{kind:G.a.DataTableNode,source:{kind:G.a.EventsQuery,select:Object(Pe.a)(G.a.EventsQuery),actionId:n},full:!0,showEventFilter:!1,showPropertyFilter:!1}}):Object(e.jsx)(Fe.b,{fixedFilters:t,sceneUrl:v.a.action(n),fetchMonths:3,pageKey:`action-${n}-${JSON.stringify(t)}`,showEventFilter:!1})]}):Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsx)(we.a,{className:"mr-4"}),"Calculating action, please hold on."]})]}))]})}try{V.displayName="Action",V.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:V.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(n){}}}]);
