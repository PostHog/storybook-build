(window.webpackJsonp=window.webpackJsonp||[]).push([[325],{"./frontend/src/scenes/surveys/Survey.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Survey",(function(){return Survey})),__webpack_require__.d(__webpack_exports__,"SurveyForm",(function(){return SurveyForm})),__webpack_require__.d(__webpack_exports__,"SurveyView",(function(){return SurveyView}));var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const NEW_SURVEY={name:"",description:"",questions:[{type:types.ib.Open,question:""}],type:types.jb.Popover,linked_flag_id:void 0,targeting_flag:null,start_date:null,end_date:null},DEFAULT_DATATABLE_QUERY={kind:schema.a.DataTableNode,full:!0,source:{kind:schema.a.EventsQuery,select:["*","event","timestamp","person"],orderBy:["timestamp DESC"],after:"-30d",limit:100,event:"insight viewed"},propertiesViaUrl:!0,showExport:!0,showReload:!0,showColumnConfigurator:!0,showEventFilter:!0,showPropertyFilter:!0},surveyLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","surveys","surveyLogic"]),Object(index_esm.props)({}),Object(index_esm.key)((_ref=>{let{id:id}=_ref;return id})),Object(index_esm.actions)({editingSurvey:editing=>({editing:editing})}),Object(kea_loaders_lib.loaders)((_ref2=>{let{props:props}=_ref2;return{survey:{loadSurvey:async()=>props.id&&"new"!==props.id?await api.b.surveys.get(props.id):{...NEW_SURVEY},createSurvey:async surveyPayload=>await api.b.surveys.create(surveyPayload),updateSurvey:async surveyPayload=>await api.b.surveys.update(props.id,surveyPayload)}}})),Object(index_esm.listeners)((()=>({createSurveySuccess:async _ref3=>{let{survey:survey}=_ref3;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," created"]})),kea_router_lib.router.actions.push(urls.a.survey(survey.id))},updateSurveySuccess:async _ref4=>{let{survey:survey}=_ref4;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," updated"]})),kea_router_lib.router.actions.push(urls.a.survey(survey.id))}}))),Object(index_esm.reducers)({isEditingSurvey:[!1,{editingSurvey:(_,_ref5)=>{let{editing:editing}=_ref5;return editing}}],dataTableQuery:[DEFAULT_DATATABLE_QUERY]}),Object(index_esm.selectors)({isSurveyRunning:[s=>[s.survey],survey=>!(!survey.start_date||survey.end_date)],breadcrumbs:[s=>[s.survey],survey=>[{name:"Surveys",path:urls.a.surveys()},...null!=survey&&survey.name?[{name:survey.name}]:[]]]}),Object(lib.forms)((_ref6=>{let{actions:actions,props:props}=_ref6;return{survey:{defaults:{...NEW_SURVEY},errors:_ref7=>{let{name:name}=_ref7;return{name:name?void 0:"Please enter a name"}},submit:async surveyPayload=>{props.id&&"new"!==props.id?actions.updateSurvey(surveyPayload):actions.createSurvey(surveyPayload)}}}})),Object(kea_router_lib.urlToAction)((_ref8=>{var _props$id;let{actions:actions,props:props}=_ref8;return{[urls.a.survey(null!==(_props$id=props.id)&&void 0!==_props$id?_props$id:"new")]:(_,__,___,_ref9)=>{let{method:method}=_ref9;"PUSH"===method&&(props.id?actions.loadSurvey():actions.resetSurvey())}}})),Object(index_esm.afterMount)((async _ref10=>{let{props:props,actions:actions}=_ref10;"new"!==props.id&&await actions.loadSurvey(),"new"===props.id&&actions.resetSurvey()}))]);var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),EarlyAccessFeature=__webpack_require__("./frontend/src/scenes/early-access-features/EarlyAccessFeature.tsx"),PropertyFilters=__webpack_require__("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),TaxonomicFilter_types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),EditableField=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js");const scene={component:Survey,logic:surveyLogic,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{id:id}}};function Survey(){let{id:id}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{isEditingSurvey:isEditingSurvey}=Object(index_esm.useValues)(surveyLogic),showSurveyForm="new"===id||isEditingSurvey;return Object(jsx_runtime.jsx)("div",{children:id?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:showSurveyForm?Object(jsx_runtime.jsx)(SurveyForm,{id:id}):Object(jsx_runtime.jsx)(SurveyView,{})}):Object(jsx_runtime.jsx)(LemonSkeleton.a,{})})}function SurveyForm(_ref2){var _survey$targeting_fla,_survey$targeting_fla2;let{id:id}=_ref2;const{survey:survey,surveyLoading:surveyLoading,isEditingSurvey:isEditingSurvey}=Object(index_esm.useValues)(surveyLogic),{loadSurvey:loadSurvey,editingSurvey:editingSurvey}=Object(index_esm.useActions)(surveyLogic);return Object(jsx_runtime.jsxs)(lib.Form,{formKey:"survey",logic:surveyLogic,className:"space-y-4",children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:"new"===id?"New survey":survey.name,buttons:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-survey",type:"secondary",loading:surveyLoading,onClick:()=>{isEditingSurvey?(editingSurvey(!1),loadSurvey()):kea_router_lib.router.actions.push(urls.a.surveys())},children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:surveyLoading,children:"Save"})]})}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 max-w-160",children:[Object(jsx_runtime.jsx)(Field.a,{name:"name",label:"Name",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"survey-name"})}),Object(jsx_runtime.jsx)(Field.a,{name:"description",label:"Description",children:Object(jsx_runtime.jsx)(src.LemonTextArea,{"data-attr":"survey-description"})}),Object(jsx_runtime.jsx)(Field.a,{name:"type",label:"Type",children:Object(jsx_runtime.jsx)(src.LemonSelect,{dropdownMaxContentWidth:!0,"data-attr":"survey-type",options:[{label:"Popover",value:types.jb.Popover}]})}),Object(jsx_runtime.jsx)(Field.a,{name:"linked_flag_id",label:"Link feature flag (optional)",info:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Feature you want to connect this survey to."}),children:_ref3=>{let{value:value,onChange:onChange}=_ref3;return Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(EarlyAccessFeature.FlagSelector,{value:value,onChange:onChange})})}}),survey.questions.map(((question,index)=>Object(jsx_runtime.jsx)(lib.Group,{name:`questions.${index}`,children:Object(jsx_runtime.jsx)(Field.a,{name:"question",label:"Question",children:Object(jsx_runtime.jsx)(src.LemonInput,{value:question.question})})},index))),Object(jsx_runtime.jsxs)(Field.b,{label:"Targeting",children:[Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsxs)(lib.Group,{name:"conditions",children:[Object(jsx_runtime.jsx)(Field.a,{name:"url",label:"Url",children:Object(jsx_runtime.jsx)(src.LemonInput,{})}),Object(jsx_runtime.jsx)(Field.a,{name:"selector",label:"Selector",children:Object(jsx_runtime.jsx)(src.LemonInput,{})})]}),Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Matching ",Object(jsx_runtime.jsx)("b",{children:"users"})," against the criteria"]}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(PropertyFilters.a,{orFiltering:!0,pageKey:`survey-${id}-targeting`,propertyFilters:null===(_survey$targeting_fla=survey.targeting_flag)||void 0===_survey$targeting_fla||null===(_survey$targeting_fla2=_survey$targeting_fla.filters)||void 0===_survey$targeting_fla2?void 0:_survey$targeting_fla2.groups[0].properties,logicalRowDivider:!0,addButton:Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)(icons.sc,{}),sideIcon:null,noPadding:!0,children:"Add condition"}),onChange:()=>{},taxonomicGroupTypes:[TaxonomicFilter_types.a.PersonProperties,TaxonomicFilter_types.a.Cohorts],hasRowOperator:!1,sendAllKeyUpdates:!0})})]})]})]}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-survey",type:"secondary",loading:surveyLoading,onClick:()=>{isEditingSurvey?(editingSurvey(!1),loadSurvey()):kea_router_lib.router.actions.push(urls.a.surveys())},children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:surveyLoading,children:"Save"})]})]})}function SurveyView(){const{survey:survey,isSurveyRunning:isSurveyRunning,dataTableQuery:dataTableQuery}=Object(index_esm.useValues)(surveyLogic),[tabKey,setTabKey]=Object(react.useState)("overview");return Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:survey.name,buttons:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(More.a,{overlay:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"edit-survey",fullWidth:!0,onClick:()=>{},children:"Edit"}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsx)(src.LemonButton,{status:"danger",children:"Delete survey"})]})}),Object(jsx_runtime.jsx)(src.LemonDivider,{vertical:!0}),isSurveyRunning?Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>{},children:"Stop"}):Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>{},children:"Launch"})]}),caption:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:survey&&!!survey.description&&Object(jsx_runtime.jsx)(EditableField.a,{multiline:!0,name:"description",value:survey.description||"",placeholder:"Description (optional)",onSave:()=>{},saveOnBlur:!0,compactButtons:!0})})}),Object(jsx_runtime.jsx)(LemonTabs.a,{activeKey:tabKey,onChange:key=>setTabKey(key),tabs:[{content:Object(jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Type"}),Object(jsx_runtime.jsx)("span",{children:types.jb.Popover}),Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Questions"}),Object(jsx_runtime.jsx)("span",{})]}),key:"overview",label:"Overview"},survey.start_date?{content:Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsxs)("div",{className:"flex flex-row gap-4",children:[Object(jsx_runtime.jsxs)("div",{className:"border rounded p-4",children:[Object(jsx_runtime.jsx)("span",{children:"Impressions"}),Object(jsx_runtime.jsx)("h2",{children:"257"})]}),Object(jsx_runtime.jsxs)("div",{className:"border rounded p-4",children:[Object(jsx_runtime.jsx)("span",{children:"Started"}),Object(jsx_runtime.jsx)("h2",{children:"78"})]}),Object(jsx_runtime.jsxs)("div",{className:"border rounded p-4",children:[Object(jsx_runtime.jsx)("span",{children:"Completed"}),Object(jsx_runtime.jsx)("h2",{children:"55"})]})]}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsx)(Query.a,{query:dataTableQuery})]}),key:"results",label:"Results"}:null]})]})}try{Survey.displayName="Survey",Survey.__docgenInfo={description:"",displayName:"Survey",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#Survey"]={docgenInfo:Survey.__docgenInfo,name:"Survey",path:"frontend/src/scenes/surveys/Survey.tsx#Survey"})}catch(__react_docgen_typescript_loader_error){}try{SurveyForm.displayName="SurveyForm",SurveyForm.__docgenInfo={description:"",displayName:"SurveyForm",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#SurveyForm"]={docgenInfo:SurveyForm.__docgenInfo,name:"SurveyForm",path:"frontend/src/scenes/surveys/Survey.tsx#SurveyForm"})}catch(__react_docgen_typescript_loader_error){}}}]);