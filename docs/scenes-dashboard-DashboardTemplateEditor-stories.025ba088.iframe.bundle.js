"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[47858],{"../../frontend/src/scenes/dashboard/DashboardTemplateEditor.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CreateTemplate:()=>CreateTemplate,EditTemplate:()=>EditTemplate,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _DashboardTemplateEditor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx"),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/scenes/dashboard/dashboardTemplateEditorLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let __WEBPACK_DEFAULT_EXPORT__={title:"Scenes-App/Dashboards",component:_DashboardTemplateEditor__WEBPACK_IMPORTED_MODULE_0__.v,parameters:{testOptions:{waitForLoadersToDisappear:!0}}},CreateTemplate=()=>(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.mount(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.clear(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.openDashboardTemplateEditor(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.setEditorValue(JSON.stringify({id:"123",template_name:"My Template"},null,4)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"bg-default p-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_DashboardTemplateEditor__WEBPACK_IMPORTED_MODULE_0__.v,{inline:!0})})),EditTemplate=()=>(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.mount(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.setDashboardTemplateId("123"),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.openDashboardTemplateEditor(),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_1__.X.actions.setEditorValue(JSON.stringify({id:"123",template_name:"My Template"},null,4)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("div",{className:"bg-default p-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_DashboardTemplateEditor__WEBPACK_IMPORTED_MODULE_0__.v,{inline:!0})}));CreateTemplate.parameters={...CreateTemplate.parameters,docs:{...CreateTemplate.parameters?.docs,source:{originalSource:"(): JSX.Element => {\n  dashboardTemplateEditorLogic.mount();\n  dashboardTemplateEditorLogic.actions.clear();\n  dashboardTemplateEditorLogic.actions.openDashboardTemplateEditor();\n  dashboardTemplateEditorLogic.actions.setEditorValue(JSON.stringify({\n    id: '123',\n    template_name: 'My Template'\n  }, null, 4));\n  return <div className=\"bg-default p-4\">\n            <DashboardTemplateEditor inline={true} />\n        </div>;\n}",...CreateTemplate.parameters?.docs?.source}}},EditTemplate.parameters={...EditTemplate.parameters,docs:{...EditTemplate.parameters?.docs,source:{originalSource:"(): JSX.Element => {\n  dashboardTemplateEditorLogic.mount();\n  dashboardTemplateEditorLogic.actions.setDashboardTemplateId('123');\n  dashboardTemplateEditorLogic.actions.openDashboardTemplateEditor();\n  dashboardTemplateEditorLogic.actions.setEditorValue(JSON.stringify({\n    id: '123',\n    template_name: 'My Template'\n  }, null, 4));\n  return <div className=\"bg-default p-4\">\n            <DashboardTemplateEditor inline={true} />\n        </div>;\n}",...EditTemplate.parameters?.docs?.source}}};let __namedExportsOrder=["CreateTemplate","EditTemplate"]},"../../frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{v:()=>DashboardTemplateEditor});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_monaco_CodeEditor__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/monaco/CodeEditor.tsx"),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/dashboard/dashboardTemplateEditorLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DashboardTemplateEditor(_ref){let{inline=!1}=_ref,{closeDashboardTemplateEditor,createDashboardTemplate,updateDashboardTemplate,setEditorValue,updateValidationErrors}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_3__.X),{isOpenNewDashboardTemplateModal,editorValue,validationErrors,templateSchema,id}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_3__.X);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.fQ,{title:id?"Edit dashboard template":"New dashboard template",isOpen:isOpenNewDashboardTemplateModal,width:1e3,onClose:()=>{closeDashboardTemplateEditor()},inline:inline,footer:id?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"primary","data-attr":"update-dashboard-template-button",onClick:()=>{updateDashboardTemplate({id})},disabledReason:validationErrors.length?`There are ${validationErrors.length} errors to resolve: ${validationErrors.map(e=>" "+e)}`:void 0,children:"Update template"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"primary","data-attr":"create-dashboard-template-button",onClick:()=>{createDashboardTemplate()},disabledReason:validationErrors.length?`There are ${validationErrors.length} errors to resolve:${validationErrors.map(e=>" "+e)}`:void 0,children:"Create new template"}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(lib_monaco_CodeEditor__WEBPACK_IMPORTED_MODULE_2__.p,{className:"border",language:"json",value:editorValue,onChange:v=>{setEditorValue(null!=v?v:"")},onValidate:markers=>{updateValidationErrors(markers)},path:id?`dashboard-templates/${id}.json`:"dashboard-templates/new.json",schema:templateSchema,height:600})})}},"../../frontend/src/scenes/dashboard/dashboardTemplateEditorLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X:()=>dashboardTemplateEditorLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/dashboard/dashboards/templates/dashboardTemplatesLogic.tsx");let dashboardTemplateEditorLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","dashboard","dashboardTemplateEditorLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({logic:[_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_5__.R],values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__.featureFlagLogic,["featureFlags"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setEditorValue:value=>({value}),setDashboardTemplate:dashboardTemplate=>({dashboardTemplate}),clear:!0,setDashboardTemplateId:id=>({id}),openDashboardTemplateEditor:!0,closeDashboardTemplateEditor:!0,updateValidationErrors:markers=>({markers})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({editorValue:["",{setEditorValue:(_,_ref)=>{let{value}=_ref;return value},clear:()=>""}],dashboardTemplate:[null,{clear:()=>null,setDashboardTemplate:(_,_ref2)=>{let{dashboardTemplate}=_ref2;return dashboardTemplate}}],validationErrors:[[],{updateValidationErrors:(_,_ref3)=>{let{markers}=_ref3;return markers&&0!==markers.length?markers.map(marker=>marker.message):[]},clear:()=>[]}],id:[null,{setDashboardTemplateId:(_,_ref4)=>{let{id}=_ref4;return id},clear:()=>null}],isOpenNewDashboardTemplateModal:[!1,{openDashboardTemplateEditor:()=>!0,closeDashboardTemplateEditor:()=>!1}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref5=>{let{values}=_ref5;return{dashboardTemplate:[void 0,{createDashboardTemplate:async()=>{if(!values.dashboardTemplate){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.UJ.error("Unable to create dashboard template");return}let response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.create(values.dashboardTemplate);return _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.UJ.success("Dashboard template created"),response},getDashboardTemplate:async id=>await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.get(id),updateDashboardTemplate:async _ref6=>{let{id,dashboardTemplateUpdates}=_ref6,response=null;if(dashboardTemplateUpdates)response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.update(id,dashboardTemplateUpdates);else if(values.dashboardTemplate)response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.update(id,values.dashboardTemplate);else{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.UJ.error("Unable to update dashboard template");return}return _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.UJ.success("Dashboard template updated"),response},deleteDashboardTemplate:async id=>(await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.delete(id),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.UJ.success("Dashboard template deleted"),null)}],templateSchema:[null,{getTemplateSchema:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.getSchema()}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref7=>{let{values,actions}=_ref7;return{createDashboardTemplateSuccess:async()=>{actions.closeDashboardTemplateEditor(),_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_5__.R.actions.getAllTemplates()},updateDashboardTemplateSuccess:async()=>{actions.closeDashboardTemplateEditor(),_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_5__.R.actions.getAllTemplates()},deleteDashboardTemplateSuccess:async()=>{_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_5__.R.actions.getAllTemplates()},closeDashboardTemplateEditor:()=>{actions.clear()},setDashboardTemplateId:_ref8=>{let{id}=_ref8;id&&actions.getDashboardTemplate(id)},getDashboardTemplateSuccess:async _ref9=>{let{dashboardTemplate}=_ref9;dashboardTemplate&&actions.setEditorValue(JSON.stringify(dashboardTemplate))},setEditorValue:async(_ref10,breakpoint)=>{let{value}=_ref10;if(await breakpoint(500),0==values.validationErrors.length&&value?.length)try{let dashboardTemplate=JSON.parse(value);actions.setDashboardTemplate(dashboardTemplate)}catch(error){console.error("error",error),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.UJ.error("Unable to parse dashboard template")}},updateValidationErrors:async _ref11=>{let{markers}=_ref11;markers?.length||actions.setEditorValue(values.editorValue)},setDashboardTemplate:async _ref12=>{let{dashboardTemplate}=_ref12;dashboardTemplate&&actions.setEditorValue(JSON.stringify(dashboardTemplate,null,4))}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref13=>{let{actions}=_ref13;actions.getTemplateSchema()})])},"../../frontend/src/scenes/dashboard/dashboards/templates/dashboardTemplatesLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>dashboardTemplatesLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts");let dashboardTemplatesLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","dashboard","dashboards","templates","dashboardTemplatesLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{scope}=_ref;return null!=scope?scope:"unknown"}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__.featureFlagLogic,["featureFlags"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setTemplates:allTemplates=>({allTemplates}),setTemplateFilter:search=>({search})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({templateFilter:["",{setTemplateFilter:(_,_ref2)=>{let{search}=_ref2;return search}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.lazyLoaders)(_ref3=>{let{props,values}=_ref3;return{allTemplates:[[],{getAllTemplates:async()=>{let params={scope:"default"!==props.scope?props.scope:void 0,search:values.templateFilter.length>2?values.templateFilter:void 0};return(await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.list(params)).results}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions}=_ref4;return{setTemplateFilter:async(_,breakpoint)=>{await breakpoint(100),actions.getAllTemplates()}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.urlToAction)(_ref5=>{let{actions}=_ref5;return{"/dashboard":(_,searchParams)=>{searchParams.templateFilter&&actions.setTemplateFilter(searchParams.templateFilter)}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.actionToUrl)(_ref6=>{let{values}=_ref6;return{setTemplateFilter:()=>{let searchParams={...kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.searchParams};return searchParams.templateFilter=values.templateFilter,values.templateFilter||delete searchParams.templateFilter,["/dashboard",searchParams,kea_router__WEBPACK_IMPORTED_MODULE_2__.router.values.hashParams,{replace:!0}]}}})])}}]);