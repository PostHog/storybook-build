"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[60711],{"../../frontend/src/scenes/authentication/Login.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Cloud:()=>Cloud,CloudEU:()=>CloudEU,CloudWithGoogleLoginEnforcement:()=>CloudWithGoogleLoginEnforcement,SSOError:()=>SSOError,SecondFactor:()=>SecondFactor,SelfHosted:()=>SelfHosted,SelfHostedWithSAML:()=>SelfHostedWithSAML,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var kea_router__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_hooks_useOnMountEffect__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/hooks/useOnMountEffect.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_mocks_browser__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/mocks/browser.tsx"),_mocks_fixtures_preflight_json__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/mocks/fixtures/_preflight.json"),_Login__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/authentication/Login.tsx"),_Login2FA__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/authentication/Login2FA.tsx"),_loginLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/authentication/loginLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let __WEBPACK_DEFAULT_EXPORT__={title:"Scenes-Other/Login",parameters:{layout:"fullscreen",viewMode:"story",testOptions:{waitForSelector:".BridgePage__left__message--enter-done"}},decorators:[(0,_mocks_browser__WEBPACK_IMPORTED_MODULE_3__.x8)({post:{"/api/login/precheck":{sso_enforcement:null,saml_available:!1}}})]},Cloud=()=>((0,_mocks_browser__WEBPACK_IMPORTED_MODULE_3__.ok)({get:{"/_preflight":{..._mocks_fixtures_preflight_json__WEBPACK_IMPORTED_MODULE_4__,cloud:!0,realm:"cloud",can_create_org:!0,available_social_auth_providers:{github:!0,gitlab:!0,"google-oauth2":!0,saml:!1}}}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Login__WEBPACK_IMPORTED_MODULE_5__.Login,{})),CloudEU=()=>((0,_mocks_browser__WEBPACK_IMPORTED_MODULE_3__.ok)({get:{"/_preflight":{..._mocks_fixtures_preflight_json__WEBPACK_IMPORTED_MODULE_4__,cloud:!0,region:"EU",realm:"cloud",can_create_org:!0,available_social_auth_providers:{github:!0,gitlab:!0,"google-oauth2":!0,saml:!1}}}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Login__WEBPACK_IMPORTED_MODULE_5__.Login,{})),CloudWithGoogleLoginEnforcement=()=>((0,_mocks_browser__WEBPACK_IMPORTED_MODULE_3__.ok)({get:{"/_preflight":{..._mocks_fixtures_preflight_json__WEBPACK_IMPORTED_MODULE_4__,cloud:!0,realm:"cloud",can_create_org:!0,available_social_auth_providers:{github:!0,gitlab:!0,"google-oauth2":!0,saml:!1}}},post:{"/api/login/precheck":{sso_enforcement:"google-oauth2",saml_available:!1}}}),(0,lib_hooks_useOnMountEffect__WEBPACK_IMPORTED_MODULE_1__.f)(()=>{_loginLogic__WEBPACK_IMPORTED_MODULE_7__.l.actions.setLoginValue("email","test@posthog.com"),_loginLogic__WEBPACK_IMPORTED_MODULE_7__.l.actions.precheck({email:"test@posthog.com"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Login__WEBPACK_IMPORTED_MODULE_5__.Login,{}));CloudWithGoogleLoginEnforcement.parameters={testOptions:{waitForSelector:'[href^="/login/google-oauth2/"]'}};let SelfHosted=()=>((0,_mocks_browser__WEBPACK_IMPORTED_MODULE_3__.ok)({get:{"/_preflight":{..._mocks_fixtures_preflight_json__WEBPACK_IMPORTED_MODULE_4__,cloud:!1,realm:"hosted-clickhouse",available_social_auth_providers:{github:!1,gitlab:!1,"google-oauth2":!1,saml:!1}}}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Login__WEBPACK_IMPORTED_MODULE_5__.Login,{})),SelfHostedWithSAML=()=>((0,_mocks_browser__WEBPACK_IMPORTED_MODULE_3__.ok)({get:{"/_preflight":{..._mocks_fixtures_preflight_json__WEBPACK_IMPORTED_MODULE_4__,cloud:!1,realm:"hosted-clickhouse",available_social_auth_providers:{github:!1,gitlab:!1,"google-oauth2":!1,saml:!0}}}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Login__WEBPACK_IMPORTED_MODULE_5__.Login,{}));SelfHostedWithSAML.parameters={testOptions:{waitForSelector:'[href^="/login/saml/"]'}};let SSOError=()=>((0,_mocks_browser__WEBPACK_IMPORTED_MODULE_3__.ok)({get:{"/_preflight":_mocks_fixtures_preflight_json__WEBPACK_IMPORTED_MODULE_4__}}),(0,lib_hooks_useOnMountEffect__WEBPACK_IMPORTED_MODULE_1__.f)(()=>kea_router__WEBPACK_IMPORTED_MODULE_0__.router.actions.push(`${scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.login()}?error_code=improperly_configured_sso`)),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Login__WEBPACK_IMPORTED_MODULE_5__.Login,{})),SecondFactor=()=>((0,lib_hooks_useOnMountEffect__WEBPACK_IMPORTED_MODULE_1__.f)(()=>kea_router__WEBPACK_IMPORTED_MODULE_0__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.login2FA())),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Login2FA__WEBPACK_IMPORTED_MODULE_6__.Login2FA,{}));Cloud.parameters={...Cloud.parameters,docs:{...Cloud.parameters?.docs,source:{originalSource:"() => {\n  useStorybookMocks({\n    get: {\n      '/_preflight': {\n        ...preflightJson,\n        cloud: true,\n        realm: 'cloud',\n        can_create_org: true,\n        available_social_auth_providers: {\n          github: true,\n          gitlab: true,\n          'google-oauth2': true,\n          saml: false\n        }\n      }\n    }\n  });\n  return <Login />;\n}",...Cloud.parameters?.docs?.source}}},CloudEU.parameters={...CloudEU.parameters,docs:{...CloudEU.parameters?.docs,source:{originalSource:"() => {\n  useStorybookMocks({\n    get: {\n      '/_preflight': {\n        ...preflightJson,\n        cloud: true,\n        region: 'EU',\n        realm: 'cloud',\n        can_create_org: true,\n        available_social_auth_providers: {\n          github: true,\n          gitlab: true,\n          'google-oauth2': true,\n          saml: false\n        }\n      }\n    }\n  });\n  return <Login />;\n}",...CloudEU.parameters?.docs?.source}}},CloudWithGoogleLoginEnforcement.parameters={...CloudWithGoogleLoginEnforcement.parameters,docs:{...CloudWithGoogleLoginEnforcement.parameters?.docs,source:{originalSource:"() => {\n  useStorybookMocks({\n    get: {\n      '/_preflight': {\n        ...preflightJson,\n        cloud: true,\n        realm: 'cloud',\n        can_create_org: true,\n        available_social_auth_providers: {\n          github: true,\n          gitlab: true,\n          'google-oauth2': true,\n          saml: false\n        }\n      }\n    },\n    post: {\n      '/api/login/precheck': {\n        sso_enforcement: 'google-oauth2',\n        saml_available: false\n      }\n    }\n  });\n\n  // Trigger pre-check\n  useDelayedOnMountEffect(() => {\n    loginLogic.actions.setLoginValue('email', 'test@posthog.com');\n    loginLogic.actions.precheck({\n      email: 'test@posthog.com'\n    });\n  });\n  return <Login />;\n}",...CloudWithGoogleLoginEnforcement.parameters?.docs?.source}}},SelfHosted.parameters={...SelfHosted.parameters,docs:{...SelfHosted.parameters?.docs,source:{originalSource:"() => {\n  useStorybookMocks({\n    get: {\n      '/_preflight': {\n        ...preflightJson,\n        cloud: false,\n        realm: 'hosted-clickhouse',\n        available_social_auth_providers: {\n          github: false,\n          gitlab: false,\n          'google-oauth2': false,\n          saml: false\n        }\n      }\n    }\n  });\n  return <Login />;\n}",...SelfHosted.parameters?.docs?.source}}},SelfHostedWithSAML.parameters={...SelfHostedWithSAML.parameters,docs:{...SelfHostedWithSAML.parameters?.docs,source:{originalSource:"() => {\n  useStorybookMocks({\n    get: {\n      '/_preflight': {\n        ...preflightJson,\n        cloud: false,\n        realm: 'hosted-clickhouse',\n        available_social_auth_providers: {\n          github: false,\n          gitlab: false,\n          'google-oauth2': false,\n          saml: true\n        }\n      }\n    }\n  });\n  return <Login />;\n}",...SelfHostedWithSAML.parameters?.docs?.source}}},SSOError.parameters={...SSOError.parameters,docs:{...SSOError.parameters?.docs,source:{originalSource:"() => {\n  useStorybookMocks({\n    get: {\n      '/_preflight': preflightJson\n    }\n  });\n  useDelayedOnMountEffect(() => router.actions.push(`${urls.login()}?error_code=improperly_configured_sso`));\n  return <Login />;\n}",...SSOError.parameters?.docs?.source}}},SecondFactor.parameters={...SecondFactor.parameters,docs:{...SecondFactor.parameters?.docs,source:{originalSource:"() => {\n  useDelayedOnMountEffect(() => router.actions.push(urls.login2FA()));\n  return <Login2FA />;\n}",...SecondFactor.parameters?.docs?.source}}};let __namedExportsOrder=["Cloud","CloudEU","CloudWithGoogleLoginEnforcement","SelfHosted","SelfHostedWithSAML","SSOError","SecondFactor"]},"../../frontend/src/scenes/authentication/Login2FA.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Login2FA:()=>Login2FA});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),BridgePage=__webpack_require__("../../frontend/src/lib/components/BridgePage/BridgePage.tsx"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),api=__webpack_require__("../../frontend/src/lib/api.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),loginLogic=__webpack_require__("../../frontend/src/scenes/authentication/loginLogic.ts");let login2FALogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","authentication","login2FALogic"]),(0,index_esm.connect)(()=>({values:[preflightLogic.preflightLogic,["preflight"],featureFlagLogic.featureFlagLogic,["featureFlags"]]})),(0,index_esm.actions)({setGeneralError:(code,detail)=>({code,detail}),setLoginStep:step=>({step}),clearGeneralError:!0}),(0,index_esm.reducers)({generalError:[null,{setGeneralError:(_,error)=>error,clearGeneralError:()=>null}]}),(0,lib.forms)(_ref=>{let{actions}=_ref;return{twofactortoken:{defaults:{token:""},errors:_ref2=>{let{token}=_ref2;return{token:token?null:"Please enter a token to continue"}},submit:async(_ref3,breakpoint)=>{let{token}=_ref3;breakpoint();try{return await api.ZP.create("api/login/token",{token})}catch(e){let{code,detail}=e;throw actions.setGeneralError(code,detail),e}}}}}),(0,index_esm.listeners)({submitTwofactortokenSuccess:()=>{(0,loginLogic.w)(),window.location.reload()}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function Login2FA(){let{isTwofactortokenSubmitting,generalError}=(0,index_esm.useValues)(login2FALogic),{preflight}=(0,index_esm.useValues)(preflightLogic.preflightLogic);return(0,jsx_runtime.jsx)(BridgePage.N,{view:"login",hedgehog:!0,message:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Welcome to",(0,jsx_runtime.jsx)("br",{})," PostHog",preflight?.cloud?" Cloud":"","!"]}),children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)("h2",{children:"Two-Factor Authentication"}),(0,jsx_runtime.jsx)("p",{children:"Enter a token from your authenticator app or a backup code."}),(0,jsx_runtime.jsxs)(lib.Form,{logic:login2FALogic,formKey:"twofactortoken",enableFormOnSubmit:!0,className:"deprecated-space-y-4",children:[generalError&&(0,jsx_runtime.jsx)(LemonBanner.V,{type:"error",children:generalError.detail}),(0,jsx_runtime.jsx)(LemonField.D,{name:"token",label:"Authenticator token",children:(0,jsx_runtime.jsx)(src.DF,{className:"ph-ignore-input",autoFocus:!0,"data-attr":"token",placeholder:"123456",inputMode:"numeric",autoComplete:"one-time-code"})}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",status:"alt",htmlType:"submit","data-attr":"2fa-login",fullWidth:!0,center:!0,loading:isTwofactortokenSubmitting,size:"large",children:"Login"})]})]})})}}}]);