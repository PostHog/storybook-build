"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[75126],{"./frontend/src/scenes/pipeline/frontendAppsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>frontendAppsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");let frontendAppsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","frontendAppsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic,["currentTeamId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_frontend_apps")}],pluginConfigs:[{},{loadPluginConfigs:async()=>{let res=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/pipeline_frontend_apps_configs`);return Object.fromEntries(res.map(pluginConfig=>[pluginConfig.id,pluginConfig]))},toggleEnabled:async _ref2=>{let{id,enabled}=_ref2;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.SiteApp,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref3=>{let{pluginConfig}=_ref3;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],frontendApps:[s=>[s.plugins,s.pluginConfigs],(plugins,pluginConfigs)=>{let rawFrontendApp=Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})),convertedFrontendApps=rawFrontendApp.map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.SiteApp)),enabledFirst=convertedFrontendApps.sort((a,b)=>Number(b.enabled)-Number(a.enabled));return enabledFirst}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadPlugins(),actions.loadPluginConfigs()})])},"./frontend/src/scenes/pipeline/hogfunctions/HogFunctionIcon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>HogFunctionIcon,g:()=>HogFunctionIconEditable});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts");let hogFunctionIconLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>{var _props$logicKey;return null!==(_props$logicKey=props.logicKey)&&void 0!==_props$logicKey?_props$logicKey:"default"}),(0,index_esm.path)(key=>["scenes","pipeline","hogfunctions","hogFunctionIconLogic",key]),(0,index_esm.actions)({loadPossibleIcons:!0,setShowPopover:show=>({show}),setSearchTerm:search=>({search})}),(0,index_esm.reducers)({showPopover:[!1,{setShowPopover:(_,_ref)=>{let{show}=_ref;return show}}],searchTerm:[null,{setSearchTerm:(_,_ref2)=>{let{search}=_ref2;return search},setShowPopover:()=>null}]}),(0,lib.loaders)(_ref3=>{let{props,values}=_ref3;return{possibleIcons:[null,{loadPossibleIcons:async(_,breakpoint)=>{var _values$searchTerm;let search=null!==(_values$searchTerm=values.searchTerm)&&void 0!==_values$searchTerm?_values$searchTerm:props.search;if(!search)return[];await breakpoint(1e3);let res=await api.ZP.hogFunctions.listIcons({query:search});return res.map(icon=>({...icon,url:icon.url+"&temp=true"}))}}]}}),(0,index_esm.listeners)(_ref4=>{let{actions,values,props}=_ref4;return{loadPossibleIconsSuccess:async()=>{let autoChange=props.onChange&&(!props.src||props.src.includes("temp=true"));if(!autoChange)return;let firstValue=values.possibleIcons?.[0];firstValue&&props.onChange?.(firstValue.url)},setShowPopover:_ref5=>{let{show}=_ref5;show&&actions.loadPossibleIcons()},setSearchTerm:()=>{actions.loadPossibleIcons()}}}),(0,index_esm.propsChanged)((_ref6,oldProps)=>{let{props,actions}=_ref6;props.onChange&&(!props.src||props.search!==oldProps.search&&props.src.includes("temp=true"))&&actions.loadPossibleIcons()})]);var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let fileToBase64=file=>new Promise(resolve=>{if(!file)return;let reader=new FileReader;reader.onload=e=>{let img=new Image;img.onload=()=>{let canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=128,canvas.height=128,ctx.drawImage(img,0,0,128,128);let dataURI=canvas.toDataURL();resolve(dataURI)},img.src=e.target?.result},reader.readAsDataURL(file)});function HogFunctionIconEditable(_ref){var _possibleIcons$map;let{size="medium",...props}=_ref,{possibleIconsLoading,showPopover,possibleIcons,searchTerm}=(0,index_esm.useValues)(hogFunctionIconLogic(props)),{setShowPopover,setSearchTerm}=(0,index_esm.useActions)(hogFunctionIconLogic(props)),content=(0,jsx_runtime.jsxs)("span",{className:(0,clsx_m.default)("relative cursor-pointer",{"w-8 h-8":"small"===size,"w-10 h-10":"medium"===size,"w-12 h-12":"large"===size}),onClick:()=>setShowPopover(!showPopover),children:[possibleIconsLoading?(0,jsx_runtime.jsx)(src.Spinner,{className:"absolute -top-1 -right-1"}):null,(0,jsx_runtime.jsx)(HogFunctionIcon,{size:size,src:props.src})]});return props.onChange?(0,jsx_runtime.jsx)(src.Popover,{showArrow:!0,visible:showPopover,onClickOutside:()=>setShowPopover(!1),overlay:(0,jsx_runtime.jsxs)("div",{className:"p-1 w-100 space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,jsx_runtime.jsx)("h2",{className:"m-0",children:"Choose an icon"}),(0,jsx_runtime.jsx)(src.LemonFileInput,{multiple:!1,accept:"image/*",showUploadedFiles:!1,onChange:files=>{fileToBase64(files[0]).then(dataURI=>{props.onChange?.(dataURI)}).catch(()=>{src.lemonToast.error("Error uploading image")})},callToAction:(0,jsx_runtime.jsx)(src.LemonButton,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.bn,{}),children:"Upload image"})})]}),(0,jsx_runtime.jsx)(src.LemonInput,{size:"small",type:"search",placeholder:"Search for company logos",fullWidth:!0,value:null!=searchTerm?searchTerm:"",onChange:setSearchTerm,prefix:possibleIconsLoading?(0,jsx_runtime.jsx)(src.Spinner,{}):void 0}),(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap gap-2",children:null!==(_possibleIcons$map=possibleIcons?.map(icon=>jsx_runtime.jsx("span",{className:"w-14 h-14 cursor-pointer",onClick:()=>{let nonTempUrl=icon.url.replace("&temp=true","");props.onChange?.(nonTempUrl),setShowPopover(!1)},children:jsx_runtime.jsx("img",{src:icon.url,title:icon.name,className:"w-full h-full rounded overflow-hidden"})},icon.id)))&&void 0!==_possibleIcons$map?_possibleIcons$map:possibleIconsLoading?(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"w-14 h-14",repeat:4}):"No icons found"})]}),children:content}):content}function HogFunctionIcon(_ref2){let{src,size="medium"}=_ref2;return(0,jsx_runtime.jsx)("span",{className:(0,clsx_m.default)("flex items-center justify-center",{"w-8 h-8 text-2xl":"small"===size,"w-10 h-10 text-4xl":"medium"===size,"w-12 h-12 text-6xl":"large"===size}),children:src?(0,jsx_runtime.jsx)("img",{className:"w-full h-full rounded overflow-hidden",src:src}):(0,jsx_runtime.jsx)("span",{children:"\uD83E\uDD94"})})}},"./frontend/src/scenes/pipeline/importAppsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>importAppsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");let importAppsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","importAppsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic,["currentTeamId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_import_apps")}],pluginConfigs:[{},{loadPluginConfigs:async()=>{let res=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/pipeline_import_apps_configs`);return Object.fromEntries(res.map(pluginConfig=>[pluginConfig.id,pluginConfig]))},toggleEnabled:async _ref2=>{let{id,enabled}=_ref2;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.ImportApp,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref3=>{let{pluginConfig}=_ref3;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],importApps:[s=>[s.plugins,s.pluginConfigs],(plugins,pluginConfigs)=>{let rawImportApp=Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})),convertedImportApps=rawImportApp.map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.ImportApp)),enabledFirst=convertedImportApps.sort((a,b)=>Number(b.enabled)-Number(a.enabled));return enabledFirst}],hasEnabledImportApps:[s=>[s.importApps],importApps=>importApps.some(app=>app.enabled)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadPlugins(),actions.loadPluginConfigs()})])},"./frontend/src/scenes/pipeline/pipelineNodeMetricsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>pipelineNodeMetricsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/utils.tsx"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");let pipelineNodeMetricsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{id}=_ref;return id}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(id=>["scenes","pipeline","appMetricsLogic",id]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic,["currentTeamId"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setDateRange:(from,to)=>({from,to}),openErrorDetailsModal:errorType=>({errorType}),closeErrorDetailsModal:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values,props}=_ref2;return{appMetricsResponse:[null,{loadMetrics:async()=>{let params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({date_from:values.dateRange.from,date_to:values.dateRange.to});return await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic.values.currentTeamId}/app_metrics/${props.id}?${params}`)}}],errorDetails:[[],{openErrorDetailsModal:async _ref3=>{let{errorType}=_ref3,params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({error_type:errorType}),{result}=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic.values.currentTeamId}/app_metrics/${props.id}/error_details?${params}`);return result}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({dateRange:[{from:"-7d",to:null},{setDateRange:(_,_ref4)=>{let{from,to}=_ref4;return{from:null!=from?from:"-7d",to:to}}}],errorDetailsModalError:[null,{openErrorDetailsModal:(_,_ref5)=>{let{errorType}=_ref5;return errorType},closeErrorDetailsModal:()=>null}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref6=>{let{actions}=_ref6;return{setDateRange:()=>{actions.loadMetrics()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref7=>{let{actions}=_ref7;actions.loadMetrics()})])},"./frontend/src/scenes/pipeline/pipelineNodeMetricsV2Logic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{K:()=>pipelineNodeMetricsV2Logic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts");let pipelineNodeMetricsV2Logic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{id}=_ref;return id}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(id=>["scenes","pipeline","appMetricsLogic",id]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:filters=>({filters})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values,props}=_ref2;return{appMetrics:[null,{loadMetrics:async()=>{let params={...values.filters,breakdown_by:"name"};return await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.hogFunctions.metrics(props.id,params)}}],appMetricsTotals:[null,{loadMetricsTotals:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.hogFunctions.metricsTotals(props.id,{breakdown_by:"name"})}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({filters:[{before:void 0,after:"-7d",interval:"day"},{setFilters:(state,_ref3)=>{let{filters}=_ref3;return{...state,...filters}}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions}=_ref4;return{setFilters:async(_,breakpoint)=>{await breakpoint(100),actions.loadMetrics()}}})])},"./frontend/src/scenes/pipeline/transformationsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>pipelineTransformationsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");let pipelineTransformationsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","transformationsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic,["currentTeamId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,openReorderModal:!0,closeReorderModal:!0,setTemporaryOrder:tempOrder=>({tempOrder}),savePluginConfigsOrder:newOrders=>({newOrders}),updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_transformations")}],temporaryOrder:[{},{setTemporaryOrder:async _ref2=>{let{tempOrder}=_ref2;return tempOrder},closeReorderModal:async()=>({})}],pluginConfigs:[{},{loadPluginConfigs:async()=>{let res=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/pipeline_transformation_configs`);return Object.fromEntries(res.map(pluginConfig=>[pluginConfig.id,pluginConfig]))},savePluginConfigsOrder:async _ref3=>{let{newOrders}=_ref3;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,!1))return values.pluginConfigs;let{pluginConfigs}=values,response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update("api/plugin_config/rearrange",{orders:newOrders}),newPluginConfigs={...pluginConfigs};for(let pluginConfig of response)Object.keys(values.plugins).map(Number).includes(pluginConfig.plugin)&&(newPluginConfigs[pluginConfig.id]=pluginConfig);return newPluginConfigs},toggleEnabled:async _ref4=>{let{id,enabled}=_ref4;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let order={};enabled&&(order={order:values.nextAvailableOrder});let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled,...order});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref5=>{let{pluginConfig}=_ref5;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],transformations:[s=>[s.pluginConfigs,s.plugins],(pluginConfigs,plugins)=>{let rawTransformations=Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})),convertedTransformations=rawTransformations.map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation));return convertedTransformations}],sortedEnabledTransformations:[s=>[s.transformations,s.temporaryOrder],(transformations,temporaryOrder)=>(transformations=transformations.filter(t=>t.enabled),transformations=temporaryOrder&&Object.keys(temporaryOrder).length>0?Object.entries(temporaryOrder).sort((_ref6,_ref7)=>{let[,aIdx]=_ref6,[,bIdx]=_ref7;return aIdx-bIdx}).map(_ref8=>{let[pluginId]=_ref8;return transformations.find(t=>t.id===Number(pluginId))}):transformations.sort((a,b)=>a.order-b.order))],sortedTransformations:[s=>[s.transformations,s.sortedEnabledTransformations],(transformations,sortedEnabledTransformations)=>sortedEnabledTransformations.concat(transformations.filter(t=>!t.enabled).sort((a,b)=>a.id-b.id))],nextAvailableOrder:[s=>[s.transformations],transformations=>{let enabledTransformations=transformations.filter(t=>t.enabled);return enabledTransformations.length>0?Math.max(...enabledTransformations.map(t=>t.order),0)+1:0}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({reorderModalOpen:[!1,{openReorderModal:()=>!0,closeReorderModal:()=>!1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref9=>{let{actions}=_ref9;return{savePluginConfigsOrderSuccess:()=>{actions.closeReorderModal()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref10=>{let{actions}=_ref10;actions.loadPlugins(),actions.loadPluginConfigs()})])}}]);