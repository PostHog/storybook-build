(self.webpackChunk_posthog_frontend=self.webpackChunk_posthog_frontend||[]).push([[29705],{"./frontend/src/scenes/data-warehouse/editor/EditorScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EditorScene:()=>EditorScene});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.10.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),CopyToClipboard=__webpack_require__("./frontend/src/lib/components/CopyToClipboard.tsx"),DatabaseTableTree=__webpack_require__("./frontend/src/lib/components/DatabaseTableTree/DatabaseTableTree.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonMenu=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMenu/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),sceneTypes=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),Sidebar=__webpack_require__("./frontend/src/layout/navigation-3000/components/Sidebar.tsx"),viewLinkLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/viewLinkLogic.tsx"),ViewLinkModal=__webpack_require__("./frontend/src/scenes/data-warehouse/ViewLinkModal.tsx"),editorSceneLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/editor/editorSceneLogic.ts"),editorSidebarLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/editor/editorSidebarLogic.tsx"),resizerLogic=__webpack_require__("./frontend/src/lib/components/Resizer/resizerLogic.ts");let editorSizingLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","editorSizingLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(props=>({values:[(0,resizerLogic.Z)(props.sourceNavigatorResizerProps),["desiredSize as sourceNavigatorDesiredSize"],(0,resizerLogic.Z)(props.queryPaneResizerProps),["desiredSize as queryPaneDesiredSize"]]})),(0,index_esm.selectors)({editorSceneRef:[()=>[(_,props)=>props.editorSceneRef],editorSceneRef=>editorSceneRef],sourceNavigatorWidth:[s=>[s.sourceNavigatorDesiredSize],desiredSize=>Math.max(desiredSize||350,100)],queryPaneHeight:[s=>[s.queryPaneDesiredSize],queryPaneDesiredSize=>Math.max(queryPaneDesiredSize||400,100)],queryTabsWidth:[s=>[s.queryPaneDesiredSize],desiredSize=>desiredSize||350],sourceNavigatorResizerProps:[()=>[(_,props)=>props.sourceNavigatorResizerProps],sourceNavigatorResizerProps=>sourceNavigatorResizerProps],queryPaneResizerProps:[()=>[(_,props)=>props.queryPaneResizerProps],queryPaneResizerProps=>queryPaneResizerProps]})]);var lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),dataNodeLogic=__webpack_require__("./frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),variableModalLogic=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/Components/Variables/variableModalLogic.ts"),variablesLogic=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/Components/Variables/variablesLogic.ts"),dataVisualizationLogic=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/dataVisualizationLogic.ts"),displayLogic=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/displayLogic.ts"),types=__webpack_require__("./frontend/src/types.ts"),multitabEditorLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/editor/multitabEditorLogic.tsx");__webpack_require__("./node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-data-grid/lib/styles.css");var injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),DataGrid=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.2_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/data-warehouse/editor/DataGrid.scss"),DataGrid_default=__webpack_require__.n(DataGrid),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(DataGrid_default(),options),DataGrid_default().locals;var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),ExportButton=__webpack_require__("./frontend/src/lib/components/ExportButton/ExportButton.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),LoadingBar=__webpack_require__("./frontend/src/lib/lemon-ui/LoadingBar/index.ts"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),bundle=__webpack_require__("./node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-data-grid/lib/bundle.js"),EmptyStates=__webpack_require__("./frontend/src/scenes/insights/EmptyStates/index.ts"),BoldNumber=__webpack_require__("./frontend/src/scenes/insights/views/BoldNumber/BoldNumber.tsx"),KeyboardShortcut=__webpack_require__("./frontend/src/layout/navigation-3000/components/KeyboardShortcut.tsx"),themeLogic=__webpack_require__("./frontend/src/layout/navigation-3000/themeLogic.ts"),ElapsedTime=__webpack_require__("./frontend/src/queries/nodes/DataNode/ElapsedTime.tsx"),LoadNext=__webpack_require__("./frontend/src/queries/nodes/DataNode/LoadNext.tsx"),LineGraph=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/Components/Charts/LineGraph.tsx"),SideBar=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/Components/SideBar.tsx"),Table=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/Components/Table.tsx"),TableDisplay=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/Components/TableDisplay.tsx"),AddVariableButton=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/Components/Variables/AddVariableButton.tsx"),Variables=__webpack_require__("./frontend/src/queries/nodes/DataVisualization/Components/Variables/Variables.tsx"),dataWarehouseViewsLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/saved_queries/dataWarehouseViewsLogic.tsx");let OutputTab=function(OutputTab){return OutputTab.Results="results",OutputTab.Visualization="visualization",OutputTab.Info="info",OutputTab.Lineage="lineage",OutputTab}({}),outputPaneLogic=(0,index_esm.kea)([(0,index_esm.path)(["data-warehouse","editor","outputPaneLogic"]),(0,index_esm.actions)({setActiveTab:tab=>({tab})}),(0,index_esm.reducers)({activeTab:[OutputTab.Results,{setActiveTab:(_,_ref)=>{let{tab}=_ref;return tab}}]})]);var LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function TabScroller(_ref){let{children}=_ref;return(0,jsx_runtime.jsx)("div",{className:"relative w-full overflow-auto",children:(0,jsx_runtime.jsx)("div",{className:"flex-1 absolute top-0 left-0 right-0 bottom-0",children:children})})}var databaseTableListLogic=__webpack_require__("./frontend/src/scenes/data-management/database/databaseTableListLogic.ts");let infoTabLogic=(0,index_esm.kea)([(0,index_esm.path)(["data-warehouse","editor","outputPaneTabs","infoTabLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.codeEditorKey),(0,index_esm.connect)(props=>({values:[(0,multitabEditorLogic.tg)({key:props.codeEditorKey}),["metadata"],databaseTableListLogic.A,["posthogTablesMap","dataWarehouseTablesMap"],dataWarehouseViewsLogic.$,["dataWarehouseSavedQueryMap"]]})),(0,index_esm.selectors)({sourceTableItems:[s=>[s.metadata,s.dataWarehouseSavedQueryMap],(metadata,dataWarehouseSavedQueryMap)=>metadata&&metadata.table_names?.map(table_name=>{let view=dataWarehouseSavedQueryMap[table_name];return view?{name:table_name,type:"table",view_id:view.id,status:view.status,last_run_at:view.last_run_at||"never"}:{name:table_name,type:"source",status:void 0,last_run_at:void 0}})||[]]})]),OPTIONS=[{value:"never",label:" No resync"},{value:"5min",label:" Resync every 5 mins"},{value:"30min",label:" Resync every 30 mins"},{value:"1hour",label:" Resync every 1 hour"},{value:"6hour",label:" Resync every 6 hours"},{value:"12hour",label:" Resync every 12 hours"},{value:"24hour",label:" Resync Daily"},{value:"7day",label:" Resync Weekly"},{value:"30day",label:" Resync Monthly"}];function InfoTab(_ref){let{codeEditorKey}=_ref,{sourceTableItems}=(0,index_esm.useValues)(infoTabLogic({codeEditorKey:codeEditorKey})),{editingView}=(0,index_esm.useValues)(multitabEditorLogic.tg),{runDataWarehouseSavedQuery}=(0,index_esm.useActions)(multitabEditorLogic.tg),{dataWarehouseSavedQueryMapById}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{updateDataWarehouseSavedQuery}=(0,index_esm.useActions)(dataWarehouseViewsLogic.$),savedQuery=editingView?dataWarehouseSavedQueryMapById[editingView.id]:null;return(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 p-4 gap-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:"Materialization"}),(0,jsx_runtime.jsx)(src.oe,{type:"warning",children:"BETA"})]}),(0,jsx_runtime.jsx)("div",{children:savedQuery?.sync_frequency||savedQuery?.last_run_at?(0,jsx_runtime.jsxs)("div",{children:[savedQuery?.last_run_at?`Last run at ${(0,utils.bo)(savedQuery?.last_run_at)}`:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("span",{children:"Materialization scheduled"})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,jsx_runtime.jsx)(src.Jp,{loading:savedQuery?.status==="Running",disabledReason:savedQuery?.status==="Running"&&"Query is already running",onClick:()=>editingView&&runDataWarehouseSavedQuery(editingView.id),type:"secondary",children:"Sync now"}),(0,jsx_runtime.jsx)(src.Yv,{className:"h-9",disabledReason:savedQuery?.status==="Running"&&"Query is already running",value:editingView&&dataWarehouseSavedQueryMapById[editingView.id]?.sync_frequency||"never",onChange:newValue=>{editingView&&newValue&&updateDataWarehouseSavedQuery({id:editingView.id,sync_frequency:newValue,types:[[]]})},options:OPTIONS})]})]}):(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("p",{children:"Materialized views are a way to pre-compute data in your data warehouse. This allows you to run queries faster and more efficiently."}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>editingView&&updateDataWarehouseSavedQuery({id:editingView.id,sync_frequency:"24hour",types:[[]]}),type:"primary",disabledReason:editingView?void 0:"You must save the view first",children:"Materialize"})]})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Columns"}),(0,jsx_runtime.jsx)("p",{children:"Columns that are available in the materialized view."})]}),(0,jsx_runtime.jsx)(LemonTable.g,{columns:[{key:"name",title:"Name",render:(_,column)=>column.name},{key:"type",title:"Type",render:(_,column)=>column.type},{key:"schema_valid",title:"Schema Valid",render:(_,column)=>(0,jsx_runtime.jsx)(src.oe,{type:column.schema_valid?"success":"danger",children:column.schema_valid?"Yes":"No"})}],dataSource:savedQuery?.columns||[]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Dependencies"}),(0,jsx_runtime.jsx)("p",{children:"Dependencies are tables that this query uses. See when a source or materialized table was last run."})]}),(0,jsx_runtime.jsx)(LemonTable.g,{columns:[{key:"Name",title:"Name",render:(_,_ref2)=>{let{name}=_ref2;return name}},{key:"Type",title:"Type",render:(_,_ref3)=>{let{type}=_ref3;return type}},{key:"Status",title:"Status",render:(_,_ref4)=>{let{type,status}=_ref4;return"source"===type?(0,jsx_runtime.jsx)(src.u,{title:"This is a source table, so it doesn't have a status",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})}):status}},{key:"Last run at",title:"Last run at",render:(_,_ref5)=>{let{type,last_run_at}=_ref5;return"source"===type?(0,jsx_runtime.jsx)(src.u,{title:"This is a source table, so it is never run",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})}):(0,utils.bo)(last_run_at)}}],dataSource:sourceTableItems})]})})}let Node=function GenericNode(_ref){let{pref,className="",children}=_ref;return(0,jsx_runtime.jsx)("div",{ref:pref,className:`flex w-[200px] px-4 py-3 justify-center items-center space-between gap-1 bg-primary border border-black border-2 rounded-lg ${className}`,children:children})},assignDepths=nodes=>{let nodeMap={};nodes.forEach(node=>{nodeMap[node.nodeId]={...node,depth:-1}});let assignDepthRecursive=(nodeId,currentDepth)=>{let node=nodeMap[nodeId];node&&(node.depth=currentDepth,node.leaf.forEach(leafId=>{nodeMap[leafId]&&assignDepthRecursive(leafId,currentDepth+1)}))};return nodes.forEach(node=>{-1===nodeMap[node.nodeId].depth&&assignDepthRecursive(node.nodeId,0)}),Object.values(nodeMap)},calculateNodePositions=nodesWithDepth=>{nodesWithDepth.sort((a,b)=>a.depth-b.depth);let nodePositions=[],visited=[],dfs=function(nodeId){let row=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(visited.includes(nodeId))return row;visited.push(nodeId);let node=nodesWithDepth.find(n=>n.nodeId===nodeId);if(!node)return row;let nodePosition={...node,position:{x:50+400*node.depth,y:50+300*row}};nodePositions.push(nodePosition);let maxRow=row;return node.leaf.filter(leafId=>!leafId.includes("_joined")).forEach((leafId,index)=>{dfs(leafId,row+index),maxRow=Math.max(maxRow,row+index)}),maxRow},maxRow=0;return nodesWithDepth.forEach(node=>{0===node.depth&&(maxRow=dfs(node.nodeId,maxRow)+1)}),nodePositions},calculateBound=(node,ref)=>{if(!ref)return{...node,left:null,right:null};let{x,y}=node.position,{width,height}=ref.getBoundingClientRect();return{...node,left:{x,y:y+height/2},right:{x:x+width,y:y+height/2}}},calculateEdgesFromTo=(from,to)=>{if(!from.right||!to.left)return[];let edges=[];return edges.push({from:from.right,to:to.left}),edges},calculateEdges=(nodeRefs,nodes)=>{let nodes_map=nodes.reduce((acc,node)=>(acc[node.nodeId]=node,acc),{}),dfs=function(nodeId){let visited=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;if(visited.has(nodeId))return[];visited.add(nodeId);let node=nodes_map[nodeId];if(!node)return[];let nodeRef=nodeRefs.find(ref=>ref?.id===nodeId);if(!nodeRef)return[];let edges=[],fromWithBounds=calculateBound(node,nodeRef);for(let leafId of node.leaf){let toNode=nodes_map[leafId],toRef=nodeRefs.find(ref=>ref?.id===leafId);if(toNode&&toRef){let toWithBounds=calculateBound(toNode,toRef);edges.push(...calculateEdgesFromTo(fromWithBounds,toWithBounds))}edges.push(...dfs(leafId,visited))}return edges},edges=[],visited=new Set;for(let node of nodes)visited.has(node.nodeId)||edges.push(...dfs(node.nodeId,visited));return edges};function NodeCanvas(_ref){let{nodes,renderNode}=_ref,canvasRef=(0,react.useRef)(null),[isDragging,setIsDragging]=(0,react.useState)(!1),[offset,setOffset]=(0,react.useState)({x:0,y:0}),[dragStart,setDragStart]=(0,react.useState)({x:0,y:0}),nodeRefs=(0,react.useRef)(Array(nodes.length).fill(null)),[nodePositions,setNodePositions]=(0,react.useState)([]),[edges,setEdges]=(0,react.useState)([]);(0,react.useEffect)(()=>{setNodePositions(calculateNodePositions(assignDepths(nodes)))},[nodes,offset]),(0,react.useEffect)(()=>{let allNodes=[...nodePositions];setEdges(calculateEdges([...nodeRefs.current],allNodes))},[nodePositions]);let drawGrid=(ctx,canvasWidth,canvasHeight)=>{ctx.fillStyle="#000000",ctx.imageSmoothingEnabled=!0;for(let x=offset.x%10;x<canvasWidth;x+=10)for(let y=offset.y%10;y<canvasHeight;y+=10)ctx.fillRect(x,y,.5,.5)};(0,react.useEffect)(()=>{let canvas=canvasRef.current;if(!canvas)return;let ctx=canvas.getContext("2d");if(!ctx)return;let{width,height}=canvas.getBoundingClientRect();canvas.width=width,canvas.height=height,drawGrid(ctx,width,height);let handleResize=()=>{if(canvas){let{width,height}=canvas.getBoundingClientRect();canvas.width=width,canvas.height=height;let ctx=canvas.getContext("2d");ctx&&drawGrid(ctx,width,height)}};return window.addEventListener("resize",handleResize),()=>window.removeEventListener("resize",handleResize)},[offset,nodePositions]);let handleMouseUp=()=>{setIsDragging(!1)};return(0,jsx_runtime.jsxs)("div",{className:"w-full h-full relative",children:[(0,jsx_runtime.jsx)("canvas",{ref:canvasRef,onMouseDown:e=>{setIsDragging(!0),setDragStart({x:e.clientX-offset.x,y:e.clientY-offset.y})},onMouseMove:e=>{isDragging&&setOffset({x:e.clientX-dragStart.x,y:e.clientY-dragStart.y})},onMouseUp:handleMouseUp,onMouseLeave:handleMouseUp,className:(0,clsx_m.clsx)("w-full h-full absolute inset-0",isDragging?"cursor-grabbing":"cursor-grab")}),(0,jsx_runtime.jsx)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",children:edges.map((edge,index)=>{let controlPoint1X=edge.from.x+offset.x+(edge.to.x-edge.from.x)/3,controlPoint1Y=edge.from.y+offset.y,controlPoint2X=edge.to.x+offset.x-(edge.to.x-edge.from.x)/3,controlPoint2Y=edge.to.y+offset.y;return(0,jsx_runtime.jsx)("path",{d:`M ${edge.from.x+offset.x} ${edge.from.y+offset.y} 
                               C ${controlPoint1X} ${controlPoint1Y}, 
                                 ${controlPoint2X} ${controlPoint2Y}, 
                                 ${edge.to.x+offset.x} ${edge.to.y+offset.y}`,stroke:"var(--text-3000)",strokeWidth:"2",fill:"none"},index)})}),nodePositions.map((nodePosition,idx)=>(0,jsx_runtime.jsx)("div",{className:"absolute",style:{left:`${nodePosition.position.x+offset.x}px`,top:`${nodePosition.position.y+offset.y}px`},children:renderNode(nodePosition,el=>{nodeRefs.current[idx]=el,nodeRefs.current[idx]?.setAttribute("id",nodePosition.nodeId)})},nodePosition.nodeId))]})}var DataWarehouseManagedSourcesTable=__webpack_require__("./frontend/src/scenes/data-warehouse/settings/DataWarehouseManagedSourcesTable.tsx"),kea_subscriptions_lib=__webpack_require__("./node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.5_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts");let lineageTabLogic=(0,index_esm.kea)([(0,index_esm.path)(["data-warehouse","editor","outputPaneTabs","lineageTabLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.codeEditorKey),(0,index_esm.actions)({loadNodes:!0,traverseAncestors:(viewId,level)=>({viewId,level}),setNodes:nodes=>({nodes})}),(0,index_esm.connect)(props=>({values:[(0,multitabEditorLogic.tg)({key:props.codeEditorKey}),["metadata"],databaseTableListLogic.A,["posthogTablesMap","viewsMapById","dataWarehouseTablesMapById"],dataWarehouseViewsLogic.$,["dataWarehouseSavedQueryMap"]],actions:[(0,multitabEditorLogic.tg)({key:props.codeEditorKey}),["runQuery"],dataWarehouseViewsLogic.$,["loadDataWarehouseSavedQueries"]]})),(0,index_esm.reducers)({nodeMap:[{},{setNodes:(_,_ref)=>{let{nodes}=_ref;return nodes}}]}),(0,index_esm.listeners)(_ref2=>{let{actions,values}=_ref2;return{loadNodes:async()=>{let nodes={},traverseAncestors=async(viewId,level)=>{if(nodes[viewId]?.savedQueryId)for(let ancestor of(await api.ZP.dataWarehouseSavedQueries.ancestors(viewId,level)).ancestors)nodes[ancestor]={nodeId:ancestor,name:values.viewsMapById[ancestor]?.name||values.dataWarehouseTablesMapById[ancestor]?.name||ancestor,savedQueryId:values.viewsMapById[ancestor]?.id,leaf:[...nodes[ancestor]?.leaf||[],viewId]},await traverseAncestors(ancestor,1)};for(let view of(values.sources.forEach(source=>{source&&(nodes[source]={nodeId:source,name:source,savedQueryId:void 0,leaf:[]})}),values.views))view&&(nodes[view.id]={nodeId:view.id,name:view.name,savedQueryId:view.id,leaf:[]},await traverseAncestors(view.id,1));actions.setNodes(nodes)}}}),(0,kea_subscriptions_lib.Vt)(_ref3=>{let{actions}=_ref3;return{metadata:()=>{actions.loadNodes()}}}),(0,index_esm.selectors)({views:[s=>[s.metadata,s.dataWarehouseSavedQueryMap],(metadata,dataWarehouseSavedQueryMap)=>metadata&&metadata.table_names?.map(table_name=>{let view=dataWarehouseSavedQueryMap[table_name];if(view)return view}).filter(Boolean)||[]],sources:[s=>[s.metadata,s.dataWarehouseSavedQueryMap],(metadata,dataWarehouseSavedQueryMap)=>metadata&&metadata.table_names?.map(table_name=>{if(!dataWarehouseSavedQueryMap[table_name])return table_name}).filter(Boolean)||[]],allNodes:[s=>[s.nodeMap],nodeMap=>[...Object.values(nodeMap)]]}),(0,index_esm.events)(_ref4=>{let{cache,actions}=_ref4;return{afterMount:()=>{cache.pollingInterval||(cache.pollingInterval=setInterval(actions.loadDataWarehouseSavedQueries,1e4))},beforeUnmount:()=>{clearInterval(cache.pollingInterval)}}})]);function LineageTab(){let{allNodes}=(0,index_esm.useValues)(lineageTabLogic),{dataWarehouseSavedQueryMapById}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{runDataWarehouseSavedQuery}=(0,index_esm.useActions)(dataWarehouseViewsLogic.$);return(0,jsx_runtime.jsx)("div",{className:"flex flex-1 relative bg-dark z-0",children:(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,jsx_runtime.jsx)(NodeCanvas,{nodes:allNodes,renderNode:(node,ref)=>(0,jsx_runtime.jsx)(Node,{pref:ref,children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col max-w-full",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap justify-between gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"font-bold break-all",children:node.name}),node.savedQueryId&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",size:"xsmall",onClick:()=>node.savedQueryId&&runDataWarehouseSavedQuery(node.savedQueryId),children:"Run"})]}),node.savedQueryId&&dataWarehouseSavedQueryMapById[node.savedQueryId]?.status&&(0,jsx_runtime.jsx)("div",{className:"text-xs mt-2 max-w-full",children:(0,jsx_runtime.jsx)(src.oe,{type:dataWarehouseSavedQueryMapById[node.savedQueryId]?.status&&DataWarehouseManagedSourcesTable.IM[dataWarehouseSavedQueryMapById[node.savedQueryId].status]||"default",className:"break-words",children:dataWarehouseSavedQueryMapById[node.savedQueryId]?.status})}),node.savedQueryId&&dataWarehouseSavedQueryMapById[node.savedQueryId]?.last_run_at&&(0,jsx_runtime.jsx)("span",{className:"text-xs mt-2 max-w-full break-words",children:`Last calculated ${(0,utils.bo)(dataWarehouseSavedQueryMapById[node.savedQueryId]?.last_run_at)}`})]})})})})})}function OutputPane(){let{activeTab}=(0,index_esm.useValues)(outputPaneLogic),{setActiveTab}=(0,index_esm.useActions)(outputPaneLogic),{variablesForInsight}=(0,index_esm.useValues)(variablesLogic.Q),{editingView,sourceQuery,exportContext,isValidView,error,editorKey,metadataLoading}=(0,index_esm.useValues)(multitabEditorLogic.tg),{saveAsInsight,saveAsView,setSourceQuery,runQuery}=(0,index_esm.useActions)(multitabEditorLogic.tg),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),{response,responseLoading,responseError,queryId,pollResponse}=(0,index_esm.useValues)(dataNodeLogic.M),{updatingDataWarehouseSavedQuery}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{updateDataWarehouseSavedQuery}=(0,index_esm.useActions)(dataWarehouseViewsLogic.$),{visualizationType,queryCancelled}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h),vizKey=(0,react.useMemo)(()=>"SQLEditorScene",[]),columns=(0,react.useMemo)(()=>{var _response$columns$map;let types=response?.types;return null!==(_response$columns$map=response?.columns?.map((column,index)=>{let type=types?.[index]?.[1];return type&&type.indexOf("Bool")!==-1?{key:column,name:column,resizable:!0,renderCell:props=>null===props.row[column]?null:props.row[column].toString()}:{key:column,name:column,resizable:!0}}))&&void 0!==_response$columns$map?_response$columns$map:[]},[response]),rows=(0,react.useMemo)(()=>response?.results?response?.results?.map(row=>{let rowObject={};return response.columns.forEach((column,i)=>{"object"==typeof row[i]&&null!==row[i]?rowObject[column]=JSON.stringify(row[i]):rowObject[column]=row[i]}),rowObject}):[],[response]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full flex-1 bg-primary",children:[variablesForInsight.length>0&&(0,jsx_runtime.jsx)("div",{className:"py-2 px-4",children:(0,jsx_runtime.jsx)(Variables.M,{})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between align-center py-2 px-4 w-full h-[55px]",children:[(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:tab=>setActiveTab(tab),tabs:[{key:OutputTab.Results,label:"Results"},{key:OutputTab.Visualization,label:"Visualization"},...featureFlags[constants.y8.DATA_MODELING]?[{key:OutputTab.Info,label:(0,jsx_runtime.jsxs)("span",{className:"flex flex-row items-center gap-2",children:["Info ",metadataLoading?(0,jsx_runtime.jsx)(src.$j,{}):null]})},{key:OutputTab.Lineage,label:(0,jsx_runtime.jsxs)("span",{className:"flex flex-row items-center gap-2",children:["Lineage ",metadataLoading?(0,jsx_runtime.jsx)(src.$j,{}):null]})}]:[]]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(AddVariableButton.u,{}),exportContext&&(0,jsx_runtime.jsx)(ExportButton.j,{disabledReason:visualizationType!=types.Qb.ActionsTable&&"Only table results are exportable",type:"secondary",items:[{export_format:types.P5.CSV,export_context:exportContext},{export_format:types.P5.XLSX,export_context:exportContext}]}),editingView?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.Jp,{loading:updatingDataWarehouseSavedQuery,type:"secondary",onClick:()=>{var _response$types;return updateDataWarehouseSavedQuery({id:editingView.id,query:sourceQuery.source,types:null!==(_response$types=response?.types)&&void 0!==_response$types?_response$types:[]})},children:"Update view"})}):(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>saveAsView(),disabledReason:isValidView?"":"Some fields may need an alias",children:"Save as view"}),(0,jsx_runtime.jsxs)(src.Jp,{disabledReason:error||"",loading:responseLoading,type:"primary",onClick:()=>runQuery(),children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:"Run"}),(0,jsx_runtime.jsx)(KeyboardShortcut.e,{command:!0,enter:!0})]})]})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-1 relative bg-dark",children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:lineageTabLogic,props:{codeEditorKey:editorKey},children:(0,jsx_runtime.jsx)(Content,{activeTab:activeTab,responseError:responseError,responseLoading:responseLoading,response:response,sourceQuery:sourceQuery,queryCancelled:queryCancelled,columns:columns,rows:rows,isDarkModeOn:isDarkModeOn,vizKey:vizKey,setSourceQuery:setSourceQuery,exportContext:exportContext,saveAsInsight:saveAsInsight,queryId:queryId,pollResponse:pollResponse,editorKey:editorKey})})}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between px-2 border-t",children:[(0,jsx_runtime.jsx)("div",{children:response?(0,jsx_runtime.jsx)(LoadNext.D,{}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}),(0,jsx_runtime.jsx)(ElapsedTime.W,{})]})]})}function InternalDataTableVisualization(props){let{query,visualizationType,showEditingUI,showResultControls,response,responseLoading,isChartSettingsPanelOpen}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{toggleChartSettingsPanel}=(0,index_esm.useActions)(dataVisualizationLogic.H8),component=null;return showEditingUI||response&&!responseLoading?visualizationType===types.Qb.ActionsTable?component=(0,jsx_runtime.jsx)(Table.i,{uniqueKey:props.uniqueKey,query:query,context:props.context,cachedResults:props.cachedResults}):visualizationType===types.Qb.ActionsLineGraph||visualizationType===types.Qb.ActionsBar||visualizationType===types.Qb.ActionsAreaGraph||visualizationType===types.Qb.ActionsStackedBar?component=(0,jsx_runtime.jsx)(LineGraph.x,{}):visualizationType===types.Qb.BoldNumber&&(component=(0,jsx_runtime.jsx)(BoldNumber.w,{})):component=(0,jsx_runtime.jsx)("div",{className:"flex flex-col flex-1 justify-center items-center bg-surface-primary h-full",children:(0,jsx_runtime.jsx)(LoadingBar.F,{})}),(0,jsx_runtime.jsx)("div",{className:"DataVisualization h-full hide-scrollbar flex flex-1 gap-2",children:(0,jsx_runtime.jsxs)("div",{className:"relative w-full flex flex-col gap-4 flex-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 flex-row gap-4 overflow-scroll hide-scrollbar",children:[isChartSettingsPanelOpen&&(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(SideBar.K,{})}),(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("w-full h-full flex-1 overflow-auto"),children:component})]}),showResultControls&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 justify-between flex-wrap px-px py-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex gap-4 items-center"}),(0,jsx_runtime.jsx)("div",{className:"flex gap-4 items-center",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 items-center flex-wrap",children:[(0,jsx_runtime.jsx)(TableDisplay.V,{}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),type:isChartSettingsPanelOpen?"primary":"secondary",onClick:()=>toggleChartSettingsPanel(),tooltip:"Visualization settings"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>props.onSaveInsight(),children:"Create insight"})]})})]})})]})})}let ErrorState=_ref=>{let{responseError,sourceQuery,queryCancelled,response}=_ref;return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("flex-1 absolute top-0 left-0 right-0 bottom-0 overflow-scroll"),children:(0,jsx_runtime.jsx)(EmptyStates.jC,{query:sourceQuery,excludeDetail:!0,title:queryCancelled?"The query was cancelled":response&&"error"in response?response.error:responseError})})},Content=_ref2=>{let{activeTab,responseError,responseLoading,response,sourceQuery,queryCancelled,columns,rows,isDarkModeOn,vizKey,setSourceQuery,exportContext,saveAsInsight,queryId,pollResponse,editorKey}=_ref2;return activeTab===OutputTab.Results?responseError?(0,jsx_runtime.jsx)(ErrorState,{responseError:responseError,sourceQuery:sourceQuery,queryCancelled:queryCancelled,response:response}):responseLoading?(0,jsx_runtime.jsx)("div",{className:"flex flex-1 p-2 w-full justify-center items-center",children:(0,jsx_runtime.jsx)(EmptyStates.sX,{queryId:queryId,pollResponse:pollResponse})}):response?(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsx)(bundle.ZP,{className:isDarkModeOn?"rdg-dark h-full":"rdg-light h-full",columns:columns,rows:rows})}):(0,jsx_runtime.jsx)("div",{className:"flex flex-1 justify-center items-center",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary mt-3",children:"Query results will appear here"})}):activeTab===OutputTab.Visualization?responseError?(0,jsx_runtime.jsx)(ErrorState,{responseError:responseError,sourceQuery:sourceQuery,queryCancelled:queryCancelled,response:response}):response?(0,jsx_runtime.jsx)("div",{className:"flex-1 absolute top-0 left-0 right-0 bottom-0 px-4 py-1 hide-scrollbar",children:(0,jsx_runtime.jsx)(InternalDataTableVisualization,{uniqueKey:vizKey,query:sourceQuery,setQuery:setSourceQuery,context:{},cachedResults:void 0,exportContext:exportContext,onSaveInsight:saveAsInsight})}):(0,jsx_runtime.jsx)("div",{className:"flex flex-1 justify-center items-center",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary mt-3",children:"Query results will be visualized here"})}):activeTab===OutputTab.Info?(0,jsx_runtime.jsx)(InfoTab,{codeEditorKey:editorKey}):activeTab===OutputTab.Lineage?(0,jsx_runtime.jsx)(LineageTab,{}):null};var Resizer=__webpack_require__("./frontend/src/lib/components/Resizer/Resizer.tsx"),CodeEditor=__webpack_require__("./frontend/src/lib/monaco/CodeEditor.tsx"),AutoSizer=__webpack_require__("./node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js");function QueryPane(props){let{queryPaneHeight,queryPaneResizerProps}=(0,index_esm.useValues)(editorSizingLogic);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"relative flex flex-col w-full bg-primary",style:{height:`${queryPaneHeight}px`},ref:queryPaneResizerProps.containerRef,children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(AutoSizer.q,{children:_ref=>{let{height,width}=_ref;return(0,jsx_runtime.jsx)(CodeEditor.p,{language:"hogQL",value:props.queryInput,sourceQuery:props.sourceQuery,height:height,width:width,...props.codeEditorProps,options:{minimap:{enabled:!1},wordWrap:"on",scrollBeyondLastLine:!1,automaticLayout:!0,fixedOverflowWidgets:!0,suggest:{showInlineDetails:!0},quickSuggestionsDelay:300}})}})}),(0,jsx_runtime.jsx)(Resizer.w,{...queryPaneResizerProps})]})})}var QueryTabs=__webpack_require__("./frontend/src/scenes/data-warehouse/editor/QueryTabs.tsx");function QueryWindow(){let[monacoAndEditor,setMonacoAndEditor]=(0,react.useState)(null),[monaco,editor]=null!=monacoAndEditor?monacoAndEditor:[],codeEditorKey=`hogQLQueryEditor/${lib.router.values.location.pathname}`,logic=(0,multitabEditorLogic.tg)({key:codeEditorKey,monaco,editor}),{allTabs,activeModelUri,queryInput,editingView,sourceQuery}=(0,index_esm.useValues)(logic),{renameTab,selectTab,deleteTab,createTab,setQueryInput,runQuery,setError,setIsValidView,setMetadata,setMetadataLoading}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 flex-col h-full overflow-hidden",children:[(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto px-1",children:(0,jsx_runtime.jsx)(QueryTabs.K,{models:allTabs,onClick:selectTab,onClear:deleteTab,onAdd:createTab,onRename:renameTab,activeModelUri:activeModelUri})}),editingView&&(0,jsx_runtime.jsx)("div",{className:"h-7 bg-warning-highlight p-1",children:(0,jsx_runtime.jsxs)("span",{children:["Editing ",editingView.status?"materialized view":"view",' "',editingView.name,'"']})}),(0,jsx_runtime.jsx)(QueryPane,{queryInput:queryInput,sourceQuery:sourceQuery.source,promptError:null,codeEditorProps:{queryKey:codeEditorKey,onChange:v=>{setQueryInput(null!=v?v:"")},onMount:(editor,monaco)=>{setMonacoAndEditor([monaco,editor])},onPressCmdEnter:(value,selectionType)=>{value&&"selection"===selectionType?runQuery(value):runQuery()},onError:(error,isValidView)=>{setError(error),setIsValidView(isValidView)},onMetadata:metadata=>{setMetadata(metadata)},onMetadataLoading:loading=>{setMetadataLoading(loading)}}}),(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:multitabEditorLogic.tg,props:{key:codeEditorKey,monaco,editor},children:(0,jsx_runtime.jsx)(InternalQueryWindow,{})})]})}function InternalQueryWindow(){let{cacheLoading,sourceQuery,queryInput}=(0,index_esm.useValues)(multitabEditorLogic.tg),{setSourceQuery}=(0,index_esm.useActions)(multitabEditorLogic.tg);if(cacheLoading)return null;let dataVisualizationLogicProps={key:multitabEditorLogic.cc,query:sourceQuery,dashboardId:void 0,dataNodeCollectionId:multitabEditorLogic.cc,insightMode:types.LO.Edit,loadPriority:void 0,cachedResults:void 0,variablesOverride:void 0,setQuery:setSourceQuery},dataNodeLogicProps={query:sourceQuery.source,key:multitabEditorLogic.cc,cachedResults:void 0,loadPriority:void 0,dataNodeCollectionId:multitabEditorLogic.cc,variablesOverride:void 0,autoLoad:!1},variablesLogicProps={key:dataVisualizationLogicProps.key,readOnly:!1,queryInput};return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeLogic.M,props:dataNodeLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataVisualizationLogic.H8,props:dataVisualizationLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:displayLogic.Y,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:variablesLogic.Q,props:variablesLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:variableModalLogic.b,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(OutputPane,{})})})})})})}function EditorScene(){let ref=(0,react.useRef)(null),navigatorRef=(0,react.useRef)(null),queryPaneRef=(0,react.useRef)(null);return(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:editorSizingLogic,props:{editorSceneRef:ref,navigatorRef,sourceNavigatorResizerProps:{containerRef:navigatorRef,logicKey:"source-navigator",placement:"right"},queryPaneResizerProps:{containerRef:queryPaneRef,logicKey:"query-pane",placement:"bottom"}},children:[(0,jsx_runtime.jsxs)("div",{className:"w-full h-full flex flex-row overflow-hidden",ref:ref,children:[(0,jsx_runtime.jsx)(EditorSidebar,{}),(0,jsx_runtime.jsx)(QueryWindow,{})]}),(0,jsx_runtime.jsx)(ViewLinkModal.WI,{})]})}let EditorSidebar=()=>{let{sidebarOverlayOpen}=(0,index_esm.useValues)(editorSceneLogic.h),navBarItem={identifier:sceneTypes.x.SQLEditor,label:"SQL editor",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconServer,{}),logic:editorSidebarLogic.O};return(0,jsx_runtime.jsx)(Sidebar.Y,{navbarItem:navBarItem,sidebarOverlay:(0,jsx_runtime.jsx)(EditorSidebarOverlay,{}),sidebarOverlayProps:{isOpen:sidebarOverlayOpen}})},EditorSidebarOverlay=()=>{let{setSidebarOverlayOpen}=(0,index_esm.useActions)(editorSceneLogic.h),{sidebarOverlayTreeItems,selectedSchema}=(0,index_esm.useValues)(editorSceneLogic.h),{toggleJoinTableModal,selectSourceTable}=(0,index_esm.useActions)(viewLinkLogic.t);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col h-full",children:[(0,jsx_runtime.jsxs)("header",{className:"flex flex-row items-center h-10 border-b shrink-0 p-1 gap-2",children:[(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowLeft,{}),onClick:()=>setSidebarOverlayOpen(!1)}),selectedSchema?.name&&(0,jsx_runtime.jsx)(CopyToClipboard.D,{className:"font-mono",tooltipMessage:null,description:"schema",iconStyle:{color:"var(--text-secondary)"},explicitValue:selectedSchema?.name,children:selectedSchema?.name}),(0,jsx_runtime.jsx)(LemonMenu.d,{items:[{label:"Add join",onClick:()=>{selectedSchema&&(selectSourceTable(selectedSchema.name),toggleJoinTableModal())}}],children:(0,jsx_runtime.jsx)("div",{className:"absolute right-1 flex",children:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",noPadding:!0,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{})})})})]}),(0,jsx_runtime.jsx)("div",{className:"overflow-y-auto flex-1",children:(0,jsx_runtime.jsx)(DatabaseTableTree.E,{items:sidebarOverlayTreeItems})})]})}},"./frontend/src/scenes/data-warehouse/editor/QueryTabs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{K:()=>QueryTabs});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.10.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let editor_AutoTab=_ref=>{let{value,onChange,onKeyDown,onBlur,autoFocus,handleRename}=_ref,inputRef=(0,react.useRef)(null),spanRef=(0,react.useRef)(null);return(0,react.useEffect)(()=>{if(!inputRef.current||!spanRef.current)return;let newWidth=spanRef.current.offsetWidth;inputRef.current.style.width=newWidth+"px"},[value]),(0,jsx_runtime.jsxs)("div",{className:"relative inline-block",children:[(0,jsx_runtime.jsx)("span",{ref:spanRef,className:"pointer-events-none absolute invisible whitespace-pre","aria-hidden":"true",children:value}),(0,jsx_runtime.jsx)("input",{ref:inputRef,className:"bg-transparent border-none focus:outline-none p-0",value:value,onChange:e=>{onChange(e),handleRename()},onKeyDown:onKeyDown,onBlur:onBlur,autoFocus:autoFocus})]})};var multitabEditorLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/editor/multitabEditorLogic.tsx");function QueryTabs(_ref){let{models,onClear,onClick,onAdd,onRename,activeModelUri}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-row w-full overflow-scroll hide-scrollbar h-10 pt-1",children:[models.map(model=>(0,jsx_runtime.jsx)(QueryTabComponent,{model:model,onClear:models.length>1?onClear:void 0,onClick:onClick,active:activeModelUri?.uri.path===model.uri.path,onRename:onRename},model.uri.path)),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>onAdd(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{fontSize:14})})]})}function QueryTabComponent(_ref2){let{model,active,onClear,onClick,onRename}=_ref2,[tabName,setTabName]=(0,react.useState)(()=>model.name||multitabEditorLogic.x$),[isEditing,setIsEditing]=(0,react.useState)(!1);(0,react.useEffect)(()=>{setTabName(model.view?.name||model.name||multitabEditorLogic.x$)},[model.view?.name]);let handleRename=()=>{setIsEditing(!1),onRename(model,tabName)};return(0,jsx_runtime.jsxs)("div",{onClick:()=>onClick?.(model),className:(0,clsx_m.default)("space-y-px rounded-t p-1 flex border-b-2 flex-row items-center gap-1 hover:bg-surface-primary cursor-pointer",active?"bg-surface-primary border-b-2 !border-brand-yellow":"bg-surface-secondary border-transparent",onClear?"pl-3 pr-2":"px-3"),children:[isEditing?(0,jsx_runtime.jsx)(editor_AutoTab,{value:tabName,onChange:e=>setTabName(e.target.value),onBlur:handleRename,autoFocus:!0,handleRename:()=>onRename(model,tabName),onKeyDown:e=>{"Enter"===e.key?handleRename():"Escape"===e.key&&setIsEditing(!1)}}):(0,jsx_runtime.jsx)("div",{onDoubleClick:()=>{model.view||setIsEditing(!isEditing)},className:"flex-grow text-left whitespace-pre",children:tabName}),onClear&&(0,jsx_runtime.jsx)(src.Jp,{onClick:e=>{e.stopPropagation(),onClear(model)},size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{})})]})}},"./frontend/src/scenes/data-warehouse/settings/DataWarehouseManagedSourcesTable.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{IM:()=>StatusTagSetting,lL:()=>DataWarehouseManagedSourcesTable,qs:()=>getDataWarehouseSourceUrl});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_components_TZLabel__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),scenes_data_warehouse_settings_DataWarehouseSourceIcon__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/data-warehouse/settings/DataWarehouseSourceIcon.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/urls.ts"),_types__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/types.ts"),_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx"),_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let StatusTagSetting={Running:"primary",Completed:"success",Error:"danger",Failed:"danger","Billing limits":"danger"};function DataWarehouseManagedSourcesTable(){var _dataWarehouseSources;let{dataWarehouseSources,dataWarehouseSourcesLoading,sourceReloadingById}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_9__.T),{deleteSource,reloadSource}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)(_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_9__.T);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.g3,{dataSource:null!==(_dataWarehouseSources=dataWarehouseSources?.results)&&void 0!==_dataWarehouseSources?_dataWarehouseSources:[],loading:dataWarehouseSourcesLoading,disableTableWhileLoading:!1,pagination:{pageSize:10},columns:[{width:0,render:(_,source)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(scenes_data_warehouse_settings_DataWarehouseSourceIcon__WEBPACK_IMPORTED_MODULE_5__.U,{type:source.source_type})},{title:"Source",key:"name",render:(_,source)=>{var _SOURCE_DETAILS$sourc;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_4__.i,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.pipelineNode(_types__WEBPACK_IMPORTED_MODULE_7__.We.Source,`managed-${source.id}`,_types__WEBPACK_IMPORTED_MODULE_7__.il.Schemas),title:null!==(_SOURCE_DETAILS$sourc=_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_8__.l2[source.source_type]?.label)&&void 0!==_SOURCE_DETAILS$sourc?_SOURCE_DETAILS$sourc:source.source_type,description:source.prefix})}},{title:"Last Successful Run",key:"last_run_at",tooltip:"Time of the last run that completed a data import",render:(_,run)=>run.last_run_at?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_components_TZLabel__WEBPACK_IMPORTED_MODULE_2__.w,{time:run.last_run_at,formatDate:"MMM DD, YYYY",formatTime:"HH:mm"}):"Never"},{title:"Total Rows Synced",key:"rows_synced",tooltip:"Total number of rows synced across all schemas in this source",render:(_,source)=>source.schemas.reduce((acc,schema)=>{var _schema$table$row_cou;return acc+(null!==(_schema$table$row_cou=schema.table?.row_count)&&void 0!==_schema$table$row_cou?_schema$table$row_cou:0)},0).toLocaleString()},{title:"Status",key:"status",render:(_,source)=>{if(!source.status)return null;let tagContent=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{type:StatusTagSetting[source.status]||"default",children:source.status});return source.latest_error&&"Error"===source.status?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.u,{title:source.latest_error,children:tagContent}):tagContent}},{key:"actions",width:0,render:(_,source)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"flex flex-row justify-end",children:sourceReloadingById[source.id]?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.$j,{})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_3__.T,{overlay:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.u,{title:"Start the data import for this schema again",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{type:"tertiary","data-attr":`reload-data-warehouse-${source.source_type}`,onClick:()=>{reloadSource(source)},children:"Reload"},`reload-data-warehouse-${source.source_type}`)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{status:"danger","data-attr":`delete-data-warehouse-${source.source_type}`,onClick:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.dn.open({title:"Delete data source?",description:"Are you sure you want to delete this data source? All related tables will be deleted.",primaryButton:{children:"Delete",status:"danger",onClick:()=>deleteSource(source)},secondaryButton:{children:"Cancel"}})},children:"Delete"},`delete-data-warehouse-${source.source_type}`)]})})})})}]})}function getDataWarehouseSourceUrl(service){return _types__WEBPACK_IMPORTED_MODULE_7__.zD.includes(service)?"https://posthog.com/docs/data-warehouse/setup#step-1-creating-a-bucket-in-s3":`https://posthog.com/docs/data-warehouse/setup#${service.toLowerCase()}`}},"./frontend/src/scenes/data-warehouse/settings/DataWarehouseSourceIcon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{U:()=>DataWarehouseSourceIcon,Z:()=>mapUrlToProvider});var Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),blushing_hog=__webpack_require__("./frontend/public/hedgehog/blushing-hog.png"),aws_s3=__webpack_require__("./frontend/public/services/aws-s3.png");let azure=__webpack_require__.p+"images/azure.af1ab71d57e8348437183a694553a45f.png";var bigquery=__webpack_require__("./frontend/public/services/bigquery.png");let chargebee=__webpack_require__.p+"images/chargebee.394d057d1051597137e505b5fe7e86d5.png",cloudflare=__webpack_require__.p+"images/cloudflare.ac2b10d48ae784e080e8f5be0b4d19cb.png";var google_cloud_storage=__webpack_require__("./frontend/public/services/google-cloud-storage.png"),hubspot=__webpack_require__("./frontend/public/services/hubspot.png");let mysql=__webpack_require__.p+"images/mysql.7912374cef9be6a09530b67289e766b5.png";var postgres=__webpack_require__("./frontend/public/services/postgres.png"),salesforce=__webpack_require__("./frontend/public/services/salesforce.png"),snowflake=__webpack_require__("./frontend/public/services/snowflake.png");let sql_azure=__webpack_require__.p+"images/sql-azure.be99f21a93dbdf9b0e2092e1bd3f9f70.png",stripe=__webpack_require__.p+"images/stripe.675a1480d2e5d55e32e3e9e0dc54b92e.png",vitally=__webpack_require__.p+"images/vitally.2399d8a0e27a2b9b051d4500481e3009.png",zendesk=__webpack_require__.p+"images/zendesk.4febb7199e1b2b53c901089ce7fcccd1.png";var DataWarehouseManagedSourcesTable=__webpack_require__("./frontend/src/scenes/data-warehouse/settings/DataWarehouseManagedSourcesTable.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function mapUrlToProvider(url){return url.includes(".s3.amazonaws.com")?"aws":url.startsWith("https://storage.googleapis.com")?"google-cloud":url.includes(".blob.")?"azure":url.includes(".r2.cloudflarestorage.com")?"cloudflare-r2":"BlushingHog"}function DataWarehouseSourceIcon(_ref){let{type,size="small"}=_ref,sizePx="small"===size?30:60,icon={Stripe:stripe,Hubspot:hubspot.Z,Zendesk:zendesk,Postgres:postgres.Z,MySQL:mysql,Snowflake:snowflake.Z,aws:aws_s3.Z,"google-cloud":google_cloud_storage.Z,"cloudflare-r2":cloudflare,azure:azure,Salesforce:salesforce.Z,MSSQL:sql_azure,Vitally:vitally,BigQuery:bigquery.Z,Chargebee:chargebee,BlushingHog:blushing_hog.Z}[type];return(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-4",children:(0,jsx_runtime.jsx)(Tooltip.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[type,(0,jsx_runtime.jsx)("br",{}),"Click to view docs"]}),children:(0,jsx_runtime.jsx)(Link.r,{to:(0,DataWarehouseManagedSourcesTable.qs)(type),children:(0,jsx_runtime.jsx)("img",{src:icon,alt:type,height:sizePx,width:sizePx,className:"rounded object-contain max-w-none"})})})})}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.2_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/data-warehouse/editor/DataGrid.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".rdg-cell{border-block-end:1px solid var(--border);border-inline-end:1px solid var(--border)}",""]),module.exports=exports}}]);
//# sourceMappingURL=29705.60565caa.iframe.bundle.js.map