"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[9298],{"../../frontend/src/scenes/dashboard/NewDashboardModal.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>NewDashboardModal});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonModal=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonModal/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),dashboardTemplatesLogic=__webpack_require__("../../frontend/src/scenes/dashboard/dashboards/templates/dashboardTemplatesLogic.tsx"),newDashboardLogic=__webpack_require__("../../frontend/src/scenes/dashboard/newDashboardLogic.ts"),DashboardTemplateChooser=__webpack_require__("../../frontend/src/scenes/dashboard/DashboardTemplateChooser.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),ActionFilter=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),dashboardTemplateVariablesLogic=__webpack_require__("../../frontend/src/scenes/dashboard/dashboardTemplateVariablesLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DashboardTemplateVariables(){let{activeDashboardTemplate}=(0,index_esm.useValues)(newDashboardLogic.Z),theDashboardTemplateVariablesLogic=(0,dashboardTemplateVariablesLogic.y)({variables:activeDashboardTemplate?.variables||[]}),{variables}=(0,index_esm.useValues)(theDashboardTemplateVariablesLogic),{setVariable,setVariables}=(0,index_esm.useActions)(theDashboardTemplateVariablesLogic);return(0,react.useEffect)(()=>{setVariables(activeDashboardTemplate?.variables||[])},[activeDashboardTemplate]),(0,jsx_runtime.jsx)("div",{className:"mb-4 DashboardTemplateVariables max-w-192",children:variables.map((variable,index)=>(0,jsx_runtime.jsxs)("div",{className:"mb-6",children:[(0,jsx_runtime.jsxs)("div",{className:"mb-2",children:[(0,jsx_runtime.jsx)(src.HQ,{showOptional:!variable.required,info:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:variable.description}),children:variable.name}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-secondary",children:variable.description})]}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(ActionFilter.T,{filters:{insight:types.dw.TRENDS,events:[variable.default]},setFilters:filters=>{setVariable(variable.name,filters)},typeKey:"variable_"+variable.name,hideDeleteBtn:!0,hideRename:!0,hideDuplicate:!0,entitiesLimit:1})})]},index))})}function NewDashboardModal(){let builtLogic=(0,index_esm.useMountedLogic)(newDashboardLogic.Z),{hideNewDashboardModal,clearActiveDashboardTemplate,createDashboardFromTemplate}=(0,index_esm.useActions)(newDashboardLogic.Z),{newDashboardModalVisible,activeDashboardTemplate,variableSelectModalVisible}=(0,index_esm.useValues)(newDashboardLogic.Z),{variables}=(0,index_esm.useValues)(dashboardTemplateVariablesLogic.y),templatesLogic=(0,dashboardTemplatesLogic.R)({scope:builtLogic.props.featureFlagId?"feature_flag":"default"}),{templateFilter}=(0,index_esm.useValues)(templatesLogic),{setTemplateFilter}=(0,index_esm.useActions)(templatesLogic),_dashboardTemplateChooser=builtLogic.props.featureFlagId?(0,jsx_runtime.jsx)(DashboardTemplateChooser.g,{scope:"feature_flag"}):(0,jsx_runtime.jsx)(DashboardTemplateChooser.g,{});return(0,jsx_runtime.jsx)(LemonModal.f,{onClose:hideNewDashboardModal,isOpen:newDashboardModalVisible,title:activeDashboardTemplate?"Choose your events":"Create a dashboard","data-attr":"new-dashboard-chooser",description:activeDashboardTemplate?(0,jsx_runtime.jsxs)("p",{children:["The ",(0,jsx_runtime.jsx)("i",{children:activeDashboardTemplate.template_name})," template requires you to choose"," ",(0,utils.Zi)((activeDashboardTemplate.variables||[]).length,"event","events",!0),"."]}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)("div",{children:"Choose a template or start with a blank slate"}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Filter templates",onChange:setTemplateFilter,value:templateFilter,fullWidth:!0})})]}),footer:activeDashboardTemplate?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[variableSelectModalVisible?(0,jsx_runtime.jsx)("div",{}):(0,jsx_runtime.jsx)(src.Jp,{onClick:clearActiveDashboardTemplate,type:"secondary",children:"Back"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{activeDashboardTemplate&&createDashboardFromTemplate(activeDashboardTemplate,variables)},type:"primary",children:"Create"})]}):null,children:(0,jsx_runtime.jsx)("div",{className:"NewDashboardModal",children:activeDashboardTemplate?(0,jsx_runtime.jsx)(DashboardTemplateVariables,{}):_dashboardTemplateChooser})})}},"../../products/customer_analytics/frontend/CustomerAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{CustomerAnalyticsScene:()=>CustomerAnalyticsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),NewDashboardModal=__webpack_require__("../../frontend/src/scenes/dashboard/NewDashboardModal.tsx"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),Dashboard=__webpack_require__("../../frontend/src/scenes/dashboard/Dashboard.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),newDashboardLogic=__webpack_require__("../../frontend/src/scenes/dashboard/newDashboardLogic.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");let customerAnalyticsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","customerAnalytics","customerAnalyticsScene"]),(0,index_esm.connect)({actions:[(0,newDashboardLogic.Z)({initialTags:["customer-analytics"]}),["showNewDashboardModal","hideNewDashboardModal","submitNewDashboardSuccessWithResult"]],values:[(0,newDashboardLogic.Z)({initialTags:["customer-analytics"]}),["newDashboardModalVisible"],teamLogic.teamLogic,["currentTeamId"]]}),(0,index_esm.actions)({createNewDashboard:!0,handleEditDashboard:()=>{},onChangeDashboard:dashboardId=>({dashboardId}),selectDashboard:dashboardId=>({dashboardId})}),(0,lib.loaders)(_ref=>{let{values}=_ref;return{availableDashboards:[[],{loadCustomerDashboards:async()=>((await api.ZP.get(`api/environments/${values.currentTeamId}/dashboards/?tags=customer-analytics`)).results||[]).map(dashboard=>({id:dashboard.id,name:dashboard.name,description:dashboard.description||""}))}]}}),(0,index_esm.reducers)({selectedDashboardId:[null,{selectDashboard:(_,_ref2)=>{let{dashboardId}=_ref2;return dashboardId},loadCustomerDashboardsSuccess:(_,_ref3)=>{let{availableDashboards}=_ref3;return availableDashboards.length>0?availableDashboards[0].id:null}}]}),(0,index_esm.listeners)(_ref4=>{let{actions,values}=_ref4;return{loadCustomerDashboardsSuccess:_ref5=>{let{availableDashboards}=_ref5;availableDashboards.length>0&&!values.selectedDashboardId&&actions.selectDashboard(availableDashboards[0].id)},createNewDashboard:()=>{actions.showNewDashboardModal()},handleEditDashboard:()=>{values.selectedDashboardId&&kea_router_lib.router.actions.push(urls.j.dashboard(values.selectedDashboardId))},submitNewDashboardSuccessWithResult:_ref6=>{let{result}=_ref6;actions.loadCustomerDashboards(),actions.selectDashboard(result.id)},onChangeDashboard:_ref7=>{let{dashboardId}=_ref7;"create_new"===dashboardId?actions.createNewDashboard():actions.selectDashboard(dashboardId)}}}),(0,index_esm.afterMount)(_ref8=>{let{actions}=_ref8;actions.loadCustomerDashboards()})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function CustomerAnalyticsDashboardCard(){let{availableDashboards,availableDashboardsLoading,selectedDashboardId}=(0,index_esm.useValues)(customerAnalyticsSceneLogic),{onChangeDashboard,createNewDashboard,handleEditDashboard}=(0,index_esm.useActions)(customerAnalyticsSceneLogic);if(availableDashboardsLoading)return(0,jsx_runtime.jsx)("div",{className:"text-center p-8",children:"Loading dashboards..."});if(!availableDashboards.length)return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center align-center text-center p-8",children:[(0,jsx_runtime.jsx)("p",{className:"text-muted mb-4",children:"No dashboards available"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),onClick:createNewDashboard,children:"Create your first dashboard"})]});let dashboardOptions=[...availableDashboards.map(dashboard=>({value:dashboard.id,label:dashboard.name})),{value:"create_new",label:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),"Create new dashboard"]})}];return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-sm font-medium",children:"Dashboard:"}),(0,jsx_runtime.jsx)(src.Yv,{value:selectedDashboardId||void 0,onChange:onChangeDashboard,options:dashboardOptions,placeholder:"Select a dashboard",className:"min-w-48"}),selectedDashboardId&&(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{}),onClick:handleEditDashboard,size:"small",tooltip:"Edit dashboard"})]}),selectedDashboardId&&(0,jsx_runtime.jsx)("div",{className:"dashboard-container",children:(0,jsx_runtime.jsx)(Dashboard.Dashboard,{id:selectedDashboardId.toString(),placement:types.F4.CustomerAnalytics})})]})}let scene={component:CustomerAnalyticsScene,logic:customerAnalyticsSceneLogic};function CustomerAnalyticsScene(){let{newDashboardModalVisible}=(0,index_esm.useValues)(customerAnalyticsSceneLogic);return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(Header,{}),(0,jsx_runtime.jsx)(CustomerAnalyticsDashboardCard,{}),newDashboardModalVisible&&(0,jsx_runtime.jsx)(NewDashboardModal.O,{})]})}let Header=()=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{}),(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:"Customer analytics",description:"Analyze your customers",resourceType:{type:"customerAnalytics",forceIcon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPeople,{})}}),(0,jsx_runtime.jsx)(SceneDivider.V,{})]})}}]);