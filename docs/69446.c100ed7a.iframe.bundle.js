"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[69446],{"./frontend/src/toolbar/actions/actionsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{M:()=>actionsLogic});var fuse_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_utils_kea_logic_builders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/utils/kea-logic-builders.ts"),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/toolbar/toolbarConfigLogic.ts");let actionsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","actions","actionsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setSearchTerm:searchTerm=>({searchTerm})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{allActions:[[],{getActions:async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let breakpoint=arguments.length>1?arguments[1]:void 0,response=await (0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_3__.O)("/api/projects/@current/actions/"),results=await response.json();if(403===response.status)return _toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_3__.W.actions.authenticate(),[];if(breakpoint(),!Array.isArray(results?.results))throw Error("Error loading actions!");return results.results},updateAction:_ref2=>{let{action}=_ref2;return values.allActions.filter(r=>r.id!==action.id).concat([action])},deleteAction:_ref3=>{let{id}=_ref3;return values.allActions.filter(r=>r.id!==id)}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({searchTerm:["",{setSearchTerm:(_,_ref4)=>{let{searchTerm}=_ref4;return searchTerm}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({sortedActions:[s=>[s.allActions,s.searchTerm],(allActions,searchTerm)=>{let filteredActions=searchTerm?new fuse_js__WEBPACK_IMPORTED_MODULE_4__.Z(allActions,{threshold:.3,keys:["name"]}).search(searchTerm).map(_ref5=>{let{item}=_ref5;return item}):allActions;return[...filteredActions].sort((a,b)=>{var _a$name,_b$name;return(null!==(_a$name=a.name)&&void 0!==_a$name?_a$name:"Untitled").localeCompare(null!==(_b$name=b.name)&&void 0!==_b$name?_b$name:"Untitled")})}],actionCount:[s=>[s.allActions],allActions=>allActions.length]}),(0,lib_utils_kea_logic_builders__WEBPACK_IMPORTED_MODULE_2__.Y)()])},"./frontend/src/toolbar/actions/actionsTabLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>actionsTabLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_subscriptions__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.5/node_modules/kea-subscriptions/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/urls.ts"),_toolbar_actions_actionsLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/toolbar/actions/actionsLogic.ts"),_toolbar_bar_toolbarLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/toolbar/bar/toolbarLogic.ts"),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/toolbar/toolbarConfigLogic.ts"),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/toolbar/toolbarPosthogJS.ts"),_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/toolbar/utils.ts");function toElementsChain(element){let chain=[],currentElement=element;for(;currentElement&&currentElement!==document.documentElement;)chain.push(currentElement),currentElement=currentElement.parentElement;return chain.map((element,index)=>({attr_class:element.getAttribute("class")?.split(" "),attr_id:element.getAttribute("id")||void 0,attributes:Array.from(element.attributes).reduce((acc,attr)=>(acc[attr.name]?acc[attr.name]+=` ${attr.value}`:acc[attr.name]=attr.value,acc),{}),href:element.getAttribute("href")||void 0,tag_name:element.tagName.toLowerCase(),text:0===index?element.innerText:void 0}))}let actionsTabLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","actions","actionsTabLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({selectAction:id=>({id:id||null}),newAction:element=>({element:element||null}),inspectForElementWithIndex:index=>({index}),editSelectorWithIndex:index=>({index}),inspectElementSelected:(element,index)=>({element,index}),incrementCounter:!0,saveAction:formValues=>({formValues}),deleteAction:!0,showButtonActions:!0,hideButtonActions:!0,setShowActionsTooltip:showActionsTooltip=>({showActionsTooltip}),setElementSelector:(selector,index)=>({selector,index})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W,["dataAttributes","apiURL","temporaryToken","buttonVisible","userIntent","actionId","dataAttributes"],_toolbar_actions_actionsLogic__WEBPACK_IMPORTED_MODULE_6__.M,["allActions"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({actionFormElementsChains:[{},{inspectElementSelected:(state,_ref)=>{let{element,index}=_ref;return null===index?[]:{...state,[index]:toElementsChain(element)}},newAction:(_,_ref2)=>{let{element}=_ref2;return{0:element?toElementsChain(element):[]}}}],buttonActionsVisible:[!1,{showButtonActions:()=>!0,hideButtonActions:()=>!1}],selectedActionId:[null,{selectAction:(_,_ref3)=>{let{id}=_ref3;return id},newAction:()=>"new"}],newActionForElement:[null,{newAction:(_,_ref4)=>{let{element}=_ref4;return element},selectAction:()=>null}],inspectingElement:[null,{inspectForElementWithIndex:(_,_ref5)=>{let{index}=_ref5;return index},inspectElementSelected:()=>null,selectAction:()=>null,newAction:()=>null}],editingSelector:[null,{editSelectorWithIndex:(_,_ref6)=>{let{index}=_ref6;return index}}],counter:[0,{incrementCounter:state=>state+1}],showActionsTooltip:[!1,{setShowActionsTooltip:(_,_ref7)=>{let{showActionsTooltip}=_ref7;return showActionsTooltip}}]}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_1__.forms)(_ref8=>{let{values,actions}=_ref8;return{actionForm:{defaults:{name:null,steps:[{}]},errors:_ref9=>{let{name}=_ref9;return{name:name&&name.length?void 0:"Must name this action"}},submit:async(formValues,breakpoint)=>{let response;let actionToSave={...formValues,steps:formValues.steps?.map(_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.sV)||[]},{apiURL,temporaryToken}=values,{selectedActionId}=values;response=selectedActionId&&"new"!==selectedActionId?await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.update(`${apiURL}/api/projects/@current/actions/${selectedActionId}/?temporary_token=${temporaryToken}`,actionToSave):await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.create(`${apiURL}/api/projects/@current/actions/?temporary_token=${temporaryToken}`,actionToSave),breakpoint(),_toolbar_actions_actionsLogic__WEBPACK_IMPORTED_MODULE_6__.M.actions.updateAction({action:response}),actions.selectAction(null),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.success("Action saved",{button:{label:"Open in PostHog",action:()=>window.open(`${apiURL}${scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.action(response.id)}`,"_blank")}})},showErrorsOnTouch:!0,alwaysShowErrors:!1}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({editingSelectorValue:[s=>[s.editingSelector,s.actionForm],(editingSelector,actionForm)=>{if(null===editingSelector)return null;let selector=actionForm.steps?.[editingSelector].selector;return selector||null}],elementsChainBeingEdited:[s=>[s.editingSelector,s.actionFormElementsChains],(editingSelector,elementChains)=>null===editingSelector?[]:elementChains[editingSelector]||[]],selectedAction:[s=>[s.selectedActionId,s.newActionForElement,s.allActions,s.dataAttributes],(selectedActionId,newActionForElement,allActions,dataAttributes)=>"new"===selectedActionId?function(element){let dataAttributes=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{name:"",steps:[element?(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.gj)((0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.bE)(element,dataAttributes),!0):{}]}}(newActionForElement,dataAttributes):allActions.find(a=>a.id===selectedActionId)||null]}),(0,kea_subscriptions__WEBPACK_IMPORTED_MODULE_2__.subscriptions)(_ref10=>{let{actions}=_ref10;return{selectedAction:selectedAction=>{selectedAction?actions.setActionFormValues({...selectedAction,steps:selectedAction.steps?selectedAction.steps.map(step=>(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.gj)(step,!1)):[{}]}):actions.setActionFormValues({name:null,steps:[{}]})}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref11=>{let{actions,values}=_ref11;return{setElementSelector:_ref12=>{let{selector,index}=_ref12;if(values.actionForm){let steps=[...values.actionForm.steps||[]];steps&&steps[index]&&(steps[index].selector=selector),actions.setActionFormValue("steps",steps)}},selectAction:_ref13=>{let{id}=_ref13;id&&(values.buttonVisible||_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.actions.showButton(),values.buttonActionsVisible||actions.showButtonActions(),_toolbar_bar_toolbarLogic__WEBPACK_IMPORTED_MODULE_7__.L.actions.setVisibleMenu("actions"))},inspectElementSelected:_ref14=>{let{element,index}=_ref14;if(values.actionForm){let actionStep=(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.gj)((0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.bE)(element,values.dataAttributes),!0),newSteps=(values.actionForm.steps||[]).map((step,i)=>i===(null!=index?index:0)?actionStep:step);actions.setActionFormValue("steps",newSteps),actions.incrementCounter()}},deleteAction:async()=>{let{selectedActionId,apiURL,temporaryToken}=values;selectedActionId&&"new"!==selectedActionId&&(await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.delete(`${apiURL}/api/projects/@current/actions/${selectedActionId}/?temporary_token=${temporaryToken}`),_toolbar_actions_actionsLogic__WEBPACK_IMPORTED_MODULE_6__.M.actions.deleteAction({id:selectedActionId}),actions.selectAction(null),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.info("Action deleted"))},showButtonActions:()=>{_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_9__.T.capture("toolbar mode triggered",{mode:"actions",enabled:!0})},hideButtonActions:()=>{actions.setShowActionsTooltip(!1),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_9__.T.capture("toolbar mode triggered",{mode:"actions",enabled:!1})},[_toolbar_actions_actionsLogic__WEBPACK_IMPORTED_MODULE_6__.M.actionTypes.getActionsSuccess]:()=>{let{userIntent,actionId}=values;"edit-action"===userIntent?(actions.selectAction(actionId),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.actions.clearUserIntent()):"add-action"===userIntent?(actions.newAction(),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.actions.clearUserIntent()):actions.setShowActionsTooltip(!0)},setShowActionsTooltip:async(_ref15,breakpoint)=>{let{showActionsTooltip}=_ref15;showActionsTooltip&&(await breakpoint(1e3),actions.setShowActionsTooltip(!1))}}})])},"./frontend/src/toolbar/bar/toolbarLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{L:()=>toolbarLogic,T:()=>PostHogAppToolbarEvent});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_window_values__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-window-values@3.0.0_kea@3.1.5/node_modules/kea-window-values/lib/index.js"),lib_components_HedgehogBuddy_sprites_sprites__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/components/HedgehogBuddy/sprites/sprites.tsx"),_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/toolbar/actions/actionsTabLogic.tsx"),_toolbar_elements_elementsLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/toolbar/elements/elementsLogic.ts"),_toolbar_elements_heatmapLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/toolbar/elements/heatmapLogic.ts"),_toolbar_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/toolbar/utils.ts");let PostHogAppToolbarEvent=function(PostHogAppToolbarEvent){return PostHogAppToolbarEvent.PH_TOOLBAR_INIT="ph-toolbar-init",PostHogAppToolbarEvent.PH_TOOLBAR_READY="ph-toolbar-ready",PostHogAppToolbarEvent.PH_APP_INIT="ph-app-init",PostHogAppToolbarEvent.PH_HEATMAPS_CONFIG="ph-heatmaps-config",PostHogAppToolbarEvent}({}),toolbarLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","bar","toolbarLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({actions:[_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_3__.A,["showButtonActions","hideButtonActions","selectAction"],_toolbar_elements_elementsLogic__WEBPACK_IMPORTED_MODULE_4__.l,["enableInspect","disableInspect","createAction"],_toolbar_elements_heatmapLogic__WEBPACK_IMPORTED_MODULE_5__.XP,["enableHeatmap","disableHeatmap"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)(()=>({toggleTheme:theme=>({theme}),toggleMinimized:minimized=>({minimized}),setHedgehogMode:hedgehogMode=>({hedgehogMode}),setDragPosition:(x,y)=>({x,y}),setHedgehogActor:actor=>({actor}),syncWithHedgehog:!0,setVisibleMenu:visibleMenu=>({visibleMenu}),onMouseDown:event=>({event}),setDragging:function(){let dragging=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return{dragging}},setElement:element=>({element}),setMenu:element=>({element}),setIsBlurred:isBlurred=>({isBlurred}),setIsEmbeddedInApp:isEmbedded=>({isEmbedded})})),(0,kea_window_values__WEBPACK_IMPORTED_MODULE_1__.windowValues)(()=>({windowHeight:window1=>window1.innerHeight,windowWidth:window1=>Math.min(window1.innerWidth,window1.document.body.clientWidth)})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(()=>({element:[null,{setElement:(_,_ref)=>{let{element}=_ref;return element}}],menu:[null,{setMenu:(_,_ref2)=>{let{element}=_ref2;return element}}],visibleMenu:["none",{setVisibleMenu:(_,_ref3)=>{let{visibleMenu}=_ref3;return visibleMenu},setHedgehogMode:(state,_ref4)=>{let{hedgehogMode}=_ref4;return hedgehogMode?"hedgehog":"hedgehog"===state?"none":state}}],minimized:[!1,{persist:!0},{toggleMinimized:(state,_ref5)=>{let{minimized}=_ref5;return null!=minimized?minimized:!state}}],isBlurred:[!1,{setIsBlurred:(_,_ref6)=>{let{isBlurred}=_ref6;return isBlurred},setVisibleMenu:()=>!1}],theme:["dark",{persist:!0},{toggleTheme:(state,_ref7)=>{let{theme}=_ref7;return null!=theme?theme:"light"===state?"dark":"light"}}],isDragging:[!1,{setDragging:(_,_ref8)=>{let{dragging}=_ref8;return dragging}}],lastDragPosition:[null,{persist:!0},{setDragPosition:(_,_ref9)=>{let{x,y}=_ref9;return{x,y}}}],hedgehogMode:[!1,{persist:!0},{setHedgehogMode:(_,_ref10)=>{let{hedgehogMode}=_ref10;return hedgehogMode}}],hedgehogActor:[null,{setHedgehogActor:(_,_ref11)=>{let{actor}=_ref11;return actor}}],isEmbeddedInApp:[!1,{setIsEmbeddedInApp:(_,_ref12)=>{let{isEmbedded}=_ref12;return isEmbedded}}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({dragPosition:[s=>[s.element,s.lastDragPosition,s.windowWidth,s.windowHeight],(element,lastDragPosition,windowWidth,windowHeight)=>{var _element$offsetWidth,_element$offsetHeight;lastDragPosition??={x:.5*windowWidth,y:.5*windowHeight};let elWidth=(null!==(_element$offsetWidth=element?.offsetWidth)&&void 0!==_element$offsetWidth?_element$offsetWidth:40)+2,elHeight=(null!==(_element$offsetHeight=element?.offsetHeight)&&void 0!==_element$offsetHeight?_element$offsetHeight:40)+2;return{x:(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_6__.nL)(2,lastDragPosition.x,windowWidth-elWidth-2),y:(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_6__.nL)(2,lastDragPosition.y,windowHeight-elHeight-2)}}],menuProperties:[s=>[s.element,s.menu,s.dragPosition,s.windowWidth,s.windowHeight,s.isBlurred],(element,menu,dragPosition,windowWidth,windowHeight,isBlurred)=>{if(!element||!menu)return{};let elWidth=element.offsetWidth+2,elHeight=element.offsetHeight+2,isBelow=dragPosition.y+.5*elHeight<.5*windowHeight,maxHeight=isBelow?windowHeight-dragPosition.y-elHeight-20:dragPosition.y-20;maxHeight=isBlurred?0:(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_6__.nL)(0,maxHeight,.6*windowHeight);let desiredY=isBelow?dragPosition.y+elHeight+10:dragPosition.y-10,desiredX=dragPosition.x+.5*elWidth,top=(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_6__.nL)(2,desiredY,windowHeight-elHeight),left=(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_6__.nL)(2+.5*menu.clientWidth,desiredX,windowWidth-.5*menu.clientWidth-2);return{transform:`translate(${left}px, ${top}px)`,maxHeight,isBelow}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref13=>{let{actions,values}=_ref13;return{setVisibleMenu:_ref14=>{let{visibleMenu}=_ref14;"heatmap"===visibleMenu?(actions.enableHeatmap(),values.hedgehogActor?.setAnimation("heatmaps")):"actions"===visibleMenu?(actions.showButtonActions(),values.hedgehogActor?.setAnimation("action")):"flags"===visibleMenu?values.hedgehogActor?.setAnimation("flag"):"inspect"===visibleMenu?(actions.enableInspect(),values.hedgehogActor?.setAnimation("inspect")):(actions.disableInspect(),actions.disableHeatmap(),actions.hideButtonActions(),actions.selectAction(null))},onMouseDown:_ref15=>{let{event}=_ref15;if(!values.element||0!==event.button)return;let originContainerBounds=values.element.getBoundingClientRect(),offsetX=event.pageX-originContainerBounds.left,offsetY=event.pageY-originContainerBounds.top,movedCount=0,onMouseMove=e=>{(movedCount+=1)>5&&(actions.setDragging(!0),actions.setDragPosition(e.pageX-offsetX,e.pageY-offsetY))},onMouseUp=e=>{0===e.button&&(actions.setDragging(!1),document.removeEventListener("mousemove",onMouseMove),document.removeEventListener("mouseup",onMouseUp))};document.addEventListener("mousemove",onMouseMove),document.addEventListener("mouseup",onMouseUp)},setDragging:_ref16=>{let{dragging}=_ref16;values.hedgehogActor&&(values.hedgehogActor.isDragging=dragging,values.hedgehogActor.update())},syncWithHedgehog:()=>{var _values$element$getBo,_values$element$getBo2;let actor=values.hedgehogActor;if(!values.hedgehogMode||!actor)return;let pageX=actor.x+.5*lib_components_HedgehogBuddy_sprites_sprites__WEBPACK_IMPORTED_MODULE_2__.TE-(null!==(_values$element$getBo=values.element?.getBoundingClientRect().width)&&void 0!==_values$element$getBo?_values$element$getBo:0)*.5,pageY=values.windowHeight-actor.y-lib_components_HedgehogBuddy_sprites_sprites__WEBPACK_IMPORTED_MODULE_2__.TE-(null!==(_values$element$getBo2=values.element?.getBoundingClientRect().height)&&void 0!==_values$element$getBo2?_values$element$getBo2:0);actions.setDragPosition(pageX,pageY)},toggleMinimized:()=>{let sync=()=>{actions.syncWithHedgehog(),values.lastDragPosition&&actions.setDragPosition(values.lastDragPosition.x,values.lastDragPosition.y)};sync(),setTimeout(()=>sync(),150),setTimeout(()=>sync(),300),setTimeout(()=>sync(),550)},createAction:()=>{actions.setVisibleMenu("actions")}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref17=>{let{actions,values,cache}=_ref17;cache.clickListener=e=>{let shouldBeBlurred=e.target?.id!==_toolbar_utils__WEBPACK_IMPORTED_MODULE_6__.Nb;shouldBeBlurred&&!values.isBlurred&&actions.setIsBlurred(!0)},cache.iframeEventListener=e=>{let type=e?.data?.type;if(type&&type.startsWith("ph-"))switch(type){case PostHogAppToolbarEvent.PH_APP_INIT:actions.setIsEmbeddedInApp(!0),window.parent.postMessage({type:PostHogAppToolbarEvent.PH_TOOLBAR_READY},"*");return;case PostHogAppToolbarEvent.PH_HEATMAPS_CONFIG:actions.enableHeatmap();return;default:console.warn(`[PostHog Toolbar] Received unknown parent window message: ${type}`)}},window.addEventListener("mousedown",cache.clickListener),window.addEventListener("message",cache.iframeEventListener,!1),window.parent.postMessage({type:PostHogAppToolbarEvent.PH_TOOLBAR_INIT},"*")}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.beforeUnmount)(_ref18=>{let{cache}=_ref18;window.removeEventListener("mousedown",cache.clickListener),window.removeEventListener("message",cache.iframeEventListener,!1)})])},"./frontend/src/toolbar/elements/elementsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>elementsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/.pnpm/query-selector-shadow-dom@1.0.0/node_modules/query-selector-shadow-dom/src/querySelectorDeep.js"),_toolbar_actions_actionsLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/toolbar/actions/actionsLogic.ts"),_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/toolbar/actions/actionsTabLogic.tsx"),_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/toolbar/stats/currentPageLogic.ts"),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/toolbar/toolbarConfigLogic.ts"),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/toolbar/toolbarPosthogJS.ts"),_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/toolbar/utils.ts"),_heatmapLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/toolbar/elements/heatmapLogic.ts");let elementsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","elements","elementsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A,["actionForm"],_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_3__.z,["href"]],actions:[_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A,["selectAction","newAction"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({enableInspect:!0,disableInspect:!0,selectElement:element=>({element}),createAction:element=>({element}),updateRects:!0,setHoverElement:element=>({element}),setHighlightElement:element=>({element}),setSelectedElement:element=>({element}),setRelativePositionCompensation:compensation=>({compensation})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(()=>({inspectEnabledRaw:[!1,{enableInspect:()=>!0,disableInspect:()=>!1}],rectUpdateCounter:[0,{updateRects:state=>state+1}],hoverElement:[null,{setHoverElement:(_,_ref)=>{let{element}=_ref;return element},enableInspect:()=>null,disableInspect:()=>null,createAction:()=>null,selectElement:()=>null}],highlightElement:[null,{setHighlightElement:(_,_ref2)=>{let{element}=_ref2;return element},setHoverElement:()=>null,setSelectedElement:()=>null,selectElement:()=>null,disableInspect:()=>null,createAction:()=>null}],selectedElement:[null,{setSelectedElement:(_,_ref3)=>{let{element}=_ref3;return element},disableInspect:()=>null,createAction:()=>null,[_heatmapLogic__WEBPACK_IMPORTED_MODULE_7__.XP.actionTypes.disableHeatmap]:()=>null,selectAction:()=>null}],enabledLast:[null,{enableInspect:()=>"inspect",[_heatmapLogic__WEBPACK_IMPORTED_MODULE_7__.XP.actionTypes.enableHeatmap]:()=>"heatmap"}],relativePositionCompensation:[0,{setRelativePositionCompensation:(_,_ref4)=>{let{compensation}=_ref4;return compensation}}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({activeMetaIsSelected:[s=>[s.selectedElementMeta,s.activeMeta],(selectedElementMeta,activeMeta)=>!!selectedElementMeta&&!!activeMeta&&selectedElementMeta.element===activeMeta.element],inspectEnabled:[s=>[s.inspectEnabledRaw,_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A.selectors.inspectingElement,_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A.selectors.buttonActionsVisible],(inspectEnabledRaw,inspectingElement,buttonActionsVisible)=>inspectEnabledRaw||buttonActionsVisible&&null!==inspectingElement],heatmapEnabled:[()=>[_heatmapLogic__WEBPACK_IMPORTED_MODULE_7__.XP.selectors.heatmapEnabled],heatmapEnabled=>heatmapEnabled],heatmapElements:[s=>[_heatmapLogic__WEBPACK_IMPORTED_MODULE_7__.XP.selectors.countedElements,s.rectUpdateCounter,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_4__.W.selectors.buttonVisible],countedElements=>countedElements.map(e=>({...e,rect:(0,_utils__WEBPACK_IMPORTED_MODULE_6__.vf)(e.element)}))],allInspectElements:[s=>[s.inspectEnabled,s.href],inspectEnabled=>inspectEnabled?(0,_utils__WEBPACK_IMPORTED_MODULE_6__.R6)():[]],inspectElements:[s=>[s.allInspectElements,s.rectUpdateCounter,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_4__.W.selectors.buttonVisible],allInspectElements=>allInspectElements.map(element=>({element,rect:(0,_utils__WEBPACK_IMPORTED_MODULE_6__.vf)(element)})).filter(e=>e.rect&&e.rect.width*e.rect.height>0)],displayActionElements:[()=>[_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A.selectors.buttonActionsVisible],buttonActionsVisible=>buttonActionsVisible],_actionElements:[s=>[s.displayActionElements,s.actionForm],(displayActionElements,actionForm)=>{if(displayActionElements&&actionForm?.steps){let allElements=(0,query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_8__.n8)("*",document),steps=[];return actionForm.steps.forEach((step,index)=>{let element=(0,_utils__WEBPACK_IMPORTED_MODULE_6__.o)(step,allElements);element&&steps.push({element,index})}),steps}return[]}],actionElements:[s=>[s._actionElements,s.rectUpdateCounter,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_4__.W.selectors.buttonVisible],actionElements=>actionElements.map(element=>element.element?{...element,rect:(0,_utils__WEBPACK_IMPORTED_MODULE_6__.vf)(element.element)}:element)],elementMap:[s=>[s.heatmapElements,s.inspectElements,s.actionElements,s.actionsListElements],(heatmapElements,inspectElements,actionElements,actionsListElements)=>{let elementMap=new Map;return[...inspectElements,...heatmapElements,...actionElements,...actionsListElements].forEach(e=>{let elementWithMetadata={...e};elementMap.get(e.element)?elementMap.set(e.element,{...elementMap.get(e.element),...elementWithMetadata}):elementMap.set(e.element,elementWithMetadata)}),elementMap}],_actionsForElementMap:[()=>[_toolbar_actions_actionsLogic__WEBPACK_IMPORTED_MODULE_1__.M.selectors.sortedActions],sortedActions=>{let allElements=(0,query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_8__.n8)("*",document),actionsForElementMap=new Map;return sortedActions.forEach((action,index)=>{action.steps?.filter(step=>"$autocapture"===step.event).forEach(step=>{let element=_utils__WEBPACK_IMPORTED_MODULE_6__.o(step,allElements);if(element){let rect=_utils__WEBPACK_IMPORTED_MODULE_6__.vf(element),array=actionsForElementMap.get(element);array||(array=[],actionsForElementMap.set(element,array)),array.push({action,step,element,rect,index})}})}),actionsForElementMap}],actionsForElementMap:[s=>[s._actionsForElementMap,s.rectUpdateCounter,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_4__.W.selectors.buttonVisible],actionsForElementMap=>(actionsForElementMap.forEach((actions,element)=>{actions.forEach(action=>{action.rect=(0,_utils__WEBPACK_IMPORTED_MODULE_6__.vf)(element)})}),actionsForElementMap)],elementsWithActions:[s=>[s.actionsForElementMap],actionsForElementMap=>[...actionsForElementMap.keys()]],actionsListElements:[s=>[s.actionsForElementMap],actionsForElementMap=>[...actionsForElementMap.values()].map(a=>a[0])],elementsToDisplayRaw:[s=>[s.displayActionElements,s.actionElements,s.inspectElements,s.actionsListElements,_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A.selectors.selectedAction],(displayActionElements,actionElements,inspectElements,actionsListElements,selectedAction)=>inspectElements.length>0?inspectElements:displayActionElements&&selectedAction&&actionElements.length>0?actionElements:displayActionElements&&!selectedAction&&actionsListElements.length>0?actionsListElements:[]],elementsToDisplay:[s=>[s.elementsToDisplayRaw],elementsToDisplayRaw=>elementsToDisplayRaw.filter(_ref5=>{let{rect}=_ref5;return rect&&(0!==rect.width||0!==rect.height)})],labelsToDisplay:[s=>[s.displayActionElements,s.actionElements,s.actionsListElements,_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A.selectors.selectedAction],(displayActionElements,actionElements,actionsListElements,selectedAction)=>displayActionElements&&selectedAction&&actionElements.length>0?actionElements:displayActionElements&&!selectedAction&&actionsListElements.length>0?actionsListElements:[]],selectedElementMeta:[s=>[s.selectedElement,s.elementMap,s.actionsForElementMap,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_4__.W.selectors.dataAttributes],(selectedElement,elementMap,actionsForElementMap,dataAttributes)=>{if(selectedElement){let meta=elementMap.get(selectedElement);if(meta){let actions=actionsForElementMap.get(selectedElement);return{...meta,actionStep:(0,_utils__WEBPACK_IMPORTED_MODULE_6__.bE)(meta.element,dataAttributes),actions:actions||[]}}}return null}],hoverElementMeta:[s=>[s.hoverElement,s.elementMap,s.actionsForElementMap,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_4__.W.selectors.dataAttributes],(hoverElement,elementMap,actionsForElementMap,dataAttributes)=>{if(hoverElement){let meta=elementMap.get(hoverElement);if(meta){let actions=actionsForElementMap.get(hoverElement);return{...meta,actionStep:(0,_utils__WEBPACK_IMPORTED_MODULE_6__.bE)(meta.element,dataAttributes),actions:actions||[]}}}return null}],highlightElementMeta:[s=>[s.highlightElement,s.elementMap,s.actionsForElementMap,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_4__.W.selectors.dataAttributes],(highlightElement,elementMap,actionsForElementMap,dataAttributes)=>{if(highlightElement){let meta=elementMap.get(highlightElement);if(meta){let actions=actionsForElementMap.get(highlightElement);return{...meta,actionStep:(0,_utils__WEBPACK_IMPORTED_MODULE_6__.bE)(meta.element,dataAttributes),actions:actions||[]}}}return null}],activeMeta:[s=>[s.selectedElementMeta,s.hoverElementMeta],(selectedElementMeta,hoverElementMeta)=>selectedElementMeta||hoverElementMeta]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref6=>{let{actions}=_ref6;return{enableInspect:()=>{_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_5__.T.capture("toolbar mode triggered",{mode:"inspect",enabled:!0}),_toolbar_actions_actionsLogic__WEBPACK_IMPORTED_MODULE_1__.M.actions.getActions()},disableInspect:()=>{_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_5__.T.capture("toolbar mode triggered",{mode:"inspect",enabled:!1})},selectElement:_ref7=>{let{element}=_ref7,inspectForAction=_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A.values.buttonActionsVisible&&null!==_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A.values.inspectingElement;inspectForAction?(actions.setHoverElement(null),element&&_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A.actions.inspectElementSelected(element,_toolbar_actions_actionsTabLogic__WEBPACK_IMPORTED_MODULE_2__.A.values.inspectingElement)):actions.setSelectedElement(element);let data_attributes=[];if(element?.attributes)for(let i=0;i<element.attributes.length;i++){let name=element.attributes.item(i)?.nodeName;name&&name.indexOf("data-")>-1&&data_attributes.push(name)}_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_5__.T.capture("toolbar selected HTML element",{element_tag:element?.tagName.toLowerCase(),element_type:element?.type,has_href:!!element?.href,has_class:!!element?.className,has_id:!!element?.id,has_name:!!element?.name,has_data_attr:data_attributes.includes("data-attr"),data_attributes:data_attributes,attribute_length:element?.attributes.length})},createAction:_ref8=>{let{element}=_ref8;actions.selectElement(null),actions.newAction(element)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.events)(_ref9=>{let{cache,values,actions}=_ref9;return{afterMount:()=>{cache.updateRelativePosition=function(func,waitFor){let timeout;return function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];clearTimeout(timeout),timeout=setTimeout(()=>func(...args),100)}}(()=>{let relativePositionCompensation="relative"===window.getComputedStyle(document.body).position?document.documentElement.getBoundingClientRect().y-document.body.getBoundingClientRect().y:0;relativePositionCompensation!==values.relativePositionCompensation&&actions.setRelativePositionCompensation(relativePositionCompensation)},0),cache.onClick=()=>actions.updateRects(),cache.onScrollResize=()=>{window.clearTimeout(cache.clickDelayTimeout),actions.updateRects(),cache.clickDelayTimeout=window.setTimeout(actions.updateRects,100),cache.updateRelativePosition()},cache.onKeyDown=e=>{if(27===e.keyCode){if(values.hoverElement&&actions.setHoverElement(null),values.selectedElement){actions.setSelectedElement(null);return}if("heatmap"===values.enabledLast&&values.heatmapEnabled){_heatmapLogic__WEBPACK_IMPORTED_MODULE_7__.XP.actions.disableHeatmap();return}if(values.inspectEnabled){actions.disableInspect();return}if(values.heatmapEnabled){_heatmapLogic__WEBPACK_IMPORTED_MODULE_7__.XP.actions.disableHeatmap();return}}},window.addEventListener("click",cache.onClick),window.addEventListener("resize",cache.onScrollResize),window.addEventListener("keydown",cache.onKeyDown),window.document.addEventListener("scroll",cache.onScrollResize,!0),cache.updateRelativePosition()},beforeUnmount:()=>{window.removeEventListener("click",cache.onClick),window.removeEventListener("resize",cache.onScrollResize),window.removeEventListener("keydown",cache.onKeyDown),window.document.removeEventListener("scroll",cache.onScrollResize,!0)}}})])},"./frontend/src/toolbar/elements/heatmapLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Rp:()=>HEATMAP_COLOR_PALETTE_OPTIONS,XP:()=>heatmapLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.5/node_modules/kea-subscriptions/lib/index.js"),kea_window_values__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-window-values@3.0.0_kea@3.1.5/node_modules/kea-window-values/lib/index.js"),lib_actionUtils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/actionUtils.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/utils.tsx"),query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/.pnpm/query-selector-shadow-dom@1.0.0/node_modules/query-selector-shadow-dom/src/querySelectorDeep.js"),_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/toolbar/stats/currentPageLogic.ts"),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/toolbar/toolbarConfigLogic.ts"),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/toolbar/toolbarPosthogJS.ts"),_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/toolbar/utils.ts"),_types__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/types.ts");let emptyElementsStatsPages={next:void 0,previous:void 0,results:[]},HEATMAP_COLOR_PALETTE_OPTIONS=[{value:"default",label:"Default (multicolor)"},{value:"red",label:"Red (monocolor)"},{value:"green",label:"Green (monocolor)"},{value:"blue",label:"Blue (monocolor)"}],heatmapLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","elements","heatmapLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_7__.z,["href","wildcardHref"],_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W,["posthog"]],actions:[_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_7__.z,["setHref","setWildcardHref"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({getElementStats:url=>({url}),enableHeatmap:!0,disableHeatmap:!0,setShiftPressed:shiftPressed=>({shiftPressed}),setCommonFilters:filters=>({filters}),setHeatmapFilters:filters=>({filters}),patchHeatmapFilters:filters=>({filters}),toggleClickmapsEnabled:enabled=>({enabled}),loadMoreElementStats:!0,setMatchLinksByHref:matchLinksByHref=>({matchLinksByHref}),loadHeatmap:type=>({type}),loadAllEnabled:function(){let delayMs=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{delayMs}},maybeLoadClickmap:function(){let delayMs=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{delayMs}},maybeLoadHeatmap:function(){let delayMs=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{delayMs}},fetchHeatmapApi:params=>({params}),setHeatmapScrollY:scrollY=>({scrollY}),setHeatmapFixedPositionMode:mode=>({mode}),setHeatmapColorPalette:Palette=>({Palette})}),(0,kea_window_values__WEBPACK_IMPORTED_MODULE_4__.windowValues)(()=>({windowWidth:window1=>window1.innerWidth,windowHeight:window1=>window1.innerHeight})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({matchLinksByHref:[!1,{setMatchLinksByHref:(_,_ref)=>{let{matchLinksByHref}=_ref;return matchLinksByHref}}],canLoadMoreElementStats:[!0,{getElementStatsSuccess:(_,_ref2)=>{let{elementStats}=_ref2;return null!==elementStats.next},getElementStatsFailure:()=>!0}],heatmapEnabled:[!1,{enableHeatmap:()=>!0,disableHeatmap:()=>!1,getElementStatsFailure:()=>!1}],shiftPressed:[!1,{setShiftPressed:(_,_ref3)=>{let{shiftPressed}=_ref3;return shiftPressed}}],commonFilters:[{date_from:"-7d"},{setCommonFilters:(_,_ref4)=>{let{filters}=_ref4;return filters}}],heatmapFilters:[{enabled:!0,type:"click",viewportAccuracy:.9,aggregation:"total_count"},{persist:!0},{setHeatmapFilters:(_,_ref5)=>{let{filters}=_ref5;return filters},patchHeatmapFilters:(state,_ref6)=>{let{filters}=_ref6;return{...state,...filters}}}],clickmapsEnabled:[!0,{persist:!0},{toggleClickmapsEnabled:(state,_ref7)=>{let{enabled}=_ref7;return void 0===enabled?!state:enabled}}],heatmapScrollY:[0,{setHeatmapScrollY:(_,_ref8)=>{let{scrollY}=_ref8;return scrollY}}],heatmapFixedPositionMode:["fixed",{setHeatmapFixedPositionMode:(_,_ref9)=>{let{mode}=_ref9;return mode}}],heatmapColorPalette:["default",{persist:!0},{setHeatmapColorPalette:(_,_ref10)=>{let{Palette}=_ref10;return Palette}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref11=>{let{values}=_ref11;return{elementStats:[null,{resetElementStats:()=>emptyElementsStatsPages,getElementStats:async(_ref12,breakpoint)=>{let{url}=_ref12,{href,wildcardHref}=values,defaultUrl="";if(!url){let params={properties:[wildcardHref===href?{key:"$current_url",value:href,operator:_types__WEBPACK_IMPORTED_MODULE_11__.WV.Exact,type:_types__WEBPACK_IMPORTED_MODULE_11__.FT.Event}:{key:"$current_url",value:`^${wildcardHref.split("*").map(lib_actionUtils__WEBPACK_IMPORTED_MODULE_5__.yI).join(".*")}$`,operator:_types__WEBPACK_IMPORTED_MODULE_11__.WV.Regex,type:_types__WEBPACK_IMPORTED_MODULE_11__.FT.Event}],date_from:values.commonFilters.date_from,date_to:values.commonFilters.date_to};defaultUrl=`/api/element/stats/${(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.encodeParams)({...params,paginate_response:!0},"?")}`}let response=await (0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.O)(url||defaultUrl,"GET",void 0,url?"use-as-provided":"full");if(403===response.status)return _toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.actions.authenticate(),emptyElementsStatsPages;let paginatedResults=await response.json();if(breakpoint(),!Array.isArray(paginatedResults.results))throw Error("Error loading HeatMap data!");return{results:[...url&&values.elementStats?.results||[],...paginatedResults.results||[]],next:paginatedResults.next,previous:paginatedResults.previous}}}],rawHeatmap:[null,{loadHeatmap:async()=>{let{href,wildcardHref}=values,{date_from,date_to}=values.commonFilters,{type,aggregation}=values.heatmapFilters,response=await (0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.O)(`/api/heatmap/${(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.encodeParams)({type,date_from,date_to,url_exact:wildcardHref===href?href:void 0,url_pattern:wildcardHref!==href?wildcardHref:void 0,viewport_width_min:values.viewportRange.min,viewport_width_max:values.viewportRange.max,aggregation},"?")}`,"GET");if(403===response.status&&_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.actions.authenticate(),200!==response.status)throw Error("API error");return await response.json()}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(_ref13=>{let{cache}=_ref13;return{dateRange:[s=>[s.commonFilters],commonFilters=>(0,lib_utils__WEBPACK_IMPORTED_MODULE_6__.Kl)(commonFilters.date_from,commonFilters.date_to,"Last 7 days")],elements:[s=>[s.elementStats,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.selectors.dataAttributes,s.href,s.matchLinksByHref],(elementStats,dataAttributes,href,matchLinksByHref)=>{cache.pageElements=cache.lastHref==href?cache.pageElements:(0,query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_12__.n8)("*",document),cache.selectorToElements=cache.lastHref==href?cache.selectorToElements:{},cache.lastHref=href;let elements=[];return elementStats?.results.forEach(event=>{let combinedSelector,lastSelector;for(let i=0;i<event.elements.length;i++){let element=event.elements[i],selector=lib_actionUtils__WEBPACK_IMPORTED_MODULE_5__.nr(matchLinksByHref?element:{...element,href:void 0},dataAttributes)||"*";combinedSelector=lastSelector?`${selector} > ${lastSelector}`:selector;try{let domElements=cache.selectorToElements?.[combinedSelector];if(void 0===domElements&&(domElements=Array.from(query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_12__.Jp(combinedSelector,document,cache.pageElements)),cache.selectorToElements[combinedSelector]=domElements),1===domElements.length){let e=event.elements[i];if(0!==i||!e.tag_name||e.attr_class||e.attr_id||e.href||e.text||1!==e.nth_child||1!==e.nth_of_type||e.attributes["attr__data-attr"])return elements.push({element:domElements[0],count:event.count,selector:selector,hash:event.hash,type:event.type}),null}if(0===domElements.length){if(i===event.elements.length-1)return null;if(i>0&&lastSelector){lastSelector=lastSelector?`* > ${lastSelector}`:"*";continue}}}catch(error){break}lastSelector=combinedSelector}}),elements}],countedElements:[s=>[s.elements,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.selectors.dataAttributes,s.clickmapsEnabled],(elements,dataAttributes,clickmapsEnabled)=>{if(!clickmapsEnabled)return[];let normalisedElements=new Map;(elements||[]).forEach(countedElement=>{let trimmedElement=(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.OS)(countedElement.element);if(trimmedElement){if(normalisedElements.has(trimmedElement)){let existing=normalisedElements.get(trimmedElement);existing&&(existing.count+=countedElement.count,existing.clickCount+="$rageclick"===countedElement.type?0:countedElement.count,existing.rageclickCount+="$rageclick"===countedElement.type?countedElement.count:0)}else normalisedElements.set(trimmedElement,{...countedElement,clickCount:"$rageclick"===countedElement.type?0:countedElement.count,rageclickCount:"$rageclick"===countedElement.type?countedElement.count:0,element:trimmedElement,actionStep:(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.bE)(trimmedElement,dataAttributes)})}});let countedElements=Array.from(normalisedElements.values());return countedElements.sort((a,b)=>b.count-a.count),countedElements.map((e,i)=>({...e,position:i+1}))}],elementCount:[s=>[s.countedElements],countedElements=>countedElements.length],clickCount:[s=>[s.countedElements],countedElements=>countedElements?countedElements.map(e=>e.count).reduce((a,b)=>a+b,0):0],highestClickCount:[s=>[s.countedElements],countedElements=>countedElements?countedElements.map(e=>e.count).reduce((a,b)=>b>a?b:a,0):0],heatmapElements:[s=>[s.rawHeatmap],rawHeatmap=>{if(!rawHeatmap)return[];let elements=[];return rawHeatmap?.results.forEach(element=>{"scroll_depth_bucket"in element?elements.push({count:element.cumulative_count,xPercentage:0,targetFixed:!1,y:element.scroll_depth_bucket}):elements.push({count:element.count,xPercentage:element.pointer_relative_x,targetFixed:element.pointer_target_fixed,y:element.pointer_y})}),elements}],viewportRange:[s=>[s.heatmapFilters,s.windowWidth],(heatmapFilters,windowWidth)=>{var _heatmapFilters$viewp;let viewportAccuracy=null!==(_heatmapFilters$viewp=heatmapFilters.viewportAccuracy)&&void 0!==_heatmapFilters$viewp?_heatmapFilters$viewp:.2,extraPixels=windowWidth-windowWidth*viewportAccuracy;return{min:Math.round(Math.max(0,windowWidth-extraPixels)),max:Math.round(windowWidth+extraPixels)}}],heatmapTooltipLabel:[s=>[s.heatmapFilters],heatmapFilters=>"unique_visitors"===heatmapFilters.aggregation?"visitors":heatmapFilters.type+"s"],scrollDepthPosthogJsError:[s=>[s.posthog],posthog=>{var _posthog$_calculate_e;let posthogVersion=null!==(_posthog$_calculate_e=posthog?._calculate_event_properties("test",{})?.$lib_version)&&void 0!==_posthog$_calculate_e?_posthog$_calculate_e:"0.0.0",majorMinorVersion=posthogVersion.split("."),majorVersion=parseInt(majorMinorVersion[0],10),minorVersion=parseInt(majorMinorVersion[1],10);if(!posthog?.scrollManager?.scrollY)return"version";let isDisabled=posthog?.config.disable_scroll_properties;return majorVersion>1||1===majorVersion&&minorVersion>=99?isDisabled?"disabled":null:"version"}],heatmapJsData:[s=>[s.heatmapElements,s.heatmapScrollY,s.windowWidth,s.heatmapFixedPositionMode],(heatmapElements,heatmapScrollY,windowWidth,heatmapFixedPositionMode)=>{let data=heatmapElements.reduce((acc,element)=>{if("hidden"===heatmapFixedPositionMode&&element.targetFixed)return acc;let y=Math.round(element.targetFixed&&"fixed"===heatmapFixedPositionMode?element.y:element.y-heatmapScrollY),x=Math.round(element.xPercentage*windowWidth);return[...acc,{x,y,value:element.count}]},[]),max=data.reduce((max,_ref14)=>{let{value}=_ref14;return Math.max(max,value)},0);return{min:0,max,data}}]}}),(0,kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__.subscriptions)(_ref15=>{let{actions}=_ref15;return{viewportRange:()=>{actions.maybeLoadHeatmap(500)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref16=>{let{actions,values}=_ref16;return{fetchHeatmapApi:async()=>{let{href,wildcardHref}=values,{date_from,date_to}=values.commonFilters,{type,aggregation}=values.heatmapFilters,response=await (0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.O)(`/api/heatmap/${(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.encodeParams)({type,date_from,date_to,url_exact:wildcardHref===href?href:void 0,url_pattern:wildcardHref!==href?wildcardHref:void 0,viewport_width_min:values.viewportRange.min,viewport_width_max:values.viewportRange.max,aggregation},"?")}`,"GET");if(403===response.status&&_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.actions.authenticate(),200!==response.status)throw Error("API error");return await response.json()},enableHeatmap:()=>{actions.loadAllEnabled(),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_9__.T.capture("toolbar mode triggered",{mode:"heatmap",enabled:!0})},disableHeatmap:()=>{actions.resetElementStats(),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_9__.T.capture("toolbar mode triggered",{mode:"heatmap",enabled:!1})},loadAllEnabled:async(_ref17,breakpoint)=>{let{delayMs}=_ref17;await breakpoint(delayMs),actions.maybeLoadHeatmap(),actions.maybeLoadClickmap()},maybeLoadClickmap:async(_ref18,breakpoint)=>{let{delayMs}=_ref18;await breakpoint(delayMs),values.heatmapEnabled&&values.clickmapsEnabled&&actions.getElementStats()},maybeLoadHeatmap:async(_ref19,breakpoint)=>{let{delayMs}=_ref19;await breakpoint(delayMs),values.heatmapEnabled&&values.heatmapFilters.enabled&&values.heatmapFilters.type&&actions.loadHeatmap(values.heatmapFilters.type)},setHref:()=>{actions.loadAllEnabled()},setWildcardHref:()=>{actions.loadAllEnabled(1e3)},setCommonFilters:()=>{actions.loadAllEnabled(200)},toggleClickmapsEnabled:()=>{values.clickmapsEnabled&&actions.getElementStats()},loadMoreElementStats:()=>{values.elementStats?.next&&actions.getElementStats(values.elementStats.next)},patchHeatmapFilters:_ref20=>{let{filters}=_ref20;filters.type&&actions.loadHeatmapSuccess({results:[]}),actions.maybeLoadHeatmap(200)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref21=>{let{actions,values,cache}=_ref21;actions.loadAllEnabled(),cache.keyDownListener=event=>{event.shiftKey&&!values.shiftPressed&&actions.setShiftPressed(!0)},cache.keyUpListener=event=>{!event.shiftKey&&values.shiftPressed&&actions.setShiftPressed(!1)},window.addEventListener("keydown",cache.keyDownListener),window.addEventListener("keyup",cache.keyUpListener),cache.scrollCheckTimer=setInterval(()=>{var _scrollManager$scroll;let scrollY=null!==(_scrollManager$scroll=values.posthog?.scrollManager?.scrollY())&&void 0!==_scrollManager$scroll?_scrollManager$scroll:0;values.heatmapScrollY!==scrollY&&actions.setHeatmapScrollY(scrollY)},100)}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.beforeUnmount)(_ref22=>{let{cache}=_ref22;window.removeEventListener("keydown",cache.keyDownListener),window.removeEventListener("keyup",cache.keyUpListener),clearInterval(cache.scrollCheckTimer)})])},"./frontend/src/toolbar/stats/currentPageLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{z:()=>currentPageLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js");let replaceWithWildcard=part=>part.match(/^([a-f]|[0-9]){8}-([a-f]|[0-9]){4}-([a-f]|[0-9]){4}-([a-f]|[0-9]){4}-([a-f]|[0-9]){12}$/)||part.match(/^[0-9]+$/)||part.length>24?"*":part,currentPageLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","stats","currentPageLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)(()=>({setHref:href=>({href}),setWildcardHref:href=>({href}),autoWildcardHref:!0})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(()=>({href:[window.location.href,{setHref:(_,_ref)=>{let{href}=_ref;return href}}],wildcardHref:[window.location.href,{setHref:(_,_ref2)=>{let{href}=_ref2;return href},setWildcardHref:(_,_ref3)=>{let{href}=_ref3;return href}}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions,values}=_ref4;return{autoWildcardHref:()=>{let url=values.wildcardHref,urlParts=url.split("?");if(url=urlParts[0].split("/").map(part=>replaceWithWildcard(part)).join("/"),urlParts.length>1){let queryParams=urlParts[1].split("&");for(let i=0;i<queryParams.length;i++){let[key,value]=queryParams[i].split("=");queryParams[i]=`${key}=${replaceWithWildcard(value)}`}url=`${url}?${queryParams.join("&")}`}actions.setWildcardHref(url)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref5=>{let{actions,values,cache}=_ref5;cache.interval=window.setInterval(()=>{window.location.href!==values.href&&actions.setHref(window.location.href)},500)}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.beforeUnmount)(_ref6=>{let{cache}=_ref6;window.clearInterval(cache.interval)})])}}]);