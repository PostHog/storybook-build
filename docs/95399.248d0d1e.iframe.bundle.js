"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[95399],{"../../products/messaging/frontend/MessagingTabs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{J:()=>MessagingTabs});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");let messagingTabsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","messagingTabsLogic"]),(0,index_esm.actions)({setTab:function(tab){let fromUrl=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{tab,fromUrl}}}),(0,index_esm.reducers)({currentTab:["broadcasts",{setTab:(_,_ref)=>{let{tab}=_ref;return tab}}]}),(0,lib.actionToUrl)(_ref2=>{let{values}=_ref2;return{setTab:_ref3=>{let{fromUrl}=_ref3;if(!fromUrl){var _campaigns$broadcasts;return null!==(_campaigns$broadcasts=({campaigns:urls.j.messagingCampaigns(),broadcasts:urls.j.messagingBroadcasts(),library:urls.j.messagingLibrary()})[values.currentTab])&&void 0!==_campaigns$broadcasts?_campaigns$broadcasts:urls.j.messagingBroadcasts()}}}}),(0,lib.urlToAction)(_ref4=>{let{actions,values}=_ref4;return{"/messaging/:tab":_ref5=>{let{tab}=_ref5;tab!==values.currentTab&&actions.setTab(tab,!0)},"/messaging/:tab/*":_ref6=>{let{tab}=_ref6;tab!==values.currentTab&&actions.setTab(tab,!0)}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function MessagingTabs(){let{currentTab}=(0,index_esm.useValues)(messagingTabsLogic),{setTab}=(0,index_esm.useActions)(messagingTabsLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),isAutomationEnabled=featureFlags[constants.y8.MESSAGING_AUTOMATION],isLibraryEnabled=featureFlags[constants.y8.MESSAGING_LIBRARY],tabs=[{key:"broadcasts",label:"Broadcasts"}];return isAutomationEnabled&&tabs.push({key:"campaigns",label:"Campaigns"}),isLibraryEnabled&&tabs.push({key:"library",label:"Templates"}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,onChange:tab=>setTab(tab),tabs:tabs})}},"../../products/messaging/frontend/library/MessageLibrary.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MessageLibrary:()=>MessageLibrary,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.6_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),MessagingTabs=__webpack_require__("../../products/messaging/frontend/MessagingTabs.tsx"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts");let messageLibraryLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","messageLibraryLogic"]),(0,index_esm.selectors)({breadcrumbs:[()=>[],()=>[{key:sceneTypes.x.MessagingLibrary,name:"Messaging",path:urls.j.messagingLibrary()},{key:"templates",name:"Templates",path:urls.j.messagingLibrary()}]]})]);var More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),deleteWithUndo=__webpack_require__("../../frontend/src/lib/utils/deleteWithUndo.tsx");let messageTemplatesLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","library","messageTemplatesLogic"]),(0,lib.loaders)(_ref=>{let{values,actions}=_ref;return{templates:[[],{loadTemplates:async()=>(await api.ZP.messaging.getTemplates()).results,deleteTemplate:async template=>(await (0,deleteWithUndo.S)({endpoint:"environments/@current/messaging/templates",object:{id:template.id,name:template.name},callback:undo=>{undo&&actions.loadTemplates()}}),values.templates.filter(t=>t.id!==template.id)),createTemplate:async _ref2=>{let{template}=_ref2;try{let newTemplate=await api.ZP.messaging.createTemplate(template);return LemonToast.U.success("Template created successfully"),[...values.templates,newTemplate]}catch(error){return LemonToast.U.error("Failed to create template"),values.templates}},updateTemplate:async _ref3=>{let{templateId,template}=_ref3;try{let updatedTemplate=await api.ZP.messaging.updateTemplate(templateId,template);return LemonToast.U.success("Template updated successfully"),values.templates.map(t=>t.id===templateId?updatedTemplate:t)}catch(error){return LemonToast.U.error("Failed to update template"),values.templates}}}]}}),(0,index_esm.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadTemplates()})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function MessageTemplatesTable(){(0,index_esm.useMountedLogic)(messageTemplatesLogic);let{templates,templatesLoading}=(0,index_esm.useValues)(messageTemplatesLogic),{deleteTemplate}=(0,index_esm.useActions)(messageTemplatesLogic),columns=[{title:"Name",render:(_,item)=>(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.messagingLibraryTemplate(item.id),title:item.name,description:item.description})},(0,columnUtils.JB)(),(0,columnUtils.rw)(),{width:0,render:function Render(_,message){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"message-template-delete",fullWidth:!0,status:"danger",onClick:()=>deleteTemplate(message),children:"Delete"})})})}}];return(0,jsx_runtime.jsx)("div",{className:"templates-section",children:(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:templates,loading:templatesLoading,columns:columns})})}function MessageLibrary(){return(0,jsx_runtime.jsxs)("div",{className:"messaging-library",children:[(0,jsx_runtime.jsx)(MessagingTabs.J,{},"library-tabs"),(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Create and manage messages",buttons:(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"new-message-button",icon:(0,jsx_runtime.jsx)(posthog_icons_es.iU,{}),size:"small",type:"primary",to:urls.j.messagingLibraryTemplateNew(),children:"New template"})}),(0,jsx_runtime.jsx)(MessageTemplatesTable,{})]})}let scene={component:MessageLibrary,logic:messageLibraryLogic}}}]);