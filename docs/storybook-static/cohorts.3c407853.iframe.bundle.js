(window.webpackJsonp=window.webpackJsonp||[]).push([[12,28],{5454:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return personsLogic}));__webpack_require__(53),__webpack_require__(69),__webpack_require__(171),__webpack_require__(103),__webpack_require__(301),__webpack_require__(54),__webpack_require__(278),__webpack_require__(390),__webpack_require__(436),__webpack_require__(2456),__webpack_require__(111),__webpack_require__(48),__webpack_require__(170),__webpack_require__(57);var _babel_runtime_helpers_objectDestructuringEmpty__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(95),_babel_runtime_helpers_objectDestructuringEmpty__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_babel_runtime_helpers_objectDestructuringEmpty__WEBPACK_IMPORTED_MODULE_14__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(8),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15__),_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(85),_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18__=(__webpack_require__(72),__webpack_require__(17)),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18__),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(5),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19__),kea__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(4),kea_router__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(27),lib_api__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(20),react_toastify__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(58),_types__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(9),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(51),scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(47);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19___default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var FILTER_ALLOWLIST=["is_identified","search","cohort"],personsLogic=Object(kea__WEBPACK_IMPORTED_MODULE_20__.kea)({connect:{actions:[lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_25__.c,["reportPersonDetailViewed"]]},actions:{setListFilters:function setListFilters(payload){return{payload:payload}},editProperty:function editProperty(key,newValue){return{key:key,newValue:newValue}},setHasNewKeys:!0,navigateToCohort:function navigateToCohort(cohort){return{cohort:cohort}},navigateToTab:function navigateToTab(tab){return{tab:tab}}},reducers:{listFilters:[{},{setListFilters:function setListFilters(state,_ref){var payload=_ref.payload;return _objectSpread(_objectSpread({},state),payload)}}],hasNewKeys:[!1,{setHasNewKeys:function setHasNewKeys(){return!0}}],activeTab:[_types__WEBPACK_IMPORTED_MODULE_24__.j.EVENTS,{navigateToTab:function navigateToTab(_,_ref2){return _ref2.tab}}]},selectors:{exampleEmail:[function(s){return[s.persons]},function(persons){var _match$properties,match=persons&&persons.results.find((function(person){var _person$properties;return null===(_person$properties=person.properties)||void 0===_person$properties?void 0:_person$properties.email}));return(null==match||null===(_match$properties=match.properties)||void 0===_match$properties?void 0:_match$properties.email)||"example@gmail.com"}]},listeners:function listeners(_ref3){var _editProperty,actions=_ref3.actions,values=_ref3.values;return{deletePersonSuccess:function deletePersonSuccess(){Object(react_toastify__WEBPACK_IMPORTED_MODULE_23__.c)("Person deleted successfully"),actions.loadPersons(),kea_router__WEBPACK_IMPORTED_MODULE_21__.router.actions.push(scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_26__.c.persons())},editProperty:(_editProperty=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee(_ref4){var key,newValue,person,parsedValue,action,oldPropertyType,newPropertyType,attemptedParsedNumber,lowercaseValue,response;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(key=_ref4.key,newValue=_ref4.newValue,!(person=values.person)){_context.next=17;break}return parsedValue=newValue,oldPropertyType=null===person.properties[key]?"null":_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16___default()(person.properties[key]),newPropertyType=_babel_runtime_helpers_typeof__WEBPACK_IMPORTED_MODULE_16___default()(newValue),attemptedParsedNumber=Number(newValue),Number.isNaN(attemptedParsedNumber)||"boolean"==typeof newValue||(parsedValue=attemptedParsedNumber,newPropertyType="number"),"true"!==(lowercaseValue="string"==typeof parsedValue&&parsedValue.toLowerCase())&&"false"!==lowercaseValue&&"null"!==lowercaseValue||(newPropertyType=null!==(parsedValue="true"===lowercaseValue||"null"===lowercaseValue&&null)?"boolean":"null"),Object.keys(person.properties).includes(key)?(person.properties[key]=parsedValue,action=void 0!==parsedValue?"updated":"removed"):(actions.setHasNewKeys(),person.properties=_objectSpread(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_19___default()({},key,parsedValue),person.properties),action="added"),actions.setPerson(person),_context.next=14,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.update("api/person/".concat(person.id),person);case 14:response=_context.sent,actions.setPerson(response),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_25__.c.actions.reportPersonPropertyUpdated(action,Object.keys(person.properties).length,oldPropertyType,newPropertyType);case 17:case"end":return _context.stop()}}),_callee)}))),function editProperty(_x){return _editProperty.apply(this,arguments)}),navigateToCohort:function navigateToCohort(_ref5){var cohort=_ref5.cohort;kea_router__WEBPACK_IMPORTED_MODULE_21__.router.actions.push(scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_26__.c.cohort(cohort.id))}}},loaders:function loaders(_ref6){var _deletePerson,_loadCohorts,_loadPerson,_loadPersons,values=_ref6.values,actions=_ref6.actions;return{persons:[{next:null,previous:null,results:[]},{loadPersons:(_loadPersons=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee2(){var url,qs,_args2=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return(url=_args2.length>0&&void 0!==_args2[0]?_args2[0]:"")||(qs=Object.keys(values.listFilters).filter((function(key){var _url;return"is_identified"!==key?FILTER_ALLOWLIST.includes(key):!(null===(_url=url)||void 0===_url?void 0:_url.includes("is_identified"))})).reduce((function(result,key){var value=values.listFilters[key];return null!=value&&result.push("".concat(key,"=").concat(encodeURIComponent(value))),result}),[]),url="api/person/".concat(qs.length?"?"+qs.join("&"):"")),_context2.next=4,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.get(url);case 4:return _context2.abrupt("return",_context2.sent);case 5:case"end":return _context2.stop()}}),_callee2)}))),function loadPersons(){return _loadPersons.apply(this,arguments)})}],person:[null,{loadPerson:(_loadPerson=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee3(id){var response,person;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.get("api/person/?distinct_id=".concat(id));case 2:return(response=_context3.sent).results.length||kea_router__WEBPACK_IMPORTED_MODULE_21__.router.actions.push(scenes_sceneLogic__WEBPACK_IMPORTED_MODULE_26__.c.notFound()),(person=response.results[0])&&actions.reportPersonDetailViewed(person),_context3.abrupt("return",person);case 7:case"end":return _context3.stop()}}),_callee3)}))),function loadPerson(_x2){return _loadPerson.apply(this,arguments)}),setPerson:function setPerson(person){return person}}],cohorts:[null,{loadCohorts:(_loadCohorts=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee4(){var _values$person,response;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.get("api/person/cohorts/?person_id=".concat(null===(_values$person=values.person)||void 0===_values$person?void 0:_values$person.id));case 2:return response=_context4.sent,_context4.abrupt("return",response.results);case 4:case"end":return _context4.stop()}}),_callee4)}))),function loadCohorts(){return _loadCohorts.apply(this,arguments)})}],deletedPerson:[!1,{deletePerson:(_deletePerson=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_18___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.mark((function _callee5(){return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_15___default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(values.person){_context5.next=2;break}return _context5.abrupt("return",!1);case 2:return _context5.next=4,lib_api__WEBPACK_IMPORTED_MODULE_22__.a.delete("api/person/".concat(values.person.id));case 4:return _context5.abrupt("return",!0);case 5:case"end":return _context5.stop()}}),_callee5)}))),function deletePerson(){return _deletePerson.apply(this,arguments)})}]}},actionToUrl:function actionToUrl(_ref7){var values=_ref7.values,props=_ref7.props;return{setListFilters:function setListFilters(){if(props.updateURL&&kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.location.pathname.indexOf("/persons")>-1)return["/persons",values.listFilters,void 0,{replace:!0}]},navigateToTab:function navigateToTab(){if(kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.location.pathname.indexOf("/person")>-1)return[kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.location.pathname,kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.searchParams,_objectSpread(_objectSpread({},kea_router__WEBPACK_IMPORTED_MODULE_21__.router.values.hashParams),{},{activeTab:values.activeTab})]}}},urlToAction:function urlToAction(_ref8){var actions=_ref8.actions,values=_ref8.values;return{"/persons":function persons(_ref9,searchParams){_babel_runtime_helpers_objectDestructuringEmpty__WEBPACK_IMPORTED_MODULE_14___default()(_ref9),actions.setListFilters(searchParams),values.persons.results.length||values.personsLoading||actions.loadPersons()},"/person/*":function person(_ref10,_ref11,_ref12){var _person=_ref10._,sessionRecordingId=_ref11.sessionRecordingId,activeTab=_ref12.activeTab;sessionRecordingId?actions.navigateToTab(_types__WEBPACK_IMPORTED_MODULE_24__.j.SESSIONS):activeTab&&values.activeTab!==activeTab&&actions.navigateToTab(activeTab),_person&&actions.loadPerson(_person)}}},path:function path(){return["scenes","persons","personsLogic"]}})},5501:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Persons",(function(){return Persons}));__webpack_require__(48),__webpack_require__(144);var react=__webpack_require__(0),react_default=__webpack_require__.n(react),index_esm=__webpack_require__(4),PersonsTable=__webpack_require__(1704),row=__webpack_require__(434),es_radio=__webpack_require__(1089),es_alert=__webpack_require__(808),es_button=__webpack_require__(114),ExportOutlined=__webpack_require__(5430),PlusOutlined=__webpack_require__(1666),PageHeader=__webpack_require__(256),personsLogic=__webpack_require__(5454),Link=__webpack_require__(49),LinkButton=__webpack_require__(324),ClockCircleFilled=__webpack_require__(5385),utils=__webpack_require__(12),slicedToArray=(__webpack_require__(99),__webpack_require__(257),__webpack_require__(16)),slicedToArray_default=__webpack_require__.n(slicedToArray),input=__webpack_require__(649),PersonsSearch_PersonsSearch=function PersonsSearch(_ref){var _ref$autoFocus=_ref.autoFocus,autoFocus=void 0===_ref$autoFocus||_ref$autoFocus,_useActions=Object(index_esm.useActions)(personsLogic.a),loadPersons=_useActions.loadPersons,setListFilters=_useActions.setListFilters,_useValues=Object(index_esm.useValues)(personsLogic.a),exampleEmail=_useValues.exampleEmail,listFilters=_useValues.listFilters,_useState=Object(react.useState)(""),_useState2=slicedToArray_default()(_useState,2),searchTerm=_useState2[0],setSearchTerm=_useState2[1];return Object(react.useEffect)((function(){setSearchTerm(listFilters.search)}),[]),react_default.a.createElement(input.a.Search,{"data-attr":"persons-search",placeholder:"search person by email, name or ID (e.g. ".concat(exampleEmail,")"),autoFocus:autoFocus,value:searchTerm,onChange:function onChange(e){setSearchTerm(e.target.value),e.target.value||(setListFilters({search:void 0}),loadPersons())},enterButton:!0,allowClear:!0,onSearch:function onSearch(){setListFilters({search:searchTerm||void 0}),loadPersons()},style:{width:"100%"}})};try{PersonsSearch_PersonsSearch.displayName="PersonsSearch",PersonsSearch_PersonsSearch.__docgenInfo={description:"",displayName:"PersonsSearch",props:{autoFocus:{defaultValue:{value:"true"},description:"",name:"autoFocus",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"]={docgenInfo:PersonsSearch_PersonsSearch.__docgenInfo,name:"PersonsSearch",path:"frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"})}catch(__react_docgen_typescript_loader_error){}var icons=__webpack_require__(93);function Persons(_ref){var cohort=_ref.cohort,_useActions=Object(index_esm.useActions)(personsLogic.a),loadPersons=_useActions.loadPersons,setListFilters=_useActions.setListFilters,_useValues=Object(index_esm.useValues)(personsLogic.a),persons=_useValues.persons,listFilters=_useValues.listFilters,personsLoading=_useValues.personsLoading;return Object(react.useEffect)((function(){cohort&&(setListFilters({cohort:cohort.id}),loadPersons())}),[]),react_default.a.createElement("div",{className:"persons-list"},!cohort&&react_default.a.createElement(PageHeader.a,{title:"Persons"}),react_default.a.createElement(row.a,{style:{gap:"0.75rem"},className:"mb"},react_default.a.createElement("div",{style:{flexGrow:1,maxWidth:600}},react_default.a.createElement(PersonsSearch_PersonsSearch,{autoFocus:!cohort}),react_default.a.createElement("div",{className:"text-muted text-small"},"You can also filter persons that have a certain property set (e.g. ",react_default.a.createElement("code",null,"has:email")," or"," ",react_default.a.createElement("code",null,"has:name"),")")),react_default.a.createElement("div",null,react_default.a.createElement(es_radio.a.Group,{buttonStyle:"solid",onChange:function onChange(e){var key=e.target.value;setListFilters({is_identified:"all"===key?void 0:key}),loadPersons()},value:void 0!==listFilters.is_identified?listFilters.is_identified.toString():"all"},react_default.a.createElement(es_radio.a.Button,{"data-attr":"people-types-tab-all",value:"all"},"All persons"),react_default.a.createElement(es_radio.a.Button,{"data-attr":"people-types-tab-identified",value:"true"},"Identified"),react_default.a.createElement(es_radio.a.Button,{"data-attr":"people-types-tab-anonymous",value:"false"},"Unidentified")))),"false"===listFilters.is_identified&&react_default.a.createElement("div",{className:"mb"},react_default.a.createElement(es_alert.a,{type:"info",closable:!0,message:react_default.a.createElement(react_default.a.Fragment,null,"Unidentified persons are usually anonymous visitors to your app or website that have not been identified to you. To mark a person as identified, call"," ",react_default.a.createElement("code",null,"posthog.identify")," on your frontend."," ",react_default.a.createElement("a",{href:"https://posthog.com/docs/integrations/js-integration?utm_medium=in-product&utm_campaign=persons-unidentified#identifying-users",target:"_blank",style:{display:"inline-flex",alignItems:"center"}},react_default.a.createElement(icons.h,null)," Learn more")),showIcon:!0})),react_default.a.createElement("div",{className:"mb text-right"},cohort?react_default.a.createElement(LinkButton.a,{to:"/sessions?".concat(Object(utils.lb)({properties:[{key:"id",value:cohort.id,type:"cohort"}]})),target:"_blank"},react_default.a.createElement(ClockCircleFilled.a,null)," View sessions"):null,react_default.a.createElement(es_button.a,{type:"default",icon:react_default.a.createElement(ExportOutlined.a,null),href:"/api/person.csv"+(listFilters.cohort?"?cohort="+listFilters.cohort:""),style:{marginLeft:8}},"Export"),react_default.a.createElement(Link.a,{to:"/cohorts/new",style:{display:"none"},className:"ml"},react_default.a.createElement(es_button.a,{type:"default",icon:react_default.a.createElement(PlusOutlined.a,null)},"New Cohort"))),react_default.a.createElement("div",null,react_default.a.createElement(PersonsTable.a,{people:persons.results,loading:personsLoading,hasPrevious:!!persons.previous,hasNext:!!persons.next,loadPrevious:function loadPrevious(){return loadPersons(persons.previous)},loadNext:function loadNext(){return loadPersons(persons.next)},allColumns:!0,backTo:cohort?"Cohort":"Persons"})))}try{Persons.displayName="Persons",Persons.__docgenInfo={description:"",displayName:"Persons",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!0,type:{name:"CohortType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/Persons.tsx#Persons"]={docgenInfo:Persons.__docgenInfo,name:"Persons",path:"frontend/src/scenes/persons/Persons.tsx#Persons"})}catch(__react_docgen_typescript_loader_error){}},5594:function(module,exports,__webpack_require__){(exports=__webpack_require__(70)(!1)).push([module.i,'.bg-mid{background-color:#f2f2f2!important}.mixin-base-bordered-card{border-radius:4px;box-shadow:0 4px 10px rgba(0,0,0,.04)}.mixin-elevated{box-shadow:0 80px 80px rgba(0,0,0,.075),0 10px 10px rgba(0,0,0,.035)!important}.mixin-gradient-overlay{width:100%;height:3rem;background:linear-gradient(0deg,#fff,transparent)}.mixin-gradient-overlay,.mixin-gradient-overlay-right{content:"";position:absolute;pointer-events:none;bottom:0}.mixin-gradient-overlay-right{width:3rem;height:100%;background:linear-gradient(270deg,#fff,transparent)}.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.cohorts-drawer .ant-drawer-content-wrapper{max-width:850px!important;width:100%!important}.cohort-type-description{text-align:center}.cohort-recalculating{background-color:#f2f2f2;padding:8px 16px;margin-top:16px;border-radius:2px}.cohort-recalculating .ant-spin-spinning{margin-right:6px}.cohort-csv-dragger .ant-upload-drag-container{display:flex!important;text-align:left}.cohort-csv-dragger .ant-upload-drag-container .ant-upload-drag-icon{margin:0!important;padding-left:16px;padding-right:16px}.cohort-csv-dragger .ant-upload-drag-container .ant-upload-text{font-size:1rem!important;margin:0!important}',""]),exports.locals={zDrawer:"950",zPopup:"1060",zGraphAnnotationPrompt:"99"},module.exports=exports},5931:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Cohorts",(function(){return Cohorts_Cohorts}));__webpack_require__(53),__webpack_require__(54),__webpack_require__(34),__webpack_require__(61),__webpack_require__(436),__webpack_require__(48),__webpack_require__(99),__webpack_require__(144),__webpack_require__(257),__webpack_require__(57);var slicedToArray=__webpack_require__(16),slicedToArray_default=__webpack_require__.n(slicedToArray),regenerator=__webpack_require__(8),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(72),__webpack_require__(17)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),react=__webpack_require__(0),react_default=__webpack_require__.n(react),dayjs_min=__webpack_require__(30),dayjs_min_default=__webpack_require__.n(dayjs_min),utils=__webpack_require__(12),spin=__webpack_require__(431),es_input=__webpack_require__(649),es_button=__webpack_require__(114),table=__webpack_require__(5337),InfoCircleOutlined=__webpack_require__(546),ExportOutlined=__webpack_require__(5430),DeleteOutlined=__webpack_require__(5352),ClockCircleOutlined=__webpack_require__(1097),cohortsModel=__webpack_require__(122),index_esm=__webpack_require__(4),PageHeader=__webpack_require__(256),PlusOutlined=__webpack_require__(1666),helpers_extends=(__webpack_require__(195),__webpack_require__(208),__webpack_require__(1702),__webpack_require__(650),__webpack_require__(24)),extends_default=__webpack_require__.n(helpers_extends),toConsumableArray=__webpack_require__(19),toConsumableArray_default=__webpack_require__.n(toConsumableArray),defineProperty=__webpack_require__(5),defineProperty_default=__webpack_require__.n(defineProperty);function CohortNameInput(_ref){var input=_ref.input,_onChange=_ref.onChange;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("label",{className:"ant-form-item-label",htmlFor:"cohort-name"},"Name"),react_default.a.createElement(es_input.a,{required:!0,autoFocus:!0,placeholder:"Name your cohort",value:input||"","data-attr":"cohort-name",onChange:function onChange(e){return _onChange(e.target.value)},id:"cohort-name",className:"ph-ignore-input"}))}try{CohortNameInput.displayName="CohortNameInput",CohortNameInput.__docgenInfo={description:"",displayName:"CohortNameInput",props:{input:{defaultValue:null,description:"",name:"input",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(input: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/CohortNameInput.tsx#CohortNameInput"]={docgenInfo:CohortNameInput.__docgenInfo,name:"CohortNameInput",path:"frontend/src/scenes/cohorts/CohortV2/CohortNameInput.tsx#CohortNameInput"})}catch(__react_docgen_typescript_loader_error){}function CohortDescriptionInput(_ref){var description=_ref.description,_onChange=_ref.onChange;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("label",{className:"ant-form-item-label",htmlFor:"cohort-description"},"Description"),react_default.a.createElement(es_input.a.TextArea,{placeholder:"Add a useful description for other team members",value:description||"","data-attr":"cohort-description",id:"cohort-description",onChange:function onChange(e){return _onChange(e.target.value)}}))}try{CohortDescriptionInput.displayName="CohortDescriptionInput",CohortDescriptionInput.__docgenInfo={description:"",displayName:"CohortDescriptionInput",props:{description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(input: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/CohortDescriptionInput.tsx#CohortDescriptionInput"]={docgenInfo:CohortDescriptionInput.__docgenInfo,name:"CohortDescriptionInput",path:"frontend/src/scenes/cohorts/CohortV2/CohortDescriptionInput.tsx#CohortDescriptionInput"})}catch(__react_docgen_typescript_loader_error){}var row=__webpack_require__(434),col=__webpack_require__(255),divider=__webpack_require__(5368),es_select=(__webpack_require__(111),__webpack_require__(148)),AimOutlined=__webpack_require__(1670),ContainerOutlined=__webpack_require__(2450),SelectBox=__webpack_require__(1037),actionsModel=__webpack_require__(248),types=__webpack_require__(9),ActionFilterDropdown=__webpack_require__(1705),eventDefinitionsModel=__webpack_require__(154);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function CohortEntityFilterBox(_ref){var _ref$open=_ref.open,open=void 0!==_ref$open&&_ref$open,onSelect=_ref.onSelect,eventDefinitions=Object(index_esm.useValues)(eventDefinitionsModel.a).eventDefinitions,actions=Object(index_esm.useValues)(actionsModel.a).actions;if(!open)return null;var groups=[{key:"actions",name:"Actions",header:function actionHeader(label){return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(AimOutlined.a,null)," ",label)},dataSource:actions.map((function(action){return{key:types.d.ACTIONS+action.id,name:action.name,volume:action.count,id:action.id,action:action}})),renderInfo:ActionFilterDropdown.b,type:"action_type",getValue:function getValue(item){var _item$action;return(null===(_item$action=item.action)||void 0===_item$action?void 0:_item$action.id)||""},getLabel:function getLabel(item){var _item$action2;return(null===(_item$action2=item.action)||void 0===_item$action2?void 0:_item$action2.name)||""}},{key:"events",name:"Events",header:function eventHeader(label){return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(ContainerOutlined.a,null)," ",label)},dataSource:eventDefinitions.map((function(definition){return function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({key:types.d.EVENTS+definition.name},definition)}))||[],renderInfo:function events(_ref2){var item=_ref2.item;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(ContainerOutlined.a,null)," Events",react_default.a.createElement("br",null),react_default.a.createElement("h3",null,item.name),(null==item?void 0:item.volume_30_day)&&react_default.a.createElement(react_default.a.Fragment,null,"Seen ",react_default.a.createElement("strong",null,item.volume_30_day)," times."," "),(null==item?void 0:item.query_usage_30_day)&&react_default.a.createElement(react_default.a.Fragment,null,"Used in ",react_default.a.createElement("strong",null,item.query_usage_30_day)," queries."))},type:"event_type",getValue:function getValue(item){return item.name},getLabel:function getLabel(item){return item.name}}];return react_default.a.createElement(SelectBox.a,{selectedItemKey:void 0,onDismiss:function onDismiss(){},onSelect:onSelect,items:groups})}try{CohortEntityFilterBox.displayName="CohortEntityFilterBox",CohortEntityFilterBox.__docgenInfo={description:"",displayName:"CohortEntityFilterBox",props:{open:{defaultValue:{value:"false"},description:"",name:"open",required:!1,type:{name:"boolean"}},onSelect:{defaultValue:null,description:"",name:"onSelect",required:!0,type:{name:"(type: any, id: string | number, name: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/CohortMatchingCriteriaSection/CohortEntityFilterBox.tsx#CohortEntityFilterBox"]={docgenInfo:CohortEntityFilterBox.__docgenInfo,name:"CohortEntityFilterBox",path:"frontend/src/scenes/cohorts/CohortV2/CohortMatchingCriteriaSection/CohortEntityFilterBox.tsx#CohortEntityFilterBox"})}catch(__react_docgen_typescript_loader_error){}var PropertyKeyInfo=__webpack_require__(46),SelectDownIcon=__webpack_require__(1685),constants=__webpack_require__(23),PropertyFilters=__webpack_require__(617),TaxonomicFilter_types=__webpack_require__(71),Option=es_select.a.Option;function MatchCriteriaSelector(_ref){var _group$properties,onCriteriaChange=_ref.onCriteriaChange,group=_ref.group,onRemove=_ref.onRemove,errored=_ref.showErrors&&(group.matchType===constants.k&&!(null===(_group$properties=group.properties)||void 0===_group$properties?void 0:_group$properties.length)||group.matchType===constants.w&&!(group.action_id||group.event_id));return react_default.a.createElement("div",{style:{padding:15,border:errored?"1px solid var(--danger)":"1px solid rgba(0, 0, 0, 0.1)",borderRadius:4,width:"100%"}},react_default.a.createElement(row.a,{align:"middle",justify:"space-between"},react_default.a.createElement("div",null,"Match users who",react_default.a.createElement(es_select.a,{defaultValue:constants.w,value:group.matchType,style:{width:240,marginLeft:10},onChange:function onMatchTypeChange(input){onCriteriaChange({matchType:input})}},react_default.a.createElement(Option,{value:constants.w},"have properties"),react_default.a.createElement(Option,{value:constants.k},"performed action or event"))),react_default.a.createElement(DeleteOutlined.a,{onClick:function onClick(){return onRemove()},style:{cursor:"pointer"}})),react_default.a.createElement(row.a,null,errored&&react_default.a.createElement("div",{style:{color:"var(--danger)",marginTop:16}},group.matchType===constants.k?"Please select an event or action.":"Please select at least one property or remove this match group.")),react_default.a.createElement(row.a,{align:"middle"},group.matchType===constants.k?react_default.a.createElement(EntityCriteriaRow,{group:group,onEntityCriteriaChange:onCriteriaChange}):react_default.a.createElement(PropertyCriteriaRow,{onPropertyCriteriaChange:onCriteriaChange,group:group})))}function PropertyCriteriaRow(_ref2){var group=_ref2.group,onPropertyCriteriaChange=_ref2.onPropertyCriteriaChange;return react_default.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%"}},react_default.a.createElement("div",{style:{flex:3,marginRight:5}},react_default.a.createElement(PropertyFilters.a,{endpoint:"person",pageKey:group.id,onChange:function onChange(properties){onPropertyCriteriaChange({properties:properties})},propertyFilters:group.properties,style:{margin:"1rem 0 0"},popoverPlacement:"bottomRight",groupTypes:[TaxonomicFilter_types.a.PersonProperties,TaxonomicFilter_types.a.CohortsWithAllUsers]})))}function EntityCriteriaRow(_ref3){var onEntityCriteriaChange=_ref3.onEntityCriteriaChange,group=_ref3.group,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),open=_useState2[0],setOpen=_useState2[1],label=group.label,days=group.days,count_operator=group.count_operator,count=group.count;return react_default.a.createElement("div",{style:{marginTop:16,width:"100%"}},react_default.a.createElement(row.a,{gutter:8},react_default.a.createElement(col.a,{flex:"auto"},react_default.a.createElement(es_button.a,{onClick:function onClick(){return setOpen(!open)},className:"full-width",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},"data-attr":"edit-cohort-entity-filter"},react_default.a.createElement(PropertyKeyInfo.b,{value:label||"Select an event"}),react_default.a.createElement(SelectDownIcon.a,{className:"text-muted"})),react_default.a.createElement(CohortEntityFilterBox,{open:open,onSelect:function onEntityChange(type,id,newLabel){type===constants.o&&"string"==typeof id?onEntityCriteriaChange({event_id:id,label:newLabel}):type===constants.g&&"number"==typeof id&&onEntityCriteriaChange({action_id:id,label:newLabel}),setOpen(!1)}})),react_default.a.createElement(col.a,{span:4},react_default.a.createElement(OperatorSelect,{value:count_operator,onChange:function onOperatorChange(newCountOperator){onEntityCriteriaChange({count_operator:newCountOperator})}})),react_default.a.createElement(col.a,{span:3},react_default.a.createElement(es_input.a,{required:!0,value:count,"data-attr":"entity-count",onChange:function onChange(e){return function onEntityCountChange(newCount){onEntityCriteriaChange({count:newCount})}(parseInt(e.target.value))},placeholder:"2",type:"number"})),react_default.a.createElement(col.a,{style:{display:"flex",alignItems:"center"}},"times in the last"),react_default.a.createElement(col.a,{span:4},react_default.a.createElement(DateIntervalSelect,{value:days,onChange:function onDateIntervalChange(dateInterval){onEntityCriteriaChange({days:dateInterval})}}))))}function OperatorSelect(_ref4){var onChange=_ref4.onChange,value=_ref4.value;return react_default.a.createElement(es_select.a,{value:value||"gte",style:{width:"100%"},onChange:onChange},react_default.a.createElement(Option,{value:"gte"},"at least"),react_default.a.createElement(Option,{value:"eq"},"exactly"),react_default.a.createElement(Option,{value:"lte"},"at most"))}function DateIntervalSelect(_ref5){var onChange=_ref5.onChange,value=_ref5.value,PRESET_OPTIONS={1:"day",7:"week",14:"2 weeks",30:"month"},valueOrDefault=null!=value?value:"1";return react_default.a.createElement(es_select.a,{value:valueOrDefault,style:{width:"100%"},onChange:onChange},Object.keys(PRESET_OPTIONS).map((function(key){return react_default.a.createElement(Option,{value:key,key:key},PRESET_OPTIONS[key])})))}try{MatchCriteriaSelector.displayName="MatchCriteriaSelector",MatchCriteriaSelector.__docgenInfo={description:"",displayName:"MatchCriteriaSelector",props:{onCriteriaChange:{defaultValue:null,description:"",name:"onCriteriaChange",required:!0,type:{name:"(group: Partial<CohortGroupType>) => void"}},group:{defaultValue:null,description:"",name:"group",required:!0,type:{name:"CohortGroupType"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"() => void"}},showErrors:{defaultValue:null,description:"",name:"showErrors",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/CohortMatchingCriteriaSection/MatchCriteriaSelector.tsx#MatchCriteriaSelector"]={docgenInfo:MatchCriteriaSelector.__docgenInfo,name:"MatchCriteriaSelector",path:"frontend/src/scenes/cohorts/CohortV2/CohortMatchingCriteriaSection/MatchCriteriaSelector.tsx#MatchCriteriaSelector"})}catch(__react_docgen_typescript_loader_error){}function CohortMatchingCriteriaSection_CohortMatchingCriteriaSection(_ref){var _onCriteriaChange=_ref.onCriteriaChange,cohort=_ref.cohort,onAddGroup=_ref.onAddGroup,onRemoveGroup=_ref.onRemoveGroup,showErrors=_ref.showErrors,addButton=react_default.a.createElement("div",{style:{marginTop:8,marginBottom:8}},react_default.a.createElement("a",{href:"#add",style:{padding:0},onClick:function onClick(){return onAddGroup()}},react_default.a.createElement(PlusOutlined.a,null)," Add matching criteria"));return react_default.a.createElement(col.a,null,react_default.a.createElement("h3",{className:"l3"},"Matching Criteria"),react_default.a.createElement("div",{className:"mb"},"Users who match the following criteria will be part of the cohort. Continuously updated automatically."),addButton,react_default.a.createElement("div",null,cohort.groups.map((function(group,index){return react_default.a.createElement(react_default.a.Fragment,{key:index},react_default.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}},react_default.a.createElement(MatchCriteriaSelector,{onCriteriaChange:function onCriteriaChange(newGroup){return _onCriteriaChange(newGroup,group.id)},onRemove:function onRemove(){return onRemoveGroup(index)},group:group,showErrors:showErrors}),index<cohort.groups.length-1&&react_default.a.createElement("div",{className:"stateful-badge or mt mb"},"OR")))}))),react_default.a.createElement("span",{id:"add"}),!!cohort.groups.length&&addButton)}try{CohortMatchingCriteriaSection_CohortMatchingCriteriaSection.displayName="CohortMatchingCriteriaSection",CohortMatchingCriteriaSection_CohortMatchingCriteriaSection.__docgenInfo={description:"",displayName:"CohortMatchingCriteriaSection",props:{onCriteriaChange:{defaultValue:null,description:"",name:"onCriteriaChange",required:!0,type:{name:"(group: Partial<CohortGroupType>, id: string) => void"}},cohort:{defaultValue:null,description:"",name:"cohort",required:!0,type:{name:"CohortType"}},onAddGroup:{defaultValue:null,description:"",name:"onAddGroup",required:!0,type:{name:"() => void"}},onRemoveGroup:{defaultValue:null,description:"",name:"onRemoveGroup",required:!0,type:{name:"(index: number) => void"}},showErrors:{defaultValue:null,description:"",name:"showErrors",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/CohortMatchingCriteriaSection/CohortMatchingCriteriaSection.tsx#CohortMatchingCriteriaSection"]={docgenInfo:CohortMatchingCriteriaSection_CohortMatchingCriteriaSection.__docgenInfo,name:"CohortMatchingCriteriaSection",path:"frontend/src/scenes/cohorts/CohortV2/CohortMatchingCriteriaSection/CohortMatchingCriteriaSection.tsx#CohortMatchingCriteriaSection"})}catch(__react_docgen_typescript_loader_error){}try{CohortMatchingCriteriaSection.displayName="CohortMatchingCriteriaSection",CohortMatchingCriteriaSection.__docgenInfo={description:"",displayName:"CohortMatchingCriteriaSection",props:{onCriteriaChange:{defaultValue:null,description:"",name:"onCriteriaChange",required:!0,type:{name:"(group: Partial<CohortGroupType>, id: string) => void"}},cohort:{defaultValue:null,description:"",name:"cohort",required:!0,type:{name:"CohortType"}},onAddGroup:{defaultValue:null,description:"",name:"onAddGroup",required:!0,type:{name:"() => void"}},onRemoveGroup:{defaultValue:null,description:"",name:"onRemoveGroup",required:!0,type:{name:"(index: number) => void"}},showErrors:{defaultValue:null,description:"",name:"showErrors",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/CohortMatchingCriteriaSection/index.tsx#CohortMatchingCriteriaSection"]={docgenInfo:CohortMatchingCriteriaSection.__docgenInfo,name:"CohortMatchingCriteriaSection",path:"frontend/src/scenes/cohorts/CohortV2/CohortMatchingCriteriaSection/index.tsx#CohortMatchingCriteriaSection"})}catch(__react_docgen_typescript_loader_error){}var InboxOutlined=__webpack_require__(5955),LoadingOutlined=__webpack_require__(345),SaveOutlined=__webpack_require__(5428),Dragger=__webpack_require__(5489),Dragger_default=__webpack_require__.n(Dragger),ProfilePicture=__webpack_require__(772);function TeamMemberID(_ref){var person=_ref.person;return react_default.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},person?react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(ProfilePicture.a,{name:null==person?void 0:person.first_name,email:null==person?void 0:person.email,size:"md"}),react_default.a.createElement("span",{style:{marginLeft:4}},(null==person?void 0:person.first_name)||(null==person?void 0:person.email))):react_default.a.createElement("span",{className:"text-muted"},"Unknown"))}try{TeamMemberID.displayName="TeamMemberID",TeamMemberID.__docgenInfo={description:"",displayName:"TeamMemberID",props:{person:{defaultValue:null,description:"",name:"person",required:!1,type:{name:"UserBasicType | null"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/TeamMemberID.tsx#TeamMemberID"]={docgenInfo:TeamMemberID.__docgenInfo,name:"TeamMemberID",path:"frontend/src/lib/components/TeamMemberID.tsx#TeamMemberID"})}catch(__react_docgen_typescript_loader_error){}var PreflightCheck_logic=__webpack_require__(56);function CohortDetailsRow(_ref){var cohort=_ref.cohort,preflight=Object(index_esm.useValues)(PreflightCheck_logic.a).preflight,columnSize=(null==preflight?void 0:preflight.is_clickhouse_enabled)?12:8;return react_default.a.createElement(row.a,{justify:"space-between",align:"top",className:"mt text-center"},react_default.a.createElement(col.a,{span:columnSize},react_default.a.createElement("label",{className:"ant-form-item-label"},"Created"),react_default.a.createElement("div",null,dayjs_min_default()(cohort.created_at).fromNow())),react_default.a.createElement(col.a,{span:columnSize},react_default.a.createElement("label",{className:"ant-form-item-label"},"Created By"),react_default.a.createElement("div",null,react_default.a.createElement(TeamMemberID,{person:cohort.created_by}))),!(null==preflight?void 0:preflight.is_clickhouse_enabled)&&react_default.a.createElement(col.a,{span:columnSize},react_default.a.createElement("label",{className:"ant-form-item-label"},"Last Calculated"),react_default.a.createElement("div",null,cohort.last_calculation?dayjs_min_default()(cohort.last_calculation).fromNow():"in progress")))}try{CohortDetailsRow.displayName="CohortDetailsRow",CohortDetailsRow.__docgenInfo={description:"",displayName:"CohortDetailsRow",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!0,type:{name:"CohortType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/CohortDetailsRow.tsx#CohortDetailsRow"]={docgenInfo:CohortDetailsRow.__docgenInfo,name:"CohortDetailsRow",path:"frontend/src/scenes/cohorts/CohortV2/CohortDetailsRow.tsx#CohortDetailsRow"})}catch(__react_docgen_typescript_loader_error){}var Persons=__webpack_require__(5501),react_toastify=(__webpack_require__(172),__webpack_require__(58)),api=__webpack_require__(20);function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function cohortLogic_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function cohortLogic_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?cohortLogic_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):cohortLogic_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function formatGroupPayload(group){return cohortLogic_objectSpread(cohortLogic_objectSpread({},group),{},{id:void 0,matchType:void 0})}function determineMatchType(group){return group.action_id||group.event_id?constants.k:constants.w}function processCohortOnSet(cohort){return cohort.groups&&(cohort.groups=cohort.groups.map((function(group){return function addLocalCohortGroupId(group){return cohortLogic_objectSpread({matchType:determineMatchType(group),id:Math.random().toString().substr(2,5)},group)}(group)}))),cohort}var cohortLogic=Object(index_esm.kea)({props:{},key:function key(props){return props.cohort.id||"new"},connect:[cohortsModel.a],actions:function actions(){return{saveCohort:function saveCohort(){var cohortParams=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},filterParams=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{cohortParams:cohortParams,filterParams:filterParams}},setCohort:function setCohort(cohort){return{cohort:cohort}},fetchCohort:function fetchCohort(cohort){return{cohort:cohort}},setPollTimeout:function setPollTimeout(pollTimeout){return{pollTimeout:pollTimeout}},setLastSavedAt:function setLastSavedAt(lastSavedAt){return{lastSavedAt:lastSavedAt}},checkIfFinishedCalculating:function checkIfFinishedCalculating(cohort){return{cohort:cohort}},setSubmitted:function setSubmitted(submitted){return{submitted:submitted}}}},reducers:function reducers(_ref){return{pollTimeout:[null,{setPollTimeout:function setPollTimeout(_,_ref2){return _ref2.pollTimeout}}],cohort:[processCohortOnSet(_ref.props.cohort),{setCohort:function setCohort(_,_ref3){return processCohortOnSet(_ref3.cohort)}}],lastSavedAt:[!1,{setLastSavedAt:function setLastSavedAt(_,_ref4){return _ref4.lastSavedAt}}],submitted:[!1,{setSubmitted:function setSubmitted(_,_ref5){return _ref5.submitted}}]}},listeners:function listeners(_ref6){var _checkIfFinishedCalculating,_fetchCohort,_saveCohort,actions=_ref6.actions,values=_ref6.values,key=_ref6.key;return{saveCohort:(_saveCohort=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(_ref7,breakpoint){var cohortParams,filterParams,cohort,cohortFormData,_i,_Object$entries,_Object$entries$_i,itemKey,value,_iterator,_step,_group$properties,_group,formattedGroups;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:cohortParams=_ref7.cohortParams,filterParams=_ref7.filterParams,cohort=cohortLogic_objectSpread(cohortLogic_objectSpread({},values.cohort),cohortParams),cohortFormData=new FormData,_i=0,_Object$entries=Object.entries(cohort);case 4:if(!(_i<_Object$entries.length)){_context.next=36;break}if(_Object$entries$_i=slicedToArray_default()(_Object$entries[_i],2),itemKey=_Object$entries$_i[0],value=_Object$entries$_i[1],"groups"!==itemKey){_context.next=32;break}_iterator=_createForOfIteratorHelper(value),_context.prev=8,_iterator.s();case 10:if((_step=_iterator.n()).done){_context.next=20;break}if((_group=_step.value).matchType!==constants.w||(null===(_group$properties=_group.properties)||void 0===_group$properties?void 0:_group$properties.length)){_context.next=15;break}return actions.setSubmitted(!0),_context.abrupt("return");case 15:if(_group.matchType!==constants.k||_group.action_id||_group.event_id){_context.next=18;break}return actions.setSubmitted(!0),_context.abrupt("return");case 18:_context.next=10;break;case 20:_context.next=25;break;case 22:_context.prev=22,_context.t0=_context.catch(8),_iterator.e(_context.t0);case 25:return _context.prev=25,_iterator.f(),_context.finish(25);case 28:formattedGroups=value.map((function(group){return formatGroupPayload(group)})),cohort.csv?cohortFormData.append(itemKey,"[]"):cohortFormData.append(itemKey,JSON.stringify(formattedGroups)),_context.next=33;break;case 32:cohortFormData.append(itemKey,value);case 33:_i++,_context.next=4;break;case 36:if(_context.prev=36,"new"===cohort.id){_context.next=44;break}return _context.next=40,api.a.update("api/cohort/"+cohort.id+(filterParams?"?"+filterParams:""),cohortFormData);case 40:cohort=_context.sent,cohortsModel.a.actions.updateCohort(cohort),_context.next=48;break;case 44:return _context.next=46,api.a.create("api/cohort"+(filterParams?"?"+filterParams:""),cohortFormData);case 46:cohort=_context.sent,cohortsModel.a.actions.createCohort(cohort);case 48:_context.next=54;break;case 50:return _context.prev=50,_context.t1=_context.catch(36),Object(utils.x)("Error saving your cohort","Attempting to save this cohort returned an error:",0!==_context.t1.status?_context.t1.detail:"Check your internet connection and make sure you don't have an extension blocking our requests.",_context.t1.code),_context.abrupt("return");case 54:actions.setSubmitted(!1),cohort.is_calculating=!0,breakpoint(),delete cohort.csv,actions.setCohort(cohort),react_toastify.c.success(react_default.a.createElement("div",{"data-attr":"success-toast"},react_default.a.createElement("h1",null,"Cohort saved successfully!"),react_default.a.createElement("p",null,"Please wait up to a few minutes for the cohort to be calculated.")),{toastId:"cohort-saved-".concat(key)}),actions.checkIfFinishedCalculating(cohort);case 61:case"end":return _context.stop()}}),_callee,null,[[8,22,25,28],[36,50]])}))),function saveCohort(_x,_x2){return _saveCohort.apply(this,arguments)}),fetchCohort:(_fetchCohort=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(_ref8,breakpoint){var cohort;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return cohort=_ref8.cohort,_context2.next=3,api.a.get("api/cohort/"+cohort.id);case 3:cohort=_context2.sent,breakpoint(),actions.checkIfFinishedCalculating(cohort);case 6:case"end":return _context2.stop()}}),_callee2)}))),function fetchCohort(_x3,_x4){return _fetchCohort.apply(this,arguments)}),checkIfFinishedCalculating:(_checkIfFinishedCalculating=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(_ref9,breakpoint){var cohort;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:cohort=_ref9.cohort,breakpoint(),cohort.is_calculating?actions.setPollTimeout(setTimeout((function(){return actions.fetchCohort(cohort)}),1e3)):(actions.setLastSavedAt((new Date).toISOString()),actions.setCohort(cohort),cohortsModel.a.actions.updateCohort(cohort),values.pollTimeout&&(clearTimeout(values.pollTimeout),actions.setPollTimeout(null)));case 3:case"end":return _context3.stop()}}),_callee3)}))),function checkIfFinishedCalculating(_x5,_x6){return _checkIfFinishedCalculating.apply(this,arguments)})}},events:function events(_ref10){var _afterMount,values=_ref10.values,actions=_ref10.actions,props=_ref10.props;return{afterMount:(_afterMount=asyncToGenerator_default()(regenerator_default.a.mark((function _callee4(){return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:props.cohort.id||actions.setCohort({groups:[],id:"new"});case 1:case"end":return _context4.stop()}}),_callee4)}))),function afterMount(){return _afterMount.apply(this,arguments)}),beforeUnmount:function beforeUnmount(){values.pollTimeout&&clearTimeout(values.pollTimeout)}}},path:function path(key){return["scenes","cohorts","CohortV2","cohortLogic",key]}});try{cohortLogic.displayName="cohortLogic",cohortLogic.__docgenInfo={description:"",displayName:"cohortLogic",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/cohortLogic.tsx#cohortLogic"]={docgenInfo:cohortLogic.__docgenInfo,name:"cohortLogic",path:"frontend/src/scenes/cohorts/CohortV2/cohortLogic.tsx#cohortLogic"})}catch(__react_docgen_typescript_loader_error){}var OrderedListOutlined=__webpack_require__(5441),CalculatorOutlined=__webpack_require__(5407),DropdownSelector=__webpack_require__(2371);function CohortV2_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function CohortV2_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?CohortV2_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):CohortV2_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function CohortV2(props){var logic=cohortLogic(props),setCohort=Object(index_esm.useActions)(logic).setCohort,_useValues=Object(index_esm.useValues)(logic),cohort=_useValues.cohort,submitted=_useValues.submitted,staticCSVDraggerProps={name:"file",multiple:!1,fileList:cohort.csv?[cohort.csv]:[],beforeUpload:function beforeUpload(file){return setCohort(CohortV2_objectSpread(CohortV2_objectSpread({},cohort),{},{csv:file})),!1},accept:".csv"},COHORT_TYPE_OPTIONS=[{key:constants.j,label:"Static",description:"Upload a list of users. Updates manually",icon:react_default.a.createElement(OrderedListOutlined.a,null)},{key:constants.i,label:"Dynamic",description:"Cohort updates dynamically based on properties",icon:react_default.a.createElement(CalculatorOutlined.a,null)}];return react_default.a.createElement("div",{className:"mb"},react_default.a.createElement(row.a,{gutter:16},react_default.a.createElement(col.a,null,react_default.a.createElement("h3",{className:"l3"},"General"))),react_default.a.createElement(row.a,{gutter:16},react_default.a.createElement(col.a,{md:14},react_default.a.createElement(CohortNameInput,{input:cohort.name,onChange:function onNameChange(name){setCohort(CohortV2_objectSpread(CohortV2_objectSpread({},cohort),{},{name:name}))}})),react_default.a.createElement(col.a,{md:10},react_default.a.createElement(DropdownSelector.a,{options:COHORT_TYPE_OPTIONS,value:cohort.is_static?constants.j:constants.i,onValueChange:function onTypeChange(type){type===constants.j?setCohort(CohortV2_objectSpread(CohortV2_objectSpread({},cohort),{},{is_static:!0})):type===constants.i&&setCohort(CohortV2_objectSpread(CohortV2_objectSpread({},cohort),{},{is_static:!1}))}}))),react_default.a.createElement(row.a,{gutter:16,className:"mt"},react_default.a.createElement(col.a,{span:24},react_default.a.createElement(CohortDescriptionInput,{description:cohort.description,onChange:function onDescriptionChange(description){setCohort(CohortV2_objectSpread(CohortV2_objectSpread({},cohort),{},{description:description}))}}))),cohort.id&&"new"!==cohort.id&&react_default.a.createElement(CohortDetailsRow,{cohort:cohort}),react_default.a.createElement(divider.a,null),cohort.is_static?react_default.a.createElement("div",null,react_default.a.createElement("h3",{className:"l3"},"Add Users"),react_default.a.createElement("span",null,"Drop a ",react_default.a.createElement("pre",{style:{display:"inline"}},".csv")," file here to add users to your cohort"),react_default.a.createElement(Dragger_default.a,extends_default()({},staticCSVDraggerProps,{className:"cohort-csv-dragger"}),react_default.a.createElement("p",{className:"ant-upload-drag-icon"},react_default.a.createElement(InboxOutlined.a,null)),react_default.a.createElement("div",null,react_default.a.createElement("p",{className:"ant-upload-text"},"Click or drag file to this area to upload"),react_default.a.createElement("p",{className:"ant-upload-hint"},"The CSV file only requires a single column with the user’s distinct ID.")))):react_default.a.createElement(CohortMatchingCriteriaSection_CohortMatchingCriteriaSection,{onCriteriaChange:function onCriteriaChange(_group,id){var index=cohort.groups.findIndex((function(group){return group.id===id}));_group.matchType?cohort.groups[index]=CohortV2_objectSpread({id:cohort.groups[index].id,matchType:constants.k},_group):cohort.groups[index]=CohortV2_objectSpread(CohortV2_objectSpread({},cohort.groups[index]),_group),setCohort(CohortV2_objectSpread({},cohort))},cohort:cohort,onAddGroup:function onAddGroup(){cohort.groups=[].concat(toConsumableArray_default()(cohort.groups),[{id:Math.random().toString().substr(2,5),matchType:constants.w,properties:[]}]),setCohort(CohortV2_objectSpread({},cohort))},onRemoveGroup:function onRemoveGroup(index){cohort.groups.splice(index,1),setCohort(CohortV2_objectSpread({},cohort))},showErrors:submitted}),"new"!==cohort.id&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(divider.a,null),react_default.a.createElement("div",null,react_default.a.createElement("h3",{className:"l3"},"Matched Users"),react_default.a.createElement("span",null,"List of users that currently match the criteria defined"),cohort.is_calculating?react_default.a.createElement("div",{className:"cohort-recalculating"},react_default.a.createElement(spin.a,{indicator:react_default.a.createElement(LoadingOutlined.a,{style:{fontSize:24},spin:!0})})," We're recalculating who belongs to this cohort. This could take up to a couple of minutes."):react_default.a.createElement("div",{style:{marginTop:15}},react_default.a.createElement(Persons.Persons,{cohort:cohort})))))}function CohortV2Footer(props){var logic=cohortLogic(props),cohort=Object(index_esm.useValues)(logic).cohort,saveCohort=Object(index_esm.useActions)(logic).saveCohort;return react_default.a.createElement(row.a,{style:{display:"flex"}},react_default.a.createElement(es_button.a,{type:"link",danger:!0,icon:react_default.a.createElement(DeleteOutlined.a,null)},"Delete cohort"),react_default.a.createElement("div",{style:{flexGrow:1,textAlign:"right"}},react_default.a.createElement(es_button.a,{disabled:!cohort.name,type:"primary",htmlType:"submit","data-attr":"save-cohort",onClick:saveCohort,style:{float:"right"},icon:react_default.a.createElement(SaveOutlined.a,null)},"Save cohort")))}try{CohortV2.displayName="CohortV2",CohortV2.__docgenInfo={description:"",displayName:"CohortV2",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!0,type:{name:"CohortType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/CohortV2.tsx#CohortV2"]={docgenInfo:CohortV2.__docgenInfo,name:"CohortV2",path:"frontend/src/scenes/cohorts/CohortV2/CohortV2.tsx#CohortV2"})}catch(__react_docgen_typescript_loader_error){}try{CohortV2Footer.displayName="CohortV2Footer",CohortV2Footer.__docgenInfo={description:"",displayName:"CohortV2Footer",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!0,type:{name:"CohortType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortV2/CohortV2.tsx#CohortV2Footer"]={docgenInfo:CohortV2Footer.__docgenInfo,name:"CohortV2Footer",path:"frontend/src/scenes/cohorts/CohortV2/CohortV2.tsx#CohortV2Footer"})}catch(__react_docgen_typescript_loader_error){}__webpack_require__(69),__webpack_require__(301);var CloseButton=__webpack_require__(294),PropertyFilters_PropertyFilters=__webpack_require__(325),card=__webpack_require__(5375),es_radio=__webpack_require__(1089);function CohortGroup(_ref){var _onChange=_ref.onChange,onRemove=_ref.onRemove,group=_ref.group,index=_ref.index,allowRemove=_ref.allowRemove,actionsGrouped=Object(index_esm.useValues)(actionsModel.a).actionsGrouped,_useState=Object(react.useState)(group.action_id?"action":group.properties&&"property"),_useState2=slicedToArray_default()(_useState,2),selected=_useState2[0],setSelected=_useState2[1];return react_default.a.createElement(card.a,{title:!1,style:{margin:0}},allowRemove&&react_default.a.createElement(CloseButton.a,{className:"float-right",onClick:onRemove}),react_default.a.createElement("div",{style:{height:32}},react_default.a.createElement("span",{style:{paddingRight:"action"!==selected?40:0}},"User has"),"action"===selected&&" done ",react_default.a.createElement("span",{style:{paddingRight:8}},react_default.a.createElement(es_radio.a.Group,{buttonStyle:"solid",onChange:function onChange(e){setSelected(e.target.value),_onChange({})},size:"small",value:selected},react_default.a.createElement(es_radio.a.Button,{value:"action","data-attr":"cohort-group-action"},"action"),react_default.a.createElement(es_radio.a.Button,{value:"property","data-attr":"cohort-group-property"},"property"))),"action"==selected&&react_default.a.createElement("span",null,"in the last",react_default.a.createElement(es_radio.a.Group,{buttonStyle:"solid",onChange:function onChange(e){return _onChange({action_id:group.action_id,days:e.target.value})},size:"small",value:group.days,style:{paddingLeft:8}},react_default.a.createElement(es_radio.a.Button,{value:"1"},"day"),react_default.a.createElement(es_radio.a.Button,{value:"7"},"7 days"),react_default.a.createElement(es_radio.a.Button,{value:"30"},"month")))),selected&&react_default.a.createElement("div",{style:{minHeight:38}},"property"==selected&&react_default.a.createElement(PropertyFilters_PropertyFilters.a,{endpoint:"person",pageKey:"cohort_"+index,onChange:function onChange(properties){_onChange(properties.length?{properties:properties,days:group.days}:{})},propertyFilters:group.properties||{},groupTypes:[TaxonomicFilter_types.a.PersonProperties,TaxonomicFilter_types.a.CohortsWithAllUsers],style:{margin:"1rem 0 0"},popoverPlacement:"bottomRight"}),"action"==selected&&react_default.a.createElement("div",{style:{marginTop:"1rem"}},react_default.a.createElement(es_select.a,{showSearch:!0,placeholder:"Select action...",style:{width:"100%"},onChange:function onChange(value){return _onChange({action_id:value,days:group.days})},filterOption:function filterOption(input,option){return(null==option?void 0:option.children)&&option.children.toLowerCase().indexOf(input.toLowerCase())>=0},value:group.action_id},actionsGrouped.map((function(typeGroup){if(typeGroup.options.length>0)return react_default.a.createElement(es_select.a.OptGroup,{key:typeGroup.label,label:typeGroup.label},typeGroup.options.map((function(item){return react_default.a.createElement(es_select.a.Option,{key:item.value,value:item.value},item.label)})))}))))))}try{CohortGroup.displayName="CohortGroup",CohortGroup.__docgenInfo={description:"",displayName:"CohortGroup",props:{onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"CallableFunction"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"CallableFunction"}},group:{defaultValue:null,description:"",name:"group",required:!0,type:{name:"Record<string, any>"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},allowRemove:{defaultValue:null,description:"",name:"allowRemove",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortGroup.tsx#CohortGroup"]={docgenInfo:CohortGroup.__docgenInfo,name:"CohortGroup",path:"frontend/src/scenes/cohorts/CohortGroup.tsx#CohortGroup"})}catch(__react_docgen_typescript_loader_error){}var cohorts_cohortLogic=__webpack_require__(1596),ArrowLeftOutlined=__webpack_require__(5342),UnorderedListOutlined=__webpack_require__(5450);function Cohort_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function Cohort_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Cohort_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):Cohort_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var isSubmitDisabled=function isSubmitDisabled(cohort){return(!cohort||!cohort.csv)&&(!cohort||!cohort.groups||cohort.groups.filter(isValidGroup).length!==cohort.groups.length)},isValidGroup=function isValidGroup(group){return!(!group.days||!group.action_id)||!!(group.properties&&group.properties.length>0)};function StaticCohort(_ref){var logic=_ref.logic,setCohort=Object(index_esm.useActions)(logic).setCohort,_useValues=Object(index_esm.useValues)(logic),cohort=_useValues.cohort,isNewCohort=_useValues.isNewCohort,props={name:"file",multiple:!1,fileList:cohort.csv?[cohort.csv]:[],beforeUpload:function beforeUpload(file){return setCohort(Cohort_objectSpread(Cohort_objectSpread({},cohort),{},{csv:file})),!1},accept:".csv"};return react_default.a.createElement(react_default.a.Fragment,null,isNewCohort&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(es_button.a,{size:"small",type:"link",onClick:function onClick(){return setCohort(Cohort_objectSpread(Cohort_objectSpread({},cohort),{},{is_static:void 0}))}},react_default.a.createElement(ArrowLeftOutlined.a,null)," Create dynamic cohort instead"),react_default.a.createElement("br",null),react_default.a.createElement("br",null)),react_default.a.createElement(Dragger_default.a,props,react_default.a.createElement("p",{className:"ant-upload-drag-icon"},react_default.a.createElement(InboxOutlined.a,null)),react_default.a.createElement("p",{className:"ant-upload-text"},"Click or drag CSV to this area to upload"),react_default.a.createElement("p",{className:"ant-upload-hint"},"Make sure the file has a single column with the user's distinct_id.")),!isNewCohort&&react_default.a.createElement("p",{style:{marginTop:"1rem"}},"This is a static cohort with ",react_default.a.createElement("strong",null,cohort.count)," user",1!==cohort.count&&"s",". If you upload another .csv file, those users will be added to this cohort."))}function DynamicCohort(_ref2){var logic=_ref2.logic,_useActions2=Object(index_esm.useActions)(logic),updateCohortGroups=_useActions2.updateCohortGroups,setCohort=_useActions2.setCohort,_useValues2=Object(index_esm.useValues)(logic),cohort=_useValues2.cohort,isNewCohort=_useValues2.isNewCohort;return react_default.a.createElement(react_default.a.Fragment,null,isNewCohort&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(es_button.a,{size:"small",type:"link",onClick:function onClick(){return setCohort(Cohort_objectSpread(Cohort_objectSpread({},cohort),{},{is_static:void 0}))}},react_default.a.createElement(ArrowLeftOutlined.a,null)," Create static cohort instead"),react_default.a.createElement("br",null),react_default.a.createElement("br",null)),cohort.groups.map((function(group,index){return react_default.a.createElement(react_default.a.Fragment,{key:index},react_default.a.createElement(CohortGroup,{group:group,allowRemove:cohort.groups.length>1,index:index,onRemove:function onRemove(){var groups=toConsumableArray_default()(cohort.groups).splice(index,1);updateCohortGroups(groups)},onChange:function onChange(_group){var groups=toConsumableArray_default()(cohort.groups);groups[index]=_group,updateCohortGroups(groups)}}),index<cohort.groups.length-1&&react_default.a.createElement("div",{key:index,className:"secondary",style:{textAlign:"center",margin:8}}," ","OR"," "))})))}function CohortChoice(_ref3){var setCohort=_ref3.setCohort,cohort=_ref3.cohort;return react_default.a.createElement(row.a,{gutter:24},react_default.a.createElement(col.a,{sm:12},react_default.a.createElement(card.a,{title:"Dynamic cohort",size:"small",className:"clickable-card","data-attr":"cohort-choice-definition",onClick:function onClick(){return setCohort(Cohort_objectSpread(Cohort_objectSpread({},cohort),{},{is_static:!1}))},style:{height:"100%"}},react_default.a.createElement("div",{style:{textAlign:"center",fontSize:40}},react_default.a.createElement(AimOutlined.a,null)),react_default.a.createElement("div",{className:"cohort-type-description"},"Define rules or properties to match automatically to your users. Updates automatically."))),react_default.a.createElement(col.a,{sm:12},react_default.a.createElement(card.a,{title:"Static cohort",size:"small",className:"clickable-card","data-attr":"cohort-choice-upload-csv",onClick:function onClick(){return setCohort(Cohort_objectSpread(Cohort_objectSpread({},cohort),{},{is_static:!0}))},style:{height:"100%"}},react_default.a.createElement("div",{style:{textAlign:"center",fontSize:40}},react_default.a.createElement(UnorderedListOutlined.a,null)),react_default.a.createElement("div",{className:"cohort-type-description"},"Upload a list of users to create cohort with a specific set of users."))))}function Cohort(props){var logic=Object(cohorts_cohortLogic.a)(props),_useActions3=Object(index_esm.useActions)(logic),setCohort=_useActions3.setCohort,saveCohort=_useActions3.saveCohort,_useValues3=Object(index_esm.useValues)(logic),cohort=_useValues3.cohort,lastSavedAt=_useValues3.lastSavedAt,isNewCohort=_useValues3.isNewCohort;return react_default.a.createElement("div",{style:{maxWidth:750},className:"mb"},react_default.a.createElement("form",{onSubmit:function onSubmit(e){e.preventDefault(),saveCohort()}},react_default.a.createElement("div",{className:"mb"},react_default.a.createElement(es_input.a,{required:!0,autoFocus:!0,placeholder:"Cohort name...",value:cohort.name,"data-attr":"cohort-name",onChange:function onChange(e){return setCohort(Cohort_objectSpread(Cohort_objectSpread({},cohort),{},{name:e.target.value}))}})),isNewCohort&&void 0===cohort.is_static&&react_default.a.createElement(CohortChoice,{cohort:cohort,setCohort:setCohort}),cohort.is_static&&react_default.a.createElement(StaticCohort,{logic:logic}),(!1===cohort.is_static||null===cohort.is_static&&!isNewCohort)&&react_default.a.createElement(DynamicCohort,{logic:logic}),react_default.a.createElement("div",{className:"mt"},react_default.a.createElement(es_button.a,{type:"primary",htmlType:"submit",disabled:isSubmitDisabled(cohort),"data-attr":"save-cohort",style:{marginRight:"1rem"}},"Save cohort"),!1===cohort.is_static&&react_default.a.createElement(es_button.a,{onClick:function onClick(){return setCohort(Cohort_objectSpread(Cohort_objectSpread({},cohort),{},{groups:[].concat(toConsumableArray_default()(cohort.groups),[{}])}))}},"New group"))),react_default.a.createElement(divider.a,null),!isNewCohort&&react_default.a.createElement(Persons.Persons,{cohort:cohort,key:lastSavedAt}))}try{Cohort.displayName="Cohort",Cohort.__docgenInfo={description:"",displayName:"Cohort",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!0,type:{name:"CohortType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/Cohort.tsx#Cohort"]={docgenInfo:Cohort.__docgenInfo,name:"Cohort",path:"frontend/src/scenes/cohorts/Cohort.tsx#Cohort"})}catch(__react_docgen_typescript_loader_error){}var Drawer=__webpack_require__(1673),injectStylesIntoStyleTag=__webpack_require__(31),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Cohorts=__webpack_require__(5594),Cohorts_default=__webpack_require__.n(Cohorts),options={insert:"head",singleton:!1},fuse_esm=(injectStylesIntoStyleTag_default()(Cohorts_default.a,options),Cohorts_default.a.locals,__webpack_require__(249)),Table=__webpack_require__(1107),Tooltip=__webpack_require__(50),relativeTime=__webpack_require__(226),relativeTime_default=__webpack_require__.n(relativeTime),Link=__webpack_require__(49),featureFlagLogic=__webpack_require__(80);dayjs_min_default.a.extend(relativeTime_default.a);var NEW_COHORT={id:"new",groups:[{id:Math.random().toString().substr(2,5),matchType:constants.w,properties:[]}]},cohortsUrlLogic=Object(index_esm.kea)({actions:{setOpenCohort:function setOpenCohort(cohort){return{cohort:cohort}}},reducers:{openCohort:[null,{setOpenCohort:function setOpenCohort(_,_ref){return _ref.cohort}}]},actionToUrl:function actionToUrl(_ref2){var values=_ref2.values;return{setOpenCohort:function setOpenCohort(){return"/cohorts"+(values.openCohort?"/"+(values.openCohort.id||"new"):"")}}},urlToAction:function urlToAction(_ref3){var _cohortsCohortId,actions=_ref3.actions,values=_ref3.values;return{"/cohorts(/:cohortId)":(_cohortsCohortId=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(_ref4){var _values$openCohort,cohortId,cohort;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!(cohortId=_ref4.cohortId)||"new"===cohortId||"personsModalNew"===cohortId||Number(cohortId)===(null===(_values$openCohort=values.openCohort)||void 0===_values$openCohort?void 0:_values$openCohort.id)){_context.next=8;break}return _context.next=4,api.a.get("api/cohort/"+cohortId);case 4:cohort=_context.sent,actions.setOpenCohort(cohort),_context.next=9;break;case 8:"new"===cohortId&&actions.setOpenCohort(NEW_COHORT);case 9:case"end":return _context.stop()}}),_callee)}))),function cohortsCohortId(_x){return _cohortsCohortId.apply(this,arguments)})}},path:function path(){return["scenes","cohorts","Cohorts"]}}),Cohorts_searchCohorts=function searchCohorts(sources,search){return new fuse_esm.a(sources,{keys:["name"],threshold:.3}).search(search).map((function(result){return result.item}))};function Cohorts_Cohorts(){var _useValues=Object(index_esm.useValues)(cohortsModel.a),cohorts=_useValues.cohorts,cohortsLoading=_useValues.cohortsLoading,loadCohorts=Object(index_esm.useActions)(cohortsModel.a).loadCohorts,openCohort=Object(index_esm.useValues)(cohortsUrlLogic).openCohort,setOpenCohort=Object(index_esm.useActions)(cohortsUrlLogic).setOpenCohort,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),searchTerm=_useState2[0],setSearchTerm=_useState2[1],featureFlags=Object(index_esm.useValues)(featureFlagLogic.a).featureFlags,preflight=Object(index_esm.useValues)(PreflightCheck_logic.a).preflight,columns=[{title:"Name",dataIndex:"name",key:"name",className:"ph-no-capture",sorter:function sorter(a,b){return(""+a.name).localeCompare(b.name)}},{title:"Users in cohort",render:function RenderCount(_,cohort){var _cohort$count;return null===(_cohort$count=cohort.count)||void 0===_cohort$count?void 0:_cohort$count.toLocaleString()},sorter:function sorter(a,b){return(a.count||0)-(b.count||0)}},Object(Table.a)(),Object(Table.b)(cohorts),{title:react_default.a.createElement("span",null,react_default.a.createElement(Tooltip.a,{title:"PostHog calculates what users belong to each cohort. This is then used when filtering on cohorts in the Trends page etc. Calculating happens every 15 minutes, or whenever a cohort is updated."},"Last calculation",react_default.a.createElement(InfoCircleOutlined.a,{style:{marginLeft:6}}))),render:function RenderCalculation(_,cohort){return cohort.is_static?react_default.a.createElement(react_default.a.Fragment,null,"N/A"):cohort.is_calculating?react_default.a.createElement("span",null,"Calculating ",react_default.a.createElement(spin.a,null)):dayjs_min_default()(cohort.last_calculation).fromNow()}},{title:"Actions",render:function RenderActions(cohort){var filters={filters:[{key:"id",label:cohort.name,type:"cohort",value:cohort.id}]},sessionsLink="/sessions?"+Object(utils.lb)(filters);return react_default.a.createElement("span",null,react_default.a.createElement("a",{href:"/api/person.csv?cohort="+cohort.id},react_default.a.createElement(Tooltip.a,{title:"Export all users in this cohort as a .csv file"},react_default.a.createElement(ExportOutlined.a,null))),"new"!==cohort.id&&"personsModalNew"!==cohort.id&&react_default.a.createElement(utils.b,{endpoint:"cohort",object:{name:cohort.name,id:cohort.id},className:"text-danger",style:{marginLeft:8,marginRight:8},callback:loadCohorts},react_default.a.createElement(DeleteOutlined.a,null)),react_default.a.createElement(Link.a,{onClick:function onClick(e){e.stopPropagation()},to:"".concat(sessionsLink,"#backTo=cohorts&backToURL=").concat(window.location.pathname),"data-attr":"cohorts-table-sessions"},"Sessions ",react_default.a.createElement(ClockCircleOutlined.a,null)))}}],COHORT_V2=featureFlags[constants.q.ENGAGEMENT_COHORTS]&&(null==preflight?void 0:preflight.is_clickhouse_enabled);return react_default.a.createElement("div",null,react_default.a.createElement(PageHeader.a,{title:"Cohorts",caption:"Create lists of users who have something in common to use in analytics or feature flags."}),react_default.a.createElement("div",null,react_default.a.createElement(es_input.a.Search,{allowClear:!0,enterButton:!0,style:{maxWidth:400,width:"initial",flexGrow:1},onChange:function onChange(e){setSearchTerm(e.target.value)}}),react_default.a.createElement("div",{className:"mb float-right"},react_default.a.createElement(es_button.a,{type:"primary","data-attr":"create-cohort",onClick:function onClick(){return setOpenCohort(NEW_COHORT)},icon:react_default.a.createElement(PlusOutlined.a,null)},"New Cohort")),react_default.a.createElement(table.a,{size:"small",columns:columns,loading:cohortsLoading,rowKey:"id",pagination:{pageSize:100,hideOnSinglePage:!0},rowClassName:"cursor-pointer",onRow:function onRow(cohort){return{onClick:function onClick(){return setOpenCohort(cohort)},"data-test-cohort-row":cohort.id}},dataSource:searchTerm?Cohorts_searchCohorts(cohorts,searchTerm):cohorts}),react_default.a.createElement(Drawer.a,{title:"new"===(null==openCohort?void 0:openCohort.id)?"New cohort":null==openCohort?void 0:openCohort.name,className:"cohorts-drawer",onClose:function onClose(){return setOpenCohort(null)},destroyOnClose:!0,visible:!!openCohort,footer:openCohort&&COHORT_V2?react_default.a.createElement(CohortV2Footer,{cohort:openCohort}):null},openCohort&&(COHORT_V2?react_default.a.createElement(CohortV2,{cohort:openCohort}):react_default.a.createElement(Cohort,{cohort:openCohort})))))}}}]);