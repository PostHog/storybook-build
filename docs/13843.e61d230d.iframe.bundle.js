(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[13843],{"../../frontend/src/scenes/billing/BillingSection.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BillingSection:()=>BillingSection,scene:()=>scene}),__webpack_require__("../../frontend/src/scenes/billing/Billing.scss");var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),billing_Billing=__webpack_require__("../../frontend/src/scenes/billing/Billing.tsx"),injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),BillingUsage=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/billing/BillingUsage.scss"),BillingUsage_default=__webpack_require__.n(BillingUsage),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(BillingUsage_default(),options),BillingUsage_default().locals;var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.27.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),exportsLogic=__webpack_require__("../../frontend/src/lib/components/ExportButton/exportsLogic.ts"),RestrictedArea=__webpack_require__("../../frontend/src/lib/components/RestrictedArea.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonInputSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInputSelect/LemonInputSelect.tsx"),LemonLabel=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),types=__webpack_require__("../../frontend/src/types.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),colors=__webpack_require__("../../frontend/src/lib/colors.ts"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),BillingLineGraph=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/billing/BillingLineGraph.scss"),BillingLineGraph_default=__webpack_require__.n(BillingLineGraph),BillingLineGraph_options={};BillingLineGraph_options.insert="head",BillingLineGraph_options.singleton=!1,injectStylesIntoStyleTag_default()(BillingLineGraph_default(),BillingLineGraph_options),BillingLineGraph_default().locals,__webpack_require__("../../node_modules/.pnpm/chartjs-adapter-dayjs-3@1.2.3_chart.js@4.4.3_dayjs@1.11.11_patch_hash=lbfir4woetqmvzqg7l4q5mjtfq_/node_modules/chartjs-adapter-dayjs-3/dist/chartjs-adapter-dayjs-3.esm.js");var chartjs_plugin_annotation_esm=__webpack_require__("../../node_modules/.pnpm/chartjs-plugin-annotation@2.2.1_chart.js@4.4.3/node_modules/chartjs-plugin-annotation/dist/chartjs-plugin-annotation.esm.js"),client=__webpack_require__("../../node_modules/.pnpm/react-dom@18.2.0_react@18.2.0/node_modules/react-dom/client.js"),Chart=__webpack_require__("../../frontend/src/lib/Chart.ts"),useOnMountEffect=__webpack_require__("../../frontend/src/lib/hooks/useOnMountEffect.ts"),themeLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function BillingLineGraphTooltip(_ref){let{title,sortedSeries}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold text-text-primary",children:title}),sortedSeries.map(item=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(SeriesColorDot,{colorIndex:item.id}),(0,jsx_runtime.jsx)("span",{className:"text-text-secondary whitespace-nowrap overflow-hidden text-ellipsis max-w-xs",children:item.label})]}),(0,jsx_runtime.jsx)("span",{className:"font-medium text-text-primary whitespace-nowrap",children:item.formattedValue})]},item.id))]})}function useBillingMarkersPositioning(chart,chartWidth,chartHeight){return(0,react.useMemo)(()=>{if(!chart||!chart.scales.x)return{chartAreaLeft:0,chartAreaTop:0,getMarkerPosition:()=>({left:0,visible:!1})};let xScale=chart.scales.x,yScale=chart.scales.y;return{chartAreaLeft:xScale.left,chartAreaTop:yScale.top,getMarkerPosition:date=>{let utcMidnightTimestamp=date.utc().startOf("day").valueOf(),xPos=xScale.getPixelForValue(utcMidnightTimestamp),visible=void 0!==xPos&&xPos>=xScale.left&&xPos<=xScale.right;return{left:visible?xPos-xScale.left:0,visible}}}},[chart,chartWidth,chartHeight])}Chart.kL.register(chartjs_plugin_annotation_esm.Z);let defaultFormatter=value=>value.toLocaleString();function useBillingTooltip(){let tooltipElRef=(0,react.useRef)(null),tooltipRootRef=(0,react.useRef)(null),ensureBillingTooltip=(0,react.useCallback)(()=>(tooltipElRef.current||(tooltipElRef.current=document.createElement("div"),tooltipElRef.current.id="BillingTooltipWrapper",tooltipElRef.current.className="BillingTooltipWrapper hidden absolute z-10 p-2 bg-bg-light rounded shadow-md text-xs pointer-events-none border border-border",document.body.appendChild(tooltipElRef.current)),tooltipRootRef.current||(tooltipRootRef.current=(0,client.createRoot)(tooltipElRef.current)),[tooltipRootRef.current,tooltipElRef.current]),[]),hideBillingTooltip=(0,react.useCallback)(()=>{tooltipElRef.current&&(tooltipElRef.current.classList.add("hidden"),tooltipElRef.current.classList.remove("block"))},[]);return(0,useOnMountEffect.x)(()=>()=>{tooltipRootRef.current&&setTimeout(()=>tooltipRootRef.current?.unmount(),0),tooltipElRef.current?.remove()}),{ensureBillingTooltip,hideBillingTooltip}}function SeriesColorDot(_ref){let{colorIndex}=_ref;return(0,jsx_runtime.jsx)("div",{className:`series-color-dot series-color-dot-${colorIndex%15}`})}function BillingLineGraph_BillingLineGraph(_ref2){let{series,dates,isLoading,hiddenSeries,valueFormatter=defaultFormatter,showLegend=!0,interval="day",billingPeriodMarkers=[]}=_ref2,canvasRef=(0,react.useRef)(null),chartRef=(0,react.useRef)(null),[chartReady,setChartReady]=(0,react.useState)(!1),[chartDimensions,setChartDimensions]=(0,react.useState)({width:0,height:0}),[axisLabelColor,setAxisLabelColor]=(0,react.useState)("#666666"),[markersReady,setMarkersReady]=(0,react.useState)(!1),[stableChartAreaLeft,setStableChartAreaLeft]=(0,react.useState)(null),markerTimeoutRef=(0,react.useRef)(null),{ensureBillingTooltip,hideBillingTooltip}=useBillingTooltip(),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),{chartAreaLeft,chartAreaTop,getMarkerPosition}=useBillingMarkersPositioning(chartRef.current||void 0,chartDimensions.width,chartDimensions.height);return(0,react.useEffect)(()=>{if(!canvasRef.current)return;chartRef.current&&chartRef.current.destroy();let visibleSeries=series.filter(s=>!hiddenSeries.includes(s.id)),graphColors=(0,colors.lw)(),currentAxisLabelColor=graphColors.axisLabel||"#666666";setAxisLabelColor(currentAxisLabelColor);let datasets=visibleSeries.map(s=>({label:s.label,data:s.data,borderColor:(0,colors._r)(s.id%15),backgroundColor:(0,colors._r)(s.id%15),borderWidth:2,tension:.1,pointRadius:0,pointHoverRadius:4,pointHoverBackgroundColor:(0,colors._r)(s.id%15),pointHoverBorderColor:(0,colors._r)(s.id%15)})),options={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"nearest",axis:"x",intersect:!1},scales:{x:{type:"time",time:{unit:interval,displayFormats:{day:"MMM DD"}},ticks:{source:"labels",color:currentAxisLabelColor},grid:{display:!1}},y:{beginAtZero:!0,grid:{color:graphColors.axisLine||"rgba(0, 0, 0, 0.1)"},ticks:{callback:function(value){return"number"==typeof value?valueFormatter(value):value},color:currentAxisLabelColor}}},plugins:{tooltip:{enabled:!1,external:_ref3=>{let{tooltip}=_ref3;if(!canvasRef.current)return;let[tooltipRoot,tooltipEl]=ensureBillingTooltip();if(0===tooltip.opacity||!tooltip.body?.length){hideBillingTooltip();return}try{let title=tooltip.title?.[0]||"",sortedSeries=(tooltip.dataPoints||[]).map(point=>{let dataset=point.datasetIndex<visibleSeries.length?visibleSeries[point.datasetIndex]:null;if(!dataset)return null;let value=point.parsed.y;return{id:dataset.id,label:dataset.label,value:value,formattedValue:valueFormatter(value),color:(0,colors._r)(dataset.id%15),datasetIndex:point.datasetIndex}}).filter(item=>null!==item).sort((a,b)=>b.value-a.value);tooltipRoot.render((0,jsx_runtime.jsx)(BillingLineGraphTooltip,{title:title,sortedSeries:sortedSeries})),tooltipEl.classList.remove("hidden"),tooltipEl.classList.add("block");let bounds=canvasRef.current.getBoundingClientRect(),tooltipWidth=tooltipEl.offsetWidth,tooltipHeight=tooltipEl.offsetHeight,scrollX=window.scrollX,scrollY=window.scrollY,tooltipX=bounds.left+scrollX+tooltip.caretX+8,tooltipY=bounds.top+scrollY+tooltip.caretY-tooltipHeight/2;tooltipX+tooltipWidth>bounds.right+scrollX&&(tooltipX=bounds.left+scrollX+tooltip.caretX-tooltipWidth-8),tooltipX=Math.max(tooltipX,bounds.left+scrollX),tooltipY=Math.max(tooltipY,bounds.top+scrollY),tooltipY=Math.min(tooltipY,bounds.bottom+scrollY-tooltipHeight),tooltipEl.style.top=`${tooltipY}px`,tooltipEl.style.left=`${tooltipX}px`}catch{hideBillingTooltip()}},mode:"index",intersect:!1},legend:{display:showLegend,position:"bottom",labels:{usePointStyle:!0,boxWidth:6}},annotation:{annotations:billingPeriodMarkers.reduce((acc,marker,idx)=>(acc[`billing-period-${idx}`]={type:"line",xMin:marker.date.utc().format("YYYY-MM-DD"),xMax:marker.date.utc().format("YYYY-MM-DD"),borderColor:isDarkModeOn?"rgba(255, 255, 255, 0.4)":"rgba(0, 0, 0, 0.4)",borderWidth:2,borderDash:[8,4]},acc),{})}}},ctx=canvasRef.current.getContext("2d");if(ctx){chartRef.current=new Chart.kL(ctx,{type:"line",data:{labels:dates,datasets},options});let chartInstance=chartRef.current;setChartDimensions({width:chartInstance.width,height:chartInstance.height}),setChartReady(!0);let currentChartAreaLeft=chartInstance.chartArea?.left;null!==stableChartAreaLeft&&1>Math.abs(currentChartAreaLeft-stableChartAreaLeft)?setMarkersReady(!0):(setStableChartAreaLeft(currentChartAreaLeft),setMarkersReady(!1),markerTimeoutRef.current&&clearTimeout(markerTimeoutRef.current),markerTimeoutRef.current=setTimeout(()=>{setMarkersReady(!0)},200))}return()=>{markerTimeoutRef.current&&clearTimeout(markerTimeoutRef.current),chartRef.current&&(chartRef.current.destroy(),chartRef.current=null,setChartReady(!1),setMarkersReady(!1),setStableChartAreaLeft(null))}},[series,dates,hiddenSeries,valueFormatter,showLegend,interval,ensureBillingTooltip,hideBillingTooltip,isDarkModeOn,billingPeriodMarkers]),(0,jsx_runtime.jsxs)("div",{className:"relative h-96",onMouseLeave:hideBillingTooltip,children:[isLoading&&(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-bg-light bg-opacity-75 z-10",children:(0,jsx_runtime.jsx)("div",{className:"text-muted",children:"Loading..."})}),(0,jsx_runtime.jsx)("canvas",{ref:canvasRef}),chartReady&&markersReady&&billingPeriodMarkers.length>0&&(0,jsx_runtime.jsx)("div",{className:"BillingMarkersOverlay",style:{"--billing-markers-chart-area-left":`${chartAreaLeft}px`,"--billing-markers-chart-area-top":`${chartAreaTop}px`,"--billing-marker-text-color":axisLabelColor,"--billing-marker-bg-color":"var(--color-bg-surface-primary)","--billing-marker-border-color":"var(--color-border-primary)"},children:billingPeriodMarkers.filter(marker=>getMarkerPosition(marker.date).visible).slice(-1).map((marker,idx)=>{let position=getMarkerPosition(marker.date);return(0,jsx_runtime.jsx)("div",{className:"BillingMarker",style:{"--billing-marker-left":`${position.left}px`},onMouseEnter:hideBillingTooltip,children:(0,jsx_runtime.jsx)(Tooltip.u,{title:(0,jsx_runtime.jsxs)("div",{className:"p-2",children:[(0,jsx_runtime.jsx)("strong",{children:"New billing period started"}),(0,jsx_runtime.jsx)("p",{className:"mt-2 text-xs",children:"Pricing tiers reset when billing periods begin, which can cause temporary usage and spend changes:"}),(0,jsx_runtime.jsxs)("ul",{className:"mt-1 text-xs list-disc list-inside",children:[(0,jsx_runtime.jsx)("li",{children:"Usage may drop to zero in last days of the billing period after billing limits are reached"}),(0,jsx_runtime.jsx)("li",{children:"Zero spend in first days due to free tier allowance"}),(0,jsx_runtime.jsx)("li",{children:"Higher daily spend in first days due to higher rates at lower volume tiers"})]})]}),placement:"bottom",children:(0,jsx_runtime.jsxs)("div",{className:"BillingMarkerLabel",children:["New billing period",(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"w-3 h-3"})]})})},`marker-${idx}`)})})]})}let BillingDataTable_defaultFormatter=value=>value.toLocaleString();function BillingDataTable(_ref){let{series,dates,isLoading,hiddenSeries,toggleSeries,toggleAllSeries,valueFormatter=BillingDataTable_defaultFormatter,totalLabel="Total"}=_ref,headerChecked=0===hiddenSeries.length||hiddenSeries.length!==series.length&&"indeterminate",dateColumns=(0,react.useMemo)(()=>dates&&0!==dates.length?dates.map((date,colIndex)=>({width:`${100/(dates.length+1)}%`,title:(0,dayjs.Bv)(date).format("MMM D"),render:(_,record)=>{let value=record.data[colIndex];return(0,jsx_runtime.jsxs)("div",{className:"text-right",children:[colIndex>=0&&colIndex<record.data.length?valueFormatter(value):valueFormatter(0)," "]})},key:`date-${colIndex}`,sorter:(a,b)=>{var _a$data$dateIndex,_b$data$dateIndex;return(null!==(_a$data$dateIndex=a.data[colIndex])&&void 0!==_a$data$dateIndex?_a$data$dateIndex:0)-(null!==(_b$data$dateIndex=b.data[colIndex])&&void 0!==_b$data$dateIndex?_b$data$dateIndex:0)},align:"right"})):[],[dates,valueFormatter]),totalColumn=(0,react.useMemo)(()=>({width:`${100/(dates.length+1)}%`,title:totalLabel,render:(_,record)=>{let total=record.data.reduce((sum,val)=>sum+val,0);return(0,jsx_runtime.jsx)("div",{className:"text-right font-semibold",children:valueFormatter(total)})},key:"total",sorter:(a,b)=>a.data.reduce((sum,val)=>sum+val,0)-b.data.reduce((sum,val)=>sum+val,0),align:"right"}),[dates.length,totalLabel,valueFormatter]),columns=(0,react.useMemo)(()=>[{title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)(src.Hw,{checked:headerChecked,onChange:toggleAllSeries,className:"mr-2"}),(0,jsx_runtime.jsx)("span",{children:"Series"})]}),render:(_,record)=>{let isHidden=hiddenSeries.includes(record.id);return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)(src.Hw,{checked:!isHidden,onChange:()=>toggleSeries(record.id),className:"mr-2"}),(0,jsx_runtime.jsx)(SeriesColorDot,{colorIndex:record.id}),(0,jsx_runtime.jsx)("span",{className:"font-medium whitespace-nowrap overflow-hidden text-ellipsis max-w-xs",children:record.label})]})},key:"series",sorter:(a,b)=>a.label.localeCompare(b.label)},totalColumn,...dateColumns],[headerChecked,totalColumn,dateColumns,toggleSeries,toggleAllSeries,hiddenSeries]);return(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto border rounded bg-bg-light",children:(0,jsx_runtime.jsx)(src.g3,{"data-attr":"billing-data-table",dataSource:series,columns:columns,loading:isLoading,embedded:!0,size:"small",rowClassName:record=>hiddenSeries.includes(record.id)?"opacity-50":"",defaultSorting:{columnKey:"total",order:-1},rowRibbonColor:record=>(0,colors._r)(record.id%15),firstColumnSticky:!0})})}var supportLogic=__webpack_require__("../../frontend/src/lib/components/Support/supportLogic.ts"),hedgehogs=__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonTag=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx");function BillingEarlyAccessBanner(){let{openSupportForm}=(0,index_esm.useActions)(supportLogic.Pw);return(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",hideIcon:!0,className:"overflow-visible",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"relative flex-shrink-0 mr-2",children:[(0,jsx_runtime.jsx)(LemonTag.o,{type:"completion",className:"absolute top-2.5 left-0 transform -rotate-12",children:"EARLY ACCESS"}),(0,jsx_runtime.jsx)(hedgehogs.BuilderHog3,{className:"w-20 h-20 mt-6"})]}),(0,jsx_runtime.jsxs)("div",{className:"text-primary",children:[(0,jsx_runtime.jsxs)("p",{children:["We're still tinkering with these dashboards - got questions, ideas or bugs?"," ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>openSupportForm({kind:"support",target_area:"billing",isEmailFormOpen:!0}),children:"Send them our way"}),"!"]}),(0,jsx_runtime.jsxs)("ul",{className:"list-disc list-inside pl-2",children:[(0,jsx_runtime.jsx)("li",{children:"Usage data updates daily (UTC) - so today's numbers show up tomorrow"}),(0,jsx_runtime.jsx)("li",{children:"Historical spend and billing periods are based on the current subscription plan"}),(0,jsx_runtime.jsxs)("li",{children:["To further breakdown product usage, check out this"," ",(0,jsx_runtime.jsx)(src.rU,{to:`/dashboard?templateFilter=${encodeURIComponent("billable usage")}#newDashboard=modal`,children:"dashboard template"})]})]})]})]})})}function BillingEmptyState(_ref){let{heading="No data available",detail="Please try adjusting your query or filters."}=_ref;return(0,jsx_runtime.jsxs)("div",{"data-attr":"billing-empty-state",className:"flex flex-col bg-white rounded px-4 py-8 items-center text-center mx-auto",children:[(0,jsx_runtime.jsx)(hedgehogs.WarningHog,{width:"100",height:"100",className:"mb-4"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl leading-tight",children:heading}),"string"==typeof detail?(0,jsx_runtime.jsx)("p",{className:"text-sm text-balance text-tertiary",children:detail}):(0,jsx_runtime.jsx)("div",{className:"text-sm text-balance text-tertiary",children:detail})]})}var BillingNoAccess=__webpack_require__("../../frontend/src/scenes/billing/BillingNoAccess.tsx"),billing_utils=__webpack_require__("../../frontend/src/scenes/billing/billing-utils.ts"),billingSpendLogic=__webpack_require__("../../frontend/src/scenes/billing/billingSpendLogic.ts"),billing_constants=__webpack_require__("../../frontend/src/scenes/billing/constants.ts");function BillingSpendView(){let restrictionReason=(0,RestrictedArea.U)({minimumAccessLevel:constants.Dk.Admin,scope:RestrictedArea.C.Organization}),logic=(0,billingSpendLogic.Q8)({syncWithUrl:!0}),{series,dates,filters,dateFrom,dateTo,billingSpendResponseLoading,dateOptions,excludeEmptySeries,finalHiddenSeries,heading,headingTooltip,showSeries,showEmptyState,teamOptions,billingPeriodMarkers}=(0,index_esm.useValues)(logic),{startExport}=(0,index_esm.useActions)(exportsLogic.exportsLogic),{setFilters,setDateRange,toggleSeries,toggleAllSeries,setExcludeEmptySeries,toggleBreakdown,resetFilters}=(0,index_esm.useActions)(logic);return restrictionReason?(0,jsx_runtime.jsx)(BillingNoAccess.J,{title:"Spend",reason:restrictionReason}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(BillingEarlyAccessBanner,{}),(0,jsx_runtime.jsxs)("div",{className:"border rounded p-4 bg-bg-light space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 items-start flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Products"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",className:"w-50 h-10",value:filters.usage_types||[],onChange:value=>setFilters({usage_types:value}),placeholder:"All products",options:billing_constants.c.map(opt=>({key:opt.value,label:opt.label})),allowCustomValues:!1})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Projects"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",className:"w-50 h-10",value:(filters.team_ids||[]).map(String),onChange:value=>setFilters({team_ids:value.map(Number).filter(n=>!isNaN(n))}),placeholder:"All projects",options:teamOptions,loading:billingSpendResponseLoading,allowCustomValues:!1})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Break down by"}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center min-h-10",children:[(0,jsx_runtime.jsx)(src.Hw,{label:"Product",checked:filters.breakdowns?.includes("type"),onChange:()=>toggleBreakdown("type")}),(0,jsx_runtime.jsx)(src.Hw,{label:"Project",checked:filters.breakdowns?.includes("team"),onChange:()=>toggleBreakdown("team")})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Date range (UTC)"}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-light rounded-md",children:(0,jsx_runtime.jsx)(DateFilter.f,{className:"h-8 flex items-center",dateFrom:dateFrom,dateTo:dateTo,onChange:(fromDate,toDate)=>setDateRange(fromDate,toDate),dateOptions:dateOptions})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Group by"}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-light rounded-md",children:(0,jsx_runtime.jsx)(src.Yv,{className:"h-10.5 flex items-center",size:"small",value:filters.interval||"day",onChange:value=>setFilters({interval:value}),options:[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}]})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Options"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center min-h-10",children:(0,jsx_runtime.jsx)(src.Hw,{label:"Hide results with no spend",checked:excludeEmptySeries,onChange:value=>setExcludeEmptySeries(value)})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:" "}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"medium",onClick:resetFilters,children:"Clear filters"}),showSeries&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"medium",onClick:()=>{let csv=(0,billing_utils.R3)({series,dates,hiddenSeries:finalHiddenSeries,options:{decimals:2}}),filename=`posthog_spend_${dateFrom}_${dateTo}_${filters.interval||"day"}.csv`;startExport({export_format:types.P5.CSV,export_context:{localData:csv,filename}})},children:"Export CSV"})]})]})]}),showSeries&&(0,jsx_runtime.jsx)(BillingLineGraph_BillingLineGraph,{series:series,dates:dates,isLoading:billingSpendResponseLoading,hiddenSeries:finalHiddenSeries,valueFormatter:billing_utils.oB,showLegend:!1,interval:filters.interval,billingPeriodMarkers:billingPeriodMarkers}),showEmptyState&&(0,jsx_runtime.jsx)(BillingEmptyState,{heading:"We couldn't find any usage data for your current query.",detail:"Try adjusting the filters. If you think something is wrong, contact us!"})]}),showSeries&&(0,jsx_runtime.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold mb-0",children:heading}),headingTooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:headingTooltip,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg text-secondary shrink-0"})})]}),(0,jsx_runtime.jsx)(BillingDataTable,{series:series,dates:dates,isLoading:billingSpendResponseLoading,hiddenSeries:finalHiddenSeries,toggleSeries:toggleSeries,toggleAllSeries:toggleAllSeries,valueFormatter:billing_utils.oB,totalLabel:"Total Spend"})]})]})}var billingUsageLogic=__webpack_require__("../../frontend/src/scenes/billing/billingUsageLogic.ts");function BillingUsage_BillingUsage(){let restrictionReason=(0,RestrictedArea.U)({minimumAccessLevel:constants.Dk.Admin,scope:RestrictedArea.C.Organization}),logic=(0,billingUsageLogic.zu)({syncWithUrl:!0}),{series,dates,filters,dateFrom,dateTo,billingUsageResponseLoading,dateOptions,excludeEmptySeries,finalHiddenSeries,heading,headingTooltip,showSeries,showEmptyState,teamOptions,billingPeriodMarkers}=(0,index_esm.useValues)(logic),{startExport}=(0,index_esm.useActions)(exportsLogic.exportsLogic),{setFilters,setDateRange,toggleSeries,toggleAllSeries,setExcludeEmptySeries,toggleTeamBreakdown,resetFilters}=(0,index_esm.useActions)(logic);return restrictionReason?(0,jsx_runtime.jsx)(BillingNoAccess.J,{title:"Usage",reason:restrictionReason}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(BillingEarlyAccessBanner,{}),(0,jsx_runtime.jsxs)("div",{className:"border rounded p-4 bg-bg-light space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 items-start flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Products"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",className:"w-50 h-10",value:filters.usage_types||[],onChange:value=>setFilters({usage_types:value}),placeholder:"All products",options:billing_constants.c.map(opt=>({key:opt.value,label:opt.label})),allowCustomValues:!1})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Projects"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",displayMode:"count",bulkActions:"select-and-clear-all",className:"w-50 h-10",value:(filters.team_ids||[]).map(String),onChange:value=>setFilters({team_ids:value.map(Number).filter(n=>!isNaN(n))}),placeholder:"All projects",options:teamOptions,loading:billingUsageResponseLoading,allowCustomValues:!1})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Break down by"}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center min-h-10",children:[(0,jsx_runtime.jsx)("span",{className:"opacity-70",children:(0,jsx_runtime.jsx)(src.Hw,{label:"Product",checked:!0,disabledReason:"Breakdown by Product is required for usage volume, as summing different units (e.g., events + recordings) doesn't produce a meaningful total."})}),(0,jsx_runtime.jsx)(src.Hw,{label:"Project",checked:(filters.breakdowns||[]).includes("team"),onChange:toggleTeamBreakdown})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Date range (UTC)"}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-light rounded-md",children:(0,jsx_runtime.jsx)(DateFilter.f,{className:"h-8 flex items-center",dateFrom:dateFrom,dateTo:dateTo,onChange:(fromDate,toDate)=>setDateRange(fromDate,toDate),dateOptions:dateOptions})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Group by"}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-light rounded-md",children:(0,jsx_runtime.jsx)(src.Yv,{className:"h-10.5 flex items-center",size:"small",value:filters.interval||"day",onChange:value=>setFilters({interval:value}),options:[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}]})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Options"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center min-h-10",children:(0,jsx_runtime.jsx)(src.Hw,{label:"Hide results with no usage",checked:excludeEmptySeries,onChange:value=>setExcludeEmptySeries(value)})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:" "}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"medium",onClick:resetFilters,children:"Clear filters"}),showSeries&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"medium",onClick:()=>{let csv=(0,billing_utils.R3)({series,dates,hiddenSeries:finalHiddenSeries}),filename=`posthog_usage_${dateFrom}_${dateTo}_${filters.interval||"day"}.csv`;startExport({export_format:types.P5.CSV,export_context:{localData:csv,filename}})},children:"Export CSV"})]})]})]}),showSeries&&(0,jsx_runtime.jsx)(BillingLineGraph_BillingLineGraph,{series:series,dates:dates,isLoading:billingUsageResponseLoading,hiddenSeries:finalHiddenSeries,showLegend:!1,interval:filters.interval,billingPeriodMarkers:billingPeriodMarkers}),showEmptyState&&(0,jsx_runtime.jsx)(BillingEmptyState,{heading:"We couldn't find any usage data for your current query.",detail:"Try adjusting the filters. If you think something is wrong, contact us!"})]}),showSeries?(0,jsx_runtime.jsxs)("div",{className:"mt-4 flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold mb-0",children:heading}),headingTooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:headingTooltip,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg text-secondary shrink-0"})})]}),(0,jsx_runtime.jsx)(BillingDataTable,{series:series,dates:dates,isLoading:billingUsageResponseLoading,hiddenSeries:finalHiddenSeries,toggleSeries:toggleSeries,toggleAllSeries:toggleAllSeries})]}):null]})}let scene={component:BillingSection,logic:__webpack_require__("../../frontend/src/scenes/billing/billingLogic.tsx").billingLogic},tabs=[{key:"overview",label:"Overview"},{key:"usage",label:"Usage"},{key:"spend",label:"Spend"}];function BillingSection(){let{location,searchParams}=(0,index_esm.useValues)(lib.router),section=location.pathname.includes("spend")?"spend":location.pathname.includes("usage")?"usage":"overview";return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[(0,jsx_runtime.jsx)(src.TP,{activeKey:section,onChange:key=>{let newUrl=urls.j.organizationBillingSection(key),targetHasParams="usage"===key||"spend"===key;if(!(("usage"===section||"spend"===section)&&targetHasParams)){lib.router.actions.push(newUrl);return}let paramsToPreserve={...searchParams};if("spend"===section&&"usage"===key&&paramsToPreserve.breakdowns){let currentBreakdowns=Array.isArray(paramsToPreserve.breakdowns)?paramsToPreserve.breakdowns:[];currentBreakdowns.includes("type")||(paramsToPreserve.breakdowns=["type",...currentBreakdowns])}lib.router.actions.push(newUrl,paramsToPreserve)},tabs:tabs}),"overview"===section&&(0,jsx_runtime.jsx)(billing_Billing.Billing,{}),"usage"===section&&(0,jsx_runtime.jsx)(BillingUsage_BillingUsage,{}),"spend"===section&&(0,jsx_runtime.jsx)(BillingSpendView,{})]})}},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/billing/BillingLineGraph.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".BillingMarkersOverlay{left:var(--billing-markers-chart-area-left);pointer-events:none;position:absolute;top:var(--billing-markers-chart-area-top)}.BillingMarker{cursor:default;left:var(--billing-marker-left);pointer-events:auto;position:absolute;top:-20px;transform:translateX(-50%)}.BillingMarker .BillingMarkerLabel{align-items:center;background-color:var(--billing-marker-bg-color);border:1px solid var(--billing-marker-border-color);border-radius:4px;color:var(--billing-marker-text-color);display:flex;font-size:12px;font-weight:400;gap:4px;padding:4px 8px;white-space:nowrap}.BillingMarker .BillingMarkerLabel .anticon{height:12px;width:12px}",""]),module.exports=exports},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/billing/BillingUsage.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".series-color-dot{border-radius:9999px;display:inline-block;height:.75rem;margin-right:.5rem;width:.75rem}.series-color-dot-0{background-color:var(--data-color-1)}.series-color-dot-1{background-color:var(--data-color-2)}.series-color-dot-2{background-color:var(--data-color-3)}.series-color-dot-3{background-color:var(--data-color-4)}.series-color-dot-4{background-color:var(--data-color-5)}.series-color-dot-5{background-color:var(--data-color-6)}.series-color-dot-6{background-color:var(--data-color-7)}.series-color-dot-7{background-color:var(--data-color-8)}.series-color-dot-8{background-color:var(--data-color-9)}.series-color-dot-9{background-color:var(--data-color-10)}.series-color-dot-10{background-color:var(--data-color-11)}.series-color-dot-11{background-color:var(--data-color-12)}.series-color-dot-12{background-color:var(--data-color-13)}.series-color-dot-13{background-color:var(--data-color-14)}.series-color-dot-14{background-color:var(--data-color-15)}",""]),module.exports=exports}}]);