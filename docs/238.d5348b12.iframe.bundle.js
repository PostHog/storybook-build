(window.webpackJsonp=window.webpackJsonp||[]).push([[238],{"./frontend/src/lib/components/RestrictedArea.tsx":function(fe,V,t){"use strict";t.d(V,"b",function(){return C}),t.d(V,"a",function(){return X});var w=t("./node_modules/core-js/modules/es.array.concat.js"),N=t.n(w),k=t("./node_modules/kea/lib/index.esm.js"),j=t("./node_modules/react/index.js"),e=t.n(j),H=t("./frontend/src/scenes/organizationLogic.tsx"),ve=t("./frontend/src/lib/constants.tsx"),ge=t("./frontend/src/lib/components/Tooltip.tsx"),se=t("./frontend/src/lib/utils/permissioning.ts"),pe=t("./frontend/src/scenes/teamLogic.tsx"),C;(function(f){f.Organization="organization",f.Project="project"})(C||(C={}));function X(f){var P=f.Component,K=f.minimumAccessLevel,_=f.scope,F=_===void 0?C.Organization:_,q=Object(k.useValues)(H.a),U=q.currentOrganization,ee=Object(k.useValues)(pe.a),O=ee.currentTeam,b=Object(j.useMemo)(function(){var I;if(F===C.Project){if(!O)return"Loading current project\u2026";I=O.effective_membership_level}else{if(!U)return"Loading current organization\u2026";I=U.membership_level}return I===null?"You don't have access to the current ".concat(F,"."):I<K?K===ve.n.Owner?"This area is restricted to the ".concat(F," owner."):"This area is restricted to ".concat(F," ").concat(se.b.get(K),"s and up. Your level is ").concat(se.b.get(I),"."):null},[U]);return b?e.a.createElement(ge.a,{title:b,placement:"topLeft",delayMs:0},e.a.createElement("span",null,e.a.createElement(P,{isRestricted:!0,restrictionReason:b}))):e.a.createElement(P,{isRestricted:!1,restrictionReason:null})}try{X.displayName="RestrictedArea",X.__docgenInfo={description:"",displayName:"RestrictedArea",props:{Component:{defaultValue:null,description:"",name:"Component",required:!0,type:{name:"(props: RestrictedComponentProps) => Element"}},minimumAccessLevel:{defaultValue:null,description:"",name:"minimumAccessLevel",required:!0,type:{name:"enum",value:[{value:"1"},{value:"8"},{value:"15"},{value:"1"},{value:"8"}]}},scope:{defaultValue:{value:"RestrictionScope.Organization"},description:"",name:"scope",required:!1,type:{name:"enum",value:[{value:'"organization"'},{value:'"project"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"]={docgenInfo:X.__docgenInfo,name:"RestrictedArea",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"})}catch(f){}try{C.Organization.displayName="RestrictionScope.Organization",C.Organization.__docgenInfo={description:"Current organization-wide membership level will be used.",displayName:"RestrictionScope.Organization",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"]={docgenInfo:C.Organization.__docgenInfo,name:"RestrictionScope.Organization",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"})}catch(f){}try{C.Project.displayName="RestrictionScope.Project",C.Project.__docgenInfo={description:"Effective level for the current project will be used.",displayName:"RestrictionScope.Project",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"]={docgenInfo:C.Project.__docgenInfo,name:"RestrictionScope.Project",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"})}catch(f){}},"./frontend/src/lib/hooks/useAnchor.ts":function(fe,V,t){"use strict";t.d(V,"a",function(){return k});var w=t("./node_modules/react/index.js"),N=t.n(w);function k(j){Object(w.useEffect)(function(){if(j&&document.getElementById(j.substr(1))){var e=document.getElementById(j.substr(1));if(!e)return;e.classList.add("highlighted");var H=e.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:H-50-32,behavior:"smooth"})}},[j])}},"./frontend/src/scenes/organization/Settings/index.tsx":function(fe,V,t){"use strict";t.r(V),t.d(V,"scene",function(){return Xe}),t.d(V,"OrganizationSettings",function(){return je});var w=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),N=t.n(w),k=t("./node_modules/core-js/modules/es.function.name.js"),j=t("./node_modules/react/index.js"),e=t.n(j),H=t("./frontend/src/lib/components/PageHeader.tsx"),ve=t("./node_modules/core-js/modules/es.array.iterator.js"),ge=t("./node_modules/core-js/modules/es.object.to-string.js"),se=t("./node_modules/core-js/modules/es.string.iterator.js"),pe=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),C=t("./node_modules/core-js/modules/web.url.js"),X=t("./node_modules/core-js/modules/web.url-search-params.js"),f=t("./node_modules/kea/lib/index.esm.js"),P=t("./frontend/src/lib/components/CopyToClipboard.tsx"),K=t("./frontend/src/lib/components/ProfilePicture/index.ts"),_=t("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),F=t("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),q=t("./frontend/src/lib/components/LemonTable/index.ts"),U=t("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),ee=t("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),O=t("./frontend/src/lib/components/LemonButton/index.ts"),b=t("./frontend/src/lib/components/icons.tsx"),I=t("./frontend/src/lib/components/LemonDialog/index.ts");function Le(a,n){var o=new URL("/signup/".concat(a),document.baseURI).href;return n.is_expired?e.a.createElement("b",null,"Expired! Delete and recreate"):e.a.createElement(P.a,{"data-attr":"invite-link",description:"invite link"},o)}function De(a){return function(o,r){return e.a.createElement(O.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:e.a.createElement(b.IconClose,null),status:"danger",onClick:function(){r.is_expired?a(r):I.a.open({title:"Do you want to cancel the invite for ".concat(r.target_email,"?"),primaryButton:{children:"Yes, cancel invite",status:"danger",onClick:function(){return a(r)}},secondaryButton:{children:"No, keep invite"}})}})}}function Me(){var a=Object(f.useValues)(_.a),n=a.invites,o=a.invitesLoading,r=Object(f.useActions)(_.a),i=r.deleteInvite,l=r.showInviteModal,s=Object(f.useValues)(ee.a),c=s.preflight,v=[{key:"user_profile_picture",render:function(d,m){return e.a.createElement(K.b,{name:m.first_name,email:m.target_email})},width:32},{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(d,m){return m.target_email?e.a.createElement("div",{className:"flex items-center"},m.target_email,m.first_name?" (".concat(m.first_name,")"):""):e.a.createElement("i",null,"no one")},width:"20%"},Object(U.b)(),Object(U.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(d,m){return Le(m.id,m)}},{title:"",key:"actions",width:24,render:De(i)}];return e.a.createElement("div",null,e.a.createElement("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"}},"Pending Invites",e.a.createElement(O.a,{type:"primary",onClick:l,"data-attr":"invite-teammate-button"},"Invite team member")),!(c!=null&&c.email_service_available)&&e.a.createElement(F.a,null),e.a.createElement(q.a,{dataSource:n,columns:v,rowKey:"id",loading:o,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."}))}var nn=t("./node_modules/core-js/modules/es.array.filter.js"),tn=t("./node_modules/core-js/modules/es.array.map.js"),an=t("./node_modules/core-js/modules/es.array.concat.js"),rn=t("./node_modules/core-js/modules/es.regexp.exec.js"),on=t("./node_modules/core-js/modules/es.string.search.js"),le=t("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),S=t("./frontend/src/lib/constants.tsx"),R=t("./frontend/src/scenes/organizationLogic.tsx"),Ee=t("./frontend/src/scenes/userLogic.ts"),W=t("./frontend/src/lib/utils/permissioning.ts"),xe=t("./frontend/src/lib/components/TimezoneAware/index.tsx"),ye=t("./frontend/src/lib/components/LemonButton/More.tsx"),ce=t("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Ie=t("./frontend/src/lib/components/LemonDivider/index.ts"),A=t("./frontend/@posthog/lemon-ui/src/index.ts");function Re(a,n){var o,r=Object(f.useValues)(Ee.a),i=r.user,l=Object(f.useValues)(R.a),s=l.currentOrganization,c=Object(f.useActions)(le.a),v=c.removeMember,u=c.changeMemberAccessLevel;if(!i)return null;var d=(o=s==null?void 0:s.membership_level)!==null&&o!==void 0?o:-1,m=(d>=S.n.Admin&&n.level<=d||n.user.uuid===i.uuid)&&n.level!==S.n.Owner,h=s?s.membership_level:null,g=W.c.filter(function(E){return!Object(W.a)(h,i,n,E)}),z=Object(W.a)(h,i,n,g);return e.a.createElement(ye.a,{overlay:e.a.createElement(e.a.Fragment,null,z?e.a.createElement("div",null,z):g.map(function(E){return e.a.createElement(O.a,{status:"stealth",fullWidth:!0,key:"".concat(n.user.uuid,"-level-").concat(E),onClick:function(p){if(p.preventDefault(),!i)throw Error;if(E===S.n.Owner){var y;I.a.open({title:"Transfer organization ownership to ".concat(n.user.first_name,"?"),description:"You will no longer be the owner of ".concat((y=i.organization)===null||y===void 0?void 0:y.name,". After the transfer you will become an administrator."),primaryButton:{status:"danger",children:"Transfer Ownership",onClick:function(){return u(n,E)}},secondaryButton:{children:"Cancel"}})}else u(n,E)},"data-test-level":E},E===S.n.Owner?e.a.createElement(e.a.Fragment,null,"Transfer organization ownership"):E>n.level?e.a.createElement(e.a.Fragment,null,"Upgrade to ",W.b.get(E)):e.a.createElement(e.a.Fragment,null,"Downgrade to ",W.b.get(E)))}),m?e.a.createElement(e.a.Fragment,null,e.a.createElement(Ie.a,null),e.a.createElement(O.a,{status:"danger","data-attr":"delete-org-membership",onClick:function(){var D;if(!i)throw Error;I.a.open({title:"".concat(n.user.uuid==i.uuid?"Leave":"Remove ".concat(n.user.first_name," from")," organization ").concat((D=i.organization)===null||D===void 0?void 0:D.name,"?"),primaryButton:{children:n.user.uuid==i.uuid?"Leave":"Remove",status:"danger",onClick:function(){return v(n)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0},n.user.uuid!==i.uuid?"Remove from organization":"Leave organization")):null)})}function ne(a){var n=a.user,o=Object(f.useValues)(le.a),r=o.filteredMembers,i=o.membersLoading,l=o.search,s=Object(f.useActions)(le.a),c=s.setSearch,v=[{key:"user_profile_picture",render:function(d,m){return e.a.createElement(K.b,{name:m.user.first_name,email:m.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(d,m){return m.user.uuid==n.uuid?"".concat(m.user.first_name," (me)"):m.user.first_name},sorter:function(d,m){return d.user.first_name.localeCompare(m.user.first_name)}},{title:"Email",key:"user_email",render:function(d,m){return m.user.email},sorter:function(d,m){return d.user.email.localeCompare(m.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(d,m){var h;return e.a.createElement(ce.a,{"data-attr":"membership-level"},m.level===S.n.Owner?"Organization owner":"Project ".concat((h=W.b.get(m.level))!==null&&h!==void 0?h:"unknown (".concat(m.level,")")))},sorter:function(d,m){return d.level-m.level}},{title:"Joined",dataIndex:"joined_at",key:"joined_at",render:function(d){return e.a.createElement("div",{className:"whitespace-nowrap"},e.a.createElement(xe.b,{time:d}))},sorter:function(d,m){return d.joined_at.localeCompare(m.joined_at)}},{key:"actions",width:0,render:Re}];return e.a.createElement(e.a.Fragment,null,e.a.createElement("h2",{className:"subtitle"},"Members"),e.a.createElement(A.LemonInput,{type:"search",placeholder:"Search for members",value:l,onChange:c}),e.a.createElement(q.a,{dataSource:r,columns:v,rowKey:"id",style:{marginTop:"1rem"},loading:i,"data-attr":"org-members-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}}))}try{ne.displayName="Members",ne.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:ne.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(a){}function te(a){var n=a.isOpen,o=a.setIsOpen,r=Object(f.useValues)(R.a),i=r.currentOrganization,l=r.organizationBeingDeleted,s=Object(f.useActions)(R.a),c=s.deleteOrganization,v=Object(j.useState)(!1),u=N()(v,2),d=u[0],m=u[1],h=!!i&&(l==null?void 0:l.id)===i.id;return e.a.createElement(A.LemonModal,{title:"Delete the entire organization?",onClose:function(){return o(!1)},footer:e.a.createElement(e.a.Fragment,null,e.a.createElement(A.LemonButton,{disabled:h,type:"secondary",onClick:function(){return o(!1)}},"Cancel"),e.a.createElement(A.LemonButton,{type:"primary",disabled:!d,loading:h,"data-attr":"delete-organization-ok",status:"danger",onClick:i?function(){return c(i)}:void 0},"Delete ".concat(i?i.name:"the current organization"))),isOpen:n},e.a.createElement("p",null,"Organization deletion ",e.a.createElement("b",null,"cannot be undone"),". You will lose all data, ",e.a.createElement("b",null,"including all events"),", related to all projects within this organization."),e.a.createElement("p",null,"Please type"," ",e.a.createElement("strong",null,i?i.name:"this organization's name")," to confirm."),e.a.createElement(A.LemonInput,{type:"text",onChange:function(z){i&&m(z.toLowerCase()===i.name.toLowerCase())}}))}function ae(a){var n=a.isRestricted,o=Object(f.useValues)(R.a),r=o.currentOrganization,i=Object(j.useState)(!1),l=N()(i,2),s=l[0],c=l[1];return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"text-danger"},e.a.createElement("h2",{className:"text-danger subtitle"},"Danger Zone"),e.a.createElement("div",{className:"mt-4"},!n&&e.a.createElement("p",{className:"text-danger"},"This is ",e.a.createElement("b",null,"irreversible"),". Please be certain."),e.a.createElement(A.LemonButton,{status:"danger",type:"secondary",onClick:function(){return c(!0)},"data-attr":"delete-organization-button",icon:e.a.createElement(b.IconDelete,null),disabled:n},"Delete ",(r==null?void 0:r.name)||"the current organization"))),e.a.createElement(te,{isOpen:s,setIsOpen:c}))}try{te.displayName="DeleteOrganizationModal",te.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},setIsOpen:{defaultValue:null,description:"",name:"setIsOpen",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:te.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(a){}try{ae.displayName="DangerZone",ae.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:ae.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(a){}var re=t("./frontend/src/lib/components/RestrictedArea.tsx"),ze=t("./frontend/src/lib/hooks/useAnchor.ts"),Ve=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ie=t.n(Ve),de=t("./frontend/src/lib/components/Tooltip.tsx"),sn=t("./node_modules/core-js/modules/es.object.keys.js"),ln=t("./node_modules/core-js/modules/es.symbol.js"),cn=t("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),dn=t("./node_modules/core-js/modules/web.dom-collections.for-each.js"),un=t("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Te=t("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),Ne=t.n(Te),Pe=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),Be=t.n(Pe),we=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),Y=t.n(we),Ke=t("./node_modules/@babel/runtime/regenerator/index.js"),L=t.n(Ke),mn=t("./node_modules/core-js/modules/es.array.sort.js"),fn=t("./node_modules/core-js/modules/es.array.find.js"),vn=t("./node_modules/core-js/modules/es.array.includes.js"),gn=t("./node_modules/core-js/modules/es.string.includes.js"),pn=t("./node_modules/core-js/modules/es.string.match.js"),$=t("./frontend/src/lib/api.ts"),oe=t("./frontend/src/lib/components/lemonToast.tsx"),he=t("./frontend/src/types.ts"),Oe=t("./node_modules/kea-forms/lib/index.js"),Fe=t("./node_modules/kea-loaders/lib/index.js"),Ue=["id"];function be(a,n){var o=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);n&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),o.push.apply(o,r)}return o}function ue(a){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?be(Object(o),!0).forEach(function(r){Be()(a,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):be(Object(o)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(o,r))})}return a}var x=Object(f.kea)([Object(f.path)(["scenes","organization","verifiedDomainsLogic"]),Object(f.connect)({values:[R.a,["currentOrganization"]]}),Object(f.actions)({replaceDomain:function(n){return{domain:n}},setAddModalShown:function(n){return{shown:n}},setConfigureSAMLModalId:function(n){return{id:n}},setVerifyModal:function(n){return{id:n}}}),Object(f.reducers)({verifiedDomains:[[],{replaceDomain:function(n,o){var r=o.domain,i=[].concat(ie()(n.filter(function(l){var s=l.id;return s!==r.id})),[r]);return i.sort(function(l,s){return l.domain.localeCompare(s.domain)}),i}}],addModalShown:[!1,{setAddModalShown:function(n,o){var r=o.shown;return r},addVerifiedDomainSuccess:function(){return!1}}],configureSAMLModalId:[null,{setConfigureSAMLModalId:function(n,o){var r=o.id;return r}}],verifyModal:[null,{setVerifyModal:function(n,o){var r=o.id;return r}}]}),Object(Fe.loaders)(function(a){var n=a.values,o=a.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var r=Y()(L.a.mark(function l(){var s;return L.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,$.b.get("api/organizations/".concat((s=n.currentOrganization)===null||s===void 0?void 0:s.id,"/domains"));case 2:return v.abrupt("return",v.sent.results);case 3:case"end":return v.stop()}},l)}));function i(){return r.apply(this,arguments)}return i}(),addVerifiedDomain:function(){var r=Y()(L.a.mark(function l(s){var c,v;return L.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,$.b.create("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains"),{domain:s});case 2:return v=d.sent,d.abrupt("return",[v].concat(ie()(n.verifiedDomains)));case 4:case"end":return d.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}(),deleteVerifiedDomain:function(){var r=Y()(L.a.mark(function l(s){var c;return L.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,$.b.delete("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s));case 2:return u.abrupt("return",ie()(n.verifiedDomains.filter(function(d){return d.id!==s})));case 3:case"end":return u.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}()}],updatingDomain:[!1,{updateDomain:function(){var r=Y()(L.a.mark(function l(s){var c,v;return L.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,$.b.update("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s.id),ue(ue({},s),{},{id:void 0}));case 2:return v=d.sent,oe.d.success("Domain updated successfully! Changes will take immediately."),o.replaceDomain(v),d.abrupt("return",!1);case 6:case"end":return d.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}(),verifyDomain:function(){var r=Y()(L.a.mark(function l(){var s,c;return L.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,$.b.create("api/organizations/".concat((s=n.currentOrganization)===null||s===void 0?void 0:s.id,"/domains/").concat(n.verifyModal,"/verify"));case 2:return c=u.sent,c.is_verified?oe.d.success("Domain verified successfully."):oe.d.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),o.replaceDomain(c),o.setVerifyModal(null),u.abrupt("return",!1);case 7:case"end":return u.stop()}},l)}));function i(){return r.apply(this,arguments)}return i}()}]}}),Object(f.listeners)(function(a){var n=a.actions,o=a.values;return{setConfigureSAMLModalId:function(i){var l=i.id,s=o.verifiedDomains.find(function(d){var m=d.id;return m===l});if(l&&s){var c=s.saml_acs_url,v=s.saml_entity_id,u=s.saml_x509_cert;n.setSamlConfigValues({saml_acs_url:c,saml_entity_id:v,saml_x509_cert:u,id:l})}}}}),Object(f.selectors)({domainBeingVerified:[function(a){return[a.verifiedDomains,a.verifyModal]},function(a,n){return n&&a.find(function(o){var r=o.id;return r===n})||null}],isSSOEnforcementAvailable:[function(a){return[a.currentOrganization]},function(a){var n;return(n=a==null?void 0:a.available_features.includes(he.d.SSO_ENFORCEMENT))!==null&&n!==void 0?n:!1}],isSAMLAvailable:[function(a){return[a.currentOrganization]},function(a){var n;return(n=a==null?void 0:a.available_features.includes(he.d.SAML))!==null&&n!==void 0?n:!1}]}),Object(f.afterMount)(function(a){var n=a.actions;return n.loadVerifiedDomains()}),Object(Oe.forms)(function(a){var n=a.actions,o=a.values;return{samlConfig:{defaults:{},errors:function(i){return{saml_acs_url:i.saml_acs_url&&!i.saml_acs_url.match(S.v)?"Please enter a valid URL, including https://":void 0}},submit:function(){var r=Y()(L.a.mark(function l(s,c){var v,u,d,m;return L.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(u=s.id,d=Ne()(s,Ue),u){g.next=3;break}return g.abrupt("return");case 3:return g.next=5,$.b.update("api/organizations/".concat((v=o.currentOrganization)===null||v===void 0?void 0:v.id,"/domains/").concat(s.id),ue({},d));case 5:m=g.sent,c(),n.replaceDomain(m),n.setConfigureSAMLModalId(null),n.setSamlConfigValues({}),oe.d.success("SAML configuration for ".concat(m.domain," updated successfully."));case 11:case"end":return g.stop()}},l)}));function i(l,s){return r.apply(this,arguments)}return i}()}}})]),me=t("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),Z=t("./frontend/src/lib/components/LemonModal/index.ts");function We(){var a=Object(f.useValues)(x),n=a.addModalShown,o=a.verifiedDomainsLoading,r=Object(f.useActions)(x),i=r.setAddModalShown,l=r.addVerifiedDomain,s=Object(j.useState)(""),c=N()(s,2),v=c[0],u=c[1],d=Object(j.useState)(!1),m=N()(d,2),h=m[0],g=m[1],z=!v||!v.match(S.c),E=function(){u(""),g(!1)},D=function(){i(!1),E()},p=function(){g(!0),z||(l(v),E())};return e.a.createElement(Z.a,{onClose:D,isOpen:n,title:"Add authentication domain",footer:e.a.createElement(O.a,{type:"primary",disabled:v===""||h&&z||o,onClick:p},"Add domain")},e.a.createElement(A.LemonInput,{placeholder:"posthog.com",autoFocus:!0,value:v,onChange:u,onPressEnter:p}),h&&z&&e.a.createElement("span",{className:"text-danger text-xs"},"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"))}var Ye=t("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx"),G=t("./frontend/src/lib/forms/Field.tsx");function $e(){var a=Object(f.useValues)(x),n=a.domainBeingVerified,o=a.updatingDomainLoading,r=Object(f.useActions)(x),i=r.setVerifyModal,l=r.verifyDomain,s="_posthog-challenge.".concat(n==null?void 0:n.domain,".");return e.a.createElement(Z.a,{isOpen:!!n,onClose:function(){return i(null)},title:"Verify your domain",description:e.a.createElement(e.a.Fragment,null,e.a.createElement(ce.a,null,(n==null?void 0:n.domain)||""),e.a.createElement("p",null,"To verify your domain, you need to add a record to your DNS zone.")),footer:e.a.createElement(e.a.Fragment,null,e.a.createElement(O.a,{type:"secondary",onClick:function(){return i(null)}},"Verify later"),e.a.createElement(O.a,{type:"primary",disabled:o,onClick:l},"Verify"))},e.a.createElement("div",null,e.a.createElement("ol",null,e.a.createElement("li",null,"Sign in to your DNS provider."),e.a.createElement("li",null,"Add the following ",e.a.createElement("b",null,"TXT")," record.",e.a.createElement("div",{className:"my-4 space-y-2"},e.a.createElement(G.b,{label:"Name"},e.a.createElement("div",{className:"flex items-center gap-2"},e.a.createElement("div",{className:"border rounded p-2 h-10 flex-1"},s),e.a.createElement(P.a,{explicitValue:s}))),e.a.createElement(G.b,{label:"Value or content"},e.a.createElement("div",{className:"flex items-center gap-2"},e.a.createElement("div",{className:"border rounded p-2 h-10 flex-1"},n==null?void 0:n.verification_challenge),e.a.createElement(P.a,{explicitValue:n==null?void 0:n.verification_challenge}))),e.a.createElement(G.b,{label:"TTL"},e.a.createElement("div",{className:"flex items-center gap-2"},e.a.createElement("div",{className:"border rounded p-2 h-10 flex-1"},"Default or 3600"),e.a.createElement(P.a,{explicitValue:"3600"}))))),e.a.createElement("li",null,"Press verify below."))))}var Se=t("./frontend/src/lib/components/Link.tsx"),Ze=t("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),Ge=t("./frontend/src/lib/components/AlertMessage/index.ts"),Ae=t("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),Je=t("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx");function Qe(){var a=Object(f.useValues)(x),n=a.configureSAMLModalId,o=a.isSamlConfigSubmitting,r=a.samlConfig,i=Object(f.useActions)(x),l=i.setConfigureSAMLModalId,s=r.saml_acs_url&&r.saml_entity_id&&r.saml_x509_cert,c=function(){l(null)};return e.a.createElement(Z.a,{onClose:c,isOpen:!!n,title:"",simple:!0},e.a.createElement(Oe.Form,{logic:x,formKey:"samlConfig",enableFormOnSubmit:!0,className:"LemonModal__layout "},e.a.createElement(Z.a.Header,null,e.a.createElement("h3",null,"Configure SAML authentication and provisioning")),e.a.createElement(Z.a.Content,{className:"space-y-2"},e.a.createElement(G.a,{name:"saml_acs_url",label:"SAML ACS URL"},e.a.createElement(Ae.a,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})),e.a.createElement(G.a,{name:"saml_entity_id",label:"SAML Entity ID"},e.a.createElement(Ae.a,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})),e.a.createElement(G.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate"},e.a.createElement(Je.a,{className:"ph-ignore-input",minRows:10,placeholder:`Enter the public certificate of your IdP. Keep all line breaks.
-----BEGIN CERTIFICATE-----
MIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL
-----END CERTIFICATE-----`})),!s&&e.a.createElement(Ge.a,{type:"info"},"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft.")),e.a.createElement(Z.a.Footer,null,e.a.createElement(O.a,{loading:o,type:"primary",htmlType:"submit"},"Save settings"))))}var J={marginRight:4,fontSize:"1.15em",paddingTop:2};function ke(){var a=Object(f.useValues)(x),n=a.verifiedDomainsLoading,o=a.updatingDomainLoading,r=Object(f.useActions)(x),i=r.setAddModalShown;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"flex items-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("div",{id:"domain-whitelist"})," ",e.a.createElement("h2",{id:"authentication-domains",className:"subtitle"},"Authentication domains"),e.a.createElement("p",{className:"text-muted-alt"},"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains.")),e.a.createElement(O.a,{type:"primary",onClick:function(){return i(!0)},disabled:n||o},"Add domain")),e.a.createElement(He,null))}function He(){var a=Object(f.useValues)(x),n=a.verifiedDomains,o=a.verifiedDomainsLoading,r=a.currentOrganization,i=a.updatingDomainLoading,l=a.isSSOEnforcementAvailable,s=a.isSAMLAvailable,c=Object(f.useActions)(x),v=c.updateDomain,u=c.deleteVerifiedDomain,d=c.setVerifyModal,m=c.setConfigureSAMLModalId,h=Object(f.useValues)(ee.a),g=h.preflight,z=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function(D,p){var y=p.domain;return e.a.createElement(ce.a,{style:{textTransform:"lowercase"}},y)}}].concat(ie()(g!=null&&g.cloud?[{key:"is_verified",title:e.a.createElement(e.a.Fragment,null,"Verification",e.a.createElement(de.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO)."},e.a.createElement(me.a,{style:{marginLeft:4}}))),render:function(D,p){var y=p.is_verified,M=p.verified_at;return y?e.a.createElement("div",{className:"flex items-center text-success"},e.a.createElement(b.IconCheckmark,{style:J})," Verified"):M?e.a.createElement("div",{className:"flex items-center text-danger"},e.a.createElement(b.IconExclamation,{style:J})," Verification expired"):e.a.createElement("div",{className:"flex items-center text-warning"},e.a.createElement(b.IconWarning,{style:J})," Pending verification")}}]:[]),[{key:"jit_provisioning_enabled",title:e.a.createElement(e.a.Fragment,null,"Automatic provisioning"," ",e.a.createElement(de.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((r==null?void 0:r.name)||"this organization"," if it does not exist.")},e.a.createElement(me.a,null))),render:function(D,p){var y=p.jit_provisioning_enabled,M=p.id,T=p.is_verified;return T?e.a.createElement("div",{className:"flex items-center"},e.a.createElement(Ze.a,{checked:y,disabled:i||!T,onChange:function(Q){return v({id:M,jit_provisioning_enabled:Q})},label:e.a.createElement("span",{className:"font-normal"},y?"Enabled":"Disabled")})):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable automatic provisioning")}},{key:"sso_enforcement",title:e.a.createElement(e.a.Fragment,null,"Enforce SSO"," ",e.a.createElement(de.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider."},e.a.createElement(me.a,null))),render:function(D,p,y){var M=p.sso_enforcement,T=p.is_verified,B=p.id,Q=p.has_saml;return l?T?e.a.createElement(Ye.a,{value:M,loading:i,onChange:function(en){return v({id:B,sso_enforcement:en})},samlAvailable:Q}):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):y===0?e.a.createElement(Se.a,{to:Object(S.B)(g==null?void 0:g.cloud).url,target:Object(S.B)(g==null?void 0:g.cloud).target,className:"flex items-center"},e.a.createElement(b.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"):e.a.createElement(e.a.Fragment,null)}},{key:"saml",title:"SAML",render:function(D,p,y){var M=p.is_verified,T=p.saml_acs_url,B=p.saml_entity_id,Q=p.saml_x509_cert,Ce=p.has_saml;return s?M?e.a.createElement(e.a.Fragment,null,Ce?e.a.createElement("div",{className:"flex items-center text-success"},e.a.createElement(b.IconCheckmark,{style:J})," SAML enabled"):T||B||Q?e.a.createElement("div",{className:"flex items-center text-warning"},e.a.createElement(b.IconWarning,{style:J})," SAML partially configured"):e.a.createElement("div",{className:"flex items-center"},e.a.createElement(b.IconOffline,{style:J})," SAML not set up")):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):y===0?e.a.createElement(Se.a,{to:Object(S.B)(g==null?void 0:g.cloud).url,target:Object(S.B)(g==null?void 0:g.cloud).target,className:"flex items-center"},e.a.createElement(b.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"):e.a.createElement(e.a.Fragment,null)}},{key:"actions",width:32,align:"center",render:function(D,p){var y=p.is_verified,M=p.id,T=p.domain;return y?e.a.createElement(ye.a,{overlay:e.a.createElement(e.a.Fragment,null,e.a.createElement(O.a,{status:"stealth",onClick:function(){return m(M)},fullWidth:!0,disabled:!s,title:s?void 0:"Upgrade to enable SAML"},"Configure SAML"),e.a.createElement(O.a,{status:"danger",onClick:function(){return I.a.open({title:"Remove ".concat(T,"?"),description:"This cannot be undone. If you have SAML configured or SSO enforced,it will be immediately disabled.",primaryButton:{status:"danger",children:"Remove domain",onClick:function(){return u(M)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0},e.a.createElement(b.IconDelete,null)," Remove domain")),style:{display:"inline-block"}}):e.a.createElement(O.a,{type:"primary",onClick:function(){return d(M)}},"Verify")}}]);return e.a.createElement("div",null,e.a.createElement(q.a,{dataSource:n,columns:z,loading:o,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),e.a.createElement(We,null),e.a.createElement(Qe,null),e.a.createElement($e,null))}var Xe={component:je,logic:R.a};function _e(a){var n=a.isRestricted,o=Object(f.useValues)(R.a),r=o.currentOrganization,i=o.currentOrganizationLoading,l=Object(f.useActions)(R.a),s=l.updateOrganization,c=Object(j.useState)((r==null?void 0:r.name)||""),v=N()(c,2),u=v[0],d=v[1];return e.a.createElement("div",{style:{maxWidth:"40rem"}},e.a.createElement("h2",{id:"name",className:"subtitle mt-0"},"Display Name"),e.a.createElement(A.LemonInput,{className:"mb-4",value:u,onChange:d,disabled:n}),e.a.createElement(A.LemonButton,{type:"primary",onClick:function(h){h.preventDefault(),s({name:u})},disabled:n||!u||!r||u===r.name,loading:i},"Rename Organization"))}function qe(a){var n=a.isRestricted,o=Object(f.useValues)(R.a),r=o.currentOrganization,i=o.currentOrganizationLoading,l=Object(f.useActions)(R.a),s=l.updateOrganization;return e.a.createElement("div",null,e.a.createElement("h2",{id:"notification-preferences",className:"subtitle"},"Notification Preferences"),e.a.createElement("div",null,e.a.createElement(A.LemonSwitch,{"data-attr":"is-member-join-email-enabled-switch",onChange:function(v){s({is_member_join_email_enabled:v})},checked:!!(r!=null&&r.is_member_join_email_enabled),loading:i,disabled:n||!r,label:"Email all current members when a new member joins",bordered:!0})))}function je(){var a=Object(f.useValues)(Ee.a),n=a.user;return Object(ze.a)(location.hash),e.a.createElement(e.a.Fragment,null,e.a.createElement(H.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),e.a.createElement("div",{className:"border rounded p-6"},e.a.createElement(re.a,{Component:_e,minimumAccessLevel:S.n.Admin}),e.a.createElement(A.LemonDivider,{className:"my-6"}),e.a.createElement(Me,null),e.a.createElement(A.LemonDivider,{className:"my-6"}),n&&e.a.createElement(ne,{user:n}),e.a.createElement(A.LemonDivider,{className:"my-6"}),e.a.createElement(re.a,{Component:ke,minimumAccessLevel:S.n.Admin}),e.a.createElement(A.LemonDivider,{className:"my-6"}),e.a.createElement(re.a,{Component:qe,minimumAccessLevel:S.n.Admin}),e.a.createElement(A.LemonDivider,{className:"my-6"}),e.a.createElement(re.a,{Component:ae,minimumAccessLevel:S.n.Owner})))}}}]);
