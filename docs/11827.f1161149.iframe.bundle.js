(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[11827],{"../../products/games/368Hedgehogs/368Hedgehogs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>games_368Hedgehogs_368Hedgehogs});var injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),_368Hedgehogs=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.4_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../products/games/368Hedgehogs/368Hedgehogs.scss"),_368Hedgehogs_default=__webpack_require__.n(_368Hedgehogs),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(_368Hedgehogs_default(),options),_368Hedgehogs_default().locals;var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.22.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let EMOJIS=["hog1","hog2","hog3","hog4"],IMAGE_MAP={hog1:"/static/hedgehog/burning-money-hog.png",hog2:"/static/hedgehog/police-hog.png",hog3:"/static/hedgehog/sleeping-hog.png",hog4:"/static/hedgehog/warning-hog.png"},makeEmptyBoard=()=>Array.from({length:6},()=>Array(6).fill(null)),genPieceForBoard=board=>{let legalOrientations=[];for(let r=0;r<6;r++)for(let c=0;c<6;c++)null===board[r][c]&&(c+1<6&&null===board[r][c+1]&&legalOrientations.push("horizontal"),r+1<6&&null===board[r+1][c]&&legalOrientations.push("vertical"));return 0===legalOrientations.length?null:{orientation:legalOrientations[Math.floor(Math.random()*legalOrientations.length)],cells:[EMOJIS[Math.floor(Math.random()*EMOJIS.length)],EMOJIS[Math.floor(Math.random()*EMOJIS.length)]]}},cellKey=(r,c)=>`${r}-${c}`;function findMatches(board){let matches=makeEmptyBoard().map(row=>row.map(()=>!1));for(let r=0;r<6;r++){let c=0;for(;c<6;){let emoji=board[r][c];if(!emoji){c++;continue}let len=1;for(;c+len<6&&board[r][c+len]===emoji;)len++;if(len>=3)for(let k=0;k<len;k++)matches[r][c+k]=!0;c+=len}}for(let c=0;c<6;c++){let r=0;for(;r<6;){let emoji=board[r][c];if(!emoji){r++;continue}let len=1;for(;r+len<6&&board[r+len][c]===emoji;)len++;if(len>=3)for(let k=0;k<len;k++)matches[r+k][c]=!0;r+=len}}let coords=[];return matches.forEach((row,r)=>row.forEach((flag,c)=>{flag&&coords.push(cellKey(r,c))})),coords}let games_368Hedgehogs_368Hedgehogs=()=>{let initialBoard=makeEmptyBoard(),[board,setBoard]=(0,react.useState)(initialBoard),[piece,setPiece]=(0,react.useState)(()=>genPieceForBoard(initialBoard)),[pointsLeft,setPointsLeft]=(0,react.useState)(368),[clearing,setClearing]=(0,react.useState)(new Set),[gameOver,setGameOver]=(0,react.useState)(!1),clearTimer=(0,react.useRef)(null),boardRef=(0,react.useRef)(null),attemptPlacePiece=(0,react.useCallback)((anchorR,anchorC,droppedPiece,offset)=>{if(gameOver||clearing.size||!droppedPiece)return;let{orientation,cells}=droppedPiece;if(1===offset&&("horizontal"===orientation?anchorC-=1:anchorR-=1),anchorR<0||anchorC<0)return;let row2="vertical"===orientation?anchorR+1:anchorR,col2="horizontal"===orientation?anchorC+1:anchorC;if(row2>=6||col2>=6||board[anchorR][anchorC]||board[row2][col2])return;let newBoard=board.map(r=>r.slice());newBoard[anchorR][anchorC]=cells[0],newBoard[row2][col2]=cells[1];let toRemove=findMatches(newBoard);if(0===toRemove.length){setBoard(newBoard);let nextPiece=genPieceForBoard(newBoard);nextPiece?setPiece(nextPiece):setGameOver(!0);return}let removeSet=new Set(toRemove);setClearing(removeSet),setBoard(newBoard),clearTimer.current&&clearTimeout(clearTimer.current),clearTimer.current=setTimeout(()=>{let afterClear=newBoard.map((row,r)=>row.map((cell,c)=>removeSet.has(cellKey(r,c))?null:cell));setBoard(afterClear),setClearing(new Set);let newPoints=pointsLeft-removeSet.size;if(setPointsLeft(newPoints),newPoints<=0){setGameOver(!0);return}let nextPiece=genPieceForBoard(afterClear);nextPiece?setPiece(nextPiece):setGameOver(!0)},350)},[board,pointsLeft,gameOver,clearing.size]),handleDrop=(0,react.useCallback)((e,anchorRow,anchorCol)=>{e.preventDefault();let payloadText=e.dataTransfer.getData("text/plain");if(!payloadText)return;let{piece:droppedPiece,offset}=JSON.parse(payloadText);attemptPlacePiece(anchorRow,anchorCol,droppedPiece,offset)},[attemptPlacePiece]),allowDrop=e=>e.preventDefault(),restartGame=(0,react.useCallback)(()=>{clearTimer.current&&(clearTimeout(clearTimer.current),clearTimer.current=null);let freshBoard=makeEmptyBoard();setBoard(freshBoard),setPiece(genPieceForBoard(freshBoard)),setPointsLeft(368),setClearing(new Set),setGameOver(!1)},[]),[dragStyle,setDragStyle]=(0,react.useState)({}),dragOffsetPx=(0,react.useRef)({x:0,y:0}),dragOffsetCell=(0,react.useRef)(0),isTouchDragging=(0,react.useRef)(!1),isClearing=(r,c)=>clearing.has(cellKey(r,c));return(0,jsx_runtime.jsx)("div",{className:"Game368Hedgehogs",children:(0,jsx_runtime.jsxs)("div",{className:"cmg-container",children:[(0,jsx_runtime.jsxs)("h2",{className:"flex gap-2 items-center",children:[gameOver?pointsLeft>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{children:"Game over."}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",onClick:restartGame,children:"Try again?"})]}):"ðŸŽ‰ All the hogs are safe! Well done you! ðŸŽ‰":`${pointsLeft} hogs remaining`,gameOver?null:(0,jsx_runtime.jsx)(Tooltip.u,{title:"Drag the hogs onto the board. Get 3 in a row to save them. Heavily inspired by 368chickens.com",delayMs:0,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"ml-2"})})]}),(0,jsx_runtime.jsx)("div",{className:"cmg-board",ref:boardRef,children:board.map((row,r)=>row.map((cell,c)=>(0,jsx_runtime.jsx)("div",{className:`cmg-cell ${isClearing(r,c)?"vanish":""}`,onDragOver:allowDrop,onDrop:e=>handleDrop(e,r,c),children:cell&&(0,jsx_runtime.jsx)("img",{src:IMAGE_MAP[cell],alt:cell})},cellKey(r,c))))}),!gameOver&&piece&&(0,jsx_runtime.jsx)("div",{className:"cmg-piece-holder",children:(0,jsx_runtime.jsx)("div",{className:"cmg-piece cmg-board",draggable:!0,onDragStart:e=>{if(!piece)return;let rect=e.currentTarget.getBoundingClientRect(),relX=e.clientX-rect.left,relY=e.clientY-rect.top,offset=0;("horizontal"===piece.orientation&&relX>rect.width/2||"vertical"===piece.orientation&&relY>rect.height/2)&&(offset=1);let payload={piece,offset};e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify(payload))},onPointerDown:e=>{if("mouse"===e.pointerType||!piece)return;e.preventDefault();let rect=e.currentTarget.getBoundingClientRect(),relX=e.clientX-rect.left,relY=e.clientY-rect.top,offset=0;("horizontal"===piece.orientation&&relX>rect.width/2||"vertical"===piece.orientation&&relY>rect.height/2)&&(offset=1),dragOffsetCell.current=offset,dragOffsetPx.current={x:relX,y:relY},isTouchDragging.current=!0,setDragStyle({position:"fixed",left:e.clientX-relX,top:e.clientY-relY,zIndex:1e3,touchAction:"none"}),e.currentTarget.setPointerCapture(e.pointerId)},onPointerMove:e=>{isTouchDragging.current&&(e.preventDefault(),setDragStyle(prev=>({...prev,left:e.clientX-dragOffsetPx.current.x,top:e.clientY-dragOffsetPx.current.y})))},onPointerUp:e=>{if(!isTouchDragging.current)return;e.preventDefault();let boardEl=boardRef.current;if(boardEl){let boardRect=boardEl.getBoundingClientRect(),cellSize=boardRect.width/6,col=Math.floor((e.clientX-boardRect.left)/cellSize);attemptPlacePiece(Math.floor((e.clientY-boardRect.top)/cellSize),col,piece,dragOffsetCell.current)}isTouchDragging.current=!1,setDragStyle({}),dragOffsetCell.current=0},style:{flexDirection:"horizontal"===piece.orientation?"row":"column",...dragStyle},children:piece.cells.map((emoji,idx)=>(0,jsx_runtime.jsx)("div",{className:"cmg-cell piece-cell",children:(0,jsx_runtime.jsx)("img",{src:IMAGE_MAP[emoji],alt:emoji})},idx))})})]})})}},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.4_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../products/games/368Hedgehogs/368Hedgehogs.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".Game368Hedgehogs{--board-size:6}.Game368Hedgehogs .cmg-container{align-items:center;display:flex;flex-direction:column;font-family:system-ui,sans-serif;-webkit-user-select:none;-moz-user-select:none;user-select:none}.Game368Hedgehogs .cmg-title{color:#fff;margin-bottom:1rem;text-shadow:0 2px 4px rgba(0,0,0,.4)}.Game368Hedgehogs .cmg-board{background:#0d1b2a;border-radius:12px;display:grid;gap:4px;grid-template-columns:repeat(var(--board-size),64px);grid-template-rows:repeat(var(--board-size),64px);padding:4px}.Game368Hedgehogs .cmg-cell{align-items:center;background:#1b263b;border-radius:8px;display:flex;font-size:40px;height:64px;justify-content:center;transition:background .2s;width:64px}.Game368Hedgehogs .cmg-cell img{height:100%;object-fit:contain;width:100%}.Game368Hedgehogs .cmg-cell:hover{background:#24344d}.Game368Hedgehogs .cmg-piece-holder{height:140px;padding-top:32px}.Game368Hedgehogs .cmg-piece{cursor:grab;display:flex;gap:4px}.Game368Hedgehogs .piece-cell{pointer-events:none}.Game368Hedgehogs .vanish{animation:Game368Hedgehogs__vanish .2s forwards}@keyframes Game368Hedgehogs__vanish{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.3)}}",""]),module.exports=exports}}]);