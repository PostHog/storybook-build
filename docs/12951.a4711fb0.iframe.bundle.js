"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[12951],{"./frontend/src/scenes/heatmaps/HeatmapsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HeatmapsScene:()=>HeatmapsScene,scene:()=>scene});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),AuthorizedUrlList=__webpack_require__("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),authorizedUrlListLogic=__webpack_require__("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),hedgehogs=__webpack_require__("./frontend/src/lib/components/hedgehogs.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),utils=__webpack_require__("./frontend/src/queries/utils.ts"),toolbarLogic=__webpack_require__("./frontend/src/toolbar/bar/toolbarLogic.ts");let heatmapsBrowserLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","heatmaps","heatmapsBrowserLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)({values:[(0,authorizedUrlListLogic.zl)({actionId:null,type:authorizedUrlListLogic.uw.TOOLBAR_URLS}),["urlsKeyed","checkUrlIsAuthorized"]]}),(0,index_esm.actions)({setBrowserSearch:searchTerm=>({searchTerm}),setBrowserUrl:url=>({url}),setIframePosthogJsConnected:ready=>({ready}),onIframeLoad:!0,onIframeToolbarLoad:!0,sendToolbarMessage:(type,payload)=>({type,payload}),setLoading:loading=>({loading}),loadTopUrls:!0,maybeLoadTopUrls:!0,loadBrowserSearchResults:!0}),(0,lib.loaders)(_ref=>{let{values}=_ref;return{browserSearchResults:[null,{loadBrowserSearchResults:async()=>{if(!values.browserSearchTerm)return[];let query={kind:schema.OH.HogQLQuery,query:(0,utils.zP)`SELECT distinct properties.$current_url AS urls
                                FROM events
                                WHERE timestamp >= now() - INTERVAL 7 DAY
                                AND timestamp <= now()
                                AND properties.$current_url like '%${utils.zP.identifier(values.browserSearchTerm)}%'
                                ORDER BY timestamp DESC
                                limit 100`},res=await api.ZP.query(query);return res.results?.map(x=>x[0])}}],topUrls:[null,{loadTopUrls:async()=>{let query={kind:schema.OH.HogQLQuery,query:(0,utils.zP)`SELECT properties.$current_url AS url, count() as count FROM events
                                WHERE timestamp >= now() - INTERVAL 7 DAY
                                AND event in ('$pageview', '$autocapture')
                                AND timestamp <= now()
                                GROUP BY properties.$current_url
                                ORDER BY count DESC
                                LIMIT 10`},res=await api.ZP.query(query);return res.results?.map(x=>({url:x[0],count:x[1]}))}}]}}),(0,index_esm.reducers)({browserSearchTerm:["",{setBrowserSearch:(_,_ref2)=>{let{searchTerm}=_ref2;return searchTerm}}],browserUrl:[null,{persist:!0},{setBrowserUrl:(_,_ref3)=>{let{url}=_ref3;return url}}],iframePosthogJsConnected:[!1,{setIframePosthogJsConnected:(_,_ref4)=>{let{ready}=_ref4;return ready}}],loading:[!1,{setLoading:(_,_ref5)=>{let{loading}=_ref5;return loading},setBrowserUrl:()=>!0,onIframeToolbarLoad:()=>!1}]}),(0,index_esm.selectors)({browserUrlSearchOptions:[s=>[s.browserSearchResults,s.topUrls,s.browserSearchTerm],(browserSearchResults,topUrls,browserSearchTerm)=>{var _topUrls$map;return browserSearchTerm?browserSearchResults:null!==(_topUrls$map=topUrls?.map(x=>x.url))&&void 0!==_topUrls$map?_topUrls$map:[]}],isBrowserUrlAuthorized:[s=>[s.browserUrl,s.checkUrlIsAuthorized],(browserUrl,checkUrlIsAuthorized)=>!!browserUrl&&checkUrlIsAuthorized(browserUrl)]}),(0,index_esm.listeners)(_ref6=>{let{actions,props,values}=_ref6;return{setBrowserSearch:async(_,breakpoint)=>{await breakpoint(200),actions.loadBrowserSearchResults()},sendToolbarMessage:_ref7=>{let{type,payload}=_ref7;props.iframeRef?.current?.contentWindow?.postMessage({type,payload},"*")},onIframeLoad:()=>{let init=()=>{actions.sendToolbarMessage(toolbarLogic.T.PH_APP_INIT),actions.sendToolbarMessage(toolbarLogic.T.PH_HEATMAPS_CONFIG,{enabled:!0})};window.addEventListener("message",e=>{let type=e?.data?.type;if(type&&type.startsWith("ph-"))switch(type){case toolbarLogic.T.PH_TOOLBAR_INIT:return init();case toolbarLogic.T.PH_TOOLBAR_READY:return actions.onIframeToolbarLoad();default:console.warn(`[PostHog Heatmpas] Received unknown child window message: ${type}`)}},!1),init()},maybeLoadTopUrls:()=>{values.topUrls||values.topUrlsLoading||actions.loadTopUrls()},setBrowserUrl:()=>{actions.maybeLoadTopUrls()}}}),(0,index_esm.afterMount)(_ref8=>{let{actions,values}=_ref8;values.browserUrl?actions.setLoading(!0):actions.maybeLoadTopUrls()})]);var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function HeatmapsBrowser(){var _browserUrlSearchOpti,_browserUrlSearchOpti2;let iframeRef=(0,react.useRef)(null),logic=heatmapsBrowserLogic({iframeRef}),{browserUrlSearchOptions,browserUrl,loading,isBrowserUrlAuthorized,topUrls,topUrlsLoading}=(0,index_esm.useValues)(logic),{setBrowserSearch,setBrowserUrl,onIframeLoad}=(0,index_esm.useActions)(logic),placeholderUrl=null!==(_browserUrlSearchOpti=browserUrlSearchOptions?.[0])&&void 0!==_browserUrlSearchOpti?_browserUrlSearchOpti:"https://your-website.com/pricing";return(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap gap-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col overflow-hidden w-full h-[90vh] rounded border",children:[(0,jsx_runtime.jsxs)("div",{className:"bg-accent-3000 p-2 border-b flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"flex-1",children:(0,jsx_runtime.jsx)(src.LemonInputSelect,{mode:"single",allowCustomValues:!0,placeholder:`e.g. ${placeholderUrl}`,onInputChange:e=>setBrowserSearch(e),value:browserUrl?[browserUrl]:void 0,onChange:v=>{var _v$;return setBrowserUrl(null!==(_v$=v[0])&&void 0!==_v$?_v$:null)},options:null!==(_browserUrlSearchOpti2=browserUrlSearchOptions?.map(x=>({label:x,key:x})))&&void 0!==_browserUrlSearchOpti2?_browserUrlSearchOpti2:[]})}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",sideIcon:(0,jsx_runtime.jsx)(icons.pF,{}),to:browserUrl?(0,authorizedUrlListLogic.Kc)(browserUrl,{userIntent:"heatmaps"}):void 0,targetBlank:!0,disabledReason:browserUrl?void 0:"Select a URL first",children:"Open in toolbar"})]}),(0,jsx_runtime.jsx)("div",{className:"relative flex flex-1 bg-accent-3000 overflow-hidden",children:browserUrl?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:isBrowserUrlAuthorized?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("iframe",{ref:iframeRef,className:"flex-1",src:(0,authorizedUrlListLogic.Kc)(browserUrl,{userIntent:"heatmaps"}),style:{background:"#FFF"},onLoad:onIframeLoad}),loading&&(0,jsx_runtime.jsx)(src.SpinnerOverlay,{})]}):(0,jsx_runtime.jsxs)("div",{className:"flex-1 p-4 space-y-4",children:[(0,jsx_runtime.jsxs)(src.LemonBanner,{type:"error",children:[browserUrl," is not an authorized URL. Please add it to the list of authorized URLs to view heatmaps on this page."]}),(0,jsx_runtime.jsx)("h2",{children:"Authorized Toolbar URLs"}),(0,jsx_runtime.jsx)(AuthorizedUrlList.t,{type:authorizedUrlListLogic.uw.TOOLBAR_URLS})]})}):(0,jsx_runtime.jsx)("div",{className:"flex-1 flex items-center justify-center overflow-y-auto",children:(0,jsx_runtime.jsxs)("div",{className:"max-w-[50rem] m-6",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center flex-wrap gap-6 my-10",children:[(0,jsx_runtime.jsx)("div",{className:"w-50",children:(0,jsx_runtime.jsx)(hedgehogs.DetectiveHog,{className:"w-full h-full"})}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("h2",{children:"Welcome to Heatmaps"}),(0,jsx_runtime.jsx)("p",{children:"Heatmaps are powered by the embedded JavaScript SDK and allow you to see a range of user interactions directly on your website via the Toolbar."}),(0,jsx_runtime.jsx)("p",{children:"You can also view heatmaps for any page on your website by entering the URL above. As long as the page has the PostHog Toolbar installed, and can be loaded in an iframe, you can view heatmaps for it."})]})]}),(0,jsx_runtime.jsx)("div",{className:"space-y-px p-2 border bg-bg-light rounded",children:topUrlsLoading?(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"h-10",repeat:10}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:topUrls?.map(_ref=>{let{url}=_ref;return jsx_runtime.jsx(src.LemonButton,{fullWidth:!0,onClick:()=>setBrowserUrl(url),children:url},url)})})})]})})})]})})}let heatmapsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","heatmaps","heatmapsSceneLogic"])]),scene={component:HeatmapsScene,logic:heatmapsSceneLogic};function HeatmapsScene(){return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(HeatmapsBrowser,{})})}}}]);
//# sourceMappingURL=12951.a4711fb0.iframe.bundle.js.map