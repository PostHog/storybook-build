(window.webpackJsonp=window.webpackJsonp||[]).push([[238],{"./frontend/src/scenes/actions/Action.tsx":function(le,L,e){"use strict";e.r(L),e.d(L,"scene",function(){return ct}),e.d(L,"Action",function(){return Le});var q=e("./node_modules/core-js/modules/es.array.concat.js"),ee=e("./node_modules/react/index.js"),t=e.n(ee),Me=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),N=e.n(Me),v=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ie=e.n(v),He=e("./node_modules/core-js/modules/es.array.map.js"),xe=e("./node_modules/core-js/modules/es.array.filter.js"),Re=e("./node_modules/core-js/modules/es.object.to-string.js"),ce=e("./node_modules/core-js/modules/es.object.keys.js"),Ee=e("./node_modules/core-js/modules/es.symbol.js"),Je=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),de=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),ge=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),R=e("./frontend/src/lib/utils.tsx"),he=e("./frontend/src/lib/components/Link.tsx"),h=e("./node_modules/kea/lib/index.esm.js"),$=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),te=e.n($),je=e("./node_modules/@babel/runtime/regenerator/index.js"),W=e.n(je),ye=e("./node_modules/core-js/modules/es.function.name.js"),Xe=e("./node_modules/core-js/modules/es.array.iterator.js"),ne=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Oe=e("./node_modules/core-js/modules/es.regexp.exec.js"),_e=e("./node_modules/core-js/modules/es.string.split.js"),H=e("./frontend/src/lib/api.ts"),ae=e("./frontend/src/models/actionsModel.ts"),z=e("./frontend/src/lib/components/lemonToast.tsx"),Ae=e("./node_modules/kea-loaders/lib/index.js"),Be=e("./node_modules/kea-forms/lib/index.js");function re(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),r.push.apply(r,o)}return r}function J(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?re(Object(r),!0).forEach(function(o){N()(a,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(r,o))})}return a}var X=Object(h.kea)([Object(h.path)(["scenes","actions","actionEditLogic"]),Object(h.props)({}),Object(h.key)(function(a){return a.id||"new"}),Object(h.actions)({setAction:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:n,options:r}},setCreateNew:function(n){return{createNew:n}},actionAlreadyExists:function(n){return{actionId:n}}}),Object(h.reducers)({createNew:[!1,{setCreateNew:function(n,r){var o=r.createNew;return o}}]}),Object(Be.forms)(function(a){var n=a.actions,r=a.props;return{action:{defaults:J({},r.action),errors:function(c){var u=c.name;return{name:u?null:"You need to set a name"}},submit:function(c){n.saveAction(c)}}}}),Object(Ae.loaders)(function(a){var n=a.props,r=a.values;return{actionCount:{loadActionCount:function(){var o=te()(W.a.mark(function u(){return W.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!n.id){p.next=6;break}return p.next=3,H.b.actions.getCount(n.id);case 3:p.t0=p.sent,p.next=7;break;case 6:p.t0=0;case 7:return p.abrupt("return",p.t0);case 8:case"end":return p.stop()}},u)}));function c(){return o.apply(this,arguments)}return c}()},action:[J({},n.action),{setAction:function(c){var u=c.action,E=c.options.merge;return E?J(J({},r.action),u):u},saveAction:function(){var o=te()(W.a.mark(function u(E,p){var d,b;return W.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(d=J({},E),d.steps=d.steps?d.steps.filter(function(De){return De.event}):[],g.prev=2,!d.id){g.next=9;break}return g.next=6,H.b.actions.update(d.id,d,n.temporaryToken);case 6:d=g.sent,g.next=12;break;case 9:return g.next=11,H.b.actions.create(d,n.temporaryToken);case 11:d=g.sent;case 12:p(),g.next=22;break;case 15:if(g.prev=15,g.t0=g.catch(2),g.t0.code!=="unique"){g.next=21;break}return b=g.t0.detail.split(" ").pop(),Ye(b),g.abrupt("return",d);case 21:throw g.t0;case 22:return z.d.success("Action saved"),n.onSave(d),ae.a.actions.loadActions(),g.abrupt("return",d);case 26:case"end":return g.stop()}},u,null,[[2,15]])}));function c(u,E){return o.apply(this,arguments)}return c}()}]}}),Object(h.afterMount)(function(a){var n=a.actions,r=a.props;r.id?n.loadActionCount():n.setAction({name:"",steps:[{isNew:Object(R.Cb)()}]},{merge:!1})})]),Qe=e("./frontend/src/scenes/actions/Actions.scss"),F=e("./frontend/src/scenes/actions/EventName.tsx"),Ke=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),ue=e.n(Ke),be=e("./frontend/src/scenes/teamLogic.tsx"),oe=e("./node_modules/antd/es/button/index.js"),Ne=e("./node_modules/antd/es/modal/index.js"),Te=e("./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx"),We=e("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts");function Y(a){var n,r=a.actionId,o=a.style,c=a.children,u=Object(ee.useState)(!1),E=ue()(u,2),p=E[0],d=E[1],b=Object(h.useValues)(be.a),D=b.currentTeam;return t.a.createElement(t.a.Fragment,null,t.a.createElement(oe.a,{href:Object(We.b)(D==null||(n=D.app_urls)===null||n===void 0?void 0:n[0],r),style:o,size:"small",onClick:function(De){De.preventDefault(),d(!0)}},c),t.a.createElement(Ne.a,{visible:p,title:r?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:t.a.createElement(oe.a,{onClick:function(){return d(!1)}},"Close"),onCancel:function(){return d(!1)}},t.a.createElement(Te.a,{actionId:r,pageKey:"app-editor-link"})))}try{Y.displayName="AppEditorLink",Y.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:Y.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(a){}var Q=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),j=e("./frontend/src/lib/components/Tooltip.tsx"),G=e("./frontend/src/scenes/actions/hints.tsx"),w=e("./node_modules/antd/es/typography/index.js"),M=e("./node_modules/antd/es/col/index.js"),me=e("./node_modules/antd/es/card/index.js"),Ce=e("./node_modules/antd/es/input/index.js"),pe=e("./node_modules/antd/es/space/index.js"),x=e("./node_modules/antd/es/radio/index.js"),Z=e("./node_modules/@ant-design/icons/es/icons/ExportOutlined.js"),V=e("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js");function ve(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),r.push.apply(r,o)}return r}function T(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ve(Object(r),!0).forEach(function(o){N()(a,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):ve(Object(r)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(r,o))})}return a}var Pe=w.a.Text,Ze="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function se(a){var n=a.step,r=a.actionId,o=a.isOnlyStep,c=a.index,u=a.identifier,E=a.onDelete,p=a.onChange,d=function(D){p(D)};return t.a.createElement(M.a,{span:24,md:12},t.a.createElement(me.a,{className:"action-step",style:{overflow:"visible"}},c>0&&t.a.createElement("div",{className:"stateful-badge pos-center-end or"},"OR"),t.a.createElement("div",null,!o&&t.a.createElement("div",{className:"remove-wrapper"},t.a.createElement("button",{type:"button","aria-label":"delete",onClick:E},t.a.createElement("span",{"aria-hidden":"true"},"\xD7"))),t.a.createElement("div",{className:"mb"},t.a.createElement("b",null,"Match Group #",c+1)),t.a.createElement(Ue,{step:n,sendStep:d}),t.a.createElement("div",{style:{marginTop:n.event==="$pageview"?20:8,paddingBottom:0}},n.event==="$autocapture"&&t.a.createElement(ze,{step:n,sendStep:d,actionId:r}),n.event!=null&&n.event!=="$autocapture"&&n.event!=="$pageview"&&t.a.createElement("div",{style:{marginTop:"2rem"}},t.a.createElement("label",null,t.a.createElement("b",null,"Event name: ")),t.a.createElement(F.a,{value:n.event,onChange:function(D){return d(T(T({},n),{},{event:D||""}))}}),t.a.createElement("br",null),t.a.createElement("small",null,t.a.createElement("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer"},"See documentation")," ","on how to send custom events in lots of languages.")),n.event==="$pageview"&&t.a.createElement("div",null,t.a.createElement(k,{step:n,sendStep:d,item:"url",extra_options:t.a.createElement(Fe,{step:n,sendStep:d}),label:"URL"}),n.url_matching&&n.url_matching in G.a&&t.a.createElement("small",{style:{display:"block",marginTop:-12}},G.a[n.url_matching])),n.event&&t.a.createElement("div",{className:"action-property-filters"},t.a.createElement("h3",{className:"l3"},"Filters"),(!n.properties||n.properties.length===0)&&t.a.createElement("div",{className:"text-muted"},"This match group has no additional filters."),t.a.createElement(Q.a,{propertyFilters:n.properties,pageKey:u,eventNames:n.event?[n.event]:[],onChange:function(D){d(T(T({},n),{},{properties:D}))},showConditionBadge:!0}))))))}function k(a){var n=function(o){return a.sendStep(T(T({},a.step),{},N()({},a.item,o.target.value||null)))};return t.a.createElement("div",{className:"mb"},t.a.createElement("label",{style:{fontWeight:"bold"}},a.label," ",a.extra_options),a.caption&&t.a.createElement("div",{className:"action-step-caption"},a.caption),a.item==="selector"?t.a.createElement(Ce.a.TextArea,{allowClear:!0,onChange:n,value:a.step[a.item]||"",placeholder:a.placeholder}):t.a.createElement(Ce.a,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:n,value:a.step[a.item]||"",placeholder:a.placeholder}))}function ze(a){var n=a.step,r=a.actionId,o=a.sendStep,c=function(){return t.a.createElement("div",{className:"text-center"},t.a.createElement("span",{className:"stateful-badge and"},"AND"))};return t.a.createElement("div",null,t.a.createElement("span",null,t.a.createElement(Y,{actionId:r,style:{margin:"1rem 0"}},"Select element on site ",t.a.createElement(Z.a,null)),t.a.createElement("a",{href:"".concat(Ze,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8}},"See documentation.")," "),t.a.createElement(k,{step:n,sendStep:o,item:"href",label:"Link target equals",caption:t.a.createElement(t.a.Fragment,null,"If your element is a link, the location that the link opens (",t.a.createElement("code",null,"href")," tag)")}),t.a.createElement(c,null),t.a.createElement(k,{step:n,sendStep:o,item:"text",label:"Text equals",caption:"Text content inside your element"}),t.a.createElement(c,null),t.a.createElement(k,{step:n,sendStep:o,item:"selector",label:t.a.createElement(t.a.Fragment,null,"HTML selector matches",t.a.createElement(j.a,{title:"Click here to learn more about supported selectors"},t.a.createElement("a",{href:"".concat(Ze,"#matching-selectors"),target:"_blank",rel:"noopener"},t.a.createElement(V.a,{style:{marginLeft:4}})))),placeholder:'button[data-attr="my-id"]',caption:t.a.createElement(pe.b,{direction:"vertical"},t.a.createElement(Pe,{style:{color:"var(--muted)"}},"CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",t.a.createElement(Pe,{code:!0},'[data-attr="signup"]')))}),t.a.createElement("div",{style:{marginBottom:18}},t.a.createElement(c,null)),t.a.createElement(k,{step:n,sendStep:o,item:"url",extra_options:t.a.createElement(Fe,{step:n,sendStep:o}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(n==null?void 0:n.url_matching)&&n.url_matching in G.a&&t.a.createElement("small",{style:{display:"block",marginTop:-12}},G.a[n.url_matching]))}function Ue(a){var n=a.step,r=a.sendStep,o=function(u){var E=u.target.value;E==="$autocapture"?r(T(T({},n),{},{event:"$autocapture"})):E==="event"?r(T(T({},n),{},{event:""})):E==="$pageview"&&r(T(T({},n),{},{event:"$pageview",url:n.url}))};return t.a.createElement("div",{className:"type-switcher"},t.a.createElement(x.a.Group,{buttonStyle:"solid",onChange:o,value:n.event==="$autocapture"||n.event==="$pageview"||n.event===void 0?n.event:"event"},t.a.createElement(x.a.Button,{value:"$autocapture"},"Autocapture"),t.a.createElement(x.a.Button,{value:"event"},"Custom event"),t.a.createElement(x.a.Button,{value:"$pageview"},"Page view")))}function Fe(a){var n=a.step,r=a.sendStep,o=function(u){r(T(T({},n),{},{url_matching:u.target.value}))};return t.a.createElement(x.a.Group,{buttonStyle:"solid",onChange:o,value:n.url_matching||"contains",size:"small"},t.a.createElement(x.a.Button,{value:"contains"},"contains"),t.a.createElement(x.a.Button,{value:"regex"},"matches regex"),t.a.createElement(x.a.Button,{value:"exact"},"matches exactly"))}try{se.displayName="ActionStep",se.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:se.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(a){}var O=e("./node_modules/antd/es/row/index.js"),i=e("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),s=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),l=e("./node_modules/kea-router/lib/index.js"),f=e("./frontend/src/lib/components/PageHeader.tsx"),y=e("./frontend/src/scenes/urls.ts"),I=e("./frontend/src/lib/components/EditableField/EditableField.tsx"),C=e("./frontend/src/types.ts"),P=e("./frontend/src/scenes/userLogic.ts"),B=e("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),fe=e("./frontend/src/lib/forms/VerticalForm.tsx"),A=e("./frontend/src/lib/forms/Field.tsx"),K=e("./frontend/src/lib/components/LemonButton/index.ts"),Se=e("./frontend/src/lib/components/LemonCheckbox/index.ts"),Ve=e("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function nt(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),r.push.apply(r,o)}return r}function ot(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?nt(Object(r),!0).forEach(function(o){N()(a,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):nt(Object(r)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(r,o))})}return a}function $e(a){var n=a.action,r=a.id,o=a.onSave,c=a.temporaryToken,u={id:r,action:n,onSave:function(m){return o(m)},temporaryToken:c},E=X(u),p=Object(h.useValues)(E),d=p.action,b=p.actionLoading,D=p.actionCount,g=p.actionCountLoading,De=Object(h.useActions)(ae.a),dt=De.loadActions,ut=Object(h.useValues)(be.a),qe=ut.currentTeam,mt=Object(h.useValues)(P.a),pt=mt.hasAvailableFeature,et=qe==null?void 0:qe.slack_incoming_webhook,at=function(){return t.a.createElement(K.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",style:{marginRight:8},onClick:function(){Object(R.x)({endpoint:H.b.actions.determineDeleteEndpoint(),object:d,callback:function(){l.router.actions.push(y.a.actions()),dt()}})}},"Delete")},rt=function(){return t.a.createElement(K.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",style:{marginRight:8},onClick:function(){l.router.actions.push(y.a.actions())}},"Cancel")};return t.a.createElement("div",{className:"action-edit-container"},t.a.createElement(fe.a,{logic:X,props:u,formKey:"action",enableFormOnSubmit:!0},t.a.createElement(f.a,{title:t.a.createElement(A.a,{name:"name"},function(_){var m=_.value,U=_.onChange;return t.a.createElement(I.a,{name:"name",value:m||"",placeholder:"Name this action",onChange:r?void 0:U,onSave:r?U:void 0,mode:r?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(r?"edit":"create"),saveButtonText:"Set",className:"action-name"})}),caption:t.a.createElement(t.a.Fragment,null,t.a.createElement(A.a,{name:"description",showOptional:!0},function(_){var m=_.value,U=_.onChange;return t.a.createElement(I.a,{multiline:!0,name:"description",value:m||"",placeholder:"Description (optional)",onChange:r?void 0:U,onSave:r?U:void 0,mode:r?void 0:"edit",autoFocus:!!r,"data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!pt(C.d.INGESTION_TAXONOMY),saveButtonText:"Set"})}),t.a.createElement(A.a,{name:"tags",showOptional:!0},function(_){var m=_.value,U=_.onChange;return t.a.createElement(B.a,{tags:m!=null?m:[],onChange:function(Ge,tt){return U(tt)},className:"action-tags",saving:b})})),buttons:r?at():rt()}),r&&t.a.createElement("div",{className:"input-set"},t.a.createElement("div",null,t.a.createElement("span",{className:"text-muted mb-05"},g&&t.a.createElement(i.a,null),D!==null&&D>-1&&t.a.createElement(t.a.Fragment,null,"This action matches ",t.a.createElement("b",null,Object(R.q)(D))," events in the last 3 months")))),t.a.createElement("div",{style:{overflow:"visible"}},t.a.createElement("h2",{className:"subtitle"},"Match groups"),t.a.createElement("div",null,"Your action will be triggered whenever ",t.a.createElement("b",null,"any of your match groups")," are received."," ",t.a.createElement("a",{href:"https://posthog.com/docs/features/actions",target:"_blank"},t.a.createElement(V.a,null))),t.a.createElement(A.a,{name:"steps"},function(_){var m=_.onChange;return t.a.createElement("div",{style:{textAlign:"right",marginBottom:12}},t.a.createElement(oe.a,{onClick:function(){return m([].concat(ie()(d.steps||[]),[{isNew:Object(R.Cb)()}]))},size:"small"},"Add another match group"))}),t.a.createElement(A.a,{name:"steps"},function(_){var m=_.value,U=_.onChange;return t.a.createElement(O.a,{gutter:[24,24]},t.a.createElement(t.a.Fragment,null,m==null?void 0:m.map(function(S,Ge){return t.a.createElement(se,{key:S.id||S.isNew,identifier:String(S.id||S.isNew),index:Ge,step:S,actionId:d.id||0,isOnlyStep:!!m&&m.length===1,onDelete:function(){var we=S.id?"id":"isNew";U(m==null?void 0:m.filter(function(Ie){return Ie[we]!==S[we]}))},onChange:function(we){U(m==null?void 0:m.map(function(Ie){return S.id&&Ie.id==S.id||S.isNew&&Ie.isNew===S.isNew?ot({id:S.id,isNew:S.isNew},we):Ie}))}})})),t.a.createElement(M.a,{span:24,md:12},t.a.createElement("div",{className:"match-group-add-skeleton",onClick:function(){U([].concat(ie()(d.steps||[]),[{isNew:Object(R.Cb)()}]))}},t.a.createElement(s.a,{style:{fontSize:28,color:"#666666"}}))))})),t.a.createElement("div",null,t.a.createElement("div",{style:{marginTop:"2rem"}},t.a.createElement("h2",{className:"subtitle"},"Match groups"),t.a.createElement(A.a,{name:"post_to_slack"},function(_){var m=_.value,U=_.onChange;return t.a.createElement(Se.a,{id:"webhook-checkbox",checked:!!m,onChange:function(Ge){return U(Ge.target.checked)},rowProps:{fullWidth:!0},disabled:!et,label:t.a.createElement(t.a.Fragment,null,"Post to webhook when this action is triggered.",t.a.createElement(he.a,{to:"/project/settings#webhook",style:{marginLeft:4}},et?"Configure":"Enable"," this integration in Setup."))})}),d.post_to_slack&&t.a.createElement(t.a.Fragment,null,t.a.createElement(A.a,{name:"slack_message_format"},function(_){var m=_.value,U=_.onChange;return t.a.createElement(t.a.Fragment,null,t.a.createElement("div",null,"Message format (optional)"),t.a.createElement(Ve.a,{placeholder:"Default: [action.name] triggered by [person]",value:m,onChange:U,disabled:!et||!d.post_to_slack,"data-attr":"edit-slack-message-format"}),t.a.createElement("small",null,t.a.createElement("a",{href:"https://posthog.com/docs/integrations/message-formatting/",target:"_blank",rel:"noopener noreferrer"},"See documentation on how to format webhook messages.")))})))),t.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r?at():rt(),t.a.createElement(K.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:b},"Save"))))}function Ye(a){z.d.error(t.a.createElement(t.a.Fragment,null,"Action with this name already exists. ",t.a.createElement("a",{href:y.a.action(a)},"Click here to edit.")))}try{$e.displayName="ActionEdit",$e.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:$e.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(a){}try{Ye.displayName="duplicateActionErrorToast",Ye.__docgenInfo={description:"",displayName:"duplicateActionErrorToast",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#duplicateActionErrorToast"]={docgenInfo:Ye.__docgenInfo,name:"duplicateActionErrorToast",path:"frontend/src/scenes/actions/ActionEdit.tsx#duplicateActionErrorToast"})}catch(a){}var st=e("./frontend/src/scenes/events/index.ts"),lt=e("./frontend/src/lib/dayjs.ts"),it=e("./frontend/src/lib/components/Spinner/Spinner.tsx"),ke=Object(h.kea)({props:{},key:function(n){return n.id||"new"},path:function(n){return["scenes","actions","actionLogic",n]},actions:function(){return{checkIsFinished:function(r){return{action:r}},setPollTimeout:function(r){return{pollTimeout:r}},setIsComplete:function(r){return{isComplete:r}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(r,o){var c=o.pollTimeout;return c}}],isComplete:[!1,{setIsComplete:function(r,o){var c=o.isComplete;return c}}]}},selectors:{breadcrumbs:[function(a){return[a.action]},function(a){return[{name:"Data Management",path:y.a.actions()},{name:(a==null?void 0:a.name)||"Unnamed",path:a?y.a.action(a.id):void 0}]}]},loaders:function(n){var r=n.actions,o=n.props;return{action:{loadAction:function(){var c=te()(W.a.mark(function E(){var p;return W.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(r.setIsComplete(!1),o.id){b.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return b.next=5,H.b.actions.get(o.id);case 5:return p=b.sent,r.checkIsFinished(p),b.abrupt("return",p);case 8:case"end":return b.stop()}},E)}));function u(){return c.apply(this,arguments)}return u}()}}},listeners:function(n){var r=n.actions,o=n.values;return{checkIsFinished:function(u){var E=u.action;E.is_calculating?r.setPollTimeout(setTimeout(function(){return r.loadAction()},1e3)):(r.setIsComplete(new Date),o.pollTimeout&&clearTimeout(o.pollTimeout))}}},events:function(n){var r=n.values,o=n.actions,c=n.props;return{afterMount:function(){c.id&&o.loadAction()},beforeUnmount:function(){r.pollTimeout&&clearTimeout(r.pollTimeout)}}}}),ct={logic:ke,component:Le,paramsToProps:function(n){var r=n.params.id;return{id:parseInt(r)}}};function Le(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=a.id,r={action_id:n},o=Object(h.useActions)(l.router),c=o.push,u=Object(h.useValues)(ke),E=u.action,p=u.isComplete,d=Object(h.useActions)(ke),b=d.loadAction;return t.a.createElement(t.a.Fragment,null,(!n||E)&&t.a.createElement($e,{id:n,action:E,onSave:function(g){n||c(y.a.action(g.id)),b()}}),n&&(p?t.a.createElement("div",null,t.a.createElement("h2",{className:"subtitle"},"Matching events"),t.a.createElement("p",null,"This is the list of ",t.a.createElement("strong",null,"recent")," events that match this action.",E!=null&&E.last_calculated_at?t.a.createElement(t.a.Fragment,null," ","Last calculated: ",t.a.createElement("b",null,Object(lt.a)(E.last_calculated_at).fromNow()),"."):""),t.a.createElement(st.a,{fixedFilters:r,sceneUrl:y.a.action(n),fetchMonths:3,pageKey:"action-".concat(n,"-").concat(JSON.stringify(r))})):t.a.createElement("div",null,t.a.createElement("h2",{className:"subtitle"},"Matching events"),t.a.createElement("div",{className:"flex-center"},t.a.createElement(it.a,{style:{marginRight:12}}),"Calculating action, please hold on."))))}try{Le.displayName="Action",Le.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:Le.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(a){}},"./frontend/src/scenes/events/index.ts":function(le,L,e){"use strict";var q=e("./frontend/src/scenes/events/EventDetails.tsx"),ee=e("./frontend/src/scenes/events/EventElements.tsx"),t=e("./frontend/src/scenes/events/EventsTable.tsx");e.d(L,"a",function(){return t.a});var Me=e("./frontend/src/scenes/events/eventsTableLogic.ts")},"./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx":function(le,L,e){"use strict";e.d(L,"a",function(){return ne});var q=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),ee=e.n(q),t=e("./node_modules/core-js/modules/es.regexp.exec.js"),Me=e("./node_modules/core-js/modules/es.string.match.js"),N=e("./node_modules/react/index.js"),v=e.n(N),ie=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),He=e.n(ie),xe=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss"),Re=e.n(xe),ce={};ce.insert="head",ce.singleton=!1;var Ee=He()(Re.a,ce),Je=Re.a.locals||{},de=e("./node_modules/clsx/dist/clsx.m.js"),ge=e("./node_modules/kea/lib/index.esm.js"),R=e("./frontend/src/lib/components/LemonTable/index.ts"),he=e("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),h=e("./node_modules/@ant-design/icons/es/icons/CheckCircleFilled.js"),$=e("./frontend/src/lib/components/LemonButton/index.ts"),te=e("./node_modules/antd/es/input/index.js"),je=e("./node_modules/antd/es/button/index.js"),W=e("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts"),ye=e("./frontend/src/lib/utils.tsx"),Xe=e("./frontend/src/lib/components/LemonButton/More.tsx");function ne(Oe){var _e=Oe.pageKey,H=Oe.actionId,ae=Object(W.c)({actionId:H}),z=Object(ge.useValues)(ae),Ae=z.appUrlsKeyed,Be=z.suggestionsLoading,re=z.searchTerm,J=z.launchUrl,X=z.appUrls,Qe=z.editUrlIndex,F=Object(ge.useActions)(ae),Ke=F.addUrl,ue=F.removeUrl,be=F.setSearchTerm,oe=F.updateUrl,Ne=F.newUrl,Te=F.setEditUrlIndex,We=[{title:"URLs",dataIndex:"url",key:"url",render:function(Q,j){var G=Object(N.useState)(j.url),w=ee()(G,2),M=w[0],me=w[1],Ce=Object(N.useState)(""),pe=ee()(Ce,2),x=pe[0],Z=pe[1];Object(N.useEffect)(function(){return me(j.url)},[j]);var V=function(){if(Z(""),M===W.a&&ue(j.originalIndex),M.indexOf("*")>-1&&!M.match(/^(.*)\*[^\*]*\.[^\*]+\.[^\*]+$/)){Z("You can only wildcard subdomains. If you wildcard the domain or TLD, people might be able to gain access to your PostHog data.");return}if(!Object(ye.fb)(M)){Z("Please type a valid URL or domain.");return}if(X.indexOf(M)>-1&&X.indexOf(M,j.originalIndex)!==j.originalIndex&&X.indexOf(M,j.originalIndex+1)!==j.originalIndex){Z("This URL is already registered.");return}oe(j.originalIndex,M)};return j.type==="suggestion"||Q!==W.a&&Qe!==j.originalIndex?v.a.createElement("div",{className:Object(de.a)("authorized-url-col",j.type)},j.type==="authorized"&&v.a.createElement(h.a,{style:{marginRight:4}}),Q,j.type==="suggestion"&&v.a.createElement(he.a,null,"Suggestion")):v.a.createElement("div",null,v.a.createElement("div",{style:{display:"flex"}},v.a.createElement(te.a,{value:M,onChange:function(T){return me(T.target.value)},onPressEnter:V,autoFocus:!0,placeholder:"Enter a URL or wildcard subdomain (e.g. https://*.posthog.com)"}),v.a.createElement(je.a,{type:"primary",onClick:V},"Save")),x&&v.a.createElement("span",{className:"text-small text-danger"},x))}},{title:"",key:"actions",render:function(Q,j,G){return v.a.createElement("div",{className:"actions-col"},j.type==="suggestion"?v.a.createElement($.a,{type:"secondary",onClick:function(){return Ke(j.url)}},"Apply suggestion"):v.a.createElement(v.a.Fragment,null,v.a.createElement($.a,{type:"highlighted",href:J(j.url),className:"mr"},"Open with Toolbar"),v.a.createElement(Xe.a,{overlay:v.a.createElement(v.a.Fragment,null,v.a.createElement($.a,{fullWidth:!0,type:"stealth",onClick:function(){return Te(j.originalIndex)}},"Edit authorized URL"),v.a.createElement($.a,{fullWidth:!0,style:{color:"var(--danger)"},type:"stealth",onClick:function(){return ue(G)}},"Remove authorized URL"))})))}}];return v.a.createElement("div",null,v.a.createElement("div",{className:"flex-center mb"},v.a.createElement("div",{style:{flexGrow:1}},v.a.createElement(te.a.Search,{allowClear:!0,enterButton:!0,placeholder:"Search for authorized URLs",style:{maxWidth:480},value:re,onChange:function(Q){be(Q.target.value)},autoFocus:_e==="toolbar-launch"&&!Object(ye.X)()})),v.a.createElement($.a,{type:"primary",onClick:Ne},"Add",_e==="toolbar-launch"&&" authorized domain")),v.a.createElement(R.a,{className:"authorized-urls-table",columns:We,dataSource:Ae,emptyState:re?"There are no authorized URLs that match your search.":"There are no authorized URLs or domains. Add one to get started.",loading:Be}))}try{ne.displayName="AuthorizedUrlsTable",ne.__docgenInfo={description:"",displayName:"AuthorizedUrlsTable",props:{pageKey:{defaultValue:null,description:"",name:"pageKey",required:!1,type:{name:"string"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"]={docgenInfo:ne.__docgenInfo,name:"AuthorizedUrlsTable",path:"frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"})}catch(Oe){}},"./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts":function(le,L,e){"use strict";e.d(L,"b",function(){return ze}),e.d(L,"a",function(){return Ue}),e.d(L,"c",function(){return Fe});var q=e("./node_modules/core-js/modules/es.object.keys.js"),ee=e.n(q),t=e("./node_modules/core-js/modules/es.symbol.js"),Me=e.n(t),N=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),v=e.n(N),ie=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),He=e.n(ie),xe=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Re=e.n(xe),ce=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Ee=e.n(ce),Je=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),de=e.n(Je),ge=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),R=e.n(ge),he=e("./node_modules/@babel/runtime/regenerator/index.js"),h=e.n(he),$=e("./node_modules/core-js/modules/es.array.concat.js"),te=e.n($),je=e("./node_modules/core-js/modules/es.array.iterator.js"),W=e.n(je),ye=e("./node_modules/core-js/modules/es.object.to-string.js"),Xe=e.n(ye),ne=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Oe=e.n(ne),_e=e("./node_modules/core-js/modules/es.array.slice.js"),H=e.n(_e),ae=e("./node_modules/core-js/modules/es.array.map.js"),z=e.n(ae),Ae=e("./node_modules/core-js/modules/es.array.filter.js"),Be=e.n(Ae),re=e("./node_modules/core-js/modules/es.string.iterator.js"),J=e.n(re),X=e("./node_modules/core-js/modules/web.url.js"),Qe=e.n(X),F=e("./node_modules/core-js/modules/web.url-search-params.js"),Ke=e.n(F),ue=e("./node_modules/core-js/modules/es.regexp.to-string.js"),be=e.n(ue),oe=e("./node_modules/core-js/modules/es.array.includes.js"),Ne=e.n(oe),Te=e("./node_modules/core-js/modules/es.string.includes.js"),We=e.n(Te),Y=e("./node_modules/core-js/modules/es.object.assign.js"),Q=e.n(Y),j=e("./node_modules/core-js/modules/es.array.splice.js"),G=e.n(j),w=e("./node_modules/core-js/modules/es.regexp.exec.js"),M=e.n(w),me=e("./node_modules/core-js/modules/es.string.search.js"),Ce=e.n(me),pe=e("./node_modules/kea/lib/index.esm.js"),x=e("./frontend/src/lib/api.ts"),Z=e("./frontend/src/lib/utils.tsx"),V=e("./frontend/src/scenes/teamLogic.tsx"),ve=e("./frontend/src/lib/dayjs.ts"),T=e("./node_modules/fuse.js/dist/fuse.esm.js"),Pe=e("./node_modules/kea-router/lib/index.js"),Ze=e.n(Pe);function se(O,i){var s=Object.keys(O);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(O);i&&(l=l.filter(function(f){return Object.getOwnPropertyDescriptor(O,f).enumerable})),s.push.apply(s,l)}return s}function k(O){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?se(Object(s),!0).forEach(function(l){R()(O,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(s)):se(Object(s)).forEach(function(l){Object.defineProperty(O,l,Object.getOwnPropertyDescriptor(s,l))})}return O}function ze(O,i,s){var l=k(k({userIntent:s?void 0:i?"edit-action":"add-action"},i?{actionId:i}:{}),O?{appUrl:O}:{});return"/api/user/redirect_to_site/"+Object(Pe.encodeParams)(l,"?")}var Ue="https://",Fe=Object(pe.kea)({path:function(i){return["lib","components","AppEditorLink","appUrlsLogic",i]},key:function(i){return"".concat(i.pageKey).concat(i.actionId)||"global"},props:{},connect:{values:[V.a,["currentTeam","currentTeamId"]],actions:[V.a,["updateCurrentTeam"]]},actions:function(){return{setAppUrls:function(s){return{appUrls:s}},addUrl:function(s,l){return{url:s,launch:l}},newUrl:!0,removeUrl:function(s){return{index:s}},updateUrl:function(s,l){return{index:s,url:l}},launchAtUrl:function(s){return{url:s}},setSearchTerm:function(s){return{term:s}},setEditUrlIndex:function(s){return{originalIndex:s}}}},loaders:function(i){var s=i.values;return{suggestions:{__default:[],loadSuggestions:function(){var l=de()(h.a.mark(function y(){var I,C,P,B;return h.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return C={events:[{id:"$pageview",name:"$pageview",type:"events"}],breakdown:"$current_url",date_from:Object(ve.a)().subtract(3,"days").toISOString()},A.next=3,x.b.get("api/projects/".concat(s.currentTeamId,"/insights/trend/?").concat(Object(Z.zb)(C)));case 3:if(P=A.sent.result,!(P&&((I=P[0])===null||I===void 0?void 0:I.count)===0)){A.next=6;break}return A.abrupt("return",[]);case 6:return B=[],A.abrupt("return",(P||[]).filter(function(K){if(!K.breakdown_value)return!1;try{var Se=new URL(K.breakdown_value.toString()).hostname;return B.indexOf(Se)>-1||s.appUrls.filter(function(Ve){return Ve.indexOf(Se)>-1}).length>0?void 0:(B.push(Se),!0)}catch(Ve){return!1}}).map(function(K){return K.breakdown_value}).slice(0,20));case 8:case"end":return A.stop()}},y)}));function f(){return l.apply(this,arguments)}return f}()}}},events:function(i){var s=i.actions,l=i.values;return{afterMount:function(){s.loadSuggestions(),l.currentTeam&&s.setAppUrls(l.currentTeam.app_urls)}}},reducers:function(){return{appUrls:[[],{setAppUrls:function(s,l){var f=l.appUrls;return f},addUrl:function(s,l){var f=l.url;return s.concat([f])},newUrl:function(s){return s.includes(Ue)?s:[Ue].concat(s)},updateUrl:function(s,l){var f=l.index,y=l.url;return Object.assign(Ee()(s),R()({},f,y))},removeUrl:function(s,l){var f=l.index,y=Ee()(s);return y.splice(f,1),y}}],suggestions:[[],{addUrl:function(s,l){var f=l.url;return Ee()(s).filter(function(y){return f!==y})}}],searchTerm:["",{setSearchTerm:function(s,l){var f=l.term;return f}}],editUrlIndex:[null,{setEditUrlIndex:function(s,l){var f=l.originalIndex;return f},removeUrl:function(s,l){var f=l.index;return s&&f<s?s-1:f===s?null:s}}]}},listeners:function(i){var s,l=i.sharedListeners,f=i.values,y=i.actions;return s={addUrl:[l.saveAppUrls,function(){var I=de()(h.a.mark(function C(P){var B,fe;return h.a.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:B=P.url,fe=P.launch,fe&&y.launchAtUrl(B);case 2:case"end":return K.stop()}},C)}));return function(C){return I.apply(this,arguments)}}()],removeUrl:l.saveAppUrls,updateUrl:[l.saveAppUrls,function(){return y.setEditUrlIndex(null)}]},R()(s,V.a.actionTypes.loadCurrentTeamSuccess,function(){var I=de()(h.a.mark(function C(P){var B;return h.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:B=P.currentTeam,B&&y.setAppUrls(B.app_urls);case 2:case"end":return A.stop()}},C)}));return function(C){return I.apply(this,arguments)}}()),R()(s,"launchAtUrl",function(C){var P=C.url;window.location.href=f.launchUrl(P)}),s},sharedListeners:function(i){var s=i.values;return{saveAppUrls:function(){V.a.actions.updateCurrentTeam({app_urls:s.appUrls})}}},selectors:function(i){var s=i.props;return{appUrlsKeyed:[function(l){return[l.appUrls,l.suggestions,l.searchTerm]},function(l,f,y){var I=l.map(function(C,P){return{url:C,type:"authorized",originalIndex:P}}).concat(f.map(function(C,P){return{url:C,type:"suggestion",originalIndex:P}}));return y?new T.a(I,{keys:["url"],threshold:.3}).search(y).map(function(C){return C.item}):I}],launchUrl:[function(){return[]},function(){return function(l){return ze(l,s.actionId,!s.actionId)}}]}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss":function(le,L,e){var q=e("./node_modules/css-loader/dist/runtime/api.js");L=q(!1),L.push([le.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.authorized-urls-table .authorized-url-col{display:flex;align-items:center}.authorized-urls-table .authorized-url-col .lemon-tag{margin-left:6px}.authorized-urls-table .authorized-url-col.suggestion{color:#747ea1}.authorized-urls-table .authorized-url-col.authorized{color:var(--success)}.authorized-urls-table .actions-col{display:flex;align-items:center;justify-content:flex-end}",""]),le.exports=L}}]);
