"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[70163],{"./frontend/src/scenes/experiments/Experiments.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Experiments:()=>Experiments,scene:()=>scene});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.2.0_kea@3.1.5/node_modules/kea-router/lib/index.js"),hedgehogs=__webpack_require__("./frontend/src/lib/components/hedgehogs.tsx"),MemberSelect=__webpack_require__("./frontend/src/lib/components/MemberSelect.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),ProductIntroduction=__webpack_require__("./frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonDivider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDivider/index.ts"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),LemonTableLink=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),stringWithWBR=__webpack_require__("./frontend/src/lib/utils/stringWithWBR.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),experimentsLogic=__webpack_require__("./frontend/src/scenes/experiments/experimentsLogic.ts"),components=__webpack_require__("./frontend/src/scenes/experiments/ExperimentView/components.tsx"),posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.9.2_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),LemonSlider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSlider/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),holdoutsLogic=__webpack_require__("./frontend/src/scenes/experiments/holdoutsLogic.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function Holdouts(){let{holdouts,holdoutsLoading,holdout}=(0,index_esm.useValues)(holdoutsLogic.o),{createHoldout,deleteHoldout,setHoldout,updateHoldout}=(0,index_esm.useActions)(holdoutsLogic.o),[isHoldoutModalOpen,setIsHoldoutModalOpen]=(0,react.useState)(!1),[editingHoldout,setEditingHoldout]=(0,react.useState)(null),openEditModal=holdout=>{setEditingHoldout(holdout),setHoldout(holdout),setIsHoldoutModalOpen(!0)},closeModal=()=>{setIsHoldoutModalOpen(!1),setEditingHoldout(null)},columns=[{title:"Name",dataIndex:"name",key:"name",render:name=>(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:name})},{title:"Description",dataIndex:"description",key:"description"},{title:"Rollout Percentage",dataIndex:"filters",key:"rollout",render:filters=>{let percentage=filters?.[0]?.rollout_percentage||0;return(0,jsx_runtime.jsxs)("div",{children:[percentage," %"]})}},{title:"Actions",key:"actions",render:(_,record)=>(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{}),onClick:()=>openEditModal(record)}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),size:"xsmall",status:"danger",onClick:()=>{src.dn.open({title:"Delete this holdout?",content:(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Are you sure you want to delete the holdout ",(0,jsx_runtime.jsxs)("b",{children:['"',record.name,'"']}),"? This action cannot be undone."]}),primaryButton:{children:"Delete",type:"primary",status:"danger",onClick:()=>deleteHoldout(record.id),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})}})]})}];return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(src.fQ,{isOpen:isHoldoutModalOpen,onClose:closeModal,title:editingHoldout?"Edit holdout":"Add holdout",footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:closeModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{editingHoldout?updateHoldout(editingHoldout.id,holdout):createHoldout(),closeModal()},disabledReason:holdout.name?holdout.filters?.[0]?.rollout_percentage===void 0?"Rollout percentage is required":void 0:"Name is required",children:editingHoldout?"Update":"Save"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Name"}),(0,jsx_runtime.jsx)(src.DF,{value:holdout.name,onChange:name=>setHoldout({name}),placeholder:"e.g. 'Frontend holdout group 1'"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Description"}),(0,jsx_runtime.jsx)(src.DF,{value:holdout.description||"",onChange:description=>setHoldout({description})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:(0,jsx_runtime.jsx)("div",{children:"Specify the percentage population that should be included in this holdout group. This is stable across experiments."})})}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-1",children:["Roll out to"," ",(0,jsx_runtime.jsx)(LemonSlider.j,{value:holdout.filters?.[0]?.rollout_percentage||100,onChange:rollout_percentage=>setHoldout({filters:[{properties:[],rollout_percentage}]}),min:0,max:100,step:1,className:"ml-1.5 w-20"}),(0,jsx_runtime.jsx)(src.DF,{"data-attr":"rollout-percentage",type:"number",className:"ml-2 mr-1.5 max-w-30",value:holdout.filters?.[0]?.rollout_percentage||100,onChange:rollout_percentage=>setHoldout({filters:[{properties:[],rollout_percentage}]}),min:0,max:100,step:"any",suffix:(0,jsx_runtime.jsx)("span",{children:"%"})}),"of ",(0,jsx_runtime.jsx)("b",{children:"total users."})]})]})]})}),(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:(0,jsx_runtime.jsx)("div",{children:"Holdouts are stable groups of users excluded from experiment variations.They act as a baseline, helping you see how users behave without any changes applied. This lets you directly compare their behavior to those exposed to the experiment variations. Once a holdout is configured, you can apply it to an experiment during creation."})})}),(0,jsx_runtime.jsx)(src.g3,{emptyState:(0,jsx_runtime.jsx)("div",{className:"py-4 text-muted text-sm text-center",children:"You have not created any holdouts yet."}),loading:holdoutsLoading,dataSource:holdouts,columns:columns}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{setEditingHoldout(null),setHoldout({...holdoutsLogic.x}),setIsHoldoutModalOpen(!0)},"data-attr":"add-holdout",children:"New holdout"})]})}let scene={component:Experiments,logic:experimentsLogic.OK};function Experiments(){let{filteredExperiments,experimentsLoading,tab,searchTerm,shouldShowEmptyState,searchStatus,userFilter}=(0,index_esm.useValues)(experimentsLogic.OK),{setExperimentsTab,deleteExperiment,archiveExperiment,setSearchStatus,setSearchTerm,setUserFilter}=(0,index_esm.useActions)(experimentsLogic.OK),EXPERIMENTS_PRODUCT_DESCRIPTION="Experiments help you test changes to your product to see which changes will lead to optimal results. Automatic statistical calculations let you see if the results are valid or if they are likely just a chance occurrence.",getExperimentDuration=experiment=>experiment.end_date?(0,dayjs.Bv)(experiment.end_date).diff((0,dayjs.Bv)(experiment.start_date),"day"):experiment.start_date?(0,dayjs.Bv)().diff((0,dayjs.Bv)(experiment.start_date),"day"):void 0,columns=[{title:"Name",dataIndex:"name",className:"ph-no-capture",sticky:!0,width:"40%",render:function Render(_,experiment){return(0,jsx_runtime.jsx)(LemonTableLink.i,{to:experiment.id?urls.j.experiment(experiment.id):void 0,title:(0,stringWithWBR.Z)(experiment.name,17),description:experiment.description})}},(0,columnUtils.JB)(),(0,columnUtils.rw)(),(0,columnUtils.pD)("start_date","Started"),{title:"Duration",key:"duration",render:function Render(_,experiment){let duration=getExperimentDuration(experiment);return(0,jsx_runtime.jsx)("div",{children:void 0!==duration?`${duration} day${1!==duration?"s":""}`:"â€”"})},sorter:(a,b)=>{var _getExperimentDuratio,_getExperimentDuratio2;let durationA=null!==(_getExperimentDuratio=getExperimentDuration(a))&&void 0!==_getExperimentDuratio?_getExperimentDuratio:-1,durationB=null!==(_getExperimentDuratio2=getExperimentDuration(b))&&void 0!==_getExperimentDuratio2?_getExperimentDuratio2:-1;return durationA>durationB?1:-1},align:"right"},{title:"Status",key:"status",render:function Render(_,experiment){return(0,jsx_runtime.jsx)(components.Nj,{experiment:experiment})},align:"center",sorter:(a,b)=>{let statusA=(0,experimentsLogic.Ot)(a),statusB=(0,experimentsLogic.Ot)(b),score={draft:1,running:2,complete:3};return score[statusA]>score[statusB]?1:-1}},{width:0,render:function Render(_,experiment){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{to:urls.j.experiment(`${experiment.id}`),size:"small",fullWidth:!0,children:"View"}),!experiment.archived&&experiment?.end_date&&(0,dayjs.Bv)().isSameOrAfter((0,dayjs.Bv)(experiment.end_date),"day")&&(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>{src.dn.open({title:"Archive this experiment?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"This action will move the experiment to the archived tab. It can be restored at any time."}),primaryButton:{children:"Archive",type:"primary",onClick:()=>archiveExperiment(experiment.id),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},"data-attr":`experiment-${experiment.id}-dropdown-archive`,fullWidth:!0,children:"Archive experiment"}),(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(LemonButton.J,{status:"danger",onClick:()=>{src.dn.open({title:"Delete this experiment?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"This action cannot be undone. All experiment data will be permanently removed."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>deleteExperiment(experiment.id),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},"data-attr":`experiment-${experiment.id}-dropdown-remove`,fullWidth:!0,children:"Delete experiment"})]})})}}];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary","data-attr":"create-experiment",to:urls.j.experiment("new"),children:"New experiment"}),caption:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(Link.r,{"data-attr":"experiment-help",to:"https://posthog.com/docs/experiments/installation?utm_medium=in-product&utm_campaign=new-experiment",target:"_blank",children:[" ","Visit the guide"]})," ","to learn more."]}),tabbedPage:!0}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tab,onChange:newKey=>setExperimentsTab(newKey),tabs:[{key:types.F7.All,label:"All experiments"},{key:types.F7.Yours,label:"Your experiments"},{key:types.F7.Archived,label:"Archived experiments"},{key:types.F7.Holdouts,label:"Holdout groups"}]}),tab===types.F7.Holdouts?(0,jsx_runtime.jsx)(Holdouts,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[tab===types.F7.Archived?(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Experiments",productKey:types.Md.EXPERIMENTS,thingName:"archived experiment",description:EXPERIMENTS_PRODUCT_DESCRIPTION,docsURL:"https://posthog.com/docs/experiments",isEmpty:shouldShowEmptyState}):(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Experiments",productKey:types.Md.EXPERIMENTS,thingName:"experiment",description:EXPERIMENTS_PRODUCT_DESCRIPTION,docsURL:"https://posthog.com/docs/experiments",action:()=>lib.router.actions.push(urls.j.experiment("new")),isEmpty:shouldShowEmptyState,customHog:hedgehogs.ExperimentsHog}),!shouldShowEmptyState&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between mb-4 gap-2 flex-wrap",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search experiments",onChange:setSearchTerm,value:searchTerm}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)("b",{children:"Status"})}),(0,jsx_runtime.jsx)(src.Yv,{size:"small",onChange:status=>{status&&setSearchStatus(status)},options:[{label:"All",value:"all"},{label:"Draft",value:types.mN.Draft},{label:"Running",value:types.mN.Running},{label:"Complete",value:types.mN.Complete}],value:null!=searchStatus?searchStatus:"all",dropdownMatchSelectWidth:!1,dropdownMaxContentWidth:!0}),(0,jsx_runtime.jsx)("span",{className:"ml-1",children:(0,jsx_runtime.jsx)("b",{children:"Created by"})}),(0,jsx_runtime.jsx)(MemberSelect.a,{defaultLabel:"Any user",value:null!=userFilter?userFilter:null,onChange:user=>{var _user$uuid;return setUserFilter(null!==(_user$uuid=user?.uuid)&&void 0!==_user$uuid?_user$uuid:null)}})]})]}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:filteredExperiments,columns:columns,rowKey:"id",loading:experimentsLoading,defaultSorting:{columnKey:"created_at",order:-1},noSortingCancellation:!0,pagination:{pageSize:100},nouns:["experiment","experiments"],"data-attr":"experiment-table"})]})]})]})}}}]);