"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[97481,78229],{"../../products/llm_analytics/frontend/LLMAnalyticsPlaygroundScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMAnalyticsPlaygroundScene:()=>LLMAnalyticsPlaygroundScene,scene:()=>scene});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_posthog_icons__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.28.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../products/llm_analytics/frontend/llmAnalyticsPlaygroundLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let formatMs=ms=>null==ms?"-":ms<1e3?`${ms.toFixed(0)} ms`:`${(ms/1e3).toFixed(2)} s`,scene={component:LLMAnalyticsPlaygroundScene,logic:_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s};function LLMAnalyticsPlaygroundScene(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(kea__WEBPACK_IMPORTED_MODULE_0__.BindLogic,{logic:_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s,props:{key:"llm-analytics-playground-scene"},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(PlaygroundLayout,{})})}function PlaygroundLayout(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex flex-col min-h-[calc(100vh-120px)] relative",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex flex-col border rounded overflow-hidden flex-1",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(ConversationPanel,{})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(ComparisonTablePanel,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(StickyActionBar,{})]})}function ConversationPanel(){let{messages}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),[expandTextAreas,setExpandTextAreas]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),messagesStartRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),messagesEndRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex-1 p-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{ref:messagesStartRef,"data-attr":"messages-start"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("h3",{className:"text-lg font-semibold",children:"Messages"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.f4,{bordered:!0,checked:expandTextAreas,onChange:setExpandTextAreas,label:"Expand text areas",size:"small",tooltip:"If your messages exceed the text box you can toggle this to see more"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"space-y-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(ToolsDisplay,{expandTextAreas:expandTextAreas}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(SystemMessageDisplay,{expandTextAreas:expandTextAreas}),messages.map((message,index)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(MessageDisplay,{index:index,message:message,expandTextAreas:expandTextAreas},index)),0===messages.length&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-muted",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconMessage,{className:"text-3xl mb-2"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("p",{children:"Add messages to start the conversation."})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{ref:messagesEndRef,"data-attr":"messages-end"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(OutputSection,{})]})}function ToolsDisplay(_ref){let{expandTextAreas}=_ref,{tools}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),{setTools}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),[showEditModal,setShowEditModal]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[localToolsJson,setLocalToolsJson]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null);if(!tools)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{});let toolsJsonString=null!=localToolsJson?localToolsJson:JSON.stringify(tools,null,2),handleToolsChange=value=>{try{let parsedTools=JSON.parse(value);setTools(parsedTools),setLocalToolsJson(null)}finally{setLocalToolsJson(value)}};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"border rounded p-3 relative group bg-white dark:bg-[var(--bg-surface-primary)] border-l-4 border-l-[var(--color-orange-500)]",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{size:"small",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconPencil,{}),tooltip:"Edit tools",noPadding:!0,onClick:()=>setShowEditModal(!0)})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded",children:"Tools"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__._V,{className:"text-sm w-full font-mono",placeholder:"Tools available to the AI assistant (JSON format)...",value:toolsJsonString,onChange:handleToolsChange,minRows:2,maxRows:expandTextAreas?void 0:6})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.fQ,{isOpen:showEditModal,onClose:()=>setShowEditModal(!1),title:"Edit Tools",width:"90vw",maxWidth:"1200px",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"space-y-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"Tools (JSON)"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__._V,{className:"text-sm w-full font-mono",placeholder:"Tools available to the AI assistant (JSON format)...",value:toolsJsonString,onChange:handleToolsChange,minRows:12})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex justify-end gap-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",onClick:()=>setShowEditModal(!1),children:"Close"})})]})})]})}function SystemMessageDisplay(_ref2){let{expandTextAreas}=_ref2,{systemPrompt}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),{setSystemPrompt}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),[showEditModal,setShowEditModal]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"border rounded p-3 relative group bg-white dark:bg-[var(--color-bg-surface-primary)] border-l-4 border-l-[var(--color-purple-500)]",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{size:"small",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconPencil,{}),tooltip:"Edit system prompt",noPadding:!0,onClick:()=>setShowEditModal(!0)})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded",children:"System"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__._V,{className:"text-sm w-full",placeholder:"System instructions for the AI assistant...",value:systemPrompt,onChange:setSystemPrompt,minRows:2,maxRows:expandTextAreas?void 0:4})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.fQ,{isOpen:showEditModal,onClose:()=>setShowEditModal(!1),title:"Edit System Prompt",width:"90vw",maxWidth:"1200px",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"space-y-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"System Instructions"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__._V,{className:"text-sm w-full",placeholder:"System instructions for the AI assistant...",value:systemPrompt,onChange:setSystemPrompt,minRows:8})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex justify-end gap-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",onClick:()=>setShowEditModal(!1),children:"Close"})})]})})]})}function MessageDisplay(_ref3){let{message,index,expandTextAreas}=_ref3,{updateMessage,deleteMessage}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),[showEditModal,setShowEditModal]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),isLongMessage=message.content.length>300,handleRoleChange=newRole=>{updateMessage(index,{role:newRole})},handleContentChange=newContent=>{updateMessage(index,{content:newContent})},roleOptions=[{label:"User",value:"user"},{label:"Assistant",value:"assistant"},{label:"System",value:"system"}];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:`border rounded p-3 relative group bg-white dark:bg-[var(--color-bg-surface-primary)] hover:shadow-sm transition-shadow ${(role=>{switch(role){case"user":return"border-l-4 border-l-[var(--color-blue-500)]";case"assistant":return"border-l-4 border-l-[var(--color-green-500)]";case"system":return"border-l-4 border-l-[var(--color-purple-500)]";default:return""}})(message.role)}`,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{size:"small",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconPencil,{}),tooltip:"Edit in large modal",noPadding:!0,onClick:()=>setShowEditModal(!0)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{size:"small",status:"danger",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconTrash,{}),tooltip:"Delete message",noPadding:!0,onClick:()=>deleteMessage(index)})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Yv,{size:"small",options:roleOptions,value:message.role,onChange:handleRoleChange,dropdownMatchSelectWidth:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__._V,{className:"text-sm w-full",placeholder:`Enter ${message.role} message here...`,value:message.content,onChange:handleContentChange,minRows:2,maxRows:expandTextAreas?void 0:isLongMessage?2:4})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.fQ,{isOpen:showEditModal,onClose:()=>setShowEditModal(!1),title:"Edit Message",width:"max(44vw)",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"space-y-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"Role"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Yv,{options:roleOptions,value:message.role,onChange:handleRoleChange,dropdownMatchSelectWidth:!1})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"Content"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__._V,{className:"text-sm w-full",placeholder:`Enter ${message.role} message here...`,value:message.content,onChange:handleContentChange,minRows:12})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex justify-end gap-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",onClick:()=>setShowEditModal(!1),children:"Close"})})]})})]})}function OutputSection(){let{submitting,currentResponse,lastRunDetails,responseHasError}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),{addResponseToHistory,addCurrentRunToComparison}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"p-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("h3",{className:"text-lg font-semibold",children:"AI Response"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex gap-2",children:[!submitting&&currentResponse&&currentResponse.trim()&&!responseHasError&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",size:"small",onClick:()=>addResponseToHistory(currentResponse),children:"Add to Chat History"}),!submitting&&lastRunDetails&&!responseHasError&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",size:"small",onClick:addCurrentRunToComparison,tooltip:"Add this run to comparison table",children:"Add to Compare"})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:`border rounded p-4 min-h-32 ${responseHasError?"bg-red-50 dark:bg-red-900/20 border-red-300 dark:border-red-800":"bg-bg-light dark:bg-[var(--color-bg-surface-primary)]"}`,children:[submitting&&(null===currentResponse||""===currentResponse)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.yW,{active:!0,className:"my-2"}),null!==currentResponse?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("pre",{className:`whitespace-pre-wrap text-sm break-words ${responseHasError?"text-red-800 dark:text-red-200":""}`,children:[currentResponse,submitting&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"text-muted italic",children:" (streaming...)"})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex items-center justify-center h-24 text-muted",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("p",{children:"AI response will appear here after running your prompt"})})]})]})}function ConfigurationPanel(){let{maxTokens,thinking,reasoningLevel,model,modelOptions,modelOptionsLoading}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),{setMaxTokens,setThinking,setReasoningLevel,setModel}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),options=Array.isArray(modelOptions)?modelOptions:[];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"space-y-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"Model"}),modelOptionsLoading&&!options.length?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.yW,{className:"h-10"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Yv,{className:"w-full",placeholder:"Select model",value:model,onChange:value=>setModel(value),options:options.map(option=>({label:`${option.name} (${option.provider})`,value:option.id,tooltip:option.description||`Provider: ${option.provider}`})),loading:modelOptionsLoading,disabled:modelOptionsLoading||0===options.length}),0===options.length&&!modelOptionsLoading&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("p",{className:"text-xs text-danger mt-1",children:"No models available. Check proxy status."})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"Max tokens (optional)"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.DF,{type:"number",value:null!=maxTokens?maxTokens:void 0,onChange:val=>setMaxTokens(null!=val?val:null),min:1,max:16384,step:64,placeholder:"Leave empty for model default"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"text-xs text-muted mt-1",children:"Leave empty to use model's default max tokens"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("input",{id:"thinkingToggle",type:"checkbox",className:"rounded text-primary focus:ring-primary",checked:thinking,onChange:e=>{setThinking(e.target.checked)}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("label",{htmlFor:"thinkingToggle",className:"text-sm font-medium",children:"Enable thinking/reasoning stream (if supported)"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"Reasoning level (optional)"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Yv,{className:"w-full",placeholder:"None",value:reasoningLevel,onChange:value=>setReasoningLevel(null!=value?value:null),options:[{label:"None",value:null},{label:"Minimal",value:"minimal"},{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"}],dropdownMatchSelectWidth:!1}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"text-xs text-muted mt-1",children:"If set and supported by the model, enables enhanced reasoning."})]})]})}function ComparisonTablePanel(){let{comparisonItems}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),{clearComparison}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),columns=[{title:"Model",dataIndex:"model",render:model=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.oe,{children:"string"==typeof model&&model||"-"}),sorter:(a,b)=>a.model.localeCompare(b.model)},{title:"Response",dataIndex:"response",render:response=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"max-h-40 overflow-y-auto whitespace-pre-wrap text-xs break-words p-1 border rounded bg-bg-light dark:bg-[var(--color-bg-surface-primary)]",children:"string"==typeof response?response:"-"}),width:"40%"},{title:"TTFT",dataIndex:"ttftMs",render:ttftMs=>formatMs(ttftMs),sorter:(a,b)=>{var _a$ttftMs,_b$ttftMs;return(null!==(_a$ttftMs=a.ttftMs)&&void 0!==_a$ttftMs?_a$ttftMs:1/0)-(null!==(_b$ttftMs=b.ttftMs)&&void 0!==_b$ttftMs?_b$ttftMs:1/0)},align:"right",tooltip:"Time To First Token"},{title:"Latency",dataIndex:"latencyMs",render:latencyMs=>formatMs(latencyMs),sorter:(a,b)=>{var _a$latencyMs,_b$latencyMs;return(null!==(_a$latencyMs=a.latencyMs)&&void 0!==_a$latencyMs?_a$latencyMs:1/0)-(null!==(_b$latencyMs=b.latencyMs)&&void 0!==_b$latencyMs?_b$latencyMs:1/0)},align:"right",tooltip:"Total Request Latency"}];return 0===comparisonItems.length?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"border rounded p-4 min-h-0 flex flex-col",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex justify-between items-center mb-4 shrink-0",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("h3",{className:"text-lg font-semibold",children:"Comparison"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",status:"danger",size:"small",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconTrash,{}),onClick:clearComparison,tooltip:"Clear all comparison items",children:"Clear All"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.g3,{dataSource:comparisonItems,columns:columns,rowKey:"id",loading:!1,embedded:!0})})]})}function StickyActionBar(){let runDisabledReason;let{messages,submitting,model,maxTokens,reasoningLevel}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),{addMessage,clearConversation,submitPrompt}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(_llmAnalyticsPlaygroundLogic__WEBPACK_IMPORTED_MODULE_5__.s),[showConfigModal,setShowConfigModal]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),scrollToBottom=()=>{let element=document.querySelector('[data-attr="messages-end"]');element?.scrollIntoView({behavior:"smooth"})};return 0===messages.length&&(runDisabledReason="Add messages to start the conversation"),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"sticky bottom-0 bg-bg-light dark:bg-[var(--color-bg-surface-primary)] border-t border-border z-10 ml-[calc(var(--scene-padding)*-1)] mr-[calc(var(--scene-padding)*-1)] mb-[calc(var(--scene-padding-bottom)*-1)]",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconPlus,{}),onClick:()=>{addMessage(),scrollToBottom()},disabled:submitting,children:"Add Message"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",status:"danger",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconTrash,{}),onClick:clearConversation,disabled:submitting||0===messages.length,tooltip:"Clear all messages",children:"Clear All"}),messages.length>3&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"border-l border-border mx-2 h-6"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{size:"small",type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_4__.Cz,{}),onClick:()=>{let element=document.querySelector('[data-attr="llm-analytics-tabs"]');element?.scrollIntoView({behavior:"smooth"})},tooltip:"Jump to top"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{size:"small",type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_4__.BD,{}),onClick:scrollToBottom,tooltip:"Jump to bottom"})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex items-center gap-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted bg-bg-dark dark:bg-bg-light px-2 py-1 rounded",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"font-medium",children:model||"No model"}),maxTokens&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{children:"•"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("span",{children:["Max:",maxTokens]})]}),reasoningLevel&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{children:"•"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("span",{children:["Reasoning:",reasoningLevel]})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconGear,{}),onClick:()=>setShowConfigModal(!0),tooltip:"Model settings",size:"small",children:"Settings"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"primary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconPlay,{}),onClick:submitPrompt,loading:submitting,disabledReason:submitting?"Generating...":runDisabledReason,children:"Run"})]})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.fQ,{isOpen:showConfigModal,onClose:()=>setShowConfigModal(!1),title:"Model Configuration",width:"large",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(ConfigurationPanel,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex justify-end gap-2 mt-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_3__.Jp,{type:"secondary",onClick:()=>setShowConfigModal(!1),children:"Close"})})]})]})}},"../../products/llm_analytics/frontend/LLMAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMAnalyticsScene:()=>LLMAnalyticsScene,scene:()=>scene});var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.28.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),QueryCard=__webpack_require__("../../frontend/src/lib/components/Cards/InsightCard/QueryCard.tsx"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),PropertyFilters=__webpack_require__("../../frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),TestAccountFiltersSwitch=__webpack_require__("../../frontend/src/lib/components/TestAccountFiltersSwitch.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),dataNodeCollectionLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeCollectionLogic.ts"),DataTable=__webpack_require__("../../frontend/src/queries/nodes/DataTable/DataTable.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),utils=__webpack_require__("../../frontend/src/queries/utils.ts"),ConversationMessagesDisplay=__webpack_require__("../../products/llm_analytics/frontend/ConversationDisplay/ConversationMessagesDisplay.tsx"),LLMAnalyticsPlaygroundScene=__webpack_require__("../../products/llm_analytics/frontend/LLMAnalyticsPlaygroundScene.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),llmAnalyticsLogic=__webpack_require__("../../products/llm_analytics/frontend/llmAnalyticsLogic.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let LastRefreshText=()=>{let{newestRefreshed}=(0,index_esm.useValues)(llmAnalyticsLogic.B);return newestRefreshed?(0,jsx_runtime.jsxs)("span",{children:["Last updated ",(0,dayjs.Bv)(newestRefreshed).fromNow()]}):(0,jsx_runtime.jsx)("span",{children:"Refresh"})};function LLMAnalyticsReloadAction(){let{isRefreshing}=(0,index_esm.useValues)(llmAnalyticsLogic.B),{refreshAllDashboardItems}=(0,index_esm.useActions)(llmAnalyticsLogic.B);return(0,jsx_runtime.jsx)("div",{className:"relative",children:(0,jsx_runtime.jsx)(src.Jp,{onClick:refreshAllDashboardItems,type:"secondary",icon:isRefreshing?(0,jsx_runtime.jsx)(Spinner.$,{textColored:!0}):(0,jsx_runtime.jsx)(icons.tr,{}),size:"small",disabledReason:isRefreshing?"Refreshing...":void 0,children:(0,jsx_runtime.jsx)("span",{className:"dashboard-items-action-refresh-text",children:isRefreshing?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Refreshing..."}):(0,jsx_runtime.jsx)(LastRefreshText,{})})})})}var TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),frontend_utils=__webpack_require__("../../products/llm_analytics/frontend/utils.ts");function LLMAnalyticsTraces(){let{setDates,setShouldFilterTestAccounts,setPropertyFilters,setTracesQuery}=(0,index_esm.useActions)(llmAnalyticsLogic.B),{tracesQuery}=(0,index_esm.useValues)(llmAnalyticsLogic.B);return(0,jsx_runtime.jsx)(DataTable.w,{query:tracesQuery,setQuery:query=>{if(!(0,utils.zO)(query.source))throw Error("Invalid query");setDates(query.source.dateRange?.date_from||null,query.source.dateRange?.date_to||null),setShouldFilterTestAccounts(query.source.filterTestAccounts||!1),setPropertyFilters(query.source.properties||[]),setTracesQuery(query)},context:{emptyStateHeading:"There were no traces in this period",emptyStateDetail:"Try changing the date range or filters.",columns:{id:{title:"ID",render:IDColumn},inputState:{title:"Input message",render:InputMessageColumn},outputState:{title:"Output message",render:OutputMessageColumn},timestamp:{title:"Time",render:TimestampColumn},traceName:{title:"Trace Name",render:TraceNameColumn},person:{title:"Person"},totalLatency:{title:"Latency",render:LatencyColumn},usage:{title:"Token Usage",render:UsageColumn},totalCost:{title:"Total Cost",render:CostColumn}}},uniqueKey:"llm-analytics-traces"})}let IDColumn=_ref=>{let{record}=_ref;return(0,jsx_runtime.jsx)("strong",{children:(0,jsx_runtime.jsx)(Tooltip.u,{title:record.id,children:(0,jsx_runtime.jsxs)(Link.r,{className:"ph-no-capture",to:urls.j.llmAnalyticsTrace(record.id,{timestamp:(0,frontend_utils.sl)(record.createdAt)}),children:[record.id.slice(0,4),"...",record.id.slice(-4)]})})})},TraceNameColumn=_ref2=>{let{record}=_ref2;return(0,jsx_runtime.jsx)("strong",{children:(0,jsx_runtime.jsx)(Link.r,{className:"ph-no-capture",to:urls.j.llmAnalyticsTrace(record.id,{timestamp:(0,frontend_utils.sl)(record.createdAt)}),children:record.traceName||"–"})})},TimestampColumn=_ref3=>{let{record}=_ref3;return(0,jsx_runtime.jsx)(TZLabel.w,{time:record.createdAt})};TimestampColumn.displayName="TimestampColumn";let LatencyColumn=_ref4=>{let{record}=_ref4;return"number"==typeof record.totalLatency?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,frontend_utils.DB)(record.totalLatency,!0)}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})};LatencyColumn.displayName="LatencyColumn";let UsageColumn=_ref5=>{let{record}=_ref5,usage=(0,frontend_utils.Pz)(record);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:usage||"–"})};UsageColumn.displayName="UsageColumn";let CostColumn=_ref6=>{let{record}=_ref6;return"number"==typeof record.totalCost?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,frontend_utils.K7)(record.totalCost)}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})};CostColumn.displayName="CostColumn";let InputMessageColumn=_ref7=>{let{record}=_ref7,inputNormalized=(0,frontend_utils.VL)(record.inputState?.messages,"user");return inputNormalized.length?(0,jsx_runtime.jsx)(ConversationMessagesDisplay.qb,{message:inputNormalized.at(-1),isOutput:!1,minimal:!0}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})};InputMessageColumn.displayName="InputMessageColumn";let OutputMessageColumn=_ref8=>{let{record}=_ref8,errorEventFound=!!Array.isArray(record.events)&&record.events.find(e=>e.properties?.$ai_error||e.properties?.$ai_is_error);if(errorEventFound)return(0,jsx_runtime.jsx)(src.oe,{type:"danger",className:"font-mono max-w-50 truncate",children:errorEventFound.properties?.$ai_error||"Unknown error"});let outputNormalized=(0,frontend_utils.VL)(record.outputState?.messages,"assistant");return outputNormalized.length?(0,jsx_runtime.jsx)(ConversationMessagesDisplay.qb,{message:outputNormalized.at(-1),isOutput:!0,minimal:!0}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})};OutputMessageColumn.displayName="OutputMessageColumn";var LLMAnalyticsUsers=__webpack_require__("../../products/llm_analytics/frontend/LLMAnalyticsUsers.tsx");let scene={component:LLMAnalyticsScene},Filters=()=>{let{dashboardDateFilter,dateFilter,shouldFilterTestAccounts,generationsQuery,propertyFilters,activeTab}=(0,index_esm.useValues)(llmAnalyticsLogic.B),{setDates,setShouldFilterTestAccounts,setPropertyFilters}=(0,index_esm.useActions)(llmAnalyticsLogic.B),dateFrom="dashboard"===activeTab?dashboardDateFilter.dateFrom:dateFilter.dateFrom,dateTo="dashboard"===activeTab?dashboardDateFilter.dateTo:dateFilter.dateTo;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-4 gap-y-2 items-center flex-wrap py-4 -mt-4 mb-4 border-b",children:[(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:dateFrom,dateTo:dateTo,onChange:setDates}),(0,jsx_runtime.jsx)(PropertyFilters.t,{propertyFilters:propertyFilters,taxonomicGroupTypes:generationsQuery.showPropertyFilter,onChange:setPropertyFilters,pageKey:"llm-analytics"}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:shouldFilterTestAccounts,onChange:setShouldFilterTestAccounts}),(0,jsx_runtime.jsx)(LLMAnalyticsReloadAction,{})]})},Tiles=()=>{let{tiles}=(0,index_esm.useValues)(llmAnalyticsLogic.B);return(0,jsx_runtime.jsx)("div",{className:"mt-2 grid grid-cols-1 @xl/dashboard:grid-cols-2 @4xl/dashboard:grid-cols-6 gap-4",children:tiles.map((_ref,i)=>{let{title,description,query,context}=_ref;return(0,jsx_runtime.jsx)(QueryCard.w,{title:title,description:description,query:{kind:schema_general.OH.InsightVizNode,source:query},context:context,className:(0,clsx_m.default)("h-96",i<3||i>=5?"@4xl/dashboard:col-span-2":"@4xl/dashboard:col-span-3")},i)})})},IngestionStatusCheck=()=>(0,jsx_runtime.jsxs)(src.Vp,{type:"warning",className:"mt-2",children:[(0,jsx_runtime.jsx)("p",{children:(0,jsx_runtime.jsx)("strong",{children:"No LLM generation events have been detected!"})}),(0,jsx_runtime.jsxs)("p",{children:["To use the LLM Analytics product, please"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/llm-analytics/installation",children:"instrument your LLM calls with the PostHog SDK"})," ","(otherwise it'll be a little empty!)"]})]});function LLMAnalyticsDashboard(){return(0,jsx_runtime.jsxs)("div",{className:"@container/dashboard",children:[(0,jsx_runtime.jsx)(Filters,{}),(0,jsx_runtime.jsx)(Tiles,{})]})}function LLMAnalyticsGenerations(){let{setDates,setShouldFilterTestAccounts,setPropertyFilters,setGenerationsQuery,setGenerationsColumns}=(0,index_esm.useActions)(llmAnalyticsLogic.B),{generationsQuery}=(0,index_esm.useValues)(llmAnalyticsLogic.B);return(0,jsx_runtime.jsx)(DataTable.w,{query:generationsQuery,setQuery:query=>{if(!(0,utils.rz)(query.source))throw Error("Invalid query");setDates(query.source.after||null,query.source.before||null),setShouldFilterTestAccounts(query.source.filterTestAccounts||!1),setPropertyFilters(query.source.properties||[]),query.source.select&&setGenerationsColumns(query.source.select),setGenerationsQuery(query)},context:{emptyStateHeading:"There were no generations in this period",emptyStateDetail:"Try changing the date range or filters.",columns:{uuid:{title:"ID",render:_ref2=>{let{record,value}=_ref2,traceId=record[1];if(!value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let visualValue=value.slice(0,4)+"..."+value.slice(-4);return traceId?(0,jsx_runtime.jsx)("strong",{children:(0,jsx_runtime.jsx)(Tooltip.u,{title:value,children:(0,jsx_runtime.jsx)(src.rU,{to:`/llm-analytics/traces/${traceId}?event=${value}`,children:visualValue})})}):(0,jsx_runtime.jsx)("strong",{children:visualValue})}},"properties.$ai_input[-1]":{title:"Input",render:_ref3=>{let inputNormalized,{value}=_ref3;if("string"==typeof value)try{inputNormalized=(0,frontend_utils.VL)(JSON.parse(value),"user")}catch(e){console.warn("Error parsing properties.$ai_input[-1] as JSON",e)}return inputNormalized?.length?(0,jsx_runtime.jsx)(ConversationMessagesDisplay.qb,{message:inputNormalized.at(-1),isOutput:!1,minimal:!0}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})}},"properties.$ai_output_choices":{title:"Output",render:_ref4=>{let outputNormalized,{value}=_ref4;if("string"==typeof value)try{outputNormalized=(0,frontend_utils.VL)(JSON.parse(value),"assistant")}catch(e){console.warn("Error parsing properties.$ai_output_choices as JSON",e)}return outputNormalized?.length?(0,jsx_runtime.jsx)("div",{children:outputNormalized.map((message,index)=>(0,jsx_runtime.jsx)(ConversationMessagesDisplay.qb,{message:message,isOutput:!0,minimal:!0},index))}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"–"})}},"properties.$ai_trace_id":{title:"Trace ID",render:_ref5=>{let{value}=_ref5;if(!value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let visualValue=value.slice(0,4)+"..."+value.slice(-4);return(0,jsx_runtime.jsx)(Tooltip.u,{title:value,children:(0,jsx_runtime.jsx)(src.rU,{to:`/llm-analytics/traces/${value}`,children:visualValue})})}}}},uniqueKey:"llm-analytics-generations"})}function LLMAnalyticsNoEvents(){return(0,jsx_runtime.jsx)("div",{className:"w-full flex flex-col items-center justify-center",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center justify-center max-w-md w-full",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconArchive,{className:"text-5xl mb-2 text-muted-alt"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl leading-tight",children:"We haven't detected any LLM generations yet"}),(0,jsx_runtime.jsxs)("p",{className:"text-sm text-center text-balance",children:["To use the LLM Analytics product, please"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/llm-analytics/installation",children:"instrument your LLM calls with the PostHog SDK"})," "]})]})})}function LLMAnalyticsScene(){let{activeTab,hasSentAiGenerationEvent,hasSentAiGenerationEventLoading}=(0,index_esm.useValues)(llmAnalyticsLogic.B),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{searchParams}=(0,index_esm.useValues)(lib.router),tabs=[{key:"dashboard",label:"Dashboard",content:(0,jsx_runtime.jsx)(LLMAnalyticsDashboard,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsDashboard(),searchParams).url},{key:"traces",label:"Traces",content:hasSentAiGenerationEvent?(0,jsx_runtime.jsx)(LLMAnalyticsTraces,{}):(0,jsx_runtime.jsx)(LLMAnalyticsNoEvents,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsTraces(),searchParams).url},{key:"generations",label:"Generations",content:hasSentAiGenerationEvent?(0,jsx_runtime.jsx)(LLMAnalyticsGenerations,{}):(0,jsx_runtime.jsx)(LLMAnalyticsNoEvents,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsGenerations(),searchParams).url},{key:"users",label:"Users",content:hasSentAiGenerationEvent?(0,jsx_runtime.jsx)(LLMAnalyticsUsers.LLMAnalyticsUsers,{}):(0,jsx_runtime.jsx)(LLMAnalyticsNoEvents,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsUsers(),searchParams).url}];return featureFlags[constants.y8.LLM_OBSERVABILITY_PLAYGROUND]&&tabs.push({key:"playground",label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Playground"," ",(0,jsx_runtime.jsx)(src.oe,{className:"ml-1",type:"warning",children:"Beta"})]}),content:(0,jsx_runtime.jsx)(LLMAnalyticsPlaygroundScene.LLMAnalyticsPlaygroundScene,{}),link:(0,lib.combineUrl)(urls.j.llmAnalyticsPlayground(),searchParams).url}),(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:dataNodeCollectionLogic.y,props:{key:llmAnalyticsLogic.S},children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsx)("div",{className:"flex gap-2",children:(0,jsx_runtime.jsx)(src.Jp,{to:"https://posthog.com/docs/llm-analytics/installation",type:"secondary",targetBlank:!0,children:"Documentation"})})}),!hasSentAiGenerationEventLoading&&!hasSentAiGenerationEvent&&(0,jsx_runtime.jsx)(IngestionStatusCheck,{}),(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,"data-attr":"llm-analytics-tabs",tabs:tabs})]})}}}]);