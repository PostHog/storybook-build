(window.webpackJsonp=window.webpackJsonp||[]).push([[311],{"./frontend/src/scenes/instance/Licenses/index.tsx":function(U,E,n){"use strict";n.r(E),n.d(E,"scene",function(){return W}),n.d(E,"Licenses",function(){return P});var x=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),R=n.n(x),D=n("./frontend/src/lib/components/LemonButton/More.tsx"),m=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/form/index.js"),M=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/alert/index.js"),v=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/input/index.js"),L=n("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/button/index.js"),u=n("./frontend/src/scenes/instance/Licenses/licenseLogic.ts"),j=n("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),g=n("./frontend/src/lib/utils.tsx"),p=n("./frontend/src/lib/components/PageHeader.tsx"),C=n("./frontend/src/lib/components/LemonTable/index.ts"),h=n("./frontend/src/lib/components/LemonButton/index.ts"),A=n("./frontend/src/scenes/organizationLogic.tsx"),f=n("./frontend/src/lib/dayjs.ts"),B=n("./frontend/src/lib/components/LemonModal/index.ts"),T=n("./frontend/src/scenes/billing/billingLogic.ts"),y=n("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),z=n.n(y),I=n("./frontend/src/scenes/urls.ts"),e=n("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js"),F=n.n(e);const W={component:P,logic:u.b};function K(i){let{licenses:O,isOpen:b,onCancel:c,onOk:a}=i;const{currentOrganization:r}=Object(j.useValues)(A.a),{billingVersion:_}=Object(j.useValues)(T.a),d=O.filter(t=>Object(f.a)().isBefore(t.valid_until)).length>1,l=((r==null?void 0:r.teams)||[]).filter(t=>!t.is_demo).sort((t,o)=>t.id-o.id),s=!d&&l.slice(1,l.length).length>0;return Object(x.useEffect)(()=>{_==="v2"&&y.router.actions.push(I.a.organizationBilling())},[_]),Object(e.jsx)(B.a,{isOpen:b,onClose:c,title:"Are you sure you want to deactivate your license?",footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(h.a,{form:"new-dashboard-form",type:"secondary","data-attr":"deactivate-license-cancel",className:"mr-2",onClick:c,children:"Cancel"}),Object(e.jsx)(h.a,{"data-attr":"deactivate-license-proceed",type:"primary",status:"danger",onClick:a,children:s?Object(e.jsxs)(e.Fragment,{children:["Deactivate license & delete ",l.length," project(s)"]}):"Deactivate license"})]}),children:Object(e.jsxs)("ul",{className:"pl-3 list-disc",children:[d?Object(e.jsxs)("li",{children:["You will ",Object(e.jsx)("strong",{children:"keep"})," all premium features available with your other valid license."]}):Object(e.jsxs)("li",{children:["You will ",Object(e.jsx)("strong",{children:"IMMEDIATELY"})," lose access to all premium features such as"," ",Object(e.jsx)("strong",{children:"multiple projects"}),", ",Object(e.jsx)("strong",{children:"single sign on"}),","," ",Object(e.jsx)("strong",{children:"group analytics"}),", ",Object(e.jsx)("strong",{children:"multivariate feature flags"})," and many more."]}),s&&Object(e.jsxs)("li",{children:["We will ",Object(e.jsx)("strong",{className:"text-danger",children:"DELETE"})," the following projects:",Object(e.jsx)("ul",{className:"pl-6 list-disc mb-2",children:l.map(t=>Object(e.jsx)("li",{children:Object(e.jsx)("strong",{children:t.name})},t.id))}),"To keep one of these projects instead, remove all other projects first."]}),Object(e.jsx)("li",{children:"You will immediately be billed for usage in the current period, if any."})]})})}function P(){const[i]=m.a.useForm(),{licenses:O,licensesLoading:b,error:c,showConfirmCancel:a}=Object(j.useValues)(u.b),{createLicense:r,deleteLicense:_,setShowConfirmCancel:d}=Object(j.useActions)(u.b),l=[{title:"Active",render:function(t,o){return Object(u.a)(o)?"expired":"active"}},{title:"Valid until",render:function(t,o){return Object(g.O)(o.valid_until)}},{title:"Plan",dataIndex:"plan"},{title:"License added on",render:function(t,o){return Object(g.O)(o.created_at)}},{width:0,render:function(t,o){return Object(f.a)().isAfter(o.valid_until)?null:Object(e.jsx)(D.a,{overlay:Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(h.a,{status:"danger",onClick:()=>d(o),fullWidth:!0,children:"Deactivate license"})})})}}];return Object(e.jsxs)("div",{children:[Object(e.jsx)(K,{licenses:O,isOpen:!!a,onCancel:()=>d(null),onOk:()=>a?_(a):null}),Object(e.jsx)(p.a,{title:"Licenses",caption:Object(e.jsxs)(e.Fragment,{children:["Here you can add and manage your PostHog enterprise licenses. When you activate a license key, enterprise functionality will be enabled immediately. Contact"," ",Object(e.jsx)("a",{href:"mailto:sales@posthog.com",children:"sales@posthog.com"})," to buy a license or if you have any issues with a license."]})}),c&&Object(e.jsx)(M.a,{message:c.detail||Object(e.jsx)("span",{children:"Could not validate license key. Please try again or contact us."}),type:"error",style:{marginBottom:"1em"}}),Object(e.jsxs)(m.a,{form:i,name:"horizontal_login",layout:"inline",onFinish:s=>r({key:s.key}),style:{marginBottom:"1rem"},children:[Object(e.jsx)(m.a.Item,{name:"key",rules:[{required:!0,message:"Please input a license key!"}],children:Object(e.jsx)(v.a,{placeholder:"License key",style:{minWidth:400}})}),Object(e.jsx)(m.a.Item,{shouldUpdate:!0,children:()=>Object(e.jsx)(L.a,{type:"primary",htmlType:"submit",disabled:!i.isFieldsTouched(!0)||!!i.getFieldsError().filter(s=>{let{errors:t}=s;return t.length}).length,children:"Activate License Key"})})]}),Object(e.jsx)(C.a,{"data-attr":"license-table",size:"small",rowKey:"id",rowClassName:"cursor-pointer",dataSource:O,columns:l,loading:b})]})}}}]);
