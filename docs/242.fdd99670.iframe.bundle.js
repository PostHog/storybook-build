(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{4369:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return featureFlagsLogic}));__webpack_require__(41),__webpack_require__(63),__webpack_require__(129),__webpack_require__(49),__webpack_require__(34),__webpack_require__(42),__webpack_require__(84),__webpack_require__(299),__webpack_require__(53);var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(15),_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_9__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(8),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_10__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_12__=(__webpack_require__(70),__webpack_require__(13)),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_12__),kea__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(1),lib_api__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(23),fuse_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(300),_teamLogic__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(31),scenes_urls__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(18),featureFlagsLogic=Object(kea__WEBPACK_IMPORTED_MODULE_13__.kea)({path:["scenes","feature-flags","featureFlagsLogic"],connect:{values:[_teamLogic__WEBPACK_IMPORTED_MODULE_16__.a,["currentTeamId"]]},actions:{updateFlag:function updateFlag(flag){return{flag:flag}},deleteFlag:function deleteFlag(id){return{id:id}},setSearchTerm:function setSearchTerm(searchTerm){return{searchTerm:searchTerm}}},loaders:function loaders(_ref){var _updateFeatureFlag,_loadFeatureFlags,values=_ref.values;return{featureFlags:{__default:[],loadFeatureFlags:(_loadFeatureFlags=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_12___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_10___default.a.mark((function _callee(){var response;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_10___default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,lib_api__WEBPACK_IMPORTED_MODULE_14__.a.get("api/projects/".concat(values.currentTeamId,"/feature_flags/"));case 2:return response=_context.sent,_context.abrupt("return",response.results);case 4:case"end":return _context.stop()}}),_callee)}))),function loadFeatureFlags(){return _loadFeatureFlags.apply(this,arguments)}),updateFeatureFlag:(_updateFeatureFlag=_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_12___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_10___default.a.mark((function _callee2(_ref2){var id,payload,response;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_10___default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return id=_ref2.id,payload=_ref2.payload,_context2.next=3,lib_api__WEBPACK_IMPORTED_MODULE_14__.a.update("api/projects/".concat(values.currentTeamId,"/feature_flags/").concat(id),payload);case 3:return response=_context2.sent,_context2.abrupt("return",_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_9___default()(values.featureFlags).map((function(flag){return flag.id===response.id?response:flag})));case 5:case"end":return _context2.stop()}}),_callee2)}))),function updateFeatureFlag(_x){return _updateFeatureFlag.apply(this,arguments)})}}},selectors:{searchedFeatureFlags:[function(selectors){return[selectors.featureFlags,selectors.searchTerm]},function(featureFlags,searchTerm){return searchTerm?new fuse_js__WEBPACK_IMPORTED_MODULE_15__.a(featureFlags,{keys:["key","name"],threshold:.3}).search(searchTerm).map((function(result){return result.item})):featureFlags}],breadcrumbs:[function(){return[]},function(){return[{name:"Feature Flags",path:scenes_urls__WEBPACK_IMPORTED_MODULE_17__.a.featureFlags()}]}]},reducers:{searchTerm:{setSearchTerm:function setSearchTerm(_,_ref3){return _ref3.searchTerm}},featureFlags:{updateFlag:function updateFlag(state,_ref4){var flag=_ref4.flag;return state.find((function(_ref5){return _ref5.id===flag.id}))?state.map((function(stateFlag){return stateFlag.id===flag.id?flag:stateFlag})):[flag].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_9___default()(state))},deleteFlag:function deleteFlag(state,_ref6){var id=_ref6.id;return state.filter((function(flag){return flag.id!==id}))}}},events:function events(_ref7){var actions=_ref7.actions;return{afterMount:function afterMount(){actions.loadFeatureFlags()}}}})},4488:function(module,exports,__webpack_require__){(exports=__webpack_require__(50)(!1)).push([module.i,'.mixin-gradient-overlay{width:100%;height:3rem;background:linear-gradient(0deg,#fff,transparent)}.mixin-gradient-overlay,.mixin-gradient-overlay-right{content:"";position:absolute;pointer-events:none;bottom:0}.mixin-gradient-overlay-right{width:3rem;height:100%;background:linear-gradient(270deg,#fff,transparent)}.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.feature-flag .enabled-switch{margin-right:1rem!important}.feature-flag .enabled-switch .ant-form-item-control-input-content{flex-direction:row;align-items:center;display:flex}.feature-flag .enabled-switch .ant-form-item-label{padding:0 4px 0 0}.variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{margin-bottom:4px;font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}.feature-flag-form-row{display:flex;justify-content:space-between;align-items:center;width:100%}.feature-flag-form-row .centered{display:flex;align-items:center;white-space:pre-wrap}',""]),module.exports=exports},4733:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"FeatureFlag",(function(){return FeatureFlag_FeatureFlag}));__webpack_require__(41),__webpack_require__(34),__webpack_require__(62),__webpack_require__(42),__webpack_require__(122);var defineProperty=__webpack_require__(3),defineProperty_default=__webpack_require__.n(defineProperty),slicedToArray=__webpack_require__(12),slicedToArray_default=__webpack_require__.n(slicedToArray),react=__webpack_require__(0),react_default=__webpack_require__.n(react),es_form=__webpack_require__(319),es_switch=__webpack_require__(4264),es_button=__webpack_require__(135),row=__webpack_require__(381),col=__webpack_require__(349),input=__webpack_require__(459),collapse=__webpack_require__(4257),popconfirm=__webpack_require__(4213),es_radio=__webpack_require__(1222),slider=__webpack_require__(4715),input_number=__webpack_require__(4255),es_select=__webpack_require__(297),card=__webpack_require__(4261),index_esm=__webpack_require__(1),utils=__webpack_require__(10),PropertyFilters=__webpack_require__(314),DeleteOutlined=__webpack_require__(4236),SaveOutlined=__webpack_require__(4319),ApiFilled=__webpack_require__(4741),LockOutlined=__webpack_require__(4226),MergeCellsOutlined=__webpack_require__(4513),PlusOutlined=__webpack_require__(1868),CopyOutlined=__webpack_require__(1246),objectWithoutProperties=(__webpack_require__(1251),__webpack_require__(63),__webpack_require__(129),__webpack_require__(167),__webpack_require__(49),__webpack_require__(320),__webpack_require__(644),__webpack_require__(168),__webpack_require__(53),__webpack_require__(43)),objectWithoutProperties_default=__webpack_require__.n(objectWithoutProperties),regenerator=__webpack_require__(8),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(70),__webpack_require__(13)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),toConsumableArray=__webpack_require__(15),toConsumableArray_default=__webpack_require__.n(toConsumableArray),api=__webpack_require__(23),react_toastify=__webpack_require__(67),lib=__webpack_require__(32),urls=__webpack_require__(18),teamLogic=__webpack_require__(31),featureFlagsLogic=__webpack_require__(4369),groupsModel=__webpack_require__(126),types=__webpack_require__(40);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var NEW_FLAG={id:null,created_at:null,key:"",name:"",filters:{groups:[{properties:[],rollout_percentage:null}],multivariate:null},deleted:!1,active:!0,created_by:null,is_simple_flag:!1,rollout_percentage:null},NEW_VARIANT={key:"",name:"",rollout_percentage:0},EMPTY_MULTIVARIATE_OPTIONS={variants:[{key:"",name:"",rollout_percentage:100}]},featureFlagLogic=Object(index_esm.kea)({path:["scenes","feature-flags","featureFlagLogic"],connect:{values:[teamLogic.a,["currentTeamId"],groupsModel.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]]},actions:{setFeatureFlagId:function setFeatureFlagId(id){return{id:id}},setFeatureFlag:function setFeatureFlag(featureFlag){return{featureFlag:featureFlag}},addConditionSet:!0,setAggregationGroupTypeIndex:function setAggregationGroupTypeIndex(value){return{value:value}},removeConditionSet:function removeConditionSet(index){return{index:index}},duplicateConditionSet:function duplicateConditionSet(index){return{index:index}},updateConditionSet:function updateConditionSet(index,newRolloutPercentage,newProperties){return{index:index,newRolloutPercentage:newRolloutPercentage,newProperties:newProperties}},deleteFeatureFlag:function deleteFeatureFlag(featureFlag){return{featureFlag:featureFlag}},setMultivariateEnabled:function setMultivariateEnabled(enabled){return{enabled:enabled}},setMultivariateOptions:function setMultivariateOptions(multivariateOptions){return{multivariateOptions:multivariateOptions}},addVariant:!0,updateVariant:function updateVariant(index,newProperties){return{index:index,newProperties:newProperties}},removeVariant:function removeVariant(index){return{index:index}},distributeVariantsEqually:!0},reducers:{featureFlagId:[null,{setFeatureFlagId:function setFeatureFlagId(_,_ref){return _ref.id}}],featureFlag:[null,{setFeatureFlag:function setFeatureFlag(_,_ref2){return _ref2.featureFlag},addConditionSet:function addConditionSet(state){if(!state)return state;var groups=[].concat(toConsumableArray_default()(null==state?void 0:state.filters.groups),[{properties:[],rollout_percentage:null}]);return _objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{groups:groups})})},updateConditionSet:function updateConditionSet(state,_ref3){var index=_ref3.index,newRolloutPercentage=_ref3.newRolloutPercentage,newProperties=_ref3.newProperties;if(!state)return state;var groups=toConsumableArray_default()(null==state?void 0:state.filters.groups);return void 0!==newRolloutPercentage&&(groups[index]=_objectSpread(_objectSpread({},groups[index]),{},{rollout_percentage:newRolloutPercentage})),void 0!==newProperties&&(groups[index]=_objectSpread(_objectSpread({},groups[index]),{},{properties:newProperties})),_objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{groups:groups})})},removeConditionSet:function removeConditionSet(state,_ref4){var index=_ref4.index;if(!state)return state;var groups=toConsumableArray_default()(state.filters.groups);return groups.splice(index,1),_objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{groups:groups})})},duplicateConditionSet:function duplicateConditionSet(state,_ref5){var index=_ref5.index;if(!state)return state;var groups=state.filters.groups.concat([state.filters.groups[index]]);return _objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{groups:groups})})},setMultivariateOptions:function setMultivariateOptions(state,_ref6){var multivariateOptions=_ref6.multivariateOptions;return state?_objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{multivariate:multivariateOptions})}):state},addVariant:function addVariant(state){var _state$filters$multiv;if(!state)return state;var variants=toConsumableArray_default()((null===(_state$filters$multiv=state.filters.multivariate)||void 0===_state$filters$multiv?void 0:_state$filters$multiv.variants)||[]);return _objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{multivariate:_objectSpread(_objectSpread({},state.filters.multivariate||{}),{},{variants:[].concat(toConsumableArray_default()(variants),[NEW_VARIANT])})})})},updateVariant:function updateVariant(state,_ref7){var _state$filters$multiv2,index=_ref7.index,newProperties=_ref7.newProperties;if(!state)return state;var variants=toConsumableArray_default()((null===(_state$filters$multiv2=state.filters.multivariate)||void 0===_state$filters$multiv2?void 0:_state$filters$multiv2.variants)||[]);return variants[index]?(variants[index]=_objectSpread(_objectSpread({},variants[index]),newProperties),_objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{multivariate:_objectSpread(_objectSpread({},state.filters.multivariate),{},{variants:variants})})})):state},removeVariant:function removeVariant(state,_ref8){var _state$filters$multiv3,index=_ref8.index;if(!state)return state;var variants=toConsumableArray_default()((null===(_state$filters$multiv3=state.filters.multivariate)||void 0===_state$filters$multiv3?void 0:_state$filters$multiv3.variants)||[]);return variants.splice(index,1),_objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{multivariate:_objectSpread(_objectSpread({},state.filters.multivariate),{},{variants:variants})})})},distributeVariantsEqually:function distributeVariantsEqually(state){var _state$filters$multiv4;if(!state)return state;var variants=toConsumableArray_default()((null===(_state$filters$multiv4=state.filters.multivariate)||void 0===_state$filters$multiv4?void 0:_state$filters$multiv4.variants)||[]),numVariants=variants.length;if(numVariants>0&&numVariants<=100){var percentageRounded=Math.round(100/numVariants),delta=percentageRounded*numVariants-100;variants.forEach((function(variant,index){variants[index]=_objectSpread(_objectSpread({},variant),{},{rollout_percentage:percentageRounded})})),variants[numVariants-1]=_objectSpread(_objectSpread({},variants[numVariants-1]),{},{rollout_percentage:percentageRounded-delta})}return _objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{multivariate:_objectSpread(_objectSpread({},state.filters.multivariate),{},{variants:variants})})})},setAggregationGroupTypeIndex:function setAggregationGroupTypeIndex(state,_ref9){var value=_ref9.value;return state&&state.filters.aggregation_group_type_index!=value?_objectSpread(_objectSpread({},state),{},{filters:_objectSpread(_objectSpread({},state.filters),{},{aggregation_group_type_index:value,groups:[{properties:[],rollout_percentage:null}]})}):state}}]},loaders:function loaders(_ref10){var _saveFeatureFlag,_loadFeatureFlag,values=_ref10.values;return{featureFlag:{loadFeatureFlag:(_loadFeatureFlag=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!values.featureFlagId||"new"===values.featureFlagId){_context.next=4;break}return _context.next=3,api.a.get("api/projects/".concat(values.currentTeamId,"/feature_flags/").concat(values.featureFlagId));case 3:return _context.abrupt("return",_context.sent);case 4:return _context.abrupt("return",NEW_FLAG);case 5:case"end":return _context.stop()}}),_callee)}))),function loadFeatureFlag(){return _loadFeatureFlag.apply(this,arguments)}),saveFeatureFlag:(_saveFeatureFlag=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(updatedFlag){var flag;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(updatedFlag.created_at,updatedFlag.id,flag=objectWithoutProperties_default()(updatedFlag,["created_at","id"]),updatedFlag.id){_context2.next=7;break}return _context2.next=4,api.a.create("api/projects/".concat(values.currentTeamId,"/feature_flags"),flag);case 4:return _context2.abrupt("return",_context2.sent);case 7:return _context2.next=9,api.a.update("api/projects/".concat(values.currentTeamId,"/feature_flags/").concat(updatedFlag.id),flag);case 9:return _context2.abrupt("return",_context2.sent);case 10:case"end":return _context2.stop()}}),_callee2)}))),function saveFeatureFlag(_x){return _saveFeatureFlag.apply(this,arguments)})}}},listeners:function listeners(_ref11){var _setMultivariateEnabled,_deleteFeatureFlag,actions=_ref11.actions,values=_ref11.values;return{saveFeatureFlagSuccess:function saveFeatureFlagSuccess(_ref12){var _featureFlagsLogic$fi,featureFlag=_ref12.featureFlag;react_toastify.c.success(react_default.a.createElement("div",null,react_default.a.createElement("h1",null,"Your feature flag has been saved!"),react_default.a.createElement("p",null,"Click here to go back to the feature flag list.")),{onClick:function onClick(){lib.router.actions.push(urls.a.featureFlags())},closeOnClick:!0}),null===(_featureFlagsLogic$fi=featureFlagsLogic.a.findMounted())||void 0===_featureFlagsLogic$fi||_featureFlagsLogic$fi.actions.updateFlag(featureFlag)},deleteFeatureFlag:(_deleteFeatureFlag=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(_ref13){var featureFlag;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:featureFlag=_ref13.featureFlag,Object(utils.v)({endpoint:"projects/".concat(values.currentTeamId,"/feature_flags"),object:{name:featureFlag.name,id:featureFlag.id},callback:function callback(){var _featureFlagsLogic$fi2;featureFlag.id&&(null===(_featureFlagsLogic$fi2=featureFlagsLogic.a.findMounted())||void 0===_featureFlagsLogic$fi2||_featureFlagsLogic$fi2.actions.deleteFlag(featureFlag.id)),lib.router.actions.push(urls.a.featureFlags())}});case 2:case"end":return _context3.stop()}}),_callee3)}))),function deleteFeatureFlag(_x2){return _deleteFeatureFlag.apply(this,arguments)}),setMultivariateEnabled:(_setMultivariateEnabled=asyncToGenerator_default()(regenerator_default.a.mark((function _callee4(_ref14){return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:_ref14.enabled?actions.setMultivariateOptions(EMPTY_MULTIVARIATE_OPTIONS):actions.setMultivariateOptions(null);case 2:case"end":return _context4.stop()}}),_callee4)}))),function setMultivariateEnabled(_x3){return _setMultivariateEnabled.apply(this,arguments)})}},selectors:{multivariateEnabled:[function(s){return[s.featureFlag]},function(featureFlag){return!!(null==featureFlag?void 0:featureFlag.filters.multivariate)}],variants:[function(s){return[s.featureFlag]},function(featureFlag){var _featureFlag$filters$;return(null==featureFlag||null===(_featureFlag$filters$=featureFlag.filters.multivariate)||void 0===_featureFlag$filters$?void 0:_featureFlag$filters$.variants)||[]}],nonEmptyVariants:[function(s){return[s.variants]},function(variants){return variants.filter((function(_ref15){return!!_ref15.key}))}],variantRolloutSum:[function(s){return[s.variants]},function(variants){return variants.reduce((function(total,_ref16){return total+_ref16.rollout_percentage}),0)}],areVariantRolloutsValid:[function(s){return[s.variants,s.variantRolloutSum]},function(variants,variantRolloutSum){return variants.every((function(_ref17){var rollout_percentage=_ref17.rollout_percentage;return rollout_percentage>=0&&rollout_percentage<=100}))&&100===variantRolloutSum}],aggregationTargetName:[function(s){return[s.featureFlag,s.groupTypes,s.aggregationLabel]},function(featureFlag,groupTypes,aggregationLabel){return featureFlag&&null!=featureFlag.filters.aggregation_group_type_index&&groupTypes.length>0?aggregationLabel(featureFlag.filters.aggregation_group_type_index).plural:"users"}],taxonomicGroupTypes:[function(s){return[s.featureFlag,s.groupsTaxonomicTypes]},function(featureFlag,groupsTaxonomicTypes){return featureFlag&&null!=featureFlag.filters.aggregation_group_type_index&&groupsTaxonomicTypes.length>0?[groupsTaxonomicTypes[featureFlag.filters.aggregation_group_type_index]]:[types.a.PersonProperties,types.a.Cohorts]}],breadcrumbs:[function(s){return[s.featureFlag]},function(featureFlag){return[{name:"Feature Flags",path:urls.a.featureFlags()}].concat(toConsumableArray_default()(featureFlag?[{name:featureFlag.key||"Unnamed"}]:[]))}]},actionToUrl:function actionToUrl(){return{saveFeatureFlagSuccess:function saveFeatureFlagSuccess(_ref18){var featureFlag=_ref18.featureFlag;return["/feature_flags/".concat(featureFlag.id||"new"),{},{},{replace:!0}]}}},urlToAction:function urlToAction(_ref19){var actions=_ref19.actions,values=_ref19.values;return{"/feature_flags/*":function feature_flags(_ref20){var id=_ref20._;if(id&&id!==values.featureFlagId){var _featureFlagsLogic$fi3,parsedId="new"===id?"new":parseInt(id);actions.setFeatureFlagId(parsedId);var foundFlag=null===(_featureFlagsLogic$fi3=featureFlagsLogic.a.findMounted())||void 0===_featureFlagsLogic$fi3?void 0:_featureFlagsLogic$fi3.values.featureFlags.find((function(flag){return flag.id===parsedId}));foundFlag?actions.setFeatureFlag(foundFlag):actions.setFeatureFlag(NEW_FLAG),"new"!==id&&actions.loadFeatureFlag()}}}}}),PageHeader=__webpack_require__(298),injectStylesIntoStyleTag=__webpack_require__(20),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),FeatureFlag=__webpack_require__(4488),FeatureFlag_default=__webpack_require__.n(FeatureFlag),options={insert:"head",singleton:!1},icons=(injectStylesIntoStyleTag_default()(FeatureFlag_default.a,options),FeatureFlag_default.a.locals,__webpack_require__(36)),Tooltip=__webpack_require__(46),CodeSnippet=__webpack_require__(52),UTM_TAGS="?utm_medium=in-product&utm_campaign=feature-flag";function JSSnippet(_ref){var flagKey=_ref.flagKey;return react_default.a.createElement(react_default.a.Fragment,null,"(",react_default.a.createElement(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0},"if (posthog.isFeatureEnabled('".concat(null!=flagKey?flagKey:"","')) {\n    // run your activation code here\n}")),")",react_default.a.createElement("div",{className:"mt"},"Need more information?"," ",react_default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/js-integration".concat(UTM_TAGS,"#feature-flags")},"Check the docs ",react_default.a.createElement(icons.IconOpenInNew,null))),")")}function PythonSnippet(_ref2){var flagKey=_ref2.flagKey;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(CodeSnippet.a,{language:CodeSnippet.b.Python,wrap:!0},'if posthog.feature_enabled("'.concat(flagKey,'", "user_distinct_id"):\n    runAwesomeFeature()\n')),react_default.a.createElement("div",{className:"mt"},"Need more information?"," ",react_default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/python-integration".concat(UTM_TAGS,"#feature-flags")},"Check the docs ",react_default.a.createElement(icons.IconOpenInNew,null))))}function APISnippet(){var currentTeam=Object(index_esm.useValues)(teamLogic.a).currentTeam;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(CodeSnippet.a,{language:CodeSnippet.b.Bash,wrap:!0},"curl ".concat(window.location.origin,"/decide/ \\\n-X POST -H 'Content-Type: application/json' \\\n-d '{\n    \"api_key\": \"").concat(currentTeam?currentTeam.api_token:"[project_api_key]",'",\n    "distinct_id": "[user distinct id]"\n}\'\n                ')),react_default.a.createElement("div",{className:"mt"},"Need more information?"," ",react_default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/api/feature-flags".concat(UTM_TAGS)},"Check the docs ",react_default.a.createElement(icons.IconOpenInNew,null))))}try{JSSnippet.displayName="JSSnippet",JSSnippet.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:JSSnippet.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(__react_docgen_typescript_loader_error){}try{PythonSnippet.displayName="PythonSnippet",PythonSnippet.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:PythonSnippet.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(__react_docgen_typescript_loader_error){}var LemonRow=__webpack_require__(199),GroupsIntroductionOption=__webpack_require__(1166),LemonTag=__webpack_require__(755),userLogic=__webpack_require__(71),src_types=__webpack_require__(6),Link=__webpack_require__(56);function FeatureFlag_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function FeatureFlag_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?FeatureFlag_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):FeatureFlag_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var scene={component:FeatureFlag_FeatureFlag,logic:featureFlagLogic};function focusVariantKeyField(index){setTimeout((function(){var _document$querySelect;return null===(_document$querySelect=document.querySelector('.variant-form-list input[data-key-index="'.concat(index,'"]')))||void 0===_document$querySelect?void 0:_document$querySelect.focus()}),50)}function FeatureFlag_FeatureFlag(){var _Form$useForm=es_form.a.useForm(),form=slicedToArray_default()(_Form$useForm,1)[0],_useValues=Object(index_esm.useValues)(featureFlagLogic),featureFlag=_useValues.featureFlag,featureFlagId=_useValues.featureFlagId,multivariateEnabled=_useValues.multivariateEnabled,variants=_useValues.variants,nonEmptyVariants=_useValues.nonEmptyVariants,areVariantRolloutsValid=_useValues.areVariantRolloutsValid,variantRolloutSum=_useValues.variantRolloutSum,groupTypes=_useValues.groupTypes,aggregationTargetName=_useValues.aggregationTargetName,taxonomicGroupTypes=_useValues.taxonomicGroupTypes,_useActions=Object(index_esm.useActions)(featureFlagLogic),addConditionSet=_useActions.addConditionSet,updateConditionSet=_useActions.updateConditionSet,removeConditionSet=_useActions.removeConditionSet,duplicateConditionSet=_useActions.duplicateConditionSet,saveFeatureFlag=_useActions.saveFeatureFlag,deleteFeatureFlag=_useActions.deleteFeatureFlag,setMultivariateEnabled=_useActions.setMultivariateEnabled,addVariant=_useActions.addVariant,updateVariant=_useActions.updateVariant,removeVariant=_useActions.removeVariant,distributeVariantsEqually=_useActions.distributeVariantsEqually,setFeatureFlag=_useActions.setFeatureFlag,setAggregationGroupTypeIndex=_useActions.setAggregationGroupTypeIndex,_useValues2=Object(index_esm.useValues)(groupsModel.a),showGroupsOptions=_useValues2.showGroupsOptions,aggregationLabel=_useValues2.aggregationLabel,_useValues3=Object(index_esm.useValues)(userLogic.a),hasAvailableFeature=_useValues3.hasAvailableFeature,upgradeLink=_useValues3.upgradeLink,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),hasKeyChanged=_useState2[0],setHasKeyChanged=_useState2[1],_useState3=Object(react.useState)(!1),_useState4=slicedToArray_default()(_useState3,2),showVariantDiscardWarning=_useState4[0],setShowVariantDiscardWarning=_useState4[1];Object(react.useEffect)((function(){form.setFieldsValue(FeatureFlag_objectSpread({},featureFlag))}),[featureFlag]);var matchByGroupsIntroductionOption=Object(GroupsIntroductionOption.a)({value:-2});return react_default.a.createElement("div",{className:"feature-flag"},featureFlag?react_default.a.createElement(es_form.a,{layout:"vertical",form:form,initialValues:{name:featureFlag.name,key:featureFlag.key,active:featureFlag.active},onValuesChange:function onValuesChange(newValues){"new"!==featureFlagId&&newValues.key&&setHasKeyChanged(newValues.key!==featureFlag.key),setFeatureFlag(FeatureFlag_objectSpread(FeatureFlag_objectSpread({},featureFlag),newValues))},onFinish:function onFinish(values){return saveFeatureFlag(FeatureFlag_objectSpread(FeatureFlag_objectSpread(FeatureFlag_objectSpread({},featureFlag),values),{},{filters:featureFlag.filters}))},requiredMark:!1,scrollToFirstError:!0},react_default.a.createElement(PageHeader.a,{title:"Feature Flag",buttons:react_default.a.createElement("div",{style:{display:"flex"}},react_default.a.createElement(es_form.a.Item,{className:"enabled-switch"},react_default.a.createElement(es_form.a.Item,{shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.active!==currentValues.active},style:{marginBottom:0,marginRight:6}},(function(_ref){var getFieldValue=_ref.getFieldValue;return react_default.a.createElement("span",{className:"ant-form-item-label",style:{lineHeight:"1.5rem"}},getFieldValue("active")?react_default.a.createElement("span",{className:"text-success"},"Enabled"):react_default.a.createElement("span",{className:"text-danger"},"Disabled"))})),react_default.a.createElement(es_form.a.Item,{name:"active",noStyle:!0,valuePropName:"checked"},react_default.a.createElement(es_switch.a,null))),"new"!==featureFlagId&&react_default.a.createElement(es_button.a,{"data-attr":"delete-flag",danger:!0,icon:react_default.a.createElement(DeleteOutlined.a,null),onClick:function onClick(){deleteFeatureFlag(featureFlag)},style:{marginRight:16}},"Delete"),react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(SaveOutlined.a,null),type:"primary","data-attr":"feature-flag-submit",htmlType:"submit"},"Save changes"))}),react_default.a.createElement("h3",{className:"l3"},"General configuration"),react_default.a.createElement("div",{className:"text-muted mb"},"General settings for your feature flag and integration instructions."),react_default.a.createElement(row.a,{gutter:16,style:{marginBottom:32}},react_default.a.createElement(col.a,{span:12},react_default.a.createElement(es_form.a.Item,{name:"key",label:"Key (must be unique)",rules:[{required:!0,message:"You need to set a key."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}],validateStatus:hasKeyChanged?"warning":void 0,help:hasKeyChanged?react_default.a.createElement("small",null,react_default.a.createElement("b",null,"Warning! "),"Changing this key will",react_default.a.createElement("a",{href:"https://posthog.com/docs/features/feature-flags".concat(UTM_TAGS,"#feature-flag-persistence"),target:"_blank",rel:"noopener"}," ","affect the persistence of your flag ",react_default.a.createElement(icons.IconOpenInNew,null))):void 0},react_default.a.createElement(input.a,{"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),react_default.a.createElement(es_form.a.Item,{name:"name",label:"Description"},react_default.a.createElement(input.a.TextArea,{className:"ph-ignore-input","data-attr":"feature-flag-description",placeholder:"Adding a helpful description can ensure others know what this feature is for."}))),react_default.a.createElement(col.a,{span:12,style:{paddingTop:31}},react_default.a.createElement(collapse.a,null,react_default.a.createElement(collapse.a.Panel,{header:react_default.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},react_default.a.createElement(icons.IconJavascript,{style:{marginRight:6}})," Javascript integration instructions"),key:"js"},react_default.a.createElement(es_form.a.Item,{shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.key!==currentValues.key}},(function(_ref2){var getFieldValue=_ref2.getFieldValue;return react_default.a.createElement(JSSnippet,{flagKey:getFieldValue("key")})}))),react_default.a.createElement(collapse.a.Panel,{header:react_default.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},react_default.a.createElement(icons.IconPython,{style:{marginRight:6}})," Python integration instructions"),key:"python"},react_default.a.createElement(es_form.a.Item,{shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.key!==currentValues.key}},(function(_ref3){var getFieldValue=_ref3.getFieldValue;return react_default.a.createElement(PythonSnippet,{flagKey:getFieldValue("key")})}))),react_default.a.createElement(collapse.a.Panel,{header:react_default.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},react_default.a.createElement(ApiFilled.a,{style:{marginRight:6}})," API integration instructions"),key:"api"},react_default.a.createElement(es_form.a.Item,{shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.key!==currentValues.key}},react_default.a.createElement(APISnippet,null)))))),react_default.a.createElement("div",{className:"mb-2"},react_default.a.createElement("h3",{className:"l3"},"Served value"),react_default.a.createElement("div",{className:"mb-05"},react_default.a.createElement(popconfirm.a,{placement:"top",title:"Change value type? The variants below will be lost.",visible:showVariantDiscardWarning,onConfirm:function onConfirm(){setMultivariateEnabled(!1),setShowVariantDiscardWarning(!1)},onCancel:function onCancel(){return setShowVariantDiscardWarning(!1)},okText:"OK",cancelText:"Cancel"},react_default.a.createElement(es_radio.a.Group,{options:[{label:"Boolean value (A/B test)",value:!1},{label:react_default.a.createElement(Tooltip.a,{title:hasAvailableFeature(src_types.c.MULTIVARIATE_FLAGS)?"":"This feature is not available on your current plan."},react_default.a.createElement("div",null,!hasAvailableFeature(src_types.c.MULTIVARIATE_FLAGS)&&react_default.a.createElement(Link.a,{to:upgradeLink,target:"_blank"},react_default.a.createElement(LockOutlined.a,{style:{marginRight:4,color:"var(--warning)"}})),"String value (Multivariate test)"," ",react_default.a.createElement(LemonTag.a,{type:"warning"},"Beta"))),value:!0,disabled:!hasAvailableFeature(src_types.c.MULTIVARIATE_FLAGS)}],onChange:function onChange(e){var value=e.target.value;!1===value&&nonEmptyVariants.length?setShowVariantDiscardWarning(!0):(setMultivariateEnabled(value),focusVariantKeyField(0))},value:multivariateEnabled,optionType:"button"}))),react_default.a.createElement("div",{className:"text-muted mb"},Object(utils.j)(aggregationTargetName)," will be served"," ",multivariateEnabled?react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("strong",null,"a variant key")," according to the below distribution"):react_default.a.createElement("strong",null,react_default.a.createElement("code",null,"true"))," ","if they match one or more release condition groups."),multivariateEnabled&&react_default.a.createElement("div",{className:"variant-form-list"},react_default.a.createElement(row.a,{gutter:8,className:"label-row"},react_default.a.createElement(col.a,{span:7},"Variant key"),react_default.a.createElement(col.a,{span:7},"Description"),react_default.a.createElement(col.a,{span:9},react_default.a.createElement("span",null,"Rollout percentage"),react_default.a.createElement(es_button.a,{type:"link",onClick:distributeVariantsEqually,icon:react_default.a.createElement(MergeCellsOutlined.a,null),style:{padding:"0 0 0 0.5em"},title:"Distribute variants equally"},"Distribute"))),variants.map((function(_ref4,index){var rollout_percentage=_ref4.rollout_percentage;return react_default.a.createElement(es_form.a,{key:index,onValuesChange:function onValuesChange(changedValues){return updateVariant(index,changedValues)},initialValues:variants[index],validateTrigger:["onChange","onBlur"]},react_default.a.createElement(row.a,{gutter:8},react_default.a.createElement(col.a,{span:7},react_default.a.createElement(es_form.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}]},react_default.a.createElement(input.a,{"data-attr":"feature-flag-variant-key","data-key-index":index.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(index+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}))),react_default.a.createElement(col.a,{span:7},react_default.a.createElement(es_form.a.Item,{name:"name"},react_default.a.createElement(input.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"}))),react_default.a.createElement(col.a,{span:7},react_default.a.createElement(slider.a,{tooltipPlacement:"top",value:rollout_percentage,onChange:function onChange(value){return updateVariant(index,{rollout_percentage:value})}})),react_default.a.createElement(col.a,{span:2},react_default.a.createElement(input_number.a,{min:0,max:100,value:rollout_percentage,onChange:function onChange(value){if(null!=value){var valueInt=parseInt(value.toString());isNaN(valueInt)||updateVariant(index,{rollout_percentage:valueInt})}},style:{width:"100%",borderColor:areVariantRolloutsValid?void 0:"var(--danger)"}})),variants.length>1&&react_default.a.createElement(col.a,{span:1},react_default.a.createElement(Tooltip.a,{title:"Delete this variant",placement:"bottomLeft"},react_default.a.createElement(es_button.a,{type:"link",icon:react_default.a.createElement(DeleteOutlined.a,null),onClick:function onClick(){return removeVariant(index)},style:{color:"var(--danger)"}})))))})),variants.length>0&&!areVariantRolloutsValid&&react_default.a.createElement("p",{className:"text-danger"},"Percentage rollouts for variants must sum to 100 (currently ",variantRolloutSum,")."),react_default.a.createElement(es_button.a,{type:"dashed",block:!0,icon:react_default.a.createElement(PlusOutlined.a,null),onClick:function onClick(){var newIndex=variants.length;addVariant(),focusVariantKeyField(newIndex)},style:{marginBottom:16}},"Add Variant"))),react_default.a.createElement("div",{className:"feature-flag-form-row"},react_default.a.createElement("div",null,react_default.a.createElement("h3",{className:"l3"},"Release conditions"),react_default.a.createElement("div",{className:"text-muted mb"},"Specify the ",aggregationTargetName," to which you want to release this flag. Note that condition sets are rolled out independently of each other.")),showGroupsOptions&&react_default.a.createElement("div",{className:"centered"},"Match by",react_default.a.createElement(es_select.a,{value:null!=featureFlag.filters.aggregation_group_type_index?featureFlag.filters.aggregation_group_type_index:-1,onChange:function onChange(value){setAggregationGroupTypeIndex(-1!==value?value:null)},style:{marginLeft:8},"data-attr":"feature-flag-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]}},react_default.a.createElement(es_select.a.Option,{key:-1,value:-1},"Users"),groupTypes.map((function(groupType){return react_default.a.createElement(es_select.a.Option,{key:groupType.group_type_index,value:groupType.group_type_index},Object(utils.j)(aggregationLabel(groupType.group_type_index).plural))})),matchByGroupsIntroductionOption))),react_default.a.createElement(row.a,{gutter:16},featureFlag.filters.groups.map((function(group,index){var _group$properties,_featureFlag$filters$;return react_default.a.createElement(col.a,{span:24,md:24,key:"".concat(index,"-").concat(featureFlag.filters.groups.length)},index>0&&react_default.a.createElement("div",{style:{display:"flex",marginLeft:16}},react_default.a.createElement("div",{className:"stateful-badge or-light-grey mb"},"OR")),react_default.a.createElement(card.a,{style:{marginBottom:16}},react_default.a.createElement("div",{className:"feature-flag-form-row",style:{height:24}},react_default.a.createElement("div",null,react_default.a.createElement("span",{className:"simple-tag tag-light-blue",style:{marginRight:8}},"Set ",index+1),(null===(_group$properties=group.properties)||void 0===_group$properties?void 0:_group$properties.length)?react_default.a.createElement(react_default.a.Fragment,null,"Matching ",react_default.a.createElement("b",null,aggregationTargetName)," with filters"):react_default.a.createElement(react_default.a.Fragment,null,"Condition set will match ",react_default.a.createElement("b",null,"all ",aggregationTargetName))),react_default.a.createElement("div",null,react_default.a.createElement(Tooltip.a,{title:"Duplicate this condition set",placement:"bottomLeft"},react_default.a.createElement(es_button.a,{type:"link",icon:react_default.a.createElement(CopyOutlined.a,null),style:{width:24,height:24},onClick:function onClick(){return duplicateConditionSet(index)}})),featureFlag.filters.groups.length>1&&react_default.a.createElement(Tooltip.a,{title:"Delete this condition set",placement:"bottomLeft"},react_default.a.createElement(es_button.a,{type:"link",icon:react_default.a.createElement(DeleteOutlined.a,null),style:{width:24,height:24},onClick:function onClick(){return removeConditionSet(index)}})))),react_default.a.createElement(LemonRow.b,{large:!0}),react_default.a.createElement(PropertyFilters.a,{style:{marginLeft:15},pageKey:"feature-flag-".concat(featureFlag.id,"-").concat(index,"-").concat(featureFlag.filters.groups.length,"-").concat(null!==(_featureFlag$filters$=featureFlag.filters.aggregation_group_type_index)&&void 0!==_featureFlag$filters$?_featureFlag$filters$:""),propertyFilters:null==group?void 0:group.properties,onChange:function onChange(properties){return updateConditionSet(index,void 0,properties)},taxonomicGroupTypes:taxonomicGroupTypes,showConditionBadge:!0,greyBadges:!0}),react_default.a.createElement(LemonRow.b,{large:!0}),react_default.a.createElement("div",{className:"feature-flag-form-row"},react_default.a.createElement("div",{className:"centered"},"Roll out to"," ",react_default.a.createElement(input_number.a,{style:{width:100,marginLeft:8,marginRight:8},onChange:function onChange(value){updateConditionSet(index,value)},value:null!=group.rollout_percentage?group.rollout_percentage:100,min:0,max:100,addonAfter:"%"})," ","of ",react_default.a.createElement("b",null,aggregationTargetName)," in this set"))))}))),react_default.a.createElement(card.a,{size:"small",style:{marginBottom:16}},react_default.a.createElement(es_button.a,{type:"link",onClick:addConditionSet,style:{marginLeft:5}},react_default.a.createElement(PlusOutlined.a,{style:{marginRight:15}})," Add condition set")),react_default.a.createElement(es_form.a.Item,{className:"text-right"},react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(SaveOutlined.a,null),htmlType:"submit",type:"primary","data-attr":"feature-flag-submit-bottom"},"Save changes"))):react_default.a.createElement(utils.c,null))}}}]);