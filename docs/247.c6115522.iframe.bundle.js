(window.webpackJsonp=window.webpackJsonp||[]).push([[247],{"./frontend/src/scenes/annotations/index.tsx":function(On,$,n){"use strict";n.r($),n.d($,"scene",function(){return bn}),n.d($,"Annotations",function(){return W});var k=n("./node_modules/@babel/runtime/regenerator/index.js"),E=n.n(k),Sn=n("./node_modules/regenerator-runtime/runtime.js"),Q=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),P=n.n(Q),X=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),O=n.n(X),C=n("./node_modules/react/index.js"),e=n.n(C),z=n("./node_modules/kea/lib/index.esm.js"),Z=n("./node_modules/antd/es/input/index.js"),S=n("./node_modules/antd/es/tag/index.js"),R=n("./node_modules/antd/es/button/index.js"),w=n("./node_modules/antd/es/modal/index.js"),q=n("./node_modules/antd/es/dropdown/index.js"),H=n("./node_modules/antd/es/menu/index.js"),_=n("./node_modules/antd/es/row/index.js"),K=n("./frontend/src/models/annotationsModel.ts"),Tn=n("./node_modules/core-js/modules/es.array.concat.js"),Nn=n("./node_modules/core-js/modules/es.array.iterator.js"),Dn=n("./node_modules/core-js/modules/es.object.to-string.js"),Pn=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),nn=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),en=n.n(nn),tn=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),V=n.n(tn),Y=n("./frontend/src/lib/api.ts"),F=n("./frontend/src/lib/utils.tsx"),U=n("./frontend/src/scenes/teamLogic.ts"),B=Object(z.kea)({path:["scenes","annotations","logic"],loaders:function(o){var t=o.actions;return{annotations:{__default:[],loadAnnotations:function(){var c=P()(E.a.mark(function l(){var d;return E.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Y.a.get("api/projects/".concat(U.a.values.currentTeamId,"/annotations/?").concat(Object(F.xb)({order:"-updated_at"})));case 2:return d=r.sent,t.setNext(d.next),r.abrupt("return",d.results);case 5:case"end":return r.stop()}},l)}));function i(){return c.apply(this,arguments)}return i}()}}},reducers:function(){return{annotations:[[],{appendAnnotations:function(t,c){var i=c.annotations;return[].concat(V()(t),V()(i))}}],next:[null,{setNext:function(t,c){var i=c.next;return i}}],loadingNext:[!1,{loadAnnotationsNext:function(){return!0},appendAnnotations:function(){return!1}}]}},actions:function(){return{updateAnnotation:function(t,c){return{id:t,content:c}},deleteAnnotation:function(t){return{id:t}},restoreAnnotation:function(t){return{id:t}},loadAnnotationsNext:function(){return!0},setNext:function(t){return{next:t}},appendAnnotations:function(t){return{annotations:t}}}},listeners:function(o){var t=o.actions,c=o.values;return en()({updateAnnotation:function(){var i=P()(E.a.mark(function d(m){var r,j;return E.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return r=m.id,j=m.content,b.next=3,Y.a.update("api/projects/".concat(U.a.values.currentTeamId,"/annotations/").concat(r),{content:j});case 3:t.loadAnnotations();case 4:case"end":return b.stop()}},d)}));function l(d){return i.apply(this,arguments)}return l}(),restoreAnnotation:function(){var i=P()(E.a.mark(function d(m){var r;return E.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r=m.id,u.next=3,Y.a.update("api/projects/".concat(U.a.values.currentTeamId,"/annotations/").concat(r),{deleted:!1});case 3:t.loadAnnotations();case 4:case"end":return u.stop()}},d)}));function l(d){return i.apply(this,arguments)}return l}(),deleteAnnotation:function(l){var d=l.id;Object(F.v)({endpoint:"projects/".concat(U.a.values.currentTeamId,"/annotations"),object:{name:"Annotation",id:d},callback:function(){return t.loadAnnotations()}})},loadAnnotationsNext:function(){var i=P()(E.a.mark(function d(){var m,r;return E.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(m=[],!c.next){u.next=7;break}return u.next=4,Y.a.get(c.next);case 4:r=u.sent,t.setNext(r.next),m=r.results;case 7:t.appendAnnotations(m);case 8:case"end":return u.stop()}},d)}));function l(){return i.apply(this,arguments)}return l}()},K.a.actionTypes.createGlobalAnnotationSuccess,function(){t.loadAnnotations()})},events:function(o){var t=o.actions;return{afterMount:function(){return t.loadAnnotations()}}}}),an=n("./node_modules/@ant-design/icons/es/icons/ProjectOutlined.js"),on=n("./node_modules/@ant-design/icons/es/icons/DeploymentUnitOutlined.js"),rn=n("./node_modules/@ant-design/icons/es/icons/DownOutlined.js"),sn=n("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),ln=n("./node_modules/@ant-design/icons/es/icons/RedoOutlined.js"),dn=n("./frontend/src/lib/constants.tsx"),cn=n("./frontend/src/lib/components/PageHeader.tsx"),un=n("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),h=n("./frontend/src/types.ts"),mn=n("./node_modules/rc-picker/lib/generate/dayjs.js"),fn=n.n(mn),vn=n("./node_modules/antd/lib/date-picker/generatePicker/index.js"),An=n.n(vn),I=n("./frontend/src/lib/dayjs.ts"),jn=n("./frontend/src/lib/components/Spinner/Spinner.tsx"),pn=n("./frontend/src/lib/components/LemonTable/index.ts"),gn=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),En=n("./frontend/src/lib/components/TimezoneAware/index.tsx"),yn=An()(fn.a),xn=Z.a.TextArea,bn={component:W,logic:B};function W(){var a=Object(z.useValues)(B),o=a.annotations,t=a.annotationsLoading,c=a.next,i=a.loadingNext,l=Object(z.useActions)(B),d=l.updateAnnotation,m=l.deleteAnnotation,r=l.loadAnnotationsNext,j=l.restoreAnnotation,u=Object(z.useActions)(K.a),b=u.createGlobalAnnotation,T=Object(C.useState)(!1),L=O()(T,2),J=L[0],N=L[1],G=Object(C.useState)(null),M=O()(G,2),y=M[0],p=M[1],g=[{title:"Annotation",key:"annotation",width:"30%",render:function(v,s){return e.a.createElement("div",{className:"ph-no-capture",style:{width:"auto",maxWidth:250}},s.content)}},{title:"For date",dataIndex:"date_marker",render:function(v,s){return e.a.createElement("span",null,Object(I.a)(s.date_marker).format("MMMM DD, YYYY"))},sorter:function(v,s){return Object(I.a)(v.date_marker).diff(s.date_marker)}},Object(gn.b)(),{title:"Last updated",dataIndex:"updated_at",render:function(v,s){return e.a.createElement(En.b,{time:s.updated_at})},sorter:function(v,s){return Object(I.a)(v.date_marker).diff(s.date_marker)}},{title:"Status",render:function(v,s){return s.deleted?e.a.createElement(S.a,{color:"red"},"Deleted"):e.a.createElement(S.a,{color:"green"},"Active")}},{title:"Scope",render:function(v,s){return s.scope===h.b.Insight?e.a.createElement(S.a,{color:"blue"},"Insight"):s.scope===h.b.Project?e.a.createElement(S.a,{color:"purple"},"Project"):s.scope===h.b.Organization?e.a.createElement(S.a,{color:"pink"},"Organization"):e.a.createElement(S.a,null,"Unknown (",s.scope,")")}}];function D(){N(!1),setTimeout(function(){return p(null)},500)}return e.a.createElement("div",null,e.a.createElement(cn.a,{title:"Annotations",caption:"Here you can add organization- and project-wide annotations. Dashboard-specific ones can be added directly in the dashboard.",buttons:e.a.createElement(R.a,{type:"primary","data-attr":"create-annotation",onClick:function(){return N(!0)},icon:e.a.createElement(un.a,null)},"New Annotation")}),e.a.createElement("div",null,e.a.createElement(pn.a,{"data-attr":"annotations-table",rowKey:"id",rowClassName:"cursor-pointer",dataSource:o,columns:g,loading:t,onRow:function(v){return{onClick:function(){p(v),N(!0)}}},emptyState:"No annotations yet"}),e.a.createElement("div",{style:{visibility:c?"visible":"hidden",margin:"2rem auto 5rem",textAlign:"center"}},i?e.a.createElement(jn.a,{size:"sm"}):e.a.createElement(R.a,{type:"primary",onClick:function(){r()}},"Load more annotations"))),e.a.createElement(Cn,{visible:J,onCancel:function(){D()},onSubmit:function(){var f=P()(E.a.mark(function v(s,hn){return E.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(A.t0=y,!A.t0){A.next=5;break}return A.next=4,y;case 4:A.t0=A.sent;case 5:if(!A.t0){A.next=9;break}d(y.id,s),A.next=10;break;case 9:b(s,hn.format("YYYY-MM-DD"));case 10:D();case 11:case"end":return A.stop()}},v)}));return function(v,s){return f.apply(this,arguments)}}(),onDelete:function(){y&&m(y.id),D()},onRestore:function(){y&&j(y.id),D()},annotation:y}))}var x;(function(a){a[a.CREATE=0]="CREATE",a[a.EDIT=1]="EDIT"})(x||(x={}));function Cn(a){var o,t=Object(C.useState)(h.b.Project),c=O()(t,2),i=c[0],l=c[1],d=Object(C.useState)(""),m=O()(d,2),r=m[0],j=m[1],u=Object(C.useState)(x.CREATE),b=O()(u,2),T=b[0],L=b[1],J=Object(C.useState)(Object(I.a)()),N=O()(J,2),G=N[0],M=N[1];Object(C.useEffect)(function(){a.annotation?(L(x.EDIT),j(a.annotation.content)):(L(x.CREATE),j(""))},[a.annotation]);var y=function(g,D){a.onSubmit(g,D),j(""),M(Object(I.a)()),l(h.b.Project)};return e.a.createElement(w.a,{footer:[e.a.createElement(R.a,{key:"create-annotation-cancel",onClick:function(){return a.onCancel()}},"Cancel"),e.a.createElement(R.a,{type:"primary",key:"create-annotation-submit","data-attr":"create-annotation-submit",onClick:function(){y(r,G)}},T===x.CREATE?"Submit":"Update")],closable:!1,visible:a.visible,onCancel:a.onCancel,title:T===x.CREATE?"Create annotation":"Edit ennotation"},T===x.CREATE?e.a.createElement("span",null,"This annotation will appear on all",e.a.createElement(q.a,{overlay:e.a.createElement(H.a,{activeKey:i,onSelect:function(g){return l(g.key)}},e.a.createElement(H.a.Item,{key:h.b.Project,icon:e.a.createElement(an.a,null)},"Project"),e.a.createElement(H.a.Item,{key:h.b.Organization,icon:e.a.createElement(on.a,null)},"Organization"))},e.a.createElement(R.a,{style:{marginLeft:8,marginRight:8}},dn.E.get(i)," ",e.a.createElement(rn.a,null)))," ","charts"):e.a.createElement(_.a,{justify:"space-between"},e.a.createElement("span",null,"Change existing annotation text"),!((o=a.annotation)===null||o===void 0)&&o.deleted?e.a.createElement(ln.a,{className:"button-border clickable",onClick:function(){a.onRestore()}}):e.a.createElement(sn.a,{className:"text-danger",onClick:function(){a.onDelete()}})),e.a.createElement("br",null),T===x.CREATE&&e.a.createElement("div",null,"Date:",e.a.createElement(yn,{style:{marginTop:16,marginLeft:8,marginBottom:16},getPopupContainer:function(g){return g.parentElement},value:G,onChange:function(g){return M(g)},allowClear:!1})),e.a.createElement(xn,{"data-attr":"create-annotation-input",maxLength:300,style:{marginBottom:12,marginTop:5},rows:4,value:r,onChange:function(g){return j(g.target.value)}}))}}}]);
