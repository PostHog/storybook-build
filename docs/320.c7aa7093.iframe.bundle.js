(window.webpackJsonp=window.webpackJsonp||[]).push([[320],{"./frontend/src/scenes/instance/AsyncMigrations/AsyncMigrations.tsx":function(Ye,N,i){"use strict";i.r(N),i.d(N,"scene",function(){return Re}),i.d(N,"AsyncMigrations",function(){return ae});var He=i("./node_modules/core-js/modules/es.object.keys.js"),Ge=i("./node_modules/core-js/modules/es.array.filter.js"),ze=i("./node_modules/core-js/modules/es.object.to-string.js"),Je=i("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Qe=i("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Xe=i("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),ce=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),E=i.n(ce),Ze=i("./node_modules/core-js/modules/es.function.name.js"),qe=i("./node_modules/core-js/modules/es.symbol.js"),_e=i("./node_modules/core-js/modules/es.symbol.description.js"),en=i("./node_modules/core-js/modules/es.array.includes.js"),nn=i("./node_modules/core-js/modules/es.string.includes.js"),tn=i("./node_modules/core-js/modules/es.array.map.js"),k=i("./node_modules/react/index.js"),H=i("./frontend/src/lib/components/PageHeader.tsx"),G=i("./node_modules/antd/es/tabs/index.js"),le=i("./node_modules/antd/es/progress/index.js"),z=i("./node_modules/antd/es/button/index.js"),ue=i("./node_modules/antd/es/space/index.js"),p=i("./node_modules/kea/lib/index.esm.js"),de=i("./node_modules/@ant-design/icons/es/icons/PlayCircleOutlined.js"),ge=i("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),O=i.n(ge),me=i("./node_modules/@babel/runtime/regenerator/index.js"),m=i.n(me),rn=i("./node_modules/core-js/modules/es.array.iterator.js"),an=i("./node_modules/core-js/modules/web.dom-collections.iterator.js"),sn=i("./node_modules/core-js/modules/es.array.concat.js"),R=i("./frontend/src/lib/api.ts"),D=i("./frontend/src/scenes/userLogic.ts"),fe=i("./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),T=i("./frontend/src/lib/components/lemonToast.tsx"),pe=i("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),je=i("./node_modules/kea-loaders/lib/index.js"),J=i("./node_modules/kea-router/lib/index.js");function Q(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),r.push.apply(r,a)}return r}function A(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Q(Object(r),!0).forEach(function(a){E()(n,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))})}return n}var b;(function(n){n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.CompletedSuccessfully=2]="CompletedSuccessfully",n[n.Errored=3]="Errored",n[n.RolledBack=4]="RolledBack",n[n.Starting=5]="Starting",n[n.FailedAtStartup=6]="FailedAtStartup"})(b||(b={}));var v;(function(n){n.Management="management",n.FutureMigrations="future",n.Settings="settings"})(v||(v={}));var ye={0:"Not started",1:"Running",2:"Complete",3:"Error",4:"Rolled back",5:"Starting",6:"Failed at startup"},x=Object(p.kea)([Object(p.path)(["scenes","instance","AsyncMigrations","asyncMigrationsLogic"]),Object(p.connect)({values:[pe.a,["preflight"]]}),Object(p.actions)({triggerMigration:function(e){return{migration:e}},resumeMigration:function(e){return{migration:e}},rollbackMigration:function(e){return{migration:e}},forceStopMigration:function(e){return{migration:e}},forceStopMigrationWithoutRollback:function(e){return{migration:e}},updateMigrationStatus:function(e,r,a){return{migration:e,endpoint:r,message:a}},setActiveTab:function(e){return{tab:e}},updateSetting:function(e,r){return{settingKey:e,newValue:r}},loadAsyncMigrationErrors:function(e){return{migrationId:e}},loadAsyncMigrationErrorsSuccess:function(e,r){return{migrationId:e,errors:r}},loadAsyncMigrationErrorsFailure:function(e,r){return{migrationId:e,error:r}},openAsyncMigrationsModal:function(e,r,a){return{migration:e,endpoint:r,message:a}},closeAsyncMigrationsModal:!0}),Object(p.reducers)({activeTab:[v.Management,{setActiveTab:function(e,r){var a=r.tab;return a}}],asyncMigrationErrors:[{},{loadAsyncMigrationErrorsSuccess:function(e,r){var a=r.migrationId,s=r.errors;return A(A({},e),{},E()({},a,s))}}],asyncMigrationErrorsLoading:[{},{loadAsyncMigrationErrors:function(e,r){var a=r.migrationId;return A(A({},e),{},E()({},a,!0))},loadAsyncMigrationErrorsSuccess:function(e,r){var a=r.migrationId;return A(A({},e),{},E()({},a,!1))},loadAsyncMigrationErrorsFailure:function(e,r){var a=r.migrationId;return A(A({},e),{},E()({},a,!1))}}],activeAsyncMigrationModal:[null,{openAsyncMigrationsModal:function(e,r){return r},closeAsyncMigrationsModal:function(){return null},updateMigrationStatus:function(){return null}}]}),Object(je.loaders)(function(){return{asyncMigrations:[[],{loadAsyncMigrations:function(){var n=O()(m.a.mark(function r(){var a;return m.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if((a=D.a.values.user)!==null&&a!==void 0&&a.is_staff){c.next=2;break}return c.abrupt("return",[]);case 2:return c.next=4,R.b.get("api/async_migrations");case 4:return c.abrupt("return",c.sent.results);case 5:case"end":return c.stop()}},r)}));function e(){return n.apply(this,arguments)}return e}()}],asyncMigrationSettings:[[],{loadAsyncMigrationSettings:function(){var n=O()(m.a.mark(function r(){var a,s;return m.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if((a=D.a.values.user)!==null&&a!==void 0&&a.is_staff){o.next=2;break}return o.abrupt("return",[]);case 2:return o.next=4,R.b.get("api/instance_settings");case 4:return s=o.sent.results,o.abrupt("return",s.filter(function(d){return d.key.includes("ASYNC_MIGRATIONS")}));case 6:case"end":return o.stop()}},r)}));function e(){return n.apply(this,arguments)}return e}()}]}}),Object(p.selectors)({isAnyMigrationRunning:[function(n){return[n.asyncMigrations]},function(n){return n.some(function(e){return[b.Running,b.Starting].includes(e.status)})}],actionableMigrations:[function(n){return[n.asyncMigrations]},function(n){return n.filter(function(e){return e.is_available})}],futureMigrations:[function(n){return[n.asyncMigrations]},function(n){return n.filter(function(e){return!e.is_available})}]}),Object(p.listeners)(function(n){var e=n.actions;return{triggerMigration:function(){var r=O()(m.a.mark(function s(c){var o;return m.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:o=c.migration,Object.keys(o.parameter_definitions).length>0?e.openAsyncMigrationsModal(o,"trigger","Migration triggered successfully"):e.updateMigrationStatus(o,"trigger","Migration triggered successfully");case 2:case"end":return u.stop()}},s)}));function a(s){return r.apply(this,arguments)}return a}(),resumeMigration:function(){var r=O()(m.a.mark(function s(c){var o;return m.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:o=c.migration,Object.keys(o.parameter_definitions).length>0?e.openAsyncMigrationsModal(o,"resume","Migration resume triggered successfully"):e.updateMigrationStatus(o,"resume","Migration resume triggered successfully");case 2:case"end":return u.stop()}},s)}));function a(s){return r.apply(this,arguments)}return a}(),rollbackMigration:function(){var r=O()(m.a.mark(function s(c){var o;return m.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:o=c.migration,e.updateMigrationStatus(o,"rollback","Migration rollback triggered successfully");case 2:case"end":return u.stop()}},s)}));function a(s){return r.apply(this,arguments)}return a}(),forceStopMigration:function(){var r=O()(m.a.mark(function s(c){var o;return m.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:o=c.migration,e.updateMigrationStatus(o,"force_stop","Force stop triggered successfully");case 2:case"end":return u.stop()}},s)}));function a(s){return r.apply(this,arguments)}return a}(),forceStopMigrationWithoutRollback:function(){var r=O()(m.a.mark(function s(c){var o;return m.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:o=c.migration,e.updateMigrationStatus(o,"force_stop_without_rollback","Force stop without rollback triggered successfully");case 2:case"end":return u.stop()}},s)}));function a(s){return r.apply(this,arguments)}return a}(),updateMigrationStatus:function(){var r=O()(m.a.mark(function s(c){var o,d,u,l;return m.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=c.migration,d=c.endpoint,u=c.message,h.next=3,R.b.create("/api/async_migrations/".concat(o.id,"/").concat(d),{parameters:o.parameters});case 3:l=h.sent,l.success?(T.d.success(u),e.loadAsyncMigrations()):T.d.error(l.error);case 5:case"end":return h.stop()}},s)}));function a(s){return r.apply(this,arguments)}return a}(),updateSetting:function(){var r=O()(m.a.mark(function s(c){var o,d;return m.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return o=c.settingKey,d=c.newValue,l.prev=1,l.next=4,R.b.update("/api/instance_settings/".concat(o),{value:d});case 4:T.d.success("Instance setting ".concat(o," updated")),e.loadAsyncMigrationSettings(),e.loadAsyncMigrations(),fe.b.actions.loadSystemStatus(),l.next=13;break;case 10:l.prev=10,l.t0=l.catch(1),T.d.error("Failed to trigger migration");case 13:case"end":return l.stop()}},s,null,[[1,10]])}));function a(s){return r.apply(this,arguments)}return a}(),loadAsyncMigrationErrors:function(){var r=O()(m.a.mark(function s(c){var o,d;return m.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return o=c.migrationId,l.prev=1,l.next=4,R.b.get("api/async_migrations/".concat(o,"/errors"));case 4:d=l.sent,e.loadAsyncMigrationErrorsSuccess(o,d),l.next=11;break;case 8:l.prev=8,l.t0=l.catch(1),e.loadAsyncMigrationErrorsFailure(o,l.t0);case 11:case"end":return l.stop()}},s,null,[[1,8]])}));function a(s){return r.apply(this,arguments)}return a}()}}),Object(p.events)(function(n){var e=n.actions;return{afterMount:function(){e.loadAsyncMigrations(),e.loadAsyncMigrationSettings()}}}),Object(J.actionToUrl)(function(n){var e=n.values;return{setActiveTab:function(){return"/instance/async_migrations".concat(e.activeTab===v.Management?"":"/"+e.activeTab)}}}),Object(J.urlToAction)(function(n){var e=n.actions,r=n.values;return{"/instance/async_migrations(/:tab)":function(s){var c=s.tab;c&&c!==r.activeTab&&c!==v.Management&&e.setActiveTab(c)}}})]),X=i("./frontend/src/lib/components/Tooltip.tsx"),Z=i("./frontend/src/lib/components/Spinner/Spinner.tsx"),be=i("./node_modules/@babel/runtime/helpers/slicedToArray.js"),P=i.n(be),ve=i("./node_modules/antd/es/row/index.js"),q=i("./node_modules/antd/es/col/index.js"),Me=i("./node_modules/antd/es/input/index.js"),Oe=i("./node_modules/antd/es/divider/index.js"),t=i("./node_modules/react/jsx-runtime.js");function F(n){var e=n.setting,r=Object(p.useActions)(x),a=r.updateSetting,s=Object(k.useState)(String(e.value)),c=P()(s,2),o=c[0],d=c[1];return Object(t.jsxs)("div",{children:[Object(t.jsx)("h4",{children:e.key}),Object(t.jsx)("p",{children:e.description}),Object(t.jsxs)(ve.a,{gutter:[8,8],children:[Object(t.jsx)(q.a,{span:8,children:Object(t.jsx)(Me.a,{value:o,onChange:function(l){return d(l.target.value)}})}),Object(t.jsx)(q.a,{span:16,children:Object(t.jsx)(z.a,{disabled:String(e.value)===o,type:"primary",onClick:function(){return a(e.key,o)},children:"Update"})})]}),Object(t.jsx)(Oe.a,{})]},e.key)}try{F.displayName="SettingUpdateField",F.__docgenInfo={description:"",displayName:"SettingUpdateField",props:{setting:{defaultValue:null,description:"",name:"setting",required:!0,type:{name:"InstanceSetting"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/AsyncMigrations/SettingUpdateField.tsx#SettingUpdateField"]={docgenInfo:F.__docgenInfo,name:"SettingUpdateField",path:"frontend/src/scenes/instance/AsyncMigrations/SettingUpdateField.tsx#SettingUpdateField"})}catch(n){}var _=i("./frontend/src/lib/components/LemonTable/index.ts"),V=i("./frontend/src/lib/utils.tsx"),S=i("./frontend/src/lib/components/LemonButton/index.ts"),$=i("./frontend/src/lib/components/icons.tsx");function L(n){var e=n.asyncMigration,r=Object(p.useValues)(x),a=r.asyncMigrationErrorsLoading,s=r.asyncMigrationErrors,c=Object(p.useActions)(x),o=c.loadAsyncMigrationErrors,d=[{title:"Error",dataIndex:"description"},{title:Object(t.jsx)(S.a,{icon:a[e.id]?Object(t.jsx)(Z.a,{}):Object(t.jsx)($.IconRefresh,{}),onClick:function(){return o(e.id)},type:"secondary",size:"small",children:"Refresh errors"}),render:function(l,M){return Object(t.jsx)("div",{children:Object(V.N)(M.created_at)})}}];return Object(t.jsx)(_.a,{columns:d,dataSource:s[e.id],loading:a[e.id],embedded:!0})}try{L.displayName="AsyncMigrationDetails",L.__docgenInfo={description:"",displayName:"AsyncMigrationDetails",props:{asyncMigration:{defaultValue:null,description:"",name:"asyncMigration",required:!0,type:{name:"AsyncMigration"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/AsyncMigrations/AsyncMigrationDetails.tsx#AsyncMigrationDetails"]={docgenInfo:L.__docgenInfo,name:"AsyncMigrationDetails",path:"frontend/src/scenes/instance/AsyncMigrations/AsyncMigrationDetails.tsx#AsyncMigrationDetails"})}catch(n){}var ee=i("./frontend/src/lib/components/LemonButton/More.tsx"),he=i("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),on=i("./node_modules/core-js/modules/es.object.entries.js"),K=i("./node_modules/kea-forms/lib/index.js");function ne(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),r.push.apply(r,a)}return r}function te(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ne(Object(r),!0).forEach(function(a){E()(n,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):ne(Object(r)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))})}return n}var Se=Object(p.kea)([Object(p.path)(["scenes","instance","AsyncMigrations","asyncMigrationParameterFormLogic"]),Object(p.props)({}),Object(p.key)(function(n){return n.migration.id}),Object(K.forms)(function(n){var e=n.props;return{parameters:{defaults:Ae(e),submit:function(){var r=O()(m.a.mark(function s(c){return m.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:x.actions.updateMigrationStatus(te(te({},e.migration),{},{parameters:c}),e.endpoint,e.message);case 1:case"end":return d.stop()}},s)}));function a(s){return r.apply(this,arguments)}return a}()}}})]);function Ae(n){var e={};return Object.keys(n.migration.parameter_definitions).forEach(function(r){n.migration.parameters[r]?e[r]=n.migration.parameters[r]:e[r]=n.migration.parameter_definitions[r][0]}),e}var xe=i("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),Ee=i("./frontend/src/lib/components/AnimatedCollapsible.tsx"),I=i("./frontend/src/lib/components/LemonModal/index.ts");function w(n){var e=Object(p.useActions)(x),r=e.closeAsyncMigrationsModal,a=Object(k.useState)(!0),s=P()(a,2),c=s[0],o=s[1];return Object(t.jsx)(I.a,{title:"",onClose:r,isOpen:!0,simple:!0,children:Object(t.jsxs)(K.Form,{logic:Se,props:n,formKey:"parameters",enableFormOnSubmit:!0,id:"async-migration-parameters-form",className:"LemonModal__layout",children:[Object(t.jsx)(I.a.Header,{children:Object(t.jsx)("h3",{children:"Advanced migration configuration"})}),Object(t.jsxs)(I.a.Content,{children:[Object(t.jsxs)("p",{children:["This async migration allows tuning parameters used in the async migration.",c&&Object(t.jsxs)(t.Fragment,{children:[Object(t.jsx)("br",{}),Object(t.jsx)("a",{onClick:function(){o(!c)},children:"Click here to show advanced configuration."})]})]}),Object(t.jsx)(Ee.a,{collapsed:c,children:Object.entries(n.migration.parameter_definitions).map(function(d){var u=P()(d,2),l=u[0],M=P()(u[1],2),h=M[0],W=M[1];return Object(t.jsx)(K.Field,{name:l,label:Object(t.jsx)(t.Fragment,{children:W}),children:Object(t.jsx)(xe.a,{type:typeof h=="number"?"number":"text"})},l)})})]}),Object(t.jsxs)(I.a.Footer,{children:[Object(t.jsx)(S.a,{form:"async-migration-parameters-form",type:"secondary","data-attr":"async-migration-parameters-cancel",className:"mr-2",onClick:r,children:"Cancel"}),Object(t.jsx)(S.a,{form:"async-migration-parameters-form",htmlType:"submit",type:"primary","data-attr":"async-migration-parameters-submit",children:"Run migration"})]})]})})}try{w.displayName="AsyncMigrationParametersModal",w.__docgenInfo={description:"",displayName:"AsyncMigrationParametersModal",props:{migration:{defaultValue:null,description:"",name:"migration",required:!0,type:{name:"AsyncMigration"}},endpoint:{defaultValue:null,description:"",name:"endpoint",required:!0,type:{name:"string"}},message:{defaultValue:null,description:"",name:"message",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/AsyncMigrations/AsyncMigrationParametersModal.tsx#AsyncMigrationParametersModal"]={docgenInfo:w.__docgenInfo,name:"AsyncMigrationParametersModal",path:"frontend/src/scenes/instance/AsyncMigrations/AsyncMigrationParametersModal.tsx#AsyncMigrationParametersModal"})}catch(n){}function re(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),r.push.apply(r,a)}return r}function Ce(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?re(Object(r),!0).forEach(function(a){E()(n,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))})}return n}var B=G.a.TabPane,Re={component:ae,logic:x},Te=3e3;function ae(){var n=Object(p.useValues)(D.a),e=n.user,r=Object(p.useValues)(x),a=r.asyncMigrationsLoading,s=r.activeTab,c=r.asyncMigrationSettings,o=r.isAnyMigrationRunning,d=r.activeAsyncMigrationModal,u=r.actionableMigrations,l=r.futureMigrations,M=Object(p.useActions)(x),h=M.triggerMigration,W=M.resumeMigration,Pe=M.rollbackMigration,Fe=M.forceStopMigration,Le=M.forceStopMigrationWithoutRollback,ie=M.loadAsyncMigrations,Ie=M.loadAsyncMigrationErrors,we=M.setActiveTab;Object(k.useEffect)(function(){if(o){var j=setInterval(function(){return ie()},Te);return function(){return clearInterval(j)}}},[o]);var se={title:"Migration",render:function(y,g){var f="https://github.com/PostHog/posthog/blob/master/posthog/async_migrations/migrations/"+g.name+".py";return Object(t.jsxs)(t.Fragment,{children:[Object(t.jsx)("div",{className:"row-name",children:Object(t.jsx)("a",{href:f,children:g.name})}),Object(t.jsx)("div",{className:"row-description",children:g.description})]})}},Ne={title:"Progress",render:function(y,g){var f=g.progress;return Object(t.jsx)("div",{children:Object(t.jsx)(le.a,{percent:f})})}},oe={title:"Status",render:function(y,g){var f=g.status,C=f===b.Running?"success":f===b.Errored||f===b.FailedAtStartup?"danger":f===b.Starting||f===b.RolledBack?"warning":"default";return Object(t.jsx)(he.a,{type:C,className:"uppercase",children:ye[f]})}},ke={title:"Last operation index",render:function(y,g){return Object(t.jsx)("div",{children:g.current_operation_index})}},De={title:"Last query ID",render:function(y,g){return Object(t.jsx)("div",{children:Object(t.jsx)("small",{children:g.current_query_id})})}},Ve={title:"Started at",render:function(y,g){var f=g.started_at;return Object(t.jsx)("div",{children:Object(V.N)(f)})}},$e={title:"Finished at",render:function(y,g){var f=g.finished_at;return Object(t.jsx)("div",{children:Object(V.N)(f)})}},Ke={title:"",render:function(y,g){var f=g.status;return Object(t.jsx)("div",{children:f===b.NotStarted||f===b.FailedAtStartup?Object(t.jsx)(X.a,{title:"Start",children:Object(t.jsx)(z.a,{type:"link",icon:Object(t.jsx)(de.a,{}),onClick:function(){return h(g)},children:"Run"})}):f===b.Starting||f===b.Running?Object(t.jsx)(ee.a,{overlay:Object(t.jsxs)(t.Fragment,{children:[Object(t.jsx)(S.a,{status:"stealth",onClick:function(){return Fe(g)},fullWidth:!0,children:"Stop and rollback"}),Object(t.jsx)(S.a,{status:"stealth",onClick:function(){return Le(g)},fullWidth:!0,children:"Stop"})]})}):f===b.CompletedSuccessfully?Object(t.jsx)(t.Fragment,{}):f===b.Errored?Object(t.jsx)(ee.a,{overlay:Object(t.jsxs)(t.Fragment,{children:[Object(t.jsx)(S.a,{status:"stealth",onClick:function(){return W(g)},fullWidth:!0,children:"Resume"}),Object(t.jsx)(S.a,{status:"stealth",onClick:function(){return Pe(g)},fullWidth:!0,children:"Rollback"})]})}):f===b.RolledBack?Object(t.jsx)(X.a,{title:"Restart",children:Object(t.jsx)(S.a,{status:"stealth",icon:Object(t.jsx)($.IconReplay,{}),onClick:function(){return h(g)},fullWidth:!0})}):null})}},Be={title:"Minimum PostHog version",render:function(y,g){return Object(t.jsx)("div",{children:g.posthog_min_version})}},We={title:"Maximum PostHog version",render:function(y,g){return Object(t.jsx)("div",{children:g.posthog_max_version})}},U={};U[v.FutureMigrations]=[se,oe,Be,We],U[v.Management]=[se,Ne,oe,ke,De,Ve,$e,Ke];var Y={};Y[v.FutureMigrations]=l,Y[v.Management]=u;var Ue={expandedRowRender:function(y){return y&&Object(t.jsx)(L,{asyncMigration:y})},rowExpandable:function(y){return y.error_count>0},onRowExpand:function(y){Ie(y.id)}};return Object(t.jsx)("div",{children:e!=null&&e.is_staff?Object(t.jsxs)(t.Fragment,{children:[Object(t.jsx)(H.a,{title:"Async Migrations",caption:Object(t.jsxs)(t.Fragment,{children:[Object(t.jsx)("p",{children:"Manage async migrations in your instance."}),Object(t.jsxs)("p",{children:["Read about async migrations on our"," ",Object(t.jsx)("a",{href:"https://posthog.com/docs/self-host/configure/async-migrations/overview",children:"dedicated docs page"}),"."]})]})}),Object(t.jsxs)(G.a,{activeKey:s,onTabClick:function(y){return we(y)},children:[Object(t.jsx)(B,{tab:"Management (".concat(u.length,")")},v.Management),l.length>0&&Object(t.jsx)(B,{tab:"Future Migrations (".concat(l.length,")")},v.FutureMigrations),Object(t.jsx)(B,{tab:"Settings"},v.Settings)]}),[v.Management,v.FutureMigrations].includes(s)?Object(t.jsxs)(t.Fragment,{children:[Object(t.jsx)("div",{className:"mb-4 float-right",children:Object(t.jsx)(S.a,{icon:a?Object(t.jsx)(Z.a,{}):Object(t.jsx)($.IconRefresh,{}),onClick:ie,type:"secondary",size:"small",children:"Refresh"})}),Object(t.jsx)(ue.b,{}),Object(t.jsx)(_.a,{pagination:{pageSize:10},loading:a,columns:U[s],dataSource:Y[s],expandable:Ue}),d?Object(t.jsx)(w,Ce({},d)):null]}):s===v.Settings?Object(t.jsxs)(t.Fragment,{children:[Object(t.jsx)("br",{}),c.map(function(j){return Object(t.jsx)("div",{children:Object(t.jsx)(F,{setting:j})},j.key)})]}):null]}):Object(t.jsx)(H.a,{title:"Async Migrations",caption:Object(t.jsxs)(t.Fragment,{children:[Object(t.jsx)("p",{children:"Only users with staff access can manage async migrations. Please contact your instance admin."}),Object(t.jsxs)("p",{children:["If you're an admin and don't have access, set ",Object(t.jsx)("code",{children:"is_staff=true"})," for your user on the PostgreSQL ",Object(t.jsx)("code",{children:"posthog_user"})," table."]})]})})})}}}]);
