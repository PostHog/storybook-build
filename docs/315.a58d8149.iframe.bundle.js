(window.webpackJsonp=window.webpackJsonp||[]).push([[315],{"./frontend/src/scenes/actions/Action.tsx":function(tt,Y,o){"use strict";o.r(Y),o.d(Y,"scene",function(){return Qe}),o.d(Y,"Action",function(){return D});var nt=o("./node_modules/core-js/modules/es.array.concat.js"),ve=o("./node_modules/@babel/runtime/helpers/defineProperty.js"),R=o.n(ve),fe=o("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ee=o.n(fe),st=o("./node_modules/core-js/modules/es.array.filter.js"),ot=o("./node_modules/core-js/modules/es.object.to-string.js"),at=o("./node_modules/core-js/modules/es.array.includes.js"),it=o("./node_modules/core-js/modules/es.string.includes.js"),rt=o("./node_modules/core-js/modules/es.function.name.js"),ct=o("./node_modules/core-js/modules/es.array.map.js"),lt=o("./node_modules/core-js/modules/es.object.keys.js"),dt=o("./node_modules/core-js/modules/es.symbol.js"),ut=o("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),mt=o("./node_modules/core-js/modules/web.dom-collections.for-each.js"),jt=o("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),N=o("./frontend/src/lib/utils.tsx"),M=o("./frontend/src/lib/components/Link.tsx"),p=o("./node_modules/kea/lib/index.esm.js"),be=o("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),G=o.n(be),ge=o("./node_modules/@babel/runtime/regenerator/index.js"),L=o.n(ge),pt=o("./node_modules/core-js/modules/es.array.iterator.js"),ht=o("./node_modules/core-js/modules/web.dom-collections.iterator.js"),vt=o("./node_modules/core-js/modules/es.regexp.exec.js"),ft=o("./node_modules/core-js/modules/es.string.split.js"),E=o("./frontend/src/lib/api.ts"),Oe=o("./frontend/src/models/actionsModel.ts"),te=o("./frontend/src/lib/components/lemonToast.tsx"),xe=o("./node_modules/kea-loaders/lib/index.js"),ne=o("./node_modules/kea-forms/lib/index.js"),U=o("./node_modules/kea-router/lib/index.js"),x=o("./frontend/src/scenes/urls.ts"),ye=o("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts"),se=o("./frontend/src/models/tagsModel.ts"),e=o("./node_modules/react/jsx-runtime.js");function oe(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function I(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?oe(Object(s),!0).forEach(function(a){R()(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):oe(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}var ae=Object(p.kea)([Object(p.path)(["scenes","actions","actionEditLogic"]),Object(p.props)({}),Object(p.key)(function(n){return n.id||"new"}),Object(p.connect)({actions:[se.a,["loadTags"]]}),Object(p.actions)({setAction:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:t,options:s}},setCreateNew:function(t){return{createNew:t}},actionAlreadyExists:function(t){return{actionId:t}},deleteAction:!0}),Object(p.connect)({actions:[Oe.a,["loadActions"],ye.c,["loadEventDefinitions"]]}),Object(p.reducers)({createNew:[!1,{setCreateNew:function(t,s){var a=s.createNew;return a}}]}),Object(ne.forms)(function(n){var t=n.actions,s=n.props;return{action:{defaults:I({},s.action),errors:function(i){var l=i.name;return{name:l?null:"You need to set a name"}},submit:function(i){t.saveAction(i)}}}}),Object(xe.loaders)(function(n){var t=n.props,s=n.values,a=n.actions;return{actionCount:{loadActionCount:function(){var i=G()(L.a.mark(function d(){return L.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.id){r.next=6;break}return r.next=3,E.b.actions.getCount(t.id);case 3:r.t0=r.sent,r.next=7;break;case 6:r.t0=0;case 7:return r.abrupt("return",r.t0);case 8:case"end":return r.stop()}},d)}));function l(){return i.apply(this,arguments)}return l}()},action:[I({},t.action),{setAction:function(l){var d=l.action,h=l.options.merge;return h?I(I({},s.action),d):d},saveAction:function(){var i=G()(L.a.mark(function d(h,r){var c,g;return L.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(c=I({},h),c.steps=c.steps?c.steps.filter(function(w){return w.event}):[],u.prev=2,!c.id){u.next=9;break}return u.next=6,E.b.actions.update(c.id,c,t.temporaryToken);case 6:c=u.sent,u.next=12;break;case 9:return u.next=11,E.b.actions.create(c,t.temporaryToken);case 11:c=u.sent;case 12:r(),u.next=22;break;case 15:if(u.prev=15,u.t0=u.catch(2),u.t0.code!=="unique"){u.next=21;break}return g=u.t0.detail.split(" ").pop(),te.d.error(Object(e.jsxs)(e.Fragment,{children:["Action with this name already exists."," ",Object(e.jsx)(M.a,{to:x.a.action(g),children:"Click here to edit."})]})),u.abrupt("return",c);case 21:throw u.t0;case 22:return te.d.success("Action saved"),t.onSave(c),a.loadEventDefinitions(null),a.loadActions(),a.loadTags(),u.abrupt("return",c);case 28:case"end":return u.stop()}},d,null,[[2,15]])}));function l(d,h){return i.apply(this,arguments)}return l}()}]}}),Object(p.listeners)(function(n){var t=n.values,s=n.actions;return{deleteAction:function(){Object(N.x)({endpoint:E.b.actions.determineDeleteEndpoint(),object:t.action,callback:function(){U.router.actions.push(x.a.actions()),s.loadActions()}})}}}),Object(p.afterMount)(function(n){var t=n.actions,s=n.props;s.id?t.loadActionCount():t.setAction({name:"",steps:[{isNew:Object(N.Jb)()}]},{merge:!1})})]),bt=o("./frontend/src/scenes/actions/Actions.scss"),Ae=o("./frontend/src/scenes/actions/EventName.tsx"),Ce=o("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Se=o("./frontend/src/lib/components/Tooltip.tsx"),$=o("./frontend/src/scenes/actions/hints.tsx"),ie=o("./node_modules/antd/es/col/index.js"),A=o("./node_modules/antd/es/radio/index.js"),re=o("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),C=o("./frontend/@posthog/lemon-ui/src/index.ts"),J=o("./frontend/src/lib/components/icons.tsx"),Le=o("./frontend/src/lib/components/LemonDialog/index.ts"),Te=o("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),Ne=o("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),H=o("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx");function ce(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function b(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?ce(Object(s),!0).forEach(function(a){R()(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):ce(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}var le="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function K(n){var t=n.step,s=n.actionId,a=n.isOnlyStep,i=n.index,l=n.identifier,d=n.onDelete,h=n.onChange,r=function(g){h(g)};return Object(e.jsx)(ie.a,{span:24,md:12,children:Object(e.jsxs)("div",{className:"rounded border p-4 relative h-full",children:[i>0&&Object(e.jsx)("div",{className:"stateful-badge pos-center-end or",children:"OR"}),Object(e.jsxs)("div",{className:"space-y-4",children:[Object(e.jsxs)("div",{className:"flex items-center justify-between",children:[Object(e.jsxs)("b",{children:["Match Group #",i+1]}),!a&&Object(e.jsx)(C.LemonButton,{status:"primary-alt",icon:Object(e.jsx)(J.IconClose,{}),size:"small","aria-label":"delete",onClick:d})]}),Object(e.jsx)(Ie,{step:t,sendStep:r}),t.event==="$autocapture"&&Object(e.jsx)(Ee,{step:t,sendStep:r,actionId:s}),t.event!=null&&t.event!=="$autocapture"&&t.event!=="$pageview"&&Object(e.jsxs)("div",{className:"space-y-1",children:[Object(e.jsx)(H.a,{children:"Event name"}),Object(e.jsx)(Ae.a,{value:t.event,onChange:function(g){return r(b(b({},t),{},{event:g||""}))}}),Object(e.jsxs)("small",{children:[Object(e.jsx)(C.Link,{to:"https://posthog.com/docs/libraries",target:"_blank",children:"See documentation"})," ","on how to send custom events in lots of languages."]})]}),t.event==="$pageview"&&Object(e.jsxs)("div",{children:[Object(e.jsx)(P,{step:t,sendStep:r,item:"url",extra_options:Object(e.jsx)(de,{step:t,sendStep:r}),label:"URL"}),t.url_matching&&t.url_matching in $.a&&Object(e.jsx)("small",{children:$.a[t.url_matching]})]}),t.event&&Object(e.jsxs)("div",{className:"mt-6 space-y-2",children:[Object(e.jsx)("h3",{children:"Filters"}),(!t.properties||t.properties.length===0)&&Object(e.jsx)("div",{className:"text-muted",children:"This match group has no additional filters."}),Object(e.jsx)(Ce.a,{propertyFilters:t.properties,pageKey:l,eventNames:t.event?[t.event]:[],onChange:function(g){r(b(b({},t),{},{properties:g}))},showConditionBadge:!0})]})]})]})})}function P(n){var t=function(a){return n.sendStep(b(b({},n.step),{},R()({},n.item,a||null)))};return Object(e.jsxs)("div",{className:"space-y-1",children:[Object(e.jsxs)(H.a,{children:[n.label," ",n.extra_options]}),n.caption&&Object(e.jsx)("div",{className:"action-step-caption",children:n.caption}),n.item==="selector"?Object(e.jsx)(C.LemonTextArea,{onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}):Object(e.jsx)(C.LemonInput,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder})]})}var Q=function(){return Object(e.jsx)("div",{className:"text-center my-2",children:Object(e.jsx)("span",{className:"stateful-badge and",children:"AND"})})};function Ee(n){var t=n.step,s=n.actionId,a=n.sendStep,i=function(){Le.a.open({title:"Select an element",description:s?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",content:Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(Te.a,{actionId:s,type:Ne.a.TOOLBAR_URLS})}),primaryButton:{children:"Close",type:"secondary"}})};return Object(e.jsxs)("div",{className:"space-y-4",children:[Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)(C.LemonButton,{size:"small",type:"secondary",onClick:i,sideIcon:Object(e.jsx)(J.IconOpenInApp,{}),children:"Select element on site"}),Object(e.jsx)(C.Link,{to:"".concat(le,"#autocapture-based-actions"),target:"_blank",children:"See documentation."})]}),Object(e.jsx)(P,{step:t,sendStep:a,item:"href",label:"Link target equals",caption:Object(e.jsxs)(e.Fragment,{children:["If your element is a link, the location that the link opens (",Object(e.jsx)("code",{children:"href"})," tag)"]})}),Object(e.jsx)(Q,{}),Object(e.jsx)(P,{step:t,sendStep:a,item:"text",label:"Text equals",caption:"Text content inside your element"}),Object(e.jsx)(Q,{}),Object(e.jsx)(P,{step:t,sendStep:a,item:"selector",label:Object(e.jsxs)(e.Fragment,{children:["HTML selector matches",Object(e.jsx)(Se.a,{title:"Click here to learn more about supported selectors",children:Object(e.jsx)(C.Link,{to:"".concat(le,"#matching-selectors"),target:"_blank",children:Object(e.jsx)(re.a,{})})})]}),placeholder:'button[data-attr="my-id"]',caption:Object(e.jsxs)("span",{children:["CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",Object(e.jsx)("code",{className:"code",children:'[data-attr="signup"]'})]})}),Object(e.jsx)(Q,{}),Object(e.jsx)(P,{step:t,sendStep:a,item:"url",extra_options:Object(e.jsx)(de,{step:t,sendStep:a}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(t==null?void 0:t.url_matching)&&t.url_matching in $.a&&Object(e.jsx)("small",{children:$.a[t.url_matching]})]})}function Ie(n){var t=n.step,s=n.sendStep,a=function(l){var d=l.target.value;d==="$autocapture"?s(b(b({},t),{},{event:"$autocapture"})):d==="event"?s(b(b({},t),{},{event:""})):d==="$pageview"&&s(b(b({},t),{},{event:"$pageview",url:t.url}))};return Object(e.jsx)("div",{className:"type-switcher",children:Object(e.jsxs)(A.a.Group,{buttonStyle:"solid",onChange:a,value:t.event==="$autocapture"||t.event==="$pageview"||t.event===void 0?t.event:"event",children:[Object(e.jsx)(A.a.Button,{value:"$autocapture",children:"Autocapture"}),Object(e.jsx)(A.a.Button,{value:"event",children:"Custom event"}),Object(e.jsx)(A.a.Button,{value:"$pageview",children:"Page view"})]})})}function de(n){var t=n.step,s=n.sendStep,a=function(l){s(b(b({},t),{},{url_matching:l.target.value}))};return Object(e.jsxs)(A.a.Group,{buttonStyle:"solid",onChange:a,value:t.url_matching||"contains",size:"small",children:[Object(e.jsx)(A.a.Button,{value:"contains",children:"contains"}),Object(e.jsx)(A.a.Button,{value:"regex",children:"matches regex"}),Object(e.jsx)(A.a.Button,{value:"exact",children:"matches exactly"})]})}try{K.displayName="ActionStep",K.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:K.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(n){}var Pe=o("./node_modules/antd/es/row/index.js"),Fe=o("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),De=o("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),we=o("./frontend/src/lib/components/PageHeader.tsx"),Ve=o("./frontend/src/scenes/teamLogic.tsx"),ue=o("./frontend/src/lib/components/EditableField/EditableField.tsx"),Be=o("./frontend/src/types.ts"),Re=o("./frontend/src/scenes/userLogic.ts"),Me=o("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),S=o("./frontend/src/lib/forms/Field.tsx"),F=o("./frontend/src/lib/components/LemonButton/index.ts"),Ue=o("./frontend/src/lib/components/LemonCheckbox/index.ts"),$e=o("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function me(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function Ke(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?me(Object(s),!0).forEach(function(a){R()(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):me(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}function z(n){var t=n.action,s=n.id,a=n.onSave,i=n.temporaryToken,l={id:s,action:t,onSave:function(m){return a(m)},temporaryToken:i},d=ae(l),h=Object(p.useValues)(d),r=h.action,c=h.actionLoading,g=h.actionCount,k=h.actionCountLoading,u=Object(p.useActions)(d),w=u.submitAction,W=u.deleteAction,Xe=Object(p.useValues)(Ve.a),Z=Xe.currentTeam,We=Object(p.useValues)(Re.a),Ze=We.hasAvailableFeature,qe=Object(p.useValues)(se.a),_e=qe.tags,q=Z==null?void 0:Z.slack_incoming_webhook,pe=function(){return Object(e.jsx)(F.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",onClick:function(){W()},children:"Delete"})},he=function(){return Object(e.jsx)(F.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",onClick:function(){U.router.actions.push(x.a.actions())},children:"Cancel"})};return Object(e.jsx)("div",{className:"action-edit-container",children:Object(e.jsxs)(ne.Form,{logic:ae,props:l,formKey:"action",enableFormOnSubmit:!0,children:[Object(e.jsx)(we.a,{title:Object(e.jsx)(S.a,{name:"name",children:function(m){var j=m.value,v=m.onChange;return Object(e.jsx)(ue.a,{name:"name",value:j||"",placeholder:"Name this action",onChange:s?void 0:v,onSave:function(O){v(O),w()},mode:s?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(s?"edit":"create"),className:"action-name"})}}),caption:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(S.a,{name:"description",children:function(m){var j=m.value,v=m.onChange;return Object(e.jsx)(ue.a,{multiline:!0,name:"description",value:j||"",placeholder:"Description (optional)",onChange:s?void 0:v,onSave:function(O){v(O),w()},mode:s?void 0:"edit","data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!Ze(Be.e.INGESTION_TAXONOMY)})}}),Object(e.jsx)(S.a,{name:"tags",children:function(m){var j=m.value,v=m.onChange;return Object(e.jsx)(Me.a,{tags:j!=null?j:[],onChange:function(O,_){return v(_)},className:"action-tags",saving:c,tagsAvailable:_e.filter(function(f){var O;return!((O=r.tags)!==null&&O!==void 0&&O.includes(f))})})}})]}),buttons:Object(e.jsxs)(e.Fragment,{children:[s?Object(e.jsx)(F.a,{type:"secondary",to:Object(U.combineUrl)(x.a.sessionRecordings(),{filters:{actions:[{id:s,type:"actions",order:0,name:r.name}]}}).url,sideIcon:Object(e.jsx)(J.IconPlayCircle,{}),"data-attr":"action-view-recordings",children:"View recordings"}):null,s?pe():he()]})}),s&&Object(e.jsx)("div",{className:"input-set",children:Object(e.jsx)("div",{children:Object(e.jsxs)("span",{className:"text-muted mb-2",children:[k&&Object(e.jsx)(Fe.a,{}),g!==null&&g>-1&&Object(e.jsxs)(e.Fragment,{children:["This action matches ",Object(e.jsx)("b",{children:Object(N.p)(g)})," events in the last 3 months"]})]})})}),Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Match groups"}),Object(e.jsxs)("div",{children:["Your action will be triggered whenever ",Object(e.jsx)("b",{children:"any of your match groups"})," are received."," ",Object(e.jsx)(M.a,{to:"https://posthog.com/docs/features/actions",target:"_blank",children:Object(e.jsx)(re.a,{})})]}),Object(e.jsx)(S.a,{name:"steps",children:function(m){var j=m.onChange;return Object(e.jsx)("div",{className:"flex justify-end mb-2",children:Object(e.jsx)(F.a,{onClick:function(){return j([].concat(ee()(r.steps||[]),[{isNew:Object(N.Jb)()}]))},size:"small",type:"secondary",children:"Add another match group"})})}}),Object(e.jsx)(S.a,{name:"steps",children:function(m){var j=m.value,v=m.onChange;return Object(e.jsxs)(Pe.a,{gutter:[24,24],children:[Object(e.jsx)(e.Fragment,{children:j.map(function(f,O){var _=String(JSON.stringify(f));return Object(e.jsx)(K,{identifier:_,index:O,step:f,actionId:r.id||0,isOnlyStep:!!j&&j.length===1,onDelete:function(){var V,T=f.id?"id":"isNew";v((V=j==null?void 0:j.filter(function(B){return B[T]!==f[T]}))!==null&&V!==void 0?V:[])},onChange:function(V){var T;v((T=j==null?void 0:j.map(function(B){return f.id&&B.id==f.id||f.isNew&&B.isNew===f.isNew?Ke({id:f.id,isNew:f.isNew},V):B}))!==null&&T!==void 0?T:[])}},O)})}),Object(e.jsx)(ie.a,{span:24,md:12,children:Object(e.jsx)("div",{className:"match-group-add-skeleton",onClick:function(){v([].concat(ee()(r.steps||[]),[{isNew:Object(N.Jb)()}]))},children:Object(e.jsx)(De.a,{style:{fontSize:28,color:"#666666"}})})})]})}})]}),Object(e.jsxs)("div",{className:"my-8",children:[Object(e.jsx)(S.a,{name:"post_to_slack",children:function(m){var j=m.value,v=m.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ue.a,{id:"webhook-checkbox",checked:!!j,onChange:v,disabled:!q,label:Object(e.jsx)(e.Fragment,{children:"Post to webhook when this action is triggered."})}),Object(e.jsx)("p",{className:"pl-7",children:Object(e.jsxs)(M.a,{to:"/project/settings#webhook",children:[q?"Configure":"Enable"," this integration in Project Settings."]})})]})}}),r.post_to_slack&&Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(S.a,{name:"slack_message_format",children:function(m){var j=m.value,v=m.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(H.a,{showOptional:!0,children:"Message format"}),Object(e.jsx)($e.a,{placeholder:"Default: [action.name] triggered by [person]",value:j,onChange:v,disabled:!q||!r.post_to_slack,"data-attr":"edit-slack-message-format"}),Object(e.jsx)("small",{children:Object(e.jsx)(M.a,{to:"https://posthog.com/docs/integrate/webhooks/message-formatting",target:"_blank",children:"See documentation on how to format webhook messages."})})]})}})})]}),Object(e.jsxs)("div",{className:"flex justify-end gap-2",children:[s?pe():he(),Object(e.jsx)(F.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:c,children:"Save"})]})]})})}try{z.displayName="ActionEdit",z.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:z.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(n){}var ze=o("./frontend/src/scenes/events/index.ts"),ke=o("./frontend/src/lib/dayjs.ts"),Ye=o("./frontend/src/lib/components/Spinner/Spinner.tsx"),X=Object(p.kea)({props:{},key:function(t){return t.id||"new"},path:function(t){return["scenes","actions","actionLogic",t]},actions:function(){return{checkIsFinished:function(s){return{action:s}},setPollTimeout:function(s){return{pollTimeout:s}},setIsComplete:function(s){return{isComplete:s}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(s,a){var i=a.pollTimeout;return i}}],isComplete:[!1,{setIsComplete:function(s,a){var i=a.isComplete;return i}}]}},selectors:{breadcrumbs:[function(n){return[n.action]},function(n){return[{name:"Data Management",path:x.a.eventDefinitions()},{name:"Actions",path:x.a.actions()},{name:(n==null?void 0:n.name)||"Unnamed",path:n?x.a.action(n.id):void 0}]}]},loaders:function(t){var s=t.actions,a=t.props;return{action:{loadAction:function(){var i=G()(L.a.mark(function d(){var h;return L.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s.setIsComplete(!1),a.id){c.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return c.next=5,E.b.actions.get(a.id);case 5:return h=c.sent,s.checkIsFinished(h),c.abrupt("return",h);case 8:case"end":return c.stop()}},d)}));function l(){return i.apply(this,arguments)}return l}()}}},listeners:function(t){var s=t.actions,a=t.values;return{checkIsFinished:function(l){var d=l.action;d.is_calculating?s.setPollTimeout(setTimeout(function(){return s.loadAction()},1e3)):(s.setIsComplete(new Date),a.pollTimeout&&clearTimeout(a.pollTimeout))}}},events:function(t){var s=t.values,a=t.actions,i=t.props;return{afterMount:function(){i.id&&a.loadAction()},beforeUnmount:function(){s.pollTimeout&&clearTimeout(s.pollTimeout)}}}}),Ge=o("./frontend/src/queries/Query/Query.tsx"),je=o("./frontend/src/queries/schema.ts"),Je=o("./frontend/src/lib/logic/featureFlagLogic.ts"),He=o("./frontend/src/lib/constants.tsx"),Qe={logic:X,component:D,paramsToProps:function(t){var s=t.params.id;return{id:parseInt(s)}}};function D(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.id,s={action_id:t},a=Object(p.useActions)(U.router),i=a.push,l=Object(p.useValues)(X),d=l.action,h=l.isComplete,r=Object(p.useActions)(X),c=r.loadAction,g=Object(p.useValues)(Je.a),k=g.featureFlags,u=k[He.i.DATA_EXPLORATION_LIVE_EVENTS];return Object(e.jsxs)(e.Fragment,{children:[(!t||d)&&Object(e.jsx)(z,{id:t,action:d,onSave:function(W){t||i(x.a.action(W.id)),c()}}),t&&(h?Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("p",{children:["This is the list of ",Object(e.jsx)("strong",{children:"recent"})," events that match this action.",d!=null&&d.last_calculated_at?Object(e.jsxs)(e.Fragment,{children:[" ","Last calculated: ",Object(e.jsx)("b",{children:Object(ke.a)(d.last_calculated_at).fromNow()}),"."]}):""]}),Object(e.jsx)("div",{className:"pt-4 border-t"}),u?Object(e.jsx)(Ge.a,{query:{kind:je.a.DataTableNode,source:{kind:je.a.EventsNode,actionId:t},showReload:!0,showColumnConfigurator:!0,showExport:!0}}):Object(e.jsx)(ze.b,{fixedFilters:s,sceneUrl:x.a.action(t),fetchMonths:3,pageKey:"action-".concat(t,"-").concat(JSON.stringify(s)),showEventFilter:!1})]}):Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsx)(Ye.a,{className:"mr-4"}),"Calculating action, please hold on."]})]}))]})}try{D.displayName="Action",D.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:D.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(n){}}}]);
