"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[83694],{"../../frontend/src/scenes/notebooks/NotebooksScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{NotebooksScene:()=>NotebooksScene,scene:()=>scene});var lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.33.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),AccessControlAction=__webpack_require__("../../frontend/src/lib/components/AccessControlAction.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),file_utils=__webpack_require__("../../frontend/src/lib/utils/file-utils.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),types=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/types.ts"),notebooksModel=__webpack_require__("../../frontend/src/models/notebooksModel.ts"),src_types=__webpack_require__("../../frontend/src/types.ts");let DEFAULT_FILTERS={search:"",createdBy:null,contains:[]},DEFAULT_SORTING={columnKey:"-created_at",order:1},notebooksTableLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","notebooks","NotebooksTable","notebooksTableLogic"]),(0,index_esm.actions)({loadNotebooks:!0,setFilters:filters=>({filters}),tableSortingChanged:sorting=>({sorting}),setPage:page=>({page})}),(0,index_esm.connect)(()=>({values:[notebooksModel.L,["notebookTemplates"]],actions:[notebooksModel.L,["deleteNotebookSuccess"]]})),(0,index_esm.reducers)({filters:[DEFAULT_FILTERS,{setFilters:(state,_ref)=>{let{filters}=_ref;return(0,utils.hO)({...state,...filters})}}],sortValue:[null,{setSortValue:(_,_ref2)=>{let{sortValue}=_ref2;return sortValue}}],page:[1,{setPage:(_,_ref3)=>{let{page}=_ref3;return page},setFilters:()=>1,setSortValue:()=>1}],tableSorting:[DEFAULT_SORTING,{persist:!0},{tableSortingChanged:(_,_ref4)=>{let{sorting}=_ref4;return sorting||DEFAULT_SORTING}}]}),(0,kea_loaders_lib.loaders)(_ref5=>{let{values}=_ref5;return{notebooksResponse:[null,{loadNotebooks:async(_,breakpoint)=>{var _values$sortValue;await breakpoint(100);let contains=values.filters?.contains.map(type=>({type,attrs:{}}))||void 0,createdByForQuery=values.filters?.createdBy===DEFAULT_FILTERS.createdBy?void 0:values.filters?.createdBy,res=await api.ZP.notebooks.list({contains,created_by:null!=createdByForQuery?createdByForQuery:void 0,search:values.filters?.search||void 0,order:null!==(_values$sortValue=values.sortValue)&&void 0!==_values$sortValue?_values$sortValue:"-last_modified_at",limit:50,offset:(values.page-1)*50});return breakpoint(),res}}]}}),(0,index_esm.listeners)(_ref6=>{let{actions}=_ref6;return{setFilters:()=>actions.loadNotebooks(),setSortValue:()=>actions.loadNotebooks(),setPage:()=>actions.loadNotebooks(),deleteNotebookSuccess:()=>actions.loadNotebooks()}}),(0,index_esm.selectors)(_ref7=>{let{actions}=_ref7;return{notebooksAndTemplates:[s=>[s.notebooks,s.notebookTemplates,s.filters],(notebooks,notebookTemplates,filters)=>[...(0,utils.h0)(filters,DEFAULT_FILTERS)?notebookTemplates:[],...notebooks]],notebooks:[s=>[s.notebooksResponse],notebooksResponse=>notebooksResponse?.results||[]],pagination:[s=>[s.page,s.notebooksResponse],(page,notebooksResponse)=>{var _notebooksResponse$co;return{controlled:!0,pageSize:50,currentPage:page,entryCount:null!==(_notebooksResponse$co=notebooksResponse?.count)&&void 0!==_notebooksResponse$co?_notebooksResponse$co:0,onBackward:()=>actions.setPage(page-1),onForward:()=>actions.setPage(page+1)}}]}}),(0,index_esm.selectors)({breadcrumbs:[()=>[],()=>[{key:"notebooks",name:"Notebooks",iconType:"notebook"}]],[types.f]:[()=>[],()=>({activity_scope:src_types.jc.NOTEBOOK})]})]);var urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),MemberSelect=__webpack_require__("../../frontend/src/lib/components/MemberSelect.tsx"),useOnMountEffect=__webpack_require__("../../frontend/src/lib/hooks/useOnMountEffect.ts"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonMenu=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/index.ts"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.275.3_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),LemonInputSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInputSelect/index.ts"),notebooks_types=__webpack_require__("../../frontend/src/scenes/notebooks/types.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let fromNodeTypeToLabel={[notebooks_types.C.FeatureFlag]:"Feature flags",[notebooks_types.C.FeatureFlagCodeExample]:"Feature flag Code Examples",[notebooks_types.C.Experiment]:"Experiments",[notebooks_types.C.EarlyAccessFeature]:"Early Access Features",[notebooks_types.C.Survey]:"Surveys",[notebooks_types.C.Image]:"Images",[notebooks_types.C.Person]:"Persons",[notebooks_types.C.Query]:"Queries",[notebooks_types.C.Recording]:"Session recordings",[notebooks_types.C.RecordingPlaylist]:"Session replay playlists",[notebooks_types.C.ReplayTimestamp]:"Session recording comments",[notebooks_types.C.Cohort]:"Cohorts",[notebooks_types.C.Group]:"Groups",[notebooks_types.C.TaskCreate]:"Task suggestions",[notebooks_types.C.LLMTrace]:"LLM traces",[notebooks_types.C.Issues]:"Issues",[notebooks_types.C.UsageMetrics]:"Usage metrics"};function ContainsTypeFilters(_ref){let{filters,setFilters}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Containing:"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",placeholder:"Any content",options:Object.entries(fromNodeTypeToLabel).filter(entry=>""!==entry[1]).map(_ref2=>{let[type,label]=_ref2;return{key:type,label}}),value:filters.contains,onChange:newValue=>{dist_module.ZP.capture("notebook containing filter applied"),setFilters({contains:newValue.map(x=>x)})},"data-attr":"notebooks-list-contains-filters"})]})}var notebookPanelLogic=__webpack_require__("../../frontend/src/scenes/notebooks/NotebookPanel/notebookPanelLogic.ts");function titleColumn(){return{title:"Title",dataIndex:"title",width:"100%",render:function Render(title,_ref){let{short_id,is_template}=_ref;return(0,jsx_runtime.jsxs)(Link.r,{"data-attr":"notebook-title",to:urls.j.notebook(short_id),className:"font-semibold flex items-center gap-2",children:[title||"Untitled",is_template&&(0,jsx_runtime.jsx)(src.oe,{type:"highlight",children:"TEMPLATE"})]})},sorter:(a,b)=>{var _a$title,_b$title;return(null!==(_a$title=a.title)&&void 0!==_a$title?_a$title:"Untitled").localeCompare(null!==(_b$title=b.title)&&void 0!==_b$title?_b$title:"Untitled")}}}function NotebooksTable(){let{notebooksAndTemplates,filters,notebooksResponseLoading,notebookTemplates,tableSorting,pagination}=(0,index_esm.useValues)(notebooksTableLogic),{loadNotebooks,setFilters,tableSortingChanged}=(0,index_esm.useActions)(notebooksTableLogic),{selectNotebook}=(0,index_esm.useActions)(notebookPanelLogic.F);(0,useOnMountEffect.x)(loadNotebooks);let columns=[titleColumn(),(0,columnUtils.JB)(),(0,columnUtils.pD)("created_at","Created"),(0,columnUtils.pD)("last_modified_at","Last modified"),{render:function Render(_,notebook){return notebook.is_template?null:(0,jsx_runtime.jsx)(LemonMenu.d,{items:[{label:"Delete",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",onClick:()=>{notebooksModel.L.actions.deleteNotebook(notebook.short_id,notebook?.title)}}],children:(0,jsx_runtime.jsx)(src.Jp,{"aria-label":"more",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{}),size:"small"})})}}];return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",action:{onClick:()=>{selectNotebook(notebookTemplates[0].short_id)},children:"Get started"},dismissKey:"notebooks-preview-banner",children:[(0,jsx_runtime.jsx)("b",{children:"Welcome to Notebooks"})," - a great way to bring Insights, Replays, Feature Flags and many more PostHog products together into one place."]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between gap-2 flex-wrap",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search for notebooks",onChange:s=>{setFilters({search:s})},value:filters.search,"data-attr":"notebooks-search"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,jsx_runtime.jsx)(ContainsTypeFilters,{filters:filters,setFilters:setFilters}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Created by:"}),(0,jsx_runtime.jsx)(MemberSelect.a,{value:filters.createdBy,onChange:user=>setFilters({createdBy:user?.uuid||null})})]})]})]}),(0,jsx_runtime.jsx)(LemonTable.g,{"data-attr":"notebooks-table",pagination:pagination,dataSource:notebooksAndTemplates,rowKey:"short_id",columns:columns,loading:notebooksResponseLoading,defaultSorting:tableSorting,emptyState:"No notebooks matching your filters!",nouns:["notebook","notebooks"],onSort:tableSortingChanged})]})}let scene={component:NotebooksScene,logic:notebooksTableLogic};function NotebooksScene(){return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:"Notebooks",resourceType:{type:"notebook"},actions:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.d6,{items:[{label:"Load from JSON",onClick:()=>{(0,file_utils.l)({contentType:"application/json",multiple:!1}).then(files=>(0,file_utils.m)(files[0])).then(text=>{if("doc"!==JSON.parse(text).type)throw Error("Not a notebook");lib.router.actions.push(urls.j.canvas(),{},{"🦔":(0,utils.h$)(text)})}).catch(e=>{src.UJ.error(e.message)})}}],children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{}),size:"small"})}),(0,jsx_runtime.jsx)(src.u,{title:"Like a Notebook but all your exploration is persisted to the URL for easy sharing.",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small","data-attr":"new-canvas",to:urls.j.canvas(),type:"secondary",children:"New canvas"})}),(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:src_types.qR.Notebook,minAccessLevel:src_types.W$.Editor,children:(0,jsx_runtime.jsx)(src.Jp,{size:"small","data-attr":"new-notebook",to:urls.j.notebook("new"),type:"primary",children:"New notebook"})})]})}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(NotebooksTable,{})]})}}}]);