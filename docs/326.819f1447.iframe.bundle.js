(window.webpackJsonp=window.webpackJsonp||[]).push([[326],{"./frontend/src/scenes/groups/Group.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Group",(function(){return Group}));var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),PropertiesTable=__webpack_require__("./frontend/src/lib/components/PropertiesTable/index.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),api=__webpack_require__("./frontend/src/lib/api.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),groupsModel=__webpack_require__("./frontend/src/models/groupsModel.ts"),types=__webpack_require__("./frontend/src/types.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),GroupActorDisplay=__webpack_require__("./frontend/src/scenes/persons/GroupActorDisplay.tsx"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),DataTable_utils=__webpack_require__("./frontend/src/queries/nodes/DataTable/utils.ts"),queries_utils=__webpack_require__("./frontend/src/queries/utils.ts"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx");const groupLogic=Object(index_esm.kea)({path:["groups","groupLogic"],connect:{values:[teamLogic.b,["currentTeamId"],groupsModel.a,["groupTypes","aggregationLabel"],featureFlagLogic.a,["featureFlags"]]},actions:()=>({setGroup:(groupTypeIndex,groupKey,groupTab)=>({groupTypeIndex:groupTypeIndex,groupKey:groupKey,groupTab:groupTab}),setGroupTab:groupTab=>({groupTab:groupTab}),setGroupEventsQuery:query=>({query:query})}),loaders:_ref=>{let{values:values}=_ref;return{groupData:[null,{loadGroup:async()=>{const params={group_type_index:values.groupTypeIndex,group_key:values.groupKey},url=`api/projects/${values.currentTeamId}/groups/find?${Object(utils.Mb)(params)}`;return await api.b.get(url)}}]}},reducers:{groupTypeIndex:[0,{setGroup:(_,_ref2)=>{let{groupTypeIndex:groupTypeIndex}=_ref2;return groupTypeIndex}}],groupKey:["",{setGroup:(_,_ref3)=>{let{groupKey:groupKey}=_ref3;return groupKey}}],groupTab:[null,{setGroup:(_,_ref4)=>{let{groupTab:groupTab}=_ref4;return null!=groupTab?groupTab:null},setGroupTab:(_,_ref5)=>{let{groupTab:groupTab}=_ref5;return groupTab}}],groupEventsQuery:[null,{setGroup:(_,_ref6)=>{let{groupTypeIndex:groupTypeIndex,groupKey:groupKey}=_ref6;return function getGroupEventsQuery(groupTypeIndex,groupKey){return{kind:schema.a.DataTableNode,full:!0,source:{kind:schema.a.EventsQuery,select:Object(DataTable_utils.a)(schema.a.EventsQuery),after:"-24h",fixedProperties:[{key:`$group_${groupTypeIndex}`,value:groupKey,type:types.U.Event,operator:types.W.Exact}]}}}(groupTypeIndex,groupKey)},setGroupEventsQuery:(_,_ref7)=>{let{query:query}=_ref7;return Object(queries_utils.i)(query)?query:null}}]},selectors:{showCustomerSuccessDashboards:[s=>[s.featureFlags],featureFlags=>featureFlags[constants.i.CS_DASHBOARDS]],groupTypeName:[s=>[s.aggregationLabel,s.groupTypeIndex],(aggregationLabel,index)=>aggregationLabel(index).singular],groupType:[s=>[s.groupTypes,s.groupTypeIndex],(groupTypes,index)=>{var _groupTypes$index;return null===(_groupTypes$index=groupTypes[index])||void 0===_groupTypes$index?void 0:_groupTypes$index.group_type}],breadcrumbs:[s=>[s.groupTypeName,s.groupTypeIndex,s.groupKey,s.groupData],(groupTypeName,groupTypeIndex,groupKey,groupData)=>[{name:Object(utils.i)(groupTypeName),path:urls.a.groups(String(groupTypeIndex))},{name:Object(GroupActorDisplay.b)(groupKey,(null==groupData?void 0:groupData.group_properties)||{}),path:urls.a.group(String(groupTypeIndex),groupKey)}]]},actionToUrl:_ref8=>{let{values:values}=_ref8;return{setGroup:()=>{const{groupTypeIndex:groupTypeIndex,groupKey:groupKey,groupTab:groupTab}=values;return urls.a.group(String(groupTypeIndex),groupKey,!0,groupTab)},setGroupTab:()=>{const{groupTypeIndex:groupTypeIndex,groupKey:groupKey,groupTab:groupTab}=values;return urls.a.group(String(groupTypeIndex),groupKey,!0,groupTab)}}},urlToAction:_ref9=>{let{actions:actions,values:values}=_ref9;return{"/groups/:groupTypeIndex/:groupKey(/:groupTab)":_ref10=>{let{groupTypeIndex:groupTypeIndex,groupKey:groupKey,groupTab:groupTab}=_ref10;groupTypeIndex&&groupKey&&(+groupTypeIndex===values.groupTypeIndex&&groupKey===values.groupKey?actions.setGroupTab(groupTab||null):actions.setGroup(+groupTypeIndex,decodeURIComponent(groupKey),groupTab))}}},listeners:_ref11=>{let{actions:actions,selectors:selectors,values:values}=_ref11;return{setGroup:(_,__,___,previousState)=>{selectors.groupTypeIndex(previousState)===values.groupTypeIndex&&selectors.groupKey(previousState)===values.groupKey||actions.loadGroup()}}}});var RelatedGroups=__webpack_require__("./frontend/src/scenes/groups/RelatedGroups.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),CopyToClipboard=__webpack_require__("./frontend/src/lib/components/CopyToClipboard.tsx"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),RelatedFeatureFlags=__webpack_require__("./frontend/src/scenes/persons/RelatedFeatureFlags.tsx"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),Dashboard=__webpack_require__("./frontend/src/scenes/dashboard/Dashboard.tsx"),sceneTypes=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts");const groupDashboardLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","groups","groupDashboardLogic"]),Object(index_esm.connect)({values:[userLogic.a,["user"]]}),Object(index_esm.selectors)((()=>({groupDashboardId:[s=>[s.user],user=>{var _user$scene_personali,_user$scene_personali2;const currentDashboard=null==user||null===(_user$scene_personali=user.scene_personalisation)||void 0===_user$scene_personali||null===(_user$scene_personali2=_user$scene_personali.find((choice=>choice.scene===sceneTypes.a.Group)))||void 0===_user$scene_personali2?void 0:_user$scene_personali2.dashboard;return"number"==typeof currentDashboard?currentDashboard:null==currentDashboard?void 0:currentDashboard.id}],dashboardLogicProps:[s=>[s.groupDashboardId],groupDashboardId=>({id:null!=groupDashboardId?groupDashboardId:void 0,placement:types.m.Group})]})))]);var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),SceneDashboardChoiceRequired=__webpack_require__("./frontend/src/lib/components/SceneDashboardChoice/SceneDashboardChoiceRequired.tsx"),SceneDashboardChoiceModal=__webpack_require__("./frontend/src/lib/components/SceneDashboardChoice/SceneDashboardChoiceModal.tsx"),sceneDashboardChoiceModalLogic=__webpack_require__("./frontend/src/lib/components/SceneDashboardChoice/sceneDashboardChoiceModalLogic.ts"),dashboardLogic=__webpack_require__("./frontend/src/scenes/dashboard/dashboardLogic.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function GroupDashboard(_ref){let{groupData:groupData}=_ref;const{showSceneDashboardChoiceModal:showSceneDashboardChoiceModal}=Object(index_esm.useActions)(Object(sceneDashboardChoiceModalLogic.a)({scene:sceneTypes.a.Group})),{dashboardLogicProps:dashboardLogicProps}=Object(index_esm.useValues)(groupDashboardLogic),{dashboard:dashboard}=Object(index_esm.useValues)(Object(dashboardLogic.f)(dashboardLogicProps)),{setProperties:setProperties}=Object(index_esm.useActions)(Object(dashboardLogic.f)(dashboardLogicProps));return Object(react.useEffect)((()=>{if(dashboard&&groupData){const current=Array.isArray(null==dashboard?void 0:dashboard.filters.properties)?null==dashboard?void 0:dashboard.filters.properties:[],desired={key:"id",value:[groupData.group_properties.id.toString()],operator:types.W.Exact,type:types.U.Group,group_type_index:groupData.group_type_index};current.some((item=>item.type===types.U.Group&&item.group_type_index===groupData.group_type_index&&"id"===item.key))||setProperties([...current,desired])}}),[dashboard,groupData]),Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[void 0!==dashboardLogicProps.id?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("div",{className:"flex items-center justify-end mb-2",children:Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",size:"small","data-attr":"group-dashboard-change-dashboard",onClick:showSceneDashboardChoiceModal,children:"Change dashboard"})}),Object(jsx_runtime.jsx)(Dashboard.Dashboard,{id:dashboardLogicProps.id.toString(),placement:dashboardLogicProps.placement})]}):Object(jsx_runtime.jsx)(SceneDashboardChoiceRequired.a,{open:()=>{showSceneDashboardChoiceModal()},scene:sceneTypes.a.Group}),Object(jsx_runtime.jsx)(SceneDashboardChoiceModal.a,{scene:sceneTypes.a.Group})]})}try{GroupDashboard.displayName="GroupDashboard",GroupDashboard.__docgenInfo={description:"",displayName:"GroupDashboard",props:{groupData:{defaultValue:null,description:"",name:"groupData",required:!0,type:{name:"Group"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/groups/GroupDashboard.tsx#GroupDashboard"]={docgenInfo:GroupDashboard.__docgenInfo,name:"GroupDashboard",path:"frontend/src/scenes/groups/GroupDashboard.tsx#GroupDashboard"})}catch(__react_docgen_typescript_loader_error){}const scene={component:Group,logic:groupLogic};function GroupCaption(_ref){let{groupData:groupData,groupTypeName:groupTypeName}=_ref;return Object(jsx_runtime.jsxs)("div",{className:"flex items-center flex-wrap",children:[Object(jsx_runtime.jsxs)("div",{className:"mr-4",children:[Object(jsx_runtime.jsx)("span",{className:"text-muted",children:"Type:"})," ",groupTypeName]}),Object(jsx_runtime.jsxs)("div",{className:"mr-4",children:[Object(jsx_runtime.jsx)("span",{className:"text-muted",children:"Key:"})," ",Object(jsx_runtime.jsx)(CopyToClipboard.a,{tooltipMessage:null,description:"group key",style:{display:"inline-flex",justifyContent:"flex-end"},children:groupData.group_key})]}),Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("span",{className:"text-muted",children:"First seen:"})," ",groupData.created_at?Object(jsx_runtime.jsx)(TZLabel.a,{time:groupData.created_at}):"unknown"]})]})}function Group(){const{groupData:groupData,groupDataLoading:groupDataLoading,groupTypeName:groupTypeName,groupKey:groupKey,groupTypeIndex:groupTypeIndex,groupType:groupType,groupTab:groupTab,groupEventsQuery:groupEventsQuery,showCustomerSuccessDashboards:showCustomerSuccessDashboards}=Object(index_esm.useValues)(groupLogic),{setGroupTab:setGroupTab,setGroupEventsQuery:setGroupEventsQuery}=Object(index_esm.useActions)(groupLogic);return groupData?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:Object(GroupActorDisplay.b)(groupData.group_key,groupData.group_properties),caption:Object(jsx_runtime.jsx)(GroupCaption,{groupData:groupData,groupTypeName:groupTypeName})}),Object(jsx_runtime.jsx)(LemonTabs.a,{activeKey:null!=groupTab?groupTab:types.O.PROPERTIES,onChange:tab=>setGroupTab(tab),tabs:[{key:types.O.PROPERTIES,label:Object(jsx_runtime.jsx)("span",{"data-attr":"persons-properties-tab",children:"Properties"}),content:Object(jsx_runtime.jsx)(PropertiesTable.a,{type:types.T.Group,properties:groupData.group_properties||{},embedded:!1,searchable:!0})},{key:types.O.EVENTS,label:Object(jsx_runtime.jsx)("span",{"data-attr":"persons-events-tab",children:"Events"}),content:groupEventsQuery?Object(jsx_runtime.jsx)(Query.a,{query:groupEventsQuery,setQuery:setGroupEventsQuery}):Object(jsx_runtime.jsx)(Spinner.a,{})},{key:types.O.RELATED,label:Object(jsx_runtime.jsx)("div",{className:"flex items-center","data-attr":"group-related-tab",children:"Related people & groups"}),tooltip:`People and groups that have shared events with this ${groupTypeName} in the last 90 days.`,content:Object(jsx_runtime.jsx)(RelatedGroups.a,{id:groupKey,groupTypeIndex:groupTypeIndex})},{key:types.O.FEATURE_FLAGS,label:Object(jsx_runtime.jsx)("span",{"data-attr":"groups-related-flags-tab",children:"Feature flags"}),content:Object(jsx_runtime.jsx)(RelatedFeatureFlags.b,{distinctId:groupData.group_key,groups:{[groupType]:groupKey}})},showCustomerSuccessDashboards?{key:types.O.DASHBOARD,label:"Dashboard",content:Object(jsx_runtime.jsx)(GroupDashboard,{groupData:groupData})}:null]})]}):groupDataLoading?Object(jsx_runtime.jsx)(Spinner.b,{sceneLevel:!0}):Object(jsx_runtime.jsx)(NotFound.a,{object:"group"})}}}]);