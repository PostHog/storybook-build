(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(x,f,e){"use strict";e.r(f),e.d(f,"AppMetricsTab",function(){return l}),e.d(f,"appMetricsSceneLogic",function(){return y});var D=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),T=e.n(D),C=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),m=e.n(C),A=e("./node_modules/@babel/runtime/regenerator/index.js"),d=e.n(A),I=e("./node_modules/core-js/modules/es.array.iterator.js"),F=e.n(I),b=e("./node_modules/core-js/modules/es.object.to-string.js"),H=e.n(b),L=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),$=e.n(L),B=e("./node_modules/core-js/modules/es.array.concat.js"),S=e.n(B),U=e("./node_modules/core-js/modules/es.function.name.js"),G=e.n(U),K=e("./node_modules/core-js/modules/es.array.includes.js"),J=e.n(K),R=e("./node_modules/core-js/modules/es.string.includes.js"),N=e.n(R),W=e("./node_modules/core-js/modules/es.array.filter.js"),z=e.n(W),_=e("./node_modules/kea/lib/index.esm.js"),M=e("./node_modules/kea-loaders/lib/index.js"),Q=e.n(M),v=e("./frontend/src/scenes/urls.ts"),p=e("./frontend/src/lib/api.ts"),O=e("./frontend/src/scenes/teamLogic.tsx"),g=e("./node_modules/kea-router/lib/index.js"),V=e.n(g),h=e("./frontend/src/lib/utils.tsx"),l;(function(n){n.ProcessEvent="processEvent",n.OnEvent="onEvent",n.ExportEvents="exportEvents",n.HistoricalExports="historical_exports"})(l||(l={}));var P=[l.ProcessEvent,l.OnEvent,l.ExportEvents],y=Object(_.kea)([Object(_.path)(function(n){return["scenes","apps","appMetricsSceneLogic",n]}),Object(_.props)({}),Object(_.key)(function(n){return n.pluginConfigId}),Object(_.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}}}),Object(_.reducers)({activeTab:[null,{setActiveTab:function(o,s){var r=s.tab;return r}}],dateFrom:["-30d",{setDateFrom:function(o,s){var r=s.dateFrom;return r}}]}),Object(M.loaders)(function(n){var o=n.values,s=n.props;return{pluginConfig:[null,{loadPluginConfig:function(){var r=m()(d.a.mark(function i(){return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,p.b.get("api/projects/".concat(O.a.values.currentTeamId,"/plugin_configs/").concat(s.pluginConfigId));case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},i)}));function t(){return r.apply(this,arguments)}return t}()}],metrics:[null,{loadMetrics:function(){var r=m()(d.a.mark(function i(){var u,a,j;return d.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return u=Object(h.Eb)({category:o.activeTab,date_from:o.dateFrom}),E.next=3,p.b.get("api/projects/".concat(O.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"?").concat(u));case 3:return a=E.sent,j=a.results,E.abrupt("return",j);case 6:case"end":return E.stop()}},i)}));function t(){return r.apply(this,arguments)}return t}()}],historicalExports:[[],{loadHistoricalExports:function(){var r=m()(d.a.mark(function i(){var u,a;return d.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,p.b.get("api/projects/".concat(O.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/historical_exports"));case 2:return u=c.sent,a=u.results,c.abrupt("return",a);case 5:case"end":return c.stop()}},i)}));function t(){return r.apply(this,arguments)}return t}()}]}}),Object(_.selectors)(function(n){var o=n.values;return{breadcrumbs:[function(s){return[s.pluginConfig,function(r,t){return t.pluginConfigId}]},function(s,r){var t;return[{name:"Apps",path:v.a.projectApps()},{name:s==null||(t=s.plugin_info)===null||t===void 0?void 0:t.name,path:v.a.appMetrics(r)}]}],showTab:[function(){return[]},function(){return function(s){var r;if(o.pluginConfigLoading||!o.pluginConfig)return!1;var t=((r=o.pluginConfig.plugin_info.capabilities)===null||r===void 0?void 0:r.methods)||[];return s===l.HistoricalExports?t.includes("exportEvents"):s===l.OnEvent&&t.includes("exportEvents")?!1:t.includes(s)}}]}}),Object(_.listeners)(function(n){var o=n.values,s=n.actions;return{loadPluginConfigSuccess:function(){if(!o.activeTab){var t=P.filter(function(a){return o.showTab(a)}),i=T()(t,1),u=i[0];s.setActiveTab(u)}},setActiveTab:function(t){var i=t.tab;i===l.HistoricalExports?s.loadHistoricalExports():s.loadMetrics()},setDateFrom:function(){s.loadMetrics()}}}),Object(g.actionToUrl)(function(n){var o=n.values,s=n.props;return{setActiveTab:function(){var t;return o.activeTab===l.HistoricalExports?v.a.appHistoricalExports(s.pluginConfigId):v.a.appMetrics(s.pluginConfigId,(t=o.activeTab)!==null&&t!==void 0?t:void 0)}}}),Object(g.urlToAction)(function(n){var o=n.values,s=n.actions;return{"/app/:pluginConfigId/:page":function(t,i){o.pluginConfig||s.loadPluginConfig(),t.page===l.HistoricalExports?s.setActiveTab(l.HistoricalExports):i.tab&&P.includes(i.tab)&&s.setActiveTab(i.tab)}}})])}}]);
