(window.webpackJsonp=window.webpackJsonp||[]).push([[234],{"./frontend/src/scenes/actions/Action.tsx":function(he,D,e){"use strict";e.r(D),e.d(D,"scene",function(){return it}),e.d(D,"Action",function(){return Pe});var G=e("./node_modules/react/index.js"),t=e.n(G),ze=e("./node_modules/core-js/modules/es.symbol.js"),Fe=e("./node_modules/core-js/modules/es.symbol.description.js"),ye=e("./node_modules/core-js/modules/es.array.concat.js"),le=e("./node_modules/core-js/modules/es.array.filter.js"),p=e("./node_modules/core-js/modules/es.array.map.js"),$e=e("./node_modules/core-js/modules/es.function.name.js"),Oe=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Ie=e.n(Oe),ie=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),z=e.n(ie),xe=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),De=e.n(xe),Y=e("./frontend/src/lib/utils.tsx"),je=e("./frontend/src/lib/components/Link.tsx"),U=e("./node_modules/kea/lib/index.esm.js"),Ve=e("./node_modules/core-js/modules/es.array.iterator.js"),Me=e("./node_modules/core-js/modules/es.object.assign.js"),_e=e("./node_modules/core-js/modules/es.object.to-string.js"),Re=e("./node_modules/core-js/modules/es.regexp.exec.js"),Ge=e("./node_modules/core-js/modules/es.string.split.js"),k=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Ae=e("./node_modules/@babel/runtime/regenerator/index.js"),M=e.n(Ae),Te=e("./node_modules/regenerator-runtime/runtime.js"),ce=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),q=e.n(ce),R=e("./frontend/src/lib/api.ts"),ee=e("./frontend/src/models/actionsModel.ts"),de=e("./frontend/src/lib/components/lemonToast.tsx");function be(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable})),r.push.apply(r,o)}return r}function te(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?be(Object(r),!0).forEach(function(o){z()(a,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(r,o))})}return a}var F=Object(U.kea)({path:function(n){return["scenes","actions","actionEditLogic",n]},props:{},key:function(n){return n.id||"new"},actions:function(){return{saveAction:!0,setAction:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:r,options:o}},setCreateNew:function(r){return{createNew:r}},actionAlreadyExists:function(r){return{actionId:r}}}},reducers:function(){return{errorActionId:[null,{saveAction:function(){return null},actionAlreadyExists:function(r,o){var d=o.actionId;return d}}],createNew:[!1,{setCreateNew:function(r,o){var d=o.createNew;return d}}]}},loaders:function(n){var r=n.props,o=n.values,d=n.actions;return{actionCount:{loadActionCount:function(){var h=q()(M.a.mark(function y(){return M.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!r.id){c.next=6;break}return c.next=3,R.a.actions.getCount(r.id);case 3:c.t0=c.sent,c.next=7;break;case 6:c.t0=0;case 7:return c.abrupt("return",c.t0);case 8:case"end":return c.stop()}},y)}));function E(){return h.apply(this,arguments)}return E}()},action:[r.action,{setAction:function(E){var y=E.action,u=E.options.merge;return u?te(te({},o.action),y):y},saveAction:function(){var h=q()(M.a.mark(function y(){var u;return M.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(u=Object.assign({},o.action),u.steps=u.steps?u.steps.filter(function(V){return V.event}):[],m.prev=2,!u.id){m.next=9;break}return m.next=6,R.a.actions.update(u.id,u,r.temporaryToken);case 6:u=m.sent,m.next=12;break;case 9:return m.next=11,R.a.actions.create(u,r.temporaryToken);case 11:u=m.sent;case 12:m.next=22;break;case 14:if(m.prev=14,m.t0=m.catch(2),m.t0.code!=="unique"){m.next=21;break}return d.actionAlreadyExists(m.t0.detail.split(" ").pop()),m.abrupt("return",u);case 21:throw m.t0;case 22:return de.a.success("Action saved"),r.onSave(u),ee.a.actions.loadActions(),m.abrupt("return",u);case 26:case"end":return m.stop()}},y,null,[[2,14]])}));function E(){return h.apply(this,arguments)}return E}()}]}},events:function(n){var r=n.actions,o=n.props;return{afterMount:function(){var d=q()(M.a.mark(function E(){return M.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:o.id?r.loadActionCount():r.setAction({name:"",steps:[{isNew:Object(Y.Eb)()}]},{merge:!1});case 1:case"end":return u.stop()}},E)}));function h(){return d.apply(this,arguments)}return h}()}}}),Be=e("./frontend/src/scenes/actions/Actions.scss"),ne=e("./frontend/src/scenes/actions/EventName.tsx"),ae=e("./frontend/src/scenes/teamLogic.ts"),x=e("./node_modules/antd/es/button/index.js"),re=e("./node_modules/antd/es/modal/index.js"),Ke=e("./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx"),N=e("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts");function W(a){var n,r=a.actionId,o=a.style,d=a.children,h=Object(G.useState)(!1),E=De()(h,2),y=E[0],u=E[1],c=Object(U.useValues)(ae.a),m=c.currentTeam;return t.a.createElement(t.a.Fragment,null,t.a.createElement(x.a,{href:Object(N.b)(m==null||(n=m.app_urls)===null||n===void 0?void 0:n[0],r),style:o,size:"small",onClick:function(ve){ve.preventDefault(),u(!0)}},d),t.a.createElement(re.a,{visible:y,title:r?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:t.a.createElement(x.a,{onClick:function(){return u(!1)}},"Close"),onCancel:function(){return u(!1)}},t.a.createElement(Ke.a,{actionId:r,pageKey:"app-editor-link"})))}try{W.displayName="AppEditorLink",W.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:W.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(a){}var ue=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),H=e("./frontend/src/lib/components/Tooltip.tsx"),J=e("./frontend/src/scenes/actions/hints.tsx"),Ce=e("./node_modules/antd/es/typography/index.js"),me=e("./node_modules/antd/es/col/index.js"),X=e("./node_modules/antd/es/card/index.js"),Q=e("./node_modules/antd/es/input/index.js"),$=e("./node_modules/antd/es/space/index.js"),f=e("./node_modules/antd/es/radio/index.js"),pe=e("./node_modules/@ant-design/icons/es/icons/ExportOutlined.js"),K=e("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js");function S(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable})),r.push.apply(r,o)}return r}function j(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?S(Object(r),!0).forEach(function(o){z()(a,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(r,o))})}return a}var Z=Ce.a.Text,oe="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function g(a){var n=a.step,r=a.actionId,o=a.isOnlyStep,d=a.index,h=a.identifier,E=a.onDelete,y=a.onChange,u=function(m){y(m)};return t.a.createElement(me.a,{span:24,md:12},t.a.createElement(X.a,{className:"action-step",style:{overflow:"visible"}},d>0&&t.a.createElement("div",{className:"stateful-badge pos-center-end or"},"OR"),t.a.createElement("div",null,!o&&t.a.createElement("div",{className:"remove-wrapper"},t.a.createElement("button",{type:"button","aria-label":"delete",onClick:E},t.a.createElement("span",{"aria-hidden":"true"},"\xD7"))),t.a.createElement("div",{className:"mb"},t.a.createElement("b",null,"Match Group #",d+1)),t.a.createElement(i,{step:n,sendStep:u}),t.a.createElement("div",{style:{marginTop:n.event==="$pageview"?20:8,paddingBottom:0}},n.event==="$autocapture"&&t.a.createElement(s,{step:n,sendStep:u,actionId:r}),n.event!=null&&n.event!=="$autocapture"&&n.event!=="$pageview"&&t.a.createElement("div",{style:{marginTop:"2rem"}},t.a.createElement("label",null,t.a.createElement("b",null,"Event name: ")),t.a.createElement(ne.a,{value:n.event,onChange:function(m){return u(j(j({},n),{},{event:m||""}))}}),t.a.createElement("br",null),t.a.createElement("small",null,t.a.createElement("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer"},"See documentation")," ","on how to send custom events in lots of languages.")),n.event==="$pageview"&&t.a.createElement("div",null,t.a.createElement(l,{step:n,sendStep:u,item:"url",extra_options:t.a.createElement(v,{step:n,sendStep:u}),label:"URL"}),n.url_matching&&n.url_matching in J.a&&t.a.createElement("small",{style:{display:"block",marginTop:-12}},J.a[n.url_matching])),n.event&&t.a.createElement("div",{className:"property-filters"},t.a.createElement("h3",{className:"l3"},"Filters"),(!n.properties||n.properties.length===0)&&t.a.createElement("div",{className:"text-muted"},"This match group has no additional filters."),t.a.createElement(ue.a,{propertyFilters:n.properties,pageKey:h,eventNames:n.event?[n.event]:[],onChange:function(m){u(j(j({},n),{},{properties:m}))},showConditionBadge:!0}))))))}function l(a){var n=function(o){return a.sendStep(j(j({},a.step),{},z()({},a.item,o.target.value||null)))};return t.a.createElement("div",{className:"mb"},t.a.createElement("label",{style:{fontWeight:"bold"}},a.label," ",a.extra_options),a.caption&&t.a.createElement("div",{className:"action-step-caption"},a.caption),a.item==="selector"?t.a.createElement(Q.a.TextArea,{allowClear:!0,onChange:n,value:a.step[a.item]||"",placeholder:a.placeholder}):t.a.createElement(Q.a,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:n,value:a.step[a.item]||"",placeholder:a.placeholder}))}function s(a){var n=a.step,r=a.actionId,o=a.sendStep,d=function(){return t.a.createElement("div",{className:"text-center"},t.a.createElement("span",{className:"stateful-badge and"},"AND"))};return t.a.createElement("div",null,t.a.createElement("span",null,t.a.createElement(W,{actionId:r,style:{margin:"1rem 0"}},"Select element on site ",t.a.createElement(pe.a,null)),t.a.createElement("a",{href:"".concat(oe,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8}},"See documentation.")," "),t.a.createElement(l,{step:n,sendStep:o,item:"href",label:"Link target equals",caption:t.a.createElement(t.a.Fragment,null,"If your element is a link, the location that the link opens (",t.a.createElement("code",null,"href")," tag)")}),t.a.createElement(d,null),t.a.createElement(l,{step:n,sendStep:o,item:"text",label:"Text equals",caption:"Text content inside your element"}),t.a.createElement(d,null),t.a.createElement(l,{step:n,sendStep:o,item:"selector",label:t.a.createElement(t.a.Fragment,null,"HTML selector matches",t.a.createElement(H.a,{title:"Click here to learn more about supported selectors"},t.a.createElement("a",{href:"".concat(oe,"#matching-selectors"),target:"_blank",rel:"noopener"},t.a.createElement(K.a,{style:{marginLeft:4}})))),placeholder:'button[data-attr="my-id"]',caption:t.a.createElement($.b,{direction:"vertical"},t.a.createElement(Z,{style:{color:"var(--muted)"}},"CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",t.a.createElement(Z,{code:!0},'[data-attr="signup"]')))}),t.a.createElement("div",{style:{marginBottom:18}},t.a.createElement(d,null)),t.a.createElement(l,{step:n,sendStep:o,item:"url",extra_options:t.a.createElement(v,{step:n,sendStep:o}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(n==null?void 0:n.url_matching)&&n.url_matching in J.a&&t.a.createElement("small",{style:{display:"block",marginTop:-12}},J.a[n.url_matching]))}function i(a){var n=a.step,r=a.sendStep,o=function(h){var E=h.target.value;E==="$autocapture"?r(j(j({},n),{},{event:"$autocapture"})):E==="event"?r(j(j({},n),{},{event:""})):E==="$pageview"&&r(j(j({},n),{},{event:"$pageview",url:n.url}))};return t.a.createElement("div",{className:"type-switcher".concat(n.event===void 0?" unselected":"")},t.a.createElement(f.a.Group,{buttonStyle:"solid",onChange:o,value:n.event==="$autocapture"||n.event==="$pageview"||n.event===void 0?n.event:"event"},t.a.createElement(f.a.Button,{value:"$autocapture"},"Autocapture"),t.a.createElement(f.a.Button,{value:"event"},"Custom event"),t.a.createElement(f.a.Button,{value:"$pageview"},"Page view")))}function v(a){var n=a.step,r=a.sendStep,o=function(h){r(j(j({},n),{},{url_matching:h.target.value}))};return t.a.createElement(f.a.Group,{buttonStyle:"solid",onChange:o,value:n.url_matching||"contains",size:"small"},t.a.createElement(f.a.Button,{value:"contains"},"contains"),t.a.createElement(f.a.Button,{value:"regex"},"matches regex"),t.a.createElement(f.a.Button,{value:"exact"},"matches exactly"))}try{g.displayName="ActionStep",g.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:g.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(a){}var T=e("./node_modules/antd/es/row/index.js"),_=e("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),A=e("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),b=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),B=e("./node_modules/@ant-design/icons/es/icons/SaveOutlined.js"),se=e("./node_modules/kea-router/lib/index.js"),L=e("./frontend/src/lib/components/PageHeader.tsx"),P=e("./frontend/src/scenes/urls.ts"),fe=e("./frontend/src/lib/components/EditableField/EditableField.tsx"),Ue=e("./frontend/src/types.ts"),nt=e("./frontend/src/scenes/userLogic.ts"),at=e("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx");function Qe(a,n){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);n&&(o=o.filter(function(d){return Object.getOwnPropertyDescriptor(a,d).enumerable})),r.push.apply(r,o)}return r}function I(a){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Qe(Object(r),!0).forEach(function(o){z()(a,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):Qe(Object(r)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(r,o))})}return a}function Ne(a){var n,r,o=a.action,d=a.id,h=a.onSave,E=a.temporaryToken,y=F({id:d,action:o,onSave:function(C){return h(C)},temporaryToken:E}),u=Object(U.useValues)(y),c=u.action,m=u.actionLoading,V=u.errorActionId,ve=u.actionCount,He=u.actionCountLoading,Ze=Object(U.useActions)(y),w=Ze.setAction,we=Ze.saveAction,ct=Object(U.useActions)(ee.a),dt=ct.loadActions,ut=Object(U.useValues)(ae.a),Je=ut.currentTeam,mt=Object(U.useValues)(nt.a),ke=mt.hasAvailableFeature,pt=Object(G.useState)(!1),qe=De()(pt,2),ft=qe[0],ge=qe[1],We=Je==null?void 0:Je.slack_incoming_webhook;function et(){w(I(I({},c),{},{steps:[].concat(Ie()(c.steps||[]),[{isNew:Object(Y.Eb)()}])}))}var vt=t.a.createElement(x.a,{onClick:et,size:"small"},"Add another match group"),tt=d?t.a.createElement(x.a,{"data-attr":"delete-action",danger:!0,icon:t.a.createElement(_.a,null),onClick:function(){Object(Y.x)({endpoint:R.a.actions.determineDeleteEndpoint(),object:c,callback:function(){se.router.actions.push("/events/actions"),dt()}})}},"Delete"):void 0;return t.a.createElement("div",{className:"action-edit-container"},t.a.createElement(L.a,{title:t.a.createElement(fe.a,{name:"name",value:c.name||"",placeholder:"Name this action",onChange:function(C){w(I(I({},c),{},{name:C})),ge(!!C)},mode:d?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(d?"edit":"create"),saveButtonText:"Set"}),caption:t.a.createElement(t.a.Fragment,null,t.a.createElement(fe.a,{multiline:!0,name:"description",value:c.description||"",placeholder:"Description (optional)",onSave:function(C){w(I(I({},c),{},{description:C})),ge(!!C)},mode:d?void 0:"edit",autoFocus:!!d,"data-attr":"action-description",compactButtons:!0,maxLength:600,paywall:!ke(Ue.c.INGESTION_TAXONOMY),saveButtonText:"Set"}),ke(Ue.c.TAGGING)&&t.a.createElement(at.a,{tags:(n=c.tags)!==null&&n!==void 0?n:[],onChange:function(C,Xe){return w({tags:Xe})},className:"action-tags",saving:m})),buttons:tt}),t.a.createElement("form",{onSubmit:function(C){C.preventDefault(),we()}},d&&t.a.createElement("div",{className:"input-set"},t.a.createElement("div",null,t.a.createElement("span",{className:"text-muted mb-05"},He&&t.a.createElement(A.a,null),ve!==null&&ve>-1&&t.a.createElement(t.a.Fragment,null,"This action matches ",t.a.createElement("b",null,Object(Y.q)(ve))," events in the last 3 months")))),t.a.createElement("div",{className:"match-group-section",style:{overflow:"visible"}},t.a.createElement("h2",{className:"subtitle"},"Match groups"),t.a.createElement("div",null,"Your action will be triggered whenever ",t.a.createElement("b",null,"any of your match groups")," are received."," ",t.a.createElement("a",{href:"https://posthog.com/docs/features/actions",target:"_blank"},t.a.createElement(K.a,null))),t.a.createElement("div",{style:{textAlign:"right",marginBottom:12}},vt),t.a.createElement(T.a,{gutter:[24,24]},(r=c.steps)===null||r===void 0?void 0:r.map(function(O,C){return t.a.createElement(g,{key:O.id||O.isNew,identifier:String(O.id||O.isNew),index:C,step:O,actionId:c.id||0,isOnlyStep:!!c.steps&&c.steps.length===1,onDelete:function(){var Se,Ee=O.id?"id":"isNew";w(I(I({},c),{},{steps:(Se=c.steps)===null||Se===void 0?void 0:Se.filter(function(Le){return Le[Ee]!==O[Ee]})})),ge(!0)},onChange:function(Se){var Ee;w(I(I({},c),{},{steps:(Ee=c.steps)===null||Ee===void 0?void 0:Ee.map(function(Le){return O.id&&Le.id==O.id||O.isNew&&Le.isNew===O.isNew?I({id:O.id,isNew:O.isNew},Se):Le})})),ge(!0)}})}),t.a.createElement(me.a,{span:24,md:12},t.a.createElement("div",{className:"match-group-add-skeleton",onClick:et},t.a.createElement(b.a,{style:{fontSize:28,color:"#666666"}}))))),t.a.createElement("div",null,t.a.createElement("div",{style:{margin:"1rem 0"}},t.a.createElement("p",null,t.a.createElement("input",{id:"webhook-checkbox",type:"checkbox",onChange:function(C){w(I(I({},c),{},{post_to_slack:C.target.checked})),ge(!0)},checked:!!c.post_to_slack,disabled:!We}),t.a.createElement("label",{className:We?"":"disabled",style:{marginLeft:"0.5rem",marginBottom:"0.5rem"},htmlFor:"webhook-checkbox"},"Post to webhook when this action is triggered.")," ",t.a.createElement(je.a,{to:"/project/settings#webhook"},We?"Configure":"Enable"," this integration in Setup.")),c.post_to_slack&&t.a.createElement(t.a.Fragment,null,t.a.createElement(Q.a,{addonBefore:"Message format (optional)",placeholder:"Default: [action.name] triggered by [user.name]",value:c.slack_message_format,onChange:function(C){w(I(I({},c),{},{slack_message_format:C.target.value})),ge(!0)},disabled:!We||!c.post_to_slack,"data-attr":"edit-slack-message-format"}),t.a.createElement("small",null,t.a.createElement("a",{href:"https://posthog.com/docs/integrations/message-formatting/",target:"_blank",rel:"noopener noreferrer"},"See documentation on how to format webhook messages."))))),V&&t.a.createElement("p",{className:"text-danger"},"Action with this name already exists."," ",t.a.createElement("a",{href:P.a.action(V)},"Click here to edit.")),t.a.createElement("div",{className:"float-right"},t.a.createElement("span",{"data-attr":"delete-action-bottom"},tt),t.a.createElement(x.a,{disabled:!ft||!c.name,"data-attr":"save-action-button",type:"primary",icon:t.a.createElement(B.a,null),onClick:we,style:{marginLeft:16}},"Save action"))))}try{Ne.displayName="ActionEdit",Ne.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:Ne.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(a){}var rt=e("./frontend/src/scenes/events/eventsTableLogic.ts"),ot=e("./frontend/src/scenes/events/index.ts"),st=e("./frontend/src/lib/dayjs.ts"),lt=e("./frontend/src/lib/components/Spinner/Spinner.tsx"),Ye=Object(U.kea)({props:{},key:function(n){return n.id||"new"},path:function(n){return["scenes","actions","actionLogic",n]},actions:function(){return{checkIsFinished:function(r){return{action:r}},setPollTimeout:function(r){return{pollTimeout:r}},setIsComplete:function(r){return{isComplete:r}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(r,o){var d=o.pollTimeout;return d}}],isComplete:[!1,{setIsComplete:function(r,o){var d=o.isComplete;return d}}]}},selectors:{breadcrumbs:[function(a){return[a.action]},function(a){return[{name:"Events & Actions",path:P.a.actions()},{name:(a==null?void 0:a.name)||"Unnamed",path:a?P.a.action(a.id):void 0}]}]},loaders:function(n){var r=n.actions,o=n.props;return{action:{loadAction:function(){var d=q()(M.a.mark(function E(){var y;return M.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(r.setIsComplete(!1),o.id){c.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return c.next=5,R.a.actions.get(o.id);case 5:return y=c.sent,r.checkIsFinished(y),c.abrupt("return",y);case 8:case"end":return c.stop()}},E)}));function h(){return d.apply(this,arguments)}return h}()}}},listeners:function(n){var r=n.actions,o=n.props,d=n.values;return{checkIsFinished:function(E){var y=E.action;y.is_calculating?r.setPollTimeout(setTimeout(function(){return r.loadAction()},1e3)):(o.onComplete(),r.setIsComplete(new Date),d.pollTimeout&&clearTimeout(d.pollTimeout))}}},events:function(n){var r=n.values,o=n.actions,d=n.props;return{afterMount:function(){d.id&&o.loadAction()},beforeUnmount:function(){r.pollTimeout&&clearTimeout(r.pollTimeout)}}}}),it={logic:Ye,component:Pe,paramsToProps:function(n){var r=n.params.id;return{id:parseInt(r),onComplete:function(){}}}};function Pe(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=a.id,r={action_id:n},o=Object(U.useActions)(se.router),d=o.push,h=Object(U.useActions)(Object(rt.a)({fixedFilters:r,sceneUrl:n?P.a.action(n):P.a.actions(),key:"Action",disableActions:!0})),E=h.fetchEvents,y=Object(U.useValues)(Ye({id:n,onComplete:E})),u=y.action,c=y.isComplete,m=Object(U.useActions)(Ye({id:n,onComplete:E})),V=m.loadAction;return t.a.createElement(t.a.Fragment,null,(!n||u)&&t.a.createElement(Ne,{id:n,action:u,onSave:function(He){n||d(P.a.action(He.id)),V()}}),n&&!c&&t.a.createElement("div",{style:{marginBottom:"10rem"}},t.a.createElement("h2",{className:"subtitle"},"Events"),t.a.createElement("div",{className:"flex-center"},t.a.createElement(lt.a,{style:{marginRight:12}}),"Calculating action, please hold on.")),c&&n&&t.a.createElement("div",{style:{marginTop:"4rem"}},t.a.createElement("h2",{className:"subtitle"},"Matching events"),t.a.createElement("p",null,"This is the list of ",t.a.createElement("strong",null,"recent")," events that match this action.",u!=null&&u.last_calculated_at?t.a.createElement(t.a.Fragment,null," ","Last calculated: ",t.a.createElement("b",null,Object(st.a)(u.last_calculated_at).fromNow()),"."):""),t.a.createElement(ot.b,{fixedFilters:r,sceneUrl:P.a.action(n),fetchMonths:3,pageKey:"Action"})))}try{Pe.displayName="Action",Pe.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:Pe.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(a){}},"./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx":function(he,D,e){"use strict";e.d(D,"a",function(){return R});var G=e("./node_modules/core-js/modules/es.array.index-of.js"),t=e("./node_modules/core-js/modules/es.regexp.exec.js"),ze=e("./node_modules/core-js/modules/es.string.match.js"),Fe=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),ye=e.n(Fe),le=e("./node_modules/react/index.js"),p=e.n(le),$e=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Oe=e.n($e),Ie=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss"),ie=e.n(Ie),z={};z.insert="head",z.singleton=!1;var xe=Oe()(ie.a,z),De=ie.a.locals||{},Y=e("./node_modules/clsx/dist/clsx.m.js"),je=e("./node_modules/kea/lib/index.esm.js"),U=e("./frontend/src/lib/components/LemonTable/index.ts"),Ve=e("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Me=e("./node_modules/@ant-design/icons/es/icons/CheckCircleFilled.js"),_e=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),Re=e("./node_modules/@ant-design/icons/es/icons/EditOutlined.js"),Ge=e("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),k=e("./frontend/src/lib/components/LemonButton/index.ts"),Ae=e("./node_modules/antd/es/input/index.js"),M=e("./node_modules/antd/es/button/index.js"),Te=e("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts"),ce=e("./frontend/src/lib/utils.tsx"),q=e("./frontend/src/lib/components/LemonButton/More.tsx");function R(ee){var de=ee.pageKey,be=ee.actionId,te=Object(Te.c)({actionId:be}),F=Object(je.useValues)(te),Be=F.appUrlsKeyed,ne=F.suggestionsLoading,ae=F.searchTerm,x=F.launchUrl,re=F.appUrls,Ke=F.editUrlIndex,N=Object(je.useActions)(te),W=N.addUrl,ue=N.removeUrl,H=N.setSearchTerm,J=N.updateUrl,Ce=N.newUrl,me=N.setEditUrlIndex,X=[{title:"URLs",dataIndex:"url",key:"url",render:function($,f){var pe=Object(le.useState)(f.url),K=ye()(pe,2),S=K[0],j=K[1],Z=Object(le.useState)(""),oe=ye()(Z,2),g=oe[0],l=oe[1];Object(le.useEffect)(function(){return j(f.url)},[f]);var s=function(){if(l(""),S===Te.a&&ue(f.originalIndex),S.indexOf("*")>-1&&!S.match(/^(.*)\*[^\*]*\.[^\*]+\.[^\*]+$/)){l("You can only wildcard subdomains. If you wildcard the domain or TLD, people might be able to gain access to your PostHog data.");return}if(!Object(ce.eb)(S)){l("Please type a valid URL or domain.");return}if(re.indexOf(S)>-1&&re.indexOf(S,f.originalIndex)!==f.originalIndex&&re.indexOf(S,f.originalIndex+1)!==f.originalIndex){l("This URL is already registered.");return}J(f.originalIndex,S)};return f.type==="suggestion"||$!==Te.a&&Ke!==f.originalIndex?p.a.createElement("div",{className:Object(Y.a)("authorized-url-col",f.type)},f.type==="authorized"&&p.a.createElement(Me.a,{style:{marginRight:4}}),$,f.type==="suggestion"&&p.a.createElement(Ve.a,null,"Suggestion")):p.a.createElement("div",null,p.a.createElement("div",{style:{display:"flex"}},p.a.createElement(Ae.a,{value:S,onChange:function(v){return j(v.target.value)},onPressEnter:s,autoFocus:!0,placeholder:"Enter a URL or wildcard subdomain (e.g. https://*.posthog.com)"}),p.a.createElement(M.a,{type:"primary",onClick:s},"Save")),g&&p.a.createElement("span",{className:"text-small text-danger"},g))}},{title:"",key:"actions",render:function($,f,pe){return p.a.createElement("div",{className:"actions-col"},f.type==="suggestion"?p.a.createElement(k.a,{type:"default",onClick:function(){return W(f.url)}},p.a.createElement(_e.a,null)," Add as authorized"):p.a.createElement(p.a.Fragment,null,p.a.createElement("a",{href:x(f.url),style:{marginRight:4}},p.a.createElement(k.a,{type:"highlighted"},"Launch toolbar")),p.a.createElement(q.a,{overlay:p.a.createElement(p.a.Fragment,null,p.a.createElement(k.a,{fullWidth:!0,type:"stealth",onClick:function(){return me(f.originalIndex)}},p.a.createElement(Re.a,{style:{marginRight:4}}),"Edit authorized URL"),p.a.createElement(k.a,{fullWidth:!0,style:{color:"var(--danger)"},type:"stealth",onClick:function(){return ue(pe)}},p.a.createElement(Ge.a,{style:{marginRight:4}}),"Remove authorized URL"))})))}}];return p.a.createElement("div",null,p.a.createElement("div",{className:"flex-center mb"},p.a.createElement("div",{style:{flexGrow:1}},p.a.createElement(Ae.a.Search,{allowClear:!0,enterButton:!0,placeholder:"Search for authorized URLs",style:{maxWidth:480},value:ae,onChange:function($){H($.target.value)},autoFocus:de==="toolbar-launch"&&!Object(ce.X)()})),p.a.createElement(M.a,{type:"primary",icon:p.a.createElement(_e.a,null),onClick:Ce},"Add",de==="toolbar-launch"&&" authorized domain")),p.a.createElement(U.a,{className:"authorized-urls-table",columns:X,dataSource:Be,emptyState:ae?"There are no authorized URLs that match your search.":"There are no authorized URLs or domains. Add one to get started.",loading:ne}))}try{R.displayName="AuthorizedUrlsTable",R.__docgenInfo={description:"",displayName:"AuthorizedUrlsTable",props:{pageKey:{defaultValue:null,description:"",name:"pageKey",required:!1,type:{name:"string"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"]={docgenInfo:R.__docgenInfo,name:"AuthorizedUrlsTable",path:"frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"})}catch(ee){}},"./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts":function(he,D,e){"use strict";e.d(D,"b",function(){return j}),e.d(D,"a",function(){return Z}),e.d(D,"c",function(){return oe});var G=e("./node_modules/core-js/modules/es.array.concat.js"),t=e.n(G),ze=e("./node_modules/core-js/modules/es.array.filter.js"),Fe=e.n(ze),ye=e("./node_modules/core-js/modules/es.array.includes.js"),le=e.n(ye),p=e("./node_modules/core-js/modules/es.array.index-of.js"),$e=e.n(p),Oe=e("./node_modules/core-js/modules/es.array.iterator.js"),Ie=e.n(Oe),ie=e("./node_modules/core-js/modules/es.array.map.js"),z=e.n(ie),xe=e("./node_modules/core-js/modules/es.array.slice.js"),De=e.n(xe),Y=e("./node_modules/core-js/modules/es.array.splice.js"),je=e.n(Y),U=e("./node_modules/core-js/modules/es.object.assign.js"),Ve=e.n(U),Me=e("./node_modules/core-js/modules/es.object.to-string.js"),_e=e.n(Me),Re=e("./node_modules/core-js/modules/es.regexp.exec.js"),Ge=e.n(Re),k=e("./node_modules/core-js/modules/es.regexp.to-string.js"),Ae=e.n(k),M=e("./node_modules/core-js/modules/es.string.includes.js"),Te=e.n(M),ce=e("./node_modules/core-js/modules/es.string.iterator.js"),q=e.n(ce),R=e("./node_modules/core-js/modules/es.string.search.js"),ee=e.n(R),de=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),be=e.n(de),te=e("./node_modules/core-js/modules/web.url.js"),F=e.n(te),Be=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),ne=e.n(Be),ae=e("./node_modules/@babel/runtime/regenerator/index.js"),x=e.n(ae),re=e("./node_modules/regenerator-runtime/runtime.js"),Ke=e.n(re),N=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),W=e.n(N),ue=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),H=e.n(ue),J=e("./node_modules/kea/lib/index.esm.js"),Ce=e("./frontend/src/lib/api.ts"),me=e("./frontend/src/lib/utils.tsx"),X=e("./frontend/src/scenes/teamLogic.ts"),Q=e("./frontend/src/lib/dayjs.ts"),$=e("./node_modules/fuse.js/dist/fuse.esm.js"),f=e("./node_modules/kea-router/lib/index.js"),pe=e.n(f);function K(g,l){var s=Object.keys(g);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(g);l&&(i=i.filter(function(v){return Object.getOwnPropertyDescriptor(g,v).enumerable})),s.push.apply(s,i)}return s}function S(g){for(var l=1;l<arguments.length;l++){var s=arguments[l]!=null?arguments[l]:{};l%2?K(Object(s),!0).forEach(function(i){H()(g,i,s[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(s)):K(Object(s)).forEach(function(i){Object.defineProperty(g,i,Object.getOwnPropertyDescriptor(s,i))})}return g}function j(g,l,s){var i=S(S({userIntent:s?void 0:l?"edit-action":"add-action"},l?{actionId:l}:{}),g?{appUrl:g}:{});return"/api/user/redirect_to_site/"+Object(f.encodeParams)(i,"?")}var Z="https://",oe=Object(J.kea)({path:function(l){return["lib","components","AppEditorLink","appUrlsLogic",l]},key:function(l){return"".concat(l.pageKey).concat(l.actionId)||"global"},props:{},connect:{values:[X.a,["currentTeam","currentTeamId"]],actions:[X.a,["updateCurrentTeam"]]},actions:function(){return{setAppUrls:function(s){return{appUrls:s}},addUrl:function(s,i){return{url:s,launch:i}},newUrl:!0,removeUrl:function(s){return{index:s}},updateUrl:function(s,i){return{index:s,url:i}},launchAtUrl:function(s){return{url:s}},setSearchTerm:function(s){return{term:s}},setEditUrlIndex:function(s){return{originalIndex:s}}}},loaders:function(l){var s=l.values;return{suggestions:{__default:[],loadSuggestions:function(){var i=W()(x.a.mark(function T(){var _,A,b,B;return x.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return A={events:[{id:"$pageview",name:"$pageview",type:"events"}],breakdown:"$current_url",date_from:Object(Q.a)().subtract(3,"days").toISOString()},L.next=3,Ce.a.get("api/projects/".concat(s.currentTeamId,"/insights/trend/?").concat(Object(me.Bb)(A)));case 3:if(b=L.sent.result,!(b&&((_=b[0])===null||_===void 0?void 0:_.count)===0)){L.next=6;break}return L.abrupt("return",[]);case 6:return B=[],L.abrupt("return",(b||[]).filter(function(P){if(!P.breakdown_value)return!1;try{var fe=new URL(P.breakdown_value.toString()).hostname;return B.indexOf(fe)>-1||s.appUrls.filter(function(Ue){return Ue.indexOf(fe)>-1}).length>0?void 0:(B.push(fe),!0)}catch(Ue){return!1}}).map(function(P){return P.breakdown_value}).slice(0,20));case 8:case"end":return L.stop()}},T)}));function v(){return i.apply(this,arguments)}return v}()}}},events:function(l){var s=l.actions,i=l.values;return{afterMount:function(){s.loadSuggestions(),i.currentTeam&&s.setAppUrls(i.currentTeam.app_urls)}}},reducers:function(){return{appUrls:[[],{setAppUrls:function(s,i){var v=i.appUrls;return v},addUrl:function(s,i){var v=i.url;return s.concat([v])},newUrl:function(s){return s.includes(Z)?s:[Z].concat(s)},updateUrl:function(s,i){var v=i.index,T=i.url;return Object.assign(ne()(s),H()({},v,T))},removeUrl:function(s,i){var v=i.index,T=ne()(s);return T.splice(v,1),T}}],suggestions:[[],{addUrl:function(s,i){var v=i.url;return ne()(s).filter(function(T){return v!==T})}}],searchTerm:["",{setSearchTerm:function(s,i){var v=i.term;return v}}],editUrlIndex:[null,{setEditUrlIndex:function(s,i){var v=i.originalIndex;return v},removeUrl:function(s,i){var v=i.index;return s&&v<s?s-1:v===s?null:s}}]}},listeners:function(l){var s,i=l.sharedListeners,v=l.values,T=l.actions;return s={addUrl:[i.saveAppUrls,function(){var _=W()(x.a.mark(function A(b){var B,se;return x.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:B=b.url,se=b.launch,se&&T.launchAtUrl(B);case 2:case"end":return P.stop()}},A)}));return function(A){return _.apply(this,arguments)}}()],removeUrl:i.saveAppUrls,updateUrl:[i.saveAppUrls,function(){return T.setEditUrlIndex(null)}]},H()(s,X.a.actionTypes.loadCurrentTeamSuccess,function(){var _=W()(x.a.mark(function A(b){var B;return x.a.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:B=b.currentTeam,B&&T.setAppUrls(B.app_urls);case 2:case"end":return L.stop()}},A)}));return function(A){return _.apply(this,arguments)}}()),H()(s,"launchAtUrl",function(A){var b=A.url;window.location.href=v.launchUrl(b)}),s},sharedListeners:function(l){var s=l.values;return{saveAppUrls:function(){X.a.actions.updateCurrentTeam({app_urls:s.appUrls})}}},selectors:function(l){var s=l.props;return{appUrlsKeyed:[function(i){return[i.appUrls,i.suggestions,i.searchTerm]},function(i,v,T){var _=i.map(function(A,b){return{url:A,type:"authorized",originalIndex:b}}).concat(v.map(function(A,b){return{url:A,type:"suggestion",originalIndex:b}}));return T?new $.a(_,{keys:["url"],threshold:.3}).search(T).map(function(A){return A.item}):_}],launchUrl:[function(){return[]},function(){return function(i){return j(i,s.actionId,!s.actionId)}}]}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss":function(he,D,e){var G=e("./node_modules/css-loader/dist/runtime/api.js");D=G(!1),D.push([he.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.authorized-urls-table .authorized-url-col{display:flex;align-items:center}.authorized-urls-table .authorized-url-col .lemon-tag{margin-left:4px}.authorized-urls-table .authorized-url-col.suggestion{color:#747ea1}.authorized-urls-table .authorized-url-col.authorized{color:var(--success)}.authorized-urls-table .actions-col{display:flex;align-items:center;justify-content:flex-end}",""]),he.exports=D}}]);
