(window.webpackJsonp=window.webpackJsonp||[]).push([[0,5,9,10,309],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(S,c,e){"use strict";e.r(c);var g=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),f=e.n(g),T=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),d=e.n(T),h={};h.insert="head",h.singleton=!1;var y=f()(d.a,h);c.default=d.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(S,c,e){"use strict";e.r(c),e.d(c,"AppMetricsGraph",function(){return G});var g=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),f=e.n(g),T=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),d=e.n(T),h=e("./node_modules/core-js/modules/es.array.concat.js"),y=e.n(h),F=e("./node_modules/core-js/modules/es.object.keys.js"),Z=e.n(F),$=e("./node_modules/core-js/modules/es.symbol.js"),Q=e.n($),r=e("./node_modules/core-js/modules/es.array.filter.js"),X=e.n(r),W=e("./node_modules/core-js/modules/es.object.to-string.js"),N=e.n(W),x=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Y=e.n(x),l=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),L=e.n(l),A=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),E=e.n(A),O=e("./node_modules/react/index.js"),M=e.n(O),R=e("./frontend/src/lib/colors.ts"),C=e("./node_modules/chart.js/dist/chart.mjs"),i=e("./frontend/src/scenes/apps/constants.tsx"),D=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),w=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),B=e("./frontend/src/lib/utils.tsx"),K=e("./node_modules/react/jsx-runtime.js"),z=e.n(K);function V(p,v){var _=Object.keys(p);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(p);v&&(P=P.filter(function(s){return Object.getOwnPropertyDescriptor(p,s).enumerable})),_.push.apply(_,P)}return _}function J(p){for(var v=1;v<arguments.length;v++){var _=arguments[v]!=null?arguments[v]:{};v%2?V(Object(_),!0).forEach(function(P){f()(p,P,_[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(_)):V(Object(_)).forEach(function(P){Object.defineProperty(p,P,Object.getOwnPropertyDescriptor(_,P))})}return p}function G(p){var v=p.tab,_=p.metrics,P=p.metricsLoading,s=Object(O.useRef)(null),o=i.DescriptionColumns[v];return Object(O.useEffect)(function(){var t;if(s.current&&_){var n;t=new C.a((n=s.current)===null||n===void 0?void 0:n.getContext("2d"),{type:"line",data:{labels:_.dates,datasets:[J({label:o.successes,data:_.successes,borderColor:""},u("data-brand-blue"))].concat(d()(o.successes_on_retry?[J({label:o.successes_on_retry,data:_.successes_on_retry},u("data-yellow"))]:[]),[J({label:o.failures,data:_.failures},u("data-vermilion"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var a;(a=t)===null||a===void 0||a.destroy()}},[_]),P||!_?Object(K.jsx)(D.a,{className:"AppMetricsGraph border rounded p-6"}):Object(K.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:Object(K.jsx)("canvas",{ref:s})})}function u(p){var v=Object(R.b)(p);return{borderColor:v,hoverBorderColor:Object(B.lb)(v,-20),hoverBackgroundColor:Object(B.lb)(v,-20),backgroundColor:v,fill:!1,borderWidth:2,pointRadius:0}}try{G.displayName="AppMetricsGraph",G.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:G.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(p){}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(S,c,e){"use strict";e.r(c),e.d(c,"MetricsTab",function(){return W}),e.d(c,"MetricsOverview",function(){return N}),e.d(c,"ErrorsOverview",function(){return x});var g=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),f=e("./frontend/src/scenes/apps/constants.tsx"),T=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),d=e("./frontend/src/lib/utils.tsx"),h=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),y=e("./frontend/src/lib/components/LemonSelect.tsx"),F=e("./node_modules/kea/lib/index.esm.js"),Z=e("./frontend/src/lib/components/LemonTable/index.ts"),$=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),Q=e("./frontend/src/lib/components/Link.tsx"),r=e("./node_modules/react/jsx-runtime.js"),X=e.n(r);function W(l){var L=l.tab,A=Object(F.useValues)(g.appMetricsSceneLogic),E=A.appMetricsResponse,O=A.appMetricsResponseLoading,M=A.dateFrom,R=Object(F.useActions)(g.appMetricsSceneLogic),C=R.setDateFrom;return Object(r.jsxs)("div",{className:"space-y-8",children:[Object(r.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[Object(r.jsx)(N,{tab:L,metrics:E==null?void 0:E.metrics,metricsLoading:O}),Object(r.jsx)(y.a,{value:M,onChange:function(D){return C(D)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"Delivery trends"}),Object(r.jsx)(h.AppMetricsGraph,{tab:L,metrics:E==null?void 0:E.metrics,metricsLoading:O})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("h2",{children:"Errors"}),Object(r.jsx)(x,{category:L,errors:(E==null?void 0:E.errors)||[],loading:O})]})]})}function N(l){var L,A,E,O=l.tab,M=l.metrics,R=l.metricsLoading,C=l.exportDuration,i=l.exportFailureReason;return R?Object(r.jsx)(T.a,{className:"w-20 mb-2",repeat:4}):Object(r.jsxs)("div",{className:"space-y-4",children:[Object(r.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:"text-muted font-semibold mb-2",children:f.DescriptionColumns[O].successes}),Object(r.jsx)("div",{className:"text-4xl",children:Y(M==null||(L=M.totals)===null||L===void 0?void 0:L.successes)})]}),f.DescriptionColumns[O].successes_on_retry&&Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:"text-muted font-semibold mb-2",children:f.DescriptionColumns[O].successes_on_retry}),Object(r.jsx)("div",{className:"text-4xl",children:Y(M==null||(A=M.totals)===null||A===void 0?void 0:A.successes_on_retry)})]}),Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:"text-muted font-semibold mb-2",children:f.DescriptionColumns[O].failures}),Object(r.jsx)("div",{className:"text-4xl",children:Y(M==null||(E=M.totals)===null||E===void 0?void 0:E.failures)})]}),C&&Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export duration"}),Object(r.jsx)("div",{className:"text-4xl",children:Object(d.O)(C)})]})]}),i&&Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export failure reason"}),Object(r.jsx)("div",{children:i})]})]})}function x(l){var L=l.errors,A=l.loading,E=l.category,O=l.jobId,M=Object(F.useActions)(g.appMetricsSceneLogic),R=M.openErrorDetailsModal;return Object(r.jsx)(Z.a,{dataSource:L,loading:A,columns:[{title:"Error type",dataIndex:"error_type",render:function(i,D){return Object(r.jsx)(Q.a,{title:"View details",className:"font-semibold",onClick:function(B){B.preventDefault(),R(D.error_type,E,O)},children:D.error_type})},sorter:function(i,D){return i.error_type.localeCompare(D.error_type)}},{title:"Count",dataIndex:"count",align:"right",sorter:function(i,D){return i.count-D.count}},{title:"Last seen",dataIndex:"last_seen",render:function(i){return Object(r.jsx)("div",{className:"whitespace-nowrap text-right",children:Object(r.jsx)($.b,{time:i})})},align:"right",sorter:function(i,D){return new Date(i.last_seen||0)>new Date(D.last_seen||0)?1:-1}}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:Object(r.jsxs)("div",{className:"",children:[Object(r.jsx)("b",{children:"No errors! \u{1F973}"}),Object(r.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})}function Y(l){return Object(r.jsx)(r.Fragment,{children:l&&Object(d.P)(l)})}try{W.displayName="MetricsTab",W.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:W.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(l){}try{N.displayName="MetricsOverview",N.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}},exportDuration:{defaultValue:null,description:"",name:"exportDuration",required:!1,type:{name:"number"}},exportFailureReason:{defaultValue:null,description:"",name:"exportFailureReason",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:N.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(l){}try{x.displayName="ErrorsOverview",x.__docgenInfo={description:"",displayName:"ErrorsOverview",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"AppErrorSummary[]"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},category:{defaultValue:null,description:"",name:"category",required:!0,type:{name:"string"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"]={docgenInfo:x.__docgenInfo,name:"ErrorsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"})}catch(l){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(S,c,e){"use strict";e.r(c),e.d(c,"AppMetricsTab",function(){return u}),e.d(c,"appMetricsSceneLogic",function(){return _});var g=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),f=e.n(g),T=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),d=e.n(T),h=e("./node_modules/@babel/runtime/regenerator/index.js"),y=e.n(h),F=e("./node_modules/core-js/modules/es.array.iterator.js"),Z=e.n(F),$=e("./node_modules/core-js/modules/es.object.to-string.js"),Q=e.n($),r=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),X=e.n(r),W=e("./node_modules/core-js/modules/es.array.concat.js"),N=e.n(W),x=e("./node_modules/core-js/modules/es.function.name.js"),Y=e.n(x),l=e("./node_modules/core-js/modules/es.array.includes.js"),L=e.n(l),A=e("./node_modules/core-js/modules/es.string.includes.js"),E=e.n(A),O=e("./node_modules/core-js/modules/es.array.filter.js"),M=e.n(O),R=e("./node_modules/core-js/modules/es.number.constructor.js"),C=e.n(R),i=e("./node_modules/kea/lib/index.esm.js"),D=e("./node_modules/kea-loaders/lib/index.js"),w=e.n(D),B=e("./frontend/src/scenes/urls.ts"),K=e("./frontend/src/lib/api.ts"),z=e("./frontend/src/scenes/teamLogic.tsx"),V=e("./node_modules/kea-router/lib/index.js"),J=e.n(V),G=e("./frontend/src/lib/utils.tsx"),u;(function(s){s.ProcessEvent="processEvent",s.OnEvent="onEvent",s.ExportEvents="exportEvents",s.ScheduledTask="scheduledTask",s.HistoricalExports="historical_exports"})(u||(u={}));var p="-30d",v=[u.ProcessEvent,u.OnEvent,u.ExportEvents,u.ScheduledTask],_=Object(i.kea)([Object(i.path)(function(s){return["scenes","apps","appMetricsSceneLogic",s]}),Object(i.props)({}),Object(i.key)(function(s){return s.pluginConfigId}),Object(i.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}},openErrorDetailsModal:function(o,t,n){return{errorType:o,category:t,jobId:n}},closeErrorDetailsModal:!0}),Object(i.reducers)({activeTab:[null,{setActiveTab:function(o,t){var n=t.tab;return n}}],dateFrom:[p,{setDateFrom:function(o,t){var n=t.dateFrom;return n}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(o,t){var n=t.errorType;return n},closeErrorDetailsModal:function(){return null}}]}),Object(D.loaders)(function(s){var o=s.values,t=s.props;return{pluginConfig:[null,{loadPluginConfig:function(){var n=d()(y.a.mark(function j(){return y.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,K.b.get("api/projects/".concat(z.a.values.currentTeamId,"/plugin_configs/").concat(t.pluginConfigId));case 2:return b.abrupt("return",b.sent);case 3:case"end":return b.stop()}},j)}));function a(){return n.apply(this,arguments)}return a}()}],appMetricsResponse:[null,{loadMetrics:function(){var n=d()(y.a.mark(function j(){var m;return y.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return m=Object(G.Eb)({category:o.activeTab,date_from:o.dateFrom}),I.next=3,K.b.get("api/projects/".concat(z.a.values.currentTeamId,"/app_metrics/").concat(t.pluginConfigId,"?").concat(m));case 3:return I.abrupt("return",I.sent);case 4:case"end":return I.stop()}},j)}));function a(){return n.apply(this,arguments)}return a}()}],historicalExports:[[],{loadHistoricalExports:function(){var n=d()(y.a.mark(function j(){var m,b;return y.a.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,K.b.get("api/projects/".concat(z.a.values.currentTeamId,"/app_metrics/").concat(t.pluginConfigId,"/historical_exports"));case 2:return m=U.sent,b=m.results,U.abrupt("return",b);case 5:case"end":return U.stop()}},j)}));function a(){return n.apply(this,arguments)}return a}()}],errorDetails:[[],{openErrorDetailsModal:function(){var n=d()(y.a.mark(function j(m){var b,I,U,k,q,ee;return y.a.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return b=m.category,I=m.jobId,U=m.errorType,k=Object(G.Eb)({category:b,job_id:I,error_type:U}),H.next=4,K.b.get("api/projects/".concat(z.a.values.currentTeamId,"/app_metrics/").concat(t.pluginConfigId,"/error_details?").concat(k));case 4:return q=H.sent,ee=q.result,H.abrupt("return",ee);case 7:case"end":return H.stop()}},j)}));function a(j){return n.apply(this,arguments)}return a}()}]}}),Object(i.selectors)(function(s){var o=s.values;return{breadcrumbs:[function(t){return[t.pluginConfig,function(n,a){return a.pluginConfigId}]},function(t,n){var a;return[{name:"Apps",path:B.a.projectApps()},{name:t==null||(a=t.plugin_info)===null||a===void 0?void 0:a.name,path:B.a.appMetrics(n)}]}],showTab:[function(){return[]},function(){return function(t){if(o.pluginConfigLoading||!o.pluginConfig||!o.pluginConfig.plugin_info.capabilities)return!1;var n=o.pluginConfig.plugin_info.capabilities,a=n.methods.includes("exportEvents");return t===u.HistoricalExports?a:t===u.OnEvent&&a?!1:t===u.ScheduledTask?!a&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(j){return n.scheduled_tasks.includes(j)}):n.methods.includes(t)}}]}}),Object(i.listeners)(function(s){var o=s.values,t=s.actions;return{loadPluginConfigSuccess:function(){if(!o.activeTab){var a=v.filter(function(b){return o.showTab(b)}),j=f()(a,1),m=j[0];t.setActiveTab(m)}},setActiveTab:function(a){var j=a.tab;j===u.HistoricalExports?t.loadHistoricalExports():t.loadMetrics()},setDateFrom:function(){t.loadMetrics()}}}),Object(V.actionToUrl)(function(s){var o=s.values,t=s.props;return{setActiveTab:function(){return P(o,t)},setDateFrom:function(){return P(o,t)}}}),Object(V.urlToAction)(function(s){var o=s.values,t=s.actions,n=s.props;return{"/app/:pluginConfigId/:page":function(j,m){n.pluginConfigId===Number(j.pluginConfigId)&&(o.pluginConfig||t.loadPluginConfig(),j.page===u.HistoricalExports?t.setActiveTab(u.HistoricalExports):(m.tab&&v.includes(m.tab)&&t.setActiveTab(m.tab),m.from&&t.setDateFrom(m.from)))}}})]);function P(s,o){if(s.activeTab===u.HistoricalExports)return B.a.appHistoricalExports(o.pluginConfigId);var t={};return s.activeTab&&(t.tab=s.activeTab),s.dateFrom!==p&&(t.from=s.dateFrom),B.a.appMetrics(o.pluginConfigId,t)}},"./frontend/src/scenes/apps/constants.tsx":function(S,c,e){"use strict";e.r(c),e.d(c,"DescriptionColumns",function(){return h});var g=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),f=e.n(g),T=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),d,h=(d={},f()(d,T.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),f()(d,T.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),f()(d,T.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),f()(d,T.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),f()(d,T.AppMetricsTab.ScheduledTask,{successes:"Successes",failures:"Failures"}),d)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(S,c,e){var g=e("./node_modules/css-loader/dist/runtime/api.js");c=g(!1),c.push([S.i,".AppMetricsGraph{height:300px}",""]),S.exports=c}}]);
