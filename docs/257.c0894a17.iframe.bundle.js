(window.webpackJsonp=window.webpackJsonp||[]).push([[257],{"./frontend/src/scenes/annotations/index.tsx":function(mn,k,n){"use strict";n.r(k),n.d(k,"scene",function(){return cn}),n.d(k,"Annotations",function(){return J});var K=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),R=n.n(K),W=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),S=n.n(W),Q=n("./node_modules/@babel/runtime/regenerator/index.js"),b=n.n(Q),g=n("./node_modules/react/index.js"),t=n.n(g),z=n("./node_modules/kea/lib/index.esm.js"),H=n("./frontend/src/models/annotationsModel.ts"),X=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),Z=n.n(X),q=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),w=n.n(q),fn=n("./node_modules/core-js/modules/es.array.concat.js"),vn=n("./node_modules/core-js/modules/es.array.iterator.js"),pn=n("./node_modules/core-js/modules/es.object.to-string.js"),An=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Y=n("./frontend/src/lib/api.ts"),F=n("./frontend/src/lib/utils.tsx"),G=n("./frontend/src/scenes/teamLogic.tsx"),U=Object(z.kea)({path:["scenes","annotations","logic"],loaders:function(o){var e=o.actions;return{annotations:{__default:[],loadAnnotations:function(){var d=R()(b.a.mark(function l(){var c;return b.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Y.b.get("api/projects/".concat(G.a.values.currentTeamId,"/annotations/?").concat(Object(F.Bb)({order:"-updated_at"})));case 2:return c=r.sent,e.setNext(c.next),r.abrupt("return",c.results);case 5:case"end":return r.stop()}},l)}));function i(){return d.apply(this,arguments)}return i}()}}},reducers:function(){return{annotations:[[],{appendAnnotations:function(e,d){var i=d.annotations;return[].concat(w()(e),w()(i))}}],next:[null,{setNext:function(e,d){var i=d.next;return i}}],loadingNext:[!1,{loadAnnotationsNext:function(){return!0},appendAnnotations:function(){return!1}}]}},actions:function(){return{updateAnnotation:function(e,d){return{id:e,content:d}},deleteAnnotation:function(e){return{id:e}},restoreAnnotation:function(e){return{id:e}},loadAnnotationsNext:function(){return!0},setNext:function(e){return{next:e}},appendAnnotations:function(e){return{annotations:e}}}},listeners:function(o){var e=o.actions,d=o.values;return Z()({updateAnnotation:function(){var i=R()(b.a.mark(function c(f){var r,A;return b.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return r=f.id,A=f.content,j.next=3,Y.b.update("api/projects/".concat(G.a.values.currentTeamId,"/annotations/").concat(r),{content:A});case 3:e.loadAnnotations();case 4:case"end":return j.stop()}},c)}));function l(c){return i.apply(this,arguments)}return l}(),restoreAnnotation:function(){var i=R()(b.a.mark(function c(f){var r;return b.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return r=f.id,u.next=3,Y.b.update("api/projects/".concat(G.a.values.currentTeamId,"/annotations/").concat(r),{deleted:!1});case 3:e.loadAnnotations();case 4:case"end":return u.stop()}},c)}));function l(c){return i.apply(this,arguments)}return l}(),deleteAnnotation:function(l){var c=l.id;Object(F.w)({endpoint:"projects/".concat(G.a.values.currentTeamId,"/annotations"),object:{name:"Annotation",id:c},callback:function(){return e.loadAnnotations()}})},loadAnnotationsNext:function(){var i=R()(b.a.mark(function c(){var f,r;return b.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(f=[],!d.next){u.next=7;break}return u.next=4,Y.b.get(d.next);case 4:r=u.sent,e.setNext(r.next),f=r.results;case 7:e.appendAnnotations(f);case 8:case"end":return u.stop()}},c)}));function l(){return i.apply(this,arguments)}return l}()},H.a.actionTypes.createGlobalAnnotationSuccess,function(){e.loadAnnotations()})},events:function(o){var e=o.actions;return{afterMount:function(){return e.loadAnnotations()}}}}),_=n("./frontend/src/lib/components/PageHeader.tsx"),T=n("./frontend/src/types.ts"),M=n("./frontend/src/lib/dayjs.ts"),nn=n("./frontend/src/lib/components/Spinner/Spinner.tsx"),tn=n("./frontend/src/lib/components/LemonTable/index.ts"),en=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),an=n("./frontend/src/lib/components/TimezoneAware/index.tsx"),N=n("./frontend/src/lib/components/LemonButton/index.ts"),on=n("./frontend/src/lib/components/DatePicker.tsx"),rn=n("./frontend/src/lib/components/LemonModal/index.ts"),sn=n("./frontend/src/lib/components/LemonSelect.tsx"),ln=n("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx"),L=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),cn={component:J,logic:U};function J(){var a=Object(z.useValues)(U),o=a.annotations,e=a.annotationsLoading,d=a.next,i=a.loadingNext,l=Object(z.useActions)(U),c=l.updateAnnotation,f=l.deleteAnnotation,r=l.loadAnnotationsNext,A=l.restoreAnnotation,u=Object(z.useActions)(H.a),j=u.createGlobalAnnotation,h=Object(g.useState)(!1),I=S()(h,2),B=I[0],O=I[1],$=Object(g.useState)(null),P=S()($,2),x=P[0],C=P[1],y=[{title:"Annotation",key:"annotation",width:"30%",render:function(v,s){return t.a.createElement("div",{className:"ph-no-capture"},s.content)}},{title:"For date",dataIndex:"date_marker",render:function(v,s){return t.a.createElement("span",null,Object(M.a)(s.date_marker).format("MMMM DD, YYYY"))},sorter:function(v,s){return Object(M.a)(v.date_marker).diff(s.date_marker)}},Object(en.b)(),{title:"Last updated",dataIndex:"updated_at",render:function(v,s){return t.a.createElement(an.b,{time:s.updated_at})},sorter:function(v,s){return Object(M.a)(v.date_marker).diff(s.date_marker)}},{title:"Status",render:function(v,s){return s.deleted?t.a.createElement(L.a,{type:"danger"},"Deleted"):t.a.createElement(L.a,{type:"success"},"Active")}},{title:"Scope",render:function(v,s){return s.scope===T.c.Insight?t.a.createElement(L.a,{className:"border",style:{color:"#096dd9",background:"#e6f7ff",borderColor:"#91d5ff"}},"Insight"):s.scope===T.c.Project?t.a.createElement(L.a,{className:"border",style:{color:"#531dab",background:"#f9f0ff",borderColor:"#d3adf7"}},"Project"):s.scope===T.c.Organization?t.a.createElement(L.a,{className:"border",style:{color:"#c41d7f",background:"#fff0f6",borderColor:"#ffadd2"}},"Organization"):t.a.createElement(L.a,null,"Unknown (",s.scope,")")}}];function D(){O(!1),setTimeout(function(){return C(null)},500)}return t.a.createElement("div",null,t.a.createElement(_.a,{title:"Annotations",caption:"Here you can add organization- and project-wide annotations. Dashboard-specific ones can be added directly in the dashboard.",buttons:t.a.createElement(N.a,{type:"primary","data-attr":"create-annotation",onClick:function(){return O(!0)}},"New annotation")}),t.a.createElement("div",null,t.a.createElement(tn.a,{"data-attr":"annotations-table",rowKey:"id",rowClassName:"cursor-pointer",dataSource:o,columns:y,loading:e,onRow:function(v){return{onClick:function(){C(v),O(!0)}}},emptyState:"No annotations yet"}),t.a.createElement("div",{className:"flex flex-row justify-center mt-8"},d&&t.a.createElement(N.a,{type:"primary",icon:i?t.a.createElement(nn.a,null):null,onClick:function(){r()}},"Load more annotations"))),t.a.createElement(dn,{visible:B,onCancel:function(){D()},onSubmit:function(){var m=R()(b.a.mark(function v(s,V,un){return b.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(p.t0=x,!p.t0){p.next=5;break}return p.next=4,x;case 4:p.t0=p.sent;case 5:if(!p.t0){p.next=9;break}c(x.id,s),p.next=10;break;case 9:j(s,V.format("YYYY-MM-DD"),void 0,un);case 10:D();case 11:case"end":return p.stop()}},v)}));return function(v,s,V){return m.apply(this,arguments)}}(),onDelete:function(){x&&f(x.id),D()},onRestore:function(){x&&A(x.id),D()},annotation:x}))}var E;(function(a){a[a.CREATE=0]="CREATE",a[a.EDIT=1]="EDIT"})(E||(E={}));function dn(a){var o,e=Object(g.useState)(T.c.Project),d=S()(e,2),i=d[0],l=d[1],c=Object(g.useState)(""),f=S()(c,2),r=f[0],A=f[1],u=Object(g.useState)(E.CREATE),j=S()(u,2),h=j[0],I=j[1],B=Object(g.useState)(Object(M.a)()),O=S()(B,2),$=O[0],P=O[1];Object(g.useEffect)(function(){a.annotation?(I(E.EDIT),A(a.annotation.content)):(I(E.CREATE),A(""))},[a.annotation]);var x=function(y,D,m){a.onSubmit(y,D,m),A(""),P(Object(M.a)()),l(T.c.Project)};return t.a.createElement(rn.a,{isOpen:a.visible,footer:t.a.createElement(t.a.Fragment,null,h===E.EDIT?t.a.createElement("div",{className:"flex-1"},(o=a.annotation)!==null&&o!==void 0&&o.deleted?t.a.createElement(N.a,{type:"secondary",status:"primary-alt",onClick:a.onRestore,"data-attr":"restore-annotation"},"Restore annotation"):t.a.createElement(N.a,{type:"secondary",status:"danger",onClick:a.onDelete,"data-attr":"delete-annotation"},"Delete annotation")):null,t.a.createElement(N.a,{key:"create-annotation-cancel",type:"secondary",onClick:function(){return a.onCancel()}},"Cancel"),t.a.createElement(N.a,{type:"primary",key:"create-annotation-submit","data-attr":"create-annotation-submit",onClick:function(){x(r,$,i)}},h===E.CREATE?"Submit":"Update")),onClose:a.onCancel,title:h===E.CREATE?"Create annotation":"Edit annotation"},h===E.CREATE?t.a.createElement("span",null,"This annotation will appear on all"," ",t.a.createElement("div",{className:"inline-flex"},t.a.createElement(sn.a,{size:"small",dropdownMaxContentWidth:!0,options:[{value:T.c.Project,label:"project"},{value:T.c.Organization,label:"organization"}],onChange:function(y){y&&l(y)},value:i}))," ","insights"):null,h===E.CREATE&&t.a.createElement("div",null,t.a.createElement("div",{className:"my-2 flex flex-row items-center"},"Date:\xA0",t.a.createElement(on.a,{getPopupContainer:function(y){return y.parentElement},value:$,onChange:function(y){return P(y)},allowClear:!1}))),t.a.createElement("div",null,"Annotation text:"),t.a.createElement(ln.a,{"data-attr":"create-annotation-input",maxLength:300,className:"mt-1",rows:4,value:r,onChange:A}))}}}]);
