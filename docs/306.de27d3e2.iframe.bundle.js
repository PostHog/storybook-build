var Pe=Object.defineProperty,ze=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var le=(x,d,s)=>d in x?Pe(x,d,{enumerable:!0,configurable:!0,writable:!0,value:s}):x[d]=s,b=(x,d)=>{for(var s in d||(d={}))Ke.call(d,s)&&le(x,s,d[s]);if(ce)for(var s of ce(d))Ye.call(d,s)&&le(x,s,d[s]);return x},S=(x,d)=>ze(x,Ue(d));var U=(x,d,s)=>new Promise((C,L)=>{var c=O=>{try{F(s.next(O))}catch(k){L(k)}},N=O=>{try{F(s.throw(O))}catch(k){L(k)}},F=O=>O.done?C(O.value):Promise.resolve(O.value).then(c,N);F((s=s.apply(x,d)).next())});(window.webpackJsonp=window.webpackJsonp||[]).push([[306],{"./frontend/src/scenes/actions/Action.tsx":function(x,d,s){"use strict";s.r(d),s.d(d,"scene",function(){return Ve}),s.d(d,"Action",function(){return R});var C=s("./frontend/src/lib/utils.tsx"),L=s("./frontend/src/lib/components/Link.tsx"),c=s("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),N=s("./frontend/src/lib/api.ts"),F=s("./frontend/src/models/actionsModel.ts"),O=s("./frontend/src/lib/components/lemonToast.tsx"),k=s("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),X=s("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.0/node_modules/kea-forms/lib/index.js"),$=s("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),v=s("./frontend/src/scenes/urls.ts"),re=s("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts"),W=s("./frontend/src/models/tagsModel.ts"),e=s("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const Z=Object(c.kea)([Object(c.path)(["scenes","actions","actionEditLogic"]),Object(c.props)({}),Object(c.key)(n=>n.id||"new"),Object(c.connect)({actions:[W.a,["loadTags"]]}),Object(c.actions)({setAction:function(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:n,options:t}},setCreateNew:n=>({createNew:n}),actionAlreadyExists:n=>({actionId:n}),deleteAction:!0}),Object(c.connect)({actions:[F.a,["loadActions"],re.c,["loadEventDefinitions"]]}),Object(c.reducers)({createNew:[!1,{setCreateNew:(n,t)=>{let{createNew:a}=t;return a}}]}),Object(X.forms)(n=>{let{actions:t,props:a}=n;return{action:{defaults:b({},a.action),errors:o=>{let{name:r}=o;return{name:r?null:"You need to set a name"}},submit:o=>{t.saveAction(o)}}}}),Object(k.loaders)(n=>{let{props:t,values:a,actions:o}=n;return{actionCount:{loadActionCount:()=>U(this,null,function*(){return t.id?yield N.b.actions.getCount(t.id):0})},action:[b({},t.action),{setAction:r=>{let{action:j,options:{merge:l}}=r;return l?b(b({},a.action),j):j},saveAction:(r,j)=>U(this,null,function*(){let l=b({},r);l.steps=l.steps?l.steps.filter(u=>u.event):[];try{l.id?l=yield N.b.actions.update(l.id,l,t.temporaryToken):l=yield N.b.actions.create(l,t.temporaryToken),j()}catch(u){if(u.code==="unique"){const g=u.detail.split(" ").pop();return O.d.error(Object(e.jsxs)(e.Fragment,{children:["Action with this name already exists."," ",Object(e.jsx)(L.a,{to:v.a.action(g),children:"Click here to edit."})]})),l}throw u}return O.d.success("Action saved"),t.onSave(l),o.loadEventDefinitions(null),o.loadActions(),o.loadTags(),l})}]}}),Object(c.listeners)(n=>{let{values:t,actions:a}=n;return{deleteAction:()=>{Object(C.x)({endpoint:N.b.actions.determineDeleteEndpoint(),object:t.action,callback:()=>{$.router.actions.push(v.a.actions()),a.loadActions()}})}}}),Object(c.afterMount)(n=>{let{actions:t,props:a}=n;a.id?t.loadActionCount():t.setAction({name:"",steps:[{isNew:Object(C.Jb)()}]},{merge:!1})})]);var Je=s("./frontend/src/scenes/actions/Actions.scss"),de=s("./frontend/src/scenes/actions/EventName.tsx"),ue=s("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),me=s("./frontend/src/lib/components/Tooltip.tsx"),M=s("./frontend/src/scenes/actions/hints.tsx"),q=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/col/index.js"),y=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/radio/index.js"),_=s("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),T=s("./frontend/@posthog/lemon-ui/src/index.ts"),K=s("./frontend/src/lib/components/icons.tsx"),je=s("./frontend/src/lib/components/LemonDialog/index.ts"),he=s("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),pe=s("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),Y=s("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx");const ee="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function P(n){let{step:t,actionId:a,isOnlyStep:o,index:r,identifier:j,onDelete:l,onChange:u}=n;const g=f=>{u(f)};return Object(e.jsx)(q.a,{span:24,md:12,children:Object(e.jsxs)("div",{className:"rounded border p-4 relative h-full",children:[r>0&&Object(e.jsx)("div",{className:"stateful-badge pos-center-end or",children:"OR"}),Object(e.jsxs)("div",{className:"space-y-4",children:[Object(e.jsxs)("div",{className:"flex items-center justify-between",children:[Object(e.jsxs)("b",{children:["Match Group #",r+1]}),!o&&Object(e.jsx)(T.LemonButton,{status:"primary-alt",icon:Object(e.jsx)(K.IconClose,{}),size:"small","aria-label":"delete",onClick:l})]}),Object(e.jsx)(ge,{step:t,sendStep:g}),t.event==="$autocapture"&&Object(e.jsx)(be,{step:t,sendStep:g,actionId:a}),t.event!=null&&t.event!=="$autocapture"&&t.event!=="$pageview"&&Object(e.jsxs)("div",{className:"space-y-1",children:[Object(e.jsx)(Y.a,{children:"Event name"}),Object(e.jsx)(de.a,{value:t.event,onChange:f=>g(S(b({},t),{event:f||""}))}),Object(e.jsxs)("small",{children:[Object(e.jsx)(T.Link,{to:"https://posthog.com/docs/libraries",target:"_blank",children:"See documentation"})," ","on how to send custom events in lots of languages."]})]}),t.event==="$pageview"&&Object(e.jsxs)("div",{children:[Object(e.jsx)(w,{step:t,sendStep:g,item:"url",extra_options:Object(e.jsx)(te,{step:t,sendStep:g}),label:"URL"}),t.url_matching&&t.url_matching in M.a&&Object(e.jsx)("small",{children:M.a[t.url_matching]})]}),t.event&&Object(e.jsxs)("div",{className:"mt-6 space-y-2",children:[Object(e.jsx)("h3",{children:"Filters"}),(!t.properties||t.properties.length===0)&&Object(e.jsx)("div",{className:"text-muted",children:"This match group has no additional filters."}),Object(e.jsx)(ue.a,{propertyFilters:t.properties,pageKey:j,eventNames:t.event?[t.event]:[],onChange:f=>{g(S(b({},t),{properties:f}))},showConditionBadge:!0})]})]})]})})}function w(n){const t=a=>n.sendStep(S(b({},n.step),{[n.item]:a||null}));return Object(e.jsxs)("div",{className:"space-y-1",children:[Object(e.jsxs)(Y.a,{children:[n.label," ",n.extra_options]}),n.caption&&Object(e.jsx)("div",{className:"action-step-caption",children:n.caption}),n.item==="selector"?Object(e.jsx)(T.LemonTextArea,{onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}):Object(e.jsx)(T.LemonInput,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder})]})}const J=()=>Object(e.jsx)("div",{className:"text-center my-2",children:Object(e.jsx)("span",{className:"stateful-badge and",children:"AND"})});function be(n){let{step:t,actionId:a,sendStep:o}=n;const r=()=>{je.a.open({title:"Select an element",description:a?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",content:Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(he.a,{actionId:a,type:pe.a.TOOLBAR_URLS})}),primaryButton:{children:"Close",type:"secondary"}})};return Object(e.jsxs)("div",{className:"space-y-4",children:[Object(e.jsxs)("div",{className:"flex items-center gap-2",children:[Object(e.jsx)(T.LemonButton,{size:"small",type:"secondary",onClick:r,sideIcon:Object(e.jsx)(K.IconOpenInApp,{}),children:"Select element on site"}),Object(e.jsx)(T.Link,{to:`${ee}#autocapture-based-actions`,target:"_blank",children:"See documentation."})]}),Object(e.jsx)(w,{step:t,sendStep:o,item:"href",label:"Link target equals",caption:Object(e.jsxs)(e.Fragment,{children:["If your element is a link, the location that the link opens (",Object(e.jsx)("code",{children:"href"})," tag)"]})}),Object(e.jsx)(J,{}),Object(e.jsx)(w,{step:t,sendStep:o,item:"text",label:"Text equals",caption:"Text content inside your element"}),Object(e.jsx)(J,{}),Object(e.jsx)(w,{step:t,sendStep:o,item:"selector",label:Object(e.jsxs)(e.Fragment,{children:["HTML selector matches",Object(e.jsx)(me.a,{title:"Click here to learn more about supported selectors",children:Object(e.jsx)(T.Link,{to:`${ee}#matching-selectors`,target:"_blank",children:Object(e.jsx)(_.a,{})})})]}),placeholder:'button[data-attr="my-id"]',caption:Object(e.jsxs)("span",{children:["CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",Object(e.jsx)("code",{className:"code",children:'[data-attr="signup"]'})]})}),Object(e.jsx)(J,{}),Object(e.jsx)(w,{step:t,sendStep:o,item:"url",extra_options:Object(e.jsx)(te,{step:t,sendStep:o}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(t==null?void 0:t.url_matching)&&t.url_matching in M.a&&Object(e.jsx)("small",{children:M.a[t.url_matching]})]})}function ge(n){let{step:t,sendStep:a}=n;const o=r=>{const j=r.target.value;j==="$autocapture"?a(S(b({},t),{event:"$autocapture"})):j==="event"?a(S(b({},t),{event:""})):j==="$pageview"&&a(S(b({},t),{event:"$pageview",url:t.url}))};return Object(e.jsx)("div",{className:"type-switcher",children:Object(e.jsxs)(y.a.Group,{buttonStyle:"solid",onChange:o,value:t.event==="$autocapture"||t.event==="$pageview"||t.event===void 0?t.event:"event",children:[Object(e.jsx)(y.a.Button,{value:"$autocapture",children:"Autocapture"}),Object(e.jsx)(y.a.Button,{value:"event",children:"Custom event"}),Object(e.jsx)(y.a.Button,{value:"$pageview",children:"Page view"})]})})}function te(n){let{step:t,sendStep:a}=n;const o=r=>{a(S(b({},t),{url_matching:r.target.value}))};return Object(e.jsxs)(y.a.Group,{buttonStyle:"solid",onChange:o,value:t.url_matching||"contains",size:"small",children:[Object(e.jsx)(y.a.Button,{value:"contains",children:"contains"}),Object(e.jsx)(y.a.Button,{value:"regex",children:"matches regex"}),Object(e.jsx)(y.a.Button,{value:"exact",children:"matches exactly"})]})}try{P.displayName="ActionStep",P.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:P.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(n){}var xe=s("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/row/index.js"),Oe=s("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),ve=s("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),fe=s("./frontend/src/lib/components/PageHeader.tsx"),ye=s("./frontend/src/scenes/teamLogic.tsx"),ne=s("./frontend/src/lib/components/EditableField/EditableField.tsx"),Ae=s("./frontend/src/types.ts"),Se=s("./frontend/src/scenes/userLogic.ts"),Ce=s("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),E=s("./frontend/src/lib/forms/Field.tsx"),V=s("./frontend/src/lib/components/LemonButton/index.ts"),Le=s("./frontend/src/lib/components/LemonCheckbox/index.ts"),Ne=s("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function z(n){let{action:t,id:a,onSave:o,temporaryToken:r}=n;const j={id:a,action:t,onSave:h=>o(h),temporaryToken:r},l=Z(j),{action:u,actionLoading:g,actionCount:f,actionCountLoading:Re}=Object(c.useValues)(l),{submitAction:ae,deleteAction:Be}=Object(c.useActions)(l),{currentTeam:H}=Object(c.useValues)(ye.a),{hasAvailableFeature:De}=Object(c.useValues)(Se.a),{tags:$e}=Object(c.useValues)(W.a),Q=H==null?void 0:H.slack_incoming_webhook,oe=()=>Object(e.jsx)(V.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",onClick:()=>{Be()},children:"Delete"}),ie=()=>Object(e.jsx)(V.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",onClick:()=>{$.router.actions.push(v.a.actions())},children:"Cancel"});return Object(e.jsx)("div",{className:"action-edit-container",children:Object(e.jsxs)(X.Form,{logic:Z,props:j,formKey:"action",enableFormOnSubmit:!0,children:[Object(e.jsx)(fe.a,{title:Object(e.jsx)(E.a,{name:"name",children:h=>{let{value:i,onChange:p}=h;return Object(e.jsx)(ne.a,{name:"name",value:i||"",placeholder:"Name this action",onChange:a?void 0:p,onSave:m=>{p(m),ae()},mode:a?void 0:"edit",minLength:1,maxLength:400,"data-attr":`action-name-${a?"edit":"create"}`,className:"action-name"})}}),caption:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(E.a,{name:"description",children:h=>{let{value:i,onChange:p}=h;return Object(e.jsx)(ne.a,{multiline:!0,name:"description",value:i||"",placeholder:"Description (optional)",onChange:a?void 0:p,onSave:m=>{p(m),ae()},mode:a?void 0:"edit","data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!De(Ae.e.INGESTION_TAXONOMY)})}}),Object(e.jsx)(E.a,{name:"tags",children:h=>{let{value:i,onChange:p}=h;return Object(e.jsx)(Ce.a,{tags:i!=null?i:[],onChange:(m,A)=>p(A),className:"action-tags",saving:g,tagsAvailable:$e.filter(m=>{var A;return!((A=u.tags)!==null&&A!==void 0&&A.includes(m))})})}})]}),buttons:Object(e.jsxs)(e.Fragment,{children:[a?Object(e.jsx)(V.a,{type:"secondary",to:Object($.combineUrl)(v.a.sessionRecordings(),{filters:{actions:[{id:a,type:"actions",order:0,name:u.name}]}}).url,sideIcon:Object(e.jsx)(K.IconPlayCircle,{}),"data-attr":"action-view-recordings",children:"View recordings"}):null,a?oe():ie()]})}),a&&Object(e.jsx)("div",{className:"input-set",children:Object(e.jsx)("div",{children:Object(e.jsxs)("span",{className:"text-muted mb-2",children:[Re&&Object(e.jsx)(Oe.a,{}),f!==null&&f>-1&&Object(e.jsxs)(e.Fragment,{children:["This action matches ",Object(e.jsx)("b",{children:Object(C.p)(f)})," events in the last 3 months"]})]})})}),Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Match groups"}),Object(e.jsxs)("div",{children:["Your action will be triggered whenever ",Object(e.jsx)("b",{children:"any of your match groups"})," are received."," ",Object(e.jsx)(L.a,{to:"https://posthog.com/docs/features/actions",target:"_blank",children:Object(e.jsx)(_.a,{})})]}),Object(e.jsx)(E.a,{name:"steps",children:h=>{let{onChange:i}=h;return Object(e.jsx)("div",{className:"flex justify-end mb-2",children:Object(e.jsx)(V.a,{onClick:()=>i([...u.steps||[],{isNew:Object(C.Jb)()}]),size:"small",type:"secondary",children:"Add another match group"})})}}),Object(e.jsx)(E.a,{name:"steps",children:h=>{let{value:i,onChange:p}=h;return Object(e.jsxs)(xe.a,{gutter:[24,24],children:[Object(e.jsx)(e.Fragment,{children:i.map((m,A)=>{const Me=String(JSON.stringify(m));return Object(e.jsx)(P,{identifier:Me,index:A,step:m,actionId:u.id||0,isOnlyStep:!!i&&i.length===1,onDelete:()=>{var B;const I=m.id?"id":"isNew";p((B=i==null?void 0:i.filter(D=>D[I]!==m[I]))!==null&&B!==void 0?B:[])},onChange:B=>{var I;p((I=i==null?void 0:i.map(D=>m.id&&D.id==m.id||m.isNew&&D.isNew===m.isNew?b({id:m.id,isNew:m.isNew},B):D))!==null&&I!==void 0?I:[])}},A)})}),Object(e.jsx)(q.a,{span:24,md:12,children:Object(e.jsx)("div",{className:"match-group-add-skeleton",onClick:()=>{p([...u.steps||[],{isNew:Object(C.Jb)()}])},children:Object(e.jsx)(ve.a,{style:{fontSize:28,color:"#666666"}})})})]})}})]}),Object(e.jsxs)("div",{className:"my-8",children:[Object(e.jsx)(E.a,{name:"post_to_slack",children:h=>{let{value:i,onChange:p}=h;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Le.a,{id:"webhook-checkbox",checked:!!i,onChange:p,disabled:!Q,label:Object(e.jsx)(e.Fragment,{children:"Post to webhook when this action is triggered."})}),Object(e.jsx)("p",{className:"pl-7",children:Object(e.jsxs)(L.a,{to:"/project/settings#webhook",children:[Q?"Configure":"Enable"," this integration in Project Settings."]})})]})}}),u.post_to_slack&&Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(E.a,{name:"slack_message_format",children:h=>{let{value:i,onChange:p}=h;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Y.a,{showOptional:!0,children:"Message format"}),Object(e.jsx)(Ne.a,{placeholder:"Default: [action.name] triggered by [person]",value:i,onChange:p,disabled:!Q||!u.post_to_slack,"data-attr":"edit-slack-message-format"}),Object(e.jsx)("small",{children:Object(e.jsx)(L.a,{to:"https://posthog.com/docs/integrate/webhooks/message-formatting",target:"_blank",children:"See documentation on how to format webhook messages."})})]})}})})]}),Object(e.jsxs)("div",{className:"flex justify-end gap-2",children:[a?oe():ie(),Object(e.jsx)(V.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:g,children:"Save"})]})]})})}try{z.displayName="ActionEdit",z.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:z.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(n){}var Te=s("./frontend/src/scenes/events/index.ts"),Ee=s("./frontend/src/lib/dayjs.ts"),Ie=s("./frontend/src/lib/components/Spinner/Spinner.tsx");const G=Object(c.kea)({props:{},key:n=>n.id||"new",path:n=>["scenes","actions","actionLogic",n],actions:()=>({checkIsFinished:n=>({action:n}),setPollTimeout:n=>({pollTimeout:n}),setIsComplete:n=>({isComplete:n})}),reducers:()=>({pollTimeout:[null,{setPollTimeout:(n,t)=>{let{pollTimeout:a}=t;return a}}],isComplete:[!1,{setIsComplete:(n,t)=>{let{isComplete:a}=t;return a}}]}),selectors:{breadcrumbs:[n=>[n.action],n=>[{name:"Data Management",path:v.a.eventDefinitions()},{name:"Actions",path:v.a.actions()},{name:(n==null?void 0:n.name)||"Unnamed",path:n?v.a.action(n.id):void 0}]]},loaders:n=>{let{actions:t,props:a}=n;return{action:{loadAction:()=>U(this,null,function*(){if(t.setIsComplete(!1),!a.id)throw new Error("Cannot fetch an unsaved action from the API.");const o=yield N.b.actions.get(a.id);return t.checkIsFinished(o),o})}}},listeners:n=>{let{actions:t,values:a}=n;return{checkIsFinished:o=>{let{action:r}=o;r.is_calculating?t.setPollTimeout(setTimeout(()=>t.loadAction(),1e3)):(t.setIsComplete(new Date),a.pollTimeout&&clearTimeout(a.pollTimeout))}}},events:n=>{let{values:t,actions:a,props:o}=n;return{afterMount:()=>{o.id&&a.loadAction()},beforeUnmount:()=>{t.pollTimeout&&clearTimeout(t.pollTimeout)}}}});var Fe=s("./frontend/src/queries/Query/Query.tsx"),se=s("./frontend/src/queries/schema.ts"),ke=s("./frontend/src/lib/logic/featureFlagLogic.ts"),we=s("./frontend/src/lib/constants.tsx");const Ve={logic:G,component:R,paramsToProps:n=>{let{params:{id:t}}=n;return{id:parseInt(t)}}};function R(){let{id:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={action_id:n},{push:a}=Object(c.useActions)($.router),{action:o,isComplete:r}=Object(c.useValues)(G),{loadAction:j}=Object(c.useActions)(G),{featureFlags:l}=Object(c.useValues)(ke.a),u=l[we.i.DATA_EXPLORATION_LIVE_EVENTS];return Object(e.jsxs)(e.Fragment,{children:[(!n||o)&&Object(e.jsx)(z,{id:n,action:o,onSave:g=>{n||a(v.a.action(g.id)),j()}}),n&&(r?Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("p",{children:["This is the list of ",Object(e.jsx)("strong",{children:"recent"})," events that match this action.",o!=null&&o.last_calculated_at?Object(e.jsxs)(e.Fragment,{children:[" ","Last calculated: ",Object(e.jsx)("b",{children:Object(Ee.a)(o.last_calculated_at).fromNow()}),"."]}):""]}),Object(e.jsx)("div",{className:"pt-4 border-t"}),u?Object(e.jsx)(Fe.a,{query:{kind:se.a.DataTableNode,source:{kind:se.a.EventsNode,actionId:n},showReload:!0,showColumnConfigurator:!0,showExport:!0}}):Object(e.jsx)(Te.b,{fixedFilters:t,sceneUrl:v.a.action(n),fetchMonths:3,pageKey:`action-${n}-${JSON.stringify(t)}`,showEventFilter:!1})]}):Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsx)(Ie.a,{className:"mr-4"}),"Calculating action, please hold on."]})]}))]})}try{R.displayName="Action",R.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:R.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(n){}}}]);
