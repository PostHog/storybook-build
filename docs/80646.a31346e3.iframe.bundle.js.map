{"version":3,"file":"80646.a31346e3.iframe.bundle.js","mappings":";;;;AA4FA;;;;;;AAMA","sources":["webpack://@posthog/storybook/../../products/customer_analytics/frontend/components/Insights/ActiveUsersInsights.tsx"],"sourcesContent":["import { useActions, useValues } from 'kea'\n\nimport { IconGear } from '@posthog/icons'\nimport { LemonBanner, LemonButton, Link } from '@posthog/lemon-ui'\n\nimport { TaxonomicFilterGroupType } from 'lib/components/TaxonomicFilter/types'\nimport { ActionFilter } from 'scenes/insights/filters/ActionFilter/ActionFilter'\nimport { MathAvailability } from 'scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow'\nimport { urls } from 'scenes/urls'\n\nimport { Query } from '~/queries/Query/Query'\nimport { NodeKind } from '~/queries/schema/schema-general'\nimport { hogql } from '~/queries/utils'\n\nimport { customerAnalyticsSceneLogic } from '../../customerAnalyticsSceneLogic'\nimport { InsightDefinition } from '../../insightDefinitions'\nimport { CustomerAnalyticsQueryCard } from '../CustomerAnalyticsQueryCard'\nimport { EventConfigModal } from './EventConfigModal'\n\nexport function ActiveUsersInsights(): JSX.Element {\n    const { activityEvent, activityEventSelectionWithDefault, activeUsersInsights, hasActivityEventChanged, tabId } =\n        useValues(customerAnalyticsSceneLogic)\n    const { setActivityEventSelection, saveActivityEvent, toggleEventConfigModal } =\n        useActions(customerAnalyticsSceneLogic)\n    const isActivityEventPageview = activityEvent === '$pageview'\n\n    return (\n        <div className=\"space-y-2 mb-0\">\n            {isActivityEventPageview && (\n                <LemonBanner type=\"warning\">\n                    You are currently using pageview event to define user activity. Consider using a more specific\n                    event, so that you're tracking activity accurately.\n                    <div className=\"flex flex-row items-center gap-4 mt-2 max-w-160\">\n                        <ActionFilter\n                            filters={activityEventSelectionWithDefault}\n                            setFilters={setActivityEventSelection}\n                            typeKey=\"customer-analytics-activity-event\"\n                            mathAvailability={MathAvailability.None}\n                            hideDeleteBtn={true}\n                            hideRename={true}\n                            hideDuplicate={true}\n                            hideFilter={true}\n                            entitiesLimit={1}\n                            actionsTaxonomicGroupTypes={[TaxonomicFilterGroupType.Events]}\n                            buttonCopy=\"Change event\"\n                        />\n                        <LemonButton\n                            type=\"primary\"\n                            disabledReason={hasActivityEventChanged ? null : 'No changes'}\n                            onClick={saveActivityEvent}\n                        >\n                            Save activity event\n                        </LemonButton>\n                    </div>\n                </LemonBanner>\n            )}\n            <div className=\"flex items-center gap-2 ml-1\">\n                <h2 className=\"m-0\">Active Users</h2>\n                {!isActivityEventPageview && (\n                    <LemonButton\n                        icon={<IconGear />}\n                        size=\"small\"\n                        noPadding\n                        onClick={() => toggleEventConfigModal()}\n                        tooltip=\"Configure activity event\"\n                    />\n                )}\n            </div>\n            <div className=\"grid grid-cols-[3fr_1fr] gap-2\">\n                {activeUsersInsights.map((insight, index) => {\n                    return (\n                        <CustomerAnalyticsQueryCard key={index} insight={insight as InsightDefinition} tabId={tabId} />\n                    )\n                })}\n            </div>\n            <h2 className=\"ml-1 -mb-2\">Power Users</h2>\n            <PowerUsersTable />\n            <EventConfigModal />\n        </div>\n    )\n}\n\nfunction PowerUsersTable(): JSX.Element {\n    const { activityEvent, tabId } = useValues(customerAnalyticsSceneLogic)\n    const query = {\n        kind: NodeKind.DataTableNode,\n        source: {\n            kind: NodeKind.HogQLQuery,\n            query: hogql`\n                SELECT person_id,\n                       count() as event_count\n                FROM events\n                WHERE event = ${activityEvent}\n                  and timestamp\n                    > now() - interval '30 days'\n                GROUP BY person_id\n                ORDER BY event_count DESC\n                    LIMIT 10\n            `,\n        },\n        columns: ['person_id', 'event_count'],\n    }\n\n    return (\n        <Query\n            uniqueKey={`power-users-${tabId}`}\n            attachTo={customerAnalyticsSceneLogic}\n            query={{ ...query, showTimings: false, showOpenEditorButton: false }}\n            context={{\n                columns: {\n                    person_id: {\n                        title: 'Person',\n                        render: ({ value }) => (\n                            <div className=\"flex items-center gap-2\">\n                                <Link target=\"_blank\" to={urls.personByUUID(value as string)}>\n                                    {value}\n                                </Link>\n                            </div>\n                        ),\n                    },\n                    event_count: {\n                        title: 'Event Count',\n                        render: ({ value }) => <strong>{value}</strong>,\n                    },\n                },\n            }}\n        />\n    )\n}\n"],"names":[],"sourceRoot":""}