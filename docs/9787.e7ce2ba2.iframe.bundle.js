"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[9787],{"../../frontend/src/scenes/heatmaps/HeatmapsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HeatmapsScene:()=>HeatmapsScene,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.7_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),AuthorizedUrlList=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),authorizedUrlListLogic=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),HeatMapsSettings=__webpack_require__("../../frontend/src/lib/components/heatmaps/HeatMapsSettings.tsx"),hedgehogs=__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx"),utils=__webpack_require__("../../frontend/src/lib/components/IframedToolbarBrowser/utils.ts"),useResizeObserver=__webpack_require__("../../frontend/src/lib/hooks/useResizeObserver.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),sidePanelSettingsLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/panels/sidePanelSettingsLogic.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.232.7_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),queries_utils=__webpack_require__("../../frontend/src/queries/utils.ts");let teamId=window.POSTHOG_APP_CONTEXT?.current_team?.id,heatmapsBrowserLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","heatmaps","heatmapsBrowserLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)({values:[(0,authorizedUrlListLogic.zl)({...authorizedUrlListLogic.P1,type:authorizedUrlListLogic.uw.TOOLBAR_URLS}),["urlsKeyed","checkUrlIsAuthorized"]]}),(0,index_esm.actions)({setBrowserSearch:searchTerm=>({searchTerm}),setBrowserUrl:url=>({url}),onIframeLoad:!0,sendToolbarMessage:(type,payload)=>({type,payload}),loadTopUrls:!0,maybeLoadTopUrls:!0,loadBrowserSearchResults:!0,patchHeatmapFilters:filters=>({filters}),setHeatmapColorPalette:Palette=>({Palette}),setHeatmapFixedPositionMode:mode=>({mode}),setCommonFilters:filters=>({filters}),setIframeWidth:width=>({width}),toggleFilterPanelCollapsed:!0,setIframeBanner:banner=>({banner}),startTrackingLoading:!0,stopTrackingLoading:!0}),(0,lib.loaders)(_ref=>{let{values}=_ref;return{browserSearchResults:[null,{loadBrowserSearchResults:async()=>{if(!values.browserSearchTerm)return[];let query={kind:schema_general.OH.HogQLQuery,query:(0,queries_utils.zP)`SELECT distinct properties.$current_url AS urls
                                     FROM events
                                     WHERE timestamp >= now() - INTERVAL 7 DAY
                                       AND timestamp <= now()
                                       AND properties.$current_url like '%${queries_utils.zP.identifier(values.browserSearchTerm)}%'
                                     ORDER BY timestamp DESC
                                         limit 100`},res=await api.ZP.query(query);return res.results?.map(x=>x[0])}}],topUrls:[null,{loadTopUrls:async()=>{let query={kind:schema_general.OH.HogQLQuery,query:(0,queries_utils.zP)`SELECT properties.$current_url AS url, count() as count
                                     FROM events
                                     WHERE timestamp >= now() - INTERVAL 7 DAY
                                       AND event in ('$pageview'
                                         , '$autocapture')
                                       AND timestamp <= now()
                                     GROUP BY properties.$current_url
                                     ORDER BY count DESC
                                         LIMIT 10`},res=await api.ZP.query(query);return res.results?.map(x=>({url:x[0],count:x[1]}))}}]}}),(0,index_esm.reducers)({filterPanelCollapsed:[!1,{persist:!0},{toggleFilterPanelCollapsed:state=>!state}],commonFilters:[{date_from:"-7d"},{setCommonFilters:(_,_ref2)=>{let{filters}=_ref2;return filters}}],heatmapColorPalette:["default",{setHeatmapColorPalette:(_,_ref3)=>{let{Palette}=_ref3;return Palette}}],heatmapFilters:[utils._f,{patchHeatmapFilters:(state,_ref4)=>{let{filters}=_ref4;return{...state,...filters}}}],heatmapFixedPositionMode:["fixed",{setHeatmapFixedPositionMode:(_,_ref5)=>{let{mode}=_ref5;return mode}}],iframeWidth:[null,{setIframeWidth:(_,_ref6)=>{let{width}=_ref6;return width}}],browserSearchTerm:["",{setBrowserSearch:(_,_ref7)=>{let{searchTerm}=_ref7;return searchTerm}}],browserUrl:[null,{persist:!0,prefix:`${teamId}__`},{setBrowserUrl:(_,_ref8)=>{let{url}=_ref8;return url}}],loading:[!1,{setBrowserUrl:(state,_ref9)=>{let{url}=_ref9;return!!url?.trim().length||state},setIframeBanner:(state,_ref10)=>{let{banner}=_ref10;return banner?.level!="error"&&state},startTrackingLoading:()=>!0,stopTrackingLoading:()=>!1}],iframeBanner:[null,{setIframeBanner:(_,_ref11)=>{let{banner}=_ref11;return banner}}]}),(0,index_esm.selectors)({browserUrlSearchOptions:[s=>[s.browserSearchResults,s.topUrls,s.browserSearchTerm],(browserSearchResults,topUrls,browserSearchTerm)=>{var _topUrls$map;return browserSearchTerm?browserSearchResults:null!==(_topUrls$map=topUrls?.map(x=>x.url))&&void 0!==_topUrls$map?_topUrls$map:[]}],isBrowserUrlAuthorized:[s=>[s.browserUrl,s.checkUrlIsAuthorized],(browserUrl,checkUrlIsAuthorized)=>!!browserUrl&&checkUrlIsAuthorized(browserUrl)],isBrowserUrlValid:[s=>[s.browserUrl],browserUrl=>{if(!browserUrl)return!0;try{return new URL(browserUrl),browserUrl.includes("://")}catch(e){return!1}}],viewportRange:[s=>[s.heatmapFilters,s.iframeWidth],(heatmapFilters,iframeWidth)=>iframeWidth?(0,utils.f6)(heatmapFilters,iframeWidth):{min:0,max:1800}],noPageviews:[s=>[s.topUrlsLoading,s.topUrls],(topUrlsLoading,topUrls)=>!topUrlsLoading&&(!topUrls||0===topUrls.length)]}),(0,index_esm.listeners)(_ref12=>{let{actions,cache,props,values}=_ref12;return{setBrowserSearch:async(_,breakpoint)=>{await breakpoint(200),actions.loadBrowserSearchResults()},sendToolbarMessage:_ref13=>{let{type,payload}=_ref13;props.iframeRef?.current?.contentWindow?.postMessage({type,payload},"*")},patchHeatmapFilters:_ref14=>{let{filters}=_ref14;actions.sendToolbarMessage(utils.TH.PH_PATCH_HEATMAP_FILTERS,{filters})},setHeatmapFixedPositionMode:_ref15=>{let{mode}=_ref15;actions.sendToolbarMessage(utils.TH.PH_HEATMAPS_FIXED_POSITION_MODE,{fixedPositionMode:mode})},setHeatmapColorPalette:_ref16=>{let{Palette}=_ref16;actions.sendToolbarMessage(utils.TH.PH_HEATMAPS_COLOR_PALETTE,{colorPalette:Palette})},setCommonFilters:_ref17=>{let{filters}=_ref17;actions.sendToolbarMessage(utils.TH.PH_HEATMAPS_COMMON_FILTERS,{commonFilters:filters})},onIframeLoad:()=>{let init=()=>{actions.sendToolbarMessage(utils.TH.PH_APP_INIT,{filters:values.heatmapFilters,colorPalette:values.heatmapColorPalette,fixedPositionMode:values.heatmapFixedPositionMode,commonFilters:values.commonFilters}),actions.sendToolbarMessage(utils.TH.PH_HEATMAPS_CONFIG,{enabled:!0})};window.addEventListener("message",e=>{let type=e?.data?.type;if(type&&type.startsWith("ph-")){if(!values.checkUrlIsAuthorized(e.origin)){console.warn("ignoring message from iframe with origin not in authorized toolbar urls",e.origin,e.data);return}switch(type){case utils.TH.PH_TOOLBAR_INIT:return init();case utils.TH.PH_TOOLBAR_READY:return dist_module.ZP.capture("in-app heatmap frame loaded",{inapp_heatmap_page_url_visited:values.browserUrl,inapp_heatmap_filters:values.heatmapFilters,inapp_heatmap_color_palette:values.heatmapColorPalette,inapp_heatmap_fixed_position_mode:values.heatmapFixedPositionMode}),actions.startTrackingLoading();case utils.TH.PH_TOOLBAR_HEATMAP_LOADING:return actions.startTrackingLoading();case utils.TH.PH_TOOLBAR_HEATMAP_LOADED:return dist_module.ZP.capture("in-app heatmap loaded",{inapp_heatmap_page_url_visited:values.browserUrl,inapp_heatmap_filters:values.heatmapFilters,inapp_heatmap_color_palette:values.heatmapColorPalette,inapp_heatmap_fixed_position_mode:values.heatmapFixedPositionMode}),actions.stopTrackingLoading();case utils.TH.PH_TOOLBAR_HEATMAP_FAILED:dist_module.ZP.capture("in-app heatmap failed",{inapp_heatmap_page_url_visited:values.browserUrl,inapp_heatmap_filters:values.heatmapFilters,inapp_heatmap_color_palette:values.heatmapColorPalette,inapp_heatmap_fixed_position_mode:values.heatmapFixedPositionMode}),actions.stopTrackingLoading(),actions.setIframeBanner({level:"error",message:"The heatmap failed to load."});return;default:console.warn(`[PostHog Heatmaps] Received unknown child window message: ${type}`)}}},!1),init()},maybeLoadTopUrls:()=>{values.topUrls||values.topUrlsLoading||actions.loadTopUrls()},setBrowserUrl:_ref18=>{let{url}=_ref18;actions.maybeLoadTopUrls(),url?.trim().length&&actions.startTrackingLoading()},startTrackingLoading:()=>{actions.setIframeBanner(null),clearTimeout(cache.errorTimeout),cache.errorTimeout=setTimeout(()=>{actions.setIframeBanner({level:"error",message:"The heatmap failed to load (or is very slow)."})},7500),clearTimeout(cache.warnTimeout),cache.warnTimeout=setTimeout(()=>{actions.setIframeBanner({level:"warning",message:"Still waiting for the toolbar to load."})},3e3)},stopTrackingLoading:()=>{actions.setIframeBanner(null),clearTimeout(cache.errorTimeout),clearTimeout(cache.warnTimeout)}}}),(0,index_esm.afterMount)(_ref19=>{let{actions,values}=_ref19;values.browserUrl?.trim().length?actions.startTrackingLoading():actions.maybeLoadTopUrls()}),(0,kea_router_lib.urlToAction)(_ref20=>{let{actions,values}=_ref20;return{"/heatmaps":(_,searchParams)=>{searchParams.pageURL&&searchParams.pageURL!==values.browserUrl&&actions.setBrowserUrl(searchParams.pageURL),searchParams.heatmapFilters&&!(0,lib_utils.h0)(searchParams.heatmapFilters,values.heatmapFilters)&&actions.patchHeatmapFilters(searchParams.heatmapFilters),searchParams.heatmapPalette&&searchParams.heatmapPalette!==values.heatmapColorPalette&&actions.setHeatmapColorPalette(searchParams.heatmapPalette),searchParams.heatmapFixedPositionMode&&searchParams.heatmapFixedPositionMode!==values.heatmapFixedPositionMode&&actions.setHeatmapFixedPositionMode(searchParams.heatmapFixedPositionMode),searchParams.commonFilters&&!(0,lib_utils.h0)(searchParams.commonFilters,values.commonFilters)&&actions.setCommonFilters(searchParams.commonFilters)}}}),(0,kea_router_lib.actionToUrl)(_ref21=>{let{values}=_ref21;return{setBrowserUrl:_ref22=>{let{url}=_ref22,searchParams={...kea_router_lib.router.values.searchParams,pageURL:url};return url&&""!==url.trim()||delete searchParams.pageURL,[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]},patchHeatmapFilters:()=>{let searchParams={...kea_router_lib.router.values.searchParams,heatmapFilters:values.heatmapFilters};return[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]},setHeatmapColorPalette:_ref23=>{let{Palette}=_ref23,searchParams={...kea_router_lib.router.values.searchParams,heatmapPalette:Palette};return[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]},setHeatmapFixedPositionMode:_ref24=>{let{mode}=_ref24,searchParams={...kea_router_lib.router.values.searchParams,heatmapFixedPositionMode:mode};return[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]},setCommonFilters:_ref25=>{let{filters}=_ref25,searchParams={...kea_router_lib.router.values.searchParams,commonFilters:filters};return[kea_router_lib.router.values.location.pathname,searchParams,kea_router_lib.router.values.hashParams,{replace:!0}]}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function UrlSearchHeader(){var _browserUrlSearchOpti,_browserUrlSearchOpti2;let logic=heatmapsBrowserLogic(),{browserUrlSearchOptions,browserUrl,isBrowserUrlValid}=(0,index_esm.useValues)(logic),{setBrowserSearch,setBrowserUrl}=(0,index_esm.useActions)(logic),placeholderUrl=null!==(_browserUrlSearchOpti=browserUrlSearchOptions?.[0])&&void 0!==_browserUrlSearchOpti?_browserUrlSearchOpti:"https://your-website.com/pricing";return(0,jsx_runtime.jsxs)("div",{className:"bg-surface-primary p-2 border-b flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"flex-1",children:(0,jsx_runtime.jsx)(src.nt,{mode:"single",allowCustomValues:!0,placeholder:`e.g. ${placeholderUrl}`,onInputChange:e=>setBrowserSearch(e),value:browserUrl?[browserUrl]:void 0,onChange:v=>{var _v$;return setBrowserUrl(null!==(_v$=v[0])&&void 0!==_v$?_v$:null)},options:null!==(_browserUrlSearchOpti2=browserUrlSearchOptions?.map(x=>({label:x,key:x})))&&void 0!==_browserUrlSearchOpti2?_browserUrlSearchOpti2:[],className:isBrowserUrlValid?void 0:"border-red-500"})}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",sideIcon:(0,jsx_runtime.jsx)(icons.pF,{}),to:browserUrl?(0,authorizedUrlListLogic.Kc)(browserUrl,{userIntent:"heatmaps"}):void 0,targetBlank:!0,disabledReason:browserUrl?void 0:"Select a URL first",children:"Open in toolbar"})]})}function HeatmapsBrowserIntro(){let logic=heatmapsBrowserLogic(),{topUrls,topUrlsLoading,noPageviews}=(0,index_esm.useValues)(logic),{setBrowserUrl}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center overflow-y-auto",children:(0,jsx_runtime.jsxs)("div",{className:"max-w-[50rem] py-6 px-3 h-full w-full",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center flex-wrap gap-6",children:[(0,jsx_runtime.jsx)("div",{className:"w-50",children:(0,jsx_runtime.jsx)(hedgehogs.DetectiveHog,{className:"w-full h-full"})}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("h2",{children:"Welcome to Heatmaps"}),(0,jsx_runtime.jsx)("p",{children:"Heatmaps are powered by the embedded JavaScript SDK and allow you to see a range of user interactions directly on your website via the Toolbar."}),(0,jsx_runtime.jsx)("p",{children:"You can also view heatmaps for any page on your website by entering the URL above. As long as the page has the PostHog Toolbar installed, and can be loaded in an iframe, you can view heatmaps for it."})]})]}),(0,jsx_runtime.jsx)("div",{className:"gap-y-px p-2 border bg-surface-primary rounded",children:topUrlsLoading?(0,jsx_runtime.jsx)(src.yW,{className:"h-10",repeat:10}):noPageviews?(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:"No pageview events have been received yet. Once you have some data, you'll see the most viewed pages here."}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:topUrls?.map(_ref=>{let{url}=_ref;return jsx_runtime.jsx(src.Jp,{fullWidth:!0,onClick:()=>setBrowserUrl(url),children:url},url)})})})]})})}function ForbiddenURL(){let logic=heatmapsBrowserLogic(),{browserUrl}=(0,index_esm.useValues)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex-1 p-4 gap-y-4",children:[(0,jsx_runtime.jsxs)(src.Vp,{type:"error",children:[browserUrl," is not an authorized URL. Please add it to the list of authorized URLs to view heatmaps on this page."]}),(0,jsx_runtime.jsx)("h2",{children:"Authorized Toolbar URLs"}),(0,jsx_runtime.jsx)(AuthorizedUrlList.t,{type:authorizedUrlListLogic.uw.TOOLBAR_URLS})]})}function InvalidURL(){return(0,jsx_runtime.jsx)("div",{className:"flex-1 p-4 gap-y-4",children:(0,jsx_runtime.jsx)(src.Vp,{type:"error",children:"Not a valid URL. Can't load a heatmap for that \uD83D\uDE30"})})}function FilterPanel(){let logic=heatmapsBrowserLogic(),{heatmapFilters,heatmapColorPalette,heatmapFixedPositionMode,viewportRange,commonFilters,filterPanelCollapsed}=(0,index_esm.useValues)(logic),{patchHeatmapFilters,setHeatmapColorPalette,setHeatmapFixedPositionMode,setCommonFilters,toggleFilterPanelCollapsed}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("flex flex-col gap-y-2 px-2 py-1 border-r",!filterPanelCollapsed&&"w-100"),children:filterPanelCollapsed?(0,jsx_runtime.jsx)(src.u,{title:"Expand heatmap settings",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(icons.VG,{}),onClick:()=>toggleFilterPanelCollapsed()})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center",children:[(0,jsx_runtime.jsx)(src.u,{title:"Collapse heatmap settings",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCollapse,{className:"rotate-90"}),onClick:()=>toggleFilterPanelCollapsed()})}),(0,jsx_runtime.jsx)("h2",{className:"flex-1 mb-0 px-2",children:"Heatmap settings"})]}),(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:commonFilters.date_from,dateTo:commonFilters.date_to,onChange:(fromDate,toDate)=>{setCommonFilters({date_from:fromDate,date_to:toDate})},dateOptions:utils.PJ}),(0,jsx_runtime.jsx)(HeatMapsSettings.s,{heatmapFilters:heatmapFilters,patchHeatmapFilters:patchHeatmapFilters,viewportRange:viewportRange,heatmapColorPalette:heatmapColorPalette,setHeatmapColorPalette:setHeatmapColorPalette,heatmapFixedPositionMode:heatmapFixedPositionMode,setHeatmapFixedPositionMode:setHeatmapFixedPositionMode})]})})}function IframeErrorOverlay(){let logic=heatmapsBrowserLogic(),{iframeBanner}=(0,index_esm.useValues)(logic);return iframeBanner?(0,jsx_runtime.jsx)("div",{className:"absolute flex flex-col w-full h-full bg-blend-overlay items-start py-4 px-8 pointer-events-none",children:(0,jsx_runtime.jsxs)(src.Vp,{className:"w-full",type:iframeBanner.level,children:[iframeBanner.message,'. Your site might not allow being embedded in an iframe. You can click "Open in toolbar" above to visit your site and view the heatmap there.']})}):null}function LoadingOverlay(){return(0,jsx_runtime.jsx)("div",{className:"absolute flex flex-col w-full h-full items-center justify-center pointer-events-none",children:(0,jsx_runtime.jsx)(src.$j,{className:"text-5xl",textColored:!0})})}function ViewportChooser(_ref2){let{setWidth,selectedWidth}=_ref2,[hoveredWidth,setHoveredWidth]=react.useState(null),viewports={320:"Mobile - S (320px)",375:"Mobile - M (375px)",425:"Mobile - L (425px)",768:"Tablet (768px)",1024:"Desktop (1024px)",1440:"Desktop - L (1440px)",1920:"Desktop - XL (1920px)"},handleWidthSelect=width=>{setWidth(selectedWidth===width?null:width)},label=null!==hoveredWidth?(0,jsx_runtime.jsx)("span",{children:viewports[hoveredWidth]}):null!==selectedWidth?(0,jsx_runtime.jsx)("span",{children:viewports[selectedWidth]}):(0,jsx_runtime.jsx)("span",{children:"Choose viewport"});return(0,jsx_runtime.jsx)("div",{className:"w-full flex flex-row items-center justify-center relative h-8 border-y rounded-0 bg-bg-light select-none overflow-hidden",children:Object.keys(viewports).map(width=>{let numWidth=parseInt(width);return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("absolute h-full border-l border-r cursor-pointer flex items-center justify-center px-2 text-xs transition-colors","hover:bg-primary hover:bg-opacity-20","left-1/2 -translate-x-1/2",selectedWidth===numWidth&&"bg-primary bg-opacity-20"),style:{width:numWidth},onClick:()=>handleWidthSelect(numWidth),onMouseEnter:()=>setHoveredWidth(numWidth),onMouseLeave:()=>setHoveredWidth(null),children:320===numWidth?(0,jsx_runtime.jsx)("span",{children:label}):null},width)}).reverse()})}function EmbeddedHeatmapBrowser(_ref3){let{iframeRef}=_ref3,logic=heatmapsBrowserLogic(),[widthOverride,setWidthOverride]=react.useState(null),{browserUrl,loading,iframeBanner}=(0,index_esm.useValues)(logic),{onIframeLoad,setIframeWidth}=(0,index_esm.useActions)(logic),{width:iframeWidth}=(0,useResizeObserver.y)({ref:iframeRef});return(0,react.useEffect)(()=>{null===widthOverride&&setIframeWidth(null!=iframeWidth?iframeWidth:null)},[iframeWidth,setIframeWidth,widthOverride]),browserUrl?(0,jsx_runtime.jsxs)("div",{className:"flex flex-row w-full",children:[(0,jsx_runtime.jsx)(FilterPanel,{}),(0,jsx_runtime.jsxs)("div",{className:"relative flex-1 w-full h-full",children:[loading?(0,jsx_runtime.jsx)(LoadingOverlay,{}):null,!loading&&iframeBanner?(0,jsx_runtime.jsx)(IframeErrorOverlay,{}):null,(0,jsx_runtime.jsx)(ViewportChooser,{setWidth:setWidthOverride,selectedWidth:widthOverride}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center h-full",children:(0,jsx_runtime.jsx)("iframe",{ref:iframeRef,className:"h-full bg-white",style:{width:null!=widthOverride?widthOverride:"100%"},src:(0,authorizedUrlListLogic.Kc)(browserUrl,{userIntent:"heatmaps"}),onLoad:onIframeLoad,sandbox:"allow-scripts allow-same-origin",allow:""})})]})]}):null}function Warnings(){let{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),heatmapsEnabled=currentTeam?.heatmaps_opt_in,{openSettingsPanel}=(0,index_esm.useActions)(sidePanelSettingsLogic.A);return heatmapsEnabled?null:(0,jsx_runtime.jsx)(src.Vp,{type:"warning",action:{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>openSettingsPanel({sectionId:"environment-autocapture",settingId:"heatmaps"}),children:"Configure"},dismissKey:"heatmaps-might-be-disabled-warning",children:"You aren't collecting heatmaps data. Enable heatmaps in your project."})}function HeatmapsBrowser(){let iframeRef=(0,react.useRef)(null),logic=heatmapsBrowserLogic({iframeRef}),{browserUrl,isBrowserUrlAuthorized,isBrowserUrlValid}=(0,index_esm.useValues)(logic);return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:heatmapsBrowserLogic,props:{ref:iframeRef},children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(Warnings,{}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col overflow-hidden w-full h-[90vh] rounded border",children:[(0,jsx_runtime.jsx)(UrlSearchHeader,{}),(0,jsx_runtime.jsx)("div",{className:"relative flex flex-1 bg-surface-primary overflow-hidden",children:browserUrl?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:isBrowserUrlAuthorized?isBrowserUrlValid?(0,jsx_runtime.jsx)(EmbeddedHeatmapBrowser,{iframeRef:iframeRef}):(0,jsx_runtime.jsx)(InvalidURL,{}):(0,jsx_runtime.jsx)(ForbiddenURL,{})}):(0,jsx_runtime.jsx)(HeatmapsBrowserIntro,{})})]})]})})}let scene={component:HeatmapsScene,logic:(0,index_esm.kea)([(0,index_esm.path)(["scenes","heatmaps","heatmapsSceneLogic"])])};function HeatmapsScene(){return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(HeatmapsBrowser,{})})}}}]);
//# sourceMappingURL=9787.e7ce2ba2.iframe.bundle.js.map