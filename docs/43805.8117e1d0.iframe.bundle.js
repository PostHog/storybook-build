"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[43805],{"../../frontend/src/lib/components/heatmaps/HeatMapsSettings.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>HeatmapsSettings});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_posthog_icons__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/components/heatmaps/heatmapDataLogic.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonLabel__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/index.ts"),lib_lemon_ui_LemonSegmentedButton__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSegmentedButton/index.ts"),lib_lemon_ui_LemonSelect__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSelect/index.ts"),lib_lemon_ui_LemonSlider__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSlider/index.ts"),_toolbar_elements_heatmapToolbarMenuLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/toolbar/elements/heatmapToolbarMenuLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ScrollDepthJSWarning=()=>{let{scrollDepthPosthogJsError}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_toolbar_elements_heatmapToolbarMenuLogic__WEBPACK_IMPORTED_MODULE_9__.W);return scrollDepthPosthogJsError?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("p",{className:"my-2 bg-danger-highlight border border-danger rounded p-2",children:"version"===scrollDepthPosthogJsError?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:"This feature requires a newer version of posthog-js"}):"disabled"===scrollDepthPosthogJsError?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:["Your posthog-js config has ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("i",{children:"disable_scroll_properties"})," set - these properties are required for scroll depth calculations to work."]}):null}):null},SectionSetting=_ref=>{let{children,title,info}=_ref,[showInfo,setShowInfo]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"deprecated-space-y-2 mb-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"flex items-center gap-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(lib_lemon_ui_LemonLabel__WEBPACK_IMPORTED_MODULE_5__.H,{className:"flex-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("span",{children:title}),info&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_4__.J,{icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_2__.IconInfo,{}),size:"xsmall",active:showInfo,onClick:()=>setShowInfo(!showInfo),noPadding:!0})]})}),showInfo?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"text-sm",children:info}):null,children]})},HeatmapsSettings=_ref2=>{var _heatmapFilters$type,_heatmapFilters$aggre,_heatmapFilters$viewp,_heatmapFilters$viewp2;let{heatmapFilters,patchHeatmapFilters,viewportRange,heatmapColorPalette,setHeatmapColorPalette,heatmapFixedPositionMode,setHeatmapFixedPositionMode}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(SectionSetting,{title:"Heatmap type",info:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:['Select the kind of heatmap you want to view. Clicks, rageclicks, and mouse moves options will show different "heat" based on the number of interactions at that area of the page. Scroll depth will show how far down the page users have reached.',(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("br",{}),"Scroll depth uses additional information from Pageview and Pageleave events to indicate how far down the page users have scrolled."]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"flex gap-2 justify-between items-center",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_LemonSelect__WEBPACK_IMPORTED_MODULE_7__.Yv,{onChange:e=>patchHeatmapFilters?.({type:e}),value:null!==(_heatmapFilters$type=heatmapFilters?.type)&&void 0!==_heatmapFilters$type?_heatmapFilters$type:void 0,options:[{value:"click",label:"Clicks"},{value:"rageclick",label:"Rageclicks"},{value:"deadclick",label:"Dead clicks"},{value:"mousemove",label:"Mouse moves"},{value:"scrolldepth",label:"Scroll depth"}],size:"small"}),heatmapFilters?.type==="scrolldepth"&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(ScrollDepthJSWarning,{})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(SectionSetting,{title:"Aggregation",info:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:"Heatmaps can be aggregated by total count or unique visitors. Total count will show the total number of interactions on the page, while unique visitors will only count each visitor once."}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"flex gap-2 justify-between items-center",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_LemonSegmentedButton__WEBPACK_IMPORTED_MODULE_6__.P,{onChange:e=>patchHeatmapFilters?.({aggregation:e}),value:null!==(_heatmapFilters$aggre=heatmapFilters?.aggregation)&&void 0!==_heatmapFilters$aggre?_heatmapFilters$aggre:"total_count",options:[{value:"total_count",label:"Total count"},{value:"unique_visitors",label:"Unique visitors"}],size:"small"})})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(SectionSetting,{title:"Viewport accuracy",info:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:["The viewport accuracy setting will determine how closely the loaded data will be to your current viewport.",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("br",{}),"For example if you set this to 100%, only visitors whose viewport width is identical to yours will be included in the heatmap.",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("br",{}),"At 90% you will see data from viewports that are 10% smaller or larger than yours."]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"flex gap-2 justify-between items-center",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_LemonSlider__WEBPACK_IMPORTED_MODULE_8__.j,{className:"flex-1",min:0,max:1,step:.01,value:null!==(_heatmapFilters$viewp=heatmapFilters?.viewportAccuracy)&&void 0!==_heatmapFilters$viewp?_heatmapFilters$viewp:0,onChange:value=>patchHeatmapFilters?.({viewportAccuracy:value})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("code",{className:"w-[12rem] text-right text-xs whitsepace-nowrap",children:`${Math.round((null!==(_heatmapFilters$viewp2=heatmapFilters?.viewportAccuracy)&&void 0!==_heatmapFilters$viewp2?_heatmapFilters$viewp2:1)*100)}% (${viewportRange?.min}px - ${viewportRange?.max}px)`})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(SectionSetting,{title:"Color palette",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_LemonSelect__WEBPACK_IMPORTED_MODULE_7__.Yv,{size:"small",options:lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_3__.R,value:heatmapColorPalette,onChange:setHeatmapColorPalette})}),heatmapFilters?.type!=="scrolldepth"&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(SectionSetting,{title:"Fixed positioning calculation",info:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:["PostHog JS will attempt to detect fixed elements such as headers or modals and will therefore show those heatmap areas, ignoring the scroll value.",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("br",{}),"You can choose to show these areas as fixed, include them with scrolled data or hide them altogether."]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_LemonSegmentedButton__WEBPACK_IMPORTED_MODULE_6__.P,{onChange:setHeatmapFixedPositionMode,value:heatmapFixedPositionMode,options:[{value:"fixed",label:"Show fixed"},{value:"relative",label:"Show scrolled"},{value:"hidden",label:"Hide"}],size:"small"})})]})}},"../../frontend/src/toolbar/elements/heatmapToolbarMenuLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{W:()=>heatmapToolbarMenuLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.7_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),kea_window_values__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/kea-window-values@3.0.1_kea@3.1.7_react@18.2.0_/node_modules/kea-window-values/lib/index.js"),query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../node_modules/.pnpm/query-selector-shadow-dom@1.0.0/node_modules/query-selector-shadow-dom/src/querySelectorDeep.js"),lib_actionUtils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/actionUtils.ts"),lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/components/heatmaps/heatmapDataLogic.ts"),lib_utils_semver__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../frontend/src/lib/utils/semver.ts"),_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/toolbar/stats/currentPageLogic.ts"),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/toolbar/toolbarConfigLogic.ts"),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/toolbar/toolbarPosthogJS.ts"),_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/toolbar/utils.ts"),_types__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/types.ts");let doesVersionSupportScrollDepth=(0,lib_utils_semver__WEBPACK_IMPORTED_MODULE_12__.Ff)("1.99"),emptyElementsStatsPages={next:void 0,previous:void 0,results:[]},heatmapToolbarMenuLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","elements","heatmapToolbarMenuLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_7__.z,["href","wildcardHref"],_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W,["posthog"],lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_6__.y,["commonFilters","heatmapColorPalette","heatmapFixedPositionMode","rawHeatmapLoading","viewportRange","heatmapFilters","heatmapElements","heatmapTooltipLabel","heatmapScrollY","dateRange"]],actions:[_toolbar_stats_currentPageLogic__WEBPACK_IMPORTED_MODULE_7__.z,["setHref","setWildcardHref"],lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_6__.y,["setHeatmapColorPalette","setCommonFilters","setHeatmapFixedPositionMode","setHref as setDataHref","setHrefMatchType","resetHeatmapData","patchHeatmapFilters","loadHeatmap","loadHeatmapSuccess","loadHeatmapFailure","setHeatmapScrollY"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({getElementStats:url=>({url}),enableHeatmap:!0,disableHeatmap:!0,toggleClickmapsEnabled:enabled=>({enabled}),setSamplingFactor:samplingFactor=>({samplingFactor}),loadMoreElementStats:!0,setMatchLinksByHref:matchLinksByHref=>({matchLinksByHref}),loadAllEnabled:!0,maybeLoadClickmap:!0,maybeLoadHeatmap:!0,updateElementMetrics:observedElements=>({observedElements})}),(0,kea_window_values__WEBPACK_IMPORTED_MODULE_4__.windowValues)(()=>({windowWidth:window1=>window1.innerWidth,windowHeight:window1=>window1.innerHeight})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({matchLinksByHref:[!1,{setMatchLinksByHref:(_,_ref)=>{let{matchLinksByHref}=_ref;return matchLinksByHref}}],canLoadMoreElementStats:[!0,{getElementStatsSuccess:(_,_ref2)=>{let{elementStats}=_ref2;return null!==elementStats.next},getElementStatsFailure:()=>!0}],heatmapEnabled:[!1,{enableHeatmap:()=>!0,disableHeatmap:()=>!1,getElementStatsFailure:()=>!1}],clickmapsEnabled:[!1,{toggleClickmapsEnabled:(_,_ref3)=>{let{enabled}=_ref3;return enabled}}],samplingFactor:[1,{persist:!0},{setSamplingFactor:(_,_ref4)=>{let{samplingFactor}=_ref4;return samplingFactor}}],elementMetrics:[new Map,{updateElementMetrics:(state,_ref5)=>{let{observedElements}=_ref5;if(0===observedElements.length)return state;let onUpdate=new Map(Array.from(state.entries()));for(let[element,visible]of observedElements)onUpdate.set(element,{visible});return onUpdate}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref6=>{let{values}=_ref6;return{elementStats:[null,{resetElementStats:()=>emptyElementsStatsPages,getElementStats:async(_ref7,breakpoint)=>{let{url}=_ref7;await breakpoint(150);let{href,wildcardHref}=values,defaultUrl="";if(!url){let params={properties:[wildcardHref===href?{key:"$current_url",value:href,operator:_types__WEBPACK_IMPORTED_MODULE_11__.WV.Exact,type:_types__WEBPACK_IMPORTED_MODULE_11__.FT.Event}:{key:"$current_url",value:`^${wildcardHref.split("*").map(escapeUnescapedRegex).join(".*")}$`,operator:_types__WEBPACK_IMPORTED_MODULE_11__.WV.Regex,type:_types__WEBPACK_IMPORTED_MODULE_11__.FT.Event}],date_from:values.commonFilters.date_from,date_to:values.commonFilters.date_to};defaultUrl=`/api/element/stats/${(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.encodeParams)({...params,paginate_response:!0,sampling_factor:values.samplingFactor},"?")}`}let response=await (0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.O)(url||defaultUrl,"GET",void 0,url?"use-as-provided":"full");if(breakpoint(),403===response.status)return _toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.actions.authenticate(),emptyElementsStatsPages;let paginatedResults=await response.json();if(!Array.isArray(paginatedResults.results))throw Error("Error loading HeatMap data!");return{results:[...url&&values.elementStats?.results||[],...paginatedResults.results||[]],next:paginatedResults.next,previous:paginatedResults.previous}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(_ref8=>{let{cache}=_ref8;return{elements:[s=>[s.elementStats,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.selectors.dataAttributes,s.href,s.matchLinksByHref],(elementStats,dataAttributes,href,matchLinksByHref)=>{cache.pageElements=cache.lastHref==href?cache.pageElements:(0,query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_13__.n8)("*",document),cache.selectorToElements=cache.lastHref==href?cache.selectorToElements:{},cache.lastHref=href;let elements=[];return elementStats?.results.forEach(event=>{let combinedSelector,lastSelector;for(let i=0;i<event.elements.length;i++){let element=event.elements[i],selector=lib_actionUtils__WEBPACK_IMPORTED_MODULE_5__.nr(matchLinksByHref?element:{...element,href:void 0},dataAttributes)||"*";combinedSelector=lastSelector?`${selector} > ${lastSelector}`:selector;try{let domElements=cache.selectorToElements?.[combinedSelector];if(void 0===domElements&&(domElements=Array.from(query_selector_shadow_dom__WEBPACK_IMPORTED_MODULE_13__.Jp(combinedSelector,document,cache.pageElements)),cache.selectorToElements[combinedSelector]=domElements),1===domElements.length){let e=event.elements[i];if(0!==i||!e.tag_name||e.attr_class||e.attr_id||e.href||e.text||1!==e.nth_child||1!==e.nth_of_type||e.attributes["attr__data-attr"])return elements.push({element:domElements[0],count:event.count,selector:selector,hash:event.hash,type:event.type}),null}if(0===domElements.length){if(i===event.elements.length-1)return null;if(i>0&&lastSelector){lastSelector=lastSelector?`* > ${lastSelector}`:"*";continue}}}catch{break}lastSelector=combinedSelector}}),elements}],countedElements:[s=>[s.elements,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_8__.W.selectors.dataAttributes,s.clickmapsEnabled,s.elementMetrics],(elements,dataAttributes,clickmapsEnabled,elementMetrics)=>{if(!clickmapsEnabled)return[];cache.intersectionObserver.disconnect(),cache.intersectionObserver.observe(document.body);let normalisedElements=new Map;for(let countedElement of elements||[]){let trimmedElement=(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.OS)(countedElement.element);if(!trimmedElement)continue;let metrics=elementMetrics.get(trimmedElement)||{visible:isElementVisible(trimmedElement),rect:trimmedElement.getBoundingClientRect()};if(normalisedElements.has(trimmedElement)){let existing=normalisedElements.get(trimmedElement);existing&&(existing.count+=countedElement.count,existing.clickCount+="$autocapture"===countedElement.type?countedElement.count:0,existing.rageclickCount+="$rageclick"===countedElement.type?countedElement.count:0,existing.deadclickCount+="$dead_click"===countedElement.type?countedElement.count:0,existing.visible=metrics.visible)}else normalisedElements.set(trimmedElement,{...countedElement,clickCount:"$autocapture"===countedElement.type?countedElement.count:0,rageclickCount:"$rageclick"===countedElement.type?countedElement.count:0,deadclickCount:"$dead_click"===countedElement.type?countedElement.count:0,element:trimmedElement,actionStep:(0,_toolbar_utils__WEBPACK_IMPORTED_MODULE_10__.bE)(trimmedElement,dataAttributes),visible:metrics.visible});cache.intersectionObserver.observe(trimmedElement)}let countedElements=Array.from(normalisedElements.values());return countedElements.sort((a,b)=>b.count-a.count),countedElements.map((e,i)=>({...e,position:i+1}))}],elementCount:[s=>[s.countedElements],countedElements=>countedElements.length],clickCount:[s=>[s.countedElements],countedElements=>countedElements?countedElements.map(e=>e.count).reduce((a,b)=>a+b,0):0],highestClickCount:[s=>[s.countedElements],countedElements=>countedElements?countedElements.map(e=>e.count).reduce((a,b)=>b>a?b:a,0):0],scrollDepthPosthogJsError:[s=>[s.posthog],posthog=>{var _ref9,_posthog$version;if(!posthog)return null;let posthogVersion=null!==(_ref9=null!==(_posthog$version=posthog?.version)&&void 0!==_posthog$version?_posthog$version:posthog?._calculate_event_properties("test",{},new Date)?.$lib_version)&&void 0!==_ref9?_ref9:"0.0.0";if(!posthog?.scrollManager?.scrollY)return"version";let isSupported=doesVersionSupportScrollDepth(posthogVersion),isDisabled=posthog?.config.disable_scroll_properties;return isSupported?isDisabled?"disabled":null:"version"}]}}),(0,kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__.Vt)(_ref10=>{let{actions}=_ref10;return{viewportRange:()=>{actions.maybeLoadHeatmap()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref11=>{let{actions,values}=_ref11;return{enableHeatmap:()=>{actions.setDataHref(values.href),actions.loadAllEnabled(),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_9__.T.capture("toolbar mode triggered",{mode:"heatmap",enabled:!0})},disableHeatmap:()=>{actions.resetElementStats(),actions.resetHeatmapData(),_toolbar_toolbarPosthogJS__WEBPACK_IMPORTED_MODULE_9__.T.capture("toolbar mode triggered",{mode:"heatmap",enabled:!1})},loadAllEnabled:async()=>{actions.maybeLoadHeatmap(),actions.maybeLoadClickmap()},maybeLoadClickmap:async()=>{values.clickmapsEnabled&&actions.getElementStats()},maybeLoadHeatmap:async()=>{values.heatmapEnabled&&values.heatmapFilters.enabled&&values.heatmapFilters.type&&actions.loadHeatmap()},setHref:_ref12=>{let{href}=_ref12;values.heatmapEnabled&&(actions.setHrefMatchType(href===window.location.href?"exact":"pattern"),actions.setDataHref(href)),actions.maybeLoadClickmap()},setWildcardHref:_ref13=>{let{href}=_ref13;values.heatmapEnabled&&(actions.setHrefMatchType(href===window.location.href?"exact":"pattern"),actions.setDataHref(href)),actions.maybeLoadClickmap()},setCommonFilters:()=>{actions.loadAllEnabled()},setSamplingFactor:()=>{actions.maybeLoadClickmap()},toggleClickmapsEnabled:()=>{values.clickmapsEnabled&&actions.getElementStats()},loadMoreElementStats:()=>{values.elementStats?.next&&actions.getElementStats(values.elementStats.next)},patchHeatmapFilters:_ref14=>{let{filters}=_ref14;filters.type&&actions.resetHeatmapData(),actions.maybeLoadHeatmap()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref15=>{let{actions,values,cache}=_ref15;cache.scrollCheckTimer=setInterval(()=>{var _values$posthog$scrol;let scrollY=null!==(_values$posthog$scrol=values.posthog?.scrollManager?.scrollY())&&void 0!==_values$posthog$scrol?_values$posthog$scrol:0;values.heatmapScrollY!==scrollY&&actions.setHeatmapScrollY(scrollY)},50),cache.intersectionObserver=new IntersectionObserver(entries=>{let observedElements=[];entries.forEach(entry=>{let element=entry.target;observedElements.push([element,entry.isIntersecting])}),actions.updateElementMetrics(observedElements)})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.beforeUnmount)(_ref16=>{let{cache}=_ref16;clearInterval(cache.scrollCheckTimer),cache.intersectionObserver?.disconnect()})]);function isElementVisible(element){let style=window.getComputedStyle(element);return"none"!==style.display&&"hidden"!==style.visibility&&"0"!==style.opacity}let escapeUnescapedRegex=str=>str.replace(/\\.|([.*+?^=!:${}()|[\]/\\])/g,(match,group1)=>group1?`\\${group1}`:match)},"../../frontend/src/toolbar/stats/currentPageLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{z:()=>currentPageLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js");let replaceWithWildcard=part=>part.match(/^([a-f]|[0-9]){8}-([a-f]|[0-9]){4}-([a-f]|[0-9]){4}-([a-f]|[0-9]){4}-([a-f]|[0-9]){12}$/)||part.match(/^[0-9]+$/)||part.length>24?"*":part;function withoutPostHogInit(href){try{let firstHash=href.indexOf("#");if(-1===firstHash)return href;return href.replace(/__posthog=\{[^}]*}[^#]*/,"").replace("##","#").replace(/#$/,"")}catch{return href}}let currentPageLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["toolbar","stats","currentPageLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)(()=>({setHref:href=>({href}),setWildcardHref:href=>({href}),autoWildcardHref:!0})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(()=>({href:[window.location.href,{setHref:(_,_ref)=>{let{href}=_ref;return withoutPostHogInit(href)}}],wildcardHref:[window.location.href,{setHref:(_,_ref2)=>{let{href}=_ref2;return withoutPostHogInit(href)},setWildcardHref:(_,_ref3)=>{let{href}=_ref3;return withoutPostHogInit(href)}}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions,values}=_ref4;return{autoWildcardHref:()=>{let url=values.wildcardHref,urlParts=url.split("?");if(url=urlParts[0].split("/").map(part=>replaceWithWildcard(part)).join("/"),urlParts.length>1){let queryParams=urlParts[1].split("&");for(let i=0;i<queryParams.length;i++){let[key,value]=queryParams[i].split("=");queryParams[i]=`${key}=${replaceWithWildcard(value)}`}url=`${url}\\?${queryParams.join("&")}`}actions.setWildcardHref(url)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref5=>{let{actions,values,cache}=_ref5;actions.setHref(withoutPostHogInit(values.href)),cache.interval=window.setInterval(()=>{window.location.href!==values.href&&actions.setHref(withoutPostHogInit(window.location.href))},500)}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.beforeUnmount)(_ref6=>{let{cache}=_ref6;window.clearInterval(cache.interval)})])}}]);