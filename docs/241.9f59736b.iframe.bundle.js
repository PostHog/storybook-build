(window.webpackJsonp=window.webpackJsonp||[]).push([[241],{"./frontend/src/scenes/actions/Action.tsx":function(k,j,a){"use strict";a.r(j),a.d(j,"scene",function(){return dt}),a.d(j,"Action",function(){return q});var W=a("./node_modules/core-js/modules/es.array.concat.js"),K=a("./node_modules/react/index.js"),e=a.n(K),ve=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),T=a.n(ve),p=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),te=a.n(p),Re=a("./node_modules/core-js/modules/es.array.map.js"),ze=a("./node_modules/core-js/modules/es.array.filter.js"),fe=a("./node_modules/core-js/modules/es.object.to-string.js"),ne=a("./node_modules/core-js/modules/es.object.keys.js"),Ge=a("./node_modules/core-js/modules/es.symbol.js"),He=a("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Fe=a("./node_modules/core-js/modules/web.dom-collections.for-each.js"),ge=a("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),U=a("./frontend/src/lib/utils.tsx"),he=a("./frontend/src/lib/components/Link.tsx"),h=a("./node_modules/kea/lib/index.esm.js"),P=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),$=a.n(P),Ee=a("./node_modules/@babel/runtime/regenerator/index.js"),C=a.n(Ee),ye=a("./node_modules/core-js/modules/es.function.name.js"),De=a("./node_modules/core-js/modules/es.array.iterator.js"),G=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),ae=a("./node_modules/core-js/modules/es.regexp.exec.js"),be=a("./node_modules/core-js/modules/es.string.split.js"),R=a("./frontend/src/lib/api.ts"),H=a("./frontend/src/models/actionsModel.ts"),x=a("./frontend/src/lib/components/lemonToast.tsx"),Oe=a("./node_modules/kea-loaders/lib/index.js"),Ae=a("./node_modules/kea-forms/lib/index.js");function J(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),o.push.apply(o,r)}return o}function z(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?J(Object(o),!0).forEach(function(r){T()(n,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):J(Object(o)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))})}return n}var Y=Object(h.kea)([Object(h.path)(["scenes","actions","actionEditLogic"]),Object(h.props)({}),Object(h.key)(function(n){return n.id||"new"}),Object(h.actions)({setAction:function(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:t,options:o}},setCreateNew:function(t){return{createNew:t}},actionAlreadyExists:function(t){return{actionId:t}}}),Object(h.reducers)({createNew:[!1,{setCreateNew:function(t,o){var r=o.createNew;return r}}]}),Object(Ae.forms)(function(n){var t=n.actions,o=n.props;return{action:{defaults:z({},o.action),errors:function(s){var i=s.name;return{name:i?null:"You need to set a name"}},submit:function(s){t.saveAction(s)}}}}),Object(Oe.loaders)(function(n){var t=n.props,o=n.values;return{actionCount:{loadActionCount:function(){var r=$()(C.a.mark(function i(){return C.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!t.id){u.next=6;break}return u.next=3,R.b.actions.getCount(t.id);case 3:u.t0=u.sent,u.next=7;break;case 6:u.t0=0;case 7:return u.abrupt("return",u.t0);case 8:case"end":return u.stop()}},i)}));function s(){return r.apply(this,arguments)}return s}()},action:[z({},t.action),{setAction:function(s){var i=s.action,d=s.options.merge;return d?z(z({},o.action),i):i},saveAction:function(){var r=$()(C.a.mark(function i(d,u){var l,g;return C.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(l=z({},d),l.steps=l.steps?l.steps.filter(function(_){return _.event}):[],m.prev=2,!l.id){m.next=9;break}return m.next=6,R.b.actions.update(l.id,l,t.temporaryToken);case 6:l=m.sent,m.next=12;break;case 9:return m.next=11,R.b.actions.create(l,t.temporaryToken);case 11:l=m.sent;case 12:u(),m.next=22;break;case 15:if(m.prev=15,m.t0=m.catch(2),m.t0.code!=="unique"){m.next=21;break}return g=m.t0.detail.split(" ").pop(),me(g),m.abrupt("return",l);case 21:throw m.t0;case 22:return x.d.success("Action saved"),t.onSave(l),H.a.actions.loadActions(),m.abrupt("return",l);case 26:case"end":return m.stop()}},i,null,[[2,15]])}));function s(i,d){return r.apply(this,arguments)}return s}()}]}}),Object(h.afterMount)(function(n){var t=n.actions,o=n.props;o.id?t.loadActionCount():t.setAction({name:"",steps:[{isNew:Object(U.Eb)()}]},{merge:!1})})]),Be=a("./frontend/src/scenes/actions/Actions.scss"),L=a("./frontend/src/scenes/actions/EventName.tsx"),je=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),oe=a.n(je),re=a("./frontend/src/scenes/teamLogic.tsx"),X=a("./node_modules/antd/es/button/index.js"),Se=a("./node_modules/antd/es/modal/index.js"),Ce=a("./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx"),Te=a("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts");function F(n){var t,o=n.actionId,r=n.style,s=n.children,i=Object(K.useState)(!1),d=oe()(i,2),u=d[0],l=d[1],g=Object(h.useValues)(re.a),O=g.currentTeam;return e.a.createElement(e.a.Fragment,null,e.a.createElement(X.a,{href:Object(Te.b)(O==null||(t=O.app_urls)===null||t===void 0?void 0:t[0],o),style:r,size:"small",onClick:function(_){_.preventDefault(),l(!0)}},s),e.a.createElement(Se.a,{visible:u,title:o?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:e.a.createElement(X.a,{onClick:function(){return l(!1)}},"Close"),onCancel:function(){return l(!1)}},e.a.createElement(Ce.a,{actionId:o,pageKey:"app-editor-link"})))}try{F.displayName="AppEditorLink",F.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:F.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(n){}var D=a("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),f=a("./frontend/src/lib/components/Tooltip.tsx"),I=a("./frontend/src/scenes/actions/hints.tsx"),B=a("./node_modules/antd/es/typography/index.js"),A=a("./node_modules/antd/es/col/index.js"),se=a("./node_modules/antd/es/card/index.js"),le=a("./node_modules/antd/es/input/index.js"),ie=a("./node_modules/antd/es/space/index.js"),S=a("./node_modules/antd/es/radio/index.js"),w=a("./node_modules/@ant-design/icons/es/icons/ExportOutlined.js"),Q=a("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js");function ce(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),o.push.apply(o,r)}return o}function b(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?ce(Object(o),!0).forEach(function(r){T()(n,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):ce(Object(o)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))})}return n}var Me=B.a.Text,Ve="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function de(n){var t=n.step,o=n.actionId,r=n.isOnlyStep,s=n.index,i=n.identifier,d=n.onDelete,u=n.onChange,l=function(O){u(O)};return e.a.createElement(A.a,{span:24,md:12},e.a.createElement(se.a,{className:"action-step",style:{overflow:"visible"}},s>0&&e.a.createElement("div",{className:"stateful-badge pos-center-end or"},"OR"),e.a.createElement("div",null,!r&&e.a.createElement("div",{className:"remove-wrapper"},e.a.createElement("button",{type:"button","aria-label":"delete",onClick:d},e.a.createElement("span",{"aria-hidden":"true"},"\xD7"))),e.a.createElement("div",{className:"mb"},e.a.createElement("b",null,"Match Group #",s+1)),e.a.createElement(Xe,{step:t,sendStep:l}),e.a.createElement("div",{style:{marginTop:t.event==="$pageview"?20:8,paddingBottom:0}},t.event==="$autocapture"&&e.a.createElement(Je,{step:t,sendStep:l,actionId:o}),t.event!=null&&t.event!=="$autocapture"&&t.event!=="$pageview"&&e.a.createElement("div",{style:{marginTop:"2rem"}},e.a.createElement("label",null,e.a.createElement("b",null,"Event name: ")),e.a.createElement(L.a,{value:t.event,onChange:function(O){return l(b(b({},t),{},{event:O||""}))}}),e.a.createElement("br",null),e.a.createElement("small",null,e.a.createElement("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer"},"See documentation")," ","on how to send custom events in lots of languages.")),t.event==="$pageview"&&e.a.createElement("div",null,e.a.createElement(Z,{step:t,sendStep:l,item:"url",extra_options:e.a.createElement(Ke,{step:t,sendStep:l}),label:"URL"}),t.url_matching&&t.url_matching in I.a&&e.a.createElement("small",{style:{display:"block",marginTop:-12}},I.a[t.url_matching])),t.event&&e.a.createElement("div",{className:"action-property-filters"},e.a.createElement("h3",{className:"l3"},"Filters"),(!t.properties||t.properties.length===0)&&e.a.createElement("div",{className:"text-muted"},"This match group has no additional filters."),e.a.createElement(D.a,{propertyFilters:t.properties,pageKey:i,eventNames:t.event?[t.event]:[],onChange:function(O){l(b(b({},t),{},{properties:O}))},showConditionBadge:!0}))))))}function Z(n){var t=function(r){return n.sendStep(b(b({},n.step),{},T()({},n.item,r.target.value||null)))};return e.a.createElement("div",{className:"mb"},e.a.createElement("label",{style:{fontWeight:"bold"}},n.label," ",n.extra_options),n.caption&&e.a.createElement("div",{className:"action-step-caption"},n.caption),n.item==="selector"?e.a.createElement(le.a.TextArea,{allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}):e.a.createElement(le.a,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}))}function Je(n){var t=n.step,o=n.actionId,r=n.sendStep,s=function(){return e.a.createElement("div",{className:"text-center"},e.a.createElement("span",{className:"stateful-badge and"},"AND"))};return e.a.createElement("div",null,e.a.createElement("span",null,e.a.createElement(F,{actionId:o,style:{margin:"1rem 0"}},"Select element on site ",e.a.createElement(w.a,null)),e.a.createElement("a",{href:"".concat(Ve,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8}},"See documentation.")," "),e.a.createElement(Z,{step:t,sendStep:r,item:"href",label:"Link target equals",caption:e.a.createElement(e.a.Fragment,null,"If your element is a link, the location that the link opens (",e.a.createElement("code",null,"href")," tag)")}),e.a.createElement(s,null),e.a.createElement(Z,{step:t,sendStep:r,item:"text",label:"Text equals",caption:"Text content inside your element"}),e.a.createElement(s,null),e.a.createElement(Z,{step:t,sendStep:r,item:"selector",label:e.a.createElement(e.a.Fragment,null,"HTML selector matches",e.a.createElement(f.a,{title:"Click here to learn more about supported selectors"},e.a.createElement("a",{href:"".concat(Ve,"#matching-selectors"),target:"_blank",rel:"noopener"},e.a.createElement(Q.a,{style:{marginLeft:4}})))),placeholder:'button[data-attr="my-id"]',caption:e.a.createElement(ie.b,{direction:"vertical"},e.a.createElement(Me,{style:{color:"var(--muted)"}},"CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",e.a.createElement(Me,{code:!0},'[data-attr="signup"]')))}),e.a.createElement("div",{style:{marginBottom:18}},e.a.createElement(s,null)),e.a.createElement(Z,{step:t,sendStep:r,item:"url",extra_options:e.a.createElement(Ke,{step:t,sendStep:r}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(t==null?void 0:t.url_matching)&&t.url_matching in I.a&&e.a.createElement("small",{style:{display:"block",marginTop:-12}},I.a[t.url_matching]))}function Xe(n){var t=n.step,o=n.sendStep,r=function(i){var d=i.target.value;d==="$autocapture"?o(b(b({},t),{},{event:"$autocapture"})):d==="event"?o(b(b({},t),{},{event:""})):d==="$pageview"&&o(b(b({},t),{},{event:"$pageview",url:t.url}))};return e.a.createElement("div",{className:"type-switcher"},e.a.createElement(S.a.Group,{buttonStyle:"solid",onChange:r,value:t.event==="$autocapture"||t.event==="$pageview"||t.event===void 0?t.event:"event"},e.a.createElement(S.a.Button,{value:"$autocapture"},"Autocapture"),e.a.createElement(S.a.Button,{value:"event"},"Event"),e.a.createElement(S.a.Button,{value:"$pageview"},"Page view")))}function Ke(n){var t=n.step,o=n.sendStep,r=function(i){o(b(b({},t),{},{url_matching:i.target.value}))};return e.a.createElement(S.a.Group,{buttonStyle:"solid",onChange:r,value:t.url_matching||"contains",size:"small"},e.a.createElement(S.a.Button,{value:"contains"},"contains"),e.a.createElement(S.a.Button,{value:"regex"},"matches regex"),e.a.createElement(S.a.Button,{value:"exact"},"matches exactly"))}try{de.displayName="ActionStep",de.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:de.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(n){}var Qe=a("./node_modules/antd/es/row/index.js"),Ze=a("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),qe=a("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),xe=a("./node_modules/kea-router/lib/index.js"),_e=a("./frontend/src/lib/components/PageHeader.tsx"),M=a("./frontend/src/scenes/urls.ts"),$e=a("./frontend/src/lib/components/EditableField/EditableField.tsx"),et=a("./frontend/src/types.ts"),tt=a("./frontend/src/scenes/userLogic.ts"),nt=a("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),at=a("./frontend/src/lib/forms/VerticalForm.tsx"),V=a("./frontend/src/lib/forms/Field.tsx"),Le=a("./frontend/src/lib/components/LemonButton/index.ts"),ot=a("./frontend/src/lib/components/LemonCheckbox/index.ts"),rt=a("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function Ye(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),o.push.apply(o,r)}return o}function st(n){for(var t=1;t<arguments.length;t++){var o=arguments[t]!=null?arguments[t]:{};t%2?Ye(Object(o),!0).forEach(function(r){T()(n,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Ye(Object(o)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(o,r))})}return n}function ue(n){var t=n.action,o=n.id,r=n.onSave,s=n.temporaryToken,i={id:o,action:t,onSave:function(c){return r(c)},temporaryToken:s},d=Y(i),u=Object(h.useValues)(d),l=u.action,g=u.actionLoading,O=u.actionCount,m=u.actionCountLoading,_=Object(h.useActions)(d),we=_.submitAction,ut=Object(h.useActions)(H.a),mt=ut.loadActions,pt=Object(h.useValues)(re.a),Ne=pt.currentTeam,vt=Object(h.useValues)(tt.a),ft=vt.hasAvailableFeature,Ue=Ne==null?void 0:Ne.slack_incoming_webhook,ke=function(){return e.a.createElement(Le.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",style:{marginRight:8},onClick:function(){Object(U.x)({endpoint:R.b.actions.determineDeleteEndpoint(),object:l,callback:function(){xe.router.actions.push(M.a.actions()),mt()}})}},"Delete")},We=function(){return e.a.createElement(Le.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",style:{marginRight:8},onClick:function(){xe.router.actions.push(M.a.actions())}},"Cancel")};return e.a.createElement("div",{className:"action-edit-container"},e.a.createElement(at.a,{logic:Y,props:i,formKey:"action",enableFormOnSubmit:!0},e.a.createElement(_e.a,{title:e.a.createElement(V.a,{name:"name"},function(v){var c=v.value,y=v.onChange;return e.a.createElement($e.a,{name:"name",value:c||"",placeholder:"Name this action",onChange:o?void 0:y,onSave:function(N){y(N),we()},mode:o?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(o?"edit":"create"),className:"action-name"})}),caption:e.a.createElement(e.a.Fragment,null,e.a.createElement(V.a,{name:"description",showOptional:!0},function(v){var c=v.value,y=v.onChange;return e.a.createElement($e.a,{multiline:!0,name:"description",value:c||"",placeholder:"Description (optional)",onChange:o?void 0:y,onSave:function(N){y(N),we()},mode:o?void 0:"edit",autoFocus:!!o,"data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!ft(et.d.INGESTION_TAXONOMY)})}),e.a.createElement(V.a,{name:"tags",showOptional:!0},function(v){var c=v.value,y=v.onChange;return e.a.createElement(nt.a,{tags:c!=null?c:[],onChange:function(N,Pe){return y(Pe)},className:"action-tags",saving:g})})),buttons:o?ke():We()}),o&&e.a.createElement("div",{className:"input-set"},e.a.createElement("div",null,e.a.createElement("span",{className:"text-muted mb-05"},m&&e.a.createElement(Ze.a,null),O!==null&&O>-1&&e.a.createElement(e.a.Fragment,null,"This action matches ",e.a.createElement("b",null,Object(U.q)(O))," events in the last 3 months")))),e.a.createElement("div",{style:{overflow:"visible"}},e.a.createElement("h2",{className:"subtitle"},"Match groups"),e.a.createElement("div",null,"Your action will be triggered whenever ",e.a.createElement("b",null,"any of your match groups")," are received."," ",e.a.createElement("a",{href:"https://posthog.com/docs/features/actions",target:"_blank"},e.a.createElement(Q.a,null))),e.a.createElement(V.a,{name:"steps"},function(v){var c=v.onChange;return e.a.createElement("div",{style:{textAlign:"right",marginBottom:12}},e.a.createElement(X.a,{onClick:function(){return c([].concat(te()(l.steps||[]),[{isNew:Object(U.Eb)()}]))},size:"small"},"Add another match group"))}),e.a.createElement(V.a,{name:"steps"},function(v){var c=v.value,y=v.onChange;return e.a.createElement(Qe.a,{gutter:[24,24]},e.a.createElement(e.a.Fragment,null,c==null?void 0:c.map(function(E,N){return e.a.createElement(de,{key:E.id||E.isNew,identifier:String(E.id||E.isNew),index:N,step:E,actionId:l.id||0,isOnlyStep:!!c&&c.length===1,onDelete:function(){var pe=E.id?"id":"isNew";y(c==null?void 0:c.filter(function(ee){return ee[pe]!==E[pe]}))},onChange:function(pe){y(c==null?void 0:c.map(function(ee){return E.id&&ee.id==E.id||E.isNew&&ee.isNew===E.isNew?st({id:E.id,isNew:E.isNew},pe):ee}))}})})),e.a.createElement(A.a,{span:24,md:12},e.a.createElement("div",{className:"match-group-add-skeleton",onClick:function(){y([].concat(te()(l.steps||[]),[{isNew:Object(U.Eb)()}]))}},e.a.createElement(qe.a,{style:{fontSize:28,color:"#666666"}}))))})),e.a.createElement("div",null,e.a.createElement("div",{style:{marginTop:"2rem"}},e.a.createElement("h2",{className:"subtitle"},"Match groups"),e.a.createElement(V.a,{name:"post_to_slack"},function(v){var c=v.value,y=v.onChange;return e.a.createElement(ot.a,{id:"webhook-checkbox",checked:!!c,onChange:function(N){return y(N.target.checked)},rowProps:{fullWidth:!0},disabled:!Ue,label:e.a.createElement(e.a.Fragment,null,"Post to webhook when this action is triggered.",e.a.createElement(he.a,{to:"/project/settings#webhook",style:{marginLeft:4}},Ue?"Configure":"Enable"," this integration in Setup."))})}),l.post_to_slack&&e.a.createElement(e.a.Fragment,null,e.a.createElement(V.a,{name:"slack_message_format"},function(v){var c=v.value,y=v.onChange;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",null,"Message format (optional)"),e.a.createElement(rt.a,{placeholder:"Default: [action.name] triggered by [person]",value:c,onChange:y,disabled:!Ue||!l.post_to_slack,"data-attr":"edit-slack-message-format"}),e.a.createElement("small",null,e.a.createElement("a",{href:"https://posthog.com/docs/integrations/message-formatting/",target:"_blank",rel:"noopener noreferrer"},"See documentation on how to format webhook messages.")))})))),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},o?ke():We(),e.a.createElement(Le.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:g},"Save"))))}function me(n){x.d.error(e.a.createElement(e.a.Fragment,null,"Action with this name already exists. ",e.a.createElement("a",{href:M.a.action(n)},"Click here to edit.")))}try{ue.displayName="ActionEdit",ue.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:ue.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(n){}try{me.displayName="duplicateActionErrorToast",me.__docgenInfo={description:"",displayName:"duplicateActionErrorToast",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#duplicateActionErrorToast"]={docgenInfo:me.__docgenInfo,name:"duplicateActionErrorToast",path:"frontend/src/scenes/actions/ActionEdit.tsx#duplicateActionErrorToast"})}catch(n){}var lt=a("./frontend/src/scenes/events/index.ts"),it=a("./frontend/src/lib/dayjs.ts"),ct=a("./frontend/src/lib/components/Spinner/Spinner.tsx"),Ie=Object(h.kea)({props:{},key:function(t){return t.id||"new"},path:function(t){return["scenes","actions","actionLogic",t]},actions:function(){return{checkIsFinished:function(o){return{action:o}},setPollTimeout:function(o){return{pollTimeout:o}},setIsComplete:function(o){return{isComplete:o}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(o,r){var s=r.pollTimeout;return s}}],isComplete:[!1,{setIsComplete:function(o,r){var s=r.isComplete;return s}}]}},selectors:{breadcrumbs:[function(n){return[n.action]},function(n){return[{name:"Data Management",path:M.a.actions()},{name:(n==null?void 0:n.name)||"Unnamed",path:n?M.a.action(n.id):void 0}]}]},loaders:function(t){var o=t.actions,r=t.props;return{action:{loadAction:function(){var s=$()(C.a.mark(function d(){var u;return C.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(o.setIsComplete(!1),r.id){g.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return g.next=5,R.b.actions.get(r.id);case 5:return u=g.sent,o.checkIsFinished(u),g.abrupt("return",u);case 8:case"end":return g.stop()}},d)}));function i(){return s.apply(this,arguments)}return i}()}}},listeners:function(t){var o=t.actions,r=t.values;return{checkIsFinished:function(i){var d=i.action;d.is_calculating?o.setPollTimeout(setTimeout(function(){return o.loadAction()},1e3)):(o.setIsComplete(new Date),r.pollTimeout&&clearTimeout(r.pollTimeout))}}},events:function(t){var o=t.values,r=t.actions,s=t.props;return{afterMount:function(){s.id&&r.loadAction()},beforeUnmount:function(){o.pollTimeout&&clearTimeout(o.pollTimeout)}}}}),dt={logic:Ie,component:q,paramsToProps:function(t){var o=t.params.id;return{id:parseInt(o)}}};function q(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.id,o={action_id:t},r=Object(h.useActions)(xe.router),s=r.push,i=Object(h.useValues)(Ie),d=i.action,u=i.isComplete,l=Object(h.useActions)(Ie),g=l.loadAction;return e.a.createElement(e.a.Fragment,null,(!t||d)&&e.a.createElement(ue,{id:t,action:d,onSave:function(m){t||s(M.a.action(m.id)),g()}}),t&&(u?e.a.createElement("div",null,e.a.createElement("h2",{className:"subtitle"},"Matching events"),e.a.createElement("p",null,"This is the list of ",e.a.createElement("strong",null,"recent")," events that match this action.",d!=null&&d.last_calculated_at?e.a.createElement(e.a.Fragment,null," ","Last calculated: ",e.a.createElement("b",null,Object(it.a)(d.last_calculated_at).fromNow()),"."):""),e.a.createElement(lt.a,{fixedFilters:o,sceneUrl:M.a.action(t),fetchMonths:3,pageKey:"action-".concat(t,"-").concat(JSON.stringify(o))})):e.a.createElement("div",null,e.a.createElement("h2",{className:"subtitle"},"Matching events"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(ct.a,{style:{marginRight:12}}),"Calculating action, please hold on."))))}try{q.displayName="Action",q.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:q.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(n){}},"./frontend/src/scenes/events/index.ts":function(k,j,a){"use strict";var W=a("./frontend/src/scenes/events/EventDetails.tsx"),K=a("./frontend/src/scenes/events/EventElements.tsx"),e=a("./frontend/src/scenes/events/EventsTable.tsx");a.d(j,"a",function(){return e.a});var ve=a("./frontend/src/scenes/events/eventsTableLogic.ts")},"./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx":function(k,j,a){"use strict";a.d(j,"a",function(){return G});var W=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),K=a.n(W),e=a("./node_modules/core-js/modules/es.regexp.exec.js"),ve=a("./node_modules/core-js/modules/es.string.match.js"),T=a("./node_modules/react/index.js"),p=a.n(T),te=a("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Re=a.n(te),ze=a("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss"),fe=a.n(ze),ne={};ne.insert="head",ne.singleton=!1;var Ge=Re()(fe.a,ne),He=fe.a.locals||{},Fe=a("./node_modules/clsx/dist/clsx.m.js"),ge=a("./node_modules/kea/lib/index.esm.js"),U=a("./frontend/src/lib/components/LemonTable/index.ts"),he=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),h=a("./node_modules/@ant-design/icons/es/icons/CheckCircleFilled.js"),P=a("./frontend/src/lib/components/LemonButton/index.ts"),$=a("./node_modules/antd/es/input/index.js"),Ee=a("./node_modules/antd/es/button/index.js"),C=a("./frontend/src/scenes/toolbar-launch/authorizedUrlsLogic.ts"),ye=a("./frontend/src/lib/utils.tsx"),De=a("./frontend/src/lib/components/LemonButton/More.tsx");function G(ae){var be=ae.pageKey,R=ae.actionId,H=Object(C.c)({actionId:R}),x=Object(ge.useValues)(H),Oe=x.appUrlsKeyed,Ae=x.suggestionsLoading,J=x.searchTerm,z=x.launchUrl,Y=x.appUrls,Be=x.editUrlIndex,L=Object(ge.useActions)(H),je=L.addUrl,oe=L.removeUrl,re=L.setSearchTerm,X=L.updateUrl,Se=L.newUrl,Ce=L.setEditUrlIndex,Te=[{title:"URLs",dataIndex:"url",key:"url",render:function(D,f){var I=Object(T.useState)(f.url),B=K()(I,2),A=B[0],se=B[1],le=Object(T.useState)(""),ie=K()(le,2),S=ie[0],w=ie[1];Object(T.useEffect)(function(){return se(f.url)},[f]);var Q=function(){if(w(""),A===C.a&&oe(f.originalIndex),A.indexOf("*")>-1&&!A.match(/^(.*)\*[^\*]*\.[^\*]+\.[^\*]+$/)){w("You can only wildcard subdomains. If you wildcard the domain or TLD, people might be able to gain access to your PostHog data.");return}if(!Object(ye.gb)(A)){w("Please type a valid URL or domain.");return}if(Y.indexOf(A)>-1&&Y.indexOf(A,f.originalIndex)!==f.originalIndex&&Y.indexOf(A,f.originalIndex+1)!==f.originalIndex){w("This URL is already registered.");return}X(f.originalIndex,A)};return f.type==="suggestion"||D!==C.a&&Be!==f.originalIndex?p.a.createElement("div",{className:Object(Fe.a)("authorized-url-col",f.type)},f.type==="authorized"&&p.a.createElement(h.a,{style:{marginRight:4}}),D,f.type==="suggestion"&&p.a.createElement(he.a,null,"Suggestion")):p.a.createElement("div",null,p.a.createElement("div",{style:{display:"flex"}},p.a.createElement($.a,{value:A,onChange:function(b){return se(b.target.value)},onPressEnter:Q,autoFocus:!0,placeholder:"Enter a URL or wildcard subdomain (e.g. https://*.posthog.com)"}),p.a.createElement(Ee.a,{type:"primary",onClick:Q},"Save")),S&&p.a.createElement("span",{className:"text-small text-danger"},S))}},{title:"",key:"actions",render:function(D,f,I){return p.a.createElement("div",{className:"actions-col"},f.type==="suggestion"?p.a.createElement(P.a,{type:"secondary",onClick:function(){return je(f.url)}},"Apply suggestion"):p.a.createElement(p.a.Fragment,null,p.a.createElement(P.a,{type:"highlighted",href:z(f.url),className:"mr"},"Open with Toolbar"),p.a.createElement(De.a,{overlay:p.a.createElement(p.a.Fragment,null,p.a.createElement(P.a,{fullWidth:!0,type:"stealth",onClick:function(){return Ce(f.originalIndex)}},"Edit authorized URL"),p.a.createElement(P.a,{fullWidth:!0,style:{color:"var(--danger)"},type:"stealth",onClick:function(){return oe(I)}},"Remove authorized URL"))})))}}];return p.a.createElement("div",null,p.a.createElement("div",{className:"flex-center mb"},p.a.createElement("div",{style:{flexGrow:1}},p.a.createElement($.a.Search,{allowClear:!0,enterButton:!0,placeholder:"Search for authorized URLs",style:{maxWidth:480},value:J,onChange:function(D){re(D.target.value)},autoFocus:be==="toolbar-launch"&&!Object(ye.Y)()})),p.a.createElement(P.a,{type:"primary",onClick:Se},"Add",be==="toolbar-launch"&&" authorized domain")),p.a.createElement(U.a,{className:"authorized-urls-table",columns:Te,dataSource:Oe,emptyState:J?"There are no authorized URLs that match your search.":"There are no authorized URLs or domains. Add one to get started.",loading:Ae}))}try{G.displayName="AuthorizedUrlsTable",G.__docgenInfo={description:"",displayName:"AuthorizedUrlsTable",props:{pageKey:{defaultValue:null,description:"",name:"pageKey",required:!1,type:{name:"string"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"]={docgenInfo:G.__docgenInfo,name:"AuthorizedUrlsTable",path:"frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.tsx#AuthorizedUrlsTable"})}catch(ae){}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/toolbar-launch/AuthorizedUrlsTable.scss":function(k,j,a){var W=a("./node_modules/css-loader/dist/runtime/api.js");j=W(!1),j.push([k.i,".authorized-urls-table .authorized-url-col{display:flex;align-items:center}.authorized-urls-table .authorized-url-col .lemon-tag{margin-left:6px}.authorized-urls-table .authorized-url-col.suggestion{color:var(--text-muted-alt)}.authorized-urls-table .authorized-url-col.authorized{color:var(--success)}.authorized-urls-table .actions-col{display:flex;align-items:center;justify-content:flex-end}",""]),k.exports=j}}]);
