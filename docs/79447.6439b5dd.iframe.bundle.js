"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[79447],{"../../node_modules/.pnpm/image-blob-reduce@4.1.0/node_modules/image-blob-reduce/dist/image-blob-reduce.esm.mjs":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{/*! image-blob-reduce 4.1.0 https://github.com/nodeca/image-blob-reduce @license MIT */function commonjsRequire(path){throw Error('Could not dynamically require "'+path+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>imageBlobReduce});var utils$1={};function pick(from,props){var to={};return props.forEach(function(key){Object.prototype.hasOwnProperty.call(from,key)&&(to[key]=from[key])}),to}function pick_pica_resize_options(from){return pick(from,["alpha","unsharpAmount","unsharpRadius","unsharpThreshold","cancelToken"])}utils$1.assign=function assign(to){for(var from,s=1;s<arguments.length;s++)for(var key in from=Object(arguments[s]))Object.prototype.hasOwnProperty.call(from,key)&&(to[key]=from[key]);return to},utils$1.pick=pick,utils$1.pick_pica_resize_options=pick_pica_resize_options;var pica$1={exports:{}};!/*!

pica
https://github.com/nodeca/pica

*/function(module,exports){var f;f=function(){return(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=commonjsRequire;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=commonjsRequire,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(_dereq_,module,exports){var Multimath=_dereq_("multimath"),mm_unsharp_mask=_dereq_("./mm_unsharp_mask"),mm_resize=_dereq_("./mm_resize");function MathLib(requested_features){var __requested_features=requested_features||[],features={js:__requested_features.indexOf("js")>=0,wasm:__requested_features.indexOf("wasm")>=0};Multimath.call(this,features),this.features={js:features.js,wasm:features.wasm&&this.has_wasm()},this.use(mm_unsharp_mask),this.use(mm_resize)}MathLib.prototype=Object.create(Multimath.prototype),MathLib.prototype.constructor=MathLib,MathLib.prototype.resizeAndUnsharp=function resizeAndUnsharp(options,cache){var result=this.resize(options,cache);return options.unsharpAmount&&this.unsharp_mask(result,options.toWidth,options.toHeight,options.unsharpAmount,options.unsharpRadius,options.unsharpThreshold),result},module.exports=MathLib},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(_dereq_,module,exports){function clampTo8(i){return i<0?0:i>255?255:i}function clampNegative(i){return i>=0?i:0}function convolveHor(src,dest,srcW,srcH,destW,filters){var r,g,b,a,filterPtr,filterShift,filterSize,srcPtr,srcY,destX,filterVal,srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){for(destX=0,filterPtr=0;destX<destW;destX++){for(filterShift=filters[filterPtr++],filterSize=filters[filterPtr++],srcPtr=srcOffset+4*filterShift|0,r=g=b=a=0;filterSize>0;filterSize--)a=a+(filterVal=filters[filterPtr++])*src[srcPtr+3]|0,b=b+filterVal*src[srcPtr+2]|0,g=g+filterVal*src[srcPtr+1]|0,r=r+filterVal*src[srcPtr]|0,srcPtr=srcPtr+4|0;dest[destOffset+3]=clampNegative(a>>7),dest[destOffset+2]=clampNegative(b>>7),dest[destOffset+1]=clampNegative(g>>7),dest[destOffset]=clampNegative(r>>7),destOffset=destOffset+4*srcH|0}destOffset=(srcY+1)*4|0,srcOffset=(srcY+1)*srcW*4|0}}function convolveVert(src,dest,srcW,srcH,destW,filters){var r,g,b,a,filterPtr,filterShift,filterSize,srcPtr,srcY,destX,filterVal,srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){for(destX=0,filterPtr=0;destX<destW;destX++){for(filterShift=filters[filterPtr++],filterSize=filters[filterPtr++],srcPtr=srcOffset+4*filterShift|0,r=g=b=a=0;filterSize>0;filterSize--)a=a+(filterVal=filters[filterPtr++])*src[srcPtr+3]|0,b=b+filterVal*src[srcPtr+2]|0,g=g+filterVal*src[srcPtr+1]|0,r=r+filterVal*src[srcPtr]|0,srcPtr=srcPtr+4|0;r>>=7,g>>=7,b>>=7,a>>=7,dest[destOffset+3]=clampTo8(a+8192>>14),dest[destOffset+2]=clampTo8(b+8192>>14),dest[destOffset+1]=clampTo8(g+8192>>14),dest[destOffset]=clampTo8(r+8192>>14),destOffset=destOffset+4*srcH|0}destOffset=(srcY+1)*4|0,srcOffset=(srcY+1)*srcW*4|0}}function convolveHorWithPre(src,dest,srcW,srcH,destW,filters){var r,g,b,a,alpha,filterPtr,filterShift,filterSize,srcPtr,srcY,destX,filterVal,srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){for(destX=0,filterPtr=0;destX<destW;destX++){for(filterShift=filters[filterPtr++],filterSize=filters[filterPtr++],srcPtr=srcOffset+4*filterShift|0,r=g=b=a=0;filterSize>0;filterSize--)a=a+(filterVal=filters[filterPtr++])*(alpha=src[srcPtr+3])|0,b=b+filterVal*src[srcPtr+2]*alpha|0,g=g+filterVal*src[srcPtr+1]*alpha|0,r=r+filterVal*src[srcPtr]*alpha|0,srcPtr=srcPtr+4|0;b=b/255|0,g=g/255|0,r=r/255|0,dest[destOffset+3]=clampNegative(a>>7),dest[destOffset+2]=clampNegative(b>>7),dest[destOffset+1]=clampNegative(g>>7),dest[destOffset]=clampNegative(r>>7),destOffset=destOffset+4*srcH|0}destOffset=(srcY+1)*4|0,srcOffset=(srcY+1)*srcW*4|0}}function convolveVertWithPre(src,dest,srcW,srcH,destW,filters){var r,g,b,a,filterPtr,filterShift,filterSize,srcPtr,srcY,destX,filterVal,srcOffset=0,destOffset=0;for(srcY=0;srcY<srcH;srcY++){for(destX=0,filterPtr=0;destX<destW;destX++){for(filterShift=filters[filterPtr++],filterSize=filters[filterPtr++],srcPtr=srcOffset+4*filterShift|0,r=g=b=a=0;filterSize>0;filterSize--)a=a+(filterVal=filters[filterPtr++])*src[srcPtr+3]|0,b=b+filterVal*src[srcPtr+2]|0,g=g+filterVal*src[srcPtr+1]|0,r=r+filterVal*src[srcPtr]|0,srcPtr=srcPtr+4|0;r>>=7,g>>=7,b>>=7,a>>=7,(a=clampTo8(a+8192>>14))>0&&(r=255*r/a|0,g=255*g/a|0,b=255*b/a|0),dest[destOffset+3]=a,dest[destOffset+2]=clampTo8(b+8192>>14),dest[destOffset+1]=clampTo8(g+8192>>14),dest[destOffset]=clampTo8(r+8192>>14),destOffset=destOffset+4*srcH|0}destOffset=(srcY+1)*4|0,srcOffset=(srcY+1)*srcW*4|0}}module.exports={convolveHor:convolveHor,convolveVert:convolveVert,convolveHorWithPre:convolveHorWithPre,convolveVertWithPre:convolveVertWithPre}},{}],3:[function(_dereq_,module,exports){module.exports="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"},{}],4:[function(_dereq_,module,exports){module.exports={name:"resize",fn:_dereq_("./resize"),wasm_fn:_dereq_("./resize_wasm"),wasm_src:_dereq_("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(_dereq_,module,exports){var createFilters=_dereq_("./resize_filter_gen"),_require=_dereq_("./convolve"),convolveHor=_require.convolveHor,convolveVert=_require.convolveVert,convolveHorWithPre=_require.convolveHorWithPre,convolveVertWithPre=_require.convolveVertWithPre;function hasAlpha(src,width,height){for(var ptr=3,len=width*height*4|0;ptr<len;){if(255!==src[ptr])return!0;ptr=ptr+4|0}return!1}function resetAlpha(dst,width,height){for(var ptr=3,len=width*height*4|0;ptr<len;)dst[ptr]=255,ptr=ptr+4|0}module.exports=function resize(options){var src=options.src,srcW=options.width,srcH=options.height,destW=options.toWidth,destH=options.toHeight,scaleX=options.scaleX||options.toWidth/options.width,scaleY=options.scaleY||options.toHeight/options.height,offsetX=options.offsetX||0,offsetY=options.offsetY||0,dest=options.dest||new Uint8Array(destW*destH*4),filter=void 0===options.filter?"mks2013":options.filter,filtersX=createFilters(filter,srcW,destW,scaleX,offsetX),filtersY=createFilters(filter,srcH,destH,scaleY,offsetY),tmp=new Uint16Array(destW*srcH*4);return hasAlpha(src,srcW,srcH)?(convolveHorWithPre(src,tmp,srcW,srcH,destW,filtersX),convolveVertWithPre(tmp,dest,srcH,destW,destH,filtersY)):(convolveHor(src,tmp,srcW,srcH,destW,filtersX),convolveVert(tmp,dest,srcH,destW,destH,filtersY),resetAlpha(dest,destW,destH)),dest}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(_dereq_,module,exports){var FILTER_INFO=_dereq_("./resize_filter_info");function toFixedPoint(num){return Math.round(16383*num)}module.exports=function resizeFilterGen(filter,srcSize,destSize,scale,offset){var destPixel,srcPixel,srcFirst,srcLast,filterElementSize,floatFilter,fxpFilter,total,pxl,idx,floatVal,filterTotal,filterVal,leftNotEmpty,rightNotEmpty,filterShift,filterSize,filterFunction=FILTER_INFO.filter[filter].fn,scaleInverted=1/scale,scaleClamped=Math.min(1,scale),srcWindow=FILTER_INFO.filter[filter].win/scaleClamped,packedFilter=new Int16Array((Math.floor((srcWindow+1)*2)+2)*destSize),packedFilterPtr=0,slowCopy=!packedFilter.subarray||!packedFilter.set;for(destPixel=0;destPixel<destSize;destPixel++){for(srcFirst=Math.max(0,Math.floor((srcPixel=(destPixel+.5)*scaleInverted+offset)-srcWindow)),floatFilter=new Float32Array(filterElementSize=(srcLast=Math.min(srcSize-1,Math.ceil(srcPixel+srcWindow)))-srcFirst+1),fxpFilter=new Int16Array(filterElementSize),total=0,pxl=srcFirst,idx=0;pxl<=srcLast;pxl++,idx++)total+=floatVal=filterFunction((pxl+.5-srcPixel)*scaleClamped),floatFilter[idx]=floatVal;for(idx=0,filterTotal=0;idx<floatFilter.length;idx++)filterTotal+=filterVal=floatFilter[idx]/total,fxpFilter[idx]=toFixedPoint(filterVal);for(fxpFilter[destSize>>1]+=toFixedPoint(1-filterTotal),leftNotEmpty=0;leftNotEmpty<fxpFilter.length&&0===fxpFilter[leftNotEmpty];)leftNotEmpty++;if(leftNotEmpty<fxpFilter.length){for(rightNotEmpty=fxpFilter.length-1;rightNotEmpty>0&&0===fxpFilter[rightNotEmpty];)rightNotEmpty--;if(filterShift=srcFirst+leftNotEmpty,filterSize=rightNotEmpty-leftNotEmpty+1,packedFilter[packedFilterPtr++]=filterShift,packedFilter[packedFilterPtr++]=filterSize,slowCopy)for(idx=leftNotEmpty;idx<=rightNotEmpty;idx++)packedFilter[packedFilterPtr++]=fxpFilter[idx];else packedFilter.set(fxpFilter.subarray(leftNotEmpty,rightNotEmpty+1),packedFilterPtr),packedFilterPtr+=filterSize}else packedFilter[packedFilterPtr++]=0,packedFilter[packedFilterPtr++]=0}return packedFilter}},{"./resize_filter_info":7}],7:[function(_dereq_,module,exports){module.exports={filter:{box:{win:.5,fn:function fn(x){return x<0&&(x=-x),+(x<.5)}},hamming:{win:1,fn:function fn(x){if(x<0&&(x=-x),x>=1)return 0;if(x<11920929e-14)return 1;var xpi=x*Math.PI;return Math.sin(xpi)/xpi*(.54+.46*Math.cos(xpi/1))}},lanczos2:{win:2,fn:function fn(x){if(x<0&&(x=-x),x>=2)return 0;if(x<11920929e-14)return 1;var xpi=x*Math.PI;return Math.sin(xpi)/xpi*Math.sin(xpi/2)/(xpi/2)}},lanczos3:{win:3,fn:function fn(x){if(x<0&&(x=-x),x>=3)return 0;if(x<11920929e-14)return 1;var xpi=x*Math.PI;return Math.sin(xpi)/xpi*Math.sin(xpi/3)/(xpi/3)}},mks2013:{win:2.5,fn:function fn(x){return(x<0&&(x=-x),x>=2.5)?0:x>=1.5?-.125*(x-2.5)*(x-2.5):x>=.5?.25*(4*x*x-11*x+7):1.0625-1.75*x*x}}},f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(_dereq_,module,exports){var createFilters=_dereq_("./resize_filter_gen");function hasAlpha(src,width,height){for(var ptr=3,len=width*height*4|0;ptr<len;){if(255!==src[ptr])return!0;ptr=ptr+4|0}return!1}function resetAlpha(dst,width,height){for(var ptr=3,len=width*height*4|0;ptr<len;)dst[ptr]=255,ptr=ptr+4|0}function asUint8Array(src){return new Uint8Array(src.buffer,0,src.byteLength)}var IS_LE=!0;try{IS_LE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(__){}function copyInt16asLE(src,target,target_offset){if(IS_LE){target.set(asUint8Array(src),target_offset);return}for(var ptr=target_offset,i=0;i<src.length;i++){var data=src[i];target[ptr++]=255&data,target[ptr++]=data>>8&255}}module.exports=function resize_wasm(options){var src=options.src,srcW=options.width,srcH=options.height,destW=options.toWidth,destH=options.toHeight,scaleX=options.scaleX||options.toWidth/options.width,scaleY=options.scaleY||options.toHeight/options.height,offsetX=options.offsetX||0,offsetY=options.offsetY||0,dest=options.dest||new Uint8Array(destW*destH*4),filter=void 0===options.filter?"mks2013":options.filter,filtersX=createFilters(filter,srcW,destW,scaleX,offsetX),filtersY=createFilters(filter,srcH,destH,scaleY,offsetY),src_size=Math.max(src.byteLength,dest.byteLength),tmp_offset=this.__align(0+src_size),tmp_size=srcH*destW*8,filtersX_offset=this.__align(tmp_offset+tmp_size),filtersY_offset=this.__align(filtersX_offset+filtersX.byteLength),alloc_bytes=filtersY_offset+filtersY.byteLength,instance=this.__instance("resize",alloc_bytes),mem=new Uint8Array(this.__memory.buffer),mem32=new Uint32Array(this.__memory.buffer),src32=new Uint32Array(src.buffer);mem32.set(src32),copyInt16asLE(filtersX,mem,filtersX_offset),copyInt16asLE(filtersY,mem,filtersY_offset);var fn=instance.exports.convolveHV||instance.exports._convolveHV;return hasAlpha(src,srcW,srcH)?fn(filtersX_offset,filtersY_offset,tmp_offset,srcW,srcH,destW,destH,1):(fn(filtersX_offset,filtersY_offset,tmp_offset,srcW,srcH,destW,destH,0),resetAlpha(dest,destW,destH)),new Uint32Array(dest.buffer).set(new Uint32Array(this.__memory.buffer,0,destH*destW)),dest}},{"./resize_filter_gen":6}],9:[function(_dereq_,module,exports){module.exports={name:"unsharp_mask",fn:_dereq_("./unsharp_mask"),wasm_fn:_dereq_("./unsharp_mask_wasm"),wasm_src:_dereq_("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(_dereq_,module,exports){var glur_mono16=_dereq_("glur/mono16");function hsv_v16(img,width,height){for(var r,g,b,max,size=width*height,out=new Uint16Array(size),i=0;i<size;i++)r=img[4*i],g=img[4*i+1],b=img[4*i+2],max=r>=g&&r>=b?r:g>=b&&g>=r?g:b,out[i]=max<<8;return out}module.exports=function unsharp(img,width,height,amount,radius,threshold){if(0!==amount&&!(radius<.5)){radius>2&&(radius=2);var v1,v2,vmul,diff,iTimes4,brightness=hsv_v16(img,width,height),blured=new Uint16Array(brightness);glur_mono16(blured,width,height,radius);for(var amountFp=amount/100*4096+.5|0,thresholdFp=threshold<<8,size=width*height,i=0;i<size;i++)Math.abs(diff=(v1=brightness[i])-blured[i])>=thresholdFp&&(vmul=((v2=(v2=(v2=v1+(amountFp*diff+2048>>12))>65280?65280:v2)<0?0:v2)<<12)/(v1=0!==v1?v1:1)|0,img[iTimes4=4*i]=img[iTimes4]*vmul+2048>>12,img[iTimes4+1]=img[iTimes4+1]*vmul+2048>>12,img[iTimes4+2]=img[iTimes4+2]*vmul+2048>>12)}}},{"glur/mono16":18}],11:[function(_dereq_,module,exports){module.exports=function unsharp(img,width,height,amount,radius,threshold){if(0!==amount&&!(radius<.5)){radius>2&&(radius=2);var pixels=width*height,img_bytes_cnt=4*pixels,hsv_bytes_cnt=2*pixels,blur_bytes_cnt=2*pixels,blur_line_byte_cnt=4*Math.max(width,height),blur_offset=img_bytes_cnt+hsv_bytes_cnt,blur_tmp_offset=blur_offset+blur_bytes_cnt,blur_line_offset=blur_tmp_offset+blur_bytes_cnt,instance=this.__instance("unsharp_mask",img_bytes_cnt+hsv_bytes_cnt+2*blur_bytes_cnt+blur_line_byte_cnt+32,{exp:Math.exp}),img32=new Uint32Array(img.buffer);new Uint32Array(this.__memory.buffer).set(img32);var fn=instance.exports.hsv_v16||instance.exports._hsv_v16;fn(0,img_bytes_cnt,width,height),(fn=instance.exports.blurMono16||instance.exports._blurMono16)(img_bytes_cnt,blur_offset,blur_tmp_offset,blur_line_offset,blur_line_offset+blur_line_byte_cnt,width,height,radius),(fn=instance.exports.unsharp||instance.exports._unsharp)(0,0,img_bytes_cnt,blur_offset,width,height,amount,threshold),img32.set(new Uint32Array(this.__memory.buffer,0,pixels))}}},{}],12:[function(_dereq_,module,exports){module.exports="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"},{}],13:[function(_dereq_,module,exports){function Pool(create,idle){this.create=create,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=idle||2e3}Pool.prototype.acquire=function(){var resource,_this=this;return 0!==this.available.length?resource=this.available.pop():((resource=this.create()).id=this.lastId++,resource.release=function(){return _this.release(resource)}),this.acquired[resource.id]=resource,resource},Pool.prototype.release=function(resource){var _this2=this;delete this.acquired[resource.id],resource.lastUsed=Date.now(),this.available.push(resource),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return _this2.gc()},100))},Pool.prototype.gc=function(){var _this3=this,now=Date.now();this.available=this.available.filter(function(resource){return!(now-resource.lastUsed>_this3.idle)||(resource.destroy(),!1)}),0!==this.available.length?this.timeoutId=setTimeout(function(){return _this3.gc()},100):this.timeoutId=0},module.exports=Pool},{}],14:[function(_dereq_,module,exports){module.exports=function createStages(fromWidth,fromHeight,toWidth,toHeight,srcTileSize,destTileBorder){var scaleX=toWidth/fromWidth,scaleY=toHeight/fromHeight,minScale=(2*destTileBorder+2+1)/srcTileSize;if(minScale>.5)return[[toWidth,toHeight]];var stageCount=Math.ceil(Math.log(Math.min(scaleX,scaleY))/Math.log(minScale));if(stageCount<=1)return[[toWidth,toHeight]];for(var result=[],i=0;i<stageCount;i++){var width=Math.round(Math.pow(Math.pow(fromWidth,stageCount-i-1)*Math.pow(toWidth,i+1),1/stageCount)),height=Math.round(Math.pow(Math.pow(fromHeight,stageCount-i-1)*Math.pow(toHeight,i+1),1/stageCount));result.push([width,height])}return result}},{}],15:[function(_dereq_,module,exports){function pixelFloor(x){var nearest=Math.round(x);return 1e-5>Math.abs(x-nearest)?nearest:Math.floor(x)}function pixelCeil(x){var nearest=Math.round(x);return 1e-5>Math.abs(x-nearest)?nearest:Math.ceil(x)}module.exports=function createRegions(options){var x,y,innerX,innerY,toTileWidth,toTileHeight,scaleX=options.toWidth/options.width,scaleY=options.toHeight/options.height,innerTileWidth=pixelFloor(options.srcTileSize*scaleX)-2*options.destTileBorder,innerTileHeight=pixelFloor(options.srcTileSize*scaleY)-2*options.destTileBorder;if(innerTileWidth<1||innerTileHeight<1)throw Error("Internal error in pica: target tile width/height is too small.");var tiles=[];for(innerY=0;innerY<options.toHeight;innerY+=innerTileHeight)for(innerX=0;innerX<options.toWidth;innerX+=innerTileWidth)(x=innerX-options.destTileBorder)<0&&(x=0),toTileWidth=innerX+innerTileWidth+options.destTileBorder-x,x+toTileWidth>=options.toWidth&&(toTileWidth=options.toWidth-x),(y=innerY-options.destTileBorder)<0&&(y=0),toTileHeight=innerY+innerTileHeight+options.destTileBorder-y,y+toTileHeight>=options.toHeight&&(toTileHeight=options.toHeight-y),tiles.push({toX:x,toY:y,toWidth:toTileWidth,toHeight:toTileHeight,toInnerX:innerX,toInnerY:innerY,toInnerWidth:innerTileWidth,toInnerHeight:innerTileHeight,offsetX:x/scaleX-pixelFloor(x/scaleX),offsetY:y/scaleY-pixelFloor(y/scaleY),scaleX:scaleX,scaleY:scaleY,x:pixelFloor(x/scaleX),y:pixelFloor(y/scaleY),width:pixelCeil(toTileWidth/scaleX),height:pixelCeil(toTileHeight/scaleY)});return tiles}},{}],16:[function(_dereq_,module,exports){function objClass(obj){return Object.prototype.toString.call(obj)}module.exports.isCanvas=function isCanvas(element){var cname=objClass(element);return"[object HTMLCanvasElement]"===cname||"[object OffscreenCanvas]"===cname||"[object Canvas]"===cname},module.exports.isImage=function isImage(element){return"[object HTMLImageElement]"===objClass(element)},module.exports.isImageBitmap=function isImageBitmap(element){return"[object ImageBitmap]"===objClass(element)},module.exports.limiter=function limiter(concurrency){var active=0,queue=[];function roll(){active<concurrency&&queue.length&&(active++,queue.shift()())}return function limit(fn){return new Promise(function(resolve,reject){queue.push(function(){fn().then(function(result){resolve(result),active--,roll()},function(err){reject(err),active--,roll()})}),roll()})}},module.exports.cib_quality_name=function cib_quality_name(num){switch(num){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},module.exports.cib_support=function cib_support(createCanvas){return Promise.resolve().then(function(){if("undefined"==typeof createImageBitmap)return!1;var c=createCanvas(100,100);return createImageBitmap(c,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(bitmap){var status=10===bitmap.width;return bitmap.close(),c=null,status})}).catch(function(){return!1})},module.exports.worker_offscreen_canvas_support=function worker_offscreen_canvas_support(){return new Promise(function(resolve,reject){if("undefined"==typeof OffscreenCanvas){resolve(!1);return}function workerPayload(self1){if("undefined"==typeof createImageBitmap){self1.postMessage(!1);return}Promise.resolve().then(function(){var canvas=new OffscreenCanvas(10,10);return canvas.getContext("2d").rect(0,0,1,1),createImageBitmap(canvas,0,0,1,1)}).then(function(){return self1.postMessage(!0)},function(){return self1.postMessage(!1)})}var code=btoa("(".concat(workerPayload.toString(),")(self);")),w=new Worker("data:text/javascript;base64,".concat(code));w.onmessage=function(ev){return resolve(ev.data)},w.onerror=reject}).then(function(result){return result},function(){return!1})},module.exports.can_use_canvas=function can_use_canvas(createCanvas){var usable=!1;try{var ctx=createCanvas(2,1).getContext("2d"),d=ctx.createImageData(2,1);d.data[0]=12,d.data[1]=23,d.data[2]=34,d.data[3]=255,d.data[4]=45,d.data[5]=56,d.data[6]=67,d.data[7]=255,ctx.putImageData(d,0,0),d=null,d=ctx.getImageData(0,0,2,1),12===d.data[0]&&23===d.data[1]&&34===d.data[2]&&255===d.data[3]&&45===d.data[4]&&56===d.data[5]&&67===d.data[6]&&255===d.data[7]&&(usable=!0)}catch(err){}return usable},module.exports.cib_can_use_region=function cib_can_use_region(){return new Promise(function(resolve){if("undefined"==typeof createImageBitmap){resolve(!1);return}var image=new Image;image.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",image.onload=function(){createImageBitmap(image,0,0,image.width,image.height).then(function(bitmap){bitmap.width===image.width&&bitmap.height===image.height?resolve(!0):resolve(!1)},function(){return resolve(!1)})},image.onerror=function(){return resolve(!1)}})}},{}],17:[function(_dereq_,module,exports){module.exports=function(){var mathLib,MathLib=_dereq_("./mathlib");onmessage=function onmessage1(ev){var tileOpts=ev.data.opts;if(!tileOpts.src&&tileOpts.srcBitmap){var canvas=new OffscreenCanvas(tileOpts.width,tileOpts.height),ctx=canvas.getContext("2d");ctx.drawImage(tileOpts.srcBitmap,0,0),tileOpts.src=ctx.getImageData(0,0,tileOpts.width,tileOpts.height).data,canvas.width=canvas.height=0,canvas=null,tileOpts.srcBitmap.close(),tileOpts.srcBitmap=null}mathLib||(mathLib=new MathLib(ev.data.features));var data=mathLib.resizeAndUnsharp(tileOpts);postMessage({data:data},[data.buffer])}}},{"./mathlib":1}],18:[function(_dereq_,module,exports){var a0,a1,a2,a3,b1,b2,left_corner,right_corner;function gaussCoef(sigma){sigma<.5&&(sigma=.5);var a=Math.exp(.527076)/sigma,g1=Math.exp(-a),g2=Math.exp(-2*a),k=(1-g1)*(1-g1)/(1+2*a*g1-g2);return a0=k,a1=k*(a-1)*g1,a2=k*(a+1)*g1,a3=-k*g2,left_corner=(a0+a1)/(1-(b1=2*g1)-(b2=-g2)),right_corner=(a2+a3)/(1-b1-b2),new Float32Array([a0,a1,a2,a3,b1,b2,left_corner,right_corner])}function convolveMono16(src,out,line,coeff,width,height){var prev_src,curr_src,curr_out,prev_out,prev_prev_out,src_index,out_index,line_index,i,j,coeff_a0,coeff_a1,coeff_b1,coeff_b2;for(i=0;i<height;i++){for(j=0,src_index=i*width,out_index=i,line_index=0,prev_out=prev_prev_out=(prev_src=src[src_index])*coeff[6],coeff_a0=coeff[0],coeff_a1=coeff[1],coeff_b1=coeff[4],coeff_b2=coeff[5];j<width;j++)curr_out=(curr_src=src[src_index])*coeff_a0+prev_src*coeff_a1+prev_out*coeff_b1+prev_prev_out*coeff_b2,prev_prev_out=prev_out,prev_out=curr_out,prev_src=curr_src,line[line_index]=prev_out,line_index++,src_index++;for(src_index--,line_index--,out_index+=height*(width-1),prev_out=prev_prev_out=(prev_src=src[src_index])*coeff[7],curr_src=prev_src,coeff_a0=coeff[2],coeff_a1=coeff[3],j=width-1;j>=0;j--)curr_out=curr_src*coeff_a0+prev_src*coeff_a1+prev_out*coeff_b1+prev_prev_out*coeff_b2,prev_prev_out=prev_out,prev_out=curr_out,prev_src=curr_src,curr_src=src[src_index],out[out_index]=line[line_index]+prev_out,src_index--,line_index--,out_index-=height}}function blurMono16(src,width,height,radius){if(radius){var out=new Uint16Array(src.length),tmp_line=new Float32Array(Math.max(width,height)),coeff=gaussCoef(radius);convolveMono16(src,out,tmp_line,coeff,width,height),convolveMono16(out,src,tmp_line,coeff,height,width)}}module.exports=blurMono16},{}],19:[function(_dereq_,module,exports){var assign=_dereq_("object-assign"),base64decode=_dereq_("./lib/base64decode"),hasWebAssembly=_dereq_("./lib/wa_detect"),DEFAULT_OPTIONS={js:!0,wasm:!0};function MultiMath(options){if(!(this instanceof MultiMath))return new MultiMath(options);var opts=assign({},DEFAULT_OPTIONS,options||{});if(this.options=opts,this.__cache={},this.__init_promise=null,this.__modules=opts.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw Error('mathlib: at least "js" or "wasm" should be enabled')}MultiMath.prototype.has_wasm=hasWebAssembly,MultiMath.prototype.use=function(module){return this.__modules[module.name]=module,this.options.wasm&&this.has_wasm()&&module.wasm_fn?this[module.name]=module.wasm_fn:this[module.name]=module.fn,this},MultiMath.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var self1=this;return this.__init_promise=Promise.all(Object.keys(self1.__modules).map(function(name){var module=self1.__modules[name];return self1.options.wasm&&self1.has_wasm()&&module.wasm_fn&&!self1.__wasm[name]?WebAssembly.compile(self1.__base64decode(module.wasm_src)).then(function(m){self1.__wasm[name]=m}):null})).then(function(){return self1}),this.__init_promise},MultiMath.prototype.__base64decode=base64decode,MultiMath.prototype.__reallocate=function mem_grow_to(bytes){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(bytes/65536)}),this.__memory;var mem_size=this.__memory.buffer.byteLength;return mem_size<bytes&&this.__memory.grow(Math.ceil((bytes-mem_size)/65536)),this.__memory},MultiMath.prototype.__instance=function instance(name,memsize,env_extra){if(memsize&&this.__reallocate(memsize),!this.__wasm[name]){var module=this.__modules[name];this.__wasm[name]=new WebAssembly.Module(this.__base64decode(module.wasm_src))}if(!this.__cache[name]){var env_base={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[name]=new WebAssembly.Instance(this.__wasm[name],{env:assign(env_base,env_extra||{})})}return this.__cache[name]},MultiMath.prototype.__align=function align(number,base){var reminder=number%(base=base||8);return number+(reminder?base-reminder:0)},module.exports=MultiMath},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(_dereq_,module,exports){module.exports=function base64decode(str){for(var input=str.replace(/[\r\n=]/g,""),max=input.length,out=new Uint8Array(3*max>>2),bits=0,ptr=0,idx=0;idx<max;idx++)idx%4==0&&idx&&(out[ptr++]=bits>>16&255,out[ptr++]=bits>>8&255,out[ptr++]=255&bits),bits=bits<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(input.charAt(idx));var tailbits=max%4*6;return 0===tailbits?(out[ptr++]=bits>>16&255,out[ptr++]=bits>>8&255,out[ptr++]=255&bits):18===tailbits?(out[ptr++]=bits>>10&255,out[ptr++]=bits>>2&255):12===tailbits&&(out[ptr++]=bits>>4&255),out}},{}],21:[function(_dereq_,module,exports){var wa;module.exports=function hasWebAssembly(){if(void 0!==wa||(wa=!1,"undefined"==typeof WebAssembly))return wa;try{var bin=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),module=new WebAssembly.Module(bin),instance=new WebAssembly.Instance(module,{});0!==instance.exports.test(4)&&(wa=!0)}catch(__){}return wa}},{}],22:[function(_dereq_,module,exports){var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null==val)throw TypeError("Object.assign cannot be called with null or undefined");return Object(val)}function shouldUseNative(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;for(var test2={},i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if("0123456789"!==order2.join(""))return!1;var test3={};if("abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter}),"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},test3)).join(""))return!1;return!0}catch(err){return!1}}module.exports=shouldUseNative()?Object.assign:function(target,source){for(var from,symbols,to=toObject(target),s=1;s<arguments.length;s++){for(var key in from=Object(arguments[s]))hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},{}],23:[function(_dereq_,module,exports){var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(fn,options){for(var wkey,cacheKeys=Object.keys(cache),i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i],exp=cache[key].exports;if(exp===fn||exp&&exp.default===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(0x100000000*Math.random()).toString(16);for(var wcache={},i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];wcache[key]=key}sources[wkey]=["function(require,module,exports){"+fn+"(self); }",wcache]}var skey=Math.floor(0x100000000*Math.random()).toString(16),scache={};scache[wkey]=wkey,sources[skey]=["function(require,module,exports){var f = require("+stringify(wkey)+");(f.default ? f.default : f)(self);}",scache];var workerSources={};function resolveSources(key){for(var depPath in workerSources[key]=!0,sources[key][1]){var depKey=sources[key][1][depPath];workerSources[depKey]||resolveSources(depKey)}}resolveSources(skey);var src="("+bundleFn+")({"+Object.keys(workerSources).map(function(key){return stringify(key)+":["+sources[key][0]+","+stringify(sources[key][1])+"]"}).join(",")+"},{},["+stringify(skey)+"])",URL=window.URL||window.webkitURL||window.mozURL||window.msURL,blob=new Blob([src],{type:"text/javascript"});if(options&&options.bare)return blob;var workerUrl=URL.createObjectURL(blob),worker=new Worker(workerUrl);return worker.objectURL=workerUrl,worker}},{}],"/index.js":[function(_dereq_,module,exports){function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if("Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){var _s,_e,_i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}var assign=_dereq_("object-assign"),webworkify=_dereq_("webworkify"),MathLib=_dereq_("./lib/mathlib"),Pool=_dereq_("./lib/pool"),utils=_dereq_("./lib/utils"),worker=_dereq_("./lib/worker"),createStages=_dereq_("./lib/stepper"),createRegions=_dereq_("./lib/tiler"),filter_info=_dereq_("./lib/mm_resize/resize_filter_info"),singletones={},NEED_SAFARI_FIX=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(NEED_SAFARI_FIX=navigator.userAgent.indexOf("Safari")>=0)}catch(e){}var concurrency=1;"undefined"!=typeof navigator&&(concurrency=Math.min(navigator.hardwareConcurrency||1,4));var DEFAULT_PICA_OPTS={tile:1024,concurrency:concurrency,features:["js","wasm","ww"],idle:2e3,createCanvas:function createCanvas(width,height){var tmpCanvas=document.createElement("canvas");return tmpCanvas.width=width,tmpCanvas.height=height,tmpCanvas}},DEFAULT_RESIZE_OPTS={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},CAN_NEW_IMAGE_DATA=!1,CAN_CREATE_IMAGE_BITMAP=!1,CAN_USE_CANVAS_GET_IMAGE_DATA=!1,CAN_USE_OFFSCREEN_CANVAS=!1,CAN_USE_CIB_REGION_FOR_IMAGE=!1;function workerFabric(){return{value:webworkify(worker),destroy:function destroy(){if(this.value.terminate(),"undefined"!=typeof window){var url=window.URL||window.webkitURL||window.mozURL||window.msURL;url&&url.revokeObjectURL&&this.value.objectURL&&url.revokeObjectURL(this.value.objectURL)}}}}function Pica(options){if(!(this instanceof Pica))return new Pica(options);this.options=assign({},DEFAULT_PICA_OPTS,options||{});var limiter_key="lk_".concat(this.options.concurrency);this.__limit=singletones[limiter_key]||utils.limiter(this.options.concurrency),singletones[limiter_key]||(singletones[limiter_key]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}Pica.prototype.init=function(){var checkCibResize,checkOffscreenCanvas,_this=this;if(this.__initPromise)return this.__initPromise;if("undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray)try{new ImageData(new Uint8ClampedArray(400),10,10),CAN_NEW_IMAGE_DATA=!0}catch(__){}"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?CAN_CREATE_IMAGE_BITMAP=!0:this.debug("ImageBitmap does not support .close(), disabled"));var features=this.options.features.slice();if(features.indexOf("all")>=0&&(features=["cib","wasm","js","ww"]),this.__requested_features=features,this.__mathlib=new MathLib(features),features.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{_dereq_("webworkify")(function(){}).terminate(),this.features.ww=!0;var wpool_key="wp_".concat(JSON.stringify(this.options));singletones[wpool_key]?this.__workersPool=singletones[wpool_key]:(this.__workersPool=new Pool(workerFabric,this.options.idle),singletones[wpool_key]=this.__workersPool)}catch(__){}var initMath=this.__mathlib.init().then(function(mathlib){assign(_this.features,mathlib.features)});checkCibResize=CAN_CREATE_IMAGE_BITMAP?utils.cib_support(this.options.createCanvas).then(function(status){if(_this.features.cib&&0>features.indexOf("cib")){_this.debug("createImageBitmap() resize supported, but disabled by config");return}features.indexOf("cib")>=0&&(_this.features.cib=status)}):Promise.resolve(!1),CAN_USE_CANVAS_GET_IMAGE_DATA=utils.can_use_canvas(this.options.createCanvas),checkOffscreenCanvas=(checkOffscreenCanvas=CAN_CREATE_IMAGE_BITMAP&&CAN_NEW_IMAGE_DATA&&-1!==features.indexOf("ww")?utils.worker_offscreen_canvas_support():Promise.resolve(!1)).then(function(result){CAN_USE_OFFSCREEN_CANVAS=result});var checkCibRegion=utils.cib_can_use_region().then(function(result){CAN_USE_CIB_REGION_FOR_IMAGE=result});return this.__initPromise=Promise.all([initMath,checkCibResize,checkOffscreenCanvas,checkCibRegion]).then(function(){return _this}),this.__initPromise},Pica.prototype.__invokeResize=function(tileOpts,opts){var _this2=this;return opts.__mathCache=opts.__mathCache||{},Promise.resolve().then(function(){return _this2.features.ww?new Promise(function(resolve,reject){var w=_this2.__workersPool.acquire();opts.cancelToken&&opts.cancelToken.catch(function(err){return reject(err)}),w.value.onmessage=function(ev){w.release(),ev.data.err?reject(ev.data.err):resolve(ev.data)};var transfer=[];tileOpts.src&&transfer.push(tileOpts.src.buffer),tileOpts.srcBitmap&&transfer.push(tileOpts.srcBitmap),w.value.postMessage({opts:tileOpts,features:_this2.__requested_features,preload:{wasm_nodule:_this2.__mathlib.__}},transfer)}):{data:_this2.__mathlib.resizeAndUnsharp(tileOpts,opts.__mathCache)}})},Pica.prototype.__extractTileData=function(tile,from,opts,stageEnv,extractTo){if(this.features.ww&&CAN_USE_OFFSCREEN_CANVAS&&(utils.isCanvas(from)||CAN_USE_CIB_REGION_FOR_IMAGE))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(stageEnv.srcImageBitmap||from,tile.x,tile.y,tile.width,tile.height).then(function(bitmap){return extractTo.srcBitmap=bitmap,extractTo});if(utils.isCanvas(from))return stageEnv.srcCtx||(stageEnv.srcCtx=from.getContext("2d")),this.debug("Get tile pixel data"),extractTo.src=stageEnv.srcCtx.getImageData(tile.x,tile.y,tile.width,tile.height).data,extractTo;this.debug("Draw tile imageBitmap/image to temporary canvas");var tmpCanvas=this.options.createCanvas(tile.width,tile.height),tmpCtx=tmpCanvas.getContext("2d");return tmpCtx.globalCompositeOperation="copy",tmpCtx.drawImage(stageEnv.srcImageBitmap||from,tile.x,tile.y,tile.width,tile.height,0,0,tile.width,tile.height),this.debug("Get tile pixel data"),extractTo.src=tmpCtx.getImageData(0,0,tile.width,tile.height).data,tmpCanvas.width=tmpCanvas.height=0,extractTo},Pica.prototype.__landTileData=function(tile,result,stageEnv){var toImageData;if(this.debug("Convert raw rgba tile result to ImageData"),result.bitmap)return stageEnv.toCtx.drawImage(result.bitmap,tile.toX,tile.toY),null;if(CAN_NEW_IMAGE_DATA)toImageData=new ImageData(new Uint8ClampedArray(result.data),tile.toWidth,tile.toHeight);else if((toImageData=stageEnv.toCtx.createImageData(tile.toWidth,tile.toHeight)).data.set)toImageData.data.set(result.data);else for(var i=toImageData.data.length-1;i>=0;i--)toImageData.data[i]=result.data[i];return this.debug("Draw tile"),NEED_SAFARI_FIX?stageEnv.toCtx.putImageData(toImageData,tile.toX,tile.toY,tile.toInnerX-tile.toX,tile.toInnerY-tile.toY,tile.toInnerWidth+1e-5,tile.toInnerHeight+1e-5):stageEnv.toCtx.putImageData(toImageData,tile.toX,tile.toY,tile.toInnerX-tile.toX,tile.toInnerY-tile.toY,tile.toInnerWidth,tile.toInnerHeight),null},Pica.prototype.__tileAndResize=function(from,to,opts){var _this3=this,stageEnv={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null};return Promise.resolve().then(function(){if(stageEnv.toCtx=to.getContext("2d"),utils.isCanvas(from))return null;if(utils.isImageBitmap(from))return stageEnv.srcImageBitmap=from,stageEnv.isImageBitmapReused=!0,null;if(utils.isImage(from))return CAN_CREATE_IMAGE_BITMAP?(_this3.debug("Decode image via createImageBitmap"),createImageBitmap(from).then(function(imageBitmap){stageEnv.srcImageBitmap=imageBitmap}).catch(function(e){return null})):null;throw Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(opts.canceled)return opts.cancelToken;_this3.debug("Calculate tiles");var jobs=createRegions({width:opts.width,height:opts.height,srcTileSize:_this3.options.tile,toWidth:opts.toWidth,toHeight:opts.toHeight,destTileBorder:opts.__destTileBorder}).map(function(tile){return _this3.__limit(function(){if(opts.canceled)return opts.cancelToken;var tileOpts={width:tile.width,height:tile.height,toWidth:tile.toWidth,toHeight:tile.toHeight,scaleX:tile.scaleX,scaleY:tile.scaleY,offsetX:tile.offsetX,offsetY:tile.offsetY,filter:opts.filter,unsharpAmount:opts.unsharpAmount,unsharpRadius:opts.unsharpRadius,unsharpThreshold:opts.unsharpThreshold};return _this3.debug("Invoke resize math"),Promise.resolve(tileOpts).then(function(tileOpts){return _this3.__extractTileData(tile,from,opts,stageEnv,tileOpts)}).then(function(tileOpts){return _this3.debug("Invoke resize math"),_this3.__invokeResize(tileOpts,opts)}).then(function(result){return opts.canceled?opts.cancelToken:(stageEnv.srcImageData=null,_this3.__landTileData(tile,result,stageEnv))})})});function cleanup(stageEnv){stageEnv.srcImageBitmap&&(stageEnv.isImageBitmapReused||stageEnv.srcImageBitmap.close(),stageEnv.srcImageBitmap=null)}return _this3.debug("Process tiles"),Promise.all(jobs).then(function(){return _this3.debug("Finished!"),cleanup(stageEnv),to},function(err){throw cleanup(stageEnv),err})})},Pica.prototype.__processStages=function(stages,from,to,opts){var filter,tmpCanvas,_this4=this;if(opts.canceled)return opts.cancelToken;var _stages$shift2=_slicedToArray(stages.shift(),2),toWidth=_stages$shift2[0],toHeight=_stages$shift2[1],isLastStage=0===stages.length;return filter=isLastStage||0>filter_info.q2f.indexOf(opts.filter)?opts.filter:"box"===opts.filter?"box":"hamming",opts=assign({},opts,{toWidth:toWidth,toHeight:toHeight,filter:filter}),isLastStage||(tmpCanvas=this.options.createCanvas(toWidth,toHeight)),this.__tileAndResize(from,isLastStage?to:tmpCanvas,opts).then(function(){return isLastStage?to:(opts.width=toWidth,opts.height=toHeight,_this4.__processStages(stages,tmpCanvas,to,opts))}).then(function(res){return tmpCanvas&&(tmpCanvas.width=tmpCanvas.height=0),res})},Pica.prototype.__resizeViaCreateImageBitmap=function(from,to,opts){var _this5=this,toCtx=to.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(from,{resizeWidth:opts.toWidth,resizeHeight:opts.toHeight,resizeQuality:utils.cib_quality_name(filter_info.f2q[opts.filter])}).then(function(imageBitmap){if(opts.canceled)return opts.cancelToken;if(!opts.unsharpAmount)return toCtx.drawImage(imageBitmap,0,0),imageBitmap.close(),toCtx=null,_this5.debug("Finished!"),to;_this5.debug("Unsharp result");var tmpCanvas=_this5.options.createCanvas(opts.toWidth,opts.toHeight),tmpCtx=tmpCanvas.getContext("2d");tmpCtx.drawImage(imageBitmap,0,0),imageBitmap.close();var iData=tmpCtx.getImageData(0,0,opts.toWidth,opts.toHeight);return _this5.__mathlib.unsharp_mask(iData.data,opts.toWidth,opts.toHeight,opts.unsharpAmount,opts.unsharpRadius,opts.unsharpThreshold),toCtx.putImageData(iData,0,0),tmpCanvas.width=tmpCanvas.height=0,iData=tmpCtx=tmpCanvas=toCtx=null,_this5.debug("Finished!"),to})},Pica.prototype.resize=function(from,to,options){var _this6=this;this.debug("Start resize...");var opts=assign({},DEFAULT_RESIZE_OPTS);if(isNaN(options)?options&&(opts=assign(opts,options)):opts=assign(opts,{quality:options}),opts.toWidth=to.width,opts.toHeight=to.height,opts.width=from.naturalWidth||from.width,opts.height=from.naturalHeight||from.height,Object.prototype.hasOwnProperty.call(opts,"quality")){if(opts.quality<0||opts.quality>3)throw Error("Pica: .quality should be [0..3], got ".concat(opts.quality));opts.filter=filter_info.q2f[opts.quality]}return 0===to.width||0===to.height?Promise.reject(Error("Invalid output size: ".concat(to.width,"x").concat(to.height))):(opts.unsharpRadius>2&&(opts.unsharpRadius=2),opts.canceled=!1,opts.cancelToken&&(opts.cancelToken=opts.cancelToken.then(function(data){throw opts.canceled=!0,data},function(err){throw opts.canceled=!0,err})),opts.__destTileBorder=Math.ceil(Math.max(3,2.5*opts.unsharpRadius|0)),this.init().then(function(){if(opts.canceled)return opts.cancelToken;if(_this6.features.cib){if(filter_info.q2f.indexOf(opts.filter)>=0)return _this6.__resizeViaCreateImageBitmap(from,to,opts);_this6.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!CAN_USE_CANVAS_GET_IMAGE_DATA){var err=Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw err.code="ERR_GET_IMAGE_DATA",err}var stages=createStages(opts.width,opts.height,opts.toWidth,opts.toHeight,_this6.options.tile,opts.__destTileBorder);return _this6.__processStages(stages,from,to,opts)}))},Pica.prototype.resizeBuffer=function(options){var _this7=this,opts=assign({},DEFAULT_RESIZE_OPTS,options);if(Object.prototype.hasOwnProperty.call(opts,"quality")){if(opts.quality<0||opts.quality>3)throw Error("Pica: .quality should be [0..3], got ".concat(opts.quality));opts.filter=filter_info.q2f[opts.quality]}return this.init().then(function(){return _this7.__mathlib.resizeAndUnsharp(opts)})},Pica.prototype.toBlob=function(canvas,mimeType,quality){return mimeType=mimeType||"image/png",new Promise(function(resolve){if(canvas.toBlob){canvas.toBlob(function(blob){return resolve(blob)},mimeType,quality);return}if(canvas.convertToBlob){resolve(canvas.convertToBlob({type:mimeType,quality:quality}));return}for(var asString=atob(canvas.toDataURL(mimeType,quality).split(",")[1]),len=asString.length,asBuffer=new Uint8Array(len),i=0;i<len;i++)asBuffer[i]=asString.charCodeAt(i);resolve(new Blob([asBuffer],{type:mimeType}))})},Pica.prototype.debug=function(){},module.exports=Pica},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")},module.exports=f()}(pica$1);var jpeg_plugins={},image_traverse$1={exports:{}};!function(module){function error(message,code){var err=Error(message);return err.code=code,err}function to_hex(number){for(var n=number.toString(16).toUpperCase(),i=2-n.length;i>0;i--)n="0"+n;return"0x"+n}function utf8_encode(str){try{return unescape(encodeURIComponent(str))}catch(_){return str}}function utf8_decode(str){try{return decodeURIComponent(escape(str))}catch(_){return str}}function is_uint8array(bin){return"[object Uint8Array]"===Object.prototype.toString.call(bin)}function ExifParser(jpeg_bin,exif_start,exif_end){this.input=jpeg_bin.subarray(exif_start,exif_end),this.start=exif_start;var sig=String.fromCharCode.apply(null,this.input.subarray(0,4));if("II*\0"!==sig&&"MM\0*"!==sig)throw error("invalid TIFF signature","EBADDATA");this.big_endian="M"===sig[0]}ExifParser.prototype.each=function(on_entry){this.aborted=!1;var offset=this.read_uint32(4);for(this.ifds_to_read=[{id:0,offset:offset}];this.ifds_to_read.length>0&&!this.aborted;){var i=this.ifds_to_read.shift();i.offset&&this.scan_ifd(i.id,i.offset,on_entry)}},ExifParser.prototype.filter=function(on_entry){var ifds={};ifds.ifd0={id:0,entries:[]},this.each(function(entry){(!1!==on_entry(entry)||entry.is_subifd_link)&&(entry.is_subifd_link&&1!==entry.count&&4!==entry.format||(ifds["ifd"+entry.ifd]||(ifds["ifd"+entry.ifd]={id:entry.ifd,entries:[]}),ifds["ifd"+entry.ifd].entries.push(entry)))}),delete ifds.ifd1;var length=8;Object.keys(ifds).forEach(function(ifd_no){length+=2,ifds[ifd_no].entries.forEach(function(entry){length+=12+(entry.data_length>4?2*Math.ceil(entry.data_length/2):0)}),length+=4}),this.output=new Uint8Array(length),this.output[0]=this.output[1]=(this.big_endian?"M":"I").charCodeAt(0),this.write_uint16(2,42);var offset=8,self1=this;if(this.write_uint32(4,offset),Object.keys(ifds).forEach(function(ifd_no){ifds[ifd_no].written_offset=offset;var ifd_start=offset,ifd_end=ifd_start+2+12*ifds[ifd_no].entries.length+4;offset=ifd_end,self1.write_uint16(ifd_start,ifds[ifd_no].entries.length),ifds[ifd_no].entries.sort(function(a,b){return a.tag-b.tag}).forEach(function(entry,idx){var entry_offset=ifd_start+2+12*idx;self1.write_uint16(entry_offset,entry.tag),self1.write_uint16(entry_offset+2,entry.format),self1.write_uint32(entry_offset+4,entry.count),entry.is_subifd_link?ifds["ifd"+entry.tag]&&(ifds["ifd"+entry.tag].link_offset=entry_offset+8):entry.data_length<=4?self1.output.set(self1.input.subarray(entry.data_offset-self1.start,entry.data_offset-self1.start+4),entry_offset+8):(self1.write_uint32(entry_offset+8,offset),self1.output.set(self1.input.subarray(entry.data_offset-self1.start,entry.data_offset-self1.start+entry.data_length),offset),offset+=2*Math.ceil(entry.data_length/2))});var next_ifd=ifds["ifd"+(ifds[ifd_no].id+1)];next_ifd&&(next_ifd.link_offset=ifd_end-4)}),Object.keys(ifds).forEach(function(ifd_no){ifds[ifd_no].written_offset&&ifds[ifd_no].link_offset&&self1.write_uint32(ifds[ifd_no].link_offset,ifds[ifd_no].written_offset)}),this.output.length!==offset)throw error("internal error: incorrect buffer size allocated");return this.output},ExifParser.prototype.read_uint16=function(offset){var d=this.input;if(offset+2>d.length)throw error("unexpected EOF","EBADDATA");return this.big_endian?256*d[offset]+d[offset+1]:d[offset]+256*d[offset+1]},ExifParser.prototype.read_uint32=function(offset){var d=this.input;if(offset+4>d.length)throw error("unexpected EOF","EBADDATA");return this.big_endian?0x1000000*d[offset]+65536*d[offset+1]+256*d[offset+2]+d[offset+3]:d[offset]+256*d[offset+1]+65536*d[offset+2]+0x1000000*d[offset+3]},ExifParser.prototype.write_uint16=function(offset,value){var d=this.output;this.big_endian?(d[offset]=value>>>8&255,d[offset+1]=255&value):(d[offset]=255&value,d[offset+1]=value>>>8&255)},ExifParser.prototype.write_uint32=function(offset,value){var d=this.output;this.big_endian?(d[offset]=value>>>24&255,d[offset+1]=value>>>16&255,d[offset+2]=value>>>8&255,d[offset+3]=255&value):(d[offset]=255&value,d[offset+1]=value>>>8&255,d[offset+2]=value>>>16&255,d[offset+3]=value>>>24&255)},ExifParser.prototype.is_subifd_link=function(ifd,tag){return 0===ifd&&34665===tag||0===ifd&&34853===tag||34665===ifd&&40965===tag},ExifParser.prototype.exif_format_length=function(format){switch(format){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}},ExifParser.prototype.exif_format_read=function(format,offset){var v;switch(format){case 1:case 2:return this.input[offset];case 6:return(v=this.input[offset])|(128&v)*0x1fffffe;case 3:return this.read_uint16(offset);case 8:return(v=this.read_uint16(offset))|(32768&v)*131070;case 4:return this.read_uint32(offset);case 9:return 0|(v=this.read_uint32(offset));default:return null}},ExifParser.prototype.scan_ifd=function(ifd_no,offset,on_entry){var entry_count=this.read_uint16(offset);offset+=2;for(var i=0;i<entry_count;i++){var tag=this.read_uint16(offset),format=this.read_uint16(offset+2),count=this.read_uint32(offset+4),comp_length=this.exif_format_length(format),data_length=count*comp_length,data_offset=data_length<=4?offset+8:this.read_uint32(offset+8),is_subifd_link=!1;if(data_offset+data_length>this.input.length)throw error("unexpected EOF","EBADDATA");for(var value=[],comp_offset=data_offset,j=0;j<count;j++,comp_offset+=comp_length){var item=this.exif_format_read(format,comp_offset);if(null===item){value=null;break}value.push(item)}if(Array.isArray(value)&&2===format){try{value=utf8_decode(String.fromCharCode.apply(null,value))}catch(_){value=null}value&&"\0"===value[value.length-1]&&(value=value.slice(0,-1))}if(this.is_subifd_link(ifd_no,tag)&&Array.isArray(value)&&Number.isInteger(value[0])&&value[0]>0&&(this.ifds_to_read.push({id:tag,offset:value[0]}),is_subifd_link=!0),!1===on_entry({is_big_endian:this.big_endian,ifd:ifd_no,tag:tag,format:format,count:count,entry_offset:offset+this.start,data_length:data_length,data_offset:data_offset+this.start,value:value,is_subifd_link:is_subifd_link})){this.aborted=!0;return}offset+=12}0===ifd_no&&this.ifds_to_read.push({id:1,offset:this.read_uint32(offset)})},module.exports.is_jpeg=function(jpeg_bin){return jpeg_bin.length>=4&&255===jpeg_bin[0]&&216===jpeg_bin[1]&&255===jpeg_bin[2]},module.exports.jpeg_segments_each=function(jpeg_bin,on_segment){if(!is_uint8array(jpeg_bin))throw error("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if("function"!=typeof on_segment)throw error("Invalid argument (on_segment), Function expected","EINVAL");if(!module.exports.is_jpeg(jpeg_bin))throw error("Unknown file format","ENOTJPEG");for(var offset=0,length=jpeg_bin.length,inside_scan=!1;;){if(offset+1>=length)throw error("Unexpected EOF","EBADDATA");var segment_code,segment_length,byte1=jpeg_bin[offset],byte2=jpeg_bin[offset+1];if(255===byte1&&255===byte2)segment_code=255,segment_length=1;else if(255===byte1&&0!==byte2){if(segment_length=2,208<=(segment_code=byte2)&&segment_code<=217||1===segment_code);else{if(offset+3>=length)throw error("Unexpected EOF","EBADDATA");if((segment_length+=256*jpeg_bin[offset+2]+jpeg_bin[offset+3])<2)throw error("Invalid segment length","EBADDATA");if(offset+segment_length-1>=length)throw error("Unexpected EOF","EBADDATA")}inside_scan&&(segment_code>=208&&segment_code<=215||(inside_scan=!1)),218===segment_code&&(inside_scan=!0)}else if(inside_scan)for(var pos=offset+1;;pos++){if(pos>=length)throw error("Unexpected EOF","EBADDATA");if(255===jpeg_bin[pos]){if(pos+1>=length)throw error("Unexpected EOF","EBADDATA");if(0!==jpeg_bin[pos+1]){segment_code=0,segment_length=pos-offset;break}}}else throw error("Unexpected byte at segment start: "+to_hex(byte1)+" (offset "+to_hex(offset)+")","EBADDATA");if(!1===on_segment({code:segment_code,offset:offset,length:segment_length})||217===segment_code)break;offset+=segment_length}},module.exports.jpeg_segments_filter=function(jpeg_bin,on_segment){if(!is_uint8array(jpeg_bin))throw error("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if("function"!=typeof on_segment)throw error("Invalid argument (on_segment), Function expected","EINVAL");var ranges=[],out_length=0;module.exports.jpeg_segments_each(jpeg_bin,function(segment){var new_segment=on_segment(segment);if(is_uint8array(new_segment))ranges.push({data:new_segment}),out_length+=new_segment.length;else if(Array.isArray(new_segment))new_segment.filter(is_uint8array).forEach(function(s){ranges.push({data:s}),out_length+=s.length});else if(!1!==new_segment){var new_range={start:segment.offset,end:segment.offset+segment.length};ranges.length>0&&ranges[ranges.length-1].end===new_range.start?ranges[ranges.length-1].end=new_range.end:ranges.push(new_range),out_length+=segment.length}});var result=new Uint8Array(out_length),offset=0;return ranges.forEach(function(range){var data=range.data||jpeg_bin.subarray(range.start,range.end);result.set(data,offset),offset+=data.length}),result},module.exports.jpeg_exif_tags_each=function(jpeg_bin,on_exif_entry){if(!is_uint8array(jpeg_bin))throw error("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if("function"!=typeof on_exif_entry)throw error("Invalid argument (on_exif_entry), Function expected","EINVAL");module.exports.jpeg_segments_each(jpeg_bin,function(segment){return 218!==segment.code&&(225===segment.code&&segment.length>=10&&69===jpeg_bin[segment.offset+4]&&120===jpeg_bin[segment.offset+5]&&105===jpeg_bin[segment.offset+6]&&102===jpeg_bin[segment.offset+7]&&0===jpeg_bin[segment.offset+8]&&0===jpeg_bin[segment.offset+9]?(new ExifParser(jpeg_bin,segment.offset+10,segment.offset+segment.length).each(on_exif_entry),!1):void 0)})},module.exports.jpeg_exif_tags_filter=function(jpeg_bin,on_exif_entry){if(!is_uint8array(jpeg_bin))throw error("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if("function"!=typeof on_exif_entry)throw error("Invalid argument (on_exif_entry), Function expected","EINVAL");var stop_search=!1;return module.exports.jpeg_segments_filter(jpeg_bin,function(segment){if(!stop_search&&(218===segment.code&&(stop_search=!0),225===segment.code&&segment.length>=10&&69===jpeg_bin[segment.offset+4]&&120===jpeg_bin[segment.offset+5]&&105===jpeg_bin[segment.offset+6]&&102===jpeg_bin[segment.offset+7]&&0===jpeg_bin[segment.offset+8]&&0===jpeg_bin[segment.offset+9])){var new_exif=new ExifParser(jpeg_bin,segment.offset+10,segment.offset+segment.length).filter(on_exif_entry);if(!new_exif)return!1;var header=new Uint8Array(10);return header.set(jpeg_bin.slice(segment.offset,segment.offset+10)),header[2]=new_exif.length+8>>>8&255,header[3]=new_exif.length+8&255,stop_search=!0,[header,new_exif]}})},module.exports.jpeg_add_comment=function(jpeg_bin,comment){var comment_inserted=!1,segment_count=0;return module.exports.jpeg_segments_filter(jpeg_bin,function(segment){if((1!=++segment_count||216!==segment.code)&&(2!==segment_count||224!==segment.code)&&!comment_inserted){var csegment=new Uint8Array(5+(comment=utf8_encode(comment)).length),offset=0;return csegment[offset++]=255,csegment[offset++]=254,csegment[offset++]=comment.length+3>>>8&255,csegment[offset++]=comment.length+3&255,comment.split("").forEach(function(c){csegment[offset++]=255&c.charCodeAt(0)}),csegment[offset++]=0,comment_inserted=!0,[csegment,jpeg_bin.subarray(segment.offset,segment.offset+segment.length)]}})}}(image_traverse$1);var image_traverse=image_traverse$1.exports;function jpeg_patch_exif(env){return this._getUint8Array(env.blob).then(function(data){if(env.is_jpeg=image_traverse.is_jpeg(data),!env.is_jpeg)return Promise.resolve(env);env.orig_blob=env.blob;try{var exif_is_big_endian,orientation_offset;if(image_traverse.jpeg_exif_tags_each(data,function(entry){if(0===entry.ifd&&274===entry.tag&&Array.isArray(entry.value))return env.orientation=entry.value[0]||1,exif_is_big_endian=entry.is_big_endian,orientation_offset=entry.data_offset,!1}),orientation_offset){var orientation_patch=new Uint8Array(exif_is_big_endian?[0,1]:[1,0]);env.blob=new Blob([data.slice(0,orientation_offset),orientation_patch,data.slice(orientation_offset+2)],{type:"image/jpeg"})}}catch(_){}return env})}function jpeg_rotate_canvas(env){if(!env.is_jpeg)return Promise.resolve(env);var canvas,orientation=env.orientation-1;if(!orientation)return Promise.resolve(env);var ctx=(canvas=4&orientation?this.pica.options.createCanvas(env.out_canvas.height,env.out_canvas.width):this.pica.options.createCanvas(env.out_canvas.width,env.out_canvas.height)).getContext("2d");return ctx.save(),1&orientation&&ctx.transform(-1,0,0,1,canvas.width,0),2&orientation&&ctx.transform(-1,0,0,-1,canvas.width,canvas.height),4&orientation&&ctx.transform(0,1,1,0,0,0),ctx.drawImage(env.out_canvas,0,0),ctx.restore(),env.out_canvas.width=env.out_canvas.height=0,env.out_canvas=canvas,Promise.resolve(env)}function jpeg_attach_orig_segments(env){return env.is_jpeg?Promise.all([this._getUint8Array(env.blob),this._getUint8Array(env.out_blob)]).then(function(res){var data=res[0],data_out=res[1];if(!image_traverse.is_jpeg(data))return Promise.resolve(env);var segments=[];return image_traverse.jpeg_segments_each(data,function(segment){if(218===segment.code)return!1;segments.push(segment)}),segments=segments.filter(function(segment){return 226!==segment.code&&(segment.code>=224&&segment.code<240||254===segment.code)}).map(function(segment){return data.slice(segment.offset,segment.offset+segment.length)}),env.out_blob=new Blob([data_out.slice(0,2)].concat(segments).concat([data_out.slice(20)]),{type:"image/jpeg"}),env}):Promise.resolve(env)}function assign(reducer){reducer.before("_blob_to_image",jpeg_patch_exif),reducer.after("_transform",jpeg_rotate_canvas),reducer.after("_create_blob",jpeg_attach_orig_segments)}jpeg_plugins.jpeg_patch_exif=jpeg_patch_exif,jpeg_plugins.jpeg_rotate_canvas=jpeg_rotate_canvas,jpeg_plugins.jpeg_attach_orig_segments=jpeg_attach_orig_segments,jpeg_plugins.assign=assign;var pica=pica$1.exports;function ImageBlobReduce(options){if(!(this instanceof ImageBlobReduce))return new ImageBlobReduce(options);options=options||{},this.pica=options.pica||pica({}),this.initialized=!1,this.utils=utils$1}ImageBlobReduce.prototype.use=function(plugin){var args=[this].concat(Array.prototype.slice.call(arguments,1));return plugin.apply(plugin,args),this},ImageBlobReduce.prototype.init=function(){this.use(jpeg_plugins.assign)},ImageBlobReduce.prototype.toBlob=function(blob,options){var opts=utils$1.assign({max:1/0},options);return this.initialized||(this.init(),this.initialized=!0),Promise.resolve({blob:blob,opts:opts}).then(this._blob_to_image).then(this._calculate_size).then(this._transform).then(this._cleanup).then(this._create_blob).then(function(_env){return _env.out_canvas.width=_env.out_canvas.height=0,_env.out_blob})},ImageBlobReduce.prototype.toCanvas=function(blob,options){var opts=utils$1.assign({max:1/0},options);return this.initialized||(this.init(),this.initialized=!0),Promise.resolve({blob:blob,opts:opts}).then(this._blob_to_image).then(this._calculate_size).then(this._transform).then(this._cleanup).then(function(_env){return _env.out_canvas})},ImageBlobReduce.prototype.before=function(method_name,fn){if(!this[method_name])throw Error('Method "'+method_name+'" does not exist');if("function"!=typeof fn)throw Error('Invalid argument "fn", function expected');var old_fn=this[method_name],self1=this;return this[method_name]=function(env){return fn.call(self1,env).then(function(_env){return old_fn.call(self1,_env)})},this},ImageBlobReduce.prototype.after=function(method_name,fn){if(!this[method_name])throw Error('Method "'+method_name+'" does not exist');if("function"!=typeof fn)throw Error('Invalid argument "fn", function expected');var old_fn=this[method_name],self1=this;return this[method_name]=function(env){return old_fn.call(self1,env).then(function(_env){return fn.call(self1,_env)})},this},ImageBlobReduce.prototype._blob_to_image=function(env){var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;return env.image=document.createElement("img"),env.image_url=URL.createObjectURL(env.blob),env.image.src=env.image_url,new Promise(function(resolve,reject){env.image.onerror=function(){reject(Error("ImageBlobReduce: failed to create Image() from blob"))},env.image.onload=function(){resolve(env)}})},ImageBlobReduce.prototype._calculate_size=function(env){var scale_factor=env.opts.max/Math.max(env.image.width,env.image.height);return scale_factor>1&&(scale_factor=1),env.transform_width=Math.max(Math.round(env.image.width*scale_factor),1),env.transform_height=Math.max(Math.round(env.image.height*scale_factor),1),env.scale_factor=scale_factor,Promise.resolve(env)},ImageBlobReduce.prototype._transform=function(env){env.out_canvas=this.pica.options.createCanvas(env.transform_width,env.transform_height),env.transform_width=null,env.transform_height=null;var pica_opts={alpha:"image/png"===env.blob.type};return this.utils.assign(pica_opts,this.utils.pick_pica_resize_options(env.opts)),this.pica.resize(env.image,env.out_canvas,pica_opts).then(function(){return env})},ImageBlobReduce.prototype._cleanup=function(env){env.image.src="",env.image=null;var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;return URL.revokeObjectURL&&URL.revokeObjectURL(env.image_url),env.image_url=null,Promise.resolve(env)},ImageBlobReduce.prototype._create_blob=function(env){return this.pica.toBlob(env.out_canvas,env.blob.type).then(function(blob){return env.out_blob=blob,env})},ImageBlobReduce.prototype._getUint8Array=function(blob){return blob.arrayBuffer?blob.arrayBuffer().then(function(buf){return new Uint8Array(buf)}):new Promise(function(resolve,reject){var fr=new FileReader;fr.readAsArrayBuffer(blob),fr.onload=function(){resolve(new Uint8Array(fr.result))},fr.onerror=function(){reject(Error("ImageBlobReduce: failed to load data from input blob")),fr.abort()},fr.onabort=function(){reject(Error("ImageBlobReduce: failed to load data from input blob (aborted)"))}})},ImageBlobReduce.pica=pica;var imageBlobReduce=ImageBlobReduce}}]);
//# sourceMappingURL=79447.6439b5dd.iframe.bundle.js.map