"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[88558],{"../../frontend/src/scenes/groups/GroupsNew.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{GroupsNew:()=>GroupsNew,scene:()=>scene});var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),kea_forms_lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),groupsModel=__webpack_require__("../../frontend/src/models/groupsModel.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx");let NEW_GROUP={},groupsNewLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>`${props.groupTypeIndex}-new`),(0,index_esm.path)(key=>["scenes","groupsNew","groupsNewLogic",key]),(0,index_esm.connect)(()=>({values:[groupsModel.$,["aggregationLabel"],featureFlagLogic.featureFlagLogic,["featureFlags"]]})),(0,index_esm.selectors)({logicProps:[()=>[(_,props)=>props],props=>props],groupTypeName:[s=>[s.aggregationLabel,s.logicProps],(aggregationLabel,logicProps)=>aggregationLabel(logicProps.groupTypeIndex).singular],breadcrumbs:[s=>[s.logicProps,s.groupTypeName],(logicProps,groupTypeName)=>[{key:sceneTypes.x.PersonsManagement,name:"People",path:urls.j.persons()},{key:sceneTypes.x.Groups,name:(0,utils.fm)(groupTypeName),path:urls.j.groups(logicProps.groupTypeIndex)},{key:sceneTypes.x.GroupsNew,name:`Create ${groupTypeName}`}]]}),(0,index_esm.actions)({saveGroup:groupParams=>({groupParams}),addProperty:()=>({}),removeProperty:index=>({index}),updateProperty:(index,field,value)=>({index,field,value})}),(0,index_esm.reducers)({createdGroup:[null,{saveGroupSuccess:(_,_ref)=>{let{createdGroup}=_ref;return createdGroup},resetGroup:()=>null}],customProperties:[[],{addProperty:state=>[...state,{name:"",value:""}],removeProperty:(state,_ref2)=>{let{index}=_ref2;return state.filter((_,i)=>i!==index)},updateProperty:(state,_ref3)=>{let{index,field,value}=_ref3;return state.map((prop,i)=>i===index?{...prop,[field]:value}:prop)},resetGroup:()=>[]}]}),(0,kea_forms_lib.forms)(_ref4=>{let{actions,props,values}=_ref4;return{group:{defaults:NEW_GROUP,errors:_ref5=>{let{group_key,name}=_ref5;return{name:name?.trim()?void 0:"Group name cannot be empty",group_key:group_key?.trim()?void 0:"Group key cannot be empty"}},submit:formData=>{let flattenedCustomProperties=flattenProperties(values.customProperties),group_properties={name:formData.name,...flattenedCustomProperties},groupData={group_key:formData.group_key,group_type_index:props.groupTypeIndex,group_properties};actions.saveGroup(groupData)}}}}),(0,kea_loaders_lib.loaders)(()=>({createdGroup:[null,{saveGroup:async _ref6=>{let{groupParams}=_ref6;try{let newGroup=await api.ZP.groups.create(groupParams);return LemonToast.UJ.success("Group saved"),newGroup}catch(error){throw LemonToast.UJ.error("Failed to save group"),error}}}]})),(0,index_esm.listeners)(_ref7=>{let{actions,values}=_ref7;return{submitGroup:()=>{values.groupHasErrors&&LemonToast.UJ.error("There was an error submitting this group. Make sure all fields are filled correctly.")},saveGroupSuccess:()=>actions.resetGroup()}}),(0,lib.actionToUrl)(_ref8=>{let{values}=_ref8;return{saveGroupSuccess:()=>urls.j.groups(values.logicProps.groupTypeIndex)}}),(0,index_esm.afterMount)(_ref9=>{let{props,values}=_ref9;values.featureFlags[constants.y8.CRM_ITERATION_ONE]||lib.router.actions.push(urls.j.groups(props.groupTypeIndex))}),(0,index_esm.beforeUnmount)(_ref10=>{let{actions}=_ref10;return actions.resetGroup()})]);function flattenProperties(properties){return properties.filter(prop=>prop.name.trim()&&prop.value.trim()).reduce((acc,prop)=>(acc[prop.name.trim()]=prop.value,acc),{})}var LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.26.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:GroupsNew,logic:groupsNewLogic,paramsToProps:_ref=>{let{params:{groupTypeIndex}}=_ref;return{groupTypeIndex:parseInt(null!=groupTypeIndex?groupTypeIndex:"0")}}};function GroupsNew(){let{logicProps,customProperties}=(0,index_esm.useValues)(groupsNewLogic),{addProperty,removeProperty,updateProperty}=(0,index_esm.useActions)(groupsNewLogic);return(0,jsx_runtime.jsx)("div",{className:"groups-new",children:(0,jsx_runtime.jsxs)(kea_forms_lib.Form,{id:"group",logic:groupsNewLogic,props:logicProps,formKey:"group",enableFormOnSubmit:!0,children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{"data-attr":"cancel-group",type:"secondary",onClick:()=>{lib.router.actions.push(urls.j.groups(logicProps.groupTypeIndex))},children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary","data-attr":"save-group",htmlType:"submit",form:"group",children:"Save"})]})}),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2 max-w-200 gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 flex-wrap",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",children:(0,jsx_runtime.jsx)(src.DF,{"data-attr":"group-name"})})}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(LemonField.D,{name:"group_key",label:"ID",children:(0,jsx_runtime.jsx)(src.DF,{"data-attr":"group-key"})})})]}),(0,jsx_runtime.jsx)(src.p2,{className:"my-4"})]}),(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2 max-w-214 gap-4",children:(0,jsx_runtime.jsxs)("div",{className:"mt-4",children:[(0,jsx_runtime.jsx)("h3",{className:"text-md font-medium mb-2",children:"Properties"}),customProperties&&customProperties.length>0&&(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mb-2 text-s font-medium",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:"Name"}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:"Value"}),(0,jsx_runtime.jsx)("div",{className:"w-8"})," "]}),customProperties&&customProperties.map((property,index)=>(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mb-2 items-start",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{value:property.name,onChange:value=>updateProperty(index,"name",value),placeholder:"e.g., company"})}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(src.DF,{value:property.value,onChange:value=>updateProperty(index,"value",value),placeholder:"e.g., PostHog"})}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),size:"small",type:"secondary",status:"danger",onClick:()=>removeProperty(index),"data-attr":`remove-property-${index}`})]},index)),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),type:"secondary",onClick:addProperty,"data-attr":"add-property",children:"Add property"})]})})]})})}}}]);