"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[76375],{"../../products/tasks/frontend/TaskTracker.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{TaskTracker:()=>TaskTracker,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),useFeatureFlag=__webpack_require__("../../frontend/src/lib/hooks/useFeatureFlag.ts"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),types=__webpack_require__("../../products/tasks/frontend/types.ts");let demoTasks=[{id:"1",title:"Memory leak in session recording module",description:"Users reporting browser crashes during long recording sessions, memory usage keeps growing",status:types.hY.BACKLOG,origin_product:types.Aw.ERROR_TRACKING,position:0,created_at:"2024-01-15T10:30:00Z",updated_at:"2024-01-15T10:30:00Z"},{id:"2",title:"Add dark mode toggle to settings",description:"User requested feature to enable dark mode across the entire application interface",status:types.hY.BACKLOG,origin_product:types.Aw.USER_CREATED,position:1,created_at:"2024-01-14T09:15:00Z",updated_at:"2024-01-14T09:15:00Z"},{id:"3",title:"Improve A/B test statistical significance calculations",description:"Enhance the evaluation clustering algorithm for more accurate experiment results",status:types.hY.TODO,origin_product:types.Aw.EVAL_CLUSTERS,position:0,created_at:"2024-01-13T14:20:00Z",updated_at:"2024-01-16T11:45:00Z"},{id:"4",title:"User cannot access dashboard after password reset",description:"Multiple support tickets about users being locked out after password reset flow",status:types.hY.DONE,origin_product:types.Aw.SUPPORT_QUEUE,position:0,created_at:"2024-01-12T16:00:00Z",updated_at:"2024-01-17T08:30:00Z"},{id:"5",title:"Performance testing for new cohort analysis feature",description:"Run evaluation tests to ensure cohort analysis performs well with large datasets",status:types.hY.DONE,origin_product:types.Aw.EVAL_CLUSTERS,position:0,created_at:"2024-01-11T13:45:00Z",updated_at:"2024-01-18T15:20:00Z"},{id:"6",title:"Fix JavaScript error in event tracking",description:"TypeError: Cannot read property of undefined in tracking script causing events to fail",status:types.hY.DONE,origin_product:types.Aw.ERROR_TRACKING,position:0,created_at:"2024-01-10T11:00:00Z",updated_at:"2024-01-19T12:00:00Z"},{id:"7",title:"Custom dashboard widget for conversion metrics",description:"User-requested feature to create custom widgets showing conversion funnel data",status:types.hY.BACKLOG,origin_product:types.Aw.USER_CREATED,position:2,created_at:"2024-01-09T10:15:00Z",updated_at:"2024-01-09T10:15:00Z"},{id:"8",title:"Export functionality not working for team admin",description:"Support ticket: Team admin reports CSV export button returns empty files",status:types.hY.BACKLOG,origin_product:types.Aw.SUPPORT_QUEUE,position:3,created_at:"2024-01-08T15:30:00Z",updated_at:"2024-01-08T15:30:00Z"}],tasksLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","tasks","frontend","tasksLogic"]),(0,index_esm.actions)({setActiveTab:tab=>({tab}),moveTask:(taskId,newStatus,newPosition)=>({taskId,newStatus,newPosition}),createTask:task=>({task}),updateTask:(id,data)=>({id,data}),scopeTask:taskId=>({taskId}),reorderTasks:(sourceIndex,destinationIndex,status)=>({sourceIndex,destinationIndex,status}),openTaskModal:taskId=>({taskId}),closeTaskModal:!0,openCreateModal:!0,closeCreateModal:!0,startPolling:!0,stopPolling:!0,pollForUpdates:!0,startReordering:!0,endReordering:!0}),(0,lib.loaders)(_ref=>{let{values,actions}=_ref;return{tasks:[[],{loadTasks:async()=>{try{return(await api.ZP.tasks.list()).results}catch(error){return console.error("Failed to load tasks, using demo data:",error),demoTasks}},createTask:async _ref2=>{let{task}=_ref2;try{let response=await api.ZP.tasks.create(task);return[...values.tasks,response]}catch(error){throw src.UJ.error("Failed to create task. Please try again."),console.error("Failed to create task:",error),error}},updateTask:async _ref3=>{let{id,data}=_ref3;try{let response=await api.ZP.tasks.update(id,data);return[...values.tasks].map(task=>task.id===id?{...task,...response}:task)}catch(error){throw src.UJ.error("Failed to update task. Please try again."),console.error("Failed to update task:",error),error}},moveTask:async _ref4=>{let{taskId,newStatus,newPosition}=_ref4;actions.startReordering();let currentTasks=[...values.tasks],moved=currentTasks.find(t=>t.id===taskId);if(!moved)return actions.endReordering(),currentTasks;let sourceStatus=moved.status,sourceList=currentTasks.filter(t=>t.status===sourceStatus&&t.id!==taskId).sort((a,b)=>a.position-b.position),targetList=currentTasks.filter(t=>t.status===newStatus&&t.id!==taskId).sort((a,b)=>a.position-b.position),insertIndex=Math.min(Math.max(null!=newPosition?newPosition:targetList.length,0),targetList.length),updatedTargetList=[...targetList.slice(0,insertIndex),{...moved,status:newStatus},...targetList.slice(insertIndex)],sourceIds=sourceList.map(t=>t.id),targetIds=updatedTargetList.map(t=>t.id),updatedTasks=currentTasks.map(t=>t.id===taskId?{...t,status:newStatus,position:targetIds.indexOf(t.id),updated_at:new Date().toISOString()}:t.status===sourceStatus&&sourceIds.includes(t.id)?{...t,position:sourceIds.indexOf(t.id)}:t.status===newStatus&&targetIds.includes(t.id)?{...t,position:targetIds.indexOf(t.id)}:t),columns={};return columns[sourceStatus]=sourceIds,columns[newStatus]=targetIds,api.ZP.tasks.bulkReorder(columns).then(()=>{}).catch(()=>{actions.loadTasks()}).finally(()=>{actions.endReordering()}),updatedTasks},scopeTask:async _ref5=>{let{taskId}=_ref5,nextPosition=values.tasks.filter(task=>task.status===types.hY.TODO).length,currentTasks=values.tasks.map(task=>task.id===taskId&&task.status===types.hY.BACKLOG?{...task,status:types.hY.TODO,position:nextPosition,updated_at:new Date().toISOString()}:task);return api.ZP.tasks.update(taskId,{status:types.hY.TODO,position:nextPosition}).catch(()=>{actions.loadTasks()}),currentTasks},reorderTasks:async _ref6=>{let{sourceIndex,destinationIndex,status}=_ref6,statusTasks=values.tasks.filter(task=>task.status===status).sort((a,b)=>a.position-b.position),movedTask=statusTasks[sourceIndex];if(!movedTask)return values.tasks;let reorderedStatusTasks=[...statusTasks];reorderedStatusTasks.splice(sourceIndex,1),reorderedStatusTasks.splice(destinationIndex,0,movedTask);let currentTasks=values.tasks.map(task=>{if(task.status===status){let newIndex=reorderedStatusTasks.findIndex(st=>st.id===task.id);return{...task,position:newIndex}}return task});return Promise.all(reorderedStatusTasks.map((task,index)=>task.position!==index?api.ZP.tasks.update(task.id,{position:index}):Promise.resolve())).catch(()=>{actions.loadTasks()}),currentTasks},pollForUpdates:async()=>{if(values.isReordering)return values.tasks;try{return(await api.ZP.tasks.list()).results}catch(error){return console.error("Polling failed:",error),values.tasks}}}]}}),(0,index_esm.reducers)({activeTab:["backlog",{setActiveTab:(_,_ref7)=>{let{tab}=_ref7;return tab}}],selectedTaskId:[null,{openTaskModal:(_,_ref8)=>{let{taskId}=_ref8;return taskId},closeTaskModal:()=>null}],isCreateModalOpen:[!1,{openCreateModal:()=>!0,closeCreateModal:()=>!1}],pollingInterval:[null,{startPolling:()=>null,stopPolling:()=>null}],isReordering:[!1,{startReordering:()=>!0,endReordering:()=>!1}]}),(0,index_esm.selectors)({backlogTasks:[s=>[s.tasks],tasks=>tasks.filter(task=>task.status===types.hY.BACKLOG).sort((a,b)=>a.position-b.position)],kanbanColumns:[s=>[s.tasks],tasks=>{let buckets=tasks.reduce((acc,task)=>(acc[task.status].push(task),acc),{[types.hY.BACKLOG]:[],[types.hY.TODO]:[],[types.hY.IN_PROGRESS]:[],[types.hY.TESTING]:[],[types.hY.DONE]:[]});return Object.keys(buckets).forEach(k=>{buckets[k]=buckets[k].slice().sort((a,b)=>a.position-b.position)}),buckets}],selectedTask:[s=>[s.tasks,s.selectedTaskId],(tasks,selectedTaskId)=>selectedTaskId&&tasks.find(task=>task.id===selectedTaskId)||null],hasActiveTasks:[s=>[s.tasks],tasks=>tasks.some(task=>task.status===types.hY.IN_PROGRESS||task.status===types.hY.TODO||task.status===types.hY.TESTING)]}),(0,index_esm.listeners)(_ref9=>{let{actions,values,cache}=_ref9;return{startPolling:()=>{cache.pollingInterval&&clearInterval(cache.pollingInterval),cache.pollingInterval=setInterval(()=>{values.hasActiveTasks?actions.pollForUpdates():actions.stopPolling()},3e3)},stopPolling:()=>{cache.pollingInterval&&(clearInterval(cache.pollingInterval),cache.pollingInterval=null)},loadTasksSuccess:()=>{values.hasActiveTasks&&!cache.pollingInterval?actions.startPolling():!values.hasActiveTasks&&cache.pollingInterval&&actions.stopPolling()},moveTaskSuccess:()=>{values.hasActiveTasks&&!cache.pollingInterval?actions.startPolling():!values.hasActiveTasks&&cache.pollingInterval&&actions.stopPolling()},pollForUpdatesSuccess:()=>{values.hasActiveTasks||actions.stopPolling()}}}),(0,index_esm.afterMount)(_ref10=>{let{actions}=_ref10;actions.loadTasks()}),(0,index_esm.beforeUnmount)(_ref11=>{let{cache}=_ref11;cache.pollingInterval&&clearInterval(cache.pollingInterval)})]);var icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts");let STATUS_LABELS={[types.hY.BACKLOG]:"Backlog",[types.hY.TODO]:"To Do",[types.hY.IN_PROGRESS]:"In Progress",[types.hY.TESTING]:"Testing",[types.hY.DONE]:"Done"},STATUS_COLORS={[types.hY.BACKLOG]:"bg-stone-100 text-stone-800",[types.hY.TODO]:"bg-blue-100 text-blue-800",[types.hY.IN_PROGRESS]:"bg-amber-100 text-amber-800",[types.hY.TESTING]:"bg-violet-100 text-violet-800",[types.hY.DONE]:"bg-green-100 text-green-800"},ORIGIN_PRODUCT_LABELS={[types.Aw.ERROR_TRACKING]:"Error Tracking",[types.Aw.EVAL_CLUSTERS]:"Eval Clusters",[types.Aw.USER_CREATED]:"User Created",[types.Aw.SUPPORT_QUEUE]:"Support Queue"},ORIGIN_PRODUCT_COLORS={[types.Aw.ERROR_TRACKING]:"bg-red-100 text-red-800",[types.Aw.EVAL_CLUSTERS]:"bg-sky-100 text-sky-800",[types.Aw.USER_CREATED]:"bg-emerald-100 text-emerald-800",[types.Aw.SUPPORT_QUEUE]:"bg-orange-100 text-orange-800"};var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function TaskCard(_ref){let{task,onScope,onClick,draggable=!1}=_ref;return(0,jsx_runtime.jsxs)(src.Mi,{className:`p-3 ${draggable?"cursor-move":"cursor-pointer"}`,hoverEffect:!0,onClick:()=>{onClick&&onClick(task.id)},children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,jsx_runtime.jsx)("h4",{className:"font-medium text-sm leading-tight",children:task.title})}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted mb-3 line-clamp-2",children:task.description}),(task.github_branch||task.github_pr_url)&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 mb-2",children:[(0,jsx_runtime.jsx)(icons.Uv,{className:"text-xs"}),task.github_branch&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted",children:[(0,jsx_runtime.jsx)(icons.$M,{}),(0,jsx_runtime.jsx)("span",{className:"truncate max-w-32",children:task.github_branch})]}),task.github_pr_url&&(0,jsx_runtime.jsxs)(src.rU,{to:task.github_pr_url,target:"_blank",className:"flex items-center gap-1 text-xs text-link hover:text-link-hover",onClick:e=>e.stopPropagation(),children:[(0,jsx_runtime.jsx)("span",{children:"↗"}),(0,jsx_runtime.jsx)("span",{children:"PR"})]})]}),task.repository_scope&&(0,jsx_runtime.jsx)("div",{className:"mb-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium",children:"Repos:"}),"single"===task.repository_scope&&task.primary_repository&&(0,jsx_runtime.jsxs)("span",{className:"text-primary",children:[task.primary_repository.organization,"/",task.primary_repository.repository]}),"multiple"===task.repository_scope&&task.repository_list&&(0,jsx_runtime.jsxs)("span",{className:"text-primary",children:[task.repository_list.length," repositories"]}),"smart_select"===task.repository_scope&&(0,jsx_runtime.jsx)("span",{className:"text-primary",children:"Smart Select"})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${ORIGIN_PRODUCT_COLORS[task.origin_product]}`,children:ORIGIN_PRODUCT_LABELS[task.origin_product]}),task.status===types.hY.BACKLOG&&onScope&&(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"primary",onClick:e=>{e.stopPropagation(),onScope(task.id)},children:"Scope"})]})]})}var react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.27.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),integrationsLogic=__webpack_require__("../../frontend/src/lib/integrations/integrationsLogic.ts");let repositorySelectorLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","tasks","frontend","components","repositorySelectorLogic"]),(0,index_esm.connect)({actions:[integrationsLogic.a,["loadIntegrations","loadGitHubRepositories"]],values:[integrationsLogic.a,["integrations","getGitHubRepositories"]]}),(0,index_esm.actions)({setAvailableRepos:repos=>({repos}),setOnChangeCallback:callback=>({callback}),setCurrentConfig:config=>({config}),tryAutoSelectFirstIntegration:!0}),(0,index_esm.reducers)({availableRepos:[[],{setAvailableRepos:(_,_ref)=>{let{repos}=_ref;return repos}}],onChangeCallback:[null,{setOnChangeCallback:(_,_ref2)=>{let{callback}=_ref2;return callback}}],currentConfig:[{},{setCurrentConfig:(_,_ref3)=>{let{config}=_ref3;return config}}]}),(0,index_esm.selectors)({githubIntegrations:[s=>[s.integrations],integrations=>integrations?.filter(integration=>"github"===integration.kind)||[]]}),(0,index_esm.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadIntegrations()}),(0,index_esm.listeners)(_ref5=>{let{actions,values}=_ref5;return{[integrationsLogic.a.actionTypes.loadIntegrationsSuccess]:()=>{values.githubIntegrations.length>0&&values.githubIntegrations.forEach(integration=>{actions.loadGitHubRepositories(integration.id)})},[integrationsLogic.a.actionTypes.loadGitHubRepositoriesSuccess]:()=>{if(values.githubIntegrations.length>0){let repoData=[];for(let integration of values.githubIntegrations){let repos=values.getGitHubRepositories(integration.id);repoData.push({integration_id:integration.id,organization:integration.config?.account?.name||"GitHub",repositories:repos||[]})}actions.setAvailableRepos(repoData),actions.tryAutoSelectFirstIntegration()}},tryAutoSelectFirstIntegration:()=>{let config=values.currentConfig,onChange=values.onChangeCallback;if(onChange&&!config.integrationId&&values.githubIntegrations.length>0&&values.availableRepos.length>0){let firstIntegration=values.githubIntegrations[0],firstRepoData=values.availableRepos.find(r=>r.integration_id===firstIntegration.id);onChange({...config,integrationId:firstIntegration.id,organization:firstRepoData?.organization||firstIntegration.config?.account?.name||"GitHub",repository:firstRepoData?.repositories[0]||""})}}}})]);function RepositorySelector(_ref){let{value,onChange}=_ref,{githubRepositoriesLoading}=(0,index_esm.useValues)(integrationsLogic.a),{availableRepos,githubIntegrations}=(0,index_esm.useValues)(repositorySelectorLogic),{setOnChangeCallback,setCurrentConfig}=(0,index_esm.useActions)(repositorySelectorLogic);(0,react.useEffect)(()=>{setOnChangeCallback(onChange),setCurrentConfig(value)},[onChange,value,setOnChangeCallback,setCurrentConfig]);let selectedRepoData=availableRepos.find(r=>r.integration_id===value.integrationId);return 0===githubIntegrations.length?(0,jsx_runtime.jsx)(src.Mi,{className:"p-6 text-center",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{className:"mx-auto text-4xl text-muted"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"font-medium",children:"No GitHub Integration"}),(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm",children:"Connect a GitHub integration to enable repository selection."})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>window.open("/project/settings/environment-integrations","_blank"),children:"Configure GitHub Integration"})]})}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"GitHub Integration"}),(0,jsx_runtime.jsx)(src.Yv,{value:value.integrationId,onChange:integrationId=>{let integration=githubIntegrations.find(i=>i.id===integrationId),repoData=availableRepos.find(r=>r.integration_id===integrationId);onChange({...value,integrationId,organization:repoData?.organization||integration?.config?.account?.name||"GitHub",repository:repoData?.repositories[0]||""})},options:githubIntegrations.map(integration=>({value:integration.id,label:`${integration.display_name} (${integration.config?.account?.name||"GitHub"})`})),placeholder:"Select GitHub integration..."})]}),selectedRepoData&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Repository"}),(0,jsx_runtime.jsx)(src.Yv,{value:value.repository,onChange:repository=>onChange({...value,repository,organization:selectedRepoData.organization}),options:selectedRepoData.repositories.map(repo=>({value:repo,label:`${selectedRepoData.organization}/${repo}`})),placeholder:"Select repository..."})]}),githubRepositoriesLoading&&0===availableRepos.length&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-muted",children:[(0,jsx_runtime.jsx)(src.$j,{})," Loading repositories..."]})]})}function TaskCreateModal(_ref){let{isOpen,onClose}=_ref,{createTask}=(0,index_esm.useActions)(tasksLogic),[formData,setFormData]=(0,react.useState)({title:"",description:"",status:types.hY.BACKLOG,origin_product:types.Aw.USER_CREATED,repositoryConfig:{integrationId:void 0,organization:void 0,repository:void 0}}),[loading,setLoading]=(0,react.useState)(!1),[errors,setErrors]=(0,react.useState)({}),resetForm=()=>{setFormData({title:"",description:"",status:types.hY.BACKLOG,origin_product:types.Aw.USER_CREATED,repositoryConfig:{integrationId:void 0,organization:void 0,repository:void 0}})},handleSubmit=async()=>{let newErrors={};if(formData.title.trim()||(newErrors.title="Title is required"),formData.description.trim()||(newErrors.description="Description is required"),(formData.repositoryConfig.integrationId||formData.repositoryConfig.organization||formData.repositoryConfig.repository)&&(!formData.repositoryConfig.integrationId||!formData.repositoryConfig.organization||!formData.repositoryConfig.repository)&&(newErrors.repository="Please complete the repository configuration or leave it empty"),Object.keys(newErrors).length>0){setErrors(newErrors);return}setLoading(!0),setErrors({});try{let taskData={title:formData.title,description:formData.description,status:formData.status,origin_product:formData.origin_product,repository_config:{organization:formData.repositoryConfig.organization||"",repository:formData.repositoryConfig.repository||""}};formData.repositoryConfig.integrationId&&(taskData.github_integration=formData.repositoryConfig.integrationId),await createTask(taskData),resetForm(),onClose()}catch(error){console.error("Failed to create task:",error),setErrors({submit:"Failed to create task. Please try again."})}finally{setLoading(!1)}},handleCancel=()=>{resetForm(),setErrors({}),onClose()};return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isOpen,onClose:handleCancel,title:"Create New Task",width:800,footer:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:handleCancel,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:handleSubmit,loading:loading,disabled:loading,children:"Create Task"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[errors.submit&&(0,jsx_runtime.jsx)("div",{className:"bg-danger-3000 text-danger border border-danger rounded p-3 text-sm",children:errors.submit}),(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Title *"}),(0,jsx_runtime.jsx)(src.DF,{value:formData.title,onChange:value=>setFormData({...formData,title:value}),placeholder:"Enter task title...",status:errors.title?"danger":void 0}),errors.title&&(0,jsx_runtime.jsx)("p",{className:"text-danger text-xs mt-1",children:errors.title})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description *"}),(0,jsx_runtime.jsx)(src._V,{value:formData.description,onChange:value=>setFormData({...formData,description:value}),placeholder:"Describe the task in detail...",rows:4}),errors.description&&(0,jsx_runtime.jsx)("p",{className:"text-danger text-xs mt-1",children:errors.description})]}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Status"}),(0,jsx_runtime.jsx)(src.Yv,{value:formData.status,onChange:value=>setFormData({...formData,status:value}),options:[{value:types.hY.BACKLOG,label:"Backlog"},{value:types.hY.TODO,label:"To Do"},{value:types.hY.IN_PROGRESS,label:"In Progress"},{value:types.hY.TESTING,label:"Testing"},{value:types.hY.DONE,label:"Done"}]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Origin"}),(0,jsx_runtime.jsx)(src.Yv,{value:formData.origin_product,onChange:value=>setFormData({...formData,origin_product:value}),options:Object.entries(ORIGIN_PRODUCT_LABELS).map(_ref2=>{let[key,label]=_ref2;return{value:key,label}})})]})]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Repository Configuration"}),(0,jsx_runtime.jsx)(RepositorySelector,{value:formData.repositoryConfig,onChange:config=>setFormData({...formData,repositoryConfig:config})}),errors.repository&&(0,jsx_runtime.jsx)("p",{className:"text-danger text-xs mt-2",children:errors.repository})]})]})})}var LemonProgress=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonProgress/index.tsx"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts");function TaskProgressDisplay(_ref){let{task,className=""}=_ref,[progress,setProgress]=(0,react.useState)(null),[loading,setLoading]=(0,react.useState)(!0),[error,setError]=(0,react.useState)(null),[autoRefresh,setAutoRefresh]=(0,react.useState)(!0),fetchProgress=(0,react.useCallback)(async()=>{try{setError(null);let response=await api.ZP.get(`api/projects/@current/tasks/${task.id}/progress/`);setProgress(response),response.has_progress&&response.status&&[types.mN.STARTED,types.mN.IN_PROGRESS].includes(response.status)?setAutoRefresh(!0):setAutoRefresh(!1)}catch(err){console.error("Progress fetch error:",err);let errorMessage=err instanceof Error?err.message:"Failed to fetch progress";setError(`API Error: ${errorMessage}`),setAutoRefresh(!1)}finally{setLoading(!1)}},[task]);return((0,react.useEffect)(()=>{fetchProgress()},[task.id,fetchProgress]),(0,react.useEffect)(()=>{if(!autoRefresh)return;let interval=setInterval(fetchProgress,3e3);return()=>clearInterval(interval)},[autoRefresh,fetchProgress]),loading)?(0,jsx_runtime.jsxs)("div",{className:`${className} flex items-center gap-2 p-3 bg-bg-light rounded border`,children:[(0,jsx_runtime.jsx)(src.$j,{className:"w-4 h-4"}),(0,jsx_runtime.jsx)("span",{className:"text-sm text-muted",children:"Loading execution progress..."})]}):error?(0,jsx_runtime.jsx)("div",{className:`${className} p-3 bg-bg-light rounded border`,children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsxs)("span",{className:"text-sm text-danger",children:["Error: ",error]}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(icons.tr,{}),size:"xsmall",onClick:fetchProgress,children:"Retry"})]})}):progress?.has_progress?(0,jsx_runtime.jsxs)("div",{className:`${className} space-y-3`,children:[(task.github_branch||task.github_pr_url)&&(0,jsx_runtime.jsxs)("div",{className:"p-3 bg-bg-light rounded border",children:[(0,jsx_runtime.jsx)("h4",{className:"text-sm font-medium mb-2",children:"GitHub Integration"}),(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[task.github_branch&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"Branch:"}),(0,jsx_runtime.jsx)("code",{className:"px-2 py-1 bg-bg-dark rounded text-xs",children:task.github_branch})]}),task.github_pr_url&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"Pull Request:"}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{}),size:"xsmall",type:"primary",to:task.github_pr_url,targetBlank:!0,children:"View PR"})]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"p-3 bg-bg-light rounded border",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,jsx_runtime.jsx)("h4",{className:"text-sm font-medium",children:"Claude Code Execution"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsxs)("span",{className:(0,css_classes.cn)("text-sm",(status=>{switch(status){case types.mN.STARTED:case types.mN.IN_PROGRESS:return"text-primary";case types.mN.COMPLETED:return"text-success";case types.mN.FAILED:return"text-danger";default:return"text-muted"}})(progress.status)),children:[(status=>{switch(status){case types.mN.STARTED:case types.mN.IN_PROGRESS:return"⚡";case types.mN.COMPLETED:return"✅";case types.mN.FAILED:return"❌";default:return"⏸"}})(progress.status)," ",progress.status]}),autoRefresh&&(0,jsx_runtime.jsx)(src.$j,{className:"w-3 h-3"})]})]}),progress.total_steps&&progress.total_steps>0&&(0,jsx_runtime.jsxs)("div",{className:"mb-3",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between text-xs text-muted mb-1",children:[(0,jsx_runtime.jsx)("span",{children:"Progress"}),(0,jsx_runtime.jsxs)("span",{children:[progress.completed_steps,"/",progress.total_steps," steps"]})]}),progress.progress_percentage&&(0,jsx_runtime.jsx)(LemonProgress.b,{percent:progress.progress_percentage,strokeColor:progress.status===types.mN.FAILED?"var(--danger)":void 0})]}),progress.current_step&&(0,jsx_runtime.jsxs)("div",{className:"mb-3",children:[(0,jsx_runtime.jsx)("span",{className:"text-xs text-muted",children:"Current step:"}),(0,jsx_runtime.jsx)("div",{className:"text-sm font-medium",children:progress.current_step})]}),progress.error_message&&(0,jsx_runtime.jsxs)("div",{className:"mb-3 p-2 bg-danger-highlight rounded",children:[(0,jsx_runtime.jsx)("span",{className:"text-xs text-danger font-medium",children:"Error:"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-danger",children:progress.error_message})]}),progress.output_log&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-xs text-muted",children:"Live Output:"}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(icons.tr,{}),size:"xsmall",onClick:fetchProgress,loading:loading,children:"Refresh"})]}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-dark rounded p-3 max-h-64 overflow-y-auto",children:(0,jsx_runtime.jsx)("pre",{className:"text-xs text-default font-mono whitespace-pre-wrap",children:progress.output_log.split("\n").filter(line=>line.trim()).map((line,idx)=>(0,jsx_runtime.jsx)("div",{className:"mb-1",children:line},idx))})})]}),(0,jsx_runtime.jsx)("div",{className:"mt-3 pt-3 border-t border-border",children:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between text-xs text-muted",children:[(0,jsx_runtime.jsxs)("span",{children:["Started: ",progress.created_at?new Date(progress.created_at).toLocaleString():"Unknown"]}),progress.completed_at&&(0,jsx_runtime.jsxs)("span",{children:["Completed: ",new Date(progress.completed_at).toLocaleString()]})]})})]})]}):(0,jsx_runtime.jsx)("div",{className:`${className} p-3 bg-bg-light rounded border`,children:(0,jsx_runtime.jsx)("span",{className:"text-sm text-muted",children:"No Claude Code execution found for this task"})})}function TaskModal(_ref){let{task,onClose}=_ref,{scopeTask,updateTask}=(0,index_esm.useActions)(tasksLogic),[isEditingRepository,setIsEditingRepository]=(0,react.useState)(!1),[repositoryConfig,setRepositoryConfig]=(0,react.useState)({integrationId:task?.github_integration||void 0,organization:task?.repository_config?.organization||void 0,repository:task?.repository_config?.repository||void 0}),[savingRepository,setSavingRepository]=(0,react.useState)(!1),formatDate=dateString=>new Date(dateString).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),handleSaveRepository=async()=>{if(repositoryConfig.integrationId&&repositoryConfig.organization&&repositoryConfig.repository){setSavingRepository(!0);try{let updateData={github_integration:repositoryConfig.integrationId,repository_config:{organization:repositoryConfig.organization,repository:repositoryConfig.repository}};updateTask(task.id,updateData),setIsEditingRepository(!1)}catch(error){console.error("Failed to update repository:",error)}finally{setSavingRepository(!1)}}};return(0,jsx_runtime.jsx)(src.fQ,{isOpen:!0,onClose:onClose,title:task.title,width:600,children:(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-start",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${STATUS_COLORS[task.status]}`,children:STATUS_LABELS[task.status]}),(0,jsx_runtime.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${ORIGIN_PRODUCT_COLORS[task.origin_product]}`,children:ORIGIN_PRODUCT_LABELS[task.origin_product]})]}),(0,jsx_runtime.jsxs)("span",{className:"text-xs text-muted",children:["Position: ",task.position]})]}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold text-default mb-2",children:task.title})}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-sm font-medium text-default mb-2",children:"Description"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted leading-relaxed",children:task.description})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,jsx_runtime.jsx)("h3",{className:"text-sm font-medium text-default",children:"Repository Configuration"}),!isEditingRepository&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",onClick:()=>setIsEditingRepository(!0),children:"Edit"})]}),isEditingRepository?(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(RepositorySelector,{value:repositoryConfig,onChange:setRepositoryConfig}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"primary",size:"small",onClick:handleSaveRepository,loading:savingRepository,disabled:!repositoryConfig.integrationId||!repositoryConfig.organization||!repositoryConfig.repository,children:"Save"}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>{setRepositoryConfig({integrationId:task?.github_integration||void 0,organization:task?.repository_config?.organization||void 0,repository:task?.repository_config?.repository||void 0}),setIsEditingRepository(!1)},children:"Cancel"})]})]}):(0,jsx_runtime.jsx)("div",{className:"bg-bg-light p-3 rounded border",children:task.repository_config?.organization&&task.repository_config?.repository?(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"text-xs font-medium text-muted",children:"Repository:"}),(0,jsx_runtime.jsxs)("span",{className:"text-sm font-mono text-primary",children:[task.repository_config.organization,"/",task.repository_config.repository]})]}):(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted italic",children:"No repository configured - click Edit to add one"})})]}),[types.hY.IN_PROGRESS,types.hY.TESTING,types.hY.DONE].includes(task.status)&&(0,jsx_runtime.jsx)(TaskProgressDisplay,{task:task}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:"font-medium text-default",children:"Created:"}),(0,jsx_runtime.jsx)("div",{className:"text-muted",children:formatDate(task.created_at)})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:"font-medium text-default",children:"Last Updated:"}),(0,jsx_runtime.jsx)("div",{className:"text-muted",children:formatDate(task.updated_at)})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-border",children:[(0,jsx_runtime.jsx)("div",{children:task.status===types.hY.BACKLOG&&(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{scopeTask(task.id),onClose()},children:"Scope to Todo"})}),(0,jsx_runtime.jsx)(src.Jp,{onClick:onClose,children:"Close"})]})]})})}function BacklogView(){let{backlogTasks,selectedTask,isCreateModalOpen}=(0,index_esm.useValues)(tasksLogic),{scopeTask,openTaskModal,closeTaskModal,openCreateModal,closeCreateModal}=(0,index_esm.useActions)(tasksLogic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"Backlog"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3",children:[(0,jsx_runtime.jsxs)("span",{className:"text-sm text-muted",children:[backlogTasks.length," tasks"]}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:openCreateModal,children:"Create Task"})]})]}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:backlogTasks.map(task=>(0,jsx_runtime.jsx)(TaskCard,{task:task,onScope:scopeTask,onClick:openTaskModal},task.id))}),0===backlogTasks.length&&(0,jsx_runtime.jsx)("div",{className:"text-center py-8 text-muted",children:"No tasks in backlog"}),selectedTask&&(0,jsx_runtime.jsx)(TaskModal,{task:selectedTask,onClose:closeTaskModal}),(0,jsx_runtime.jsx)(TaskCreateModal,{isOpen:isCreateModalOpen,onClose:closeCreateModal})]})}var kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");function GitHubIntegrationSettings(){let{integrations,integrationsLoading,githubRepositoriesLoading,getGitHubRepositories}=(0,index_esm.useValues)(integrationsLogic.a),{loadIntegrations,loadGitHubRepositories}=(0,index_esm.useActions)(integrationsLogic.a),githubIntegration=integrations?.find(integration=>"github"===integration.kind),repositories=githubIntegration?getGitHubRepositories(githubIntegration.id):[];(0,react.useEffect)(()=>{loadIntegrations()},[loadIntegrations]),(0,react.useEffect)(()=>{githubIntegration&&loadGitHubRepositories(githubIntegration.id)},[githubIntegration,loadGitHubRepositories]);let handleManageIntegration=()=>{kea_router_lib.router.actions.push(urls.j.settings("environment-integrations"))};return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(icons.Uv,{className:"text-2xl"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"GitHub Integration"}),githubIntegration&&(0,jsx_runtime.jsx)(src.oe,{type:"success",children:"Connected"})]}),(0,jsx_runtime.jsx)(src.Mi,{className:"p-6",children:githubIntegration?(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("h3",{className:"font-medium",children:["Connected to ",githubIntegration.display_name]}),(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm",children:'Issues moved to "To Do" will automatically create branches and pull requests.'})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,jsx_runtime.jsxs)("h4",{className:"font-medium flex items-center gap-2",children:[(0,jsx_runtime.jsx)(icons.$M,{className:"text-lg"}),"Accessible Repositories"]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-1",children:[(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.tr,{}),onClick:()=>githubIntegration&&loadGitHubRepositories(githubIntegration.id),loading:githubRepositoriesLoading,tooltip:"Refresh repositories"}),(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.pF,{}),to:githubIntegration?.config?.installation_id?`https://github.com/settings/installations/${githubIntegration.config.installation_id}`:void 0,tooltip:"Manage repository access on GitHub"})]})]}),githubRepositoriesLoading?(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-muted text-sm",children:[(0,jsx_runtime.jsx)(src.$j,{className:"text-lg"}),"Loading repositories..."]}):repositories.length>0?(0,jsx_runtime.jsx)("div",{className:"space-y-1",children:repositories.map(repo=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-sm bg-accent-3000 rounded px-2 py-1",children:[(0,jsx_runtime.jsx)(icons.$M,{className:"text-muted"}),(0,jsx_runtime.jsxs)("span",{className:"font-mono",children:[githubIntegration.config?.account?.name||"GitHub","/",repo]})]},repo))}):(0,jsx_runtime.jsxs)("div",{className:"text-muted text-sm",children:[(0,jsx_runtime.jsx)("p",{children:"No repositories found."}),(0,jsx_runtime.jsx)("p",{className:"mt-1",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.pF,{}),to:githubIntegration?.config?.installation_id?`https://github.com/settings/installations/${githubIntegration.config.installation_id}`:void 0,children:"Configure repository access"})})]})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(icons.pF,{}),onClick:handleManageIntegration,children:"Manage Integration"})]}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"font-medium",children:"No GitHub integration"}),(0,jsx_runtime.jsx)("p",{className:"text-muted text-sm",children:"Connect GitHub to enable automatic branch creation and pull requests for issues."})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:handleManageIntegration,loading:integrationsLoading,children:"Connect GitHub"})]})})]})}var core_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@dnd-kit/core/dist/core.esm.js"),sortable_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+sortable@7.0.2_@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0__react@18.2.0/node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),utilities_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+utilities@3.2.1_react@18.2.0/node_modules/@dnd-kit/utilities/dist/utilities.esm.js");function DroppableContainer(_ref){let{children,disabled,id}=_ref,{setNodeRef,isOver}=(0,core_esm.Zj)({id,data:{type:"container"}});return(0,jsx_runtime.jsx)("div",{ref:disabled?void 0:setNodeRef,className:(0,css_classes.cn)("space-y-2 min-h-[200px] rounded-md",isOver&&"ring-2 ring-primary/40 bg-primary/5"),children:children})}function KanbanView(){let{tasks,kanbanColumns,selectedTask}=(0,index_esm.useValues)(tasksLogic),{openTaskModal,closeTaskModal,moveTask}=(0,index_esm.useActions)(tasksLogic),[items,setItems]=(0,react.useState)(kanbanColumns),[activeTask,setActiveTask]=(0,react.useState)(null),recentlyMovedToNewContainer=(0,react.useRef)(!1),containers=Object.keys(kanbanColumns),handleTaskClick=taskId=>{openTaskModal(taskId)},[clonedItems,setClonedItems]=(0,react.useState)(null),[dropIndicator,setDropIndicator]=(0,react.useState)({container:null,index:null}),sensors=(0,core_esm.Dy)((0,core_esm.VT)(core_esm.MA),(0,core_esm.VT)(core_esm.LO),(0,core_esm.VT)(core_esm.Lg,{coordinateGetter:sortable_esm.is})),findContainer=item=>isContainer(item)?item.id:tasks.find(t=>t.id===item.id)?.status;return(0,react.useEffect)(()=>{requestAnimationFrame(()=>{recentlyMovedToNewContainer.current=!1})},[items]),(0,react.useEffect)(()=>{activeTask||setItems(kanbanColumns)},[kanbanColumns,activeTask]),(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold",children:"Kanban Board"}),(0,jsx_runtime.jsx)(core_esm.LB,{sensors:sensors,collisionDetection:core_esm.ey,measuring:{droppable:{strategy:core_esm.uN.Always}},onDragStart:_ref2=>{let{active}=_ref2,task=tasks.find(t=>t.id===active.id);task&&(setActiveTask(task),setClonedItems(items))},onDragOver:_ref3=>{let{active,over,delta}=_ref3;if(!over)return;let activeContainer=findContainer(active),overContainer=findContainer(over);if(!activeContainer||!overContainer)return;let targetItems=items[overContainer],overId=String(over.id),overIndex=targetItems.findIndex(i=>i.id===overId),putBelowLast=overIndex===targetItems.length-1&&(delta?.y||0)>0;setDropIndicator({container:overContainer,index:overIndex>=0?overIndex+ +!!putBelowLast:targetItems.length})},onDragEnd:_ref4=>{let{active,over}=_ref4,activeContainer=findContainer(active);if(!activeContainer){setActiveTask(null);return}if(null==over){setActiveTask(null),setDropIndicator({container:null,index:null});return}let overContainer=findContainer(over);if(overContainer){let sourceItems=items[activeContainer],targetItems=items[overContainer],sourceIndex=sourceItems.findIndex(t=>t.id===active.id),overIndexRaw=targetItems.findIndex(t=>t.id===over.id);if(activeContainer===overContainer){let fallbackIndex=dropIndicator.container===overContainer&&null!=dropIndicator.index?dropIndicator.index:targetItems.length,finalIndex=overIndexRaw>=0?overIndexRaw:fallbackIndex;sourceIndex>=0&&null!=finalIndex&&sourceIndex!==finalIndex&&(setItems(current=>({...current,[overContainer]:(0,sortable_esm.Rp)(current[overContainer],sourceIndex,finalIndex)})),moveTask(String(active.id),overContainer,finalIndex))}else{let draggedTask=sourceIndex>=0?sourceItems[sourceIndex]:tasks.find(t=>t.id===active.id);if(!draggedTask){setActiveTask(null);return}let insertIndex=overIndexRaw>=0?overIndexRaw:dropIndicator.container===overContainer&&null!=dropIndicator.index?dropIndicator.index:targetItems.length;setItems(current=>({...current,[activeContainer]:current[activeContainer].filter(t=>t.id!==active.id),[overContainer]:[...current[overContainer].slice(0,insertIndex),{...draggedTask,status:overContainer},...current[overContainer].slice(insertIndex)]})),moveTask(String(active.id),overContainer,insertIndex)}}setActiveTask(null),setDropIndicator({container:null,index:null})},onDragCancel:()=>{clonedItems&&setItems(clonedItems),setActiveTask(null),setClonedItems(null)},children:(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-5 gap-4",children:containers.map(containerId=>{let isAgentOnly=![types.hY.TODO,types.hY.BACKLOG].includes(containerId);return(0,jsx_runtime.jsxs)("div",{className:(0,css_classes.cn)("bg-bg-light rounded-lg p-3 relative",isAgentOnly&&"opacity-75"),children:[isAgentOnly&&(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 bg-border/20 rounded-lg flex items-center justify-center pointer-events-none z-10",children:(0,jsx_runtime.jsx)("div",{className:"bg-bg-light border border-border rounded-lg px-3 py-2 shadow-lg",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted",children:[(0,jsx_runtime.jsx)("span",{className:"w-2 h-2 bg-warning rounded-full"}),"Agent Only"]})})}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,jsx_runtime.jsx)("h3",{className:"font-medium text-sm",children:"Column Title"}),(0,jsx_runtime.jsx)("span",{className:"text-xs text-muted bg-border rounded-full px-2 py-1",children:items[containerId].length})]}),(0,jsx_runtime.jsx)(DroppableContainer,{id:containerId,children:(0,jsx_runtime.jsxs)(sortable_esm.Fo,{items:items[containerId].map(t=>t.id),strategy:sortable_esm.qw,children:[items[containerId].map((task,idx)=>(0,jsx_runtime.jsxs)(react.Fragment,{children:[dropIndicator.container===containerId&&dropIndicator.index===idx&&(0,jsx_runtime.jsx)(DropIndicator,{}),(0,jsx_runtime.jsx)(SortableItem,{task:task,onClick:handleTaskClick},task.id)]},`row-${task.id}`)),dropIndicator.container===containerId&&dropIndicator.index===items[containerId].length&&(0,jsx_runtime.jsx)(DropIndicator,{})]})},containerId)]},containerId)})})}),selectedTask&&(0,jsx_runtime.jsx)(TaskModal,{task:selectedTask,onClose:closeTaskModal})]})}function SortableItem(_ref5){let{disabled,task,onClick}=_ref5,{setNodeRef,listeners,transform,attributes,transition,isDragging}=(0,sortable_esm.nB)({id:task.id,data:{status:task.status}});return(0,jsx_runtime.jsx)("div",{ref:disabled?void 0:setNodeRef,...listeners,...attributes,style:{transform:utilities_esm.ux.Translate.toString(transform),transition},className:(0,css_classes.cn)("cursor-grab active:cursor-grabbing",isDragging&&"opacity-50"),children:(0,jsx_runtime.jsx)(TaskCard,{task:task,draggable:!0,onClick:()=>onClick(task.id)})})}function isContainer(item){return!!(item.data.current&&"container"===item.data.current.type)}function DropIndicator(){return(0,jsx_runtime.jsxs)(src.Mi,{className:"p-3 my-1 border-2 border-dashed border-primary/50 bg-transparent pointer-events-none",children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-start mb-2",children:(0,jsx_runtime.jsx)("div",{className:"h-3 w-2/3 bg-border/60 rounded"})}),(0,jsx_runtime.jsx)("div",{className:"h-2 w-full bg-border/40 rounded mb-2"}),(0,jsx_runtime.jsx)("div",{className:"h-2 w-4/5 bg-border/40 rounded mb-3"}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"h-5 w-24 rounded-full bg-border/60"}),(0,jsx_runtime.jsx)("span",{className:"h-6 w-12 rounded bg-border/60"})]})]})}let scene={component:TaskTracker,logic:tasksLogic};function TaskTracker(){let{activeTab}=(0,index_esm.useValues)(tasksLogic),{setActiveTab}=(0,index_esm.useActions)(tasksLogic);if(!(0,useFeatureFlag.y)("TASKS"))return(0,jsx_runtime.jsx)(NotFound.T,{object:"Tasks",caption:"This feature is not enabled for your project."});let tabs=[{key:"backlog",label:"Backlog",content:(0,jsx_runtime.jsx)(BacklogView,{})},{key:"kanban",label:"Kanban Board",content:(0,jsx_runtime.jsx)(KanbanView,{})},{key:"settings",label:"Settings",content:(0,jsx_runtime.jsx)(GitHubIntegrationSettings,{})}];return(0,jsx_runtime.jsx)("div",{className:"TaskTracker",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h1",{className:"text-2xl font-bold",children:"Tasks"}),(0,jsx_runtime.jsx)("p",{className:"text-muted",children:"Manage and track development tasks across all PostHog products"})]}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeTab,onChange:setActiveTab,tabs:tabs,size:"medium"})]})})}},"../../products/tasks/frontend/types.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Aw:()=>OriginProduct,hY:()=>TaskStatus,mN:()=>ProgressStatus});let TaskStatus=function(TaskStatus){return TaskStatus.BACKLOG="backlog",TaskStatus.TODO="todo",TaskStatus.IN_PROGRESS="in_progress",TaskStatus.TESTING="testing",TaskStatus.DONE="done",TaskStatus}({}),OriginProduct=function(OriginProduct){return OriginProduct.ERROR_TRACKING="error_tracking",OriginProduct.EVAL_CLUSTERS="eval_clusters",OriginProduct.USER_CREATED="user_created",OriginProduct.SUPPORT_QUEUE="support_queue",OriginProduct}({}),ProgressStatus=function(ProgressStatus){return ProgressStatus.STARTED="started",ProgressStatus.IN_PROGRESS="in_progress",ProgressStatus.COMPLETED="completed",ProgressStatus.FAILED="failed",ProgressStatus}({})}}]);