"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[18780],{"../../frontend/src/scenes/web-analytics/SessionAttributionExplorer/SessionAttributionExplorerScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{GroupByFilter:()=>GroupByFilter,SessionAttributionExplorer:()=>SessionAttributionExplorer,SessionAttributionExplorerScene:()=>SessionAttributionExplorerScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.30.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),supportLogic=__webpack_require__("../../frontend/src/lib/components/Support/supportLogic.ts"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),SceneBreadcrumbs=__webpack_require__("../../frontend/src/layout/scenes/components/SceneBreadcrumbs.tsx"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),schema_guards=__webpack_require__("../../frontend/src/queries/schema-guards.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),common=__webpack_require__("../../frontend/src/scenes/web-analytics/common.ts");let initialProperties=[],initialGroupBy=[schema_general.Lm.Source,schema_general.Lm.Medium,schema_general.Lm.ChannelType,schema_general.Lm.ReferringDomain],defaultDateRange={date_from:"-7d",date_to:"now"},sessionAttributionExplorerLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","webAnalytics","sessionDebuggerLogic"]),(0,index_esm.connect)(()=>({values:[featureFlagLogic.featureFlagLogic,["featureFlags"]]})),(0,index_esm.actions)({setProperties:properties=>({properties}),setDateRange:dateRange=>({dateRange}),setStateFromUrl:state=>({state}),enableGroupBy:groupBy=>({groupBy}),disableGroupBy:groupBy=>({groupBy})}),(0,index_esm.reducers)({properties:[initialProperties,{setProperties:(_,_ref)=>{let{properties}=_ref;return properties},setStateFromUrl:(_,_ref2)=>{let{state}=_ref2;return state.properties}}],dateRange:[null,{setDateRange:(_,_ref3)=>{let{dateRange}=_ref3;return dateRange},setStateFromUrl:(_,_ref4)=>{let{state}=_ref4;return state.dateRange}}],groupBy:[initialGroupBy,{enableGroupBy:(state,_ref5)=>{let{groupBy}=_ref5;return Array.from(new Set([...state,groupBy]))},disableGroupBy:(state,_ref6)=>{let{groupBy}=_ref6;return state.filter(item=>item!==groupBy)}}]}),(0,index_esm.selectors)({query:[s=>[s.properties,s.dateRange,s.groupBy],(properties,dateRange,groupBy)=>{let source={kind:schema_general.OH.SessionAttributionExplorerQuery,groupBy:groupBy,filters:{properties,dateRange:null!=dateRange?dateRange:defaultDateRange},tags:common.Zt};return{kind:schema_general.OH.DataTableNode,source:source,showPropertyFilter:[types.t.SessionProperties],showDateRange:!0,showOpenEditorButton:!0,showReload:!0}}],breadcrumbs:[()=>[],()=>[{key:sceneTypes.x.WebAnalytics,name:"Web analytics",path:urls.j.webAnalytics()},{key:sceneTypes.x.SessionAttributionExplorer,name:"Session attribution explorer",path:urls.j.sessionAttributionExplorer()}]]}),(0,lib.actionToUrl)(_ref7=>{let{values}=_ref7,stateToUrl=()=>{let{properties,dateRange}=values,urlParams={};return properties.length>0&&(urlParams.properties=properties),dateRange&&(urlParams.dateRange=dateRange),[urls.j.sessionAttributionExplorer(),urlParams]};return{setProperties:stateToUrl,setDateRange:stateToUrl}}),(0,lib.urlToAction)(_ref8=>{let{actions}=_ref8;return{[urls.j.sessionAttributionExplorer()]:(_,_ref9)=>{let{properties,dateRange}=_ref9,parsedProperties=(0,schema_guards.aH)(properties)?properties:initialProperties;actions.setStateFromUrl({properties:parsedProperties,dateRange:null!=dateRange?dateRange:null})}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SessionAttributionExplorerScene(){return(0,jsx_runtime.jsx)(SessionAttributionExplorer,{})}let scene={component:SessionAttributionExplorerScene,logic:sessionAttributionExplorerLogic,settingSectionId:"environment-web-analytics"},ExpandableDataCell=_ref=>{let{value}=_ref,[isExpanded,setIsExpanded]=react.useState(!1);return null==value||Array.isArray(value)&&0===value.length?(0,jsx_runtime.jsx)(Tooltip.u,{title:"NULL",children:(0,jsx_runtime.jsx)("span",{"aria-hidden":!0,className:"cursor-default",children:"â€”"})}):Array.isArray(value)?(0,jsx_runtime.jsxs)("div",{className:"flex flex-row",children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)(LemonButton.J,{active:isExpanded,onClick:()=>{setIsExpanded(!isExpanded)},icon:isExpanded?(0,jsx_runtime.jsx)(posthog_icons_es.IconCollapse,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand,{}),title:isExpanded?"Show less":"Show more",size:"small"})})}),(0,jsx_runtime.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-1",children:isExpanded?(0,jsx_runtime.jsx)("ul",{className:"flex-1 flex flex-col",children:value.map(url=>(0,jsx_runtime.jsx)("li",{className:"flex-1 mb-1 break-all",children:url},url))}):value[0]})})]}):(0,jsx_runtime.jsx)("div",{children:value})},queryContext={columns:{channel_type:{title:"Channel type",render:ExpandableDataCell},count:{title:"Session count",align:"right"},referring_domain:{title:"Referring domain",render:ExpandableDataCell},utm_source:{title:"UTM source",render:ExpandableDataCell},utm_medium:{title:"UTM medium",render:ExpandableDataCell},utm_campaign:{title:"UTM campaign",render:ExpandableDataCell},ad_ids:{title:"Ad IDs",render:ExpandableDataCell},example_entry_urls:{title:"Example entry URLs",render:ExpandableDataCell}},emptyStateHeading:"There are no matching sessions for this query",emptyStateDetail:"Try changing the date range, or changing the property filters."},groupByOptions=[{label:"Channel type",value:schema_general.Lm.ChannelType},{label:"Referring domain",value:schema_general.Lm.ReferringDomain},{label:"UTM source",value:schema_general.Lm.Source},{label:"UTM medium",value:schema_general.Lm.Medium},{label:"UTM campaign",value:schema_general.Lm.Campaign},{label:"Ad IDs",value:schema_general.Lm.AdIds},{label:"Entry URL",value:schema_general.Lm.InitialURL}],GroupByFilter=()=>{let{groupBy}=(0,index_esm.useValues)(sessionAttributionExplorerLogic),{enableGroupBy,disableGroupBy}=(0,index_esm.useActions)(sessionAttributionExplorerLogic);return(0,jsx_runtime.jsx)("div",{className:"mb-2",children:(0,jsx_runtime.jsx)(src.d6,{items:groupByOptions.map(_ref2=>{let{label,value}=_ref2;return{label:()=>(0,jsx_runtime.jsx)(src.f4,{checked:groupBy.includes(value),onChange:val=>{val?enableGroupBy(value):disableGroupBy(value)},fullWidth:!0,label:label})}}),closeOnClickInside:!1,children:(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),size:"small",type:"secondary",children:"Group by"})})})};function SessionAttributionExplorer(){let{query}=(0,index_esm.useValues)(sessionAttributionExplorerLogic),{setDateRange,setProperties}=(0,index_esm.useActions)(sessionAttributionExplorerLogic),{preflight}=(0,index_esm.useValues)(preflightLogic.preflightLogic),{openSupportForm}=(0,index_esm.useActions)(supportLogic.Pw),showSupportOptions=preflight?.cloud;return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(SceneBreadcrumbs.A,{}),(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",className:"my-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center flex-wrap gap-2 justify-between",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1 min-w-full sm:min-w-0",children:[(0,jsx_runtime.jsxs)("p",{children:["You can use the Session attribution explorer (beta) to understand how your sessions are attributed. We use the referring domain, ",(0,jsx_runtime.jsx)("code",{children:"utm_source"}),", ",(0,jsx_runtime.jsx)("code",{children:"utm_medium"}),","," ",(0,jsx_runtime.jsx)("code",{children:"utm_campaign"}),", and the presence of advertising ids like ",(0,jsx_runtime.jsx)("code",{children:"gclid"})," and"," ",(0,jsx_runtime.jsx)("code",{children:"gad_source"}),", to assign a session a"," ",(0,jsx_runtime.jsx)(Link.r,{to:"https://posthog.com/docs/data/channel-type",children:"Channel type"}),"."]}),(0,jsx_runtime.jsxs)("p",{children:["If you believe that a session is attributed incorrectly, please let us know! If you'd like to customize your Channel attribution, please leave feedback on the"," ",(0,jsx_runtime.jsx)(Link.r,{to:"https://github.com/PostHog/posthog/issues/21195",children:"feature request"}),"."]})]}),showSupportOptions?(0,jsx_runtime.jsx)("span",{className:"flex items-center gap-2",children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",icon:(0,jsx_runtime.jsx)(icons.Rz,{}),onClick:()=>openSupportForm({kind:"feedback",isEmailFormOpen:!0,target_area:"web_analytics"}),children:"Give feedback"})}):null]})}),(0,jsx_runtime.jsx)(GroupByFilter,{}),(0,jsx_runtime.jsx)(Query.A,{context:queryContext,query:query,setQuery:query=>{var _source$filters$dateR;let source=query.source;source.filters&&(0,schema_guards.aH)(source.filters.properties)?setProperties(source.filters.properties):setProperties([]),setDateRange(null!==(_source$filters$dateR=source.filters?.dateRange)&&void 0!==_source$filters$dateR?_source$filters$dateR:null)}})]})}}}]);