"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[36229],{"./frontend/src/scenes/surveys/Surveys.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Surveys:function(){return Surveys},SurveysTabs:function(){return SurveysTabs},scene:function(){return scene}});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),lib_utils_stringWithWBR__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/utils/stringWithWBR.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/urls.ts"),_surveysLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/surveys/surveysLogic.tsx"),lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),_types__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/types.ts"),kea__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_lemon_ui_LemonTabs__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),react__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),lib_components_ProductIntroduction_ProductIntroduction__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.tsx"),lib_dayjs__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./frontend/src/lib/dayjs.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const scene={component:Surveys,logic:_surveysLogic__WEBPACK_IMPORTED_MODULE_5__.k};let SurveysTabs=function(SurveysTabs){return SurveysTabs.All="all",SurveysTabs.Yours="yours",SurveysTabs.Archived="archived",SurveysTabs}({});function Surveys(){const{nonArchivedSurveys:nonArchivedSurveys,archivedSurveys:archivedSurveys,surveys:surveys,surveysLoading:surveysLoading}=(0,kea__WEBPACK_IMPORTED_MODULE_8__.useValues)(_surveysLogic__WEBPACK_IMPORTED_MODULE_5__.k),{deleteSurvey:deleteSurvey,updateSurvey:updateSurvey}=(0,kea__WEBPACK_IMPORTED_MODULE_8__.useActions)(_surveysLogic__WEBPACK_IMPORTED_MODULE_5__.k),{user:user}=(0,kea__WEBPACK_IMPORTED_MODULE_8__.useValues)(scenes_userLogic__WEBPACK_IMPORTED_MODULE_13__.userLogic),[tab,setSurveyTab]=(0,react__WEBPACK_IMPORTED_MODULE_11__.useState)(SurveysTabs.All),shouldShowEmptyState=!surveysLoading&&0===surveys.length;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{className:"mt-10",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_1__.m,{title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{className:"flex items-center gap-2",children:["Surveys",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTag,{type:"warning",className:"uppercase",children:"Beta"})]}),buttons:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{type:"primary",to:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.survey("new"),"data-attr":"new-survey",children:"New survey"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_LemonTabs__WEBPACK_IMPORTED_MODULE_10__.T,{activeKey:tab,onChange:newTab=>setSurveyTab(newTab),tabs:[{key:SurveysTabs.All,label:"All surveys"},{key:SurveysTabs.Archived,label:"Archived surveys"}]}),surveysLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_LemonSkeleton__WEBPACK_IMPORTED_MODULE_14__.y,{}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(shouldShowEmptyState||!user?.has_seen_product_intro_for?.[_types__WEBPACK_IMPORTED_MODULE_7__.Md.SURVEYS])&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_components_ProductIntroduction_ProductIntroduction__WEBPACK_IMPORTED_MODULE_12__.C,{productName:"Surveys",thingName:"survey",description:"Use surveys to gather qualitative feedback from your users on new or existing features.",action:()=>kea_router__WEBPACK_IMPORTED_MODULE_9__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.survey("new")),isEmpty:0===surveys.length,productKey:_types__WEBPACK_IMPORTED_MODULE_7__.Md.SURVEYS}),!shouldShowEmptyState&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTable,{className:"mt-6",columns:[{dataIndex:"name",title:"Name",render:function RenderName(_,survey){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Link,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.survey(survey.id),className:"row-name",children:(0,lib_utils_stringWithWBR__WEBPACK_IMPORTED_MODULE_3__.Z)(survey.name,17)})})}},{dataIndex:"type",title:"Type"},(0,lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_6__.J)(),(0,lib_lemon_ui_LemonTable_columnUtils__WEBPACK_IMPORTED_MODULE_6__.r)(),{title:"Status",width:100,render:function Render(_,survey){const status=(0,_surveysLogic__WEBPACK_IMPORTED_MODULE_5__.z)(survey);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTag,{type:{running:"success",draft:"default",complete:"completion"}[status],style:{fontWeight:600},children:status.toUpperCase()})}},{width:0,render:function Render(_,survey){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_LemonButton_More__WEBPACK_IMPORTED_MODULE_2__.T,{overlay:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{status:"stealth",fullWidth:!0,onClick:()=>kea_router__WEBPACK_IMPORTED_MODULE_9__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.survey(survey.id)),children:"View"}),!survey.start_date&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{status:"stealth",fullWidth:!0,onClick:()=>updateSurvey({id:survey.id,updatePayload:{start_date:(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_15__.Bv)().toISOString()}}),children:"Launch survey"}),survey.start_date&&!survey.end_date&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{status:"stealth",fullWidth:!0,onClick:()=>updateSurvey({id:survey.id,updatePayload:{end_date:(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_15__.Bv)().toISOString()}}),children:"Stop survey"}),survey.end_date&&!survey.archived&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{status:"stealth",fullWidth:!0,onClick:()=>updateSurvey({id:survey.id,updatePayload:{end_date:null}}),children:"Resume survey"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonDivider,{}),survey.end_date&&survey.archived&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{status:"stealth",fullWidth:!0,onClick:()=>updateSurvey({id:survey.id,updatePayload:{archived:!1}}),children:"Unarchive"}),survey.end_date&&!survey.archived&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{status:"stealth",fullWidth:!0,onClick:()=>updateSurvey({id:survey.id,updatePayload:{archived:!0}}),children:"Archive"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{status:"danger",onClick:()=>deleteSurvey(survey.id),fullWidth:!0,children:"Delete"})]})})}}],dataSource:tab===SurveysTabs.Archived?archivedSurveys:nonArchivedSurveys,defaultSorting:{columnKey:"created_at",order:-1},nouns:["survey","surveys"],"data-attr":"surveys-table",emptyState:"No surveys. Create a new survey?"})]})]})}},"./frontend/src/scenes/surveys/surveysLogic.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{k:function(){return surveysLogic},z:function(){return getSurveyStatus}});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/types.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/urls.ts"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/userLogic.ts");function getSurveyStatus(survey){return survey.start_date?survey.end_date?_types__WEBPACK_IMPORTED_MODULE_3__.mN.Complete:_types__WEBPACK_IMPORTED_MODULE_3__.mN.Running:_types__WEBPACK_IMPORTED_MODULE_3__.mN.Draft}const surveysLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","surveys","surveysLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)([scenes_userLogic__WEBPACK_IMPORTED_MODULE_6__.userLogic]),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)((_ref=>{let{values:values}=_ref;return{surveys:{__default:[],loadSurveys:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.surveys.list()).results,deleteSurvey:async id=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.surveys.delete(id),values.surveys.filter((survey=>survey.id!==id))),updateSurvey:async _ref2=>{let{id:id,updatePayload:updatePayload}=_ref2;const updatedSurvey=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.surveys.update(id,{...updatePayload});return values.surveys.map((survey=>survey.id===id?updatedSurvey:survey))}}}})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((()=>({deleteSurveySuccess:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.lemonToast.success("Survey deleted")},updateSurveySuccess:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.lemonToast.success("Survey updated")}}))),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{name:"Surveys",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.surveys()}]],nonArchivedSurveys:[s=>[s.surveys],surveys=>surveys.filter((survey=>!survey.archived))],archivedSurveys:[s=>[s.surveys],surveys=>surveys.filter((survey=>survey.archived))],whitelabelAvailable:[()=>[scenes_userLogic__WEBPACK_IMPORTED_MODULE_6__.userLogic.selectors.user],user=>(user?.organization?.available_features||[]).includes(_types__WEBPACK_IMPORTED_MODULE_3__.P$.WHITE_LABELLING)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((async _ref3=>{let{actions:actions}=_ref3;await actions.loadSurveys()}))]);try{getSurveyStatus.displayName="getSurveyStatus",getSurveyStatus.__docgenInfo={description:"",displayName:"getSurveyStatus",props:{id:{defaultValue:null,description:"UUID",name:"id",required:!0,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"popover"'},{value:'"button"'},{value:'"full_screen"'},{value:'"email"'},{value:'"api"'}]}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"string"}},linked_flag_id:{defaultValue:null,description:"",name:"linked_flag_id",required:!0,type:{name:"number | null"}},linked_flag:{defaultValue:null,description:"",name:"linked_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag:{defaultValue:null,description:"",name:"targeting_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag_filters:{defaultValue:null,description:"",name:"targeting_flag_filters",required:!0,type:{name:'Pick<FeatureFlagFilters, "groups"> | undefined'}},conditions:{defaultValue:null,description:"",name:"conditions",required:!0,type:{name:"{ url: string; selector: string; is_headless?: boolean | undefined; } | null"}},appearance:{defaultValue:null,description:"",name:"appearance",required:!0,type:{name:"SurveyAppearance"}},questions:{defaultValue:null,description:"",name:"questions",required:!0,type:{name:"(BasicSurveyQuestion | LinkSurveyQuestion | RatingSurveyQuestion | MultipleSurveyQuestion)[]"}},created_at:{defaultValue:null,description:"",name:"created_at",required:!0,type:{name:"string"}},created_by:{defaultValue:null,description:"",name:"created_by",required:!0,type:{name:"UserBasicType | null"}},start_date:{defaultValue:null,description:"",name:"start_date",required:!0,type:{name:"string | null"}},end_date:{defaultValue:null,description:"",name:"end_date",required:!0,type:{name:"string | null"}},archived:{defaultValue:null,description:"",name:"archived",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveysLogic.tsx#getSurveyStatus"]={docgenInfo:getSurveyStatus.__docgenInfo,name:"getSurveyStatus",path:"frontend/src/scenes/surveys/surveysLogic.tsx#getSurveyStatus"})}catch(__react_docgen_typescript_loader_error){}}}]);