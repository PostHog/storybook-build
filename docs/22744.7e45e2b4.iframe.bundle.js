"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[22744],{"../../frontend/src/scenes/pipeline/PipelinePluginConfiguration.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>PipelinePluginConfiguration});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.21.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonMarkdown=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMarkdown/index.ts"),CodeEditor=__webpack_require__("../../frontend/src/lib/monaco/CodeEditor.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),AutoSizer=__webpack_require__("../../node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),configUtils=__webpack_require__("../../frontend/src/scenes/pipeline/configUtils.ts"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),types=__webpack_require__("../../frontend/src/types.ts"),destinations_constants=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/constants.ts"),destinationsLogic=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/destinationsLogic.tsx"),frontendAppsLogic=__webpack_require__("../../frontend/src/scenes/pipeline/frontendAppsLogic.tsx"),importAppsLogic=__webpack_require__("../../frontend/src/scenes/pipeline/importAppsLogic.tsx"),pipelineAccessLogic=__webpack_require__("../../frontend/src/scenes/pipeline/pipelineAccessLogic.tsx"),transformationsLogic=__webpack_require__("../../frontend/src/scenes/pipeline/transformationsLogic.tsx"),utils=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");function getConfigurationFromPluginConfig(pluginConfig){return{...pluginConfig.config,enabled:pluginConfig.enabled,order:pluginConfig.order,name:pluginConfig.name?pluginConfig.name:pluginConfig.plugin_info.name,description:pluginConfig.description?pluginConfig.description:pluginConfig.plugin_info.description||""}}function getDefaultConfiguration(plugin){return{...(0,configUtils.NM)(plugin),enabled:!1,name:plugin.name,description:plugin.description}}let pipelinePluginConfigurationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{pluginId,pluginConfigId}=_ref;return pluginConfigId?`ID:${pluginConfigId}`:`NEW:${pluginId}`}),(0,index_esm.path)(id=>["scenes","pipeline","pipelinePluginConfigurationLogic",id]),(0,index_esm.connect)(()=>({values:[teamLogic.teamLogic,["currentTeamId"],transformationsLogic.P,["plugins as transformationPlugins","nextAvailableOrder"],featureFlagLogic.featureFlagLogic,["featureFlags"],pipelineAccessLogic.g,["canEnableNewDestinations"]]})),(0,kea_loaders_lib.loaders)(_ref2=>{let{props,values}=_ref2;return{pluginFromPluginId:[null,{loadPlugin:async()=>{if(!props.pluginId)return null;let plugins={};return props.stage===types.We.Transformation?plugins=await (0,utils.c$)("api/organizations/@current/pipeline_transformations"):props.stage===types.We.Destination&&(plugins=await (0,utils.c$)("api/organizations/@current/pipeline_destinations")),plugins[props.pluginId]||api.ZP.get(`api/organizations/@current/plugins/${props.pluginId}`)}}],pluginConfig:[null,{loadPluginConfig:async()=>props.pluginConfigId?await api.ZP.pluginConfigs.get(props.pluginConfigId):null,updatePluginConfig:async formdata=>{if(!values.plugin||!props.stage)return null;if((!values.pluginConfig||!values.pluginConfig.enabled&&formdata.enabled)&&props.stage===types.We.Destination&&!values.canEnableNewDestinations)return src.UJ.error("Data pipelines add-on is required for enabling new destinations."),values.pluginConfig;let{enabled,order,name,description,...config}=formdata,formData=(0,configUtils.Ge)(values.plugin.config_schema,(0,configUtils.NM)(values.plugin),config);formData.append("enabled",enabled),formData.append("name",name),formData.append("description",description);let orderFixed=enabled&&values.pluginConfig&&!values.pluginConfig.enabled?values.nextAvailableOrder:order||0;if(formData.append("order",orderFixed),props.pluginConfigId)return await api.ZP.pluginConfigs.update(props.pluginConfigId,formData);formData.append("plugin",values.plugin.id.toString());let res=await api.ZP.pluginConfigs.create(formData);return kea_router_lib.router.actions.replace(urls.j.pipelineNode(props.stage,res.id,types.il.Configuration)),res},migrateToHogFunction:async()=>{if(!props.pluginConfigId)return null;let hogFunction=await api.ZP.pluginConfigs.migrate(props.pluginConfigId);return kea_router_lib.router.actions.replace(urls.j.pipelineNode(types.We.Destination,`hog-${hogFunction.id}`)),values.pluginConfig}}]}}),(0,index_esm.listeners)(_ref3=>{let{props,actions,values}=_ref3;return{updatePluginConfigSuccess:_ref4=>{let{pluginConfig}=_ref4;pluginConfig&&(actions.resetConfiguration(values.configuration),props.stage===types.We.Transformation?transformationsLogic.P.findMounted()?.actions.updatePluginConfig(pluginConfig):props.stage===types.We.Destination?destinationsLogic.w.findMounted({types:destinations_constants.SO})?.actions.updatePluginConfig(pluginConfig):props.stage===types.We.SiteApp?values.featureFlags[constants.y8.SITE_APP_FUNCTIONS]?destinationsLogic.w.findMounted({types:destinations_constants.hz})?.actions.updatePluginConfig(pluginConfig):frontendAppsLogic.$.findMounted()?.actions.updatePluginConfig(pluginConfig):props.stage===types.We.ImportApp&&importAppsLogic.c.findMounted()?.actions.updatePluginConfig(pluginConfig))}}}),(0,index_esm.reducers)(()=>({configuration:[{},{loadPluginSuccess:(state,_ref5)=>{let{pluginFromPluginId}=_ref5;return Object.keys(state).length>0||!pluginFromPluginId?state:getDefaultConfiguration(pluginFromPluginId)},loadPluginConfigSuccess:(state,_ref6)=>{let{pluginConfig}=_ref6;return pluginConfig?getConfigurationFromPluginConfig(pluginConfig):state},updatePluginConfigSuccess:(state,_ref7)=>{let{pluginConfig}=_ref7;return pluginConfig?getConfigurationFromPluginConfig(pluginConfig):state}}]})),(0,index_esm.selectors)(()=>({plugin:[s=>[s.pluginFromPluginId,s.pluginConfig],(pluginFromId,pluginConfig)=>pluginConfig?.plugin_info||pluginFromId],loading:[s=>[s.pluginFromPluginIdLoading,s.pluginConfigLoading],(pluginLoading,pluginConfigLoading)=>pluginLoading||pluginConfigLoading],savedConfiguration:[s=>[s.pluginConfig,s.plugin],(pluginConfig,plugin)=>pluginConfig&&plugin?pluginConfig?getConfigurationFromPluginConfig(pluginConfig):plugin?getDefaultConfiguration(plugin):void 0:{}],requiredFields:[s=>[s.plugin,s.configuration],(plugin,configuration)=>plugin&&configuration?(0,configUtils.fY)(fieldName=>configuration[fieldName],plugin):[]],hiddenFields:[s=>[s.plugin,s.configuration],(plugin,configuration)=>plugin&&configuration?(0,configUtils.zl)(fieldName=>configuration[fieldName],plugin):[]],isNew:[(_,p)=>[p.pluginConfigId],pluginConfigId=>!pluginConfigId],stage:[(_,p)=>[p.stage],stage=>stage]})),(0,lib.forms)(_ref8=>{let{asyncActions,values}=_ref8;return{configuration:{errors:formdata=>Object.fromEntries(values.requiredFields.map(field=>[field,formdata[field]?void 0:"This field is required"])),submit:async formdata=>{await asyncActions.updatePluginConfig(formdata)}}}}),(0,kea_router_lib.beforeUnload)(_ref9=>{let{actions,values}=_ref9;return{enabled:()=>values.configurationChanged,message:"Leave action?\nChanges you made will be discarded.",onConfirm:()=>{actions.resetConfiguration()}}}),(0,index_esm.afterMount)(_ref10=>{let{props,actions}=_ref10;props.pluginConfigId?actions.loadPluginConfig():props.pluginId&&actions.loadPlugin()})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelinePluginConfiguration(_ref){let{stage,pluginId,pluginConfigId}=_ref,logicProps={stage:stage,pluginId:pluginId||null,pluginConfigId:pluginConfigId||null},logic=pipelinePluginConfigurationLogic(logicProps),{plugin,isNew,isConfigurationSubmitting,savedConfiguration,hiddenFields,requiredFields,loading,configurationChanged}=(0,index_esm.useValues)(logic),{submitConfiguration,resetConfiguration,migrateToHogFunction}=(0,index_esm.useActions)(logic);if(!stage)return(0,jsx_runtime.jsx)(NotFound.T,{object:"pipeline stage"});if(loading&&!plugin)return(0,jsx_runtime.jsx)(src.t2,{});if(!plugin)return(0,jsx_runtime.jsx)(NotFound.T,{object:`pipeline ${stage}`});let loadingOrSubmitting=loading||isConfigurationSubmitting,fields=(0,configUtils.fN)(plugin.config_schema).map((fieldConfig,index)=>(0,jsx_runtime.jsx)(react.Fragment,{children:fieldConfig.key&&fieldConfig.type&&(0,configUtils.Zs)(fieldConfig)&&!hiddenFields.includes(fieldConfig.key)?(0,jsx_runtime.jsx)(LemonField.D,{name:fieldConfig.key,label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[fieldConfig.secret&&(0,jsx_runtime.jsx)(src.u,{placement:"top-start",title:"This field is write-only. Its value won't be visible after saving.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconLock,{})}),fieldConfig.markdown&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{children:fieldConfig.markdown}),fieldConfig.name||fieldConfig.key]}),help:fieldConfig.hint&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"mt-0.5",children:fieldConfig.hint}),showOptional:!requiredFields.includes(fieldConfig.key),children:(0,jsx_runtime.jsx)(PluginField,{fieldConfig:fieldConfig,disabled:loadingOrSubmitting})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:fieldConfig.type?(0,jsx_runtime.jsxs)("p",{className:"text-danger",children:["Invalid config field ",(0,jsx_runtime.jsx)("i",{children:fieldConfig.name||fieldConfig.key}),"."]}):null})},fieldConfig.key||`__key__${index}`)),buttons=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",htmlType:"reset",onClick:()=>resetConfiguration(savedConfiguration||{}),disabledReason:configurationChanged?isConfigurationSubmitting?"Saving in progressâ€¦":void 0:"No changes",children:"Clear changes"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",htmlType:"submit",onClick:submitConfiguration,loading:isConfigurationSubmitting,children:isNew?"Create":"Save"})]});return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-3",children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:buttons}),plugin?.hog_function_migration_available&&(0,jsx_runtime.jsxs)(src.Vp,{type:"error",action:{children:"Upgrade to new version",onClick:()=>src.dn.open({title:"Upgrade destination",width:"30rem",description:"This will create a new Destination in the upgraded system. The old destination will be disabled and can later be deleted. In addition there may be slight differences in the configuration options that you can choose to modify.",secondaryButton:{type:"secondary",children:"Cancel"},primaryButton:{type:"primary",onClick:()=>migrateToHogFunction(),children:"Upgrade"}}),disabled:loading},children:[(0,jsx_runtime.jsx)("b",{children:"New version available!"})," This destination is part of our legacy system. Click to upgrade."]}),(0,jsx_runtime.jsx)(lib.Form,{logic:pipelinePluginConfigurationLogic,props:logicProps,formKey:"configuration",className:"deprecated-space-y-3",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4 items-start",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 gap-4 min-w-100",children:[(0,jsx_runtime.jsxs)("div",{className:"p-3 rounded border bg-surface-primary deprecated-space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 items-center min-h-16",children:[(0,jsx_runtime.jsx)(utils.Wf,{plugin:plugin,imageSize:"medium"}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 py-1",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row gap-1 items-center text-sm font-semibold",children:plugin.name}),plugin.description?(0,jsx_runtime.jsx)("div",{className:"mt-1 text-xs text-text-3000 text-tertiary",children:(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"max-w-[30rem]",lowKeyHeadings:!0,children:plugin.description})}):null]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"enabled",children:_ref2=>{let{value,onChange}=_ref2;return(0,jsx_runtime.jsx)(src.f4,{label:"Enabled",onChange:()=>onChange(!value),checked:value,disabled:loadingOrSubmitting,bordered:!0})}})]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",info:"Customising the name can be useful if multiple instances of the same type are used.",children:(0,jsx_runtime.jsx)(src.DF,{type:"text",disabled:loadingOrSubmitting})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"description",label:"Description",info:"Add a description to share context with other team members",children:(0,jsx_runtime.jsx)(src._V,{disabled:loadingOrSubmitting})})]})," "]}),(0,jsx_runtime.jsxs)("div",{className:"flex-2 min-w-100 deprecated-space-y-4",children:[(0,jsx_runtime.jsx)("div",{className:"p-3 rounded border bg-surface-primary deprecated-space-y-2",children:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:fields.length?fields:(0,jsx_runtime.jsx)("span",{className:"italic text-secondary",children:"This app does not have specific configuration options"})})}),(0,jsx_runtime.jsx)("div",{className:"flex gap-2 justify-end",children:buttons})]})]})})]})}function PluginField(_ref3){let{value,onChange,fieldConfig,disabled}=_ref3,[editingSecret,setEditingSecret]=(0,react.useState)(!1);return fieldConfig.secret&&!editingSecret&&value&&(value===configUtils.ue||value.name===configUtils.ue)?(0,jsx_runtime.jsxs)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{}),onClick:()=>{onChange?.(fieldConfig.default||""),setEditingSecret(!0)},disabled:disabled,children:["Reset secret ","attachment"===fieldConfig.type?"attachment":"field"]}):"attachment"===fieldConfig.type?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[value?.name?(0,jsx_runtime.jsxs)("span",{children:["Selected file: ",value.name]}):null,(0,jsx_runtime.jsx)(src.mH,{accept:"*",multiple:!1,onChange:files=>onChange?.(files[0]),value:value?.size?[value]:[],showUploadedFiles:!1})]}):"string"===fieldConfig.type?(0,jsx_runtime.jsx)(src.DF,{value:value,onChange:onChange,autoFocus:editingSecret,className:"ph-no-capture",disabled:disabled}):"json"===fieldConfig.type?(0,jsx_runtime.jsx)(JsonConfigField,{value:value,onChange:onChange,autoFocus:editingSecret,className:"ph-no-capture"}):"choice"===fieldConfig.type?(0,jsx_runtime.jsx)(src.Yv,{fullWidth:!0,value:value,className:"ph-no-capture",onChange:onChange,options:fieldConfig.choices.map(choice=>({label:choice,value:choice})),disabled:disabled}):(0,jsx_runtime.jsxs)("strong",{className:"text-danger",children:['Unknown field type "',(0,jsx_runtime.jsx)("code",{children:fieldConfig.type}),'".',(0,jsx_runtime.jsx)("br",{}),"You may need to upgrade PostHog!"]})}function JsonConfigField(props){return(0,jsx_runtime.jsx)(AutoSizer.q,{disableWidth:!0,className:"min-h-60",children:_ref4=>{let{height}=_ref4;return(0,jsx_runtime.jsx)(CodeEditor.p,{className:"border",language:"json",value:props.value,onChange:v=>props.onChange?.(null!=v?v:""),height:height,options:{minimap:{enabled:!1}}})}})}},"../../frontend/src/scenes/pipeline/frontendAppsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>frontendAppsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/projectLogic.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");let frontendAppsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","frontendAppsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__.K,["currentProjectId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_frontend_apps")}],pluginConfigs:[{},{loadPluginConfigs:async()=>Object.fromEntries((await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentProjectId}/pipeline_frontend_apps_configs`)).map(pluginConfig=>[pluginConfig.id,pluginConfig])),toggleEnabled:async _ref2=>{let{id,enabled}=_ref2;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.SiteApp,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref3=>{let{pluginConfig}=_ref3;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],frontendApps:[s=>[s.plugins,s.pluginConfigs],(plugins,pluginConfigs)=>Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})).map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.SiteApp)).sort((a,b)=>Number(b.enabled)-Number(a.enabled))]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadPlugins(),actions.loadPluginConfigs()})])},"../../frontend/src/scenes/pipeline/importAppsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>importAppsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/projectLogic.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");let importAppsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","importAppsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__.K,["currentProjectId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_import_apps")}],pluginConfigs:[{},{loadPluginConfigs:async()=>Object.fromEntries((await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentProjectId}/pipeline_import_apps_configs`)).map(pluginConfig=>[pluginConfig.id,pluginConfig])),toggleEnabled:async _ref2=>{let{id,enabled}=_ref2;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.ImportApp,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref3=>{let{pluginConfig}=_ref3;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],importApps:[s=>[s.plugins,s.pluginConfigs],(plugins,pluginConfigs)=>Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})).map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.ImportApp)).sort((a,b)=>Number(b.enabled)-Number(a.enabled))],hasEnabledImportApps:[s=>[s.importApps],importApps=>importApps.some(app=>app.enabled)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadPlugins(),actions.loadPluginConfigs()})])},"../../frontend/src/scenes/pipeline/transformationsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>pipelineTransformationsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/projectLogic.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");let pipelineTransformationsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","transformationsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__.K,["currentProjectId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,openReorderModal:!0,closeReorderModal:!0,setTemporaryOrder:tempOrder=>({tempOrder}),savePluginConfigsOrder:newOrders=>({newOrders}),updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_transformations")}],temporaryOrder:[{},{setTemporaryOrder:async _ref2=>{let{tempOrder}=_ref2;return tempOrder},closeReorderModal:async()=>({})}],pluginConfigs:[{},{loadPluginConfigs:async()=>Object.fromEntries((await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentProjectId}/pipeline_transformation_configs`)).map(pluginConfig=>[pluginConfig.id,pluginConfig])),savePluginConfigsOrder:async _ref3=>{let{newOrders}=_ref3;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,!1))return values.pluginConfigs;let{pluginConfigs}=values,response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update("api/plugin_config/rearrange",{orders:newOrders}),newPluginConfigs={...pluginConfigs};for(let pluginConfig of response)Object.keys(values.plugins).map(Number).includes(pluginConfig.plugin)&&(newPluginConfigs[pluginConfig.id]=pluginConfig);return newPluginConfigs},toggleEnabled:async _ref4=>{let{id,enabled}=_ref4;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let order={};enabled&&(order={order:values.nextAvailableOrder});let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled,...order});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref5=>{let{pluginConfig}=_ref5;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],transformations:[s=>[s.pluginConfigs,s.plugins],(pluginConfigs,plugins)=>Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})).map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation))],sortedEnabledTransformations:[s=>[s.transformations,s.temporaryOrder],(transformations,temporaryOrder)=>(transformations=transformations.filter(t=>t.enabled),transformations=temporaryOrder&&Object.keys(temporaryOrder).length>0?Object.entries(temporaryOrder).sort((_ref6,_ref7)=>{let[,aIdx]=_ref6,[,bIdx]=_ref7;return aIdx-bIdx}).map(_ref8=>{let[pluginId]=_ref8;return transformations.find(t=>t.id===Number(pluginId))}):transformations.sort((a,b)=>a.order-b.order))],sortedTransformations:[s=>[s.transformations,s.sortedEnabledTransformations],(transformations,sortedEnabledTransformations)=>sortedEnabledTransformations.concat(transformations.filter(t=>!t.enabled).sort((a,b)=>a.id-b.id))],nextAvailableOrder:[s=>[s.transformations],transformations=>{let enabledTransformations=transformations.filter(t=>t.enabled);return enabledTransformations.length>0?Math.max(...enabledTransformations.map(t=>t.order),0)+1:0}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({reorderModalOpen:[!1,{openReorderModal:()=>!0,closeReorderModal:()=>!1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref9=>{let{actions}=_ref9;return{savePluginConfigsOrderSuccess:()=>{actions.closeReorderModal()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref10=>{let{actions}=_ref10;actions.loadPlugins(),actions.loadPluginConfigs()})])}}]);