(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[41516],{"../../frontend/src/scenes/data-warehouse/editor/EditorScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EditorScene:()=>EditorScene_EditorScene});var injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),EditorScene=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.3_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/EditorScene.scss"),EditorScene_default=__webpack_require__.n(EditorScene),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(EditorScene_default(),options),EditorScene_default().locals;var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),dataNodeLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),variableModalLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/variableModalLogic.ts"),variablesLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/variablesLogic.ts"),dataVisualizationLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/dataVisualizationLogic.ts"),displayLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/displayLogic.ts"),types=__webpack_require__("../../frontend/src/types.ts"),ViewLinkModal=__webpack_require__("../../frontend/src/scenes/data-warehouse/ViewLinkModal.tsx"),resizerLogic=__webpack_require__("../../frontend/src/lib/components/Resizer/resizerLogic.ts");let editorSizingLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","editorSizingLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(props=>({values:[(0,resizerLogic.Z)(props.sourceNavigatorResizerProps),["desiredSize as sourceNavigatorDesiredSize"],(0,resizerLogic.Z)(props.sidebarResizerProps),["desiredSize as sidebarDesiredSize"],(0,resizerLogic.Z)(props.queryPaneResizerProps),["desiredSize as queryPaneDesiredSize"]],actions:[(0,resizerLogic.Z)(props.sidebarResizerProps),["setDesiredSize as sidebarSetDesiredSize"]]})),(0,index_esm.actions)({resetDefaultSidebarWidth:!0}),(0,index_esm.listeners)(_ref=>{let{actions}=_ref;return{resetDefaultSidebarWidth:()=>{actions.sidebarSetDesiredSize(300)}}}),(0,index_esm.selectors)({editorSceneRef:[()=>[(_,props)=>props.editorSceneRef],editorSceneRef=>editorSceneRef],sourceNavigatorWidth:[s=>[s.sourceNavigatorDesiredSize],desiredSize=>Math.max(desiredSize||350,100)],queryPaneHeight:[s=>[s.queryPaneDesiredSize],queryPaneDesiredSize=>Math.max(queryPaneDesiredSize||300,100)],queryTabsWidth:[s=>[s.queryPaneDesiredSize],desiredSize=>desiredSize||350],sourceNavigatorResizerProps:[()=>[(_,props)=>props.sourceNavigatorResizerProps],sourceNavigatorResizerProps=>sourceNavigatorResizerProps],queryPaneResizerProps:[()=>[(_,props)=>props.queryPaneResizerProps],queryPaneResizerProps=>queryPaneResizerProps],sidebarWidth:[s=>[s.sidebarDesiredSize],desiredSize=>null!==desiredSize&&desiredSize<75?0:Math.min(Math.max(desiredSize||300,150),550)],sidebarResizerProps:[()=>[(_,props)=>props.sidebarResizerProps],sidebarResizerProps=>sidebarResizerProps]})]);var multitabEditorLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/multitabEditorLogic.tsx"),outputPaneLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/outputPaneLogic.ts"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.12.1_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),dataWarehouseViewsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/saved_queries/dataWarehouseViewsLogic.tsx");__webpack_require__("../../node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-data-grid/lib/styles.css");var DataGrid=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.3_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/DataGrid.scss"),DataGrid_default=__webpack_require__.n(DataGrid),DataGrid_options={};DataGrid_options.insert="head",DataGrid_options.singleton=!1,injectStylesIntoStyleTag_default()(DataGrid_default(),DataGrid_options),DataGrid_default().locals;var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),ExportButton=__webpack_require__("../../frontend/src/lib/components/ExportButton/ExportButton.tsx"),JSONViewer=__webpack_require__("../../frontend/src/lib/components/JSONViewer.tsx"),LemonMenu=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/LemonMenu.tsx"),LoadingBar=__webpack_require__("../../frontend/src/lib/lemon-ui/LoadingBar/index.ts"),copyToClipboard=__webpack_require__("../../frontend/src/lib/utils/copyToClipboard.tsx"),bundle=__webpack_require__("../../node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-data-grid/lib/bundle.js"),EmptyStates=__webpack_require__("../../frontend/src/scenes/insights/EmptyStates/index.ts"),BoldNumber=__webpack_require__("../../frontend/src/scenes/insights/views/BoldNumber/BoldNumber.tsx"),KeyboardShortcut=__webpack_require__("../../frontend/src/layout/navigation-3000/components/KeyboardShortcut.tsx"),themeLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),DateRange=__webpack_require__("../../frontend/src/queries/nodes/DataNode/DateRange.tsx"),ElapsedTime=__webpack_require__("../../frontend/src/queries/nodes/DataNode/ElapsedTime.tsx"),LoadNext=__webpack_require__("../../frontend/src/queries/nodes/DataNode/LoadNext.tsx"),LineGraph=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Charts/LineGraph.tsx"),SideBar=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/SideBar.tsx"),Table=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Table.tsx"),TableDisplay=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/TableDisplay.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function TabScroller(_ref){let{children}=_ref;return(0,jsx_runtime.jsx)("div",{className:"relative w-full overflow-auto",children:(0,jsx_runtime.jsx)("div",{className:"flex-1 absolute top-0 left-0 right-0 bottom-0",children:children})})}function RowDetailsModal(_ref){let{isOpen,onClose,row,columns}=_ref,[showRawJson,setShowRawJson]=(0,react.useState)({}),[wordWrap,setWordWrap]=(0,react.useState)({});if(!row)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let isJsonString=str=>{try{let parsed=JSON.parse(str);return"object"==typeof parsed&&null!==parsed}catch{return!1}},tableData=columns.map(column=>{let value=row[column],isStringifiedJson="string"==typeof value&&isJsonString(value),isJson="object"==typeof value||isStringifiedJson,jsonValue=isStringifiedJson?JSON.parse(value):value;return{column,isJson,rawValue:null===value?"null":"object"==typeof value||isStringifiedJson?JSON.stringify(value,null,2):String(value),value:null===value?(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"null"}):isJson?(0,jsx_runtime.jsx)("div",{className:"flex gap-2 w-full",children:(0,jsx_runtime.jsx)("div",{className:"w-full overflow-hidden",children:showRawJson[column]?(0,jsx_runtime.jsx)("pre",{className:(0,clsx_m.default)("m-0 font-mono",wordWrap[column]?"whitespace-pre-wrap break-all":"overflow-x-auto hide-scrollbar"),children:String(value)}):(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto max-w-full",children:(0,jsx_runtime.jsx)(JSONViewer.C,{src:jsonValue,name:null,collapsed:1})})})}):(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto",children:(0,jsx_runtime.jsx)("span",{className:"whitespace-pre-wrap break-all font-mono",children:String(value)})})}});return(0,jsx_runtime.jsx)(src.fQ,{title:"Row Details",isOpen:isOpen,onClose:onClose,width:800,children:(0,jsx_runtime.jsx)("div",{className:"RowDetailsModal max-h-[70vh] overflow-y-auto px-2 overflow-x-hidden",children:(0,jsx_runtime.jsx)(src.g3,{dataSource:tableData,className:"w-full table-fixed",columns:[{title:"Column",dataIndex:"column",className:"font-semibold",width:"35%",render:(_,record)=>(0,jsx_runtime.jsx)("span",{title:record.column,children:record.column})},{title:"Value",dataIndex:"value",className:"px-4 overflow-hidden",width:"65%",render:(_,record)=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1 overflow-x-auto pr-2",children:record.value}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-1 flex-shrink-0 ml-auto",children:[record.isJson&&record.rawValue&&"null"!=record.rawValue&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode,{}),onClick:()=>setShowRawJson(prev=>({...prev,[record.column]:!prev[record.column]})),tooltip:showRawJson[record.column]?"Show formatted":"Show raw"}),showRawJson[record.column]&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:wordWrap[record.column]?(0,jsx_runtime.jsx)(posthog_icons_es.IconMinus,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>setWordWrap(prev=>({...prev,[record.column]:!prev[record.column]})),tooltip:wordWrap[record.column]?"Collapse":"Expand"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCopy,{}),onClick:()=>void(0,copyToClipboard.v)(record.rawValue,"value"),tooltip:"Copy value"})]})]})}]})})})}function OutputPane(){let{activeTab}=(0,index_esm.useValues)(outputPaneLogic.o),{setActiveTab}=(0,index_esm.useActions)(outputPaneLogic.o),{sourceQuery,exportContext,editorKey,editingInsight,updateInsightButtonEnabled,showLegacyFilters,localStorageResponse}=(0,index_esm.useValues)(multitabEditorLogic.tg),{saveAsInsight,updateInsight,setSourceQuery,runQuery}=(0,index_esm.useActions)(multitabEditorLogic.tg),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),{response:dataNodeResponse,responseLoading,responseError,queryId,pollResponse}=(0,index_esm.useValues)(dataNodeLogic.M),{queryCancelled}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{toggleChartSettingsPanel}=(0,index_esm.useActions)(dataVisualizationLogic.H8),response=null!=dataNodeResponse?dataNodeResponse:localStorageResponse,[progressCache,setProgressCache]=(0,react.useState)({}),vizKey=(0,react.useMemo)(()=>"SQLEditorScene",[]),[selectedRow,setSelectedRow]=(0,react.useState)(null),setProgress=(0,react.useCallback)((loadId,progress)=>{setProgressCache(prev=>({...prev,[loadId]:progress}))},[]),columns=(0,react.useMemo)(()=>{var _response$columns$map;let types=response?.types;return[{key:"__details",name:"",minWidth:30,width:30,renderCell:_ref2=>{let{row}=_ref2;return(0,jsx_runtime.jsx)("div",{className:"hover-actions-cell flex justify-center items-center",children:(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand45,{}),onClick:e=>{e.stopPropagation(),setSelectedRow(row)}})})}},...null!==(_response$columns$map=response?.columns?.map((column,index)=>{let type=types?.[index]?.[1],finalWidth=Math.max(column.length,...(response.results||response.result).map(row=>{let content=row[index];return"string"==typeof content?content.length:null===content?0:content.toString().length}))>100?600:void 0;return type&&type.indexOf("Bool")!==-1?{key:column,name:column,resizable:!0,width:finalWidth,renderCell:props=>null===props.row[column]?null:props.row[column].toString()}:{...{key:column,name:column,resizable:!0,width:finalWidth},renderCell:props=>props.row[column]}}))&&void 0!==_response$columns$map?_response$columns$map:[]]},[response,setSelectedRow]),rows=(0,react.useMemo)(()=>response?.results?response?.results?.map((row,index)=>{let rowObject={__index:index};return response.columns.forEach((column,i)=>{"object"==typeof row[i]&&null!==row[i]?rowObject[column]=JSON.stringify(row[i]):rowObject[column]=row[i]}),rowObject}):[],[response]),hasColumns=columns.length>1;return(0,jsx_runtime.jsxs)("div",{className:"OutputPane flex flex-col w-full flex-1 bg-primary",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between align-center py-2 px-4 w-full h-[50px] border-b",children:[(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:tab=>setActiveTab(tab),tabs:[{key:outputPaneLogic.R.Results,label:"Results"},{key:outputPaneLogic.R.Visualization,label:"Visualization"}]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[showLegacyFilters&&(0,jsx_runtime.jsx)(DateRange.C,{query:sourceQuery.source,setQuery:query=>{setSourceQuery({...sourceQuery,source:query}),runQuery(query.query)}},"date-range"),activeTab===outputPaneLogic.R.Results&&exportContext&&(0,jsx_runtime.jsx)(ExportButton.j,{disabledReason:hasColumns?void 0:"No results to export",type:"secondary",items:[{export_format:types.P5.CSV,export_context:exportContext},{export_format:types.P5.XLSX,export_context:exportContext}]}),activeTab===outputPaneLogic.R.Visualization&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between flex-wrap",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[(0,jsx_runtime.jsx)(TableDisplay.V,{disabledReason:hasColumns?void 0:"No results to visualize"}),(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasColumns?void 0:"No results to visualize",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>toggleChartSettingsPanel(),tooltip:"Visualization settings"}),editingInsight&&(0,jsx_runtime.jsx)(src.Jp,{disabledReason:!updateInsightButtonEnabled&&"No updates to save",type:"primary",onClick:()=>updateInsight(),sideAction:{dropdown:{placement:"bottom-end",overlay:(0,jsx_runtime.jsx)(LemonMenu.iy,{items:[{label:"Save as...",onClick:()=>saveAsInsight()}]})}},children:"Save insight"}),!editingInsight&&(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasColumns?void 0:"No results to save",type:"primary",onClick:()=>saveAsInsight(),children:"Create insight"})]})})]})}),activeTab===outputPaneLogic.R.Results&&(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasColumns?void 0:"No results to visualize",type:"secondary",onClick:()=>setActiveTab(outputPaneLogic.R.Visualization),children:"Visualize"})]})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-1 relative bg-dark",children:(0,jsx_runtime.jsx)(Content,{activeTab:activeTab,responseError:responseError,responseLoading:responseLoading,response:response,sourceQuery:sourceQuery,queryCancelled:queryCancelled,columns:columns,rows:rows,isDarkModeOn:isDarkModeOn,vizKey:vizKey,setSourceQuery:setSourceQuery,exportContext:exportContext,saveAsInsight:saveAsInsight,queryId:queryId,pollResponse:pollResponse,editorKey:editorKey,setProgress:setProgress,progress:queryId?progressCache[queryId]:void 0})}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between px-2 border-t",children:[(0,jsx_runtime.jsx)("div",{children:response&&!responseError?(0,jsx_runtime.jsx)(LoadNext.D,{localResponse:localStorageResponse}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}),(0,jsx_runtime.jsx)(ElapsedTime.W,{})]}),(0,jsx_runtime.jsx)(RowDetailsModal,{isOpen:!!selectedRow,onClose:()=>setSelectedRow(null),row:selectedRow,columns:response?.columns||[]})]})}function InternalDataTableVisualization(props){let{query,visualizationType,showEditingUI,response,responseLoading,isChartSettingsPanelOpen}=(0,index_esm.useValues)(dataVisualizationLogic.H8),component=null;return showEditingUI||response&&!responseLoading?visualizationType===types.Qb.ActionsTable?component=(0,jsx_runtime.jsx)(Table.i,{uniqueKey:props.uniqueKey,query:query,context:props.context,cachedResults:props.cachedResults}):visualizationType===types.Qb.ActionsLineGraph||visualizationType===types.Qb.ActionsBar||visualizationType===types.Qb.ActionsAreaGraph||visualizationType===types.Qb.ActionsStackedBar?component=(0,jsx_runtime.jsx)(LineGraph.x,{}):visualizationType===types.Qb.BoldNumber&&(component=(0,jsx_runtime.jsx)(BoldNumber.w,{})):component=(0,jsx_runtime.jsx)("div",{className:"flex flex-col flex-1 justify-center items-center bg-surface-primary h-full",children:(0,jsx_runtime.jsx)(LoadingBar.F,{})}),(0,jsx_runtime.jsx)("div",{className:"DataVisualization h-full hide-scrollbar flex flex-1 gap-2",children:(0,jsx_runtime.jsx)("div",{className:"relative w-full flex flex-col gap-4 flex-1",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 flex-row gap-4 overflow-scroll hide-scrollbar",children:[isChartSettingsPanelOpen&&(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(SideBar.K,{})}),(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("w-full h-full flex-1 overflow-auto"),children:component})]})})})}let ErrorState=_ref3=>{let{responseError,sourceQuery,queryCancelled,response}=_ref3;return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("flex-1 absolute top-0 left-0 right-0 bottom-0 overflow-scroll"),children:(0,jsx_runtime.jsx)(EmptyStates.jC,{query:sourceQuery,excludeDetail:!0,title:queryCancelled?"The query was cancelled":response&&"error"in response?response.error:responseError})})},Content=_ref4=>{let{activeTab,responseError,responseLoading,response,sourceQuery,queryCancelled,columns,rows,isDarkModeOn,vizKey,setSourceQuery,exportContext,saveAsInsight,queryId,pollResponse,setProgress,progress}=_ref4;if(responseLoading)return(0,jsx_runtime.jsx)("div",{className:"flex flex-1 p-2 w-full justify-center items-center",children:(0,jsx_runtime.jsx)(EmptyStates.sX,{queryId:queryId,pollResponse:pollResponse,setProgress:setProgress,progress:progress})});if(responseError)return(0,jsx_runtime.jsx)(ErrorState,{responseError:responseError,sourceQuery:sourceQuery,queryCancelled:queryCancelled,response:response});if(!response){let msg=activeTab===outputPaneLogic.R.Results?"Query results will appear here.":"Query results will be visualized here.";return(0,jsx_runtime.jsx)("div",{className:"flex flex-1 justify-center items-center",children:(0,jsx_runtime.jsxs)("span",{className:"text-secondary mt-3",children:[msg," Press ",(0,jsx_runtime.jsx)(KeyboardShortcut.e,{command:!0,enter:!0})," to run the query."]})})}return activeTab===outputPaneLogic.R.Results?(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsx)(bundle.ZP,{className:isDarkModeOn?"rdg-dark h-full":"rdg-light h-full",columns:columns,rows:rows})}):activeTab===outputPaneLogic.R.Visualization?(0,jsx_runtime.jsx)("div",{className:"flex-1 absolute top-0 left-0 right-0 bottom-0 px-4 py-1 hide-scrollbar",children:(0,jsx_runtime.jsx)(InternalDataTableVisualization,{uniqueKey:vizKey,query:sourceQuery,setQuery:setSourceQuery,context:{},cachedResults:void 0,exportContext:exportContext,onSaveInsight:saveAsInsight})}):null};var Resizer=__webpack_require__("../../frontend/src/lib/components/Resizer/Resizer.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),CodeEditor=__webpack_require__("../../frontend/src/lib/monaco/CodeEditor.tsx"),AutoSizer=__webpack_require__("../../node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),MaxTool=__webpack_require__("../../frontend/src/scenes/max/MaxTool.tsx");function QueryPane(props){let{queryPaneHeight,queryPaneResizerProps}=(0,index_esm.useValues)(editorSizingLogic),{setSuggestedQueryInput,onAcceptSuggestedQueryInput,onRejectSuggestedQueryInput,reportAIQueryPromptOpen}=(0,index_esm.useActions)(multitabEditorLogic.tg),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"relative flex flex-col w-full bg-primary",style:{height:`${queryPaneHeight}px`},ref:queryPaneResizerProps.containerRef,children:[(0,jsx_runtime.jsx)("div",{className:"flex-1","data-attr":"hogql-query-editor",children:(0,jsx_runtime.jsx)(AutoSizer.q,{children:_ref=>{let{height,width}=_ref;return(0,jsx_runtime.jsx)(CodeEditor.p,{language:"hogQL",value:props.queryInput,sourceQuery:props.sourceQuery,height:height,width:width,originalValue:props.originalValue,...props.codeEditorProps,options:{minimap:{enabled:!1},wordWrap:"on",scrollBeyondLastLine:!!props.originalValue,automaticLayout:!0,fixedOverflowWidgets:!0,suggest:{showInlineDetails:!0},quickSuggestionsDelay:300}})}})}),featureFlags[constants.y8.AI_HOGQL]&&(0,jsx_runtime.jsx)("div",{className:"absolute bottom-6 right-4",children:(0,jsx_runtime.jsx)(MaxTool.Z,{name:"generate_hogql_query",displayName:"Write and tweak SQL",context:{current_query:props.queryInput},callback:toolOutput=>{setSuggestedQueryInput(toolOutput)},suggestions:[],onMaxOpen:()=>{reportAIQueryPromptOpen()},children:(0,jsx_runtime.jsx)("div",{className:"relative"})})}),props.originalValue&&(0,jsx_runtime.jsxs)("div",{className:"absolute flex gap-1 bg-bg-light rounded border py-1 px-1.5 z-10 left-1/2 -translate-x-1/2 bottom-4 whitespace-nowrap",style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},children:[(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{color:"var(--success)"}),onClick:()=>{onAcceptSuggestedQueryInput(!0)},tooltipPlacement:"top",size:"small",children:"Accept & run"}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"tertiary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{color:"var(--success)"}),onClick:()=>{onAcceptSuggestedQueryInput()},tooltipPlacement:"top",size:"small",children:"Accept"}),(0,jsx_runtime.jsx)(LemonButton.J,{status:"danger",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:()=>{onRejectSuggestedQueryInput()},tooltipPlacement:"top",size:"small",children:"Reject"})]}),(0,jsx_runtime.jsx)(Resizer.w,{...queryPaneResizerProps})]})})}var QueryTabs=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/QueryTabs.tsx"),kea_subscriptions_lib=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.5_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js");let EditorSidebarTab=function(EditorSidebarTab){return EditorSidebarTab.QueryDatabase="query_database",EditorSidebarTab.QueryVariables="query_variables",EditorSidebarTab.QueryInfo="query_info",EditorSidebarTab}({}),editorSidebarLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","sidebar","editorSidebarLogic"]),(0,index_esm.props)({key:""}),(0,index_esm.key)(props=>props.key),(0,index_esm.connect)({values:[variablesLogic.Q,["variablesForInsight"]]}),(0,index_esm.actions)({setActiveTab:tab=>({tab}),setPreviousVariableCount:count=>({count})}),(0,index_esm.reducers)({activeTab:[EditorSidebarTab.QueryDatabase,{setActiveTab:(_,_ref)=>{let{tab}=_ref;return tab}}],previousVariableCount:[0,{setPreviousVariableCount:(_,_ref2)=>{let{count}=_ref2;return count}}]}),(0,kea_subscriptions_lib.Vt)(_ref3=>{let{values,actions}=_ref3;return{variablesForInsight:variables=>{variables.length>values.previousVariableCount&&actions.setActiveTab(EditorSidebarTab.QueryVariables),actions.setPreviousVariableCount(variables.length)}}})]);function QueryWindow(_ref){let{onSetMonacoAndEditor}=_ref,codeEditorKey=`hogQLQueryEditor/${lib.router.values.location.pathname}`,{allTabs,activeModelUri,queryInput,editingView,editingInsight,sourceQuery,suggestedQueryInput}=(0,index_esm.useValues)(multitabEditorLogic.tg),{renameTab,selectTab,deleteTab,createTab,setQueryInput,runQuery,setError,setMetadata,setMetadataLoading,saveAsView}=(0,index_esm.useActions)(multitabEditorLogic.tg),{response}=(0,index_esm.useValues)(dataNodeLogic.M),{updatingDataWarehouseSavedQuery}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{updateDataWarehouseSavedQuery}=(0,index_esm.useActions)(dataWarehouseViewsLogic.$),{sidebarWidth}=(0,index_esm.useValues)(editorSizingLogic),{resetDefaultSidebarWidth}=(0,index_esm.useActions)(editorSizingLogic),{setActiveTab}=(0,index_esm.useActions)(editorSidebarLogic),isMaterializedView=!!editingView?.status;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 flex-col h-full overflow-hidden",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row overflow-x-auto",children:[0===sidebarWidth&&(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>resetDefaultSidebarWidth(),className:"rounded-none",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconSidebarClose,{}),type:"tertiary",size:"small"}),(0,jsx_runtime.jsx)(QueryTabs.K,{models:allTabs,onClick:selectTab,onClear:deleteTab,onAdd:createTab,onRename:renameTab,activeModelUri:activeModelUri})]}),(editingView||editingInsight)&&(0,jsx_runtime.jsx)("div",{className:"h-5 bg-warning-highlight",children:(0,jsx_runtime.jsxs)("span",{className:"pl-2 text-xs",children:[editingView&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Editing ",isMaterializedView?"materialized view":"view",' "',editingView.name,'"']}),editingInsight&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:['Editing insight "',editingInsight.name,'"']})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-start align-center w-full ml-2 mr-2",children:[(0,jsx_runtime.jsx)(RunButton,{}),(0,jsx_runtime.jsx)(src.p2,{vertical:!0}),editingView?(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>{var _response$types;return updateDataWarehouseSavedQuery({id:editingView.id,query:{...sourceQuery.source,query:queryInput},types:null!==(_response$types=response?.types)&&void 0!==_response$types?_response$types:[],shouldRematerialize:isMaterializedView})},disabledReason:updatingDataWarehouseSavedQuery?"Saving...":"",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),type:"tertiary",size:"xsmall",id:`sql-editor-query-window-update-${isMaterializedView?"materialize":"view"}`,children:isMaterializedView?"Update and re-materialize view":"Update view"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>saveAsView(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),type:"tertiary",size:"xsmall",id:"sql-editor-query-window-save-as-view",children:"Save as view"}),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>setActiveTab(EditorSidebarTab.QueryInfo),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBolt,{}),type:"tertiary",size:"xsmall",id:"sql-editor-query-window-materialize",children:"Materialize"})]})]}),(0,jsx_runtime.jsx)(QueryPane,{originalValue:suggestedQueryInput&&suggestedQueryInput!=queryInput?null!=queryInput?queryInput:" ":void 0,queryInput:suggestedQueryInput&&suggestedQueryInput!=queryInput?suggestedQueryInput:queryInput,sourceQuery:sourceQuery.source,promptError:null,onRun:runQuery,codeEditorProps:{queryKey:codeEditorKey,onChange:v=>{setQueryInput(null!=v?v:"")},onMount:(editor,monaco)=>{onSetMonacoAndEditor(monaco,editor)},onPressCmdEnter:(value,selectionType)=>{value&&"selection"===selectionType?runQuery(value):runQuery()},onError:error=>{setError(error)},onMetadata:metadata=>{setMetadata(metadata)},onMetadataLoading:loading=>{setMetadataLoading(loading)}}}),(0,jsx_runtime.jsx)(InternalQueryWindow,{})]})}function RunButton(){let{runQuery}=(0,index_esm.useActions)(multitabEditorLogic.tg),{cancelQuery}=(0,index_esm.useActions)(dataNodeLogic.M),{responseLoading}=(0,index_esm.useValues)(dataNodeLogic.M),{metadata,queryInput,isSourceQueryLastRun}=(0,index_esm.useValues)(multitabEditorLogic.tg),isUsingIndices=metadata?.isUsingIndices==="yes",[iconColor,tooltipContent]=(0,react.useMemo)(()=>isSourceQueryLastRun?["var(--primary)","No changes to run"]:!metadata||isUsingIndices||0===queryInput.trim().length?["var(--success)","New changes to run"]:["var(--warning)",isUsingIndices?void 0:"This query is not using indices optimally, which may result in slower performance."],[metadata,isUsingIndices,queryInput,isSourceQueryLastRun]);return(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>{responseLoading?cancelQuery():runQuery()},icon:responseLoading?(0,jsx_runtime.jsx)(icons.uR,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPlayFilled,{color:iconColor}),type:"tertiary",size:"xsmall",tooltip:tooltipContent,children:responseLoading?"Cancel":"Run"})}function InternalQueryWindow(){let{cacheLoading}=(0,index_esm.useValues)(multitabEditorLogic.tg);return cacheLoading?null:(0,jsx_runtime.jsx)(OutputPane,{})}var LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.236.4_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),navigationLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/navigationLogic.tsx"),editorSceneLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/editorSceneLogic.tsx"),DatabaseTableTree=__webpack_require__("../../frontend/src/lib/components/DatabaseTableTree/DatabaseTableTree.tsx"),viewLinkLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/viewLinkLogic.tsx"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),Sidebar=__webpack_require__("../../frontend/src/layout/navigation-3000/components/Sidebar.tsx"),queryDatabaseLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/sidebar/queryDatabaseLogic.ts");let QueryDatabase=_ref=>{let{isOpen}=_ref,navBarItem={identifier:sceneTypes.x.SQLEditor,label:"SQL editor",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconServer,{}),logic:editorSceneLogic.h};return(0,jsx_runtime.jsx)(Sidebar.Y,{navbarItem:navBarItem,sidebarOverlay:(0,jsx_runtime.jsx)(EditorSidebarOverlay,{}),sidebarOverlayProps:{isOpen}})},EditorSidebarOverlay=()=>{let{setSidebarOverlayOpen}=(0,index_esm.useActions)(editorSceneLogic.h),{sidebarOverlayTreeItems,selectedSchema}=(0,index_esm.useValues)(queryDatabaseLogic.a),{toggleJoinTableModal,selectSourceTable}=(0,index_esm.useActions)(viewLinkLogic.t),copy=()=>{selectedSchema?.name&&(0,copyToClipboard.v)(selectedSchema.name,"schema")};return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col h-full",children:[(0,jsx_runtime.jsxs)("header",{className:"flex flex-row items-center h-10 border-b shrink-0 p-1 gap-1",children:[(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowLeft,{}),onClick:()=>setSidebarOverlayOpen(!1)}),(0,jsx_runtime.jsx)(src.u,{title:"Click to copy",children:(0,jsx_runtime.jsx)("span",{className:"font-mono cursor-pointer flex-1 whitespace-nowrap overflow-hidden text-ellipsis",onClick:()=>copy(),children:selectedSchema?.name})}),(0,jsx_runtime.jsxs)("div",{className:"flex",children:[selectedSchema?.name&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCopy,{style:{color:"var(--text-secondary)"}}),noPadding:!0,className:"ml-1 mr-1","data-attr":"copy-icon",onClick:()=>copy()}),selectedSchema&&"type"in selectedSchema&&"managed_view"!==selectedSchema.type&&(0,jsx_runtime.jsx)(src.d6,{items:[{label:"Add join",onClick:()=>{selectedSchema&&(selectSourceTable(selectedSchema.name),toggleJoinTableModal())}}],children:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",noPadding:!0,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{})})})})]})]}),(0,jsx_runtime.jsx)("div",{className:"overflow-y-auto flex-1",children:(0,jsx_runtime.jsx)(DatabaseTableTree.E,{items:sidebarOverlayTreeItems})})]})};var LemonSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSelect/index.ts"),LemonTag=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTag/index.ts"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),databaseTableListLogic=__webpack_require__("../../frontend/src/scenes/data-management/database/databaseTableListLogic.ts");let infoTabLogic=(0,index_esm.kea)([(0,index_esm.path)(["data-warehouse","editor","sidebar","infoTabLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.codeEditorKey),(0,index_esm.connect)(props=>({values:[(0,multitabEditorLogic.tg)({key:props.codeEditorKey}),["metadata"],databaseTableListLogic.A,["posthogTablesMap","dataWarehouseTablesMap"],dataWarehouseViewsLogic.$,["dataWarehouseSavedQueryMap"]]})),(0,index_esm.selectors)({sourceTableItems:[s=>[s.metadata,s.dataWarehouseSavedQueryMap],(metadata,dataWarehouseSavedQueryMap)=>metadata&&metadata.table_names?.map(table_name=>{let view=dataWarehouseSavedQueryMap[table_name];return view?{name:table_name,type:"table",view_id:view.id,status:view.status,last_run_at:view.last_run_at||"never"}:{name:table_name,type:"source",status:void 0,last_run_at:void 0}})||[]]})]),OPTIONS=[{value:"never",label:" No resync"},{value:"5min",label:" Resync every 5 mins"},{value:"30min",label:" Resync every 30 mins"},{value:"1hour",label:" Resync every 1 hour"},{value:"6hour",label:" Resync every 6 hours"},{value:"12hour",label:" Resync every 12 hours"},{value:"24hour",label:" Resync Daily"},{value:"7day",label:" Resync Weekly"},{value:"30day",label:" Resync Monthly"}];function QueryInfo(_ref){let{codeEditorKey}=_ref,{sourceTableItems}=(0,index_esm.useValues)(infoTabLogic({codeEditorKey:codeEditorKey})),{editingView}=(0,index_esm.useValues)(multitabEditorLogic.tg),{runDataWarehouseSavedQuery,saveAsView}=(0,index_esm.useActions)(multitabEditorLogic.tg),{dataWarehouseSavedQueryMapById,updatingDataWarehouseSavedQuery,initialDataWarehouseSavedQueryLoading,dataModelingJobs,hasMoreJobsToLoad}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{updateDataWarehouseSavedQuery,loadOlderDataModelingJobs}=(0,index_esm.useActions)(dataWarehouseViewsLogic.$),savedQuery=editingView?dataWarehouseSavedQueryMapById[editingView.id]:null;return initialDataWarehouseSavedQueryLoading?(0,jsx_runtime.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,jsx_runtime.jsx)(src.$j,{className:"text-lg"})}):(0,jsx_runtime.jsx)("div",{className:"overflow-auto",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 p-4 gap-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:"Materialization"}),(0,jsx_runtime.jsx)(LemonTag.o,{type:"warning",children:"BETA"}),savedQuery?.latest_error&&"Failed"===savedQuery.status&&(0,jsx_runtime.jsx)(Tooltip.u,{title:savedQuery.latest_error,children:(0,jsx_runtime.jsx)(LemonTag.o,{type:"danger",children:"Error"})})]}),(0,jsx_runtime.jsx)("div",{children:savedQuery?.sync_frequency||savedQuery?.last_run_at?(0,jsx_runtime.jsxs)("div",{children:[savedQuery?.last_run_at?`Last run at ${(0,utils.bo)(savedQuery?.last_run_at)}`:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("span",{children:"Materialization scheduled"})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,jsx_runtime.jsx)(LemonButton.J,{loading:savedQuery?.status==="Running",disabledReason:savedQuery?.status==="Running"&&"Query is already running",onClick:()=>editingView&&runDataWarehouseSavedQuery(editingView.id),type:"secondary",children:"Sync now"}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{className:"h-9",disabledReason:savedQuery?.status==="Running"&&"Query is already running",value:editingView&&dataWarehouseSavedQueryMapById[editingView.id]?.sync_frequency||"never",onChange:newValue=>{editingView&&newValue&&updateDataWarehouseSavedQuery({id:editingView.id,sync_frequency:newValue,types:[[]],lifecycle:"update"})},loading:updatingDataWarehouseSavedQuery,options:OPTIONS})]})]}):(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("p",{children:["Materialized views are a way to pre-compute data in your data warehouse. This allows you to run queries faster and more efficiently. Learn more about materialization"," ",(0,jsx_runtime.jsx)(src.rU,{"data-attr":"materializing-help",to:"https://posthog.com/docs/data-warehouse/views#materializing-and-scheduling-a-view",target:"_blank",children:"here"}),"."]}),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>{editingView?updateDataWarehouseSavedQuery({id:editingView.id,sync_frequency:"24hour",types:[[]],lifecycle:"create"}):saveAsView({materializeAfterSave:!0})},type:"primary",loading:updatingDataWarehouseSavedQuery,children:editingView?"Materialize":"Save and materialize"})]})})]}),savedQuery&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Materialization Runs"}),(0,jsx_runtime.jsx)("p",{children:"The last runs for this materialized view. These can be scheduled or run on demand."})]}),(0,jsx_runtime.jsx)(src.g3,{loading:initialDataWarehouseSavedQueryLoading,dataSource:dataModelingJobs?.results||[],columns:[{title:"Status",dataIndex:"status",render:(_,_ref2)=>{let{status,error}=_ref2,type={Completed:"success",Failed:"danger",Running:"warning"}[status]||"warning";return error?(0,jsx_runtime.jsx)(Tooltip.u,{title:error,children:(0,jsx_runtime.jsx)(LemonTag.o,{type:type,children:status})}):(0,jsx_runtime.jsx)(LemonTag.o,{type:type,children:status})}},{title:"Rows",dataIndex:"rows_materialized",render:(_,_ref3)=>{let{rows_materialized,status}=_ref3;return"Running"===status&&0===rows_materialized?"~":rows_materialized}},{title:"Updated",dataIndex:"last_run_at",render:(_,_ref4)=>{let{last_run_at}=_ref4;return(0,utils.bo)(last_run_at)}},{title:"Duration",render:(_,job)=>{if("Running"===job.status)return"In progress";let start=new Date(job.created_at).getTime(),end=new Date(job.last_run_at).getTime();return start>end?"N/A":(0,utils.C7)((end-start)/1e3)}}],nouns:["run","runs"],emptyState:"No runs available",footer:hasMoreJobsToLoad&&(0,jsx_runtime.jsx)("div",{className:"flex items-center m-2",children:(0,jsx_runtime.jsx)(LemonButton.J,{center:!0,fullWidth:!0,onClick:()=>loadOlderDataModelingJobs(),loading:initialDataWarehouseSavedQueryLoading,children:"Load older runs"})})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Columns"}),(0,jsx_runtime.jsx)("p",{children:"Columns that are available in the materialized view."})]}),(0,jsx_runtime.jsx)(src.g3,{columns:[{key:"name",title:"Name",render:(_,column)=>column.name},{key:"type",title:"Type",render:(_,column)=>column.type},{key:"schema_valid",title:"Schema Valid",render:(_,column)=>(0,jsx_runtime.jsx)(LemonTag.o,{type:column.schema_valid?"success":"danger",children:column.schema_valid?"Yes":"No"})}],dataSource:savedQuery?.columns||[]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Dependencies"}),(0,jsx_runtime.jsx)("p",{children:"Dependencies are tables that this query uses. See when a source or materialized table was last run."})]}),(0,jsx_runtime.jsx)(src.g3,{columns:[{key:"Name",title:"Name",render:(_,_ref5)=>{let{name}=_ref5;return name}},{key:"Type",title:"Type",render:(_,_ref6)=>{let{type}=_ref6;return type}},{key:"Status",title:"Status",render:(_,_ref7)=>{let{type,status}=_ref7;return"source"===type?(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a source table, so it doesn't have a status",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})}):status}},{key:"Last run at",title:"Last run at",render:(_,_ref8)=>{let{type,last_run_at}=_ref8;return"source"===type?(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a source table, so it is never run",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})}):(0,utils.bo)(last_run_at)}}],dataSource:sourceTableItems})]})})}var AddVariableButton=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/AddVariableButton.tsx"),NewVariableModal=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/NewVariableModal.tsx"),Variables=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/Variables.tsx");function QueryVariables(){let{variablesForInsight}=(0,index_esm.useValues)(variablesLogic.Q),{updateVariableValue,removeVariable}=(0,index_esm.useActions)(variablesLogic.Q),{showEditingUI}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{variableOverridesAreSet}=(0,index_esm.useValues)(dataNodeLogic.M),{openExistingVariableModal}=(0,index_esm.useActions)(variableModalLogic.b);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 py-2 h-full overflow-auto",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center justify-between px-2",children:[(0,jsx_runtime.jsx)("h3",{className:"text-sm font-semibold mb-0",children:"Query variables"}),(0,jsx_runtime.jsx)(AddVariableButton.u,{buttonProps:{type:"primary",size:"xsmall"},title:""})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-between px-2",children:(0,jsx_runtime.jsxs)("span",{className:"text-xs text-muted-alt",children:["Query variables let you dynamically set values in your SQL query."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/sql/variables",target:"_blank",children:"Learn more"})]})}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("flex gap-4 flex-col px-2",0===variablesForInsight.length&&"h-full items-center justify-center"),children:[0===variablesForInsight.length&&(0,jsx_runtime.jsx)("span",{className:"text-xs text-muted-alt",children:"No query variables found"}),variablesForInsight.map(n=>(0,jsx_runtime.jsx)(Variables.LO,{variable:n,showEditingUI:showEditingUI,onChange:updateVariableValue,onRemove:removeVariable,variableOverridesAreSet:variableOverridesAreSet,variableSettingsOnClick:()=>openExistingVariableModal(n)},n.id))]}),(0,jsx_runtime.jsx)(NewVariableModal.f,{})]})}let EditorSidebar=_ref=>{let{sidebarRef,codeEditorKey}=_ref,{sidebarOverlayOpen}=(0,index_esm.useValues)(editorSceneLogic.h),{sidebarWidth}=(0,index_esm.useValues)(editorSizingLogic),{setSidebarWidth}=(0,index_esm.useActions)(navigationLogic.f),editorSizingLogicProps=editorSizingLogic.props,{activeTab,variablesForInsight}=(0,index_esm.useValues)(editorSidebarLogic),{setActiveTab}=(0,index_esm.useActions)(editorSidebarLogic);(0,react.useEffect)(()=>{setSidebarWidth(sidebarWidth)},[sidebarWidth,setSidebarWidth]);let tabs=(0,react.useMemo)(()=>[{key:EditorSidebarTab.QueryDatabase,label:(0,jsx_runtime.jsx)(src.u,{title:"Data warehouse",children:(0,jsx_runtime.jsx)("div",{className:"flex justify-center px-2",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconServer,{className:"text-xl"})})})},{key:EditorSidebarTab.QueryVariables,label:(0,jsx_runtime.jsx)(src.u,{title:"Query variables",children:(0,jsx_runtime.jsxs)("div",{className:"flex justify-center px-2 relative",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconBrackets,{className:"text-xl"}),variablesForInsight.length>0&&(0,jsx_runtime.jsx)("div",{className:"absolute -top-1 -right-1 flex items-center justify-center bg-gray-700 rounded-full text-white text-[9px] h-3 w-3 min-w-3",children:variablesForInsight.length})]})})},{key:EditorSidebarTab.QueryInfo,label:(0,jsx_runtime.jsx)(src.u,{title:"Materialization and query properties",children:(0,jsx_runtime.jsx)("div",{className:"flex justify-center px-2",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconDatabaseBolt,{className:"text-xl"})})})}],[variablesForInsight.length]);return(0,jsx_runtime.jsxs)("div",{className:"EditorSidebar flex flex-col h-full relative",ref:sidebarRef,style:{width:`${sidebarWidth}px`},children:[(0,jsx_runtime.jsx)("div",{className:"w-full",children:(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeTab,onChange:key=>{dist_module.ZP.capture("sql-editor-side-tab-change",{tab:key,oldTab:activeTab}),setActiveTab(key)},tabs:tabs,size:"small",barClassName:"flex justify-center h-10 items-center"})}),(()=>{switch(activeTab){case EditorSidebarTab.QueryDatabase:return(0,jsx_runtime.jsx)(QueryDatabase,{isOpen:sidebarOverlayOpen});case EditorSidebarTab.QueryVariables:return(0,jsx_runtime.jsx)(QueryVariables,{});case EditorSidebarTab.QueryInfo:return(0,jsx_runtime.jsx)(QueryInfo,{codeEditorKey:codeEditorKey});default:return(0,jsx_runtime.jsx)(QueryDatabase,{isOpen:sidebarOverlayOpen})}})(),(0,jsx_runtime.jsx)(Resizer.w,{...editorSizingLogicProps.sidebarResizerProps,offset:0})]})};function EditorScene_EditorScene(){let ref=(0,react.useRef)(null),navigatorRef=(0,react.useRef)(null),queryPaneRef=(0,react.useRef)(null),sidebarRef=(0,react.useRef)(null),[monacoAndEditor,setMonacoAndEditor]=(0,react.useState)(null),[monaco,editor]=null!=monacoAndEditor?monacoAndEditor:[],codeEditorKey=`hogQLQueryEditor/${lib.router.values.location.pathname}`,logic=(0,multitabEditorLogic.tg)({key:codeEditorKey,monaco,editor}),{queryInput,sourceQuery,dataLogicKey}=(0,index_esm.useValues)(logic),{setSourceQuery,setResponse}=(0,index_esm.useActions)(logic),dataVisualizationLogicProps={key:dataLogicKey,query:sourceQuery,dashboardId:void 0,dataNodeCollectionId:dataLogicKey,insightMode:types.LO.Edit,loadPriority:void 0,cachedResults:void 0,variablesOverride:void 0,setQuery:setSourceQuery},dataNodeLogicProps={query:sourceQuery.source,key:dataLogicKey,cachedResults:void 0,loadPriority:void 0,dataNodeCollectionId:dataLogicKey,variablesOverride:void 0,autoLoad:!1,onData:data=>{setResponse(null!=data?data:null)}},{loadData}=(0,index_esm.useActions)((0,dataNodeLogic.M)(dataNodeLogicProps)),variablesLogicProps={key:dataVisualizationLogicProps.key,readOnly:!1,queryInput,sourceQuery,setQuery:setSourceQuery,onUpdate:query=>{loadData("force_async",void 0,query.source)}};return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:editorSizingLogic,props:{editorSceneRef:ref,navigatorRef,sidebarRef,sourceNavigatorResizerProps:{containerRef:navigatorRef,logicKey:"source-navigator",placement:"right"},sidebarResizerProps:{containerRef:sidebarRef,logicKey:"sidebar-resizer",placement:"right"},queryPaneResizerProps:{containerRef:queryPaneRef,logicKey:"query-pane",placement:"bottom"}},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeLogic.M,props:dataNodeLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataVisualizationLogic.H8,props:dataVisualizationLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:displayLogic.Y,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:variablesLogic.Q,props:variablesLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:variableModalLogic.b,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:editorSidebarLogic,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:outputPaneLogic.o,props:{},children:(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:multitabEditorLogic.tg,props:{key:codeEditorKey,monaco,editor},children:[(0,jsx_runtime.jsxs)("div",{className:"EditorScene w-full h-full flex flex-row overflow-hidden",ref:ref,children:[(0,jsx_runtime.jsx)(EditorSidebar,{sidebarRef:sidebarRef,codeEditorKey:codeEditorKey}),(0,jsx_runtime.jsx)(QueryWindow,{onSetMonacoAndEditor:(monaco,editor)=>setMonacoAndEditor([monaco,editor])})]}),(0,jsx_runtime.jsx)(ViewLinkModal.WI,{})]})})})})})})})})})}},"../../frontend/src/scenes/data-warehouse/editor/QueryTabs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{K:()=>QueryTabs});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.12.1_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let editor_AutoTab=_ref=>{let{value,onChange,onKeyDown,onBlur,autoFocus,handleRename}=_ref,inputRef=(0,react.useRef)(null),spanRef=(0,react.useRef)(null);return(0,react.useEffect)(()=>{if(!inputRef.current||!spanRef.current)return;let newWidth=spanRef.current.offsetWidth;inputRef.current.style.width=newWidth+"px"},[value]),(0,jsx_runtime.jsxs)("div",{className:"relative inline-block",children:[(0,jsx_runtime.jsx)("span",{ref:spanRef,className:"pointer-events-none absolute invisible whitespace-pre","aria-hidden":"true",children:value}),(0,jsx_runtime.jsx)("input",{ref:inputRef,className:"bg-transparent border-none focus:outline-hidden p-0",value:value,onChange:e=>{onChange(e),handleRename()},onKeyDown:onKeyDown,onBlur:onBlur,autoFocus:autoFocus})]})};var multitabEditorLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/multitabEditorLogic.tsx");function QueryTabs(_ref){let{models,onClear,onClick,onAdd,onRename,activeModelUri}=_ref;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row overflow-scroll hide-scrollbar h-10",children:models.map(model=>(0,jsx_runtime.jsx)(QueryTabComponent,{model:model,onClear:models.length>1?onClear:void 0,onClick:onClick,active:activeModelUri?.uri.path===model.uri.path,onRename:onRename},model.uri.path))}),(0,jsx_runtime.jsx)(src.Jp,{className:"rounded-none",onClick:()=>onAdd(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{fontSize:14})})]})}function QueryTabComponent(_ref2){let{model,active,onClear,onClick,onRename}=_ref2,[tabName,setTabName]=(0,react.useState)(()=>model.name||multitabEditorLogic.x$),[isEditing,setIsEditing]=(0,react.useState)(!1);(0,react.useEffect)(()=>{setTabName(model.view?.name||model.name||multitabEditorLogic.x$)},[model.view?.name]);let handleRename=()=>{setIsEditing(!1),onRename(model,tabName)};return(0,jsx_runtime.jsxs)("div",{onClick:()=>onClick?.(model),className:(0,clsx_m.default)("deprecated-space-y-px p-1 flex border-b-2 flex-row items-center gap-1 hover:bg-surface-primary cursor-pointer",active?"bg-surface-primary border-b-2 !border-brand-yellow":"bg-surface-secondary border-transparent",onClear?"pl-3 pr-2":"px-3"),children:[isEditing?(0,jsx_runtime.jsx)(editor_AutoTab,{value:tabName,onChange:e=>setTabName(e.target.value),onBlur:handleRename,autoFocus:!0,handleRename:()=>onRename(model,tabName),onKeyDown:e=>{"Enter"===e.key?handleRename():"Escape"===e.key&&setIsEditing(!1)}}):(0,jsx_runtime.jsx)("div",{onDoubleClick:()=>{!model.view&&setIsEditing(!isEditing)},className:"flex-grow text-left whitespace-pre",children:tabName}),onClear&&(0,jsx_runtime.jsx)(src.Jp,{onClick:e=>{e.stopPropagation(),onClear(model)},size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{})})]})}},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.3_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/DataGrid.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".rdg-cell{border-block-end:1px solid var(--border);border-right:0;font-size:.75rem}.rdg-row .hover-actions-cell{opacity:0;transition:opacity .2s ease}.rdg-row:hover{cursor:pointer}.rdg-row:hover .hover-actions-cell{opacity:1}.RowDetailsModal .LemonTable__content table td{max-width:0}",""]),module.exports=exports},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.3_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/EditorScene.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".EditorScene .LemonTabs__bar{--lemon-tabs-slider-width:0px;margin-bottom:0}.EditorScene .OutputPane .LemonTabs{align-self:center}.EditorScene .OutputPane .LemonTabs__bar:before{display:none}",""]),module.exports=exports}}]);