(window.webpackJsonp=window.webpackJsonp||[]).push([[240],{"./frontend/src/scenes/feature-flags/FeatureFlag.tsx":function(Q,A,a){"use strict";a.r(A),a.d(A,"scene",function(){return Tt}),a.d(A,"FeatureFlag",function(){return w});var Z=a("./node_modules/core-js/modules/es.array.concat.js"),ke=a("./node_modules/core-js/modules/es.array.map.js"),Ie=a("./node_modules/core-js/modules/es.object.to-string.js"),qe=a("./node_modules/core-js/modules/es.regexp.to-string.js"),fe=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),ge=a.n(fe),M=a("./node_modules/react/index.js"),e=a.n(M),k=a("./node_modules/kea-forms/lib/index.js"),L=a("./node_modules/antd/es/button/index.js"),V=a("./node_modules/antd/es/row/index.js"),C=a("./node_modules/antd/es/col/index.js"),G=a("./node_modules/antd/es/input/index.js"),z=a("./node_modules/antd/es/collapse/index.js"),ve=a("./node_modules/antd/es/popconfirm/index.js"),_e=a("./node_modules/antd/es/radio/index.js"),pe=a("./node_modules/antd/es/slider/index.js"),Ee=a("./node_modules/antd/es/input-number/index.js"),J=a("./node_modules/antd/es/select/index.js"),Y=a("./node_modules/antd/es/card/index.js"),I=a("./node_modules/kea/lib/index.esm.js"),S=a("./frontend/src/lib/utils.tsx"),ye=a("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),he=a("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),q=a("./node_modules/@ant-design/icons/es/icons/SaveOutlined.js"),K=a("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917.7 148.8l-42.4-42.4c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-76.1 76.1a199.27 199.27 0 00-112.1-34.3c-51.2 0-102.4 19.5-141.5 58.6L432.3 308.7a8.03 8.03 0 000 11.3L704 591.7c1.6 1.6 3.6 2.3 5.7 2.3 2 0 4.1-.8 5.7-2.3l101.9-101.9c68.9-69 77-175.7 24.3-253.5l76.1-76.1c3.1-3.2 3.1-8.3 0-11.4zM578.9 546.7a8.03 8.03 0 00-11.3 0L501 613.3 410.7 523l66.7-66.7c3.1-3.1 3.1-8.2 0-11.3L441 408.6a8.03 8.03 0 00-11.3 0L363 475.3l-43-43a7.85 7.85 0 00-5.7-2.3c-2 0-4.1.8-5.7 2.3L206.8 534.2c-68.9 68.9-77 175.7-24.3 253.5l-76.1 76.1a8.03 8.03 0 000 11.3l42.4 42.4c1.6 1.6 3.6 2.3 5.7 2.3s4.1-.8 5.7-2.3l76.1-76.1c33.7 22.9 72.9 34.3 112.1 34.3 51.2 0 102.4-19.5 141.5-58.6l101.9-101.9c3.1-3.1 3.1-8.2 0-11.3l-43-43 66.7-66.7c3.1-3.1 3.1-8.2 0-11.3l-36.6-36.2z"}}]},name:"api",theme:"filled"},ee=Fe,te=a("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),ae=function(t,r){return M.createElement(te.a,Object(K.a)(Object(K.a)({},t),{},{ref:r,icon:ee}))};ae.displayName="ApiFilled";var je=M.forwardRef(ae),Oe=a("./node_modules/@ant-design/icons/es/icons/LockOutlined.js"),h={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482.2 508.4L331.3 389c-3-2.4-7.3-.2-7.3 3.6V478H184V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H144c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H184V546h140v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM880 116H596c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H700v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h140v294H636V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"merge-cells",theme:"outlined"},g=h,E=function(t,r){return M.createElement(te.a,Object(K.a)(Object(K.a)({},t),{},{ref:r,icon:g}))};E.displayName="MergeCellsOutlined";var F=M.forwardRef(E),j=a("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),B=a("./node_modules/core-js/modules/es.array.every.js"),$=a("./node_modules/core-js/modules/es.array.filter.js"),ne=a("./node_modules/core-js/modules/es.array.find.js"),T=a("./node_modules/core-js/modules/es.array.for-each.js"),re=a("./node_modules/core-js/modules/es.array.iterator.js"),et=a("./node_modules/core-js/modules/es.array.reduce.js"),W=a("./node_modules/core-js/modules/es.array.splice.js"),Ce=a("./node_modules/core-js/modules/es.function.name.js"),Ht=a("./node_modules/core-js/modules/es.regexp.exec.js"),zt=a("./node_modules/core-js/modules/es.string.match.js"),Jt=a("./node_modules/core-js/modules/es.string.replace.js"),Yt=a("./node_modules/core-js/modules/web.dom-collections.for-each.js"),wt=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),tt=a("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),at=a.n(tt),nt=a("./node_modules/@babel/runtime/regenerator/index.js"),_=a.n(nt),Xt=a("./node_modules/regenerator-runtime/runtime.js"),rt=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),le=a.n(rt),lt=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),D=a.n(lt),ot=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),De=a.n(ot),Se=a("./frontend/src/lib/api.ts"),Re=a("./node_modules/kea-router/lib/index.js"),oe=a("./frontend/src/scenes/urls.ts"),Ne=a("./frontend/src/scenes/teamLogic.ts"),Te=a("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),Ve=a("./frontend/src/models/groupsModel.ts"),Ke=a("./frontend/src/lib/components/TaxonomicFilter/types.ts"),st=a("./frontend/src/lib/components/lemonToast.tsx");function Be(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);t&&(l=l.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),r.push.apply(r,l)}return r}function o(n){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Be(Object(r),!0).forEach(function(l){De()(n,l,r[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Be(Object(r)).forEach(function(l){Object.defineProperty(n,l,Object.getOwnPropertyDescriptor(r,l))})}return n}var be={id:null,created_at:null,key:"",name:"",filters:{groups:[{properties:[],rollout_percentage:null}],multivariate:null},deleted:!1,active:!0,created_by:null,is_simple_flag:!1,rollout_percentage:null},it={key:"",name:"",rollout_percentage:0},ut={variants:[{key:"",name:"",rollout_percentage:100}]},se=Object(I.kea)({path:function(t){return["scenes","feature-flags","featureFlagLogic",t]},props:{},key:function(t){var r=t.id;return r!=null?r:"new"},connect:{values:[Ne.a,["currentTeamId"],Ve.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]]},actions:{setFeatureFlag:function(t){return{featureFlag:t}},addConditionSet:!0,setAggregationGroupTypeIndex:function(t){return{value:t}},removeConditionSet:function(t){return{index:t}},duplicateConditionSet:function(t){return{index:t}},updateConditionSet:function(t,r,l){return{index:t,newRolloutPercentage:r,newProperties:l}},deleteFeatureFlag:function(t){return{featureFlag:t}},setMultivariateEnabled:function(t){return{enabled:t}},setMultivariateOptions:function(t){return{multivariateOptions:t}},addVariant:!0,removeVariant:function(t){return{index:t}},distributeVariantsEqually:!0},forms:function(t){var r=t.actions;return{featureFlag:{defaults:o({},be),validator:function(i){var s,u,m,c=i.key,O=i.filters;return{key:c?!((s=c.match)===null||s===void 0)&&s.call(c,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key",filters:{multivariate:{variants:O==null||(u=O.multivariate)===null||u===void 0||(m=u.variants)===null||m===void 0?void 0:m.map(function(y){var U,p=y.key;return{key:p?!((U=p.match)===null||U===void 0)&&U.call(p,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key"}})}}}},submit:function(i){r.saveFeatureFlag(i)}}}},reducers:{featureFlag:[o({},be),{setFeatureFlag:function(t,r){var l=r.featureFlag;if(l.filters.groups){var i=l.filters.groups.map(function(s){return s.properties?o(o({},s),{},{properties:Object(S.s)(s.properties)}):s});return o(o({},l),{},{filters:o(o({},l==null?void 0:l.filters),{},{groups:i})})}return l},addConditionSet:function(t){if(!t)return t;var r=[].concat(D()(t==null?void 0:t.filters.groups),[{properties:[],rollout_percentage:null}]);return o(o({},t),{},{filters:o(o({},t.filters),{},{groups:r})})},updateConditionSet:function(t,r){var l=r.index,i=r.newRolloutPercentage,s=r.newProperties;if(!t)return t;var u=D()(t==null?void 0:t.filters.groups);return i!==void 0&&(u[l]=o(o({},u[l]),{},{rollout_percentage:i})),s!==void 0&&(u[l]=o(o({},u[l]),{},{properties:s})),o(o({},t),{},{filters:o(o({},t.filters),{},{groups:u})})},removeConditionSet:function(t,r){var l=r.index;if(!t)return t;var i=D()(t.filters.groups);return i.splice(l,1),o(o({},t),{},{filters:o(o({},t.filters),{},{groups:i})})},duplicateConditionSet:function(t,r){var l=r.index;if(!t)return t;var i=t.filters.groups.concat([t.filters.groups[l]]);return o(o({},t),{},{filters:o(o({},t.filters),{},{groups:i})})},setMultivariateOptions:function(t,r){var l=r.multivariateOptions;return t&&o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:l})})},addVariant:function(t){var r;if(!t)return t;var l=D()(((r=t.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]);return o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate||{}),{},{variants:[].concat(D()(l),[it])})})})},removeVariant:function(t,r){var l,i=r.index;if(!t)return t;var s=D()(((l=t.filters.multivariate)===null||l===void 0?void 0:l.variants)||[]);return s.splice(i,1),o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate),{},{variants:s})})})},distributeVariantsEqually:function(t){var r;if(!t)return t;var l=D()(((r=t.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]),i=l.length;if(i>0&&i<=100){var s=Math.round(100/i),u=s*i,m=u-100;l.forEach(function(c,O){l[O]=o(o({},c),{},{rollout_percentage:s})}),l[i-1]=o(o({},l[i-1]),{},{rollout_percentage:s-m})}return o(o({},t),{},{filters:o(o({},t.filters),{},{multivariate:o(o({},t.filters.multivariate),{},{variants:l})})})},setAggregationGroupTypeIndex:function(t,r){var l=r.value;return!t||t.filters.aggregation_group_type_index==l?t:o(o({},t),{},{filters:o(o({},t.filters),{},{aggregation_group_type_index:l,groups:[{properties:[],rollout_percentage:null}]})})}}]},loaders:function(t){var r=t.values,l=t.props;return{featureFlag:{loadFeatureFlag:function(){var i=le()(_.a.mark(function u(){return _.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(l.id&&l.id!=="new")){c.next=4;break}return c.next=3,Se.a.get("api/projects/".concat(r.currentTeamId,"/feature_flags/").concat(l.id));case 3:return c.abrupt("return",c.sent);case 4:return c.abrupt("return",be);case 5:case"end":return c.stop()}},u)}));function s(){return i.apply(this,arguments)}return s}(),saveFeatureFlag:function(){var i=le()(_.a.mark(function u(m){var c,O,y;return _.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(c=m.created_at,O=m.id,y=at()(m,["created_at","id"]),m.id){p.next=7;break}return p.next=4,Se.a.create("api/projects/".concat(r.currentTeamId,"/feature_flags"),y);case 4:return p.abrupt("return",p.sent);case 7:return p.next=9,Se.a.update("api/projects/".concat(r.currentTeamId,"/feature_flags/").concat(m.id),y);case 9:return p.abrupt("return",p.sent);case 10:case"end":return p.stop()}},u)}));function s(u){return i.apply(this,arguments)}return s}()}}},listeners:function(t){var r=t.actions,l=t.values;return{saveFeatureFlagSuccess:function(s){var u,m=s.featureFlag;st.a.success("Feature flag saved"),(u=Te.a.findMounted())===null||u===void 0||u.actions.updateFlag(m),Re.router.actions.replace(oe.a.featureFlag(m.id))},deleteFeatureFlag:function(){var i=le()(_.a.mark(function u(m){var c;return _.a.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:c=m.featureFlag,Object(S.x)({endpoint:"projects/".concat(l.currentTeamId,"/feature_flags"),object:{name:c.name,id:c.id},callback:function(){var p;c.id&&((p=Te.a.findMounted())===null||p===void 0||p.actions.deleteFlag(c.id)),Re.router.actions.push(oe.a.featureFlags())}});case 2:case"end":return y.stop()}},u)}));function s(u){return i.apply(this,arguments)}return s}(),setMultivariateEnabled:function(){var i=le()(_.a.mark(function u(m){var c;return _.a.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:c=m.enabled,c?r.setMultivariateOptions(ut):r.setMultivariateOptions(null);case 2:case"end":return y.stop()}},u)}));function s(u){return i.apply(this,arguments)}return s}()}},selectors:{multivariateEnabled:[function(n){return[n.featureFlag]},function(n){return!!(n!=null&&n.filters.multivariate)}],variants:[function(n){return[n.featureFlag]},function(n){var t;return(n==null||(t=n.filters.multivariate)===null||t===void 0?void 0:t.variants)||[]}],nonEmptyVariants:[function(n){return[n.variants]},function(n){return n.filter(function(t){var r=t.key;return!!r})}],variantRolloutSum:[function(n){return[n.variants]},function(n){return n.reduce(function(t,r){var l=r.rollout_percentage;return t+l},0)}],areVariantRolloutsValid:[function(n){return[n.variants,n.variantRolloutSum]},function(n,t){return n.every(function(r){var l=r.rollout_percentage;return l>=0&&l<=100})&&t===100}],aggregationTargetName:[function(n){return[n.featureFlag,n.groupTypes,n.aggregationLabel]},function(n,t,r){return n&&n.filters.aggregation_group_type_index!=null&&t.length>0?r(n.filters.aggregation_group_type_index).plural:"users"}],taxonomicGroupTypes:[function(n){return[n.featureFlag,n.groupsTaxonomicTypes]},function(n,t){return n&&n.filters.aggregation_group_type_index!=null&&t.length>0?[t[n.filters.aggregation_group_type_index]]:[Ke.a.PersonProperties,Ke.a.Cohorts]}],breadcrumbs:[function(n){return[n.featureFlag]},function(n){return[{name:"Feature Flags",path:oe.a.featureFlags()}].concat(D()(n?[{name:n.key||"Unnamed"}]:[]))}]},urlToAction:function(t){var r,l=t.actions,i=t.props;return De()({},oe.a.featureFlag((r=i.id)!==null&&r!==void 0?r:"new"),function(s,u,m,c){var O=c.method;O==="PUSH"&&(i.id?l.loadFeatureFlag():l.resetFeatureFlag())})},events:function(t){var r=t.props,l=t.actions;return{afterMount:function(){var s,u=(s=Te.a.findMounted())===null||s===void 0?void 0:s.values.featureFlags.find(function(m){return m.id===r.id});u?l.setFeatureFlag(u):r.id!=="new"&&l.loadFeatureFlag()}}}}),ct=a("./frontend/src/lib/components/PageHeader.tsx"),dt=a("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),mt=a.n(dt),ft=a("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss"),We=a.n(ft),Pe={};Pe.insert="head",Pe.singleton=!1;var Qt=mt()(We.a,Pe),Zt=We.a.locals||{},R=a("./frontend/src/lib/components/icons.tsx"),ie=a("./frontend/src/lib/components/Tooltip.tsx"),H=a("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),ue="?utm_medium=in-product&utm_campaign=feature-flag";function ce(n){var t=n.flagKey;return e.a.createElement(e.a.Fragment,null,e.a.createElement(H.a,{language:H.b.JavaScript,wrap:!0},"if\xA0(posthog.isFeatureEnabled('".concat(t!=null?t:"",`')) {
    // run your activation code here
}`)),e.a.createElement("div",{className:"mt"},"Need more information?"," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/js-integration".concat(ue,"#feature-flags")},"Check the docs ",e.a.createElement(R.IconOpenInNew,null))))}function de(n){var t=n.flagKey;return e.a.createElement(e.a.Fragment,null,e.a.createElement(H.a,{language:H.b.Python,wrap:!0},'if\xA0posthog.feature_enabled("'.concat(t,`", "user_distinct_id"):
    runAwesomeFeature()
`)),e.a.createElement("div",{className:"mt"},"Need more information?"," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/python-integration".concat(ue,"#feature-flags")},"Check the docs ",e.a.createElement(R.IconOpenInNew,null))))}function gt(){var n=Object(I.useValues)(Ne.a),t=n.currentTeam;return e.a.createElement(e.a.Fragment,null,e.a.createElement(H.a,{language:H.b.Bash,wrap:!0},"curl ".concat(window.location.origin,`/decide/ \\
-X POST -H 'Content-Type: application/json' \\
-d '{
    "api_key": "`).concat(t?t.api_token:"[project_api_key]",`",
    "distinct_id": "[user distinct id]"
}'
                `)),e.a.createElement("div",{className:"mt"},"Need more information?"," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/api/feature-flags".concat(ue)},"Check the docs ",e.a.createElement(R.IconOpenInNew,null))))}try{ce.displayName="JSSnippet",ce.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:ce.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(n){}try{de.displayName="PythonSnippet",de.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:de.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(n){}var Ue=a("./frontend/src/lib/components/LemonRow/index.ts"),vt=a("./frontend/src/lib/introductions/GroupsIntroductionOption.tsx"),pt=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Et=a("./frontend/src/scenes/userLogic.ts"),xe=a("./frontend/src/types.ts"),yt=a("./frontend/src/lib/components/Link.tsx"),Ge=a("./frontend/src/lib/components/LemonButton/index.ts"),ht=a("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),Ft=a("./node_modules/@babel/runtime/helpers/extends.js"),jt=a.n(Ft),Ot=a("./node_modules/clsx/dist/clsx.m.js"),Ct=a("./node_modules/kea-forms/lib/components.js"),St=function(t){var r=t.label,l=t.kids,i=t.hint,s=t.error;return e.a.createElement("div",{className:Object(Ot.a)("ant-row","ant-form-item",i||s?"ant-form-item-with-help":"",s?"ant-form-item-has-error":"")},r?e.a.createElement("div",{className:"ant-col ant-form-item-label"},e.a.createElement("label",{htmlFor:String(name),className:"ant-form-item-required",title:typeof r=="string"?r:void 0},r)):null,e.a.createElement("div",{className:"ant-col ant-form-item-control"},e.a.createElement("div",{className:"ant-form-item-control-input"},e.a.createElement("div",{className:"ant-form-item-control-input-content"},l)),i||s?e.a.createElement("div",{className:"ant-form-item-explain ant-form-item-explain-connected"},s?e.a.createElement("div",{role:"alert",className:"ant-form-item-explain-error"},"Error: ",s):null,i?e.a.createElement("div",{role:"alert",className:"ant-form-item-explain-warning"},"Hint: ",i):null):null))},b=function(t){return e.a.createElement(Ct.Field,jt()({},t,{template:St}))};try{b.displayName="Field",b.__docgenInfo={description:"Compatible replacement for Form.Item",displayName:"Field",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/forms/Field.tsx#Field"]={docgenInfo:b.__docgenInfo,name:"Field",path:"frontend/src/lib/forms/Field.tsx#Field"})}catch(n){}var Tt={component:w,logic:se,paramsToProps:function(t){var r=t.params.id;return{id:r&&r!=="new"?parseInt(r):"new"}}};function $e(n){setTimeout(function(){var t;return(t=document.querySelector('.variant-form-list input[data-key-index="'.concat(n,'"]')))===null||t===void 0?void 0:t.focus()},50)}function w(){var n,t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=r.id,i={id:l&&l!=="new"?parseInt(l):"new"},s=Object(I.useValues)(se(i)),u=s.featureFlag,m=s.multivariateEnabled,c=s.variants,O=s.nonEmptyVariants,y=s.areVariantRolloutsValid,U=s.variantRolloutSum,p=s.groupTypes,X=s.aggregationTargetName,bt=s.taxonomicGroupTypes,Pt=s.featureFlagLoading,P=Object(I.useActions)(se(i)),xt=P.addConditionSet,He=P.updateConditionSet,At=P.removeConditionSet,Mt=P.duplicateConditionSet,Lt=P.deleteFeatureFlag,ze=P.setMultivariateEnabled,It=P.addVariant,_t=P.removeVariant,Dt=P.distributeVariantsEqually,Rt=P.setAggregationGroupTypeIndex,Je=Object(I.useValues)(Ve.a),Nt=Je.showGroupsOptions,Vt=Je.aggregationLabel,Ye=Object(I.useValues)(Et.a),Ae=Ye.hasAvailableFeature,Kt=Ye.upgradeLink,Bt=Object(M.useState)(!1),we=ge()(Bt,2),Xe=we[0],Wt=we[1],Ut=Object(M.useState)(!1),Qe=ge()(Ut,2),Gt=Qe[0],Me=Qe[1],$t=Object(vt.a)({value:-2});return e.a.createElement("div",{className:"feature-flag"},u?e.a.createElement(k.Form,{logic:se,props:i,formKey:"featureFlag",className:"ant-form-vertical ant-form-hide-required-mark"},e.a.createElement(ct.a,{title:"Feature Flag",buttons:e.a.createElement("div",{style:{display:"flex"}},e.a.createElement(b,{name:"active"},function(f){var d=f.value,v=f.onValueChange;return e.a.createElement(ht.a,{checked:d,onChange:v,label:d?e.a.createElement("span",{className:"text-success"},"Enabled"):e.a.createElement("span",{className:"text-danger"},"Disabled")})}),(u==null?void 0:u.id)&&e.a.createElement(L.a,{"data-attr":"delete-flag",danger:!0,icon:e.a.createElement(he.a,null),onClick:function(){Lt(u)},style:{marginRight:16}},"Delete"),e.a.createElement(L.a,{icon:e.a.createElement(q.a,null),type:"primary","data-attr":"feature-flag-submit",loading:Pt,htmlType:"submit"},"Save changes"))}),e.a.createElement("h3",{className:"l3"},"General configuration"),e.a.createElement("div",{className:"text-muted mb"},"General settings for your feature flag and integration instructions."),e.a.createElement(V.a,{gutter:16,style:{marginBottom:32}},e.a.createElement(C.a,{span:12},e.a.createElement(b,{name:"key",label:"Key (must be unique)",validateStatus:Xe?"warning":void 0,hint:Xe&&l!=="new"?e.a.createElement("small",null,e.a.createElement("b",null,"Warning! "),"Changing this key will",e.a.createElement("a",{href:"https://posthog.com/docs/features/feature-flags".concat(ue,"#feature-flag-persistence"),target:"_blank",rel:"noopener"}," ","affect the persistence of your flag ",e.a.createElement(R.IconOpenInNew,null))):void 0},function(f){var d=f.value,v=f.onChange;return e.a.createElement(G.a,{value:d,onChange:function(x){x.target.value!==d&&Wt(!0),v(x)},"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),e.a.createElement(b,{name:"name",label:"Description"},function(f){var d=f.value,v=f.onChange;return e.a.createElement(G.a.TextArea,{value:d,onChange:v,className:"ph-ignore-input","data-attr":"feature-flag-description",placeholder:"Adding a helpful description can ensure others know what this feature is for."})})),e.a.createElement(C.a,{span:12,style:{paddingTop:31}},e.a.createElement(z.a,null,e.a.createElement(z.a.Panel,{header:e.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},e.a.createElement(R.IconJavascript,{style:{marginRight:6}})," Javascript integration instructions"),key:"js"},e.a.createElement(ce,{flagKey:u.key||"my-flag"})),e.a.createElement(z.a.Panel,{header:e.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},e.a.createElement(R.IconPython,{style:{marginRight:6}})," Python integration instructions"),key:"python"},e.a.createElement(de,{flagKey:u.key||"my-flag"})),e.a.createElement(z.a.Panel,{header:e.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},e.a.createElement(je,{style:{marginRight:6}})," API integration instructions"),key:"api"},e.a.createElement(gt,null))))),e.a.createElement("div",{className:"mb-2"},e.a.createElement("h3",{className:"l3"},"Served value"),e.a.createElement("div",{className:"mb-05"},e.a.createElement(ve.a,{placement:"top",title:"Change value type? The variants below will be lost.",visible:Gt,onConfirm:function(){ze(!1),Me(!1)},onCancel:function(){return Me(!1)},okText:"OK",cancelText:"Cancel"},e.a.createElement(_e.a.Group,{options:[{label:"Boolean value (A/B test)",value:!1},{label:e.a.createElement(ie.a,{title:Ae(xe.c.MULTIVARIATE_FLAGS)?"":"This feature is not available on your current plan."},e.a.createElement("div",null,!Ae(xe.c.MULTIVARIATE_FLAGS)&&e.a.createElement(yt.a,{to:Kt,target:"_blank"},e.a.createElement(Oe.a,{style:{marginRight:4,color:"var(--warning)"}})),"String value (Multivariate test)"," ",e.a.createElement(pt.a,{type:"warning"},"Beta"))),value:!0,disabled:!Ae(xe.c.MULTIVARIATE_FLAGS)}],onChange:function(d){var v=d.target.value;v===!1&&O.length?Me(!0):(ze(v),$e(0))},value:m,optionType:"button"}))),e.a.createElement("div",{className:"text-muted mb"},Object(S.j)(X)," will be served"," ",m?e.a.createElement(e.a.Fragment,null,e.a.createElement("strong",null,"a variant key")," according to the below distribution"):e.a.createElement("strong",null,e.a.createElement("code",null,"true"))," ","if they match one or more release condition groups."),m&&e.a.createElement("div",{className:"variant-form-list"},e.a.createElement(V.a,{gutter:8,className:"label-row"},e.a.createElement(C.a,{span:7},"Variant key"),e.a.createElement(C.a,{span:7},"Description"),e.a.createElement(C.a,{span:9},e.a.createElement("span",null,"Rollout percentage"),e.a.createElement(L.a,{type:"link",onClick:Dt,icon:e.a.createElement(F,null),style:{padding:"0 0 0 0.5em"},title:"Distribute variants equally"},"Distribute"))),c.map(function(f,d){return e.a.createElement(k.Group,{key:d,name:["filters","multivariate","variants",d]},e.a.createElement(V.a,{gutter:8},e.a.createElement(C.a,{span:7},e.a.createElement(b,{name:"key"},e.a.createElement(G.a,{"data-attr":"feature-flag-variant-key","data-key-index":d.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(d+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}))),e.a.createElement(C.a,{span:7},e.a.createElement(b,{name:"name"},e.a.createElement(G.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"}))),e.a.createElement(C.a,{span:7},e.a.createElement(b,{name:"rollout_percentage"},function(v){var N=v.value,x=v.onValueChange;return e.a.createElement(pe.a,{tooltipPlacement:"top",value:N,onChange:x})})),e.a.createElement(C.a,{span:2},e.a.createElement(b,{name:"rollout_percentage"},function(v){var N=v.value,x=v.onValueChange;return e.a.createElement(Ee.a,{min:0,max:100,value:N,onChange:function(Le){if(Le!=null){var Ze=parseInt(Le.toString());isNaN(Ze)||x(Ze)}},style:{width:"100%",borderColor:y?void 0:"var(--danger)"}})})),c.length>1&&e.a.createElement(C.a,{span:1},e.a.createElement(ie.a,{title:"Delete this variant",placement:"bottomLeft"},e.a.createElement(L.a,{type:"link",icon:e.a.createElement(he.a,null),onClick:function(){return _t(d)},style:{color:"var(--danger)"}})))))}),c.length>0&&!y&&e.a.createElement("p",{className:"text-danger"},"Percentage rollouts for variants must sum to 100 (currently ",U,")."),e.a.createElement(L.a,{type:"dashed",block:!0,icon:e.a.createElement(j.a,null),onClick:function(){var d=c.length;It(),$e(d)},style:{marginBottom:16}},"Add Variant"))),e.a.createElement("div",{className:"feature-flag-form-row"},e.a.createElement("div",null,e.a.createElement("h3",{className:"l3"},"Release conditions"),e.a.createElement("div",{className:"text-muted mb"},"Specify the ",X," to which you want to release this flag. Note that condition sets are rolled out independently of each other.")),Nt&&e.a.createElement("div",{className:"centered"},"Match by",e.a.createElement(J.a,{value:((n=u.filters)===null||n===void 0?void 0:n.aggregation_group_type_index)!=null?(t=u.filters)===null||t===void 0?void 0:t.aggregation_group_type_index:-1,onChange:function(d){var v=d!==-1?d:null;Rt(v)},style:{marginLeft:8},"data-attr":"feature-flag-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]}},e.a.createElement(J.a.Option,{key:-1,value:-1},"Users"),p.map(function(f){return e.a.createElement(J.a.Option,{key:f.group_type_index,value:f.group_type_index},Object(S.j)(Vt(f.group_type_index).plural))}),$t))),e.a.createElement(V.a,{gutter:16},u.filters.groups.map(function(f,d){var v,N;return e.a.createElement(C.a,{span:24,md:24,key:"".concat(d,"-").concat(u.filters.groups.length)},d>0&&e.a.createElement("div",{style:{display:"flex",marginLeft:16}},e.a.createElement("div",{className:"stateful-badge or-light-grey mb"},"OR")),e.a.createElement(Y.a,{style:{marginBottom:16}},e.a.createElement("div",{className:"feature-flag-form-row",style:{height:24}},e.a.createElement("div",null,e.a.createElement("span",{className:"simple-tag tag-light-blue",style:{marginRight:8}},"Set ",d+1),!((v=f.properties)===null||v===void 0)&&v.length?e.a.createElement(e.a.Fragment,null,"Matching ",e.a.createElement("b",null,X)," with filters"):e.a.createElement(e.a.Fragment,null,"Condition set will match ",e.a.createElement("b",null,"all ",X))),e.a.createElement(V.a,{align:"middle"},e.a.createElement(ie.a,{title:"Duplicate this condition set",placement:"bottomLeft"},e.a.createElement(Ge.a,{icon:e.a.createElement(R.IconCopy,null),compact:!0,onClick:function(){return Mt(d)}})),u.filters.groups.length>1&&e.a.createElement(ie.a,{title:"Delete this condition set",placement:"bottomLeft"},e.a.createElement(Ge.a,{icon:e.a.createElement(R.IconDelete,null),compact:!0,onClick:function(){return At(d)}})))),e.a.createElement(Ue.b,{large:!0}),e.a.createElement(ye.a,{style:{marginLeft:15},pageKey:"feature-flag-".concat(u.id,"-").concat(d,"-").concat(u.filters.groups.length,"-").concat((N=u.filters.aggregation_group_type_index)!==null&&N!==void 0?N:""),propertyFilters:f==null?void 0:f.properties,onChange:function(me){return He(d,void 0,me)},taxonomicGroupTypes:bt,showConditionBadge:!0}),e.a.createElement(Ue.b,{large:!0}),e.a.createElement("div",{className:"feature-flag-form-row"},e.a.createElement("div",{className:"centered"},"Roll out to"," ",e.a.createElement(Ee.a,{style:{width:100,marginLeft:8,marginRight:8},onChange:function(me){He(d,me)},value:f.rollout_percentage!=null?f.rollout_percentage:100,min:0,max:100,addonAfter:"%"})," ","of ",e.a.createElement("b",null,X)," in this set"))))})),e.a.createElement(Y.a,{size:"small",style:{marginBottom:16}},e.a.createElement(L.a,{type:"link",onClick:xt,style:{marginLeft:5}},e.a.createElement(j.a,{style:{marginRight:15}})," Add condition set")),e.a.createElement("div",{className:"text-right"},e.a.createElement(L.a,{icon:e.a.createElement(q.a,null),htmlType:"submit",type:"primary","data-attr":"feature-flag-submit-bottom"},"Save changes"))):e.a.createElement(S.c,null))}try{w.displayName="FeatureFlag",w.__docgenInfo={description:"",displayName:"FeatureFlag",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"]={docgenInfo:w.__docgenInfo,name:"FeatureFlag",path:"frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"})}catch(n){}},"./frontend/src/scenes/feature-flags/featureFlagsLogic.ts":function(Q,A,a){"use strict";a.d(A,"a",function(){return Oe});var Z=a("./node_modules/core-js/modules/es.array.concat.js"),ke=a.n(Z),Ie=a("./node_modules/core-js/modules/es.array.filter.js"),qe=a.n(Ie),fe=a("./node_modules/core-js/modules/es.array.find.js"),ge=a.n(fe),M=a("./node_modules/core-js/modules/es.array.iterator.js"),e=a.n(M),k=a("./node_modules/core-js/modules/es.array.map.js"),L=a.n(k),V=a("./node_modules/core-js/modules/es.object.to-string.js"),C=a.n(V),G=a("./node_modules/core-js/modules/es.regexp.exec.js"),z=a.n(G),ve=a("./node_modules/core-js/modules/es.string.search.js"),_e=a.n(ve),pe=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Ee=a.n(pe),J=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Y=a.n(J),I=a("./node_modules/@babel/runtime/regenerator/index.js"),S=a.n(I),ye=a("./node_modules/regenerator-runtime/runtime.js"),he=a.n(ye),q=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),K=a.n(q),Fe=a("./node_modules/kea/lib/index.esm.js"),ee=a("./frontend/src/lib/api.ts"),te=a("./node_modules/fuse.js/dist/fuse.esm.js"),ae=a("./frontend/src/scenes/teamLogic.ts"),je=a("./frontend/src/scenes/urls.ts"),Oe=Object(Fe.kea)({path:["scenes","feature-flags","featureFlagsLogic"],connect:{values:[ae.a,["currentTeamId"]]},actions:{updateFlag:function(g){return{flag:g}},deleteFlag:function(g){return{id:g}},setSearchTerm:function(g){return{searchTerm:g}}},loaders:function(g){var E=g.values;return{featureFlags:{__default:[],loadFeatureFlags:function(){var F=K()(S.a.mark(function B(){var $;return S.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,ee.a.get("api/projects/".concat(E.currentTeamId,"/feature_flags/"));case 2:return $=T.sent,T.abrupt("return",$.results);case 4:case"end":return T.stop()}},B)}));function j(){return F.apply(this,arguments)}return j}(),updateFeatureFlag:function(){var F=K()(S.a.mark(function B($){var ne,T,re;return S.a.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return ne=$.id,T=$.payload,W.next=3,ee.a.update("api/projects/".concat(E.currentTeamId,"/feature_flags/").concat(ne),T);case 3:return re=W.sent,W.abrupt("return",Y()(E.featureFlags).map(function(Ce){return Ce.id===re.id?re:Ce}));case 5:case"end":return W.stop()}},B)}));function j(B){return F.apply(this,arguments)}return j}()}}},selectors:{searchedFeatureFlags:[function(h){return[h.featureFlags,h.searchTerm]},function(h,g){return g?new te.a(h,{keys:["key","name"],threshold:.3}).search(g).map(function(E){return E.item}):h}],breadcrumbs:[function(){return[]},function(){return[{name:"Feature Flags",path:je.a.featureFlags()}]}]},reducers:{searchTerm:{setSearchTerm:function(g,E){var F=E.searchTerm;return F}},featureFlags:{updateFlag:function(g,E){var F=E.flag;return g.find(function(j){var B=j.id;return B===F.id})?g.map(function(j){return j.id===F.id?F:j}):[F].concat(Y()(g))},deleteFlag:function(g,E){var F=E.id;return g.filter(function(j){return j.id!==F})}}},events:function(g){var E=g.actions;return{afterMount:function(){E.loadFeatureFlags()}}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss":function(Q,A,a){var Z=a("./node_modules/css-loader/dist/runtime/api.js");A=Z(!1),A.push([Q.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.feature-flag .LemonSwitch{margin-right:1rem!important}.variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{margin-bottom:4px;font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}.feature-flag-form-row{display:flex;justify-content:space-between;align-items:center;width:100%}.feature-flag-form-row .centered{display:flex;align-items:center;white-space:pre-wrap}",""]),Q.exports=A}}]);
