(window.webpackJsonp=window.webpackJsonp||[]).push([[257],{"./frontend/src/scenes/annotations/Annotations.tsx":function(sn,N,n){"use strict";n.r(N),n.d(N,"scene",function(){return on}),n.d(N,"Annotations",function(){return Y});var rn=n("./node_modules/core-js/modules/es.function.name.js"),G=n("./node_modules/react/index.js"),t=n.n(G),l=n("./node_modules/kea/lib/index.esm.js"),J=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),K=n.n(J),U=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),M=n.n(U),k=n("./node_modules/@babel/runtime/regenerator/index.js"),P=n.n(k),ln=n("./node_modules/core-js/modules/es.array.iterator.js"),cn=n("./node_modules/core-js/modules/es.object.to-string.js"),dn=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),z=n("./frontend/src/lib/api.ts"),o=n("./frontend/src/types.ts"),V=n("./node_modules/kea-forms/lib/index.js"),T=n("./frontend/src/lib/dayjs.ts"),D=n("./frontend/src/models/annotationsModel.ts"),b,E,F="MMMM\xA0DD,\xA0YYYY h:mm\xA0A",x=(b={},M()(b,o.c.Insight,"Insight"),M()(b,o.c.Project,"Project"),M()(b,o.c.Organization,"Organization"),b),B=(E={},M()(E,o.c.Insight,0),M()(E,o.c.Project,1),M()(E,o.c.Organization,2),E),h=Object(l.kea)([Object(l.path)(["scenes","annotations","annotationsPageLogic"]),Object(l.connect)({actions:[D.a,["loadAnnotationsNext","replaceAnnotation","appendAnnotations","deleteAnnotation"]],values:[D.a,["annotations","annotationsLoading","next","loadingNext"]]}),Object(l.actions)({openModalToCreateAnnotation:function(){return!0},openModalToEditAnnotation:function(r){return{annotation:r}},closeModal:!0}),Object(l.reducers)(function(){return{isModalOpen:[!1,{openModalToCreateAnnotation:function(){return!0},openModalToEditAnnotation:function(){return!0},closeModal:function(){return!1}}],existingModalAnnotation:[null,{openModalToCreateAnnotation:function(){return null},openModalToEditAnnotation:function(r,e){var c=e.annotation;return c}}]}}),Object(l.listeners)(function(a){var r=a.actions;return{openModalToEditAnnotation:function(c){var s=c.annotation,d=s.date_marker,f=s.scope,p=s.content;r.setAnnotationModalValues({dateMarker:Object(T.a)(d),scope:f,content:p})},openModalToCreateAnnotation:function(){r.resetAnnotationModal()}}}),Object(V.forms)(function(a){var r=a.actions,e=a.values;return{annotationModal:{defaults:{dateMarker:Object(T.a)(),content:"",scope:o.c.Project},errors:function(s){var d=s.content;return{content:d?null:"An annotation must have text content."}},submit:function(){var c=K()(P.a.mark(function d(f){var p,u,g,O,C;return P.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(p=f.dateMarker,u=f.content,g=f.scope,!e.existingModalAnnotation){m.next=8;break}return m.next=4,z.b.annotations.update(e.existingModalAnnotation.id,{date_marker:p.toISOString(),content:u,scope:g});case 4:O=m.sent,r.replaceAnnotation(O),m.next=12;break;case 8:return m.next=10,z.b.annotations.create({date_marker:p.toISOString(),content:u,scope:g});case 10:C=m.sent,r.appendAnnotations([C]);case 12:r.closeModal();case 13:case"end":return m.stop()}},d)}));function s(d){return c.apply(this,arguments)}return s}()}}})]),H=n("./frontend/src/lib/components/PageHeader.tsx"),$=n("./frontend/src/lib/components/LemonTable/index.ts"),R=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),L=n("./frontend/src/lib/components/LemonButton/index.ts"),Q=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),y=n("./frontend/src/lib/components/icons.tsx"),v=n("./frontend/@posthog/lemon-ui/src/index.ts"),X=n("./frontend/src/scenes/urls.ts"),Z=n("./frontend/src/lib/components/Tooltip.tsx"),w=n("./frontend/src/scenes/teamLogic.tsx"),q=n("./frontend/src/scenes/organizationLogic.tsx"),_=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),nn=n.n(_),mn=n("./node_modules/core-js/modules/es.array.concat.js"),I=n("./frontend/src/lib/forms/Field.tsx"),tn=n("./frontend/src/lib/components/DatePicker.tsx");function en(){var a=Object(l.useValues)(h),r=a.isModalOpen,e=a.existingModalAnnotation,c=a.isAnnotationModalSubmitting,s=Object(l.useActions)(h),d=s.closeModal,f=s.deleteAnnotation,p=s.submitAnnotationModal,u=(e==null?void 0:e.scope)===o.c.Insight;return t.a.createElement(v.LemonModal,{isOpen:r,onClose:d,title:e?"Edit annotation":"New annotation",description:"Use annotations to add context to insights and dashboards.",footer:t.a.createElement("div",{className:"flex-1 flex items-center justify-between"},t.a.createElement("div",{className:"flex items-center gap-2"},e&&t.a.createElement(v.LemonButton,{form:"annotation-modal-form",type:"secondary",status:"danger",onClick:function(){f(e),d()},"data-attr":"delete-annotation"},"Delete annotation")),t.a.createElement("div",{className:"flex items-center gap-2"},t.a.createElement(v.LemonButton,{form:"annotation-modal-form",type:"secondary",onClick:d},"Cancel"),t.a.createElement(v.LemonButton,{form:"annotation-modal-form",htmlType:"submit",type:"primary",loading:c,"data-attr":"create-annotation-submit"},e?"Edit":"Create")))},t.a.createElement(V.Form,{logic:h,formKey:"annotationModal",id:"annotation-modal-form",enableFormOnSubmit:!0,className:"space-y-4"},t.a.createElement("div",{className:"flex gap-2"},t.a.createElement(I.a,{name:"dateMarker",label:"Date\xA0and\xA0time",className:"flex-1"},t.a.createElement(tn.a,{className:"h-10",allowClear:!1,showTime:!0,showSecond:!1,format:F})),t.a.createElement(I.a,{name:"scope",label:"Scope",className:"flex-1"},t.a.createElement(v.LemonSelect,{options:[].concat(nn()((e==null?void 0:e.scope)===o.c.Insight?[{value:o.c.Insight,label:x[o.c.Insight]}]:[]),[{value:o.c.Project,label:x[o.c.Project],sideIcon:u?t.a.createElement(y.IconWarning,null):void 0,tooltip:u?"After saving, it won't be possible to make the annotation insight-scoped again.":void 0},{value:o.c.Organization,label:x[o.c.Organization],sideIcon:u?t.a.createElement(y.IconWarning,null):void 0,tooltip:u?"After saving, it won't be possible to make the annotation insight-scoped again.":void 0}]),fullWidth:!0}))),t.a.createElement(I.a,{name:"content",label:"Content"},t.a.createElement(v.LemonTextArea,{placeholder:"What's this annotation about?",onPressCmdEnter:p,"data-attr":"create-annotation-input"}))))}var on={component:Y,logic:h};function Y(){var a=Object(l.useValues)(w.a),r=a.currentTeam,e=Object(l.useValues)(q.a),c=e.currentOrganization,s=Object(l.useValues)(h),d=s.annotations,f=s.annotationsLoading,p=s.next,u=s.loadingNext,g=Object(l.useActions)(h),O=g.loadAnnotationsNext,C=g.openModalToCreateAnnotation,W=g.openModalToEditAnnotation,m=[{title:"Annotation",key:"annotation",width:"30%",render:function(A,i){return t.a.createElement("div",{className:"ph-no-capture"},i.content)}},{title:"Date\xA0and\xA0time",dataIndex:"date_marker",render:function(A,i){return Object(T.a)(i.date_marker).format(F)},sorter:function(A,i){return Object(T.a)(A.date_marker).diff(i.date_marker)}},{title:"Scope",key:"scope",render:function(A,i){var S=x[i.scope],an=i.scope===o.c.Insight?'This annotation only applies to the "'.concat(i.insight_name,'" insight'):i.scope===o.c.Project?"This annotation applies to all insights in the ".concat(r==null?void 0:r.name," project"):"This annotation applies to all insights in the ".concat(c==null?void 0:c.name," organization");return t.a.createElement(Z.a,{title:an,placement:"right"},t.a.createElement(Q.a,null,i.scope===o.c.Insight?t.a.createElement(v.Link,{to:X.a.insightView(i.insight_short_id),className:"flex items-center",target:"_blank"},S,t.a.createElement(y.IconOpenInNew,{className:"ml-1"})):S))},sorter:function(A,i){return B[A.scope]-B[i.scope]}},Object(R.b)(),Object(R.a)(),{key:"actions",width:0,render:function(A,i){return t.a.createElement(L.a,{icon:t.a.createElement(y.IconEdit,null),size:"small",type:"tertiary",status:"stealth",onClick:function(){return W(i)}})}}];return t.a.createElement(t.a.Fragment,null,t.a.createElement(H.a,{title:"Annotations",caption:t.a.createElement(t.a.Fragment,null,"Annotations add time-specific context to insights and dashboards.",t.a.createElement("br",null),"Manage all of this project's annotations from this page."),buttons:t.a.createElement(L.a,{type:"primary","data-attr":"create-annotation",onClick:C},"New annotation")}),t.a.createElement($.a,{"data-attr":"annotations-table",rowKey:"id",dataSource:d,columns:m,defaultSorting:{columnKey:"date_marker",order:-1},noSortingCancellation:!0,loading:f,emptyState:"No annotations yet"}),p&&t.a.createElement("div",{className:"flex justify-center mt-6"},t.a.createElement(L.a,{type:"primary",loading:u,onClick:function(){O()}},"Load more annotations")),t.a.createElement(en,null))}}}]);
