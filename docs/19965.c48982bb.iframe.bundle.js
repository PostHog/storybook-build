(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[19965],{"../../frontend/src/scenes/instance/SystemStatus/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SystemStatus:()=>SystemStatus_SystemStatus,scene:()=>scene});var injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),SystemStatus=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/instance/SystemStatus/index.scss"),SystemStatus_default=__webpack_require__.n(SystemStatus),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(SystemStatus_default(),options),SystemStatus_default().locals;var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.26.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),LemonTag=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),LemonCollapse=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonCollapse/index.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),systemStatusLogic=__webpack_require__("../../frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function InternalMetricsTab(){let{openSections,queries,queriesLoading}=(0,index_esm.useValues)(systemStatusLogic.Q),{setOpenSections,loadQueries}=(0,index_esm.useActions)(systemStatusLogic.Q),[showIdle,setShowIdle]=(0,react.useState)(!1),postgresQueries=(0,react.useMemo)(()=>queries?.postgres_running?.filter(_ref=>{let{state}=_ref;return showIdle||"idle"!==state}),[showIdle,queries]),reloadQueries=e=>{e.stopPropagation(),loadQueries()};return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonCollapse.J,{activeKeys:openSections,className:"bg-surface-primary",onChange:keys=>setOpenSections(keys),multiple:!0,panels:[{key:"1",header:"PostgreSQL - currently running queries",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex mb-4 float-right deprecated-space-x-2",children:[(0,jsx_runtime.jsx)(src.Hw,{checked:showIdle,onChange:setShowIdle,label:"Show idle queries"}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",icon:(0,jsx_runtime.jsx)(icons.tr,{}),onClick:reloadQueries,children:"Reload Queries"})]}),(0,jsx_runtime.jsx)(QueryTable,{queries:postgresQueries,loading:queriesLoading})]})},queries?.clickhouse_running!=void 0&&{key:"2",header:"Clickhouse - currently running queries",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex mb-4 float-right",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",icon:(0,jsx_runtime.jsx)(icons.tr,{}),onClick:reloadQueries,children:"Reload Queries"})}),(0,jsx_runtime.jsx)(QueryTable,{queries:queries?.clickhouse_running,loading:queriesLoading})]})},queries?.clickhouse_slow_log!=void 0&&{key:"3",header:"Clickhouse - slow query log (past 6 hours)",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex mb-4 float-right",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",icon:(0,jsx_runtime.jsx)(icons.tr,{}),onClick:reloadQueries,children:"Reload Queries"})}),(0,jsx_runtime.jsx)(QueryTable,{queries:queries?.clickhouse_slow_log,loading:queriesLoading})]})}]})})}function QueryTable(props){let columns=[{title:"duration",dataIndex:"duration",key:"duration",sorter:(a,b)=>+a.duration-+b.duration},{title:"query",dataIndex:"query",render:function RenderAnalyze(_,item){return item.query},key:"query"}];return props.queries&&props.queries.length>0&&Object.keys(props.queries[0]).forEach(column=>{"duration"!==column&&"query"!==column&&columns.push({title:column,dataIndex:column,key:column})}),(0,jsx_runtime.jsx)(src.g3,{dataSource:props.queries||[],columns:columns,loading:props.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",nouns:["query","queries"]})}var Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx");let TIMESTAMP_VALUES=new Set(["last_event_ingested_timestamp"]);function RenderMetricValue(_,_ref){let{key,value,value_type,emptyNullLabel,isSecret}=_ref;return value&&isSecret?(0,jsx_runtime.jsx)(LemonTag.o,{className:"uppercase text-secondary bg-mark",icon:isSecret?(0,jsx_runtime.jsx)(posthog_icons_es.IconLock,{className:"text-warning"}):void 0,children:"Secret"}):key&&TIMESTAMP_VALUES.has(key)&&"string"==typeof value?new Date(value).getTime()===new Date("1970-01-01T00:00:00").getTime()?"Never":(0,jsx_runtime.jsx)(TZLabel.w,{time:value}):"bool"===value_type||"boolean"==typeof value?(0,jsx_runtime.jsx)(LemonTag.o,{className:"uppercase",type:value?"success":"danger",children:value?"Yes":"No"}):null==value||""===value?(0,jsx_runtime.jsx)(LemonTag.o,{className:"uppercase text-secondary",children:null!=emptyNullLabel?emptyNullLabel:"Unknown"}):"int"===value_type||"number"==typeof value?value.toLocaleString("en-US"):value.toString()}let METRIC_KEY_TO_INTERNAL_LINK={async_migrations_ok:"/instance/async_migrations"};function RenderMetric(_,systemStatusRow){return(0,jsx_runtime.jsxs)("span",{children:[systemStatusRow.metric," ",METRIC_KEY_TO_INTERNAL_LINK[systemStatusRow.key]?(0,jsx_runtime.jsx)(Link.r,{to:METRIC_KEY_TO_INTERNAL_LINK[systemStatusRow.key],children:(0,jsx_runtime.jsx)(icons.pF,{style:{verticalAlign:"middle"}})}):null]})}function OverviewTab(){let{overview,systemStatusLoading}=(0,index_esm.useValues)(systemStatusLogic.Q);return(0,jsx_runtime.jsx)(src.g3,{className:"system-status-table",rowKey:"metric",dataSource:overview,columns:[{title:"Metric",className:"metric-column",render:RenderMetric},{title:"Value",render:RenderMetricValue}],loading:systemStatusLoading,expandable:{expandedRowRender:function renderExpand(row){return row.subrows?.rows.length?(0,jsx_runtime.jsx)(Subrows,{...row.subrows}):null},rowExpandable:row=>!!row.subrows?.rows.length}})}function Subrows(props){return(0,jsx_runtime.jsx)(src.g3,{dataSource:props.rows,columns:props.columns.map((title,dataIndex)=>({title,dataIndex})),embedded:!0})}var preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),useKeyboardHotkeys=__webpack_require__("../../frontend/src/lib/hooks/useKeyboardHotkeys.tsx"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts");function ChangeRow(_ref){let{metricKey,oldValue,value,isSecret}=_ref;return value?.toString()===oldValue?.toString()?null:(0,jsx_runtime.jsxs)("div",{className:"bg-border-light radius p-2",children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("code",{children:metricKey})}),(0,jsx_runtime.jsxs)("div",{className:"text-secondary",children:["Value will be changed",!isSecret&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[" from ",(0,jsx_runtime.jsx)("span",{className:"font-bold text-text-3000",children:RenderMetricValue(null,{key:metricKey,value:oldValue,emptyNullLabel:"Unset",isSecret})})]})," to ",(0,jsx_runtime.jsx)("span",{className:"font-bold text-text-3000",children:RenderMetricValue(null,{key:metricKey,value,emptyNullLabel:"Unset"})}),isSecret&&(0,jsx_runtime.jsx)("div",{className:"text-danger",children:"This field is secret - you won't see its value once saved"})]})]})}function InstanceConfigSaveModal(_ref2){let{onClose,isOpen}=_ref2,{instanceConfigEditingState,editableInstanceSettings,updatedInstanceConfigCount}=(0,index_esm.useValues)(systemStatusLogic.Q),{saveInstanceConfig}=(0,index_esm.useActions)(systemStatusLogic.Q),loading=null!==updatedInstanceConfigCount,isChangingEnabledEmailSettings=!1!==instanceConfigEditingState.EMAIL_ENABLED&&Object.keys(instanceConfigEditingState).find(key=>key.startsWith("EMAIL")),isEnablingEmail=!0===instanceConfigEditingState.EMAIL_ENABLED,changeNoun=1===Object.keys(instanceConfigEditingState).length?"change":"changes";return(0,jsx_runtime.jsx)(src.fQ,{title:`Confirm ${changeNoun} to instance configuration`,isOpen:isOpen,closable:!loading,onClose:onClose,width:576,footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:onClose,disabledReason:loading?"Saving in progress":void 0,children:"Cancel"}),(0,jsx_runtime.jsxs)(src.Jp,{type:"secondary",status:"danger",loading:loading,onClick:saveInstanceConfig,children:["Apply ",changeNoun]})]}),children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[isChangingEnabledEmailSettings&&(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",children:["As you are changing email settings and ",isEnablingEmail?"enabling email":"email is enabled",", we'll attempt to send a test email so you can verify everything works."]}),Object.keys(instanceConfigEditingState).includes("RECORDINGS_TTL_WEEKS")&&(0,jsx_runtime.jsx)(LemonBanner.V,{type:"warning",children:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Changing your recordings TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately."})}),Object.keys(instanceConfigEditingState).includes("RECORDINGS_PERFORMANCE_EVENTS_TTL_WEEKS")&&(0,jsx_runtime.jsx)(LemonBanner.V,{type:"warning",children:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Changing your performance events TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately."})}),(0,jsx_runtime.jsxs)("div",{children:["The following ",changeNoun," will be immediately applied to your instance."]}),Object.keys(instanceConfigEditingState).map(key=>(0,jsx_runtime.jsx)(ChangeRow,{metricKey:key,value:instanceConfigEditingState[key],oldValue:editableInstanceSettings.find(record=>record.key===key)?.value,isSecret:editableInstanceSettings.find(record=>record.key===key)?.is_secret},key)),loading&&(0,jsx_runtime.jsx)("div",{className:"mt-4 text-success",children:(0,jsx_runtime.jsxs)("b",{children:[(0,utils.Zi)(updatedInstanceConfigCount||0,"change")," updated successfully."]})})]})})}function RenderMetricValueEdit(_ref){let{key,value,value_type,onValueChanged,isSecret}=_ref;return"bool"===value_type?(0,jsx_runtime.jsx)(src.Hw,{defaultChecked:!!value,onChange:val=>onValueChanged(key,val),label:(0,jsx_runtime.jsx)(LemonTag.o,{type:value?"success":"danger",className:"uppercase",children:value?"Yes":"No"})}):(0,jsx_runtime.jsx)(src.DF,{defaultValue:isSecret&&value?"":value,type:"int"===value_type?"number":"text",placeholder:isSecret&&value?"Keep existing secret value":void 0,onBlur:e=>onValueChanged(key,e.target.value)})}function InstanceConfigTab(){let{configOptions,preflightLoading}=(0,index_esm.useValues)(preflightLogic.preflightLogic),{editableInstanceSettings,instanceSettingsLoading,instanceConfigMode,instanceConfigEditingState}=(0,index_esm.useValues)(systemStatusLogic.Q),{loadInstanceSettings,setInstanceConfigMode,updateInstanceConfigValue,clearInstanceConfigEditing}=(0,index_esm.useActions)(systemStatusLogic.Q);(0,react.useEffect)(()=>{loadInstanceSettings()},[]),(0,useKeyboardHotkeys.l)({e:{action:()=>setInstanceConfigMode(systemStatusLogic.D.Edit),disabled:instanceConfigMode!==systemStatusLogic.D.View||instanceSettingsLoading},escape:{action:()=>discard(),disabled:instanceConfigMode!==systemStatusLogic.D.Edit||instanceSettingsLoading},enter:{action:()=>save(),disabled:instanceConfigMode!==systemStatusLogic.D.Edit||instanceSettingsLoading}});let save=()=>{Object.keys(instanceConfigEditingState).length?setInstanceConfigMode(systemStatusLogic.D.Saving):setInstanceConfigMode(systemStatusLogic.D.View)},discard=()=>{setInstanceConfigMode(systemStatusLogic.D.View),clearInstanceConfigEditing()},columns=[{title:"Key",dataIndex:"key",render:function render(value){return(0,jsx_runtime.jsx)("code",{children:value})}},{title:"Description",dataIndex:"description"},{title:"Value",render:function renderValue(_,record){var _instanceConfigEditin;let props={value:record.value,key:record.key,emptyNullLabel:"Unset",value_type:record.value_type,isSecret:record.is_secret};return instanceConfigMode===systemStatusLogic.D.View?RenderMetricValue(_,props):RenderMetricValueEdit({...props,value:null!==(_instanceConfigEditin=instanceConfigEditingState[record.key])&&void 0!==_instanceConfigEditin?_instanceConfigEditin:record.value,onValueChanged:updateInstanceConfigValue})}}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("h3",{children:"Instance configuration"}),(0,jsx_runtime.jsxs)("div",{children:["Changing these settings will take effect on your entire instance."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/self-host/configure/instance-settings",target:"_blank",targetBlankIcon:!0,children:"Learn more"}),"."]})]}),instanceConfigMode===systemStatusLogic.D.View?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>setInstanceConfigMode(systemStatusLogic.D.Edit),"data-attr":"instance-config-edit-button",disabled:instanceSettingsLoading,children:"Edit"})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object.keys(instanceConfigEditingState).length>0&&(0,jsx_runtime.jsxs)("span",{className:"text-warning-dark flex items-center gap-2",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{className:"text-xl"}),(0,jsx_runtime.jsxs)("span",{children:["You have ",(0,jsx_runtime.jsx)("b",{children:Object.keys(instanceConfigEditingState).length})," unapplied"," ",(0,utils.Zi)(Object.keys(instanceConfigEditingState).length,"change",void 0,!1)]})]}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",disabled:instanceSettingsLoading,onClick:discard,children:"Discard changes"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",disabled:instanceSettingsLoading,onClick:save,children:"Save"})]})]}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:editableInstanceSettings,columns:columns,loading:instanceSettingsLoading,rowKey:"key"}),(0,jsx_runtime.jsxs)("div",{className:"my-4",children:[(0,jsx_runtime.jsx)("h3",{children:"Environment configuration"}),(0,jsx_runtime.jsxs)("div",{children:["These settings can only be modified by environment variables."," ",(0,jsx_runtime.jsxs)(src.rU,{to:"https://posthog.com/docs/self-host/configure/environment-variables",target:"_blank",children:["Learn more ",(0,jsx_runtime.jsx)(icons.pF,{style:{verticalAlign:"middle"}})]}),"."]})]}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:configOptions,columns:[{key:"metric",title:"Metric",dataIndex:"metric"},{title:"Value",dataIndex:"value"}],loading:preflightLoading,rowKey:"key"}),(0,jsx_runtime.jsx)(InstanceConfigSaveModal,{isOpen:instanceConfigMode===systemStatusLogic.D.Saving,onClose:()=>setInstanceConfigMode(systemStatusLogic.D.Edit)})]})}var UserSelectItem=__webpack_require__("../../frontend/src/lib/components/UserSelectItem.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonInputSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInputSelect/LemonInputSelect.tsx"),ProfilePicture=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.3.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");let staffUsersLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","instance","SystemStatus","staffUsersLogic"]),(0,index_esm.connect)(()=>({values:[userLogic.userLogic,["user"]],actions:[userLogic.userLogic,["loadUser"]]})),(0,index_esm.actions)({setStaffUsersToBeAdded:userUuids=>({userUuids}),addStaffUsers:!0,setStaffUserToBeDeleted:user=>({user}),deleteStaffUser:userUuid=>({userUuid})}),(0,lib.loaders)(_ref=>{let{actions,values}=_ref;return{allUsers:[[],{loadAllUsers:async()=>{var _await$api$get$result;return null!==(_await$api$get$result=(await api.ZP.get("api/users")).results)&&void 0!==_await$api$get$result?_await$api$get$result:[]},addStaffUsers:async()=>{let{staffUsersToBeAdded,allUsers}=values;actions.setStaffUsersToBeAdded([]);let newStaffUsers=await Promise.all(staffUsersToBeAdded.map(async userUuid=>await api.ZP.update(`api/users/${userUuid}`,{is_staff:!0}))),updatedAllUsers=[...allUsers.filter(_ref2=>{let{uuid}=_ref2;return!staffUsersToBeAdded.includes(uuid)}),...newStaffUsers];return updatedAllUsers.sort((a,b)=>a.first_name.localeCompare(b.first_name)),updatedAllUsers},deleteStaffUser:async _ref3=>{let{userUuid}=_ref3;await api.ZP.update(`api/users/${userUuid}`,{is_staff:!1}),values.user?.uuid===userUuid&&(actions.loadUser(),kea_router_lib.router.actions.push(urls.j.projectHomepage()));let updatedAllUsers=[...values.allUsers];for(let user of updatedAllUsers)user.uuid===userUuid&&(user.is_staff=!1);return updatedAllUsers}}]}}),(0,index_esm.reducers)({staffUsersToBeAdded:[[],{setStaffUsersToBeAdded:(_,_ref4)=>{let{userUuids}=_ref4;return userUuids}}],staffUserToBeDeleted:[null,{setStaffUserToBeDeleted:(_,_ref5)=>{let{user}=_ref5;return user}}]}),(0,index_esm.selectors)({staffUsers:[s=>[s.allUsers],allUsers=>allUsers.filter(user=>user.is_staff)],nonStaffUsers:[s=>[s.allUsers],allUsers=>allUsers.filter(user=>!user.is_staff)]}),(0,index_esm.events)(_ref6=>{let{actions}=_ref6;return{afterMount:[actions.loadAllUsers]}})]);function StaffUsersTab(){let{user:myself}=(0,index_esm.useValues)(userLogic.userLogic),{staffUsers,allUsersLoading,nonStaffUsers,staffUsersToBeAdded,staffUserToBeDeleted}=(0,index_esm.useValues)(staffUsersLogic),{setStaffUsersToBeAdded,addStaffUsers,deleteStaffUser,setStaffUserToBeDeleted}=(0,index_esm.useActions)(staffUsersLogic),columns=[{key:"profile_picture",render:function ProfilePictureRender(_,user){return(0,jsx_runtime.jsx)(ProfilePicture.Y,{user:user})},width:32},{key:"name",title:"Name",dataIndex:"first_name",render:function ProfilePictureRender(_,user){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[user.first_name,user.uuid===myself?.uuid&&(0,jsx_runtime.jsx)(LemonTag.o,{className:"uppercase ml-1",children:"Me"})]})}},{key:"email",title:"Email",dataIndex:"email"},{key:"actions",width:32,render:function RenderActions(_,user){return(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"invite-delete",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",disabledReason:staffUsers.length<2&&"At least one staff user must remain",title:staffUsers.length<2?"You should always have at least one staff user.":"Cancel the invite",onClick:()=>setStaffUserToBeDeleted(user)})}}];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"l3 mt-4",children:"Staff Users"}),(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:["Users who have permissions to manage instance-wide settings. Staff user permissions are set at the"," ",(0,jsx_runtime.jsx)("b",{children:"instance-level and are independent of any organization or project permissions."})," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/self-host/configure/instance-settings#staff-users",target:"_blank",targetBlankIcon:!0,children:"Learn more"}),"."]}),(0,jsx_runtime.jsx)(src.p2,{className:"mb-4"}),(0,jsx_runtime.jsx)("section",{children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(LemonInputSelect.n,{placeholder:"Add staff users here…",loading:allUsersLoading,value:staffUsersToBeAdded,onChange:newValues=>setStaffUsersToBeAdded(newValues),mode:"multiple","data-attr":"subscribed-emails",options:(0,UserSelectItem.W)(nonStaffUsers,"uuid")})}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",loading:allUsersLoading,disabled:0===staffUsersToBeAdded.length,onClick:addStaffUsers,children:"Add"})]})}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:staffUsers,columns:columns,loading:allUsersLoading,rowKey:"uuid"}),(0,jsx_runtime.jsx)(StaffUsersRemovalModal,{myself:myself,user:staffUserToBeDeleted,onClose:()=>setStaffUserToBeDeleted(null),onRemove:()=>{staffUserToBeDeleted&&(deleteStaffUser(staffUserToBeDeleted.uuid),setStaffUserToBeDeleted(null))}})]})}let StaffUsersRemovalModal=_ref=>{let{myself,user,onClose,onRemove}=_ref;return(0,jsx_runtime.jsx)(src.fQ,{closable:!1,isOpen:!!user,title:`Remove ${myself?.uuid===user?.uuid?"yourself":user?.first_name} as a Staff User?`,onClose:onClose,footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",onClick:onClose,children:"Cancel"}),(0,jsx_runtime.jsx)(LemonButton.J,{form:"text-tile-form",htmlType:"submit",type:"primary",status:"danger",onClick:onRemove,children:"Remove user"})]}),children:(0,jsx_runtime.jsx)("div",{className:"border-none",children:myself?.uuid===user?.uuid?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Please confirm you want to ",(0,jsx_runtime.jsx)("b",{children:"remove yourself"})," as a staff user.",(0,jsx_runtime.jsx)("div",{className:"font-normal text-secondary",children:"Only another staff user will be able to add you again."})]}):`Are you sure you want to remove ${user?.first_name} as a Staff User?`})})},scene={component:SystemStatus_SystemStatus,logic:systemStatusLogic.Q};function SystemStatus_SystemStatus(){let{tab,error}=(0,index_esm.useValues)(systemStatusLogic.Q),{setTab}=(0,index_esm.useActions)(systemStatusLogic.Q),{preflight,siteUrlMisconfigured}=(0,index_esm.useValues)(preflightLogic.preflightLogic),{user}=(0,index_esm.useValues)(userLogic.userLogic),tabs=[{key:"overview",label:(0,jsx_runtime.jsx)(Tooltip.u,{title:"System overview is cached for 60 seconds",children:(0,jsx_runtime.jsxs)("span",{children:["System overview ",(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})]})}),content:(0,jsx_runtime.jsx)(OverviewTab,{})}];return user?.is_staff&&(tabs=tabs.concat([{key:"metrics",label:"Internal metrics",content:(0,jsx_runtime.jsx)(InternalMetricsTab,{})},{key:"settings",label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Settings"," ",(0,jsx_runtime.jsx)(LemonTag.o,{type:"warning",className:"ml-1 uppercase",children:"Beta"})]}),content:(0,jsx_runtime.jsx)(InstanceConfigTab,{})},{key:"staff_users",label:"Staff Users",content:(0,jsx_runtime.jsx)(StaffUsersTab,{})}])),(0,jsx_runtime.jsxs)("div",{className:"system-status-scene",children:[(0,jsx_runtime.jsx)(PageHeader.m,{caption:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Here you can find all the critical runtime details and settings of your PostHog instance. You have access to this because you're a ",(0,jsx_runtime.jsx)("b",{children:"staff user"}),"."," ",(0,jsx_runtime.jsx)(src.rU,{target:"_blank",targetBlankIcon:!0,to:"https://posthog.com/docs/self-host/configure/instance-settings?utm_medium=in-product&utm_campaign=instance_status",children:"Learn more"}),"."]})}),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[error&&(0,jsx_runtime.jsxs)(src.Vp,{type:"error",children:[(0,jsx_runtime.jsx)("div",{children:"Something went wrong"}),(0,jsx_runtime.jsx)("div",{children:error||"An unknown error occurred. Please try again or contact us."})]}),siteUrlMisconfigured&&(0,jsx_runtime.jsxs)(src.Vp,{type:"warning",action:{children:"Learn more",to:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig"},children:["Your ",(0,jsx_runtime.jsx)("code",{children:"SITE_URL"})," environment variable seems misconfigured. Your ",(0,jsx_runtime.jsx)("code",{children:"SITE_URL"})," ","is set to"," ",(0,jsx_runtime.jsx)("b",{children:(0,jsx_runtime.jsx)("code",{children:preflight?.site_url})})," ","but you're currently browsing this page from"," ",(0,jsx_runtime.jsx)("b",{children:(0,jsx_runtime.jsx)("code",{children:window.location.origin})}),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."]})]}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tab,onChange:setTab,tabs:tabs})]})}},"../../frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{D:()=>ConfigMode,Q:()=>systemStatusLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.3.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils.tsx"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/utils/eventUsageLogic.ts"),scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/scenes/userLogic.ts");let ConfigMode=function(ConfigMode){return ConfigMode.View="view",ConfigMode.Edit="edit",ConfigMode.Saving="saving",ConfigMode}({}),EDITABLE_INSTANCE_SETTINGS=["RECORDINGS_TTL_WEEKS","RECORDINGS_PERFORMANCE_EVENTS_TTL_WEEKS","EMAIL_ENABLED","EMAIL_HOST","EMAIL_PORT","EMAIL_HOST_USER","EMAIL_HOST_PASSWORD","EMAIL_USE_TLS","EMAIL_USE_SSL","EMAIL_DEFAULT_FROM","EMAIL_REPLY_TO","AGGREGATE_BY_DISTINCT_IDS_TEAMS","PERSON_ON_EVENTS_ENABLED","STRICT_CACHING_TEAMS","SLACK_APP_CLIENT_ID","SLACK_APP_CLIENT_SECRET","SLACK_APP_SIGNING_SECRET","PARALLEL_DASHBOARD_ITEM_CACHE","RATE_LIMIT_ENABLED","RATE_LIMITING_ALLOW_LIST_TEAMS","SENTRY_AUTH_TOKEN","SENTRY_ORGANIZATION"],systemStatusLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","instance","SystemStatus","systemStatusLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setTab:tab=>({tab}),setOpenSections:sections=>({sections}),setInstanceConfigMode:mode=>({mode}),updateInstanceConfigValue:(key,value)=>({key,value}),clearInstanceConfigEditing:!0,saveInstanceConfig:!0,setUpdatedInstanceConfigCount:count=>({count}),increaseUpdatedInstanceConfigCount:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(()=>({systemStatus:[null,{loadSystemStatus:async()=>{var _await$api$get$result;return!(0,lib_utils__WEBPACK_IMPORTED_MODULE_5__.Pc)()||scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_7__.preflightLogic.values.preflight?.cloud&&!scenes_userLogic__WEBPACK_IMPORTED_MODULE_8__.userLogic.values.user?.is_staff?null:null!==(_await$api$get$result=(await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.get("api/instance_status")).results)&&void 0!==_await$api$get$result?_await$api$get$result:null}}],instanceSettings:[[],{loadInstanceSettings:async()=>{var _await$api$get$result2;return null!==(_await$api$get$result2=(await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.get("api/instance_settings")).results)&&void 0!==_await$api$get$result2?_await$api$get$result2:[]}}],queries:[null,{loadQueries:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.get("api/instance_status/queries")).results}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({tab:["overview",{setTab:(_,_ref)=>{let{tab}=_ref;return tab}}],error:[null,{loadSystemStatusFailure:(_,_ref2)=>{let{error}=_ref2;return error}}],openSections:[["0"],{persist:!0},{setOpenSections:(_,_ref3)=>{let{sections}=_ref3;return sections}}],instanceConfigMode:[ConfigMode.View,{setInstanceConfigMode:(_,_ref4)=>{let{mode}=_ref4;return mode}}],instanceConfigEditingState:[{},{updateInstanceConfigValue:(s,_ref5)=>{let{key,value}=_ref5;if(void 0!==value)return{...s,[key]:value};let newState={...s};return delete newState[key],newState},clearInstanceConfigEditing:()=>({})}],updatedInstanceConfigCount:[null,{setUpdatedInstanceConfigCount:(_,_ref6)=>{let{count}=_ref6;return count},loadInstanceSettings:()=>null,increaseUpdatedInstanceConfigCount:state=>(null!=state?state:0)+1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(()=>({overview:[s=>[s.systemStatus],status=>status?status.overview:[]],editableInstanceSettings:[s=>[s.instanceSettings],instanceSettings=>instanceSettings.filter(item=>item.editable&&EDITABLE_INSTANCE_SETTINGS.includes(item.key))]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref7=>{let{actions,values}=_ref7;return{setTab:_ref8=>{let{tab}=_ref8;"metrics"===tab&&actions.loadQueries(),actions.setInstanceConfigMode(ConfigMode.View)},updateInstanceConfigValue:_ref9=>{let{key,value}=_ref9,previousValue=values.editableInstanceSettings.find(item=>item.key===key)?.value;value&&previousValue==value&&actions.updateInstanceConfigValue(key,void 0)},saveInstanceConfig:async(_,breakpoint)=>{actions.setUpdatedInstanceConfigCount(0),await Promise.all(Object.entries(values.instanceConfigEditingState).map(async _ref10=>{let[key,value]=_ref10;await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.update(`api/instance_settings/${key}`,{value}),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_6__.vx.actions.reportInstanceSettingChange(key,value),actions.increaseUpdatedInstanceConfigCount()})),await breakpoint(1e3),values.updatedInstanceConfigCount===Object.keys(values.instanceConfigEditingState).length&&(actions.loadInstanceSettings(),actions.clearInstanceConfigEditing(),actions.setInstanceConfigMode(ConfigMode.View),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.success("Instance settings updated"))}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.actionToUrl)(_ref11=>{let{values}=_ref11;return{setTab:()=>"/instance/"+("overview"===values.tab?"status":values.tab)}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.urlToAction)(_ref12=>{let{actions,values}=_ref12;return{"/instance(/:tab)":_ref13=>{let{tab}=_ref13,currentTab=tab&&["metrics","settings","staff_users"].includes(tab)?tab:"overview";currentTab!==values.tab&&actions.setTab(currentTab)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.events)(_ref14=>{let{actions}=_ref14;return{afterMount:()=>{actions.loadSystemStatus()}}})])},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/instance/SystemStatus/index.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}.embedded-svg-wrapper{cursor:text}.embedded-svg-wrapper svg{height:100%;width:100%}",""]),module.exports=exports}}]);