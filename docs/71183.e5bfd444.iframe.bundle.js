"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[71183],{"../../frontend/src/scenes/data-pipelines/legacy-plugins/LegacyPluginScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LegacyPluginScene:()=>LegacyPluginScene,legacyPluginSceneLogic:()=>legacyPluginSceneLogic,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),kea_forms_lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),AutoSizer=__webpack_require__("../../node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonMarkdown=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMarkdown/index.ts"),CodeEditor=__webpack_require__("../../frontend/src/lib/monaco/CodeEditor.tsx");let SECRET_FIELD_VALUE="**************** POSTHOG SECRET FIELD ****************";function getConfigSchemaArray(configSchema){return Array.isArray(configSchema)?configSchema:Object.entries(configSchema).map(_ref=>{let[key,value]=_ref;return{key,...value}}).sort((a,b)=>(a.order||999999)-(b.order||999999))}function getConfigSchemaObject(configSchema){if(Array.isArray(configSchema)){let newSchema={};return configSchema.forEach((conf,order)=>{conf.key&&(newSchema[conf.key]={...conf,order})}),newSchema}return configSchema}function defaultConfigForPlugin(plugin){let config={};for(let field of getConfigSchemaArray(plugin.config_schema))field.key&&void 0!==field.default&&(config[field.key]=field.default);return config}function getPluginConfigFormData(rawConfigSchema,existingConfig,updatedConfig){let configSchema=getConfigSchemaObject(rawConfigSchema),formData=new FormData,otherConfig={};for(let[key,value]of Object.entries(updatedConfig))configSchema[key]?.type==="attachment"?(value&&!value.saved&&formData.append(`add_attachment[${key}]`,value),!value&&existingConfig?.[key]&&formData.append(`remove_attachment[${key}]`,"true")):configSchema[key]?.secret&&value===SECRET_FIELD_VALUE||(otherConfig[key]=value);return formData.append("config",JSON.stringify(otherConfig)),formData}let doFieldRequirementsMatch=(getFieldValue,targetFieldName,targetFieldValue)=>{let formActualValue=getFieldValue(targetFieldName||"")||"";return void 0===targetFieldValue&&!!formActualValue||targetFieldValue===formActualValue},determineInvisibleFields=(getFieldValue,plugin)=>{let fieldsToSetAsInvisible=[];for(let field of Object.values(getConfigSchemaArray(plugin.config_schema||{})))field.visible_if&&field.key&&(field.visible_if.every(_ref2=>{let[targetFieldName,targetFieldValue]=_ref2;return doFieldRequirementsMatch(getFieldValue,targetFieldName,targetFieldValue)})||fieldsToSetAsInvisible.push(field.key));return fieldsToSetAsInvisible},determineRequiredFields=(getFieldValue,plugin)=>{let fieldsToSetAsRequired=[];for(let field of Object.values(getConfigSchemaArray(plugin.config_schema||{})))field.key&&(field.required?fieldsToSetAsRequired.push(field.key):field.required_if&&Array.isArray(field.required_if)&&field.required_if.every(_ref3=>{let[targetFieldName,targetFieldValue]=_ref3;return doFieldRequirementsMatch(getFieldValue,targetFieldName,targetFieldValue)})&&fieldsToSetAsRequired.push(field.key));return fieldsToSetAsRequired},isValidChoiceConfig=fieldConfig=>Array.isArray(fieldConfig.choices)&&!!fieldConfig.choices.length&&!fieldConfig.choices.find(c=>"string"!=typeof c)&&!fieldConfig.secret,isValidField=fieldConfig=>"choice"!==fieldConfig.type||isValidChoiceConfig(fieldConfig);var kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");function getConfigurationFromPluginConfig(pluginConfig){return{...pluginConfig.config,enabled:pluginConfig.enabled,order:pluginConfig.order,name:pluginConfig.name?pluginConfig.name:pluginConfig.plugin_info.name,description:pluginConfig.description?pluginConfig.description:pluginConfig.plugin_info.description||""}}function getDefaultConfiguration(plugin){return{...defaultConfigForPlugin(plugin),enabled:!1,name:plugin.name,description:plugin.description}}let pipelinePluginConfigurationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{pluginId,pluginConfigId}=_ref;return pluginConfigId?`ID:${pluginConfigId}`:`NEW:${pluginId}`}),(0,index_esm.path)(id=>["scenes","pipeline","pipelinePluginConfigurationLogic",id]),(0,index_esm.connect)(()=>({values:[teamLogic.teamLogic,["currentTeamId"],featureFlagLogic.featureFlagLogic,["featureFlags"]]})),(0,kea_loaders_lib.loaders)(_ref2=>{let{props,values}=_ref2;return{pluginFromPluginId:[null,{loadPlugin:async()=>props.pluginId?({})[props.pluginId]||api.ZP.get(`api/organizations/@current/plugins/${props.pluginId}`):null}],pluginConfig:[null,{loadPluginConfig:async()=>props.pluginConfigId?await api.ZP.pluginConfigs.get(props.pluginConfigId):null,updatePluginConfig:async formdata=>{if(!values.plugin)return null;let{enabled,order,name,description,...config}=formdata,formData=getPluginConfigFormData(values.plugin.config_schema,defaultConfigForPlugin(values.plugin),config);if(formData.append("enabled",enabled),formData.append("name",name),formData.append("description",description),formData.append("order","0"),props.pluginConfigId)return await api.ZP.pluginConfigs.update(props.pluginConfigId,formData);formData.append("plugin",values.plugin.id.toString());let res=await api.ZP.pluginConfigs.create(formData);return lib.router.actions.replace(urls.j.legacyPlugin(res.id.toString())),res},migrateToHogFunction:async()=>{if(!props.pluginConfigId)return null;let hogFunction=await api.ZP.pluginConfigs.migrate(props.pluginConfigId);return lib.router.actions.replace(urls.j.hogFunction(hogFunction.id)),values.pluginConfig}}]}}),(0,index_esm.listeners)(_ref3=>{let{actions,values}=_ref3;return{updatePluginConfigSuccess:_ref4=>{let{pluginConfig}=_ref4;pluginConfig&&actions.resetConfiguration(values.configuration)}}}),(0,index_esm.reducers)(()=>({configuration:[{},{loadPluginSuccess:(state,_ref5)=>{let{pluginFromPluginId}=_ref5;return Object.keys(state).length>0||!pluginFromPluginId?state:getDefaultConfiguration(pluginFromPluginId)},loadPluginConfigSuccess:(state,_ref6)=>{let{pluginConfig}=_ref6;return pluginConfig?getConfigurationFromPluginConfig(pluginConfig):state},updatePluginConfigSuccess:(state,_ref7)=>{let{pluginConfig}=_ref7;return pluginConfig?getConfigurationFromPluginConfig(pluginConfig):state}}]})),(0,index_esm.selectors)(()=>({plugin:[s=>[s.pluginFromPluginId,s.pluginConfig],(pluginFromId,pluginConfig)=>pluginConfig?.plugin_info||pluginFromId],loading:[s=>[s.pluginFromPluginIdLoading,s.pluginConfigLoading],(pluginLoading,pluginConfigLoading)=>pluginLoading||pluginConfigLoading],savedConfiguration:[s=>[s.pluginConfig,s.plugin],(pluginConfig,plugin)=>pluginConfig&&plugin?pluginConfig?getConfigurationFromPluginConfig(pluginConfig):plugin?getDefaultConfiguration(plugin):void 0:{}],requiredFields:[s=>[s.plugin,s.configuration],(plugin,configuration)=>plugin&&configuration?determineRequiredFields(fieldName=>configuration[fieldName],plugin):[]],hiddenFields:[s=>[s.plugin,s.configuration],(plugin,configuration)=>plugin&&configuration?determineInvisibleFields(fieldName=>configuration[fieldName],plugin):[]],isNew:[(_,p)=>[p.pluginConfigId],pluginConfigId=>!pluginConfigId]})),(0,kea_forms_lib.forms)(_ref8=>{let{asyncActions,values}=_ref8;return{configuration:{errors:formdata=>Object.fromEntries(values.requiredFields.map(field=>[field,formdata[field]?void 0:"This field is required"])),submit:async formdata=>{await asyncActions.updatePluginConfig(formdata)}}}}),(0,lib.beforeUnload)(_ref9=>{let{actions,values}=_ref9;return{enabled:()=>values.configurationChanged,message:"Leave action?\nChanges you made will be discarded.",onConfirm:()=>{actions.resetConfiguration()}}}),(0,index_esm.afterMount)(_ref10=>{let{props,actions}=_ref10;props.pluginConfigId?actions.loadPluginConfig():props.pluginId&&actions.loadPlugin()})]);var Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx");let plugin_default=__webpack_require__.p+"images/plugin-default.e3e047768d82d1c3fe24fce102eaef18.svg",semver_flattener=__webpack_require__.p+"images/semver-flattener.efa68a08f8afcde67288729b0d2f4007.png",user_agent=__webpack_require__.p+"images/user-agent.3eb5015f5b4d1c7b28212e18de661bc4.png";var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let pluginImageOverrides={"inline://semver-flattener":semver_flattener,"inline://user-agent":user_agent};function PluginImage(_ref){let{plugin,size="medium"}=_ref,{plugin_type:pluginType,url,icon}=plugin,[state,setState]=(0,react.useState)({image:plugin_default}),pixelSize={large:100,medium:60,small:30}[size];return(0,react.useEffect)(()=>{let imageOverride=pluginImageOverrides[null!=url?url:""];if(imageOverride)setState(state=>({...state,image:imageOverride}));else if(icon)setState(state=>({...state,image:icon}));else if(url?.includes("github.com")){let{user,repo,path}=(0,utils.iw)(url);setState({...state,image:`https://raw.githubusercontent.com/${user}/${repo}/${path||"main"}/logo.png`})}},[url]),"source"===pluginType?(0,jsx_runtime.jsx)(posthog_icons_es.IconTerminal,{className:"ml-0 plugin-image shrink-0",style:{fontSize:pixelSize}}):(0,jsx_runtime.jsx)("div",{className:"bg-no-repeat bg-contain plugin-image shrink-0",style:{width:pixelSize,height:pixelSize,backgroundImage:`url(${state.image})`},onError:()=>setState({...state,image:plugin_default})})}function RenderApp(_ref){let{plugin,imageSize="small"}=_ref;return plugin?(0,jsx_runtime.jsx)("div",{className:"flex gap-4 items-center",children:(0,jsx_runtime.jsx)(Tooltip.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[plugin.name,(0,jsx_runtime.jsx)("br",{}),plugin.description,(0,jsx_runtime.jsx)("br",{}),plugin.url?"Click to view app source code":"No source code available"]}),children:plugin.url&&"inline"!==plugin.plugin_type?(0,jsx_runtime.jsx)(Link.r,{to:plugin.url,target:"_blank",children:(0,jsx_runtime.jsx)(PluginImage,{plugin:plugin,size:imageSize})}):(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)(PluginImage,{plugin:plugin,size:imageSize})})})}):(0,jsx_runtime.jsx)(src.yW,{className:"w-15 h-15"})}function PipelinePluginConfiguration(_ref){let{pluginId,pluginConfigId}=_ref,logicProps={pluginId:pluginId||null,pluginConfigId:pluginConfigId||null},logic=pipelinePluginConfigurationLogic(logicProps),{plugin,isNew,isConfigurationSubmitting,savedConfiguration,hiddenFields,requiredFields,loading,configurationChanged}=(0,index_esm.useValues)(logic),{submitConfiguration,resetConfiguration,migrateToHogFunction}=(0,index_esm.useActions)(logic);if(loading&&!plugin)return(0,jsx_runtime.jsx)(src.t2,{});if(!plugin)return(0,jsx_runtime.jsx)(NotFound.T,{object:"plugin"});let loadingOrSubmitting=loading||isConfigurationSubmitting,fields=getConfigSchemaArray(plugin.config_schema).map((fieldConfig,index)=>(0,jsx_runtime.jsx)(react.Fragment,{children:fieldConfig.key&&fieldConfig.type&&isValidField(fieldConfig)&&!hiddenFields.includes(fieldConfig.key)?(0,jsx_runtime.jsx)(LemonField.D,{name:fieldConfig.key,label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[fieldConfig.secret&&(0,jsx_runtime.jsx)(src.u,{placement:"top-start",title:"This field is write-only. Its value won't be visible after saving.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconLock,{})}),fieldConfig.markdown&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{children:fieldConfig.markdown}),fieldConfig.name||fieldConfig.key]}),help:fieldConfig.hint&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"mt-0.5",children:fieldConfig.hint}),showOptional:!requiredFields.includes(fieldConfig.key),children:(0,jsx_runtime.jsx)(PluginField,{fieldConfig:fieldConfig,disabled:loadingOrSubmitting})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:fieldConfig.type?(0,jsx_runtime.jsxs)("p",{className:"text-danger",children:["Invalid config field ",(0,jsx_runtime.jsx)("i",{children:fieldConfig.name||fieldConfig.key}),"."]}):null})},fieldConfig.key||`__key__${index}`)),buttons=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",htmlType:"reset",onClick:()=>resetConfiguration(savedConfiguration||{}),disabledReason:configurationChanged?isConfigurationSubmitting?"Saving in progress…":void 0:"No changes",children:"Clear changes"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",htmlType:"submit",onClick:submitConfiguration,loading:isConfigurationSubmitting,children:isNew?"Create":"Save"})]});return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-3",children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-end w-full",children:(0,jsx_runtime.jsx)("div",{className:"shrink-0",children:buttons})}),plugin?.hog_function_migration_available&&(0,jsx_runtime.jsxs)(src.Vp,{type:"error",action:{children:"Upgrade to new version",onClick:()=>src.dn.open({title:"Upgrade destination",width:"30rem",description:"This will create a new Destination in the upgraded system. The old destination will be disabled and can later be deleted. In addition there may be slight differences in the configuration options that you can choose to modify.",secondaryButton:{type:"secondary",children:"Cancel"},primaryButton:{type:"primary",onClick:()=>migrateToHogFunction(),children:"Upgrade"}}),disabled:loading},children:[(0,jsx_runtime.jsx)("b",{children:"New version available!"})," This destination is part of our legacy system. Click to upgrade."]}),(0,jsx_runtime.jsx)(kea_forms_lib.Form,{logic:pipelinePluginConfigurationLogic,props:logicProps,formKey:"configuration",className:"deprecated-space-y-3",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4 items-start",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 gap-4 min-w-100",children:[(0,jsx_runtime.jsxs)("div",{className:"p-3 rounded border bg-surface-primary deprecated-space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 items-center min-h-16",children:[(0,jsx_runtime.jsx)(RenderApp,{plugin:plugin,imageSize:"medium"}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 py-1",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row gap-1 items-center text-sm font-semibold",children:plugin.name}),plugin.description?(0,jsx_runtime.jsx)("div",{className:"mt-1 text-xs text-tertiary",children:(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"max-w-[30rem]",lowKeyHeadings:!0,children:plugin.description})}):null]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"enabled",children:_ref2=>{let{value,onChange}=_ref2;return(0,jsx_runtime.jsx)(src.f4,{label:"Enabled",onChange:()=>onChange(!value),checked:value,disabled:loadingOrSubmitting,bordered:!0})}})]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",info:"Customising the name can be useful if multiple instances of the same type are used.",children:(0,jsx_runtime.jsx)(src.DF,{type:"text",disabled:loadingOrSubmitting})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"description",label:"Description",info:"Add a description to share context with other team members",children:(0,jsx_runtime.jsx)(src._V,{disabled:loadingOrSubmitting})})]})," "]}),(0,jsx_runtime.jsxs)("div",{className:"flex-2 min-w-100 deprecated-space-y-4",children:[(0,jsx_runtime.jsx)("div",{className:"p-3 rounded border bg-surface-primary deprecated-space-y-2",children:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:fields.length?fields:(0,jsx_runtime.jsx)("span",{className:"italic text-secondary",children:"This app does not have specific configuration options"})})}),(0,jsx_runtime.jsx)("div",{className:"flex gap-2 justify-end",children:buttons})]})]})})]})}function PluginField(_ref3){let{value,onChange,fieldConfig,disabled}=_ref3,[editingSecret,setEditingSecret]=(0,react.useState)(!1);return fieldConfig.secret&&!editingSecret&&value&&(value===SECRET_FIELD_VALUE||value.name===SECRET_FIELD_VALUE)?(0,jsx_runtime.jsxs)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{}),onClick:()=>{onChange?.(fieldConfig.default||""),setEditingSecret(!0)},disabled:disabled,children:["Reset secret ","attachment"===fieldConfig.type?"attachment":"field"]}):"attachment"===fieldConfig.type?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[value?.name?(0,jsx_runtime.jsxs)("span",{children:["Selected file: ",value.name]}):null,(0,jsx_runtime.jsx)(src.mH,{accept:"*",multiple:!1,onChange:files=>onChange?.(files[0]),value:value?.size?[value]:[],showUploadedFiles:!1})]}):"string"===fieldConfig.type?(0,jsx_runtime.jsx)(src.DF,{value:value,onChange:onChange,autoFocus:editingSecret,className:"ph-no-capture",disabled:disabled}):"json"===fieldConfig.type?(0,jsx_runtime.jsx)(JsonConfigField,{value:value,onChange:onChange,autoFocus:editingSecret,className:"ph-no-capture"}):"choice"===fieldConfig.type?(0,jsx_runtime.jsx)(src.Yv,{fullWidth:!0,value:value,className:"ph-no-capture",onChange:onChange,options:fieldConfig.choices.map(choice=>({label:choice,value:choice})),disabled:disabled}):(0,jsx_runtime.jsxs)("strong",{className:"text-danger",children:['Unknown field type "',(0,jsx_runtime.jsx)("code",{children:fieldConfig.type}),'".',(0,jsx_runtime.jsx)("br",{}),"You may need to upgrade PostHog!"]})}function JsonConfigField(props){return(0,jsx_runtime.jsx)(AutoSizer.q,{disableWidth:!0,className:"min-h-60",children:_ref4=>{let{height}=_ref4;return(0,jsx_runtime.jsx)(CodeEditor.p,{className:"border",language:"json",value:props.value,onChange:v=>props.onChange?.(null!=v?v:""),height:height,options:{minimap:{enabled:!1}}})}})}var sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),types=__webpack_require__("../../frontend/src/types.ts"),PipelineNodeLogs=__webpack_require__("../../frontend/src/scenes/data-pipelines/legacy-plugins/PipelineNodeLogs.tsx"),Chart=__webpack_require__("../../frontend/src/lib/Chart.ts"),colors=__webpack_require__("../../frontend/src/lib/colors.ts"),CodeSnippet=__webpack_require__("../../frontend/src/lib/components/CodeSnippet/index.ts"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonLabel=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),LemonModal=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonModal/index.ts"),LemonSkeleton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),projectLogic=__webpack_require__("../../frontend/src/scenes/projectLogic.ts");let pipelineNodeMetricsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return id}),(0,index_esm.path)(id=>["scenes","pipeline","appMetricsLogic",id]),(0,index_esm.connect)(()=>({values:[projectLogic.K,["currentProjectId"]]})),(0,index_esm.actions)({setDateRange:(from,to)=>({from,to}),openErrorDetailsModal:errorType=>({errorType}),closeErrorDetailsModal:!0}),(0,kea_loaders_lib.loaders)(_ref2=>{let{values,props}=_ref2;return{appMetricsResponse:[null,{loadMetrics:async()=>{let params=(0,utils.oZ)({date_from:values.dateRange.from,date_to:values.dateRange.to});return await api.ZP.get(`api/projects/${values.currentProjectId}/app_metrics/${props.id}?${params}`)}}],errorDetails:[[],{openErrorDetailsModal:async _ref3=>{let{errorType}=_ref3,params=(0,utils.oZ)({error_type:errorType}),{result}=await api.ZP.get(`api/projects/${values.currentProjectId}/app_metrics/${props.id}/error_details?${params}`);return result}}]}}),(0,index_esm.reducers)({dateRange:[{from:"-7d",to:null},{setDateRange:(_,_ref4)=>{let{from,to}=_ref4;return{from:null!=from?from:"-7d",to:to}}}],errorDetailsModalError:[null,{openErrorDetailsModal:(_,_ref5)=>{let{errorType}=_ref5;return errorType},closeErrorDetailsModal:()=>null}]}),(0,index_esm.listeners)(_ref6=>{let{actions}=_ref6;return{setDateRange:()=>{actions.loadMetrics()}}}),(0,index_esm.afterMount)(_ref7=>{let{actions}=_ref7;actions.loadMetrics()})]);function PipelineNodeMetrics(_ref){let{id}=_ref,logic=pipelineNodeMetricsLogic({id}),{appMetricsResponse,appMetricsResponseLoading,dateRange}=(0,index_esm.useValues)(logic),{setDateRange}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-8",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,jsx_runtime.jsx)(MetricsOverview,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading}),(0,jsx_runtime.jsx)(DateFilter.f,{dateTo:dateRange.to,dateFrom:dateRange.from,onChange:(from,to)=>setDateRange(from,to),allowedRollingDateOptions:["days","weeks","months","years"],makeLabel:key=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCalendar,{})," ",key]})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Delivery trends"}),(0,jsx_runtime.jsx)(AppMetricsGraph,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Errors"}),(0,jsx_runtime.jsx)(ErrorsOverview,{id:id})]})]})}function MetricsOverview(_ref2){let{metrics,metricsLoading}=_ref2;return metricsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-20 h-4 mb-2",repeat:4}):(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-secondary font-semibold mb-2",children:["Events Processed successfully",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Total number of events processed successfully",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.successes)})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-secondary font-semibold mb-2",children:["Events Failed",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Total number of events that threw an error during processing",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.failures)})]})]})})}function renderNumber(value){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value?(0,utils.Lc)(value):value})}function AppMetricsGraph(_ref3){let{metrics,metricsLoading}=_ref3,canvasRef=(0,react.useRef)(null);return((0,react.useEffect)(()=>{let chart;if(canvasRef.current&&metrics&&!(0,utils.es)())return chart=new Chart.kL(canvasRef.current?.getContext("2d"),{type:"line",data:{labels:metrics.dates,datasets:[{label:"events processed successfully",data:metrics.successes,borderColor:"",...colorConfig("data-color-1")},{label:"events failed",data:metrics.failures,...colorConfig("data-color-5")}]},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}}),()=>{chart?.destroy()}},[metrics]),metricsLoading||!metrics)?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"AppMetricsGraph border rounded p-6"}):(0,jsx_runtime.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:(0,jsx_runtime.jsx)("canvas",{ref:canvasRef})})}function colorConfig(baseColorVar){let mainColor=(0,colors.cM)(baseColorVar);return{borderColor:mainColor,hoverBorderColor:(0,utils._$)(mainColor,-20),hoverBackgroundColor:(0,utils._$)(mainColor,-20),backgroundColor:mainColor,fill:!1,borderWidth:2,pointRadius:0}}function ErrorsOverview(_ref4){let{id}=_ref4,logic=pipelineNodeMetricsLogic({id}),{appMetricsResponse,appMetricsResponseLoading}=(0,index_esm.useValues)(logic),{openErrorDetailsModal}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ErrorDetailsModal,{id:id}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:appMetricsResponse?.errors||[],loading:appMetricsResponseLoading,columns:[{title:"Error type",dataIndex:"error_type",render:function RenderErrorType(_,errorSummary){return(0,jsx_runtime.jsx)(Link.r,{title:"View details",className:"font-semibold",onClick:event=>{event.preventDefault(),openErrorDetailsModal(errorSummary.error_type)},children:errorSummary.error_type})},sorter:(a,b)=>a.error_type.localeCompare(b.error_type)},{title:"Count",dataIndex:"count",align:"right",sorter:(a,b)=>a.count-b.count},{title:"Last seen",dataIndex:"last_seen",render:function RenderCreatedAt(lastSeen){return(0,jsx_runtime.jsx)("div",{className:"whitespace-nowrap text-right",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:lastSeen})})},align:"right",sorter:(a,b)=>new Date(a.last_seen||0)>new Date(b.last_seen||0)?1:-1}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:(0,jsx_runtime.jsxs)("div",{className:"",children:[(0,jsx_runtime.jsx)("b",{children:"No errors! \uD83E\uDD73"}),(0,jsx_runtime.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})]})}function ErrorDetailsModal(_ref5){let{id}=_ref5,logic=pipelineNodeMetricsLogic({id}),{errorDetails,errorDetailsModalError,errorDetailsLoading}=(0,index_esm.useValues)(logic),{closeErrorDetailsModal}=(0,index_esm.useActions)(logic),[page,setPage]=(0,react.useState)(0),activeErrorDetails=errorDetails[page];return(0,jsx_runtime.jsx)(LemonModal.f,{isOpen:!!errorDetailsModalError,onClose:closeErrorDetailsModal,title:errorDetailsModalError,width:"min(50vw, 80rem)",description:(0,jsx_runtime.jsx)("span",{children:activeErrorDetails?.error_details?.error.message?.substring(0,200)}),footer:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("span",{children:[page+1," of ",errorDetails.length," sample",errorDetails.length>1?"s":""]}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.ed,{}),onClick:()=>setPage(page-1),disabledReason:0==page?"First page":void 0}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.VG,{}),onClick:()=>setPage(page+1),disabledReason:page==errorDetails.length-1?"Last page":void 0})]})}),children:!errorDetailsModalError||errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col deprecated-space-y-2 h-[80vh]",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"When:"})," ",(0,jsx_runtime.jsx)(TZLabel.w,{time:activeErrorDetails.timestamp,showSeconds:!0})]}),activeErrorDetails.error_details.eventCount&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Event Count"}),(0,jsx_runtime.jsx)("div",{children:activeErrorDetails.error_details.eventCount})]}),activeErrorDetails.error_details.error.message&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Error message",defaultIsExpanded:!0,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.message})}),activeErrorDetails.error_details.event&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Event payload",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JSON,children:JSON.stringify(activeErrorDetails.error_details.event,null,2)})}),activeErrorDetails.error_details.error.stack&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Stack trace",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.stack})})]})})}function CollapsibleSection(props){let[isExpanded,setIsExpanded]=(0,react.useState)(props.defaultIsExpanded);return(0,jsx_runtime.jsxs)("div",{className:"bg-primary border rounded",children:[(0,jsx_runtime.jsx)(LemonButton.J,{fullWidth:!0,onClick:()=>setIsExpanded(!isExpanded),sideIcon:isExpanded?(0,jsx_runtime.jsx)(posthog_icons_es.IconCollapse,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand,{}),title:isExpanded?"Show less":"Show more",className:"bg-primary",children:props.title}),isExpanded&&(0,jsx_runtime.jsx)("div",{className:"bg-surface-primary p-2",children:props.children})]})}let LEGACY_PLUGIN_SCENE_TABS=["configuration","metrics","logs","history"],legacyPluginSceneLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return null!=id?id:"new"}),(0,index_esm.path)(key=>["scenes","data-pipelines","legacy-plugins","legacyPluginSceneLogic",key]),(0,index_esm.actions)({setCurrentTab:tab=>({tab})}),(0,index_esm.reducers)(()=>({currentTab:["configuration",{setCurrentTab:(_,_ref2)=>{let{tab}=_ref2;return tab}}]})),(0,index_esm.selectors)({logicProps:[()=>[(_,props)=>props],props=>props],breadcrumbs:[()=>[],()=>[{key:sceneTypes.x.DataPipelines,name:"Data pipelines",path:urls.j.dataPipelines(),iconType:"data_pipeline"},{key:[sceneTypes.x.DataPipelines,"destinations"],name:"Destinations",path:urls.j.dataPipelines("destinations"),iconType:"data_pipeline"},{key:sceneTypes.x.LegacyPlugin,name:"Plugin destination (deprecated)",iconType:"data_pipeline"}]]}),(0,lib.actionToUrl)(_ref3=>{let{values}=_ref3;return{setCurrentTab:()=>[lib.router.values.location.pathname,{...lib.router.values.searchParams,tab:values.currentTab},lib.router.values.hashParams]}}),(0,lib.urlToAction)(_ref4=>{let{actions,values}=_ref4;return{[urls.j.legacyPlugin(":id")]:(_,search)=>{var _search$tab;let possibleTab=null!==(_search$tab=search.tab)&&void 0!==_search$tab?_search$tab:"configuration",tab=LEGACY_PLUGIN_SCENE_TABS.includes(possibleTab)?possibleTab:"configuration";tab!==values.currentTab&&actions.setCurrentTab(tab)}}})]),scene={component:LegacyPluginScene,logic:legacyPluginSceneLogic,paramsToProps:_ref5=>{let{params:{id}}=_ref5;return{id}}};function LegacyPluginScene(){let{currentTab,logicProps}=(0,index_esm.useValues)(legacyPluginSceneLogic),{setCurrentTab}=(0,index_esm.useActions)(legacyPluginSceneLogic),{id}=logicProps,pluginConfigId=parseInt(id),tabs=[{label:"Configuration",key:"configuration",content:(0,jsx_runtime.jsx)(PipelinePluginConfiguration,{pluginConfigId:pluginConfigId})},{label:"Metrics",key:"metrics",content:(0,jsx_runtime.jsx)(PipelineNodeMetrics,{id:pluginConfigId})},{label:"Logs",key:"logs",content:(0,jsx_runtime.jsx)(PipelineNodeLogs.e,{id:pluginConfigId})},{label:"History",key:"history",content:(0,jsx_runtime.jsx)(ActivityLog.DA,{id:id,scope:types.jc.PLUGIN})}];return(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,tabs:tabs,onChange:setCurrentTab})}},"../../frontend/src/scenes/data-pipelines/legacy-plugins/PipelineNodeLogs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{e:()=>PipelineNodeLogs});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),api=__webpack_require__("../../frontend/src/lib/api.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function LogLevelDisplay(level){let color;switch(level){case"DEBUG":color="text-muted";break;case"LOG":color="text-text-3000";break;case"INFO":color="text-accent";break;case"WARNING":case"WARN":color="text-warning";break;case"ERROR":color="text-danger"}return(0,jsx_runtime.jsx)("span",{className:color,children:level})}let ALL_LOG_LEVELS=["DEBUG","LOG","INFO","WARNING","ERROR"],PipelineBackend=function(PipelineBackend){return PipelineBackend.BatchExport="batch_export",PipelineBackend.Plugin="plugin",PipelineBackend}({}),pipelineNodeLogsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return id}),(0,index_esm.path)(key=>["scenes","pipeline","pipelineNodeLogsLogic",key]),(0,index_esm.connect)(()=>({values:[(0,teamLogic.teamLogic)(),["currentTeamId"]]})),(0,index_esm.actions)({setSelectedLogLevels:levels=>({levels}),setSearchTerm:searchTerm=>({searchTerm}),setInstanceId:instanceId=>({instanceId}),clearBackgroundLogs:!0,markLogsEnd:!0}),(0,lib.loaders)(_ref2=>{let{values,actions,cache}=_ref2;return{logs:[[],{loadLogs:async()=>{var _values$instanceId;let results=[],logParams={search:values.searchTerm,level:values.selectedLogLevelsForAPI.join(","),limit:constants.F2,instance_id:null!==(_values$instanceId=values.instanceId)&&void 0!==_values$instanceId?_values$instanceId:void 0};return results=values.node.backend===PipelineBackend.BatchExport?(await api.ZP.batchExports.logs(values.node.id,logParams)).results:await api.ZP.pluginConfigs.logs(Number(values.node.id),logParams),cache.disposables.add(()=>{let intervalId=setInterval(actions.pollBackgroundLogs,5e3);return()=>clearInterval(intervalId)},"pollingInterval"),actions.clearBackgroundLogs(),results},loadMoreLogs:async()=>{var _values$instanceId2;let results;let logParams={search:values.searchTerm,level:values.selectedLogLevels.join(","),limit:constants.F2,before:values.trailingEntry?.timestamp,instance_id:null!==(_values$instanceId2=values.instanceId)&&void 0!==_values$instanceId2?_values$instanceId2:void 0};return(results=values.node.backend===PipelineBackend.BatchExport?(await api.ZP.batchExports.logs(values.node.id,logParams)).results:await api.ZP.pluginConfigs.logs(Number(values.node.id),logParams)).length<constants.F2&&actions.markLogsEnd(),[...values.logs,...results]},revealBackground:()=>{let newArray=[...values.backgroundLogs,...values.logs];return actions.clearBackgroundLogs(),newArray}}],backgroundLogs:[[],{pollBackgroundLogs:async()=>{var _values$instanceId3;let results;if(values.logsLoading)return values.backgroundLogs;let logParams={search:values.searchTerm,level:values.selectedLogLevels.join(","),limit:constants.F2,after:values.leadingEntry?.timestamp,instance_id:null!==(_values$instanceId3=values.instanceId)&&void 0!==_values$instanceId3?_values$instanceId3:void 0};return[...values.node.backend===PipelineBackend.BatchExport?(await api.ZP.batchExports.logs(values.node.id,logParams)).results:await api.ZP.pluginConfigs.logs(Number(values.node.id),logParams),...values.backgroundLogs]}}]}}),(0,index_esm.reducers)({selectedLogLevels:[["LOG","INFO","WARNING","ERROR"],{setSelectedLogLevels:(_,_ref3)=>{let{levels}=_ref3;return levels}}],backgroundLogs:[[],{clearBackgroundLogs:()=>[]}],searchTerm:["",{setSearchTerm:(_,_ref4)=>{let{searchTerm}=_ref4;return searchTerm}}],instanceId:[null,{setInstanceId:(_,_ref5)=>{let{instanceId}=_ref5;return instanceId}}],isThereMoreToLoad:[!0,{loadLogsSuccess:(_,_ref6)=>{let{logs}=_ref6;return logs.length>=constants.F2},markLogsEnd:()=>!1}]}),(0,index_esm.selectors)(_ref7=>{let{actions,values}=_ref7;return{node:[(_,p)=>[p.id],id=>"string"==typeof id?{backend:PipelineBackend.BatchExport,id}:{backend:PipelineBackend.Plugin,id}],leadingEntry:[s=>[s.logs,s.backgroundLogs],(logs,backgroundLogs)=>backgroundLogs.length?backgroundLogs[0]:logs.length?logs[0]:null],trailingEntry:[s=>[s.logs,s.backgroundLogs],(logs,backgroundLogs)=>logs.length?logs[logs.length-1]:backgroundLogs.length?backgroundLogs[backgroundLogs.length-1]:null],columns:[s=>[s.node],node=>[{title:"Timestamp",key:"timestamp",dataIndex:"timestamp",sorter:(a,b)=>(0,dayjs.Bv)(a.timestamp).unix()-(0,dayjs.Bv)(b.timestamp).unix(),render:timestamp=>(0,jsx_runtime.jsx)(TZLabel.w,{time:timestamp}),width:0},{width:0,title:node.backend==PipelineBackend.BatchExport?"Run Id":"Source",dataIndex:"instance_id",key:"instance_id",render:instanceId=>(0,jsx_runtime.jsx)("code",{className:"whitespace-nowrap",children:node.backend!==PipelineBackend.Plugin?(0,jsx_runtime.jsx)(src.rU,{subtle:!0,onClick:()=>{values.instanceId===instanceId?actions.setInstanceId(null):actions.setInstanceId(instanceId)},children:instanceId}):instanceId})},{width:100,title:"Level",key:"level",dataIndex:"level",render:LogLevelDisplay},{title:"Message",key:"message",dataIndex:"message",render:message=>(0,jsx_runtime.jsx)("code",{className:"whitespace-pre-wrap",children:message})}]],selectedLogLevelsForAPI:[s=>[s.selectedLogLevels],logLevels=>{let uniqueLevels=new Set(logLevels);return uniqueLevels.has("WARN")&&uniqueLevels.add("WARNING"),uniqueLevels.has("WARNING")&&uniqueLevels.add("WARN"),Array.from(uniqueLevels)}]}}),(0,index_esm.listeners)(_ref8=>{let{actions}=_ref8;return{setSelectedLogLevels:()=>{actions.loadLogs()},setSearchTerm:async(_ref9,breakpoint)=>{let{searchTerm}=_ref9;searchTerm&&await breakpoint(1e3),actions.loadLogs()},setInstanceId:async()=>{actions.loadLogs()}}}),(0,index_esm.events)(_ref10=>{let{actions,cache}=_ref10;return{afterMount:()=>{actions.loadLogs()},beforeUnmount:()=>{clearInterval(cache.pollingInterval)}}})]);function PipelineNodeLogs(_ref){let{id}=_ref,logic=pipelineNodeLogsLogic({id}),{logs,logsLoading,backgroundLogs,columns,isThereMoreToLoad,selectedLogLevels,instanceId}=(0,index_esm.useValues)(logic),{revealBackground,loadMoreLogs,setSelectedLogLevels,setSearchTerm,setInstanceId}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex-1 ph-no-capture deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search for messages containing…",fullWidth:!0,onChange:setSearchTerm,allowClear:!0,prefix:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconSearch,{}),instanceId&&(0,jsx_runtime.jsx)(src.LV,{onClose:()=>setInstanceId(null),children:instanceId})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:"Show logs of level:"}),ALL_LOG_LEVELS.map(level=>(0,jsx_runtime.jsx)(src.Hw,{label:level,checked:selectedLogLevels.includes(level),onChange:checked=>{setSelectedLogLevels(checked?[...selectedLogLevels,level]:selectedLogLevels.filter(t=>t!=level))}},level))]}),(0,jsx_runtime.jsx)(src.Jp,{onClick:revealBackground,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:backgroundLogs.length?void 0:"There's nothing to load",children:backgroundLogs.length?`Load ${(0,utils.Zi)(backgroundLogs.length,"newer entry","newer entries")}`:"No new entries"}),(0,jsx_runtime.jsx)(src.g3,{dataSource:logs,columns:columns,loading:logsLoading,className:"ph-no-capture",rowKey:record=>`${record.log_source_id}:${record.instance_id}:${record.timestamp}`,pagination:{pageSize:200,hideOnSinglePage:!0}}),!!logs.length&&(0,jsx_runtime.jsx)(src.Jp,{onClick:loadMoreLogs,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:isThereMoreToLoad?void 0:"There's nothing more to load",children:isThereMoreToLoad?`Load up to ${constants.F2} older entries`:"No older entries"})]})}}}]);