"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[11709],{"../../products/logs/frontend/LogsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LogsScene:()=>LogsScene,scene:()=>scene});var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),Sparkline=__webpack_require__("../../frontend/src/lib/components/Sparkline.tsx"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let logsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","logs","frontend","logsLogic"]),(0,index_esm.actions)({setDateRange:dateRange=>({dateRange}),setOrderBy:orderBy=>({orderBy}),setSearchTerm:searchTerm=>({searchTerm}),setResource:resource=>({resource}),setSeverityLevels:severityLevels=>({severityLevels}),setWrapBody:wrapBody=>({wrapBody})}),(0,index_esm.reducers)({dateRange:[{date_from:"-7d",date_to:null},{setDateRange:(_,_ref)=>{let{dateRange}=_ref;return dateRange}}],orderBy:["latest",{setOrderBy:(_,_ref2)=>{let{orderBy}=_ref2;return orderBy}}],searchTerm:["",{setSearchTerm:(_,_ref3)=>{let{searchTerm}=_ref3;return searchTerm}}],resource:["",{setResource:(_,_ref4)=>{let{resource}=_ref4;return resource}}],severityLevels:[[],{setSeverityLevels:(_,_ref5)=>{let{severityLevels}=_ref5;return severityLevels}}],wrapBody:[!0,{setWrapBody:(_,_ref6)=>{let{wrapBody}=_ref6;return wrapBody}}]}),(0,lib.loaders)(_ref7=>{let{values}=_ref7;return{logs:[[],{fetchLogs:async()=>(await api.ZP.logs.query({query:{limit:100,offset:values.logs.length,orderBy:values.orderBy,dateRange:values.dateRange,searchTerm:values.searchTerm,resource:values.resource,severityLevels:values.severityLevels}})).results}]}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let DateRangeFilter=()=>{let{dateRange}=(0,index_esm.useValues)(logsLogic),{setDateRange}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsx)("span",{className:"rounded bg-surface-primary",children:(0,jsx_runtime.jsx)(DateFilter.f,{size:"small",dateFrom:dateRange.date_from,dateTo:dateRange.date_to,onChange:(changedDateFrom,changedDateTo)=>setDateRange({date_from:changedDateFrom,date_to:changedDateTo}),allowedRollingDateOptions:["hours","days","weeks","months","years"]})})},ResourceFilter=()=>{let{resource}=(0,index_esm.useValues)(logsLogic),{setResource}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsx)("span",{className:"rounded bg-surface-primary",children:(0,jsx_runtime.jsx)(src.DF,{size:"small",value:resource,onChange:setResource,placeholder:"Resource"})})},SearchTermFilter=()=>{let{searchTerm}=(0,index_esm.useValues)(logsLogic),{setSearchTerm}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsx)("span",{className:"rounded bg-surface-primary",children:(0,jsx_runtime.jsx)(src.DF,{size:"small",value:searchTerm,onChange:value=>setSearchTerm(""===value?void 0:value),placeholder:"Search logs..."})})};var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.14.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx");let options={info:"Info",debug:"Debug",warn:"Warn",error:"Error"},SeverityLevelsFilter=()=>{let{severityLevels}=(0,index_esm.useValues)(logsLogic),{setSeverityLevels}=(0,index_esm.useActions)(logsLogic),onClick=level=>{let levels=[...severityLevels],index=levels.indexOf(level);index>-1?levels.splice(index,1):levels.push(level),setSeverityLevels(levels)},displayLevels=severityLevels.length>0?severityLevels.map(l=>(0,utils.fm)(l)).join(", "):"All levels";return(0,jsx_runtime.jsx)("span",{className:"rounded bg-surface-primary",children:(0,jsx_runtime.jsx)(src.d6,{closeOnClickInside:!1,items:Object.entries(options).map(_ref=>{let[key,label]=_ref;return{label,onClick:()=>onClick(key),active:severityLevels.includes(key)}}),children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFilter,{}),size:"small",type:"secondary",children:displayLevels})})})},scene={component:LogsScene};function LogsScene(){let{wrapBody,logs}=(0,index_esm.useValues)(logsLogic),{fetchLogs}=(0,index_esm.useActions)(logsLogic);return(0,react.useEffect)(()=>{fetchLogs()},[]),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-y-2 h-screen",children:[(0,jsx_runtime.jsx)(Filters,{}),(0,jsx_runtime.jsx)(Sparkline.b,{labels:["bucket 1"],data:[1],className:"w-full"}),(0,jsx_runtime.jsx)(DisplayOptions,{}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(src.g3,{hideScrollbar:!0,dataSource:logs,loading:!1,size:"small",columns:[{title:"Level",key:"severity_text",dataIndex:"severity_text",width:0,render:(_,record)=>(0,jsx_runtime.jsx)(LogTag,{level:record.severity_text})},{title:"Message",key:"body",dataIndex:"body",render:body=>(0,jsx_runtime.jsx)("div",{className:(0,css_classes.cn)(wrapBody?"":"whitespace-nowrap"),children:body})}],expandable:{noIndent:!0,expandedRowRender:log=>(0,jsx_runtime.jsx)(ExpandedLog,{log:log})}})})]})}let ExpandedLog=_ref=>{let{log}=_ref,rows=Object.entries(log.attributes).map(_ref2=>{let[key,value]=_ref2;return{key,value}});return(0,jsx_runtime.jsx)(src.g3,{embedded:!0,showHeader:!1,columns:[{title:"Key",key:"key",dataIndex:"key"},{title:"Value",key:"value",dataIndex:"value"}],dataSource:rows})},LogTag=_ref3=>{let{level}=_ref3;return(0,jsx_runtime.jsx)(src.oe,{type:{debug:"completion",info:"caution",warn:"warning",error:"danger"}[level],children:level})},Filters=()=>{let{fetchLogs}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-y-1.5",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between gap-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-1",children:[(0,jsx_runtime.jsx)(ResourceFilter,{}),(0,jsx_runtime.jsx)(SeverityLevelsFilter,{})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-1",children:[(0,jsx_runtime.jsx)(DateRangeFilter,{}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(icons.tr,{}),type:"secondary",onClick:fetchLogs,children:"Refresh"})]})]}),(0,jsx_runtime.jsx)(SearchTermFilter,{})]})},DisplayOptions=()=>{let{orderBy,wrapBody}=(0,index_esm.useValues)(logsLogic),{setOrderBy,setWrapBody}=(0,index_esm.useActions)(logsLogic);return(0,jsx_runtime.jsxs)("div",{className:"flex gap-x-2",children:[(0,jsx_runtime.jsx)(src.P4,{value:orderBy,onChange:setOrderBy,options:[{value:"earliest",label:"Earliest"},{value:"latest",label:"Latest"}],size:"small"}),(0,jsx_runtime.jsx)(src.Hw,{checked:wrapBody,bordered:!0,onChange:setWrapBody,label:"Wrap message",size:"small"})]})}}}]);