(window.webpackJsonp=window.webpackJsonp||[]).push([[241],{5632:function(module,exports,__webpack_require__){(exports=__webpack_require__(70)(!1)).push([module.i,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}",""]),module.exports=exports},5945:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"SystemStatus",(function(){return SystemStatus_SystemStatus}));var injectStylesIntoStyleTag=__webpack_require__(31),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),SystemStatus=__webpack_require__(5632),SystemStatus_default=__webpack_require__.n(SystemStatus),options={insert:"head",singleton:!1},react=(injectStylesIntoStyleTag_default()(SystemStatus_default.a,options),SystemStatus_default.a.locals,__webpack_require__(0)),react_default=__webpack_require__.n(react),es_alert=__webpack_require__(809),tabs=__webpack_require__(1662),systemStatusLogic=__webpack_require__(1108),index_esm=__webpack_require__(4),PageHeader=__webpack_require__(259),logic=__webpack_require__(56),icons=__webpack_require__(93),tag=(__webpack_require__(34),__webpack_require__(48),__webpack_require__(145),__webpack_require__(1107)),card=__webpack_require__(5378),table=__webpack_require__(5340);function RenderValue(value){return"boolean"==typeof value?react_default.a.createElement(tag.a,{color:value?"success":"error"},value?"Yes":"No"):null==value||""===value?react_default.a.createElement(tag.a,null,"Unknown"):value.toString()}function OverviewTab(){var _useValues=Object(index_esm.useValues)(systemStatusLogic.a),overview=_useValues.overview,systemStatusLoading=_useValues.systemStatusLoading,_useValues2=Object(index_esm.useValues)(logic.a),configOptions=_useValues2.configOptions,preflightLoading=_useValues2.preflightLoading,columns=[{title:"Metric",dataIndex:"metric",className:"metric-column"},{title:"Value",dataIndex:"value",render:RenderValue}];return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(card.a,null,react_default.a.createElement("h3",{className:"l3"},"Key metrics"),react_default.a.createElement(table.a,{className:"system-status-table",size:"small",rowKey:"metric",pagination:{pageSize:99999,hideOnSinglePage:!0},dataSource:overview,columns:columns,loading:systemStatusLoading,expandable:{expandedRowRender:function renderExpand(row){return row.subrows?react_default.a.createElement(Subrows,row.subrows):null},rowExpandable:function rowExpandable(row){return!!row.subrows&&row.subrows.rows.length>0},expandRowByClick:!0}}),react_default.a.createElement("h3",{className:"l3",style:{marginTop:32}},"Configuration options"),react_default.a.createElement("p",null,react_default.a.createElement("a",{href:"https://posthog.com/docs/self-host#Configure?utm_medium=in-product",rel:"noopener",target:"_blank"},"Learn more ",react_default.a.createElement(icons.h,{style:{verticalAlign:"middle"}}))),react_default.a.createElement(table.a,{className:"system-config-table",size:"small",rowKey:"metric",pagination:{pageSize:99999,hideOnSinglePage:!0},dataSource:configOptions,columns:columns,loading:preflightLoading})))}function Subrows(props){return react_default.a.createElement(table.a,{rowKey:"metric",pagination:{pageSize:99999,hideOnSinglePage:!0},dataSource:props.rows,columns:props.columns.map((function(title,dataIndex){return{title:title,dataIndex:dataIndex}}))})}__webpack_require__(69),__webpack_require__(207),__webpack_require__(112),__webpack_require__(208);var objectDestructuringEmpty=__webpack_require__(96),objectDestructuringEmpty_default=__webpack_require__.n(objectDestructuringEmpty),slicedToArray=__webpack_require__(16),slicedToArray_default=__webpack_require__.n(slicedToArray),collapse=__webpack_require__(5375),es_checkbox=__webpack_require__(803),es_button=__webpack_require__(115),ReloadOutlined=__webpack_require__(5383),Dashboard=__webpack_require__(5726),modal=(__webpack_require__(172),__webpack_require__(1667)),input=__webpack_require__(649);function AnalyzeQueryModal(){var _useValues=Object(index_esm.useValues)(systemStatusLogic.a),analyzeModalOpen=_useValues.analyzeModalOpen,analyzeQuery=_useValues.analyzeQuery,analyzeQueryResult=_useValues.analyzeQueryResult,analyzeQueryResultLoading=_useValues.analyzeQueryResultLoading,_useActions=Object(index_esm.useActions)(systemStatusLogic.a),setAnalyzeModalOpen=_useActions.setAnalyzeModalOpen,setAnalyzeQuery=_useActions.setAnalyzeQuery,runAnalyzeQuery=_useActions.runAnalyzeQuery;return react_default.a.createElement(modal.a,{visible:analyzeModalOpen,title:"Analyze ClickHouse query performance",footer:react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(es_button.a,{onClick:function onClick(){return setAnalyzeModalOpen(!1)}},"Cancel"),react_default.a.createElement(es_button.a,{type:"primary",onClick:function onClick(){runAnalyzeQuery()},disabled:analyzeQueryResultLoading},"Analyze")),onCancel:function onCancel(){return setAnalyzeModalOpen(!1)},width:"80%"},react_default.a.createElement(input.a.TextArea,{placeholder:"SQL query to analyze",onChange:function onChange(e){return setAnalyzeQuery(e.target.value)},value:analyzeQuery,rows:10}),analyzeQueryResult&&react_default.a.createElement("div",{style:{marginTop:30}},react_default.a.createElement("h2",null,"Analysis results"),react_default.a.createElement("ul",null,Object.entries(analyzeQueryResult.timing).map((function(_ref){var _ref2=slicedToArray_default()(_ref,2),key=_ref2[0],value=_ref2[1];return react_default.a.createElement("li",{key:key},key,": ",value)}))),Object.entries(analyzeQueryResult.flamegraphs).map((function(_ref3){var _ref4=slicedToArray_default()(_ref3,2),key=_ref4[0],value=_ref4[1];return react_default.a.createElement("div",{key:key},react_default.a.createElement("h3",null,"Flamegraph: ",key),react_default.a.createElement("img",{src:"data:image/svg+xml;utf8,".concat(encodeURIComponent(value)),style:{width:"100%"}}))}))))}var Link=__webpack_require__(51);function InternalMetricsTab(){var _useValues=Object(index_esm.useValues)(systemStatusLogic.a),openSections=_useValues.openSections,systemStatus=_useValues.systemStatus,queries=_useValues.queries,queriesLoading=_useValues.queriesLoading,showAnalyzeQueryButton=_useValues.showAnalyzeQueryButton,_useActions=Object(index_esm.useActions)(systemStatusLogic.a),setOpenSections=_useActions.setOpenSections,loadQueries=_useActions.loadQueries,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),showIdle=_useState2[0],setShowIdle=_useState2[1],postgresQueries=Object(react.useMemo)((function(){var _queries$postgres_run;return null==queries||null===(_queries$postgres_run=queries.postgres_running)||void 0===_queries$postgres_run?void 0:_queries$postgres_run.filter((function(_ref){var state=_ref.state;return showIdle||"idle"!==state}))}),[showIdle,queries]),dashboard=null==systemStatus?void 0:systemStatus.internal_metrics.clickhouse,reloadQueries=function reloadQueries(e){e.stopPropagation(),loadQueries()};return react_default.a.createElement(card.a,null,react_default.a.createElement(collapse.a,{activeKey:openSections,onChange:function onChange(keys){return setOpenSections(keys)}},dashboard?react_default.a.createElement(collapse.a.Panel,{header:"Dashboards",key:"0"},react_default.a.createElement(Dashboard.Dashboard,{id:dashboard.id.toString(),shareToken:dashboard.share_token,internal:!0})):null,react_default.a.createElement(collapse.a.Panel,{header:"PostgreSQL - currently running queries",key:"1"},react_default.a.createElement("div",{className:"mb float-right"},react_default.a.createElement(es_checkbox.a,{checked:showIdle,onChange:function onChange(e){setShowIdle(e.target.checked)}},"Show idle queries"),react_default.a.createElement(es_button.a,{style:{marginLeft:8},onClick:reloadQueries},react_default.a.createElement(ReloadOutlined.a,null)," Reload Queries")),react_default.a.createElement(QueryTable,{queries:postgresQueries,loading:queriesLoading})),null!=(null==queries?void 0:queries.clickhouse_running)?react_default.a.createElement(collapse.a.Panel,{header:"Clickhouse - currently running queries",key:"2"},react_default.a.createElement("div",{className:"mb float-right"},react_default.a.createElement(es_button.a,{style:{marginLeft:8},onClick:reloadQueries},react_default.a.createElement(ReloadOutlined.a,null)," Reload Queries")),react_default.a.createElement(QueryTable,{queries:null==queries?void 0:queries.clickhouse_running,loading:queriesLoading,showAnalyze:showAnalyzeQueryButton})):null,null!=(null==queries?void 0:queries.clickhouse_slow_log)?react_default.a.createElement(collapse.a.Panel,{header:"Clickhouse - slow query log (past 6 hours)",key:"3"},react_default.a.createElement("div",{className:"mb float-right"},react_default.a.createElement(es_button.a,{style:{marginLeft:8},onClick:reloadQueries},react_default.a.createElement(ReloadOutlined.a,null)," Reload Queries")),react_default.a.createElement(QueryTable,{queries:null==queries?void 0:queries.clickhouse_slow_log,loading:queriesLoading,showAnalyze:showAnalyzeQueryButton})):null),react_default.a.createElement(AnalyzeQueryModal,null))}function QueryTable(props){var openAnalyzeModalWithQuery=Object(index_esm.useActions)(systemStatusLogic.a).openAnalyzeModalWithQuery,columns=[{title:"duration",dataIndex:"duration",key:"duration",sorter:function sorter(a,b){return+a.duration-+b.duration}},{title:"query",dataIndex:"query",render:function RenderAnalyze(_ref2,item){return objectDestructuringEmpty_default()(_ref2),props.showAnalyze?react_default.a.createElement(Link.a,{to:"#",onClick:function onClick(){return openAnalyzeModalWithQuery(item.query)}},item.query):item.query},key:"query"}];return props.queries&&props.queries.length>0&&Object.keys(props.queries[0]).forEach((function(column){"duration"!==column&&"query"!==column&&columns.push({title:column,dataIndex:column,key:column})})),react_default.a.createElement(table.a,{dataSource:props.queries||[],columns:columns,loading:props.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",bordered:!0,style:{overflowX:"auto",overflowY:"auto"},locale:{emptyText:"No queries found"}})}function SystemStatus_SystemStatus(){var _useValues=Object(index_esm.useValues)(systemStatusLogic.a),tab=_useValues.tab,error=_useValues.error,systemStatus=_useValues.systemStatus,setTab=Object(index_esm.useActions)(systemStatusLogic.a).setTab,_useValues2=Object(index_esm.useValues)(logic.a),preflight=_useValues2.preflight,siteUrlMisconfigured=_useValues2.siteUrlMisconfigured;return react_default.a.createElement("div",{className:"system-status-scene"},react_default.a.createElement(PageHeader.a,{title:"System Status",caption:"Here you can find all the critical runtime details about your PostHog installation."}),error&&react_default.a.createElement(es_alert.a,{message:"Something went wrong",description:error||react_default.a.createElement("span",null,"An unknown error occurred. Please try again or contact us."),type:"error",showIcon:!0}),siteUrlMisconfigured&&react_default.a.createElement(es_alert.a,{message:"Misconfiguration detected",description:react_default.a.createElement(react_default.a.Fragment,null,"Your ",react_default.a.createElement("code",null,"SITE_URL")," environment variable seems misconfigured. Your"," ",react_default.a.createElement("code",null,"SITE_URL")," is set to"," ",react_default.a.createElement("b",null,react_default.a.createElement("code",null,null==preflight?void 0:preflight.site_url))," ","but you're currently browsing this page from"," ",react_default.a.createElement("b",null,react_default.a.createElement("code",null,window.location.origin)),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."," ",react_default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig"},"Learn more ",react_default.a.createElement(icons.h,null))),showIcon:!0,type:"warning",style:{marginBottom:32}}),(null==systemStatus?void 0:systemStatus.internal_metrics.clickhouse)?react_default.a.createElement(tabs.a,{tabPosition:"top",animated:!1,activeKey:tab,onTabClick:function onTabClick(key){return setTab(key)}},react_default.a.createElement(tabs.a.TabPane,{tab:"Overview",key:"overview"},react_default.a.createElement(OverviewTab,null)),react_default.a.createElement(tabs.a.TabPane,{tab:"Internal metrics",key:"internal_metrics"},react_default.a.createElement(InternalMetricsTab,null))):react_default.a.createElement(OverviewTab,null))}}}]);