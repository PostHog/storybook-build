"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[88088],{"../../products/error_tracking/frontend/scenes/ErrorTrackingIssueV2Scene/ErrorTrackingIssueV2Scene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ErrorTrackingIssueV2Scene:()=>ErrorTrackingIssueV2Scene,scene:()=>scene}),__webpack_require__("../../products/error_tracking/frontend/scenes/ErrorTrackingIssueScene/ErrorTrackingIssueScene.scss");var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.290.0/node_modules/posthog-js/dist/module.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),Resizer=__webpack_require__("../../frontend/src/lib/components/Resizer/Resizer.tsx"),resizerLogic=__webpack_require__("../../frontend/src/lib/components/Resizer/resizerLogic.ts"),ScrollableShadows=__webpack_require__("../../frontend/src/lib/components/ScrollableShadows/ScrollableShadows.tsx"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),ButtonPrimitives=__webpack_require__("../../frontend/src/lib/ui/Button/ButtonPrimitives.tsx"),TabsPrimitive=__webpack_require__("../../frontend/src/lib/ui/TabsPrimitive/TabsPrimitive.tsx"),copyToClipboard=__webpack_require__("../../frontend/src/lib/utils/copyToClipboard.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),sidePanelLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/sidePanelLogic.tsx"),SceneBreadcrumbs=__webpack_require__("../../frontend/src/layout/scenes/components/SceneBreadcrumbs.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),queries=__webpack_require__("../../products/error_tracking/frontend/queries.ts"),errorTrackingIssueSceneLogic=__webpack_require__("../../products/error_tracking/frontend/scenes/ErrorTrackingIssueScene/errorTrackingIssueSceneLogic.ts"),fast_deep_equal=__webpack_require__("../../node_modules/.pnpm/fast-deep-equal@3.1.3/node_modules/fast-deep-equal/index.js"),fast_deep_equal_default=__webpack_require__.n(fast_deep_equal),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),utils=__webpack_require__("../../products/error_tracking/frontend/utils.ts"),consts=__webpack_require__("../../products/error_tracking/frontend/components/Breakdowns/consts.ts");let breakdownFiltersLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","error_tracking","components","Breakdowns","breakdownFiltersLogic"]),(0,index_esm.actions)({setDateRange:dateRange=>({dateRange}),setFilterTestAccounts:filterTestAccounts=>({filterTestAccounts}),setFilterOpen:filterOpen=>({filterOpen}),setBreakdownProperty:breakdownProperty=>({breakdownProperty})}),(0,index_esm.reducers)({dateRange:[consts.fI,{persist:!0},{setDateRange:(_,_ref)=>{let{dateRange}=_ref;return dateRange}}],filterTestAccounts:[consts.fY,{persist:!0},{setFilterTestAccounts:(_,_ref2)=>{let{filterTestAccounts}=_ref2;return filterTestAccounts}}],breakdownProperty:["$browser",{persist:!0},{setBreakdownProperty:(_,_ref3)=>{let{breakdownProperty}=_ref3;return breakdownProperty}}],filterOpen:[!1,{setFilterOpen:(_,_ref4)=>{let{filterOpen}=_ref4;return filterOpen}}]}),(0,lib.urlToAction)(_ref5=>{let{actions,values}=_ref5;return{"*":(_,params)=>{var _params$dateRange,_params$filterTestAcc,_params$breakdownProp;let dateRange=null!==(_params$dateRange=params.dateRange)&&void 0!==_params$dateRange?_params$dateRange:consts.fI;fast_deep_equal_default()(dateRange,values.dateRange)||actions.setDateRange(dateRange);let filterTestAccounts=null!==(_params$filterTestAcc=params.filterTestAccounts)&&void 0!==_params$filterTestAcc?_params$filterTestAcc:consts.fY;filterTestAccounts!==values.filterTestAccounts&&actions.setFilterTestAccounts(filterTestAccounts);let breakdownProperty=null!==(_params$breakdownProp=params.breakdownProperty)&&void 0!==_params$breakdownProp?_params$breakdownProp:"$browser";breakdownProperty!==values.breakdownProperty&&actions.setBreakdownProperty(breakdownProperty)}}}),(0,lib.actionToUrl)(_ref6=>{let{values}=_ref6,buildURL=()=>(0,utils.qI)(lib.router,params=>((0,utils.aM)(params,"filterTestAccounts",values.filterTestAccounts,consts.fY),(0,utils.aM)(params,"dateRange",values.dateRange,consts.fI),(0,utils.aM)(params,"breakdownProperty",values.breakdownProperty,"$browser"),params));return{setDateRange:()=>buildURL(),setFilterTestAccounts:()=>buildURL(),setBreakdownProperty:()=>buildURL()}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function BreakdownsChart(){let{issue}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r),{breakdownProperty,dateRange,filterTestAccounts}=(0,index_esm.useValues)(breakdownFiltersLogic),query=(0,react.useMemo)(()=>{var _issue$id;return(0,queries.LD)({breakdownProperty,dateRange,filterTestAccounts,filterGroup:{type:types.J2.And,values:[{type:types.J2.And,values:[]}]},issueId:null!==(_issue$id=issue?.id)&&void 0!==_issue$id?_issue$id:""})},[breakdownProperty,dateRange,filterTestAccounts,issue?.id]);return issue?.id?(0,jsx_runtime.jsx)("div",{className:"border rounded bg-surface-primary p-3",children:(0,jsx_runtime.jsx)(Query.A,{query:query,context:{ignoreActionsInSeriesLabels:!0}})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}var DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),PropertyKeyInfo=__webpack_require__("../../frontend/src/lib/components/PropertyKeyInfo.tsx"),TaxonomicFilter=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/TaxonomicFilter.tsx"),TaxonomicFilter_types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),Popover=__webpack_require__("../../frontend/src/lib/lemon-ui/Popover/index.ts"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),TestAccountFilter=__webpack_require__("../../frontend/src/scenes/insights/filters/TestAccountFilter/index.ts");function BreakdownsSearchBar(){let{dateRange,filterTestAccounts,filterOpen,breakdownProperty}=(0,index_esm.useValues)(breakdownFiltersLogic),{setDateRange,setFilterTestAccounts,setFilterOpen,setBreakdownProperty}=(0,index_esm.useActions)(breakdownFiltersLogic);return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary p-3 flex gap-2 items-center",children:[(0,jsx_runtime.jsx)(DateFilter.f,{size:"small",dateFrom:dateRange.date_from,dateTo:dateRange.date_to,fullWidth:!1,dateOptions:lib_utils.bE,onChange:(changedDateFrom,changedDateTo)=>{setDateRange({date_from:changedDateFrom,date_to:changedDateTo})},allowedRollingDateOptions:["hours","days","weeks","months","years"]}),(0,jsx_runtime.jsx)(Popover.J2,{overlay:(0,jsx_runtime.jsx)(TaxonomicFilter.I,{value:breakdownProperty,onChange:(_,value)=>{value&&(setBreakdownProperty(String(value)),dist_module.ZP.capture(consts.KJ.PropertySelected,{property:String(value)})),setFilterOpen(!1)},taxonomicGroupTypes:consts.Bt}),visible:filterOpen,onClickOutside:()=>setFilterOpen(!1),children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",onClick:()=>setFilterOpen(!filterOpen),children:(0,jsx_runtime.jsx)(PropertyKeyInfo.T,{value:breakdownProperty,disablePopover:!0,type:TaxonomicFilter_types.t.EventProperties})})}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(TestAccountFilter.z,{size:"small",filters:{filter_test_accounts:filterTestAccounts},onChange:_ref=>{let{filter_test_accounts}=_ref;return setFilterTestAccounts(filter_test_accounts||!1)}})})]})}var EventsTable=__webpack_require__("../../products/error_tracking/frontend/components/EventsTable/EventsTable.tsx"),ExceptionCard=__webpack_require__("../../products/error_tracking/frontend/components/ExceptionCard/index.ts"),IssueFilters=__webpack_require__("../../products/error_tracking/frontend/components/IssueFilters/index.tsx"),issueFiltersLogic=__webpack_require__("../../products/error_tracking/frontend/components/IssueFilters/issueFiltersLogic.ts"),IssueMetadata=__webpack_require__("../../products/error_tracking/frontend/components/IssueMetadata.tsx"),SetupPrompt=__webpack_require__("../../products/error_tracking/frontend/components/SetupPrompt/SetupPrompt.tsx"),use_error_tag_renderer=__webpack_require__("../../products/error_tracking/frontend/hooks/use-error-tag-renderer.tsx"),ScenePanel=__webpack_require__("../../products/error_tracking/frontend/scenes/ErrorTrackingIssueScene/ScenePanel/index.tsx"),SimilarIssuesList=__webpack_require__("../../products/error_tracking/frontend/scenes/ErrorTrackingIssueScene/ScenePanel/SimilarIssuesList.tsx");let errorTrackingIssueSceneConfigurationLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","error_tracking","scenes","ErrorTrackingIssueScene","errorTrackingIssueSceneConfigurationLogic"]),(0,index_esm.actions)({setIsSidebarOpen:isOpen=>({isOpen}),setCategory:category=>({category}),openSidebar:category=>({category})}),(0,index_esm.defaults)({isSidebarOpen:!0,category:"overview"}),(0,index_esm.reducers)(()=>({isSidebarOpen:{setIsSidebarOpen:(_,_ref)=>{let{isOpen}=_ref;return isOpen},openSidebar:()=>!0},category:{setCategory:(_,_ref2)=>{let{category}=_ref2;return category},openSidebar:(_,_ref3)=>{let{category}=_ref3;return category}}}))]),scene={component:ErrorTrackingIssueV2Scene,logic:errorTrackingIssueSceneLogic.r,paramsToProps:_ref=>{let{params:{id},searchParams:{fingerprint,timestamp}}=_ref;return{id,fingerprint,timestamp}}};function ErrorTrackingIssueV2Scene(){let{issueId}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r);return(0,react.useEffect)(()=>{dist_module.ZP.capture("error_tracking_issue_viewed",{issue_id:issueId})},[issueId]),(0,jsx_runtime.jsx)(SetupPrompt.n,{children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:issueFiltersLogic.H,props:{logicKey:errorTrackingIssueSceneLogic.W},children:(0,jsx_runtime.jsx)(SetupPrompt.n,{children:(0,jsx_runtime.jsxs)("div",{className:"ErrorTrackingIssue flex h-full min-h-0",children:[(0,jsx_runtime.jsx)(LeftHandColumn,{}),(0,jsx_runtime.jsx)(RightHandColumn,{})]})})})})}let RightHandColumn=()=>{let{issue,issueLoading,selectedEvent,initialEventLoading}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r),tagRenderer=(0,use_error_tag_renderer.h)(),isPostHogSDKIssue=selectedEvent?.properties.$exception_values?.some(v=>v.includes("persistence.isDisabled is not a function"));return(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 gap-y-1 pl-4 overflow-y-auto min-w-[375px]",children:[isPostHogSDKIssue&&(0,jsx_runtime.jsx)(src.Vp,{type:"error",action:{to:"https://status.posthog.com/incidents/l70cgmt7475m",children:"Read more"},className:"mb-4",children:"This issue was captured because of a bug in the PostHog SDK. We've fixed the issue, and you won't be charged for any of these exception events. We recommend setting this issue's status to \"Suppressed\"."}),(0,jsx_runtime.jsx)(ExceptionCard.F,{issue:null!=issue?issue:void 0,issueLoading:issueLoading,event:null!=selectedEvent?selectedEvent:void 0,eventLoading:initialEventLoading,label:tagRenderer(selectedEvent)})]})},LeftHandColumn=()=>{let{category,isSidebarOpen}=(0,index_esm.useValues)(errorTrackingIssueSceneConfigurationLogic),{setCategory,openSidebar,setIsSidebarOpen}=(0,index_esm.useActions)(errorTrackingIssueSceneConfigurationLogic),ref=(0,react.useRef)(null),resizerLogicProps={containerRef:ref,logicKey:"error-tracking-issue",persistent:!0,closeThreshold:240,onToggleClosed:closed=>setIsSidebarOpen(!closed),onDoubleClick:()=>setIsSidebarOpen(!isSidebarOpen),placement:"right"},{desiredSize}=(0,index_esm.useValues)((0,resizerLogic.Z)(resizerLogicProps)),{issue}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r),{openSidePanel}=(0,index_esm.useActions)(sidePanelLogic.x),comment=(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{onClick:()=>openSidePanel(types.H$.Discussion),tooltip:"Comment",iconOnly:!isSidebarOpen,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconComment,{})}),copyLink=(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{onClick:()=>{issue&&(0,copyToClipboard.v)(window.location.origin+urls.j.errorTrackingIssueV2(issue.id),"issue link")},iconOnly:!isSidebarOpen,tooltip:"Share",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconShare,{})});return(0,jsx_runtime.jsxs)("div",{ref:ref,style:isSidebarOpen?{width:null!=desiredSize?desiredSize:"30%",minWidth:320}:{},className:"flex flex-col relative",children:[isSidebarOpen?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center pr-1",children:[(0,jsx_runtime.jsx)(SceneBreadcrumbs.A,{}),(0,jsx_runtime.jsxs)("div",{children:[comment,copyLink]})]}),(0,jsx_runtime.jsx)(src.p2,{className:"mt-1"}),(0,jsx_runtime.jsxs)(TabsPrimitive.F1,{value:category,onValueChange:value=>setCategory(value),className:"flex flex-col min-h-0",children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(ScrollableShadows.D,{direction:"horizontal",className:"border-b",hideScrollbars:!0,children:(0,jsx_runtime.jsxs)(TabsPrimitive.qf,{className:"flex justify-between space-x-2",children:[(0,jsx_runtime.jsxs)(TabsPrimitive.Em,{className:"flex items-center px-2 py-1.5",value:"overview",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{className:"mr-1"}),(0,jsx_runtime.jsx)("span",{className:"text-nowrap",children:"Overview"})]}),(0,jsx_runtime.jsxs)(TabsPrimitive.Em,{className:"flex items-center px-2 py-1.5",value:"exceptions",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconList,{className:"mr-1"}),(0,jsx_runtime.jsx)("span",{className:"text-nowrap",children:"Exceptions"})]}),(0,jsx_runtime.jsxs)(TabsPrimitive.Em,{className:"flex items-center px-2 py-1.5",value:"breakdowns",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconFilter,{className:"mr-1"}),(0,jsx_runtime.jsx)("span",{className:"text-nowrap",children:"Breakdowns"})]}),(0,jsx_runtime.jsxs)(TabsPrimitive.Em,{className:"flex items-center px-2 py-1.5",value:"autofix",children:[(0,jsx_runtime.jsx)(icons.Ye,{className:"mr-1"}),(0,jsx_runtime.jsx)("span",{className:"text-nowrap",children:"Autofix"})]}),(0,jsx_runtime.jsxs)(TabsPrimitive.Em,{className:"flex items-center px-2 py-1.5",value:"similar_issues",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconSearch,{className:"mr-1"}),(0,jsx_runtime.jsx)("span",{className:"text-nowrap",children:"Similar issues"})]})]})})}),(0,jsx_runtime.jsx)(TabsPrimitive.TN,{value:"overview",className:"flex flex-col overflow-y-auto pt-2 pr-2",children:(0,jsx_runtime.jsx)(ScenePanel.L,{showActions:!1,showSimilarIssues:!1})}),(0,jsx_runtime.jsx)(TabsPrimitive.TN,{value:"exceptions",className:"h-full min-h-0",children:(0,jsx_runtime.jsx)(ExceptionsTab,{})}),(0,jsx_runtime.jsxs)(TabsPrimitive.TN,{value:"breakdowns",children:[(0,jsx_runtime.jsx)(BreakdownsSearchBar,{}),(0,jsx_runtime.jsx)(BreakdownsChart,{})]}),(0,jsx_runtime.jsx)(TabsPrimitive.TN,{value:"autofix",children:"AI autofix"}),(0,jsx_runtime.jsx)(TabsPrimitive.TN,{value:"similar_issues",children:(0,jsx_runtime.jsx)(SimilarIssuesList._,{})})]})]}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col pr-0.5",children:[(0,jsx_runtime.jsx)(SceneBreadcrumbs.A,{}),comment,copyLink,(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{onClick:()=>openSidebar("overview"),iconOnly:!0,tooltip:"Overview",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{})}),(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{onClick:()=>openSidebar("exceptions"),iconOnly:!0,tooltip:"Exceptions",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconList,{})}),(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{onClick:()=>openSidebar("breakdowns"),iconOnly:!0,tooltip:"Breakdowns",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconFilter,{})}),(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{onClick:()=>openSidebar("autofix"),iconOnly:!0,tooltip:"AI Autofix",children:(0,jsx_runtime.jsx)(icons.Ye,{})}),(0,jsx_runtime.jsx)(ButtonPrimitives.hL,{onClick:()=>openSidebar("similar_issues"),iconOnly:!0,tooltip:"Similar issues",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconSearch,{})})]}),(0,jsx_runtime.jsx)(Resizer.w,{...resizerLogicProps})]})},ExceptionsTab=()=>{let{eventsQuery,eventsQueryKey}=(0,index_esm.useValues)(errorTrackingIssueSceneLogic.r),{selectEvent}=(0,index_esm.useActions)(errorTrackingIssueSceneLogic.r);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col h-full gap-y-2",children:[(0,jsx_runtime.jsxs)(IssueFilters.h.Root,{className:"pt-2 pr-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 justify-between flex-wrap",children:[(0,jsx_runtime.jsx)(IssueFilters.h.DateRange,{}),(0,jsx_runtime.jsx)(IssueFilters.h.InternalAccounts,{})]}),(0,jsx_runtime.jsx)(IssueFilters.h.FilterGroup,{})]}),(0,jsx_runtime.jsx)(IssueMetadata.S,{className:"flex flex-col overflow-y-auto rounded-r-none border-r-0",children:(0,jsx_runtime.jsx)(EventsTable.Y,{query:eventsQuery,queryKey:eventsQueryKey,selectedEvent:null,onEventSelect:selectedEvent=>{selectedEvent&&selectEvent(selectedEvent)}})})]})}}}]);