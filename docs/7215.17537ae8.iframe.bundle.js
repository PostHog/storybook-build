"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[7215],{"./frontend/src/scenes/data-management/definition/DefinitionView.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DefinitionView:()=>DefinitionView,scene:()=>scene});var _posthog_apps_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/apps-common/src/index.ts"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router_lib_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/utils.js"),lib_components_EditableField_EditableField__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),lib_components_NotFound__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),lib_components_ObjectTags_ObjectTags__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),lib_components_UserActivityIndicator_UserActivityIndicator__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/lib/components/UserActivityIndicator/UserActivityIndicator.tsx"),lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonDialog__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDialog/index.ts"),lib_lemon_ui_Spinner_Spinner__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),lib_taxonomy__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./frontend/src/lib/taxonomy.tsx"),scenes_data_management_definition_definitionLogic__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./frontend/src/scenes/data-management/definition/definitionLogic.ts"),scenes_data_management_events_EventDefinitionProperties__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./frontend/src/scenes/data-management/events/EventDefinitionProperties.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./frontend/src/scenes/urls.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_queries_nodes_DataTable_utils__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./frontend/src/queries/nodes/DataTable/utils.ts"),_queries_Query_Query__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),_queries_schema__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("./frontend/src/queries/schema.ts"),_types__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("./frontend/src/types.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:DefinitionView,logic:scenes_data_management_definition_definitionLogic__WEBPACK_IMPORTED_MODULE_15__.k,paramsToProps:_ref=>{let{params:{id}}=_ref;return{id}}};function DefinitionView(){var _definition$tags,_property_type;let props=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},logic=(0,scenes_data_management_definition_definitionLogic__WEBPACK_IMPORTED_MODULE_15__.k)(props),{definition,definitionLoading,definitionMissing,hasTaxonomyFeatures,singular,isEvent,isProperty}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(logic),{deleteDefinition}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(logic),{hasAvailableFeature}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(scenes_userLogic__WEBPACK_IMPORTED_MODULE_18__.userLogic);return definitionLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_lemon_ui_Spinner_Spinner__WEBPACK_IMPORTED_MODULE_13__.t,{sceneLevel:!0}):definitionMissing?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_5__.T,{object:"event"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_7__.m,{buttons:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.Fragment,{children:[isEvent&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_11__.J,{type:"secondary",to:(0,kea_router_lib_utils__WEBPACK_IMPORTED_MODULE_3__.combineUrl)(scenes_urls__WEBPACK_IMPORTED_MODULE_17__.j.replay(),{filters:{events:[{id:definition.name,type:"events",order:0,name:definition.name}]}}).url,sideIcon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_10__.Ud,{}),"data-attr":"event-definition-view-recordings",children:"View recordings"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_11__.J,{"data-attr":"delete-definition",type:"secondary",status:"danger",onClick:()=>lib_lemon_ui_LemonDialog__WEBPACK_IMPORTED_MODULE_12__.d.open({title:`Delete this ${singular} definition?`,description:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("p",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("strong",{children:(0,lib_taxonomy__WEBPACK_IMPORTED_MODULE_14__.R6)(definition.name,isEvent?lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_8__.t.Events:lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_8__.t.EventProperties)})," ","will no\xa0longer appear in\xa0selectors. Associated\xa0data will remain in\xa0the\xa0database."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("p",{children:["This\xa0definition will be recreated if\xa0the\xa0",singular," is\xa0ever seen again in\xa0the\xa0event\xa0stream."]})]}),primaryButton:{status:"danger",children:"Delete definition",onClick:()=>deleteDefinition()},secondaryButton:{children:"Cancel"},width:448}),tooltip:"Delete this definition. Associated data will remain.",children:"Delete"}),(hasTaxonomyFeatures||isProperty)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_11__.J,{"data-attr":"edit-definition",type:"secondary",to:isEvent?scenes_urls__WEBPACK_IMPORTED_MODULE_17__.j.eventDefinitionEdit(definition.id):scenes_urls__WEBPACK_IMPORTED_MODULE_17__.j.propertyDefinitionEdit(definition.id),children:"Edit"})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_components_EditableField_EditableField__WEBPACK_IMPORTED_MODULE_4__.f,{multiline:!0,name:"description",markdown:!0,value:definition.description||"",placeholder:"Description (optional)",mode:"view","data-attr":"definition-description-view",className:"definition-description",compactButtons:!0,maxLength:600,paywall:!hasAvailableFeature(_types__WEBPACK_IMPORTED_MODULE_22__.P$.INGESTION_TAXONOMY)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_components_ObjectTags_ObjectTags__WEBPACK_IMPORTED_MODULE_6__.D,{tags:null!==(_definition$tags=definition.tags)&&void 0!==_definition$tags?_definition$tags:[],"data-attr":"definition-tags-view",className:"definition-tags",saving:definitionLoading}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(lib_components_UserActivityIndicator_UserActivityIndicator__WEBPACK_IMPORTED_MODULE_9__.F,{at:definition.updated_at,by:definition.updated_by}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-muted-alt",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("div",{children:"Raw event name:"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonTag,{className:"font-mono",children:definition.name})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonDivider,{className:"my-6"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div",{className:"flex flex-wrap",children:[isEvent&&definition.created_at&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("h5",{children:"First seen"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("b",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_posthog_apps_common__WEBPACK_IMPORTED_MODULE_0__.TZLabel,{time:definition.created_at})})]}),isEvent&&definition.last_seen_at&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("h5",{children:"Last seen"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("b",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_posthog_apps_common__WEBPACK_IMPORTED_MODULE_0__.TZLabel,{time:definition.last_seen_at})})]}),isProperty&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("h5",{children:"Property type"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("b",{children:null!==(_property_type=definition.property_type)&&void 0!==_property_type?_property_type:"-"})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonDivider,{className:"my-6"}),isEvent&&"new"!==definition.id&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(scenes_data_management_events_EventDefinitionProperties__WEBPACK_IMPORTED_MODULE_16__.Q,{definition:definition}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonDivider,{className:"my-6"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("h3",{children:"Matching events"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)("p",{children:"This is the list of recent events that match this definition."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_23__.jsx)(_queries_Query_Query__WEBPACK_IMPORTED_MODULE_20__.A,{query:{kind:_queries_schema__WEBPACK_IMPORTED_MODULE_21__.OH.DataTableNode,source:{kind:_queries_schema__WEBPACK_IMPORTED_MODULE_21__.OH.EventsQuery,select:(0,_queries_nodes_DataTable_utils__WEBPACK_IMPORTED_MODULE_19__.Qi)(_queries_schema__WEBPACK_IMPORTED_MODULE_21__.OH.EventsQuery),event:definition.name},full:!0,showEventFilter:!1}})]})]})}},"./frontend/src/scenes/data-management/definition/definitionLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>definitionLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts"),lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),lib_taxonomy__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/taxonomy.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/urls.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_models_propertyDefinitionsModel__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/models/propertyDefinitionsModel.ts"),_types__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/types.ts"),_DataManagementScene__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/scenes/data-management/DataManagementScene.tsx"),_events_eventDefinitionsTableLogic__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts"),_properties_propertyDefinitionsTableLogic__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/scenes/data-management/properties/propertyDefinitionsTableLogic.ts");let createNewDefinition=isEvent=>({id:"new",name:`New ${isEvent?"Event":"Event property"}`}),definitionLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-management","definition","definitionViewLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.id||"new"),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setDefinition:function(definition){let options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{definition,options}},loadDefinition:id=>({id}),setDefinitionMissing:!0}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_userLogic__WEBPACK_IMPORTED_MODULE_8__.userLogic,["hasAvailableFeature"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(()=>({definitionMissing:[!1,{setDefinitionMissing:()=>!0}]})),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values,actions}=_ref;return{definition:[createNewDefinition(values.isEvent),{setDefinition:_ref2=>{let{definition,options:{merge}}=_ref2;return merge?{...values.definition,...definition}:definition},loadDefinition:async(_ref3,breakpoint)=>{let{id}=_ref3,definition={...values.definition};try{values.isEvent?definition=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.eventDefinitions.get({eventDefinitionId:id}):(definition=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.propertyDefinitions.get({propertyDefinitionId:id}),(0,_models_propertyDefinitionsModel__WEBPACK_IMPORTED_MODULE_9__.s)({[`event/${definition.name}`]:definition})),breakpoint()}catch(response){throw actions.setDefinitionMissing(),response}return definition},deleteDefinition:async()=>(values.isEvent?await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.eventDefinitions.delete({eventDefinitionId:values.definition.id}):await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.propertyDefinitions.delete({propertyDefinitionId:values.definition.id}),kea_router__WEBPACK_IMPORTED_MODULE_2__.router.actions.push(values.isEvent?scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.eventDefinitions():scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.propertyDefinitions()),values.isEvent?_events_eventDefinitionsTableLogic__WEBPACK_IMPORTED_MODULE_12__.qh.findMounted()?.actions.loadEventDefinitions():_properties_propertyDefinitionsTableLogic__WEBPACK_IMPORTED_MODULE_13__.T.findMounted()?.actions.loadPropertyDefinitions(),values.definition)}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({hasTaxonomyFeatures:[s=>[s.hasAvailableFeature],hasAvailableFeature=>hasAvailableFeature(_types__WEBPACK_IMPORTED_MODULE_10__.P$.INGESTION_TAXONOMY)||hasAvailableFeature(_types__WEBPACK_IMPORTED_MODULE_10__.P$.TAGGING)],isEvent:[()=>[kea_router__WEBPACK_IMPORTED_MODULE_2__.router.selectors.location],_ref4=>{let{pathname}=_ref4;return pathname.includes(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.eventDefinitions())}],isProperty:[s=>[s.isEvent],isEvent=>!isEvent],singular:[s=>[s.isEvent],isEvent=>isEvent?"event":"property"],breadcrumbs:[s=>[s.definition,s.isEvent],(definition,isEvent)=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_6__.x.DataManagement,name:"Data Management",path:isEvent?scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.eventDefinitions():scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.propertyDefinitions()},{key:isEvent?_DataManagementScene__WEBPACK_IMPORTED_MODULE_11__.DataManagementTab.EventDefinitions:_DataManagementScene__WEBPACK_IMPORTED_MODULE_11__.DataManagementTab.PropertyDefinitions,name:isEvent?"Events":"Properties",path:isEvent?scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.eventDefinitions():scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.propertyDefinitions()},{key:[isEvent?scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_6__.x.EventDefinition:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_6__.x.PropertyDefinition,definition?.id||"new"],name:definition?.id!=="new"&&(0,lib_taxonomy__WEBPACK_IMPORTED_MODULE_5__.R6)(definition?.name,isEvent?lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.Events:lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.EventProperties)||"Untitled"}]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref5=>{let{actions,values,props}=_ref5;props.id&&"new"!==props.id?actions.loadDefinition(props.id):actions.setDefinition(createNewDefinition(values.isEvent))})])}}]);