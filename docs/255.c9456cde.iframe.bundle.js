(window.webpackJsonp=window.webpackJsonp||[]).push([[255],{"./frontend/src/scenes/experiments/Experiment.tsx":function(Re,X,c){"use strict";c.r(X),c.d(X,"scene",function(){return _t}),c.d(X,"Experiment",function(){return vt}),c.d(X,"CodeLanguageSelect",function(){return gt});var _e=c("./node_modules/core-js/modules/es.symbol.js"),Fn=c("./node_modules/core-js/modules/es.symbol.description.js"),Tn=c("./node_modules/core-js/modules/es.array.concat.js"),Cn=c("./node_modules/core-js/modules/es.array.filter.js"),Mn=c("./node_modules/core-js/modules/es.array.map.js"),Dn=c("./node_modules/core-js/modules/es.array.reduce.js"),Pn=c("./node_modules/core-js/modules/es.function.name.js"),Ln=c("./node_modules/core-js/modules/es.number.constructor.js"),Rn=c("./node_modules/core-js/modules/es.number.to-fixed.js"),kn=c("./node_modules/core-js/modules/es.object.keys.js"),An=c("./node_modules/core-js/modules/es.object.to-string.js"),Vn=c("./node_modules/core-js/modules/es.regexp.to-string.js"),It=c("./node_modules/@babel/runtime/helpers/defineProperty.js"),Ne=c.n(It),jt=c("./node_modules/@babel/runtime/helpers/slicedToArray.js"),ce=c.n(jt),B=c("./node_modules/antd/es/form/index.js"),g=c("./node_modules/antd/es/row/index.js"),f=c("./node_modules/antd/es/col/index.js"),me=c("./node_modules/antd/es/input/index.js"),we=c("./node_modules/antd/es/tooltip/index.js"),Y=c("./node_modules/antd/es/select/index.js"),ie=c("./node_modules/antd/es/card/index.js"),et=c("./node_modules/antd/es/tag/index.js"),tt=c("./node_modules/antd/es/collapse/index.js"),ke=c("./node_modules/antd/es/skeleton/index.js"),nt=c("./node_modules/antd/es/progress/index.js"),D=c("./node_modules/kea/lib/index.esm.js"),at=c("./frontend/src/lib/components/PageHeader.tsx"),Ot=c("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Ft=c("./frontend/src/lib/components/PropertyFilters/utils.ts"),I=c("./frontend/src/lib/components/TaxonomicFilter/types.ts"),de=c("./node_modules/react/index.js"),e=c.n(de),Se=c("./frontend/src/scenes/funnels/funnelLogic.ts"),se=c("./frontend/src/scenes/insights/ActionFilter/ActionFilter.tsx"),ue=c("./frontend/src/scenes/insights/insightLogic.ts"),u=c("./frontend/src/types.ts"),Tt=c("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Ct=c.n(Tt),Mt=c("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss"),rt=c.n(Mt),Ae={};Ae.insert="head",Ae.singleton=!1;var Yn=Ct()(rt.a,Ae),$n=rt.a.locals||{},Un=c("./node_modules/core-js/modules/es.array.fill.js"),zn=c("./node_modules/core-js/modules/es.array.find.js"),Bn=c("./node_modules/core-js/modules/es.array.find-index.js"),Gn=c("./node_modules/core-js/modules/es.array.iterator.js"),Hn=c("./node_modules/core-js/modules/es.array.splice.js"),Wn=c("./node_modules/core-js/modules/es.number.epsilon.js"),Kn=c("./node_modules/core-js/modules/es.object.values.js"),Jn=c("./node_modules/core-js/modules/es.promise.js"),Xn=c("./node_modules/core-js/modules/es.string.iterator.js"),Qn=c("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Dt=c("./node_modules/@babel/runtime/regenerator/index.js"),S=c.n(Dt),Zn=c("./node_modules/regenerator-runtime/runtime.js"),Pt=c("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),V=c.n(Pt),Lt=c("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Q=c.n(Lt),W=c("./frontend/src/lib/api.ts"),F=c("./frontend/src/lib/dayjs.ts"),Ie=c("./frontend/src/scenes/insights/utils/cleanFilters.ts"),Ve=c("./frontend/src/scenes/teamLogic.ts"),Z=c("./frontend/src/scenes/urls.ts"),le=c("./node_modules/kea-router/lib/index.js"),Rt=c("./frontend/src/scenes/experiments/experimentsLogic.ts"),te=c("./frontend/src/lib/constants.tsx"),Ye=c("./frontend/src/scenes/trends/trendsLogic.ts"),pe=c("./frontend/src/lib/utils/eventUsageLogic.ts"),kt=c("./frontend/src/scenes/userLogic.ts"),it=c("./frontend/src/lib/components/Tooltip.tsx"),fe=c("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),At=c("./frontend/src/models/groupsModel.ts"),je=c("./frontend/src/lib/components/lemonToast.tsx");function st(t,n){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,r)}return a}function b(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?st(Object(a),!0).forEach(function(r){Ne()(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):st(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}var ve=14,ge=Object(D.kea)({props:{},key:function(n){return n.experimentId||"new"},path:function(n){return["scenes","experiment","experimentLogic",n]},connect:{values:[Ve.a,["currentTeamId"],kt.a,["hasAvailableFeature"],At.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]],actions:[Rt.a,["updateExperiments","addToExperiments"]]},actions:{setExperiment:function(n){return{experiment:n}},createExperiment:function(n,a,r){return{draft:n,runningTime:a,sampleSize:r}},setExperimentInsightId:function(n){return{shortId:n}},createNewExperimentInsight:function(n){return{filters:n}},setFilters:function(n){return{filters:n}},setNewExperimentData:function(n){return{experimentData:n}},updateExperimentGroup:function(n,a){return{variant:n,idx:a}},removeExperimentGroup:function(n){return{idx:n}},setExperimentInsightType:function(n){return{insightType:n}},setEditExperiment:function(n){return{editing:n}},setSecondaryMetrics:function(n){return{secondaryMetrics:n}},resetNewExperiment:!0,launchExperiment:!0,endExperiment:!0,addExperimentGroup:!0,archiveExperiment:!0},reducers:{newExperimentData:[null,{setNewExperimentData:function(n,a){var r=a.experimentData;if(r.filters){var o=b(b({},n==null?void 0:n.filters),r.filters);return b(b(b({},n),r),{},{filters:o})}if(r.parameters){var d=b(b({},n==null?void 0:n.parameters),r.parameters);return b(b(b({},n),r),{},{parameters:d})}return b(b({},n),r)},updateExperimentGroup:function(n,a){var r,o=a.variant,d=a.idx,m=Q()((n==null||(r=n.parameters)===null||r===void 0?void 0:r.feature_flag_variants)||[]);return m[d]=b(b({},m[d]),o),b(b({},n),{},{parameters:b(b({},n==null?void 0:n.parameters),{},{feature_flag_variants:m})})},addExperimentGroup:function(n){var a;if(!(n==null||(a=n.parameters)===null||a===void 0)&&a.feature_flag_variants){var r=lt(n.parameters.feature_flag_variants.length+1),o=n.parameters.feature_flag_variants.map(function(d,m){return b(b({},d),{},{rollout_percentage:r[m]})});return b(b({},n),{},{parameters:b(b({},n.parameters),{},{feature_flag_variants:[].concat(Q()(o),[{key:"test_group_".concat(n.parameters.feature_flag_variants.length),rollout_percentage:r[r.length-1]}])})})}return n},removeExperimentGroup:function(n,a){var r,o,d=a.idx;if(!n)return n;var m=Q()(((r=n.parameters)===null||r===void 0?void 0:r.feature_flag_variants)||[]);m.splice(d,1);var i=lt(((n==null||(o=n.parameters)===null||o===void 0?void 0:o.feature_flag_variants)||[]).length-1),s=m.map(function(p,N){return b(b({},p),{},{rollout_percentage:i[N]})});return b(b({},n),{},{parameters:b(b({},n.parameters),{},{feature_flag_variants:s})})},setSecondaryMetrics:function(n,a){var r=a.secondaryMetrics,o=r.map(function(d){return d});return b(b({},n),{},{secondary_metrics:o})},resetNewExperiment:function(){return{parameters:{feature_flag_variants:[{key:"control",rollout_percentage:50},{key:"test",rollout_percentage:50}]}}}}],experimentInsightType:[u.y.TRENDS,{setExperimentInsightType:function(n,a){var r=a.insightType;return r}}],experimentInsightId:[null,{setExperimentInsightId:function(n,a){var r=a.shortId;return r}}],editingExistingExperiment:[!1,{setEditExperiment:function(n,a){var r=a.editing;return r}}]},listeners:function(n){var a=n.values,r=n.actions;return{createExperiment:function(){var o=V()(S.a.mark(function m(i){var s,p,N,v,w,E,l,j,$,H;return S.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(p=i.draft,N=i.runningTime,v=i.sampleSize,w=null,E=!!a.experimentId&&a.experimentId!=="new",h.prev=3,!E){h.next=14;break}return h.next=7,W.b.update("api/projects/".concat(a.currentTeamId,"/experiments/").concat(a.experimentId),b(b({},a.newExperimentData),{},{parameters:b(b({},(l=a.newExperimentData)===null||l===void 0?void 0:l.parameters),{},{recommended_running_time:N,recommended_sample_size:v})},!p&&{start_date:Object(F.a)()}));case 7:if(w=h.sent,!(!((j=w)===null||j===void 0)&&j.id)){h.next=12;break}return r.updateExperiments(w),le.router.actions.push(Z.a.experiment(w.id)),h.abrupt("return");case 12:h.next=18;break;case 14:return h.next=16,W.b.create("api/projects/".concat(a.currentTeamId,"/experiments"),b(b({},a.newExperimentData),{},{parameters:b(b({},($=a.newExperimentData)===null||$===void 0?void 0:$.parameters),{},{recommended_running_time:N,recommended_sample_size:v})},!p&&{start_date:Object(F.a)()}));case 16:w=h.sent,w&&pe.f.actions.reportExperimentCreated(w);case 18:h.next=24;break;case 20:return h.prev=20,h.t0=h.catch(3),je.a.error(h.t0.detail||"Failed to create experiment"),h.abrupt("return");case 24:!((s=w)===null||s===void 0)&&s.id&&(H=w.id,le.router.actions.push(Z.a.experiment(H)),r.addToExperiments(w),je.a.success("Experiment ".concat(E?"updated":"created"),{button:{label:"View it",action:function(){le.router.actions.push(Z.a.experiment(H))}}}));case 25:case"end":return h.stop()}},m,null,[[3,20]])}));function d(m){return o.apply(this,arguments)}return d}(),createNewExperimentInsight:function(){var o=V()(S.a.mark(function m(i){var s,p,N,v;return S.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return s=i.filters,a.experimentInsightType===u.y.FUNNELS?p=Object(Ie.a)(b({insight:u.y.FUNNELS,funnel_viz_type:u.u.Steps,display:u.i.FunnelViz,date_from:Object(F.a)().subtract(ve,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(F.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:te.j.horizontal},s)):p=Object(Ie.a)(b({insight:u.y.TRENDS,date_from:Object(F.a)().subtract(ve,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(F.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},s)),N={name:"",description:"",tags:[],filters:p,result:null},E.next=5,W.b.create("api/projects/".concat(a.currentTeamId,"/insights"),N);case 5:v=E.sent,r.setExperimentInsightId(v.short_id),r.setNewExperimentData({filters:b({},N.filters)});case 8:case"end":return E.stop()}},m)}));function d(m){return o.apply(this,arguments)}return d}(),setFilters:function(d){var m=d.filters;if(a.experimentInsightType===u.y.FUNNELS){var i;(i=Se.a.findMounted({dashboardItemId:a.experimentInsightId}))===null||i===void 0||i.actions.setFilters(m)}else{var s;(s=Ye.a.findMounted({dashboardItemId:a.experimentInsightId}))===null||s===void 0||s.actions.setFilters(m)}},loadExperimentSuccess:function(){var o=V()(S.a.mark(function m(i){var s;return S.a.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:s=i.experimentData,s&&pe.f.actions.reportExperimentViewed(s),r.setExperimentInsightType((s==null?void 0:s.filters.insight)||u.y.FUNNELS),s!=null&&s.start_date?(r.resetNewExperiment(),r.loadExperimentResults(),r.loadSecondaryMetricResults()):(r.setNewExperimentData(b({},s)),r.createNewExperimentInsight(s==null?void 0:s.filters));case 4:case"end":return N.stop()}},m)}));function d(m){return o.apply(this,arguments)}return d}(),launchExperiment:function(){var o=V()(S.a.mark(function m(){var i;return S.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:i=Object(F.a)(),r.updateExperiment({start_date:i.format("YYYY-MM-DDTHH:mm")}),a.experimentData&&pe.f.actions.reportExperimentLaunched(a.experimentData,i);case 3:case"end":return p.stop()}},m)}));function d(){return o.apply(this,arguments)}return d}(),endExperiment:function(){var o=V()(S.a.mark(function m(){var i,s,p;return S.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:s=Object(F.a)(),r.updateExperiment({end_date:s.format("YYYY-MM-DDTHH:mm")}),p=s.diff((i=a.experimentData)===null||i===void 0?void 0:i.start_date,"second"),a.experimentData&&pe.f.actions.reportExperimentCompleted(a.experimentData,s,p,a.areResultsSignificant);case 4:case"end":return v.stop()}},m)}));function d(){return o.apply(this,arguments)}return d}(),archiveExperiment:function(){var o=V()(S.a.mark(function m(){return S.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:r.updateExperiment({archived:!0}),a.experimentData&&pe.f.actions.reportExperimentArchived(a.experimentData);case 2:case"end":return s.stop()}},m)}));function d(){return o.apply(this,arguments)}return d}(),setExperimentInsightType:function(){if(a.experimentId==="new"||a.editingExistingExperiment)r.createNewExperimentInsight();else{var d;r.createNewExperimentInsight((d=a.experimentData)===null||d===void 0?void 0:d.filters)}},updateExperimentSuccess:function(){var o=V()(S.a.mark(function m(i){var s;return S.a.wrap(function(N){for(;;)switch(N.prev=N.next){case 0:s=i.experimentData,r.updateExperiments(s);case 2:case"end":return N.stop()}},m)}));function d(m){return o.apply(this,arguments)}return d}()}},loaders:function(n){var a=n.values;return{experimentData:[null,{loadExperiment:function(){var r=V()(S.a.mark(function d(){var m;return S.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(a.experimentId&&a.experimentId!=="new")){s.next=16;break}return s.prev=1,s.next=4,W.b.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(a.experimentId));case 4:return m=s.sent,s.abrupt("return",m);case 8:if(s.prev=8,s.t0=s.catch(1),s.t0.status!==404){s.next=14;break}le.router.actions.push(Z.a.experiments()),s.next=16;break;case 14:throw je.a.error("Failed to load experiment ".concat(a.experimentId)),new Error("Failed to load experiment ".concat(a.experimentId));case 16:return s.abrupt("return",null);case 17:case"end":return s.stop()}},d,null,[[1,8]])}));function o(){return r.apply(this,arguments)}return o}(),updateExperiment:function(){var r=V()(S.a.mark(function d(m){var i;return S.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,W.b.update("api/projects/".concat(a.currentTeamId,"/experiments/").concat(a.experimentId),m);case 2:return i=p.sent,p.abrupt("return",i);case 4:case"end":return p.stop()}},d)}));function o(d){return r.apply(this,arguments)}return o}()}],experimentResults:[null,{loadExperimentResults:function(){var r=V()(S.a.mark(function d(){var m;return S.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,W.b.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(a.experimentId,"/results"));case 3:return m=s.sent,s.abrupt("return",b(b({},m),{},{itemID:Math.random().toString(36).substring(2,15)}));case 7:if(s.prev=7,s.t0=s.catch(0),s.t0.code!=="no_data"){s.next=11;break}return s.abrupt("return",null);case 11:return je.a.error(s.t0.detail||"Failed to load experiment results"),s.abrupt("return",null);case 13:case"end":return s.stop()}},d,null,[[0,7]])}));function o(){return r.apply(this,arguments)}return o}()}],secondaryMetricResults:[null,{loadSecondaryMetricResults:function(){var r=V()(S.a.mark(function d(){var m;return S.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Promise.all((((m=a.experimentData)===null||m===void 0?void 0:m.secondary_metrics)||[]).map(function(){var p=V()(S.a.mark(function N(v,w){var E;return S.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.prev=0,j.next=3,W.b.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(a.experimentId,"/secondary_results?id=").concat(w));case 3:return E=j.sent,j.abrupt("return",E.result);case 7:return j.prev=7,j.t0=j.catch(0),j.abrupt("return",{});case 10:case"end":return j.stop()}},N,null,[[0,7]])}));return function(N,v){return p.apply(this,arguments)}}()));case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}},d)}));function o(){return r.apply(this,arguments)}return o}()}]}},selectors:{experimentId:[function(){return[function(t,n){var a;return(a=n.experimentId)!==null&&a!==void 0?a:"new"}]},function(t){return t}],breadcrumbs:[function(t){return[t.experimentData,t.experimentId]},function(t,n){return[{name:"Experiments",path:Z.a.experiments()},{name:(t==null?void 0:t.name)||"New",path:Z.a.experiment(n||"new")}]}],variants:[function(t){return[t.newExperimentData,t.experimentData]},function(t,n){var a,r;if(n!=null&&n.start_date){var o;return(n==null||(o=n.parameters)===null||o===void 0?void 0:o.feature_flag_variants)||[]}return(t==null||(a=t.parameters)===null||a===void 0?void 0:a.feature_flag_variants)||(n==null||(r=n.parameters)===null||r===void 0?void 0:r.feature_flag_variants)||[]}],taxonomicGroupTypesForSelection:[function(t){return[t.newExperimentData,t.groupsTaxonomicTypes]},function(t,n){var a;return(t==null||(a=t.filters)===null||a===void 0?void 0:a.aggregation_group_type_index)!=null&&n.length>0?[n[t.filters.aggregation_group_type_index]]:[I.a.PersonProperties,I.a.Cohorts]}],parsedSecondaryMetrics:[function(t){return[t.newExperimentData,t.experimentData]},function(t,n){var a=(t==null?void 0:t.secondary_metrics)||(n==null?void 0:n.secondary_metrics)||[];return a}],minimumDetectableChange:[function(t){return[t.newExperimentData]},function(t){var n;return(t==null||(n=t.parameters)===null||n===void 0?void 0:n.minimum_detectable_effect)||5}],minimumSampleSizePerVariant:[function(t){return[t.minimumDetectableChange]},function(t){return function(n){return Math.ceil(1600*n*(1-n/100)/(t*t))}}],areResultsSignificant:[function(t){return[t.experimentResults]},function(t){return(t==null?void 0:t.significant)||!1}],significanceBannerDetails:[function(t){return[t.experimentResults]},function(t){if((t==null?void 0:t.significance_code)===u.M.HighLoss){var n;return e.a.createElement(e.a.Fragment,null,"This is because the expected loss in conversion is greater than 1%",e.a.createElement(it.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(n=((t==null?void 0:t.expected_loss)||0)*100)===null||n===void 0?void 0:n.toFixed(2),"%")},e.a.createElement(fe.a,{style:{padding:"4px 2px"}})),".")}if((t==null?void 0:t.significance_code)===u.M.HighPValue){var a;return e.a.createElement(e.a.Fragment,null,"This is because the p value is greater than 0.05",e.a.createElement(it.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(t==null||(a=t.p_value)===null||a===void 0?void 0:a.toFixed(3))||1,".")},e.a.createElement(fe.a,{style:{padding:"4px 2px"}})),".")}return(t==null?void 0:t.significance_code)===u.M.LowWinProbability?"This is because the win probability of all test variants combined is less than 90%.":(t==null?void 0:t.significance_code)===u.M.NotEnoughExposure?"This is because we need at least 100 people per variant to declare significance.":""}],recommendedExposureForCountData:[function(t){return[t.minimumDetectableChange]},function(t){return function(n){var a=n*t/100,r=n,o=a+n;return parseFloat((4/Math.pow(Math.sqrt(r/ve)-Math.sqrt(o/ve),2)).toFixed(1))}}],expectedRunningTime:[function(){return[]},function(){return function(t,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ve;return parseFloat((n/(t/a)).toFixed(1))}}],conversionRateForVariant:[function(t){return[t.experimentResults]},function(t){return function(n){var a="Can't find variant";if(!t)return a;var r=(t==null?void 0:t.insight).find(function(o){var d,m;return((d=o[0])===null||d===void 0||(m=d.breakdown_value)===null||m===void 0?void 0:m[0])===n});return r?(r[r.length-1].count/r[0].count*100).toFixed(1):a}}],getIndexForVariant:[function(t){return[t.experimentResults]},function(t){return function(n,a){if(!t)return 0;var r=-1;return a===u.y.FUNNELS?r=Q()(t==null?void 0:t.insight).sort(function(o,d){var m,i;return((m=d[0])===null||m===void 0?void 0:m.count)-((i=o[0])===null||i===void 0?void 0:i.count)}).findIndex(function(o){var d,m;return((d=o[0])===null||d===void 0||(m=d.breakdown_value)===null||m===void 0?void 0:m[0])===n}):r=(t==null?void 0:t.insight).findIndex(function(o){return o.breakdown_value===n}),r===-1?0:r}}],countDataForVariant:[function(t){return[t.experimentResults]},function(t){return function(n){var a="Can't find variant";if(!t)return a;var r=(t==null?void 0:t.insight).find(function(o){return o.breakdown_value===n});return r?r.count.toString():a}}],highestProbabilityVariant:[function(t){return[t.experimentResults]},function(t){if(t){var n=Math.max.apply(Math,Q()(Object.values(t.probability)));return Object.keys(t.probability).find(function(a){return Math.abs(t.probability[a]-n)<Number.EPSILON})}}],areTrendResultsConfusing:[function(t){return[t.experimentResults,t.highestProbabilityVariant]},function(t,n){if(!t)return!1;var a=(t==null?void 0:t.insight).reduce(function(r,o){return o.count>r.count?o:r},{count:0,breakdown_value:""});return a.count?a.breakdown_value!==n:!1}]},urlToAction:function(n){var a=n.actions,r=n.values;return{"/experiments/:id":function(d,m,i,s,p){var N=d.id;if(!r.hasAvailableFeature(u.d.EXPERIMENTATION)){le.router.actions.push("/experiments");return}var v=s.initial||s.pathname!==(p==null?void 0:p.pathname);if(N&&v){var w=N==="new"?"new":parseInt(N);w==="new"&&(a.createNewExperimentInsight(),a.resetNewExperiment(),a.setSecondaryMetrics([])),a.setEditExperiment(!1),w!=="new"&&w===r.experimentId&&a.loadExperiment()}}}}});function lt(t){var n=Math.round(100/t),a=n*t,r=a-100,o=new Array(t).fill(n);return o[t-1]=n-r,o}var $e=c("./frontend/src/scenes/insights/InsightContainer.tsx"),K=c("./frontend/src/lib/components/icons.tsx"),Vt=c("./node_modules/@ant-design/icons/es/icons/ExclamationCircleFilled.js"),Oe=c("./node_modules/@ant-design/icons/es/icons/CaretDownOutlined.js"),Ue=c("./node_modules/@ant-design/icons/es/icons/CloseOutlined.js"),Yt=c("./frontend/src/lib/components/CopyToClipboard.tsx"),C=c("./frontend/src/lib/utils.tsx"),ot=c("./frontend/src/scenes/funnels/funnelUtils.ts"),$t=c("./node_modules/antd/es/modal/index.js"),Ut=c("./node_modules/antd/es/button/index.js"),zt=c("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js");function ct(t,n){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,r)}return a}function ne(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?ct(Object(a),!0).forEach(function(r){Ne()(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ct(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}var mt=14,ze={name:"",filters:{insight:u.y.TRENDS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}]}},Bt={name:"",filters:{insight:u.y.FUNNELS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}],layout:te.j.horizontal}},Gt=Object(D.kea)({props:{},path:["scenes","experiment","secondaryMetricsLogic"],connect:{values:[Ve.a,["currentTeamId"]]},actions:{setSecondaryMetrics:function(n){return{secondaryMetrics:n}},createNewMetric:!0,addNewMetric:function(n){return{metric:n}},updateMetricFilters:function(n){return{filters:n}},setFilters:function(n){return{filters:n}},setPreviewInsightId:function(n){return{shortId:n}},createPreviewInsight:function(n){return{filters:n}},showModal:!0,hideModal:!1,changeInsightType:function(n){return{type:n}},setCurrentMetricName:function(n){return{name:n}},deleteMetric:function(n){return{metricId:n}}},loaders:function(n){var a=n.values;return{experiments:[[],{loadExperiments:function(){var r=V()(S.a.mark(function d(){var m;return S.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,W.b.get("api/projects/".concat(a.currentTeamId,"/experiments"));case 2:return m=s.sent,s.abrupt("return",m.results);case 4:case"end":return s.stop()}},d)}));function o(){return r.apply(this,arguments)}return o}()}]}},reducers:function(n){var a=n.props;return{previewInsightId:[null,{setPreviewInsightId:function(o,d){var m=d.shortId;return m}}],metrics:[a.initialMetrics,{addNewMetric:function(o,d){var m=d.metric;return[].concat(Q()(o),[ne({},m)])},deleteMetric:function(o,d){var m=d.metricId;return o.filter(function(i,s){return s!==m})}}],modalVisible:[!1,{showModal:function(){return!0},hideModal:function(){return!1}}],currentMetricName:["",{setCurrentMetricName:function(o,d){var m=d.name;return m}}],currentMetric:[ze,{changeInsightType:function(o,d){var m=d.type;return m===u.y.TRENDS?ze:o.filters.insight===u.y.TRENDS?Bt:ze},updateMetricFilters:function(o,d){var m=d.filters;return ne(ne({},o),{},{filters:m})}}]}},listeners:function(n){var a=n.actions,r=n.values,o=n.props;return{createPreviewInsight:function(){var d=V()(S.a.mark(function i(s){var p,N,v,w;return S.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return p=s.filters,(p==null?void 0:p.insight)===u.y.FUNNELS?N=Object(Ie.a)(ne({insight:u.y.FUNNELS,funnel_viz_type:u.u.Steps,display:u.i.FunnelViz,date_from:Object(F.a)().subtract(mt,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(F.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:te.j.horizontal},p)):N=Object(Ie.a)(ne({insight:u.y.TRENDS,date_from:Object(F.a)().subtract(mt,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(F.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},p)),v={description:"",tags:[],filters:N,result:null},l.next=5,W.b.create("api/projects/".concat(Ve.a.values.currentTeamId,"/insights"),v);case 5:w=l.sent,a.setPreviewInsightId(w.short_id);case 7:case"end":return l.stop()}},i)}));function m(i){return d.apply(this,arguments)}return m}(),setFilters:function(m){var i=m.filters;if(i.insight===u.y.FUNNELS){var s;(s=Se.a.findMounted({dashboardItemId:r.previewInsightId}))===null||s===void 0||s.actions.setFilters(i)}else{var p;(p=Ye.a.findMounted({dashboardItemId:r.previewInsightId}))===null||p===void 0||p.actions.setFilters(i)}},createNewMetric:function(){a.addNewMetric(ne(ne({},r.currentMetric),{},{name:r.currentMetricName})),o.onMetricsChange(r.metrics),a.changeInsightType(u.y.TRENDS),a.setCurrentMetricName("")},deleteMetric:function(){o.onMetricsChange(r.metrics)},changeInsightType:function(){return a.createPreviewInsight(r.currentMetric.filters)}}},events:function(n){var a=n.actions;return{afterMount:function(){a.createPreviewInsight()}}}}),G=c("./frontend/src/lib/components/LemonButton/index.ts"),Be=c("./frontend/src/scenes/insights/ActionFilter/ActionFilterRow/ActionFilterRow.tsx");function dt(t,n){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,r)}return a}function q(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?dt(Object(a),!0).forEach(function(r){Ne()(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):dt(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}function Fe(t){var n=t.onMetricsChange,a=t.initialMetrics,r=Gt({onMetricsChange:n,initialMetrics:a}),o=Object(D.useValues)(r),d=o.previewInsightId,m=o.metrics,i=o.modalVisible,s=o.currentMetric,p=Object(D.useActions)(r),N=p.createNewMetric,v=p.updateMetricFilters,w=p.setFilters,E=p.showModal,l=p.hideModal,j=p.changeInsightType,$=p.setCurrentMetricName,H=p.deleteMetric,_=Object(D.useValues)(Object(ue.c)({dashboardItemId:d,syncWithUrl:!1})),h=_.insightProps,ae=Object(D.useValues)(Object(Se.a)(h)),ee=ae.isStepsEmpty,O=ae.filterSteps;return e.a.createElement(e.a.Fragment,null,e.a.createElement($t.a,{title:"Add secondary metric",visible:i,destroyOnClose:!0,onCancel:l,footer:null,style:{minWidth:600}},e.a.createElement(B.a,{layout:"vertical",initialValues:{type:u.y.TRENDS},onValuesChange:function(M){M.name&&$(M.name)},onFinish:function(){N(),l()},scrollToFirstError:!0,requiredMark:!1},e.a.createElement(B.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"You have to enter a name."}]},e.a.createElement(me.a,null)),e.a.createElement(B.a.Item,{name:"type",label:"Type"},e.a.createElement(Y.a,{style:{display:"flex"},value:s.filters.insight,onChange:function(){j()},suffixIcon:e.a.createElement(Oe.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(Y.a.Option,{value:u.y.TRENDS},e.a.createElement(f.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(Y.a.Option,{value:u.y.FUNNELS},e.a.createElement(f.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel")))))),e.a.createElement(B.a.Item,{name:"query",label:"Query"},e.a.createElement(ie.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},s.filters.insight===u.y.FUNNELS&&e.a.createElement(se.a,{filters:s.filters,setFilters:function(M){var R=q(q({},s.filters),{},{insight:u.y.FUNNELS},M);v(R),w(R)},typeKey:"funnel-preview-metric",mathAvailability:Be.b.None,hideDeleteBtn:O.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!ee,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[I.a.EventProperties,I.a.PersonProperties,I.a.Cohorts,I.a.Elements],rowClassName:"action-filters-bordered"}),s.filters.insight===u.y.TRENDS&&e.a.createElement(se.a,{entitiesLimit:1,horizontalUI:!0,filters:s.filters,setFilters:function(M){var R=q(q({},s.filters),{},{insight:u.y.TRENDS},M);v(R),w(R)},typeKey:"trend-preview-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,propertiesTaxonomicGroupTypes:[I.a.EventProperties,I.a.PersonProperties,I.a.Cohorts,I.a.Elements]}))),e.a.createElement(B.a.Item,{name:"metric-preview",label:"Metric preview"},e.a.createElement(D.BindLogic,{logic:ue.c,props:h},e.a.createElement($e.a,{disableHeader:!0,disableTable:!0}))),e.a.createElement(g.a,{justify:"end"},e.a.createElement(G.a,{type:"secondary",className:"mr-05",onClick:function(){return l()}},"Cancel"),e.a.createElement(G.a,{type:"primary",htmlType:"submit"},"Save")))),e.a.createElement(g.a,null,e.a.createElement(f.a,null,m.map(function(T,M){return e.a.createElement(g.a,{key:M,className:"mt"},e.a.createElement(g.a,{align:"middle",className:"full-width border-all",style:{padding:8}},e.a.createElement("div",{style:{fontWeight:500}},"Name")," ",e.a.createElement("div",{className:"metric-name"},T.name),e.a.createElement(zt.a,{className:"text-danger",style:{padding:8},onClick:function(){return H(M)}})),e.a.createElement(ie.a,{className:"full-width",style:{borderTop:"none"},bodyStyle:{padding:0}},T.filters.insight===u.y.FUNNELS&&e.a.createElement(se.a,{filters:T.filters,setFilters:function(re){var P=q(q({},T.filters),{},{insight:u.y.FUNNELS},re);v(P),w(P)},typeKey:"funnel-preview-".concat(M),mathAvailability:Be.b.None,hideDeleteBtn:O.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!ee,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[I.a.EventProperties,I.a.PersonProperties,I.a.Cohorts,I.a.Elements],rowClassName:"action-filters-bordered",readOnly:!0}),T.filters.insight===u.y.TRENDS&&e.a.createElement(se.a,{horizontalUI:!0,filters:T.filters,setFilters:function(re){var P=q(q({},T.filters),{},{insight:u.y.TRENDS},re);v(P),w(P)},typeKey:"trend-preview-".concat(M),buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,propertiesTaxonomicGroupTypes:[I.a.EventProperties,I.a.PersonProperties,I.a.Cohorts,I.a.Elements],readOnly:!0})))}),m&&!(m.length>2)&&e.a.createElement(f.a,null,e.a.createElement("div",{className:"mb-05 mt"},e.a.createElement(Ut.a,{style:{color:"var(--primary)",minWidth:240},onClick:E},"Add metric"))))))}try{Fe.displayName="SecondaryMetrics",Fe.__docgenInfo={description:"",displayName:"SecondaryMetrics",props:{onMetricsChange:{defaultValue:null,description:"",name:"onMetricsChange",required:!0,type:{name:"(metrics: SecondaryExperimentMetric[]) => void"}},initialMetrics:{defaultValue:null,description:"",name:"initialMetrics",required:!0,type:{name:"SecondaryExperimentMetric[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"]={docgenInfo:Fe.__docgenInfo,name:"SecondaryMetrics",path:"frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"})}catch(t){}var ut=c("./frontend/src/lib/colors.ts"),Ht=c("./frontend/src/lib/components/EntityFilterInfo.tsx"),Wt=c("./frontend/src/lib/components/EditableField/EditableField.tsx"),Kt=c("./frontend/src/lib/components/Link.tsx"),Jt=c("./frontend/src/lib/logic/featureFlagLogic.ts"),Xt=c("./node_modules/antd/es/slider/index.js"),Qt=c("./node_modules/antd/es/input-number/index.js"),Zt=c("./frontend/src/lib/components/InsightLabel/index.tsx"),pt=c("./frontend/src/lib/components/PropertyFilters/components/PropertyFilterButton.tsx");function qt(){var t=Object(de.useState)(!1),n=ce()(t,2),a=n[0],r=n[1],o=Object(de.useState)(!1),d=ce()(o,2),m=d[0],i=d[1];return e.a.createElement(ie.a,{className:"experiment-workflow",title:e.a.createElement("span",{className:"card-secondary"},"Experiment workflow")},e.a.createElement(g.a,null,e.a.createElement(f.a,{className:"exp-workflow-step step-completed full-width"},e.a.createElement(g.a,{align:"middle"},e.a.createElement(K.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}),e.a.createElement("b",{className:"ml-05"},"Create experiment")),e.a.createElement("div",{className:"ml-2"},"Set variants, select participants, and add secondary metrics"))),e.a.createElement(g.a,null,e.a.createElement(f.a,{className:"full-width exp-workflow-step ".concat(a?"step-completed":""),onClick:function(){return r(!a)}},e.a.createElement(g.a,{align:"middle"},a?e.a.createElement(K.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(K.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-05"},"Validate experiment")),e.a.createElement("div",{className:"ml-2"},"Once you've written your code, it's a good idea to test that each variant behaves as you'd expect."))),e.a.createElement(g.a,null,e.a.createElement(f.a,{className:"full-width exp-workflow-step ".concat(m?"step-completed":""),onClick:function(){return i(!m)}},e.a.createElement(g.a,{align:"middle"},m?e.a.createElement(K.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(K.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-05"},"Launch experiment")),e.a.createElement("div",{className:"ml-2"},"Run your experiment, monitor results, and decide when to terminate your experiment."))))}function Ee(t){var n,a,r,o,d,m,i=t.experiment,s=t.trendCount,p=t.funnelConversionRate,N=t.trendExposure,v=t.funnelSampleSize,w=t.funnelEntrants,E=(i==null?void 0:i.id)||"new",l=Object(D.useValues)(ge({experimentId:E})),j=l.experimentInsightType,$=l.editingExistingExperiment,H=l.minimumDetectableChange,_=l.expectedRunningTime,h=l.aggregationLabel,ae=Object(D.useActions)(ge({experimentId:E})),ee=ae.setNewExperimentData,O=j===u.y.FUNNELS&&100-p<50?100-p:50,T=Object(F.a)().diff(Object(F.a)(i==null?void 0:i.start_date),"hour"),M=0;i!=null&&i.start_date?M=_(w||1,v||0,T):M=_(w||1,v||0);var R=Object(F.a)(i==null?void 0:i.start_date).add(M,"hour"),re=!(i!=null&&i.end_date)&&T>=24&&w&&v,P=Object(C.r)(i==null||(n=i.filters)===null||n===void 0?void 0:n.properties);return e.a.createElement(g.a,null,e.a.createElement(f.a,{span:!(i!=null&&i.start_date)&&E!=="new"&&!$?12:24},E==="new"&&e.a.createElement(g.a,{className:"experiment-preview-row"},e.a.createElement("div",null,e.a.createElement("div",null,e.a.createElement("b",null,"Experiment preview")),e.a.createElement("div",{className:"text-muted"},"Here are the baseline metrics for your experiment. Adjust your minimum detectible threshold to adjust for the smallest conversion value you\u2019ll accept, and the experiment duration."," "))),(E==="new"||$)&&e.a.createElement(g.a,{className:"mb"},e.a.createElement(f.a,{span:24},e.a.createElement("div",null,e.a.createElement("b",null,"Minimum acceptable improvement"),e.a.createElement(we.a,{title:"Minimum acceptable improvement is a calculation that estimates the smallest significant improvement you are willing to accept."},e.a.createElement(fe.a,{style:{marginLeft:4}}))),e.a.createElement(g.a,{className:"mde-slider"},e.a.createElement(f.a,{span:8},e.a.createElement(Xt.a,{defaultValue:5,value:H,min:1,max:O,trackStyle:{background:"var(--primary)"},handleStyle:{background:"var(--primary)"},onChange:function(A){ee({parameters:{minimum_detectable_effect:A}})},tipFormatter:function(A){return"".concat(A,"%")}})),e.a.createElement(Qt.a,{min:1,max:O,defaultValue:5,formatter:function(A){return"".concat(A,"%")},style:{margin:"0 16px"},value:H,onChange:function(A){ee({parameters:{minimum_detectable_effect:A}})}})))),e.a.createElement(g.a,{className:"experiment-preview-row ".concat(i!=null&&i.start_date?"mr":"")},j===u.y.TRENDS?e.a.createElement(e.a.Fragment,null,!(i!=null&&i.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(f.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Baseline Count"),e.a.createElement("div",{className:"l4"},Object(C.N)(s||0))),e.a.createElement(f.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Count"),e.a.createElement("div",{className:"l4"},Object(C.N)(s+Math.ceil(s*(H/100))||0)))),e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",Object(C.N)(N||0))," days"))):e.a.createElement(e.a.Fragment,null,!(i!=null&&i.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Baseline Conversion Rate"),e.a.createElement("div",{className:"l4"},p.toFixed(1),"%")),e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Conversion Rate"),e.a.createElement("div",{className:"l4"},(p+H).toFixed(1),"%"))),e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended Sample Size"),e.a.createElement("div",{className:"pb"},e.a.createElement("span",{className:"l4"},"~",Object(C.N)(v||0))," persons")),!(i!=null&&i.start_date)&&e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",Object(C.N)(M||0))," days"))),e.a.createElement(g.a,{className:"full-width mt"},e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Experiment variants"),e.a.createElement("ul",{className:"variants-list"},i==null||(a=i.parameters)===null||a===void 0||(r=a.feature_flag_variants)===null||r===void 0?void 0:r.map(function(k,A){return e.a.createElement("li",{key:A},k.key)}))),e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Participants"),e.a.createElement("div",null,P!=null&&P.length?e.a.createElement("div",null,P==null?void 0:P.map(function(k){return e.a.createElement(pt.c,{key:k.key,item:k,style:{margin:2,cursor:"default"}})})):e.a.createElement(e.a.Fragment,null,"100% of"," ",(i==null||(o=i.filters)===null||o===void 0?void 0:o.aggregation_group_type_index)!=null?Object(C.i)(h(i.filters.aggregation_group_type_index).plural):"users")))),e.a.createElement(g.a,{className:"full-width"},E!=="new"&&!$&&e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary mt"},"Start date"),i!=null&&i.start_date?e.a.createElement("span",null,Object(F.a)(i==null?void 0:i.start_date).format("D MMM YYYY")):e.a.createElement("span",{className:"description"},"Not started yet")),j===u.y.FUNNELS&&re?e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary mt"},"Expected end date"),e.a.createElement("span",null,R.isAfter(Object(F.a)())?R.format("D MMM YYYY"):Object(F.a)().format("D MMM YYYY"))):null,(i==null?void 0:i.end_date)&&e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"card-secondary mt"},"Completed date"),e.a.createElement("span",null,Object(F.a)(i==null?void 0:i.end_date).format("D MMM YYYY"))))),E!=="new"&&!$&&e.a.createElement(g.a,{className:"experiment-preview-row"},e.a.createElement(f.a,null,e.a.createElement("div",{className:"card-secondary mb-05"},j===u.y.FUNNELS?"Conversion goal steps":"Trend goal"),[].concat(Q()((i==null||(d=i.filters)===null||d===void 0?void 0:d.events)||[]),Q()((i==null||(m=i.filters)===null||m===void 0?void 0:m.actions)||[])).sort(function(k,A){return(k.order||0)-(A.order||0)}).map(function(k,A){var ye;return e.a.createElement(f.a,{key:A,className:"mb-05"},e.a.createElement(g.a,{style:{marginBottom:4}},e.a.createElement("div",{className:"preview-conversion-goal-num"},j===u.y.FUNNELS?(k.order||0)+1:A+1),e.a.createElement("b",null,e.a.createElement(Zt.b,{action:k,showCountedByTag:j===u.y.TRENDS,hideIcon:!0}))),(ye=k.properties)===null||ye===void 0?void 0:ye.map(function(Me){return e.a.createElement(pt.c,{key:Me.key,item:Me})}))})))),E!=="new"&&!$&&!(i!=null&&i.start_date)&&e.a.createElement(f.a,{span:12,className:"pl"},e.a.createElement(qt,null)))}try{Ee.displayName="ExperimentPreview",Ee.__docgenInfo={description:"",displayName:"ExperimentPreview",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}},trendCount:{defaultValue:null,description:"",name:"trendCount",required:!0,type:{name:"number"}},trendExposure:{defaultValue:null,description:"",name:"trendExposure",required:!1,type:{name:"number"}},funnelSampleSize:{defaultValue:null,description:"",name:"funnelSampleSize",required:!1,type:{name:"number"}},funnelConversionRate:{defaultValue:null,description:"",name:"funnelConversionRate",required:!0,type:{name:"number"}},funnelEntrants:{defaultValue:null,description:"",name:"funnelEntrants",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"]={docgenInfo:Ee.__docgenInfo,name:"ExperimentPreview",path:"frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"})}catch(t){}var Te=c("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx");function he(t){var n,a,r,o=t.experiment,d=Object(de.useState)("control"),m=ce()(d,2),i=m[0],s=m[1];return e.a.createElement(ie.a,{title:e.a.createElement("span",{className:"card-secondary"},"Feature flag usage and implementation"),className:"experiment-implementation-details"},e.a.createElement(g.a,{justify:"space-between",className:"mb-05"},e.a.createElement("div",null,e.a.createElement("span",{className:"mr-05"},"Variant group"),e.a.createElement(Y.a,{onChange:s,defaultValue:"control",suffixIcon:e.a.createElement(Oe.a,null)},o==null||(n=o.parameters)===null||n===void 0||(a=n.feature_flag_variants)===null||a===void 0?void 0:a.map(function(p,N){return e.a.createElement(Y.a.Option,{key:N,value:p.key},p.key)}))),e.a.createElement("div",null,e.a.createElement(gt,null))),e.a.createElement("b",null,"Implement your experiment in code"),e.a.createElement(Te.a,{language:Te.b.JavaScript,wrap:!0},"if (posthog.getFeatureFlag('".concat((r=o==null?void 0:o.feature_flag_key)!==null&&r!==void 0?r:"","') === '").concat(i,`') {
    // where '`).concat(i,`' is the variant, run your code here
}`)),e.a.createElement("b",null,"Test that it works"),e.a.createElement(Te.a,{language:Te.b.JavaScript},"posthog.feature_flags.override({'".concat(o==null?void 0:o.feature_flag_key,"': '").concat(i,"'})")),e.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://posthog.com/docs/user-guides/feature-flags"},e.a.createElement(g.a,{align:"middle"},"Experiment implementation guide",e.a.createElement(K.IconOpenInNew,{className:"ml-05"}))))}try{he.displayName="ExperimentImplementationDetails",he.__docgenInfo={description:"",displayName:"ExperimentImplementationDetails",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"]={docgenInfo:he.__docgenInfo,name:"ExperimentImplementationDetails",path:"frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"})}catch(t){}function ft(t,n){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),a.push.apply(a,r)}return a}function Ce(t){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?ft(Object(a),!0).forEach(function(r){Ne()(t,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ft(Object(a)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(a,r))})}return t}var _t={component:vt,logic:ge,paramsToProps:function(n){var a=n.params.id;return{experimentId:a==="new"?"new":parseInt(a)}}};function vt(){var t,n,a,r,o,d,m,i,s,p,N,v=Object(D.useValues)(ge),w=v.experimentId,E=v.newExperimentData,l=v.experimentData,j=v.experimentInsightId,$=v.minimumSampleSizePerVariant,H=v.recommendedExposureForCountData,_=v.variants,h=v.experimentResults,ae=v.countDataForVariant,ee=v.editingExistingExperiment,O=v.experimentInsightType,T=v.experimentResultsLoading,M=v.parsedSecondaryMetrics,R=v.areResultsSignificant,re=v.conversionRateForVariant,P=v.getIndexForVariant,k=v.significanceBannerDetails,A=v.areTrendResultsConfusing,ye=v.taxonomicGroupTypesForSelection,Me=v.groupTypes,en=v.aggregationLabel,J=v.secondaryMetricResults,tn=v.experimentDataLoading,nn=v.secondaryMetricResultsLoading,U=Object(D.useActions)(ge),xe=U.setNewExperimentData,an=U.createExperiment,rn=U.launchExperiment,De=U.setFilters,sn=U.setEditExperiment,Et=U.endExperiment,ln=U.addExperimentGroup,on=U.updateExperiment,cn=U.updateExperimentGroup,mn=U.removeExperimentGroup,dn=U.setSecondaryMetrics,un=U.setExperimentInsightType,pn=U.archiveExperiment,fn=Object(D.useValues)(Jt.a),Ge=fn.featureFlags,vn=B.a.useForm(),gn=ce()(vn,1),En=gn[0],hn=Object(de.useState)(!0),ht=ce()(hn,2),He=ht[0],We=ht[1],yn=Object(D.useValues)(Object(ue.c)({dashboardItemId:j})),Ke=yn.insightProps,be=Object(D.useValues)(Object(Se.a)(Ke)),xn=be.isStepsEmpty,bn=be.filterSteps,yt=be.filters,Je=be.results,Nn=be.conversionMetrics,xt=Object(D.useValues)(Object(Ye.a)(Ke)),Xe=xt.filters,wn=xt.results,Qe=Nn.totalRate*100,Sn=$(Qe),bt=Sn*_.length,Ze=(t=wn[0])===null||t===void 0?void 0:t.count,Nt=Je==null||(n=Je[0])===null||n===void 0?void 0:n.count,wt=H(Ze),oe=Math.floor(24/(_.length+2)),Pe=O===u.y.FUNNELS&&(h==null?void 0:h.insight)?h.insight.reduce(function(y,x){var L;return((L=x[0])===null||L===void 0?void 0:L.count)+y},0):0,In=O===u.y.FUNNELS?(Pe||0)/((l==null||(a=l.parameters)===null||a===void 0?void 0:a.recommended_sample_size)||1)*100:Object(F.a)().diff(l==null?void 0:l.start_date,"day")/((l==null||(r=l.parameters)===null||r===void 0?void 0:r.recommended_running_time)||1)*100,jn={running:"green",draft:"default",complete:"purple"},St=function(){if(l!=null&&l.start_date){if(!(l!=null&&l.end_date))return"running"}else return"draft";return"complete"},On=[{background:"#35416b",color:"#fff"},{background:"#C278CE66",color:"#35416B"},{background:"#FFE6AE",color:"#35416B"},{background:"#8DA9E74D",color:"#35416B"}];return e.a.createElement(e.a.Fragment,null,w==="new"||ee?e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{align:"middle",justify:"space-between",style:{borderBottom:"1px solid var(--border)",marginBottom:"1rem",paddingBottom:8}},e.a.createElement(at.a,{title:"New experiment"}),e.a.createElement(g.a,null,e.a.createElement(G.a,{type:"secondary",className:"mr-05",onClick:function(){return le.router.actions.push(Z.a.experiments())}},"Cancel"),e.a.createElement(G.a,{type:"primary",htmlType:"submit",form:"new-experiment"},"Save"))),e.a.createElement(B.a,{name:"new-experiment",layout:"vertical",className:"experiment-form",form:En,onValuesChange:function(x){return xe(x)},initialValues:{name:E==null?void 0:E.name,feature_flag_key:E==null?void 0:E.feature_flag_key,description:E==null?void 0:E.description},onFinish:function(){return an(!0,wt,bt)},requiredMark:!1,scrollToFirstError:!0},e.a.createElement("div",null,e.a.createElement(D.BindLogic,{logic:ue.c,props:Ke},e.a.createElement(g.a,null,e.a.createElement(f.a,{span:12,style:{paddingRight:24}},e.a.createElement(g.a,{className:"full-width"},e.a.createElement(B.a.Item,{style:{marginRight:16},label:"Name",name:"name",rules:[{required:!0,message:"You have to enter a name."}]},e.a.createElement(me.a,{"data-attr":"experiment-name",className:"ph-ignore-input"})),e.a.createElement(B.a.Item,{style:{marginBottom:"1rem"},label:e.a.createElement("div",null,"Feature flag key"," ",e.a.createElement(we.a,{title:"Enter a unique key. This will create a new feature flag which will be associated with this experiment."},e.a.createElement(fe.a,null))),name:"feature_flag_key",rules:[{required:!0,message:"You have to enter a feature flag key name."}]},e.a.createElement(me.a,{"data-attr":"experiment-feature-flag-key",disabled:ee}))),e.a.createElement(B.a.Item,{label:e.a.createElement("div",null,"Description ",e.a.createElement("span",{className:"text-muted"},"(optional)")),name:"description"},e.a.createElement(me.a.TextArea,{"data-attr":"experiment-description",className:"ph-ignore-input",placeholder:"Adding a helpful description can ensure others know what this experiment is about."})),(E==null||(o=E.parameters)===null||o===void 0?void 0:o.feature_flag_variants)&&e.a.createElement(f.a,null,e.a.createElement("label",null,e.a.createElement("b",null,"Experiment variants")),e.a.createElement("div",{className:"text-muted"},"Participants are divided into variant groups evenly. All experiments must consist of a control group and at least one test group. Experiments may have at most 3 test groups. Variant names can only contain letters, numbers, hyphens, and underscores."),e.a.createElement(f.a,{className:"variants"},E.parameters.feature_flag_variants.map(function(y,x){return e.a.createElement(B.a,{key:"".concat(y,"-").concat(x),initialValues:{key:y.key},onValuesChange:function(z){cn(z,x)}},e.a.createElement(g.a,{key:"".concat(y,"-").concat(x),className:"feature-flag-variant ".concat(x===0?"border-top":x>=3?"border-bottom":"")},e.a.createElement("div",{className:"variant-label",style:Ce({},On[x])},x===0?"Control":"Test"),e.a.createElement(B.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{required:!0,pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:e.a.createElement(e.a.Fragment,null,e.a.createElement(Vt.a,{style:{color:"#F96132"}})," ","Variant names can only contain letters, numbers, hyphens, and underscores.")}],style:{display:"contents"}},e.a.createElement(me.a,{disabled:x===0,"data-attr":"feature-flag-variant-key","data-key-index":x.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(x+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),e.a.createElement("div",{className:"float-right"},!(x===0||x===1)&&e.a.createElement(we.a,{title:"Delete this variant",placement:"bottomLeft"},e.a.createElement(G.a,{type:"primary-alt",size:"small",icon:e.a.createElement(K.IconDelete,null),onClick:function(){return mn(x)}})))))}),E.parameters.feature_flag_variants.length<4&&e.a.createElement("div",{className:"feature-flag-variant border-bottom"},e.a.createElement(G.a,{onClick:function(){return ln()},fullWidth:!0,icon:e.a.createElement(K.IconPlusMini,null)},"Add test variant")))),e.a.createElement(g.a,{className:"person-selection"},e.a.createElement("div",{className:"mb-05"},e.a.createElement("strong",null,"Select participants")),e.a.createElement(f.a,null,e.a.createElement("div",{className:"text-muted"},"Select the entities who will participate in this experiment. If no filters are set, 100% of participants will be targeted."),e.a.createElement("div",{className:"mt mb-05"},e.a.createElement("strong",null,"Participant type")),e.a.createElement(Y.a,{value:(E==null||(d=E.filters)===null||d===void 0?void 0:d.aggregation_group_type_index)!=null?E.filters.aggregation_group_type_index:-1,onChange:function(x){var L,z=x!==-1?x:void 0;z!=(E==null||(L=E.filters)===null||L===void 0?void 0:L.aggregation_group_type_index)&&(De({properties:[],aggregation_group_type_index:z}),xe({filters:{aggregation_group_type_index:z,properties:[]}}))},"data-attr":"participant-aggregation-filter",dropdownMatchSelectWidth:!1},e.a.createElement(Y.a.Option,{key:-1,value:-1},"Persons"),Me.map(function(y){return e.a.createElement(Y.a.Option,{key:y.group_type_index,value:y.group_type_index},Object(C.i)(en(y.group_type_index).plural))})),e.a.createElement("div",{className:"mt"},e.a.createElement("strong",null,"Filters")),e.a.createElement(Ot.a,{pageKey:"experiment-participants-property",propertyFilters:O===u.y.FUNNELS?Object(C.r)(yt.properties):Object(C.r)(Xe.properties),onChange:function(x){xe({filters:{properties:x}}),De({properties:x.filter(Ft.b)})},taxonomicGroupTypes:ye})))),e.a.createElement(g.a,{className:"metrics-selection"},e.a.createElement(f.a,{span:12},e.a.createElement("div",{className:"mb-05"},e.a.createElement("b",null,"Goal type"),e.a.createElement("div",{className:"text-muted"},O===u.y.TRENDS?"Track counts of a specific event or action":"Track how many persons complete a sequence of actions and or events")),e.a.createElement(Y.a,{style:{display:"flex"},value:O,onChange:un,suffixIcon:e.a.createElement(Oe.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(Y.a.Option,{value:u.y.TRENDS},e.a.createElement(f.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(Y.a.Option,{value:u.y.FUNNELS},e.a.createElement(f.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel"))))),e.a.createElement("div",{className:"mb mt"},e.a.createElement("b",null,"Experiment goal"),O===u.y.TRENDS&&e.a.createElement("div",{className:"text-muted"},"Trend-based experiments can have at most one graph series. This metric is used to track the progress of your experiment.")),e.a.createElement(g.a,null,e.a.createElement(ie.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},O===u.y.FUNNELS&&e.a.createElement(se.a,{filters:yt,setFilters:function(x){xe({filters:x}),De(x)},typeKey:"EditFunnel-action",mathAvailability:Be.b.None,hideDeleteBtn:bn.length===1,buttonCopy:"Add funnel step",buttonType:"link",showSeriesIndicator:!xn,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[I.a.EventProperties,I.a.PersonProperties,I.a.Cohorts,I.a.Elements],rowClassName:"action-filters-bordered"}),O===u.y.TRENDS&&e.a.createElement(se.a,{horizontalUI:!0,filters:Xe,setFilters:function(x){xe({filters:x}),De(x)},typeKey:"experiment-trends",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,propertiesTaxonomicGroupTypes:[I.a.EventProperties,I.a.PersonProperties,I.a.Cohorts,I.a.Elements],customRowPrefix:Xe.insight===u.y.LIFECYCLE?e.a.createElement(e.a.Fragment,null,"Showing ",e.a.createElement("b",null,"Unique users")," who did"):void 0}))),Ge[te.h.EXPERIMENTS_SECONDARY_METRICS]&&e.a.createElement(f.a,{className:"secondary-metrics"},e.a.createElement("div",null,e.a.createElement("b",null,"Secondary metrics"),e.a.createElement("span",{className:"text-muted ml-05"},"(optional)")),e.a.createElement("div",{className:"text-muted",style:{marginTop:4}},"Use secondary metrics to monitor metrics related to your experiment goal. You can add up to three secondary metrics."," "),e.a.createElement(Fe,{onMetricsChange:function(x){return dn(x)},initialMetrics:M}))),e.a.createElement(f.a,{span:12,className:"pl"},e.a.createElement("div",{className:"card-secondary mb"},"Goal preview"),e.a.createElement($e.a,{disableHeader:O===u.y.TRENDS,disableTable:!0})))),e.a.createElement(g.a,null,e.a.createElement(ie.a,{className:"experiment-preview"},e.a.createElement(Ee,{experiment:E,trendCount:Ze,trendExposure:wt,funnelSampleSize:bt,funnelEntrants:Nt,funnelConversionRate:Qe}))))),e.a.createElement(G.a,{className:"float-right",type:"primary",htmlType:"submit"},"Save"))):!tn&&l?e.a.createElement("div",{className:"view-experiment"},e.a.createElement(g.a,{className:"draft-header"},e.a.createElement(g.a,{justify:"space-between",align:"middle",className:"full-width pb"},e.a.createElement(f.a,null,e.a.createElement(g.a,null,e.a.createElement(at.a,{style:{paddingRight:8},title:"".concat(l==null?void 0:l.name),buttons:e.a.createElement(e.a.Fragment,null,e.a.createElement(Yt.a,{explicitValue:l.feature_flag_key,iconStyle:{color:"var(--text-muted-alt)"}},e.a.createElement("span",{className:"text-muted"},l.feature_flag_key)),e.a.createElement(et.a,{style:{alignSelf:"center"},color:jn[St()]},e.a.createElement("b",{className:"uppercase"},St())),h&&l.end_date&&e.a.createElement(et.a,{style:{alignSelf:"center"},color:R?"green":"geekblue"},e.a.createElement("b",{className:"uppercase"},R?"Significant Results":"Results not significant")))})),e.a.createElement("span",{className:"exp-description"},l.start_date?e.a.createElement(Wt.a,{multiline:!0,name:"description",value:l.description||"",placeholder:"Description (optional)",onSave:function(x){return on({description:x})},maxLength:400,"data-attr":"experiment-description",compactButtons:!0}):e.a.createElement(e.a.Fragment,null,l.description||"There is no description for this experiment."))),l&&!l.start_date&&e.a.createElement("div",{className:"flex-center"},e.a.createElement(G.a,{type:"secondary",className:"mr-05",onClick:function(){return sn(!0)}},"Edit"),e.a.createElement(G.a,{type:"primary",onClick:function(){return rn()}},"Launch")),l&&l.start_date&&!l.end_date&&e.a.createElement(G.a,{type:"secondary",status:"danger",onClick:function(){return Et()}},"Stop"),(l==null?void 0:l.end_date)&&Object(F.a)().isSameOrAfter(Object(F.a)(l.end_date),"day")&&!l.archived&&e.a.createElement(G.a,{type:"secondary",status:"danger",onClick:function(){return pn()}},e.a.createElement("b",null,"Archive")))),e.a.createElement(g.a,null,He&&h&&R&&!l.end_date&&e.a.createElement(g.a,{align:"middle",className:"significant-results"},e.a.createElement(f.a,{span:20,style:{fontWeight:500,color:"#497342"}},e.a.createElement("div",null,"Experiment results are significant."," ",l.end_date?"":"You can end your experiment now or let it run until complete.")),e.a.createElement(f.a,{span:4},l.end_date?e.a.createElement(Ue.a,{className:"close-button",onClick:function(){return We(!1)}}):e.a.createElement(G.a,{type:"highlighted",className:"end-experiment-btn",onClick:function(){return Et()}},"End experiment"))),He&&h&&!R&&!l.end_date&&e.a.createElement(g.a,{align:"top",className:"not-significant-results"},e.a.createElement(f.a,{span:23,style:{fontWeight:500,color:"#2D2D2D"}},e.a.createElement("strong",null,"Your results are not statistically significant"),"."," ",k," ",l!=null&&l.end_date?"":"We don't recommend ending this experiment yet."," ","See our"," ",e.a.createElement("a",{href:"https://posthog.com/docs/user-guides/experimentation#funnel-experiment-calculations"}," ","experimentation guide"," "),"for more information."," "),e.a.createElement(f.a,{span:1},e.a.createElement(Ue.a,{className:"close-button",onClick:function(){return We(!1)}}))),He&&l.end_date&&e.a.createElement(g.a,{align:"top",className:"feature-flag-mods"},e.a.createElement(f.a,{span:23,style:{fontWeight:500}},e.a.createElement("strong",null,"Your experiment is complete.")," We recommend removing the feature flag from your code completely, instead of relying on this distribution."," ",e.a.createElement(Kt.a,{to:l.feature_flag?Z.a.featureFlag(l.feature_flag):void 0},e.a.createElement("b",null,"Adjust feature flag distribution"))),e.a.createElement(f.a,{span:1},e.a.createElement(Ue.a,{className:"close-button",onClick:function(){return We(!1)}})))),e.a.createElement(g.a,null,e.a.createElement(tt.a,{className:"full-width",defaultActiveKey:"experiment-details"},e.a.createElement(tt.a.Panel,{header:e.a.createElement("b",null,"Experiment details"),key:"experiment-details"},e.a.createElement(g.a,null,e.a.createElement(f.a,{span:l!=null&&l.start_date?12:24},e.a.createElement(Ee,{experiment:l,trendCount:Ze,trendExposure:l==null?void 0:l.parameters.recommended_running_time,funnelSampleSize:l==null?void 0:l.parameters.recommended_sample_size,funnelConversionRate:Qe,funnelEntrants:l!=null&&l.start_date?Pe:Nt})),!T&&!h&&l.start_date&&e.a.createElement(f.a,{span:12},e.a.createElement(he,{experiment:l})),(h||((m=l.secondary_metrics)===null||m===void 0?void 0:m.length)>0)&&e.a.createElement(f.a,{className:"secondary-progress",span:l!=null&&l.start_date?12:24},Ge[te.h.EXPERIMENTS_SECONDARY_METRICS]&&!!(l!=null&&l.secondary_metrics.length)&&e.a.createElement(f.a,{className:"border-bottom"},e.a.createElement(g.a,{align:"middle",justify:"space-between",className:"mb-05"},e.a.createElement(f.a,{className:"card-secondary",span:2*oe},"Secondary metrics"),l==null||(i=l.parameters)===null||i===void 0||(s=i.feature_flag_variants)===null||s===void 0?void 0:s.map(function(y,x){return e.a.createElement(f.a,{key:x,span:oe,style:{color:"".concat(O===u.y.FUNNELS?Object(ot.k)(P(y.key,u.y.FUNNELS)+1):Object(ut.c)("white")[P(y.key,u.y.TRENDS)])}},e.a.createElement("span",{className:"text-default"},Object(C.i)(y.key)))})),Ge[te.h.EXPERIMENTS_SECONDARY_METRICS]&&(l.start_date?nn?e.a.createElement(ke.a,{active:!0,paragraph:!1}):e.a.createElement(e.a.Fragment,null,l.secondary_metrics.map(function(y,x){var L,z;return e.a.createElement(g.a,{className:"border-top",key:x,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement(f.a,{span:2*oe},Object(C.i)(y.name)),l==null||(L=l.parameters)===null||L===void 0||(z=L.feature_flag_variants)===null||z===void 0?void 0:z.map(function(Le,qe){return e.a.createElement(f.a,{key:qe,span:oe},J!=null&&J[x][Le.key]?y.filters.insight===u.y.FUNNELS?e.a.createElement(e.a.Fragment,null,((J==null?void 0:J[x][Le.key])*100).toFixed(1),"%"):e.a.createElement(e.a.Fragment,null,Object(C.N)(J==null?void 0:J[x][Le.key])):e.a.createElement(e.a.Fragment,null,"--"))}))})):e.a.createElement(e.a.Fragment,null,l.secondary_metrics.map(function(y,x){var L,z;return e.a.createElement(g.a,{className:"border-top",key:x,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement(f.a,{span:2*oe},Object(C.i)(y.name)),l==null||(L=l.parameters)===null||L===void 0||(z=L.feature_flag_variants)===null||z===void 0?void 0:z.map(function(Le,qe){return e.a.createElement(f.a,{key:qe,span:oe},"--")}))})))),h&&e.a.createElement(f.a,{className:"mt"},e.a.createElement("div",{className:"mb-05"},e.a.createElement("b",null,"Experiment progress")),e.a.createElement(nt.a,{strokeWidth:20,showInfo:!1,percent:In,strokeColor:"var(--success)"}),O===u.y.TRENDS&&l.start_date&&e.a.createElement(g.a,{justify:"space-between",className:"mt-05"},l.end_date?e.a.createElement("div",null,"Ran for"," ",e.a.createElement("b",null,Object(F.a)(l.end_date).diff(l.start_date,"day"))," ","days"):e.a.createElement("div",null,e.a.createElement("b",null,Object(F.a)().diff(l.start_date,"day"))," ","days running"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,l==null||(p=l.parameters)===null||p===void 0?void 0:p.recommended_running_time)," ","days")),O===u.y.FUNNELS&&e.a.createElement(g.a,{justify:"space-between",className:"mt-05"},l.end_date?e.a.createElement("div",null,"Saw"," ",e.a.createElement("b",null,Object(C.N)(Pe))," ","participants"):e.a.createElement("div",null,e.a.createElement("b",null,Object(C.N)(Pe))," ","participants seen"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,Object(C.N)((l==null||(N=l.parameters)===null||N===void 0?void 0:N.recommended_sample_size)||0))," ","participants"))))))),!(l!=null&&l.start_date)&&e.a.createElement("div",{className:"mt full-width"},e.a.createElement(he,{experiment:l}))),e.a.createElement("div",{className:"experiment-result"},h?e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{justify:"space-around",style:{flexFlow:"nowrap"}},Object.keys(h.probability).sort(function(y,x){return h.probability[x]-h.probability[y]}).map(function(y,x){return e.a.createElement(f.a,{key:x,className:"pr"},e.a.createElement("div",null,e.a.createElement("b",null,Object(C.i)(y))),O===u.y.TRENDS?e.a.createElement(g.a,null,e.a.createElement("b",{style:{paddingRight:4}},e.a.createElement(g.a,null,"action"in h.insight[0]&&e.a.createElement(Ht.a,{filter:h.insight[0].action}),e.a.createElement("span",{style:{paddingLeft:4}},"count:")))," ",ae(y)," ",A&&x===0&&e.a.createElement(we.a,{placement:"right",title:"It might seem confusing that the best variant has lower absolute count, but this can happen when fewer people are exposed to this variant, so its relative count is higher."},e.a.createElement(fe.a,{style:{padding:"4px 2px"}}))):e.a.createElement(g.a,null,e.a.createElement("b",{style:{paddingRight:4}},"Conversion rate:")," ",re(y),"%"),e.a.createElement(nt.a,{percent:Number((h.probability[y]*100).toFixed(1)),size:"small",showInfo:!1,strokeColor:O===u.y.FUNNELS?Object(ot.k)(P(y,u.y.FUNNELS)+1):Object(ut.c)("white")[P(y,u.y.TRENDS)]}),e.a.createElement("div",null,"Probability that this variant is the best:"," ",e.a.createElement("b",null,(h.probability[y]*100).toFixed(1),"%")))}))):T&&e.a.createElement("div",{className:"text-center"},e.a.createElement(ke.a,{active:!0})),h?e.a.createElement(D.BindLogic,{logic:ue.c,props:{dashboardItemId:h.itemID,cachedInsight:{short_id:h.itemID,filters:Ce(Ce(Ce({},h.filters),{},{insight:O,display:l.filters.display},O===u.y.FUNNELS&&{layout:te.j.vertical,funnel_viz_type:u.u.Steps}),O===u.y.TRENDS&&{display:u.i.ActionsLineGraphCumulative}),result:h.insight},doNotLoad:!0}},e.a.createElement("div",{className:"mt"},e.a.createElement($e.a,{disableHeader:O===u.y.TRENDS,disableTable:O===u.y.FUNNELS}))):l.start_date&&e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"no-experiment-results"},!T&&e.a.createElement("div",{className:"text-center"},e.a.createElement("b",null,"There are no results for this experiment yet."),e.a.createElement("div",{className:"text-default"},"Double check your feature flag implementation if you're still not seeing results.")))))):e.a.createElement(ke.a,{active:!0}))}function gt(){return e.a.createElement(Y.a,{defaultValue:"JavaScript",suffixIcon:e.a.createElement(Oe.a,null)},e.a.createElement(Y.a.Option,{value:"JavaScript"},e.a.createElement(g.a,{align:"middle"},e.a.createElement(K.IconJavascript,{style:{marginRight:6}})," JavaScript")))}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss":function(Re,X,c){var _e=c("./node_modules/css-loader/dist/runtime/api.js");X=_e(!1),X.push([Re.i,'.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.experiment-form .metrics-selection{border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;width:100%}.experiment-form .metrics-selection .action-filters-bordered .draggable-action-filter{border-bottom:1px solid rgba(0,0,0,.15);padding:1rem .25rem;margin-top:0}.experiment-form .metrics-selection .action-filters-bordered .row-action-btn{color:#35416b}.experiment-form .person-selection{width:100%;border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;align-items:center;justify-content:space-between}.experiment-form .insights-graph-container{margin-bottom:1rem;background-color:#fff}.experiment-form .insights-graph-container .ant-card-head{border-bottom:1px solid rgba(0,0,0,.15);min-height:unset;background-color:#fff;padding-left:1rem;padding-right:1rem}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title{padding:.5rem 0}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter{font-size:14px}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter:not(:last-child),.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter span.head-title-item{margin-right:.5rem}.experiment-form .insights-graph-container .display-config-inner{display:flex;align-items:center;justify-content:space-between;overflow-x:auto}.experiment-form .insights-graph-container .ant-card-body{padding:0}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left{width:100%}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right{width:100%;height:min(calc(90vh - 16rem),36rem);max-width:300px;padding:0 1rem 1rem 0;display:flex;align-items:center}.experiment-form .insights-graph-container .graph-container{width:calc(100% - 2rem);height:calc(100% - 3rem)}.experiment-form .insights-graph-header{margin-top:0!important;margin-bottom:0!important;padding-left:1rem;padding-right:1rem;min-height:48px}.experiment-form .experiment-preview{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.experiment-form .experiment-preview .mde-slider .ant-slider-handle{border:none}.experiment-form .experiment-preview .mde-slider .ant-slider-rail{background-color:#e5ebff}.experiment-form .variants{margin-top:.5rem;padding-bottom:1rem}.experiment-form .variants .ant-form-horizontal{min-height:32px}.experiment-form .variants .border-top{border-top-left-radius:4px;border-top-right-radius:4px}.experiment-form .variants .border-bottom{border-bottom-left-radius:4px;border-bottom-right-radius:4px}.experiment-form .variants .feature-flag-variant{display:flex;align-items:center;height:3.5rem;padding:0 .5rem;background:#fff;border-bottom-width:1px;border-bottom-color:rgba(0,0,0,.15);border-top:1px solid rgba(0,0,0,.15);border-left:1px solid rgba(0,0,0,.15);border-right:1px solid rgba(0,0,0,.15)}.experiment-form .variants .feature-flag-variant .ant-form-item-explain-error{margin-top:.5rem;color:#bf411a}.experiment-form .variants .feature-flag-variant .ant-form-item-label{padding:0}.experiment-form .variants .variant-label{display:flex;flex-direction:row;justify-content:center;align-items:center;border-radius:4px;color:#fff;min-width:52px;padding:2px 6px;margin-right:8px;font-size:12px;font-weight:500;letter-spacing:.01em}.experiment-form .secondary-metrics{margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(0,0,0,.15);margin-bottom:1rem}.experiment-form .ant-input-number-disabled,.experiment-form .ant-input[disabled]{color:#000}.view-experiment .draft-header{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.view-experiment .exp-description{font-style:italic;color:rgba(0,0,0,.5)}.view-experiment .participants{background-color:#fff}.view-experiment .participants .ant-collapse-header{padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem}.view-experiment .variants-list{list-style:none;margin:0;padding:0}.view-experiment .variants-list li{display:inline}.view-experiment .variants-list li:after{content:", "}.view-experiment .variants-list li:last-child:after{content:""}.view-experiment .experiment-result{padding-top:1rem}.view-experiment .significant-results{padding:.5rem;width:100%;background:rgba(119,185,108,.1);border-radius:4px;text-align:center;margin-bottom:1rem}.view-experiment .not-significant-results{padding:.5rem;width:100%;background:rgba(83,117,255,.1);border-radius:4px;margin-bottom:1rem}.view-experiment .feature-flag-mods{padding:.5rem;width:100%;background:#f6ebf8;border-radius:4px;margin-bottom:1rem}.view-experiment .ant-collapse-content-box{display:flex;flex-flow:column}.view-experiment .secondary-progress{margin-top:.5rem}.view-experiment .secondary-progress li:before{content:"\u2022";display:inline-block;font-weight:900;margin-right:4px}.view-experiment .secondary-progress .ant-progress-inner,.view-experiment .secondary-progress .ant-progress-inner .ant-progress-bg{border-radius:4px}.view-experiment .no-experiment-results{display:flex;justify-content:center;align-items:center;margin-top:1rem;background-color:#fafaf9;border:1px solid rgba(0,0,0,.15);width:100%;min-height:320px;font-size:24px}.view-experiment .end-experiment-btn{background:#77b96c;color:#fff}.view-experiment .end-experiment-btn:hover{color:#000}.preview-conversion-goal-num{height:24px;width:24px;text-align:center;background-color:#fafaf9;color:#35416b;font-weight:700;margin-right:.5rem}.experiment-preview-row{border-bottom:1px solid rgba(0,0,0,.15);padding-bottom:1rem;margin-bottom:1rem}.experiment-preview-row:last-child{border-bottom:none;padding-bottom:0;margin-bottom:0}.metric-name{border:1px solid rgba(0,0,0,.15);border-radius:4px;padding:8px 8px 8px 16px;margin-left:.5rem;flex:1}.experiment-implementation-details,.experiment-workflow{border-color:#d9d9d9}.experiment-implementation-details .ant-card-head,.experiment-workflow .ant-card-head{padding-left:1rem;padding-right:1rem;border:none}.experiment-implementation-details .ant-card-head-title,.experiment-workflow .ant-card-head-title{border-bottom:1px solid rgba(0,0,0,.15)}.experiment-implementation-details .exp-workflow-step,.experiment-workflow .exp-workflow-step{margin-bottom:.5rem;padding:.5rem;border-radius:4px}.experiment-implementation-details .exp-workflow-step:hover,.experiment-workflow .exp-workflow-step:hover{cursor:pointer}.experiment-implementation-details .step-completed,.experiment-workflow .step-completed{background-color:#e5ebff}',""]),Re.exports=X}}]);
