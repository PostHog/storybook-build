(window.webpackJsonp=window.webpackJsonp||[]).push([[5,6,8,10,309],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(S,c,e){"use strict";e.r(c);var g=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),O=e.n(g),A=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),d=e.n(A),h={};h.insert="head",h.singleton=!1;var y=O()(d.a,h);c.default=d.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(S,c,e){"use strict";e.r(c),e.d(c,"AppMetricsGraph",function(){return G});var g=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),O=e.n(g),A=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),d=e.n(A),h=e("./node_modules/core-js/modules/es.array.concat.js"),y=e.n(h),F=e("./node_modules/core-js/modules/es.object.keys.js"),Z=e.n(F),$=e("./node_modules/core-js/modules/es.symbol.js"),Q=e.n($),s=e("./node_modules/core-js/modules/es.array.filter.js"),X=e.n(s),W=e("./node_modules/core-js/modules/es.object.to-string.js"),N=e.n(W),x=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Y=e.n(x),l=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),L=e.n(l),T=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),m=e.n(T),v=e("./node_modules/react/index.js"),f=e.n(v),R=e("./frontend/src/lib/colors.ts"),C=e("./node_modules/chart.js/dist/chart.mjs"),i=e("./frontend/src/scenes/apps/constants.tsx"),M=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),w=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),B=e("./frontend/src/lib/utils.tsx"),K=e("./node_modules/react/jsx-runtime.js"),z=e.n(K);function V(u,E){var _=Object.keys(u);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(u);E&&(P=P.filter(function(t){return Object.getOwnPropertyDescriptor(u,t).enumerable})),_.push.apply(_,P)}return _}function J(u){for(var E=1;E<arguments.length;E++){var _=arguments[E]!=null?arguments[E]:{};E%2?V(Object(_),!0).forEach(function(P){O()(u,P,_[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(_)):V(Object(_)).forEach(function(P){Object.defineProperty(u,P,Object.getOwnPropertyDescriptor(_,P))})}return u}function G(u){var E=u.tab,_=u.metrics,P=u.metricsLoading,t=Object(v.useRef)(null),o=i.DescriptionColumns[E];return Object(v.useEffect)(function(){var r;if(t.current&&_){var n;r=new C.a((n=t.current)===null||n===void 0?void 0:n.getContext("2d"),{type:"line",data:{labels:_.dates,datasets:[J({label:o.successes,data:_.successes,borderColor:""},j("data-brand-blue"))].concat(d()(o.successes_on_retry?[J({label:o.successes_on_retry,data:_.successes_on_retry},j("data-yellow"))]:[]),[J({label:o.failures,data:_.failures},j("data-vermilion"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var a;(a=r)===null||a===void 0||a.destroy()}},[_]),P||!_?Object(K.jsx)(M.a,{className:"AppMetricsGraph border rounded p-6"}):Object(K.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:Object(K.jsx)("canvas",{ref:t})})}function j(u){var E=Object(R.b)(u);return{borderColor:E,hoverBorderColor:Object(B.lb)(E,-20),hoverBackgroundColor:Object(B.lb)(E,-20),backgroundColor:E,fill:!1,borderWidth:2,pointRadius:0}}try{G.displayName="AppMetricsGraph",G.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:G.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(u){}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(S,c,e){"use strict";e.r(c),e.d(c,"MetricsTab",function(){return W}),e.d(c,"MetricsOverview",function(){return N}),e.d(c,"ErrorsOverview",function(){return x});var g=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),O=e("./frontend/src/scenes/apps/constants.tsx"),A=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),d=e("./frontend/src/lib/utils.tsx"),h=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),y=e("./frontend/src/lib/components/LemonSelect.tsx"),F=e("./node_modules/kea/lib/index.esm.js"),Z=e("./frontend/src/lib/components/LemonTable/index.ts"),$=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),Q=e("./frontend/src/lib/components/Link.tsx"),s=e("./node_modules/react/jsx-runtime.js"),X=e.n(s);function W(l){var L=l.tab,T=Object(F.useValues)(g.appMetricsSceneLogic),m=T.appMetricsResponse,v=T.appMetricsResponseLoading,f=T.dateFrom,R=Object(F.useActions)(g.appMetricsSceneLogic),C=R.setDateFrom;return Object(s.jsxs)("div",{className:"space-y-8",children:[Object(s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[Object(s.jsx)(N,{tab:L,metrics:m==null?void 0:m.metrics,metricsLoading:v}),Object(s.jsx)(y.a,{value:f,onChange:function(M){return C(M)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),Object(s.jsxs)("div",{children:[Object(s.jsx)("h2",{children:"Delivery trends"}),Object(s.jsx)(h.AppMetricsGraph,{tab:L,metrics:m==null?void 0:m.metrics,metricsLoading:v})]}),Object(s.jsxs)("div",{children:[Object(s.jsx)("h2",{children:"Errors"}),Object(s.jsx)(x,{category:L,errors:(m==null?void 0:m.errors)||[],loading:v})]})]})}function N(l){var L,T,m,v=l.tab,f=l.metrics,R=l.metricsLoading,C=l.exportDuration,i=l.exportFailureReason;return R?Object(s.jsx)(A.a,{className:"w-20 mb-2",repeat:4}):Object(s.jsxs)("div",{className:"space-y-4",children:[Object(s.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[Object(s.jsxs)("div",{children:[Object(s.jsx)("div",{className:"text-muted font-semibold mb-2",children:O.DescriptionColumns[v].successes}),Object(s.jsx)("div",{className:"text-4xl",children:Y(f==null||(L=f.totals)===null||L===void 0?void 0:L.successes)})]}),O.DescriptionColumns[v].successes_on_retry&&Object(s.jsxs)("div",{children:[Object(s.jsx)("div",{className:"text-muted font-semibold mb-2",children:O.DescriptionColumns[v].successes_on_retry}),Object(s.jsx)("div",{className:"text-4xl",children:Y(f==null||(T=f.totals)===null||T===void 0?void 0:T.successes_on_retry)})]}),Object(s.jsxs)("div",{children:[Object(s.jsx)("div",{className:"text-muted font-semibold mb-2",children:O.DescriptionColumns[v].failures}),Object(s.jsx)("div",{className:"text-4xl",children:Y(f==null||(m=f.totals)===null||m===void 0?void 0:m.failures)})]}),C&&Object(s.jsxs)("div",{children:[Object(s.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export duration"}),Object(s.jsx)("div",{className:"text-4xl",children:Object(d.O)(C)})]})]}),i&&Object(s.jsxs)("div",{children:[Object(s.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export failure reason"}),Object(s.jsx)("div",{children:i})]})]})}function x(l){var L=l.errors,T=l.loading,m=l.category,v=l.jobId,f=Object(F.useActions)(g.appMetricsSceneLogic),R=f.openErrorDetailsModal;return Object(s.jsx)(Z.a,{dataSource:L,loading:T,columns:[{title:"Error type",dataIndex:"error_type",render:function(i,M){return Object(s.jsx)(Q.a,{title:"View details",className:"font-semibold",onClick:function(B){B.preventDefault(),R(M.error_type,m,v)},children:M.error_type})},sorter:function(i,M){return i.error_type.localeCompare(M.error_type)}},{title:"Count",dataIndex:"count",align:"right",sorter:function(i,M){return i.count-M.count}},{title:"Last seen",dataIndex:"last_seen",render:function(i){return Object(s.jsx)("div",{className:"whitespace-nowrap text-right",children:Object(s.jsx)($.b,{time:i})})},align:"right",sorter:function(i,M){return new Date(i.last_seen||0)>new Date(M.last_seen||0)?1:-1}}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:Object(s.jsxs)("div",{className:"",children:[Object(s.jsx)("b",{children:"No errors! \u{1F973}"}),Object(s.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})}function Y(l){return Object(s.jsx)(s.Fragment,{children:l&&Object(d.P)(l)})}try{W.displayName="MetricsTab",W.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:W.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(l){}try{N.displayName="MetricsOverview",N.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}},exportDuration:{defaultValue:null,description:"",name:"exportDuration",required:!1,type:{name:"number"}},exportFailureReason:{defaultValue:null,description:"",name:"exportFailureReason",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:N.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(l){}try{x.displayName="ErrorsOverview",x.__docgenInfo={description:"",displayName:"ErrorsOverview",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"AppErrorSummary[]"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},category:{defaultValue:null,description:"",name:"category",required:!0,type:{name:"string"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"]={docgenInfo:x.__docgenInfo,name:"ErrorsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"})}catch(l){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(S,c,e){"use strict";e.r(c),e.d(c,"AppMetricsTab",function(){return j}),e.d(c,"appMetricsSceneLogic",function(){return _});var g=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),O=e.n(g),A=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),d=e.n(A),h=e("./node_modules/@babel/runtime/regenerator/index.js"),y=e.n(h),F=e("./node_modules/core-js/modules/es.array.iterator.js"),Z=e.n(F),$=e("./node_modules/core-js/modules/es.object.to-string.js"),Q=e.n($),s=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),X=e.n(s),W=e("./node_modules/core-js/modules/es.array.concat.js"),N=e.n(W),x=e("./node_modules/core-js/modules/es.function.name.js"),Y=e.n(x),l=e("./node_modules/core-js/modules/es.array.includes.js"),L=e.n(l),T=e("./node_modules/core-js/modules/es.string.includes.js"),m=e.n(T),v=e("./node_modules/core-js/modules/es.array.filter.js"),f=e.n(v),R=e("./node_modules/core-js/modules/es.number.constructor.js"),C=e.n(R),i=e("./node_modules/kea/lib/index.esm.js"),M=e("./node_modules/kea-loaders/lib/index.js"),w=e.n(M),B=e("./frontend/src/scenes/urls.ts"),K=e("./frontend/src/lib/api.ts"),z=e("./frontend/src/scenes/teamLogic.tsx"),V=e("./node_modules/kea-router/lib/index.js"),J=e.n(V),G=e("./frontend/src/lib/utils.tsx"),j;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.HistoricalExports="historical_exports"})(j||(j={}));var u="-30d",E=[j.ProcessEvent,j.OnEvent,j.ExportEvents],_=Object(i.kea)([Object(i.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(i.props)({}),Object(i.key)(function(t){return t.pluginConfigId}),Object(i.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}},openErrorDetailsModal:function(o,r,n){return{errorType:o,category:r,jobId:n}},closeErrorDetailsModal:!0}),Object(i.reducers)({activeTab:[null,{setActiveTab:function(o,r){var n=r.tab;return n}}],dateFrom:[u,{setDateFrom:function(o,r){var n=r.dateFrom;return n}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(o,r){var n=r.errorType;return n},closeErrorDetailsModal:function(){return null}}]}),Object(M.loaders)(function(t){var o=t.values,r=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var n=d()(y.a.mark(function D(){return y.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,K.b.get("api/projects/".concat(z.a.values.currentTeamId,"/plugin_configs/").concat(r.pluginConfigId));case 2:return b.abrupt("return",b.sent);case 3:case"end":return b.stop()}},D)}));function a(){return n.apply(this,arguments)}return a}()}],appMetricsResponse:[null,{loadMetrics:function(){var n=d()(y.a.mark(function D(){var p;return y.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return p=Object(G.Eb)({category:o.activeTab,date_from:o.dateFrom}),I.next=3,K.b.get("api/projects/".concat(z.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"?").concat(p));case 3:return I.abrupt("return",I.sent);case 4:case"end":return I.stop()}},D)}));function a(){return n.apply(this,arguments)}return a}()}],historicalExports:[[],{loadHistoricalExports:function(){var n=d()(y.a.mark(function D(){var p,b;return y.a.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,K.b.get("api/projects/".concat(z.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/historical_exports"));case 2:return p=U.sent,b=p.results,U.abrupt("return",b);case 5:case"end":return U.stop()}},D)}));function a(){return n.apply(this,arguments)}return a}()}],errorDetails:[[],{openErrorDetailsModal:function(){var n=d()(y.a.mark(function D(p){var b,I,U,k,q,ee;return y.a.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return b=p.category,I=p.jobId,U=p.errorType,k=Object(G.Eb)({category:b,job_id:I,error_type:U}),H.next=4,K.b.get("api/projects/".concat(z.a.values.currentTeamId,"/app_metrics/").concat(r.pluginConfigId,"/error_details?").concat(k));case 4:return q=H.sent,ee=q.result,H.abrupt("return",ee);case 7:case"end":return H.stop()}},D)}));function a(D){return n.apply(this,arguments)}return a}()}]}}),Object(i.selectors)(function(t){var o=t.values;return{breadcrumbs:[function(r){return[r.pluginConfig,function(n,a){return a.pluginConfigId}]},function(r,n){var a;return[{name:"Apps",path:B.a.projectApps()},{name:r==null||(a=r.plugin_info)===null||a===void 0?void 0:a.name,path:B.a.appMetrics(n)}]}],showTab:[function(){return[]},function(){return function(r){var n;if(o.pluginConfigLoading||!o.pluginConfig)return!1;var a=((n=o.pluginConfig.plugin_info.capabilities)===null||n===void 0?void 0:n.methods)||[];return r===j.HistoricalExports?a.includes("exportEvents"):r===j.OnEvent&&a.includes("exportEvents")?!1:a.includes(r)}}]}}),Object(i.listeners)(function(t){var o=t.values,r=t.actions;return{loadPluginConfigSuccess:function(){if(!o.activeTab){var a=E.filter(function(b){return o.showTab(b)}),D=O()(a,1),p=D[0];r.setActiveTab(p)}},setActiveTab:function(a){var D=a.tab;D===j.HistoricalExports?r.loadHistoricalExports():r.loadMetrics()},setDateFrom:function(){r.loadMetrics()}}}),Object(V.actionToUrl)(function(t){var o=t.values,r=t.props;return{setActiveTab:function(){return P(o,r)},setDateFrom:function(){return P(o,r)}}}),Object(V.urlToAction)(function(t){var o=t.values,r=t.actions,n=t.props;return{"/app/:pluginConfigId/:page":function(D,p){n.pluginConfigId===Number(D.pluginConfigId)&&(o.pluginConfig||r.loadPluginConfig(),D.page===j.HistoricalExports?r.setActiveTab(j.HistoricalExports):(p.tab&&E.includes(p.tab)&&r.setActiveTab(p.tab),p.from&&r.setDateFrom(p.from)))}}})]);function P(t,o){if(t.activeTab===j.HistoricalExports)return B.a.appHistoricalExports(o.pluginConfigId);var r={};return t.activeTab&&(r.tab=t.activeTab),t.dateFrom!==u&&(r.from=t.dateFrom),B.a.appMetrics(o.pluginConfigId,r)}},"./frontend/src/scenes/apps/constants.tsx":function(S,c,e){"use strict";e.r(c),e.d(c,"DescriptionColumns",function(){return h});var g=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),O=e.n(g),A=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),d,h=(d={},O()(d,A.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),O()(d,A.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),O()(d,A.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),O()(d,A.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),d)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(S,c,e){var g=e("./node_modules/css-loader/dist/runtime/api.js");c=g(!1),c.push([S.i,".AppMetricsGraph{height:300px}",""]),S.exports=c}}]);
