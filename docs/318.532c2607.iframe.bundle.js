(window.webpackJsonp=window.webpackJsonp||[]).push([[318],{"./frontend/src/scenes/actions/Action.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Action",(function(){return Action}));var utils=__webpack_require__("./frontend/src/lib/utils.tsx"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),actionsModel=__webpack_require__("./frontend/src/models/actionsModel.ts"),lemonToast=__webpack_require__("./frontend/src/lib/lemon-ui/lemonToast.tsx"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_forms_lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),eventDefinitionsTableLogic=__webpack_require__("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts"),tagsModel=__webpack_require__("./frontend/src/models/tagsModel.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const actionEditLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","actions","actionEditLogic"]),Object(index_esm.props)({}),Object(index_esm.key)((props=>props.id||"new")),Object(index_esm.connect)({actions:[tagsModel.a,["loadTags"]]}),Object(index_esm.actions)({setAction:function(action){let options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{merge:!0};return{action:action,options:options}},setCreateNew:createNew=>({createNew:createNew}),actionAlreadyExists:actionId=>({actionId:actionId}),deleteAction:!0}),Object(index_esm.connect)({actions:[actionsModel.a,["loadActions"],eventDefinitionsTableLogic.c,["loadEventDefinitions"]]}),Object(index_esm.reducers)({createNew:[!1,{setCreateNew:(_,_ref)=>{let{createNew:createNew}=_ref;return createNew}}],wasDeleted:[!1,{deleteAction:()=>!0}]}),Object(kea_forms_lib.forms)((_ref2=>{let{actions:actions,props:props}=_ref2;return{action:{defaults:{...props.action},errors:_ref3=>{let{name:name}=_ref3;return{name:name?null:"You need to set a name"}},submit:action=>{actions.saveAction(action)}}}})),Object(lib.loaders)((_ref4=>{let{props:props,values:values,actions:actions}=_ref4;return{actionCount:{loadActionCount:async()=>props.id?await api.b.actions.getCount(props.id):0},action:[{...props.action},{setAction:_ref5=>{let{action:action,options:{merge:merge}}=_ref5;return merge?{...values.action,...action}:action},saveAction:async(updatedAction,breakpoint)=>{let action={...updatedAction};try{action=action.id?await api.b.actions.update(action.id,action,props.temporaryToken):await api.b.actions.create(action,props.temporaryToken),breakpoint()}catch(response){if("unique"===response.code){const dupeId=response.detail.split(" ").pop();return lemonToast.d.error(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Action with this name already exists."," ",Object(jsx_runtime.jsx)(Link.a,{to:urls.a.action(dupeId),children:"Click here to edit."})]})),action}throw response}return lemonToast.d.success("Action saved"),props.onSave(action),actions.loadEventDefinitions(null),actions.loadActions(),actions.loadActionCount(),actions.loadTags(),action}}]}})),Object(index_esm.listeners)((_ref6=>{let{values:values,actions:actions}=_ref6;return{deleteAction:()=>{Object(utils.x)({endpoint:api.b.actions.determineDeleteEndpoint(),object:values.action,callback:()=>{kea_router_lib.router.actions.push(urls.a.actions()),actions.loadActions()}})}}})),Object(index_esm.afterMount)((_ref7=>{let{actions:actions,props:props}=_ref7;props.id?actions.loadActionCount():actions.setAction({name:"",steps:[{isNew:Object(utils.Ob)()}]},{merge:!1})})),Object(kea_router_lib.urlToAction)((_ref8=>{let{actions:actions}=_ref8;return{[urls.a.createAction()]:(_,searchParams)=>{try{if(searchParams.copy){const{id:_id,created_at:_created_at,created_by:_created_by,last_calculated_at:_last_calculated_at,...actionToCopy}=searchParams.copy;actions.setAction({...actionToCopy,steps:actionToCopy.steps.map((s=>{const{id:_id,...step}=s;return{...step,isNew:Object(utils.Ob)()}})),name:`${actionToCopy.name} (copy)`},{merge:!1})}}catch(e){throw new Error("Could not parse action to copy from URL")}}}})),Object(kea_router_lib.beforeUnload)((_ref9=>{let{values:values}=_ref9;return{enabled:()=>values.actionChanged&&!values.wasDeleted,message:"Leave action?\nChanges you made will be discarded."}}))]);var EventName=__webpack_require__("./frontend/src/scenes/actions/EventName.tsx"),PropertyFilters=__webpack_require__("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),hints=__webpack_require__("./frontend/src/scenes/actions/hints.tsx"),col=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/col/index.js"),es_radio=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/radio/index.js"),types=__webpack_require__("./frontend/src/types.ts"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonDialog=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDialog/index.ts"),AuthorizedUrlList=__webpack_require__("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),authorizedUrlListLogic=__webpack_require__("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),LemonLabel=__webpack_require__("./frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts");const learnMoreLink="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function ActionStep(_ref){let{step:step,actionId:actionId,isOnlyStep:isOnlyStep,index:index,identifier:identifier,onDelete:onDelete,onChange:onChange}=_ref;const sendStep=stepToSend=>{onChange(stepToSend)};return Object(jsx_runtime.jsx)(col.a,{span:24,md:12,children:Object(jsx_runtime.jsxs)("div",{className:"rounded border p-4 relative h-full",children:[index>0&&Object(jsx_runtime.jsx)("div",{className:"stateful-badge pos-center-end or",children:"OR"}),Object(jsx_runtime.jsxs)("div",{className:"space-y-4",children:[Object(jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[Object(jsx_runtime.jsxs)("b",{children:["Match Group #",index+1]}),!isOnlyStep&&Object(jsx_runtime.jsx)(src.LemonButton,{status:"primary-alt",icon:Object(jsx_runtime.jsx)(icons.G,{}),size:"small","aria-label":"delete",onClick:onDelete})]}),Object(jsx_runtime.jsx)(TypeSwitcher,{step:step,sendStep:sendStep}),"$autocapture"===step.event&&Object(jsx_runtime.jsx)(AutocaptureFields,{step:step,sendStep:sendStep,actionId:actionId}),void 0!==step.event&&"$autocapture"!==step.event&&"$pageview"!==step.event&&Object(jsx_runtime.jsxs)("div",{className:"space-y-1",children:[Object(jsx_runtime.jsx)(LemonLabel.a,{children:"Event name"}),Object(jsx_runtime.jsx)(EventName.a,{value:step.event,onChange:value=>sendStep({...step,event:value}),placeholder:"All events",allEventsOption:"explicit"}),Object(jsx_runtime.jsxs)("small",{children:[Object(jsx_runtime.jsx)(src.Link,{to:"https://posthog.com/docs/libraries",target:"_blank",children:"See documentation"})," ","on how to send custom events in lots of languages."]})]}),"$pageview"===step.event&&Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)(Option,{step:step,sendStep:sendStep,item:"url",extra_options:Object(jsx_runtime.jsx)(StringMatchingSelection,{field:"url",step:step,sendStep:sendStep}),label:"URL"}),step.url_matching&&step.url_matching in hints.a&&Object(jsx_runtime.jsx)("small",{children:hints.a[step.url_matching]})]}),Object(jsx_runtime.jsxs)("div",{className:"mt-4 space-y-2",children:[Object(jsx_runtime.jsx)(LemonLabel.a,{children:"Filters"}),Object(jsx_runtime.jsx)(PropertyFilters.a,{propertyFilters:step.properties,pageKey:identifier,eventNames:step.event?[step.event]:[],onChange:properties=>{sendStep({...step,properties:properties})},showConditionBadge:!0})]})]})]})})}function Option(_ref2){let{step:step,sendStep:sendStep,item:item,label:label,placeholder:placeholder="Specify a value to match on this",caption:caption,extra_options:extra_options}=_ref2;const[selectorPrompt,setSelectorPrompt]=Object(react.useState)(null);return Object(jsx_runtime.jsxs)("div",{className:"space-y-1",children:[Object(jsx_runtime.jsxs)(LemonLabel.a,{children:[label," ",extra_options]}),caption&&Object(jsx_runtime.jsx)("div",{className:"action-step-caption",children:caption}),Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:val=>{"selector"===item&&((val,selectorPrompts)=>{val.includes("#")?selectorPrompts(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["PostHog actions don't support the ",Object(jsx_runtime.jsx)("code",{children:"#example"})," syntax.",Object(jsx_runtime.jsx)("br",{}),"Use the equivalent ",Object(jsx_runtime.jsx)("code",{children:'[id="example"]'})," instead."]})):selectorPrompts(null)})(val,setSelectorPrompt),sendStep({...step,[item]:val||null})},value:step[item]||"",placeholder:placeholder}),"selector"===item&&selectorPrompt&&Object(jsx_runtime.jsx)(LemonBanner.a,{type:"warning",children:selectorPrompt})]})}const AndSeparator=()=>Object(jsx_runtime.jsx)("div",{className:"text-center my-2",children:Object(jsx_runtime.jsx)("span",{className:"stateful-badge and",children:"AND"})});function AutocaptureFields(_ref3){let{step:step,actionId:actionId,sendStep:sendStep}=_ref3;return Object(jsx_runtime.jsxs)("div",{className:"space-y-4",children:[Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(src.LemonButton,{size:"small",type:"secondary",onClick:()=>{LemonDialog.a.open({title:"Select an element",description:actionId?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",content:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsx)(AuthorizedUrlList.a,{actionId:actionId,type:authorizedUrlListLogic.a.TOOLBAR_URLS})}),primaryButton:{children:"Close",type:"secondary"}})},sideIcon:Object(jsx_runtime.jsx)(icons.fc,{}),children:"Select element on site"}),Object(jsx_runtime.jsx)(src.Link,{to:`${learnMoreLink}#autocapture-based-actions`,target:"_blank",children:"See documentation."})]}),Object(jsx_runtime.jsx)(Option,{step:step,sendStep:sendStep,item:"text",extra_options:Object(jsx_runtime.jsx)(StringMatchingSelection,{field:"text",step:step,sendStep:sendStep}),label:"Element text"}),Object(jsx_runtime.jsx)(AndSeparator,{}),Object(jsx_runtime.jsx)(Option,{step:step,sendStep:sendStep,item:"href",extra_options:Object(jsx_runtime.jsx)(StringMatchingSelection,{field:"href",step:step,sendStep:sendStep}),label:"Element link target",caption:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Filtering by the ",Object(jsx_runtime.jsx)("code",{children:"href"})," attribute. Only ",Object(jsx_runtime.jsx)("code",{children:"<a/>"})," elements will be matched."]})}),Object(jsx_runtime.jsx)(AndSeparator,{}),Object(jsx_runtime.jsx)(Option,{step:step,sendStep:sendStep,item:"selector",label:"Element matches HTML selector",caption:Object(jsx_runtime.jsxs)("span",{children:["The selector can be a tag name, class, HTML attribute, or all of those combined. Example:"," ",Object(jsx_runtime.jsx)("code",{children:'button[data-attr="signup"]'}),"."," ",Object(jsx_runtime.jsx)(src.Link,{to:`${learnMoreLink}#matching-selectors`,children:"Learn more in Docs."})]})}),Object(jsx_runtime.jsx)(AndSeparator,{}),Object(jsx_runtime.jsx)(Option,{step:step,sendStep:sendStep,item:"url",extra_options:Object(jsx_runtime.jsx)(StringMatchingSelection,{field:"url",step:step,sendStep:sendStep}),label:"Page URL",caption:"The page on which the interaction occurred."}),(null==step?void 0:step.url_matching)&&step.url_matching in hints.a&&Object(jsx_runtime.jsx)("small",{children:hints.a[step.url_matching]})]})}function TypeSwitcher(_ref4){let{step:step,sendStep:sendStep}=_ref4;return Object(jsx_runtime.jsx)("div",{className:"type-switcher",children:Object(jsx_runtime.jsxs)(es_radio.a.Group,{buttonStyle:"solid",onChange:e=>{const type=e.target.value;"$autocapture"===type?sendStep({...step,event:"$autocapture"}):"event"===type?sendStep({...step,event:null}):"$pageview"===type&&sendStep({...step,event:"$pageview",url:step.url})},value:"$autocapture"===step.event||"$pageview"===step.event||void 0===step.event?step.event:"event",children:[Object(jsx_runtime.jsx)(es_radio.a.Button,{value:"$autocapture",children:"Autocapture"}),Object(jsx_runtime.jsx)(es_radio.a.Button,{value:"event",children:"Custom event"}),Object(jsx_runtime.jsx)(es_radio.a.Button,{value:"$pageview",children:"Page view"})]})})}function StringMatchingSelection(_ref5){let{field:field,step:step,sendStep:sendStep}=_ref5;const key=`${field}_matching`,defaultValue="url"===field?types.kb.Contains:types.kb.Exact;return Object(jsx_runtime.jsxs)(es_radio.a.Group,{buttonStyle:"solid",onChange:e=>{sendStep({...step,[key]:e.target.value})},value:step[key]||defaultValue,size:"small",children:[Object(jsx_runtime.jsx)(es_radio.a.Button,{value:"exact",children:"matches exactly"}),Object(jsx_runtime.jsx)(es_radio.a.Button,{value:"regex",children:"matches regex"}),Object(jsx_runtime.jsx)(es_radio.a.Button,{value:"contains",children:"contains"})]})}try{ActionStep.displayName="ActionStep",ActionStep.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:ActionStep.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(__react_docgen_typescript_loader_error){}var row=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/row/index.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),EditableField=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),ObjectTags=__webpack_require__("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonCheckbox=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCheckbox/index.ts"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/Spinner.tsx");function ActionEdit(_ref){let{action:loadedAction,id:id,onSave:onSave,temporaryToken:temporaryToken}=_ref;const logicProps={id:id,action:loadedAction,onSave:action=>onSave(action),temporaryToken:temporaryToken},logic=actionEditLogic(logicProps),{action:action,actionLoading:actionLoading,actionCount:actionCount,actionCountLoading:actionCountLoading}=Object(index_esm.useValues)(logic),{submitAction:submitAction,deleteAction:deleteAction}=Object(index_esm.useActions)(logic),{currentTeam:currentTeam}=Object(index_esm.useValues)(teamLogic.b),{hasAvailableFeature:hasAvailableFeature}=Object(index_esm.useValues)(userLogic.a),{tags:tags}=Object(index_esm.useValues)(tagsModel.a),slackEnabled=null==currentTeam?void 0:currentTeam.slack_incoming_webhook,deleteButton=()=>Object(jsx_runtime.jsx)(LemonButton.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",onClick:()=>{deleteAction()},children:"Delete"}),cancelButton=()=>Object(jsx_runtime.jsx)(LemonButton.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",onClick:()=>{kea_router_lib.router.actions.push(urls.a.actions())},children:"Cancel"});return Object(jsx_runtime.jsx)("div",{className:"action-edit-container",children:Object(jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:actionEditLogic,props:logicProps,formKey:"action",enableFormOnSubmit:!0,children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:Object(jsx_runtime.jsx)(Field.a,{name:"name",children:_ref2=>{let{value:value,onChange:onChange}=_ref2;return Object(jsx_runtime.jsx)(EditableField.a,{name:"name",value:value||"",placeholder:"Name this action",onChange:id?void 0:onChange,onSave:value=>{onChange(value),submitAction()},mode:id?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-"+(id?"edit":"create"),className:"action-name"})}}),caption:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(Field.a,{name:"description",children:_ref3=>{let{value:value,onChange:onChange}=_ref3;return Object(jsx_runtime.jsx)(EditableField.a,{multiline:!0,name:"description",value:value||"",placeholder:"Description (optional)",onChange:id?void 0:onChange,onSave:value=>{onChange(value),submitAction()},mode:id?void 0:"edit","data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!hasAvailableFeature(types.d.INGESTION_TAXONOMY)})}}),Object(jsx_runtime.jsx)(Field.a,{name:"tags",children:_ref4=>{let{value:value,onChange:onChange}=_ref4;return Object(jsx_runtime.jsx)(ObjectTags.a,{tags:null!=value?value:[],onChange:(_,newTags)=>onChange(newTags),className:"action-tags",saving:actionLoading,tagsAvailable:tags.filter((tag=>{var _action$tags;return!(null!==(_action$tags=action.tags)&&void 0!==_action$tags&&_action$tags.includes(tag))}))})}})]}),buttons:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[id?Object(jsx_runtime.jsx)(LemonButton.a,{type:"secondary",to:Object(kea_router_lib.combineUrl)(urls.a.replay(),{filters:{actions:[{id:id,type:"actions",order:0,name:action.name}]}}).url,sideIcon:Object(jsx_runtime.jsx)(icons.sc,{}),"data-attr":"action-view-recordings",children:"View recordings"}):null,id?deleteButton():cancelButton()]})}),id&&Object(jsx_runtime.jsx)("div",{className:"input-set",children:Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsxs)("span",{className:"flex items-center gap-2 text-muted mb-2",children:[null!==actionCount&&actionCount>-1&&Object(jsx_runtime.jsxs)("span",{children:["This action matches ",Object(jsx_runtime.jsx)("b",{children:Object(utils.p)(actionCount)})," events in the last 3 months"]}),actionCountLoading&&Object(jsx_runtime.jsx)(Spinner.a,{})]})})}),Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("h2",{className:"subtitle",children:"Match groups"}),Object(jsx_runtime.jsxs)("div",{children:["Your action will be triggered whenever ",Object(jsx_runtime.jsx)("b",{children:"any of your match groups"})," are received.",Object(jsx_runtime.jsx)(Link.a,{to:"https://posthog.com/docs/features/actions",target:"_blank",children:Object(jsx_runtime.jsx)(icons.Cb,{className:"ml-1 text-muted text-xl"})})]}),Object(jsx_runtime.jsx)(Field.a,{name:"steps",children:_ref5=>{let{onChange:onChange}=_ref5;return Object(jsx_runtime.jsx)("div",{className:"flex justify-end mb-2",children:Object(jsx_runtime.jsx)(LemonButton.a,{onClick:()=>onChange([...action.steps||[],{isNew:Object(utils.Ob)()}]),size:"small",type:"secondary",children:"Add another match group"})})}}),Object(jsx_runtime.jsx)(Field.a,{name:"steps",children:_ref6=>{let{value:stepsValue,onChange:onChange}=_ref6;return Object(jsx_runtime.jsxs)(row.a,{gutter:[24,24],children:[Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:stepsValue.map(((step,index)=>{const identifier=String(JSON.stringify(step));return Object(jsx_runtime.jsx)(ActionStep,{identifier:identifier,index:index,step:step,actionId:action.id||0,isOnlyStep:!!stepsValue&&1===stepsValue.length,onDelete:()=>{var _stepsValue$filter;const identifier=step.id?"id":"isNew";onChange(null!==(_stepsValue$filter=null==stepsValue?void 0:stepsValue.filter((s=>s[identifier]!==step[identifier])))&&void 0!==_stepsValue$filter?_stepsValue$filter:[])},onChange:newStep=>{var _stepsValue$map;onChange(null!==(_stepsValue$map=null==stepsValue?void 0:stepsValue.map((s=>step.id&&s.id==step.id||step.isNew&&s.isNew===step.isNew?{id:step.id,isNew:step.isNew,...newStep}:s)))&&void 0!==_stepsValue$map?_stepsValue$map:[])}},index)}))}),Object(jsx_runtime.jsx)(col.a,{span:24,md:12,children:Object(jsx_runtime.jsx)("div",{className:"match-group-add-skeleton",onClick:()=>{onChange([...action.steps||[],{isNew:Object(utils.Ob)()}])},children:Object(jsx_runtime.jsx)(icons.tc,{style:{fontSize:28,color:"#666666"}})})})]})}})]}),Object(jsx_runtime.jsxs)("div",{className:"my-8",children:[Object(jsx_runtime.jsx)(Field.a,{name:"post_to_slack",children:_ref7=>{let{value:value,onChange:onChange}=_ref7;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LemonCheckbox.a,{id:"webhook-checkbox",checked:!!value,onChange:onChange,disabled:!slackEnabled,label:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Post to webhook when this action is triggered."})}),Object(jsx_runtime.jsx)("p",{className:"pl-7",children:Object(jsx_runtime.jsxs)(Link.a,{to:"/project/settings#webhook",children:[slackEnabled?"Configure":"Enable"," this integration in Project Settings."]})})]})}}),action.post_to_slack&&Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsx)(Field.a,{name:"slack_message_format",children:_ref8=>{let{value:value,onChange:onChange}=_ref8;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LemonLabel.a,{showOptional:!0,children:"Message format"}),Object(jsx_runtime.jsx)(src.LemonTextArea,{placeholder:"Default: [action.name] triggered by [person]",value:value,onChange:onChange,disabled:!slackEnabled||!action.post_to_slack,"data-attr":"edit-slack-message-format"}),Object(jsx_runtime.jsx)("small",{children:Object(jsx_runtime.jsx)(Link.a,{to:"https://posthog.com/docs/integrate/webhooks/message-formatting",target:"_blank",children:"See documentation on how to format webhook messages."})})]})}})})]}),Object(jsx_runtime.jsxs)("div",{className:"flex justify-end gap-2",children:[id?deleteButton():cancelButton(),Object(jsx_runtime.jsx)(LemonButton.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:actionLoading,children:"Save"})]})]})})}try{ActionEdit.displayName="ActionEdit",ActionEdit.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:ActionEdit.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(__react_docgen_typescript_loader_error){}const actionLogic=Object(index_esm.kea)({props:{},key:props=>props.id||"new",path:key=>["scenes","actions","actionLogic",key],actions:()=>({checkIsFinished:action=>({action:action}),setPollTimeout:pollTimeout=>({pollTimeout:pollTimeout}),setIsComplete:isComplete=>({isComplete:isComplete})}),reducers:()=>({pollTimeout:[null,{setPollTimeout:(_,_ref)=>{let{pollTimeout:pollTimeout}=_ref;return pollTimeout}}],isComplete:[!1,{setIsComplete:(_,_ref2)=>{let{isComplete:isComplete}=_ref2;return isComplete}}]}),selectors:{breadcrumbs:[s=>[s.action],action=>[{name:"Data Management",path:urls.a.eventDefinitions()},{name:"Actions",path:urls.a.actions()},{name:(null==action?void 0:action.name)||"Unnamed",path:action?urls.a.action(action.id):void 0}]]},loaders:_ref3=>{let{actions:actions,props:props}=_ref3;return{action:{loadAction:async()=>{if(actions.setIsComplete(!1),!props.id)throw new Error("Cannot fetch an unsaved action from the API.");const action=await api.b.actions.get(props.id);return actions.checkIsFinished(action),action}}}},listeners:_ref4=>{let{actions:actions,values:values}=_ref4;return{checkIsFinished:_ref5=>{let{action:action}=_ref5;action.is_calculating?actions.setPollTimeout(setTimeout((()=>actions.loadAction()),1e3)):(actions.setIsComplete(new Date),values.pollTimeout&&clearTimeout(values.pollTimeout))}}},events:_ref6=>{let{values:values,actions:actions,props:props}=_ref6;return{afterMount:()=>{props.id&&actions.loadAction()},beforeUnmount:()=>{values.pollTimeout&&clearTimeout(values.pollTimeout)}}}});var Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),DataTable_utils=__webpack_require__("./frontend/src/queries/nodes/DataTable/utils.ts");const scene={logic:actionLogic,component:Action,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{id:parseInt(id)}}};function Action(){let{id:id}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{push:push}=Object(index_esm.useActions)(kea_router_lib.router),{action:action,isComplete:isComplete}=Object(index_esm.useValues)(actionLogic),{loadAction:loadAction}=Object(index_esm.useActions)(actionLogic);return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(!id||action)&&Object(jsx_runtime.jsx)(ActionEdit,{id:id,action:action,onSave:savedAction=>{id||push(urls.a.action(savedAction.id)),loadAction()}}),id&&(isComplete?Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(jsx_runtime.jsxs)("p",{children:["This is the list of ",Object(jsx_runtime.jsx)("strong",{children:"recent"})," events that match this action."]}),Object(jsx_runtime.jsx)("div",{className:"pt-4 border-t"}),Object(jsx_runtime.jsx)(Query.a,{query:{kind:schema.a.DataTableNode,source:{kind:schema.a.EventsQuery,select:Object(DataTable_utils.a)(schema.a.EventsQuery),actionId:id},full:!0,showEventFilter:!1,showPropertyFilter:!1}})]}):Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(jsx_runtime.jsxs)("div",{className:"flex items-center",children:[Object(jsx_runtime.jsx)(Spinner.a,{className:"mr-4"}),"Calculating action, please hold on."]})]}))]})}try{Action.displayName="Action",Action.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:Action.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(__react_docgen_typescript_loader_error){}}}]);