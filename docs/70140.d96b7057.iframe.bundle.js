"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[70140],{"../../frontend/src/lib/components/IframedToolbarBrowser/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{PJ:()=>heatmapDateOptions,TH:()=>PostHogAppToolbarEvent,_f:()=>DEFAULT_HEATMAP_FILTERS,f6:()=>calculateViewportRange});var lib_components_DateFilter_types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/lib/components/DateFilter/types.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/utils.tsx");let PostHogAppToolbarEvent=function(PostHogAppToolbarEvent){return PostHogAppToolbarEvent.PH_TOOLBAR_INIT="ph-toolbar-init",PostHogAppToolbarEvent.PH_TOOLBAR_READY="ph-toolbar-ready",PostHogAppToolbarEvent.PH_APP_INIT="ph-app-init",PostHogAppToolbarEvent.PH_ELEMENT_SELECTOR="ph-element-selector",PostHogAppToolbarEvent.PH_NEW_ACTION_NAME="ph-new-action-name",PostHogAppToolbarEvent.PH_NEW_ACTION_CREATED="ph-new-action-created",PostHogAppToolbarEvent.PH_TOOLBAR_NAVIGATED="ph-toolbar-navigated",PostHogAppToolbarEvent}({}),DEFAULT_HEATMAP_FILTERS={enabled:!0,type:"click",viewportAccuracy:.9,aggregation:"total_count"},calculateViewportRange=(heatmapFilters,windowWidth)=>{var _heatmapFilters$viewp;let extraPixels=windowWidth-windowWidth*(null!==(_heatmapFilters$viewp=heatmapFilters.viewportAccuracy)&&void 0!==_heatmapFilters$viewp?_heatmapFilters$viewp:.2);return{min:Math.round(Math.max(0,windowWidth-extraPixels)),max:Math.round(windowWidth+extraPixels)}},dateItemDenyList=["Last 180 days","This month","Previous month","Year to date","All time"],heatmapDateOptions=lib_utils__WEBPACK_IMPORTED_MODULE_1__.bE.filter(dm=>dm.key!==lib_components_DateFilter_types__WEBPACK_IMPORTED_MODULE_0__.Q2&&!dateItemDenyList.includes(dm.key))},"../../frontend/src/lib/components/heatmaps/HeatmapCanvas.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>HeatmapCanvas});var heatmap_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/heatmap.js@2.0.5_patch_hash=gydrxrztd4ruyhouu6tu7zh43e/node_modules/heatmap.js/build/heatmap.js"),heatmap_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(heatmap_js__WEBPACK_IMPORTED_MODULE_0__),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/components/heatmaps/heatmapDataLogic.ts"),lib_components_heatmaps_useShiftKeyPressed__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/components/heatmaps/useShiftKeyPressed.ts"),lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),_ScrollDepthCanvas__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/components/heatmaps/ScrollDepthCanvas.tsx"),_useMousePosition__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/components/heatmaps/useMousePosition.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function HeatmapMouseInfo(_ref){let{heatmapJsRef,containerRef,context}=_ref,shiftPressed=(0,lib_components_heatmaps_useShiftKeyPressed__WEBPACK_IMPORTED_MODULE_4__.u)(),{heatmapTooltipLabel}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)((0,lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_3__.y)({context})),mousePosition=(0,_useMousePosition__WEBPACK_IMPORTED_MODULE_6__.k)(containerRef?.current),value=heatmapJsRef.current?.getValueAt(mousePosition);if(!mousePosition||!value&&!shiftPressed)return null;let leftPosition=window.innerWidth-mousePosition.x<100;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:"absolute z-10",style:{top:mousePosition.y,left:mousePosition.x},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:"absolute border rounded bg-surface-primary shadow-md p-2 mx-2 -translate-y-1/2",style:{left:leftPosition?void 0:0,right:leftPosition?0:void 0},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("span",{className:"font-semibold whitespace-nowrap",children:[value," ",heatmapTooltipLabel]})})})}function HeatmapCanvas(_ref2){let{positioning="fixed",widthOverride,context,exportToken}=_ref2,{heatmapJsData,heatmapFilters,windowWidth,windowHeight,heatmapColorPalette,isReady}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)((0,lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_3__.y)({context,exportToken})),heatmapsJsRef=(0,react__WEBPACK_IMPORTED_MODULE_2__.useRef)(),heatmapsJsContainerRef=(0,react__WEBPACK_IMPORTED_MODULE_2__.useRef)(),heatmapJSColorGradient=(0,react__WEBPACK_IMPORTED_MODULE_2__.useMemo)(()=>{switch(heatmapColorPalette){case"blue":return{".0":"rgba(0, 0, 255, 0)",".100":"rgba(0, 0, 255, 1)"};case"green":return{".0":"rgba(0, 255, 0, 0)",".100":"rgba(0, 255, 0, 1)"};case"red":return{".0":"rgba(255, 0, 0, 0)",".100":"rgba(255, 0, 0, 1)"};default:return{".25":"rgb(0,0,255)","0.55":"rgb(0,255,0)","0.85":"yellow","1.0":"rgb(255,0,0)"}}},[heatmapColorPalette]),heatmapConfig={minOpacity:0,maxOpacity:.8},updateHeatmapData=(0,react__WEBPACK_IMPORTED_MODULE_2__.useCallback)(()=>{try{heatmapsJsRef.current?.setData(heatmapJsData)}catch(e){console.error("error setting data",e)}},[heatmapJsData]),setHeatmapContainer=(0,react__WEBPACK_IMPORTED_MODULE_2__.useCallback)(container=>{heatmapsJsContainerRef.current=container,container&&(heatmapsJsRef.current=heatmap_js__WEBPACK_IMPORTED_MODULE_0___default().create({...heatmapConfig,container,gradient:heatmapJSColorGradient}),updateHeatmapData())},[]);return((0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{updateHeatmapData()},[heatmapJsData]),(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{heatmapsJsContainerRef.current&&heatmapsJsRef.current?.configure({...heatmapConfig,container:heatmapsJsContainerRef.current,gradient:heatmapJSColorGradient})},[heatmapJSColorGradient]),heatmapFilters.enabled)?"scrolldepth"===heatmapFilters.type?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_ScrollDepthCanvas__WEBPACK_IMPORTED_MODULE_5__.YS,{positioning:positioning,context:context,exportToken:exportToken},`scrolldepth-${heatmapFilters.type}-${exportToken?"export":`${null!=widthOverride?widthOverride:windowWidth}x${windowHeight}`}`):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div",{className:(0,lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_8__.cn)("inset-0 overflow-hidden w-full h-full",positioning,isReady?"heatmaps-ready":"heatmaps-loading"),"data-attr":"heatmap-canvas",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("div",{className:"absolute inset-0",ref:setHeatmapContainer},exportToken?"export-heatmap":`${null!=widthOverride?widthOverride:windowWidth}x${windowHeight}`),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(HeatmapMouseInfo,{heatmapJsRef:heatmapsJsRef,containerRef:heatmapsJsContainerRef,context:context})]}):null}},"../../frontend/src/lib/components/heatmaps/ScrollDepthCanvas.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Jp:()=>scrollDepthColor,K_:()=>ScrollDepthMouseCanvas,YS:()=>ScrollDepthCanvas});var clsx__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/components/heatmaps/heatmapDataLogic.ts"),lib_components_heatmaps_useMousePosition__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/components/heatmaps/useMousePosition.ts"),lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scrollDepthColor=(count,maxCount,heatmapColorPalette)=>{if("default"===heatmapColorPalette){let hue=Math.round(260*Math.max(0,Math.min(1,1-count/maxCount)));return`hsl(${hue}, 100%, 50%)`}let rgba=[0,0,0,count/maxCount];switch(heatmapColorPalette){case"red":rgba[0]=255;break;case"green":rgba[1]=255;break;case"blue":rgba[2]=255}return`rgba(${rgba.join(", ")})`};function ScrollDepthMouseCanvas(_ref){let{mouseY,shiftPressed,rawHeatmapLoading,heatmapElements,percentage}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"absolute left-0 right-0 flex items-center z-10 -translate-y-1/2",style:{top:mouseY},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"border-b border-default w-full opacity-75"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:(0,clsx__WEBPACK_IMPORTED_MODULE_4__.default)("bg-default whitespace-nowrap text-white rounded p-2 font-semibold opacity-75 hover:opacity-100 transition-all",shiftPressed?"pointer-events-none":"pointer-events-auto"),children:rawHeatmapLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:"Loading..."}):heatmapElements.length?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[percentage.toPrecision(4),"% scrolled this far"]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:"No scroll data for the current dimension range"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"border-b border-default w-10 opacity-75"})]})}function ScrollDepthMouseInfo(_ref2){var _heatmapElements$0$co,_elementInMouseY$coun;let{context,exportToken}=_ref2,{heatmapElements,rawHeatmapLoading,heatmapScrollY}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)((0,lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_1__.y)({context,exportToken})),{y:mouseY}=(0,lib_components_heatmaps_useMousePosition__WEBPACK_IMPORTED_MODULE_2__.k)();if(!mouseY)return null;let iframe=document.getElementById("heatmap-iframe");if(!iframe)return null;let relativeMouseY=mouseY-iframe.getBoundingClientRect().top,adjustedMouseY=relativeMouseY<0?0:relativeMouseY,scrolledMouseY=adjustedMouseY+heatmapScrollY,elementInMouseY=heatmapElements.find((x,i)=>{var _heatmapElements$y;return scrolledMouseY>=(null!==(_heatmapElements$y=heatmapElements[i-1]?.y)&&void 0!==_heatmapElements$y?_heatmapElements$y:0)&&scrolledMouseY<x.y}),maxCount=null!==(_heatmapElements$0$co=heatmapElements[0]?.count)&&void 0!==_heatmapElements$0$co?_heatmapElements$0$co:0,percentage=(null!==(_elementInMouseY$coun=elementInMouseY?.count)&&void 0!==_elementInMouseY$coun?_elementInMouseY$coun:0)/maxCount*100;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(ScrollDepthMouseCanvas,{mouseY:adjustedMouseY,shiftPressed:!1,rawHeatmapLoading:rawHeatmapLoading,heatmapElements:heatmapElements,percentage:percentage})}function ScrollDepthCanvas(_ref3){var _heatmapElements$0$co2;let{positioning="fixed",context="in-app",exportToken}=_ref3,{heatmapElements,heatmapColorPalette,heatmapScrollY,isReady}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)((0,lib_components_heatmaps_heatmapDataLogic__WEBPACK_IMPORTED_MODULE_1__.y)({context,exportToken})),maxCount=null!==(_heatmapElements$0$co2=heatmapElements[0]?.count)&&void 0!==_heatmapElements$0$co2?_heatmapElements$0$co2:0;return heatmapElements.length?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:(0,lib_utils_css_classes__WEBPACK_IMPORTED_MODULE_5__.cn)("inset-0 overflow-hidden w-full h-full",positioning,isReady?"heatmaps-ready":"heatmaps-loading"),"data-attr":"scroll-depth-canvas",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"absolute top-0 left-0 right-0",style:{transform:`translateY(${-heatmapScrollY}px)`},children:heatmapElements.map((_ref4,i)=>{var _heatmapElements$y2,_heatmapElements$y3;let{y,count}=_ref4;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"absolute left-0 w-full opacity-50",style:{top:null!==(_heatmapElements$y2=heatmapElements[i-1]?.y)&&void 0!==_heatmapElements$y2?_heatmapElements$y2:0,height:y-(null!==(_heatmapElements$y3=heatmapElements[i-1]?.y)&&void 0!==_heatmapElements$y3?_heatmapElements$y3:0),backgroundColor:scrollDepthColor(count,maxCount,heatmapColorPalette)}},y)})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(ScrollDepthMouseInfo,{context:context,exportToken:exportToken})]}):null}},"../../frontend/src/lib/components/heatmaps/heatmapDataLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>HEATMAP_COLOR_PALETTE_OPTIONS,y:()=>heatmapDataLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.7_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),kea_window_values__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/kea-window-values@3.0.1_kea@3.1.7_react@18.2.0_/node_modules/kea-window-values/lib/index.js"),lib_components_IframedToolbarBrowser_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/components/IframedToolbarBrowser/utils.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/utils.tsx"),_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/toolbar/toolbarConfigLogic.ts");let HEATMAP_COLOR_PALETTE_OPTIONS=[{value:"default",label:"Default (multicolor)"},{value:"red",label:"Red (monocolor)"},{value:"green",label:"Green (monocolor)"},{value:"blue",label:"Blue (monocolor)"}],heatmapDataLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(key=>["lib","components","heatmap","heatmapDataLogic",key]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({context:"toolbar",exportToken:null}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.context),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadHeatmap:!0,setCommonFilters:filters=>({filters}),setHeatmapFilters:filters=>({filters}),patchHeatmapFilters:filters=>({filters}),setHeatmapFixedPositionMode:mode=>({mode}),setHeatmapColorPalette:Palette=>({Palette}),setHref:href=>({href}),setHrefMatchType:matchType=>({matchType}),setHeatmapScrollY:scrollY=>({scrollY}),setWindowWidthOverride:widthOverride=>({widthOverride}),setIsReady:isReady=>({isReady})}),(0,kea_window_values__WEBPACK_IMPORTED_MODULE_4__.windowValues)(()=>({windowWidth:window1=>window1.innerWidth,windowHeight:window1=>window1.innerHeight})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({hrefMatchType:["exact",{setHrefMatchType:(_,_ref)=>{let{matchType}=_ref;return matchType}}],commonFilters:[{date_from:"-7d"},{setCommonFilters:(_,_ref2)=>{let{filters}=_ref2;return filters}}],heatmapFilters:[lib_components_IframedToolbarBrowser_utils__WEBPACK_IMPORTED_MODULE_5__._f,{persist:!0},{setHeatmapFilters:(_,_ref3)=>{let{filters}=_ref3;return filters},patchHeatmapFilters:(state,_ref4)=>{let{filters}=_ref4;return{...state,...filters}}}],heatmapFixedPositionMode:["fixed",{setHeatmapFixedPositionMode:(_,_ref5)=>{let{mode}=_ref5;return mode}}],heatmapColorPalette:["default",{persist:!0},{setHeatmapColorPalette:(_,_ref6)=>{let{Palette}=_ref6;return Palette}}],href:[null,{setHref:(_,_ref7)=>{let{href}=_ref7;return href}}],heatmapScrollY:[0,{setHeatmapScrollY:(_,_ref8)=>{let{scrollY}=_ref8;return scrollY}}],windowWidthOverride:[null,{setWindowWidthOverride:(_,_ref9)=>{let{widthOverride}=_ref9;return widthOverride}}],isReady:[!1,{setIsReady:(_,_ref10)=>{let{isReady}=_ref10;return isReady}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref11=>{let{values,props,actions}=_ref11;return{rawHeatmap:[null,{resetHeatmapData:()=>({results:[]}),loadHeatmap:async(_,breakpoint)=>{if(await breakpoint(150),!values.href||!values.href.trim().length||!values.heatmapFilters.enabled)return null;actions.setIsReady(!1);let{date_from,date_to,filter_test_accounts}=values.commonFilters,{type,aggregation}=values.heatmapFilters,apiURL=`/api/heatmap/${(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.encodeParams)({type,date_from,date_to,url_exact:"exact"===values.hrefMatchType?values.href:void 0,url_pattern:"pattern"===values.hrefMatchType?values.href:void 0,viewport_width_min:values.viewportRange.min,viewport_width_max:values.viewportRange.max,aggregation,filter_test_accounts},"?")}`,response=await ("toolbar"===props.context?(0,_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_7__.O)(apiURL,"GET"):props.exportToken?fetch(apiURL,{headers:{Authorization:`Bearer ${props.exportToken}`}}):fetch(apiURL));if(breakpoint(),"toolbar"===props.context&&403===response.status&&_toolbar_toolbarConfigLogic__WEBPACK_IMPORTED_MODULE_7__.W.actions.authenticate(),200!==response.status)throw Error("API error");let data=await response.json();return actions.setIsReady(!0),data}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({dateRange:[s=>[s.commonFilters],commonFilters=>(0,lib_utils__WEBPACK_IMPORTED_MODULE_6__.Kl)(commonFilters.date_from,commonFilters.date_to,"Last 7 days")],heatmapElements:[s=>[s.rawHeatmap],rawHeatmap=>{if(!rawHeatmap)return[];let elements=[];return rawHeatmap?.results.forEach(element=>{"scroll_depth_bucket"in element?elements.push({count:element.cumulative_count,xPercentage:0,targetFixed:!1,y:element.scroll_depth_bucket}):elements.push({count:element.count,xPercentage:element.pointer_relative_x,targetFixed:element.pointer_target_fixed,y:element.pointer_y})}),elements}],viewportRange:[s=>[s.heatmapFilters,s.windowWidth,s.windowWidthOverride],(heatmapFilters,windowWidth,windowWidthOverride)=>(0,lib_components_IframedToolbarBrowser_utils__WEBPACK_IMPORTED_MODULE_5__.f6)(heatmapFilters,null!=windowWidthOverride?windowWidthOverride:windowWidth)],heatmapTooltipLabel:[s=>[s.heatmapFilters],heatmapFilters=>"unique_visitors"===heatmapFilters.aggregation?"visitors":heatmapFilters.type+"s"],heatmapEmpty:[s=>[s.rawHeatmap,s.rawHeatmapLoading],(rawHeatmap,rawHeatmapLoading)=>rawHeatmap?.results.length===0&&!rawHeatmapLoading],heatmapJsData:[s=>[s.heatmapElements,s.heatmapScrollY,s.windowWidth,s.windowWidthOverride,s.heatmapFixedPositionMode],(heatmapElements,heatmapScrollY,windowWidth,windowWidthOverride,heatmapFixedPositionMode)=>{let width=null!=windowWidthOverride?windowWidthOverride:windowWidth,data=heatmapElements.reduce((acc,element)=>{if("hidden"===heatmapFixedPositionMode&&element.targetFixed)return acc;let y=Math.round(element.targetFixed&&"fixed"===heatmapFixedPositionMode?element.y:element.y-heatmapScrollY),x=Math.round(element.xPercentage*width);return acc.push({x,y,value:element.count}),acc},[]);return{min:0,max:data.reduce((max,_ref12)=>{let{value}=_ref12;return Math.max(max,value)},0),data}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref13=>{let{actions}=_ref13;return{setCommonFilters:()=>{actions.loadHeatmap()},setHeatmapFilters:()=>{actions.loadHeatmap()},patchHeatmapFilters:()=>{actions.loadHeatmap()},setHeatmapFixedPositionMode:()=>{actions.loadHeatmap()},setHeatmapColorPalette:()=>{actions.loadHeatmap()},setHref:()=>{actions.loadHeatmap()},setWindowWidthOverride:()=>{actions.loadHeatmap()}}}),(0,kea_subscriptions__WEBPACK_IMPORTED_MODULE_3__.Vt)(_ref14=>{let{actions}=_ref14;return{windowWidth:()=>{actions.loadHeatmap()},windowHeight:()=>{actions.loadHeatmap()}}})])},"../../frontend/src/lib/components/heatmaps/useMousePosition.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>useMousePosition});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");let useMousePosition=container=>{let[mousePosition,setMousePosition]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({x:0,y:0});return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{let onMove=e=>{let rect=container?container.getBoundingClientRect():{left:0,top:0},newX=e.clientX-rect.left,newY=e.clientY-rect.top,inBounds=newX>=0&&newY>=0;setMousePosition(prev=>{let hasChanged=newX!==prev.x||newY!==prev.y;return inBounds&&hasChanged?{x:newX,y:newY}:prev})};return window.addEventListener("mousemove",onMove,{passive:!0}),()=>{window.removeEventListener("mousemove",onMove)}},[container]),mousePosition}},"../../frontend/src/lib/components/heatmaps/useShiftKeyPressed.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{u:()=>useShiftKeyPressed});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib_hooks_useOnMountEffect__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/hooks/useOnMountEffect.ts");function useShiftKeyPressed(){let[isShiftPressed,setIsShiftPressed]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1);return(0,lib_hooks_useOnMountEffect__WEBPACK_IMPORTED_MODULE_1__.x)(()=>{let handleKeyDown=event=>{"Shift"===event.key&&setIsShiftPressed(!0)},handleKeyUp=event=>{"Shift"===event.key&&setIsShiftPressed(!1)};return window.addEventListener("keydown",handleKeyDown,{passive:!0}),window.addEventListener("keyup",handleKeyUp,{passive:!0}),()=>{window.removeEventListener("keydown",handleKeyDown),window.removeEventListener("keyup",handleKeyUp)}}),isShiftPressed}}}]);