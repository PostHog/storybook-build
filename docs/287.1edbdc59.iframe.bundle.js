(window.webpackJsonp=window.webpackJsonp||[]).push([[287],{"./frontend/src/scenes/experiments/Experiment.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Experiment",(function(){return Experiment_Experiment}));var skeleton=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/skeleton/index.js"),col=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/col/index.js"),row=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/row/index.js"),tooltip=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tooltip/index.js"),card=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/card/index.js"),tag=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tag/index.js"),popconfirm=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/popconfirm/index.js"),progress=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/progress/index.js"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),PropertyFilters=__webpack_require__("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),utils=__webpack_require__("./frontend/src/lib/components/PropertyFilters/utils.ts"),types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),funnelLogic=__webpack_require__("./frontend/src/scenes/funnels/funnelLogic.ts"),ActionFilter=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),insightLogic=__webpack_require__("./frontend/src/scenes/insights/insightLogic.ts"),src_types=__webpack_require__("./frontend/src/types.ts"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@4.46.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Experiment=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss"),Experiment_default=__webpack_require__.n(Experiment),options={insert:"head",singleton:!1},api=(injectStylesIntoStyleTag_default()(Experiment_default.a,options),Experiment_default.a.locals,__webpack_require__("./frontend/src/lib/api.ts")),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),cleanFilters=__webpack_require__("./frontend/src/scenes/insights/utils/cleanFilters.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),experimentsLogic=__webpack_require__("./frontend/src/scenes/experiments/experimentsLogic.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),trendsLogic=__webpack_require__("./frontend/src/scenes/trends/trendsLogic.ts"),eventUsageLogic=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip.tsx"),groupsModel=__webpack_require__("./frontend/src/models/groupsModel.ts"),lemonToast=__webpack_require__("./frontend/src/lib/lemon-ui/lemonToast.tsx"),lib_utils=__webpack_require__("./frontend/src/lib/utils.tsx"),kea_forms_lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const NEW_EXPERIMENT={id:"new",name:"",feature_flag_key:"",filters:{},parameters:{feature_flag_variants:[{key:"control",rollout_percentage:50},{key:"test",rollout_percentage:50}]},secondary_metrics:[],created_at:null,created_by:null,updated_at:null},experimentLogic=Object(index_esm.kea)([Object(index_esm.props)({}),Object(index_esm.key)((props=>props.experimentId||"new")),Object(index_esm.path)((key=>["scenes","experiment","experimentLogic",key])),Object(index_esm.connect)({values:[teamLogic.a,["currentTeamId"],groupsModel.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]],actions:[experimentsLogic.a,["updateExperiments","addToExperiments"],eventUsageLogic.e,["reportExperimentCreated","reportExperimentViewed","reportExperimentLaunched","reportExperimentCompleted","reportExperimentArchived","reportExperimentReset"]]}),Object(index_esm.actions)({setExperiment:experiment=>({experiment:experiment}),createExperiment:(draft,runningTime,sampleSize)=>({draft:draft,runningTime:runningTime,sampleSize:sampleSize}),setExperimentInsightId:shortId=>({shortId:shortId}),createNewExperimentInsight:filters=>({filters:filters}),setFilters:filters=>({filters:filters}),removeExperimentGroup:idx=>({idx:idx}),setEditExperiment:editing=>({editing:editing}),setExperimentResultCalculationError:error=>({error:error}),setFlagImplementationWarning:warning=>({warning:warning}),setFlagAvailabilityWarning:warning=>({warning:warning}),setExposureAndSampleSize:(exposure,sampleSize)=>({exposure:exposure,sampleSize:sampleSize}),updateExperimentGoal:filters=>({filters:filters}),updateExperimentSecondaryMetrics:metrics=>({metrics:metrics}),launchExperiment:!0,endExperiment:!0,addExperimentGroup:!0,archiveExperiment:!0,resetRunningExperiment:!0,checkFlagImplementationWarning:!0,checkFlagAvailabilityWarning:!0,openExperimentGoalModal:!0,closeExperimentGoalModal:!0}),Object(index_esm.reducers)({experiment:[{...NEW_EXPERIMENT},{setExperiment:(state,_ref)=>{let{experiment:experiment}=_ref;if(experiment.filters){const newFilters={...state.filters,...experiment.filters};return{...state,...experiment,filters:newFilters}}if(experiment.parameters){const newParameters={...null==state?void 0:state.parameters,...experiment.parameters};return{...state,...experiment,parameters:newParameters}}return{...state,...experiment}},addExperimentGroup:state=>{var _state$parameters;if(null!=state&&null!==(_state$parameters=state.parameters)&&void 0!==_state$parameters&&_state$parameters.feature_flag_variants){const newRolloutPercentages=percentageDistribution(state.parameters.feature_flag_variants.length+1),updatedRolloutPercentageVariants=state.parameters.feature_flag_variants.map(((variant,i)=>({...variant,rollout_percentage:newRolloutPercentages[i]})));return{...state,parameters:{...state.parameters,feature_flag_variants:[...updatedRolloutPercentageVariants,{key:`test_group_${state.parameters.feature_flag_variants.length}`,rollout_percentage:newRolloutPercentages[newRolloutPercentages.length-1]}]}}}return state},removeExperimentGroup:(state,_ref2)=>{var _state$parameters2,_state$parameters3;let{idx:idx}=_ref2;if(!state)return state;const variants=[...(null===(_state$parameters2=state.parameters)||void 0===_state$parameters2?void 0:_state$parameters2.feature_flag_variants)||[]];variants.splice(idx,1);const newRolloutPercentages=percentageDistribution(((null==state||null===(_state$parameters3=state.parameters)||void 0===_state$parameters3?void 0:_state$parameters3.feature_flag_variants)||[]).length-1),updatedVariants=variants.map(((variant,i)=>({...variant,rollout_percentage:newRolloutPercentages[i]})));return{...state,parameters:{...state.parameters,feature_flag_variants:updatedVariants}}}}],experimentInsightId:[null,{setExperimentInsightId:(_,_ref3)=>{let{shortId:shortId}=_ref3;return shortId}}],editingExistingExperiment:[!1,{setEditExperiment:(_,_ref4)=>{let{editing:editing}=_ref4;return editing}}],changingGoalMetric:[!1,{updateExperimentGoal:()=>!0,loadExperimentResults:()=>!1}],changingSecondaryMetrics:[!1,{updateExperimentSecondaryMetrics:()=>!0,loadSecondaryMetricResults:()=>!1}],experimentResultCalculationError:[null,{setExperimentResultCalculationError:(_,_ref5)=>{let{error:error}=_ref5;return error}}],flagImplementationWarning:[!1,{setFlagImplementationWarning:(_,_ref6)=>{let{warning:warning}=_ref6;return warning}}],flagAvailabilityWarning:[!1,{setFlagAvailabilityWarning:(_,_ref7)=>{let{warning:warning}=_ref7;return warning}}],exposureAndSampleSize:[{exposure:0,sampleSize:0},{setExposureAndSampleSize:(_,_ref8)=>{let{exposure:exposure,sampleSize:sampleSize}=_ref8;return{exposure:exposure,sampleSize:sampleSize}}}],isExperimentGoalModalOpen:[!1,{openExperimentGoalModal:()=>!0,closeExperimentGoalModal:()=>!1}]}),Object(index_esm.listeners)((_ref9=>{let{values:values,actions:actions}=_ref9;return{createExperiment:async _ref10=>{var _response2;let{draft:draft,runningTime:runningTime,sampleSize:sampleSize}=_ref10,response=null;const isUpdate=!!values.experimentId&&"new"!==values.experimentId;try{var _values$experiment,_response,_values$experiment2;if(isUpdate){if(response=await api.b.update(`api/projects/${values.currentTeamId}/experiments/${values.experimentId}`,{...values.experiment,parameters:{...null===(_values$experiment=values.experiment)||void 0===_values$experiment?void 0:_values$experiment.parameters,recommended_running_time:runningTime,recommended_sample_size:sampleSize},...!draft&&{start_date:Object(dayjs.a)()}}),null!==(_response=response)&&void 0!==_response&&_response.id)return actions.updateExperiments(response),actions.setEditExperiment(!1),void actions.setExperiment(response)}else response=await api.b.create(`api/projects/${values.currentTeamId}/experiments`,{...values.experiment,parameters:{...null===(_values$experiment2=values.experiment)||void 0===_values$experiment2?void 0:_values$experiment2.parameters,recommended_running_time:runningTime,recommended_sample_size:sampleSize},...!draft&&{start_date:Object(dayjs.a)()}}),response&&actions.reportExperimentCreated(response)}catch(error){return void lemonToast.d.error(error.detail||"Failed to create experiment")}if(null!==(_response2=response)&&void 0!==_response2&&_response2.id){const experimentId=response.id;lib.router.actions.push(urls.a.experiment(experimentId)),actions.addToExperiments(response),lemonToast.d.success("Experiment "+(isUpdate?"updated":"created"),{button:{label:"View it",action:()=>{lib.router.actions.push(urls.a.experiment(experimentId))}}})}},createNewExperimentInsight:async _ref11=>{let newInsightFilters,{filters:filters}=_ref11;newInsightFilters=(null==filters?void 0:filters.insight)===src_types.F.FUNNELS?Object(cleanFilters.a)({insight:src_types.F.FUNNELS,funnel_viz_type:src_types.B.Steps,date_from:Object(dayjs.a)().subtract(14,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(dayjs.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:constants.k.horizontal,...filters}):Object(cleanFilters.a)({insight:src_types.F.TRENDS,date_from:Object(dayjs.a)().subtract(14,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(dayjs.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),...filters});const newInsight={name:"",description:"",tags:[],filters:newInsightFilters,result:null},createdInsight=await api.b.create(`api/projects/${values.currentTeamId}/insights`,newInsight);actions.setExperimentInsightId(createdInsight.short_id),actions.setExperiment({filters:{...newInsight.filters}})},setFilters:_ref12=>{let{filters:filters}=_ref12;var _funnelLogic$findMoun,_trendsLogic$findMoun;values.experimentInsightType===src_types.F.FUNNELS?null===(_funnelLogic$findMoun=funnelLogic.a.findMounted({dashboardItemId:values.experimentInsightId}))||void 0===_funnelLogic$findMoun||_funnelLogic$findMoun.actions.setFilters(filters):null===(_trendsLogic$findMoun=trendsLogic.a.findMounted({dashboardItemId:values.experimentInsightId}))||void 0===_trendsLogic$findMoun||_trendsLogic$findMoun.actions.setFilters(filters)},loadExperimentSuccess:async _ref13=>{let{experiment:experiment}=_ref13;experiment&&actions.reportExperimentViewed(experiment),null!=experiment&&experiment.start_date?(actions.loadExperimentResults(),actions.loadSecondaryMetricResults()):actions.createNewExperimentInsight(null==experiment?void 0:experiment.filters)},launchExperiment:async()=>{const startDate=Object(dayjs.a)();actions.updateExperiment({start_date:startDate.toISOString()}),values.experiment&&eventUsageLogic.e.actions.reportExperimentLaunched(values.experiment,startDate)},endExperiment:async()=>{var _values$experiment3;const endDate=Object(dayjs.a)();actions.updateExperiment({end_date:endDate.toISOString()});const duration=endDate.diff(null===(_values$experiment3=values.experiment)||void 0===_values$experiment3?void 0:_values$experiment3.start_date,"second");values.experiment&&actions.reportExperimentCompleted(values.experiment,endDate,duration,values.areResultsSignificant)},archiveExperiment:async()=>{actions.updateExperiment({archived:!0}),values.experiment&&actions.reportExperimentArchived(values.experiment)},updateExperimentGoal:async _ref14=>{let{filters:filters}=_ref14;const filtersToUpdate={...filters};delete filtersToUpdate.properties,actions.updateExperiment({filters:filtersToUpdate}),actions.closeExperimentGoalModal()},updateExperimentSecondaryMetrics:async _ref15=>{let{metrics:metrics}=_ref15;actions.updateExperiment({secondary_metrics:metrics})},closeExperimentGoalModal:()=>{values.experimentChanged&&actions.loadExperiment()},resetRunningExperiment:async()=>{actions.updateExperiment({start_date:null,end_date:null}),values.experiment&&actions.reportExperimentReset(values.experiment),actions.loadExperimentResultsSuccess(null),actions.loadSecondaryMetricResultsSuccess([])},updateExperimentSuccess:async _ref16=>{let{experiment:experiment}=_ref16;actions.updateExperiments(experiment),values.changingGoalMetric&&actions.loadExperimentResults(),values.changingSecondaryMetrics&&actions.loadSecondaryMetricResults()},setExperiment:async _ref17=>{var _experiment$filters,_experiment$filters2;let{experiment:experiment}=_ref17;const experimentEntitiesChanged=(null===(_experiment$filters=experiment.filters)||void 0===_experiment$filters?void 0:_experiment$filters.events)&&experiment.filters.events.length>0||(null===(_experiment$filters2=experiment.filters)||void 0===_experiment$filters2?void 0:_experiment$filters2.actions)&&experiment.filters.actions.length>0;experiment.filters&&0!==Object.keys(experiment.filters).length&&(experimentEntitiesChanged&&actions.checkFlagImplementationWarning(),actions.checkFlagAvailabilityWarning())},setExperimentValue:async(_ref18,breakpoint)=>{let{name:name,value:value}=_ref18;if(await breakpoint(100),"filters"===name){const experimentEntitiesChanged=(null==value?void 0:value.events)&&value.events.length>0||(null==value?void 0:value.actions)&&value.actions.length>0;if(!value||0===Object.keys(value).length)return;experimentEntitiesChanged&&actions.checkFlagImplementationWarning(),actions.checkFlagAvailabilityWarning()}},setExperimentValues:async(_ref19,breakpoint)=>{var _experiment$filters3,_experiment$filters4;let{values:values}=_ref19;await breakpoint(100);const experiment=values,experimentEntitiesChanged=(null===(_experiment$filters3=experiment.filters)||void 0===_experiment$filters3?void 0:_experiment$filters3.events)&&experiment.filters.events.length>0||(null===(_experiment$filters4=experiment.filters)||void 0===_experiment$filters4?void 0:_experiment$filters4.actions)&&experiment.filters.actions.length>0;experiment.filters&&0!==Object.keys(experiment.filters).length&&(experimentEntitiesChanged&&actions.checkFlagImplementationWarning(),actions.checkFlagAvailabilityWarning())},checkFlagImplementationWarning:async(_,breakpoint)=>{var _experiment$filters5,_experiment$filters6;const experiment=values.experiment,experimentEntitiesChanged=(null===(_experiment$filters5=experiment.filters)||void 0===_experiment$filters5?void 0:_experiment$filters5.events)&&experiment.filters.events.length>0||(null===(_experiment$filters6=experiment.filters)||void 0===_experiment$filters6?void 0:_experiment$filters6.actions)&&experiment.filters.actions.length>0;if(experiment.filters&&0!==Object.keys(experiment.filters).length&&experimentEntitiesChanged){const url=`/api/projects/${values.currentTeamId}/experiments/requires_flag_implementation?${Object(lib_utils.Kb)(experiment.filters||{})}`;await breakpoint(100);try{const response=await api.b.get(url);actions.setFlagImplementationWarning(response.result)}catch(e){actions.setFlagImplementationWarning(!1)}}},checkFlagAvailabilityWarning:async()=>{var _values$experiment$fi;if(null!==(_values$experiment$fi=values.experiment.filters)&&void 0!==_values$experiment$fi&&_values$experiment$fi.properties){const targetProperties=Object(lib_utils.r)(values.experiment.filters.properties)||[];if(targetProperties.length>0){const hasNonInstantProperty=!!targetProperties.find((property=>"cohort"===property.type||!constants.l.includes(property.key||"")));actions.setFlagAvailabilityWarning(hasNonInstantProperty)}else actions.setFlagAvailabilityWarning(!1)}},openExperimentGoalModal:async()=>{var _values$experiment4;actions.createNewExperimentInsight(null===(_values$experiment4=values.experiment)||void 0===_values$experiment4?void 0:_values$experiment4.filters)}}})),Object(kea_loaders_lib.loaders)((_ref20=>{let{actions:actions,props:props,values:values}=_ref20;return{experiment:{loadExperiment:async()=>{if(props.experimentId&&"new"!==props.experimentId)try{return await api.b.get(`api/projects/${values.currentTeamId}/experiments/${props.experimentId}`)}catch(error){throw 404===error.status?error:(lemonToast.d.error(`Failed to load experiment ${props.experimentId}`),new Error(`Failed to load experiment ${props.experimentId}`))}return NEW_EXPERIMENT},updateExperiment:async update=>await api.b.update(`api/projects/${values.currentTeamId}/experiments/${values.experimentId}`,update)},experimentResults:[null,{loadExperimentResults:async()=>{try{return{...(await api.b.get(`api/projects/${values.currentTeamId}/experiments/${values.experimentId}/results`)).result,fakeInsightId:Math.random().toString(36).substring(2,15)}}catch(error){return actions.setExperimentResultCalculationError(error.detail),null}}}],secondaryMetricResults:[null,{loadSecondaryMetricResults:async()=>{var _values$experiment5;return await Promise.all(((null===(_values$experiment5=values.experiment)||void 0===_values$experiment5?void 0:_values$experiment5.secondary_metrics)||[]).map((async(_,index)=>{try{return(await api.b.get(`api/projects/${values.currentTeamId}/experiments/${values.experimentId}/secondary_results?id=${index}`)).result}catch(error){return{}}})))}}]}})),Object(index_esm.selectors)({props:[()=>[(_,props)=>props],props=>props],experimentId:[()=>[(_,props)=>{var _props$experimentId;return null!==(_props$experimentId=props.experimentId)&&void 0!==_props$experimentId?_props$experimentId:"new"}],experimentId=>experimentId],experimentInsightType:[s=>[s.experiment],experiment=>{var _experiment$filters7;return(null==experiment||null===(_experiment$filters7=experiment.filters)||void 0===_experiment$filters7?void 0:_experiment$filters7.insight)||src_types.F.TRENDS}],isExperimentRunning:[s=>[s.experiment],experiment=>!(null==experiment||!experiment.start_date)],breadcrumbs:[s=>[s.experiment,s.experimentId],(experiment,experimentId)=>[{name:"Experiments",path:urls.a.experiments()},{name:(null==experiment?void 0:experiment.name)||"New",path:urls.a.experiment(experimentId||"new")}]],variants:[s=>[s.experiment],experiment=>{var _experiment$parameter;return(null==experiment||null===(_experiment$parameter=experiment.parameters)||void 0===_experiment$parameter?void 0:_experiment$parameter.feature_flag_variants)||[]}],taxonomicGroupTypesForSelection:[s=>[s.experiment,s.groupsTaxonomicTypes],(newexperiment,groupsTaxonomicTypes)=>{var _newexperiment$filter;return null!=(null==newexperiment||null===(_newexperiment$filter=newexperiment.filters)||void 0===_newexperiment$filter?void 0:_newexperiment$filter.aggregation_group_type_index)&&groupsTaxonomicTypes.length>0?[groupsTaxonomicTypes[newexperiment.filters.aggregation_group_type_index]]:[types.a.PersonProperties,types.a.Cohorts]}],minimumDetectableChange:[s=>[s.experiment],newexperiment=>{var _newexperiment$parame;return(null==newexperiment||null===(_newexperiment$parame=newexperiment.parameters)||void 0===_newexperiment$parame?void 0:_newexperiment$parame.minimum_detectable_effect)||5}],minimumSampleSizePerVariant:[s=>[s.minimumDetectableChange],mde=>conversionRate=>Math.ceil(1600*conversionRate*(1-conversionRate/100)/(mde*mde))],areResultsSignificant:[s=>[s.experimentResults],experimentResults=>(null==experimentResults?void 0:experimentResults.significant)||!1],significanceBannerDetails:[s=>[s.experimentResults],experimentResults=>{var _ref21,_experimentResults$p_;return(null==experimentResults?void 0:experimentResults.significance_code)===src_types.bb.HighLoss?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["This is because the expected loss in conversion is greater than 1%",Object(jsx_runtime.jsx)(Tooltip.a,{placement:"right",title:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Current value is ",null===(_ref21=100*((null==experimentResults?void 0:experimentResults.expected_loss)||0))||void 0===_ref21?void 0:_ref21.toFixed(2),"%"]}),children:Object(jsx_runtime.jsx)(icons.xb,{className:"ml-1 text-muted text-xl"})}),"."]}):(null==experimentResults?void 0:experimentResults.significance_code)===src_types.bb.HighPValue?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["This is because the p value is greater than 0.05",Object(jsx_runtime.jsx)(Tooltip.a,{placement:"right",title:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Current value is ",(null==experimentResults||null===(_experimentResults$p_=experimentResults.p_value)||void 0===_experimentResults$p_?void 0:_experimentResults$p_.toFixed(3))||1,"."]}),children:Object(jsx_runtime.jsx)(icons.xb,{className:"ml-1 text-muted text-xl"})}),"."]}):(null==experimentResults?void 0:experimentResults.significance_code)===src_types.bb.LowWinProbability?"This is because the win probability of all test variants combined is less than 90%.":(null==experimentResults?void 0:experimentResults.significance_code)===src_types.bb.NotEnoughExposure?"This is because we need at least 100 people per variant to declare significance.":""}],recommendedExposureForCountData:[s=>[s.minimumDetectableChange],mde=>baseCountData=>{const lambda1=baseCountData,lambda2=baseCountData*mde/100+baseCountData;return parseFloat((4/Math.pow(Math.sqrt(lambda1/14)-Math.sqrt(lambda2/14),2)).toFixed(1))}],expectedRunningTime:[()=>[],()=>function(entrants,sampleSize){let duration=arguments.length>2&&void 0!==arguments[2]?arguments[2]:14;return parseFloat((sampleSize/(entrants/duration)).toFixed(1))}],conversionRateForVariant:[s=>[s.experimentResults],experimentResults=>variant=>{if(!experimentResults)return"--";const variantResults=(null==experimentResults?void 0:experimentResults.insight).find((variantFunnel=>{var _variantFunnel$,_variantFunnel$$break;return(null===(_variantFunnel$=variantFunnel[0])||void 0===_variantFunnel$||null===(_variantFunnel$$break=_variantFunnel$.breakdown_value)||void 0===_variantFunnel$$break?void 0:_variantFunnel$$break[0])===variant}));return variantResults?(variantResults[variantResults.length-1].count/variantResults[0].count*100).toFixed(1):"--"}],getIndexForVariant:[s=>[s.experimentResults],experimentResults=>(variant,insightType)=>{let result;if(experimentResults){let index=-1;index=insightType===src_types.F.FUNNELS?[...null==experimentResults?void 0:experimentResults.insight].sort(((a,b)=>{var _b$,_a$;return(null===(_b$=b[0])||void 0===_b$?void 0:_b$.count)-(null===(_a$=a[0])||void 0===_a$?void 0:_a$.count)})).findIndex((variantFunnel=>{var _variantFunnel$2,_variantFunnel$2$brea;return(null===(_variantFunnel$2=variantFunnel[0])||void 0===_variantFunnel$2||null===(_variantFunnel$2$brea=_variantFunnel$2.breakdown_value)||void 0===_variantFunnel$2$brea?void 0:_variantFunnel$2$brea[0])===variant})):(null==experimentResults?void 0:experimentResults.insight).findIndex((variantTrend=>variantTrend.breakdown_value===variant)),result=-1===index?0:index}else result=0;return insightType===src_types.F.FUNNELS&&result++,result}],countDataForVariant:[s=>[s.experimentResults],experimentResults=>variant=>{if(!experimentResults)return"--";const variantResults=experimentResults.insight.find((variantTrend=>variantTrend.breakdown_value===variant));return variantResults?variantResults.count.toString():"--"}],highestProbabilityVariant:[s=>[s.experimentResults],experimentResults=>{if(experimentResults){const maxValue=Math.max(...Object.values(experimentResults.probability));return Object.keys(experimentResults.probability).find((key=>Math.abs(experimentResults.probability[key]-maxValue)<Number.EPSILON))}}],areTrendResultsConfusing:[s=>[s.experimentResults,s.highestProbabilityVariant],(experimentResults,highestProbabilityVariant)=>{if(!experimentResults)return!1;const variantResults=(null==experimentResults?void 0:experimentResults.insight).reduce(((bestVariant,currentVariant)=>currentVariant.count>bestVariant.count?currentVariant:bestVariant),{count:0,breakdown_value:""});return!!variantResults.count&&variantResults.breakdown_value!==highestProbabilityVariant}],sortedExperimentResultVariants:[s=>[s.experimentResults,s.experiment],(experimentResults,experiment)=>{if(experimentResults){var _experiment$parameter2,_experiment$parameter3;const sortedResults=Object.keys(experimentResults.probability).sort(((a,b)=>experimentResults.probability[b]-experimentResults.probability[a]));return null==experiment||null===(_experiment$parameter2=experiment.parameters)||void 0===_experiment$parameter2||null===(_experiment$parameter3=_experiment$parameter2.feature_flag_variants)||void 0===_experiment$parameter3||_experiment$parameter3.forEach((variant=>{sortedResults.includes(variant.key)||sortedResults.push(variant.key)})),sortedResults}return[]}],tabularSecondaryMetricResults:[s=>[s.experiment,s.secondaryMetricResults],(experiment,secondaryMetricResults)=>{var _experiment$parameter4,_experiment$parameter5;const variantsWithResults=[];return null==experiment||null===(_experiment$parameter4=experiment.parameters)||void 0===_experiment$parameter4||null===(_experiment$parameter5=_experiment$parameter4.feature_flag_variants)||void 0===_experiment$parameter5||_experiment$parameter5.forEach((variant=>{var _experiment$secondary;const metricResults=[];null==experiment||null===(_experiment$secondary=experiment.secondary_metrics)||void 0===_experiment$secondary||_experiment$secondary.forEach(((metric,idx)=>{var _secondaryMetricResul;metricResults.push({insightType:metric.filters.insight||src_types.F.TRENDS,result:null==secondaryMetricResults||null===(_secondaryMetricResul=secondaryMetricResults[idx])||void 0===_secondaryMetricResul?void 0:_secondaryMetricResul[variant.key]})})),variantsWithResults.push({variant:variant.key,results:metricResults})})),variantsWithResults}]}),Object(kea_forms_lib.forms)((_ref22=>{let{actions:actions,values:values}=_ref22;return{experiment:{defaults:{...NEW_EXPERIMENT},errors:_ref23=>{var _feature_flag_key$mat,_parameters$feature_f;let{name:name,feature_flag_key:feature_flag_key,parameters:parameters}=_ref23;return{name:!name&&"You have to enter a name.",feature_flag_key:feature_flag_key?null!==(_feature_flag_key$mat=feature_flag_key.match)&&void 0!==_feature_flag_key$mat&&_feature_flag_key$mat.call(feature_flag_key,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You have to enter a feature flag key.",parameters:{feature_flag_variants:null===(_parameters$feature_f=parameters.feature_flag_variants)||void 0===_parameters$feature_f?void 0:_parameters$feature_f.map((_ref24=>{var _key$match;let{key:key}=_ref24;return{key:null!==(_key$match=key.match)&&void 0!==_key$match&&_key$match.call(key,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}}))}}},submit:()=>{const{exposure:exposure,sampleSize:sampleSize}=values.exposureAndSampleSize;actions.createExperiment(!0,exposure,sampleSize)}}}})),Object(lib.urlToAction)((_ref25=>{let{actions:actions,values:values}=_ref25;return{"/experiments/:id":(_ref26,_,__,currentLocation,previousLocation)=>{let{id:id}=_ref26;const didPathChange=currentLocation.initial||currentLocation.pathname!==(null==previousLocation?void 0:previousLocation.pathname);if(actions.setEditExperiment(!1),id&&didPathChange){const parsedId="new"===id?"new":parseInt(id);"new"===parsedId&&(actions.createNewExperimentInsight(),actions.resetExperiment()),"new"!==parsedId&&parsedId===values.experimentId&&actions.loadExperiment()}}}}))]);function percentageDistribution(variantCount){const percentageRounded=Math.round(100/variantCount),delta=percentageRounded*variantCount-100,percentages=new Array(variantCount).fill(percentageRounded);return percentages[variantCount-1]=percentageRounded-delta,percentages}var InsightContainer=__webpack_require__("./frontend/src/scenes/insights/InsightContainer.tsx"),CloseOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/CloseOutlined.js"),InfoCircleOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),CopyToClipboard=__webpack_require__("./frontend/src/lib/components/CopyToClipboard.tsx");const defaultFormValues={name:"",filters:{insight:src_types.F.TRENDS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}]}},secondaryMetricsLogic=Object(index_esm.kea)([Object(index_esm.props)({}),Object(index_esm.key)((props=>props.experimentId||"new")),Object(index_esm.path)((key=>["scenes","experiment","secondaryMetricsLogic",key])),Object(index_esm.connect)({values:[teamLogic.a,["currentTeamId"]]}),Object(index_esm.actions)({openModalToCreateSecondaryMetric:!0,openModalToEditSecondaryMetric:(metric,metricId)=>({metric:metric,metricId:metricId}),closeModal:!0,addNewMetric:metric=>({metric:metric}),setFilters:filters=>({filters:filters}),setPreviewInsightId:shortId=>({shortId:shortId}),createPreviewInsight:filters=>({filters:filters}),deleteMetric:metricId=>({metricId:metricId}),updateMetric:(metric,metricId)=>({metric:metric,metricId:metricId}),setMetricId:metricId=>({metricId:metricId}),saveSecondaryMetric:!0}),Object(kea_loaders_lib.loaders)((_ref=>{let{values:values}=_ref;return{experiments:[[],{loadExperiments:async()=>(await api.b.get(`api/projects/${values.currentTeamId}/experiments`)).results}]}})),Object(index_esm.reducers)((_ref2=>{let{props:props}=_ref2;return{isModalOpen:[!1,{openModalToCreateSecondaryMetric:()=>!0,openModalToEditSecondaryMetric:()=>!0,closeModal:()=>!1}],existingModalSecondaryMetric:[null,{openModalToCreateSecondaryMetric:()=>null,openModalToEditSecondaryMetric:(_,_ref3)=>{let{metric:metric}=_ref3;return metric}}],previewInsightId:[null,{setPreviewInsightId:(_,_ref4)=>{let{shortId:shortId}=_ref4;return shortId}}],metrics:[props.initialMetrics,{addNewMetric:(metrics,_ref5)=>{let{metric:metric}=_ref5;return[...metrics,{...metric}]},deleteMetric:(metrics,_ref6)=>{let{metricId:metricId}=_ref6;return metrics.filter(((_,idx)=>idx!==metricId))},updateMetric:(metrics,_ref7)=>{let{metric:metric,metricId:metricId}=_ref7;const metricsCopy=[...metrics];return metricsCopy[metricId]=metric,metricsCopy}}],metricId:[0,{setMetricId:(_,_ref8)=>{let{metricId:metricId}=_ref8;return metricId}}]}})),Object(kea_forms_lib.forms)((()=>({secondaryMetricModal:{defaults:defaultFormValues,errors:()=>({}),submit:async()=>{}}}))),Object(index_esm.listeners)((_ref9=>{let{props:props,actions:actions,values:values}=_ref9;return{openModalToEditSecondaryMetric:_ref10=>{let{metric:{name:name,filters:filters},metricId:metricId}=_ref10;actions.setSecondaryMetricModalValue("name",name),actions.createPreviewInsight(filters),actions.setMetricId(metricId)},openModalToCreateSecondaryMetric:()=>{actions.resetSecondaryMetricModal(),actions.createPreviewInsight(defaultFormValues.filters)},createPreviewInsight:async _ref11=>{let newInsightFilters,{filters:filters}=_ref11;newInsightFilters=(null==filters?void 0:filters.insight)===src_types.F.FUNNELS?Object(cleanFilters.a)({insight:src_types.F.FUNNELS,funnel_viz_type:src_types.B.Steps,date_from:Object(dayjs.a)().subtract(14,"day").format("YYYY-MM-DD"),date_to:Object(dayjs.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:constants.k.horizontal,...filters}):Object(cleanFilters.a)({insight:src_types.F.TRENDS,date_from:Object(dayjs.a)().subtract(14,"day").format("YYYY-MM-DD"),date_to:Object(dayjs.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),...filters});const newInsight={description:"",tags:[],filters:newInsightFilters,result:null},createdInsight=await api.b.create(`api/projects/${teamLogic.a.values.currentTeamId}/insights`,newInsight);actions.setPreviewInsightId(createdInsight.short_id),actions.setSecondaryMetricModalValue("filters",newInsight.filters)},setFilters:_ref12=>{let{filters:filters}=_ref12;var _funnelLogic$findMoun,_trendsLogic$findMoun;filters.insight===src_types.F.FUNNELS?null===(_funnelLogic$findMoun=funnelLogic.a.findMounted({dashboardItemId:values.previewInsightId}))||void 0===_funnelLogic$findMoun||_funnelLogic$findMoun.actions.setFilters(filters):null===(_trendsLogic$findMoun=trendsLogic.a.findMounted({dashboardItemId:values.previewInsightId}))||void 0===_trendsLogic$findMoun||_trendsLogic$findMoun.actions.setFilters(filters)},saveSecondaryMetric:()=>{values.existingModalSecondaryMetric?actions.updateMetric(values.secondaryMetricModal,values.metricId):actions.addNewMetric(values.secondaryMetricModal),props.onMetricsChange(values.metrics),actions.closeModal()},deleteMetric:()=>{props.onMetricsChange(values.metrics)}}})),Object(index_esm.events)((_ref13=>{let{actions:actions}=_ref13;return{afterMount:()=>{actions.createPreviewInsight()}}}))]);var LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),ActionFilterRow=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),SamplingFilter=__webpack_require__("./frontend/src/scenes/insights/EditorFilters/SamplingFilter.tsx"),samplingFilterLogic=__webpack_require__("./frontend/src/scenes/insights/EditorFilters/samplingFilterLogic.ts");function MetricSelector(_ref){let{createPreviewInsight:createPreviewInsight,previewInsightId:previewInsightId,filters:filters,setFilters:setFilters}=_ref;const{insightProps:insightProps}=Object(index_esm.useValues)(Object(insightLogic.d)({dashboardItemId:previewInsightId,syncWithUrl:!1})),{isStepsEmpty:isStepsEmpty,filterSteps:filterSteps,filters:funnelsFilters}=Object(index_esm.useValues)(Object(funnelLogic.a)(insightProps)),{filters:trendsFilters}=Object(index_esm.useValues)(Object(trendsLogic.a)(insightProps)),experimentInsightType=filters.insight,{samplingAvailable:samplingAvailable}=Object(index_esm.useValues)(Object(samplingFilterLogic.b)({insightType:experimentInsightType,insightProps:insightProps}));return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)("div",{className:"flex items-center w-full gap-2 mb-4",children:[Object(jsx_runtime.jsx)("span",{children:"Insight Type"}),Object(jsx_runtime.jsx)(src.LemonSelect,{value:experimentInsightType,onChange:val=>{val&&createPreviewInsight({insight:val})},options:[{value:src_types.F.TRENDS,label:Object(jsx_runtime.jsx)("b",{children:"Trends"})},{value:src_types.F.FUNNELS,label:Object(jsx_runtime.jsx)("b",{children:"Funnels"})}]})]}),samplingAvailable?Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)(SamplingFilter.a,{insightProps:insightProps,infoTooltipContent:"Sampling on experiment goals is an Alpha feature to enable faster computation of experiment results.",setFilters:payload=>setFilters({...filters,...payload.sampling_factor?{sampling_factor:payload.sampling_factor}:{sampling_factor:null}}),initialSamplingPercentage:filters.sampling_factor?100*filters.sampling_factor:null}),Object(jsx_runtime.jsx)("br",{})]}):null,experimentInsightType===src_types.F.FUNNELS&&Object(jsx_runtime.jsx)(ActionFilter.a,{bordered:!0,filters:funnelsFilters,setFilters:payload=>{setFilters({...filters,insight:src_types.F.FUNNELS,...payload})},typeKey:`experiment-funnel-goal-${JSON.stringify(filters)}`,mathAvailability:ActionFilterRow.b.None,hideDeleteBtn:1===filterSteps.length,buttonCopy:"Add funnel step",showSeriesIndicator:!isStepsEmpty,seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.EventFeatureFlags,types.a.Cohorts,types.a.Elements]}),experimentInsightType===src_types.F.TRENDS&&Object(jsx_runtime.jsx)(ActionFilter.a,{bordered:!0,filters:trendsFilters,setFilters:payload=>{setFilters({...filters,insight:src_types.F.TRENDS,...payload})},typeKey:`experiment-trends-goal-${JSON.stringify(filters)}`,buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideDeleteBtn:!0,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.EventFeatureFlags,types.a.Cohorts,types.a.Elements]}),Object(jsx_runtime.jsx)("div",{className:"mt-4",children:Object(jsx_runtime.jsx)(index_esm.BindLogic,{logic:insightLogic.d,props:insightProps,children:Object(jsx_runtime.jsx)(InsightContainer.a,{disableHeader:!0,disableTable:!0,disableCorrelationTable:!0})})})]})}try{MetricSelector.displayName="MetricSelector",MetricSelector.__docgenInfo={description:"",displayName:"MetricSelector",props:{createPreviewInsight:{defaultValue:null,description:"",name:"createPreviewInsight",required:!0,type:{name:"(filters?: Partial<FilterType> | undefined) => void"}},setFilters:{defaultValue:null,description:"",name:"setFilters",required:!0,type:{name:"(filters: Partial<FilterType>) => void"}},previewInsightId:{defaultValue:null,description:"",name:"previewInsightId",required:!0,type:{name:"InsightShortId | null"}},filters:{defaultValue:null,description:"",name:"filters",required:!0,type:{name:"Partial<FilterType>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/MetricSelector.tsx#MetricSelector"]={docgenInfo:MetricSelector.__docgenInfo,name:"MetricSelector",path:"frontend/src/scenes/experiments/MetricSelector.tsx#MetricSelector"})}catch(__react_docgen_typescript_loader_error){}var colors=__webpack_require__("./frontend/src/lib/colors.ts");function SecondaryMetrics(_ref){var _experiment$secondary;let{onMetricsChange:onMetricsChange,initialMetrics:initialMetrics,experimentId:experimentId}=_ref;const logic=secondaryMetricsLogic({onMetricsChange:onMetricsChange,initialMetrics:initialMetrics,experimentId:experimentId}),{previewInsightId:previewInsightId,metrics:metrics,isModalOpen:isModalOpen,isSecondaryMetricModalSubmitting:isSecondaryMetricModalSubmitting,existingModalSecondaryMetric:existingModalSecondaryMetric,metricId:metricId}=Object(index_esm.useValues)(logic),{setFilters:setFilters,deleteMetric:deleteMetric,openModalToCreateSecondaryMetric:openModalToCreateSecondaryMetric,openModalToEditSecondaryMetric:openModalToEditSecondaryMetric,closeModal:closeModal,saveSecondaryMetric:saveSecondaryMetric,createPreviewInsight:createPreviewInsight}=Object(index_esm.useActions)(logic),{secondaryMetricResultsLoading:secondaryMetricResultsLoading,isExperimentRunning:isExperimentRunning,getIndexForVariant:getIndexForVariant,experiment:experiment,editingExistingExperiment:editingExistingExperiment,tabularSecondaryMetricResults:tabularSecondaryMetricResults}=Object(index_esm.useValues)(experimentLogic({experimentId:experimentId})),columns=[{key:"variant",title:"Variant",render:function Key(_,item){var _experiment$filters;return Object(jsx_runtime.jsx)("div",{style:{color:Object(colors.d)(getIndexForVariant(item.variant,(null===(_experiment$filters=experiment.filters)||void 0===_experiment$filters?void 0:_experiment$filters.insight)||src_types.F.TRENDS))},children:Object(jsx_runtime.jsx)("span",{className:"text-sm",children:Object(lib_utils.i)(item.variant)})})},sorter:(a,b)=>String(a.variant).localeCompare(String(b.variant))}];return null===(_experiment$secondary=experiment.secondary_metrics)||void 0===_experiment$secondary||_experiment$secondary.forEach(((metric,idx)=>{columns.push({key:`results_${idx}`,title:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)("b",{children:Object(lib_utils.i)(metric.name)})}),Object(jsx_runtime.jsx)("div",{className:"flex",onClick:event=>event.stopPropagation(),children:Object(jsx_runtime.jsx)(LemonButton.a,{icon:Object(jsx_runtime.jsx)(icons.S,{}),size:"small",status:"muted",onClick:()=>openModalToEditSecondaryMetric(metric,idx)})})]}),align:"right",render:function Key(_,item){var _item$results;return Object(jsx_runtime.jsx)("div",{children:null!==(_item$results=item.results)&&void 0!==_item$results&&_item$results[idx].result?item.results[idx].insightType===src_types.F.FUNNELS?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(100*item.results[idx].result).toFixed(1),"%"]}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(lib_utils.Q)(item.results[idx].result)}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"--"})})},sorter:(a,b)=>{var _a$results$idx$result,_a$results,_b$results$idx$result,_b$results;return(null!==(_a$results$idx$result=null===(_a$results=a.results)||void 0===_a$results?void 0:_a$results[idx].result)&&void 0!==_a$results$idx$result?_a$results$idx$result:0)-(null!==(_b$results$idx$result=null===(_b$results=b.results)||void 0===_b$results?void 0:_b$results[idx].result)&&void 0!==_b$results$idx$result?_b$results$idx$result:0)}})})),Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(src.LemonModal,{isOpen:isModalOpen,onClose:closeModal,width:1e3,title:existingModalSecondaryMetric?"Edit secondary metric":"New secondary metric",footer:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[existingModalSecondaryMetric&&Object(jsx_runtime.jsx)(LemonButton.a,{className:"mr-auto",form:"secondary-metric-modal-form",type:"secondary",status:"danger",onClick:()=>deleteMetric(metricId),children:"Delete"}),Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(LemonButton.a,{form:"secondary-metric-modal-form",type:"secondary",onClick:closeModal,children:"Cancel"}),Object(jsx_runtime.jsx)(LemonButton.a,{form:"secondary-metric-modal-form",onClick:saveSecondaryMetric,type:"primary",loading:isSecondaryMetricModalSubmitting,"data-attr":"create-annotation-submit",children:existingModalSecondaryMetric?"Save":"Create"})]})]}),children:Object(jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:secondaryMetricsLogic,props:{onMetricsChange:onMetricsChange,initialMetrics:initialMetrics,experimentId:experimentId},formKey:"secondaryMetricModal",id:"secondary-metric-modal-form",className:"space-y-4",children:[Object(jsx_runtime.jsx)(Field.a,{name:"name",label:"Name",children:Object(jsx_runtime.jsx)(src.LemonInput,{})}),Object(jsx_runtime.jsx)(Field.a,{name:"filters",label:"Query",children:_ref2=>{let{value:value,onChange:onChange}=_ref2;return Object(jsx_runtime.jsx)(MetricSelector,{createPreviewInsight:createPreviewInsight,setFilters:payload=>{setFilters(payload),onChange(payload)},previewInsightId:previewInsightId,filters:value})}})]})}),"new"==experimentId||editingExistingExperiment?Object(jsx_runtime.jsx)(row.a,{children:Object(jsx_runtime.jsxs)(col.a,{children:[metrics.map(((metric,idx)=>Object(jsx_runtime.jsxs)(row.a,{className:"mt-4 border rounded p-4",children:[Object(jsx_runtime.jsxs)(row.a,{align:"middle",justify:"space-between",className:"w-full mb-3 pb-2 border-b",children:[Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)("b",{children:metric.name})}),Object(jsx_runtime.jsxs)("div",{className:"flex",children:[Object(jsx_runtime.jsx)(LemonButton.a,{icon:Object(jsx_runtime.jsx)(icons.S,{}),size:"small",status:"muted",onClick:()=>openModalToEditSecondaryMetric(metric,idx)}),Object(jsx_runtime.jsx)(LemonButton.a,{icon:Object(jsx_runtime.jsx)(icons.O,{}),size:"small",status:"muted",onClick:()=>deleteMetric(idx)})]})]}),metric.filters.insight===src_types.F.FUNNELS&&Object(jsx_runtime.jsx)(ActionFilter.a,{bordered:!0,filters:metric.filters,setFilters:()=>{},typeKey:`funnel-preview-${idx}`,mathAvailability:ActionFilterRow.b.None,buttonCopy:"Add funnel step",seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.EventFeatureFlags,types.a.Cohorts,types.a.Elements],readOnly:!0}),metric.filters.insight===src_types.F.TRENDS&&Object(jsx_runtime.jsx)(ActionFilter.a,{bordered:!0,filters:metric.filters,setFilters:()=>{},typeKey:`trend-preview-${idx}`,buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.EventFeatureFlags,types.a.Cohorts,types.a.Elements],readOnly:!0})]},idx))),metrics&&!(metrics.length>2)&&Object(jsx_runtime.jsx)(col.a,{children:Object(jsx_runtime.jsx)("div",{className:"mb-2 mt-4",children:Object(jsx_runtime.jsx)(LemonButton.a,{type:"secondary",onClick:openModalToCreateSecondaryMetric,children:"Add metric"})})})]})}):Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary mt-4 mb-1",children:"Secondary metrics"}),metrics&&metrics.length>0?Object(jsx_runtime.jsx)(src.LemonTable,{loading:secondaryMetricResultsLoading,columns:columns,dataSource:tabularSecondaryMetricResults}):isExperimentRunning?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"--"}),metrics&&!(metrics.length>2)&&isExperimentRunning&&Object(jsx_runtime.jsx)("div",{className:"mb-2 mt-4 justify-end",children:Object(jsx_runtime.jsx)(LemonButton.a,{type:"secondary",size:"small",onClick:openModalToCreateSecondaryMetric,children:"Add metric"})})]})]})}try{SecondaryMetrics.displayName="SecondaryMetrics",SecondaryMetrics.__docgenInfo={description:"",displayName:"SecondaryMetrics",props:{onMetricsChange:{defaultValue:null,description:"",name:"onMetricsChange",required:!0,type:{name:"(metrics: SecondaryExperimentMetric[]) => void"}},initialMetrics:{defaultValue:null,description:"",name:"initialMetrics",required:!0,type:{name:"SecondaryExperimentMetric[]"}},experimentId:{defaultValue:null,description:"",name:"experimentId",required:!0,type:{name:'number | "new"'}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"]={docgenInfo:SecondaryMetrics.__docgenInfo,name:"SecondaryMetrics",path:"frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"})}catch(__react_docgen_typescript_loader_error){}var EntityFilterInfo=__webpack_require__("./frontend/src/lib/components/EntityFilterInfo.tsx"),EditableField=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link.tsx"),slider=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/slider/index.js"),input_number=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/input-number/index.js"),InsightLabel=__webpack_require__("./frontend/src/lib/components/InsightLabel/index.tsx"),PropertyFilterButton=__webpack_require__("./frontend/src/lib/components/PropertyFilters/components/PropertyFilterButton.tsx");function ExperimentWorkflow(){const[workflowValidateStepCompleted,setWorkflowValidateStepCompleted]=Object(react.useState)(!1),[workflowLaunchStepCompleted,setWorkflowLaunchStepCompleted]=Object(react.useState)(!1);return Object(jsx_runtime.jsxs)(card.a,{className:"experiment-workflow",title:Object(jsx_runtime.jsx)("span",{className:"card-secondary",children:"Experiment workflow"}),children:[Object(jsx_runtime.jsx)(row.a,{children:Object(jsx_runtime.jsxs)(col.a,{className:"exp-workflow-step step-completed w-full",children:[Object(jsx_runtime.jsxs)(row.a,{align:"middle",children:[Object(jsx_runtime.jsx)(icons.z,{style:{color:"var(--primary)",fontSize:24}}),Object(jsx_runtime.jsx)("b",{className:"ml-2",children:"Create experiment"})]}),Object(jsx_runtime.jsx)("div",{className:"ml-8",children:"Set variants, select participants, and add secondary metrics"})]})}),Object(jsx_runtime.jsx)(row.a,{children:Object(jsx_runtime.jsxs)(col.a,{className:"w-full exp-workflow-step "+(workflowValidateStepCompleted?"step-completed":""),onClick:()=>setWorkflowValidateStepCompleted(!workflowValidateStepCompleted),children:[Object(jsx_runtime.jsxs)(row.a,{align:"middle",children:[workflowValidateStepCompleted?Object(jsx_runtime.jsx)(icons.z,{style:{color:"var(--primary)",fontSize:24}}):Object(jsx_runtime.jsx)(icons.wc,{}),Object(jsx_runtime.jsx)("b",{className:"ml-2",children:"Validate experiment"})]}),Object(jsx_runtime.jsx)("div",{className:"ml-8",children:"Once you've written your code, it's a good idea to test that each variant behaves as you'd expect."})]})}),Object(jsx_runtime.jsx)(row.a,{children:Object(jsx_runtime.jsxs)(col.a,{className:"w-full exp-workflow-step "+(workflowLaunchStepCompleted?"step-completed":""),onClick:()=>setWorkflowLaunchStepCompleted(!workflowLaunchStepCompleted),children:[Object(jsx_runtime.jsxs)(row.a,{align:"middle",children:[workflowLaunchStepCompleted?Object(jsx_runtime.jsx)(icons.z,{style:{color:"var(--primary)",fontSize:24}}):Object(jsx_runtime.jsx)(icons.wc,{}),Object(jsx_runtime.jsx)("b",{className:"ml-2",children:"Launch experiment"})]}),Object(jsx_runtime.jsx)("div",{className:"ml-8",children:"Run your experiment, monitor results, and decide when to terminate your experiment."})]})})]})}var TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx");function ExperimentPreview(_ref){var _experiment$filters,_experiment$parameter,_experiment$parameter2,_experiment$filters2,_experiment$filters3,_experiment$filters4;let{experimentId:experimentId,trendCount:trendCount,funnelConversionRate:funnelConversionRate,trendExposure:trendExposure,funnelSampleSize:funnelSampleSize,funnelEntrants:funnelEntrants}=_ref;const{experimentInsightType:experimentInsightType,editingExistingExperiment:editingExistingExperiment,minimumDetectableChange:minimumDetectableChange,expectedRunningTime:expectedRunningTime,aggregationLabel:aggregationLabel,experiment:experiment,isExperimentGoalModalOpen:isExperimentGoalModalOpen,experimentLoading:experimentLoading,experimentInsightId:experimentInsightId}=Object(index_esm.useValues)(experimentLogic({experimentId:experimentId})),{setExperiment:setExperiment,openExperimentGoalModal:openExperimentGoalModal,closeExperimentGoalModal:closeExperimentGoalModal,updateExperimentGoal:updateExperimentGoal,setFilters:setFilters,createNewExperimentInsight:createNewExperimentInsight}=Object(index_esm.useActions)(experimentLogic({experimentId:experimentId})),sliderMaxValue=experimentInsightType===src_types.F.FUNNELS&&100-funnelConversionRate<50?100-funnelConversionRate:50,currentDuration=Object(dayjs.a)().diff(Object(dayjs.a)(null==experiment?void 0:experiment.start_date),"hour");let runningTime=0;runningTime=null!=experiment&&experiment.start_date?expectedRunningTime(funnelEntrants||1,funnelSampleSize||0,currentDuration):expectedRunningTime(funnelEntrants||1,funnelSampleSize||0);const expectedEndDate=Object(dayjs.a)(null==experiment?void 0:experiment.start_date).add(runningTime,"hour"),showEndDate=!(null!=experiment&&experiment.end_date)&&currentDuration>=24&&funnelEntrants&&funnelSampleSize,experimentProperties=Object(lib_utils.r)(null==experiment||null===(_experiment$filters=experiment.filters)||void 0===_experiment$filters?void 0:_experiment$filters.properties);return Object(jsx_runtime.jsxs)(row.a,{children:[Object(jsx_runtime.jsxs)(col.a,{span:null!=experiment&&experiment.start_date||"new"===experimentId||editingExistingExperiment?24:12,children:["new"===experimentId&&Object(jsx_runtime.jsx)(row.a,{className:"experiment-preview-row",children:Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)("b",{children:"Experiment preview"})}),Object(jsx_runtime.jsxs)("div",{className:"text-muted",children:["Here are the baseline metrics for your experiment. Adjust your minimum detectible threshold to adjust for the smallest conversion value you'll accept, and the experiment duration."," "]})]})}),("new"===experimentId||editingExistingExperiment)&&Object(jsx_runtime.jsx)(row.a,{className:"mb-4",children:Object(jsx_runtime.jsxs)(col.a,{span:24,children:[Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("b",{children:"Minimum acceptable improvement"}),Object(jsx_runtime.jsx)(tooltip.a,{title:"Minimum acceptable improvement is a calculation that estimates the smallest significant improvement you are willing to accept.",children:Object(jsx_runtime.jsx)(icons.xb,{className:"ml-1 text-muted text-xl"})})]}),Object(jsx_runtime.jsxs)(row.a,{className:"mde-slider",children:[Object(jsx_runtime.jsx)(col.a,{span:8,children:Object(jsx_runtime.jsx)(slider.a,{defaultValue:5,value:minimumDetectableChange,min:1,max:sliderMaxValue,trackStyle:{background:"var(--primary)"},handleStyle:{background:"var(--primary)"},onChange:value=>{setExperiment({parameters:{...experiment.parameters,minimum_detectable_effect:value}})},tipFormatter:value=>`${value}%`})}),Object(jsx_runtime.jsx)(input_number.a,{min:1,max:sliderMaxValue,defaultValue:5,formatter:value=>`${value}%`,style:{margin:"0 16px"},value:minimumDetectableChange,onChange:value=>{setExperiment({parameters:{...experiment.parameters,minimum_detectable_effect:value}})}})]})]})}),Object(jsx_runtime.jsxs)(row.a,{className:"experiment-preview-row "+(null!=experiment&&experiment.start_date?"mr":""),children:[experimentInsightType===src_types.F.TRENDS?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!(null!=experiment&&experiment.start_date)&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)(col.a,{span:6,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary",children:"Baseline Count"}),Object(jsx_runtime.jsx)("div",{className:"l4",children:Object(lib_utils.Q)(trendCount||0)})]}),Object(jsx_runtime.jsxs)(col.a,{span:6,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Count"}),Object(jsx_runtime.jsx)("div",{className:"l4",children:Object(lib_utils.Q)(trendCount+Math.ceil(trendCount*(minimumDetectableChange/100))||0)})]})]}),Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsxs)("span",{className:"l4",children:["~",Object(lib_utils.Q)(trendExposure||0)]})," days"]})]})]}):Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!(null!=experiment&&experiment.start_date)&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary",children:"Baseline Conversion Rate"}),Object(jsx_runtime.jsxs)("div",{className:"l4",children:[funnelConversionRate.toFixed(1),"%"]})]}),Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Conversion Rate"}),Object(jsx_runtime.jsxs)("div",{className:"l4",children:[(funnelConversionRate+minimumDetectableChange).toFixed(1),"%"]})]})]}),Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended Sample Size"}),Object(jsx_runtime.jsxs)("div",{className:"pb-4",children:[Object(jsx_runtime.jsxs)("span",{className:"l4",children:["~",Object(lib_utils.Q)(funnelSampleSize||0)]})," persons"]})]}),!(null!=experiment&&experiment.start_date)&&Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsxs)("span",{className:"l4",children:["~",Object(lib_utils.Q)(runningTime||0)]})," days"]})]})]}),Object(jsx_runtime.jsxs)(row.a,{className:"w-full mt-4",children:[Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary",children:"Experiment variants"}),Object(jsx_runtime.jsx)("ul",{className:"variants-list",children:null==experiment||null===(_experiment$parameter=experiment.parameters)||void 0===_experiment$parameter||null===(_experiment$parameter2=_experiment$parameter.feature_flag_variants)||void 0===_experiment$parameter2?void 0:_experiment$parameter2.map(((variant,idx)=>Object(jsx_runtime.jsx)("li",{children:variant.key},idx)))})]}),Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary",children:"Participants"}),Object(jsx_runtime.jsx)("div",{children:null!=experimentProperties&&experimentProperties.length?Object(jsx_runtime.jsx)("div",{children:null==experimentProperties?void 0:experimentProperties.map((item=>Object(jsx_runtime.jsx)(PropertyFilterButton.a,{item:item,style:{margin:2,cursor:"default"}},item.key)))}):Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["100% of"," ",null!=(null==experiment||null===(_experiment$filters2=experiment.filters)||void 0===_experiment$filters2?void 0:_experiment$filters2.aggregation_group_type_index)?Object(lib_utils.i)(aggregationLabel(experiment.filters.aggregation_group_type_index).plural):"users"]})})]})]}),Object(jsx_runtime.jsxs)(row.a,{className:"w-full",children:["new"!==experimentId&&!editingExistingExperiment&&Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary mt-4",children:"Start date"}),null!=experiment&&experiment.start_date?Object(jsx_runtime.jsx)(TZLabel.a,{time:null==experiment?void 0:experiment.start_date}):Object(jsx_runtime.jsx)("span",{className:"description",children:"Not started yet"})]}),experimentInsightType===src_types.F.FUNNELS&&showEndDate?Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary mt-4",children:"Expected end date"}),Object(jsx_runtime.jsx)("span",{children:expectedEndDate.isAfter(Object(dayjs.a)())?expectedEndDate.format("D MMM YYYY"):Object(dayjs.a)().format("D MMM YYYY")})]}):null,(null==experiment?void 0:experiment.end_date)&&Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary mt-4",children:"Completed date"}),Object(jsx_runtime.jsx)(TZLabel.a,{time:null==experiment?void 0:experiment.end_date})]})]})]}),"new"!==experimentId&&!editingExistingExperiment&&Object(jsx_runtime.jsx)(row.a,{className:"experiment-preview-row",children:Object(jsx_runtime.jsxs)(col.a,{children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary mb-2",children:experimentInsightType===src_types.F.FUNNELS?"Conversion goal steps":"Trend goal"}),[...(null==experiment||null===(_experiment$filters3=experiment.filters)||void 0===_experiment$filters3?void 0:_experiment$filters3.events)||[],...(null==experiment||null===(_experiment$filters4=experiment.filters)||void 0===_experiment$filters4?void 0:_experiment$filters4.actions)||[]].sort(((a,b)=>(a.order||0)-(b.order||0))).map(((event,idx)=>{var _event$properties;return Object(jsx_runtime.jsxs)(col.a,{className:"mb-2",children:[Object(jsx_runtime.jsxs)(row.a,{style:{marginBottom:4},children:[Object(jsx_runtime.jsx)("div",{className:"preview-conversion-goal-num",children:experimentInsightType===src_types.F.FUNNELS?(event.order||0)+1:idx+1}),Object(jsx_runtime.jsx)("b",{children:Object(jsx_runtime.jsx)(InsightLabel.a,{action:event,showCountedByTag:experimentInsightType===src_types.F.TRENDS,hideIcon:!0})})]}),null===(_event$properties=event.properties)||void 0===_event$properties?void 0:_event$properties.map((prop=>Object(jsx_runtime.jsx)(PropertyFilterButton.a,{item:prop},prop.key)))]},idx)})),(null==experiment?void 0:experiment.start_date)&&Object(jsx_runtime.jsx)("div",{className:"mb-2 mt-4",children:Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:openExperimentGoalModal,children:"Change experiment goal"})})]})})]}),"new"!==experimentId&&!editingExistingExperiment&&!(null!=experiment&&experiment.start_date)&&Object(jsx_runtime.jsx)(col.a,{span:12,className:"pl-4",children:Object(jsx_runtime.jsx)(ExperimentWorkflow,{})}),Object(jsx_runtime.jsx)(src.LemonModal,{isOpen:isExperimentGoalModalOpen,onClose:closeExperimentGoalModal,width:1e3,title:"Change experiment goal",footer:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(src.LemonButton,{form:"edit-experiment-goal-form",type:"secondary",onClick:closeExperimentGoalModal,children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{form:"edit-experiment-goal-form",onClick:()=>{updateExperimentGoal(experiment.filters)},type:"primary",loading:experimentLoading,"data-attr":"create-annotation-submit",children:"Save"})]}),children:Object(jsx_runtime.jsx)(kea_forms_lib.Form,{logic:experimentLogic,props:{experimentId:experimentId},formKey:"experiment",id:"edit-experiment-goal-form",className:"space-y-4",children:Object(jsx_runtime.jsx)(kea_forms_lib.Field,{name:"filters",children:_ref2=>{let{value:value,onChange:onChange}=_ref2;return Object(jsx_runtime.jsx)(MetricSelector,{createPreviewInsight:createNewExperimentInsight,setFilters:payload=>{setFilters(payload),onChange(payload)},previewInsightId:experimentInsightId,filters:value})}})})})]})}try{ExperimentPreview.displayName="ExperimentPreview",ExperimentPreview.__docgenInfo={description:"",displayName:"ExperimentPreview",props:{experimentId:{defaultValue:null,description:"",name:"experimentId",required:!0,type:{name:'number | "new"'}},trendCount:{defaultValue:null,description:"",name:"trendCount",required:!0,type:{name:"number"}},trendExposure:{defaultValue:null,description:"",name:"trendExposure",required:!1,type:{name:"number"}},funnelSampleSize:{defaultValue:null,description:"",name:"funnelSampleSize",required:!1,type:{name:"number"}},funnelConversionRate:{defaultValue:null,description:"",name:"funnelConversionRate",required:!0,type:{name:"number"}},funnelEntrants:{defaultValue:null,description:"",name:"funnelEntrants",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"]={docgenInfo:ExperimentPreview.__docgenInfo,name:"ExperimentPreview",path:"frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"})}catch(__react_docgen_typescript_loader_error){}var es_select=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/select/index.js"),CaretDownOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/CaretDownOutlined.js"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.tsx");function ServerSideWarning(){return Object(jsx_runtime.jsx)("div",{className:"warning",children:Object(jsx_runtime.jsxs)("p",{children:[Object(jsx_runtime.jsx)("b",{children:"Warning:"})," Server side experiment metrics require you to manually send the feature flag information."," ",Object(jsx_runtime.jsx)(src.Link,{to:"https://posthog.com/tutorials/experiments#step-2-sending-the-right-events",target:"_blank",children:"See this tutorial for more information."})]})})}function NodeJSSnippet(_ref){let{flagKey:flagKey,variant:variant}=_ref;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:`const experimentFlagValue = await client.getFeatureFlag('${flagKey}', 'user distinct id')\n\nif (experimentFlagValue === '${variant}' ) {\n    // Do something differently for this user\n} else {\n    // It's a good idea to let control variant always be the default behaviour,\n    // so if something goes wrong with flag evaluation, you don't break your app.\n}`}),Object(jsx_runtime.jsx)(ServerSideWarning,{})]})}function JSSnippet(_ref2){let{flagKey:flagKey,variant:variant}=_ref2;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:`if (posthog.getFeatureFlag('${flagKey}') === '${variant}') {\n    // Do something differently for this user\n} else {\n    // It's a good idea to let control variant always be the default behaviour,\n    // so if something goes wrong with flag evaluation, you don't break your app.\n}`}),Object(jsx_runtime.jsx)("b",{children:"Test that it works"}),Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:`posthog.feature_flags.override({'${flagKey}': '${variant}'})`})]})}function RNSnippet(_ref3){let{flagKey:flagKey,variant:variant}=_ref3;return Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:`if (posthog.getFeatureFlag('${flagKey}') === '${variant}') {\n    // Do something differently for this user\n} else {\n    // It's a good idea to let control variant always be the default behaviour,\n    // so if something goes wrong with flag evaluation, you don't break your app.\n}`})})}function PHPSnippet(_ref4){let{flagKey:flagKey,variant:variant}=_ref4;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.PHP,wrap:!0,children:`if (PostHog::getFeatureFlag('${flagKey}', 'user distinct id') == '${variant}') {\n    // Do something differently for this user\n} else {\n    // It's a good idea to let control variant always be the default behaviour,\n    // so if something goes wrong with flag evaluation, you don't break your app.\n}`}),Object(jsx_runtime.jsx)(ServerSideWarning,{})]})}function GolangSnippet(_ref5){let{flagKey:flagKey,variant:variant}=_ref5;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.Go,wrap:!0,children:`experimentFlagValue, err := client.GetFeatureFlag(\n                    FeatureFlagPayload{\n                        Key:        '${flagKey}',\n                        DistinctId: "distinct-id",\n                    })\n\nif (experimentFlagValue == '${variant}' ) {\n    // Do something differently for this user\n} else {\n    // It's a good idea to let control variant always be the default behaviour,\n    // so if something goes wrong with flag evaluation, you don't break your app.\n}`}),Object(jsx_runtime.jsx)(ServerSideWarning,{})]})}function RubySnippet(_ref6){let{flagKey:flagKey,variant:variant}=_ref6;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.Ruby,wrap:!0,children:`experimentFlagValue = posthog.get_feature_flag('${flagKey}', 'user distinct id')\n\n\nif experimentFlagValue == '${variant}'\n    # Do something differently for this user\nelse\n    # It's a good idea to let control variant always be the default behaviour,\n    # so if something goes wrong with flag evaluation, you don't break your app.\nend\n`}),Object(jsx_runtime.jsx)(ServerSideWarning,{})]})}function PythonSnippet(_ref7){let{flagKey:flagKey,variant:variant}=_ref7;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.Python,wrap:!0,children:`experiment_flag_value = posthog.get_feature_flag("${flagKey}", "user_distinct_id"):\n\nif experiment_flag_value == '${variant}':\n    # Do something differently for this user\nelse:\n    # It's a good idea to let control variant always be the default behaviour,\n    # so if something goes wrong with flag evaluation, you don't break your app.\n`}),Object(jsx_runtime.jsx)(ServerSideWarning,{})]})}try{NodeJSSnippet.displayName="NodeJSSnippet",NodeJSSnippet.__docgenInfo={description:"",displayName:"NodeJSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#NodeJSSnippet"]={docgenInfo:NodeJSSnippet.__docgenInfo,name:"NodeJSSnippet",path:"frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#NodeJSSnippet"})}catch(__react_docgen_typescript_loader_error){}try{JSSnippet.displayName="JSSnippet",JSSnippet.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#JSSnippet"]={docgenInfo:JSSnippet.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#JSSnippet"})}catch(__react_docgen_typescript_loader_error){}try{RNSnippet.displayName="RNSnippet",RNSnippet.__docgenInfo={description:"",displayName:"RNSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#RNSnippet"]={docgenInfo:RNSnippet.__docgenInfo,name:"RNSnippet",path:"frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#RNSnippet"})}catch(__react_docgen_typescript_loader_error){}try{PHPSnippet.displayName="PHPSnippet",PHPSnippet.__docgenInfo={description:"",displayName:"PHPSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#PHPSnippet"]={docgenInfo:PHPSnippet.__docgenInfo,name:"PHPSnippet",path:"frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#PHPSnippet"})}catch(__react_docgen_typescript_loader_error){}try{GolangSnippet.displayName="GolangSnippet",GolangSnippet.__docgenInfo={description:"",displayName:"GolangSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#GolangSnippet"]={docgenInfo:GolangSnippet.__docgenInfo,name:"GolangSnippet",path:"frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#GolangSnippet"})}catch(__react_docgen_typescript_loader_error){}try{RubySnippet.displayName="RubySnippet",RubySnippet.__docgenInfo={description:"",displayName:"RubySnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#RubySnippet"]={docgenInfo:RubySnippet.__docgenInfo,name:"RubySnippet",path:"frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#RubySnippet"})}catch(__react_docgen_typescript_loader_error){}try{PythonSnippet.displayName="PythonSnippet",PythonSnippet.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#PythonSnippet"]={docgenInfo:PythonSnippet.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/experiments/ExperimentCodeSnippets.tsx#PythonSnippet"})}catch(__react_docgen_typescript_loader_error){}const UTM_TAGS="?utm_medium=in-product&utm_campaign=experiment",DOC_BASE_URL="https://posthog.com/docs/integrate/",FF_ANCHOR="#feature-flags",OPTIONS=[{value:"JavaScript",documentationLink:`${DOC_BASE_URL}client/js${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.zb,Snippet:JSSnippet},{value:"ReactNative",documentationLink:`${DOC_BASE_URL}client/react-native${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.zb,Snippet:RNSnippet},{value:"Node.js",documentationLink:`${DOC_BASE_URL}server/node${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.Xb,Snippet:NodeJSSnippet},{value:"PHP",documentationLink:`${DOC_BASE_URL}server/php${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.dc,Snippet:PHPSnippet},{value:"Ruby",documentationLink:`${DOC_BASE_URL}server/ruby${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.Bc,Snippet:RubySnippet},{value:"Golang",documentationLink:`${DOC_BASE_URL}server/go${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.qb,Snippet:GolangSnippet},{value:"Python",documentationLink:`${DOC_BASE_URL}server/python${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.tc,Snippet:PythonSnippet}];function CodeLanguageSelect(_ref){let{selectedOptionValue:selectedOptionValue,selectOption:selectOption}=_ref;return Object(jsx_runtime.jsx)(es_select.a,{value:selectedOptionValue,onChange:selectOption,style:{minWidth:120},suffixIcon:Object(jsx_runtime.jsx)(CaretDownOutlined.a,{}),children:OPTIONS.map(((_ref2,index)=>{let{value:value,Icon:Icon}=_ref2;return Object(jsx_runtime.jsx)(es_select.a.Option,{"data-attr":"experiment-instructions-select-option-"+value,value:value,children:Object(jsx_runtime.jsxs)("div",{className:"flex items-center",children:[Object(jsx_runtime.jsx)(Icon,{className:"mr-1"})," ",value]})},index)}))})}function ExperimentImplementationDetails(_ref3){var _experiment$parameter,_experiment$parameter2,_experiment$parameter3,_experiment$parameter4,_experiment$parameter5,_experiment$parameter6,_experiment$feature_f;let{experiment:experiment}=_ref3;const defaultVariant=null!==(_experiment$parameter=null==experiment||null===(_experiment$parameter2=experiment.parameters)||void 0===_experiment$parameter2||null===(_experiment$parameter3=_experiment$parameter2.feature_flag_variants)||void 0===_experiment$parameter3||null===(_experiment$parameter4=_experiment$parameter3[1])||void 0===_experiment$parameter4?void 0:_experiment$parameter4.key)&&void 0!==_experiment$parameter?_experiment$parameter:"test",[currentVariant,setCurrentVariant]=Object(react.useState)(defaultVariant),[defaultSelectedOption]=OPTIONS,[selectedOption,setSelectedOption]=Object(react.useState)(defaultSelectedOption);return Object(jsx_runtime.jsxs)(card.a,{title:Object(jsx_runtime.jsx)("span",{className:"card-secondary",children:"Feature flag usage and implementation"}),className:"experiment-implementation-details",children:[Object(jsx_runtime.jsxs)("div",{style:{justifyContent:"space-between"},className:"flex mb-2",children:[Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("span",{className:"mr-2",children:"Variant group"}),Object(jsx_runtime.jsx)(es_select.a,{onChange:setCurrentVariant,value:currentVariant,style:{minWidth:80},suffixIcon:Object(jsx_runtime.jsx)(CaretDownOutlined.a,{}),children:null==experiment||null===(_experiment$parameter5=experiment.parameters)||void 0===_experiment$parameter5||null===(_experiment$parameter6=_experiment$parameter5.feature_flag_variants)||void 0===_experiment$parameter6?void 0:_experiment$parameter6.map(((variant,idx)=>Object(jsx_runtime.jsx)(es_select.a.Option,{value:variant.key,children:variant.key},idx)))})]}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(CodeLanguageSelect,{selectOption:selectedValue=>{const option=OPTIONS.find((option=>option.value===selectedValue));option&&setSelectedOption(option)},selectedOptionValue:selectedOption.value})})]}),Object(jsx_runtime.jsx)("b",{children:"Implement your experiment in code"}),Object(jsx_runtime.jsx)(selectedOption.Snippet,{variant:currentVariant,flagKey:null!==(_experiment$feature_f=null==experiment?void 0:experiment.feature_flag_key)&&void 0!==_experiment$feature_f?_experiment$feature_f:""}),Object(jsx_runtime.jsx)(src.Link,{to:selectedOption.documentationLink,target:"_blank",children:Object(jsx_runtime.jsxs)("div",{className:"flex items-center",children:["See the docs for more implementation information. ",Object(jsx_runtime.jsx)(icons.bc,{className:"ml-1"})]})})]})}try{CodeLanguageSelect.displayName="CodeLanguageSelect",CodeLanguageSelect.__docgenInfo={description:"",displayName:"CodeLanguageSelect",props:{selectedOptionValue:{defaultValue:null,description:"",name:"selectedOptionValue",required:!0,type:{name:"string"}},selectOption:{defaultValue:null,description:"",name:"selectOption",required:!0,type:{name:"(selectedValue: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#CodeLanguageSelect"]={docgenInfo:CodeLanguageSelect.__docgenInfo,name:"CodeLanguageSelect",path:"frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#CodeLanguageSelect"})}catch(__react_docgen_typescript_loader_error){}try{ExperimentImplementationDetails.displayName="ExperimentImplementationDetails",ExperimentImplementationDetails.__docgenInfo={description:"",displayName:"ExperimentImplementationDetails",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"]={docgenInfo:ExperimentImplementationDetails.__docgenInfo,name:"ExperimentImplementationDetails",path:"frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"})}catch(__react_docgen_typescript_loader_error){}var NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),ExperimentsPayGate=__webpack_require__("./frontend/src/scenes/experiments/ExperimentsPayGate.tsx"),LemonCollapse=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCollapse/index.ts");const scene={component:Experiment_Experiment,logic:experimentLogic,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{experimentId:"new"===id?"new":parseInt(id)}}};function Experiment_Experiment(){var _trendResults$,_results$,_experiment$parameter,_experiment$parameter2,_experiment$parameter3,_experiment$parameter4,_experiment$parameter5,_experiment$parameter6,_experiment$parameter7,_experiment$parameter8,_experiment$parameter9;const{experimentId:experimentId,experiment:experiment,experimentInsightId:experimentInsightId,minimumSampleSizePerVariant:minimumSampleSizePerVariant,recommendedExposureForCountData:recommendedExposureForCountData,variants:variants,experimentResults:experimentResults,countDataForVariant:countDataForVariant,editingExistingExperiment:editingExistingExperiment,experimentInsightType:experimentInsightType,experimentResultsLoading:experimentResultsLoading,experimentLoading:experimentLoading,areResultsSignificant:areResultsSignificant,conversionRateForVariant:conversionRateForVariant,getIndexForVariant:getIndexForVariant,significanceBannerDetails:significanceBannerDetails,areTrendResultsConfusing:areTrendResultsConfusing,taxonomicGroupTypesForSelection:taxonomicGroupTypesForSelection,groupTypes:groupTypes,aggregationLabel:aggregationLabel,isExperimentRunning:isExperimentRunning,experimentResultCalculationError:experimentResultCalculationError,flagImplementationWarning:flagImplementationWarning,flagAvailabilityWarning:flagAvailabilityWarning,props:props,sortedExperimentResultVariants:sortedExperimentResultVariants}=Object(index_esm.useValues)(experimentLogic),{launchExperiment:launchExperiment,setFilters:setFilters,setEditExperiment:setEditExperiment,endExperiment:endExperiment,addExperimentGroup:addExperimentGroup,updateExperiment:updateExperiment,removeExperimentGroup:removeExperimentGroup,createNewExperimentInsight:createNewExperimentInsight,archiveExperiment:archiveExperiment,resetRunningExperiment:resetRunningExperiment,loadExperiment:loadExperiment,setExposureAndSampleSize:setExposureAndSampleSize,setExperimentValue:setExperimentValue,updateExperimentSecondaryMetrics:updateExperimentSecondaryMetrics}=Object(index_esm.useActions)(experimentLogic),{hasAvailableFeature:hasAvailableFeature}=Object(index_esm.useValues)(userLogic.a),[showWarning,setShowWarning]=Object(react.useState)(!0),{insightProps:insightProps}=Object(index_esm.useValues)(Object(insightLogic.d)({dashboardItemId:experimentInsightId})),{isStepsEmpty:isStepsEmpty,filterSteps:filterSteps,filters:funnelsFilters,results:results,conversionMetrics:conversionMetrics}=Object(index_esm.useValues)(Object(funnelLogic.a)(insightProps)),{filters:trendsFilters,results:trendResults}=Object(index_esm.useValues)(Object(trendsLogic.a)(insightProps)),conversionRate=100*conversionMetrics.totalRate,sampleSize=minimumSampleSizePerVariant(conversionRate)*variants.length,trendCount=null===(_trendResults$=trendResults[0])||void 0===_trendResults$?void 0:_trendResults$.count,entrants=null==results||null===(_results$=results[0])||void 0===_results$?void 0:_results$.count,exposure=recommendedExposureForCountData(trendCount),secondaryColumnSpan=Math.floor(24/(variants.length+2));Object(react.useEffect)((()=>{setExposureAndSampleSize(exposure,sampleSize)}),[exposure,sampleSize]);const funnelResultsPersonsTotal=experimentInsightType===src_types.F.FUNNELS&&null!=experimentResults&&experimentResults.insight?experimentResults.insight.reduce(((sum,variantResult)=>{var _variantResult$;return(null===(_variantResult$=variantResult[0])||void 0===_variantResult$?void 0:_variantResult$.count)+sum}),0):0,experimentProgressPercent=experimentInsightType===src_types.F.FUNNELS?(funnelResultsPersonsTotal||0)/((null==experiment||null===(_experiment$parameter=experiment.parameters)||void 0===_experiment$parameter?void 0:_experiment$parameter.recommended_sample_size)||1)*100:Object(dayjs.a)().diff(null==experiment?void 0:experiment.start_date,"day")/((null==experiment||null===(_experiment$parameter2=experiment.parameters)||void 0===_experiment$parameter2?void 0:_experiment$parameter2.recommended_running_time)||1)*100,status=()=>isExperimentRunning?null!=experiment&&experiment.end_date?"complete":"running":"draft",variantLabelColors=[{background:"#35416b",color:"#fff"},{background:"#C278CE66",color:"#35416B"},{background:"#FFE6AE",color:"#35416B"},{background:"#8DA9E74D",color:"#35416B"}];return hasAvailableFeature(src_types.e.EXPERIMENTATION)?experimentLoading?Object(jsx_runtime.jsx)(skeleton.a,{active:!0}):experiment||"new"===experimentId?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"new"===experimentId||editingExistingExperiment?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:experimentLogic,formKey:"experiment",props:props,id:"experiment-form",enableFormOnSubmit:!0,className:"space-y-4 experiment-form",children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:editingExistingExperiment?"Edit experiment":"New experiment",buttons:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(LemonButton.a,{"data-attr":"cancel-experiment",type:"secondary",onClick:()=>{editingExistingExperiment?(setEditExperiment(!1),loadExperiment()):lib.router.actions.push(urls.a.experiments())},disabled:experimentLoading,children:"Cancel"}),Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary","data-attr":"save-experiment",htmlType:"submit",loading:experimentLoading,disabled:experimentLoading,children:"Save"})]})}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsx)(index_esm.BindLogic,{logic:insightLogic.d,props:insightProps,children:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",style:{maxWidth:"50%"},children:[Object(jsx_runtime.jsx)(Field.a,{name:"name",label:"Name",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"experiment-name"})}),Object(jsx_runtime.jsx)(Field.a,{name:"feature_flag_key",label:"Feature flag key",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"experiment-feature-flag-key",disabled:editingExistingExperiment})}),Object(jsx_runtime.jsx)(Field.a,{name:"description",label:Object(jsx_runtime.jsxs)("div",{children:["Description ",Object(jsx_runtime.jsx)("span",{className:"text-muted",children:"(optional)"})]}),children:Object(jsx_runtime.jsx)(src.LemonTextArea,{"data-attr":"experiment-description",className:"ph-ignore-input",placeholder:"Adding a helpful description can ensure others know what this experiment is about."})}),experiment.parameters.feature_flag_variants&&Object(jsx_runtime.jsxs)(col.a,{children:[Object(jsx_runtime.jsx)("label",{children:Object(jsx_runtime.jsx)("b",{children:"Experiment variants"})}),Object(jsx_runtime.jsx)("div",{className:"text-muted",children:"Participants are divided into variant groups evenly. All experiments must consist of a control group and at least one test group. Experiments may have at most 9 test groups. Variant names can only contain letters, numbers, hyphens, and underscores."}),Object(jsx_runtime.jsxs)(col.a,{className:"variants",children:[null===(_experiment$parameter3=experiment.parameters.feature_flag_variants)||void 0===_experiment$parameter3?void 0:_experiment$parameter3.map(((variant,index)=>Object(jsx_runtime.jsx)(kea_forms_lib.Group,{name:["parameters","feature_flag_variants",index],children:Object(jsx_runtime.jsxs)(row.a,{className:"feature-flag-variant "+(0===index?"border-t":index>=10?"border-b":""),children:[Object(jsx_runtime.jsx)("div",{className:"variant-label",style:0===index?{...variantLabelColors[index]}:{...variantLabelColors[index%3+1]},children:0===index?"Control":"Test"}),Object(jsx_runtime.jsx)(Field.a,{name:"key",className:"extend-variant-fully",children:Object(jsx_runtime.jsx)(src.LemonInput,{disabled:0===index||"new"!==experimentId,"data-attr":"experiment-variant-key","data-key-index":index.toString(),className:"ph-ignore-input",fullWidth:!0,placeholder:`example-variant-${index+1}`,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),Object(jsx_runtime.jsx)("div",{className:"float-right",children:"new"===experimentId&&!(0===index||1===index)&&Object(jsx_runtime.jsx)(tooltip.a,{title:"Delete this variant",placement:"bottomLeft",children:Object(jsx_runtime.jsx)(LemonButton.a,{status:"primary-alt",size:"small",icon:Object(jsx_runtime.jsx)(icons.O,{}),onClick:()=>removeExperimentGroup(index)})})})]},`${variant}-${index}`)},index))),(null!==(_experiment$parameter4=experiment.parameters.feature_flag_variants.length)&&void 0!==_experiment$parameter4?_experiment$parameter4:0)<10&&"new"===experimentId&&Object(jsx_runtime.jsx)("div",{className:"feature-flag-variant border-b",children:Object(jsx_runtime.jsx)(LemonButton.a,{onClick:()=>addExperimentGroup(),icon:Object(jsx_runtime.jsx)(icons.qc,{}),children:"Add test variant"})})]})]})]}),Object(jsx_runtime.jsx)(row.a,{className:"person-selection",children:Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsx)("div",{className:"mb-2",children:Object(jsx_runtime.jsx)("strong",{children:"Select participants"})}),Object(jsx_runtime.jsx)("div",{className:"text-muted",children:"Select the entities who will participate in this experiment. If no filters are set, 100% of participants will be targeted."}),Object(jsx_runtime.jsx)("div",{className:"mt-4 mb-2",children:Object(jsx_runtime.jsx)("strong",{children:"Participant type"})}),Object(jsx_runtime.jsx)(src.LemonSelect,{value:null!=experiment.filters.aggregation_group_type_index?experiment.filters.aggregation_group_type_index:-1,"data-attr":"participant-aggregation-filter",dropdownMatchSelectWidth:!1,onChange:rawGroupTypeIndex=>{const groupTypeIndex=-1!==rawGroupTypeIndex?rawGroupTypeIndex:void 0;setFilters({properties:[],aggregation_group_type_index:null!=groupTypeIndex?groupTypeIndex:void 0}),setExperimentValue("filters",{...experiment.filters,aggregation_group_type_index:groupTypeIndex,properties:[]})},options:[{value:-1,label:"Persons"},...groupTypes.map((groupType=>({value:groupType.group_type_index,label:Object(lib_utils.i)(aggregationLabel(groupType.group_type_index).plural)})))]}),Object(jsx_runtime.jsx)("div",{className:"mt-4 mb-2",children:Object(jsx_runtime.jsx)("strong",{children:"Filters"})}),Object(jsx_runtime.jsx)("div",{className:"mb-4",children:Object(jsx_runtime.jsx)(PropertyFilters.a,{pageKey:`experiment-participants-property-${JSON.stringify(experiment.filters)}`,propertyFilters:Object(lib_utils.r)(experiment.filters.properties),onChange:anyProperties=>{setFilters({properties:anyProperties.filter(utils.g)}),setExperimentValue("filters",{...experiment.filters,properties:anyProperties.filter(utils.g)})},taxonomicGroupTypes:taxonomicGroupTypesForSelection})}),flagAvailabilityWarning&&Object(jsx_runtime.jsxs)(LemonBanner.a,{type:"info",className:"mt-3 mb-3",children:["These properties aren't immediately available on first page load for unidentified persons. This experiment requires that at least one event is sent prior to becoming available to your product or website."," ",Object(jsx_runtime.jsxs)("a",{href:"https://posthog.com/docs/integrate/client/js#bootstrapping-flags",target:"_blank",children:[" ","Learn more about how to make feature flags available instantly."]})]}),Object(jsx_runtime.jsx)("div",{className:"mt-4 mb-2",children:Object(jsx_runtime.jsx)("strong",{children:"Advanced Options"})}),Object(jsx_runtime.jsxs)("div",{className:"mb-4",children:["For more advanced options like changing the rollout percentage and persisting feature flags, you can"," ","new"===experimentId?"change settings on the feature flag after creation.":Object(jsx_runtime.jsx)(Link.a,{to:experiment.feature_flag?urls.a.featureFlag(experiment.feature_flag):void 0,children:"change settings on the feature flag."})]})]})}),Object(jsx_runtime.jsxs)(row.a,{className:"metrics-selection",children:[Object(jsx_runtime.jsxs)(col.a,{span:12,children:[Object(jsx_runtime.jsxs)("div",{className:"mb-2","data-attr":"experiment-goal-type",children:[Object(jsx_runtime.jsx)("b",{children:"Goal type"}),Object(jsx_runtime.jsx)("div",{className:"text-muted",children:experimentInsightType===src_types.F.TRENDS?"Track counts of a specific event or action":"Track how many persons complete a sequence of actions and or events"})]}),Object(jsx_runtime.jsx)(src.LemonSelect,{value:experimentInsightType,onChange:val=>{var _experiment$filters;val&&createNewExperimentInsight({insight:val,properties:null==experiment||null===(_experiment$filters=experiment.filters)||void 0===_experiment$filters?void 0:_experiment$filters.properties})},dropdownMatchSelectWidth:!1,options:[{value:src_types.F.TRENDS,label:"Trend"},{value:src_types.F.FUNNELS,label:"Conversion funnel"}]}),Object(jsx_runtime.jsxs)("div",{className:"my-4",children:[Object(jsx_runtime.jsx)("b",{children:"Experiment goal"}),experimentInsightType===src_types.F.TRENDS&&Object(jsx_runtime.jsx)("div",{className:"text-muted",children:"Trend-based experiments can have at most one graph series. This metric is used to track the progress of your experiment."})]}),flagImplementationWarning&&Object(jsx_runtime.jsxs)(LemonBanner.a,{type:"info",className:"mt-3 mb-3",children:["We can't detect any feature flag information for this target metric. Ensure that you're using the latest PostHog client libraries, and make sure you manually send feature flag information for server-side libraries if necessary."," ",Object(jsx_runtime.jsxs)("a",{href:"https://posthog.com/docs/integrate/server/python#capture",target:"_blank",children:[" ","Read the docs for how to do this for server-side libraries."]})]}),experimentInsightType===src_types.F.FUNNELS&&Object(jsx_runtime.jsx)(ActionFilter.a,{bordered:!0,filters:funnelsFilters,setFilters:payload=>{setFilters(payload),setExperimentValue("filters",{...experiment.filters,...payload})},typeKey:`experiment-funnel-goal-${JSON.stringify(experiment.filters)}`,mathAvailability:ActionFilterRow.b.None,hideDeleteBtn:1===filterSteps.length,buttonCopy:"Add funnel step",showSeriesIndicator:!isStepsEmpty,seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.EventFeatureFlags,types.a.Cohorts,types.a.Elements]}),experimentInsightType===src_types.F.TRENDS&&Object(jsx_runtime.jsx)(ActionFilter.a,{bordered:!0,filters:trendsFilters,setFilters:payload=>{setFilters(payload),setExperimentValue("filters",{...experiment.filters,...payload})},typeKey:`experiment-trends-goal-${JSON.stringify(experiment.filters)}`,buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideDeleteBtn:!0,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.EventFeatureFlags,types.a.Cohorts,types.a.Elements]})]}),Object(jsx_runtime.jsxs)(col.a,{span:12,className:"pl-4",children:[Object(jsx_runtime.jsx)("div",{className:"card-secondary mb-4","data-attr":"experiment-preview",children:"Goal preview"}),Object(jsx_runtime.jsx)(InsightContainer.a,{disableHeader:experimentInsightType===src_types.F.TRENDS,disableTable:!0,disableCorrelationTable:!0})]})]}),Object(jsx_runtime.jsx)(Field.a,{name:"secondary_metrics",children:_ref2=>{let{value:value,onChange:onChange}=_ref2;return Object(jsx_runtime.jsx)(row.a,{className:"secondary-metrics",children:Object(jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("b",{children:"Secondary metrics"}),Object(jsx_runtime.jsx)("span",{className:"text-muted ml-2",children:"(optional)"})]}),Object(jsx_runtime.jsxs)("div",{className:"text-muted mt-1",children:["Use secondary metrics to monitor metrics related to your experiment goal. You can add up to three secondary metrics."," "]}),Object(jsx_runtime.jsx)(SecondaryMetrics,{onMetricsChange:onChange,initialMetrics:value,experimentId:experiment.id})]})})}}),Object(jsx_runtime.jsx)(card.a,{className:"experiment-preview",children:Object(jsx_runtime.jsx)(ExperimentPreview,{experimentId:experiment.id,trendCount:trendCount,trendExposure:exposure,funnelSampleSize:sampleSize,funnelEntrants:entrants,funnelConversionRate:conversionRate})}),Object(jsx_runtime.jsx)(row.a,{})]})}),Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[Object(jsx_runtime.jsx)(LemonButton.a,{"data-attr":"cancel-experiment",type:"secondary",onClick:()=>{editingExistingExperiment?(setEditExperiment(!1),loadExperiment()):lib.router.actions.push(urls.a.experiments())},disabled:experimentLoading,children:"Cancel"}),Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary","data-attr":"save-experiment",htmlType:"submit",loading:experimentLoading,disabled:experimentLoading,children:"Save"})]})]})}):experiment?Object(jsx_runtime.jsxs)("div",{className:"view-experiment",children:[Object(jsx_runtime.jsx)(row.a,{className:"draft-header",children:Object(jsx_runtime.jsxs)(row.a,{justify:"space-between",align:"middle",className:"w-full pb-4",children:[Object(jsx_runtime.jsxs)(col.a,{children:[Object(jsx_runtime.jsx)(row.a,{children:Object(jsx_runtime.jsx)(PageHeader.a,{style:{paddingRight:8},title:`${null==experiment?void 0:experiment.name}`,buttons:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(CopyToClipboard.a,{explicitValue:experiment.feature_flag_key,iconStyle:{color:"var(--muted-alt)"},children:Object(jsx_runtime.jsx)("span",{className:"text-muted",children:experiment.feature_flag_key})}),Object(jsx_runtime.jsx)(tag.a,{style:{alignSelf:"center"},color:{running:"green",draft:"default",complete:"purple"}[status()],children:Object(jsx_runtime.jsx)("b",{className:"uppercase",children:status()})}),experimentResults&&experiment.end_date&&Object(jsx_runtime.jsx)(tag.a,{style:{alignSelf:"center"},color:areResultsSignificant?"green":"geekblue",children:Object(jsx_runtime.jsx)("b",{className:"uppercase",children:areResultsSignificant?"Significant Results":"Results not significant"})})]})})}),Object(jsx_runtime.jsx)("span",{className:"exp-description",children:isExperimentRunning?Object(jsx_runtime.jsx)(EditableField.a,{multiline:!0,name:"description",value:experiment.description||"",placeholder:"Description (optional)",onSave:value=>updateExperiment({description:value}),maxLength:400,"data-attr":"experiment-description",compactButtons:!0}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:experiment.description||"There is no description for this experiment."})})]}),experiment&&!isExperimentRunning&&Object(jsx_runtime.jsxs)("div",{className:"flex items-center",children:[Object(jsx_runtime.jsx)(LemonButton.a,{type:"secondary",className:"mr-2",onClick:()=>setEditExperiment(!0),children:"Edit"}),Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",onClick:()=>launchExperiment(),children:"Launch"})]}),experiment&&isExperimentRunning&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2",children:[Object(jsx_runtime.jsx)(popconfirm.a,{placement:"topLeft",title:Object(jsx_runtime.jsxs)("div",{children:["Reset this experiment and go back to draft mode?",Object(jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"All collected data so far will be discarded."})]}),onConfirm:()=>resetRunningExperiment(),children:Object(jsx_runtime.jsx)(LemonButton.a,{type:"secondary",status:"primary",children:"Reset"})}),!experiment.end_date&&Object(jsx_runtime.jsx)(LemonButton.a,{type:"secondary",status:"danger",onClick:()=>endExperiment(),children:"Stop"}),(null==experiment?void 0:experiment.end_date)&&Object(dayjs.a)().isSameOrAfter(Object(dayjs.a)(experiment.end_date),"day")&&!experiment.archived&&Object(jsx_runtime.jsx)(LemonButton.a,{type:"secondary",status:"danger",onClick:()=>archiveExperiment(),children:Object(jsx_runtime.jsx)("b",{children:"Archive"})})]})]})}),Object(jsx_runtime.jsxs)(row.a,{children:[showWarning&&experimentResults&&areResultsSignificant&&!experiment.end_date&&Object(jsx_runtime.jsxs)(row.a,{align:"middle",className:"significant-results",children:[Object(jsx_runtime.jsx)(col.a,{span:20,style:{fontWeight:500,color:"#497342"},children:Object(jsx_runtime.jsxs)("div",{children:["Experiment results are significant."," ",experiment.end_date?"":"You can end your experiment now or let it run until complete."]})}),Object(jsx_runtime.jsx)(col.a,{span:4,children:experiment.end_date?Object(jsx_runtime.jsx)(CloseOutlined.a,{className:"close-button",onClick:()=>setShowWarning(!1)}):Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",onClick:()=>endExperiment(),children:"End experiment"})})]}),showWarning&&experimentResults&&!areResultsSignificant&&!experiment.end_date&&Object(jsx_runtime.jsxs)(row.a,{align:"top",className:"not-significant-results",children:[Object(jsx_runtime.jsxs)(col.a,{span:23,style:{fontWeight:500,color:"#2D2D2D"},children:[Object(jsx_runtime.jsx)("strong",{children:"Your results are not statistically significant"}),"."," ",significanceBannerDetails," ",null!=experiment&&experiment.end_date?"":"We don't recommend ending this experiment yet."," See our"," ",Object(jsx_runtime.jsxs)("a",{href:"https://posthog.com/docs/user-guides/experimentation#funnel-experiment-calculations",children:[" ","experimentation guide"," "]}),"for more information."," "]}),Object(jsx_runtime.jsx)(col.a,{span:1,children:Object(jsx_runtime.jsx)(CloseOutlined.a,{className:"close-button",onClick:()=>setShowWarning(!1)})})]}),showWarning&&experiment.end_date&&Object(jsx_runtime.jsxs)(row.a,{align:"top",className:"feature-flag-mods",children:[Object(jsx_runtime.jsxs)(col.a,{span:23,style:{fontWeight:500},children:[Object(jsx_runtime.jsx)("strong",{children:"Your experiment is complete, but the feature flag is still enabled."})," ","We recommend removing the feature flag from your code completely, instead of relying on this distribution."," ",Object(jsx_runtime.jsx)(Link.a,{to:experiment.feature_flag?urls.a.featureFlag(experiment.feature_flag):void 0,children:Object(jsx_runtime.jsx)("b",{children:"Adjust feature flag distribution"})})]}),Object(jsx_runtime.jsx)(col.a,{span:1,children:Object(jsx_runtime.jsx)(CloseOutlined.a,{className:"close-button",onClick:()=>setShowWarning(!1)})})]})]}),Object(jsx_runtime.jsxs)(row.a,{children:[Object(jsx_runtime.jsx)(LemonCollapse.a,{className:"w-full",defaultActiveKey:"experiment-details",panels:[{key:"experiment-details",header:"Experiment details",content:Object(jsx_runtime.jsxs)(row.a,{children:[Object(jsx_runtime.jsx)(col.a,{span:isExperimentRunning?12:24,children:Object(jsx_runtime.jsx)(ExperimentPreview,{experimentId:experiment.id,trendCount:trendCount,trendExposure:null==experiment?void 0:experiment.parameters.recommended_running_time,funnelSampleSize:null==experiment?void 0:experiment.parameters.recommended_sample_size,funnelConversionRate:conversionRate,funnelEntrants:isExperimentRunning?funnelResultsPersonsTotal:entrants})}),!experimentResultsLoading&&!experimentResults&&isExperimentRunning&&Object(jsx_runtime.jsx)(col.a,{span:12,children:Object(jsx_runtime.jsx)(ExperimentImplementationDetails,{experiment:experiment})}),experimentResults&&Object(jsx_runtime.jsxs)(col.a,{span:12,className:"mt-4",children:[Object(jsx_runtime.jsx)("div",{className:"mb-2",children:Object(jsx_runtime.jsx)("b",{children:"Experiment progress"})}),Object(jsx_runtime.jsx)(progress.a,{strokeWidth:20,showInfo:!1,percent:experimentProgressPercent,strokeColor:"var(--success)"}),experimentInsightType===src_types.F.TRENDS&&experiment.start_date&&Object(jsx_runtime.jsxs)(row.a,{justify:"space-between",className:"mt-2",children:[experiment.end_date?Object(jsx_runtime.jsxs)("div",{children:["Ran for"," ",Object(jsx_runtime.jsx)("b",{children:Object(dayjs.a)(experiment.end_date).diff(experiment.start_date,"day")})," ","days"]}):Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("b",{children:Object(dayjs.a)().diff(experiment.start_date,"day")})," ","days running"]}),Object(jsx_runtime.jsxs)("div",{children:["Goal:"," ",Object(jsx_runtime.jsx)("b",{children:null!==(_experiment$parameter5=null==experiment||null===(_experiment$parameter6=experiment.parameters)||void 0===_experiment$parameter6?void 0:_experiment$parameter6.recommended_running_time)&&void 0!==_experiment$parameter5?_experiment$parameter5:"Unknown"})," ","days"]})]}),experimentInsightType===src_types.F.FUNNELS&&Object(jsx_runtime.jsxs)(row.a,{justify:"space-between",className:"mt-2",children:[experiment.end_date?Object(jsx_runtime.jsxs)("div",{children:["Saw"," ",Object(jsx_runtime.jsx)("b",{children:Object(lib_utils.Q)(funnelResultsPersonsTotal)})," ","participants"]}):Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("b",{children:Object(lib_utils.Q)(funnelResultsPersonsTotal)})," ","participants seen"]}),Object(jsx_runtime.jsxs)("div",{children:["Goal:"," ",Object(jsx_runtime.jsx)("b",{children:Object(lib_utils.Q)((null==experiment||null===(_experiment$parameter7=experiment.parameters)||void 0===_experiment$parameter7?void 0:_experiment$parameter7.recommended_sample_size)||0)})," ","participants"]})]})]}),Object(jsx_runtime.jsx)(col.a,{children:Object(jsx_runtime.jsx)(SecondaryMetrics,{experimentId:experiment.id,onMetricsChange:metrics=>updateExperimentSecondaryMetrics(metrics),initialMetrics:experiment.secondary_metrics})})]})}]}),!(null!=experiment&&experiment.start_date)&&Object(jsx_runtime.jsx)("div",{className:"mt-4 w-full",children:Object(jsx_runtime.jsx)(ExperimentImplementationDetails,{experiment:experiment})})]}),Object(jsx_runtime.jsxs)("div",{className:"experiment-result",children:[experimentResults?((null==experiment||null===(_experiment$parameter8=experiment.parameters)||void 0===_experiment$parameter8||null===(_experiment$parameter9=_experiment$parameter8.feature_flag_variants)||void 0===_experiment$parameter9?void 0:_experiment$parameter9.length)||0)>4?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)(row.a,{className:"border-t",justify:"space-between",style:{paddingTop:8,paddingBottom:8},children:[Object(jsx_runtime.jsx)(col.a,{span:2*secondaryColumnSpan,children:"Variant"}),sortedExperimentResultVariants.map(((variant,idx)=>Object(jsx_runtime.jsx)(col.a,{span:secondaryColumnSpan,style:{color:Object(colors.d)(getIndexForVariant(variant,experimentInsightType))},children:Object(jsx_runtime.jsx)("b",{children:Object(lib_utils.i)(variant)})},idx)))]}),Object(jsx_runtime.jsxs)(row.a,{className:"border-t",justify:"space-between",style:{paddingTop:8,paddingBottom:8},children:[Object(jsx_runtime.jsx)(col.a,{span:2*secondaryColumnSpan,children:experimentInsightType===src_types.F.TRENDS?"Count":"Conversion Rate"}),sortedExperimentResultVariants.map(((variant,idx)=>Object(jsx_runtime.jsx)(col.a,{span:secondaryColumnSpan,children:experimentInsightType===src_types.F.TRENDS?countDataForVariant(variant):`${conversionRateForVariant(variant)}%`},idx)))]}),Object(jsx_runtime.jsxs)(row.a,{className:"border-t",justify:"space-between",style:{paddingTop:8,paddingBottom:8},children:[Object(jsx_runtime.jsx)(col.a,{span:2*secondaryColumnSpan,children:"Probability to be the best"}),sortedExperimentResultVariants.map(((variant,idx)=>Object(jsx_runtime.jsx)(col.a,{span:secondaryColumnSpan,children:Object(jsx_runtime.jsx)("b",{children:experimentResults.probability[variant]?`${(100*experimentResults.probability[variant]).toFixed(1)}%`:"--"})},idx)))]})]}):Object(jsx_runtime.jsx)(row.a,{justify:"space-around",style:{flexFlow:"nowrap"},children:Object.keys(experimentResults.probability).sort(((a,b)=>experimentResults.probability[b]-experimentResults.probability[a])).map(((variant,idx)=>Object(jsx_runtime.jsxs)(col.a,{className:"pr-4",children:[Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)("b",{children:Object(lib_utils.i)(variant)})}),experimentInsightType===src_types.F.TRENDS?Object(jsx_runtime.jsxs)(row.a,{children:[Object(jsx_runtime.jsx)("b",{style:{paddingRight:4},children:Object(jsx_runtime.jsxs)(row.a,{children:["action"in experimentResults.insight[0]&&Object(jsx_runtime.jsx)(EntityFilterInfo.a,{filter:experimentResults.insight[0].action}),Object(jsx_runtime.jsx)("span",{style:{paddingLeft:4},children:"count:"})]})})," ",countDataForVariant(variant)," ",areTrendResultsConfusing&&0===idx&&Object(jsx_runtime.jsx)(tooltip.a,{placement:"right",title:"It might seem confusing that the best variant has lower absolute count, but this can happen when fewer people are exposed to this variant, so its relative count is higher.",children:Object(jsx_runtime.jsx)(InfoCircleOutlined.a,{style:{padding:"4px 2px"}})})]}):Object(jsx_runtime.jsxs)(row.a,{children:[Object(jsx_runtime.jsx)("b",{style:{paddingRight:4},children:"Conversion rate:"})," ",conversionRateForVariant(variant),"%"]}),Object(jsx_runtime.jsx)(progress.a,{percent:Number((100*experimentResults.probability[variant]).toFixed(1)),size:"small",showInfo:!1,strokeColor:Object(colors.d)(getIndexForVariant(variant,experimentInsightType))}),Object(jsx_runtime.jsxs)("div",{children:["Probability that this variant is the best:"," ",Object(jsx_runtime.jsxs)("b",{children:[(100*experimentResults.probability[variant]).toFixed(1),"%"]})]})]},idx)))}):experimentResultsLoading&&Object(jsx_runtime.jsx)("div",{className:"text-center",children:Object(jsx_runtime.jsx)(skeleton.a,{active:!0})}),experimentResults?Object(jsx_runtime.jsx)(index_esm.BindLogic,{logic:insightLogic.d,props:{dashboardItemId:experimentResults.fakeInsightId,cachedInsight:{short_id:experimentResults.fakeInsightId,filters:{...experimentResults.filters,insight:experimentInsightType,...experimentInsightType===src_types.F.FUNNELS&&{layout:constants.k.vertical,funnel_viz_type:src_types.B.Steps},...experimentInsightType===src_types.F.TRENDS&&{display:src_types.k.ActionsLineGraphCumulative}},result:experimentResults.insight,disable_baseline:!0},doNotLoad:!0},children:Object(jsx_runtime.jsx)("div",{className:"mt-4",children:Object(jsx_runtime.jsx)(InsightContainer.a,{disableHeader:!0,disableCorrelationTable:experimentInsightType===src_types.F.FUNNELS,disableLastComputation:!0})})}):experiment.start_date&&Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsx)("div",{className:"no-experiment-results",children:!experimentResultsLoading&&Object(jsx_runtime.jsxs)("div",{className:"text-center",children:[Object(jsx_runtime.jsx)("b",{children:"There are no results for this experiment yet."}),Object(jsx_runtime.jsxs)("div",{className:"text-sm ",children:[!!experimentResultCalculationError&&`${experimentResultCalculationError}. `," ","Wait a bit longer for your users to be exposed to the experiment. Double check your feature flag implementation if you're still not seeing results."]})]})})})]})]}):Object(jsx_runtime.jsx)(skeleton.a,{active:!0})}):Object(jsx_runtime.jsx)(NotFound.a,{object:"experiment"}):Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:"Experiments"}),Object(jsx_runtime.jsx)(ExperimentsPayGate.a,{})]})}},"./frontend/src/scenes/experiments/ExperimentsPayGate.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ExperimentsPayGate}));var lib_components_PayGatePage_PayGatePage__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/lib/components/PayGatePage/PayGatePage.tsx"),_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/types.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function ExperimentsPayGate(){return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(lib_components_PayGatePage_PayGatePage__WEBPACK_IMPORTED_MODULE_0__.a,{featureKey:_types__WEBPACK_IMPORTED_MODULE_1__.e.EXPERIMENTATION,header:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:["Introducing ",Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("span",{className:"highlight",children:"Experimentation"}),"!"]}),caption:"Improve your product by A/B testing new features to discover what works best for your users.",docsLink:"https://posthog.com/docs/user-guides/experimentation"})}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,'.experiment-form .metrics-selection,.experiment-form .person-selection{border-top:1px solid var(--border);padding-top:1rem;width:100%}.experiment-form .person-selection{align-items:center;justify-content:space-between}.experiment-form .insights-graph-container{margin-bottom:1rem;background-color:#fff}.experiment-form .insights-graph-container .ant-card-head{border-bottom:1px solid var(--border);min-height:unset;background-color:var(--bg-light);padding-left:1rem;padding-right:1rem}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title{padding:.5rem 0}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter{font-size:14px}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter:not(:last-child),.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter span.head-title-item{margin-right:.5rem}.experiment-form .insights-graph-container .display-config-inner{display:flex;align-items:center;justify-content:space-between;overflow-x:auto}.experiment-form .insights-graph-container .ant-card-body{padding:0}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left{width:100%}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right{width:100%;height:min(90vh - 16rem,36rem);max-width:300px;padding:0 1rem 1rem 0;display:flex;align-items:center}.experiment-form .insights-graph-container .LineGraph{width:calc(100% - 2rem);height:calc(100% - 3rem)}.experiment-form .insights-graph-header{margin-top:0!important;margin-bottom:0!important;padding-left:1rem;padding-right:1rem;min-height:48px}.experiment-form .experiment-preview{margin-bottom:1rem;border-bottom:1px solid var(--border)}.experiment-form .experiment-preview .mde-slider .ant-slider-handle{border:none}.experiment-form .experiment-preview .mde-slider .ant-slider-rail{background-color:#e5ebff}.experiment-form .variants{margin-top:.5rem;padding-bottom:1rem}.experiment-form .variants .ant-form-horizontal{min-height:32px}.experiment-form .variants .border-top{border-top-left-radius:4px;border-top-right-radius:4px}.experiment-form .variants .border-bottom{border-bottom-left-radius:4px;border-bottom-right-radius:4px}.experiment-form .variants .feature-flag-variant{display:flex;align-items:center;padding:.5rem;background:#fff;border-bottom-width:1px;border-bottom-color:var(--border);border-top:1px solid var(--border);border-left:1px solid var(--border);border-right:1px solid var(--border)}.experiment-form .variants .feature-flag-variant .extend-variant-fully{flex:1}.experiment-form .variants .variant-label{display:flex;flex-direction:row;justify-content:center;align-items:center;border-radius:4px;color:#fff;min-width:52px;padding:2px 6px;margin-right:8px;font-size:12px;font-weight:500;letter-spacing:.01em}.experiment-form .secondary-metrics{margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border);margin-bottom:1rem;width:100%}.experiment-form .ant-input-number-disabled,.experiment-form .ant-input[disabled]{color:#000}.view-experiment .draft-header{margin-bottom:1rem;border-bottom:1px solid var(--border)}.view-experiment .exp-description{font-style:italic;color:var(--muted)}.view-experiment .participants{background-color:#fff}.view-experiment .participants .ant-collapse-header{padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem}.view-experiment .variants-list li{display:inline}.view-experiment .variants-list li:after{content:", "}.view-experiment .variants-list li:last-child:after{content:""}.view-experiment .experiment-result{padding-top:1rem}.view-experiment .significant-results{padding:.5rem;width:100%;background:rgba(119,185,108,.1);border-radius:4px;text-align:center;margin-bottom:1rem}.view-experiment .not-significant-results{padding:.5rem;width:100%;background:rgba(83,117,255,.1);border-radius:4px;margin-bottom:1rem}.view-experiment .feature-flag-mods{padding:.5rem;width:100%;background:#f6ebf8;border-radius:4px;margin-bottom:1rem}.view-experiment .ant-collapse-content-box{display:flex;flex-flow:column}.view-experiment .secondary-progress{margin-top:.5rem}.view-experiment .secondary-progress li:before{content:"";display:inline-block;font-weight:900;margin-right:4px}.view-experiment .secondary-progress .ant-progress-inner,.view-experiment .secondary-progress .ant-progress-inner .ant-progress-bg{border-radius:4px}.view-experiment .no-experiment-results{display:flex;justify-content:center;align-items:center;margin-top:1rem;background-color:var(--side);border:1px solid var(--border);width:100%;min-height:320px;font-size:24px}.view-experiment .computation-time-and-sampling-notice{margin-top:8px}.preview-conversion-goal-num{height:24px;width:24px;text-align:center;background-color:var(--side);color:var(--primary-alt);font-weight:700;margin-right:.5rem}.experiment-preview-row{border-bottom:1px solid var(--border);padding-bottom:1rem;margin-bottom:1rem}.experiment-preview-row:last-child{border-bottom:none;padding-bottom:0;margin-bottom:0}.metric-name{border:1px solid var(--border);border-radius:4px;padding:8px 8px 8px 16px;margin-left:.5rem;flex:1}.experiment-implementation-details,.experiment-workflow{border-color:var(--dark-grey)}.experiment-implementation-details .ant-card-head,.experiment-workflow .ant-card-head{padding-left:1rem;padding-right:1rem;border:none}.experiment-implementation-details .ant-card-head-title,.experiment-workflow .ant-card-head-title{border-bottom:1px solid var(--border)}.experiment-implementation-details .exp-workflow-step,.experiment-workflow .exp-workflow-step{margin-bottom:.5rem;padding:.5rem;border-radius:4px}.experiment-implementation-details .exp-workflow-step:hover,.experiment-workflow .exp-workflow-step:hover{cursor:pointer}.experiment-implementation-details .step-completed,.experiment-workflow .step-completed{background-color:#e5ebff}',""]),module.exports=exports}}]);