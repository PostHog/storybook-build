(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(z,j,r){"use strict";r.r(j),r.d(j,"AppMetricsTab",function(){return u}),r.d(j,"appMetricsSceneLogic",function(){return N});var y=r("./node_modules/@babel/runtime/helpers/slicedToArray.js"),U=r.n(y),R=r("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),p=r.n(R),B=r("./node_modules/@babel/runtime/regenerator/index.js"),d=r.n(B),K=r("./node_modules/core-js/modules/es.array.iterator.js"),Q=r.n(K),W=r("./node_modules/core-js/modules/es.object.to-string.js"),V=r.n(W),h=r("./node_modules/core-js/modules/web.dom-collections.iterator.js"),X=r.n(h),F=r("./node_modules/core-js/modules/es.array.concat.js"),Y=r.n(F),x=r("./node_modules/core-js/modules/es.function.name.js"),Z=r.n(x),H=r("./node_modules/core-js/modules/es.array.includes.js"),w=r.n(H),S=r("./node_modules/core-js/modules/es.string.includes.js"),k=r.n(S),J=r("./node_modules/core-js/modules/es.array.filter.js"),q=r.n(J),$=r("./node_modules/core-js/modules/es.number.constructor.js"),ee=r.n($),E=r("./node_modules/kea/lib/index.esm.js"),g=r("./node_modules/kea-loaders/lib/index.js"),re=r.n(g),v=r("./frontend/src/scenes/urls.ts"),m=r("./frontend/src/lib/api.ts"),M=r("./frontend/src/scenes/teamLogic.tsx"),D=r("./node_modules/kea-router/lib/index.js"),te=r.n(D),O=r("./frontend/src/lib/utils.tsx"),P=r("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),G=r("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),u;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.ScheduledTask="scheduledTask",t.HistoricalExports="historical_exports"})(u||(u={}));var T="-30d",b=[u.ProcessEvent,u.OnEvent,u.ExportEvents,u.ScheduledTask],N=Object(E.kea)([Object(E.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(E.props)({}),Object(E.key)(function(t){return t.pluginConfigId}),Object(E.actions)({setActiveTab:function(s){return{tab:s}},setDateFrom:function(s){return{dateFrom:s}},openErrorDetailsModal:function(s,n,e){return{errorType:s,category:n,jobId:e}},closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),Object(E.reducers)({activeTab:[null,{setActiveTab:function(s,n){var e=n.tab;return e}}],dateFrom:[T,{setDateFrom:function(s,n){var e=n.dateFrom;return e}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(s,n){var e=n.errorType;return e},closeErrorDetailsModal:function(){return null}}]}),Object(g.loaders)(function(t){var s=t.values,n=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var e=p()(d.a.mark(function o(){return d.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,m.b.get("api/projects/".concat(M.a.values.currentTeamId,"/plugin_configs/").concat(n.pluginConfigId));case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},o)}));function i(){return e.apply(this,arguments)}return i}()}],appMetricsResponse:[null,{loadMetrics:function(){var e=p()(d.a.mark(function o(){var a;return d.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=Object(O.Eb)({category:s.activeTab,date_from:s.dateFrom}),c.next=3,m.b.get("api/projects/".concat(M.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"?").concat(a));case 3:return c.abrupt("return",c.sent);case 4:case"end":return c.stop()}},o)}));function i(){return e.apply(this,arguments)}return i}()}],historicalExports:[[],{loadHistoricalExports:function(){var e=p()(d.a.mark(function o(){var a,l;return d.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,m.b.get("api/projects/".concat(M.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/historical_exports"));case 2:return a=_.sent,l=a.results,_.abrupt("return",l);case 5:case"end":return _.stop()}},o)}));function i(){return e.apply(this,arguments)}return i}()}],errorDetails:[[],{openErrorDetailsModal:function(){var e=p()(d.a.mark(function o(a){var l,c,_,C,A,L;return d.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return l=a.category,c=a.jobId,_=a.errorType,C=Object(O.Eb)({category:l,job_id:c,error_type:_}),f.next=4,m.b.get("api/projects/".concat(M.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/error_details?").concat(C));case 4:return A=f.sent,L=A.result,f.abrupt("return",L);case 7:case"end":return f.stop()}},o)}));function i(o){return e.apply(this,arguments)}return i}()}]}}),Object(E.selectors)(function(t){var s=t.values,n=t.actions;return{breadcrumbs:[function(e){return[e.pluginConfig,function(i,o){return o.pluginConfigId}]},function(e,i){var o;return[{name:"Apps",path:v.a.projectApps()},{name:e==null||(o=e.plugin_info)===null||o===void 0?void 0:o.name,path:v.a.appMetrics(i)}]}],showTab:[function(){return[]},function(){return function(e){if(s.pluginConfigLoading||!s.pluginConfig||!s.pluginConfig.plugin_info.capabilities)return!1;var i=s.pluginConfig.plugin_info.capabilities,o=i.methods.includes("exportEvents");return e===u.HistoricalExports?o:e===u.OnEvent&&o?!1:e===u.ScheduledTask?!o&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(a){return i.scheduled_tasks.includes(a)}):i.methods.includes(e)}}],interfaceJobsProps:[function(e){return[e.pluginConfig]},function(e){return!e||!e.plugin_info.public_jobs||!(e!=null&&e.enabled)?null:{jobName:P.b,jobSpec:e.plugin_info.public_jobs[P.b],pluginConfigId:e.id,pluginId:e.plugin,onSubmit:n.loadHistoricalExports}}]}}),Object(E.listeners)(function(t){var s=t.values,n=t.actions;return{loadPluginConfigSuccess:function(){if(!s.activeTab){var i=b.filter(function(l){return s.showTab(l)}),o=U()(i,1),a=o[0];n.setActiveTab(a)}},setActiveTab:function(i){var o=i.tab;o===u.HistoricalExports?n.loadHistoricalExports():n.loadMetrics()},setDateFrom:function(){n.loadMetrics()},openHistoricalExportModal:function(){s.interfaceJobsProps&&Object(G.a)(s.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}}),Object(D.actionToUrl)(function(t){var s=t.values,n=t.props;return{setActiveTab:function(){return I(s,n)},setDateFrom:function(){return I(s,n)}}}),Object(D.urlToAction)(function(t){var s=t.values,n=t.actions,e=t.props;return{"/app/:pluginConfigId/:page":function(o,a){e.pluginConfigId===Number(o.pluginConfigId)&&(s.pluginConfig||n.loadPluginConfig(),o.page===u.HistoricalExports?n.setActiveTab(u.HistoricalExports):(a.tab&&b.includes(a.tab)&&n.setActiveTab(a.tab),a.from&&n.setDateFrom(a.from)))}}})]);function I(t,s){if(t.activeTab===u.HistoricalExports)return v.a.appHistoricalExports(s.pluginConfigId);var n={};return t.activeTab&&(n.tab=t.activeTab),t.dateFrom!==T&&(n.from=t.dateFrom),v.a.appMetrics(s.pluginConfigId,n)}}}]);
