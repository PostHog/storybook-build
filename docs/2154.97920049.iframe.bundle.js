(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[2154],{"./frontend/src/scenes/persons-management/PersonsManagementScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PersonsManagementScene:()=>PersonsManagementScene,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),groupsModel=__webpack_require__("./frontend/src/models/groupsModel.ts"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),groupsAccessLogic=__webpack_require__("./frontend/src/lib/introductions/groupsAccessLogic.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Cohorts=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/cohorts/Cohorts.scss"),Cohorts_default=__webpack_require__.n(Cohorts),options={insert:"head",singleton:!1};injectStylesIntoStyleTag_default()(Cohorts_default(),options);Cohorts_default().locals;var hedgehogs=__webpack_require__("./frontend/src/lib/components/hedgehogs.tsx"),ProductIntroduction=__webpack_require__("./frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonDivider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDivider/index.ts"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),types=__webpack_require__("./frontend/src/types.ts"),cohortsModel=__webpack_require__("./frontend/src/models/cohortsModel.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function Cohorts_Cohorts(){const{cohorts,cohortsSearch,cohortsLoading}=(0,index_esm.useValues)(cohortsModel.Q),{deleteCohort,exportCohortPersons}=(0,index_esm.useActions)(cohortsModel.Q),{hasAvailableFeature}=(0,index_esm.useValues)(userLogic.userLogic),{searchParams}=(0,index_esm.useValues)(lib.router),[searchTerm,setSearchTerm]=(0,react.useState)(""),{user}=(0,index_esm.useValues)(userLogic.userLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h),shouldShowEmptyState=0==cohorts?.length&&!cohortsLoading,shouldShowProductIntroduction=!user?.has_seen_product_intro_for?.[types.Md.COHORTS]&&!!featureFlags[constants.y8.SHOW_PRODUCT_INTRO_EXISTING_PRODUCTS],columns=[{title:"Name",dataIndex:"name",className:"ph-no-capture",width:"30%",sorter:(a,b)=>(a.name||"").localeCompare(b.name||""),render:function Render(name,_ref){let{id,description}=_ref;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Link.r,{to:(0,lib.combineUrl)(urls.j.cohort(id),searchParams).url,className:"row-name",children:name||"Untitled"}),hasAvailableFeature(types.P$.DASHBOARD_COLLABORATION)&&description&&(0,jsx_runtime.jsx)("span",{className:"row-description",children:description})]})}},{title:"Users in cohort",align:"right",render:function RenderCount(_,cohort){return cohort.count?.toLocaleString()},dataIndex:"count",sorter:(a,b)=>(a.count||0)-(b.count||0)},(0,columnUtils.JB)(),(0,columnUtils.rw)(),{title:"Last calculated",tooltip:"PostHog calculates what users belong to each cohort. This is then used when filtering on cohorts in the Trends page etc. Calculating happens every 24 hours, or whenever a cohort is updated",render:function RenderCalculation(_,cohort){return cohort.is_static?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"N/A"}):cohort.is_calculating?(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:["in progress ",(0,jsx_runtime.jsx)(Spinner.$,{className:"ml-2"})]}):(0,dayjs.Bv)(cohort.last_calculation).fromNow()}},{width:0,render:function RenderActions(_,cohort){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",to:urls.j.cohort(cohort.id),fullWidth:!0,children:"Edit"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",to:(0,lib.combineUrl)(urls.j.replay(),{filters:{properties:[{key:"id",label:cohort.name,type:"cohort",value:cohort.id}]}}).url,fullWidth:!0,children:"View session recordings"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",onClick:()=>exportCohortPersons(cohort.id,["distinct_ids.0","id","name","properties.email"]),tooltip:"Export specific columns for users belonging to this cohort in CSV format. Includes distinct id, internal id, email, and name",fullWidth:!0,children:"Export important columns for users"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",onClick:()=>exportCohortPersons(cohort.id),tooltip:"Export all users belonging to this cohort in CSV format.",fullWidth:!0,children:"Export all columns for users"}),(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"danger",onClick:()=>deleteCohort(cohort),fullWidth:!0,children:"Delete cohort"})]})})}}];return(0,jsx_runtime.jsxs)("div",{children:[(shouldShowProductIntroduction||shouldShowEmptyState)&&(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Cohorts",productKey:types.Md.COHORTS,thingName:"cohort",description:"Use cohorts to group people together, such as users who used your app in the last week, or people who viewed the signup page but didnâ€™t convert.",isEmpty:0==cohorts?.length,docsURL:"https://posthog.com/docs/data/cohorts",action:()=>lib.router.actions.push(urls.j.cohort("new")),customHog:hedgehogs.ListHog}),!shouldShowEmptyState&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-between items-center mb-4 gap-2",children:(0,jsx_runtime.jsx)(src.LemonInput,{type:"search",placeholder:"Search for cohorts",onChange:setSearchTerm,value:searchTerm})}),(0,jsx_runtime.jsx)(LemonTable.g,{columns,loading:cohortsLoading,rowKey:"id",pagination:{pageSize:100},dataSource:searchTerm?cohortsSearch(searchTerm):null!=cohorts?cohorts:[],nouns:["cohort","cohorts"],"data-attr":"cohorts-table"})]})]})}var CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),PropertiesTable=__webpack_require__("./frontend/src/lib/components/PropertiesTable/index.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonInput=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx"),GroupsIntroduction=__webpack_require__("./frontend/src/scenes/groups/GroupsIntroduction.tsx"),GroupActorDisplay=__webpack_require__("./frontend/src/scenes/persons/GroupActorDisplay.tsx"),groupsListLogic=__webpack_require__("./frontend/src/scenes/groups/groupsListLogic.ts");function Groups(_ref){let{groupTypeIndex}=_ref;const{groupTypeName:{singular,plural},groups,groupsLoading,search}=(0,index_esm.useValues)((0,groupsListLogic.z)({groupTypeIndex})),{loadGroups,setSearch}=(0,index_esm.useActions)((0,groupsListLogic.z)({groupTypeIndex})),{groupsAccessStatus}=(0,index_esm.useValues)(groupsAccessLogic.e);if(void 0===groupTypeIndex)throw new Error("groupTypeIndex is undefined");if(groupsAccessStatus==groupsAccessLogic.Q.HasAccess||groupsAccessStatus==groupsAccessLogic.Q.HasGroupTypes||groupsAccessStatus==groupsAccessLogic.Q.NoAccess)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(GroupsIntroduction.S,{access:groupsAccessStatus})});const columns=[{title:(0,utils.fm)(plural),key:"group_key",render:function Render(_,group){return(0,jsx_runtime.jsx)(Link.r,{to:urls.j.group(group.group_type_index.toString(),group.group_key),children:(0,GroupActorDisplay.O)(group.group_key,group.group_properties)})}},{title:"First seen",key:"created_at",render:function Render(_,group){return(0,jsx_runtime.jsx)(TZLabel.w,{time:group.created_at})}}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonInput.D,{type:"search",placeholder:`Search for ${plural}`,onChange:setSearch,value:search,"data-attr":"group-search",className:"mb-4"}),(0,jsx_runtime.jsx)(LemonDivider.p,{className:"mb-4"}),(0,jsx_runtime.jsx)(LemonTable.g,{columns,rowKey:"group_key",loading:groupsLoading,dataSource:groups.results,expandable:{expandedRowRender:function RenderPropertiesTable(_ref2){let{group_properties}=_ref2;return(0,jsx_runtime.jsx)(PropertiesTable.V,{type:types.ll.Group,properties:group_properties})},rowExpandable:_ref3=>{let{group_properties}=_ref3;return!!group_properties&&Object.keys(group_properties).length>0}},pagination:{controlled:!0,onBackward:groups.previous?()=>{loadGroups(groups.previous),window.scrollTo(0,0)}:void 0,onForward:groups.next?()=>{loadGroups(groups.next),window.scrollTo(0,0)}:void 0},emptyState:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",children:["No ",plural," found. Make sure to send properties with your ",singular," for them to show up in the list."," ",(0,jsx_runtime.jsx)(Link.r,{to:"https://posthog.com/docs/user-guides/group-analytics",target:"_blank",children:"Read more here."})]}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`posthog.group('${singular}', 'id:5', {\n    name: 'Awesome ${singular}',\n    value: 11\n});`})]})})]})}try{Groups.displayName="Groups",Groups.__docgenInfo={description:"",displayName:"Groups",props:{groupTypeIndex:{defaultValue:null,description:"",name:"groupTypeIndex",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/groups/Groups.tsx#Groups"]={docgenInfo:Groups.__docgenInfo,name:"Groups",path:"frontend/src/scenes/groups/Groups.tsx#Groups"})}catch(__react_docgen_typescript_loader_error){}var sceneTypes=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),DataTable_utils=__webpack_require__("./frontend/src/queries/nodes/DataTable/utils.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts");const personsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","persons","personsSceneLogic"]),(0,index_esm.connect)({values:[featureFlagLogic.h,["featureFlags"]]}),(0,index_esm.selectors)({queryFlagEnabled:[s=>[s.featureFlags],featureFlags=>!!featureFlags?.[constants.y8.PERSONS_HOGQL_QUERY]]}),(0,index_esm.actions)({setQuery:query=>({query})}),(0,index_esm.reducers)((_ref=>{let{selectors}=_ref;return{query:[state=>function(){let usePersonsQuery=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{kind:schema.OH.DataTableNode,source:usePersonsQuery?{kind:schema.OH.PersonsQuery,select:(0,DataTable_utils.Qi)(schema.OH.PersonsQuery)}:{kind:schema.OH.PersonsNode},full:!0,propertiesViaUrl:!0}}(selectors.queryFlagEnabled(state)),{setQuery:(_,_ref2)=>{let{query}=_ref2;return query}}]}}))]);var Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx");function Persons(){const{query}=(0,index_esm.useValues)(personsSceneLogic),{setQuery}=(0,index_esm.useActions)(personsSceneLogic);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(Query.A,{query,setQuery})})}const personsManagementSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","persons-management","personsManagementSceneLogic"]),(0,index_esm.connect)({values:[groupsModel.$,["aggregationLabel","groupTypes","groupsAccessStatus","aggregationLabel"]]}),(0,index_esm.actions)({setTabKey:tabKey=>({tabKey})}),(0,index_esm.reducers)({tabKey:["persons",{setTabKey:(_,_ref)=>{let{tabKey}=_ref;return tabKey}}]}),(0,index_esm.selectors)({tabs:[s=>[s.groupTabs],groupTabs=>[{key:"persons",url:urls.j.persons(),label:"People",content:(0,jsx_runtime.jsx)(Persons,{})},{key:"cohorts",url:urls.j.cohorts(),label:"Cohorts",content:(0,jsx_runtime.jsx)(Cohorts_Cohorts,{}),buttons:(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"new-cohort",onClick:()=>lib.router.actions.push(urls.j.cohort("new")),children:"New Cohort"})},...groupTabs]],activeTab:[s=>[s.tabs,s.tabKey],(tabs,tabKey)=>{var _tabs$find;return null!==(_tabs$find=tabs.find((x=>x.key===tabKey)))&&void 0!==_tabs$find?_tabs$find:null}],groupTabs:[s=>[s.groupTypes,s.groupsAccessStatus,s.aggregationLabel],(groupTypes,groupsAccessStatus,aggregationLabel)=>[...[groupsAccessLogic.Q.HasAccess,groupsAccessLogic.Q.HasGroupTypes,groupsAccessLogic.Q.NoAccess].includes(groupsAccessStatus)?[{key:"groups-intro",label:"Groups",url:urls.j.groups(0),content:(0,jsx_runtime.jsx)(Groups,{groupTypeIndex:0})}]:Array.from(groupTypes.values()).map((groupType=>({key:`groups-${groupType.group_type_index}`,label:(0,utils.fm)(aggregationLabel(groupType.group_type_index).plural),url:urls.j.groups(groupType.group_type_index),content:(0,jsx_runtime.jsx)(Groups,{groupTypeIndex:groupType.group_type_index})})))]],breadcrumbs:[s=>[s.tabs,s.activeTab],(tabs,activeTab)=>[{key:sceneTypes.x.PersonsManagement,name:"People",path:tabs[0].url},activeTab?{key:activeTab.key,name:activeTab.label,path:activeTab.url}:{key:"loading",name:"Loading..."}]]}),(0,lib.actionToUrl)((_ref2=>{let{values}=_ref2;return{setTabKey:_ref3=>{let{tabKey}=_ref3;return values.tabs.find((x=>x.key===tabKey))?.url||values.tabs[0].url}}})),(0,lib.urlToAction)((_ref4=>{let{actions}=_ref4;return{[urls.j.persons()]:()=>{actions.setTabKey("persons")},[urls.j.cohorts()]:()=>{actions.setTabKey("cohorts")},[urls.j.groups(":key")]:_ref5=>{let{key}=_ref5;actions.setTabKey(`groups-${key}`)}}}))]);function PersonsManagementScene(){const{tabs,activeTab,tabKey}=(0,index_esm.useValues)(personsManagementSceneLogic),{setTabKey}=(0,index_esm.useActions)(personsManagementSceneLogic),{showGroupsOptions}=(0,index_esm.useValues)(groupsModel.$),lemonTabs=tabs.map((tab=>({key:tab.key,label:(0,jsx_runtime.jsx)("span",{"data-attr":`persons-management-${tab.key}-tab`,children:tab.label}),content:tab.content})));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:"People",caption:`A catalog of your product's end users, lists of users who have something in common to use in analytics or feature flags${showGroupsOptions?" and groups":""}.`,buttons:activeTab?.buttons}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tabKey,onChange:t=>setTabKey(t),tabs:lemonTabs})]})}const scene={component:PersonsManagementScene,logic:personsManagementSceneLogic}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/cohorts/Cohorts.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".cohorts-drawer .ant-drawer-content-wrapper{max-width:850px!important;width:100%!important}.cohort-recalculating{background-color:var(--mid);padding:.5rem 1rem;margin-top:1rem;border-radius:var(--radius)}.cohort-recalculating .ant-spin-spinning{margin-right:.375rem}.cohort-csv-dragger{height:155px!important;background-color:transparent!important;margin-top:1rem;border:2px dashed var(--primary)!important;border-radius:4px!important}.cohort-csv-dragger:hover{border-color:var(--primary-3000-hover)!important}.cohort-csv-dragger .ant-upload-drag-container{display:flex!important;justify-content:center;flex-direction:column;align-items:center;height:100%;padding:0 1rem}.cohort-csv-dragger .ant-upload-drag-container .ant-upload-text{font-weight:600;font-size:1rem!important;margin:8px 0 0!important}",""]),module.exports=exports}}]);