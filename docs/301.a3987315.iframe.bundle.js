(window.webpackJsonp=window.webpackJsonp||[]).push([[301],{"./frontend/src/lib/hooks/useAnchor.ts":function(Ee,k,a){"use strict";a.d(k,"a",function(){return re});var U=a("./node_modules/react/index.js"),N=a.n(U);function re(L){Object(U.useEffect)(function(){if(L&&document.getElementById(L.substr(1))){var e=document.getElementById(L.substr(1));if(!e)return;e.classList.add("highlighted");var X=e.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:X-50-32,behavior:"smooth"})}},[L])}},"./frontend/src/scenes/organization/Settings/index.tsx":function(Ee,k,a){"use strict";a.r(k),a.d(k,"scene",function(){return We}),a.d(k,"OrganizationSettings",function(){return pe});var U=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),N=a.n(U),re=a("./node_modules/core-js/modules/es.function.name.js"),L=a("./node_modules/react/index.js"),e=a.n(L),X=a("./frontend/src/lib/components/PageHeader.tsx"),Qe=a("./node_modules/core-js/modules/es.array.iterator.js"),He=a("./node_modules/core-js/modules/es.object.to-string.js"),Xe=a("./node_modules/core-js/modules/es.string.iterator.js"),qe=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),_e=a("./node_modules/core-js/modules/web.url.js"),en=a("./node_modules/core-js/modules/web.url-search-params.js"),v=a("./node_modules/kea/lib/index.esm.js"),Y=a("./frontend/src/lib/components/CopyToClipboard.tsx"),ie=a("./frontend/src/lib/components/ProfilePicture/index.ts"),oe=a("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),he=a("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),q=a("./frontend/src/lib/components/LemonTable/index.ts"),se=a("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),le=a("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),S=a("./frontend/src/lib/components/LemonButton/index.ts"),D=a("./frontend/src/lib/components/icons.tsx"),$=a("./frontend/src/lib/components/LemonDialog/index.ts");function be(t,n){var o=new URL("/signup/".concat(t),document.baseURI).href;return n.is_expired?e.a.createElement("b",null,"Expired! Delete and recreate"):e.a.createElement(Y.a,{"data-attr":"invite-link",description:"invite link"},o)}function Oe(t){return function(o,r){return e.a.createElement(S.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:e.a.createElement(D.IconClose,null),status:"danger",onClick:function(){r.is_expired?t(r):$.a.open({title:"Do you want to cancel the invite for ".concat(r.target_email,"?"),primaryButton:{children:"Yes, cancel invite",status:"danger",onClick:function(){return t(r)}},secondaryButton:{children:"No, keep invite"}})}})}}function Se(){var t=Object(v.useValues)(oe.a),n=t.invites,o=t.invitesLoading,r=Object(v.useActions)(oe.a),i=r.deleteInvite,l=r.showInviteModal,s=Object(v.useValues)(le.a),c=s.preflight,f=[{key:"user_profile_picture",render:function(d,m){return e.a.createElement(ie.b,{name:m.first_name,email:m.target_email})},width:32},{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(d,m){return m.target_email?e.a.createElement("div",{className:"flex items-center"},m.target_email,m.first_name?" (".concat(m.first_name,")"):""):e.a.createElement("i",null,"no one")},width:"20%"},Object(se.b)(),Object(se.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(d,m){return be(m.id,m)}},{title:"",key:"actions",width:24,render:Oe(i)}];return e.a.createElement("div",null,e.a.createElement("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"}},"Pending Invites",e.a.createElement(S.a,{type:"primary",onClick:l,"data-attr":"invite-teammate-button"},"Invite team member")),!(c!=null&&c.email_service_available)&&e.a.createElement(he.a,null),e.a.createElement(q.a,{dataSource:n,columns:f,rowKey:"id",loading:o,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."}))}var nn=a("./node_modules/core-js/modules/es.array.filter.js"),tn=a("./node_modules/core-js/modules/es.array.map.js"),an=a("./node_modules/core-js/modules/es.array.concat.js"),rn=a("./node_modules/core-js/modules/es.regexp.exec.js"),on=a("./node_modules/core-js/modules/es.string.search.js"),_=a("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),b=a("./frontend/src/lib/constants.tsx"),x=a("./frontend/src/scenes/organizationLogic.tsx"),ce=a("./frontend/src/scenes/userLogic.ts"),T=a("./frontend/src/lib/utils/permissioning.ts"),je=a("./frontend/src/lib/components/TimezoneAware/index.tsx"),de=a("./frontend/src/lib/components/LemonButton/More.tsx"),ee=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Ce=a("./frontend/src/lib/components/LemonDivider/index.ts"),O=a("./frontend/@posthog/lemon-ui/src/index.ts");function Ae(t,n){var o,r=Object(v.useValues)(ce.a),i=r.user,l=Object(v.useValues)(x.a),s=l.currentOrganization,c=Object(v.useActions)(_.a),f=c.removeMember,u=c.changeMemberAccessLevel;if(!i)return null;var d=(o=s==null?void 0:s.membership_level)!==null&&o!==void 0?o:-1,m=(d>=b.q.Admin&&n.level<=d||n.user.uuid===i.uuid)&&n.level!==b.q.Owner,h=s?s.membership_level:null,g=T.c.filter(function(y){return!Object(T.a)(h,i,n,y)}),V=Object(T.a)(h,i,n,g);return e.a.createElement(de.a,{overlay:e.a.createElement(e.a.Fragment,null,V?e.a.createElement("div",null,V):g.map(function(y){return e.a.createElement(S.a,{status:"stealth",fullWidth:!0,key:"".concat(n.user.uuid,"-level-").concat(y),onClick:function(p){if(p.preventDefault(),!i)throw Error;if(y===b.q.Owner){var E;$.a.open({title:"Transfer organization ownership to ".concat(n.user.first_name,"?"),description:"You will no longer be the owner of ".concat((E=i.organization)===null||E===void 0?void 0:E.name,". After the transfer you will become an administrator."),primaryButton:{status:"danger",children:"Transfer Ownership",onClick:function(){return u(n,y)}},secondaryButton:{children:"Cancel"}})}else u(n,y)},"data-test-level":y},y===b.q.Owner?e.a.createElement(e.a.Fragment,null,"Transfer organization ownership"):y>n.level?e.a.createElement(e.a.Fragment,null,"Upgrade to ",T.b.get(y)):e.a.createElement(e.a.Fragment,null,"Downgrade to ",T.b.get(y)))}),m?e.a.createElement(e.a.Fragment,null,e.a.createElement(Ce.a,null),e.a.createElement(S.a,{status:"danger","data-attr":"delete-org-membership",onClick:function(){var C;if(!i)throw Error;$.a.open({title:"".concat(n.user.uuid==i.uuid?"Leave":"Remove ".concat(n.user.first_name," from")," organization ").concat((C=i.organization)===null||C===void 0?void 0:C.name,"?"),primaryButton:{children:n.user.uuid==i.uuid?"Leave":"Remove",status:"danger",onClick:function(){return f(n)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0},n.user.uuid!==i.uuid?"Remove from organization":"Leave organization")):null)})}function W(t){var n=t.user,o=Object(v.useValues)(_.a),r=o.filteredMembers,i=o.membersLoading,l=o.search,s=Object(v.useActions)(_.a),c=s.setSearch,f=[{key:"user_profile_picture",render:function(d,m){return e.a.createElement(ie.b,{name:m.user.first_name,email:m.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(d,m){return m.user.uuid==n.uuid?"".concat(m.user.first_name," (me)"):m.user.first_name},sorter:function(d,m){return d.user.first_name.localeCompare(m.user.first_name)}},{title:"Email",key:"user_email",render:function(d,m){return m.user.email},sorter:function(d,m){return d.user.email.localeCompare(m.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(d,m){var h;return e.a.createElement(ee.a,{"data-attr":"membership-level"},m.level===b.q.Owner?"Organization owner":"Project ".concat((h=T.b.get(m.level))!==null&&h!==void 0?h:"unknown (".concat(m.level,")")))},sorter:function(d,m){return d.level-m.level}},{title:"Joined",dataIndex:"joined_at",key:"joined_at",render:function(d){return e.a.createElement("div",{className:"whitespace-nowrap"},e.a.createElement(je.b,{time:d}))},sorter:function(d,m){return d.joined_at.localeCompare(m.joined_at)}},{key:"actions",width:0,render:Ae}];return e.a.createElement(e.a.Fragment,null,e.a.createElement("h2",{className:"subtitle"},"Members"),e.a.createElement(O.LemonInput,{type:"search",placeholder:"Search for members",value:l,onChange:c}),e.a.createElement(q.a,{dataSource:r,columns:f,rowKey:"id",style:{marginTop:"1rem"},loading:i,"data-attr":"org-members-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}}))}try{W.displayName="Members",W.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:W.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(t){}function Z(t){var n=t.isOpen,o=t.setIsOpen,r=Object(v.useValues)(x.a),i=r.currentOrganization,l=r.organizationBeingDeleted,s=Object(v.useActions)(x.a),c=s.deleteOrganization,f=Object(L.useState)(!1),u=N()(f,2),d=u[0],m=u[1],h=!!i&&(l==null?void 0:l.id)===i.id;return e.a.createElement(O.LemonModal,{title:"Delete the entire organization?",onClose:function(){return o(!1)},footer:e.a.createElement(e.a.Fragment,null,e.a.createElement(O.LemonButton,{disabled:h,type:"secondary",onClick:function(){return o(!1)}},"Cancel"),e.a.createElement(O.LemonButton,{type:"primary",disabled:!d,loading:h,"data-attr":"delete-organization-ok",status:"danger",onClick:i?function(){return c(i)}:void 0},"Delete ".concat(i?i.name:"the current organization"))),isOpen:n},e.a.createElement("p",null,"Organization deletion ",e.a.createElement("b",null,"cannot be undone"),". You will lose all data, ",e.a.createElement("b",null,"including all events"),", related to all projects within this organization."),e.a.createElement("p",null,"Please type"," ",e.a.createElement("strong",null,i?i.name:"this organization's name")," to confirm."),e.a.createElement(O.LemonInput,{type:"text",onChange:function(V){i&&m(V.toLowerCase()===i.name.toLowerCase())}}))}function G(t){var n=t.isRestricted,o=Object(v.useValues)(x.a),r=o.currentOrganization,i=Object(L.useState)(!1),l=N()(i,2),s=l[0],c=l[1];return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"text-danger"},e.a.createElement("h2",{className:"text-danger subtitle"},"Danger Zone"),e.a.createElement("div",{className:"mt-4"},!n&&e.a.createElement("p",{className:"text-danger"},"This is ",e.a.createElement("b",null,"irreversible"),". Please be certain."),e.a.createElement(O.LemonButton,{status:"danger",type:"secondary",onClick:function(){return c(!0)},"data-attr":"delete-organization-button",icon:e.a.createElement(D.IconDelete,null),disabled:n},"Delete ",(r==null?void 0:r.name)||"the current organization"))),e.a.createElement(Z,{isOpen:s,setIsOpen:c}))}try{Z.displayName="DeleteOrganizationModal",Z.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},setIsOpen:{defaultValue:null,description:"",name:"setIsOpen",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:Z.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(t){}try{G.displayName="DangerZone",G.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:G.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(t){}var J=a("./frontend/src/lib/components/RestrictedArea.tsx"),Le=a("./frontend/src/lib/hooks/useAnchor.ts"),De=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Q=a.n(De),ne=a("./frontend/src/lib/components/Tooltip.tsx"),sn=a("./node_modules/core-js/modules/es.object.keys.js"),ln=a("./node_modules/core-js/modules/es.symbol.js"),cn=a("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),dn=a("./node_modules/core-js/modules/web.dom-collections.for-each.js"),un=a("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Me=a("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),xe=a.n(Me),Ve=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),Ie=a.n(Ve),ze=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),w=a.n(ze),Ne=a("./node_modules/@babel/runtime/regenerator/index.js"),j=a.n(Ne),mn=a("./node_modules/core-js/modules/es.array.sort.js"),fn=a("./node_modules/core-js/modules/es.array.find.js"),vn=a("./node_modules/core-js/modules/es.array.includes.js"),gn=a("./node_modules/core-js/modules/es.string.includes.js"),pn=a("./node_modules/core-js/modules/es.string.match.js"),R=a("./frontend/src/lib/api.ts"),H=a("./frontend/src/lib/components/lemonToast.tsx"),ue=a("./frontend/src/types.ts"),me=a("./node_modules/kea-forms/lib/index.js"),Te=a("./node_modules/kea-loaders/lib/index.js"),we=["id"];function fe(t,n){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),o.push.apply(o,r)}return o}function te(t){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?fe(Object(o),!0).forEach(function(r){Ie()(t,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):fe(Object(o)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))})}return t}var M=Object(v.kea)([Object(v.path)(["scenes","organization","verifiedDomainsLogic"]),Object(v.connect)({values:[x.a,["currentOrganization"]]}),Object(v.actions)({replaceDomain:function(n){return{domain:n}},setAddModalShown:function(n){return{shown:n}},setConfigureSAMLModalId:function(n){return{id:n}},setVerifyModal:function(n){return{id:n}}}),Object(v.reducers)({verifiedDomains:[[],{replaceDomain:function(n,o){var r=o.domain,i=[].concat(Q()(n.filter(function(l){var s=l.id;return s!==r.id})),[r]);return i.sort(function(l,s){return l.domain.localeCompare(s.domain)}),i}}],addModalShown:[!1,{setAddModalShown:function(n,o){var r=o.shown;return r},addVerifiedDomainSuccess:function(){return!1}}],configureSAMLModalId:[null,{setConfigureSAMLModalId:function(n,o){var r=o.id;return r}}],verifyModal:[null,{setVerifyModal:function(n,o){var r=o.id;return r}}]}),Object(Te.loaders)(function(t){var n=t.values,o=t.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var r=w()(j.a.mark(function l(){var s;return j.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,R.b.get("api/organizations/".concat((s=n.currentOrganization)===null||s===void 0?void 0:s.id,"/domains"));case 2:return f.abrupt("return",f.sent.results);case 3:case"end":return f.stop()}},l)}));function i(){return r.apply(this,arguments)}return i}(),addVerifiedDomain:function(){var r=w()(j.a.mark(function l(s){var c,f;return j.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,R.b.create("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains"),{domain:s});case 2:return f=d.sent,d.abrupt("return",[f].concat(Q()(n.verifiedDomains)));case 4:case"end":return d.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}(),deleteVerifiedDomain:function(){var r=w()(j.a.mark(function l(s){var c;return j.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,R.b.delete("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s));case 2:return u.abrupt("return",Q()(n.verifiedDomains.filter(function(d){return d.id!==s})));case 3:case"end":return u.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}()}],updatingDomain:[!1,{updateDomain:function(){var r=w()(j.a.mark(function l(s){var c,f;return j.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,R.b.update("api/organizations/".concat((c=n.currentOrganization)===null||c===void 0?void 0:c.id,"/domains/").concat(s.id),te(te({},s),{},{id:void 0}));case 2:return f=d.sent,H.d.success("Domain updated successfully! Changes will take immediately."),o.replaceDomain(f),d.abrupt("return",!1);case 6:case"end":return d.stop()}},l)}));function i(l){return r.apply(this,arguments)}return i}(),verifyDomain:function(){var r=w()(j.a.mark(function l(){var s,c;return j.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,R.b.create("api/organizations/".concat((s=n.currentOrganization)===null||s===void 0?void 0:s.id,"/domains/").concat(n.verifyModal,"/verify"));case 2:return c=u.sent,c.is_verified?H.d.success("Domain verified successfully."):H.d.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),o.replaceDomain(c),o.setVerifyModal(null),u.abrupt("return",!1);case 7:case"end":return u.stop()}},l)}));function i(){return r.apply(this,arguments)}return i}()}]}}),Object(v.listeners)(function(t){var n=t.actions,o=t.values;return{setConfigureSAMLModalId:function(i){var l=i.id,s=o.verifiedDomains.find(function(d){var m=d.id;return m===l});if(l&&s){var c=s.saml_acs_url,f=s.saml_entity_id,u=s.saml_x509_cert;n.setSamlConfigValues({saml_acs_url:c,saml_entity_id:f,saml_x509_cert:u,id:l})}}}}),Object(v.selectors)({domainBeingVerified:[function(t){return[t.verifiedDomains,t.verifyModal]},function(t,n){return n&&t.find(function(o){var r=o.id;return r===n})||null}],isSSOEnforcementAvailable:[function(t){return[t.currentOrganization]},function(t){var n;return(n=t==null?void 0:t.available_features.includes(ue.d.SSO_ENFORCEMENT))!==null&&n!==void 0?n:!1}],isSAMLAvailable:[function(t){return[t.currentOrganization]},function(t){var n;return(n=t==null?void 0:t.available_features.includes(ue.d.SAML))!==null&&n!==void 0?n:!1}]}),Object(v.afterMount)(function(t){var n=t.actions;return n.loadVerifiedDomains()}),Object(me.forms)(function(t){var n=t.actions,o=t.values;return{samlConfig:{defaults:{},errors:function(i){return{saml_acs_url:i.saml_acs_url&&!i.saml_acs_url.match(b.y)?"Please enter a valid URL, including https://":void 0}},submit:function(){var r=w()(j.a.mark(function l(s,c){var f,u,d,m;return j.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(u=s.id,d=xe()(s,we),u){g.next=3;break}return g.abrupt("return");case 3:return g.next=5,R.b.update("api/organizations/".concat((f=o.currentOrganization)===null||f===void 0?void 0:f.id,"/domains/").concat(s.id),te({},d));case 5:m=g.sent,c(),n.replaceDomain(m),n.setConfigureSAMLModalId(null),n.setSamlConfigValues({}),H.d.success("SAML configuration for ".concat(m.domain," updated successfully."));case 11:case"end":return g.stop()}},l)}));function i(l,s){return r.apply(this,arguments)}return i}()}}})]),ae=a("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),P=a("./frontend/src/lib/components/LemonModal/index.ts");function Re(){var t=Object(v.useValues)(M),n=t.addModalShown,o=t.verifiedDomainsLoading,r=Object(v.useActions)(M),i=r.setAddModalShown,l=r.addVerifiedDomain,s=Object(L.useState)(""),c=N()(s,2),f=c[0],u=c[1],d=Object(L.useState)(!1),m=N()(d,2),h=m[0],g=m[1],V=!f||!f.match(b.d),y=function(){u(""),g(!1)},C=function(){i(!1),y()},p=function(){g(!0),V||(l(f),y())};return e.a.createElement(P.a,{onClose:C,isOpen:n,title:"Add authentication domain",footer:e.a.createElement(S.a,{type:"primary",disabled:f===""||h&&V||o,onClick:p},"Add domain")},e.a.createElement(O.LemonInput,{placeholder:"posthog.com",autoFocus:!0,value:f,onChange:u,onPressEnter:p}),h&&V&&e.a.createElement("span",{className:"text-danger text-xs"},"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"))}var Pe=a("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx"),B=a("./frontend/src/lib/forms/Field.tsx");function Be(){var t=Object(v.useValues)(M),n=t.domainBeingVerified,o=t.updatingDomainLoading,r=Object(v.useActions)(M),i=r.setVerifyModal,l=r.verifyDomain,s="_posthog-challenge.".concat(n==null?void 0:n.domain,".");return e.a.createElement(P.a,{isOpen:!!n,onClose:function(){return i(null)},title:"Verify your domain",description:e.a.createElement(e.a.Fragment,null,e.a.createElement(ee.a,{className:"uppercase"},(n==null?void 0:n.domain)||""),e.a.createElement("p",null,"To verify your domain, you need to add a record to your DNS zone.")),footer:e.a.createElement(e.a.Fragment,null,e.a.createElement(S.a,{type:"secondary",onClick:function(){return i(null)}},"Verify later"),e.a.createElement(S.a,{type:"primary",disabled:o,onClick:l},"Verify"))},e.a.createElement("div",null,e.a.createElement("ol",null,e.a.createElement("li",null,"Sign in to your DNS provider."),e.a.createElement("li",null,"Add the following ",e.a.createElement("b",null,"TXT")," record.",e.a.createElement("div",{className:"my-4 space-y-2"},e.a.createElement(B.b,{label:"Name"},e.a.createElement("div",{className:"flex items-center gap-2"},e.a.createElement("div",{className:"border rounded p-2 h-10 flex-1"},s),e.a.createElement(Y.a,{explicitValue:s}))),e.a.createElement(B.b,{label:"Value or content"},e.a.createElement("div",{className:"flex items-center gap-2"},e.a.createElement("div",{className:"border rounded p-2 h-10 flex-1"},n==null?void 0:n.verification_challenge),e.a.createElement(Y.a,{explicitValue:n==null?void 0:n.verification_challenge}))),e.a.createElement(B.b,{label:"TTL"},e.a.createElement("div",{className:"flex items-center gap-2"},e.a.createElement("div",{className:"border rounded p-2 h-10 flex-1"},"Default or 3600"),e.a.createElement(Y.a,{explicitValue:"3600"}))))),e.a.createElement("li",null,"Press verify below."))))}var ve=a("./frontend/src/lib/components/Link.tsx"),Fe=a("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),Ke=a("./frontend/src/lib/components/AlertMessage/index.ts"),ge=a("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),ke=a("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx");function Ue(){var t=Object(v.useValues)(M),n=t.configureSAMLModalId,o=t.isSamlConfigSubmitting,r=t.samlConfig,i=Object(v.useActions)(M),l=i.setConfigureSAMLModalId,s=r.saml_acs_url&&r.saml_entity_id&&r.saml_x509_cert,c=function(){l(null)};return e.a.createElement(P.a,{onClose:c,isOpen:!!n,title:"",simple:!0},e.a.createElement(me.Form,{logic:M,formKey:"samlConfig",enableFormOnSubmit:!0,className:"LemonModal__layout "},e.a.createElement(P.a.Header,null,e.a.createElement("h3",null,"Configure SAML authentication and provisioning")),e.a.createElement(P.a.Content,{className:"space-y-2"},e.a.createElement(B.a,{name:"saml_acs_url",label:"SAML ACS URL"},e.a.createElement(ge.a,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})),e.a.createElement(B.a,{name:"saml_entity_id",label:"SAML Entity ID"},e.a.createElement(ge.a,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})),e.a.createElement(B.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate"},e.a.createElement(ke.a,{className:"ph-ignore-input",minRows:10,placeholder:`Enter the public certificate of your IdP. Keep all line breaks.
-----BEGIN CERTIFICATE-----
MIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL
-----END CERTIFICATE-----`})),!s&&e.a.createElement(Ke.a,{type:"info"},"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft.")),e.a.createElement(P.a.Footer,null,e.a.createElement(S.a,{loading:o,type:"primary",htmlType:"submit"},"Save settings"))))}var F={marginRight:4,fontSize:"1.15em",paddingTop:2};function Ye(){var t=Object(v.useValues)(M),n=t.verifiedDomainsLoading,o=t.updatingDomainLoading,r=Object(v.useActions)(M),i=r.setAddModalShown;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"flex items-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("div",{id:"domain-whitelist"})," ",e.a.createElement("h2",{id:"authentication-domains",className:"subtitle"},"Authentication domains"),e.a.createElement("p",{className:"text-muted-alt"},"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains.")),e.a.createElement(S.a,{type:"primary",onClick:function(){return i(!0)},disabled:n||o},"Add domain")),e.a.createElement($e,null))}function $e(){var t=Object(v.useValues)(M),n=t.verifiedDomains,o=t.verifiedDomainsLoading,r=t.currentOrganization,i=t.updatingDomainLoading,l=t.isSSOEnforcementAvailable,s=t.isSAMLAvailable,c=Object(v.useActions)(M),f=c.updateDomain,u=c.deleteVerifiedDomain,d=c.setVerifyModal,m=c.setConfigureSAMLModalId,h=Object(v.useValues)(le.a),g=h.preflight,V=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function(C,p){var E=p.domain;return e.a.createElement(ee.a,null,E)}}].concat(Q()(g!=null&&g.cloud?[{key:"is_verified",title:e.a.createElement(e.a.Fragment,null,"Verification",e.a.createElement(ne.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO)."},e.a.createElement(ae.a,{style:{marginLeft:4}}))),render:function(C,p){var E=p.is_verified,A=p.verified_at;return E?e.a.createElement("div",{className:"flex items-center text-success"},e.a.createElement(D.IconCheckmark,{style:F})," Verified"):A?e.a.createElement("div",{className:"flex items-center text-danger"},e.a.createElement(D.IconExclamation,{style:F})," Verification expired"):e.a.createElement("div",{className:"flex items-center text-warning"},e.a.createElement(D.IconWarning,{style:F})," Pending verification")}}]:[]),[{key:"jit_provisioning_enabled",title:e.a.createElement(e.a.Fragment,null,"Automatic provisioning"," ",e.a.createElement(ne.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((r==null?void 0:r.name)||"this organization"," if it does not exist.")},e.a.createElement(ae.a,null))),render:function(C,p){var E=p.jit_provisioning_enabled,A=p.id,I=p.is_verified;return I?e.a.createElement("div",{className:"flex items-center"},e.a.createElement(Fe.a,{checked:E,disabled:i||!I,onChange:function(K){return f({id:A,jit_provisioning_enabled:K})},label:e.a.createElement("span",{className:"font-normal"},E?"Enabled":"Disabled")})):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable automatic provisioning")}},{key:"sso_enforcement",title:e.a.createElement(e.a.Fragment,null,"Enforce SSO"," ",e.a.createElement(ne.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider."},e.a.createElement(ae.a,null))),render:function(C,p,E){var A=p.sso_enforcement,I=p.is_verified,z=p.id,K=p.has_saml;return l?I?e.a.createElement(Pe.a,{value:A,loading:i,onChange:function(Je){return f({id:z,sso_enforcement:Je})},samlAvailable:K}):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):E===0?e.a.createElement(ve.a,{to:Object(b.E)(g==null?void 0:g.cloud).url,target:Object(b.E)(g==null?void 0:g.cloud).target,className:"flex items-center"},e.a.createElement(D.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"):e.a.createElement(e.a.Fragment,null)}},{key:"saml",title:"SAML",render:function(C,p,E){var A=p.is_verified,I=p.saml_acs_url,z=p.saml_entity_id,K=p.saml_x509_cert,ye=p.has_saml;return s?A?e.a.createElement(e.a.Fragment,null,ye?e.a.createElement("div",{className:"flex items-center text-success"},e.a.createElement(D.IconCheckmark,{style:F})," SAML enabled"):I||z||K?e.a.createElement("div",{className:"flex items-center text-warning"},e.a.createElement(D.IconWarning,{style:F})," SAML partially configured"):e.a.createElement("div",{className:"flex items-center"},e.a.createElement(D.IconOffline,{style:F})," SAML not set up")):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):E===0?e.a.createElement(ve.a,{to:Object(b.E)(g==null?void 0:g.cloud).url,target:Object(b.E)(g==null?void 0:g.cloud).target,className:"flex items-center"},e.a.createElement(D.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"):e.a.createElement(e.a.Fragment,null)}},{key:"actions",width:32,align:"center",render:function(C,p){var E=p.is_verified,A=p.id,I=p.domain;return E?e.a.createElement(de.a,{overlay:e.a.createElement(e.a.Fragment,null,e.a.createElement(S.a,{status:"stealth",onClick:function(){return m(A)},fullWidth:!0,disabled:!s,title:s?void 0:"Upgrade to enable SAML"},"Configure SAML"),e.a.createElement(S.a,{status:"danger",onClick:function(){return $.a.open({title:"Remove ".concat(I,"?"),description:"This cannot be undone. If you have SAML configured or SSO enforced,it will be immediately disabled.",primaryButton:{status:"danger",children:"Remove domain",onClick:function(){return u(A)}},secondaryButton:{children:"Cancel"}})},fullWidth:!0},e.a.createElement(D.IconDelete,null)," Remove domain")),style:{display:"inline-block"}}):e.a.createElement(S.a,{type:"primary",onClick:function(){return d(A)}},"Verify")}}]);return e.a.createElement("div",null,e.a.createElement(q.a,{dataSource:n,columns:V,loading:o,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),e.a.createElement(Re,null),e.a.createElement(Ue,null),e.a.createElement(Be,null))}var We={component:pe,logic:x.a};function Ze(t){var n=t.isRestricted,o=Object(v.useValues)(x.a),r=o.currentOrganization,i=o.currentOrganizationLoading,l=Object(v.useActions)(x.a),s=l.updateOrganization,c=Object(L.useState)((r==null?void 0:r.name)||""),f=N()(c,2),u=f[0],d=f[1];return e.a.createElement("div",{style:{maxWidth:"40rem"}},e.a.createElement("h2",{id:"name",className:"subtitle mt-0"},"Display Name"),e.a.createElement(O.LemonInput,{className:"mb-4",value:u,onChange:d,disabled:n}),e.a.createElement(O.LemonButton,{type:"primary",onClick:function(h){h.preventDefault(),s({name:u})},disabled:n||!u||!r||u===r.name,loading:i},"Rename Organization"))}function Ge(t){var n=t.isRestricted,o=Object(v.useValues)(x.a),r=o.currentOrganization,i=Object(v.useActions)(x.a),l=i.updateOrganization;return e.a.createElement("div",null,e.a.createElement("h2",{id:"notification-preferences",className:"subtitle"},"Notification Preferences"),e.a.createElement("div",null,e.a.createElement(O.LemonSwitch,{"data-attr":"is-member-join-email-enabled-switch",onChange:function(c){l({is_member_join_email_enabled:c})},checked:!!(r!=null&&r.is_member_join_email_enabled),disabled:n||!r,label:"Email all current members when a new member joins",bordered:!0})))}function pe(){var t=Object(v.useValues)(ce.a),n=t.user;return Object(Le.a)(location.hash),e.a.createElement(e.a.Fragment,null,e.a.createElement(X.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),e.a.createElement("div",{className:"border rounded p-6"},e.a.createElement(J.a,{Component:Ze,minimumAccessLevel:b.q.Admin}),e.a.createElement(O.LemonDivider,{className:"my-6"}),e.a.createElement(Se,null),e.a.createElement(O.LemonDivider,{className:"my-6"}),n&&e.a.createElement(W,{user:n}),e.a.createElement(O.LemonDivider,{className:"my-6"}),e.a.createElement(J.a,{Component:Ye,minimumAccessLevel:b.q.Admin}),e.a.createElement(O.LemonDivider,{className:"my-6"}),e.a.createElement(J.a,{Component:Ge,minimumAccessLevel:b.q.Admin}),e.a.createElement(O.LemonDivider,{className:"my-6"}),e.a.createElement(J.a,{Component:G,minimumAccessLevel:b.q.Owner})))}}}]);
