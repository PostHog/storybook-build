var Se=Object.defineProperty;var ne=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var oe=(j,b,o)=>b in j?Se(j,b,{enumerable:!0,configurable:!0,writable:!0,value:o}):j[b]=o,F=(j,b)=>{for(var o in b||(b={}))Ie.call(b,o)&&oe(j,o,b[o]);if(ne)for(var o of ne(b))Ae.call(b,o)&&oe(j,o,b[o]);return j};var A=(j,b,o)=>new Promise((v,p)=>{var H=m=>{try{M(o.next(m))}catch(h){p(h)}},O=m=>{try{M(o.throw(m))}catch(h){p(h)}},M=m=>m.done?v(m.value):Promise.resolve(m.value).then(H,O);M((o=o.apply(j,b)).next())});(window.webpackJsonp=window.webpackJsonp||[]).push([[292],{"./frontend/src/scenes/apps/AppMetricsScene.tsx":function(j,b,o){"use strict";o.r(b),o.d(b,"scene",function(){return Te}),o.d(b,"AppMetrics",function(){return se});var v=o("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),p=o("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),H=o("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),O=o("./frontend/src/scenes/urls.ts"),M=o("./frontend/src/types.ts"),m=o("./frontend/src/lib/api.ts"),h=o("./frontend/src/scenes/teamLogic.tsx"),V=o("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.0/node_modules/kea-router/lib/index.js"),T=o("./frontend/src/lib/utils.tsx"),G=o("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),ae=o("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),z=o("./frontend/src/lib/dayjs.ts"),ie=o("./frontend/src/scenes/userLogic.ts");let l;(function(r){r.ProcessEvent="processEvent",r.OnEvent="onEvent",r.ExportEvents="exportEvents",r.ScheduledTask="scheduledTask",r.HistoricalExports="historical_exports",r.History="history"})(l||(l={}));const k="-30d",W=[l.ProcessEvent,l.OnEvent,l.ExportEvents,l.ScheduledTask],x=Object(p.kea)([Object(p.path)(r=>["scenes","apps","appMetricsSceneLogic",r]),Object(p.props)({}),Object(p.key)(r=>r.pluginConfigId),Object(p.actions)({setActiveTab:r=>({tab:r}),setDateFrom:r=>({dateFrom:r}),openErrorDetailsModal:(r,t,n)=>({errorType:r,category:t,jobId:n}),closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),Object(p.reducers)({activeTab:[null,{setActiveTab:(r,t)=>{let{tab:n}=t;return n}}],selectedDateFrom:[null,{setDateFrom:(r,t)=>{let{dateFrom:n}=t;return n}}],errorDetailsModalError:[null,{openErrorDetailsModal:(r,t)=>{let{errorType:n}=t;return n},closeErrorDetailsModal:()=>null}]}),Object(H.loaders)(r=>{let{values:t,props:n}=r;return{pluginConfig:[null,{loadPluginConfig:()=>A(this,null,function*(){return yield m.b.get(`api/projects/${h.a.values.currentTeamId}/plugin_configs/${n.pluginConfigId}`)})}],appMetricsResponse:[null,{loadMetrics:()=>A(this,null,function*(){if(t.activeTab&&t.dateFrom){const s=Object(T.Gb)({category:t.activeTab,date_from:t.dateFrom});return yield m.b.get(`api/projects/${h.a.values.currentTeamId}/app_metrics/${n.pluginConfigId}?${s}`)}})}],historicalExports:[[],{loadHistoricalExports:()=>A(this,null,function*(){const{results:s}=yield m.b.get(`api/projects/${h.a.values.currentTeamId}/app_metrics/${n.pluginConfigId}/historical_exports`);return s})}],errorDetails:[[],{openErrorDetailsModal:s=>A(this,null,function*(){let{category:a,jobId:i,errorType:c}=s;const u=Object(T.Gb)({category:a,job_id:i,error_type:c}),{result:d}=yield m.b.get(`api/projects/${h.a.values.currentTeamId}/app_metrics/${n.pluginConfigId}/error_details?${u}`);return d})}]}}),Object(p.selectors)(r=>{let{values:t,actions:n}=r;return{breadcrumbs:[s=>[s.pluginConfig,(a,i)=>i.pluginConfigId],(s,a)=>{var i;return[{name:"Apps",path:O.a.projectApps()},{name:s==null||(i=s.plugin_info)===null||i===void 0?void 0:i.name,path:O.a.appMetrics(a)}]}],shouldShowAppMetrics:[()=>[ie.a.selectors.hasAvailableFeature],s=>s(M.e.APP_METRICS)],defaultTab:[s=>[s.pluginConfig],()=>{var s;return(s=W.filter(a=>t.showTab(a))[0])!==null&&s!==void 0?s:l.History}],currentTime:[()=>[],()=>Date.now()],defaultDateFrom:[s=>[s.pluginConfig,s.currentTime],(s,a)=>{if(!(s!=null&&s.created_at))return k;const i=z.a.utc(s.created_at),c=Object(z.a)(a).diff(i,"days",!0);return c<=1?"-24h":c<=7?"-7d":k}],dateFrom:[s=>[s.selectedDateFrom,s.defaultDateFrom],(s,a)=>{var i;return(i=s!=null?s:a)!==null&&i!==void 0?i:k}],showTab:[s=>[s.shouldShowAppMetrics],s=>a=>{if(t.pluginConfigLoading||!t.pluginConfig||!t.pluginConfig.plugin_info.capabilities)return!1;const i=t.pluginConfig.plugin_info.capabilities,c=i.methods.includes("exportEvents");return a===l.History?!0:s?a===l.HistoricalExports?c:a===l.OnEvent&&c?!1:a===l.ScheduledTask?!c&&["runEveryMinute","runEveryHour","runEveryDay"].some(u=>i.scheduled_tasks.includes(u)):i.methods.includes(a):!1}],interfaceJobsProps:[s=>[s.pluginConfig],s=>!s||!s.plugin_info.public_jobs||!(s!=null&&s.enabled)?null:{jobName:G.b,jobSpec:s.plugin_info.public_jobs[G.b],pluginConfigId:s.id,pluginId:s.plugin,onSubmit:n.loadHistoricalExports}],hasRunningExports:[s=>[s.historicalExports],s=>s.some(a=>a.status=="not_finished")]}}),Object(p.listeners)(r=>{let{values:t,actions:n}=r;return{loadPluginConfigSuccess:()=>{t.activeTab||n.setActiveTab(t.defaultTab)},setActiveTab:s=>{let{tab:a}=s;a===l.HistoricalExports?n.loadHistoricalExports():a!==l.History&&n.loadMetrics()},setDateFrom:()=>{n.loadMetrics()},openHistoricalExportModal:()=>{t.interfaceJobsProps&&Object(ae.a)(t.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}}),Object(V.actionToUrl)(r=>{let{values:t,props:n}=r;return{setActiveTab:()=>_(t,n),setDateFrom:()=>_(t,n),openErrorDetailsModal:()=>_(t,n),closeErrorDetailsModal:()=>_(t,n)}}),Object(V.urlToAction)(r=>{let{values:t,actions:n,props:s}=r;return{"/app/:pluginConfigId/:page":(a,i)=>{if(s.pluginConfigId===Number(a.pluginConfigId))if(t.pluginConfig||n.loadPluginConfig(),a.page===l.HistoricalExports)n.setActiveTab(l.HistoricalExports);else if(a.page===l.History)n.setActiveTab(l.History);else if(i.tab&&W.includes(i.tab)&&i.tab!==t.activeTab?n.setActiveTab(i.tab):!t.pluginConfigLoading&&t.activeTab!==t.defaultTab&&n.setActiveTab(t.defaultTab),i.from&&t.selectedDateFrom!==i.from&&n.setDateFrom(i.from),i.error){const[c,u]=i.error;t.errorDetailsModalError!==c&&(n.setActiveTab(u),n.openErrorDetailsModal(c,u))}else n.closeErrorDetailsModal()}}})]);function _(r,t){if(r.activeTab===l.HistoricalExports)return O.a.appHistoricalExports(t.pluginConfigId);if(r.activeTab===l.History)return O.a.appHistory(t.pluginConfigId,V.router.values.searchParams);const n={};return r.activeTab&&r.activeTab!==r.defaultTab&&(n.tab=r.activeTab),r.selectedDateFrom&&(n.from=r.selectedDateFrom),r.errorDetailsModalError&&r.activeTab&&(n.error=[r.errorDetailsModalError,r.activeTab]),O.a.appMetrics(t.pluginConfigId,n)}var ce=o("./frontend/src/lib/components/PageHeader.tsx"),e=o("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const f={[l.ProcessEvent]:{successes:"Events processed",successes_tooltip:Object(e.jsxs)(e.Fragment,{children:["These events were successfully processed and transformed by the ",Object(e.jsx)("i",{children:"processEvent"})," app method."]}),failures:"Failed events",failures_tooltip:Object(e.jsxs)(e.Fragment,{children:["These events had errors when being processed by the ",Object(e.jsx)("i",{children:"processEvent"})," app method, but were still ingested."]})},[l.OnEvent]:{successes:"Events processed",successes_tooltip:Object(e.jsxs)(e.Fragment,{children:["These events were successfully processed by the ",Object(e.jsx)("i",{children:"onEvent"})," app method on the first try."]}),successes_on_retry:"Events processed on retry",successes_on_retry_tooltip:Object(e.jsxs)(e.Fragment,{children:["These events were successfully processed by the ",Object(e.jsx)("i",{children:"onEvent"})," app method after being retried."]}),failures:"Failed events",failures_tooltip:Object(e.jsxs)(e.Fragment,{children:["These events had errors when being processed by the ",Object(e.jsx)("i",{children:"onEvent"})," app method."]})},[l.ExportEvents]:{successes:"Events delivered",successes_tooltip:Object(e.jsx)(e.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:Object(e.jsx)(e.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:Object(e.jsx)(e.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})},[l.HistoricalExports]:{successes:"Events delivered",successes_tooltip:Object(e.jsx)(e.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:Object(e.jsx)(e.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:Object(e.jsx)(e.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})},[l.ScheduledTask]:{successes:"Successes",successes_tooltip:Object(e.jsxs)(e.Fragment,{children:["How many times ",Object(e.jsx)("i",{children:"runEveryMinute"}),", ",Object(e.jsx)("i",{children:"runEveryHour"})," or ",Object(e.jsx)("i",{children:"runEveryDay"})," was called successfully."]}),failures:"Failures",failures_tooltip:Object(e.jsxs)(e.Fragment,{children:["How many times ",Object(e.jsx)("i",{children:"runEveryMinute"}),", ",Object(e.jsx)("i",{children:"runEveryHour"})," or ",Object(e.jsx)("i",{children:"runEveryDay"})," failed due to errors."]})}};var S=o("./frontend/src/lib/components/LemonSkeleton/index.tsx"),C=o("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),le=o("./frontend/src/lib/colors.ts"),de=o("./node_modules/.pnpm/chart.js@3.9.1/node_modules/chart.js/dist/chart.mjs"),ue=o("./node_modules/.pnpm/style-loader@2.0.0_webpack@4.46.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),pe=o.n(ue),be=o("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),Z=o.n(be),B={};B.insert="head",B.singleton=!1;var Me=pe()(Z.a,B),Ce=Z.a.locals||{};function L(r){let{tab:t,metrics:n,metricsLoading:s}=r;const a=Object(C.useRef)(null),i=f[t];return Object(C.useEffect)(()=>{let c;if(a.current&&n){var u;c=new de.a((u=a.current)===null||u===void 0?void 0:u.getContext("2d"),{type:"line",data:{labels:n.dates,datasets:[F({label:i.successes,data:n.successes,borderColor:""},J("data-brand-blue")),...i.successes_on_retry?[F({label:i.successes_on_retry,data:n.successes_on_retry},J("data-yellow"))]:[],F({label:i.failures,data:n.failures},J("data-vermilion"))]},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return()=>{var d;(d=c)===null||d===void 0||d.destroy()}},[n]),s||!n?Object(e.jsx)(S.a,{className:"AppMetricsGraph border rounded p-6"}):Object(e.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:Object(e.jsx)("canvas",{ref:a})})}function J(r){const t=Object(le.b)(r);return{borderColor:t,hoverBorderColor:Object(T.lb)(t,-20),hoverBackgroundColor:Object(T.lb)(t,-20),backgroundColor:t,fill:!1,borderWidth:2,pointRadius:0}}try{L.displayName="AppMetricsGraph",L.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'},{value:'"history"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:L.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(r){}var je=o("./frontend/src/lib/components/LemonSelect.tsx"),Q=o("./frontend/src/lib/components/LemonTable/index.ts"),X=o("./frontend/src/lib/components/TZLabel/index.tsx"),me=o("./frontend/src/lib/components/Link.tsx"),w=o("./frontend/src/lib/components/Tooltip.tsx"),g=o("./frontend/src/lib/components/icons.tsx");function y(r){let{tab:t}=r;const{appMetricsResponse:n,appMetricsResponseLoading:s,dateFrom:a}=Object(p.useValues)(x),{setDateFrom:i}=Object(p.useActions)(x);return Object(e.jsxs)("div",{className:"space-y-8",children:[Object(e.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[Object(e.jsx)(D,{tab:t,metrics:n==null?void 0:n.metrics,metricsLoading:s}),Object(e.jsx)(je.a,{value:a,onChange:c=>i(c),options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{children:"Delivery trends"}),Object(e.jsx)(L,{tab:t,metrics:n==null?void 0:n.metrics,metricsLoading:s})]}),Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{children:"Errors"}),Object(e.jsx)(N,{category:t,errors:(n==null?void 0:n.errors)||[],loading:s,showExtendedEmptyState:!0})]})]})}function D(r){var t,n,s;let{tab:a,metrics:i,metricsLoading:c,exportDuration:u,exportFailureReason:d}=r;return c?Object(e.jsx)(S.a,{className:"w-20 mb-2",repeat:4}):Object(e.jsxs)("div",{className:"space-y-4",children:[Object(e.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[Object(e.jsxs)("div",{children:[Object(e.jsxs)("div",{className:"text-muted font-semibold mb-2",children:[f[a].successes," ",f[a].successes_tooltip&&Object(e.jsx)(w.a,{title:f[a].successes_tooltip,children:Object(e.jsx)(g.IconInfo,{})})]}),Object(e.jsx)("div",{className:"text-4xl",children:K(i==null||(t=i.totals)===null||t===void 0?void 0:t.successes)})]}),f[a].successes_on_retry&&Object(e.jsxs)("div",{children:[Object(e.jsxs)("div",{className:"text-muted font-semibold mb-2",children:[f[a].successes_on_retry," ",f[a].successes_on_retry_tooltip&&Object(e.jsx)(w.a,{title:f[a].successes_on_retry_tooltip,children:Object(e.jsx)(g.IconInfo,{})})]}),Object(e.jsx)("div",{className:"text-4xl",children:K(i==null||(n=i.totals)===null||n===void 0?void 0:n.successes_on_retry)})]}),Object(e.jsxs)("div",{children:[Object(e.jsxs)("div",{className:"text-muted font-semibold mb-2",children:[f[a].failures," ",f[a].failures_tooltip&&Object(e.jsx)(w.a,{title:f[a].failures_tooltip,children:Object(e.jsx)(g.IconInfo,{})})]}),Object(e.jsx)("div",{className:"text-4xl",children:K(i==null||(s=i.totals)===null||s===void 0?void 0:s.failures)})]}),u&&Object(e.jsxs)("div",{children:[Object(e.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export duration"}),Object(e.jsx)("div",{className:"text-4xl",children:Object(T.P)(u)})]})]}),d&&Object(e.jsxs)("div",{children:[Object(e.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export failure reason"}),Object(e.jsx)("div",{children:d})]})]})}function N(r){let{errors:t,loading:n,category:s,jobId:a,showExtendedEmptyState:i}=r;const{openErrorDetailsModal:c}=Object(p.useActions)(x);return Object(e.jsx)(Q.a,{dataSource:t,loading:n,columns:[{title:"Error type",dataIndex:"error_type",render:function(d,E){return Object(e.jsx)(me.a,{title:"View details",className:"font-semibold",onClick:R=>{R.preventDefault(),c(E.error_type,s,a)},children:E.error_type})},sorter:(u,d)=>u.error_type.localeCompare(d.error_type)},{title:"Count",dataIndex:"count",align:"right",sorter:(u,d)=>u.count-d.count},{title:"Last seen",dataIndex:"last_seen",render:function(d){return Object(e.jsx)("div",{className:"whitespace-nowrap text-right",children:Object(e.jsx)(X.a,{time:d})})},align:"right",sorter:(u,d)=>new Date(u.last_seen||0)>new Date(d.last_seen||0)?1:-1}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:Object(e.jsxs)("div",{className:"",children:[Object(e.jsx)("b",{children:"No errors! \u{1F973}"}),i&&Object(e.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})}function K(r){return Object(e.jsx)(e.Fragment,{children:r&&Object(T.Q)(r)})}try{y.displayName="MetricsTab",y.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'},{value:'"history"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:y.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(r){}try{D.displayName="MetricsOverview",D.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'},{value:'"history"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}},exportDuration:{defaultValue:null,description:"",name:"exportDuration",required:!1,type:{name:"number"}},exportFailureReason:{defaultValue:null,description:"",name:"exportFailureReason",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:D.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(r){}try{N.displayName="ErrorsOverview",N.__docgenInfo={description:"",displayName:"ErrorsOverview",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"AppErrorSummary[]"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},category:{defaultValue:null,description:"",name:"category",required:!0,type:{name:"string"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!1,type:{name:"string"}},showExtendedEmptyState:{defaultValue:null,description:"",name:"showExtendedEmptyState",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"]={docgenInfo:N.__docgenInfo,name:"ErrorsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"})}catch(r){}var U=o("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/card/index.js");const ve=Object(p.kea)([Object(p.path)(["scenes","apps","historicalExportLogic"]),Object(p.props)({}),Object(p.key)(r=>{let{pluginConfigId:t,jobId:n}=r;return`${t}_${n}`}),Object(H.loaders)(r=>{let{props:t}=r;return{data:[null,{loadExportData:()=>A(this,null,function*(){return yield m.b.get(`api/projects/${h.a.values.currentTeamId}/app_metrics/${t.pluginConfigId}/historical_exports/${t.jobId}`)})}]}}),Object(p.events)(r=>{let{actions:t}=r;return{afterMount:t.loadExportData}})]);function P(r){var t,n,s,a,i;const{data:c,dataLoading:u}=Object(p.useValues)(ve(r));return Object(e.jsxs)("div",{className:"mt-4 mb-4 mr-8",children:[Object(e.jsx)(U.a,{title:"Overview",children:Object(e.jsx)(D,{tab:l.HistoricalExports,metrics:(t=c==null?void 0:c.metrics)!==null&&t!==void 0?t:null,metricsLoading:u,exportDuration:c==null||(n=c.summary)===null||n===void 0?void 0:n.duration,exportFailureReason:c==null||(s=c.summary)===null||s===void 0?void 0:s.failure_reason})}),Object(e.jsx)(U.a,{title:"Delivery trends",className:"mt-4",children:Object(e.jsx)(L,{tab:l.HistoricalExports,metrics:(a=c==null?void 0:c.metrics)!==null&&a!==void 0?a:null,metricsLoading:u})}),Object(e.jsx)(U.a,{title:"Errors",className:"mt-4",children:Object(e.jsx)(N,{errors:(c==null?void 0:c.errors)||[],loading:u,category:"exportEvents",jobId:c==null||(i=c.summary)===null||i===void 0?void 0:i.job_id})})]})}try{P.displayName="HistoricalExport",P.__docgenInfo={description:"",displayName:"HistoricalExport",props:{pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"]={docgenInfo:P.__docgenInfo,name:"HistoricalExport",path:"frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"})}catch(r){}var q=o("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),ee=o("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),fe=o("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/progress/index.js"),$=o("./frontend/src/lib/components/LemonButton/index.ts");const xe=2e4;function he(){const{historicalExports:r,historicalExportsLoading:t,pluginConfig:n,interfaceJobsProps:s,hasRunningExports:a}=Object(p.useValues)(x),{openHistoricalExportModal:i,loadHistoricalExports:c}=Object(p.useActions)(x);return Object(C.useEffect)(()=>{let u;function d(){a&&(u=setTimeout(()=>{c(),d()},xe))}return d(),()=>u&&clearTimeout(u)},[a]),Object(e.jsxs)("div",{className:"space-y-2",children:[Object(e.jsx)("div",{className:"flex items-center justify-end",children:Object(e.jsx)($.a,{type:"primary",onClick:i,disabled:!s,children:"Start new export"})}),Object(e.jsx)(Q.a,{dataSource:r,loading:t,columns:[{title:"Dates exported",render:function(d,E){const[R,re]=E.payload.dateRange;return R===re?R:`${R} - ${re}`}},{title:"Progress",width:130,render:function(d,E){switch(E.status){case"success":return Object(e.jsx)(ee.a,{type:"success",className:"uppercase",children:"Success"});case"fail":return Object(e.jsx)(ee.a,{type:"danger",className:"uppercase",children:"Failed"});case"not_finished":return Object(e.jsx)(fe.a,{percent:Math.floor((E.progress||0)*100)})}},align:"right"},Object(q.b)(),Object(q.a)()],expandable:{expandedRowRender:function(d){if(!!n)return Object(e.jsx)(P,{pluginConfigId:n.id,jobId:d.job_id})}},useURLForSorting:!1,noSortingCancellation:!0,emptyState:Object(e.jsxs)("div",{className:"",children:[Object(e.jsx)("b",{children:"Nothing has been exported yet!"}),s&&Object(e.jsx)("p",{className:"m-0",children:'Use "Start new export" button above to export historical data in a given time range.'})]})}),s&&Object(e.jsx)(G.d,F({},s))]})}var te=o("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),ge=o("./frontend/src/lib/components/LemonModal/index.ts"),I=o("./frontend/src/lib/components/CodeSnippet/index.tsx");function Oe(){var r,t;const{errorDetails:n,errorDetailsModalError:s,errorDetailsLoading:a}=Object(p.useValues)(x),{closeErrorDetailsModal:i}=Object(p.useActions)(x),[c,u]=Object(C.useState)(0),d=n[c];return Object(e.jsx)(ge.a,{isOpen:!!s,onClose:i,title:s,width:"min(50vw, 80rem)",description:Object(e.jsx)("span",{children:d==null||(r=d.error_details)===null||r===void 0||(t=r.error.message)===null||t===void 0?void 0:t.substring(0,200)}),footer:Object(e.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:a?Object(e.jsx)(S.a,{className:"1-10"}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("span",{children:[c+1," of ",n.length," sample",n.length>1?"s":""]}),Object(e.jsx)($.a,{icon:Object(e.jsx)(g.IconChevronLeft,{}),onClick:()=>u(c-1),disabled:c==0}),Object(e.jsx)($.a,{icon:Object(e.jsx)(g.IconChevronRight,{}),onClick:()=>u(c+1),disabled:c==n.length-1})]})}),children:!s||a?Object(e.jsx)(S.a,{className:"h-10"}):Object(e.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[Object(e.jsxs)("div",{children:[Object(e.jsx)(te.a,{children:"When:"})," ",Object(e.jsx)(X.a,{time:d.timestamp,showSeconds:!0})]}),d.error_details.eventCount&&Object(e.jsxs)("div",{children:[Object(e.jsx)(te.a,{children:"Event Count"}),Object(e.jsx)("div",{children:d.error_details.eventCount})]}),d.error_details.error.message&&Object(e.jsx)(Y,{title:"Error message",defaultIsExpanded:!0,children:Object(e.jsx)(I.a,{wrap:!0,language:I.b.JavaScript,children:d.error_details.error.message})}),d.error_details.event&&Object(e.jsx)(Y,{title:"Event payload",defaultIsExpanded:!1,children:Object(e.jsx)(I.a,{wrap:!0,language:I.b.JSON,children:JSON.stringify(d.error_details.event,null,2)})}),d.error_details.error.stack&&Object(e.jsx)(Y,{title:"Stack trace",defaultIsExpanded:!1,children:Object(e.jsx)(I.a,{wrap:!0,language:I.b.JavaScript,children:d.error_details.error.stack})})]})})}function Y(r){const[t,n]=Object(C.useState)(r.defaultIsExpanded);return Object(e.jsxs)("div",{className:"bg-mid border rounded",children:[Object(e.jsx)($.a,{status:"stealth",fullWidth:!0,onClick:()=>n(!t),sideIcon:t?Object(e.jsx)(g.IconUnfoldLess,{}):Object(e.jsx)(g.IconUnfoldMore,{}),title:t?"Show less":"Show more",className:"bg-mid",children:r.title}),t&&Object(e.jsx)("div",{className:"bg-light p-2",children:r.children})]})}var ye=o("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),Ee=o("./frontend/src/lib/components/ActivityLog/humanizeActivity.tsx");const Te={component:se,logic:x,paramsToProps:r=>{var t;let{params:{pluginConfigId:n}}=r;return{pluginConfigId:(t=parseInt(n))!==null&&t!==void 0?t:0}}};function se(){const{activeTab:r,pluginConfig:t,pluginConfigLoading:n,showTab:s,shouldShowAppMetrics:a}=Object(p.useValues)(x),{setActiveTab:i}=Object(p.useActions)(x);return Object(e.jsxs)("div",{children:[Object(e.jsx)(ce.a,{title:t?t.plugin_info.name:Object(e.jsx)(S.a,{}),caption:a&&t?"An overview of metrics and exports for this app.":void 0}),n||!r?Object(e.jsx)(S.a,{}):Object(e.jsxs)(v.a,{tabPosition:"top",animated:!1,activeKey:r,onTabClick:c=>i(c),children:[s(l.ProcessEvent)&&Object(e.jsx)(v.a.TabPane,{tab:"processEvent metrics",children:Object(e.jsx)(y,{tab:l.ProcessEvent})},l.ProcessEvent),s(l.OnEvent)&&Object(e.jsx)(v.a.TabPane,{tab:"onEvent metrics",children:Object(e.jsx)(y,{tab:l.OnEvent})},l.OnEvent),s(l.ExportEvents)&&Object(e.jsx)(v.a.TabPane,{tab:"exportEvents metrics",children:Object(e.jsx)(y,{tab:l.ExportEvents})},l.ExportEvents),s(l.ScheduledTask)&&Object(e.jsx)(v.a.TabPane,{tab:Object(e.jsxs)(e.Fragment,{children:["Scheduled tasks"," ",Object(e.jsx)(w.a,{title:"Shows metrics for app methods `runEveryMinute`, `runEveryHour` and `runEveryDay`",children:Object(e.jsx)(g.IconInfo,{})})]}),children:Object(e.jsx)(y,{tab:l.ScheduledTask})},l.ScheduledTask),s(l.HistoricalExports)&&Object(e.jsx)(v.a.TabPane,{tab:"Historical exports",children:Object(e.jsx)(he,{})},l.HistoricalExports),Object(e.jsx)(v.a.TabPane,{tab:"History",children:Object(e.jsx)(ye.a,{scope:Ee.a.PLUGIN,id:t==null?void 0:t.id})},l.History)]}),Object(e.jsx)(Oe,{})]})}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(j,b,o){var v=o("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js");b=v(!1),b.push([j.i,".AppMetricsGraph{height:300px}",""]),j.exports=b}}]);
