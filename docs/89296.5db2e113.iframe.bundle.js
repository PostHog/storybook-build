"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[89296],{"./frontend/src/scenes/pipeline/PipelineBatchExportConfiguration.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>PipelineBatchExportConfiguration});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_components_NotFound__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonCheckbox__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCheckbox/index.ts"),lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/index.ts"),lib_lemon_ui_Spinner__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/index.ts"),scenes_batch_exports_BatchExportEditForm__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/batch_exports/BatchExportEditForm.tsx"),_types__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/types.ts"),_pipelineBatchExportConfigurationLogic__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/scenes/pipeline/pipelineBatchExportConfigurationLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelineBatchExportConfiguration(_ref){let{service,id}=_ref;if(service&&!_types__WEBPACK_IMPORTED_MODULE_9__.e2.includes(service))return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_2__.T,{object:`batch export service ${service}`});let logicProps={service:service||null,id:id||null},logic=(0,_pipelineBatchExportConfigurationLogic__WEBPACK_IMPORTED_MODULE_10__.t)(logicProps),{isNew,configuration,savedConfiguration,isConfigurationSubmitting,batchExportConfigLoading}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(logic),{resetConfiguration,submitConfiguration}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(logic);return batchExportConfigLoading?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_Spinner__WEBPACK_IMPORTED_MODULE_7__.$,{}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"space-y-3",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(kea_forms__WEBPACK_IMPORTED_MODULE_1__.Form,{logic:_pipelineBatchExportConfigurationLogic__WEBPACK_IMPORTED_MODULE_10__.t,props:logicProps,formKey:"configuration",className:"space-y-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_5__.D,{name:"name",label:"Name",info:"Customising the name can be useful if multiple instances of the same type are used.",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_6__.D,{type:"text"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_5__.D,{name:"enabled",info:"Start continuously exporting from now",children:_ref2=>{let{value,onChange}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonCheckbox__WEBPACK_IMPORTED_MODULE_4__.H,{label:"Enabled",onChange:()=>onChange(!value),checked:value})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(BatchExportConfigurationFields,{isNew:isNew,formValues:configuration}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",{className:"flex gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_3__.J,{type:"secondary",htmlType:"reset",onClick:()=>resetConfiguration(savedConfiguration||{}),disabledReason:isConfigurationSubmitting?"Saving in progress…":void 0,children:isNew?"Reset":"Cancel"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_3__.J,{type:"primary",htmlType:"submit",onClick:submitConfiguration,loading:isConfigurationSubmitting,children:isNew?"Create":"Save"})]})]})})})}function BatchExportConfigurationFields(_ref3){let{isNew,formValues}=_ref3;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(scenes_batch_exports_BatchExportEditForm__WEBPACK_IMPORTED_MODULE_8__.pU,{isNew:isNew,isPipeline:!0,batchExportConfigForm:formValues}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(scenes_batch_exports_BatchExportEditForm__WEBPACK_IMPORTED_MODULE_8__.g3,{isNew:isNew,batchExportConfigForm:formValues})]})}},"./frontend/src/scenes/pipeline/PipelineNode.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PIPELINE_TAB_TO_NODE_STAGE:()=>PIPELINE_TAB_TO_NODE_STAGE,PipelineNode:()=>PipelineNode,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),ActivityLog=__webpack_require__("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/LemonTabs.tsx"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),PipelineNodeLogs=__webpack_require__("./frontend/src/scenes/pipeline/PipelineNodeLogs.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),PipelineBatchExportConfiguration=__webpack_require__("./frontend/src/scenes/pipeline/PipelineBatchExportConfiguration.tsx"),pipelineNodeLogic=__webpack_require__("./frontend/src/scenes/pipeline/pipelineNodeLogic.tsx"),PipelinePluginConfiguration=__webpack_require__("./frontend/src/scenes/pipeline/PipelinePluginConfiguration.tsx"),pipeline_types=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelineNodeConfiguration(){let{node,stage}=(0,index_esm.useValues)(pipelineNodeLogic.y);return stage?(0,jsx_runtime.jsx)("div",{className:"space-y-3",children:node.backend===pipeline_types.b.Plugin?(0,jsx_runtime.jsx)(PipelinePluginConfiguration.s,{stage:stage,pluginConfigId:node.id}):(0,jsx_runtime.jsx)(PipelineBatchExportConfiguration.B,{id:node.id})}):(0,jsx_runtime.jsx)(NotFound.T,{object:"pipeline app stage"})}var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.0_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),Chart=__webpack_require__("./frontend/src/lib/Chart.ts"),colors=__webpack_require__("./frontend/src/lib/colors.ts"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonLabel=__webpack_require__("./frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),LemonSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),pipelineNodeMetricsLogic=__webpack_require__("./frontend/src/scenes/pipeline/pipelineNodeMetricsLogic.tsx");function PipelineNodeMetrics(_ref){let{id}=_ref,logic=(0,pipelineNodeMetricsLogic.j)({id}),{appMetricsResponse,appMetricsResponseLoading,dateFrom}=(0,index_esm.useValues)(logic),{setDateFrom}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,jsx_runtime.jsx)(MetricsOverview,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{value:dateFrom,onChange:newValue=>setDateFrom(newValue),options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Delivery trends"}),(0,jsx_runtime.jsx)(AppMetricsGraph,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Errors"}),(0,jsx_runtime.jsx)(ErrorsOverview,{id:id})]})]})}function MetricsOverview(_ref2){let{metrics,metricsLoading}=_ref2;return metricsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-20 h-4 mb-2",repeat:4}):(0,jsx_runtime.jsx)("div",{className:"space-y-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:["Events Processed successfully",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Total number of events processed successfully",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.successes)})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:["Events Failed",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Total number of events that threw an error during processing",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.failures)})]})]})})}function renderNumber(value){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value?(0,utils.Lc)(value):value})}function AppMetricsGraph(_ref3){let{metrics,metricsLoading}=_ref3,canvasRef=(0,react.useRef)(null);return((0,react.useEffect)(()=>{let chart;if(canvasRef.current&&metrics&&!(0,utils.es)())return chart=new Chart.k(canvasRef.current?.getContext("2d"),{type:"line",data:{labels:metrics.dates,datasets:[{label:"events processed successfully",data:metrics.successes,borderColor:"",...colorConfig("data-color-1")},{label:"events failed",data:metrics.failures,...colorConfig("data-color-5")}]},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}}),()=>{chart?.destroy()}},[metrics]),metricsLoading||!metrics)?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"AppMetricsGraph border rounded p-6"}):(0,jsx_runtime.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:(0,jsx_runtime.jsx)("canvas",{ref:canvasRef})})}function colorConfig(baseColorVar){let mainColor=(0,colors.cM)(baseColorVar);return{borderColor:mainColor,hoverBorderColor:(0,utils._$)(mainColor,-20),hoverBackgroundColor:(0,utils._$)(mainColor,-20),backgroundColor:mainColor,fill:!1,borderWidth:2,pointRadius:0}}function ErrorsOverview(_ref4){let{id}=_ref4,logic=(0,pipelineNodeMetricsLogic.j)({id}),{appMetricsResponse,appMetricsResponseLoading}=(0,index_esm.useValues)(logic),{openErrorDetailsModal}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ErrorDetailsModal,{id:id}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:appMetricsResponse?.errors||[],loading:appMetricsResponseLoading,columns:[{title:"Error type",dataIndex:"error_type",render:function RenderErrorType(_,errorSummary){return(0,jsx_runtime.jsx)(Link.r,{title:"View details",className:"font-semibold",onClick:event=>{event.preventDefault(),openErrorDetailsModal(errorSummary.error_type)},children:errorSummary.error_type})},sorter:(a,b)=>a.error_type.localeCompare(b.error_type)},{title:"Count",dataIndex:"count",align:"right",sorter:(a,b)=>a.count-b.count},{title:"Last seen",dataIndex:"last_seen",render:function RenderCreatedAt(lastSeen){return(0,jsx_runtime.jsx)("div",{className:"whitespace-nowrap text-right",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:lastSeen})})},align:"right",sorter:(a,b)=>new Date(a.last_seen||0)>new Date(b.last_seen||0)?1:-1}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:(0,jsx_runtime.jsxs)("div",{className:"",children:[(0,jsx_runtime.jsx)("b",{children:"No errors! \uD83E\uDD73"}),(0,jsx_runtime.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})]})}function ErrorDetailsModal(_ref5){let{id}=_ref5,logic=(0,pipelineNodeMetricsLogic.j)({id}),{errorDetails,errorDetailsModalError,errorDetailsLoading}=(0,index_esm.useValues)(logic),{closeErrorDetailsModal}=(0,index_esm.useActions)(logic),[page,setPage]=(0,react.useState)(0),activeErrorDetails=errorDetails[page];return(0,jsx_runtime.jsx)(LemonModal.f,{isOpen:!!errorDetailsModalError,onClose:closeErrorDetailsModal,title:errorDetailsModalError,width:"min(50vw, 80rem)",description:(0,jsx_runtime.jsx)("span",{children:activeErrorDetails?.error_details?.error.message?.substring(0,200)}),footer:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("span",{children:[page+1," of ",errorDetails.length," sample",errorDetails.length>1?"s":""]}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.ed,{}),onClick:()=>setPage(page-1),disabledReason:0==page?"First page":void 0}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.VG,{}),onClick:()=>setPage(page+1),disabledReason:page==errorDetails.length-1?"Last page":void 0})]})}),children:!errorDetailsModalError||errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"When:"})," ",(0,jsx_runtime.jsx)(TZLabel.w,{time:activeErrorDetails.timestamp,showSeconds:!0})]}),activeErrorDetails.error_details.eventCount&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Event Count"}),(0,jsx_runtime.jsx)("div",{children:activeErrorDetails.error_details.eventCount})]}),activeErrorDetails.error_details.error.message&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Error message",defaultIsExpanded:!0,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.message})}),activeErrorDetails.error_details.event&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Event payload",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JSON,children:JSON.stringify(activeErrorDetails.error_details.event,null,2)})}),activeErrorDetails.error_details.error.stack&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Stack trace",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.stack})})]})})}function CollapsibleSection(props){let[isExpanded,setIsExpanded]=(0,react.useState)(props.defaultIsExpanded);return(0,jsx_runtime.jsxs)("div",{className:"bg-mid border rounded",children:[(0,jsx_runtime.jsx)(LemonButton.J,{fullWidth:!0,onClick:()=>setIsExpanded(!isExpanded),sideIcon:isExpanded?(0,jsx_runtime.jsx)(posthog_icons_es.IconCollapse,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand,{}),title:isExpanded?"Show less":"Show more",className:"bg-mid",children:props.title}),isExpanded&&(0,jsx_runtime.jsx)("div",{className:"bg-bg-light p-2",children:props.children})]})}let PIPELINE_TAB_TO_NODE_STAGE={[types.J9.Transformations]:types.We.Transformation,[types.J9.Destinations]:types.We.Destination,[types.J9.SiteApps]:types.We.SiteApp,[types.J9.ImportApps]:types.We.ImportApp},paramsToProps=_ref=>{let{params:{stage,id}}=_ref,numericId=id&&/^\d+$/.test(id)?parseInt(id):void 0;if(!stage||!id)throw Error("Loaded PipelineNode without either `stage` or `id` passed in");return{stage:PIPELINE_TAB_TO_NODE_STAGE[stage]||null,id:numericId&&!isNaN(numericId)?numericId:id}},scene={component:PipelineNode,logic:pipelineNodeLogic.y,paramsToProps};function PipelineNode(){let params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stage,id}=paramsToProps({params}),{currentTab,node}=(0,index_esm.useValues)(pipelineNodeLogic.y);if(!stage)return(0,jsx_runtime.jsx)(NotFound.T,{object:"pipeline stage"});if("new"===node.name)return(0,jsx_runtime.jsx)(PipelineNodeConfiguration,{});let tabToContent={[types.il.Configuration]:(0,jsx_runtime.jsx)(PipelineNodeConfiguration,{}),[types.il.Metrics]:(0,jsx_runtime.jsx)(PipelineNodeMetrics,{id:id}),[types.il.Logs]:(0,jsx_runtime.jsx)(PipelineNodeLogs.e,{id:id,stage:stage}),[types.il.History]:(0,jsx_runtime.jsx)(ActivityLog.D,{id:id,scope:types.jc.PLUGIN})};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,tabs:Object.values(types.il).map(tab=>({label:(0,utils.fm)(tab),key:tab,content:tabToContent[tab],link:params.stage?urls.j.pipelineNode(stage,id,tab):void 0}))})]})}},"./frontend/src/scenes/pipeline/PipelineNodeLogs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{e:()=>PipelineNodeLogs});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_constants__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/constants.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/utils.tsx"),_pipelineNodeLogsLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/pipeline/pipelineNodeLogsLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelineNodeLogs(_ref){let{id,stage}=_ref,logic=(0,_pipelineNodeLogsLogic__WEBPACK_IMPORTED_MODULE_4__.Y)({id,stage}),{logs,logsLoading,backgroundLogs,columns,isThereMoreToLoad,selectedLogLevels}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(logic),{revealBackground,loadMoreLogs,setSelectedLogLevels,setSearchTerm}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)(logic);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"ph-no-capture space-y-2 flex-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonInput,{type:"search",placeholder:"Search for messages containing…",fullWidth:!0,onChange:setSearchTerm,allowClear:!0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex items-center gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{className:"mr-1",children:"Show logs of level:"}),Object.values(_pipelineNodeLogsLogic__WEBPACK_IMPORTED_MODULE_4__.i).map(level=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonCheckbox,{label:level,checked:selectedLogLevels.includes(level),onChange:checked=>{let newLogLevels=checked?[...selectedLogLevels,level]:selectedLogLevels.filter(t=>t!=level);setSelectedLogLevels(newLogLevels)}},level))]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{onClick:revealBackground,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:backgroundLogs.length?void 0:"There's nothing to load",children:backgroundLogs.length?`Load ${(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__._6)(backgroundLogs.length,"newer entry","newer entries")}`:"No new entries"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTable,{dataSource:logs,columns:columns,loading:logsLoading,className:"ph-no-capture",rowKey:"timestamp",pagination:{pageSize:200,hideOnSinglePage:!0}}),!!logs.length&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{onClick:loadMoreLogs,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:isThereMoreToLoad?void 0:"There's nothing more to load",children:isThereMoreToLoad?`Load up to ${lib_constants__WEBPACK_IMPORTED_MODULE_2__.F2} older entries`:"No older entries"})]})}},"./frontend/src/scenes/pipeline/PipelinePluginConfiguration.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>PipelinePluginConfiguration});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.0_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_components_NotFound__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),lib_lemon_ui_LemonMarkdown__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMarkdown/index.ts"),react__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),scenes_pipeline_configUtils__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/scenes/pipeline/configUtils.ts"),scenes_plugins_edit_PluginField__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/plugins/edit/PluginField.tsx"),_pipelinePluginConfigurationLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/pipeline/pipelinePluginConfigurationLogic.tsx"),_utils__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelinePluginConfiguration(_ref){let{stage,pluginId,pluginConfigId}=_ref,logicProps={stage:stage,pluginId:pluginId||null,pluginConfigId:pluginConfigId||null},logic=(0,_pipelinePluginConfigurationLogic__WEBPACK_IMPORTED_MODULE_9__.z)(logicProps),{plugin,isNew,isConfigurationSubmitting,savedConfiguration,hiddenFields,requiredFields,loading,configurationChanged}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(logic),{submitConfiguration,resetConfiguration}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(logic);if(!stage)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_4__.T,{object:"pipeline stage"});if(loading)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Spinner,{});if(!plugin)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_4__.T,{object:`pipeline ${stage}`});let configSchemaArray=(0,scenes_pipeline_configUtils__WEBPACK_IMPORTED_MODULE_12__.fN)(plugin.config_schema),fields=configSchemaArray.map((fieldConfig,index)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(react__WEBPACK_IMPORTED_MODULE_7__.Fragment,{children:fieldConfig.key&&fieldConfig.type&&(0,scenes_pipeline_configUtils__WEBPACK_IMPORTED_MODULE_12__.Zs)(fieldConfig)&&!hiddenFields.includes(fieldConfig.key)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_5__.D,{name:fieldConfig.key,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:[fieldConfig.secret&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Tooltip,{placement:"top-start",title:"This field is write-only. Its value won't be visible after saving.",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconLock,{className:"ml-1.5"})}),fieldConfig.markdown&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonMarkdown__WEBPACK_IMPORTED_MODULE_6__.j,{children:fieldConfig.markdown}),fieldConfig.name||fieldConfig.key]}),help:fieldConfig.hint&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonMarkdown__WEBPACK_IMPORTED_MODULE_6__.j,{className:"mt-0.5",children:fieldConfig.hint}),showOptional:!requiredFields.includes(fieldConfig.key),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(scenes_plugins_edit_PluginField__WEBPACK_IMPORTED_MODULE_8__.B,{fieldConfig:fieldConfig})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:fieldConfig.type?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("p",{className:"text-danger",children:["Invalid config field ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("i",{children:fieldConfig.name||fieldConfig.key}),"."]}):null})},fieldConfig.key||`__key__${index}`));return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",{className:"space-y-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_utils__WEBPACK_IMPORTED_MODULE_10__.Wf,{plugin:plugin}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",{className:"flex flex-col py-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"flex flex-row items-center font-semibold text-sm gap-1",children:plugin.name}),plugin.description?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div",{className:"text-default text-xs text-text-secondary-3000 mt-1",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonMarkdown__WEBPACK_IMPORTED_MODULE_6__.j,{className:"max-w-[30rem]",lowKeyHeadings:!0,children:plugin.description})}):null]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(kea_forms__WEBPACK_IMPORTED_MODULE_3__.Form,{logic:_pipelinePluginConfigurationLogic__WEBPACK_IMPORTED_MODULE_9__.z,props:logicProps,formKey:"configuration",className:"space-y-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_5__.D,{name:"name",label:"Name",info:"Customising the name can be useful if multiple instances of the same type are used.",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonInput,{type:"text"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_5__.D,{name:"description",label:"Description",info:"Add a description to share context with other team members",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonInput,{type:"text"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_5__.D,{name:"enabled",children:_ref2=>{let{value,onChange}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonCheckbox,{label:"Enabled",onChange:()=>onChange(!value),checked:value})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.Fragment,{children:fields}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div",{className:"flex gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonButton,{type:"secondary",htmlType:"reset",onClick:()=>resetConfiguration(savedConfiguration||{}),disabledReason:isConfigurationSubmitting?"Saving in progress…":configurationChanged?void 0:"No changes",children:"Clear changes"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonButton,{type:"primary",htmlType:"submit",onClick:submitConfiguration,loading:isConfigurationSubmitting,children:isNew?"Create":"Save"})]})]})]})}},"./frontend/src/scenes/pipeline/pipelineNodeMetricsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>pipelineNodeMetricsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/utils.tsx"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");let pipelineNodeMetricsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{id}=_ref;return id}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(id=>["scenes","pipeline","appMetricsLogic",id]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic,["currentTeamId"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setDateFrom:dateFrom=>({dateFrom}),openErrorDetailsModal:errorType=>({errorType}),closeErrorDetailsModal:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values,props}=_ref2;return{appMetricsResponse:[null,{loadMetrics:async()=>{let params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({date_from:values.dateFrom});return await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic.values.currentTeamId}/app_metrics/${props.id}?${params}`)}}],errorDetails:[[],{openErrorDetailsModal:async _ref3=>{let{errorType}=_ref3,params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({error_type:errorType}),{result}=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic.values.currentTeamId}/app_metrics/${props.id}/error_details?${params}`);return result}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({dateFrom:["-7d",{setDateFrom:(_,_ref4)=>{let{dateFrom}=_ref4;return dateFrom}}],errorDetailsModalError:[null,{openErrorDetailsModal:(_,_ref5)=>{let{errorType}=_ref5;return errorType},closeErrorDetailsModal:()=>null}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref6=>{let{actions}=_ref6;return{setDateFrom:()=>{actions.loadMetrics()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref7=>{let{actions}=_ref7;actions.loadMetrics()})])},"./frontend/src/scenes/plugins/edit/PluginField.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>PluginField});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.0_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),CodeEditors=__webpack_require__("./frontend/src/lib/components/CodeEditors.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),AutoSizer=__webpack_require__("./node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),configUtils=__webpack_require__("./frontend/src/scenes/pipeline/configUtils.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function UploadField(_ref){let{value,onChange}=_ref;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[value?.name?(0,jsx_runtime.jsxs)("span",{children:["Selected file: ",value.name]}):null,(0,jsx_runtime.jsx)(src.LemonFileInput,{accept:"*",multiple:!1,onChange:files=>onChange?.(files[0]),value:value?.size?[value]:[],showUploadedFiles:!1})]})}function JsonConfigField(props){return(0,jsx_runtime.jsx)(AutoSizer.q,{disableWidth:!0,className:"min-h-60",children:_ref=>{let{height}=_ref;return(0,jsx_runtime.jsx)(CodeEditors.p,{className:"border",language:"json",value:props.value,onChange:v=>props.onChange?.(null!=v?v:""),height:height,options:{minimap:{enabled:!1}}})}})}function PluginField(_ref2){let{value,onChange,fieldConfig}=_ref2,[editingSecret,setEditingSecret]=(0,react.useState)(!1);return fieldConfig.secret&&!editingSecret&&value&&(value===configUtils.ue||value.name===configUtils.ue)?(0,jsx_runtime.jsxs)(src.LemonButton,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{}),onClick:()=>{onChange?.(fieldConfig.default||""),setEditingSecret(!0)},children:["Reset secret ","attachment"===fieldConfig.type?"attachment":"field"]}):"attachment"===fieldConfig.type?(0,jsx_runtime.jsx)(UploadField,{value:value,onChange:onChange}):"string"===fieldConfig.type?(0,jsx_runtime.jsx)(src.LemonInput,{value:value,onChange:onChange,autoFocus:editingSecret,className:"ph-no-capture"}):"json"===fieldConfig.type?(0,jsx_runtime.jsx)(JsonConfigField,{value:value,onChange:onChange,autoFocus:editingSecret,className:"ph-no-capture"}):"choice"===fieldConfig.type?(0,jsx_runtime.jsx)(src.LemonSelect,{fullWidth:!0,value:value,className:"ph-no-capture",onChange:onChange,options:fieldConfig.choices.map(choice=>({label:choice,value:choice}))}):(0,jsx_runtime.jsxs)("strong",{className:"text-danger",children:['Unknown field type "',(0,jsx_runtime.jsx)("code",{children:fieldConfig.type}),'".',(0,jsx_runtime.jsx)("br",{}),"You may need to upgrade PostHog!"]})}}}]);