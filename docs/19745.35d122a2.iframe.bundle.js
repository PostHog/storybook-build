"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[19745],{"./frontend/src/scenes/pipeline/PipelineNodeNew.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PipelineNodeNew:()=>PipelineNodeNew,scene:()=>scene});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.0_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),lib_components_PayGateMini_PayGateMini__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),lib_hooks_useFeatureFlag__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/hooks/useFeatureFlag.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/urls.ts"),_types__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/types.ts"),_destinationsLogic__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/scenes/pipeline/destinationsLogic.tsx"),_frontendAppsLogic__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/scenes/pipeline/frontendAppsLogic.tsx"),_hogfunctions_HogFunctionConfiguration__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/scenes/pipeline/hogfunctions/HogFunctionConfiguration.tsx"),_hogfunctions_HogFunctionIcon__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./frontend/src/scenes/pipeline/hogfunctions/HogFunctionIcon.tsx"),_PipelineBatchExportConfiguration__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./frontend/src/scenes/pipeline/PipelineBatchExportConfiguration.tsx"),_PipelineNode__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./frontend/src/scenes/pipeline/PipelineNode.tsx"),_pipelineNodeNewLogic__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./frontend/src/scenes/pipeline/pipelineNodeNewLogic.tsx"),_PipelinePluginConfiguration__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./frontend/src/scenes/pipeline/PipelinePluginConfiguration.tsx"),_transformationsLogic__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./frontend/src/scenes/pipeline/transformationsLogic.tsx"),_types__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let paramsToProps=_ref=>{let{params:{stage,id}}=_ref,numericId=id&&/^\d+$/.test(id)?parseInt(id):void 0,pluginId=numericId&&!isNaN(numericId)?numericId:null,hogFunctionId=pluginId?null:id?.startsWith("hog-")?id.slice(4):null,batchExportDestination=hogFunctionId?null:null!=id?id:null;return{stage:_PipelineNode__WEBPACK_IMPORTED_MODULE_16__.PIPELINE_TAB_TO_NODE_STAGE[stage+"s"]||null,pluginId,batchExportDestination,hogFunctionId}},scene={component:PipelineNodeNew,logic:_pipelineNodeNewLogic__WEBPACK_IMPORTED_MODULE_17__.Q,paramsToProps};function convertPluginToTableEntry(plugin){return{backend:_types__WEBPACK_IMPORTED_MODULE_20__.b.Plugin,id:plugin.id,name:plugin.name,description:plugin.description||"",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_utils__WEBPACK_IMPORTED_MODULE_21__.Wf,{plugin:plugin}),url:plugin.url}}function convertBatchExportToTableEntry(service){return{backend:_types__WEBPACK_IMPORTED_MODULE_20__.b.BatchExport,id:service,name:service,description:`${service} batch export`,icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_utils__WEBPACK_IMPORTED_MODULE_21__.oe,{type:service}),url:(0,_utils__WEBPACK_IMPORTED_MODULE_21__.n1)(service)}}function convertHogFunctionToTableEntry(hogFunction){return{backend:_types__WEBPACK_IMPORTED_MODULE_20__.b.HogFunction,id:`hog-${hogFunction.id}`,name:hogFunction.name,description:hogFunction.description,icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_hogfunctions_HogFunctionIcon__WEBPACK_IMPORTED_MODULE_14__._,{size:"small",src:hogFunction.icon_url})}}function PipelineNodeNew(){let params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stage,pluginId,batchExportDestination,hogFunctionId}=paramsToProps({params});if(!stage)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__.T,{object:"pipeline app stage"});if(pluginId){let res=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_PipelinePluginConfiguration__WEBPACK_IMPORTED_MODULE_18__.s,{stage:stage,pluginId:pluginId});return stage===_types__WEBPACK_IMPORTED_MODULE_10__.We.Destination?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_PayGateMini_PayGateMini__WEBPACK_IMPORTED_MODULE_4__.E,{feature:_types__WEBPACK_IMPORTED_MODULE_10__.P$.DATA_PIPELINES,children:res}):res}if(batchExportDestination)return stage!==_types__WEBPACK_IMPORTED_MODULE_10__.We.Destination?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__.T,{object:batchExportDestination}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_PayGateMini_PayGateMini__WEBPACK_IMPORTED_MODULE_4__.E,{feature:_types__WEBPACK_IMPORTED_MODULE_10__.P$.DATA_PIPELINES,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_PipelineBatchExportConfiguration__WEBPACK_IMPORTED_MODULE_15__.B,{service:batchExportDestination})});if(hogFunctionId){let res=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_hogfunctions_HogFunctionConfiguration__WEBPACK_IMPORTED_MODULE_13__.g,{templateId:hogFunctionId});return stage===_types__WEBPACK_IMPORTED_MODULE_10__.We.Destination?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_PayGateMini_PayGateMini__WEBPACK_IMPORTED_MODULE_4__.E,{feature:_types__WEBPACK_IMPORTED_MODULE_10__.P$.DATA_PIPELINES,children:res}):res}return stage===_types__WEBPACK_IMPORTED_MODULE_10__.We.Transformation?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(TransformationOptionsTable,{}):stage===_types__WEBPACK_IMPORTED_MODULE_10__.We.Destination?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_PayGateMini_PayGateMini__WEBPACK_IMPORTED_MODULE_4__.E,{feature:_types__WEBPACK_IMPORTED_MODULE_10__.P$.DATA_PIPELINES,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(DestinationOptionsTable,{})}):stage===_types__WEBPACK_IMPORTED_MODULE_10__.We.SiteApp?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(SiteAppOptionsTable,{}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__.T,{object:"pipeline new options"})}function TransformationOptionsTable(){let{plugins,loading}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_transformationsLogic__WEBPACK_IMPORTED_MODULE_19__.P),targets=Object.values(plugins).map(convertPluginToTableEntry);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(NodeOptionsTable,{stage:_types__WEBPACK_IMPORTED_MODULE_10__.We.Transformation,targets:targets,loading:loading})}function DestinationOptionsTable(){let hogFunctionsEnabled=!!(0,lib_hooks_useFeatureFlag__WEBPACK_IMPORTED_MODULE_5__.y)("HOG_FUNCTIONS"),{batchExportServiceNames}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_pipelineNodeNewLogic__WEBPACK_IMPORTED_MODULE_17__.Q),{plugins,loading,hogFunctionTemplates}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_destinationsLogic__WEBPACK_IMPORTED_MODULE_11__.w),pluginTargets=Object.values(plugins).map(convertPluginToTableEntry),batchExportTargets=Object.values(batchExportServiceNames).map(convertBatchExportToTableEntry),hogFunctionTargets=hogFunctionsEnabled?Object.values(hogFunctionTemplates).map(convertHogFunctionToTableEntry):[],targets=[...batchExportTargets,...pluginTargets,...hogFunctionTargets];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(NodeOptionsTable,{stage:_types__WEBPACK_IMPORTED_MODULE_10__.We.Destination,targets:targets,loading:loading})}function SiteAppOptionsTable(){let{plugins,loading}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_frontendAppsLogic__WEBPACK_IMPORTED_MODULE_12__.$),targets=Object.values(plugins).map(convertPluginToTableEntry);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(NodeOptionsTable,{stage:_types__WEBPACK_IMPORTED_MODULE_10__.We.SiteApp,targets:targets,loading:loading})}function NodeOptionsTable(_ref2){let{stage,targets,loading}=_ref2,{hashParams}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(kea_router__WEBPACK_IMPORTED_MODULE_2__.router);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.Fragment,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_lemon_ui_LemonTable__WEBPACK_IMPORTED_MODULE_7__.g,{dataSource:targets,size:"small",loading:loading,columns:[{title:"App",width:0,render:function RenderAppInfo(_,target){return target.icon}},{title:"Name",sticky:!0,render:function RenderName(_,target){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_lemon_ui_LemonTable_LemonTableLink__WEBPACK_IMPORTED_MODULE_8__.i,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_9__.j.pipelineNodeNew(stage,target.id),title:target.name,description:target.description})}},{title:"Actions",width:100,align:"right",render:function RenderActions(_,target){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_6__.J,{type:"primary","data-attr":`new-${stage}-${target.id}`,icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_22__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconPlusSmall,{}),to:(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.combineUrl)(scenes_urls__WEBPACK_IMPORTED_MODULE_9__.j.pipelineNodeNew(stage,target.id),{},hashParams).url,children:"Create"})}}]})})}}}]);