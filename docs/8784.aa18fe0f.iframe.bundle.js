(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[8784],{"./frontend/src/scenes/instance/SystemStatus/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SystemStatus:()=>SystemStatus_SystemStatus,scene:()=>scene});var injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),SystemStatus=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/instance/SystemStatus/index.scss"),SystemStatus_default=__webpack_require__.n(SystemStatus),options={insert:"head",singleton:!1};injectStylesIntoStyleTag_default()(SystemStatus_default(),options);SystemStatus_default().locals;var esm_extends=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.10/node_modules/@babel/runtime/helpers/esm/extends.js"),defineProperty=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.10/node_modules/@babel/runtime/helpers/esm/defineProperty.js"),slicedToArray=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.10/node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),CloseOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/CloseOutlined.js"),CheckCircleOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/CheckCircleOutlined.js"),ExclamationCircleOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/ExclamationCircleOutlined.js"),InfoCircleOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),CloseCircleOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/CloseCircleOutlined.js"),CheckCircleFilled=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/CheckCircleFilled.js"),ExclamationCircleFilled=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/ExclamationCircleFilled.js"),InfoCircleFilled=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/InfoCircleFilled.js"),CloseCircleFilled=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/icons/CloseCircleFilled.js"),es=__webpack_require__("./node_modules/.pnpm/rc-motion@2.6.2_react-dom@16.14.0_react@16.14.0/node_modules/rc-motion/es/index.js"),classnames=__webpack_require__("./node_modules/.pnpm/classnames@2.3.2/node_modules/classnames/index.js"),classnames_default=__webpack_require__.n(classnames),context=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/config-provider/context.js"),getDataOrAriaProps=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/_util/getDataOrAriaProps.js"),classCallCheck=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.10/node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),createClass=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.10/node_modules/@babel/runtime/helpers/esm/createClass.js"),inherits=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.10/node_modules/@babel/runtime/helpers/esm/inherits.js"),createSuper=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.10/node_modules/@babel/runtime/helpers/esm/createSuper.js"),ErrorBoundary=function(_React$Component){(0,inherits.Z)(ErrorBoundary,_React$Component);var _super=(0,createSuper.Z)(ErrorBoundary);function ErrorBoundary(){var _this;return(0,classCallCheck.Z)(this,ErrorBoundary),(_this=_super.apply(this,arguments)).state={error:void 0,info:{componentStack:""}},_this}return(0,createClass.Z)(ErrorBoundary,[{key:"componentDidCatch",value:function componentDidCatch(error,info){this.setState({error,info})}},{key:"render",value:function render(){var _this$props=this.props,message=_this$props.message,description=_this$props.description,children=_this$props.children,_this$state=this.state,error=_this$state.error,info=_this$state.info,componentStack=info&&info.componentStack?info.componentStack:null,errorMessage=void 0===message?(error||"").toString():message,errorDescription=void 0===description?componentStack:description;return error?react.createElement(es_alert,{type:"error",message:errorMessage,description:react.createElement("pre",null,errorDescription)}):children}}]),ErrorBoundary}(react.Component),reactNode=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/_util/reactNode.js"),__rest=function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t},iconMapFilled={success:CheckCircleFilled.Z,info:InfoCircleFilled.Z,error:CloseCircleFilled.Z,warning:ExclamationCircleFilled.Z},iconMapOutlined={success:CheckCircleOutlined.Z,info:InfoCircleOutlined.Z,error:CloseCircleOutlined.Z,warning:ExclamationCircleOutlined.Z},Alert=function Alert(_a){var _classNames2,description=_a.description,customizePrefixCls=_a.prefixCls,message=_a.message,banner=_a.banner,_a$className=_a.className,className=void 0===_a$className?"":_a$className,style=_a.style,onMouseEnter=_a.onMouseEnter,onMouseLeave=_a.onMouseLeave,onClick=_a.onClick,afterClose=_a.afterClose,showIcon=_a.showIcon,closable=_a.closable,closeText=_a.closeText,action=_a.action,props=__rest(_a,["description","prefixCls","message","banner","className","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","action"]),_React$useState=react.useState(!1),_React$useState2=(0,slicedToArray.Z)(_React$useState,2),closed=_React$useState2[0],setClosed=_React$useState2[1],ref=react.useRef(),_React$useContext=react.useContext(context.E_),getPrefixCls=_React$useContext.getPrefixCls,direction=_React$useContext.direction,prefixCls=getPrefixCls("alert",customizePrefixCls),handleClose=function handleClose(e){var _a;setClosed(!0),null===(_a=props.onClose)||void 0===_a||_a.call(props,e)},isClosable=!!closeText||closable,type=function getType(){var type=props.type;return void 0!==type?type:banner?"warning":"info"}(),isShowIcon=!(!banner||void 0!==showIcon)||showIcon,alertCls=classnames_default()(prefixCls,"".concat(prefixCls,"-").concat(type),(_classNames2={},(0,defineProperty.Z)(_classNames2,"".concat(prefixCls,"-with-description"),!!description),(0,defineProperty.Z)(_classNames2,"".concat(prefixCls,"-no-icon"),!isShowIcon),(0,defineProperty.Z)(_classNames2,"".concat(prefixCls,"-banner"),!!banner),(0,defineProperty.Z)(_classNames2,"".concat(prefixCls,"-rtl"),"rtl"===direction),_classNames2),className),dataOrAriaProps=(0,getDataOrAriaProps.Z)(props);return react.createElement(es.default,{visible:!closed,motionName:"".concat(prefixCls,"-motion"),motionAppear:!1,motionEnter:!1,onLeaveStart:function onLeaveStart(node){return{maxHeight:node.offsetHeight}},onLeaveEnd:afterClose},(function(_ref){var motionClassName=_ref.className,motionStyle=_ref.style;return react.createElement("div",(0,esm_extends.Z)({ref,"data-show":!closed,className:classnames_default()(alertCls,motionClassName),style:(0,esm_extends.Z)((0,esm_extends.Z)({},style),motionStyle),onMouseEnter,onMouseLeave,onClick,role:"alert"},dataOrAriaProps),isShowIcon?function renderIconNode(){var icon=props.icon,iconType=(description?iconMapOutlined:iconMapFilled)[type]||null;return icon?(0,reactNode.wm)(icon,react.createElement("span",{className:"".concat(prefixCls,"-icon")},icon),(function(){return{className:classnames_default()("".concat(prefixCls,"-icon"),(0,defineProperty.Z)({},icon.props.className,icon.props.className))}})):react.createElement(iconType,{className:"".concat(prefixCls,"-icon")})}():null,react.createElement("div",{className:"".concat(prefixCls,"-content")},message?react.createElement("div",{className:"".concat(prefixCls,"-message")},message):null,description?react.createElement("div",{className:"".concat(prefixCls,"-description")},description):null),action?react.createElement("div",{className:"".concat(prefixCls,"-action")},action):null,function renderCloseIcon(){return isClosable?react.createElement("button",{type:"button",onClick:handleClose,className:"".concat(prefixCls,"-close-icon"),tabIndex:0},closeText?react.createElement("span",{className:"".concat(prefixCls,"-close-text")},closeText):react.createElement(CloseOutlined.Z,null)):null}())}))};Alert.ErrorBoundary=ErrorBoundary;const es_alert=Alert;var systemStatusLogic=__webpack_require__("./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),preflightLogic=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),LemonTag=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx"),src=__webpack_require__("./frontend/@posthog/apps-common/src/index.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const TIMESTAMP_VALUES=new Set(["last_event_ingested_timestamp"]);function RenderMetricValue(_,_ref){let{key,value,value_type,emptyNullLabel,isSecret}=_ref;return value&&isSecret?(0,jsx_runtime.jsx)(LemonTag.o,{style:{color:"var(--muted)",backgroundColor:"#fee5b3"},className:"uppercase",icon:isSecret?(0,jsx_runtime.jsx)(icons._V1,{style:{color:"var(--warning)"}}):void 0,children:"Secret"}):key&&TIMESTAMP_VALUES.has(key)&&"string"==typeof value?new Date(value).getTime()===new Date("1970-01-01T00:00:00").getTime()?"Never":(0,jsx_runtime.jsx)(src.TZLabel,{time:value}):"bool"===value_type||"boolean"==typeof value?(0,jsx_runtime.jsx)(LemonTag.o,{className:"uppercase",type:value?"success":"danger",children:value?"Yes":"No"}):null==value||""===value?(0,jsx_runtime.jsx)(LemonTag.o,{className:"uppercase",style:{color:"var(--muted)"},children:null!=emptyNullLabel?emptyNullLabel:"Unknown"}):"int"===value_type||"number"==typeof value?value.toLocaleString("en-US"):value.toString()}var lemon_ui_src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts");const METRIC_KEY_TO_INTERNAL_LINK={async_migrations_ok:"/instance/async_migrations"};function RenderMetric(_,systemStatusRow){return(0,jsx_runtime.jsxs)("span",{children:[systemStatusRow.metric," ",METRIC_KEY_TO_INTERNAL_LINK[systemStatusRow.key]?(0,jsx_runtime.jsx)(Link.r,{to:METRIC_KEY_TO_INTERNAL_LINK[systemStatusRow.key],children:(0,jsx_runtime.jsx)(icons.pFn,{style:{verticalAlign:"middle"}})}):null]})}function OverviewTab(){const{overview,systemStatusLoading}=(0,index_esm.useValues)(systemStatusLogic.Q);return(0,jsx_runtime.jsx)(lemon_ui_src.LemonTable,{className:"system-status-table",rowKey:"metric",dataSource:overview,columns:[{title:"Metric",className:"metric-column",render:RenderMetric},{title:"Value",render:RenderMetricValue}],loading:systemStatusLoading,expandable:{expandedRowRender:function renderExpand(row){return row.subrows?.rows.length?(0,jsx_runtime.jsx)(Subrows,{...row.subrows}):null},rowExpandable:row=>!!row.subrows?.rows.length}})}function Subrows(props){return(0,jsx_runtime.jsx)(lemon_ui_src.LemonTable,{dataSource:props.rows,columns:props.columns.map(((title,dataIndex)=>({title,dataIndex}))),embedded:!0})}var es_checkbox=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/checkbox/index.js"),es_button=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/button/index.js"),table=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/table/index.js"),objectSpread2=__webpack_require__("./node_modules/.pnpm/@babel+runtime@7.22.10/node_modules/@babel/runtime/helpers/esm/objectSpread2.js");const asn_ReloadOutlined={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"};var AntdIcon=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_react-dom@16.14.0_react@16.14.0/node_modules/@ant-design/icons/es/components/AntdIcon.js"),ReloadOutlined_ReloadOutlined=function ReloadOutlined(props,ref){return react.createElement(AntdIcon.Z,(0,objectSpread2.Z)((0,objectSpread2.Z)({},props),{},{ref,icon:asn_ReloadOutlined}))};ReloadOutlined_ReloadOutlined.displayName="ReloadOutlined";const icons_ReloadOutlined=react.forwardRef(ReloadOutlined_ReloadOutlined);var LemonCollapse=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCollapse/index.ts");function InternalMetricsTab(){const{openSections,queries,queriesLoading}=(0,index_esm.useValues)(systemStatusLogic.Q),{setOpenSections,loadQueries}=(0,index_esm.useActions)(systemStatusLogic.Q),[showIdle,setShowIdle]=(0,react.useState)(!1),postgresQueries=(0,react.useMemo)((()=>queries?.postgres_running?.filter((_ref=>{let{state}=_ref;return showIdle||"idle"!==state}))),[showIdle,queries]),reloadQueries=e=>{e.stopPropagation(),loadQueries()};return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonCollapse.J,{activeKeys:openSections,onChange:keys=>setOpenSections(keys),multiple:!0,panels:[{key:"1",header:"PostgreSQL - currently running queries",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 float-right",children:[(0,jsx_runtime.jsx)(es_checkbox.Z,{checked:showIdle,onChange:e=>{setShowIdle(e.target.checked)},children:"Show idle queries"}),(0,jsx_runtime.jsxs)(es_button.Z,{style:{marginLeft:8},onClick:reloadQueries,children:[(0,jsx_runtime.jsx)(icons_ReloadOutlined,{})," Reload Queries"]})]}),(0,jsx_runtime.jsx)(QueryTable,{queries:postgresQueries,loading:queriesLoading})]})},null!=queries?.clickhouse_running&&{key:"2",header:"Clickhouse - currently running queries",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mb-4 float-right",children:(0,jsx_runtime.jsxs)(es_button.Z,{style:{marginLeft:8},onClick:reloadQueries,children:[(0,jsx_runtime.jsx)(icons_ReloadOutlined,{})," Reload Queries"]})}),(0,jsx_runtime.jsx)(QueryTable,{queries:queries?.clickhouse_running,loading:queriesLoading})]})},null!=queries?.clickhouse_slow_log&&{key:"3",header:"Clickhouse - slow query log (past 6 hours)",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"mb-4 float-right",children:(0,jsx_runtime.jsxs)(es_button.Z,{style:{marginLeft:8},onClick:reloadQueries,children:[(0,jsx_runtime.jsx)(icons_ReloadOutlined,{})," Reload Queries"]})}),(0,jsx_runtime.jsx)(QueryTable,{queries:queries?.clickhouse_slow_log,loading:queriesLoading})]})}]})})}function QueryTable(props){const columns=[{title:"duration",dataIndex:"duration",key:"duration",sorter:(a,b)=>+a.duration-+b.duration},{title:"query",dataIndex:"query",render:function RenderAnalyze(_,item){return item.query},key:"query"}];return props.queries&&props.queries.length>0&&Object.keys(props.queries[0]).forEach((column=>{"duration"!==column&&"query"!==column&&columns.push({title:column,dataIndex:column,key:column})})),(0,jsx_runtime.jsx)(table.Z,{dataSource:props.queries||[],columns,loading:props.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",bordered:!0,style:{overflowX:"auto",overflowY:"auto"},locale:{emptyText:"No queries found"}})}var LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),useKeyboardHotkeys=__webpack_require__("./frontend/src/lib/hooks/useKeyboardHotkeys.tsx");function RenderMetricValueEdit(_ref){let{key,value,value_type,onValueChanged,isSecret}=_ref;if("bool"===value_type)return(0,jsx_runtime.jsx)(lemon_ui_src.LemonCheckbox,{defaultChecked:!!value,onChange:val=>onValueChanged(key,val),label:(0,jsx_runtime.jsx)(LemonTag.o,{type:value?"success":"danger",className:"uppercase",children:value?"Yes":"No"})});const parsedValue=isSecret&&value?"":value;return(0,jsx_runtime.jsx)(lemon_ui_src.LemonInput,{defaultValue:parsedValue,type:"int"===value_type?"number":"text",placeholder:isSecret&&value?"Keep existing secret value":void 0,onBlur:e=>onValueChanged(key,e.target.value)})}try{RenderMetricValueEdit.displayName="RenderMetricValueEdit",RenderMetricValueEdit.__docgenInfo={description:"",displayName:"RenderMetricValueEdit",props:{onValueChanged:{defaultValue:null,description:"",name:"onValueChanged",required:!0,type:{name:"(key: string, value: any) => void"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string | number | boolean | null"}},value_type:{defaultValue:null,description:"",name:"value_type",required:!1,type:{name:"enum",value:[{value:'"bool"'},{value:'"str"'},{value:'"int"'}]}},emptyNullLabel:{defaultValue:null,description:"",name:"emptyNullLabel",required:!1,type:{name:"string"}},isSecret:{defaultValue:null,description:"",name:"isSecret",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"]={docgenInfo:RenderMetricValueEdit.__docgenInfo,name:"RenderMetricValueEdit",path:"frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"})}catch(__react_docgen_typescript_loader_error){}var LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx");function ChangeRow(_ref){let{metricKey,oldValue,value,isSecret}=_ref;return value?.toString()===oldValue?.toString()?null:(0,jsx_runtime.jsxs)("div",{className:"bg-border-light radius p-2",children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("code",{children:metricKey})}),(0,jsx_runtime.jsxs)("div",{className:"text-muted",children:["Value will be changed",!isSecret&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[" from ",(0,jsx_runtime.jsx)("span",{className:"font-bold text-default",children:RenderMetricValue(0,{key:metricKey,value:oldValue,emptyNullLabel:"Unset",isSecret})})]})," to ",(0,jsx_runtime.jsx)("span",{className:"font-bold text-default",children:RenderMetricValue(0,{key:metricKey,value,emptyNullLabel:"Unset"})}),isSecret&&(0,jsx_runtime.jsx)("div",{className:"text-danger",children:"This field is secret - you won't see its value once saved"})]})]})}function InstanceConfigSaveModal(_ref2){let{onClose,isOpen}=_ref2;const{instanceConfigEditingState,editableInstanceSettings,updatedInstanceConfigCount}=(0,index_esm.useValues)(systemStatusLogic.Q),{saveInstanceConfig}=(0,index_esm.useActions)(systemStatusLogic.Q),loading=null!==updatedInstanceConfigCount,isChangingEnabledEmailSettings=!1!==instanceConfigEditingState.EMAIL_ENABLED&&Object.keys(instanceConfigEditingState).find((key=>key.startsWith("EMAIL"))),isEnablingEmail=!0===instanceConfigEditingState.EMAIL_ENABLED,changeNoun=1===Object.keys(instanceConfigEditingState).length?"change":"changes";return(0,jsx_runtime.jsx)(lemon_ui_src.LemonModal,{title:`Confirm ${changeNoun} to instance configuration`,isOpen,closable:!loading,onClose,width:576,footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{type:"secondary",onClick:onClose,disabledReason:loading?"Saving in progress":void 0,children:"Cancel"}),(0,jsx_runtime.jsxs)(lemon_ui_src.LemonButton,{type:"primary",status:"danger",loading,onClick:saveInstanceConfig,children:["Apply ",changeNoun]})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[isChangingEnabledEmailSettings&&(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",children:["As you are changing email settings and ",isEnablingEmail?"enabling email":"email is enabled",", we'll attempt to send a test email so you can verify everything works."]}),Object.keys(instanceConfigEditingState).includes("RECORDINGS_TTL_WEEKS")&&(0,jsx_runtime.jsx)(LemonBanner.V,{type:"warning",children:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Changing your recordings TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately."})}),Object.keys(instanceConfigEditingState).includes("RECORDINGS_PERFORMANCE_EVENTS_TTL_WEEKS")&&(0,jsx_runtime.jsx)(LemonBanner.V,{type:"warning",children:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Changing your performance events TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately."})}),(0,jsx_runtime.jsxs)("div",{children:["The following ",changeNoun," will be immediately applied to your instance."]}),Object.keys(instanceConfigEditingState).map((key=>(0,jsx_runtime.jsx)(ChangeRow,{metricKey:key,value:instanceConfigEditingState[key],oldValue:editableInstanceSettings.find((record=>record.key===key))?.value,isSecret:editableInstanceSettings.find((record=>record.key===key))?.is_secret},key))),loading&&(0,jsx_runtime.jsx)("div",{className:"mt-4 text-success",children:(0,jsx_runtime.jsxs)("b",{children:[(0,utils._6)(updatedInstanceConfigCount||0,"change")," updated successfully."]})})]})})}try{InstanceConfigSaveModal.displayName="InstanceConfigSaveModal",InstanceConfigSaveModal.__docgenInfo={description:"",displayName:"InstanceConfigSaveModal",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"]={docgenInfo:InstanceConfigSaveModal.__docgenInfo,name:"InstanceConfigSaveModal",path:"frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"})}catch(__react_docgen_typescript_loader_error){}function InstanceConfigTab(){const{configOptions,preflightLoading}=(0,index_esm.useValues)(preflightLogic.preflightLogic),{editableInstanceSettings,instanceSettingsLoading,instanceConfigMode,instanceConfigEditingState}=(0,index_esm.useValues)(systemStatusLogic.Q),{loadInstanceSettings,setInstanceConfigMode,updateInstanceConfigValue,clearInstanceConfigEditing}=(0,index_esm.useActions)(systemStatusLogic.Q);(0,react.useEffect)((()=>{loadInstanceSettings()}),[]),(0,useKeyboardHotkeys.l)({e:{action:()=>setInstanceConfigMode(systemStatusLogic.D.Edit),disabled:instanceConfigMode!==systemStatusLogic.D.View||instanceSettingsLoading},escape:{action:()=>discard(),disabled:instanceConfigMode!==systemStatusLogic.D.Edit||instanceSettingsLoading},enter:{action:()=>save(),disabled:instanceConfigMode!==systemStatusLogic.D.Edit||instanceSettingsLoading}});const save=()=>{Object.keys(instanceConfigEditingState).length?setInstanceConfigMode(systemStatusLogic.D.Saving):setInstanceConfigMode(systemStatusLogic.D.View)},discard=()=>{setInstanceConfigMode(systemStatusLogic.D.View),clearInstanceConfigEditing()},columns=[{title:"Key",dataIndex:"key",render:function render(value){return(0,jsx_runtime.jsx)("code",{children:value})}},{title:"Description",dataIndex:"description"},{title:"Value",render:function renderValue(_,record){var _instanceConfigEditin;const props={value:record.value,key:record.key,emptyNullLabel:"Unset",value_type:record.value_type,isSecret:record.is_secret};return instanceConfigMode===systemStatusLogic.D.View?RenderMetricValue(0,props):RenderMetricValueEdit({...props,value:null!==(_instanceConfigEditin=instanceConfigEditingState[record.key])&&void 0!==_instanceConfigEditin?_instanceConfigEditin:record.value,onValueChanged:updateInstanceConfigValue})}}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("h3",{children:"Instance configuration"}),(0,jsx_runtime.jsxs)("div",{children:["Changing these settings will take effect on your entire instance."," ",(0,jsx_runtime.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings",target:"_blank",children:["Learn more ",(0,jsx_runtime.jsx)(icons.pFn,{style:{verticalAlign:"middle"}})]}),"."]})]}),instanceConfigMode===systemStatusLogic.D.View?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{type:"primary",onClick:()=>setInstanceConfigMode(systemStatusLogic.D.Edit),"data-attr":"instance-config-edit-button",disabled:instanceSettingsLoading,children:"Edit"})}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object.keys(instanceConfigEditingState).length>0&&(0,jsx_runtime.jsxs)("span",{className:"text-warning-dark flex items-center gap-2",children:[(0,jsx_runtime.jsx)(icons.FCX,{className:"text-xl"}),(0,jsx_runtime.jsxs)("span",{children:["You have ",(0,jsx_runtime.jsx)("b",{children:Object.keys(instanceConfigEditingState).length})," unapplied"," ",(0,utils._6)(Object.keys(instanceConfigEditingState).length,"change",void 0,!1)]})]}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{type:"secondary",disabled:instanceSettingsLoading,onClick:discard,children:"Discard changes"}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{type:"primary",disabled:instanceSettingsLoading,onClick:save,children:"Save"})]})]}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:editableInstanceSettings,columns,loading:instanceSettingsLoading,rowKey:"key"}),(0,jsx_runtime.jsxs)("div",{className:"my-4",children:[(0,jsx_runtime.jsx)("h3",{children:"Environment configuration"}),(0,jsx_runtime.jsxs)("div",{children:["These settings can only be modified by environment variables."," ",(0,jsx_runtime.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/environment-variables",target:"_blank",children:["Learn more ",(0,jsx_runtime.jsx)(icons.pFn,{style:{verticalAlign:"middle"}})]}),"."]})]}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:configOptions,columns:[{key:"metric",title:"Metric",dataIndex:"metric"},{title:"Value",dataIndex:"value"}],loading:preflightLoading,rowKey:"key"}),(0,jsx_runtime.jsx)(InstanceConfigSaveModal,{isOpen:instanceConfigMode===systemStatusLogic.D.Saving,onClose:()=>setInstanceConfigMode(systemStatusLogic.D.Edit)})]})}var userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),modal=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/modal/index.js"),divider=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/divider/index.js"),ProfilePicture=__webpack_require__("./frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts");const staffUsersLogic=(0,index_esm.kea)({path:["scenes","instance","SystemStatus","staffUsersLogic"],connect:{values:[userLogic.userLogic,["user"]],actions:[userLogic.userLogic,["loadUser"]]},actions:{setStaffUsersToBeAdded:userUuids=>({userUuids}),addStaffUsers:!0,deleteStaffUser:userUuid=>({userUuid})},reducers:{staffUsersToBeAdded:[[],{setStaffUsersToBeAdded:(_,_ref)=>{let{userUuids}=_ref;return userUuids}}]},loaders:_ref2=>{let{actions,values}=_ref2;return{allUsers:[[],{loadAllUsers:async()=>{var _await$api$get$result;return null!==(_await$api$get$result=(await api.ZP.get("api/users")).results)&&void 0!==_await$api$get$result?_await$api$get$result:[]},addStaffUsers:async()=>{const{staffUsersToBeAdded,allUsers}=values;actions.setStaffUsersToBeAdded([]);const newStaffUsers=await Promise.all(staffUsersToBeAdded.map((async userUuid=>await api.ZP.update(`api/users/${userUuid}`,{is_staff:!0})))),updatedAllUsers=[...allUsers.filter((_ref3=>{let{uuid}=_ref3;return!staffUsersToBeAdded.includes(uuid)})),...newStaffUsers];return updatedAllUsers.sort(((a,b)=>a.first_name.localeCompare(b.first_name))),updatedAllUsers},deleteStaffUser:async _ref4=>{let{userUuid}=_ref4;await api.ZP.update(`api/users/${userUuid}`,{is_staff:!1}),values.user?.uuid===userUuid&&(actions.loadUser(),lib.router.actions.push(urls.j.projectHomepage()));const updatedAllUsers=[...values.allUsers];for(const user of updatedAllUsers)user.uuid===userUuid&&(user.is_staff=!1);return updatedAllUsers}}]}},selectors:{staffUsers:[s=>[s.allUsers],allUsers=>allUsers.filter((user=>user.is_staff))],nonStaffUsers:[s=>[s.allUsers],allUsers=>allUsers.filter((user=>!user.is_staff))]},events:_ref5=>{let{actions}=_ref5;return{afterMount:[actions.loadAllUsers]}}});var LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonSelectMultiple=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelectMultiple/LemonSelectMultiple.tsx"),UserSelectItem=__webpack_require__("./frontend/src/lib/components/UserSelectItem.tsx");function StaffUsersTab(){const{user:myself}=(0,index_esm.useValues)(userLogic.userLogic),{staffUsers,allUsersLoading,nonStaffUsers,staffUsersToBeAdded}=(0,index_esm.useValues)(staffUsersLogic),{setStaffUsersToBeAdded,addStaffUsers,deleteStaffUser}=(0,index_esm.useActions)(staffUsersLogic),columns=[{key:"profile_picture",render:function ProfilePictureRender(_,user){return(0,jsx_runtime.jsx)(ProfilePicture.Y,{name:user.first_name,email:user.email})},width:32},{key:"name",title:"Name",dataIndex:"first_name",render:function ProfilePictureRender(_,user){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[user.first_name,user.uuid===myself?.uuid&&(0,jsx_runtime.jsx)(LemonTag.o,{className:"uppercase ml-1",children:"Me"})]})}},{key:"email",title:"Email",dataIndex:"email"},{key:"actions",width:32,render:function RenderActions(_,user){return(0,jsx_runtime.jsx)(LemonButton.Jp,{"data-attr":"invite-delete",icon:(0,jsx_runtime.jsx)(icons.Fzz,{}),status:"danger",disabled:staffUsers.length<2,title:staffUsers.length<2?"You should always have at least one staff user.":"Cancel the invite",onClick:()=>{modal.Z.confirm({title:`Remove ${myself?.uuid===user.uuid?"yourself":user.first_name} as a Staff User?`,icon:null,okText:"Remove user",okType:"primary",okButtonProps:{className:"btn-danger"},content:(0,jsx_runtime.jsx)("div",{style:{border:""},children:myself?.uuid===user.uuid?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Please confirm you want to ",(0,jsx_runtime.jsx)("b",{children:"remove yourself"})," as a staff user.",(0,jsx_runtime.jsx)("div",{style:{fontWeight:"normal",color:"var(--muted-alt)"},children:"Only another staff user will be able to add you again."})]}):`Are you sure you want to remove ${user.first_name} as a Staff User?`}),onOk(){deleteStaffUser(user.uuid)},cancelText:"Cancel"})}})}}];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Staff Users"}),(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:["Users who have permissions to manage instance-wide settings. Staff user permissions are set at the"," ",(0,jsx_runtime.jsx)("b",{children:"instance-level and are independent of any organization or project permissions."})," ",(0,jsx_runtime.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings#staff-users",target:"_blank",children:["Learn more ",(0,jsx_runtime.jsx)(icons.pFn,{style:{verticalAlign:"middle"}})]}),"."]}),(0,jsx_runtime.jsx)(divider.Z,{style:{margin:0,marginBottom:16}}),(0,jsx_runtime.jsx)("section",{children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,jsx_runtime.jsx)("div",{style:{flex:1},children:(0,jsx_runtime.jsx)(LemonSelectMultiple.E,{placeholder:"Add staff users here…",loading:allUsersLoading,value:staffUsersToBeAdded,onChange:newValues=>setStaffUsersToBeAdded(newValues),filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:(0,UserSelectItem.W)(nonStaffUsers,"uuid")})}),(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"primary",loading:allUsersLoading,disabled:0===staffUsersToBeAdded.length,onClick:addStaffUsers,children:"Add"})]})}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:staffUsers,columns,loading:allUsersLoading,rowKey:"uuid"})]})}var featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),row=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/row/index.js"),col=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@16.14.0_react@16.14.0/node_modules/antd/es/col/index.js"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),kea_forms_lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js");const kafkaInspectorLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","instance","SystemStatus","kafkaInspectorLogic"]),(0,index_esm.actions)({fetchKafkaMessage:(topic,partition,offset)=>({topic,partition,offset})}),(0,kea_loaders_lib.loaders)({kafkaMessage:[null,{fetchKafkaMessage:async _ref=>{let{topic,partition,offset}=_ref;return await api.ZP.create("api/kafka_inspector/fetch_message",{topic,partition,offset})}}]}),(0,kea_forms_lib.forms)((_ref2=>{let{actions}=_ref2;return{fetchKafkaMessage:{defaults:{topic:"clickhouse_events_json",partition:0,offset:0},submit:_ref3=>{let{topic,partition,offset}=_ref3;actions.fetchKafkaMessage(topic,Number(partition),Number(offset))}}}}))]);var LemonInput=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx");function KafkaInspectorTab(){const{kafkaMessage}=(0,index_esm.useValues)(kafkaInspectorLogic);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Kafka Inspector"}),(0,jsx_runtime.jsx)("div",{className:"mb-4",children:"Debug Kafka messages using the inspector tool."}),(0,jsx_runtime.jsx)(divider.Z,{style:{margin:0,marginBottom:16}}),(0,jsx_runtime.jsx)("section",{children:(0,jsx_runtime.jsx)("div",{style:{display:"flex",marginBottom:"0.75rem"},children:(0,jsx_runtime.jsx)(kea_forms_lib.Form,{logic:kafkaInspectorLogic,formKey:"fetchKafkaMessage",className:"ant-form-horizontal ant-form-hide-required-mark",enableFormOnSubmit:!0,children:(0,jsx_runtime.jsxs)(row.Z,{gutter:[24,24],children:[(0,jsx_runtime.jsx)(col.Z,{span:8,children:(0,jsx_runtime.jsx)(kea_forms_lib.Field,{name:"topic",children:(0,jsx_runtime.jsx)(LemonInput.D,{placeholder:"Topic"})})}),(0,jsx_runtime.jsxs)(col.Z,{span:4,children:[(0,jsx_runtime.jsx)(kea_forms_lib.Field,{name:"partition",children:(0,jsx_runtime.jsx)(LemonInput.D,{placeholder:"Partition",type:"number"})})," "]}),(0,jsx_runtime.jsxs)(col.Z,{span:4,children:[(0,jsx_runtime.jsx)(kea_forms_lib.Field,{name:"offset",children:(0,jsx_runtime.jsx)(LemonInput.D,{placeholder:"Offset",type:"number"})})," "]}),(0,jsx_runtime.jsx)(col.Z,{span:6,children:(0,jsx_runtime.jsxs)(es_button.Z,{htmlType:"submit",type:"primary","data-attr":"fetch-kafka-message-submit-button",children:["Fetch message"," "]})})]})})})}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JSON,children:kafkaMessage?JSON.stringify(kafkaMessage,null,4):"\n"})]})}var LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts");const scene={component:SystemStatus_SystemStatus,logic:systemStatusLogic.Q};function SystemStatus_SystemStatus(){const{tab,error}=(0,index_esm.useValues)(systemStatusLogic.Q),{setTab}=(0,index_esm.useActions)(systemStatusLogic.Q),{preflight,siteUrlMisconfigured}=(0,index_esm.useValues)(preflightLogic.preflightLogic),{user}=(0,index_esm.useValues)(userLogic.userLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h);let tabs=[{key:"overview",label:(0,jsx_runtime.jsxs)(Tooltip.u,{title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"System overview is cached for 60 seconds"}),children:["System overview ",(0,jsx_runtime.jsx)(icons.aUG,{})]}),content:(0,jsx_runtime.jsx)(OverviewTab,{})}];return user?.is_staff&&(tabs=tabs.concat([{key:"metrics",label:"Internal metrics",content:(0,jsx_runtime.jsx)(InternalMetricsTab,{})},{key:"settings",label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Settings"," ",(0,jsx_runtime.jsx)(LemonTag.o,{type:"warning",className:"uppercase",children:"Beta"})]}),content:(0,jsx_runtime.jsx)(InstanceConfigTab,{})},{key:"staff_users",label:"Staff Users",content:(0,jsx_runtime.jsx)(StaffUsersTab,{})}]),featureFlags[constants.y8.KAFKA_INSPECTOR]&&tabs.push({key:"kafka_inspector",label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Kafka Inspector"," ",(0,jsx_runtime.jsx)(LemonTag.o,{type:"warning",className:"uppercase",children:"Beta"})]}),content:(0,jsx_runtime.jsx)(KafkaInspectorTab,{})})),(0,jsx_runtime.jsxs)("div",{className:"system-status-scene",children:[(0,jsx_runtime.jsx)(PageHeader.m,{title:"Instance status & settings",caption:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Here you can find all the critical runtime details and settings of your PostHog instance. You have access to this because you're a ",(0,jsx_runtime.jsx)("b",{children:"staff user"}),"."," ",(0,jsx_runtime.jsxs)("a",{target:"_blank",style:{display:"inline-flex",alignItems:"center"},href:"https://posthog.com/docs/self-host/configure/instance-settings?utm_medium=in-product&utm_campaign=instance_status",children:["Learn more ",(0,jsx_runtime.jsx)(icons.pFn,{style:{marginLeft:4}})]}),"."]})}),error&&(0,jsx_runtime.jsx)(es_alert,{message:"Something went wrong",description:error||(0,jsx_runtime.jsx)("span",{children:"An unknown error occurred. Please try again or contact us."}),type:"error",showIcon:!0}),siteUrlMisconfigured&&(0,jsx_runtime.jsx)(es_alert,{message:"Misconfiguration detected",description:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Your ",(0,jsx_runtime.jsx)("code",{children:"SITE_URL"})," environment variable seems misconfigured. Your"," ",(0,jsx_runtime.jsx)("code",{children:"SITE_URL"})," is set to"," ",(0,jsx_runtime.jsx)("b",{children:(0,jsx_runtime.jsx)("code",{children:preflight?.site_url})})," ","but you're currently browsing this page from"," ",(0,jsx_runtime.jsx)("b",{children:(0,jsx_runtime.jsx)("code",{children:window.location.origin})}),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."," ",(0,jsx_runtime.jsxs)("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig",children:["Learn more ",(0,jsx_runtime.jsx)(icons.pFn,{})]})]}),showIcon:!0,type:"warning",style:{marginBottom:32}}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tab,onChange:setTab,tabs})]})}},"./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{D:()=>ConfigMode,Q:()=>systemStatusLogic});var lib_api__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/src/lib/api.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/utils.tsx"),lib_lemon_ui_lemonToast__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/lemon-ui/lemonToast.tsx"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts");let ConfigMode=function(ConfigMode){return ConfigMode.View="view",ConfigMode.Edit="edit",ConfigMode.Saving="saving",ConfigMode}({});const EDITABLE_INSTANCE_SETTINGS=["RECORDINGS_TTL_WEEKS","RECORDINGS_PERFORMANCE_EVENTS_TTL_WEEKS","EMAIL_ENABLED","EMAIL_HOST","EMAIL_PORT","EMAIL_HOST_USER","EMAIL_HOST_PASSWORD","EMAIL_USE_TLS","EMAIL_USE_SSL","EMAIL_DEFAULT_FROM","EMAIL_REPLY_TO","AGGREGATE_BY_DISTINCT_IDS_TEAMS","PERSON_ON_EVENTS_ENABLED","GROUPS_ON_EVENTS_ENABLED","STRICT_CACHING_TEAMS","SLACK_APP_CLIENT_ID","SLACK_APP_CLIENT_SECRET","SLACK_APP_SIGNING_SECRET","PARALLEL_DASHBOARD_ITEM_CACHE","RATE_LIMIT_ENABLED","RATE_LIMITING_ALLOW_LIST_TEAMS","SENTRY_AUTH_TOKEN","SENTRY_ORGANIZATION","HEATMAP_SAMPLE_N"],systemStatusLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)({path:["scenes","instance","SystemStatus","systemStatusLogic"],actions:{setTab:tab=>({tab}),setOpenSections:sections=>({sections}),setInstanceConfigMode:mode=>({mode}),updateInstanceConfigValue:(key,value)=>({key,value}),clearInstanceConfigEditing:!0,saveInstanceConfig:!0,setUpdatedInstanceConfigCount:count=>({count}),increaseUpdatedInstanceConfigCount:!0},loaders:()=>({systemStatus:[null,{loadSystemStatus:async()=>{var _await$api$get$result;return(0,lib_utils__WEBPACK_IMPORTED_MODULE_4__.Pc)()?scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_3__.preflightLogic.values.preflight?.cloud&&!scenes_userLogic__WEBPACK_IMPORTED_MODULE_2__.userLogic.values.user?.is_staff?null:null!==(_await$api$get$result=(await lib_api__WEBPACK_IMPORTED_MODULE_0__.ZP.get("api/instance_status")).results)&&void 0!==_await$api$get$result?_await$api$get$result:null:null}}],instanceSettings:[[],{loadInstanceSettings:async()=>{var _await$api$get$result2;return null!==(_await$api$get$result2=(await lib_api__WEBPACK_IMPORTED_MODULE_0__.ZP.get("api/instance_settings")).results)&&void 0!==_await$api$get$result2?_await$api$get$result2:[]}}],queries:[null,{loadQueries:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_0__.ZP.get("api/instance_status/queries")).results}]}),reducers:{tab:["overview",{setTab:(_,_ref)=>{let{tab}=_ref;return tab}}],error:[null,{loadSystemStatusFailure:(_,_ref2)=>{let{error}=_ref2;return error}}],openSections:[["0"],{persist:!0},{setOpenSections:(_,_ref3)=>{let{sections}=_ref3;return sections}}],instanceConfigMode:[ConfigMode.View,{setInstanceConfigMode:(_,_ref4)=>{let{mode}=_ref4;return mode}}],instanceConfigEditingState:[{},{updateInstanceConfigValue:(s,_ref5)=>{let{key,value}=_ref5;if(void 0!==value)return{...s,[key]:value};const newState={...s};return delete newState[key],newState},clearInstanceConfigEditing:()=>({})}],updatedInstanceConfigCount:[null,{setUpdatedInstanceConfigCount:(_,_ref6)=>{let{count}=_ref6;return count},loadInstanceSettings:()=>null,increaseUpdatedInstanceConfigCount:state=>(null!=state?state:0)+1}]},selectors:()=>({overview:[s=>[s.systemStatus],status=>status?status.overview:[]],editableInstanceSettings:[s=>[s.instanceSettings],instanceSettings=>instanceSettings.filter((item=>item.editable&&EDITABLE_INSTANCE_SETTINGS.includes(item.key)))]}),listeners:_ref7=>{let{actions,values}=_ref7;return{setTab:_ref8=>{let{tab}=_ref8;"metrics"===tab&&actions.loadQueries(),actions.setInstanceConfigMode(ConfigMode.View)},updateInstanceConfigValue:_ref9=>{let{key,value}=_ref9;const previousValue=values.editableInstanceSettings.find((item=>item.key===key))?.value;value&&previousValue==value&&actions.updateInstanceConfigValue(key,void 0)},saveInstanceConfig:async(_,breakpoint)=>{actions.setUpdatedInstanceConfigCount(0),Object.entries(values.instanceConfigEditingState).map((async _ref10=>{let[key,value]=_ref10;try{await lib_api__WEBPACK_IMPORTED_MODULE_0__.ZP.update(`api/instance_settings/${key}`,{value}),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_6__.vx.actions.reportInstanceSettingChange(key,value),actions.increaseUpdatedInstanceConfigCount()}catch{lib_lemon_ui_lemonToast__WEBPACK_IMPORTED_MODULE_5__.UJ.error("There was an error updating instance settings – please try again"),await breakpoint(1e3),actions.loadInstanceSettings()}})),await breakpoint(1e3),values.updatedInstanceConfigCount===Object.keys(values.instanceConfigEditingState).length&&(actions.loadInstanceSettings(),actions.clearInstanceConfigEditing(),actions.setInstanceConfigMode(ConfigMode.View),lib_lemon_ui_lemonToast__WEBPACK_IMPORTED_MODULE_5__.UJ.success("Instance settings updated"))}}},events:_ref11=>{let{actions}=_ref11;return{afterMount:()=>{actions.loadSystemStatus()}}},actionToUrl:_ref12=>{let{values}=_ref12;return{setTab:()=>"/instance/"+("overview"===values.tab?"status":values.tab)}},urlToAction:_ref13=>{let{actions,values}=_ref13;return{"/instance(/:tab)":_ref14=>{let{tab}=_ref14;const currentTab=tab&&["metrics","settings","staff_users","kafka_inspector"].includes(tab)?tab:"overview";currentTab!==values.tab&&actions.setTab(currentTab)}}}})},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.18_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/instance/SystemStatus/index.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}.embedded-svg-wrapper{cursor:text}.embedded-svg-wrapper svg{width:100%;height:100%}",""]),module.exports=exports}}]);