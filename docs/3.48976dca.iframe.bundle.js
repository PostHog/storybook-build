(window.webpackJsonp=window.webpackJsonp||[]).push([[3,4,6,7,8,9,11,307],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(R,c,e){"use strict";e.r(c);var p=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),m=e.n(p),u=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),i=e.n(u),j={};j.insert="head",j.singleton=!1;var g=m()(i.a,j);c.default=i.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(R,c,e){"use strict";e.r(c),e.d(c,"AppMetricsGraph",function(){return W});var p=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),m=e.n(p),u=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=e.n(u),j=e("./node_modules/core-js/modules/es.array.concat.js"),g=e.n(j),h=e("./node_modules/core-js/modules/es.object.keys.js"),f=e.n(h),n=e("./node_modules/core-js/modules/es.symbol.js"),y=e.n(n),E=e("./node_modules/core-js/modules/es.array.filter.js"),I=e.n(E),O=e("./node_modules/core-js/modules/es.object.to-string.js"),l=e.n(O),d=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),P=e.n(d),L=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),C=e.n(L),_=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),T=e.n(_),b=e("./node_modules/react/index.js"),K=e.n(b),D=e("./frontend/src/lib/colors.ts"),$=e("./node_modules/chart.js/dist/chart.mjs"),B=e("./frontend/src/scenes/apps/constants.tsx"),H=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),Y=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),N=e("./frontend/src/lib/utils.tsx"),U=e("./node_modules/react/jsx-runtime.js"),Z=e.n(U);function J(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),s.push.apply(s,o)}return s}function A(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?J(Object(s),!0).forEach(function(o){m()(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):J(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function W(t){var r=t.tab,s=t.metrics,o=t.metricsLoading,a=Object(b.useRef)(null),v=B.DescriptionColumns[r];return Object(b.useEffect)(function(){var x;if(a.current&&s){var M;x=new $.a((M=a.current)===null||M===void 0?void 0:M.getContext("2d"),{type:"line",data:{labels:s.dates,datasets:[A({label:v.successes,data:s.successes,borderColor:""},V("data-brand-blue"))].concat(i()(v.successes_on_retry?[A({label:v.successes_on_retry,data:s.successes_on_retry},V("data-yellow"))]:[]),[A({label:v.failures,data:s.failures},V("data-pink"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var S;(S=x)===null||S===void 0||S.destroy()}},[s]),o||!s?Object(U.jsx)(H.a,{className:"AppMetricsGraph"}):Object(U.jsx)("div",{className:"AppMetricsGraph",children:Object(U.jsx)("canvas",{ref:a})})}function V(t){var r=Object(D.b)(t);return{borderColor:r,hoverBorderColor:Object(N.lb)(r,-20),hoverBackgroundColor:Object(N.lb)(r,-20),backgroundColor:r,fill:!1,borderWidth:2,pointRadius:0}}try{W.displayName="AppMetricsGraph",W.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:W.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(t){}},"./frontend/src/scenes/apps/HistoricalExport.tsx":function(R,c,e){"use strict";e.r(c),e.d(c,"HistoricalExport",function(){return y});var p=e("./node_modules/antd/es/card/index.js"),m=e("./node_modules/kea/lib/index.esm.js"),u=e("./frontend/src/lib/utils.tsx"),i=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),j=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),g=e("./frontend/src/scenes/apps/historicalExportLogic.ts"),h=e("./frontend/src/scenes/apps/MetricsTab.tsx"),f=e("./node_modules/react/jsx-runtime.js"),n=e.n(f);function y(E){var I,O,l=Object(m.useValues)(Object(g.historicalExportLogic)(E)),d=l.data,P=l.dataLoading;return Object(f.jsxs)("div",{className:"mt-4 mb-4 mr-8",children:[Object(f.jsxs)(p.a,{title:"Overview",children:[d&&d.summary.duration?Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{className:"card-secondary",children:"Export duration"}),Object(f.jsx)("div",{children:Object(u.O)(d.summary.duration)})]}):null,Object(f.jsx)(h.MetricsOverview,{tab:j.AppMetricsTab.HistoricalExports,metrics:(I=d==null?void 0:d.metrics)!==null&&I!==void 0?I:null,metricsLoading:P})]}),Object(f.jsx)(p.a,{title:"Delivery trends",className:"mt-4",children:Object(f.jsx)(i.AppMetricsGraph,{tab:j.AppMetricsTab.HistoricalExports,metrics:(O=d==null?void 0:d.metrics)!==null&&O!==void 0?O:null,metricsLoading:P})})]})}try{y.displayName="HistoricalExport",y.__docgenInfo={description:"",displayName:"HistoricalExport",props:{pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"]={docgenInfo:y.__docgenInfo,name:"HistoricalExport",path:"frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"})}catch(E){}},"./frontend/src/scenes/apps/HistoricalExportsTab.tsx":function(R,c,e){"use strict";e.r(c),e.d(c,"HistoricalExportsTab",function(){return O});var p=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),m=e.n(p),u=e("./node_modules/core-js/modules/es.array.concat.js"),i=e.n(u),j=e("./node_modules/kea/lib/index.esm.js"),g=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),h=e("./frontend/src/lib/components/LemonTable/index.ts"),f=e("./frontend/src/scenes/apps/HistoricalExport.tsx"),n=e("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),y=e("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),E=e("./node_modules/react/jsx-runtime.js"),I=e.n(E);function O(){var l=Object(j.useValues)(g.appMetricsSceneLogic),d=l.historicalExports,P=l.historicalExportsLoading,L=l.pluginConfig;return Object(E.jsx)(h.a,{dataSource:d,loading:P,columns:[{title:"Dates exported",render:function(_,T){var b=m()(T.payload.dateRange,2),K=b[0],D=b[1];return K===D?K:"".concat(K," - ").concat(D)}},{title:"Status",width:100,render:function(_,T){switch(T.status){case"success":return Object(E.jsx)(y.a,{type:"success",className:"uppercase",children:"Success"});case"fail":return Object(E.jsx)(y.a,{type:"danger",className:"uppercase",children:"Failed"});case"not_finished":return Object(E.jsx)(y.a,{type:"default",className:"uppercase",children:"Running"})}}},Object(n.b)(),Object(n.a)()],expandable:{expandedRowRender:function(_){if(!!L)return Object(E.jsx)(f.HistoricalExport,{pluginConfigId:L.id,jobId:_.job_id})}}})}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(R,c,e){"use strict";e.r(c),e.d(c,"MetricsTab",function(){return E}),e.d(c,"MetricsOverview",function(){return I});var p=e("./node_modules/antd/es/card/index.js"),m=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),u=e("./frontend/src/scenes/apps/constants.tsx"),i=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),j=e("./frontend/src/lib/utils.tsx"),g=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),h=e("./frontend/src/lib/components/LemonSelect.tsx"),f=e("./node_modules/kea/lib/index.esm.js"),n=e("./node_modules/react/jsx-runtime.js"),y=e.n(n);function E(l){var d=l.tab,P=Object(f.useValues)(m.appMetricsSceneLogic),L=P.metrics,C=P.metricsLoading,_=P.dateFrom,T=Object(f.useActions)(m.appMetricsSceneLogic),b=T.setDateFrom;return Object(n.jsxs)("div",{className:"mt-4",children:[Object(n.jsx)(p.a,{title:Object(n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[Object(n.jsx)("span",{children:"Metrics overview"}),Object(n.jsx)(h.a,{value:_,onChange:function(D){return b(D)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),children:Object(n.jsx)(I,{tab:d,metrics:L,metricsLoading:C})}),Object(n.jsx)(p.a,{title:"Delivery trends",className:"mt-4",children:Object(n.jsx)(g.AppMetricsGraph,{tab:d,metrics:L,metricsLoading:C})})]})}function I(l){var d,P,L,C=l.tab,_=l.metrics,T=l.metricsLoading;return T?Object(n.jsx)(i.a,{className:"h-20"}):Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{className:"card-secondary",children:u.DescriptionColumns[C].successes}),Object(n.jsx)("div",{children:O(_==null||(d=_.totals)===null||d===void 0?void 0:d.successes)})]}),u.DescriptionColumns[C].successes_on_retry&&Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{className:"card-secondary",children:u.DescriptionColumns[C].successes_on_retry}),Object(n.jsx)("div",{children:O(_==null||(P=_.totals)===null||P===void 0?void 0:P.successes_on_retry)})]}),Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{className:"card-secondary",children:u.DescriptionColumns[C].failures}),Object(n.jsx)("div",{children:O(_==null||(L=_.totals)===null||L===void 0?void 0:L.failures)})]})]})}function O(l){return Object(n.jsx)(n.Fragment,{children:l&&Object(j.P)(l)})}try{E.displayName="MetricsTab",E.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:E.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(l){}try{I.displayName="MetricsOverview",I.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:I.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(l){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(R,c,e){"use strict";e.r(c),e.d(c,"AppMetricsTab",function(){return A}),e.d(c,"appMetricsSceneLogic",function(){return V});var p=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),m=e.n(p),u=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),i=e.n(u),j=e("./node_modules/@babel/runtime/regenerator/index.js"),g=e.n(j),h=e("./node_modules/core-js/modules/es.array.iterator.js"),f=e.n(h),n=e("./node_modules/core-js/modules/es.object.to-string.js"),y=e.n(n),E=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),I=e.n(E),O=e("./node_modules/core-js/modules/es.array.concat.js"),l=e.n(O),d=e("./node_modules/core-js/modules/es.function.name.js"),P=e.n(d),L=e("./node_modules/core-js/modules/es.array.includes.js"),C=e.n(L),_=e("./node_modules/core-js/modules/es.string.includes.js"),T=e.n(_),b=e("./node_modules/core-js/modules/es.array.filter.js"),K=e.n(b),D=e("./node_modules/kea/lib/index.esm.js"),$=e("./node_modules/kea-loaders/lib/index.js"),B=e.n($),H=e("./frontend/src/scenes/urls.ts"),Y=e("./frontend/src/lib/api.ts"),N=e("./frontend/src/scenes/teamLogic.tsx"),U=e("./node_modules/kea-router/lib/index.js"),Z=e.n(U),J=e("./frontend/src/lib/utils.tsx"),A;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.HistoricalExports="historical_exports"})(A||(A={}));var W=[A.ProcessEvent,A.OnEvent,A.ExportEvents],V=Object(D.kea)([Object(D.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(D.props)({}),Object(D.key)(function(t){return t.pluginConfigId}),Object(D.actions)({setActiveTab:function(r){return{tab:r}},setDateFrom:function(r){return{dateFrom:r}}}),Object(D.reducers)({activeTab:[null,{setActiveTab:function(r,s){var o=s.tab;return o}}],dateFrom:["-30d",{setDateFrom:function(r,s){var o=s.dateFrom;return o}}]}),Object($.loaders)(function(t){var r=t.values,s=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var o=i()(g.a.mark(function v(){return g.a.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,Y.b.get("api/projects/".concat(N.a.values.currentTeamId,"/plugin_configs/").concat(s.pluginConfigId));case 2:return M.abrupt("return",M.sent);case 3:case"end":return M.stop()}},v)}));function a(){return o.apply(this,arguments)}return a}()}],metrics:[null,{loadMetrics:function(){var o=i()(g.a.mark(function v(){var x,M,S;return g.a.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return x=Object(J.Eb)({category:r.activeTab,date_from:r.dateFrom}),F.next=3,Y.b.get("api/projects/".concat(N.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"?").concat(x));case 3:return M=F.sent,S=M.results,F.abrupt("return",S);case 6:case"end":return F.stop()}},v)}));function a(){return o.apply(this,arguments)}return a}()}],historicalExports:[[],{loadHistoricalExports:function(){var o=i()(g.a.mark(function v(){var x,M;return g.a.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,Y.b.get("api/projects/".concat(N.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/historical_exports"));case 2:return x=G.sent,M=x.results,G.abrupt("return",M);case 5:case"end":return G.stop()}},v)}));function a(){return o.apply(this,arguments)}return a}()}]}}),Object(D.selectors)(function(t){var r=t.values;return{breadcrumbs:[function(s){return[s.pluginConfig,function(o,a){return a.pluginConfigId}]},function(s,o){var a;return[{name:"Apps",path:H.a.projectApps()},{name:s==null||(a=s.plugin_info)===null||a===void 0?void 0:a.name,path:H.a.appMetrics(o)}]}],showTab:[function(){return[]},function(){return function(s){var o;if(r.pluginConfigLoading||!r.pluginConfig)return!1;var a=((o=r.pluginConfig.plugin_info.capabilities)===null||o===void 0?void 0:o.methods)||[];return s===A.HistoricalExports?a.includes("exportEvents"):s===A.OnEvent&&a.includes("exportEvents")?!1:a.includes(s)}}]}}),Object(D.listeners)(function(t){var r=t.values,s=t.actions;return{loadPluginConfigSuccess:function(){if(!r.activeTab){var a=W.filter(function(M){return r.showTab(M)}),v=m()(a,1),x=v[0];s.setActiveTab(x)}},setActiveTab:function(a){var v=a.tab;v===A.HistoricalExports?s.loadHistoricalExports():s.loadMetrics()},setDateFrom:function(){s.loadMetrics()}}}),Object(U.actionToUrl)(function(t){var r=t.values,s=t.props;return{setActiveTab:function(){var a;return r.activeTab===A.HistoricalExports?H.a.appHistoricalExports(s.pluginConfigId):H.a.appMetrics(s.pluginConfigId,(a=r.activeTab)!==null&&a!==void 0?a:void 0)}}}),Object(U.urlToAction)(function(t){var r=t.values,s=t.actions;return{"/app/:pluginConfigId/:page":function(a,v){r.pluginConfig||s.loadPluginConfig(),a.page===A.HistoricalExports?s.setActiveTab(A.HistoricalExports):v.tab&&W.includes(v.tab)&&s.setActiveTab(v.tab)}}})])},"./frontend/src/scenes/apps/constants.tsx":function(R,c,e){"use strict";e.r(c),e.d(c,"DescriptionColumns",function(){return j});var p=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),m=e.n(p),u=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),i,j=(i={},m()(i,u.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),m()(i,u.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),m()(i,u.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),m()(i,u.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),i)},"./frontend/src/scenes/apps/historicalExportLogic.ts":function(R,c,e){"use strict";e.r(c),e.d(c,"historicalExportLogic",function(){return C});var p=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),m=e.n(p),u=e("./node_modules/@babel/runtime/regenerator/index.js"),i=e.n(u),j=e("./node_modules/core-js/modules/es.array.concat.js"),g=e.n(j),h=e("./node_modules/core-js/modules/es.array.iterator.js"),f=e.n(h),n=e("./node_modules/core-js/modules/es.object.to-string.js"),y=e.n(n),E=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),I=e.n(E),O=e("./node_modules/kea/lib/index.esm.js"),l=e("./node_modules/kea-loaders/lib/index.js"),d=e.n(l),P=e("./frontend/src/lib/api.ts"),L=e("./frontend/src/scenes/teamLogic.tsx"),C=Object(O.kea)([Object(O.path)(["scenes","apps","historicalExportLogic"]),Object(O.props)({}),Object(O.key)(function(_){var T=_.pluginConfigId,b=_.jobId;return"".concat(T,"_").concat(b)}),Object(l.loaders)(function(_){var T=_.props;return{data:[null,{loadExportData:function(){var b=m()(i.a.mark(function D(){return i.a.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,P.b.get("api/projects/".concat(L.a.values.currentTeamId,"/app_metrics/").concat(T.pluginConfigId,"/historical_exports/").concat(T.jobId));case 2:return B.abrupt("return",B.sent);case 3:case"end":return B.stop()}},D)}));function K(){return b.apply(this,arguments)}return K}()}]}}),Object(O.events)(function(_){var T=_.actions;return{afterMount:T.loadExportData}})])},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(R,c,e){var p=e("./node_modules/css-loader/dist/runtime/api.js");c=p(!1),c.push([R.i,".AppMetricsGraph{height:300px}",""]),R.exports=c}}]);
