"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[68030],{"../../frontend/src/scenes/data-warehouse/settings/source/Schemas.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _mocks_browser__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/src/mocks/browser.tsx"),_mocks_fixtures_api_projects_team_id_external_data_sources_externalDataSource_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/mocks/fixtures/api/projects/team_id/external_data_sources/externalDataSource.json"),_Schemas__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/source/Schemas.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let __WEBPACK_DEFAULT_EXPORT__={title:"Scenes-App/Data Warehouse/Settings/Schemas",component:_Schemas__WEBPACK_IMPORTED_MODULE_2__.l,args:{id:"123"},parameters:{testOptions:{snapshotBrowsers:["chromium"]},mockDate:"2023-02-01",viewMode:"story"}},Default=(props=>((0,_mocks_browser__WEBPACK_IMPORTED_MODULE_0__.ok)({get:{"/api/environments/:team_id/external_data_sources/:id":()=>[200,_mocks_fixtures_api_projects_team_id_external_data_sources_externalDataSource_json__WEBPACK_IMPORTED_MODULE_1__]}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_Schemas__WEBPACK_IMPORTED_MODULE_2__.l,{...props}))).bind({});Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"props => {\n  useStorybookMocks({\n    get: {\n      '/api/environments/:team_id/external_data_sources/:id': () => {\n        return [200, externalDataSourceResponseMock];\n      }\n    }\n  });\n  return <Schemas {...props} />;\n}",...Default.parameters?.docs?.source}}};let __namedExportsOrder=["Default"]},"../../frontend/src/scenes/data-warehouse/external/forms/SyncMethodForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>SyncMethodForm});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonRadio/index.ts"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let getIncrementalSyncSupported=schema=>schema.incremental_available?0===schema.incremental_fields.length?{disabled:!0,disabledReason:"No incremental fields found on table"}:{disabled:!1}:{disabled:!0,disabledReason:"Incremental replication isn't supported on this table"},getSaveDisabledReason=(syncType,incrementalField)=>syncType?"incremental"!==syncType||incrementalField?void 0:"You must select an incremental field":"You must select a sync method before saving",SyncMethodForm=_ref=>{var _schema$sync_type,_schema$incremental_f,_schema$incremental_f3;let{schema,onClose,onSave,saveButtonIsLoading}=_ref,incrementalSyncSupported=getIncrementalSyncSupported(schema),[radioValue,setRadioValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$sync_type=schema.sync_type)&&void 0!==_schema$sync_type?_schema$sync_type:incrementalSyncSupported?"incremental":void 0),[incrementalFieldValue,setIncrementalFieldValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$incremental_f=schema.incremental_field)&&void 0!==_schema$incremental_f?_schema$incremental_f:null);return(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{var _schema$sync_type2,_schema$incremental_f2;setRadioValue(null!==(_schema$sync_type2=schema.sync_type)&&void 0!==_schema$sync_type2?_schema$sync_type2:incrementalSyncSupported?"incremental":void 0),setIncrementalFieldValue(null!==(_schema$incremental_f2=schema.incremental_field)&&void 0!==_schema$incremental_f2?_schema$incremental_f2:null)},[schema.table]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__._,{radioPosition:"top",value:radioValue,options:[{value:"incremental",disabledReason:incrementalSyncSupported.disabled&&incrementalSyncSupported.disabledReason||void 0,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-4 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h4",{className:"mb-0 mr-2 text-base font-semibold",children:"Incremental replication"}),!incrementalSyncSupported.disabled&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{type:"success",children:"Recommended"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"mb-1",children:"When using incremental replication, we'll store the max value of the below field on each sync and only sync rows with greater or equal value on the next run."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{className:"mb-1",children:["You should pick a field that increments or updates each time the row is updated, such as a ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("code",{children:"updated_at"})," timestamp."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Yv,{value:incrementalFieldValue,onChange:newValue=>setIncrementalFieldValue(newValue),options:null!==(_schema$incremental_f3=schema.incremental_fields.map(n=>({value:n.field,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{className:"leading-5",children:n.label}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{className:"ml-2",type:"success",children:n.type})]})})))&&void 0!==_schema$incremental_f3?_schema$incremental_f3:[],disabledReason:incrementalSyncSupported.disabled?"":void 0})]})},{value:"full_refresh",label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-6 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-1",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h4",{className:"mb-0 mr-2 text-base font-semibold",children:"Full table replication"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"m-0",children:"We'll replicate the whole table on every sync. This can take longer to sync and increase your monthly billing."})]})}],onChange:newValue=>setRadioValue(newValue)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"flex flex-row justify-end w-full",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{className:"mr-3",type:"secondary",onClick:onClose,children:"Close"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{type:"primary",loading:saveButtonIsLoading,disabledReason:getSaveDisabledReason(radioValue,incrementalFieldValue),onClick:()=>{if("incremental"===radioValue){let fieldSelected=schema.incremental_fields.find(n=>n.field===incrementalFieldValue);if(!fieldSelected){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Selected field for incremental replication not found");return}onSave("incremental",incrementalFieldValue,fieldSelected.field_type)}else onSave("full_refresh",null,null)},children:"Save"})]})]})}}}]);