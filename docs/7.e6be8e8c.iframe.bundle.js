(window.webpackJsonp=window.webpackJsonp||[]).push([[7,10],{"./frontend/src/scenes/apps/ErrorDetailsModal.tsx":function(te,b,t){"use strict";t.r(b),t.d(b,"ErrorDetailsModal",function(){return V});var F=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),x=t.n(F),I=t("./node_modules/react/index.js"),C=t.n(I),y=t("./node_modules/kea/lib/index.esm.js"),v=t("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),R=t("./frontend/src/lib/components/LemonSkeleton/index.tsx"),$=t("./frontend/src/lib/components/TimezoneAware/index.tsx"),U=t("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),B=t("./frontend/src/lib/components/LemonButton/index.ts"),g=t("./frontend/src/lib/components/icons.tsx"),G=t("./frontend/src/lib/components/LemonModal/index.ts"),p=t("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),o=t("./node_modules/react/jsx-runtime.js"),z=t.n(o);function V(){var O,D,M=Object(y.useValues)(v.appMetricsSceneLogic),m=M.errorDetails,P=M.errorDetailsModalError,h=M.errorDetailsLoading,Q=Object(y.useActions)(v.appMetricsSceneLogic),j=Q.closeErrorDetailsModal,W=Object(I.useState)(0),H=x()(W,2),E=H[0],K=H[1],d=m[E];return Object(o.jsx)(G.a,{isOpen:!!P,onClose:j,title:P,width:"min(50vw, 80rem)",description:Object(o.jsx)("span",{children:d==null||(O=d.error_details)===null||O===void 0||(D=O.error.message)===null||D===void 0?void 0:D.substring(0,200)}),footer:Object(o.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:h?Object(o.jsx)(R.a,{className:"1-10"}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("span",{children:[E+1," of ",m.length," sample",m.length>1?"s":""]}),Object(o.jsx)(B.a,{icon:Object(o.jsx)(g.IconChevronLeft,{}),onClick:function(){return K(E-1)},disabled:E==0}),Object(o.jsx)(B.a,{icon:Object(o.jsx)(g.IconChevronRight,{}),onClick:function(){return K(E+1)},disabled:E==m.length-1})]})}),children:!P||h?Object(o.jsx)(R.a,{className:"h-10"}):Object(o.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[Object(o.jsxs)("div",{children:[Object(o.jsx)(U.a,{children:"When:"})," ",Object(o.jsx)($.b,{time:d.timestamp,showSeconds:!0})]}),d.error_details.eventCount&&Object(o.jsxs)("div",{children:[Object(o.jsx)(U.a,{children:"Event Count"}),Object(o.jsx)("div",{children:d.error_details.eventCount})]}),d.error_details.error.message&&Object(o.jsx)(L,{title:"Error message",defaultIsExpanded:!0,children:Object(o.jsx)(p.a,{wrap:!0,language:p.b.JavaScript,children:d.error_details.error.message})}),d.error_details.event&&Object(o.jsx)(L,{title:"Event payload",defaultIsExpanded:!1,children:Object(o.jsx)(p.a,{wrap:!0,language:p.b.JSON,children:JSON.stringify(d.error_details.event,null,2)})}),d.error_details.error.stack&&Object(o.jsx)(L,{title:"Stack trace",defaultIsExpanded:!1,children:Object(o.jsx)(p.a,{wrap:!0,language:p.b.JavaScript,children:d.error_details.error.stack})})]})})}function L(O){var D=Object(I.useState)(O.defaultIsExpanded),M=x()(D,2),m=M[0],P=M[1];return Object(o.jsxs)("div",{className:"bg-mid border rounded",children:[Object(o.jsx)(B.a,{status:"stealth",fullWidth:!0,onClick:function(){return P(!m)},sideIcon:m?Object(o.jsx)(g.IconUnfoldLess,{}):Object(o.jsx)(g.IconUnfoldMore,{}),title:m?"Show less":"Show more",className:"bg-mid",children:O.title}),m&&Object(o.jsx)("div",{className:"bg-light p-2",children:O.children})]})}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(te,b,t){"use strict";t.r(b),t.d(b,"AppMetricsTab",function(){return c}),t.d(b,"appMetricsSceneLogic",function(){return se});var F=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),x=t.n(F),I=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),C=t.n(I),y=t("./node_modules/@babel/runtime/regenerator/index.js"),v=t.n(y),R=t("./node_modules/core-js/modules/es.array.iterator.js"),$=t.n(R),U=t("./node_modules/core-js/modules/es.object.to-string.js"),B=t.n(U),g=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),G=t.n(g),p=t("./node_modules/core-js/modules/es.array.concat.js"),o=t.n(p),z=t("./node_modules/core-js/modules/es.function.name.js"),V=t.n(z),L=t("./node_modules/core-js/modules/es.array.filter.js"),O=t.n(L),D=t("./node_modules/core-js/modules/es.array.includes.js"),M=t.n(D),m=t("./node_modules/core-js/modules/es.string.includes.js"),P=t.n(m),h=t("./node_modules/core-js/modules/es.number.constructor.js"),Q=t.n(h),j=t("./node_modules/kea/lib/index.esm.js"),W=t("./node_modules/kea-loaders/lib/index.js"),H=t.n(W),E=t("./frontend/src/scenes/urls.ts"),K=t("./frontend/src/types.ts"),d=t("./frontend/src/lib/api.ts"),T=t("./frontend/src/scenes/teamLogic.tsx"),J=t("./node_modules/kea-router/lib/index.js"),oe=t.n(J),X=t("./frontend/src/lib/utils.tsx"),Y=t("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),re=t("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),Z=t("./frontend/src/lib/dayjs.ts"),ne=t("./frontend/src/scenes/userLogic.ts"),c;(function(r){r.ProcessEvent="processEvent",r.OnEvent="onEvent",r.ExportEvents="exportEvents",r.ScheduledTask="scheduledTask",r.HistoricalExports="historical_exports",r.Activity="activity"})(c||(c={}));var N="-30d",w=[c.ProcessEvent,c.OnEvent,c.ExportEvents,c.ScheduledTask],se=Object(j.kea)([Object(j.path)(function(r){return["scenes","apps","appMetricsSceneLogic",r]}),Object(j.props)({}),Object(j.key)(function(r){return r.pluginConfigId}),Object(j.actions)({setActiveTab:function(n){return{tab:n}},setDateFrom:function(n){return{dateFrom:n}},openErrorDetailsModal:function(n,s,e){return{errorType:n,category:s,jobId:e}},closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),Object(j.reducers)({activeTab:[null,{setActiveTab:function(n,s){var e=s.tab;return e}}],selectedDateFrom:[null,{setDateFrom:function(n,s){var e=s.dateFrom;return e}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(n,s){var e=s.errorType;return e},closeErrorDetailsModal:function(){return null}}]}),Object(W.loaders)(function(r){var n=r.values,s=r.props;return{pluginConfig:[null,{loadPluginConfig:function(){var e=C()(v.a.mark(function a(){return v.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,d.b.get("api/projects/".concat(T.a.values.currentTeamId,"/plugin_configs/").concat(s.pluginConfigId));case 2:return u.abrupt("return",u.sent);case 3:case"end":return u.stop()}},a)}));function i(){return e.apply(this,arguments)}return i}()}],appMetricsResponse:[null,{loadMetrics:function(){var e=C()(v.a.mark(function a(){var l;return v.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(n.activeTab&&n.dateFrom)){_.next=5;break}return l=Object(X.Eb)({category:n.activeTab,date_from:n.dateFrom}),_.next=4,d.b.get("api/projects/".concat(T.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"?").concat(l));case 4:return _.abrupt("return",_.sent);case 5:case"end":return _.stop()}},a)}));function i(){return e.apply(this,arguments)}return i}()}],historicalExports:[[],{loadHistoricalExports:function(){var e=C()(v.a.mark(function a(){var l,u;return v.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,d.b.get("api/projects/".concat(T.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/historical_exports"));case 2:return l=f.sent,u=l.results,f.abrupt("return",u);case 5:case"end":return f.stop()}},a)}));function i(){return e.apply(this,arguments)}return i}()}],errorDetails:[[],{openErrorDetailsModal:function(){var e=C()(v.a.mark(function a(l){var u,_,f,k,q,ee;return v.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=l.category,_=l.jobId,f=l.errorType,k=Object(X.Eb)({category:u,job_id:_,error_type:f}),A.next=4,d.b.get("api/projects/".concat(T.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/error_details?").concat(k));case 4:return q=A.sent,ee=q.result,A.abrupt("return",ee);case 7:case"end":return A.stop()}},a)}));function i(a){return e.apply(this,arguments)}return i}()}]}}),Object(j.selectors)(function(r){var n=r.values,s=r.actions;return{breadcrumbs:[function(e){return[e.pluginConfig,function(i,a){return a.pluginConfigId}]},function(e,i){var a;return[{name:"Apps",path:E.a.projectApps()},{name:e==null||(a=e.plugin_info)===null||a===void 0?void 0:a.name,path:E.a.appMetrics(i)}]}],shouldShowAppMetrics:[function(){return[ne.a.selectors.hasAvailableFeature]},function(e){return e(K.d.APP_METRICS)}],defaultTab:[function(e){return[e.pluginConfig]},function(){var e;return(e=w.filter(function(i){return n.showTab(i)})[0])!==null&&e!==void 0?e:c.Activity}],currentTime:[function(){return[]},function(){return Date.now()}],defaultDateFrom:[function(e){return[e.pluginConfig,e.currentTime]},function(e,i){if(!(e!=null&&e.created_at))return N;var a=Z.a.utc(e.created_at),l=Object(Z.a)(i).diff(a,"days",!0);return l<=1?"-24h":l<=7?"-7d":N}],dateFrom:[function(e){return[e.selectedDateFrom,e.defaultDateFrom]},function(e,i){var a;return(a=e!=null?e:i)!==null&&a!==void 0?a:N}],showTab:[function(e){return[e.shouldShowAppMetrics]},function(e){return function(i){if(n.pluginConfigLoading||!n.pluginConfig||!n.pluginConfig.plugin_info.capabilities)return!1;var a=n.pluginConfig.plugin_info.capabilities,l=a.methods.includes("exportEvents");return i===c.Activity?!0:e?i===c.HistoricalExports?l:i===c.OnEvent&&l?!1:i===c.ScheduledTask?!l&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(u){return a.scheduled_tasks.includes(u)}):a.methods.includes(i):!1}}],interfaceJobsProps:[function(e){return[e.pluginConfig]},function(e){return!e||!e.plugin_info.public_jobs||!(e!=null&&e.enabled)?null:{jobName:Y.b,jobSpec:e.plugin_info.public_jobs[Y.b],pluginConfigId:e.id,pluginId:e.plugin,onSubmit:s.loadHistoricalExports}}],hasRunningExports:[function(e){return[e.historicalExports]},function(e){return e.some(function(i){return i.status=="not_finished"})}]}}),Object(j.listeners)(function(r){var n=r.values,s=r.actions;return{loadPluginConfigSuccess:function(){n.activeTab||s.setActiveTab(n.defaultTab)},setActiveTab:function(i){var a=i.tab;a===c.HistoricalExports?s.loadHistoricalExports():a!==c.Activity&&s.loadMetrics()},setDateFrom:function(){s.loadMetrics()},openHistoricalExportModal:function(){n.interfaceJobsProps&&Object(re.a)(n.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}}),Object(J.actionToUrl)(function(r){var n=r.values,s=r.props;return{setActiveTab:function(){return S(n,s)},setDateFrom:function(){return S(n,s)},openErrorDetailsModal:function(){return S(n,s)},closeErrorDetailsModal:function(){return S(n,s)}}}),Object(J.urlToAction)(function(r){var n=r.values,s=r.actions,e=r.props;return{"/app/:pluginConfigId/:page":function(a,l){if(e.pluginConfigId===Number(a.pluginConfigId))if(n.pluginConfig||s.loadPluginConfig(),a.page===c.HistoricalExports)s.setActiveTab(c.HistoricalExports);else if(a.page===c.Activity)s.setActiveTab(c.Activity);else if(l.tab&&w.includes(l.tab)&&l.tab!==n.activeTab?s.setActiveTab(l.tab):!n.pluginConfigLoading&&n.activeTab!==n.defaultTab&&s.setActiveTab(n.defaultTab),l.from&&n.selectedDateFrom!==l.from&&s.setDateFrom(l.from),l.error){var u=x()(l.error,2),_=u[0],f=u[1];n.errorDetailsModalError!==_&&(s.setActiveTab(f),s.openErrorDetailsModal(_,f))}else s.closeErrorDetailsModal()}}})]);function S(r,n){if(r.activeTab===c.HistoricalExports)return E.a.appHistoricalExports(n.pluginConfigId);if(r.activeTab===c.Activity)return E.a.appActivity(n.pluginConfigId);var s={};return r.activeTab&&r.activeTab!==r.defaultTab&&(s.tab=r.activeTab),r.selectedDateFrom&&(s.from=r.selectedDateFrom),r.errorDetailsModalError&&r.activeTab&&(s.error=[r.errorDetailsModalError,r.activeTab]),E.a.appMetrics(n.pluginConfigId,s)}}}]);
