"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[4370],{"./frontend/src/queries/schema-guards.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X:()=>isWebAnalyticsPropertyFilters,a:()=>isSessionPropertyFilters});var ajv__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/ajv@8.12.0/node_modules/ajv/dist/ajv.js"),ajv__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(ajv__WEBPACK_IMPORTED_MODULE_0__),_schema_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/queries/schema.json");let ajv=new(ajv__WEBPACK_IMPORTED_MODULE_0___default())({allowUnionTypes:!0});ajv.addSchema(_schema_json__WEBPACK_IMPORTED_MODULE_1__);let isWebAnalyticsPropertyFilters=data=>{let validator=ajv.getSchema("#/definitions/WebAnalyticsPropertyFilters");if(!validator)throw Error("Could not find validator for WebAnalyticsPropertyFilters");return validator(data)},isSessionPropertyFilters=data=>{let validator=ajv.getSchema("#/definitions/SessionPropertyFilter");if(!validator)throw Error("Could not find validator for SessionPropertyFilter");return!!Array.isArray(data)&&data.every(item=>validator(item))}},"./frontend/src/scenes/web-analytics/SessionDebugger/SessionAttributionExplorerScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SessionAttributionExplorer:()=>SessionAttributionExplorer,SessionAttributionExplorerScene:()=>SessionAttributionExplorerScene,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),supportLogic=__webpack_require__("./frontend/src/lib/components/Support/supportLogic.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),preflightLogic=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),schema_guards=__webpack_require__("./frontend/src/queries/schema-guards.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts");let initialFilters=[],sessionAttributionExplorerLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","webAnalytics","sessionDebuggerLogic"]),(0,index_esm.connect)(()=>({values:[featureFlagLogic.h,["featureFlags"]]})),(0,index_esm.actions)({setFilters:filters=>({filters}),setStateFromUrl:state=>({state})}),(0,index_esm.reducers)({filters:[initialFilters,{setFilters:(_,_ref)=>{let{filters}=_ref;return filters},setStateFromUrl:(_,_ref2)=>{let{state}=_ref2;return state.filters}}]}),(0,index_esm.selectors)({query:[s=>[s.filters],filters=>{let source={kind:schema.OH.HogQLQuery,filters:{properties:filters},query:`
SELECT
    "$entry_referring_domain" as 'context.columns.referring_domain',
    "$entry_utm_source" as 'context.columns.utm_source',
    "$entry_utm_medium" as 'context.columns.utm_medium',
    "$entry_utm_campaign" as 'context.columns.utm_campaign',
    nullIf(arrayStringConcat([
        if(isNotNull($entry_gclid), 'glcid', NULL),
        if(isNotNull($entry_gad_source), 'gad_source', NULL)
        -- add more here if we add more ad ids
    ], ','), '') as 'context.columns.has_ad_id',
    topK(10)($entry_current_url) as 'context.columns.example_entry_urls',
    "$channel_type" as 'context.columns.channel_type',
    count() as 'context.columns.count'
FROM sessions
WHERE $start_timestamp >= now() - toIntervalDay(7) AND {filters}
GROUP BY 1,2,3,4,5,7
ORDER BY 8 DESC
`};return{kind:schema.OH.DataTableNode,source:source,showPropertyFilter:[types.t.SessionProperties],showOpenEditorButton:!0,showReload:!0}}]}),(0,lib.actionToUrl)(_ref3=>{let{values}=_ref3;return{setFilters:()=>{let{filters}=values,urlParams={};return filters.length>0&&(urlParams.filters=filters),[urls.j.sessionAttributionExplorer(),urlParams]}}}),(0,lib.urlToAction)(_ref4=>{let{actions}=_ref4;return{[urls.j.sessionAttributionExplorer()]:(_,_ref5)=>{let{filters}=_ref5,parsedFilters=(0,schema_guards.a)(filters)?filters:initialFilters;actions.setStateFromUrl({filters:parsedFilters})}}})]);var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SessionAttributionExplorerScene(){return(0,jsx_runtime.jsx)(SessionAttributionExplorer,{})}let scene={component:SessionAttributionExplorerScene,logic:sessionAttributionExplorerLogic},queryContext={columns:{channel_type:{title:"Channel type"},count:{title:"Session count",align:"right"},referring_domain:{title:"Referring domain"},utm_source:{title:"UTM source"},utm_medium:{title:"UTM medium"},utm_campaign:{title:"UTM campaign"},has_ad_id:{title:"Has ad ID"},example_entry_urls:{title:"Example entry URLs",render:_ref=>{let{value}=_ref,values=Array.isArray(value)?value:[value];return(0,jsx_runtime.jsx)("div",{children:values.map(url=>(0,jsx_runtime.jsx)("div",{children:url},url))})}}}};function SessionAttributionExplorer(){let{query}=(0,index_esm.useValues)(sessionAttributionExplorerLogic),{setFilters}=(0,index_esm.useActions)(sessionAttributionExplorerLogic),{preflight}=(0,index_esm.useValues)(preflightLogic.preflightLogic),{openSupportForm}=(0,index_esm.useActions)(supportLogic.Pw),showSupportOptions=preflight?.cloud;return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",className:"my-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center flex-wrap gap-2 justify-between",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1 min-w-full sm:min-w-0",children:[(0,jsx_runtime.jsxs)("p",{children:["You can use the Session attribution explorer (beta) to find understand how your sessions are attributed. We use the referring domain, ",(0,jsx_runtime.jsx)("code",{children:"utm_source"}),", ",(0,jsx_runtime.jsx)("code",{children:"utm_medium"}),","," ",(0,jsx_runtime.jsx)("code",{children:"utm_campaign"}),", and the presence of advertising ids like ",(0,jsx_runtime.jsx)("code",{children:"gclid"})," and"," ",(0,jsx_runtime.jsx)("code",{children:"gad_source"}),", to assign a session a"," ",(0,jsx_runtime.jsx)(Link.r,{to:"https://posthog.com/docs/data/channel-type",children:"Channel type"}),"."]}),(0,jsx_runtime.jsx)("p",{children:"The table below groups sessions with the same value for Channel type, referring domain, source, medium, and which ad ids are present. It shows the count of sessions in each group, and some example entry URLs from that group."}),(0,jsx_runtime.jsx)("p",{children:"If you believe that a session is attributed incorrectly, please let us know!"})]}),showSupportOptions?(0,jsx_runtime.jsx)("span",{className:"flex items-center gap-2",children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",icon:(0,jsx_runtime.jsx)(icons.Rz,{}),onClick:()=>openSupportForm({kind:"feedback",isEmailFormOpen:!0,target_area:"web_analytics"}),children:"Give feedback"})}):null]})}),(0,jsx_runtime.jsx)(Query.A,{context:queryContext,query:query,setQuery:query=>{let source=query.source;source.filters?.properties&&(0,schema_guards.a)(source.filters.properties)&&setFilters(source.filters.properties)}})]})}}}]);
//# sourceMappingURL=4370.2b6e50e8.iframe.bundle.js.map