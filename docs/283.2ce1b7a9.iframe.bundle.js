(window.webpackJsonp=window.webpackJsonp||[]).push([[283],{"./frontend/src/lib/hooks/useAnchor.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useAnchor}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js");function useAnchor(hash){Object(react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{if(hash&&document.getElementById(hash.substr(1))){const element=document.getElementById(hash.substr(1));if(!element)return;element.classList.add("highlighted");const elementPosition=element.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:elementPosition-50-32,behavior:"smooth"})}}),[hash])}},"./frontend/src/scenes/organization/Settings/Permissions/Roles/rolesLogic.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return rolesLogic}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts"),scenes_project_Settings_teamMembersLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/project/Settings/teamMembersLogic.tsx"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/types.ts");const rolesLogic=Object(kea__WEBPACK_IMPORTED_MODULE_0__.kea)([Object(kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","organization","rolesLogic"]),Object(kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_project_Settings_teamMembersLogic__WEBPACK_IMPORTED_MODULE_4__.b,["allMembers"]]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setCreateRoleModalShown:shown=>({shown:shown}),setRoleInFocus:role=>({role:role}),setRoleMembersInFocus:roleMembers=>({roleMembers:roleMembers}),setRoleMembersToAdd:uuids=>({uuids:uuids}),openCreateRoleModal:!0,setPermission:(resource,access)=>({resource:resource,access:access}),clearPermission:!0,updateRole:role=>({role:role})}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({createRoleModalShown:[!1,{setCreateRoleModalShown:(_,_ref)=>{let{shown:shown}=_ref;return shown}}],roleInFocus:[null,{setRoleInFocus:(_,_ref2)=>{let{role:role}=_ref2;return role}}],roleMembersInFocus:[[],{setRoleMembersInFocus:(_,_ref3)=>{let{roleMembers:roleMembers}=_ref3;return roleMembers}}],roleMembersToAdd:[[],{setRoleMembersToAdd:(_,_ref4)=>{let{uuids:uuids}=_ref4;return uuids}}],roles:[[],{updateRole:(state,_ref5)=>{let{role:newRole}=_ref5;return state.map((role=>role.id==newRole.id?newRole:role))}}]}),Object(kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)((_ref6=>{let{values:values,actions:actions}=_ref6;return{roles:{loadRoles:async()=>{const response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.roles.list();return(null==response?void 0:response.results)||[]},createRole:async roleName=>{const{roles:roles,roleMembersToAdd:roleMembersToAdd}=values,newRole=await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.roles.create(roleName);return await actions.addRoleMembers({role:newRole,membersToAdd:roleMembersToAdd}),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_3__.e.actions.reportRoleCreated(roleName),actions.setRoleMembersInFocus([]),actions.setRoleMembersToAdd([]),actions.clearPermission(),actions.setCreateRoleModalShown(!1),[newRole,...roles]},deleteRole:async role=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.roles.delete(role.id),values.roles.filter((currRoles=>currRoles.id!==role.id)))},roleMembersInFocus:[[],{loadRoleMembers:async _ref7=>{let{roleId:roleId}=_ref7;const response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.roles.members.list(roleId);return(null==response?void 0:response.results)||[]},addRoleMembers:async _ref8=>{let{role:role,membersToAdd:membersToAdd}=_ref8;const newMembers=await Promise.all(membersToAdd.map((async userUuid=>await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.roles.members.create(role.id,userUuid))));return actions.setRoleMembersToAdd([]),[...values.roleMembersInFocus,...newMembers]},deleteRoleMember:async _ref9=>{let{roleMemberUuid:roleMemberUuid}=_ref9;return values.roleInFocus&&await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.roles.members.delete(values.roleInFocus.id,roleMemberUuid),values.roleMembersInFocus.filter((member=>member.id!==roleMemberUuid))}}]}})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((_ref10=>{let{actions:actions,values:values}=_ref10;return{setRoleInFocus:_ref11=>{let{role:role}=_ref11;role&&actions.loadRoleMembers({roleId:role.id}),actions.setCreateRoleModalShown(!0)},openCreateRoleModal:()=>{actions.setRoleInFocus(null),actions.setRoleMembersInFocus([]),actions.setCreateRoleModalShown(!0)},setCreateRoleModalShown:()=>{values.roleInFocus?actions.setPermission(_types__WEBPACK_IMPORTED_MODULE_5__.T.FEATURE_FLAGS,values.roleInFocus.feature_flags_access_level):actions.setPermission(_types__WEBPACK_IMPORTED_MODULE_5__.T.FEATURE_FLAGS,_types__WEBPACK_IMPORTED_MODULE_5__.a.WRITE)},deleteRoleSuccess:()=>{actions.setCreateRoleModalShown(!1)}}})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({addableMembers:[s=>[s.allMembers,s.roleMembersInFocus],(allMembers,roleMembersInFocus)=>{const addableMembers=[];for(const member of allMembers)roleMembersInFocus.some((roleMember=>roleMember.user.uuid===member.user.uuid))||addableMembers.push(member.user);return addableMembers.sort(((a,b)=>a.first_name.localeCompare(b.first_name))),addableMembers}]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref12=>{let{actions:actions}=_ref12;actions.loadRoles()}))])},"./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ResourcePermissionMapping})),__webpack_require__.d(__webpack_exports__,"b",(function(){return permissionsLogic}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/types.ts"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),lib_constants__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/constants.tsx"),_Roles_rolesLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/organization/Settings/Permissions/Roles/rolesLogic.tsx"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts");const ResourceDisplayMapping={[_types__WEBPACK_IMPORTED_MODULE_3__.T.FEATURE_FLAGS]:"Feature Flags"},ResourcePermissionMapping={[_types__WEBPACK_IMPORTED_MODULE_3__.a.WRITE]:"View & Edit",[_types__WEBPACK_IMPORTED_MODULE_3__.a.READ]:"View Only"},ResourceAccessLevelMapping={[_types__WEBPACK_IMPORTED_MODULE_3__.T.FEATURE_FLAGS]:"feature_flags_access_level"},permissionsLogic=Object(kea__WEBPACK_IMPORTED_MODULE_0__.kea)([Object(kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","organization","Settings","Permissions","permissionsLogic"]),Object(kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_4__.a,["featureFlags"],_Roles_rolesLogic__WEBPACK_IMPORTED_MODULE_6__.a,["roles"]],actions:[_Roles_rolesLogic__WEBPACK_IMPORTED_MODULE_6__.a,["updateRole"]]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.actions)({updatePermission:(checked,role,resourceId,resourceType)=>({checked:checked,role:role,resourceId:resourceId,resourceType:resourceType})}),Object(kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)((_ref=>{let{values:values}=_ref;return{organizationResourcePermissions:[[],{loadOrganizationResourcePermissions:async()=>{const response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.resourcePermissions.list();return(null==response?void 0:response.results)||[]},updateOrganizationResourcePermission:async _ref2=>{let{id:id,resource:resource,access_level:access_level}=_ref2;if(id){const response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.resourcePermissions.update(id,{access_level:access_level});return values.organizationResourcePermissions.map((permission=>permission.id==response.id?response:permission))}{const response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.resourcePermissions.create({resource:resource,access_level:access_level});return[...values.organizationResourcePermissions,response]}}}]}})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((_ref3=>{let{actions:actions}=_ref3;return{updatePermission:async _ref4=>{let{checked:checked,role:role,resourceId:resourceId,resourceType:resourceType}=_ref4;const accessLevel=checked?_types__WEBPACK_IMPORTED_MODULE_3__.a.WRITE:_types__WEBPACK_IMPORTED_MODULE_3__.a.READ;if(role.id){const updatedRole=await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.roles.update(role.id,{[ResourceAccessLevelMapping[resourceType]]:accessLevel});updatedRole&&(actions.updateRole(updatedRole),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_7__.lemonToast.success(`${role.name} role ${resourceType} edit access updated`))}else actions.updateOrganizationResourcePermission({id:resourceId,resource:resourceType,access_level:accessLevel});lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_8__.e.actions.reportResourceAccessLevelUpdated(resourceType,role.name,accessLevel)},updateOrganizationResourcePermissionSuccess:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_7__.lemonToast.success("Organizational edit access updated")}}})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({organizationResourcePermissionsMap:[s=>[s.organizationResourcePermissions],organizationResourcePermissions=>organizationResourcePermissions.reduce(((obj,resourcePermission)=>({...obj,[resourcePermission.resource]:resourcePermission})),{})],allPermissions:[s=>[s.organizationResourcePermissionsMap],organizationResourcePermissionsMap=>Object.keys(ResourceDisplayMapping).map((key=>{var _organizationResource,_organizationResource2;return{id:(null===(_organizationResource=organizationResourcePermissionsMap[key])||void 0===_organizationResource?void 0:_organizationResource.id)||null,resource:key,name:ResourceDisplayMapping[key],access_level:(null===(_organizationResource2=organizationResourcePermissionsMap[key])||void 0===_organizationResource2?void 0:_organizationResource2.access_level)||_types__WEBPACK_IMPORTED_MODULE_3__.a.WRITE}}))],shouldShowPermissionsTable:[s=>[s.featureFlags],featureFlags=>"control"===featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_5__.i.ROLE_BASED_ACCESS]],resourceRolesAccess:[s=>[s.allPermissions,s.roles],(permissions,roles)=>{const resources=permissions.map((resource=>({[resource.resource]:{organization_default:resource.access_level,id:resource.id}})));for(const role of roles)for(const source of resources){const resourceType=Object.keys(source)[0];source[resourceType][`${role.name}`]=role[ResourceAccessLevelMapping[resourceType]]}return resources}]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref5=>{let{actions:actions}=_ref5;actions.loadOrganizationResourcePermissions()}))])},"./frontend/src/scenes/organization/Settings/index.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"OrganizationSettingsTabs",(function(){return OrganizationSettingsTabs})),__webpack_require__.d(__webpack_exports__,"OrganizationSettings",(function(){return OrganizationSettings}));var react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),CopyToClipboard=__webpack_require__("./frontend/src/lib/components/CopyToClipboard.tsx"),ProfilePicture=__webpack_require__("./frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),inviteLogic=__webpack_require__("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),InviteModal=__webpack_require__("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),preflightLogic=__webpack_require__("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonDialog=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDialog/index.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function makeActionsComponent(deleteInvite){return function ActionsComponent(_,invite){return Object(jsx_runtime.jsx)(LemonButton.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:Object(jsx_runtime.jsx)(icons.D,{}),status:"danger",onClick:()=>{invite.is_expired?deleteInvite(invite):LemonDialog.a.open({title:`Do you want to cancel the invite for ${invite.target_email}?`,primaryButton:{children:"Yes, cancel invite",status:"danger",onClick:()=>deleteInvite(invite)},secondaryButton:{children:"No, keep invite"}})}})}}function Invites(){const{invites:invites,invitesLoading:invitesLoading}=Object(index_esm.useValues)(inviteLogic.a),{deleteInvite:deleteInvite,showInviteModal:showInviteModal}=Object(index_esm.useActions)(inviteLogic.a),{preflight:preflight}=Object(index_esm.useValues)(preflightLogic.a),columns=[{key:"user_profile_picture",render:function ProfilePictureRender(_,invite){return Object(jsx_runtime.jsx)(ProfilePicture.b,{name:invite.first_name,email:invite.target_email})},width:32},{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function TargetEmail(_,invite){return invite.target_email?Object(jsx_runtime.jsxs)("div",{className:"flex items-center",children:[invite.target_email,invite.first_name?` (${invite.first_name})`:""]}):Object(jsx_runtime.jsx)("i",{children:"no one"})},width:"20%"},Object(columnUtils.b)(),Object(columnUtils.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:(_,invite)=>function InviteLinkComponent(id,invite){const url=new URL(`/signup/${id}`,document.baseURI).href;return invite.is_expired?Object(jsx_runtime.jsx)("b",{children:"Expired! Delete and recreate"}):Object(jsx_runtime.jsx)(CopyToClipboard.a,{"data-attr":"invite-link",description:"invite link",children:url})}(invite.id,invite)},{title:"",key:"actions",width:24,render:makeActionsComponent(deleteInvite)}];return Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsxs)("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"},children:["Pending Invites",Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",onClick:showInviteModal,"data-attr":"invite-teammate-button",children:"Invite team member"})]}),!(null!=preflight&&preflight.email_service_available)&&Object(jsx_runtime.jsx)(InviteModal.a,{}),Object(jsx_runtime.jsx)(LemonTable.a,{dataSource:invites,columns:columns,rowKey:"id",loading:invitesLoading,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."})]})}var membersLogic=__webpack_require__("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),organizationLogic=__webpack_require__("./frontend/src/scenes/organizationLogic.tsx"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),permissioning=__webpack_require__("./frontend/src/lib/utils/permissioning.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonTag=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx"),LemonDivider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDivider/index.ts"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts");function Members_ActionsComponent(_,member){var _currentOrganization$;const{user:user}=Object(index_esm.useValues)(userLogic.a),{currentOrganization:currentOrganization}=Object(index_esm.useValues)(organizationLogic.a),{removeMember:removeMember,changeMemberAccessLevel:changeMemberAccessLevel}=Object(index_esm.useActions)(membersLogic.a);if(!user)return null;const currentMembershipLevel=null!==(_currentOrganization$=null==currentOrganization?void 0:currentOrganization.membership_level)&&void 0!==_currentOrganization$?_currentOrganization$:-1,allowDeletion=(currentMembershipLevel>=constants.p.Admin&&member.level<=currentMembershipLevel||member.user.uuid===user.uuid)&&member.level!==constants.p.Owner,myMembershipLevel=currentOrganization?currentOrganization.membership_level:null,allowedLevels=permissioning.c.filter((listLevel=>!Object(permissioning.a)(myMembershipLevel,user,member,listLevel))),disallowedReason=Object(permissioning.a)(myMembershipLevel,user,member,allowedLevels);return Object(jsx_runtime.jsx)(More.a,{overlay:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[disallowedReason?Object(jsx_runtime.jsx)("div",{children:disallowedReason}):allowedLevels.map((listLevel=>Object(jsx_runtime.jsx)(LemonButton.a,{status:"stealth",fullWidth:!0,onClick:event=>{if(event.preventDefault(),!user)throw Error;var _user$organization;listLevel===constants.p.Owner?LemonDialog.a.open({title:`Transfer organization ownership to ${member.user.first_name}?`,description:`You will no longer be the owner of ${null===(_user$organization=user.organization)||void 0===_user$organization?void 0:_user$organization.name}. After the transfer you will become an administrator.`,primaryButton:{status:"danger",children:"Transfer Ownership",onClick:()=>changeMemberAccessLevel(member,listLevel)},secondaryButton:{children:"Cancel"}}):changeMemberAccessLevel(member,listLevel)},"data-test-level":listLevel,children:listLevel===constants.p.Owner?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Transfer organization ownership"}):listLevel>member.level?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Upgrade to ",permissioning.b.get(listLevel)]}):Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Downgrade to ",permissioning.b.get(listLevel)]})},`${member.user.uuid}-level-${listLevel}`))),allowDeletion?Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LemonDivider.a,{}),Object(jsx_runtime.jsx)(LemonButton.a,{status:"danger","data-attr":"delete-org-membership",onClick:()=>{var _user$organization2;if(!user)throw Error;LemonDialog.a.open({title:`${member.user.uuid==user.uuid?"Leave":`Remove ${member.user.first_name} from`} organization ${null===(_user$organization2=user.organization)||void 0===_user$organization2?void 0:_user$organization2.name}?`,primaryButton:{children:member.user.uuid==user.uuid?"Leave":"Remove",status:"danger",onClick:()=>removeMember(member)},secondaryButton:{children:"Cancel"}})},fullWidth:!0,children:member.user.uuid!==user.uuid?"Remove from organization":"Leave organization"})]}):null]})})}function Members(_ref){let{user:user}=_ref;const{filteredMembers:filteredMembers,membersLoading:membersLoading,search:search}=Object(index_esm.useValues)(membersLogic.a),{setSearch:setSearch}=Object(index_esm.useActions)(membersLogic.a),columns=[{key:"user_profile_picture",render:function ProfilePictureRender(_,member){return Object(jsx_runtime.jsx)(ProfilePicture.b,{name:member.user.first_name,email:member.user.email})},width:32},{title:"Name",key:"user_first_name",render:(_,member)=>member.user.uuid==user.uuid?`${member.user.first_name} (me)`:member.user.first_name,sorter:(a,b)=>a.user.first_name.localeCompare(b.user.first_name)},{title:"Email",key:"user_email",render:(_,member)=>member.user.email,sorter:(a,b)=>a.user.email.localeCompare(b.user.email)},{title:"Level",dataIndex:"level",key:"level",render:function LevelRender(_,member){var _membershipLevelToNam;return Object(jsx_runtime.jsx)(LemonTag.a,{"data-attr":"membership-level",children:member.level===constants.p.Owner?"Organization owner":`Project ${null!==(_membershipLevelToNam=permissioning.b.get(member.level))&&void 0!==_membershipLevelToNam?_membershipLevelToNam:`unknown (${member.level})`}`})},sorter:(a,b)=>a.level-b.level},{title:"Joined",dataIndex:"joined_at",key:"joined_at",render:function RenderJoinedAt(joinedAt){return Object(jsx_runtime.jsx)("div",{className:"whitespace-nowrap",children:Object(jsx_runtime.jsx)(TZLabel.a,{time:joinedAt})})},sorter:(a,b)=>a.joined_at.localeCompare(b.joined_at)},{key:"actions",width:0,render:Members_ActionsComponent}];return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("h2",{className:"subtitle",children:"Members"}),Object(jsx_runtime.jsx)(src.LemonInput,{type:"search",placeholder:"Search for members",value:search,onChange:setSearch}),Object(jsx_runtime.jsx)(LemonTable.a,{dataSource:filteredMembers,columns:columns,rowKey:"id",style:{marginTop:"1rem"},loading:membersLoading,"data-attr":"org-members-table",defaultSorting:{columnKey:"level",order:-1},pagination:{pageSize:50}})]})}try{Members.displayName="Members",Members.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:Members.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(__react_docgen_typescript_loader_error){}function DeleteOrganizationModal(_ref){let{isOpen:isOpen,setIsOpen:setIsOpen}=_ref;const{currentOrganization:currentOrganization,organizationBeingDeleted:organizationBeingDeleted}=Object(index_esm.useValues)(organizationLogic.a),{deleteOrganization:deleteOrganization}=Object(index_esm.useActions)(organizationLogic.a),[isDeletionConfirmed,setIsDeletionConfirmed]=Object(react.useState)(!1),isDeletionInProgress=!!currentOrganization&&(null==organizationBeingDeleted?void 0:organizationBeingDeleted.id)===currentOrganization.id;return Object(jsx_runtime.jsxs)(src.LemonModal,{title:"Delete the entire organization?",onClose:isDeletionInProgress?void 0:()=>setIsOpen(!1),footer:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(src.LemonButton,{disabled:isDeletionInProgress,type:"secondary",onClick:()=>setIsOpen(!1),children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",disabled:!isDeletionConfirmed,loading:isDeletionInProgress,"data-attr":"delete-organization-ok",status:"danger",onClick:currentOrganization?()=>deleteOrganization(currentOrganization):void 0,children:`Delete ${currentOrganization?currentOrganization.name:"the current organization"}`})]}),isOpen:isOpen,children:[Object(jsx_runtime.jsxs)("p",{children:["Organization deletion ",Object(jsx_runtime.jsx)("b",{children:"cannot be undone"}),". You will lose all data, ",Object(jsx_runtime.jsx)("b",{children:"including all events"}),", related to all projects within this organization."]}),Object(jsx_runtime.jsxs)("p",{children:["Please type"," ",Object(jsx_runtime.jsx)("strong",{children:currentOrganization?currentOrganization.name:"this organization's name"})," to confirm."]}),Object(jsx_runtime.jsx)(src.LemonInput,{type:"text",onChange:value=>{currentOrganization&&setIsDeletionConfirmed(value.toLowerCase()===currentOrganization.name.toLowerCase())}})]})}function DangerZone(_ref2){let{isRestricted:isRestricted}=_ref2;const{currentOrganization:currentOrganization}=Object(index_esm.useValues)(organizationLogic.a),[isModalVisible,setIsModalVisible]=Object(react.useState)(!1);return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)("div",{className:"text-danger",children:[Object(jsx_runtime.jsx)("h2",{className:"text-danger subtitle",children:"Danger Zone"}),Object(jsx_runtime.jsxs)("div",{className:"mt-4",children:[!isRestricted&&Object(jsx_runtime.jsxs)("p",{className:"text-danger",children:["This is ",Object(jsx_runtime.jsx)("b",{children:"irreversible"}),". Please be certain."]}),Object(jsx_runtime.jsxs)(src.LemonButton,{status:"danger",type:"secondary",onClick:()=>setIsModalVisible(!0),"data-attr":"delete-organization-button",icon:Object(jsx_runtime.jsx)(icons.N,{}),disabled:isRestricted,children:["Delete ",(null==currentOrganization?void 0:currentOrganization.name)||"the current organization"]})]})]}),Object(jsx_runtime.jsx)(DeleteOrganizationModal,{isOpen:isModalVisible,setIsOpen:setIsModalVisible})]})}try{DeleteOrganizationModal.displayName="DeleteOrganizationModal",DeleteOrganizationModal.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},setIsOpen:{defaultValue:null,description:"",name:"setIsOpen",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:DeleteOrganizationModal.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(__react_docgen_typescript_loader_error){}try{DangerZone.displayName="DangerZone",DangerZone.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:DangerZone.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(__react_docgen_typescript_loader_error){}var RestrictedArea=__webpack_require__("./frontend/src/lib/components/RestrictedArea.tsx"),useAnchor=__webpack_require__("./frontend/src/lib/hooks/useAnchor.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip.tsx"),api=__webpack_require__("./frontend/src/lib/api.ts"),lemonToast=__webpack_require__("./frontend/src/lib/lemon-ui/lemonToast.tsx"),types=__webpack_require__("./frontend/src/types.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.0/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js");const verifiedDomainsLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","organization","verifiedDomainsLogic"]),Object(index_esm.connect)({values:[organizationLogic.a,["currentOrganization"]]}),Object(index_esm.actions)({replaceDomain:domain=>({domain:domain}),setAddModalShown:shown=>({shown:shown}),setConfigureSAMLModalId:id=>({id:id}),setVerifyModal:id=>({id:id})}),Object(index_esm.reducers)({verifiedDomains:[[],{replaceDomain:(state,_ref)=>{let{domain:domain}=_ref;const domains=[...state.filter((_ref2=>{let{id:id}=_ref2;return id!==domain.id})),domain];return domains.sort(((a,b)=>a.domain.localeCompare(b.domain))),domains}}],addModalShown:[!1,{setAddModalShown:(_,_ref3)=>{let{shown:shown}=_ref3;return shown},addVerifiedDomainSuccess:()=>!1}],configureSAMLModalId:[null,{setConfigureSAMLModalId:(_,_ref4)=>{let{id:id}=_ref4;return id}}],verifyModal:[null,{setVerifyModal:(_,_ref5)=>{let{id:id}=_ref5;return id}}]}),Object(kea_loaders_lib.loaders)((_ref6=>{let{values:values,actions:actions}=_ref6;return{verifiedDomains:[[],{loadVerifiedDomains:async()=>{var _values$currentOrgani;return(await api.b.get(`api/organizations/${null===(_values$currentOrgani=values.currentOrganization)||void 0===_values$currentOrgani?void 0:_values$currentOrgani.id}/domains`)).results},addVerifiedDomain:async domain=>{var _values$currentOrgani2;return[await api.b.create(`api/organizations/${null===(_values$currentOrgani2=values.currentOrganization)||void 0===_values$currentOrgani2?void 0:_values$currentOrgani2.id}/domains`,{domain:domain}),...values.verifiedDomains]},deleteVerifiedDomain:async id=>{var _values$currentOrgani3;return await api.b.delete(`api/organizations/${null===(_values$currentOrgani3=values.currentOrganization)||void 0===_values$currentOrgani3?void 0:_values$currentOrgani3.id}/domains/${id}`),[...values.verifiedDomains.filter((domain=>domain.id!==id))]}}],updatingDomain:[!1,{updateDomain:async payload=>{var _values$currentOrgani4;const response=await api.b.update(`api/organizations/${null===(_values$currentOrgani4=values.currentOrganization)||void 0===_values$currentOrgani4?void 0:_values$currentOrgani4.id}/domains/${payload.id}`,{...payload,id:void 0});return lemonToast.d.success("Domain updated successfully! Changes will take immediately."),actions.replaceDomain(response),!1},verifyDomain:async()=>{var _values$currentOrgani5;const response=await api.b.create(`api/organizations/${null===(_values$currentOrgani5=values.currentOrganization)||void 0===_values$currentOrgani5?void 0:_values$currentOrgani5.id}/domains/${values.verifyModal}/verify`);return response.is_verified?lemonToast.d.success("Domain verified successfully."):lemonToast.d.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),actions.replaceDomain(response),actions.setVerifyModal(null),!1}}]}})),Object(index_esm.listeners)((_ref7=>{let{actions:actions,values:values}=_ref7;return{setConfigureSAMLModalId:_ref8=>{let{id:id}=_ref8;const domain=values.verifiedDomains.find((_ref9=>{let{id:_idToFind}=_ref9;return _idToFind===id}));if(id&&domain){const{saml_acs_url:saml_acs_url,saml_entity_id:saml_entity_id,saml_x509_cert:saml_x509_cert}=domain;actions.setSamlConfigValues({saml_acs_url:saml_acs_url,saml_entity_id:saml_entity_id,saml_x509_cert:saml_x509_cert,id:id})}}}})),Object(index_esm.selectors)({domainBeingVerified:[s=>[s.verifiedDomains,s.verifyModal],(verifiedDomains,verifyingId)=>verifyingId&&verifiedDomains.find((_ref10=>{let{id:id}=_ref10;return id===verifyingId}))||null],isSSOEnforcementAvailable:[s=>[s.currentOrganization],currentOrganization=>{var _currentOrganization$;return null!==(_currentOrganization$=null==currentOrganization?void 0:currentOrganization.available_features.includes(types.e.SSO_ENFORCEMENT))&&void 0!==_currentOrganization$&&_currentOrganization$}],isSAMLAvailable:[s=>[s.currentOrganization],currentOrganization=>{var _currentOrganization$2;return null!==(_currentOrganization$2=null==currentOrganization?void 0:currentOrganization.available_features.includes(types.e.SAML))&&void 0!==_currentOrganization$2&&_currentOrganization$2}]}),Object(index_esm.afterMount)((_ref11=>{let{actions:actions}=_ref11;return actions.loadVerifiedDomains()})),Object(lib.forms)((_ref12=>{let{actions:actions,values:values}=_ref12;return{samlConfig:{defaults:{},errors:payload=>({saml_acs_url:payload.saml_acs_url&&!payload.saml_acs_url.match(constants.w)?"Please enter a valid URL, including https://":void 0}),submit:async(payload,breakpoint)=>{var _values$currentOrgani6;const{id:id,...updateParams}=payload;if(!id)return;const response=await api.b.update(`api/organizations/${null===(_values$currentOrgani6=values.currentOrganization)||void 0===_values$currentOrgani6?void 0:_values$currentOrgani6.id}/domains/${payload.id}`,{...updateParams});breakpoint(),actions.replaceDomain(response),actions.setConfigureSAMLModalId(null),actions.setSamlConfigValues({}),lemonToast.d.success(`SAML configuration for ${response.domain} updated successfully.`)}}}}))]);var InfoCircleOutlined=__webpack_require__("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts");function AddDomainModal(){const{addModalShown:addModalShown,verifiedDomainsLoading:verifiedDomainsLoading}=Object(index_esm.useValues)(verifiedDomainsLogic),{setAddModalShown:setAddModalShown,addVerifiedDomain:addVerifiedDomain}=Object(index_esm.useActions)(verifiedDomainsLogic),[newDomain,setNewDomain]=Object(react.useState)(""),[submitted,setSubmitted]=Object(react.useState)(!1),errored=!newDomain||!newDomain.match(constants.e),clean=()=>{setNewDomain(""),setSubmitted(!1)},handleSubmit=()=>{setSubmitted(!0),errored||(addVerifiedDomain(newDomain),clean())};return Object(jsx_runtime.jsxs)(LemonModal.a,{onClose:()=>{setAddModalShown(!1),clean()},isOpen:addModalShown,title:"Add authentication domain",footer:Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",disabled:""===newDomain||submitted&&errored||verifiedDomainsLoading,onClick:handleSubmit,children:"Add domain"}),children:[Object(jsx_runtime.jsx)(src.LemonInput,{placeholder:"posthog.com",autoFocus:!0,value:newDomain,onChange:setNewDomain,onPressEnter:handleSubmit}),submitted&&errored&&Object(jsx_runtime.jsx)("span",{className:"text-danger text-xs",children:"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"})]})}var SSOSelect=__webpack_require__("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx");function VerifyDomainModal(){const{domainBeingVerified:domainBeingVerified,updatingDomainLoading:updatingDomainLoading}=Object(index_esm.useValues)(verifiedDomainsLogic),{setVerifyModal:setVerifyModal,verifyDomain:verifyDomain}=Object(index_esm.useActions)(verifiedDomainsLogic),challengeName=`_posthog-challenge.${null==domainBeingVerified?void 0:domainBeingVerified.domain}.`;return Object(jsx_runtime.jsx)(LemonModal.a,{isOpen:!!domainBeingVerified,onClose:()=>setVerifyModal(null),title:"Verify your domain",description:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LemonTag.a,{className:"uppercase",children:(null==domainBeingVerified?void 0:domainBeingVerified.domain)||""}),Object(jsx_runtime.jsx)("p",{children:"To verify your domain, you need to add a record to your DNS zone."})]}),footer:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LemonButton.a,{type:"secondary",onClick:()=>setVerifyModal(null),children:"Verify later"}),Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",disabled:updatingDomainLoading,onClick:verifyDomain,children:"Verify"})]}),children:Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsxs)("ol",{children:[Object(jsx_runtime.jsx)("li",{children:"Sign in to your DNS provider."}),Object(jsx_runtime.jsxs)("li",{children:["Add the following ",Object(jsx_runtime.jsx)("b",{children:"TXT"})," record.",Object(jsx_runtime.jsxs)("div",{className:"my-4 space-y-2",children:[Object(jsx_runtime.jsx)(Field.b,{label:"Name",children:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:challengeName}),Object(jsx_runtime.jsx)(CopyToClipboard.a,{explicitValue:challengeName})]})}),Object(jsx_runtime.jsx)(Field.b,{label:"Value or content",children:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:null==domainBeingVerified?void 0:domainBeingVerified.verification_challenge}),Object(jsx_runtime.jsx)(CopyToClipboard.a,{explicitValue:null==domainBeingVerified?void 0:domainBeingVerified.verification_challenge})]})}),Object(jsx_runtime.jsx)(Field.b,{label:"TTL",children:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)("div",{className:"border rounded p-2 h-10 flex-1",children:"Default or 3600"}),Object(jsx_runtime.jsx)(CopyToClipboard.a,{explicitValue:"3600"})]})})]})]}),Object(jsx_runtime.jsx)("li",{children:"Press verify below."})]})})})}var Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link.tsx"),LemonSwitch=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSwitch/LemonSwitch.tsx"),AlertMessage=__webpack_require__("./frontend/src/lib/lemon-ui/AlertMessage/index.ts"),LemonInput=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx"),LemonTextArea=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTextArea/LemonTextArea.tsx");function ConfigureSAMLModal(){var _preflight$site_url;const{configureSAMLModalId:configureSAMLModalId,isSamlConfigSubmitting:isSamlConfigSubmitting,samlConfig:samlConfig}=Object(index_esm.useValues)(verifiedDomainsLogic),{setConfigureSAMLModalId:setConfigureSAMLModalId}=Object(index_esm.useActions)(verifiedDomainsLogic),{preflight:preflight}=Object(index_esm.useValues)(preflightLogic.a),siteUrl=null!==(_preflight$site_url=null==preflight?void 0:preflight.site_url)&&void 0!==_preflight$site_url?_preflight$site_url:window.location.origin,samlReady=samlConfig.saml_acs_url&&samlConfig.saml_entity_id&&samlConfig.saml_x509_cert;return Object(jsx_runtime.jsx)(LemonModal.a,{onClose:()=>{setConfigureSAMLModalId(null)},isOpen:!!configureSAMLModalId,title:"",simple:!0,children:Object(jsx_runtime.jsxs)(lib.Form,{logic:verifiedDomainsLogic,formKey:"samlConfig",enableFormOnSubmit:!0,className:"LemonModal__layout ",children:[Object(jsx_runtime.jsx)(LemonModal.a.Header,{children:Object(jsx_runtime.jsx)("h3",{children:"Configure SAML authentication and provisioning"})}),Object(jsx_runtime.jsxs)(LemonModal.a.Content,{className:"space-y-2",children:[Object(jsx_runtime.jsx)(Field.a,{label:"ACS Consumer URL",name:"_ACSConsumerUrl",children:Object(jsx_runtime.jsx)(CopyToClipboard.a,{children:`${siteUrl}/complete/saml`})}),Object(jsx_runtime.jsx)(Field.a,{label:"RelayState",name:"_RelayState",children:Object(jsx_runtime.jsx)(CopyToClipboard.a,{children:null!=configureSAMLModalId?configureSAMLModalId:void 0})}),Object(jsx_runtime.jsx)(Field.a,{name:"saml_acs_url",label:"SAML ACS URL",children:Object(jsx_runtime.jsx)(LemonInput.a,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})}),Object(jsx_runtime.jsx)(Field.a,{name:"saml_entity_id",label:"SAML Entity ID",children:Object(jsx_runtime.jsx)(LemonInput.a,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})}),Object(jsx_runtime.jsx)(Field.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate",children:Object(jsx_runtime.jsx)(LemonTextArea.a,{className:"ph-ignore-input",minRows:10,placeholder:"Enter the public certificate of your IdP. Keep all line breaks.\n-----BEGIN CERTIFICATE-----\nMIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL\n-----END CERTIFICATE-----"})}),!samlReady&&Object(jsx_runtime.jsx)(AlertMessage.a,{type:"info",children:"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft."})]}),Object(jsx_runtime.jsx)(LemonModal.a.Footer,{children:Object(jsx_runtime.jsx)(LemonButton.a,{loading:isSamlConfigSubmitting,type:"primary",htmlType:"submit",children:"Save settings"})})]})})}const iconStyle={marginRight:4,fontSize:"1.15em",paddingTop:2};function VerifiedDomains(){const{verifiedDomainsLoading:verifiedDomainsLoading,updatingDomainLoading:updatingDomainLoading}=Object(index_esm.useValues)(verifiedDomainsLogic),{setAddModalShown:setAddModalShown}=Object(index_esm.useActions)(verifiedDomainsLogic);return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)("div",{className:"flex items-center",children:[Object(jsx_runtime.jsxs)("div",{style:{flexGrow:1},children:[Object(jsx_runtime.jsx)("div",{id:"domain-whitelist"})," ",Object(jsx_runtime.jsx)("h2",{id:"authentication-domains",className:"subtitle",children:"Authentication domains"}),Object(jsx_runtime.jsx)("p",{className:"text-muted-alt",children:"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains."})]}),Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",onClick:()=>setAddModalShown(!0),disabled:verifiedDomainsLoading||updatingDomainLoading,children:"Add domain"})]}),Object(jsx_runtime.jsx)(VerifiedDomainsTable,{})]})}function VerifiedDomainsTable(){const{verifiedDomains:verifiedDomains,verifiedDomainsLoading:verifiedDomainsLoading,currentOrganization:currentOrganization,updatingDomainLoading:updatingDomainLoading,isSSOEnforcementAvailable:isSSOEnforcementAvailable,isSAMLAvailable:isSAMLAvailable}=Object(index_esm.useValues)(verifiedDomainsLogic),{updateDomain:updateDomain,deleteVerifiedDomain:deleteVerifiedDomain,setVerifyModal:setVerifyModal,setConfigureSAMLModalId:setConfigureSAMLModalId}=Object(index_esm.useActions)(verifiedDomainsLogic),{preflight:preflight}=Object(index_esm.useValues)(preflightLogic.a),columns=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function RenderDomainName(_,_ref){let{domain:domain}=_ref;return Object(jsx_runtime.jsx)(LemonTag.a,{children:domain})}},...null!=preflight&&preflight.cloud?[{key:"is_verified",title:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Verification",Object(jsx_runtime.jsx)(Tooltip.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO).",children:Object(jsx_runtime.jsx)(InfoCircleOutlined.a,{style:{marginLeft:4}})})]}),render:function Verified(_,_ref2){let{is_verified:is_verified,verified_at:verified_at}=_ref2;return is_verified?Object(jsx_runtime.jsxs)("div",{className:"flex items-center text-success",children:[Object(jsx_runtime.jsx)(icons.y,{style:iconStyle})," Verified"]}):verified_at?Object(jsx_runtime.jsxs)("div",{className:"flex items-center text-danger",children:[Object(jsx_runtime.jsx)(icons.V,{style:iconStyle})," Verification expired"]}):Object(jsx_runtime.jsxs)("div",{className:"flex items-center text-warning",children:[Object(jsx_runtime.jsx)(icons.gd,{style:iconStyle})," Pending verification"]})}}]:[],{key:"jit_provisioning_enabled",title:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Automatic provisioning"," ",Object(jsx_runtime.jsx)(Tooltip.a,{title:`Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ${(null==currentOrganization?void 0:currentOrganization.name)||"this organization"} if it does not exist.`,children:Object(jsx_runtime.jsx)(InfoCircleOutlined.a,{})})]}),render:function AutomaticProvisioning(_,_ref3){let{jit_provisioning_enabled:jit_provisioning_enabled,id:id,is_verified:is_verified}=_ref3;return is_verified?Object(jsx_runtime.jsx)("div",{className:"flex items-center",children:Object(jsx_runtime.jsx)(LemonSwitch.a,{checked:jit_provisioning_enabled,disabled:updatingDomainLoading||!is_verified,onChange:checked=>updateDomain({id:id,jit_provisioning_enabled:checked}),label:Object(jsx_runtime.jsx)("span",{className:"font-normal",children:jit_provisioning_enabled?"Enabled":"Disabled"})})}):Object(jsx_runtime.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable automatic provisioning"})}},{key:"sso_enforcement",title:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Enforce SSO"," ",Object(jsx_runtime.jsx)(Tooltip.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider.",children:Object(jsx_runtime.jsx)(InfoCircleOutlined.a,{})})]}),render:function SSOEnforcement(_,_ref4,index){let{sso_enforcement:sso_enforcement,is_verified:is_verified,id:id,has_saml:has_saml}=_ref4;return isSSOEnforcementAvailable?is_verified?Object(jsx_runtime.jsx)(SSOSelect.a,{value:sso_enforcement,loading:updatingDomainLoading,onChange:val=>updateDomain({id:id,sso_enforcement:val}),samlAvailable:has_saml}):Object(jsx_runtime.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):0===index?Object(jsx_runtime.jsxs)(Link.a,{to:Object(constants.D)(null==preflight?void 0:preflight.cloud).url,target:Object(constants.D)(null==preflight?void 0:preflight.cloud).target,className:"flex items-center",children:[Object(jsx_runtime.jsx)(icons.Eb,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"]}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{})}},{key:"saml",title:"SAML",render:function SAML(_,_ref5,index){let{is_verified:is_verified,saml_acs_url:saml_acs_url,saml_entity_id:saml_entity_id,saml_x509_cert:saml_x509_cert,has_saml:has_saml}=_ref5;return isSAMLAvailable?is_verified?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:has_saml?Object(jsx_runtime.jsxs)("div",{className:"flex items-center text-success",children:[Object(jsx_runtime.jsx)(icons.y,{style:iconStyle})," SAML enabled"]}):saml_acs_url||saml_entity_id||saml_x509_cert?Object(jsx_runtime.jsxs)("div",{className:"flex items-center text-warning",children:[Object(jsx_runtime.jsx)(icons.gd,{style:iconStyle})," SAML partially configured"]}):Object(jsx_runtime.jsxs)("div",{className:"flex items-center",children:[Object(jsx_runtime.jsx)(icons.Sb,{style:iconStyle})," SAML not set up"]})}):Object(jsx_runtime.jsx)("i",{className:"text-muted-alt",children:"Verify domain to enable"}):0===index?Object(jsx_runtime.jsxs)(Link.a,{to:Object(constants.D)(null==preflight?void 0:preflight.cloud).url,target:Object(constants.D)(null==preflight?void 0:preflight.cloud).target,className:"flex items-center",children:[Object(jsx_runtime.jsx)(icons.Eb,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"]}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{})}},{key:"actions",width:32,align:"center",render:function RenderActions(_,_ref6){let{is_verified:is_verified,id:id,domain:domain}=_ref6;return is_verified?Object(jsx_runtime.jsx)(More.a,{overlay:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(LemonButton.a,{status:"stealth",onClick:()=>setConfigureSAMLModalId(id),fullWidth:!0,disabled:!isSAMLAvailable,title:isSAMLAvailable?void 0:"Upgrade to enable SAML",children:"Configure SAML"}),Object(jsx_runtime.jsxs)(LemonButton.a,{status:"danger",onClick:()=>LemonDialog.a.open({title:`Remove ${domain}?`,description:"This cannot be undone. If you have SAML configured or SSO enforced,it will be immediately disabled.",primaryButton:{status:"danger",children:"Remove domain",onClick:()=>deleteVerifiedDomain(id)},secondaryButton:{children:"Cancel"}}),fullWidth:!0,children:[Object(jsx_runtime.jsx)(icons.N,{})," Remove domain"]})]}),style:{display:"inline-block"}}):Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",onClick:()=>setVerifyModal(id),children:"Verify"})}}];return Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)(LemonTable.a,{dataSource:verifiedDomains,columns:columns,loading:verifiedDomainsLoading,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),Object(jsx_runtime.jsx)(AddDomainModal,{}),Object(jsx_runtime.jsx)(ConfigureSAMLModal,{}),Object(jsx_runtime.jsx)(VerifyDomainModal,{})]})}var PayGateMini=__webpack_require__("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),tabs=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),TitleWithIcon=__webpack_require__("./frontend/src/lib/components/TitleWithIcon.tsx"),permissionsLogic=__webpack_require__("./frontend/src/scenes/organization/Settings/Permissions/permissionsLogic.tsx"),LemonSelectMultiple=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelectMultiple/LemonSelectMultiple.tsx"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),UserSelectItem=__webpack_require__("./frontend/src/lib/components/UserSelectItem.tsx"),rolesLogic=__webpack_require__("./frontend/src/scenes/organization/Settings/Permissions/Roles/rolesLogic.tsx");function CreateRoleModal(){const{roleInFocus:roleInFocus,createRoleModalShown:createRoleModalShown,roleMembersToAdd:roleMembersToAdd,roleMembersInFocusLoading:roleMembersInFocusLoading,addableMembers:addableMembers,rolesLoading:rolesLoading,roleMembersInFocus:roleMembersInFocus}=Object(index_esm.useValues)(rolesLogic.a),{setCreateRoleModalShown:setCreateRoleModalShown,setRoleMembersToAdd:setRoleMembersToAdd,createRole:createRole,deleteRoleMember:deleteRoleMember,addRoleMembers:addRoleMembers,deleteRole:deleteRole}=Object(index_esm.useActions)(rolesLogic.a),{isAdminOrOwner:isAdminOrOwner}=Object(index_esm.useValues)(organizationLogic.a),[roleName,setRoleName]=Object(react.useState)(""),isNewRole=!roleInFocus;return Object(jsx_runtime.jsxs)(LemonModal.a,{onClose:()=>{setCreateRoleModalShown(!1),setRoleMembersToAdd([])},isOpen:createRoleModalShown,title:isNewRole?"Create role":isAdminOrOwner?`Edit ${roleInFocus.name} role`:`${roleInFocus.name} role`,footer:rolesLoading?Object(jsx_runtime.jsx)(Spinner.a,{monocolor:!0}):isAdminOrOwner?Object(jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between w-full",children:[Object(jsx_runtime.jsx)("div",{children:!isNewRole&&Object(jsx_runtime.jsx)(LemonButton.a,{htmlType:"submit",type:"primary",status:"danger",onClick:()=>deleteRole(roleInFocus),"data-attr":"role-delete-submit",children:"Delete role"})}),Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",onClick:()=>{createRole(roleName),setRoleName("")},children:"Save"})]}):void 0,children:[isNewRole&&Object(jsx_runtime.jsxs)("div",{className:"mb-5",children:[Object(jsx_runtime.jsx)("h5",{children:"Role Name"}),Object(jsx_runtime.jsx)(src.LemonInput,{placeholder:"Product",autoFocus:!0,value:roleName,onChange:setRoleName})]}),isAdminOrOwner&&Object(jsx_runtime.jsxs)("div",{className:"mb-5",children:[Object(jsx_runtime.jsx)("h5",{children:"Members"}),Object(jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[Object(jsx_runtime.jsx)("div",{className:"flex-1",children:Object(jsx_runtime.jsx)(LemonSelectMultiple.a,{placeholder:"Search for team members to add",value:roleMembersToAdd,loading:roleMembersInFocusLoading,onChange:newValues=>setRoleMembersToAdd(newValues),filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:Object(UserSelectItem.a)(addableMembers,"uuid")})}),!isNewRole&&Object(jsx_runtime.jsx)(LemonButton.a,{type:"primary",loading:roleMembersInFocusLoading,disabled:0===roleMembersToAdd.length,onClick:()=>addRoleMembers({role:roleInFocus,membersToAdd:roleMembersToAdd}),children:"Add"})]})]}),!isNewRole&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("h5",{children:"Role Members"}),roleMembersInFocus.length>0?Object(jsx_runtime.jsx)("div",{className:"mt-2 pb-2 rounded overflow-y-auto",style:{maxHeight:300},children:roleMembersInFocus.map((member=>Object(jsx_runtime.jsx)(MemberRow,{member:member,deleteMember:roleMemberUuid=>deleteRoleMember({roleMemberUuid:roleMemberUuid}),isAdminOrOwner:!!isAdminOrOwner},member.id)))}):Object(jsx_runtime.jsx)("div",{className:"text-muted mb-2",children:"No members added yet"})]})]})}function MemberRow(_ref){let{member:member,deleteMember:deleteMember,isAdminOrOwner:isAdminOrOwner}=_ref;const{user:user}=member;return Object(jsx_runtime.jsxs)("div",{className:"flex items-center justify-between mt-2 h-8",children:[Object(jsx_runtime.jsx)(ProfilePicture.b,{email:user.email,name:user.first_name,size:"md",showName:!0}),isAdminOrOwner&&deleteMember&&Object(jsx_runtime.jsx)(LemonButton.a,{icon:Object(jsx_runtime.jsx)(icons.N,{}),onClick:()=>deleteMember(member.id),tooltip:"Remove user from role",status:"primary-alt",type:"tertiary",size:"small"})]})}function PermissionsGrid(_ref){let{isRestricted:isRestricted}=_ref;const{resourceRolesAccess:resourceRolesAccess,organizationResourcePermissionsLoading:organizationResourcePermissionsLoading}=Object(index_esm.useValues)(permissionsLogic.b),{updatePermission:updatePermission}=Object(index_esm.useActions)(permissionsLogic.b),{roles:roles,rolesLoading:rolesLoading}=Object(index_esm.useValues)(rolesLogic.a),{setRoleInFocus:setRoleInFocus,openCreateRoleModal:openCreateRoleModal}=Object(index_esm.useActions)(rolesLogic.a),{isAdminOrOwner:isAdminOrOwner}=Object(index_esm.useValues)(organizationLogic.a),columns=[{key:"role",title:"",width:150,render:function RenderRole(_,role){return Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"organization_default"==role.name?Object(jsx_runtime.jsx)("b",{children:"All users by default"}):Object(jsx_runtime.jsx)(src.LemonButton,{type:"tertiary",noPadding:!0,onClick:()=>setRoleInFocus(role),children:role.name})})}},...resourceRolesAccess.flatMap((resource=>{const name=Object.keys(resource)[0];return[{key:"view",title:Object(jsx_runtime.jsx)(Tooltip.a,{title:"View defaults cannot be changed",children:Object(jsx_runtime.jsxs)("div",{className:"text-center",children:[name," ",Object(jsx_runtime.jsx)("br",{})," View"]})}),align:"center",render:function RenderView(){return Object(jsx_runtime.jsx)("div",{className:"flex justify-center",children:Object(jsx_runtime.jsx)(src.LemonCheckbox,{defaultChecked:!0,disabled:!0,color:"gray"})})}},{key:"edit",title:Object(jsx_runtime.jsx)(TitleWithIcon.a,{icon:Object(jsx_runtime.jsx)(Tooltip.a,{title:`You can extend permissions on a per ${type=name,type===types.T.FEATURE_FLAGS?"flag":"resource"} basis.`,children:Object(jsx_runtime.jsx)(icons.tb,{})}),children:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[name," ",Object(jsx_runtime.jsx)("br",{})," Edit"]})}),align:"center",render:function RenderEdit(_,role){return Object(jsx_runtime.jsx)("div",{className:"flex justify-center",children:Object(jsx_runtime.jsx)(src.LemonCheckbox,{onChange:v=>{updatePermission(v,role,resource[name].id,name)},checked:resource[`${name}`][role.name]>=types.a.WRITE,disabled:!isAdminOrOwner,color:isAdminOrOwner?"":"gray"})})}}];var type}))];return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between items-center mb-4",children:[Object(jsx_runtime.jsx)("div",{className:"text-muted-alt",children:"Edit organizational default permission levels for posthog resources. Use roles to apply permissions to specific sets of users."}),!isRestricted&&Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:openCreateRoleModal,"data-attr":"create-role-button",children:"Create role"})]}),Object(jsx_runtime.jsx)(src.LemonTable,{bordered:!0,columns:columns,loading:rolesLoading||organizationResourcePermissionsLoading,dataSource:[{name:"organization_default"},...roles]}),Object(jsx_runtime.jsx)(CreateRoleModal,{})]})}try{PermissionsGrid.displayName="PermissionsGrid",PermissionsGrid.__docgenInfo={description:"",displayName:"PermissionsGrid",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Permissions/PermissionsGrid.tsx#PermissionsGrid"]={docgenInfo:PermissionsGrid.__docgenInfo,name:"PermissionsGrid",path:"frontend/src/scenes/organization/Settings/Permissions/PermissionsGrid.tsx#PermissionsGrid"})}catch(__react_docgen_typescript_loader_error){}const scene={component:OrganizationSettings,logic:organizationLogic.a};let OrganizationSettingsTabs;function DisplayName(_ref){let{isRestricted:isRestricted}=_ref;const{currentOrganization:currentOrganization,currentOrganizationLoading:currentOrganizationLoading}=Object(index_esm.useValues)(organizationLogic.a),{updateOrganization:updateOrganization}=Object(index_esm.useActions)(organizationLogic.a),[name,setName]=Object(react.useState)((null==currentOrganization?void 0:currentOrganization.name)||"");return Object(jsx_runtime.jsxs)("div",{style:{maxWidth:"40rem"},children:[Object(jsx_runtime.jsx)("h2",{id:"name",className:"subtitle mt-0",children:"Display Name"}),Object(jsx_runtime.jsx)(src.LemonInput,{className:"mb-4",value:name,onChange:setName,disabled:isRestricted}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:e=>{e.preventDefault(),updateOrganization({name:name})},disabled:isRestricted||!name||!currentOrganization||name===currentOrganization.name,loading:currentOrganizationLoading,children:"Rename Organization"})]})}function EmailPreferences(_ref2){let{isRestricted:isRestricted}=_ref2;const{currentOrganization:currentOrganization}=Object(index_esm.useValues)(organizationLogic.a),{updateOrganization:updateOrganization}=Object(index_esm.useActions)(organizationLogic.a);return Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("h2",{id:"notification-preferences",className:"subtitle",children:"Notification Preferences"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(src.LemonSwitch,{"data-attr":"is-member-join-email-enabled-switch",onChange:checked=>{updateOrganization({is_member_join_email_enabled:checked})},checked:!(null==currentOrganization||!currentOrganization.is_member_join_email_enabled),disabled:isRestricted||!currentOrganization,label:"Email all current members when a new member joins",bordered:!0})})]})}!function(OrganizationSettingsTabs){OrganizationSettingsTabs.GENERAL="general",OrganizationSettingsTabs.ROLE_BASED_ACCESS="role_based_access"}(OrganizationSettingsTabs||(OrganizationSettingsTabs={}));const organizationSettingsTabsLogic=Object(index_esm.kea)({path:["scenes","organization","Settings","index"],actions:{setTab:tab=>({tab:tab})},reducers:{tab:[OrganizationSettingsTabs.GENERAL,{setTab:(_,_ref3)=>{let{tab:tab}=_ref3;return tab}}]},actionToUrl:()=>({setTab:_ref4=>{let{tab:tab}=_ref4;return`${urls.a.organizationSettings()}?tab=${tab}`}}),urlToAction:_ref5=>{let{values:values,actions:actions}=_ref5;return{[urls.a.organizationSettings()]:(_,searchParams)=>{searchParams.tab&&values.tab!==searchParams.tab&&actions.setTab(searchParams.tab)}}}});function OrganizationSettings(){const{user:user}=Object(index_esm.useValues)(userLogic.a),{featureFlags:featureFlags}=Object(index_esm.useValues)(featureFlagLogic.a);Object(useAnchor.a)(location.hash);const{tab:tab}=Object(index_esm.useValues)(organizationSettingsTabsLogic),{setTab:setTab}=Object(index_esm.useActions)(organizationSettingsTabsLogic);return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),Object(jsx_runtime.jsxs)(tabs.a,{activeKey:tab,destroyInactiveTabPane:!0,onChange:t=>setTab(t),children:[Object(jsx_runtime.jsx)(tabs.a.TabPane,{tab:"General",children:Object(jsx_runtime.jsxs)("div",{className:"border rounded p-6",children:[Object(jsx_runtime.jsx)(RestrictedArea.a,{Component:DisplayName,minimumAccessLevel:constants.p.Admin}),Object(jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),Object(jsx_runtime.jsx)(Invites,{}),Object(jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),user&&Object(jsx_runtime.jsx)(Members,{user:user}),Object(jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),Object(jsx_runtime.jsx)(RestrictedArea.a,{Component:VerifiedDomains,minimumAccessLevel:constants.p.Admin}),Object(jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),Object(jsx_runtime.jsx)(RestrictedArea.a,{Component:EmailPreferences,minimumAccessLevel:constants.p.Admin}),Object(jsx_runtime.jsx)(src.LemonDivider,{className:"my-6"}),Object(jsx_runtime.jsx)(RestrictedArea.a,{Component:DangerZone,minimumAccessLevel:constants.p.Owner})]})},"general"),featureFlags[constants.i.ROLE_BASED_ACCESS]&&Object(jsx_runtime.jsx)(tabs.a.TabPane,{tab:"Role-based access",children:Object(jsx_runtime.jsx)(PayGateMini.a,{feature:types.e.ROLE_BASED_ACCESS,children:Object(jsx_runtime.jsx)(RestrictedArea.a,{Component:PermissionsGrid,minimumAccessLevel:constants.p.Admin})})},"role_based_access")]})]})}}}]);