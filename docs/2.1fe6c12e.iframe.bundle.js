(window.webpackJsonp=window.webpackJsonp||[]).push([[2,6,8,12],{"./frontend/src/scenes/apps/AppMetricsScene.tsx":function(y,d,e){"use strict";e.r(d),e.d(d,"scene",function(){return A}),e.d(d,"AppMetrics",function(){return T});var D=e("./node_modules/core-js/modules/es.function.name.js"),L=e.n(D),_=e("./node_modules/antd/es/tabs/index.js"),n=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),b=e("./frontend/src/lib/components/PageHeader.tsx"),f=e("./node_modules/kea/lib/index.esm.js"),c=e("./frontend/src/scenes/apps/MetricsTab.tsx"),R=e("./frontend/src/scenes/apps/HistoricalExportsTab.tsx"),j=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),x=e("./frontend/src/scenes/apps/ErrorDetailsModal.tsx"),O=e("./frontend/src/lib/components/Tooltip.tsx"),g=e("./frontend/src/lib/components/icons.tsx"),s=e("./node_modules/react/jsx-runtime.js"),t=e.n(s),A={component:T,logic:n.appMetricsSceneLogic,paramsToProps:function(i){var a,l=i.params.pluginConfigId;return{pluginConfigId:(a=parseInt(l))!==null&&a!==void 0?a:0}}};function T(){var o=Object(f.useValues)(n.appMetricsSceneLogic),i=o.activeTab,a=o.pluginConfig,l=o.pluginConfigLoading,r=o.showTab,M=Object(f.useActions)(n.appMetricsSceneLogic),C=M.setActiveTab;return Object(s.jsxs)("div",{children:[Object(s.jsx)(b.a,{title:a?a.plugin_info.name:Object(s.jsx)(j.a,{}),caption:"An overview of metrics and exports for this app."}),l||!i?Object(s.jsx)(j.a,{}):Object(s.jsxs)(_.a,{tabPosition:"top",animated:!1,activeKey:i,onTabClick:function(u){return C(u)},children:[r(n.AppMetricsTab.ProcessEvent)&&Object(s.jsx)(_.a.TabPane,{tab:"processEvent metrics",children:Object(s.jsx)(c.MetricsTab,{tab:n.AppMetricsTab.ProcessEvent})},n.AppMetricsTab.ProcessEvent),r(n.AppMetricsTab.OnEvent)&&Object(s.jsx)(_.a.TabPane,{tab:"onEvent metrics",children:Object(s.jsx)(c.MetricsTab,{tab:n.AppMetricsTab.OnEvent})},n.AppMetricsTab.OnEvent),r(n.AppMetricsTab.ExportEvents)&&Object(s.jsx)(_.a.TabPane,{tab:"exportEvents metrics",children:Object(s.jsx)(c.MetricsTab,{tab:n.AppMetricsTab.ExportEvents})},n.AppMetricsTab.ExportEvents),r(n.AppMetricsTab.ScheduledTask)&&Object(s.jsx)(_.a.TabPane,{tab:Object(s.jsxs)(s.Fragment,{children:["Scheduled tasks"," ",Object(s.jsx)(O.a,{title:"Shows metrics for app methods `runEveryMinute`, `runEveryHour` and `runEveryDay`",children:Object(s.jsx)(g.IconInfo,{})})]}),children:Object(s.jsx)(c.MetricsTab,{tab:n.AppMetricsTab.ScheduledTask})},n.AppMetricsTab.ScheduledTask),r(n.AppMetricsTab.HistoricalExports)&&Object(s.jsx)(_.a.TabPane,{tab:"Historical exports",children:Object(s.jsx)(R.HistoricalExportsTab,{})},n.AppMetricsTab.HistoricalExports)]}),Object(s.jsx)(x.ErrorDetailsModal,{})]})}},"./frontend/src/scenes/apps/ErrorDetailsModal.tsx":function(y,d,e){"use strict";e.r(d),e.d(d,"ErrorDetailsModal",function(){return T});var D=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),L=e.n(D),_=e("./node_modules/react/index.js"),n=e.n(_),b=e("./node_modules/kea/lib/index.esm.js"),f=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),c=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),R=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),j=e("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),x=e("./frontend/src/lib/components/LemonButton/index.ts"),O=e("./frontend/src/lib/components/icons.tsx"),g=e("./frontend/src/lib/components/LemonModal/index.ts"),s=e("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),t=e("./node_modules/react/jsx-runtime.js"),A=e.n(t);function T(){var i,a,l=Object(b.useValues)(f.appMetricsSceneLogic),r=l.errorDetails,M=l.errorDetailsModalError,C=l.errorDetailsLoading,W=Object(b.useActions)(f.appMetricsSceneLogic),u=W.closeErrorDetailsModal,S=Object(_.useState)(0),H=L()(S,2),h=H[0],N=H[1],E=r[h];return Object(t.jsx)(g.a,{isOpen:!!M,onClose:u,title:M,width:"min(50vw, 80rem)",description:Object(t.jsx)("span",{children:E==null||(i=E.error_details)===null||i===void 0||(a=i.error.message)===null||a===void 0?void 0:a.substring(0,200)}),footer:Object(t.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:C?Object(t.jsx)(c.a,{className:"1-10"}):Object(t.jsxs)(t.Fragment,{children:[Object(t.jsxs)("span",{children:[h+1," of ",r.length," sample",r.length>1?"s":""]}),Object(t.jsx)(x.a,{icon:Object(t.jsx)(O.IconChevronLeft,{}),onClick:function(){return N(h-1)},disabled:h==0}),Object(t.jsx)(x.a,{icon:Object(t.jsx)(O.IconChevronRight,{}),onClick:function(){return N(h+1)},disabled:h==r.length-1})]})}),children:!M||C?Object(t.jsx)(c.a,{className:"h-10"}):Object(t.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[Object(t.jsxs)("div",{children:[Object(t.jsx)(j.a,{children:"When:"})," ",Object(t.jsx)(R.b,{time:E.timestamp,showSeconds:!0})]}),E.error_details.eventCount&&Object(t.jsxs)("div",{children:[Object(t.jsx)(j.a,{children:"Event Count"}),Object(t.jsx)("div",{children:E.error_details.eventCount})]}),E.error_details.error.message&&Object(t.jsx)(o,{title:"Error message",defaultIsExpanded:!0,children:Object(t.jsx)(s.a,{wrap:!0,language:s.b.JavaScript,children:E.error_details.error.message})}),E.error_details.event&&Object(t.jsx)(o,{title:"Event payload",defaultIsExpanded:!1,children:Object(t.jsx)(s.a,{wrap:!0,language:s.b.JSON,children:JSON.stringify(E.error_details.event,null,2)})}),E.error_details.error.stack&&Object(t.jsx)(o,{title:"Stack trace",defaultIsExpanded:!1,children:Object(t.jsx)(s.a,{wrap:!0,language:s.b.JavaScript,children:E.error_details.error.stack})})]})})}function o(i){var a=Object(_.useState)(i.defaultIsExpanded),l=L()(a,2),r=l[0],M=l[1];return Object(t.jsxs)("div",{className:"bg-mid border rounded",children:[Object(t.jsx)(x.a,{status:"stealth",fullWidth:!0,onClick:function(){return M(!r)},sideIcon:r?Object(t.jsx)(O.IconUnfoldLess,{}):Object(t.jsx)(O.IconUnfoldMore,{}),title:r?"Show less":"Show more",className:"bg-mid",children:i.title}),r&&Object(t.jsx)("div",{className:"bg-light p-2",children:i.children})]})}},"./frontend/src/scenes/apps/HistoricalExport.tsx":function(y,d,e){"use strict";e.r(d),e.d(d,"HistoricalExport",function(){return j});var D=e("./node_modules/antd/es/card/index.js"),L=e("./node_modules/kea/lib/index.esm.js"),_=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),n=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),b=e("./frontend/src/scenes/apps/historicalExportLogic.ts"),f=e("./frontend/src/scenes/apps/MetricsTab.tsx"),c=e("./node_modules/react/jsx-runtime.js"),R=e.n(c);function j(x){var O,g,s,t,A,T=Object(L.useValues)(Object(b.historicalExportLogic)(x)),o=T.data,i=T.dataLoading;return Object(c.jsxs)("div",{className:"mt-4 mb-4 mr-8",children:[Object(c.jsx)(D.a,{title:"Overview",children:Object(c.jsx)(f.MetricsOverview,{tab:n.AppMetricsTab.HistoricalExports,metrics:(O=o==null?void 0:o.metrics)!==null&&O!==void 0?O:null,metricsLoading:i,exportDuration:o==null||(g=o.summary)===null||g===void 0?void 0:g.duration,exportFailureReason:o==null||(s=o.summary)===null||s===void 0?void 0:s.failure_reason})}),Object(c.jsx)(D.a,{title:"Delivery trends",className:"mt-4",children:Object(c.jsx)(_.AppMetricsGraph,{tab:n.AppMetricsTab.HistoricalExports,metrics:(t=o==null?void 0:o.metrics)!==null&&t!==void 0?t:null,metricsLoading:i})}),Object(c.jsx)(D.a,{title:"Errors",className:"mt-4",children:Object(c.jsx)(f.ErrorsOverview,{errors:(o==null?void 0:o.errors)||[],loading:i,category:"exportEvents",jobId:o==null||(A=o.summary)===null||A===void 0?void 0:A.job_id})})]})}try{j.displayName="HistoricalExport",j.__docgenInfo={description:"",displayName:"HistoricalExport",props:{pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"]={docgenInfo:j.__docgenInfo,name:"HistoricalExport",path:"frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"})}catch(x){}},"./frontend/src/scenes/apps/HistoricalExportsTab.tsx":function(y,d,e){"use strict";e.r(d),e.d(d,"HistoricalExportsTab",function(){return w});var D=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),L=e.n(D),_=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),n=e.n(_),b=e("./node_modules/core-js/modules/es.array.concat.js"),f=e.n(b),c=e("./node_modules/core-js/modules/es.object.keys.js"),R=e.n(c),j=e("./node_modules/core-js/modules/es.symbol.js"),x=e.n(j),O=e("./node_modules/core-js/modules/es.array.filter.js"),g=e.n(O),s=e("./node_modules/core-js/modules/es.object.to-string.js"),t=e.n(s),A=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),T=e.n(A),o=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),i=e.n(o),a=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),l=e.n(a),r=e("./node_modules/kea/lib/index.esm.js"),M=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),C=e("./frontend/src/lib/components/LemonTable/index.ts"),W=e("./frontend/src/scenes/apps/HistoricalExport.tsx"),u=e("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),S=e("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),H=e("./node_modules/antd/es/progress/index.js"),h=e("./frontend/src/lib/components/LemonButton/index.ts"),N=e("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),E=e("./node_modules/react/index.js"),$=e.n(E),p=e("./node_modules/react/jsx-runtime.js"),ee=e.n(p);function F(m,I){var v=Object.keys(m);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(m);I&&(P=P.filter(function(U){return Object.getOwnPropertyDescriptor(m,U).enumerable})),v.push.apply(v,P)}return v}function X(m){for(var I=1;I<arguments.length;I++){var v=arguments[I]!=null?arguments[I]:{};I%2?F(Object(v),!0).forEach(function(P){L()(m,P,v[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(v)):F(Object(v)).forEach(function(P){Object.defineProperty(m,P,Object.getOwnPropertyDescriptor(v,P))})}return m}var Z=2e4;function w(){var m=Object(r.useValues)(M.appMetricsSceneLogic),I=m.historicalExports,v=m.historicalExportsLoading,P=m.pluginConfig,U=m.interfaceJobsProps,G=m.hasRunningExports,Y=Object(r.useActions)(M.appMetricsSceneLogic),k=Y.openHistoricalExportModal,q=Y.loadHistoricalExports;return Object(E.useEffect)(function(){var B;function K(){G&&(B=setTimeout(function(){q(),K()},Z))}return K(),function(){return B&&clearTimeout(B)}},[G]),Object(p.jsxs)("div",{className:"space-y-2",children:[Object(p.jsx)("div",{className:"flex items-center justify-end",children:Object(p.jsx)(h.a,{type:"primary",onClick:k,disabled:!U,children:"Start new export"})}),Object(p.jsx)(C.a,{dataSource:I,loading:v,columns:[{title:"Dates exported",render:function(K,J){var z=n()(J.payload.dateRange,2),V=z[0],Q=z[1];return V===Q?V:"".concat(V," - ").concat(Q)}},{title:"Progress",width:130,render:function(K,J){switch(J.status){case"success":return Object(p.jsx)(S.a,{type:"success",className:"uppercase",children:"Success"});case"fail":return Object(p.jsx)(S.a,{type:"danger",className:"uppercase",children:"Failed"});case"not_finished":return Object(p.jsx)(H.a,{percent:Math.floor((J.progress||0)*100)})}},align:"right"},Object(u.b)(),Object(u.a)()],expandable:{expandedRowRender:function(K){if(!!P)return Object(p.jsx)(W.HistoricalExport,{pluginConfigId:P.id,jobId:K.job_id})}},useURLForSorting:!1,noSortingCancellation:!0,emptyState:Object(p.jsxs)("div",{className:"",children:[Object(p.jsx)("b",{children:"Nothing has been exported yet!"}),U&&Object(p.jsx)("p",{className:"m-0",children:'Use "Start new export" button above to export historical data in a given time range.'})]})}),U&&Object(p.jsx)(N.d,X({},U))]})}},"./frontend/src/scenes/apps/historicalExportLogic.ts":function(y,d,e){"use strict";e.r(d),e.d(d,"historicalExportLogic",function(){return i});var D=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),L=e.n(D),_=e("./node_modules/@babel/runtime/regenerator/index.js"),n=e.n(_),b=e("./node_modules/core-js/modules/es.array.concat.js"),f=e.n(b),c=e("./node_modules/core-js/modules/es.array.iterator.js"),R=e.n(c),j=e("./node_modules/core-js/modules/es.object.to-string.js"),x=e.n(j),O=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),g=e.n(O),s=e("./node_modules/kea/lib/index.esm.js"),t=e("./node_modules/kea-loaders/lib/index.js"),A=e.n(t),T=e("./frontend/src/lib/api.ts"),o=e("./frontend/src/scenes/teamLogic.tsx"),i=Object(s.kea)([Object(s.path)(["scenes","apps","historicalExportLogic"]),Object(s.props)({}),Object(s.key)(function(a){var l=a.pluginConfigId,r=a.jobId;return"".concat(l,"_").concat(r)}),Object(t.loaders)(function(a){var l=a.props;return{data:[null,{loadExportData:function(){var r=L()(n.a.mark(function C(){return n.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,T.b.get("api/projects/".concat(o.a.values.currentTeamId,"/app_metrics/").concat(l.pluginConfigId,"/historical_exports/").concat(l.jobId));case 2:return u.abrupt("return",u.sent);case 3:case"end":return u.stop()}},C)}));function M(){return r.apply(this,arguments)}return M}()}]}}),Object(s.events)(function(a){var l=a.actions;return{afterMount:l.loadExportData}})])}}]);
