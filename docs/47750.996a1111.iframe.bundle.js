"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[47750],{"../../frontend/src/scenes/experiments/SharedMetrics/SharedMetric.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SharedMetric:()=>SharedMetric,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.22.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),ObjectTags=__webpack_require__("../../frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),themeLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),tagsModel=__webpack_require__("../../frontend/src/models/tagsModel.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),ExperimentMetricForm=__webpack_require__("../../frontend/src/scenes/experiments/ExperimentMetricForm.tsx"),utils=__webpack_require__("../../frontend/src/scenes/experiments/utils.ts"),types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),TestAccountFiltersSwitch=__webpack_require__("../../frontend/src/lib/components/TestAccountFiltersSwitch.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),ActionFilter=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),ActionFilterRow=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),AggregationSelect=__webpack_require__("../../frontend/src/scenes/insights/filters/AggregationSelect.tsx"),filtersToQueryNode=__webpack_require__("../../frontend/src/queries/nodes/InsightQuery/utils/filtersToQueryNode.ts"),queryNodeToFilter=__webpack_require__("../../frontend/src/queries/nodes/InsightQuery/utils/queryNodeToFilter.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),src_types=__webpack_require__("../../frontend/src/types.ts"),Selectors=__webpack_require__("../../frontend/src/scenes/experiments/Metrics/Selectors.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),eventUsageLogic=__webpack_require__("../../frontend/src/lib/utils/eventUsageLogic.ts"),billingLogic=__webpack_require__("../../frontend/src/scenes/billing/billingLogic.tsx"),sharedMetricsLogic=__webpack_require__("../../frontend/src/scenes/experiments/SharedMetrics/sharedMetricsLogic.tsx");let NEW_SHARED_METRIC={name:"",description:"",query:void 0,tags:[]},sharedMetricLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.path)(key=>["scenes","experiments","sharedMetricLogic",key]),(0,index_esm.key)(props=>{var _props$sharedMetricId;return`${null!==(_props$sharedMetricId=props.sharedMetricId)&&void 0!==_props$sharedMetricId?_props$sharedMetricId:"new"}-${props.action}`}),(0,index_esm.connect)(()=>({actions:[sharedMetricsLogic.G,["loadSharedMetrics"],eventUsageLogic.vx,["reportExperimentSharedMetricCreated"]],values:[featureFlagLogic.featureFlagLogic,["featureFlags"],billingLogic.billingLogic,["billing"]]})),(0,index_esm.actions)({setSharedMetric:metric=>({metric}),createSharedMetric:!0,updateSharedMetric:!0,deleteSharedMetric:!0}),(0,lib.loaders)(_ref=>{let{props,values}=_ref;return{sharedMetric:{loadSharedMetric:async()=>{let{sharedMetricId}=props;return sharedMetricId?await api.ZP.get(`api/projects/@current/experiment_saved_metrics/${sharedMetricId}`):{...values.newSharedMetric}}}}}),(0,index_esm.listeners)(_ref2=>{let{actions,props,values}=_ref2;return{loadSharedMetricSuccess:()=>{"duplicate"===props.action&&values.sharedMetric&&actions.setSharedMetric({...values.sharedMetric,name:`${values.sharedMetric.name} (duplicate)`,id:void 0})},createSharedMetric:async()=>{let response=await api.ZP.create("api/projects/@current/experiment_saved_metrics/",values.sharedMetric);response.id&&(src.UJ.success("Shared metric created successfully"),actions.reportExperimentSharedMetricCreated(response),actions.loadSharedMetrics(),kea_router_lib.router.actions.push("/experiments/shared-metrics"))},updateSharedMetric:async()=>{(await api.ZP.update(`api/projects/@current/experiment_saved_metrics/${values.sharedMetricId}`,values.sharedMetric)).id&&(src.UJ.success("Shared metric updated successfully"),actions.loadSharedMetrics(),kea_router_lib.router.actions.push("/experiments/shared-metrics"))},deleteSharedMetric:async()=>{try{await api.ZP.delete(`api/projects/@current/experiment_saved_metrics/${values.sharedMetricId}`),src.UJ.success("Shared metric deleted successfully"),actions.loadSharedMetrics(),kea_router_lib.router.actions.push("/experiments/shared-metrics")}catch(error){src.UJ.error("Failed to delete shared metric"),console.error(error)}}}}),(0,index_esm.reducers)({sharedMetric:[{...NEW_SHARED_METRIC},{setSharedMetric:(state,_ref3)=>{let{metric}=_ref3;return{...state,...metric}}}]}),(0,index_esm.selectors)({sharedMetricId:[()=>[(_,props)=>{var _props$sharedMetricId2;return null!==(_props$sharedMetricId2=props.sharedMetricId)&&void 0!==_props$sharedMetricId2?_props$sharedMetricId2:"new"}],sharedMetricId=>sharedMetricId],action:[()=>[(_,props)=>props.action],action=>action],newSharedMetric:[s=>[s.featureFlags,s.billing],(featureFlags,billing)=>({...NEW_SHARED_METRIC,query:(0,utils.qJ)(featureFlags,billing)?(0,utils.US)():(0,utils.ug)()})]}),(0,kea_router_lib.urlToAction)(_ref4=>{let{actions,values}=_ref4;return{"/experiments/shared-metrics/:id":(_ref5,_,__,currentLocation,previousLocation)=>{let{id}=_ref5,didPathChange=currentLocation.initial||currentLocation.pathname!==previousLocation?.pathname;if(id&&didPathChange){let parsedId="new"===id?"new":parseInt(id);"new"===parsedId&&actions.setSharedMetric({...values.newSharedMetric}),"new"!==parsedId&&parsedId===values.sharedMetricId&&actions.loadSharedMetric()}},"/experiments/shared-metrics/:id/:action":(_ref6,_,__,currentLocation,previousLocation)=>{let{id}=_ref6,didPathChange=currentLocation.initial||currentLocation.pathname!==previousLocation?.pathname;id&&didPathChange&&actions.loadSharedMetric()}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function LegacySharedFunnelsMetricForm(){var _sharedMetricQuery$fu,_sharedMetricQuery$fu2;let{sharedMetric}=(0,index_esm.useValues)(sharedMetricLogic),{setSharedMetric}=(0,index_esm.useActions)(sharedMetricLogic),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),hasFilters=(currentTeam?.test_account_filters||[]).length>0,actionFilterProps={...Selectors.dF,actionsTaxonomicGroupTypes:[types.t.Events,types.t.Actions]};if(!sharedMetric?.query)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let sharedMetricQuery=sharedMetric.query;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,queryNodeToFilter.ce)(sharedMetricQuery.funnels_query),setFilters:_ref=>{let{actions,events,data_warehouse}=_ref;if(!sharedMetric?.query)return;let series=(0,filtersToQueryNode.NG)({actions,events,data_warehouse},!0,ActionFilterRow.Qq.None);setSharedMetric({query:{...sharedMetricQuery,funnels_query:{...sharedMetricQuery.funnels_query,series}}})},typeKey:"experiment-metric",mathAvailability:ActionFilterRow.Qq.None,buttonCopy:"Add funnel step",showSeriesIndicator:!0,seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,...actionFilterProps}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 deprecated-space-y-4",children:[(0,jsx_runtime.jsx)(Selectors.xE,{value:(0,AggregationSelect.eV)(null!==(_sharedMetricQuery$fu=sharedMetricQuery.funnels_query.aggregation_group_type_index)&&void 0!==_sharedMetricQuery$fu?_sharedMetricQuery$fu:void 0,null!==(_sharedMetricQuery$fu2=sharedMetricQuery.funnels_query.funnelsFilter?.funnelAggregateByHogQL)&&void 0!==_sharedMetricQuery$fu2?_sharedMetricQuery$fu2:void 0),onChange:value=>{setSharedMetric({query:{...sharedMetricQuery,funnels_query:{...sharedMetricQuery.funnels_query,funnelsFilter:{...sharedMetricQuery.funnels_query.funnelsFilter,funnelAggregateByHogQL:value}}}})}}),(0,jsx_runtime.jsx)(Selectors.IF,{funnelWindowInterval:sharedMetricQuery.funnels_query?.funnelsFilter?.funnelWindowInterval,funnelWindowIntervalUnit:sharedMetricQuery.funnels_query?.funnelsFilter?.funnelWindowIntervalUnit,onFunnelWindowIntervalChange:funnelWindowInterval=>{setSharedMetric({query:{...sharedMetricQuery,funnels_query:{...sharedMetricQuery.funnels_query,funnelsFilter:{...sharedMetricQuery.funnels_query.funnelsFilter,funnelWindowInterval:funnelWindowInterval}}}})},onFunnelWindowIntervalUnitChange:funnelWindowIntervalUnit=>{setSharedMetric({query:{...sharedMetricQuery,funnels_query:{...sharedMetricQuery.funnels_query,funnelsFilter:{...sharedMetricQuery.funnels_query.funnelsFilter,funnelWindowIntervalUnit:funnelWindowIntervalUnit||void 0}}}})}}),(0,jsx_runtime.jsx)(Selectors.f$,{value:(()=>{let breakdownAttributionType=sharedMetricQuery.funnels_query?.funnelsFilter?.breakdownAttributionType,breakdownAttributionValue=sharedMetricQuery.funnels_query?.funnelsFilter?.breakdownAttributionValue;return breakdownAttributionType?breakdownAttributionType===src_types.q9.Step?`${breakdownAttributionType}/${breakdownAttributionValue||0}`:breakdownAttributionType:src_types.q9.FirstTouch})(),onChange:value=>{let[breakdownAttributionType,breakdownAttributionValue]=(value||"").split("/");setSharedMetric({query:{...sharedMetricQuery,funnels_query:{...sharedMetricQuery.funnels_query,funnelsFilter:{...sharedMetricQuery.funnels_query.funnelsFilter,breakdownAttributionType:breakdownAttributionType,breakdownAttributionValue:breakdownAttributionValue?parseInt(breakdownAttributionValue):void 0}}}})},stepsLength:sharedMetricQuery.funnels_query?.series?.length}),(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:(()=>{let val=sharedMetricQuery.funnels_query?.filterTestAccounts;return!!hasFilters&&!!val})(),onChange:checked=>{setSharedMetric({query:{...sharedMetricQuery,funnels_query:{...sharedMetricQuery.funnels_query,filterTestAccounts:checked}}})},fullWidth:!0})]}),(0,jsx_runtime.jsxs)(src.Vp,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(Query.A,{query:{kind:schema_general.OH.InsightVizNode,source:sharedMetricQuery.funnels_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})}var dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),experiments_constants=__webpack_require__("../../frontend/src/scenes/experiments/constants.ts");function LegacySharedTrendsMetricForm(){let{sharedMetric}=(0,index_esm.useValues)(sharedMetricLogic),{setSharedMetric}=(0,index_esm.useActions)(sharedMetricLogic),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),hasFilters=(currentTeam?.test_account_filters||[]).length>0,[activeTab,setActiveTab]=(0,react.useState)("main");if(!sharedMetric?.query)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let sharedMetricQuery=sharedMetric.query;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:newKey=>setActiveTab(newKey),tabs:[{key:"main",label:"Main metric",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,queryNodeToFilter.ce)(sharedMetricQuery.count_query),setFilters:_ref=>{let{actions,events,data_warehouse}=_ref,series=(0,filtersToQueryNode.NG)({actions,events,data_warehouse},!0,ActionFilterRow.Qq.All);setSharedMetric({query:{...sharedMetricQuery,count_query:{...sharedMetricQuery.count_query,series}}})},typeKey:"experiment-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,showNumericalPropsOnly:!0,allowedMathTypes:experiments_constants.BK,...Selectors.dF}),(0,jsx_runtime.jsx)("div",{className:"mt-4 deprecated-space-y-4",children:(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:(()=>{let val=sharedMetricQuery.count_query?.filterTestAccounts;return!!hasFilters&&!!val})(),onChange:checked=>{setSharedMetric({query:{...sharedMetricQuery,count_query:{...sharedMetricQuery.count_query,filterTestAccounts:checked}}})},fullWidth:!0})}),(0,jsx_runtime.jsxs)(src.Vp,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(Query.A,{query:{kind:schema_general.OH.InsightVizNode,source:sharedMetricQuery.count_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})},{key:"exposure",label:"Exposure",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,jsx_runtime.jsxs)("div",{className:`flex-1 cursor-pointer p-4 rounded border ${sharedMetricQuery.exposure_query?"border-primary":"border-accent bg-accent-highlight-secondary"}`,onClick:()=>{setSharedMetric({query:{...sharedMetricQuery,exposure_query:void 0}})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Default"}),!sharedMetricQuery.exposure_query&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--accent)"})]}),(0,jsx_runtime.jsxs)("div",{className:"text-secondary text-sm leading-relaxed",children:["Uses the number of unique users who trigger the"," ",(0,jsx_runtime.jsx)(src.oe,{children:"$feature_flag_called"})," event as your exposure count. This is the recommended setting for most experiments, as it accurately tracks variant exposure."]})]}),(0,jsx_runtime.jsxs)("div",{className:`flex-1 cursor-pointer p-4 rounded border ${sharedMetricQuery.exposure_query?"border-accent bg-accent-highlight-secondary":"border-primary"}`,onClick:()=>{setSharedMetric({query:{...sharedMetricQuery,exposure_query:{kind:schema_general.OH.TrendsQuery,series:[{kind:schema_general.OH.EventsNode,name:"$feature_flag_called",event:"$feature_flag_called",math:src_types.vN.UniqueUsers}],interval:"day",dateRange:{date_from:(0,dayjs.Bv)().subtract(constants.uq,"day").format("YYYY-MM-DDTHH:mm"),date_to:(0,dayjs.Bv)().endOf("d").format("YYYY-MM-DDTHH:mm"),explicitDate:!0},trendsFilter:{display:src_types.Qb.ActionsLineGraph},filterTestAccounts:!0}}})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Custom"}),sharedMetricQuery.exposure_query&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--accent)"})]}),(0,jsx_runtime.jsx)("div",{className:"text-secondary text-sm leading-relaxed",children:"Define your own exposure metric for specific use cases, such as counting by sessions instead of users. This gives you full control but requires careful configuration."})]})]}),sharedMetricQuery.exposure_query&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,queryNodeToFilter.ce)(sharedMetricQuery.exposure_query),setFilters:_ref2=>{let{actions,events,data_warehouse}=_ref2,series=(0,filtersToQueryNode.NG)({actions,events,data_warehouse},!0,ActionFilterRow.Qq.All);setSharedMetric({query:{...sharedMetricQuery,exposure_query:{...sharedMetricQuery.exposure_query,series}}})},typeKey:"experiment-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,showNumericalPropsOnly:!0,allowedMathTypes:experiments_constants.BK,...Selectors.dF}),(0,jsx_runtime.jsx)("div",{className:"mt-4 deprecated-space-y-4",children:(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:(()=>{let val=sharedMetricQuery.exposure_query?.filterTestAccounts;return!!hasFilters&&!!val})(),onChange:checked=>{setSharedMetric({query:{...sharedMetricQuery,exposure_query:{...sharedMetricQuery.exposure_query,filterTestAccounts:checked}}})},fullWidth:!0})}),(0,jsx_runtime.jsxs)(src.Vp,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(Query.A,{query:{kind:schema_general.OH.InsightVizNode,source:sharedMetricQuery.exposure_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})]})}]})})}let scene={component:SharedMetric,logic:sharedMetricLogic,paramsToProps:_ref=>{let{params:{id,action}}=_ref;return{sharedMetricId:"new"===id?null:parseInt(id),action:action||("new"===id?"create":"update")}}};function SharedMetric(){let{sharedMetric,action}=(0,index_esm.useValues)(sharedMetricLogic),{setSharedMetric,createSharedMetric,updateSharedMetric,deleteSharedMetric}=(0,index_esm.useActions)(sharedMetricLogic),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),{tags:allExistingTags}=(0,index_esm.useValues)(tagsModel.x);return sharedMetric&&sharedMetric.query?(0,jsx_runtime.jsxs)("div",{className:"max-w-[800px]",children:[sharedMetric.query.kind!==schema_general.OH.ExperimentMetric&&(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,jsx_runtime.jsxs)("div",{className:`flex-1 cursor-pointer p-4 rounded border ${sharedMetric.query.kind===schema_general.OH.ExperimentTrendsQuery?"border-accent bg-accent-highlight-secondary":"border-primary"}`,onClick:()=>{setSharedMetric({query:(0,utils.ug)()})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Trend"}),sharedMetric.query.kind===schema_general.OH.ExperimentTrendsQuery&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--accent)"})]}),(0,jsx_runtime.jsx)("div",{className:"text-secondary text-sm leading-relaxed",children:"Track a single event, action or a property value."})]}),(0,jsx_runtime.jsxs)("div",{className:`flex-1 cursor-pointer p-4 rounded border ${sharedMetric.query.kind===schema_general.OH.ExperimentFunnelsQuery?"border-accent bg-accent-highlight-secondary":"border-primary"}`,onClick:()=>{setSharedMetric({query:(0,utils.xs)()})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Funnel"}),sharedMetric.query.kind===schema_general.OH.ExperimentFunnelsQuery&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--accent)"})]}),(0,jsx_runtime.jsx)("div",{className:"text-secondary text-sm leading-relaxed",children:"Analyze conversion rates between sequential steps."})]})]}),(0,jsx_runtime.jsxs)("div",{className:`border rounded ${isDarkModeOn?"bg-light":"bg-white"} p-4`,children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)(src.HQ,{className:"mb-1",children:"Name"}),(0,jsx_runtime.jsx)(src.DF,{value:sharedMetric.name,onChange:newName=>{setSharedMetric({name:newName})}})]}),(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)(src.HQ,{className:"mb-1",children:"Description (optional)"}),(0,jsx_runtime.jsx)(src.DF,{value:sharedMetric.description,onChange:newDescription=>{setSharedMetric({description:newDescription})}})]}),(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Tags"}),(0,jsx_runtime.jsx)("div",{className:"mt-2",children:(0,jsx_runtime.jsx)(ObjectTags.D,{tags:sharedMetric.tags||[],onChange:newTags=>{setSharedMetric({tags:newTags})},saving:!1,tagsAvailable:allExistingTags,"data-attr":"shared-metric-tags"})})]}),sharedMetric.query.kind===schema_general.OH.ExperimentMetric?(0,jsx_runtime.jsx)(ExperimentMetricForm.U,{metric:sharedMetric.query,handleSetMetric:newMetric=>{setSharedMetric({...sharedMetric,query:newMetric})},filterTestAccounts:!!currentTeam?.test_account_filters?.length}):sharedMetric.query.kind===schema_general.OH.ExperimentTrendsQuery?(0,jsx_runtime.jsx)(LegacySharedTrendsMetricForm,{}):(0,jsx_runtime.jsx)(LegacySharedFunnelsMetricForm,{})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between mt-4",children:["update"===action&&(0,jsx_runtime.jsx)(src.Jp,{size:"medium",type:"primary",status:"danger",onClick:()=>{src.dn.open({title:"Delete this metric?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"This action cannot be undone."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>deleteSharedMetric(),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Delete"}),(0,jsx_runtime.jsx)(src.Jp,{className:"ml-auto",disabledReason:sharedMetric.name?void 0:"You must give your metric a name",size:"medium",type:"primary",onClick:()=>{if(["create","duplicate"].includes(action)){createSharedMetric();return}updateSharedMetric()},children:"Save"})]})]}):(0,jsx_runtime.jsx)("div",{className:"fixed inset-0 flex justify-center items-center",children:(0,jsx_runtime.jsx)(src.$j,{className:"text-5xl"})})}}}]);