(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[2086],{"./frontend/src/scenes/apps/AppMetricsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AppMetrics:()=>AppMetrics,scene:()=>scene});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),ActivityLog=__webpack_require__("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),humanizeActivity=__webpack_require__("./frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),PluginJobConfiguration=__webpack_require__("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),sceneTypes=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),interfaceJobsLogic=__webpack_require__("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts");const TabsWithMetrics=[types.xn.ProcessEvent,types.xn.OnEvent,types.xn.ComposeWebhook,types.xn.ExportEvents,types.xn.ScheduledTask,types.xn.HistoricalExports],INITIAL_TABS=[types.xn.ProcessEvent,types.xn.OnEvent,types.xn.ComposeWebhook,types.xn.ExportEvents,types.xn.ScheduledTask],appMetricsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)((key=>["scenes","apps","appMetricsSceneLogic",key])),(0,index_esm.props)({}),(0,index_esm.key)((props=>props.pluginConfigId)),(0,index_esm.actions)({setActiveTab:tab=>({tab}),setDateFrom:dateFrom=>({dateFrom}),openErrorDetailsModal:(errorType,category,jobId)=>({errorType,category,jobId}),closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),(0,index_esm.reducers)({activeTab:[null,{setActiveTab:(_,_ref)=>{let{tab}=_ref;return tab}}],selectedDateFrom:[null,{setDateFrom:(_,_ref2)=>{let{dateFrom}=_ref2;return dateFrom}}],errorDetailsModalError:[null,{openErrorDetailsModal:(_,_ref3)=>{let{errorType}=_ref3;return errorType},closeErrorDetailsModal:()=>null}]}),(0,lib.loaders)((_ref4=>{let{values,props}=_ref4;return{pluginConfig:[null,{loadPluginConfig:async()=>await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/plugin_configs/${props.pluginConfigId}`)}],appMetricsResponse:[null,{loadMetrics:async()=>{if(!values.activeTab||!values.dateFrom)return null;const params=(0,utils.oZ)({category:values.activeTab,date_from:values.dateFrom});return await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}?${params}`)}}],historicalExports:[[],{loadHistoricalExports:async()=>{const{results}=await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}/historical_exports`);return results}}],errorDetails:[[],{openErrorDetailsModal:async _ref5=>{let{category,jobId,errorType}=_ref5;const params=(0,utils.oZ)({category,job_id:jobId,error_type:errorType}),{result}=await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}/error_details?${params}`);return result}}]}})),(0,index_esm.selectors)((_ref6=>{let{values,actions}=_ref6;return{breadcrumbs:[(s,p)=>[s.pluginConfig,p.pluginConfigId],(pluginConfig,pluginConfigId)=>[{key:sceneTypes.x.Apps,name:"Apps",path:urls.j.projectApps()},{key:pluginConfigId,name:pluginConfig?.plugin_info?.name,path:urls.j.appMetrics(pluginConfigId)}]],defaultTab:[s=>[s.pluginConfig],()=>{var _INITIAL_TABS$filter$;return null!==(_INITIAL_TABS$filter$=INITIAL_TABS.filter((tab=>values.showTab(tab)))[0])&&void 0!==_INITIAL_TABS$filter$?_INITIAL_TABS$filter$:types.xn.Logs}],defaultDateFrom:[s=>[s.pluginConfig],pluginConfig=>{if(!pluginConfig?.created_at)return"-30d";const installedAt=dayjs.Bv.utc(pluginConfig.created_at),daysSinceInstall=(0,dayjs.Bv)().diff(installedAt,"days",!0);return daysSinceInstall<=1?"-24h":daysSinceInstall<=7?"-7d":"-30d"}],dateFrom:[s=>[s.selectedDateFrom,s.defaultDateFrom],(selectedDateFrom,defaultDateFrom)=>{var _ref7;return null!==(_ref7=null!=selectedDateFrom?selectedDateFrom:defaultDateFrom)&&void 0!==_ref7?_ref7:"-30d"}],showTab:[()=>[()=>1],()=>tab=>{if(values.pluginConfigLoading||!values.pluginConfig||!values.pluginConfig.plugin_info.capabilities)return!1;const capabilities=values.pluginConfig.plugin_info.capabilities,isExportEvents=capabilities.methods?.includes("exportEvents");return!TabsWithMetrics.includes(tab)||(tab===types.xn.HistoricalExports?!!isExportEvents:(tab!==types.xn.OnEvent||!isExportEvents)&&(tab===types.xn.ScheduledTask?!isExportEvents&&["runEveryMinute","runEveryHour","runEveryDay"].some((method=>capabilities.scheduled_tasks?.includes(method))):!!capabilities.methods?.includes(tab)))}],interfaceJobsProps:[s=>[s.pluginConfig],pluginConfig=>pluginConfig&&pluginConfig.plugin_info.public_jobs&&pluginConfig?.enabled?{jobName:PluginJobConfiguration._F,jobSpec:pluginConfig.plugin_info.public_jobs[PluginJobConfiguration._F],pluginConfigId:pluginConfig.id,pluginId:pluginConfig.plugin,onSubmit:actions.loadHistoricalExports}:null],hasRunningExports:[s=>[s.historicalExports],historicalExports=>historicalExports.some((e=>"not_finished"==e.status))]}})),(0,index_esm.listeners)((_ref8=>{let{values,actions}=_ref8;return{loadPluginConfigSuccess:()=>{values.activeTab||actions.setActiveTab(values.defaultTab)},setActiveTab:_ref9=>{let{tab}=_ref9;tab===types.xn.HistoricalExports?actions.loadHistoricalExports():TabsWithMetrics.includes(tab)&&actions.loadMetrics()},setDateFrom:()=>{actions.loadMetrics()},openHistoricalExportModal:()=>{values.interfaceJobsProps&&(0,interfaceJobsLogic.D)(values.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}})),(0,kea_router_lib.actionToUrl)((_ref10=>{let{values,props}=_ref10;return{setActiveTab:()=>getUrl(values,props),setDateFrom:()=>getUrl(values,props),openErrorDetailsModal:()=>getUrl(values,props),closeErrorDetailsModal:()=>getUrl(values,props)}})),(0,kea_router_lib.urlToAction)((_ref11=>{let{values,actions,props}=_ref11;return{"/app/:pluginConfigId/:page":(url,params)=>{if(props.pluginConfigId===Number(url.pluginConfigId))if(values.pluginConfig||actions.loadPluginConfig(),url.page===types.xn.HistoricalExports)actions.setActiveTab(types.xn.HistoricalExports);else if(url.page===types.xn.History)actions.setActiveTab(types.xn.History);else if(url.page===types.xn.Logs)actions.setActiveTab(types.xn.Logs);else if(params.tab&&INITIAL_TABS.includes(params.tab)&&params.tab!==values.activeTab?actions.setActiveTab(params.tab):values.pluginConfigLoading||values.activeTab===values.defaultTab||actions.setActiveTab(values.defaultTab),params.from&&values.selectedDateFrom!==params.from&&actions.setDateFrom(params.from),params.error){const[error,category]=params.error;values.errorDetailsModalError!==error&&(actions.setActiveTab(category),actions.openErrorDetailsModal(error,category))}else actions.closeErrorDetailsModal()}}}))]);function getUrl(values,props){if(values.activeTab===types.xn.HistoricalExports)return urls.j.appHistoricalExports(props.pluginConfigId);if(values.activeTab===types.xn.History)return urls.j.appHistory(props.pluginConfigId,kea_router_lib.router.values.searchParams);if(values.activeTab===types.xn.Logs)return urls.j.appLogs(props.pluginConfigId,kea_router_lib.router.values.searchParams);const params={};return values.activeTab&&values.activeTab!==values.defaultTab&&(params.tab=values.activeTab),values.selectedDateFrom&&(params.from=values.selectedDateFrom),values.errorDetailsModalError&&values.activeTab&&(params.error=[values.errorDetailsModalError,values.activeTab]),urls.j.appMetrics(props.pluginConfigId,params)}var PluginImage=__webpack_require__("./frontend/src/scenes/plugins/plugin/PluginImage.tsx"),pluginsLogic=__webpack_require__("./frontend/src/scenes/plugins/pluginsLogic.ts"),components=__webpack_require__("./frontend/src/scenes/plugins/tabs/apps/components.tsx"),PluginLogs=__webpack_require__("./frontend/src/scenes/plugins/plugin/PluginLogs.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AppLogsTab(){const{activeTab,pluginConfig,pluginConfigLoading}=(0,index_esm.useValues)(appMetricsSceneLogic);return pluginConfig&&!pluginConfigLoading&&activeTab?(0,jsx_runtime.jsx)("div",{className:"space-y-8",children:(0,jsx_runtime.jsx)(PluginLogs.b,{pluginConfigId:pluginConfig.id})}):(0,jsx_runtime.jsx)(LemonSkeleton.y,{})}var CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonLabel=__webpack_require__("./frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");function ErrorDetailsModal(){const{errorDetails,errorDetailsModalError,errorDetailsLoading}=(0,index_esm.useValues)(appMetricsSceneLogic),{closeErrorDetailsModal}=(0,index_esm.useActions)(appMetricsSceneLogic),[page,setPage]=(0,react.useState)(0),activeErrorDetails=errorDetails[page];return(0,jsx_runtime.jsx)(LemonModal.f,{isOpen:!!errorDetailsModalError,onClose:closeErrorDetailsModal,title:errorDetailsModalError,width:"min(50vw, 80rem)",description:(0,jsx_runtime.jsx)("span",{children:activeErrorDetails?.error_details?.error.message?.substring(0,200)}),footer:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("span",{children:[page+1," of ",errorDetails.length," sample",errorDetails.length>1?"s":""]}),(0,jsx_runtime.jsx)(LemonButton.Jp,{icon:(0,jsx_runtime.jsx)(icons.ed9,{}),onClick:()=>setPage(page-1),disabled:0==page}),(0,jsx_runtime.jsx)(LemonButton.Jp,{icon:(0,jsx_runtime.jsx)(icons.VG8,{}),onClick:()=>setPage(page+1),disabled:page==errorDetails.length-1})]})}),children:!errorDetailsModalError||errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"When:"})," ",(0,jsx_runtime.jsx)(TZLabel.w,{time:activeErrorDetails.timestamp,showSeconds:!0})]}),activeErrorDetails.error_details.eventCount&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Event Count"}),(0,jsx_runtime.jsx)("div",{children:activeErrorDetails.error_details.eventCount})]}),activeErrorDetails.error_details.error.message&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Error message",defaultIsExpanded:!0,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.message})}),activeErrorDetails.error_details.event&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Event payload",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JSON,children:JSON.stringify(activeErrorDetails.error_details.event,null,2)})}),activeErrorDetails.error_details.error.stack&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Stack trace",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.stack})})]})})}function CollapsibleSection(props){const[isExpanded,setIsExpanded]=(0,react.useState)(props.defaultIsExpanded);return(0,jsx_runtime.jsxs)("div",{className:"bg-mid border rounded",children:[(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",fullWidth:!0,onClick:()=>setIsExpanded(!isExpanded),sideIcon:isExpanded?(0,jsx_runtime.jsx)(icons.GZ,{}):(0,jsx_runtime.jsx)(icons.So7,{}),title:isExpanded?"Show less":"Show more",className:"bg-mid",children:props.title}),isExpanded&&(0,jsx_runtime.jsx)("div",{className:"bg-bg-light p-2",children:props.children})]})}var progress=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@18.2.0_react@18.2.0/node_modules/antd/es/progress/index.js"),LemonButton_LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/LemonButton.tsx"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),LemonTag=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),card=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_react-dom@18.2.0_react@18.2.0/node_modules/antd/es/card/index.js"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),AppMetricsGraph=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/apps/AppMetricsGraph.scss"),AppMetricsGraph_default=__webpack_require__.n(AppMetricsGraph),options={insert:"head",singleton:!1};injectStylesIntoStyleTag_default()(AppMetricsGraph_default(),options);AppMetricsGraph_default().locals;var Chart=__webpack_require__("./frontend/src/lib/Chart.ts"),colors=__webpack_require__("./frontend/src/lib/colors.ts");const DescriptionColumns={[types.xn.ProcessEvent]:{successes:"Events processed",successes_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed and transformed by the ",(0,jsx_runtime.jsx)("i",{children:"processEvent"})," app method."]}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events had errors when being processed by the ",(0,jsx_runtime.jsx)("i",{children:"processEvent"})," app method, but were still ingested."]})},[types.xn.OnEvent]:{successes:"Events processed",successes_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed by the ",(0,jsx_runtime.jsx)("i",{children:"onEvent"})," app method on the first try."]}),successes_on_retry:"Events processed on retry",successes_on_retry_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed by the ",(0,jsx_runtime.jsx)("i",{children:"onEvent"})," app method after being retried."]}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events had errors when being processed by the ",(0,jsx_runtime.jsx)("i",{children:"onEvent"})," app method."]})},[types.xn.ComposeWebhook]:{successes:"Events processed",successes_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed by the ",(0,jsx_runtime.jsx)("i",{children:"composeWebhook"})," app method on the first try."]}),successes_on_retry:"Events processed on retry",successes_on_retry_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed by the ",(0,jsx_runtime.jsx)("i",{children:"composeWebhook"})," app method after being retried."]}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events had errors when being processed by the ",(0,jsx_runtime.jsx)("i",{children:"composeWebhook"})," app method."]})},[types.xn.ExportEvents]:{successes:"Events delivered",successes_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})},[types.xn.HistoricalExports]:{successes:"Events delivered",successes_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})},[types.xn.ScheduledTask]:{successes:"Successes",successes_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["How many times ",(0,jsx_runtime.jsx)("i",{children:"runEveryMinute"}),", ",(0,jsx_runtime.jsx)("i",{children:"runEveryHour"})," or ",(0,jsx_runtime.jsx)("i",{children:"runEveryDay"})," was called successfully."]}),failures:"Failures",failures_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["How many times ",(0,jsx_runtime.jsx)("i",{children:"runEveryMinute"}),", ",(0,jsx_runtime.jsx)("i",{children:"runEveryHour"})," or ",(0,jsx_runtime.jsx)("i",{children:"runEveryDay"})," failed due to errors."]})}};function AppMetricsGraph_AppMetricsGraph(_ref){let{tab,metrics,metricsLoading}=_ref;const canvasRef=(0,react.useRef)(null),descriptions=DescriptionColumns[tab];return(0,react.useEffect)((()=>{let chart;if(canvasRef.current&&metrics&&!(0,utils.es)())return chart=new Chart.kL(canvasRef.current?.getContext("2d"),{type:"line",data:{labels:metrics.dates,datasets:[{label:descriptions.successes,data:metrics.successes,borderColor:"",...colorConfig("data-color-1")},...descriptions.successes_on_retry?[{label:descriptions.successes_on_retry,data:metrics.successes_on_retry,...colorConfig("data-color-13")}]:[],{label:descriptions.failures,data:metrics.failures,...colorConfig("data-color-5")}]},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}}),()=>{chart?.destroy()}}),[metrics]),metricsLoading||!metrics?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"AppMetricsGraph border rounded p-6"}):(0,jsx_runtime.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:(0,jsx_runtime.jsx)("canvas",{ref:canvasRef})})}function colorConfig(baseColorVar){const mainColor=(0,colors.cM)(baseColorVar);return{borderColor:mainColor,hoverBorderColor:(0,utils._$)(mainColor,-20),hoverBackgroundColor:(0,utils._$)(mainColor,-20),backgroundColor:mainColor,fill:!1,borderWidth:2,pointRadius:0}}try{AppMetricsGraph_AppMetricsGraph.displayName="AppMetricsGraph",AppMetricsGraph_AppMetricsGraph.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"logs"'},{value:'"processEvent"'},{value:'"onEvent"'},{value:'"composeWebhook"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'},{value:'"history"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:AppMetricsGraph_AppMetricsGraph.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(__react_docgen_typescript_loader_error){}const historicalExportLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","apps","historicalExportLogic"]),(0,index_esm.props)({}),(0,index_esm.key)((_ref=>{let{pluginConfigId,jobId}=_ref;return`${pluginConfigId}_${jobId}`})),(0,lib.loaders)((_ref2=>{let{props}=_ref2;return{data:[null,{loadExportData:async()=>await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}/historical_exports/${props.jobId}`)}]}})),(0,index_esm.events)((_ref3=>{let{actions}=_ref3;return{afterMount:actions.loadExportData}}))]);var LemonSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts");function MetricsTab(_ref){let{tab}=_ref;const{appMetricsResponse,appMetricsResponseLoading,dateFrom}=(0,index_esm.useValues)(appMetricsSceneLogic),{setDateFrom}=(0,index_esm.useActions)(appMetricsSceneLogic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,jsx_runtime.jsx)(MetricsOverview,{tab,metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{value:dateFrom,onChange:newValue=>setDateFrom(newValue),options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Delivery trends"}),(0,jsx_runtime.jsx)(AppMetricsGraph_AppMetricsGraph,{tab,metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Errors"}),(0,jsx_runtime.jsx)(ErrorsOverview,{category:tab,errors:appMetricsResponse?.errors||[],loading:appMetricsResponseLoading,showExtendedEmptyState:!0})]})]})}function MetricsOverview(_ref2){let{tab,metrics,metricsLoading,exportDuration,exportFailureReason}=_ref2;return metricsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-20 h-4 mb-2",repeat:4}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:[DescriptionColumns[tab].successes," ",DescriptionColumns[tab].successes_tooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:DescriptionColumns[tab].successes_tooltip,children:(0,jsx_runtime.jsx)(icons.aUG,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.successes)})]}),DescriptionColumns[tab].successes_on_retry&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:[DescriptionColumns[tab].successes_on_retry," ",DescriptionColumns[tab].successes_on_retry_tooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:DescriptionColumns[tab].successes_on_retry_tooltip,children:(0,jsx_runtime.jsx)(icons.aUG,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.successes_on_retry)})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:[DescriptionColumns[tab].failures," ",DescriptionColumns[tab].failures_tooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:DescriptionColumns[tab].failures_tooltip,children:(0,jsx_runtime.jsx)(icons.aUG,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.failures)})]}),exportDuration&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export duration"}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:(0,utils.C7)(exportDuration)})]})]}),exportFailureReason&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export failure reason"}),(0,jsx_runtime.jsx)("div",{children:exportFailureReason})]})]})}function ErrorsOverview(_ref3){let{errors,loading,category,jobId,showExtendedEmptyState}=_ref3;const{openErrorDetailsModal}=(0,index_esm.useActions)(appMetricsSceneLogic);return(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:errors,loading,columns:[{title:"Error type",dataIndex:"error_type",render:function RenderErrorType(_,errorSummary){return(0,jsx_runtime.jsx)(Link.r,{title:"View details",className:"font-semibold",onClick:event=>{event.preventDefault(),openErrorDetailsModal(errorSummary.error_type,category,jobId)},children:errorSummary.error_type})},sorter:(a,b)=>a.error_type.localeCompare(b.error_type)},{title:"Count",dataIndex:"count",align:"right",sorter:(a,b)=>a.count-b.count},{title:"Last seen",dataIndex:"last_seen",render:function RenderCreatedAt(lastSeen){return(0,jsx_runtime.jsx)("div",{className:"whitespace-nowrap text-right",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:lastSeen})})},align:"right",sorter:(a,b)=>new Date(a.last_seen||0)>new Date(b.last_seen||0)?1:-1}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:(0,jsx_runtime.jsxs)("div",{className:"",children:[(0,jsx_runtime.jsx)("b",{children:"No errors! ðŸ¥³"}),showExtendedEmptyState&&(0,jsx_runtime.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})}function renderNumber(value){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value?(0,utils.Lc)(value):value})}try{MetricsTab.displayName="MetricsTab",MetricsTab.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"logs"'},{value:'"processEvent"'},{value:'"onEvent"'},{value:'"composeWebhook"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'},{value:'"history"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:MetricsTab.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(__react_docgen_typescript_loader_error){}try{MetricsOverview.displayName="MetricsOverview",MetricsOverview.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"logs"'},{value:'"processEvent"'},{value:'"onEvent"'},{value:'"composeWebhook"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'},{value:'"history"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}},exportDuration:{defaultValue:null,description:"",name:"exportDuration",required:!1,type:{name:"number"}},exportFailureReason:{defaultValue:null,description:"",name:"exportFailureReason",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:MetricsOverview.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(__react_docgen_typescript_loader_error){}try{ErrorsOverview.displayName="ErrorsOverview",ErrorsOverview.__docgenInfo={description:"",displayName:"ErrorsOverview",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"AppErrorSummary[]"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},category:{defaultValue:null,description:"",name:"category",required:!0,type:{name:"string"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!1,type:{name:"string"}},showExtendedEmptyState:{defaultValue:null,description:"",name:"showExtendedEmptyState",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"]={docgenInfo:ErrorsOverview.__docgenInfo,name:"ErrorsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#ErrorsOverview"})}catch(__react_docgen_typescript_loader_error){}function HistoricalExport(props){var _data$metrics,_data$metrics2;const{data,dataLoading}=(0,index_esm.useValues)(historicalExportLogic(props));return(0,jsx_runtime.jsxs)("div",{className:"mt-4 mb-4 mr-8",children:[(0,jsx_runtime.jsx)(card.Z,{title:"Overview",children:(0,jsx_runtime.jsx)(MetricsOverview,{tab:types.xn.HistoricalExports,metrics:null!==(_data$metrics=data?.metrics)&&void 0!==_data$metrics?_data$metrics:null,metricsLoading:dataLoading,exportDuration:data?.summary?.duration,exportFailureReason:data?.summary?.failure_reason})}),(0,jsx_runtime.jsx)(card.Z,{title:"Delivery trends",className:"mt-4",children:(0,jsx_runtime.jsx)(AppMetricsGraph_AppMetricsGraph,{tab:types.xn.HistoricalExports,metrics:null!==(_data$metrics2=data?.metrics)&&void 0!==_data$metrics2?_data$metrics2:null,metricsLoading:dataLoading})}),(0,jsx_runtime.jsx)(card.Z,{title:"Errors",className:"mt-4",children:(0,jsx_runtime.jsx)(ErrorsOverview,{errors:data?.errors||[],loading:dataLoading,category:"exportEvents",jobId:data?.summary?.job_id})})]})}try{HistoricalExport.displayName="HistoricalExport",HistoricalExport.__docgenInfo={description:"",displayName:"HistoricalExport",props:{pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"]={docgenInfo:HistoricalExport.__docgenInfo,name:"HistoricalExport",path:"frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"})}catch(__react_docgen_typescript_loader_error){}const RELOAD_HISTORICAL_EXPORTS_FREQUENCY_MS=2e4;function HistoricalExportsTab(){const{historicalExports,historicalExportsLoading,pluginConfig,interfaceJobsProps,hasRunningExports}=(0,index_esm.useValues)(appMetricsSceneLogic),{openHistoricalExportModal,loadHistoricalExports}=(0,index_esm.useActions)(appMetricsSceneLogic),{user}=(0,index_esm.useValues)(userLogic.userLogic);return(0,react.useEffect)((()=>{let timer;return function updateTimer(){hasRunningExports&&(timer=setTimeout((()=>{loadHistoricalExports(),updateTimer()}),RELOAD_HISTORICAL_EXPORTS_FREQUENCY_MS))}(),()=>timer&&clearTimeout(timer)}),[hasRunningExports]),(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[user?.is_impersonated&&(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end",children:(0,jsx_runtime.jsx)(LemonButton_LemonButton.Jp,{type:"primary",onClick:openHistoricalExportModal,disabled:!interfaceJobsProps,children:"Start new export"})}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:historicalExports,loading:historicalExportsLoading,columns:[{title:"Dates exported",render:function Render(_,historicalExport){const[dateFrom,dateTo]=historicalExport.payload.dateRange;return dateFrom===dateTo?dateFrom:`${dateFrom} - ${dateTo}`}},{title:"Progress",width:130,render:function RenderProgress(_,historicalExport){switch(historicalExport.status){case"success":return(0,jsx_runtime.jsx)(LemonTag.o,{type:"success",className:"uppercase",children:"Success"});case"fail":return(0,jsx_runtime.jsx)(LemonTag.o,{type:"danger",className:"uppercase",children:"Failed"});case"not_finished":return(0,jsx_runtime.jsx)(progress.Z,{percent:Math.floor(100*(historicalExport.progress||0))})}},align:"right"},(0,columnUtils.JB)(),(0,columnUtils.rw)()],expandable:{expandedRowRender:function Render(historicalExport){if(pluginConfig)return(0,jsx_runtime.jsx)(HistoricalExport,{pluginConfigId:pluginConfig.id,jobId:historicalExport.job_id})}},useURLForSorting:!1,noSortingCancellation:!0,emptyState:(0,jsx_runtime.jsx)("div",{className:"",children:(0,jsx_runtime.jsx)("b",{children:"Nothing has been exported yet!"})})}),interfaceJobsProps&&(0,jsx_runtime.jsx)(PluginJobConfiguration.CC,{...interfaceJobsProps})]})}const scene={component:AppMetrics,logic:appMetricsSceneLogic,paramsToProps:_ref=>{var _parseInt;let{params:{pluginConfigId}}=_ref;return{pluginConfigId:null!==(_parseInt=parseInt(pluginConfigId))&&void 0!==_parseInt?_parseInt:0}}};function AppMetrics(){const{activeTab,pluginConfig,pluginConfigLoading,showTab}=(0,index_esm.useValues)(appMetricsSceneLogic),{editPlugin}=(0,index_esm.useActions)(pluginsLogic.C),{setActiveTab}=(0,index_esm.useActions)(appMetricsSceneLogic);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[pluginConfig?(0,jsx_runtime.jsx)(PluginImage.c,{plugin:pluginConfig?.plugin_info}):(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-10 h-10"}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(PageHeader.m,{title:pluginConfig?(0,jsx_runtime.jsxs)("span",{className:"flex items-center gap-2",children:[pluginConfig.plugin_info.name,(0,jsx_runtime.jsx)(components.WZ,{plugin:pluginConfig.plugin_info})]}):(0,jsx_runtime.jsx)(LemonSkeleton.y,{}),caption:pluginConfig?"An overview of metrics and exports for this app.":void 0,buttons:pluginConfig?.plugin?(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",icon:(0,jsx_runtime.jsx)(icons.iCC,{}),onClick:()=>editPlugin(pluginConfig?.plugin),children:"Configure"}):void 0})})]}),pluginConfigLoading||!activeTab?(0,jsx_runtime.jsx)(LemonSkeleton.y,{}):(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeTab,onChange:newKey=>setActiveTab(newKey),tabs:[showTab(types.xn.ProcessEvent)&&{key:types.xn.ProcessEvent,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"processEvent metrics"}),content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.ProcessEvent})},showTab(types.xn.OnEvent)&&{key:types.xn.OnEvent,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"onEvent metrics"}),content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.OnEvent})},showTab(types.xn.ComposeWebhook)&&{key:types.xn.ComposeWebhook,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"composeWebhook metrics"}),content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.ComposeWebhook})},showTab(types.xn.ExportEvents)&&{key:types.xn.ExportEvents,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"exportEvents metrics"}),content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.ExportEvents})},showTab(types.xn.ScheduledTask)&&{key:types.xn.ScheduledTask,label:"Scheduled tasks",tooltip:"Metrics for app methods `runEveryMinute`, `runEveryHour` and `runEveryDay`.",content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.ScheduledTask})},showTab(types.xn.HistoricalExports)&&{key:types.xn.HistoricalExports,label:"Historical exports",content:(0,jsx_runtime.jsx)(HistoricalExportsTab,{})},{key:types.xn.Logs,label:"Logs",content:(0,jsx_runtime.jsx)(AppLogsTab,{})},{key:types.xn.History,label:"History",content:(0,jsx_runtime.jsx)(ActivityLog.D,{scope:humanizeActivity.jc.PLUGIN,id:pluginConfig?.id})}]}),(0,jsx_runtime.jsx)(ErrorDetailsModal,{})]})}},"./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$f:()=>HISTORICAL_EXPORT_JOB_NAME,CC:()=>PluginJobModal,QZ:()=>PluginJobConfiguration,_F:()=>HISTORICAL_EXPORT_JOB_NAME_V2});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.4.10_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_components_CodeEditors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/components/CodeEditors.tsx"),lib_components_DatePicker__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/components/DatePicker.tsx"),lib_dayjs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/dayjs.ts"),lib_forms_Field__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonCalendarRange_LemonCalendarRangeInline__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCalendarRange/LemonCalendarRangeInline.tsx"),lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx"),lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/lib/utils.tsx"),react__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const HISTORICAL_EXPORT_JOB_NAME="Export historical events",HISTORICAL_EXPORT_JOB_NAME_V2="Export historical events V2";function PluginJobConfiguration(props){const{jobName,jobSpec,pluginConfigId,pluginId}=props,{playButtonOnClick}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)((0,_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D)(props)),{runJobAvailable}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)((0,_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D)(props)),jobHasEmptyPayload=0===Object.keys(jobSpec.payload||{}).length,configureOrRunJobTooltip=runJobAvailable?jobHasEmptyPayload?"Run job":"Configure and run job":"You already ran this job recently.";return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("span",{className:"ml-1",onClick:()=>playButtonOnClick(jobHasEmptyPayload),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Tooltip,{title:configureOrRunJobTooltip,children:jobHasEmptyPayload?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_8__.UdX,{className:runJobAvailable?"Plugin__RunJobButton":"Plugin__RunJobButton--disabled"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_8__.iCC,{className:runJobAvailable?"Plugin__RunJobButton":"Plugin__RunJobButton--disabled"})})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(PluginJobModal,{jobName,jobSpec,pluginConfigId,pluginId})]})}function PluginJobModal(props){const{jobName,jobSpec}=props,{setIsJobModalOpen,submitJobPayload}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)((0,_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D)(props)),{isJobModalOpen}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)((0,_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D)(props)),{user}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(scenes_userLogic__WEBPACK_IMPORTED_MODULE_15__.userLogic),shownFields=(0,react__WEBPACK_IMPORTED_MODULE_14__.useMemo)((()=>Object.entries(jobSpec.payload||{}).filter((_ref=>{let[,options]=_ref;return!options.staff_only||user?.is_staff||user?.is_impersonated})).sort(((a,b)=>a[0].localeCompare(b[0])))),[jobSpec,user]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_12__.f,{isOpen:isJobModalOpen,onClose:()=>setIsJobModalOpen(!1),title:`Configuring job '${jobName}'`,footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_9__.Jp,{type:"secondary",className:"mr-2",onClick:()=>setIsJobModalOpen(!1),children:"Cancel"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_9__.Jp,{"data-attr":"run-job",type:"primary",onClick:()=>submitJobPayload(),children:"Run job now"})]}),children:shownFields.length>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(kea_forms__WEBPACK_IMPORTED_MODULE_3__.Form,{logic:_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D,props,formKey:"jobPayload",children:shownFields.map((_ref2=>{let[key,options]=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_7__.g,{name:key,label:options.title||key,className:"mb-4",children:props=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(FieldInput,{options,...props})},key)}))}):null})}function FieldInput(_ref3){let{options,value,onChange}=_ref3;switch(options.type){case"string":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_11__.D,{value:value||"",onChange});case"number":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_11__.D,{type:"number",value,onChange});case"json":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_components_CodeEditors__WEBPACK_IMPORTED_MODULE_4__.p,{options:{codeLens:!1,lineNumbers:"off"},className:"Plugin__JobJsonEditor",language:"json",height:200,value,onChange});case"boolean":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonSegmentedButton,{onChange,value,options:[{value:!0,label:"True",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconCheck,{})},{value:!1,label:"False",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_8__.bMz,{})}]});case"date":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_components_DatePicker__WEBPACK_IMPORTED_MODULE_5__.M,{popupStyle:{zIndex:1061},allowClear:!0,placeholder:"Choose a date",className:"retention-date-picker",suffixIcon:null,use12Hours:!0,showTime:!0,value:value?(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value):null,onChange:date=>onChange(date?.toISOString())});case"daterange":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)("div",{className:"border rounded p-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("div",{className:"pb-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonCalendarRange_LemonCalendarRangeInline__WEBPACK_IMPORTED_MODULE_10__.S,{value:value?[(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[0]),(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[1])]:null,onChange:_ref4=>{let[rangeStart,rangeEnd]=_ref4;return onChange([rangeStart.format("YYYY-MM-DD"),rangeEnd.format("YYYY-MM-DD")])}})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)("div",{className:"border-t pt-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("span",{className:"text-muted",children:"Selected period:"})," ",value?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("span",{children:value[0]===value[1]?(0,lib_utils__WEBPACK_IMPORTED_MODULE_13__.p6)((0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[0])):(0,lib_utils__WEBPACK_IMPORTED_MODULE_13__._Q)((0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[0]),(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[1]))}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("span",{className:"italic",children:"No period selected."})]})]})}}try{PluginJobConfiguration.displayName="PluginJobConfiguration",PluginJobConfiguration.__docgenInfo={description:"",displayName:"PluginJobConfiguration",props:{jobName:{defaultValue:null,description:"",name:"jobName",required:!0,type:{name:"string"}},jobSpec:{defaultValue:null,description:"",name:"jobSpec",required:!0,type:{name:"JobSpec"}},pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}},pluginId:{defaultValue:null,description:"",name:"pluginId",required:!0,type:{name:"number"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!1,type:{name:"(() => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx#PluginJobConfiguration"]={docgenInfo:PluginJobConfiguration.__docgenInfo,name:"PluginJobConfiguration",path:"frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx#PluginJobConfiguration"})}catch(__react_docgen_typescript_loader_error){}try{PluginJobModal.displayName="PluginJobModal",PluginJobModal.__docgenInfo={description:"",displayName:"PluginJobModal",props:{jobName:{defaultValue:null,description:"",name:"jobName",required:!0,type:{name:"string"}},jobSpec:{defaultValue:null,description:"",name:"jobSpec",required:!0,type:{name:"JobSpec"}},pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}},pluginId:{defaultValue:null,description:"",name:"pluginId",required:!0,type:{name:"number"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!1,type:{name:"(() => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx#PluginJobModal"]={docgenInfo:PluginJobModal.__docgenInfo,name:"PluginJobModal",path:"frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx#PluginJobModal"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{D:()=>interfaceJobsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_lemon_ui_lemonToast__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/lemonToast.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/utils.tsx");const interfaceJobsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","plugins","edit","interface-jobs","interfaceJobsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)((props=>`${props.pluginId}_${props.jobName}`)),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setIsJobModalOpen:isOpen=>({isOpen}),setRunJobAvailable:isAvailable=>({isAvailable}),runJob:form=>({form}),playButtonOnClick:jobHasEmptyPayload=>({jobHasEmptyPayload}),setRunJobAvailableTimeout:timeout=>({timeout})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({isJobModalOpen:[!1,{setIsJobModalOpen:(_,_ref)=>{let{isOpen}=_ref;return isOpen}}],runJobAvailable:[!0,{setRunJobAvailable:(_,_ref2)=>{let{isAvailable}=_ref2;return isAvailable}}],runJobAvailableTimeout:[null,{setRunJobAvailableTimeout:(_,_ref3)=>{let{timeout}=_ref3;return timeout}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((_ref4=>{let{actions,values}=_ref4;return{playButtonOnClick:_ref5=>{let{jobHasEmptyPayload}=_ref5;values.runJobAvailable&&(jobHasEmptyPayload?actions.submitJobPayload():actions.setIsJobModalOpen(!0))}}})),(0,kea_forms__WEBPACK_IMPORTED_MODULE_1__.forms)((_ref6=>{let{actions,props,values}=_ref6;return{jobPayload:{defaults:Object.fromEntries(Object.entries(props.jobSpec.payload||{}).filter((_ref7=>{let[,spec]=_ref7;return"default"in spec})).map((_ref8=>{let[key,spec]=_ref8;return[key,spec.default]}))),errors:payload=>{const errors={};for(const key of Object.keys(props.jobSpec.payload||{})){const spec=props.jobSpec.payload?.[key];spec?.required&&null==payload[key]?errors[key]="Please enter a value":"json"!=spec?.type||(0,lib_utils__WEBPACK_IMPORTED_MODULE_4__.XA)(payload[key])||(errors[key]="Please enter valid JSON")}return errors},submit:async payload=>{actions.setIsJobModalOpen(!1);try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.create(`api/plugin_config/${props.pluginConfigId}/job`,{job:{type:props.jobName,payload}})}catch(error){return void lib_lemon_ui_lemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error(`Enqueuing job "${props.jobName}" failed`)}props.onSubmit?.(),actions.setRunJobAvailable(!1),values.runJobAvailableTimeout&&clearTimeout(values.runJobAvailableTimeout);const timeout=window.setTimeout((()=>{actions.setRunJobAvailable(!0)}),15e3);actions.setRunJobAvailableTimeout(timeout),lib_lemon_ui_lemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success("Job has been enqueued")}}}})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.events)((_ref9=>{let{values}=_ref9;return{beforeUnmount:()=>{values.runJobAvailableTimeout&&clearTimeout(values.runJobAvailableTimeout)}}}))])},"./frontend/src/scenes/plugins/plugin/PluginImage.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{c:()=>PluginImage});var icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx");const plugin_default=__webpack_require__.p+"images/plugin-default.e3e047768d82d1c3fe24fce102eaef18.svg";var react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PluginImage(_ref){let{plugin,size="medium"}=_ref;const{plugin_type:pluginType,url,icon}=plugin,[state,setState]=(0,react.useState)({image:plugin_default}),pixelSize={medium:60,large:100,small:30}[size];return(0,react.useEffect)((()=>{if(icon)setState((state=>({...state,image:icon})));else if(url?.includes("github.com")){const{user,repo,path}=(0,utils.iw)(url);setState({...state,image:`https://raw.githubusercontent.com/${user}/${repo}/${path||"main"}/logo.png`})}}),[url]),"source"===pluginType?(0,jsx_runtime.jsx)(icons.Chd,{className:"plugin-image shrink-0",style:{fontSize:pixelSize}}):(0,jsx_runtime.jsx)("div",{className:"plugin-image shrink-0",style:{width:pixelSize,height:pixelSize,backgroundImage:`url(${state.image})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"},onError:()=>setState({...state,image:plugin_default})})}try{PluginImage.displayName="PluginImage",PluginImage.__docgenInfo={description:"",displayName:"PluginImage",props:{plugin:{defaultValue:null,description:"",name:"plugin",required:!0,type:{name:'Partial<Pick<PluginType, "icon" | "url" | "plugin_type">>'}},size:{defaultValue:{value:"medium"},description:"",name:"size",required:!1,type:{name:"enum",value:[{value:'"small"'},{value:'"medium"'},{value:'"large"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/plugins/plugin/PluginImage.tsx#PluginImage"]={docgenInfo:PluginImage.__docgenInfo,name:"PluginImage",path:"frontend/src/scenes/plugins/plugin/PluginImage.tsx#PluginImage"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/plugins/plugin/PluginLogs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{b:()=>PluginLogs});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),types=__webpack_require__("./frontend/src/types.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");const pluginLogsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)((_ref=>{let{pluginConfigId}=_ref;return pluginConfigId})),(0,index_esm.path)((key=>["scenes","plugins","plugin","pluginLogsLogic",key])),(0,index_esm.connect)({values:[teamLogic.teamLogic,["currentTeamId"]]}),(0,index_esm.actions)({clearPluginLogsBackground:!0,markLogsEnd:!0,setPluginLogsTypes:typeFilters=>({typeFilters}),setSearchTerm:searchTerm=>({searchTerm})}),(0,lib.loaders)((_ref2=>{let{props:{pluginConfigId},values,actions,cache}=_ref2;return{pluginLogs:{__default:[],loadPluginLogs:async()=>{const results=await api.ZP.pluginLogs.search(pluginConfigId,values.currentTeamId,values.searchTerm,values.typeFilters);return cache.pollingInterval||(cache.pollingInterval=setInterval(actions.loadPluginLogsBackgroundPoll,2e3)),actions.clearPluginLogsBackground(),results},loadPluginLogsMore:async()=>{const results=await api.ZP.pluginLogs.search(pluginConfigId,values.currentTeamId,values.searchTerm,values.typeFilters,values.trailingEntry);return results.length<constants.F2&&actions.markLogsEnd(),[...values.pluginLogs,...results]},revealBackground:()=>{const newArray=[...values.pluginLogsBackground,...values.pluginLogs];return actions.clearPluginLogsBackground(),newArray}},pluginLogsBackground:{__default:[],loadPluginLogsBackgroundPoll:async()=>{if(values.pluginLogsLoading)return values.pluginLogsBackground;return[...await api.ZP.pluginLogs.search(pluginConfigId,values.currentTeamId,values.searchTerm,values.typeFilters,null,values.leadingEntry),...values.pluginLogsBackground]}}}})),(0,index_esm.reducers)({pluginLogsTypes:[Object.values(types.oX).filter((type=>"DEBUG"!==type)),{setPluginLogsTypes:(_,_ref3)=>{let{typeFilters}=_ref3;return typeFilters.map((tf=>tf))}}],pluginLogsBackground:[[],{clearPluginLogsBackground:()=>[]}],searchTerm:["",{setSearchTerm:(_,_ref4)=>{let{searchTerm}=_ref4;return searchTerm}}],typeFilters:[Object.values(types.oX).filter((type=>"DEBUG"!==type)),{setPluginLogsTypes:(_,_ref5)=>{let{typeFilters}=_ref5;return typeFilters||[]}}],isThereMoreToLoad:[!0,{loadPluginLogsSuccess:(_,_ref6)=>{let{pluginLogs}=_ref6;return pluginLogs.length>=constants.F2},markLogsEnd:()=>!1}]}),(0,index_esm.selectors)((_ref7=>{let{selectors}=_ref7;return{leadingEntry:[()=>[selectors.pluginLogs,selectors.pluginLogsBackground],(pluginLogs,pluginLogsBackground)=>pluginLogsBackground.length?pluginLogsBackground[0]:pluginLogs.length?pluginLogs[0]:null],trailingEntry:[()=>[selectors.pluginLogs,selectors.pluginLogsBackground],(pluginLogs,pluginLogsBackground)=>pluginLogs.length?pluginLogs[pluginLogs.length-1]:pluginLogsBackground.length?pluginLogsBackground[pluginLogsBackground.length-1]:null]}})),(0,index_esm.listeners)((_ref8=>{let{actions}=_ref8;return{setPluginLogsTypes:()=>{actions.loadPluginLogs()},setSearchTerm:async(_ref9,breakpoint)=>{let{searchTerm}=_ref9;searchTerm&&await breakpoint(1e3),actions.loadPluginLogs()}}})),(0,index_esm.events)((_ref10=>{let{actions,cache}=_ref10;return{afterMount:()=>{actions.loadPluginLogs()},beforeUnmount:()=>{clearInterval(cache.pollingInterval)}}}))]);var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");const columns=[{title:"Timestamp",key:"timestamp",dataIndex:"timestamp",render:timestamp=>(0,dayjs.Bv)(timestamp).format("YYYY-MM-DD HH:mm:ss.SSS UTC")},{title:"Source",dataIndex:"source",key:"source"},{title:"Type",key:"type",dataIndex:"type",render:function PluginLogEntryTypeDisplay(type){let color;switch(type){case types.oX.Debug:color="text-muted";break;case types.oX.Log:color="text-default";break;case types.oX.Info:color="text-primary";break;case types.oX.Warn:color="text-warning";break;case types.oX.Error:color="text-danger"}return(0,jsx_runtime.jsx)("span",{className:color,children:type})}},{title:"Message",key:"message",dataIndex:"message",render:message=>(0,jsx_runtime.jsx)("code",{className:"whitespace-pre-wrap",children:message})}];function PluginLogs(_ref){let{pluginConfigId}=_ref;const logic=pluginLogsLogic({pluginConfigId}),{pluginLogs,pluginLogsLoading,pluginLogsBackground,isThereMoreToLoad,pluginLogsTypes}=(0,index_esm.useValues)(logic),{revealBackground,loadPluginLogsMore,setPluginLogsTypes,setSearchTerm}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"ph-no-capture space-y-2 flex-1",children:[(0,jsx_runtime.jsx)(src.LemonInput,{type:"search",placeholder:"Search for messages containingâ€¦",fullWidth:!0,onChange:setSearchTerm,allowClear:!0}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4",children:[(0,jsx_runtime.jsx)("span",{children:"Show logs of type:Â "}),Object.values(types.oX).map((type=>(0,jsx_runtime.jsx)(src.LemonCheckbox,{label:type,checked:pluginLogsTypes.includes(type),onChange:checked=>{const newPluginLogsTypes=checked?[...pluginLogsTypes,type]:pluginLogsTypes.filter((t=>t!=type));setPluginLogsTypes(newPluginLogsTypes)}},type)))]}),(0,jsx_runtime.jsx)(src.LemonButton,{onClick:revealBackground,loading:pluginLogsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:pluginLogsBackground.length?void 0:"There's nothing to load",children:pluginLogsBackground.length?`Load ${(0,utils._6)(pluginLogsBackground.length,"newer entry","newer entries")}`:"No new entries"}),(0,jsx_runtime.jsx)(src.LemonTable,{dataSource:pluginLogs,columns,loading:pluginLogsLoading,size:"small",className:"ph-no-capture",rowKey:"id",pagination:{pageSize:200,hideOnSinglePage:!0}}),!!pluginLogs.length&&(0,jsx_runtime.jsx)(src.LemonButton,{onClick:loadPluginLogsMore,loading:pluginLogsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:isThereMoreToLoad?void 0:"There's nothing mote to load",children:isThereMoreToLoad?`Load up to ${constants.F2} older entries`:"No older entries"})]})}try{PluginLogs.displayName="PluginLogs",PluginLogs.__docgenInfo={description:"",displayName:"PluginLogs",props:{pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/plugins/plugin/PluginLogs.tsx#PluginLogs"]={docgenInfo:PluginLogs.__docgenInfo,name:"PluginLogs",path:"frontend/src/scenes/plugins/plugin/PluginLogs.tsx#PluginLogs"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/plugins/tabs/apps/components.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Gs:()=>BatchExportsAlternativeWarning,WZ:()=>PluginTags});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_constants__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/constants.tsx"),lib_lemon_ui_LemonBanner__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),lib_utils_copyToClipboard__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/utils/copyToClipboard.tsx"),scenes_organizationLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/organizationLogic.tsx"),scenes_plugins_pluginsLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/plugins/pluginsLogic.ts"),scenes_plugins_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/plugins/types.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/urls.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function RepositoryTag(_ref){let{plugin}=_ref;const{pluginUrlToMaintainer}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(scenes_plugins_pluginsLogic__WEBPACK_IMPORTED_MODULE_7__.C),pluginMaintainer=plugin.maintainer||pluginUrlToMaintainer[plugin.url||""],isOfficial="official"===pluginMaintainer;if("plugin_type"in plugin){if("source"===plugin.plugin_type)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTag,{children:"Source code"});if("local"===plugin.plugin_type&&plugin.url)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTag,{type:"completion",onClick:()=>{(0,lib_utils_copyToClipboard__WEBPACK_IMPORTED_MODULE_5__.v)(plugin.url?.substring(5)||"")},children:"Installed Locally"})}return pluginMaintainer?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_4__.u,{title:isOfficial?"This app was built by the PostHog team.":"This app was built by a community member, not the PostHog team.",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTag,{type:isOfficial?"primary":"highlight",children:isOfficial?"Official":"Community"})}):null}function PluginTags(_ref2){let{plugin}=_ref2;const{currentOrganization}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(scenes_organizationLogic__WEBPACK_IMPORTED_MODULE_6__.p);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(RepositoryTag,{plugin}),"is_global"in plugin&&plugin.is_global&&!!currentOrganization&&currentOrganization.plugins_access_level>=lib_constants__WEBPACK_IMPORTED_MODULE_2__.zB.Install&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_4__.u,{title:`This plugin is managed by the ${plugin.organization_name} organization`,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTag,{type:"success",children:"Global"})})]})}function BatchExportsAlternativeWarning(){const{searchTerm}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(scenes_plugins_pluginsLogic__WEBPACK_IMPORTED_MODULE_7__.C);return searchTerm&&["export","batch","s3","snowflake","redshift","bigquery"].includes(searchTerm?.toLowerCase())?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(lib_lemon_ui_LemonBanner__WEBPACK_IMPORTED_MODULE_3__.V,{type:"warning",children:["It looks like you're trying to search for an exporter. There is now a dedicated"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Link,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_9__.j.projectApps(scenes_plugins_types__WEBPACK_IMPORTED_MODULE_8__.xb.BatchExports),children:"Batch Exports"})," area for these."]}):null}try{RepositoryTag.displayName="RepositoryTag",RepositoryTag.__docgenInfo={description:"",displayName:"RepositoryTag",props:{plugin:{defaultValue:null,description:"",name:"plugin",required:!0,type:{name:"PluginType | PluginRepositoryEntry"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/plugins/tabs/apps/components.tsx#RepositoryTag"]={docgenInfo:RepositoryTag.__docgenInfo,name:"RepositoryTag",path:"frontend/src/scenes/plugins/tabs/apps/components.tsx#RepositoryTag"})}catch(__react_docgen_typescript_loader_error){}try{PluginTags.displayName="PluginTags",PluginTags.__docgenInfo={description:"",displayName:"PluginTags",props:{plugin:{defaultValue:null,description:"",name:"plugin",required:!0,type:{name:"PluginType | PluginRepositoryEntry"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/plugins/tabs/apps/components.tsx#PluginTags"]={docgenInfo:PluginTags.__docgenInfo,name:"PluginTags",path:"frontend/src/scenes/plugins/tabs/apps/components.tsx#PluginTags"})}catch(__react_docgen_typescript_loader_error){}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/apps/AppMetricsGraph.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".AppMetricsGraph{height:300px}",""]),module.exports=exports}}]);