"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[43962],{"../../frontend/src/scenes/actions/NewActionButton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{O:()=>NewActionButton});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.22.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_components_AuthorizedUrlList_AuthorizedUrlList__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),lib_components_AuthorizedUrlList_authorizedUrlListLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),react__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/urls.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function NewActionButton(_ref){let{onSelectOption}=_ref,[visible,setVisible]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(!1),[appUrlsVisible,setAppUrlsVisible]=(0,react__WEBPACK_IMPORTED_MODULE_6__.useState)(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"primary",onClick:()=>setVisible(!0),"data-attr":"create-action",children:"New action"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.fQ,{isOpen:visible,onClose:()=>{setVisible(!1),setAppUrlsVisible(!1)},title:"Create new action",footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.Fragment,{children:[appUrlsVisible&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"secondary",onClick:()=>setAppUrlsVisible(!1),children:"Back"},"back-button"),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"secondary",onClick:()=>{setVisible(!1),setAppUrlsVisible(!1)},children:"Cancel"},"cancel-button")]}),children:appUrlsVisible?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("div",{className:"max-w-160",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_components_AuthorizedUrlList_AuthorizedUrlList__WEBPACK_IMPORTED_MODULE_3__.t,{type:lib_components_AuthorizedUrlList_authorizedUrlListLogic__WEBPACK_IMPORTED_MODULE_4__.uw.TOOLBAR_URLS})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconSearch,{}),onClick:()=>setAppUrlsVisible(!0),size:"large",fullWidth:!0,center:!0,"data-attr":"new-action-inspect",children:"Inspect element on your site"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.J,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconPencil,{}),onClick:()=>{onSelectOption?.(),kea_router__WEBPACK_IMPORTED_MODULE_2__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.createAction())},size:"large",fullWidth:!0,center:!0,"data-attr":"new-action-pageview",children:"From event or pageview"})]})})]})}},"../../frontend/src/scenes/web-analytics/pageReportsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{z:()=>pageReportsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),_queries_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/queries/utils.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/web-analytics/webAnalyticsLogic.tsx");function createUrlPropertyFilter(url,stripQueryParams){return{key:"$current_url",value:stripQueryParams?`^${url.split("?")[0]}(\\?.*)?$`:url,operator:stripQueryParams?_types__WEBPACK_IMPORTED_MODULE_5__.WV.Regex:_types__WEBPACK_IMPORTED_MODULE_5__.WV.Exact,type:_types__WEBPACK_IMPORTED_MODULE_5__.FT.Event}}let pageReportsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)({path:["scenes","web-analytics","pageReportsLogic"],connect:{values:[_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.WG,["tiles as webAnalyticsTiles","shouldFilterTestAccounts","dateFilter"]],actions:[_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.WG,["setDates"]]},actions:()=>({setPageUrl:url=>({url}),setPageUrlSearchTerm:searchTerm=>({searchTerm}),loadPages:function(){let searchTerm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{searchTerm}},toggleStripQueryParams:()=>({}),setTileVisualization:(tileId,visualization)=>({tileId,visualization})}),reducers:()=>({pageUrl:[null,{persist:!0},{setPageUrl:(_state,_ref)=>{let{url}=_ref;return Array.isArray(url)?url.length>0?url[0]:null:url}}],pageUrlSearchTerm:["",{setPageUrlSearchTerm:(_state,_ref2)=>{let{searchTerm}=_ref2;return searchTerm}}],isInitialLoad:[!0,{loadPagesSuccess:()=>!1}],stripQueryParams:[!0,{persist:!0},{toggleStripQueryParams:state=>!state}],tileVisualizations:[{},{persist:!0},{setTileVisualization:(state,_ref3)=>{let{tileId,visualization}=_ref3;return{...state,[tileId]:visualization}}}]}),loaders:_ref4=>{let{values}=_ref4;return{pagesUrls:[[],{loadPagesUrls:async _ref5=>{let{searchTerm}=_ref5;try{return(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.query((0,_queries_utils__WEBPACK_IMPORTED_MODULE_4__.xg)({kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.WebPageURLSearchQuery,searchTerm:searchTerm,stripQueryParams:values.stripQueryParams,dateRange:{date_from:values.dateFilter.dateFrom,date_to:values.dateFilter.dateTo},properties:[]}))).results}catch(error){return console.error("Error loading pages:",error),[]}}}]}},selectors:{hasPageUrl:[selectors=>[selectors.pageUrl],pageUrl=>!!pageUrl],isLoading:[selectors=>[selectors.pagesUrlsLoading,selectors.isInitialLoad],(pagesUrlsLoading,isInitialLoad)=>pagesUrlsLoading||isInitialLoad],queries:[s=>[s.webAnalyticsTiles,s.pageUrl,s.stripQueryParams,s.dateFilter,s.shouldFilterTestAccounts],(webAnalyticsTiles,pageUrl,stripQueryParams,dateFilter,shouldFilterTestAccounts)=>{if(!pageUrl)return{entryPathsQuery:void 0,exitPathsQuery:void 0,outboundClicksQuery:void 0,channelsQuery:void 0,referrersQuery:void 0,deviceTypeQuery:void 0,browserQuery:void 0,osQuery:void 0,countriesQuery:void 0,regionsQuery:void 0,citiesQuery:void 0,timezonesQuery:void 0,languagesQuery:void 0,topEventsQuery:void 0};let getQuery=(tileId,tabId)=>{let tile=webAnalyticsTiles?.find(t=>t.tileId===tileId),query=tile?.tabs.find(tab=>tab.id===tabId)?.query;if(query&&"source"in query&&query.source){let modifiedQuery=JSON.parse(JSON.stringify(query));return modifiedQuery.source.properties&&(modifiedQuery.source.properties=[createUrlPropertyFilter(pageUrl,stripQueryParams)]),modifiedQuery}return query};return{entryPathsQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PATHS,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.wT.INITIAL_PATH),exitPathsQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PATHS,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.wT.END_PATH),outboundClicksQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PATHS,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.wT.EXIT_CLICK),channelsQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.SOURCES,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.VL.CHANNEL),referrersQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.SOURCES,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.VL.REFERRING_DOMAIN),deviceTypeQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.DEVICES,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.tL.DEVICE_TYPE),browserQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.DEVICES,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.tL.BROWSER),osQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.DEVICES,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.tL.OS),countriesQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.QX.COUNTRIES),regionsQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.QX.REGIONS),citiesQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.QX.CITIES),timezonesQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.QX.TIMEZONES),languagesQuery:getQuery(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.GEOGRAPHY,_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.QX.LANGUAGES),topEventsQuery:{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.InsightVizNode,source:{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.TrendsQuery,series:[{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.EventsNode,event:null,name:"All events",math:_types__WEBPACK_IMPORTED_MODULE_5__.vN.TotalCount}],trendsFilter:{},breakdownFilter:{breakdowns:[{property:"event",type:"event_metadata"}]},properties:[...pageUrl?[createUrlPropertyFilter(pageUrl,stripQueryParams)]:[],{key:"event",value:["$pageview","$pageleave"],operator:_types__WEBPACK_IMPORTED_MODULE_5__.WV.IsNot,type:_types__WEBPACK_IMPORTED_MODULE_5__.FT.EventMetadata}],filterTestAccounts:shouldFilterTestAccounts,dateRange:{date_from:dateFilter.dateFrom,date_to:dateFilter.dateTo},tags:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.Zt},embedded:!0,hidePersonsModal:!0}}}],createInsightProps:[()=>[],()=>(tileId,tabId)=>({dashboardItemId:`new-${tileId}${tabId?`-${tabId}`:""}`,loadPriority:0,dataNodeCollectionId:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.p2})],combinedMetricsQuery:[s=>[s.pageUrl,s.stripQueryParams,s.shouldFilterTestAccounts],(pageUrl,stripQueryParams,shouldFilterTestAccounts)=>dateFilter=>({kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.InsightVizNode,source:{kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.TrendsQuery,series:[{event:"$pageview",kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.EventsNode,math:_types__WEBPACK_IMPORTED_MODULE_5__.vN.UniqueUsers,name:"$pageview",custom_name:"Unique visitors"},{event:"$pageview",kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.EventsNode,math:_types__WEBPACK_IMPORTED_MODULE_5__.vN.TotalCount,name:"$pageview",custom_name:"Page views"},{event:"$pageview",kind:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_3__.OH.EventsNode,math:_types__WEBPACK_IMPORTED_MODULE_5__.vN.UniqueSessions,name:"$pageview",custom_name:"Sessions"}],interval:dateFilter.interval,dateRange:{date_from:dateFilter.dateFrom,date_to:dateFilter.dateTo},trendsFilter:{display:_types__WEBPACK_IMPORTED_MODULE_5__.Qb.ActionsLineGraph,showLegend:!0},filterTestAccounts:shouldFilterTestAccounts,properties:pageUrl?[createUrlPropertyFilter(pageUrl,stripQueryParams)]:[],tags:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.Zt},hidePersonsModal:!0,embedded:!0})],tiles:[s=>[s.queries,s.pageUrl,s.createInsightProps,s.combinedMetricsQuery,s.dateFilter],(queries,pageUrl,createInsightProps,combinedMetricsQuery,dateFilter)=>{if(!pageUrl)return[];let createQueryTile=(tileId,title,description,query,layout)=>query?{kind:"query",tileId,title,query,showIntervalSelect:!1,insightProps:createInsightProps(tileId),layout:null!=layout?layout:{className:"flex flex-col h-full min-h-[400px]"},docs:{title,description},canOpenModal:!0}:null;return[{kind:"section",tileId:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_COMBINED_METRICS_CHART,tiles:[{kind:"query",tileId:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_COMBINED_METRICS_CHART,title:"Trends over time",query:combinedMetricsQuery(dateFilter),showIntervalSelect:!0,insightProps:createInsightProps(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_COMBINED_METRICS_CHART,"combined"),layout:{className:"w-full min-h-[350px]"},docs:{title:"Trends over time",description:"Key metrics for this page over time"}}],layout:{className:"w-full"}},{kind:"section",tileId:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_PATHS_SECTION,layout:{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},tiles:[createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_ENTRY_PATHS,"Entry Paths","How users arrive at this page",queries.entryPathsQuery,{className:"flex flex-col h-full min-h-[400px]"}),createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_EXIT_PATHS,"Exit Paths","Where users go after viewing this page",queries.exitPathsQuery,{className:"flex flex-col h-full min-h-[400px]"}),createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_OUTBOUND_CLICKS,"Outbound Clicks","External links users click on this page",queries.outboundClicksQuery)].filter(Boolean)},{kind:"section",tileId:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_TRAFFIC_SECTION,layout:{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"},tiles:[createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_CHANNELS,"Channels","Marketing channels bringing users to this page",queries.channelsQuery),createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_REFERRERS,"Referrers","Websites referring traffic to this page",queries.referrersQuery)].filter(Boolean)},{kind:"section",tileId:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_DEVICE_INFORMATION_SECTION,layout:{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},tiles:[createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_DEVICE_TYPES,"Device Types","Types of devices used to access this page",queries.deviceTypeQuery),createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_BROWSERS,"Browsers","Browsers used to access this page",queries.browserQuery),createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_OPERATING_SYSTEMS,"Operating Systems","Operating systems used to access this page",queries.osQuery)].filter(Boolean)},{kind:"section",tileId:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_GEOGRAPHY_SECTION,layout:{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},tiles:[createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_COUNTRIES,"Countries","Countries where users access this page from",queries.countriesQuery),createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_REGIONS,"Regions","Regions where users access this page from",queries.regionsQuery),createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_CITIES,"Cities","Cities where users access this page from",queries.citiesQuery),createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_TIMEZONES,"Timezones","Timezones where users access this page from",queries.timezonesQuery),createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_LANGUAGES,"Languages","Languages of users accessing this page",queries.languagesQuery)].filter(Boolean)},{kind:"section",tileId:_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_TOP_EVENTS_SECTION,title:"",layout:{className:"grid-cols-1 gap-2"},tiles:[createQueryTile(_webAnalyticsLogic__WEBPACK_IMPORTED_MODULE_6__.nM.PAGE_REPORTS_TOP_EVENTS,"Top Events","Most common events triggered by users on this page, broken down by event type",queries.topEventsQuery,{className:"w-full min-h-[300px]"})].filter(Boolean)}]}]},listeners:_ref6=>{let{actions,values}=_ref6;return{setPageUrlSearchTerm:_ref7=>{let{searchTerm}=_ref7;actions.loadPages(searchTerm)},setPageUrl:_ref8=>{let{url}=_ref8;kea_router__WEBPACK_IMPORTED_MODULE_1__.router.actions.replace("/web/page-reports",url?{pageURL:url}:{},kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.hashParams)},toggleStripQueryParams:()=>{actions.loadPages(values.pageUrlSearchTerm)},loadPages:_ref9=>{let{searchTerm}=_ref9;actions.loadPagesUrls({searchTerm})}}},afterMount:_ref10=>{let{actions}=_ref10;actions.loadPages("")},urlToAction:_ref11=>{let{actions,values}=_ref11;return{"/web/page-reports":(_,searchParams)=>{searchParams.pageURL&&searchParams.pageURL!==values.pageUrl&&actions.setPageUrl(searchParams.pageURL),"stripQueryParams"in searchParams&&!!searchParams.stripQueryParams!==values.stripQueryParams&&actions.toggleStripQueryParams()}}},actionToUrl:_ref12=>{let{values}=_ref12;return{setPageUrl:()=>{let searchParams={...kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.searchParams};return values.pageUrl?searchParams.pageURL=values.pageUrl:delete searchParams.pageURL,!!kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.searchParams.stripQueryParams!==values.stripQueryParams&&(searchParams.stripQueryParams=values.stripQueryParams),["/web/page-reports",searchParams,kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.hashParams,{replace:!0}]},toggleStripQueryParams:()=>{let searchParams={...kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.searchParams};return searchParams.stripQueryParams=values.stripQueryParams,["/web/page-reports",searchParams,kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.hashParams,{replace:!0}]}}}})},"../../frontend/src/scenes/web-analytics/tiles/WebAnalyticsTile.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{bP:()=>WebQuery,FM:()=>webAnalyticsDataTableQueryContext});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.22.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),colors=__webpack_require__("../../frontend/src/lib/colors.ts"),IntervalFilter=__webpack_require__("../../frontend/src/lib/components/IntervalFilter/index.ts"),PathCleanFilterItem=__webpack_require__("../../frontend/src/lib/components/PathCleanFilters/PathCleanFilterItem.tsx"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),PropertyIcon=__webpack_require__("../../frontend/src/lib/components/PropertyIcon/PropertyIcon.tsx"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonSwitch=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSwitch/index.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),country=__webpack_require__("../../frontend/src/lib/utils/geography/country.ts"),product_intents=__webpack_require__("../../frontend/src/lib/utils/product-intents.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),NewActionButton=__webpack_require__("../../frontend/src/scenes/actions/NewActionButton.tsx"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),webAnalyticsLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/webAnalyticsLogic.tsx"),actionsModel=__webpack_require__("../../frontend/src/models/actionsModel.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),types=__webpack_require__("../../frontend/src/types.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ErrorTrackingButton=_ref=>{let{breakdownBy,value}=_ref;return(breakdownBy===schema_general.GI.FrustrationMetrics||breakdownBy===schema_general.GI.Page)&&value&&""!==value?(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.errorTracking({filterGroup:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:"$current_url",value:[value],operator:types.WV.Exact,type:types.FT.Event}]}]}}),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{}),type:"tertiary",size:"xsmall",tooltip:"View errors for this page",className:"no-underline",targetBlank:!0,onClick:e=>{e.stopPropagation(),(0,product_intents.uX)({from:types.Md.WEB_ANALYTICS,to:types.Md.ERROR_TRACKING,intent_context:product_intents.kp.WEB_ANALYTICS_FRUSTRATING_PAGES})}}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})};var authorizedUrlListLogic=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts");let VALID_BREAKDOWN_VALUES=new Set([schema_general.GI.Page,schema_general.GI.InitialPage,schema_general.GI.ExitPage,schema_general.GI.ExitClick,schema_general.GI.FrustrationMetrics]),HeatmapButton=_ref=>{let{breakdownBy,value}=_ref,{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{domainFilter:webAnalyticsSelectedDomain}=(0,index_esm.useValues)(webAnalyticsLogic.WG);if(""===value||!VALID_BREAKDOWN_VALUES.has(breakdownBy))return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});if(!webAnalyticsSelectedDomain||"all"===webAnalyticsSelectedDomain)return(0,jsx_runtime.jsx)(src.Jp,{disabledReason:"Select a domain to view heatmaps",icon:(0,jsx_runtime.jsx)(icons.X,{}),type:"tertiary",size:"xsmall",tooltip:"View heatmap for this page",className:"no-underline"});let domain=webAnalyticsSelectedDomain.endsWith("/")?webAnalyticsSelectedDomain.slice(0,-1):webAnalyticsSelectedDomain,path=value.startsWith("/")?value.slice(1):value,url=`${domain}/${path}`,to=featureFlags[constants.y8.HEATMAPS_UI]?urls.j.heatmaps(`pageURL=${url}`):(0,authorizedUrlListLogic.Kc)(url,{userIntent:"heatmaps"});return(0,jsx_runtime.jsx)(src.Jp,{to:to,icon:(0,jsx_runtime.jsx)(icons.X,{}),type:"tertiary",size:"xsmall",tooltip:"View heatmap for this page",className:"no-underline",targetBlank:!0,onClick:e=>{e.stopPropagation(),(0,product_intents.uX)({from:types.Md.WEB_ANALYTICS,to:types.Md.HEATMAPS,intent_context:product_intents.kp.WEB_ANALYTICS_INSIGHT})}})},BREAKDOWN_TYPE_MAP={[schema_general.GI.DeviceType]:types.FT.Person,[schema_general.GI.InitialPage]:types.FT.Session,[schema_general.GI.ExitPage]:types.FT.Session,[schema_general.GI.Page]:types.FT.Event,[schema_general.GI.Browser]:types.FT.Person,[schema_general.GI.OS]:types.FT.Person,[schema_general.GI.InitialChannelType]:types.FT.Session,[schema_general.GI.InitialReferringDomain]:types.FT.Session,[schema_general.GI.InitialUTMSource]:types.FT.Session,[schema_general.GI.InitialUTMCampaign]:types.FT.Session,[schema_general.GI.InitialUTMMedium]:types.FT.Session,[schema_general.GI.InitialUTMContent]:types.FT.Session,[schema_general.GI.InitialUTMTerm]:types.FT.Session,[schema_general.GI.FrustrationMetrics]:types.FT.Event},BREAKDOWN_KEY_MAP={[schema_general.GI.DeviceType]:"$device_type",[schema_general.GI.InitialPage]:"$entry_pathname",[schema_general.GI.ExitPage]:"$end_pathname",[schema_general.GI.Page]:"$pathname",[schema_general.GI.Browser]:"$browser",[schema_general.GI.OS]:"$os",[schema_general.GI.InitialChannelType]:"$channel_type",[schema_general.GI.InitialReferringDomain]:"$entry_referring_domain",[schema_general.GI.InitialUTMSource]:"$entry_utm_source",[schema_general.GI.InitialUTMCampaign]:"$entry_utm_campaign",[schema_general.GI.InitialUTMMedium]:"$entry_utm_medium",[schema_general.GI.InitialUTMContent]:"$entry_utm_content",[schema_general.GI.InitialUTMTerm]:"$entry_utm_term",[schema_general.GI.FrustrationMetrics]:"$pathname"},ReplayButton=_ref=>{let{date_from,date_to,breakdownBy,value}=_ref,sharedButtonProps={icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconRewindPlay,{}),type:"tertiary",size:"xsmall",tooltip:"View recordings",className:"no-underline",targetBlank:!0,onClick:e=>{e.stopPropagation(),(0,product_intents.uX)({from:types.Md.WEB_ANALYTICS,to:types.Md.SESSION_REPLAY,intent_context:product_intents.kp.WEB_ANALYTICS_INSIGHT})}};if(""===value)return(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from,date_to})});if(breakdownBy===schema_general.GI.Viewport)return(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from:date_from,date_to:date_to,filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:"$viewport_width",type:types.FT.Event,value:[value[0]],operator:types.WV.Exact},{key:"$viewport_height",type:types.FT.Event,value:[value[1]],operator:types.WV.Exact}]}]}})});if(breakdownBy===schema_general.GI.InitialUTMSourceMediumCampaign){let values=value.split(" / ");return(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from:date_from,date_to:date_to,filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:"$entry_utm_source",type:types.FT.Session,value:[values[0]||""],operator:types.WV.Exact},{key:"$entry_utm_medium",type:types.FT.Session,value:[values[1]||""],operator:types.WV.Exact},{key:"$entry_utm_campaign",type:types.FT.Session,value:[values[2]||""],operator:types.WV.Exact}]}]}})})}let type=BREAKDOWN_TYPE_MAP[breakdownBy]||types.FT.Person,key=BREAKDOWN_KEY_MAP[breakdownBy];return key&&type?(0,jsx_runtime.jsx)(src.Jp,{...sharedButtonProps,to:urls.j.replay(types.yd.Home,{date_from:date_from,date_to:date_to,filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{key:key,type:type,value:[value],operator:types.WV.Exact}]}]}})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})};var pageReportsLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/pageReportsLogic.ts"),marketingAnalyticsLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/logic/marketingAnalyticsLogic.ts"),logic_utils=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/logic/utils.ts"),ConversionGoalDropdown=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/components/common/ConversionGoalDropdown.tsx"),settings_constants=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/components/settings/constants.ts"),marketingAnalyticsSettingsLogic=__webpack_require__("../../frontend/src/scenes/web-analytics/tabs/marketing-analytics/frontend/logic/marketingAnalyticsSettingsLogic.ts");let DynamicConversionGoalControls=()=>{let{setDynamicConversionGoal,clearDynamicConversionGoal}=(0,index_esm.useActions)(marketingAnalyticsLogic.O),{dynamicConversionGoal}=(0,index_esm.useValues)(marketingAnalyticsLogic.O),{addOrUpdateConversionGoal}=(0,index_esm.useActions)(marketingAnalyticsSettingsLogic.E),{conversion_goals}=(0,index_esm.useValues)(marketingAnalyticsSettingsLogic.E),conversionGoalIdRef=(0,react.useRef)();conversionGoalIdRef.current||(conversionGoalIdRef.current=(0,utils.Vj)());let[localConversionGoal,setLocalConversionGoal]=(0,react.useState)({...settings_constants.d,conversion_goal_id:conversionGoalIdRef.current,conversion_goal_name:""}),[localConversionGoalName,setLocalConversionGoalName]=(0,react.useState)(""),[isExpanded,setIsExpanded]=(0,react.useState)(!1),handleConversionGoalChange=(0,react.useCallback)(filter=>{setLocalConversionGoal({...filter,conversion_goal_name:localConversionGoalName||filter.custom_name||filter.name||"No name"})},[localConversionGoalName]),handleApplyConversionGoal=(0,react.useCallback)(()=>{setDynamicConversionGoal(localConversionGoal)},[localConversionGoal,setDynamicConversionGoal]),handleSaveConversionGoal=(0,react.useCallback)(()=>{addOrUpdateConversionGoal(localConversionGoal)},[localConversionGoal,addOrUpdateConversionGoal]),handleClearConversionGoal=(0,react.useCallback)(()=>{conversionGoalIdRef.current=(0,utils.Vj)(),setLocalConversionGoal({...settings_constants.d,conversion_goal_id:conversionGoalIdRef.current,conversion_goal_name:""}),clearDynamicConversionGoal()},[clearDynamicConversionGoal]),hasEvent=localConversionGoal.name!==settings_constants.d.name,hasChanges=!(0,utils.h0)(localConversionGoal,dynamicConversionGoal)&&hasEvent,canSave=!conversion_goals.some(goal=>goal.conversion_goal_id===localConversionGoal.conversion_goal_id)&&hasEvent,hasActiveGoal=!!dynamicConversionGoal;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsx)(LemonButton.J,{type:"tertiary",size:"small",icon:isExpanded?(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronDown,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronRight,{}),onClick:()=>setIsExpanded(!isExpanded),className:"justify-start",children:"Explore conversion goals"}),isExpanded&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 w-full",children:[(0,jsx_runtime.jsx)(src.DF,{className:"w-full",value:localConversionGoalName,onChange:value=>setLocalConversionGoalName(value),placeholder:"e.g., Purchase, Sign Up, Download"}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",size:"small",onClick:handleApplyConversionGoal,disabledReason:hasChanges?void 0:"No changes to apply",children:"Apply"}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",onClick:handleClearConversionGoal,disabledReason:hasActiveGoal?void 0:"No active goal to clear",children:"Clear"}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",size:"small",onClick:handleSaveConversionGoal,disabledReason:canSave?void 0:"Goal already exists",children:"Save"})]})}),(0,jsx_runtime.jsx)(ConversionGoalDropdown.T,{value:localConversionGoal||settings_constants.d,onChange:handleConversionGoalChange,typeKey:"dynamic-conversion-goal"})]})]})},MarketingAnalyticsTable=_ref=>{let{query,insightProps}=_ref,{setMarketingAnalyticsOrderBy,clearMarketingAnalyticsOrderBy}=(0,index_esm.useActions)(marketingAnalyticsLogic.O),{marketingAnalyticsOrderBy,conversion_goals,dynamicConversionGoal}=(0,index_esm.useValues)(marketingAnalyticsLogic.O),queryWithOrderBy=(0,react.useMemo)(()=>{if(query.source.kind!==schema_general.OH.MarketingAnalyticsTableQuery)return query;let source={...query.source,orderBy:marketingAnalyticsOrderBy?[`${marketingAnalyticsOrderBy[0]} ${marketingAnalyticsOrderBy[1]}`]:void 0};return{...query,source}},[query,marketingAnalyticsOrderBy]),allConversionGoals=(0,react.useMemo)(()=>{let goals=[];return dynamicConversionGoal&&goals.push(dynamicConversionGoal),conversion_goals&&goals.push(...conversion_goals),goals},[conversion_goals,dynamicConversionGoal]),MarketingSortableCell=(0,react.useCallback)((name,orderByField)=>function MarketingSortableCell(){let isSortedByMyField=marketingAnalyticsOrderBy?.[0]===orderByField,isAscending=marketingAnalyticsOrderBy?.[1]==="ASC",isDescending=marketingAnalyticsOrderBy?.[1]==="DESC",onClick=(0,react.useCallback)(()=>{isSortedByMyField?isDescending?setMarketingAnalyticsOrderBy(orderByField,"ASC"):isAscending&&clearMarketingAnalyticsOrderBy():setMarketingAnalyticsOrderBy(orderByField,"DESC")},[isSortedByMyField,isAscending,isDescending]);return(0,jsx_runtime.jsxs)("span",{onClick:onClick,className:"group cursor-pointer inline-flex items-center",children:[name,(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronDown,{fontSize:"20px",className:(0,clsx_m.default)("-mr-1 ml-1 text-muted-alt opacity-0 group-hover:opacity-100",{"text-primary opacity-100":isSortedByMyField,"rotate-180":isSortedByMyField&&isAscending})})]})},[marketingAnalyticsOrderBy,setMarketingAnalyticsOrderBy,clearMarketingAnalyticsOrderBy]),conversionGoalColumns=(0,react.useMemo)(()=>{let columns={};return allConversionGoals?.forEach((goal,index)=>{let goalName=goal.conversion_goal_name||`Goal ${index+1}`,costPerGoalName=`Cost per ${goalName}`;columns[goalName]={renderTitle:MarketingSortableCell(goalName,`${logic_utils.OT}${index}.${logic_utils.g7}${index}`),render:_ref2=>{let{value}=_ref2;return value||"-"},align:"right"},columns[costPerGoalName]={renderTitle:MarketingSortableCell(costPerGoalName,`${logic_utils.li}.${logic_utils.mj} / nullif(${logic_utils.OT}${index}.${logic_utils.g7}${index}, 0)`),render:_ref3=>{let{value}=_ref3;return value&&"number"==typeof value?`$${value.toFixed(2)}`:"-"},align:"right"}}),columns},[allConversionGoals,MarketingSortableCell]),marketingAnalyticsContext={...webAnalyticsDataTableQueryContext,insightProps,columns:{...webAnalyticsDataTableQueryContext.columns,Campaign:{renderTitle:MarketingSortableCell("Campaign",`${logic_utils.li}.${logic_utils.we}`)},Source:{renderTitle:MarketingSortableCell("Source",`${logic_utils.li}.${logic_utils.zG}`)},"Total Cost":{renderTitle:MarketingSortableCell("Total Cost",`${logic_utils.li}.${logic_utils.mj}`),render:webAnalyticsDataTableQueryContext.columns?.cost?.render,align:"right"},"Total Clicks":{renderTitle:MarketingSortableCell("Total Clicks",`${logic_utils.li}.${logic_utils.r0}`),render:webAnalyticsDataTableQueryContext.columns?.clicks?.render,align:"right"},"Total Impressions":{renderTitle:MarketingSortableCell("Total Impressions",`${logic_utils.li}.${logic_utils.qz}`),render:webAnalyticsDataTableQueryContext.columns?.impressions?.render,align:"right"},"Cost per Click":{renderTitle:MarketingSortableCell("Cost per Click",`${logic_utils.li}.${logic_utils.mj} / nullif(${logic_utils.li}.${logic_utils.r0}, 0)`),render:webAnalyticsDataTableQueryContext.columns?.cpc?.render,align:"right"},CTR:{renderTitle:MarketingSortableCell("CTR",`${logic_utils.li}.${logic_utils.r0} / nullif(${logic_utils.li}.${logic_utils.qz}, 0) * 100`),render:webAnalyticsDataTableQueryContext.columns?.ctr?.render,align:"right"},...conversionGoalColumns}};return(0,jsx_runtime.jsxs)("div",{className:"bg-surface-primary",children:[(0,jsx_runtime.jsx)("div",{className:"p-4 border-b border-border bg-bg-light",children:(0,jsx_runtime.jsx)(DynamicConversionGoalControls,{})}),(0,jsx_runtime.jsx)(Query.A,{query:queryWithOrderBy,readOnly:!1,context:marketingAnalyticsContext})]})},toUtcOffsetFormat=value=>{if(0===value)return"UTC";let integerPart=Math.abs(Math.trunc(value)),decimalPartAsMinutes=60*(Math.abs(value)-integerPart),formattedMinutes=decimalPartAsMinutes>0?`:${decimalPartAsMinutes}`:"";return`UTC${value>0?"+":"-"}${integerPart}${formattedMinutes}`},VariationCell=function(){let{isPercentage,reverseColors}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isPercentage:!1,reverseColors:!1},formatNumber=value=>{var _value$toLocaleString;return isPercentage?`${(100*value).toFixed(1)}%`:null!==(_value$toLocaleString=value?.toLocaleString())&&void 0!==_value$toLocaleString?_value$toLocaleString:"(empty)"};return function Cell(_ref){let{value}=_ref,{compareFilter}=(0,index_esm.useValues)(webAnalyticsLogic.WG);if(!value)return null;if(!Array.isArray(value))return(0,jsx_runtime.jsx)("span",{children:String(value)});let[current,previous]=value,pctChangeFromPrevious=0===previous&&0===current?0:null!==current&&compareFilter&&!1!==compareFilter.compare?null===previous||0===previous?1/0:current/previous-1:null,trend=null===pctChangeFromPrevious?null:0===pctChangeFromPrevious?{Icon:icons.cs,color:(0,colors.cM)("muted")}:pctChangeFromPrevious>0?{Icon:posthog_icons_es.IconTrending,color:reverseColors?(0,colors.cM)("danger"):(0,colors.cM)("success")}:{Icon:icons.j4,color:reverseColors?(0,colors.cM)("success"):(0,colors.cM)("danger")},tooltip=null!==pctChangeFromPrevious?`${current>=previous?"Increased":"Decreased"} by ${(0,utils.e9)(Math.abs(pctChangeFromPrevious),0)} since last period (from ${formatNumber(previous)} to ${formatNumber(current)})`:null;return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)({"pr-4":!trend}),children:(0,jsx_runtime.jsx)(src.u,{title:tooltip,children:(0,jsx_runtime.jsxs)("span",{children:[formatNumber(current)," ",trend&&(0,jsx_runtime.jsx)("span",{style:{color:trend.color},children:(0,jsx_runtime.jsx)(trend.Icon,{color:trend.color,className:"ml-1"})})]})})})}},SortableCell=(name,orderByField)=>function SortableCell(){let{tablesOrderBy}=(0,index_esm.useValues)(webAnalyticsLogic.WG),{setTablesOrderBy}=(0,index_esm.useActions)(webAnalyticsLogic.WG),isSortedByMyField=tablesOrderBy?.[0]===orderByField,isAscending=tablesOrderBy?.[1]==="ASC",onClick=(0,react.useCallback)(()=>{!isSortedByMyField||isAscending?setTablesOrderBy(orderByField,"DESC"):setTablesOrderBy(orderByField,"ASC")},[isAscending,isSortedByMyField,setTablesOrderBy]);return(0,jsx_runtime.jsxs)("span",{onClick:onClick,className:"group cursor-pointer inline-flex items-center",children:[name,(0,jsx_runtime.jsx)(posthog_icons_es.IconChevronDown,{fontSize:"20px",className:(0,clsx_m.default)("-mr-1 ml-1 text-muted-alt opacity-0 group-hover:opacity-100",{"text-primary opacity-100":isSortedByMyField,"rotate-180":isSortedByMyField&&isAscending})})]})},webAnalyticsDataTableQueryContext={columns:{breakdown_value:{renderTitle:props=>{let{query}=props,{source}=query;if(source.kind!==schema_general.OH.WebStatsTableQuery)return null;let{breakdownBy}=source;switch(breakdownBy){case schema_general.GI.Page:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Path"});case schema_general.GI.InitialPage:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Initial Path"});case schema_general.GI.ExitPage:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"End Path"});case schema_general.GI.ExitClick:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Exit Click"});case schema_general.GI.ScreenName:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Screen Name"});case schema_general.GI.InitialChannelType:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Initial Channel Type"});case schema_general.GI.InitialReferringDomain:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Referring Domain"});case schema_general.GI.InitialUTMSource:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Source"});case schema_general.GI.InitialUTMCampaign:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Campaign"});case schema_general.GI.InitialUTMMedium:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Medium"});case schema_general.GI.InitialUTMTerm:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Term"});case schema_general.GI.InitialUTMContent:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"UTM Content"});case schema_general.GI.Browser:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Browser"});case schema_general.GI.OS:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"OS"});case schema_general.GI.Viewport:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Viewport"});case schema_general.GI.DeviceType:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Device Type"});case schema_general.GI.Country:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Country"});case schema_general.GI.Region:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Region"});case schema_general.GI.City:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"City"});case schema_general.GI.Timezone:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Timezone"});case schema_general.GI.Language:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Language"});case schema_general.GI.FrustrationMetrics:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"URL"});case schema_general.GI.InitialUTMSourceMediumCampaign:return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Source / Medium / Campaign"});default:throw new utils.q0(breakdownBy)}},render:props=>{let{value,query}=props,{source}=query;if(source.kind!==schema_general.OH.WebStatsTableQuery)return null;let{breakdownBy}=source;switch(breakdownBy){case schema_general.GI.ExitPage:case schema_general.GI.InitialPage:case schema_general.GI.Page:case schema_general.GI.FrustrationMetrics:{if("string"!=typeof value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value});let decoded=(0,utils.fB)(value);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:source.doPathCleaning?(0,PathCleanFilterItem.Z)(decoded):decoded})}case schema_general.GI.Viewport:if(Array.isArray(value)){let[width,height]=value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[width,"x",height]})}break;case schema_general.GI.Country:if("string"==typeof value)return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,country.q9)(value)," ",country.BL[value]||value]});break;case schema_general.GI.Region:if(Array.isArray(value)){let[countryCode,regionCode,regionName]=value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,country.q9)(countryCode)," ",country.BL[countryCode]||countryCode," -"," ",regionName||regionCode]})}break;case schema_general.GI.City:if(Array.isArray(value)){let[countryCode,cityName]=value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,country.q9)(countryCode)," ",country.BL[countryCode]||countryCode," -"," ",cityName]})}break;case schema_general.GI.Timezone:if("number"==typeof value)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:toUtcOffsetFormat(value)});break;case schema_general.GI.Language:if("string"==typeof value){var _countryCode$match$,_countryCodeToFlag;let[languageCode,countryCode]=value.split("-"),parsedCountryCode=null!==(_countryCode$match$=countryCode?.match(/([A-Z]{2})/)?.[0])&&void 0!==_countryCode$match$?_countryCode$match$:"";return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[null!==(_countryCodeToFlag=(0,country.q9)(parsedCountryCode))&&void 0!==_countryCodeToFlag?_countryCodeToFlag:(0,country.RD)(languageCode)," ",country.WL[languageCode]||languageCode]})}break;case schema_general.GI.DeviceType:if("string"==typeof value)return(0,jsx_runtime.jsx)(PropertyIcon.V.WithLabel,{property:"$device_type",value:value});break;case schema_general.GI.Browser:if("string"==typeof value)return(0,jsx_runtime.jsx)(PropertyIcon.V.WithLabel,{property:"$browser",value:value});break;case schema_general.GI.OS:if("string"==typeof value)return(0,jsx_runtime.jsx)(PropertyIcon.V.WithLabel,{property:"$os",value:value})}return"string"==typeof value?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value}):null}},bounce_rate:{renderTitle:SortableCell("Bounce Rate",schema_general.nV.BounceRate),render:VariationCell({isPercentage:!0,reverseColors:!0}),align:"right"},views:{renderTitle:SortableCell("Views",schema_general.nV.Views),render:VariationCell(),align:"right"},clicks:{renderTitle:SortableCell("Clicks",schema_general.nV.Clicks),render:VariationCell(),align:"right"},visitors:{renderTitle:SortableCell("Visitors",schema_general.nV.Visitors),render:VariationCell(),align:"right"},average_scroll_percentage:{renderTitle:SortableCell("Average Scroll",schema_general.nV.AverageScrollPercentage),render:VariationCell({isPercentage:!0}),align:"right"},scroll_gt80_percentage:{renderTitle:SortableCell("Deep Scroll Rate",schema_general.nV.ScrollGt80Percentage),render:VariationCell({isPercentage:!0}),align:"right"},total_conversions:{renderTitle:SortableCell("Total Conversions",schema_general.nV.TotalConversions),render:VariationCell(),align:"right"},unique_conversions:{renderTitle:SortableCell("Unique Conversions",schema_general.nV.UniqueConversions),render:VariationCell(),align:"right"},conversion_rate:{renderTitle:SortableCell("Conversion Rate",schema_general.nV.ConversionRate),render:VariationCell({isPercentage:!0}),align:"right"},rage_clicks:{renderTitle:SortableCell("Rage Clicks",schema_general.nV.RageClicks),render:VariationCell(),align:"right"},dead_clicks:{renderTitle:SortableCell("Dead Clicks",schema_general.nV.DeadClicks),render:VariationCell(),align:"right"},errors:{renderTitle:SortableCell("Errors",schema_general.nV.Errors),render:VariationCell(),align:"right"},converting_users:{renderTitle:SortableCell("Converting Users",schema_general.nV.ConvertingUsers),render:VariationCell(),align:"right"},action_name:{title:"Action"},cross_sell:{title:" ",render:_ref2=>{var _record$;let{record,query}=_ref2,dateRange=query.source?.dateRange,breakdownBy=query.source?.breakdownBy,value=null!==(_record$=record[0])&&void 0!==_record$?_record$:"";return(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center justify-end",children:[(0,jsx_runtime.jsx)(ReplayButton,{date_from:dateRange?.date_from,date_to:dateRange?.date_to,breakdownBy:breakdownBy,value:value}),(0,jsx_runtime.jsx)(HeatmapButton,{breakdownBy:breakdownBy,value:value}),(0,jsx_runtime.jsx)(ErrorTrackingButton,{breakdownBy:breakdownBy,value:value})]})},align:"right"}}},WebStatsTrendTile=_ref3=>{let{query,showIntervalTile,insightProps}=_ref3,{togglePropertyFilter,setInterval}=(0,index_esm.useActions)(webAnalyticsLogic.WG),{hasCountryFilter,dateFilter:{interval}}=(0,index_esm.useValues)(webAnalyticsLogic.WG),worldMapPropertyName=webAnalyticsLogic.ZB(schema_general.GI.Country)?.key,onWorldMapClick=(0,react.useCallback)(breakdownValue=>{worldMapPropertyName&&togglePropertyFilter(types.FT.Event,worldMapPropertyName,breakdownValue,{geographyTab:hasCountryFilter?void 0:webAnalyticsLogic.QX.REGIONS})},[togglePropertyFilter,worldMapPropertyName,hasCountryFilter]),context=(0,react.useMemo)(()=>({...webAnalyticsDataTableQueryContext,onDataPointClick(_ref4,data){let{breakdown}=_ref4;"string"===breakdown&&data&&(data.count>0||data.aggregated_value>0)&&onWorldMapClick(breakdown)},insightProps:{...insightProps,query}}),[onWorldMapClick,insightProps]);return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[showIntervalTile&&(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center",children:[(0,jsx_runtime.jsx)("span",{className:"mr-2",children:"Group by"}),(0,jsx_runtime.jsx)(IntervalFilter.T,{interval:interval,onIntervalChange:setInterval})]})}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})]})},WebStatsTableTile=_ref5=>{let{query,breakdownBy,insightProps,control}=_ref5,{togglePropertyFilter}=(0,index_esm.useActions)(webAnalyticsLogic.WG),{productTab}=(0,index_esm.useValues)(webAnalyticsLogic.WG),{key,type}=(0,webAnalyticsLogic.ZB)(breakdownBy)||{},onClick=(0,react.useCallback)(breakdownValue=>{if(key&&type){if(productTab===webAnalyticsLogic.lZ.PAGE_REPORTS){LemonToast.UJ.info("Filters are not yet supported in this tile");return}togglePropertyFilter(type,key,breakdownValue)}},[togglePropertyFilter,type,key,productTab]),context=(0,react.useMemo)(()=>({...webAnalyticsDataTableQueryContext,insightProps,rowProps:record=>{if(!key||!type||breakdownBy===schema_general.GI.Language||breakdownBy===schema_general.GI.Timezone)return{};let breakdownValue=getBreakdownValue(record,breakdownBy);return void 0===breakdownValue?{}:{onClick:()=>onClick(breakdownValue)}}}),[onClick,insightProps]);return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[null!=control&&(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:control}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})]})},getBreakdownValue=(record,breakdownBy)=>{if("object"!=typeof record||!record||!("result"in record))return;let result=record.result;if(!Array.isArray(result))return;let breakdownValue=result[0];switch(breakdownBy){case schema_general.GI.Country:if(Array.isArray(breakdownValue))return breakdownValue[0];break;case schema_general.GI.Region:case schema_general.GI.City:if(Array.isArray(breakdownValue))return breakdownValue[1];break;case schema_general.GI.FrustrationMetrics:if("string"==typeof breakdownValue)return breakdownValue}return null===breakdownValue?null:"string"==typeof breakdownValue?breakdownValue:void 0},WebGoalsTile=_ref6=>{let{query,insightProps}=_ref6,{actions,actionsLoading}=(0,index_esm.useValues)(actionsModel.D),{updateHasSeenProductIntroFor}=(0,index_esm.useActions)(userLogic.userLogic),{addProductIntentForCrossSell}=(0,index_esm.useActions)(teamLogic.teamLogic);return actionsLoading?null:actions.length?(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row-reverse p-2",children:(0,jsx_runtime.jsx)(LemonButton.J,{to:urls.j.actions(),onClick:()=>{addProductIntentForCrossSell({from:types.Md.WEB_ANALYTICS,to:types.Md.ACTIONS,intent_context:product_intents.kp.WEB_ANALYTICS_INSIGHT})},sideIcon:(0,jsx_runtime.jsx)(icons.pF,{}),type:"secondary",size:"small",children:"Manage actions"})}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})]}):(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Actions",productKey:types.Md.ACTIONS,thingName:"action",isEmpty:!0,description:"Use actions to combine events that you want to have tracked together or to make detailed Autocapture events easier to reuse.",docsURL:"https://posthog.com/docs/data/actions",actionElementOverride:(0,jsx_runtime.jsx)(NewActionButton.O,{onSelectOption:()=>updateHasSeenProductIntroFor(types.Md.ACTIONS,!0)})})},WebExternalClicksTile=_ref7=>{let{query,insightProps}=_ref7,{productTab,shouldStripQueryParams}=(0,index_esm.useValues)(webAnalyticsLogic.WG),{setShouldStripQueryParams}=(0,index_esm.useActions)(webAnalyticsLogic.WG),isPageReportsPage=productTab===webAnalyticsLogic.lZ.PAGE_REPORTS;return(0,jsx_runtime.jsxs)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col",children:[!isPageReportsPage&&(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center justify-end m-2 mr-4",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center deprecated-space-x-2",children:(0,jsx_runtime.jsx)(LemonSwitch.f,{label:"Strip query parameters",checked:shouldStripQueryParams,onChange:setShouldStripQueryParams,className:"h-full"})})}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})]})},WebVitalsPathBreakdownTile=_ref8=>{let{query,insightProps}=_ref8,{isPathCleaningEnabled}=(0,index_esm.useValues)(webAnalyticsLogic.WG),{setIsPathCleaningEnabled}=(0,index_esm.useActions)(webAnalyticsLogic.WG);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center gap-1 m-2",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold",children:"Path Breakdown"}),!isPathCleaningEnabled&&(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("span",{children:["Path Breakdown is more useful when path cleaning is turned on."," ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>setIsPathCleaningEnabled(!0),children:"Enable it."})]}),interactive:!0,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{className:"mb-2",fontSize:"18"})})]}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})]})},WebQuery=_ref9=>{let{query,showIntervalSelect,control,insightProps,tileId}=_ref9,{productTab,shouldStripQueryParams:stripQueryParamsDashboard}=(0,index_esm.useValues)(webAnalyticsLogic.WG),{stripQueryParams:stripQueryParamsPageReports}=(0,index_esm.useValues)(pageReportsLogic.z);if(query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.WebStatsTableQuery)return query.source.breakdownBy===schema_general.GI.FrustrationMetrics?(0,jsx_runtime.jsx)("div",{className:"border rounded bg-surface-primary flex-1 flex flex-col py-2 px-1",children:(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})}):(0,jsx_runtime.jsx)(WebStatsTableTile,{query:query,breakdownBy:query.source.breakdownBy,insightProps:insightProps,control:control,tileId:tileId});if(query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.WebExternalClicksTableQuery){let effectiveStripQueryParams=productTab===webAnalyticsLogic.lZ.PAGE_REPORTS?stripQueryParamsPageReports:stripQueryParamsDashboard,adjustedQuery={...query,source:{...query.source,stripQueryParams:effectiveStripQueryParams}};return(0,jsx_runtime.jsx)(WebExternalClicksTile,{query:adjustedQuery,insightProps:insightProps})}return query.kind===schema_general.OH.InsightVizNode?(0,jsx_runtime.jsx)(WebStatsTrendTile,{query:query,showIntervalTile:showIntervalSelect,insightProps:insightProps}):query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.WebGoalsQuery?(0,jsx_runtime.jsx)(WebGoalsTile,{query:query,insightProps:insightProps}):query.kind===schema_general.OH.DataTableNode&&query.source.kind===schema_general.OH.MarketingAnalyticsTableQuery?(0,jsx_runtime.jsx)(MarketingAnalyticsTable,{query:query,insightProps:insightProps}):query.kind===schema_general.OH.WebVitalsPathBreakdownQuery?(0,jsx_runtime.jsx)(WebVitalsPathBreakdownTile,{query:query,insightProps:insightProps}):(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:{...webAnalyticsDataTableQueryContext,insightProps}})}}}]);