(window.webpackJsonp=window.webpackJsonp||[]).push([[263],{"./frontend/src/scenes/instance/DeadLetterQueue/DeadLetterQueue.tsx":function(ne,p,n){"use strict";n.r(p),n.d(p,"scene",function(){return _}),n.d(p,"DeadLetterQueue",function(){return R});var I=n("./node_modules/react/index.js"),s=n.n(I),L=n("./frontend/src/lib/components/PageHeader.tsx"),E=n("./node_modules/antd/es/tabs/index.js"),v=n("./node_modules/kea/lib/index.esm.js"),ae=n("./node_modules/core-js/modules/es.array.concat.js"),se=n("./node_modules/core-js/modules/es.array.filter.js"),oe=n("./node_modules/core-js/modules/es.array.iterator.js"),ue=n("./node_modules/core-js/modules/es.object.to-string.js"),le=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),V=n("./node_modules/@babel/runtime/regenerator/index.js"),M=n.n(V),ie=n("./node_modules/regenerator-runtime/runtime.js"),C=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),O=n.n(C),$=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),T=n.n($),K=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),A=n.n(K),Q=n("./frontend/src/lib/api.ts"),h=n("./frontend/src/scenes/userLogic.ts");function F(r,t){var e;if(typeof Symbol=="undefined"||r[Symbol.iterator]==null){if(Array.isArray(r)||(e=G(r))||t&&r&&typeof r.length=="number"){e&&(r=e);var a=0,u=function(){};return{s:u,n:function(){return a>=r.length?{done:!0}:{done:!1,value:r[a++]}},e:function(f){throw f},f:u}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,o=!1,d;return{s:function(){e=r[Symbol.iterator]()},n:function(){var f=e.next();return l=f.done,f},e:function(f){o=!0,d=f},f:function(){try{!l&&e.return!=null&&e.return()}finally{if(o)throw d}}}}function G(r,t){if(!!r){if(typeof r=="string")return P(r,t);var e=Object.prototype.toString.call(r).slice(8,-1);if(e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set")return Array.from(r);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return P(r,t)}}function P(r,t){(t==null||t>r.length)&&(t=r.length);for(var e=0,a=new Array(t);e<t;e++)a[e]=r[e];return a}function S(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);t&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(r,u).enumerable})),e.push.apply(e,a)}return e}function w(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?S(Object(e),!0).forEach(function(a){A()(r,a,e[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):S(Object(e)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(e,a))})}return r}var b;(function(r){r.Metrics="metrics",r.Management="management",r.Settings="settings"})(b||(b={}));var g=Object(v.kea)({path:["scenes","instance","DeadLetterQueue","deadLetterQueueLogic"],actions:function(){return{setActiveTab:function(e){return{tabKey:e}},loadMoreRows:function(e){return{key:e}},addRowsToMetric:function(e,a){return{key:e,rows:a}}}},reducers:{activeTab:[b.Metrics,{setActiveTab:function(t,e){var a=e.tabKey;return a}}],rowsPerMetric:[{},{addRowsToMetric:function(t,e){var a=e.key,u=e.rows;return w(w({},t),{},A()({},a,[].concat(T()(t[a]||[]),T()(u))))},loadDeadLetterQueueMetricsSuccess:function(t,e){var a=e.deadLetterQueueMetrics,u={},l=F(a),o;try{for(l.s();!(o=l.n()).done;){var d=o.value;d.subrows&&(u[d.key]=d.subrows.rows)}}catch(c){l.e(c)}finally{l.f()}return u}}]},loaders:function(){return{deadLetterQueueMetrics:[[],{loadDeadLetterQueueMetrics:function(){var t=O()(M.a.mark(function a(){var u;return M.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!((u=h.a.values.user)===null||u===void 0)&&u.is_staff){o.next=2;break}return o.abrupt("return",[]);case 2:return o.next=4,Q.a.get("api/dead_letter_queue");case 4:return o.abrupt("return",o.sent.results);case 5:case"end":return o.stop()}},a)}));function e(){return t.apply(this,arguments)}return e}()}]}},listeners:function(t){var e=t.values,a=t.actions;return{loadMoreRows:function(){var u=O()(M.a.mark(function o(d){var c,f,i,y;return M.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(f=d.key,i=((c=e.rowsPerMetric[f])===null||c===void 0?void 0:c.length)+1,!i){m.next=7;break}return m.next=5,Q.a.get("api/dead_letter_queue/".concat(f,"?offset=").concat(i));case 5:y=m.sent,a.addRowsToMetric(f,y.subrows.rows);case 7:case"end":return m.stop()}},o)}));function l(o){return u.apply(this,arguments)}return l}()}},selectors:function(){return{singleValueMetrics:[function(t){return[t.deadLetterQueueMetrics]},function(t){return t.filter(function(e){return!e.subrows})}],tableMetrics:[function(t){return[t.deadLetterQueueMetrics]},function(t){return t.filter(function(e){return!!e.subrows})}]}},events:function(t){var e=t.actions;return{afterMount:function(){e.loadDeadLetterQueueMetrics()}}}}),ce=n("./node_modules/core-js/modules/es.array.map.js"),H=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),B=n.n(H),J=n("./node_modules/antd/es/row/index.js"),U=n("./node_modules/antd/es/col/index.js"),z=n("./node_modules/antd/es/statistic/index.js"),D=n("./node_modules/antd/es/divider/index.js"),N=n("./node_modules/antd/es/button/index.js"),W=n("./frontend/src/lib/components/LemonTable/index.ts"),X=n("./frontend/src/lib/components/LemonButton/index.ts"),Y=n("./frontend/src/lib/components/Spinner/Spinner.tsx"),Z=n("./frontend/src/lib/components/icons.tsx"),k=10;function q(){var r=Object(v.useValues)(h.a),t=r.user,e=Object(v.useValues)(g),a=e.singleValueMetrics,u=e.tableMetrics,l=e.deadLetterQueueMetricsLoading,o=e.rowsPerMetric,d=Object(v.useActions)(g),c=d.loadDeadLetterQueueMetrics,f=d.loadMoreRows;return t!=null&&t.is_staff?s.a.createElement("div",null,s.a.createElement("br",null),s.a.createElement("div",{className:"mb float-right"},s.a.createElement(X.a,{icon:l?s.a.createElement(Y.a,{size:"sm"}):s.a.createElement(Z.IconRefresh,null),onClick:c,type:"secondary",compact:!0},"Refresh")),s.a.createElement(J.a,{gutter:32},a.map(function(i){return s.a.createElement(U.a,{key:i.key},s.a.createElement(z.a,{title:i.metric,value:(i.value||"0").toLocaleString("en-US"),loading:l}))})),s.a.createElement(D.a,null),u.map(function(i){var y,j;return s.a.createElement("div",{key:i.key},s.a.createElement("h2",null,i.metric),s.a.createElement(W.a,{columns:[{title:(y=i.subrows)===null||y===void 0?void 0:y.columns[0],dataIndex:"key"},{title:(j=i.subrows)===null||j===void 0?void 0:j.columns[1],dataIndex:"value"}],dataSource:o[i.key].map(function(m){var x=B()(m,2),te=x[0],re=x[1];return{key:te,value:re}})||[],loading:l,defaultSorting:{columnKey:"value",order:-1},embedded:!0}),s.a.createElement("div",{style:{margin:"1rem",textAlign:"center"}},s.a.createElement(N.a,{disabled:o[i.key].length%k!==0,onClick:function(){return f(i.key)}},"Load more values")),s.a.createElement(D.a,null))})):s.a.createElement(s.a.Fragment,null)}var _={component:R,logic:g},ee=E.a.TabPane;function R(){var r=Object(v.useValues)(h.a),t=r.user,e=Object(v.useValues)(g),a=e.activeTab,u=Object(v.useActions)(g),l=u.setActiveTab;return t!=null&&t.is_staff?s.a.createElement("div",null,s.a.createElement(L.a,{title:"Dead Letter Queue",caption:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Manage your instance's dead letter queue."))}),s.a.createElement(E.a,{activeKey:a,onChange:function(d){return l(d)}},s.a.createElement(ee,{tab:"Metrics",key:b.Metrics})),a===b.Metrics?s.a.createElement(q,null):null):s.a.createElement(L.a,{title:"Dead Letter Queue",caption:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Only users with staff access can manage the dead letter queue. Please contact your instance admin."),s.a.createElement("p",null,"If you're an admin and don't have access, set ",s.a.createElement("code",null,"is_staff=true")," for your user on the PostgreSQL ",s.a.createElement("code",null,"posthog_user")," table."))})}}}]);
