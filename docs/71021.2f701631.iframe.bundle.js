"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[71021],{"../../frontend/src/lib/hooks/useAsyncHandler.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>useAsyncHandler});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");function useAsyncHandler(onEvent){let[loading,setLoading]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1);return{loading:loading,onEvent:onEvent?e=>{if(onEvent){let result=onEvent(e);result instanceof Promise&&(setLoading(!0),result.finally(()=>setLoading(!1)))}}:void 0}}},"../../frontend/src/scenes/session-recordings/SessionRecordings.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SessionsRecordings:()=>SessionsRecordings,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.27.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),authorizedUrlListLogic=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),hedgehogs=__webpack_require__("../../frontend/src/lib/components/hedgehogs.tsx"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),VersionCheckerBanner=__webpack_require__("../../frontend/src/lib/components/VersionChecker/VersionCheckerBanner.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),useAsyncHandler=__webpack_require__("../../frontend/src/lib/hooks/useAsyncHandler.ts"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),Spinner=__webpack_require__("../../frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),NotebookSelectButton=__webpack_require__("../../frontend/src/scenes/notebooks/NotebookSelectButton/NotebookSelectButton.tsx"),sessionRecordingsPlaylistLogic=__webpack_require__("../../frontend/src/scenes/session-recordings/playlist/sessionRecordingsPlaylistLogic.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),types=__webpack_require__("../../frontend/src/types.ts"),playlistUtils=__webpack_require__("../../frontend/src/scenes/session-recordings/playlist/playlistUtils.ts"),SessionRecordingsPlaylist=__webpack_require__("../../frontend/src/scenes/session-recordings/playlist/SessionRecordingsPlaylist.tsx"),SavedSessionRecordingPlaylists=__webpack_require__("../../frontend/src/scenes/session-recordings/saved-playlists/SavedSessionRecordingPlaylists.tsx"),sessionRecordingEventUsageLogic=__webpack_require__("../../frontend/src/scenes/session-recordings/sessionRecordingEventUsageLogic.ts"),sessionReplaySceneLogic=__webpack_require__("../../frontend/src/scenes/session-recordings/sessionReplaySceneLogic.ts"),TaxonomicFilter_types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),UniversalFilters=__webpack_require__("../../frontend/src/lib/components/UniversalFilters/UniversalFilters.tsx"),universalFiltersLogic=__webpack_require__("../../frontend/src/lib/components/UniversalFilters/universalFiltersLogic.ts"),utils=__webpack_require__("../../frontend/src/lib/components/UniversalFilters/utils.ts"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),queries_utils=__webpack_require__("../../frontend/src/queries/utils.ts");let replayActiveScreensTableLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","session-recordings","components","replayActiveScreensTableLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.scene||"default"),(0,index_esm.defaults)({countedScreens:[]}),(0,kea_loaders_lib.lazyLoaders)(()=>({countedScreens:{loadCountedScreens:async(_,breakpoint)=>{let q=(0,queries_utils.zP)`
                    select cutQueryString(cutFragment(url)) as u, count(distinct session_id) as c
                    from (select session_id, arrayJoin(all_urls) as url
                          from raw_session_replay_events
                          where min_first_timestamp >= now() - toIntervalDay(7)
                            and min_first_timestamp <= now())
                    group by u
                    order by c desc limit 10
                `,qResponse=await api.ZP.queryHogQL(q);return breakpoint(),(qResponse.results||[]).map(row=>({screen:row[0],count:row[1]}))}}}))]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ReplayActiveScreensTable=()=>{let{countedScreens,countedScreensLoading}=(0,index_esm.useValues)(replayActiveScreensTableLogic({scene:"templates"}));return(0,jsx_runtime.jsx)("div",{className:"flex flex-col border rounded bg-surface-primary w-full px-4 py-2",children:(0,jsx_runtime.jsx)(LemonTable.g,{embedded:!0,columns:[{title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(Tooltip.u,{title:"Click a row to see recordings.",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 items-center cursor-pointer",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-xl"})," Last 7 days most active pages"]})})}),dataIndex:"screen",align:"left",width:"90%"},{align:"left",dataIndex:"count",width:"10%"}],dataSource:countedScreens||[],loading:countedScreensLoading,onRow:record=>({className:"cursor-pointer hover:bg-surface-secondary",onClick:()=>{lib.router.actions.push(urls.j.replay(types.yd.Home,{date_from:"-7d",filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:[{id:"$pageview",name:"$pageview",type:"events",properties:[{key:"$current_url",value:record.screen,operator:types.WV.IContains,type:types.FT.Event}]}]}]}}))}})})})};var actionsModel=__webpack_require__("../../frontend/src/models/actionsModel.ts"),CalendarHeatMap=__webpack_require__("../../frontend/src/scenes/web-analytics/CalendarHeatMap/CalendarHeatMap.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.260.0_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js");let rowLabels=["00:00 - 04:00","04:00 - 08:00","08:00 - 12:00","12:00 - 16:00","16:00 - 20:00","20:00 - 00:00"],columnLabels=now=>[now.subtract(6,"day").format("ddd D"),now.subtract(5,"day").format("ddd D"),now.subtract(4,"day").format("ddd D"),now.subtract(3,"day").format("ddd D"),now.subtract(2,"day").format("ddd D"),now.subtract(1,"day").format("ddd D"),"Today"],getOnClickTooltip=(colIndex,rowIndex)=>{let day=columnLabels((0,dayjs.zO)())[colIndex],timeRange=void 0===rowIndex?void 0:rowLabels[rowIndex];return`View recordings for ${day}${timeRange?` ${timeRange}`:""}`},onCellClick=(colIndex,rowIndex,timezone)=>{let startDate=(0,dayjs.zO)().subtract(6-colIndex,"day").startOf("day").utc(!0),endDate=startDate.clone();if(void 0!==rowIndex){let startHour=4*rowIndex;startDate=startDate.hour(startHour),endDate=endDate.hour(startHour+4)}else endDate=endDate.add(1,"day");dist_module.ZP.capture("clicked_replay_active_hours_heatmap_cell",{isColumnHeader:void 0==rowIndex,isIndividualCell:void 0!=rowIndex,timezone}),lib.router.actions.push(urls.j.replay(types.yd.Home,{date_from:startDate.tz(timezone,!0).toISOString(),date_to:endDate.tz(timezone,!0).toISOString()}))},replayActiveHoursHeatMapLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","session-recordings","components","replayActiveHoursHeatMapLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.scene||"default"),(0,kea_loaders_lib.lazyLoaders)(()=>({recordingsPerHour:{loadRecordingsPerHour:async(_,breakpoint)=>{let q=(0,queries_utils.zP)`
                    SELECT hour_block,
                           countIf(_toDate(mints) = today() - 6) AS "Day -6",
                           countIf(_toDate(mints) = today() - 5) AS "Day -5",
                           countIf(_toDate(mints) = today() - 4) AS "Day -4",
                           countIf(_toDate(mints) = today() - 3) AS "Day -3",
                           countIf(_toDate(mints) = today() - 2) AS "Day -2",
                           countIf(_toDate(mints) = today() - 1) AS "Day -1",
                           countIf(_toDate(mints) = today())     AS "Day 0"
                    FROM (SELECT intDiv(toHour(mints), 4) * 4 AS real_hour_block,
                                 mints
                          FROM (SELECT min(min_first_timestamp) AS mints
                                FROM raw_session_replay_events
                                WHERE min_first_timestamp >= now() - INTERVAL 7 day
                                  AND min_first_timestamp <= now()
                                GROUP BY session_id
                                having dateDiff('SECOND'
                                     , min (min_first_timestamp)
                                     , max (max_last_timestamp))
                                     > 5)) AS data
                             RIGHT JOIN (SELECT arrayJoin([0, 4, 8, 12, 16, 20]) AS hour_block) AS hours
                                        ON data.real_hour_block = hours.hour_block
                    GROUP BY hour_block
                    ORDER BY hour_block`,qResponse=await api.ZP.queryHogQL(q);return breakpoint(),qResponse.results}}})),(0,index_esm.selectors)(()=>({calendarHeatmapProps:[s=>[s.recordingsPerHour],recordingsPerHour=>{if(!recordingsPerHour||0===recordingsPerHour.length||0===recordingsPerHour[0].length)return{rowLabels:[],columnLabels:[],processedData:{matrix:[],columnsAggregations:[],rowsAggregations:[],overallValue:0,maxOverall:0,minOverall:0,maxRowAggregation:0,minRowAggregation:0,maxColumnAggregation:0,minColumnAggregation:0}};let dataWithoutHourBlock=recordingsPerHour.map(row=>row.slice(1)),columnsAggregations=dataWithoutHourBlock.reduce((acc,row)=>(row.forEach((value,index)=>{acc[index]=(acc[index]||0)+value}),acc),[]),rowsAggregations=dataWithoutHourBlock.reduce((acc,row)=>(acc[row[0]]=(acc[row[0]]||0)+row.reduce((a,b)=>a+b,0),acc),[]),processedData={matrix:dataWithoutHourBlock,columnsAggregations:columnsAggregations,rowsAggregations:rowsAggregations,overallValue:columnsAggregations.reduce((a,b)=>a+b,0),maxOverall:dataWithoutHourBlock.reduce((acc,row)=>Math.max(acc,...row),0),minOverall:dataWithoutHourBlock.reduce((acc,row)=>Math.min(acc,...row),0),maxColumnAggregation:Math.max(...columnsAggregations),minColumnAggregation:Math.min(...columnsAggregations),maxRowAggregation:Math.max(...rowsAggregations),minRowAggregation:Math.min(...rowsAggregations)};return{rowLabels:rowLabels,columnLabels:columnLabels((0,dayjs.zO)()),processedData:processedData}}],isClickable:[s=>[s.calendarHeatmapProps],calendarHeatmapProps=>(colIndex,rowIndex)=>{var _valueSource$colIndex;return(null!==(_valueSource$colIndex=(void 0==rowIndex?calendarHeatmapProps?.processedData.columnsAggregations:calendarHeatmapProps?.processedData.matrix[rowIndex])[colIndex])&&void 0!==_valueSource$colIndex?_valueSource$colIndex:0)>0}]})),(0,index_esm.listeners)(()=>({loadRecordingsPerHourFailed:async()=>{LemonToast.U.error("Failed to load recordings activity for heatmap")}}))]),ReplayActiveHoursHeatMap=()=>{let{timezone}=(0,index_esm.useValues)(teamLogic.teamLogic),{calendarHeatmapProps,recordingsPerHourLoading,isClickable}=(0,index_esm.useValues)(replayActiveHoursHeatMapLogic({scene:"templates"}));return(0,jsx_runtime.jsxs)("div",{className:"w-full flex flex-col",children:[(0,jsx_runtime.jsx)("h2",{children:"When are your users most active?"}),(0,jsx_runtime.jsx)("p",{children:"This heatmap shows you the busiest times of day for your recordings over the last 7 days."}),(0,jsx_runtime.jsx)(CalendarHeatMap.Z,{isLoading:recordingsPerHourLoading,...calendarHeatmapProps,allAggregationsLabel:"",getDataTooltip:()=>"",getColumnAggregationTooltip:()=>"",getRowAggregationTooltip:()=>"",getOverallAggregationTooltip:()=>"",getOnClickTooltip:getOnClickTooltip,onClick:(colIndex,rowIndex)=>onCellClick(colIndex,rowIndex,timezone),isClickable:isClickable,showColumnAggregations:!1,showRowAggregations:!1})]})};var PersonDisplay=__webpack_require__("../../frontend/src/scenes/persons/PersonDisplay.tsx");let replayActiveUsersTableLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","session-recordings","components","replayActiveUsersTableLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.scene||"default"),(0,index_esm.defaults)({countedUsers:[]}),(0,kea_loaders_lib.lazyLoaders)(()=>({countedUsers:{loadCountedUsers:async(_,breakpoint)=>{let q=(0,queries_utils.zP)`
                    select p, any (pp), count () as c
                    from (
                        select any (person_id) as p, any (person.properties) as pp
                        from raw_session_replay_events
                        where min_first_timestamp <= now()
                        and min_first_timestamp >= now() - toIntervalDay(7)
                        group by session_id
                        having date_diff('second', min (min_first_timestamp), max (max_last_timestamp)) > 5000
                        ) as q
                    group by p
                    order by c desc
                        limit 10
                `,qResponse=await api.ZP.queryHogQL(q);return breakpoint(),(qResponse.results||[]).map(row=>({person:{id:row[0],properties:JSON.parse(row[1])},count:row[2]}))}}}))]),ReplayActiveUsersTable=()=>{let{countedUsers,countedUsersLoading}=(0,index_esm.useValues)(replayActiveUsersTableLogic({scene:"templates"}));return(0,jsx_runtime.jsx)("div",{className:"flex flex-col border rounded bg-surface-primary w-full px-4 py-2",children:(0,jsx_runtime.jsx)(LemonTable.g,{embedded:!0,columns:[{title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(Tooltip.u,{title:"Click a row to see recordings.",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 items-center cursor-pointer",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-xl"})," Last 7 days most active users"]})})}),dataIndex:"person",align:"left",render:p=>(0,jsx_runtime.jsx)(PersonDisplay.I,{person:p,withIcon:!0,noLink:!0})},{align:"left",dataIndex:"count",width:"10%"}],dataSource:countedUsers||[],loading:countedUsersLoading,onRow:record=>({className:"cursor-pointer hover:bg-surface-secondary",onClick:()=>{lib.router.actions.push(urls.j.personByUUID(record.person.id)+"#activeTab=sessionRecordings")}})})})},replayTemplates=[{key:"signup-flow",name:"Signup flow",description:"Watch how users sign up for your website. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Signup page URL",key:"signup-page-url",value:"/signup",description:"Complete or partial URL"}],categories:["B2B"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconUser,{})},{key:"pricing-page",name:"Pricing page",description:"Watch how users navigate your pricing page. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Pricing page URL",key:"pricing-page-url",description:"Complete or partial URL"}],categories:["B2B"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconHandMoney,{})},{key:"upgrade-flow",name:"Upgrade / subscribe flow",description:"Watch how users upgrade to the paid plan on your website. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Upgrade / subscribe page URL",key:"upgrade-subscribe-page-url",description:"Complete or partial URL"},{type:"event",name:"Upgrade / subscribe event",key:"upgrade-subscribe-event",description:"The event that triggers the upgrade / subscribe flow."}],categories:["B2B"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconHandMoney,{})},{key:"onboarding-flow",name:"Onboarding flow",description:"Watch how users onboard to your website. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Onboarding page URL",key:"onboarding-page-url",description:"Complete or partial URL"}],categories:["B2B"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconApp,{})},{key:"feature-usage",name:"Feature usage",description:"Think of a feature you want to improve. Watch how users interact with it, and see where they get stuck.",variables:[{type:"event",name:"Feature event",key:"feature-event",description:"The event that indicates a user has interacted with the feature."},{type:"pageview",name:"Feature page URL",key:"feature-page-url",description:"Complete or partial URL where the feature is located."}],categories:["B2B","B2C"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCursorClick,{})},{key:"purchase-flow",name:"Purchase flow",description:"Watch how users purchase from your website. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Purchase page URL",key:"purchase-page-url",description:"Complete or partial URL"}],categories:["B2C"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconHandMoney,{})},{key:"product-search",name:"Product search",description:"Watch how users search for products on your website. Look for any areas or steps that cause friction.",variables:[{type:"event",name:"Product search event",key:"product-search-event",description:"The event that indicates a user has searched for something on your website."}],categories:["B2C"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconSearch,{})},{key:"experiment",name:"A/B test results",description:"Watch how users interact with your A/B test. Look for any areas or steps that cause friction.",variables:[{type:"flag",name:"Feature flag",key:"feature-flag",description:"The feature flag that you want to observe."}],categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFlag,{})},{key:"rageclicks",name:"Rageclicks",description:'See where users are "rageclicking" on your website to find things that don\'t work as expected.',variables:[{type:"event",name:"Rageclick event",key:"rageclick-event",description:'The event that indicates a user has "rageclicked" on your website.',noTouch:!0,filterGroup:{id:"$rageclick",name:"$rageclick",type:TaxonomicFilter_types.t.Events}}],categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsDown,{})},{key:"scattershot",name:"Scattershot",description:"Watch all recent replays, and see where users are getting stuck.",variables:[],categories:["More"],order:"start_time",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconVideoCamera,{})},{key:"person-property",name:"Person property",description:"Watch all replays for users with a specific property, like a specific email address.",variables:[{type:"person-property",name:"Person property",key:"person-property",description:"The person property that you want to observe."}],categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconUser,{})},{key:"mobile-devices",name:"Mobile devices",description:"Watch replays from mobile device web browsers to look for problems with your responsive design.",variables:[{type:"snapshot_source",name:"Mobile device",key:"mobile-device",description:"Users who used your website on a mobile device.",noTouch:!0,filterGroup:{id:"$pageview",name:"$pageview",type:"events",properties:[{key:"$screen_width",value:"600",operator:types.WV.LessThan,type:types.FT.Event}]}}],categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPhone,{})},{key:"activity-score",name:"Most active users",description:"Watch recordings of the most active sessions. Lots of valuable insights, guaranteed!",order:"activity_score",categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCursorClick,{})}];var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js");let getPageviewFilterValue=pageview=>({key:"visited_page",value:pageview,operator:types.WV.IContains,type:types.FT.Recording}),getFlagFilterValue=flag=>({id:"$feature_flag_called",name:"$feature_flag_called",type:"events",properties:[{key:`$feature/${flag}`,type:types.FT.Event,value:["false"],operator:types.WV.IsNot},{key:`$feature/${flag}`,type:types.FT.Event,value:"is_set",operator:types.WV.IsSet},{key:"$feature_flag",type:types.FT.Event,value:flag,operator:types.WV.Exact}]}),sessionReplayTemplatesLogic=(0,index_esm.kea)([(0,index_esm.path)(()=>["scenes","session-recordings","templates","sessionReplayTemplatesLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>`${props.category}-${props.template.key}`),(0,index_esm.connect)(()=>({values:[teamLogic.teamLogic,["currentTeam"]]})),(0,index_esm.actions)({setVariables:variables=>({variables}),setVariable:variable=>({variable}),resetVariable:variable=>({variable}),navigate:!0,showVariables:!0,hideVariables:!0}),(0,index_esm.reducers)(_ref=>{var _props$template$varia;let{props,values}=_ref;return{variables:[null!==(_props$template$varia=props.template.variables)&&void 0!==_props$template$varia?_props$template$varia:[],{persist:!0,storageKey:(0,clsx_m.default)("session-recordings.templates.variables",values.currentTeam?.id,props.category,props.template.key)},{setVariables:(_,_ref2)=>{let{variables}=_ref2;return null!=variables?variables:[]},setVariable:(state,_ref3)=>{let{variable}=_ref3;return state.map(v=>v.key===variable.key?{...variable,touched:!0}:v)},resetVariable:(state,_ref4)=>{let{variable}=_ref4;return state.map(v=>v.key===variable.key?{...variable,touched:!1}:v)}}],variablesVisible:[!1,{showVariables:()=>!0,hideVariables:()=>!1}]}}),(0,index_esm.selectors)({filterGroup:[s=>[s.variables],variables=>{let filters=variables.map(variable=>"pageview"===variable.type&&variable.value?getPageviewFilterValue(variable.value):"flag"===variable.type&&variable.value?getFlagFilterValue(variable.value):["snapshot_source","event","person-property"].includes(variable.type)&&variable.filterGroup?variable.filterGroup:void 0).filter(filter=>void 0!==filter);return{filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:filters}]}}}],canApplyFilters:[s=>[s.variables,s.areAnyVariablesTouched],(variables,areAnyVariablesTouched)=>areAnyVariablesTouched||0===variables.length],areAnyVariablesTouched:[s=>[s.variables],variables=>variables.some(v=>v.touched)||variables.some(v=>v.noTouch)],editableVariables:[s=>[s.variables],variables=>variables.filter(v=>!v.noTouch)]}),(0,index_esm.listeners)(_ref5=>{let{values,props}=_ref5;return{navigate:()=>{dist_module.ZP.capture("session replay template used",{template:props.template.key,category:props.category});let filterGroup=values.variables.length>0?values.filterGroup:void 0;lib.router.actions.push(urls.j.replay(types.yd.Home,filterGroup,void 0,props.template.order))}}}),(0,index_esm.events)(_ref6=>{let{actions,props,values}=_ref6;return{afterMount:()=>{0===values.variables.length&&actions.setVariables(props.template.variables)}}})]),allCategories=replayTemplates.flatMap(template=>template.categories).filter((category,index,self1)=>self1.indexOf(category)===index),NestedFilterGroup=_ref=>{let{buttonTitle,selectOne}=_ref,{filterGroup}=(0,index_esm.useValues)(universalFiltersLogic.d),{replaceGroupValue,removeGroupValue}=(0,index_esm.useActions)(universalFiltersLogic.d);return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"inline-flex flex-col gap-2",children:[filterGroup.values.map((filterOrGroup,index)=>(0,utils.pU)(filterOrGroup)?(0,jsx_runtime.jsx)(UniversalFilters.Z.Group,{index:index,group:filterOrGroup,children:(0,jsx_runtime.jsx)(NestedFilterGroup,{})},index):(0,jsx_runtime.jsx)(UniversalFilters.Z.Value,{index:index,filter:filterOrGroup,onRemove:()=>removeGroupValue(index),onChange:value=>replaceGroupValue(index,value)},index)),!selectOne||selectOne&&0===filterGroup.values.length?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(UniversalFilters.Z.AddFilterButton,{title:buttonTitle,type:"secondary",size:"xsmall"})}):null]})})},SingleTemplateVariable=_ref2=>{let{variable,...props}=_ref2,{setVariable,resetVariable}=(0,index_esm.useActions)(sessionReplayTemplatesLogic(props));return(0,index_esm.useMountedLogic)(actionsModel.D),"pageview"===variable.type?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{info:variable.description,children:variable.name}),(0,jsx_runtime.jsx)(src.DF,{placeholder:variable.value,value:variable.value,onChange:e=>e?setVariable({...variable,value:e}):resetVariable({...variable,value:void 0}),size:"small"})]}):["event","flag","person-property"].includes(variable.type)?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{info:variable.description,children:variable.name}),(0,jsx_runtime.jsx)(UniversalFilters.Z,{rootKey:`session-recordings-${variable.key}`,group:{type:types.J2.And,values:variable.filterGroup?[variable.filterGroup]:[]},taxonomicGroupTypes:"event"===variable.type?[TaxonomicFilter_types.t.Events,TaxonomicFilter_types.t.Actions]:"flag"===variable.type?[TaxonomicFilter_types.t.FeatureFlags]:"person-property"===variable.type?[TaxonomicFilter_types.t.PersonProperties]:[],onChange:thisFilterGroup=>{0===thisFilterGroup.values.length?resetVariable({...variable,filterGroup:void 0}):"flag"===variable.type?setVariable({...variable,value:thisFilterGroup.values[0].key}):setVariable({...variable,filterGroup:thisFilterGroup.values[0]})},children:(0,jsx_runtime.jsx)(NestedFilterGroup,{buttonTitle:`Select ${"event"===variable.type?"event":"flag"===variable.type?"flag":"person property"}`,selectOne:"flag"==variable.type})})]}):null},TemplateVariables=props=>{let{navigate}=(0,index_esm.useActions)(sessionReplayTemplatesLogic(props)),{variables,canApplyFilters}=(0,index_esm.useValues)(sessionReplayTemplatesLogic(props));return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[variables.filter(v=>!v.noTouch).map(variable=>(0,jsx_runtime.jsx)(SingleTemplateVariable,{variable:variable,...props},variable.key)),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>navigate(),type:"primary",className:"mt-2",disabledReason:canApplyFilters?void 0:"Please set a value for at least one variable",children:"Apply filters"})})]})},RecordingTemplateCard=props=>{let{showVariables,hideVariables}=(0,index_esm.useActions)(sessionReplayTemplatesLogic(props)),{variablesVisible}=(0,index_esm.useValues)(sessionReplayTemplatesLogic(props));return(0,jsx_runtime.jsx)(src.Mi,{className:"w-80",onClick:()=>{showVariables()},closeable:variablesVisible,onClose:hideVariables,focused:variablesVisible,"data-attr":"session-replay-template","data-ph-capture-attribute-category":props.category,"data-ph-capture-attribute-template":props.template.key,children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[props.template.icon&&(0,jsx_runtime.jsx)("div",{className:"bg-surface-primary rounded p-2 w-8 h-8 flex items-center justify-center",children:props.template.icon}),(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:(0,jsx_runtime.jsx)(src.rU,{onClick:()=>showVariables(),className:"text-accent",children:props.template.name})})]}),(0,jsx_runtime.jsx)("p",{children:props.template.description}),variablesVisible?(0,jsx_runtime.jsx)(TemplateVariables,{...props}):null]})})},templates_SessionRecordingTemplates=()=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("p",{children:"To get the most out of session replay, you just need to know where to start. "}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 w-full",children:[(0,jsx_runtime.jsx)(ReplayActiveUsersTable,{}),(0,jsx_runtime.jsx)(ReplayActiveScreensTable,{})]}),(0,jsx_runtime.jsx)(ReplayActiveHoursHeatMap,{})]}),(0,jsx_runtime.jsx)("h2",{className:"mt-4",children:"Filter templates"}),(0,jsx_runtime.jsx)("p",{children:"Use our templates to find a focus area, then watch the filtered replays to see where users struggle, what could be made more clear, and other ways to improve."}),allCategories.map(category=>(0,jsx_runtime.jsxs)("div",{className:"mb-6",children:[(0,jsx_runtime.jsx)("h2",{children:category}),(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap gap-2",children:replayTemplates.filter(template=>template.categories.includes(category)).map(template=>(0,jsx_runtime.jsx)(RecordingTemplateCard,{template:template,category:category},template.key))})]},`replay-template-category-${category}`))]});var notebooks_types=__webpack_require__("../../frontend/src/scenes/notebooks/types.ts");function Header(){let{tab}=(0,index_esm.useValues)(sessionReplaySceneLogic.f),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),recordingsDisabled=currentTeam&&!currentTeam?.session_recording_opt_in,{reportRecordingPlaylistCreated}=(0,index_esm.useActions)(sessionRecordingEventUsageLogic.G),{filters}=(0,index_esm.useValues)((0,sessionRecordingsPlaylistLogic.YV)({updateSearchParams:!0})),newPlaylistHandler=(0,useAsyncHandler.N)(async()=>{await (0,playlistUtils.cg)({_create_in_folder:"Unfiled/Replay playlists",type:"collection"},!0),reportRecordingPlaylistCreated("new")});return(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[tab===types.yd.Home&&!recordingsDisabled&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.d6,{items:[{label:"Playback from PostHog JSON file",to:urls.j.replayFilePlayback()}],children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{})})}),(0,jsx_runtime.jsx)(NotebookSelectButton.R,{resource:{type:notebooks_types.C.RecordingPlaylist,attrs:{filters:filters}},type:"secondary"})]}),tab===types.yd.Playlists&&(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:e=>newPlaylistHandler.onEvent?.(e),"data-attr":"save-recordings-playlist-button",loading:newPlaylistHandler.loading,children:"New collection"})]})})}function Warnings(){let{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),recordingsDisabled=currentTeam&&!currentTeam?.session_recording_opt_in,theAuthorizedUrlsLogic=(0,authorizedUrlListLogic.zl)({...authorizedUrlListLogic.P1,type:authorizedUrlListLogic.uw.RECORDING_DOMAINS}),{suggestions,authorizedUrls}=(0,index_esm.useValues)(theAuthorizedUrlsLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),mightBeRefusingRecordings=suggestions.length>0&&authorizedUrls.length>0,settingLevel=featureFlags[constants.y8.ENVIRONMENTS]?"environment":"project";return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(VersionCheckerBanner.o,{}),recordingsDisabled?(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",hideIcon:!0,children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-8 p-8 md:flex-row justify-center flex-wrap",children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-center items-center w-full md:w-50",children:(0,jsx_runtime.jsx)(hedgehogs.WarningHog,{className:"w-full h-auto md:h-[200px] md:w-[200px] max-w-50"})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 flex-shrink max-w-180",children:[(0,jsx_runtime.jsxs)("h2",{className:"text-lg font-semibold",children:["Session recordings are not yet enabled for this ",settingLevel]}),(0,jsx_runtime.jsx)("p",{className:"font-normal",children:"Enabling session recordings will help you:"}),(0,jsx_runtime.jsxs)("ul",{className:"list-disc list-inside font-normal",children:[(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"Understand user behavior:"})," Get a clear view of how people navigate and interact with your product."]}),(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"Identify UI/UX issues:"})," Spot friction points and refine your design to increase usability."]}),(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"Improve customer support:"})," Quickly diagnose problems and provide more accurate solutions."]}),(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"Refine product decisions:"})," Use real insights to prioritize features and improvements."]})]}),(0,jsx_runtime.jsx)("p",{className:"font-normal",children:"Enable session recordings to unlock these benefits and create better experiences for your users."}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-x-4 gap-y-2 flex-wrap",children:[(0,jsx_runtime.jsx)(src.Jp,{className:"hidden @md:flex",type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),to:urls.j.replaySettings(),children:"Configure"}),(0,jsx_runtime.jsx)(src.Jp,{type:"tertiary",sideIcon:(0,jsx_runtime.jsx)(posthog_icons_es.IconOpenSidebar,{className:"w-4 h-4"}),to:"https://posthog.com/docs/session-replay?utm_medium=in-product&utm_campaign=empty-state-docs-link","data-attr":"product-introduction-docs-link",targetBlank:!0,children:"Learn more"})]})]})]})}):(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"session replay",productKey:types.Md.SESSION_REPLAY,thingName:"playlist",description:"Use session replay playlists to easily group and analyze user sessions. Curate playlists based on events or user segments, spot patterns, diagnose issues, and share insights with your team.",docsURL:"https://posthog.com/docs/session-replay/manual",customHog:hedgehogs.FilmCameraHog}),!recordingsDisabled&&mightBeRefusingRecordings?(0,jsx_runtime.jsx)(LemonBanner.V,{type:"warning",action:{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),to:urls.j.replaySettings("replay-authorized-domains"),children:"Configure"},dismissKey:`session-recordings-authorized-domains-warning/${suggestions.join(",")}`,children:"You have unauthorized domains trying to send recordings. To accept recordings from these domains, please check your config."}):null]})}function MainPanel(){let{tab}=(0,index_esm.useValues)(sessionReplaySceneLogic.f);return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4 mt-2",children:[(0,jsx_runtime.jsx)(Warnings,{}),tab?tab===types.yd.Home?(0,jsx_runtime.jsx)("div",{className:"SessionRecordingPlaylistHeightWrapper",children:(0,jsx_runtime.jsx)(SessionRecordingsPlaylist.m,{updateSearchParams:!0})}):tab===types.yd.Playlists?(0,jsx_runtime.jsx)(SavedSessionRecordingPlaylists.aP,{tab:types.yd.Playlists}):tab===types.yd.Templates?(0,jsx_runtime.jsx)(templates_SessionRecordingTemplates,{}):null:(0,jsx_runtime.jsx)(Spinner.$,{})]})}let ReplayPageTabs=[{label:"Recordings",tooltipDocLink:"https://posthog.com/docs/session-replay/tutorials",key:types.yd.Home,"data-attr":"session-recordings-home-tab"},{label:"Collections",tooltipDocLink:"https://posthog.com/docs/session-replay/how-to-watch-recordings",key:types.yd.Playlists,tooltip:"View & create collections","data-attr":"session-recordings-collections-tab"},{label:"Figure out what to watch",key:types.yd.Templates,"data-attr":"session-recordings-templates-tab"},{label:"Settings",key:types.yd.Settings,"data-attr":"session-recordings-settings-tab"}];function PageTabs(){let{tab,shouldShowNewBadge}=(0,index_esm.useValues)(sessionReplaySceneLogic.f);return(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tab,className:"flex",onChange:t=>lib.router.actions.push(urls.j.replay(t)),tabs:ReplayPageTabs.map(replayTab=>({label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[replayTab.label,replayTab.label===types.yd.Templates&&shouldShowNewBadge&&(0,jsx_runtime.jsx)(src.Mo,{className:"ml-1",size:"small"})]}),key:replayTab.key,tooltip:replayTab.tooltip,tooltipDocLink:replayTab.tooltipDocLink,"data-attr":replayTab["data-attr"]}))})}function SessionsRecordings(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Header,{}),(0,jsx_runtime.jsx)(PageTabs,{}),(0,jsx_runtime.jsx)(MainPanel,{})]})}let scene={component:SessionsRecordings,logic:sessionReplaySceneLogic.f,settingSectionId:"environment-replay"}},"../../frontend/src/scenes/session-recordings/sessionReplaySceneLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>humanFriendlyTabName,f:()=>sessionReplaySceneLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/utils.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_navigation_3000_sidepanel_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/types.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts");let humanFriendlyTabName=tab=>{switch(tab){case _types__WEBPACK_IMPORTED_MODULE_5__.yd.Home:return"Recordings";case _types__WEBPACK_IMPORTED_MODULE_5__.yd.Playlists:return"Collections";case _types__WEBPACK_IMPORTED_MODULE_5__.yd.Templates:return"Figure out what to watch";case _types__WEBPACK_IMPORTED_MODULE_5__.yd.Settings:return"Settings";default:return(0,lib_utils__WEBPACK_IMPORTED_MODULE_2__.fm)(tab)}},sessionReplaySceneLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(()=>["scenes","session-recordings","sessionReplaySceneLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setTab:function(){let tab=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_types__WEBPACK_IMPORTED_MODULE_5__.yd.Home;return{tab}},hideNewBadge:!0}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(()=>({tab:[_types__WEBPACK_IMPORTED_MODULE_5__.yd.Home,{setTab:(_,_ref)=>{let{tab}=_ref;return tab}}],shouldShowNewBadge:[!0,{persist:!0},{hideNewBadge:()=>!1}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref2=>{let{actions}=_ref2;return{setTab:_ref3=>{let{tab}=_ref3;tab===_types__WEBPACK_IMPORTED_MODULE_5__.yd.Templates&&actions.hideNewBadge()}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.actionToUrl)(_ref4=>{let{values}=_ref4;return{setTab:()=>[scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.replay(values.tab),kea_router__WEBPACK_IMPORTED_MODULE_1__.router.values.searchParams]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)(()=>({breadcrumbs:[s=>[s.tab],tab=>{let breadcrumbs=[];return tab!==_types__WEBPACK_IMPORTED_MODULE_5__.yd.Home&&breadcrumbs.push({key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.Replay,name:"Replay",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.j.replay()}),breadcrumbs.push({key:tab,name:humanFriendlyTabName(tab)}),breadcrumbs}],[_layout_navigation_3000_sidepanel_types__WEBPACK_IMPORTED_MODULE_6__.f]:[()=>[kea_router__WEBPACK_IMPORTED_MODULE_1__.router.selectors.searchParams],searchParams=>searchParams.sessionRecordingId?{activity_scope:_types__WEBPACK_IMPORTED_MODULE_5__.jc.REPLAY,activity_item_id:searchParams.sessionRecordingId}:null]})),(0,kea_router__WEBPACK_IMPORTED_MODULE_1__.urlToAction)(_ref5=>{let{actions,values}=_ref5;return{"/replay/:tab":_ref6=>{let{tab}=_ref6,validTab=Object.values(_types__WEBPACK_IMPORTED_MODULE_5__.yd).includes(tab)?tab:_types__WEBPACK_IMPORTED_MODULE_5__.yd.Home;validTab!==values.tab&&actions.setTab(validTab)}}})])}}]);
//# sourceMappingURL=71021.2f701631.iframe.bundle.js.map