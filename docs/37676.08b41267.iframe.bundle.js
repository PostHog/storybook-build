"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[37676],{"./frontend/src/scenes/data-warehouse/external/forms/SyncMethodForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>SyncMethodForm});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonRadio/index.ts"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let getIncrementalSyncSupported=schema=>schema.incremental_available?0===schema.incremental_fields.length?{disabled:!0,disabledReason:"No incremental fields found on table"}:{disabled:!1}:{disabled:!0,disabledReason:"Incremental append replication isn't supported on this table"},hasInputChanged=(newSchemaSyncType,newSchemaIncrementalField,originalSchemaSyncType,originalSchemaIncrementalField)=>originalSchemaSyncType!==newSchemaSyncType||"incremental"===newSchemaSyncType&&newSchemaIncrementalField!==originalSchemaIncrementalField,getSaveDisabledReason=(syncType,incrementalField)=>syncType?"incremental"!==syncType||incrementalField?void 0:"You must select an incremental field":"You must select a sync method before saving",SyncMethodForm=_ref=>{var _schema$sync_type,_schema$incremental_f,_schema$sync_type2,_schema$incremental_f2,_schema$incremental_f4;let{schema,onClose,onSave,saveButtonIsLoading,showRefreshMessageOnChange}=_ref,[originalSchemaSyncType]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$sync_type=schema.sync_type)&&void 0!==_schema$sync_type?_schema$sync_type:null),[originalSchemaIncrementalField]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$incremental_f=schema.incremental_field)&&void 0!==_schema$incremental_f?_schema$incremental_f:null),[radioValue,setRadioValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$sync_type2=schema.sync_type)&&void 0!==_schema$sync_type2?_schema$sync_type2:void 0),[incrementalFieldValue,setIncrementalFieldValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$incremental_f2=schema.incremental_field)&&void 0!==_schema$incremental_f2?_schema$incremental_f2:null);(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{var _schema$sync_type3,_schema$incremental_f3;setRadioValue(null!==(_schema$sync_type3=schema.sync_type)&&void 0!==_schema$sync_type3?_schema$sync_type3:void 0),setIncrementalFieldValue(null!==(_schema$incremental_f3=schema.incremental_field)&&void 0!==_schema$incremental_f3?_schema$incremental_f3:null)},[schema.table]);let incrementalSyncSupported=getIncrementalSyncSupported(schema),inputChanged=hasInputChanged(null!=radioValue?radioValue:null,incrementalFieldValue,originalSchemaSyncType,originalSchemaIncrementalField);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__._,{radioPosition:"top",value:radioValue,options:[{value:"incremental",disabledReason:incrementalSyncSupported.disabled&&incrementalSyncSupported.disabledReason||void 0,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-6 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-2.5",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h2",{className:"mb-0 mr-2",children:"Incremental append replication"}),!incrementalSyncSupported.disabled&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTag,{type:"success",children:"Recommended"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"When using incremental append replication, we'll store the max value of the below field on each sync and only sync rows with greater or equal value on the next run."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:["You should pick a field that increments for each row, such as a"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("code",{children:"created_at"})," timestamp."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{children:["This method will append all new rows to your existing table - this means duplicate data can exist if the incremental field updates for updated rows (such as when using an ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("code",{children:"updated_at"})," field)"]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonSelect,{value:incrementalFieldValue,onChange:newValue=>setIncrementalFieldValue(newValue),options:null!==(_schema$incremental_f4=schema.incremental_fields.map(n=>({value:n.field,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{className:"leading-5",children:n.label}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTag,{className:"ml-2",type:"success",children:n.type})]})})))&&void 0!==_schema$incremental_f4?_schema$incremental_f4:[],disabledReason:incrementalSyncSupported.disabled?"":void 0})]})},{value:"full_refresh",label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-6 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-2.5",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h2",{className:"mb-0 mr-2",children:"Full table replication"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{children:"We'll replicate the whole table on every sync. This can take longer to sync and increase your monthly billing."})]})}],onChange:newValue=>setRadioValue(newValue)}),inputChanged&&showRefreshMessageOnChange&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"text-danger",children:"Note: Changing the sync type or incremental append replication field will trigger a full table refresh"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"flex flex-row justify-end w-full",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{className:"mr-3",type:"secondary",onClick:onClose,children:"Close"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{type:"primary",loading:saveButtonIsLoading,disabledReason:getSaveDisabledReason(radioValue,incrementalFieldValue),onClick:()=>{if("incremental"===radioValue){let fieldSelected=schema.incremental_fields.find(n=>n.field===incrementalFieldValue);if(!fieldSelected){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("Selected field for incremental append replication not found");return}onSave("incremental",incrementalFieldValue,fieldSelected.field_type)}else onSave("full_refresh",null,null)},children:"Save"})]})]})}},"./frontend/src/scenes/data-warehouse/settings/DataWarehouseManagedSourcesTable.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{lL:()=>DataWarehouseManagedSourcesTable,MX:()=>RenderDataWarehouseSourceIcon});var src=__webpack_require__("./frontend/@posthog/apps-common/src/index.ts"),lemon_ui_src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),ProductIntroduction=__webpack_require__("./frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx");let cloudflare_logo=__webpack_require__.p+"images/cloudflare-logo.df6b3a12dfe2bf895d97c50d8d7b8f2c.svg",google_cloud_storage_logo=__webpack_require__.p+"images/google-cloud-storage-logo.ae727253732762af397d7eea1278f372.png",hubspot_logo=__webpack_require__.p+"images/hubspot-logo.c0fff3b062a9575d0c2b48cda3bb6d35.svg",postgres_logo=__webpack_require__.p+"images/postgres-logo.e407ebb120aa171a7512a371dda497b5.svg",s3_logo=__webpack_require__.p+"images/s3-logo.369357168ceb78a76e4d5c9e60e3b9d8.png",snowflake_logo=__webpack_require__.p+"images/snowflake-logo.c5b9d7830f5c68469dea73f3200647c8.svg",stripe_logo=__webpack_require__.p+"images/stripe-logo.b028b0fcb152afb51f2ab5c15b9c8331.svg",zendesk_logo=__webpack_require__.p+"images/zendesk-logo.ab7151773a17b0b73f212bb73bf859d8.svg";var react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),queries_schema=__webpack_require__("./frontend/src/queries/schema.ts"),types=__webpack_require__("./frontend/src/types.ts"),SyncMethodForm=__webpack_require__("./frontend/src/scenes/data-warehouse/external/forms/SyncMethodForm.tsx"),dataWarehouseSettingsLogic=__webpack_require__("./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts");let dataWarehouseSourcesTableSyncMethodModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","settings","DataWarehouseSourcesTableSyncMethodModalLogic"]),(0,index_esm.props)({schema:{}}),(0,index_esm.key)(props=>props.schema.id),(0,index_esm.connect)(()=>({actions:[dataWarehouseSettingsLogic.T,["updateSchema","updateSchemaSuccess","updateSchemaFailure"]]})),(0,index_esm.actions)({openSyncMethodModal:schema=>({schema}),closeSyncMethodModal:!0}),(0,kea_loaders_lib.loaders)({schemaIncrementalFields:[null,{loadSchemaIncrementalFields:async schemaId=>await api.ZP.externalDataSchemas.incremental_fields(schemaId),resetSchemaIncrementalFields:()=>null}]}),(0,index_esm.reducers)({syncMethodModalIsOpen:[!1,{openSyncMethodModal:()=>!0,closeSyncMethodModal:()=>!1}],currentSyncMethodModalSchema:[null,{openSyncMethodModal:(_,_ref)=>{let{schema}=_ref;return schema},closeSyncMethodModal:()=>null}],saveButtonIsLoading:[!1,{updateSchema:()=>!0,updateSchemaFailure:()=>!1,updateSchemaSuccess:()=>!1}]}),(0,index_esm.listeners)(_ref2=>{let{actions}=_ref2;return{updateSchemaSuccess:()=>{actions.resetSchemaIncrementalFields(),actions.closeSyncMethodModal()}}})]);var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let StatusTagSetting={Running:"primary",Completed:"success",Error:"danger",Failed:"danger"};function DataWarehouseManagedSourcesTable(){var _dataWarehouseSources;let{dataWarehouseSources,dataWarehouseSourcesLoading,sourceReloadingById}=(0,index_esm.useValues)(dataWarehouseSettingsLogic.T),{deleteSource,reloadSource,updateSource}=(0,index_esm.useActions)(dataWarehouseSettingsLogic.T);return dataWarehouseSourcesLoading||dataWarehouseSources?.results.length!==0?(0,jsx_runtime.jsx)(lemon_ui_src.LemonTable,{dataSource:null!==(_dataWarehouseSources=dataWarehouseSources?.results)&&void 0!==_dataWarehouseSources?_dataWarehouseSources:[],loading:dataWarehouseSourcesLoading,disableTableWhileLoading:!1,columns:[{width:0,render:function RenderAppInfo(_,source){return(0,jsx_runtime.jsx)(RenderDataWarehouseSourceIcon,{type:source.source_type})}},{title:"Source Type",key:"name",render:function RenderName(_,source){return source.source_type}},{title:"Table prefix",key:"prefix",render:function RenderPrefix(_,source){return source.prefix}},{title:"Sync Frequency",key:"frequency",render:function RenderFrequency(_,source){return(0,jsx_runtime.jsx)(lemon_ui_src.LemonSelect,{className:"my-1",value:source.sync_frequency||"day",onChange:value=>updateSource({...source,sync_frequency:value}),options:[{value:"day",label:"Daily"},{value:"week",label:"Weekly"},{value:"month",label:"Monthly"}]})}},{title:"Last Successful Run",key:"last_run_at",tooltip:"Time of the last run that completed a data import",render:(_,run)=>run.last_run_at?(0,jsx_runtime.jsx)(src.TZLabel,{time:run.last_run_at,formatDate:"MMM\xa0DD,\xa0YYYY",formatTime:"HH:mm"}):"Never"},{title:"Total Rows Synced",key:"rows_synced",tooltip:"Total number of rows synced across all schemas in this source",render:function RenderRowsSynced(_,source){return source.schemas.reduce((acc,schema)=>{var _schema$table$row_cou;return acc+(null!==(_schema$table$row_cou=schema.table?.row_count)&&void 0!==_schema$table$row_cou?_schema$table$row_cou:0)},0).toLocaleString()}},{title:"Status",key:"status",render:function RenderStatus(_,source){return(0,jsx_runtime.jsx)(lemon_ui_src.LemonTag,{type:StatusTagSetting[source.status]||"default",children:source.status})}},{key:"actions",width:0,render:function RenderActions(_,source){return(0,jsx_runtime.jsx)("div",{className:"flex flex-row justify-end",children:sourceReloadingById[source.id]?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(lemon_ui_src.Spinner,{})}):(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(lemon_ui_src.Tooltip,{title:"Start the data import for this schema again",children:(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{type:"tertiary","data-attr":`reload-data-warehouse-${source.source_type}`,onClick:()=>{reloadSource(source)},children:"Reload"},`reload-data-warehouse-${source.source_type}`)}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{status:"danger","data-attr":`delete-data-warehouse-${source.source_type}`,onClick:()=>{lemon_ui_src.LemonDialog.open({title:"Delete data source?",description:"Are you sure you want to delete this data source? All related tables will be deleted.",primaryButton:{children:"Delete",status:"danger",onClick:()=>deleteSource(source)},secondaryButton:{children:"Cancel"}})},children:"Delete"},`delete-data-warehouse-${source.source_type}`)]})})})})}}],expandable:{expandedRowRender:source=>(0,jsx_runtime.jsx)("div",{className:"px-4 py-3",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col",children:(0,jsx_runtime.jsx)("div",{className:"mt-2",children:(0,jsx_runtime.jsx)(SchemaTable,{schemas:source.schemas})})})}),rowExpandable:()=>!0,noIndent:!0}}):(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Data Warehouse Source",productKey:types.Md.DATA_WAREHOUSE,thingName:"data source",description:"Use data warehouse sources to import data from your external data into PostHog.",isEmpty:dataWarehouseSources?.results.length==0,docsURL:"https://posthog.com/docs/data-warehouse",action:()=>lib.router.actions.push(urls.j.pipelineNodeDataWarehouseNew())})}function RenderDataWarehouseSourceIcon(_ref){let{type,size="small"}=_ref,sizePx="small"===size?30:60,icon={Stripe:stripe_logo,Hubspot:hubspot_logo,Zendesk:zendesk_logo,Postgres:postgres_logo,Snowflake:snowflake_logo,aws:s3_logo,"google-cloud":google_cloud_storage_logo,"cloudflare-r2":cloudflare_logo}[type];return(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-4",children:(0,jsx_runtime.jsx)(lemon_ui_src.Tooltip,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[type,(0,jsx_runtime.jsx)("br",{}),"Click to view docs"]}),children:(0,jsx_runtime.jsx)(lemon_ui_src.Link,{to:types.zD.includes(type)?"https://posthog.com/docs/data-warehouse/setup#step-1-creating-a-bucket-in-s3":`https://posthog.com/docs/data-warehouse/setup#${type.toLowerCase()}`,children:(0,jsx_runtime.jsx)("img",{src:icon,alt:type,height:sizePx,width:sizePx})})})})}let SchemaTable=_ref2=>{let{schemas}=_ref2,{updateSchema,reloadSchema,resyncSchema}=(0,index_esm.useActions)(dataWarehouseSettingsLogic.T),{schemaReloadingById}=(0,index_esm.useValues)(dataWarehouseSettingsLogic.T);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(lemon_ui_src.LemonTable,{dataSource:schemas,columns:[{title:"Schema Name",key:"name",render:function RenderName(_,schema){return(0,jsx_runtime.jsx)("span",{children:schema.name})}},{title:"Sync method",key:"incremental",render:function RenderIncremental(_,schema){let{openSyncMethodModal}=(0,index_esm.useActions)(dataWarehouseSourcesTableSyncMethodModalLogic({schema}));return schema.sync_type?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{className:"my-1",size:"small",type:"secondary",onClick:()=>openSyncMethodModal(schema),children:"incremental"==schema.sync_type?"Incremental":"Full refresh"}),(0,jsx_runtime.jsx)(SyncMethodModal,{schema:schema})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{className:"my-1",type:"primary",onClick:()=>openSyncMethodModal(schema),children:"Set up"}),(0,jsx_runtime.jsx)(SyncMethodModal,{schema:schema})]})}},{title:"Enabled",key:"should_sync",render:function RenderShouldSync(_,schema){return(0,jsx_runtime.jsx)(lemon_ui_src.LemonSwitch,{disabledReason:null===schema.sync_type?"You must set up the sync method first":void 0,checked:schema.should_sync,onChange:active=>{updateSchema({...schema,should_sync:active})}})}},{title:"Synced Table",key:"table",render:function RenderTable(_,schema){if(schema.table){let query={kind:queries_schema.OH.DataTableNode,full:!0,source:{kind:queries_schema.OH.HogQLQuery,query:`SELECT ${schema.table.columns.filter(_ref3=>{let{table,fields,chain,schema_valid}=_ref3;return!table&&!fields&&!chain&&schema_valid}).map(_ref4=>{let{name}=_ref4;return name})} FROM ${"numbers"===schema.table.name?"numbers(0, 10)":schema.table.name} LIMIT 100`}};return(0,jsx_runtime.jsx)(lemon_ui_src.Link,{to:urls.j.dataWarehouse(JSON.stringify(query)),children:(0,jsx_runtime.jsx)("code",{children:schema.table.name})})}return(0,jsx_runtime.jsx)("div",{children:"Not yet synced"})}},{title:"Last Synced At",key:"last_synced_at",render:function Render(_,schema){return schema.last_synced_at?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.TZLabel,{time:schema.last_synced_at,formatDate:"MMM\xa0DD,\xa0YYYY",formatTime:"HH:mm"})}):null}},{title:"Rows Synced",key:"rows_synced",render:function Render(_,schema){var _schema$table$row_cou2;return(null!==(_schema$table$row_cou2=schema.table?.row_count)&&void 0!==_schema$table$row_cou2?_schema$table$row_cou2:0).toLocaleString()}},{title:"Status",key:"status",render:function RenderStatus(_,schema){return schema.status?(0,jsx_runtime.jsx)(lemon_ui_src.LemonTag,{type:StatusTagSetting[schema.status]||"default",children:schema.status}):null}},{key:"actions",width:0,render:function RenderActions(_,schema){return schemaReloadingById[schema.id]?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(lemon_ui_src.Spinner,{})}):(0,jsx_runtime.jsx)("div",{className:"flex flex-row justify-end",children:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{type:"tertiary",onClick:()=>{reloadSchema(schema)},children:"Reload"},`reload-data-warehouse-schema-${schema.id}`),schema.incremental&&(0,jsx_runtime.jsx)(lemon_ui_src.Tooltip,{title:"Completely resync incrementally loaded data. Only recommended if there is an issue with data quality in previously imported data",children:(0,jsx_runtime.jsx)(lemon_ui_src.LemonButton,{type:"tertiary",onClick:()=>{resyncSchema(schema)},status:"danger",children:"Resync"},`resync-data-warehouse-schema-${schema.id}`)})]})})})})}}]})})},SyncMethodModal=_ref5=>{var _currentSyncMethodMod,_currentSyncMethodMod2;let{schema}=_ref5,{syncMethodModalIsOpen,currentSyncMethodModalSchema,schemaIncrementalFields,schemaIncrementalFieldsLoading,saveButtonIsLoading}=(0,index_esm.useValues)(dataWarehouseSourcesTableSyncMethodModalLogic({schema})),{closeSyncMethodModal,loadSchemaIncrementalFields,resetSchemaIncrementalFields,updateSchema}=(0,index_esm.useActions)(dataWarehouseSourcesTableSyncMethodModalLogic({schema}));(0,react.useEffect)(()=>{currentSyncMethodModalSchema?.id&&(resetSchemaIncrementalFields(),loadSchemaIncrementalFields(currentSyncMethodModalSchema.id))},[currentSyncMethodModalSchema?.id]);let schemaLoading=schemaIncrementalFieldsLoading||!schemaIncrementalFields;return currentSyncMethodModalSchema?(0,jsx_runtime.jsxs)(lemon_ui_src.LemonModal,{title:`Sync method for ${currentSyncMethodModalSchema.name}`,isOpen:syncMethodModalIsOpen,onClose:closeSyncMethodModal,footer:schemaLoading&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(lemon_ui_src.LemonSkeleton.Button,{}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonSkeleton.Button,{})]}),children:[schemaLoading&&(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)(lemon_ui_src.LemonSkeleton,{className:"w-1/2 h-4"}),(0,jsx_runtime.jsx)(lemon_ui_src.LemonSkeleton.Row,{repeat:3})]}),!schemaLoading&&schemaIncrementalFields&&(0,jsx_runtime.jsx)(SyncMethodForm.m,{showRefreshMessageOnChange:null!==currentSyncMethodModalSchema.sync_type,saveButtonIsLoading:saveButtonIsLoading,schema:{table:currentSyncMethodModalSchema.name,should_sync:currentSyncMethodModalSchema.should_sync,sync_type:currentSyncMethodModalSchema.sync_type,incremental_field:null!==(_currentSyncMethodMod=currentSyncMethodModalSchema.incremental_field)&&void 0!==_currentSyncMethodMod?_currentSyncMethodMod:null,incremental_field_type:null!==(_currentSyncMethodMod2=currentSyncMethodModalSchema.incremental_field_type)&&void 0!==_currentSyncMethodMod2?_currentSyncMethodMod2:null,incremental_available:!!schemaIncrementalFields.length,incremental_fields:schemaIncrementalFields},onClose:()=>{resetSchemaIncrementalFields(),closeSyncMethodModal()},onSave:(syncType,incrementalField,incrementalFieldType)=>{"full_refresh"===syncType?updateSchema({...currentSyncMethodModalSchema,should_sync:!0,sync_type:syncType,incremental_field:null,incremental_field_type:null}):updateSchema({...currentSyncMethodModalSchema,should_sync:!0,sync_type:syncType,incremental_field:incrementalField,incremental_field_type:incrementalFieldType})}})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}},"./frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>dataWarehouseSettingsLogic,d:()=>humanFriendlyDataWarehouseSettingsTabName});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),posthog_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/posthog-js@1.146.0/node_modules/posthog-js/dist/module.js"),scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/data-management/database/databaseTableListLogic.ts"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/urls.ts"),_types__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/types.ts");let humanFriendlyDataWarehouseSettingsTabName=tab=>{switch(tab){case _types__WEBPACK_IMPORTED_MODULE_9__.EP.Managed:return"Managed";case _types__WEBPACK_IMPORTED_MODULE_9__.EP.SelfManaged:return"Self managed"}},dataWarehouseSettingsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-warehouse","settings","dataWarehouseSettingsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__.A,["dataWarehouseTables"]],actions:[scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__.A,["loadDatabase"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({deleteSource:source=>({source}),reloadSource:source=>({source}),reloadSchema:schema=>({schema}),resyncSchema:schema=>({schema}),sourceLoadingFinished:source=>({source}),schemaLoadingFinished:schema=>({schema}),abortAnyRunningQuery:!0,setCurrentTab:function(){let tab=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_types__WEBPACK_IMPORTED_MODULE_9__.EP.Managed;return{tab}},deleteSelfManagedTable:tableId=>({tableId})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{cache,actions,values}=_ref;return{dataWarehouseSources:[null,{loadSources:async(_,breakpoint)=>{await breakpoint(300),actions.abortAnyRunningQuery(),cache.abortController=new AbortController;let methodOptions={signal:cache.abortController.signal},res=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSources.list(methodOptions);return breakpoint(),cache.abortController=null,res},updateSource:async source=>{let updatedSource=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSources.update(source.id,source);return{...values.dataWarehouseSources,results:values.dataWarehouseSources?.results.map(s=>s.id===updatedSource.id?source:s)||[]}}}],schemas:[null,{updateSchema:async schema=>{var _values$dataWarehouse;let clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse?_values$dataWarehouse:[])),sourceIndex=clonedSources.findIndex(n=>n.schemas.find(m=>m.id===schema.id)),schemaIndex=clonedSources[sourceIndex].schemas.findIndex(n=>n.id===schema.id);return clonedSources[sourceIndex].schemas[schemaIndex]=schema,actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources}),await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSchemas.update(schema.id,schema),actions.loadSources(null),null}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(_ref2=>{let{cache}=_ref2;return{dataWarehouseSourcesLoading:[!1,{loadSources:()=>!0,loadSourcesFailure:()=>null!==cache.abortController,loadSourcesSuccess:()=>null!==cache.abortController}],sourceReloadingById:[{},{reloadSource:(state,_ref3)=>{let{source}=_ref3;return{...state,[source.id]:!0}},deleteSource:(state,_ref4)=>{let{source}=_ref4;return{...state,[source.id]:!0}},sourceLoadingFinished:(state,_ref5)=>{let{source}=_ref5;return{...state,[source.id]:!1}}}],schemaReloadingById:[{},{reloadSchema:(state,_ref6)=>{let{schema}=_ref6;return{...state,[schema.id]:!0}},resyncSchema:(state,_ref7)=>{let{schema}=_ref7;return{...state,[schema.id]:!0}},schemaLoadingFinished:(state,_ref8)=>{let{schema}=_ref8;return{...state,[schema.id]:!1}}}],currentTab:[_types__WEBPACK_IMPORTED_MODULE_9__.EP.Managed,{setCurrentTab:(_,_ref9)=>{let{tab}=_ref9;return tab}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_7__.x.DataWarehouse,name:"Data Warehouse",path:scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.dataWarehouse()},{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_7__.x.DataWarehouseSettings,name:"Data Warehouse Settings",path:scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.dataWarehouseSettings()}]],selfManagedTables:[s=>[s.dataWarehouseTables],dataWarehouseTables=>dataWarehouseTables.filter(table=>!table.source)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref10=>{let{actions,values,cache}=_ref10;return{deleteSelfManagedTable:async _ref11=>{let{tableId}=_ref11;await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dataWarehouseTables.delete(tableId),actions.loadDatabase()},loadSourcesSuccess:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout(()=>{actions.loadSources(null)},1e4)},loadSourcesFailure:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout(()=>{actions.loadSources(null)},1e4)},deleteSource:async _ref12=>{let{source}=_ref12;await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSources.delete(source.id),actions.loadSources(null),actions.sourceLoadingFinished(source),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("source deleted",{sourceType:source.source_type})},reloadSource:async _ref13=>{var _values$dataWarehouse2;let{source}=_ref13,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse2=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse2?_values$dataWarehouse2:[])),sourceIndex=clonedSources.findIndex(n=>n.id===source.id);clonedSources[sourceIndex].status="Running",clonedSources[sourceIndex].schemas=clonedSources[sourceIndex].schemas.map(n=>n.should_sync?{...n,status:"Running"}:n),actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources});try{await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSources.reload(source.id),actions.loadSources(null),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("source reloaded",{sourceType:source.source_type})}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Cant refresh source at this time")}actions.sourceLoadingFinished(source)},reloadSchema:async _ref14=>{var _values$dataWarehouse3;let{schema}=_ref14,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse3=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse3?_values$dataWarehouse3:[])),sourceIndex=clonedSources.findIndex(n=>n.schemas.find(m=>m.id===schema.id)),schemaIndex=clonedSources[sourceIndex].schemas.findIndex(n=>n.id===schema.id);clonedSources[sourceIndex].status="Running",clonedSources[sourceIndex].schemas[schemaIndex].status="Running",actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources});try{await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSchemas.reload(schema.id),actions.schemaLoadingFinished(schema),actions.loadSources(null),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("schema reloaded",{sourceType:clonedSources[sourceIndex].source_type})}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Cant reload schema at this time")}},resyncSchema:async _ref15=>{var _values$dataWarehouse4;let{schema}=_ref15,clonedSources=JSON.parse(JSON.stringify(null!==(_values$dataWarehouse4=values.dataWarehouseSources?.results)&&void 0!==_values$dataWarehouse4?_values$dataWarehouse4:[])),sourceIndex=clonedSources.findIndex(n=>n.schemas.find(m=>m.id===schema.id)),schemaIndex=clonedSources[sourceIndex].schemas.findIndex(n=>n.id===schema.id);clonedSources[sourceIndex].status="Running",clonedSources[sourceIndex].schemas[schemaIndex].status="Running",actions.loadSourcesSuccess({...values.dataWarehouseSources,results:clonedSources});try{await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.externalDataSchemas.resync(schema.id),actions.schemaLoadingFinished(schema),actions.loadSources(null),posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("schema resynced",{sourceType:clonedSources[sourceIndex].source_type})}catch(e){e.message?lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Cant refresh schema at this time")}},abortAnyRunningQuery:()=>{cache.abortController&&(cache.abortController.abort(),cache.abortController=null)},updateSchema:schema=>{posthog_js__WEBPACK_IMPORTED_MODULE_5__.ZP.capture("schema updated",{shouldSync:schema.should_sync,syncType:schema.sync_type})}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref16=>{let{actions}=_ref16;actions.loadSources(null)}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.actionToUrl)(_ref17=>{let{values}=_ref17;return{setCurrentTab:()=>[scenes_urls__WEBPACK_IMPORTED_MODULE_8__.j.dataWarehouseSettings(values.currentTab)]}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.urlToAction)(_ref18=>{let{actions,values}=_ref18;return{"/data-warehouse/settings/:tab":_ref19=>{let{tab}=_ref19;tab!==values.currentTab&&actions.setCurrentTab(tab)}}})])}}]);