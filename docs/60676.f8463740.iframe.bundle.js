(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[60676],{"./frontend/src/scenes/batch_exports/BatchExportsListScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BatchExportsList:()=>BatchExportsList,BatchExportsListScene:()=>BatchExportsListScene,scene:()=>scene});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.6.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonMenu=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMenu/index.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts");let batchExportsListLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","batch_exports","batchExportsListLogic"]),(0,index_esm.actions)({loadBatchExports:offset=>({offset})}),(0,index_esm.reducers)({offset:[0,{loadBatchExports:(_,_ref)=>{let{offset}=_ref;return offset||0}}]}),(0,lib.loaders)(_ref2=>{let{values}=_ref2;return{batchExportConfigs:[null,{loadBatchExports:async(_ref3,breakpoint)=>{let{offset}=_ref3;await breakpoint(100);let res=await api.ZP.batchExports.list({offset:offset||0,limit:10});return res},pause:async batchExport=>{await api.ZP.batchExports.pause(batchExport.id),src.lemonToast.success("Batch export paused. No future runs will be scheduled");let found=values.batchExportConfigs?.results.find(config=>config.id===batchExport.id);return found&&(found.paused=!0),values.batchExportConfigs},unpause:async batchExport=>{await api.ZP.batchExports.unpause(batchExport.id),src.lemonToast.success("Batch export unpaused. Future runs will be scheduled");let found=values.batchExportConfigs?.results.find(config=>config.id===batchExport.id);return found&&(found.paused=!1),values.batchExportConfigs}}]}}),(0,index_esm.listeners)(_ref4=>{let{actions,values,cache}=_ref4;return{loadBatchExportsSuccess:()=>{clearTimeout(cache.refreshTimeout),cache.refreshTimeout=setTimeout(()=>{actions.loadBatchExports(values.offset)},1e4)}}}),(0,index_esm.beforeUnmount)(_ref5=>{let{cache}=_ref5;clearTimeout(cache.refreshTimeout)}),(0,index_esm.afterMount)(_ref6=>{let{actions}=_ref6;actions.loadBatchExports()}),(0,index_esm.selectors)(_ref7=>{let{actions}=_ref7;return{pagination:[s=>[s.offset,s.batchExportConfigs],(offset,configs)=>{var _configs$count;return{controlled:!0,pageSize:10,currentPage:Math.floor(offset/10)+1,entryCount:null!==(_configs$count=configs?.count)&&void 0!==_configs$count?_configs$count:0,onBackward:()=>actions.loadBatchExports(offset-10),onForward:()=>actions.loadBatchExports(offset+10)}}]}})]);var components=__webpack_require__("./frontend/src/scenes/batch_exports/components.tsx"),utils=__webpack_require__("./frontend/src/scenes/batch_exports/utils.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:BatchExportsListScene};function BatchExportsListScene(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,utils.dv)()&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",to:urls.j.batchExportNew(),children:"Create export workflow"})})}),(0,jsx_runtime.jsx)("p",{children:"Batch exports allow you to export your data to a destination of your choice."}),(0,jsx_runtime.jsx)(BatchExportsList,{})]})}function BatchExportsList(){var _batchExportConfigs$r;let{batchExportConfigs,batchExportConfigsLoading,pagination}=(0,index_esm.useValues)(batchExportsListLogic),{unpause,pause}=(0,index_esm.useActions)(batchExportsListLogic),{user}=(0,index_esm.useValues)(userLogic.userLogic),hasDataPipelines=(0,utils.dv)(),configs=null!==(_batchExportConfigs$r=batchExportConfigs?.results.filter(config=>"HTTP"!==config.destination.type||user?.is_impersonated))&&void 0!==_batchExportConfigs$r?_batchExportConfigs$r:[];return 0!==configs.length||hasDataPipelines?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.LemonTable,{dataSource:configs,loading:batchExportConfigsLoading,pagination:pagination,columns:[{title:"Name",key:"name",width:0,render:function RenderName(_,batchExport){return(0,jsx_runtime.jsx)(src.Link,{className:"font-semibold truncate",to:urls.j.batchExport(batchExport.id),children:batchExport.name})}},{title:"Latest runs",key:"runs",render:function RenderStatus(_,batchExport){return(0,jsx_runtime.jsx)("div",{className:"flex gap-2",children:[...batchExport.latest_runs||[]].reverse()?.map(run=>jsx_runtime.jsx(src.LemonButton,{to:urls.j.batchExport(batchExport.id),className:"flex gap-1",noPadding:!0,children:jsx_runtime.jsx(components.pP,{runs:[run]})},run.id))})}},{title:"Destination",key:"destination",render:function RenderType(_,batchExport){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:batchExport.destination.type})}},{title:"Frequency",key:"frequency",dataIndex:"interval"},{title:"Status",key:"status",width:0,render:function RenderStatus(_,batchExport){return(0,jsx_runtime.jsx)(components.$o,{batchExportConfig:batchExport})}},{width:0,render:function Render(_,batchExport){let menuItems=[{label:"View",to:urls.j.batchExport(batchExport.id)},{label:"Edit",to:urls.j.batchExportEdit(batchExport.id)}];return(hasDataPipelines||!batchExport.paused)&&menuItems.push({label:batchExport.paused?"Resume":"Pause",status:batchExport.paused?"default":"danger",onClick:()=>{batchExport.paused?unpause(batchExport):pause(batchExport)}}),(0,jsx_runtime.jsx)(LemonMenu.d,{items:menuItems,placement:"left",children:(0,jsx_runtime.jsx)(src.LemonButton,{size:"small",noPadding:!0,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{})})})}}]})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}},"./frontend/src/scenes/batch_exports/components.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{pP:()=>BatchExportRunIcon,$o:()=>BatchExportTag});var injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),BatchExports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/batch_exports/BatchExports.scss"),BatchExports_default=__webpack_require__.n(BatchExports),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(BatchExports_default(),options),BatchExports_default().locals;var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function BatchExportTag(_ref){let{batchExportConfig}=_ref;return(0,jsx_runtime.jsx)(Tooltip.u,{title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:batchExportConfig.paused?"This export is paused - no future export runs will be scheduled ":"This export is active - new runs will be triggered at the configured interval."}),children:(0,jsx_runtime.jsx)(src.LemonTag,{type:batchExportConfig.paused?"default":"primary",children:batchExportConfig.paused?"Paused":"Active"})})}let combineFailedStatuses=status=>"FailedRetryable"===status?"Failed":status,colorForStatus=status=>{switch(status){case"Completed":return"success";case"ContinuedAsNew":case"Running":case"Starting":return"primary";case"Cancelled":case"Terminated":case"TimedOut":return"warning";case"Failed":case"FailedRetryable":return"danger";default:return"default"}};function BatchExportRunIcon(_ref2){let{runs,showLabel=!1}=_ref2,latestRun=runs[0],status=combineFailedStatuses(latestRun.status),color=colorForStatus(status);return(0,jsx_runtime.jsx)(Tooltip.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Run status: ",status,runs.length>1&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("br",{}),"Attempts: ",runs.length]})]}),children:(0,jsx_runtime.jsx)("span",{className:(0,clsx_m.default)(`BatchExportRunIcon h-6 p-2 border-2 flex items-center justify-center rounded-full font-semibold text-xs border-${color} text-${color}-dark select-none`,"primary"===color&&"BatchExportRunIcon--pulse",showLabel?"":"w-6"),children:showLabel?(0,jsx_runtime.jsx)("span",{className:"text-center",children:status}):runs.length})})}},"./frontend/src/scenes/batch_exports/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{J0:()=>intervalToFrequency,WT:()=>isRunInProgress,dv:()=>showBatchExports,qY:()=>humanizeDestination});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/types.ts");function intervalToFrequency(interval){return({day:"daily",hour:"hourly","every 5 minutes":"every 5 minutes"})[interval]}function isRunInProgress(run){return["Running","Starting"].includes(run.status)}function humanizeDestination(destination){return"S3"===destination.type?`s3://${destination.config.bucket_name}/${destination.config.prefix}`:"Snowflake"===destination.type?`snowflake:${destination.config.account}:${destination.config.database}:${destination.config.table_name}`:"Postgres"===destination.type?`postgresql://${destination.config.user}:***@${destination.config.host}:${destination.config.port}/${destination.config.database}`:"Redshift"===destination.type?`redshift://${destination.config.user}:***@${destination.config.host}:${destination.config.port}/${destination.config.database}`:"BigQuery"===destination.type?`bigquery:${destination.config.project_id}:${destination.config.dataset_id}:${destination.config.table_id}`:"Unknown"}function showBatchExports(){let{user}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(scenes_userLogic__WEBPACK_IMPORTED_MODULE_1__.userLogic),{hasAvailableFeature}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(scenes_userLogic__WEBPACK_IMPORTED_MODULE_1__.userLogic);return hasAvailableFeature(_types__WEBPACK_IMPORTED_MODULE_2__.P$.DATA_PIPELINES)||user?.is_impersonated==!0}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/batch_exports/BatchExports.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".BatchExportRunIcon--pulse{animation:BatchExportRunIcon__pulse 2s ease-out infinite;outline:2px solid transparent;outline-offset:0}@keyframes BatchExportRunIcon__pulse{0%{outline-color:var(--primary-3000-hover);outline-offset:0}80%{outline-color:transparent;outline-offset:20px}to{outline-color:transparent;outline-offset:20px}}",""]),module.exports=exports}}]);