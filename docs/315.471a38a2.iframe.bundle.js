(window.webpackJsonp=window.webpackJsonp||[]).push([[315],{"./frontend/src/scenes/actions/Action.tsx":function(it,Y,o){"use strict";o.r(Y),o.d(Y,"scene",function(){return qe}),o.d(Y,"Action",function(){return F});var rt=o("./node_modules/core-js/modules/es.array.concat.js"),ve=o("./node_modules/@babel/runtime/helpers/defineProperty.js"),w=o.n(ve),be=o("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Q=o.n(be),ct=o("./node_modules/core-js/modules/es.array.filter.js"),lt=o("./node_modules/core-js/modules/es.object.to-string.js"),dt=o("./node_modules/core-js/modules/es.array.includes.js"),ut=o("./node_modules/core-js/modules/es.string.includes.js"),mt=o("./node_modules/core-js/modules/es.function.name.js"),jt=o("./node_modules/core-js/modules/es.array.map.js"),pt=o("./node_modules/core-js/modules/es.object.keys.js"),ht=o("./node_modules/core-js/modules/es.symbol.js"),vt=o("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),bt=o("./node_modules/core-js/modules/web.dom-collections.for-each.js"),ft=o("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),E=o("./frontend/src/lib/utils.tsx"),Z=o("./frontend/src/lib/components/Link.tsx"),p=o("./node_modules/kea/lib/index.esm.js"),fe=o("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),z=o.n(fe),ge=o("./node_modules/@babel/runtime/regenerator/index.js"),T=o.n(ge),gt=o("./node_modules/core-js/modules/es.array.iterator.js"),Ot=o("./node_modules/core-js/modules/web.dom-collections.iterator.js"),xt=o("./node_modules/core-js/modules/es.regexp.exec.js"),yt=o("./node_modules/core-js/modules/es.string.split.js"),N=o("./frontend/src/lib/api.ts"),Oe=o("./frontend/src/models/actionsModel.ts"),q=o("./frontend/src/lib/components/lemonToast.tsx"),xe=o("./node_modules/kea-loaders/lib/index.js"),_=o("./node_modules/kea-forms/lib/index.js"),B=o("./node_modules/kea-router/lib/index.js"),x=o("./frontend/src/scenes/urls.ts"),ye=o("./frontend/src/scenes/data-management/events/eventDefinitionsTableLogic.ts"),ee=o("./frontend/src/models/tagsModel.ts"),e=o("./node_modules/react/jsx-runtime.js");function te(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function I(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?te(Object(s),!0).forEach(function(a){w()(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):te(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}var ne=Object(p.kea)([Object(p.path)(["scenes","actions","actionEditLogic"]),Object(p.props)({}),Object(p.key)(function(n){return n.id||"new"}),Object(p.connect)({actions:[ee.a,["loadTags"]]}),Object(p.actions)({setAction:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{merge:!0};return{action:t,options:s}},setCreateNew:function(t){return{createNew:t}},actionAlreadyExists:function(t){return{actionId:t}},deleteAction:!0}),Object(p.connect)({actions:[Oe.a,["loadActions"],ye.c,["loadEventDefinitions"]]}),Object(p.reducers)({createNew:[!1,{setCreateNew:function(t,s){var a=s.createNew;return a}}]}),Object(_.forms)(function(n){var t=n.actions,s=n.props;return{action:{defaults:I({},s.action),errors:function(i){var d=i.name;return{name:d?null:"You need to set a name"}},submit:function(i){t.saveAction(i)}}}}),Object(xe.loaders)(function(n){var t=n.props,s=n.values,a=n.actions;return{actionCount:{loadActionCount:function(){var i=z()(T.a.mark(function l(){return T.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.id){r.next=6;break}return r.next=3,N.b.actions.getCount(t.id);case 3:r.t0=r.sent,r.next=7;break;case 6:r.t0=0;case 7:return r.abrupt("return",r.t0);case 8:case"end":return r.stop()}},l)}));function d(){return i.apply(this,arguments)}return d}()},action:[I({},t.action),{setAction:function(d){var l=d.action,h=d.options.merge;return h?I(I({},s.action),l):l},saveAction:function(){var i=z()(T.a.mark(function l(h,r){var c,v;return T.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(c=I({},h),c.steps=c.steps?c.steps.filter(function(K){return K.event}):[],u.prev=2,!c.id){u.next=9;break}return u.next=6,N.b.actions.update(c.id,c,t.temporaryToken);case 6:c=u.sent,u.next=12;break;case 9:return u.next=11,N.b.actions.create(c,t.temporaryToken);case 11:c=u.sent;case 12:r(),u.next=22;break;case 15:if(u.prev=15,u.t0=u.catch(2),u.t0.code!=="unique"){u.next=21;break}return v=u.t0.detail.split(" ").pop(),q.d.error(Object(e.jsxs)(e.Fragment,{children:["Action with this name already exists."," ",Object(e.jsx)(Z.a,{to:x.a.action(v),children:"Click here to edit."})]})),u.abrupt("return",c);case 21:throw u.t0;case 22:return q.d.success("Action saved"),t.onSave(c),a.loadEventDefinitions(null),a.loadActions(),a.loadTags(),u.abrupt("return",c);case 28:case"end":return u.stop()}},l,null,[[2,15]])}));function d(l,h){return i.apply(this,arguments)}return d}()}]}}),Object(p.listeners)(function(n){var t=n.values,s=n.actions;return{deleteAction:function(){Object(E.x)({endpoint:N.b.actions.determineDeleteEndpoint(),object:t.action,callback:function(){B.router.actions.push(x.a.actions()),s.loadActions()}})}}}),Object(p.afterMount)(function(n){var t=n.actions,s=n.props;s.id?t.loadActionCount():t.setAction({name:"",steps:[{isNew:Object(E.Jb)()}]},{merge:!1})})]),At=o("./frontend/src/scenes/actions/Actions.scss"),Ae=o("./frontend/src/scenes/actions/EventName.tsx"),Ce=o("./node_modules/@babel/runtime/helpers/slicedToArray.js"),Se=o.n(Ce),Te=o("./node_modules/react/index.js"),se=o("./frontend/src/scenes/teamLogic.tsx"),G=o("./node_modules/antd/es/button/index.js"),Le=o("./node_modules/antd/es/modal/index.js"),Ee=o("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),oe=o("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts");function R(n){var t,s=n.actionId,a=n.style,i=n.children,d=Object(Te.useState)(!1),l=Se()(d,2),h=l[0],r=l[1],c=Object(p.useValues)(se.a),v=c.currentTeam;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(G.a,{href:Object(oe.b)(v==null||(t=v.app_urls)===null||t===void 0?void 0:t[0],s),style:a,size:"small",onClick:function(u){u.preventDefault(),r(!0)},children:i}),Object(e.jsx)(Le.a,{visible:h,title:s?"Choose the domain on which to edit this action":"Choose the domain on which to create this action",footer:Object(e.jsx)(G.a,{onClick:function(){return r(!1)},children:"Close"}),onCancel:function(){return r(!1)},children:Object(e.jsx)(Ee.a,{actionId:s,type:oe.a.TOOLBAR_URLS})})]})}try{R.displayName="AppEditorLink",R.__docgenInfo={description:"",displayName:"AppEditorLink",props:{actionId:{defaultValue:null,description:"",name:"actionId",required:!1,type:{name:"number"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"]={docgenInfo:R.__docgenInfo,name:"AppEditorLink",path:"frontend/src/lib/components/AppEditorLink/AppEditorLink.tsx#AppEditorLink"})}catch(n){}var Ne=o("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Ie=o("./frontend/src/lib/components/Tooltip.tsx"),M=o("./frontend/src/scenes/actions/hints.tsx"),Pe=o("./node_modules/antd/es/typography/index.js"),ae=o("./node_modules/antd/es/col/index.js"),Fe=o("./node_modules/antd/es/card/index.js"),De=o("./node_modules/antd/es/space/index.js"),A=o("./node_modules/antd/es/radio/index.js"),Ve=o("./node_modules/@ant-design/icons/es/icons/ExportOutlined.js"),ie=o("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),re=o("./frontend/@posthog/lemon-ui/src/index.ts");function ce(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function g(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?ce(Object(s),!0).forEach(function(a){w()(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):ce(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}var le=Pe.a.Text,de="https://posthog.com/docs/user-guides/actions?utm_medium=in-product&utm_campaign=action-page";function $(n){var t=n.step,s=n.actionId,a=n.isOnlyStep,i=n.index,d=n.identifier,l=n.onDelete,h=n.onChange,r=function(v){h(v)};return Object(e.jsx)(ae.a,{span:24,md:12,children:Object(e.jsxs)(Fe.a,{className:"action-step",style:{overflow:"visible"},children:[i>0&&Object(e.jsx)("div",{className:"stateful-badge pos-center-end or",children:"OR"}),Object(e.jsxs)("div",{children:[!a&&Object(e.jsx)("div",{className:"remove-wrapper",children:Object(e.jsx)("button",{type:"button","aria-label":"delete",onClick:l,children:Object(e.jsx)("span",{"aria-hidden":"true",children:"\xD7"})})}),Object(e.jsx)("div",{className:"mb-4",children:Object(e.jsxs)("b",{children:["Match Group #",i+1]})}),Object(e.jsx)(Be,{step:t,sendStep:r}),Object(e.jsxs)("div",{style:{marginTop:t.event==="$pageview"?20:8,paddingBottom:0},children:[t.event==="$autocapture"&&Object(e.jsx)(we,{step:t,sendStep:r,actionId:s}),t.event!=null&&t.event!=="$autocapture"&&t.event!=="$pageview"&&Object(e.jsxs)("div",{style:{marginTop:"2rem"},children:[Object(e.jsx)("label",{children:Object(e.jsx)("b",{children:"Event name: "})}),Object(e.jsx)(Ae.a,{value:t.event,onChange:function(v){return r(g(g({},t),{},{event:v||""}))}}),Object(e.jsx)("br",{}),Object(e.jsxs)("small",{children:[Object(e.jsx)("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer",children:"See documentation"})," ","on how to send custom events in lots of languages."]})]}),t.event==="$pageview"&&Object(e.jsxs)("div",{children:[Object(e.jsx)(P,{step:t,sendStep:r,item:"url",extra_options:Object(e.jsx)(ue,{step:t,sendStep:r}),label:"URL"}),t.url_matching&&t.url_matching in M.a&&Object(e.jsx)("small",{style:{display:"block",marginTop:-12},children:M.a[t.url_matching]})]}),t.event&&Object(e.jsxs)("div",{className:"action-property-filters",children:[Object(e.jsx)("h3",{className:"l3",children:"Filters"}),(!t.properties||t.properties.length===0)&&Object(e.jsx)("div",{className:"text-muted",children:"This match group has no additional filters."}),Object(e.jsx)(Ne.a,{propertyFilters:t.properties,pageKey:d,eventNames:t.event?[t.event]:[],onChange:function(v){r(g(g({},t),{},{properties:v}))},showConditionBadge:!0})]})]})]})]})})}function P(n){var t=function(a){return n.sendStep(g(g({},n.step),{},w()({},n.item,a||null)))};return Object(e.jsxs)("div",{className:"mb-4",children:[Object(e.jsxs)("label",{style:{fontWeight:"bold"},children:[n.label," ",n.extra_options]}),n.caption&&Object(e.jsx)("div",{className:"action-step-caption",children:n.caption}),n.item==="selector"?Object(e.jsx)(re.LemonTextArea,{onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder}):Object(e.jsx)(re.LemonInput,{"data-attr":"edit-action-url-input",allowClear:!0,onChange:t,value:n.step[n.item]||"",placeholder:n.placeholder})]})}function we(n){var t=n.step,s=n.actionId,a=n.sendStep,i=function(){return Object(e.jsx)("div",{className:"text-center",children:Object(e.jsx)("span",{className:"stateful-badge and",children:"AND"})})};return Object(e.jsxs)("div",{children:[Object(e.jsxs)("span",{children:[Object(e.jsxs)(R,{actionId:s,style:{margin:"1rem 0"},children:["Select element on site ",Object(e.jsx)(Ve.a,{})]}),Object(e.jsx)("a",{href:"".concat(de,"#autocapture-based-actions"),target:"_blank",rel:"noopener",style:{marginLeft:8},children:"See documentation."})," "]}),Object(e.jsx)(P,{step:t,sendStep:a,item:"href",label:"Link target equals",caption:Object(e.jsxs)(e.Fragment,{children:["If your element is a link, the location that the link opens (",Object(e.jsx)("code",{children:"href"})," tag)"]})}),Object(e.jsx)(i,{}),Object(e.jsx)(P,{step:t,sendStep:a,item:"text",label:"Text equals",caption:"Text content inside your element"}),Object(e.jsx)(i,{}),Object(e.jsx)(P,{step:t,sendStep:a,item:"selector",label:Object(e.jsxs)(e.Fragment,{children:["HTML selector matches",Object(e.jsx)(Ie.a,{title:"Click here to learn more about supported selectors",children:Object(e.jsx)("a",{href:"".concat(de,"#matching-selectors"),target:"_blank",rel:"noopener",children:Object(e.jsx)(ie.a,{style:{marginLeft:4}})})})]}),placeholder:'button[data-attr="my-id"]',caption:Object(e.jsx)(De.b,{direction:"vertical",children:Object(e.jsxs)(le,{style:{color:"var(--muted)"},children:["CSS selector or an HTML attribute that ideally uniquely identifies your element. Example:"," ",Object(e.jsx)(le,{code:!0,children:'[data-attr="signup"]'})]})})}),Object(e.jsx)("div",{style:{marginBottom:18},children:Object(e.jsx)(i,{})}),Object(e.jsx)(P,{step:t,sendStep:a,item:"url",extra_options:Object(e.jsx)(ue,{step:t,sendStep:a}),label:"Page URL",caption:"Elements will match only when triggered from the URL (particularly useful if you have non-unique elements in different pages)."}),(t==null?void 0:t.url_matching)&&t.url_matching in M.a&&Object(e.jsx)("small",{style:{display:"block",marginTop:-12},children:M.a[t.url_matching]})]})}function Be(n){var t=n.step,s=n.sendStep,a=function(d){var l=d.target.value;l==="$autocapture"?s(g(g({},t),{},{event:"$autocapture"})):l==="event"?s(g(g({},t),{},{event:""})):l==="$pageview"&&s(g(g({},t),{},{event:"$pageview",url:t.url}))};return Object(e.jsx)("div",{className:"type-switcher",children:Object(e.jsxs)(A.a.Group,{buttonStyle:"solid",onChange:a,value:t.event==="$autocapture"||t.event==="$pageview"||t.event===void 0?t.event:"event",children:[Object(e.jsx)(A.a.Button,{value:"$autocapture",children:"Autocapture"}),Object(e.jsx)(A.a.Button,{value:"event",children:"Custom event"}),Object(e.jsx)(A.a.Button,{value:"$pageview",children:"Page view"})]})})}function ue(n){var t=n.step,s=n.sendStep,a=function(d){s(g(g({},t),{},{url_matching:d.target.value}))};return Object(e.jsxs)(A.a.Group,{buttonStyle:"solid",onChange:a,value:t.url_matching||"contains",size:"small",children:[Object(e.jsx)(A.a.Button,{value:"contains",children:"contains"}),Object(e.jsx)(A.a.Button,{value:"regex",children:"matches regex"}),Object(e.jsx)(A.a.Button,{value:"exact",children:"matches exactly"})]})}try{$.displayName="ActionStep",$.__docgenInfo={description:"",displayName:"ActionStep",props:{step:{defaultValue:null,description:"",name:"step",required:!0,type:{name:"ActionStepType"}},actionId:{defaultValue:null,description:"",name:"actionId",required:!0,type:{name:"number"}},isOnlyStep:{defaultValue:null,description:"",name:"isOnlyStep",required:!0,type:{name:"boolean"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!0,type:{name:"string"}},onDelete:{defaultValue:null,description:"",name:"onDelete",required:!0,type:{name:"() => void"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(step: ActionStepType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionStep.tsx#ActionStep"]={docgenInfo:$.__docgenInfo,name:"ActionStep",path:"frontend/src/scenes/actions/ActionStep.tsx#ActionStep"})}catch(n){}var Re=o("./node_modules/antd/es/row/index.js"),Me=o("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),$e=o("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),Ue=o("./frontend/src/lib/components/PageHeader.tsx"),me=o("./frontend/src/lib/components/EditableField/EditableField.tsx"),ke=o("./frontend/src/types.ts"),Ke=o("./frontend/src/scenes/userLogic.ts"),Ye=o("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),C=o("./frontend/src/lib/forms/Field.tsx"),U=o("./frontend/src/lib/components/LemonButton/index.ts"),ze=o("./frontend/src/lib/components/LemonCheckbox/index.ts"),Ge=o("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),Je=o("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),He=o("./frontend/src/lib/components/icons.tsx");function je(n,t){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),s.push.apply(s,a)}return s}function We(n){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?je(Object(s),!0).forEach(function(a){w()(n,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):je(Object(s)).forEach(function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(s,a))})}return n}function k(n){var t=n.action,s=n.id,a=n.onSave,i=n.temporaryToken,d={id:s,action:t,onSave:function(m){return a(m)},temporaryToken:i},l=ne(d),h=Object(p.useValues)(l),r=h.action,c=h.actionLoading,v=h.actionCount,S=h.actionCountLoading,u=Object(p.useActions)(l),K=u.submitAction,_e=u.deleteAction,et=Object(p.useValues)(se.a),H=et.currentTeam,tt=Object(p.useValues)(Ke.a),nt=tt.hasAvailableFeature,st=Object(p.useValues)(ee.a),ot=st.tags,W=H==null?void 0:H.slack_incoming_webhook,pe=function(){return Object(e.jsx)(U.a,{"data-attr":"delete-action-bottom",status:"danger",type:"secondary",onClick:function(){_e()},children:"Delete"})},he=function(){return Object(e.jsx)(U.a,{"data-attr":"cancel-action-bottom",status:"danger",type:"secondary",onClick:function(){B.router.actions.push(x.a.actions())},children:"Cancel"})};return Object(e.jsx)("div",{className:"action-edit-container",children:Object(e.jsxs)(_.Form,{logic:ne,props:d,formKey:"action",enableFormOnSubmit:!0,children:[Object(e.jsx)(Ue.a,{title:Object(e.jsx)(C.a,{name:"name",children:function(m){var j=m.value,b=m.onChange;return Object(e.jsx)(me.a,{name:"name",value:j||"",placeholder:"Name this action",onChange:s?void 0:b,onSave:function(O){b(O),K()},mode:s?void 0:"edit",minLength:1,maxLength:400,"data-attr":"action-name-".concat(s?"edit":"create"),className:"action-name"})}}),caption:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(C.a,{name:"description",children:function(m){var j=m.value,b=m.onChange;return Object(e.jsx)(me.a,{multiline:!0,name:"description",value:j||"",placeholder:"Description (optional)",onChange:s?void 0:b,onSave:function(O){b(O),K()},mode:s?void 0:"edit","data-attr":"action-description",className:"action-description",compactButtons:!0,maxLength:600,paywall:!nt(ke.e.INGESTION_TAXONOMY)})}}),Object(e.jsx)(C.a,{name:"tags",children:function(m){var j=m.value,b=m.onChange;return Object(e.jsx)(Ye.a,{tags:j!=null?j:[],onChange:function(O,X){return b(X)},className:"action-tags",saving:c,tagsAvailable:ot.filter(function(f){var O;return!((O=r.tags)!==null&&O!==void 0&&O.includes(f))})})}})]}),buttons:Object(e.jsxs)(e.Fragment,{children:[s?Object(e.jsx)(U.a,{type:"secondary",to:Object(B.combineUrl)(x.a.sessionRecordings(),{filters:{actions:[{id:s,type:"actions",order:0,name:r.name}]}}).url,sideIcon:Object(e.jsx)(He.IconPlayCircle,{}),"data-attr":"action-view-recordings",children:"View recordings"}):null,s?pe():he()]})}),s&&Object(e.jsx)("div",{className:"input-set",children:Object(e.jsx)("div",{children:Object(e.jsxs)("span",{className:"text-muted mb-2",children:[S&&Object(e.jsx)(Me.a,{}),v!==null&&v>-1&&Object(e.jsxs)(e.Fragment,{children:["This action matches ",Object(e.jsx)("b",{children:Object(E.p)(v)})," events in the last 3 months"]})]})})}),Object(e.jsxs)("div",{style:{overflow:"visible"},children:[Object(e.jsx)("h2",{className:"subtitle",children:"Match groups"}),Object(e.jsxs)("div",{children:["Your action will be triggered whenever ",Object(e.jsx)("b",{children:"any of your match groups"})," are received."," ",Object(e.jsx)("a",{href:"https://posthog.com/docs/features/actions",target:"_blank",children:Object(e.jsx)(ie.a,{})})]}),Object(e.jsx)(C.a,{name:"steps",children:function(m){var j=m.onChange;return Object(e.jsx)("div",{style:{textAlign:"right",marginBottom:12},children:Object(e.jsx)(G.a,{onClick:function(){return j([].concat(Q()(r.steps||[]),[{isNew:Object(E.Jb)()}]))},size:"small",children:"Add another match group"})})}}),Object(e.jsx)(C.a,{name:"steps",children:function(m){var j=m.value,b=m.onChange;return Object(e.jsxs)(Re.a,{gutter:[24,24],children:[Object(e.jsx)(e.Fragment,{children:j.map(function(f,O){var X=String(JSON.stringify(f));return Object(e.jsx)($,{identifier:X,index:O,step:f,actionId:r.id||0,isOnlyStep:!!j&&j.length===1,onDelete:function(){var D,L=f.id?"id":"isNew";b((D=j==null?void 0:j.filter(function(V){return V[L]!==f[L]}))!==null&&D!==void 0?D:[])},onChange:function(D){var L;b((L=j==null?void 0:j.map(function(V){return f.id&&V.id==f.id||f.isNew&&V.isNew===f.isNew?We({id:f.id,isNew:f.isNew},D):V}))!==null&&L!==void 0?L:[])}},O)})}),Object(e.jsx)(ae.a,{span:24,md:12,children:Object(e.jsx)("div",{className:"match-group-add-skeleton",onClick:function(){b([].concat(Q()(r.steps||[]),[{isNew:Object(E.Jb)()}]))},children:Object(e.jsx)($e.a,{style:{fontSize:28,color:"#666666"}})})})]})}})]}),Object(e.jsxs)("div",{className:"my-8",children:[Object(e.jsx)(C.a,{name:"post_to_slack",children:function(m){var j=m.value,b=m.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(ze.a,{id:"webhook-checkbox",checked:!!j,onChange:b,disabled:!W,label:Object(e.jsx)(e.Fragment,{children:"Post to webhook when this action is triggered."})}),Object(e.jsx)("p",{className:"pl-7",children:Object(e.jsxs)(Z.a,{to:"/project/settings#webhook",children:[W?"Configure":"Enable"," this integration in Setup."]})})]})}}),r.post_to_slack&&Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(C.a,{name:"slack_message_format",children:function(m){var j=m.value,b=m.onChange;return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Je.a,{showOptional:!0,children:"Message format"}),Object(e.jsx)(Ge.a,{placeholder:"Default: [action.name] triggered by [person]",value:j,onChange:b,disabled:!W||!r.post_to_slack,"data-attr":"edit-slack-message-format"}),Object(e.jsx)("small",{children:Object(e.jsx)("a",{href:"https://posthog.com/docs/integrate/webhooks/message-formatting",target:"_blank",rel:"noopener noreferrer",children:"See documentation on how to format webhook messages."})})]})}})})]}),Object(e.jsxs)("div",{className:"flex justify-end gap-2",children:[s?pe():he(),Object(e.jsx)(U.a,{"data-attr":"save-action-button",type:"primary",htmlType:"submit",loading:c,children:"Save"})]})]})})}try{k.displayName="ActionEdit",k.__docgenInfo={description:"",displayName:"ActionEdit",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}},action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ActionEditType"}},temporaryToken:{defaultValue:null,description:"",name:"temporaryToken",required:!1,type:{name:"string"}},onSave:{defaultValue:null,description:"",name:"onSave",required:!0,type:{name:"(action: ActionType) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"]={docgenInfo:k.__docgenInfo,name:"ActionEdit",path:"frontend/src/scenes/actions/ActionEdit.tsx#ActionEdit"})}catch(n){}var Xe=o("./frontend/src/scenes/events/index.ts"),Qe=o("./frontend/src/lib/dayjs.ts"),Ze=o("./frontend/src/lib/components/Spinner/Spinner.tsx"),J=Object(p.kea)({props:{},key:function(t){return t.id||"new"},path:function(t){return["scenes","actions","actionLogic",t]},actions:function(){return{checkIsFinished:function(s){return{action:s}},setPollTimeout:function(s){return{pollTimeout:s}},setIsComplete:function(s){return{isComplete:s}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(s,a){var i=a.pollTimeout;return i}}],isComplete:[!1,{setIsComplete:function(s,a){var i=a.isComplete;return i}}]}},selectors:{breadcrumbs:[function(n){return[n.action]},function(n){return[{name:"Data Management",path:x.a.eventDefinitions()},{name:"Actions",path:x.a.actions()},{name:(n==null?void 0:n.name)||"Unnamed",path:n?x.a.action(n.id):void 0}]}]},loaders:function(t){var s=t.actions,a=t.props;return{action:{loadAction:function(){var i=z()(T.a.mark(function l(){var h;return T.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(s.setIsComplete(!1),a.id){c.next=3;break}throw new Error("Cannot fetch an unsaved action from the API.");case 3:return c.next=5,N.b.actions.get(a.id);case 5:return h=c.sent,s.checkIsFinished(h),c.abrupt("return",h);case 8:case"end":return c.stop()}},l)}));function d(){return i.apply(this,arguments)}return d}()}}},listeners:function(t){var s=t.actions,a=t.values;return{checkIsFinished:function(d){var l=d.action;l.is_calculating?s.setPollTimeout(setTimeout(function(){return s.loadAction()},1e3)):(s.setIsComplete(new Date),a.pollTimeout&&clearTimeout(a.pollTimeout))}}},events:function(t){var s=t.values,a=t.actions,i=t.props;return{afterMount:function(){i.id&&a.loadAction()},beforeUnmount:function(){s.pollTimeout&&clearTimeout(s.pollTimeout)}}}}),qe={logic:J,component:F,paramsToProps:function(t){var s=t.params.id;return{id:parseInt(s)}}};function F(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=n.id,s={action_id:t},a=Object(p.useActions)(B.router),i=a.push,d=Object(p.useValues)(J),l=d.action,h=d.isComplete,r=Object(p.useActions)(J),c=r.loadAction;return Object(e.jsxs)(e.Fragment,{children:[(!t||l)&&Object(e.jsx)(k,{id:t,action:l,onSave:function(S){t||i(x.a.action(S.id)),c()}}),t&&(h?Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("p",{children:["This is the list of ",Object(e.jsx)("strong",{children:"recent"})," events that match this action.",l!=null&&l.last_calculated_at?Object(e.jsxs)(e.Fragment,{children:[" ","Last calculated: ",Object(e.jsx)("b",{children:Object(Qe.a)(l.last_calculated_at).fromNow()}),"."]}):""]}),Object(e.jsx)("div",{className:"pt-4 border-t"}),Object(e.jsx)(Xe.b,{fixedFilters:s,sceneUrl:x.a.action(t),fetchMonths:3,pageKey:"action-".concat(t,"-").concat(JSON.stringify(s)),showEventFilter:!1})]}):Object(e.jsxs)("div",{children:[Object(e.jsx)("h2",{className:"subtitle",children:"Matching events"}),Object(e.jsxs)("div",{className:"flex items-center",children:[Object(e.jsx)(Ze.a,{className:"mr-4"}),"Calculating action, please hold on."]})]}))]})}try{F.displayName="Action",F.__docgenInfo={description:"",displayName:"Action",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/actions/Action.tsx#Action"]={docgenInfo:F.__docgenInfo,name:"Action",path:"frontend/src/scenes/actions/Action.tsx#Action"})}catch(n){}}}]);
