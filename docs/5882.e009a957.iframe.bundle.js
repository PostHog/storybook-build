"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[5882],{"./frontend/src/scenes/onboarding/onboardingLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D6:()=>onboardingLogic,Hr:()=>OnboardingStepKey,hQ:()=>getProductUri});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/types.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/scenes/urls.ts"),scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/billing/billingLogic.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),kea_router__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts");let OnboardingStepKey=function(OnboardingStepKey){return OnboardingStepKey.PRODUCT_INTRO="product_intro",OnboardingStepKey.SDKS="sdks",OnboardingStepKey.BILLING="billing",OnboardingStepKey.OTHER_PRODUCTS="other_products",OnboardingStepKey.VERIFY="verify",OnboardingStepKey}({});const getProductUri=productKey=>{switch(productKey){case _types__WEBPACK_IMPORTED_MODULE_1__.Md.PRODUCT_ANALYTICS:return(0,kea_router__WEBPACK_IMPORTED_MODULE_5__.combineUrl)(scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.events(),{onboarding_completed:!0}).url;case _types__WEBPACK_IMPORTED_MODULE_1__.Md.SESSION_REPLAY:return scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.replay();case _types__WEBPACK_IMPORTED_MODULE_1__.Md.FEATURE_FLAGS:return scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.featureFlags();case _types__WEBPACK_IMPORTED_MODULE_1__.Md.SURVEYS:return scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.surveys();default:return scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.default()}},onboardingLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)({props:{},path:["scenes","onboarding","onboardingLogic"],connect:{values:[scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_3__.kr,["billing"],scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic,["currentTeam"]],actions:[scenes_billing_billingLogic__WEBPACK_IMPORTED_MODULE_3__.kr,["loadBillingSuccess"],scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic,["updateCurrentTeamSuccess"]]},actions:{setProduct:product=>({product}),setProductKey:productKey=>({productKey}),completeOnboarding:nextProductKey=>({nextProductKey}),setAllOnboardingSteps:allOnboardingSteps=>({allOnboardingSteps}),setStepKey:stepKey=>({stepKey}),setSubscribedDuringOnboarding:subscribedDuringOnboarding=>({subscribedDuringOnboarding}),goToNextStep:!0,goToPreviousStep:!0,resetStepKey:!0},reducers:()=>({productKey:[null,{setProductKey:(_,_ref)=>{let{productKey}=_ref;return productKey}}],product:[null,{setProduct:(_,_ref2)=>{let{product}=_ref2;return product}}],allOnboardingSteps:[[],{setAllOnboardingSteps:(_,_ref3)=>{let{allOnboardingSteps}=_ref3;return allOnboardingSteps}}],stepKey:["",{setStepKey:(_,_ref4)=>{let{stepKey}=_ref4;return stepKey}}],onCompleteOnboardingRedirectUrl:[scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.default(),{setProductKey:(_,_ref5)=>{let{productKey}=_ref5;return productKey?getProductUri(productKey):scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.default()}}],subscribedDuringOnboarding:[!1,{setSubscribedDuringOnboarding:(_,_ref6)=>{let{subscribedDuringOnboarding}=_ref6;return subscribedDuringOnboarding}}]}),selectors:{totalOnboardingSteps:[s=>[s.allOnboardingSteps],allOnboardingSteps=>allOnboardingSteps.length],currentOnboardingStep:[s=>[s.allOnboardingSteps,s.stepKey],(allOnboardingSteps,stepKey)=>allOnboardingSteps.find((step=>step.props.stepKey===stepKey))||null],hasNextStep:[s=>[s.allOnboardingSteps,s.stepKey],(allOnboardingSteps,stepKey)=>allOnboardingSteps.findIndex((step=>step.props.stepKey===stepKey))<allOnboardingSteps.length-1],hasPreviousStep:[s=>[s.allOnboardingSteps,s.stepKey],(allOnboardingSteps,stepKey)=>allOnboardingSteps.findIndex((step=>step.props.stepKey===stepKey))>0],shouldShowBillingStep:[s=>[s.product,s.subscribedDuringOnboarding],(product,subscribedDuringOnboarding)=>{const hasAllAddons=product?.addons?.every((addon=>addon.subscribed));return!product?.subscribed||!hasAllAddons||subscribedDuringOnboarding}],shouldShowOtherProductsStep:[s=>[s.suggestedProducts],suggestedProducts=>suggestedProducts.length>0],suggestedProducts:[s=>[s.billing,s.product,s.currentTeam],(billing,product,currentTeam)=>billing?.products?.filter((p=>p.type!==product?.type&&!p.contact_support&&!p.inclusion_only&&!currentTeam?.has_completed_onboarding_for?.[p.type]))||[]],isStepKeyInvalid:[s=>[s.stepKey,s.allOnboardingSteps,s.currentOnboardingStep],(stepKey,allOnboardingSteps,currentOnboardingStep)=>stepKey&&allOnboardingSteps.length>0&&!currentOnboardingStep||!stepKey&&allOnboardingSteps.length>0]},listeners:_ref7=>{let{actions,values}=_ref7;return{loadBillingSuccess:()=>{actions.setProduct(values.billing?.products.find((p=>p.type===values.productKey))||null)},setProduct:_ref8=>{let{product}=_ref8;product||(window.location.href=scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.default())},setProductKey:_ref9=>{let{productKey}=_ref9;productKey?values.billing?.products?.length&&actions.setProduct(values.billing?.products.find((p=>p.type===values.productKey))||null):window.location.href=scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.default()},setSubscribedDuringOnboarding:_ref10=>{let{subscribedDuringOnboarding}=_ref10;if(subscribedDuringOnboarding){const productKey=values.productKey||window.location.pathname.split("/")[2];lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_6__.vx.actions.reportSubscribedDuringOnboarding(productKey)}},completeOnboarding:_ref11=>{let{nextProductKey}=_ref11;if(values.productKey){const product=values.productKey;lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_6__.vx.actions.reportOnboardingCompleted(product),nextProductKey&&(actions.setProductKey(nextProductKey),kea_router__WEBPACK_IMPORTED_MODULE_5__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.onboarding(nextProductKey))),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic.actions.updateCurrentTeam({has_completed_onboarding_for:{...values.currentTeam?.has_completed_onboarding_for,[product]:!0}})}},setAllOnboardingSteps:()=>{values.isStepKeyInvalid&&actions.resetStepKey()},setStepKey:()=>{values.isStepKeyInvalid&&actions.resetStepKey()},resetStepKey:()=>{actions.setStepKey(values.allOnboardingSteps[0].props.stepKey)}}},actionToUrl:_ref12=>{let{values}=_ref12;return{setStepKey:_ref13=>{let{stepKey}=_ref13;return stepKey?[`/onboarding/${values.productKey}`,{step:stepKey}]:[`/onboarding/${values.productKey}`]},goToNextStep:()=>{const currentStepIndex=values.allOnboardingSteps.findIndex((step=>step.props.stepKey===values.stepKey)),nextStep=values.allOnboardingSteps[currentStepIndex+1];return nextStep?[`/onboarding/${values.productKey}`,{step:nextStep.props.stepKey}]:[`/onboarding/${values.productKey}`]},goToPreviousStep:()=>{const currentStepIndex=values.allOnboardingSteps.findIndex((step=>step.props.stepKey===values.stepKey)),previousStep=values.allOnboardingSteps[currentStepIndex-1];return previousStep?[`/onboarding/${values.productKey}`,{step:previousStep.props.stepKey}]:[`/onboarding/${values.productKey}`]},updateCurrentTeamSuccess(val){if(values.productKey&&val.payload?.has_completed_onboarding_for?.[values.productKey])return[values.onCompleteOnboardingRedirectUrl]}}},urlToAction:_ref14=>{let{actions,values}=_ref14;return{"/onboarding/:productKey":(_ref15,_ref16)=>{let{productKey}=_ref15,{success,upgraded,step}=_ref16;productKey?((success||upgraded)&&actions.setSubscribedDuringOnboarding(!0),productKey!==values.productKey&&actions.setProductKey(productKey),step?actions.setStepKey(step):actions.resetStepKey()):window.location.href=scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.default()}}}});try{getProductUri.displayName="getProductUri",getProductUri.__docgenInfo={description:"",displayName:"getProductUri",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/onboarding/onboardingLogic.tsx#getProductUri"]={docgenInfo:getProductUri.__docgenInfo,name:"getProductUri",path:"frontend/src/scenes/onboarding/onboardingLogic.tsx#getProductUri"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/products/Products.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Products:()=>Products,scene:()=>scene});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),billingLogic=__webpack_require__("./frontend/src/scenes/billing/billingLogic.ts"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/index.ts"),LemonCard=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCard/LemonCard.tsx"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),onboardingLogic=__webpack_require__("./frontend/src/scenes/onboarding/onboardingLogic.tsx"),types=__webpack_require__("./frontend/src/types.ts"),eventUsageLogic=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts");const productsLogic=(0,index_esm.kea)({path:()=>["scenes","products","productsLogic"],actions:()=>({onSelectProduct:product=>({product})}),listeners:()=>({onSelectProduct:_ref=>{let{product}=_ref;switch(eventUsageLogic.vx.actions.reportOnboardingProductSelected(product),product){case types.Md.PRODUCT_ANALYTICS:return;case types.Md.SESSION_REPLAY:return void teamLogic.teamLogic.actions.updateCurrentTeam({session_recording_opt_in:!0,capture_console_log_opt_in:!0,capture_performance_opt_in:!0});case types.Md.FEATURE_FLAGS:default:return}}})});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const scene={component:Products,logic:productsLogic};function OnboardingCompletedButton(_ref){let{productUrl,onboardingUrl,productKey}=_ref;const{onSelectProduct}=(0,index_esm.useActions)(productsLogic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",status:"muted",to:productUrl,children:"Go to product"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"tertiary",status:"muted",onClick:()=>{onSelectProduct(productKey),lib.router.actions.push(onboardingUrl)},children:"Set up again"})]})}function OnboardingNotCompletedButton(_ref2){let{url,productKey}=_ref2;const{onSelectProduct}=(0,index_esm.useActions)(productsLogic);return(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>{onSelectProduct(productKey),lib.router.actions.push(url)},children:"Get started"})}function ProductCard(_ref3){let{product}=_ref3;const{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),onboardingCompleted=currentTeam?.has_completed_onboarding_for?.[product.type];return(0,jsx_runtime.jsxs)(LemonCard.M,{className:"max-w-80 flex flex-col",children:[(0,jsx_runtime.jsx)("div",{className:"flex mb-2",children:(0,jsx_runtime.jsx)("div",{className:"bg-mid rounded p-2 flex",children:product.image_url?(0,jsx_runtime.jsx)("img",{className:"w-6 h-6",alt:`Logo for PostHog ${product.name}`,src:product.image_url}):(0,jsx_runtime.jsx)(icons.NZQ,{className:"w-6 h-6"})})}),(0,jsx_runtime.jsx)("div",{className:"mb-2",children:(0,jsx_runtime.jsx)("h3",{className:"bold mb-0",children:product.name})}),(0,jsx_runtime.jsx)("p",{className:"grow",children:product.description}),(0,jsx_runtime.jsx)("div",{className:"flex gap-x-2",children:onboardingCompleted?(0,jsx_runtime.jsx)(OnboardingCompletedButton,{productUrl:(0,onboardingLogic.hQ)(product.type),onboardingUrl:urls.j.onboarding(product.type),productKey:product.type}):(0,jsx_runtime.jsx)(OnboardingNotCompletedButton,{url:urls.j.onboarding(product.type),productKey:product.type})})]},product.type)}function Products(){const{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h),{billing}=(0,index_esm.useValues)(billingLogic.kr),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),{updateCurrentTeam}=(0,index_esm.useActions)(teamLogic.teamLogic),isFirstProduct=0===Object.keys(currentTeam?.has_completed_onboarding_for||{}).length,products=billing?.products||[];return(0,react.useEffect)((()=>{"test"!==featureFlags[constants.y8.PRODUCT_SPECIFIC_ONBOARDING]&&(location.href=urls.j.ingestion())}),[]),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full h-full p-6 items-center justify-center bg-mid",children:[(0,jsx_runtime.jsxs)("div",{className:"mb-8",children:[(0,jsx_runtime.jsxs)("h1",{className:"text-center text-4xl",children:["Pick your ",isFirstProduct?"first":"next"," product."]}),(0,jsx_runtime.jsxs)("p",{className:"text-center",children:["Pick your ",isFirstProduct?"first":"next"," product to get started with. You can set up any others you'd like later."]})]}),products.length>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex w-full max-w-xl justify-center gap-6 flex-wrap",children:products.filter((product=>!product.contact_support&&!product.inclusion_only)).map((product=>(0,jsx_runtime.jsx)(ProductCard,{product},product.type)))}),(0,jsx_runtime.jsx)("div",{className:"mt-20",children:(0,jsx_runtime.jsx)(src.LemonButton,{status:"muted",onClick:()=>{updateCurrentTeam({has_completed_onboarding_for:{...currentTeam?.has_completed_onboarding_for,skipped_onboarding:!0}}),lib.router.actions.replace(urls.j.default())},size:"small",children:"None of these"})})]}):(0,jsx_runtime.jsx)(Spinner.$,{className:"text-3xl"})]})}}}]);