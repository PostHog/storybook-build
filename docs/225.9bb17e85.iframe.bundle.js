(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{4357:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"d",(function(){return UTM_TAGS})),__webpack_require__.d(__webpack_exports__,"b",(function(){return JSSnippet})),__webpack_require__.d(__webpack_exports__,"c",(function(){return PythonSnippet})),__webpack_require__.d(__webpack_exports__,"a",(function(){return APISnippet}));__webpack_require__(39);var react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1),scenes_ingestion_frameworks_CodeSnippet__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(50),lib_components_icons__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(35),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(29),UTM_TAGS="?utm_medium=in-product&utm_campaign=feature-flag";function JSSnippet(_ref){var flagKey=_ref.flagKey,variants=_ref.variants;return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_1___default.a.Fragment,null,(null==variants?void 0:variants.length)?react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(scenes_ingestion_frameworks_CodeSnippet__WEBPACK_IMPORTED_MODULE_3__.a,{language:scenes_ingestion_frameworks_CodeSnippet__WEBPACK_IMPORTED_MODULE_3__.b.JavaScript,wrap:!0},"if (posthog.getFeatureFlag('".concat(null!=flagKey?flagKey:"","') === '").concat(variants[0],"') {\n    // where '").concat(variants[0],"' is the variant, run your code here\n}")):react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(scenes_ingestion_frameworks_CodeSnippet__WEBPACK_IMPORTED_MODULE_3__.a,{language:scenes_ingestion_frameworks_CodeSnippet__WEBPACK_IMPORTED_MODULE_3__.b.JavaScript,wrap:!0},"if (posthog.isFeatureEnabled('".concat(null!=flagKey?flagKey:"","')) {\n    // run your activation code here\n}")),react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("div",{className:"mt"},"Need more information?"," ",react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/js-integration".concat(UTM_TAGS,"#feature-flags")},"Check the docs ",react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(lib_components_icons__WEBPACK_IMPORTED_MODULE_4__.IconOpenInNew,null))))}function PythonSnippet(_ref2){var flagKey=_ref2.flagKey;return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_1___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(scenes_ingestion_frameworks_CodeSnippet__WEBPACK_IMPORTED_MODULE_3__.a,{language:scenes_ingestion_frameworks_CodeSnippet__WEBPACK_IMPORTED_MODULE_3__.b.Python,wrap:!0},'if posthog.feature_enabled("'.concat(flagKey,'", "user_distinct_id"):\n    runAwesomeFeature()\n')),react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("div",{className:"mt"},"Need more information?"," ",react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/python-integration".concat(UTM_TAGS,"#feature-flags")},"Check the docs ",react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(lib_components_icons__WEBPACK_IMPORTED_MODULE_4__.IconOpenInNew,null))))}function APISnippet(){var currentTeam=Object(kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(scenes_teamLogic__WEBPACK_IMPORTED_MODULE_5__.a).currentTeam;return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_1___default.a.Fragment,null,react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(scenes_ingestion_frameworks_CodeSnippet__WEBPACK_IMPORTED_MODULE_3__.a,{language:scenes_ingestion_frameworks_CodeSnippet__WEBPACK_IMPORTED_MODULE_3__.b.Bash,wrap:!0},"curl ".concat(window.location.origin,"/decide/ \\\n-X POST -H 'Content-Type: application/json' \\\n-d '{\n    \"api_key\": \"").concat(currentTeam?currentTeam.api_token:"[project_api_key]",'",\n    "distinct_id": "[user distinct id]"\n}\'\n                ')),react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("div",{className:"mt"},"Need more information?"," ",react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/api/feature-flags".concat(UTM_TAGS)},"Check the docs ",react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(lib_components_icons__WEBPACK_IMPORTED_MODULE_4__.IconOpenInNew,null))))}try{JSSnippet.displayName="JSSnippet",JSSnippet.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}},variants:{defaultValue:null,description:"",name:"variants",required:!1,type:{name:"string[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:JSSnippet.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(__react_docgen_typescript_loader_error){}try{PythonSnippet.displayName="PythonSnippet",PythonSnippet.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:PythonSnippet.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(__react_docgen_typescript_loader_error){}},4363:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return experimentsLogic}));__webpack_require__(39),__webpack_require__(62),__webpack_require__(45),__webpack_require__(40),__webpack_require__(51);var regenerator=__webpack_require__(6),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(68),__webpack_require__(11)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),index_esm=__webpack_require__(1),api=(__webpack_require__(87),__webpack_require__(3),__webpack_require__(20)),constants=(__webpack_require__(22),__webpack_require__(23));var api_mock_api=api.a;constants.s.Admin,constants.s.Admin;var teamLogic=__webpack_require__(29),CheckCircleOutlined=__webpack_require__(452),react_toastify=__webpack_require__(67),react=__webpack_require__(0),react_default=__webpack_require__.n(react),experimentsLogic=Object(index_esm.kea)({path:["scenes","experiments","experimentsLogic"],connect:{values:[teamLogic.a,["currentTeamId"]]},actions:{},loaders:function loaders(_ref){var _deleteExperiment,_loadExperiments,values=_ref.values;return{experiments:[[],{loadExperiments:(_loadExperiments=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var response;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,api_mock_api.get("api/projects/".concat(values.currentTeamId,"/experiments"));case 2:return response=_context.sent,_context.abrupt("return",response.results);case 4:case"end":return _context.stop()}}),_callee)}))),function loadExperiments(){return _loadExperiments.apply(this,arguments)}),deleteExperiment:(_deleteExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(id){return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,api_mock_api.delete("api/projects/".concat(values.currentTeamId,"/experiments/").concat(id));case 2:return Object(react_toastify.c)(react_default.a.createElement("div",null,react_default.a.createElement("h1",{className:"text-success"},react_default.a.createElement(CheckCircleOutlined.a,null)," Experiment removed"))),_context2.abrupt("return",values.experiments.filter((function(experiment){return experiment.id!==id})));case 4:case"end":return _context2.stop()}}),_callee2)}))),function deleteExperiment(_x){return _deleteExperiment.apply(this,arguments)})}]}},events:function events(_ref2){var actions=_ref2.actions;return{afterMount:function afterMount(){actions.loadExperiments()}}}})},4473:function(module,exports,__webpack_require__){(exports=__webpack_require__(47)(!1)).push([module.i,'.mixin-gradient-overlay{width:100%;height:3rem;background:linear-gradient(0deg,#fff,transparent)}.mixin-gradient-overlay,.mixin-gradient-overlay-right{content:"";position:absolute;pointer-events:none;bottom:0}.mixin-gradient-overlay-right{width:3rem;height:100%;background:linear-gradient(270deg,#fff,transparent)}.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.experiment-form .metrics-selection,.experiment-result .metrics-selection{border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;margin-top:1rem}.experiment-form .metrics-selection .action-filters-bordered .draggable-action-filter,.experiment-result .metrics-selection .action-filters-bordered .draggable-action-filter{border-bottom:1px solid rgba(0,0,0,.15);padding:1rem .25rem;margin-top:0}.experiment-form .metrics-selection .action-filters-bordered .row-action-btn,.experiment-result .metrics-selection .action-filters-bordered .row-action-btn{color:#35416b}.experiment-form .metrics-selection.person-selection label,.experiment-result .metrics-selection.person-selection label{font-size:16px;font-weight:600}.experiment-form .insights-graph-container,.experiment-result .insights-graph-container{margin-bottom:1rem;background-color:#fafaf9}.experiment-form .insights-graph-container .ant-card-head,.experiment-result .insights-graph-container .ant-card-head{border-bottom:1px solid rgba(0,0,0,.15);min-height:unset;background-color:#fff;padding-left:1rem;padding-right:1rem}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title,.experiment-result .insights-graph-container .ant-card-head .ant-card-head-title{padding:.5rem 0}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter,.experiment-result .insights-graph-container .ant-card-head .ant-card-head-title span.filter{font-size:14px}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter:not(:last-child),.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter span.head-title-item,.experiment-result .insights-graph-container .ant-card-head .ant-card-head-title span.filter:not(:last-child),.experiment-result .insights-graph-container .ant-card-head .ant-card-head-title span.filter span.head-title-item{margin-right:.5rem}.experiment-form .insights-graph-container .display-config-inner,.experiment-result .insights-graph-container .display-config-inner{display:flex;align-items:center;justify-content:space-between;overflow-x:auto}.experiment-form .insights-graph-container .ant-card-body,.experiment-result .insights-graph-container .ant-card-body{padding:0}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left,.experiment-result .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left{width:100%}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right,.experiment-result .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right{width:100%;height:min(calc(90vh - 16rem),36rem);max-width:300px;padding:0 1rem 1rem 0;display:flex;align-items:center}.experiment-form .insights-graph-container .graph-container,.experiment-result .insights-graph-container .graph-container{width:calc(100% - 48px);height:calc(100% - 48px);margin-top:2rem}.experiment-form .insights-graph-header,.experiment-result .insights-graph-header{margin-top:0!important;margin-bottom:0!important;padding-left:1rem;padding-right:1rem;min-height:48px}.experiment-form .mde-selection,.experiment-result .mde-selection{border-top:1px solid rgba(0,0,0,.15);background-color:#f2f2f2;padding:12px 16px;margin-bottom:1rem}.experiment-form .mde-selection .ant-slider-handle,.experiment-result .mde-selection .ant-slider-handle{z-index:3}.experiment-form .mde-selection .ant-slider-track,.experiment-result .mde-selection .ant-slider-track{z-index:2}.experiment-form .mde-selection .ant-slider-step,.experiment-result .mde-selection .ant-slider-step{background:#a9a9a9}.experiment-form .mde-selection .estimates .estimate,.experiment-result .mde-selection .estimates .estimate{font-weight:500;color:rgba(0,0,0,.5);font-size:12px}',""]),module.exports=exports},4474:function(module,exports,__webpack_require__){"use strict";var _interopRequireWildcard=__webpack_require__(69),_interopRequireDefault=__webpack_require__(21);Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _objectSpread2=_interopRequireDefault(__webpack_require__(78)),React=_interopRequireWildcard(__webpack_require__(0)),_SaveOutlined=_interopRequireDefault(__webpack_require__(4475)),_AntdIcon=_interopRequireDefault(__webpack_require__(103)),SaveOutlined=function SaveOutlined(props,ref){return React.createElement(_AntdIcon.default,(0,_objectSpread2.default)((0,_objectSpread2.default)({},props),{},{ref:ref,icon:_SaveOutlined.default}))};SaveOutlined.displayName="SaveOutlined";var _default=React.forwardRef(SaveOutlined);exports.default=_default},4475:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"}},4721:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Experiment",(function(){return Experiment_Experiment}));__webpack_require__(250),__webpack_require__(267),__webpack_require__(62),__webpack_require__(33),__webpack_require__(63),__webpack_require__(561);var defineProperty=__webpack_require__(3),defineProperty_default=__webpack_require__.n(defineProperty),slicedToArray=__webpack_require__(13),slicedToArray_default=__webpack_require__.n(slicedToArray),SaveOutlined=__webpack_require__(4474),SaveOutlined_default=__webpack_require__.n(SaveOutlined),es_form=__webpack_require__(454),row=__webpack_require__(343),es_button=__webpack_require__(133),input=__webpack_require__(500),col=__webpack_require__(249),card=__webpack_require__(4253),slider=__webpack_require__(4703),tooltip=__webpack_require__(288),collapse=__webpack_require__(4250),es_alert=__webpack_require__(750),index_esm=__webpack_require__(1),PageHeader=__webpack_require__(344),PropertyFilters=__webpack_require__(433),utils=__webpack_require__(143),types=__webpack_require__(36),react=__webpack_require__(0),react_default=__webpack_require__.n(react),funnelLogic=__webpack_require__(65),ActionFilter=__webpack_require__(287),insightLogic=__webpack_require__(31),src_types=__webpack_require__(5),injectStylesIntoStyleTag=__webpack_require__(17),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Experiment=__webpack_require__(4473),Experiment_default=__webpack_require__.n(Experiment),options={insert:"head",singleton:!1},regenerator=(injectStylesIntoStyleTag_default()(Experiment_default.a,options),Experiment_default.a.locals,__webpack_require__(39),__webpack_require__(45),__webpack_require__(40),__webpack_require__(119),__webpack_require__(51),__webpack_require__(6)),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(68),__webpack_require__(11)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),api=__webpack_require__(20),dayjs=__webpack_require__(42),lib_utils=__webpack_require__(10),randomAnimal=__webpack_require__(2446),react_toastify=__webpack_require__(67),cleanFilters=__webpack_require__(129),teamLogic=__webpack_require__(29),urls=__webpack_require__(18),lib=__webpack_require__(22),experimentsLogic=__webpack_require__(4363);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var experimentLogic=Object(index_esm.kea)({path:["scenes","experiment","experimentLogic"],connect:{values:[teamLogic.a,["currentTeamId"]],actions:[experimentsLogic.a,["loadExperiments"]]},actions:{setExperimentResults:function setExperimentResults(experimentResults){return{experimentResults:experimentResults}},setExperiment:function setExperiment(experiment){return{experiment:experiment}},createExperiment:function createExperiment(draft){return{draft:draft}},setExperimentFunnelId:function setExperimentFunnelId(shortId){return{shortId:shortId}},createNewExperimentFunnel:function createNewExperimentFunnel(filters){return{filters:filters}},setFilters:function setFilters(filters){return{filters:filters}},setExperimentId:function setExperimentId(experimentId){return{experimentId:experimentId}},setNewExperimentData:function setNewExperimentData(experimentData){return{experimentData:experimentData}},nextPage:!0,prevPage:!0,setPage:function setPage(page){return{page:page}},emptyData:!0,endExperiment:!0},reducers:{experimentId:[null,{setExperimentId:function setExperimentId(_,_ref){return _ref.experimentId}}],newExperimentData:[null,{setNewExperimentData:function setNewExperimentData(vals,_ref2){var experimentData=_ref2.experimentData;if(experimentData.filters){var newFilters=_objectSpread(_objectSpread({},null==vals?void 0:vals.filters),experimentData.filters);return _objectSpread(_objectSpread(_objectSpread({},vals),experimentData),{},{filters:newFilters})}return _objectSpread(_objectSpread({},vals),experimentData)},emptyData:function emptyData(){return null}}],experimentResults:[null,{setExperimentResults:function setExperimentResults(_,_ref3){return _ref3.experimentResults}}],experimentFunnelId:[null,{setExperimentFunnelId:function setExperimentFunnelId(_,_ref4){return _ref4.shortId}}],newExperimentCurrentPage:[0,{nextPage:function nextPage(page){return page+1},prevPage:function prevPage(page){return page-1},setPage:function setPage(_,_ref5){return _ref5.page}}]},listeners:function listeners(_ref6){var _endExperiment,_loadExperiment,_createNewExperimentFunnel,_createExperiment,values=_ref6.values,actions=_ref6.actions;return{createExperiment:(_createExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(_ref7){var draft,_values$newExperiment;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(draft=_ref7.draft,_context.prev=1,!(null===(_values$newExperiment=values.newExperimentData)||void 0===_values$newExperiment?void 0:_values$newExperiment.id)){_context.next=7;break}return _context.next=5,api.a.update("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId),{start_date:Object(dayjs.a)()});case 5:_context.next=9;break;case 7:return _context.next=9,api.a.create("api/projects/".concat(values.currentTeamId,"/experiments"),_objectSpread(_objectSpread({},values.newExperimentData),!draft&&{start_date:Object(dayjs.a)()}));case 9:_context.next=15;break;case 11:return _context.prev=11,_context.t0=_context.catch(1),Object(lib_utils.z)("Error creating your experiment","Attempting to create this experiment returned an error:",0!==_context.t0.status?_context.t0.detail:"Check your internet connection and make sure you don't have an extension blocking our requests.",_context.t0.code),_context.abrupt("return");case 15:react_toastify.c.success(react_default.a.createElement("div",{"data-attr":"success-toast"},react_default.a.createElement("h1",null,"Experimentation created successfully!"),react_default.a.createElement("p",null,"Click here to go back to the experiments list.")),{onClick:function onClick(){actions.loadExperiments(),lib.router.actions.push(urls.a.experiments())},closeOnClick:!0});case 16:case"end":return _context.stop()}}),_callee,null,[[1,11]])}))),function createExperiment(_x){return _createExperiment.apply(this,arguments)}),createNewExperimentFunnel:(_createNewExperimentFunnel=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(_ref8){var filters,newInsight,createdInsight;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return filters=_ref8.filters,newInsight={name:Object(randomAnimal.a)(),description:"",tags:[],filters:Object(cleanFilters.a)(_objectSpread({insight:src_types.n.FUNNELS,funnel_viz_type:src_types.l.Steps,date_from:Object(dayjs.a)().subtract(14,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(dayjs.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},filters)),result:null},_context2.next=4,api.a.create("api/projects/".concat(teamLogic.a.values.currentTeamId,"/insights"),newInsight);case 4:createdInsight=_context2.sent,actions.setExperimentFunnelId(createdInsight.short_id);case 6:case"end":return _context2.stop()}}),_callee2)}))),function createNewExperimentFunnel(_x2){return _createNewExperimentFunnel.apply(this,arguments)}),loadExperiment:(_loadExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(){var response;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.prev=0,_context3.next=3,api.a.get("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId,"/results"));case 3:response=_context3.sent,actions.setExperimentResults(_objectSpread(_objectSpread({},response),{},{itemID:Math.random().toString(36).substring(2,15)})),_context3.next=11;break;case 7:_context3.prev=7,_context3.t0=_context3.catch(0),Object(lib_utils.z)("Error loading experiment results","Attempting to load results returned an error:",0!==_context3.t0.status?_context3.t0.detail:"Check your internet connection and make sure you don't have an extension blocking our requests.",_context3.t0.code),actions.setExperimentResults(null);case 11:case"end":return _context3.stop()}}),_callee3,null,[[0,7]])}))),function loadExperiment(){return _loadExperiment.apply(this,arguments)}),setFilters:function setFilters(_ref9){var _funnelLogic$findMoun,filters=_ref9.filters;null===(_funnelLogic$findMoun=funnelLogic.a.findMounted({dashboardItemId:values.experimentFunnelId}))||void 0===_funnelLogic$findMoun||_funnelLogic$findMoun.actions.setFilters(filters)},loadExperimentSuccess:function loadExperimentSuccess(_ref10){var experimentData=_ref10.experimentData;(null==experimentData?void 0:experimentData.start_date)||(actions.createNewExperimentFunnel(null==experimentData?void 0:experimentData.filters),actions.setPage(2),actions.setNewExperimentData(_objectSpread({},experimentData)))},endExperiment:(_endExperiment=asyncToGenerator_default()(regenerator_default.a.mark((function _callee4(){return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,api.a.update("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId),{end_date:Object(dayjs.a)()});case 2:case"end":return _context4.stop()}}),_callee4)}))),function endExperiment(){return _endExperiment.apply(this,arguments)})}},loaders:function loaders(_ref11){var _loadExperiment2,values=_ref11.values;return{experimentData:[null,{loadExperiment:(_loadExperiment2=asyncToGenerator_default()(regenerator_default.a.mark((function _callee5(){var response;return regenerator_default.a.wrap((function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!values.experimentId||"new"===values.experimentId){_context5.next=5;break}return _context5.next=3,api.a.get("api/projects/".concat(values.currentTeamId,"/experiments/").concat(values.experimentId));case 3:return response=_context5.sent,_context5.abrupt("return",response);case 5:return _context5.abrupt("return",null);case 6:case"end":return _context5.stop()}}),_callee5)}))),function loadExperiment(){return _loadExperiment2.apply(this,arguments)})}]}},selectors:{breadcrumbs:[function(s){return[s.experimentData,s.experimentId]},function(experimentData,experimentId){return[{name:"Experiments",path:urls.a.experiments()},{name:(null==experimentData?void 0:experimentData.name)||"New Experiment",path:urls.a.experiment(experimentId||"new")}]}],minimimumDetectableChange:[function(s){return[s.newExperimentData]},function(newExperimentData){var _newExperimentData$pa;return(null==newExperimentData||null===(_newExperimentData$pa=newExperimentData.parameters)||void 0===_newExperimentData$pa?void 0:_newExperimentData$pa.minimum_detectable_effect)||5}],recommendedSampleSize:[function(s){return[s.minimimumDetectableChange]},function(mde){return function(conversionRate){return 2*Math.ceil(1600*conversionRate*(1-conversionRate/100)/(mde*mde))}}],expectedRunningTime:[function(){return[]},function(){return function(entrants,sampleSize){return parseFloat((sampleSize/(entrants/14)).toFixed(1))}}]},urlToAction:function urlToAction(_ref12){var actions=_ref12.actions,values=_ref12.values;return{"/experiments/:id":function experimentsId(_ref13){var id=_ref13.id;if(id){var parsedId="new"===id?"new":parseInt(id);"new"===parsedId&&(actions.createNewExperimentFunnel(),actions.emptyData(),actions.setPage(0)),parsedId!==values.experimentId&&actions.setExperimentId(parsedId),"new"!==parsedId&&actions.loadExperiment()}}}}}),InsightContainer=__webpack_require__(1744),FeatureFlagSnippets=__webpack_require__(4357),icons=__webpack_require__(35),InfoCircleOutlined=__webpack_require__(732),dayjs_min=__webpack_require__(145),dayjs_min_default=__webpack_require__.n(dayjs_min),LemonButton=__webpack_require__(92);function Experiment_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function Experiment_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?Experiment_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):Experiment_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var scene={component:Experiment_Experiment,logic:experimentLogic};function Experiment_Experiment(){var _results$,_ref,_newExperimentData$fi,_newExperimentData$fi2,_experimentData$creat,_useValues=Object(index_esm.useValues)(experimentLogic),newExperimentData=_useValues.newExperimentData,experimentId=_useValues.experimentId,experimentData=_useValues.experimentData,experimentFunnelId=_useValues.experimentFunnelId,minimimumDetectableChange=_useValues.minimimumDetectableChange,recommendedSampleSize=_useValues.recommendedSampleSize,expectedRunningTime=_useValues.expectedRunningTime,newExperimentCurrentPage=_useValues.newExperimentCurrentPage,experimentResults=_useValues.experimentResults,_useActions=Object(index_esm.useActions)(experimentLogic),setNewExperimentData=_useActions.setNewExperimentData,createExperiment=_useActions.createExperiment,_setFilters=_useActions.setFilters,nextPage=_useActions.nextPage,prevPage=_useActions.prevPage,endExperiment=_useActions.endExperiment,_Form$useForm=es_form.a.useForm(),form=slicedToArray_default()(_Form$useForm,1)[0],insightProps=Object(index_esm.useValues)(Object(insightLogic.b)({dashboardItemId:experimentFunnelId,syncWithUrl:!1})).insightProps,_useValues3=Object(index_esm.useValues)(Object(funnelLogic.a)(insightProps)),isStepsEmpty=_useValues3.isStepsEmpty,filterSteps=_useValues3.filterSteps,filters=_useValues3.filters,results=_useValues3.results,conversionRate=100*_useValues3.conversionMetrics.totalRate,entrants=null==results||null===(_results$=results[0])||void 0===_results$?void 0:_results$.count;return react_default.a.createElement(react_default.a.Fragment,null,"new"!==experimentId&&(null==experimentData?void 0:experimentData.start_date)?experimentData?react_default.a.createElement("div",{className:"experiment-result"},experimentData.end_date&&react_default.a.createElement(es_alert.a,{type:"info",message:"This experiment has ended"}),react_default.a.createElement("div",null,react_default.a.createElement(PageHeader.a,{title:experimentData.name}),react_default.a.createElement("div",null,null==experimentData?void 0:experimentData.description),react_default.a.createElement("div",null,"Owner: ",null===(_experimentData$creat=experimentData.created_by)||void 0===_experimentData$creat?void 0:_experimentData$creat.first_name),react_default.a.createElement("div",null,"Feature flag key: ",null==experimentData?void 0:experimentData.feature_flag_key)),experimentResults&&react_default.a.createElement(index_esm.BindLogic,{logic:insightLogic.b,props:{dashboardItemId:experimentResults.itemID,filters:Experiment_objectSpread(Experiment_objectSpread({},experimentResults.filters),{},{insight:"FUNNELS",funnel_viz_type:src_types.l.Steps,display:"FunnelViz"}),cachedResults:experimentResults.funnel,syncWithUrl:!1,doNotLoad:!0}},react_default.a.createElement("div",null,react_default.a.createElement(PageHeader.a,{title:"Results"}),react_default.a.createElement("div",null,"Probability: ",experimentResults.probability),react_default.a.createElement(InsightContainer.a,{disableTable:!0}))),experimentData.end_date?react_default.a.createElement("div",null,"Experiment ended ",dayjs_min_default()(experimentData.end_date)):react_default.a.createElement(LemonButton.a,{onClick:function onClick(){return endExperiment()}},"End experiment")):react_default.a.createElement("div",null,"Loading..."):react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(row.a,{align:"middle",justify:"space-between",style:{borderBottom:"1px solid var(--border)",marginBottom:"1rem",paddingBottom:8}},react_default.a.createElement(PageHeader.a,{title:(null==newExperimentData?void 0:newExperimentData.name)||"New Experiment"}),react_default.a.createElement(es_button.a,{style:{color:"var(--primary)",borderColor:"var(--primary)"},onClick:function onClick(){return createExperiment(!0)}},"Save as draft")),react_default.a.createElement(es_form.a,{name:"new-experiment",layout:"vertical",className:"experiment-form",form:form,onValuesChange:function onValuesChange(values){return setNewExperimentData(values)},initialValues:{name:null==newExperimentData?void 0:newExperimentData.name,feature_flag_key:null==newExperimentData?void 0:newExperimentData.feature_flag_key,description:null==newExperimentData?void 0:newExperimentData.description},onFinish:function onFinish(values){setNewExperimentData(values),nextPage()}},0===newExperimentCurrentPage&&react_default.a.createElement("div",null,react_default.a.createElement(es_form.a.Item,{label:"Name",name:"name",rules:[{required:!0,message:"You have to enter a name."}]},react_default.a.createElement(input.a,{"data-attr":"experiment-name",className:"ph-ignore-input"})),react_default.a.createElement(es_form.a.Item,{label:"Feature flag key",name:"feature_flag_key",rules:[{required:!0,message:"You have to enter a feature flag key."}]},react_default.a.createElement(input.a,{"data-attr":"experiment-feature-flag-key"})),react_default.a.createElement(es_form.a.Item,{label:"Description",name:"description"},react_default.a.createElement(input.a.TextArea,{"data-attr":"experiment-description",className:"ph-ignore-input",placeholder:"Adding a helpful description can ensure others know what this experiment is about."})),react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(SaveOutlined_default.a,null),type:"primary",htmlType:"submit"},"Save and continue")),1===newExperimentCurrentPage&&react_default.a.createElement("div",null,react_default.a.createElement(row.a,{className:"person-selection"},react_default.a.createElement(col.a,null,react_default.a.createElement("div",{className:"l3 mb"},"Person selection"),react_default.a.createElement("div",{className:"text-muted"},"Select the persons who will participate in this experiment. We'll split all persons evenly in a control and experiment group."),react_default.a.createElement("div",{style:{flex:3,marginRight:5}},react_default.a.createElement(PropertyFilters.b,{endpoint:"person",pageKey:"EditFunnel-property",propertyFilters:filters.properties||[],onChange:function onChange(anyProperties){setNewExperimentData({filters:{properties:anyProperties}}),_setFilters({properties:anyProperties.filter(utils.b)})},style:{margin:"1rem 0 0"},taxonomicGroupTypes:[types.a.PersonProperties,types.a.CohortsWithAllUsers],popoverPlacement:"top",taxonomicPopoverPlacement:"auto"})))),react_default.a.createElement(row.a,{className:"metrics-selection"},react_default.a.createElement(index_esm.BindLogic,{logic:insightLogic.b,props:insightProps},react_default.a.createElement(row.a,{style:{width:"100%"}},react_default.a.createElement(col.a,{span:8,style:{paddingRight:8}},react_default.a.createElement("div",{className:"l3 mb"},"Goal metric"),react_default.a.createElement(row.a,{className:"text-muted",style:{marginBottom:"1rem"}},"Define the metric which you are trying to optimize. This is the most important part of your experiment."),react_default.a.createElement(row.a,null,react_default.a.createElement(card.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},react_default.a.createElement(ActionFilter.a,{filters:filters,setFilters:function setFilters(actionFilters){setNewExperimentData({filters:actionFilters}),_setFilters(actionFilters)},typeKey:"EditFunnel-action",hideMathSelector:!0,hideDeleteBtn:1===filterSteps.length,buttonCopy:"Add funnel step",showSeriesIndicator:!isStepsEmpty,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[types.a.EventProperties,types.a.PersonProperties,types.a.Cohorts,types.a.Elements],rowClassName:"action-filters-bordered"})))),react_default.a.createElement(col.a,{span:16},react_default.a.createElement(InsightContainer.a,{disableTable:!0}))))),react_default.a.createElement(row.a,{className:"mde-selection"},react_default.a.createElement(row.a,{style:{width:"100%",marginBottom:8},align:"middle",justify:"center"},react_default.a.createElement(row.a,{style:{width:"100%",fontWeight:500,fontSize:16},className:"text-muted",justify:"center"},"Estimates for how long your experiment should run."),react_default.a.createElement(col.a,{span:8},react_default.a.createElement(slider.a,{defaultValue:5,min:1,max:50,trackStyle:{background:"black"},onChange:function onChange(value){setNewExperimentData({parameters:{minimum_detectable_effect:value}})},tipFormatter:function tipFormatter(value){return"".concat(value,"%")},marks:Math.floor(conversionRate)>0?(_ref={},defineProperty_default()(_ref,Math.floor(conversionRate),"".concat(Math.floor(conversionRate),"%")),defineProperty_default()(_ref,5,"5%"),defineProperty_default()(_ref,10,"10%"),_ref):{5:"5%",10:"10%"}}))),react_default.a.createElement(row.a,{style:{width:"100%"},justify:"center",className:"estimates"},react_default.a.createElement("div",{style:{paddingRight:16,fontWeight:600,fontSize:18}},react_default.a.createElement("div",{className:"text-center"},conversionRate.toFixed(1),"%"),react_default.a.createElement("div",{className:"estimate"},"Baseline conversion rate")),react_default.a.createElement("div",{style:{paddingLeft:16,paddingRight:16,borderLeft:"1px solid var(--border)",borderRight:"1px solid var(--border)",fontWeight:600,fontSize:18}},react_default.a.createElement("div",{className:"text-center"},Math.max(0,conversionRate-minimimumDetectableChange).toFixed(),"% -"," ",Math.min(100,conversionRate+minimimumDetectableChange).toFixed(),"%"),react_default.a.createElement("div",{className:"estimate text-center"},"Threshold of caring",react_default.a.createElement(tooltip.a,{title:"The minimum % change in conversion rate you care about. \n                                                    This means you don't care about variants whose\n                                                    conversion rate is between these two percentages."},react_default.a.createElement(InfoCircleOutlined.a,{style:{marginLeft:4}})))),react_default.a.createElement("div",{style:{paddingLeft:16,paddingRight:16,borderLeft:"1px solid var(--border)",borderRight:"1px solid var(--border)",fontWeight:600,fontSize:18}},react_default.a.createElement("div",{className:"text-center"},"~",recommendedSampleSize(conversionRate)),react_default.a.createElement("div",{className:"estimate"},"Recommended # of people")),react_default.a.createElement("div",{style:{paddingLeft:16,fontWeight:600,fontSize:18}},react_default.a.createElement("div",{className:"text-center"},"~",expectedRunningTime(entrants,recommendedSampleSize(conversionRate))),react_default.a.createElement("div",{className:"estimate"},"Recommended days")))),react_default.a.createElement(row.a,{justify:"space-between"},react_default.a.createElement(es_button.a,{onClick:prevPage},"Go back"),react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(SaveOutlined_default.a,null),type:"primary",onClick:nextPage},"Save and preview"))),2===newExperimentCurrentPage&&react_default.a.createElement("div",{className:"confirmation"},(null==newExperimentData?void 0:newExperimentData.description)&&react_default.a.createElement(row.a,null,"Description: ",null==newExperimentData?void 0:newExperimentData.description),react_default.a.createElement(row.a,{className:"mt"},react_default.a.createElement(col.a,{span:12},react_default.a.createElement("div",null,"Feature flag key: ",null==newExperimentData?void 0:newExperimentData.feature_flag_key),react_default.a.createElement("div",null,"Variants: 'control' and 'test'")),react_default.a.createElement(col.a,{span:12},react_default.a.createElement(collapse.a,null,react_default.a.createElement(collapse.a.Panel,{header:react_default.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},react_default.a.createElement(icons.IconJavascript,{style:{marginRight:6}})," Javascript integration instructions"),key:"js"},react_default.a.createElement(es_form.a.Item,{shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.key!==currentValues.key}},react_default.a.createElement(FeatureFlagSnippets.b,{variants:["control","test"],flagKey:(null==newExperimentData?void 0:newExperimentData.feature_flag_key)||""})))))),react_default.a.createElement(row.a,{className:"mt"},react_default.a.createElement(col.a,null,react_default.a.createElement(row.a,null,"Person allocation:"),react_default.a.createElement(row.a,null,"The following users will participate in the experiment"),react_default.a.createElement("ul",null,(null==newExperimentData||null===(_newExperimentData$fi=newExperimentData.filters)||void 0===_newExperimentData$fi||null===(_newExperimentData$fi2=_newExperimentData$fi.properties)||void 0===_newExperimentData$fi2?void 0:_newExperimentData$fi2.length)?newExperimentData.filters.properties.map((function(property,idx){return react_default.a.createElement("li",{key:idx},"Users with ",property.key," ",property.operator," ",Array.isArray(property.value)?property.value.map((function(val){return"".concat(val,", ")})):property.value)})):react_default.a.createElement("li",{key:"all users"},"All users")))),react_default.a.createElement(row.a,null,react_default.a.createElement(col.a,null,react_default.a.createElement(row.a,null,"Experiment parameters:"),react_default.a.createElement(row.a,null,react_default.a.createElement("ul",null,react_default.a.createElement("li",null,"Target confidence level: "),react_default.a.createElement("li",null,"Approx. run time: "),react_default.a.createElement("li",null,"Approx. sample size: "))))),react_default.a.createElement(row.a,{justify:"space-between"},react_default.a.createElement(es_button.a,{onClick:prevPage},"Go back"),react_default.a.createElement(es_button.a,{type:"primary",onClick:function onClick(){return createExperiment()}},"Save and launch"))))))}}}]);