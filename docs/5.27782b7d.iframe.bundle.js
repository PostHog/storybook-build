(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"./frontend/src/lib/components/ExportButton/ExportButton.tsx":function(U,D,t){"use strict";t.d(D,"a",function(){return ie});var H=t("./node_modules/@babel/runtime/helpers/extends.js"),xe=t.n(H),A=t("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),e=t.n(A),u=t("./node_modules/core-js/modules/es.array.map.js"),x=t("./node_modules/core-js/modules/es.regexp.exec.js"),je=t("./node_modules/core-js/modules/es.string.split.js"),Z=t("./node_modules/react/index.js"),V=t.n(Z),De=t("./frontend/src/lib/components/LemonButton/index.ts"),I=t("./node_modules/kea/lib/index.esm.js"),fe=t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ve=t.n(fe),oe=t("./node_modules/@babel/runtime/regenerator/index.js"),k=t.n(oe),Te=t("./node_modules/core-js/modules/es.array.concat.js"),de=t("./node_modules/core-js/modules/es.array.iterator.js"),q=t("./node_modules/core-js/modules/es.object.to-string.js"),o=t("./node_modules/core-js/modules/web.dom-collections.iterator.js"),j=t("./frontend/src/lib/api.ts"),B=t("./frontend/src/lib/utils.tsx"),Y=t("./node_modules/posthog-js/dist/es.js"),G=t("./frontend/src/scenes/teamLogic.tsx"),$=t("./frontend/src/lib/components/lemonToast.tsx"),le=1e3,_=10,W;(function(l){l.PNG="image/png",l.CSV="text/csv",l.PDF="application/pdf"})(W||(W={}));var be=Object(I.kea)([Object(I.path)(["lib","components","ExportButton","ExporterLogic"]),Object(I.props)({}),Object(I.key)(function(l){var T=l.dashboardId,R=l.insightId;return"dash:".concat(T,"::insight:").concat(R)}),Object(I.actions)({exportItem:function(T,R){return{exportFormat:T,successCallback:R}},exportItemSuccess:!0,exportItemFailure:!0}),Object(I.reducers)({exportInProgress:[!1,{exportItem:function(){return!0},exportItemSuccess:function(){return!1},exportItemFailure:function(){return!1}}]}),Object(I.listeners)(function(l){var T=l.actions,R=l.props;return{exportItem:function(){var ee=ve()(k.a.mark(function O(v){var X,S,f,Q,N,ce,w;return k.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return X=v.exportFormat,S=v.successCallback,$.d.info("Export started..."),f={export_format:X,dashboard:R.dashboardId,insight:R.insightId,total_time_ms:0},Q=performance.now(),i.prev=4,i.next=7,j.b.create("api/projects/".concat(G.a.values.currentTeamId,"/exports"),{export_format:X,dashboard:R.dashboardId,insight:R.insightId});case 7:if(N=i.sent,N.id){i.next=10;break}throw new Error("Missing export_id from response");case 10:ce=j.b.exports.determineExportUrl(N.id),w=0;case 12:if(!(w<_)){i.next=29;break}if(w++,!N.has_content){i.next=22;break}return T.exportItemSuccess(),$.d.success("Export complete."),S==null||S(),window.open(ce,"_blank"),f.total_time_ms=performance.now()-Q,Y.a.capture("export succeeded",f),i.abrupt("return");case 22:return i.next=24,Object(B.w)(le);case 24:return i.next=26,j.b.get("api/projects/".concat(G.a.values.currentTeamId,"/exports/").concat(N.id));case 26:N=i.sent,i.next=12;break;case 29:throw new Error("Content not loaded in time...");case 32:i.prev=32,i.t0=i.catch(4),T.exportItemFailure(),f.total_time_ms=performance.now()-Q,Y.a.capture("export failed",f),$.d.error("Export failed: ".concat(JSON.stringify(i.t0)));case 38:case"end":return i.stop()}},O,null,[[4,32]])}));function J(O){return ee.apply(this,arguments)}return J}()}})]),ge=t("./frontend/src/lib/components/LemonDivider/index.ts"),Fe=t("./frontend/src/scenes/insights/insightLogic.ts"),Ne=["dashboardId","insightShortId"];function ie(l){var T=l.dashboardId,R=l.insightShortId,ee=e()(l,Ne),J={dashboardItemId:R,doNotLoad:!0},O=Object(I.useValues)(Object(Fe.c)(J)),v=O.supportsCsvExport,X=O.csvExportUrl,S=O.insight,f=Object(I.useActions)(be({dashboardId:T,insightId:S==null?void 0:S.id})),Q=f.exportItem,N=Object(I.useValues)(be({dashboardId:T,insightId:S==null?void 0:S.id})),ce=N.exportInProgress,w=[];(T||R)&&w.push(W.PNG),v&&w.push(W.CSV);var te=function(Ee){if(Ee===W.CSV){window.open(X,"_blank");return}Q(Ee)};return V.a.createElement(De.b,xe()({type:"stealth",loading:ce,"data-attr":"export-button"},ee,{popup:{actionable:!0,placement:"right-start",overlay:V.a.createElement(V.a.Fragment,null,V.a.createElement("h5",null,"File type"),V.a.createElement(ge.a,null),w.map(function(i){return V.a.createElement(De.a,{key:i,fullWidth:!0,type:"stealth",onClick:function(){return te(i)},"data-attr":"export-button-".concat(i.split("/").pop())},".",i.split("/").pop())}))}}),"Export")}try{ie.displayName="ExportButton",ie.__docgenInfo={description:"",displayName:"ExportButton",props:{dashboardId:{defaultValue:null,description:"",name:"dashboardId",required:!1,type:{name:"number"}},insightShortId:{defaultValue:null,description:"",name:"insightShortId",required:!1,type:{name:"InsightShortId"}},type:{defaultValue:null,description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"alt"'},{value:'"default"'},{value:'"highlighted"'},{value:'"primary"'},{value:'"secondary"'},{value:'"tertiary"'},{value:'"stealth"'}]}},icon:{defaultValue:null,description:"",name:"icon",required:!1,type:{name:"ReactElement<any, string | JSXElementConstructor<any>> | null"}},fullWidth:{defaultValue:null,description:"Whether the row should take up the parent's full width.",name:"fullWidth",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/ExportButton/ExportButton.tsx#ExportButton"]={docgenInfo:ie.__docgenInfo,name:"ExportButton",path:"frontend/src/lib/components/ExportButton/ExportButton.tsx#ExportButton"})}catch(l){}},"./frontend/src/lib/hooks/useKeyboardHotkeys.tsx":function(U,D,t){"use strict";t.d(D,"a",function(){return Te});var H=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),xe=t.n(H),A=t("./node_modules/core-js/modules/es.array.includes.js"),e=t.n(A),u=t("./node_modules/core-js/modules/es.string.includes.js"),x=t.n(u),je=t("./node_modules/core-js/modules/es.object.to-string.js"),Z=t.n(je),V=t("./node_modules/core-js/modules/es.object.keys.js"),De=t.n(V),I=t("./node_modules/core-js/modules/es.array.concat.js"),fe=t.n(I),ve=t("./frontend/src/lib/hooks/useEventListener.ts"),oe=function(q,o){var j=q.composedPath()||q.path;if(!j)return!1;var B=j[0],Y=B.tagName||"not an html element";return o.includes(Y.toLowerCase())},k=[".hotkey-block",".hotkey-block *"];function Te(de,q){var o=["input","textarea"];Object(ve.a)("keydown",function(j){var B=j.key;if(!(j.metaKey||j.ctrlKey||j.altKey)&&!k.some(function(W){return j.target.matches(W)})){var Y=o.includes(j.target.tagName.toLowerCase());if(!(B!=="Escape"&&(Y||oe(j,o))))for(var G=0,$=Object.keys(de);G<$.length;G++){var le=$[G],_=de[le];if(!(!_||_.disabled)&&B.toLowerCase()===le){j.preventDefault(),_.action();break}}}},void 0,[de].concat(xe()(q||[])))}},"./frontend/src/scenes/dashboard/Dashboard.tsx":function(U,D,t){"use strict";t.r(D),t.d(D,"scene",function(){return vt}),t.d(D,"Dashboard",function(){return Ce});var H=t("./node_modules/core-js/modules/es.array.includes.js"),xe=t("./node_modules/core-js/modules/es.string.includes.js"),A=t("./node_modules/react/index.js"),e=t.n(A),u=t("./node_modules/kea/lib/index.esm.js"),x=t("./frontend/src/scenes/dashboard/dashboardLogic.ts"),je=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),Z=t.n(je),V=t("./node_modules/core-js/modules/es.array.map.js"),De=t("./node_modules/core-js/modules/es.function.name.js"),I=t("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),fe=t.n(I),ve=t("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/dashboard/DashboardItems.scss"),oe=t.n(ve),k={};k.insert="head",k.singleton=!1;var Te=fe()(oe.a,k),de=oe.a.locals||{},q=t("./node_modules/react-grid-layout/index.js"),o=t("./frontend/src/types.ts"),j=t("./frontend/src/models/insightsModel.tsx"),B=t("./node_modules/clsx/dist/clsx.m.js"),Y=t("./frontend/src/lib/components/InsightCard/index.tsx"),G=t("./frontend/src/lib/hooks/useResizeObserver.ts");function $(){var n=Object(u.useValues)(x.c),a=n.dashboard,s=n.items,d=n.layouts,r=n.dashboardMode,p=n.placement,c=n.isRefreshing,b=n.highlightedInsightId,C=n.refreshStatus,g=Object(u.useActions)(x.c),L=g.updateLayouts,E=g.updateContainerWidth,m=g.updateItemColor,F=g.removeItem,ae=g.refreshAllDashboardItems,K=Object(u.useActions)(j.a),ue=K.duplicateInsight,me=K.renameInsight,ne=K.moveToDashboard,ye=Object(A.useState)(null),Ie=Z()(ye,2),he=Ie[0],Se=Ie[1],pe=Object(A.useRef)(!1),se=Object(A.useRef)(null),Be=Object(B.a)({"dashboard-view-mode":r!==o.j.Edit,"dashboard-edit-mode":r===o.j.Edit}),Le=Object(G.b)(),h=Le.width,P=Le.ref,Ae=!h||h>x.a.sm;return e.a.createElement("div",{className:"dashboard-items-wrapper",ref:P},e.a.createElement(q.Responsive,{width:h||0,className:Be,isDraggable:r===o.j.Edit,isResizable:r===o.j.Edit,layouts:d,rowHeight:80,margin:[16,16],containerPadding:[0,0],onLayoutChange:function(re,z){r===o.j.Edit&&L(z)},onWidthChange:function(re,z,M){E(re,M)},breakpoints:x.a,resizeHandles:Ae?["s","e","se"]:["s"],cols:x.b,onResize:function(re,z,M){(!he||he.w!==M.w||he.h!==M.h)&&Se(M)},onResizeStop:function(){Se(null)},onDrag:function(){pe.current=!0,se.current&&window.clearTimeout(se.current)},onDragStop:function(){se.current&&window.clearTimeout(se.current),se.current=window.setTimeout(function(){pe.current=!1},250)},draggableCancel:".anticon,.ant-dropdown,table,.ant-popover-content,button,.Popup"},s==null?void 0:s.map(function(y){var re;return e.a.createElement(Y.a,{key:y.short_id,insight:y,dashboardId:a==null?void 0:a.id,loading:c(y.short_id),apiErrored:((re=C[y.short_id])===null||re===void 0?void 0:re.error)||!1,highlighted:b&&y.short_id===b,showResizeHandles:r===o.j.Edit,canResizeWidth:Ae,updateColor:function(M){return m(y.id,M)},removeFromDashboard:function(){return F(y)},refresh:function(){return ae([y])},rename:function(){return me(y)},duplicate:function(){return ue(y)},moveToDashboardOld:function(M){return ue(y,M,!0)},moveToDashboard:function(M){var bt=M.id,gt=M.name;if(!a)throw new Error("must be on a dashboard to move an insight");ne(y,a.id,bt,gt)},showEditingControls:[o.k.Dashboard,o.k.ProjectHomepage].includes(p),showDetailsControls:p!=o.k.Export})})))}var le=t("./frontend/src/lib/components/DateFilter/DateFilter.tsx"),_=t("./node_modules/@ant-design/icons/es/icons/CalendarOutlined.js"),W=t("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/dashboard/Dashboard.scss"),be=t.n(W),ge={};ge.insert="head",ge.singleton=!1;var Fe=fe()(be.a,ge),Ne=be.a.locals||{},ie=t("./frontend/src/lib/hooks/useKeyboardHotkeys.tsx"),l=t("./frontend/src/lib/utils/eventUsageLogic.ts"),T=t("./frontend/src/lib/components/TimezoneAware/index.tsx"),R=t("./node_modules/core-js/modules/es.array.fill.js"),ee=t("./node_modules/antd/es/card/index.js"),J=t("./node_modules/antd/es/row/index.js"),O=t("./node_modules/antd/es/col/index.js"),v=t("./node_modules/antd/es/skeleton/index.js"),X=t("./frontend/src/lib/components/Link.tsx"),S=t("./frontend/src/scenes/urls.ts"),f=t("./frontend/src/lib/components/LemonButton/index.ts");function Q(n){var a=n.active;return e.a.createElement(ee.a,{className:"hide-lte-lg"},e.a.createElement(J.a,null,e.a.createElement(O.a,{span:12},e.a.createElement(v.a,{paragraph:{rows:1},active:a}),e.a.createElement("div",{className:"mt"},e.a.createElement("div",{className:"mt"},e.a.createElement(v.a.Button,{active:a}),e.a.createElement(v.a.Button,{active:a,style:{marginLeft:4,width:140}})),e.a.createElement("div",{className:"mt"},e.a.createElement(v.a.Button,{active:a}),e.a.createElement(v.a.Button,{active:a,style:{marginLeft:4,width:140}})),e.a.createElement("div",{className:"mt"},e.a.createElement(v.a.Button,{active:a}),e.a.createElement(v.a.Button,{active:a,style:{marginLeft:4,width:140}})))),e.a.createElement(O.a,{span:12},e.a.createElement("div",{className:"skeleton-actions"},e.a.createElement(v.a.Avatar,{active:a,shape:"circle",size:"small"}),e.a.createElement(v.a.Avatar,{active:a,shape:"circle",size:"small"})),e.a.createElement(v.a.Avatar,{active:a,shape:"circle",size:"large",className:"pie-chart"}))))}function N(){return e.a.createElement("div",{className:"bar-chart ant-skeleton-content"},Array(8).fill(0).map(function(n,a){var s=200,d=40,r=Math.floor(Math.random()*(s-d+1))+d;return e.a.createElement("div",{className:"bar-el ant-skeleton-title",key:a,style:{height:r}})}))}var ce=e.a.memo(N);function w(n){var a=n.active;return e.a.createElement(ee.a,{className:Object(B.a)("ant-skeleton",a&&"ant-skeleton-active")},e.a.createElement(J.a,null,e.a.createElement(O.a,{span:12},e.a.createElement(v.a,{active:a,paragraph:{rows:1}})),e.a.createElement(O.a,{span:12},e.a.createElement("div",{className:"skeleton-actions"},e.a.createElement(v.a.Avatar,{active:a,shape:"circle",size:"small"}),e.a.createElement(v.a.Avatar,{active:a,shape:"circle",size:"small"})))),e.a.createElement(ce,null))}function te(n){var a=n.loading,s=Object(u.useValues)(x.c),d=s.dashboard;return e.a.createElement("div",{className:"empty-state"},!a&&e.a.createElement("div",{className:"cta"},e.a.createElement(ee.a,{className:"card-elevated"},e.a.createElement("h3",{className:"l3"},"Dashboard empty"),e.a.createElement("p",null,"This dashboard sure would look better with some graphs!"),e.a.createElement("div",{className:"mt text-center"},e.a.createElement(X.a,{to:S.a.insightNew(void 0,d==null?void 0:d.id)},e.a.createElement(f.a,{"data-attr":"dashboard-add-graph-header"},"Add insight"))))),e.a.createElement(J.a,{gutter:16},e.a.createElement(O.a,{span:24,lg:12},e.a.createElement(Q,{active:a})),e.a.createElement(O.a,{span:24,lg:12},e.a.createElement(w,{active:a}))),e.a.createElement(J.a,{gutter:16,className:"fade-out-graphs"},e.a.createElement(O.a,{span:24,lg:12},e.a.createElement(Q,{active:a})),e.a.createElement(O.a,{span:24,lg:12},e.a.createElement(w,{active:a}))))}try{te.displayName="EmptyDashboardComponent",te.__docgenInfo={description:"",displayName:"EmptyDashboardComponent",props:{loading:{defaultValue:null,description:"",name:"loading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/dashboard/EmptyDashboardComponent.tsx#EmptyDashboardComponent"]={docgenInfo:te.__docgenInfo,name:"EmptyDashboardComponent",path:"frontend/src/scenes/dashboard/EmptyDashboardComponent.tsx#EmptyDashboardComponent"})}catch(n){}var i=t("./frontend/src/lib/components/NotFound/index.tsx"),Ee=t("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Ge=t.n(Ee),Et=t("./node_modules/core-js/modules/es.array.from.js"),yt=t("./node_modules/core-js/modules/es.string.iterator.js"),$e=t("./node_modules/antd/es/dropdown/index.js"),Re=t("./node_modules/antd/es/menu/index.js"),Je=t("./node_modules/antd/es/checkbox/index.js"),we=t("./node_modules/antd/es/radio/index.js"),Xe=t("./node_modules/antd/es/space/index.js"),Qe=t("./node_modules/@ant-design/icons/es/icons/DownOutlined.js"),Ze=t("./node_modules/@ant-design/icons/es/icons/LoadingOutlined.js"),qe=t("./node_modules/@ant-design/icons/es/icons/ReloadOutlined.js"),ze=t("./frontend/src/lib/utils.tsx"),_e=t("./frontend/src/lib/components/Tooltip.tsx"),et=t("./frontend/src/lib/dayjs.ts"),Ve=function(){var a=Object(u.useValues)(x.c),s=a.lastRefreshed;return e.a.createElement("span",null,"Last updated ",e.a.createElement("b",null,s?Object(et.a)(s).fromNow():"a while ago"))},tt=Ge()(Array.from([60,120,300,900],function(n){return{label:Object(ze.N)(n),value:n}}));function at(){var n=Object(u.useValues)(x.c),a=n.itemsLoading,s=n.autoRefresh,d=n.refreshMetrics,r=Object(u.useActions)(x.c),p=r.refreshAllDashboardItemsManual,c=r.setAutoRefresh,b=Object(A.useState)(!1),C=Z()(b,2),g=C[0],L=C[1];return e.a.createElement(e.a.Fragment,null,e.a.createElement($e.a.Button,{overlay:e.a.createElement(Re.a,{"data-attr":"auto-refresh-picker",id:"auto-refresh-picker"},e.a.createElement("div",{id:"auto-refresh-check",key:"auto-refresh-check",onClick:function(m){m.stopPropagation(),L(!0),c(!s.enabled,s.interval)}},e.a.createElement(_e.a,{title:"Refresh dashboard automatically",placement:"bottomLeft"},e.a.createElement(Je.a,{onChange:function(m){m.stopPropagation(),m.preventDefault()},checked:s.enabled}),e.a.createElement("label",{style:{marginLeft:10,cursor:"pointer"}},"Auto refresh"))),e.a.createElement(Re.a.Divider,null),e.a.createElement(Re.a.ItemGroup,{title:"Refresh interval"},e.a.createElement(we.a.Group,{onChange:function(m){c(!0,parseInt(m.target.value))},value:s.interval,style:{width:"100%"}},e.a.createElement(Xe.b,{direction:"vertical",style:{width:"100%"}},tt.map(function(E){var m=E.label,F=E.value;return e.a.createElement(we.a,{key:F,value:F,style:{width:"100%"}},m)}))))),trigger:["click"],onClick:function(){return p()},icon:e.a.createElement(Qe.a,null),disabled:a,buttonsRender:function(m){var F=Z()(m,2),ae=F[0],K=F[1];return[e.a.cloneElement(ae,{style:{paddingLeft:10}}),K]},visible:g,onVisibleChange:function(m){return L(m)}},e.a.createElement("span",{className:"dashboard-items-action-icon"},a?e.a.createElement(Ze.a,null):e.a.createElement(qe.a,null)),e.a.createElement("span",{className:Object(B.a)("dashboard-items-action-refresh-text",{hidden:a})},e.a.createElement(Ve,null)),e.a.createElement("span",{className:Object(B.a)("dashboard-items-action-refresh-text","completed",{hidden:!a})},"Refreshed ",d.completed," out of ",d.total)))}var nt=t("./frontend/src/scenes/insights/EmptyStates/index.ts"),xt=t("./node_modules/core-js/modules/es.symbol.js"),jt=t("./node_modules/core-js/modules/es.symbol.description.js"),Dt=t("./node_modules/core-js/modules/es.array.filter.js"),Ot=t("./node_modules/core-js/modules/es.object.to-string.js"),Ct=t("./node_modules/core-js/modules/es.array.concat.js"),It=t("./node_modules/core-js/modules/es.array.join.js"),We=t("./frontend/src/lib/components/EditableField/EditableField.tsx");function Oe(n){var a=n.onExit,s="aside.ant-layout-sider, .layout-top-content";return Object(A.useEffect)(function(){for(var d=window.document.querySelectorAll(s),r=0;r<d.length;r++)d[r].style.display="none";var p=function(){window.document.fullscreenElement===null&&(a==null||a())};try{window.document.body.requestFullscreen().then(function(){window.addEventListener("fullscreenchange",p,!1)})}catch(c){}try{window.dispatchEvent(new window.Event("scroll")),window.dispatchEvent(new window.Event("resize"))}catch(c){}return function(){for(var c=window.document.querySelectorAll(s),b=0;b<c.length;b++)c[b].style.display="block";try{window.removeEventListener("fullscreenchange",p,!1),window.document.fullscreenElement!==null&&window.document.exitFullscreen()}catch(C){}try{window.dispatchEvent(new window.Event("scroll")),window.dispatchEvent(new window.Event("resize"))}catch(C){}}},[]),null}try{Oe.displayName="FullScreen",Oe.__docgenInfo={description:"",displayName:"FullScreen",props:{onExit:{defaultValue:null,description:"",name:"onExit",required:!1,type:{name:"(() => any)"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/FullScreen.tsx#FullScreen"]={docgenInfo:Oe.__docgenInfo,name:"FullScreen",path:"frontend/src/lib/components/FullScreen.tsx#FullScreen"})}catch(n){}var st=t("./frontend/src/lib/components/LemonButton/More.tsx"),rt=t("./frontend/src/lib/components/LemonRow/index.ts"),Pe=t("./frontend/src/lib/components/LemonDivider/index.ts"),Ke=t("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),ot=t("./frontend/src/lib/components/PageHeader.tsx"),Ue=t("./frontend/src/models/dashboardsModel.tsx"),dt=t("./frontend/src/scenes/dashboard/dashboardsLogic.ts"),He=t("./frontend/src/scenes/dashboard/ShareModal.tsx"),lt=t("./frontend/src/scenes/userLogic.ts"),Me=t("./frontend/src/lib/constants.tsx"),it=t("./frontend/src/lib/components/ProfilePicture/ProfileBubbles.tsx"),ct=t("./frontend/src/scenes/dashboard/dashboardCollaboratorsLogic.ts"),ut=t("./frontend/src/lib/components/icons.tsx"),ke=t("./frontend/src/lib/logic/featureFlagLogic.ts"),mt=t("./frontend/src/lib/components/ExportButton/ExportButton.tsx");function ht(){var n=Object(u.useValues)(x.c),a=n.dashboard,s=n.allItemsLoading,d=n.dashboardMode,r=n.canEditDashboard,p=Object(u.useActions)(x.c),c=p.setDashboardMode,b=p.triggerDashboardUpdate,C=Object(u.useValues)(dt.b),g=C.dashboardTags,L=Object(u.useActions)(Ue.a),E=L.updateDashboard,m=L.pinDashboard,F=L.unpinDashboard,ae=L.deleteDashboard,K=L.duplicateDashboard,ue=Object(u.useValues)(Ue.a),me=ue.dashboardLoading,ne=Object(u.useValues)(lt.a),ye=ne.hasAvailableFeature,Ie=Object(A.useState)(!1),he=Z()(Ie,2),Se=he[0],pe=he[1],se=Object(u.useValues)(ke.a),Be=se.featureFlags,Le=Be[Me.h.EXPORT_DASHBOARD_INSIGHTS];return a||s?e.a.createElement(e.a.Fragment,null,d===o.j.Fullscreen&&e.a.createElement(Oe,{onExit:function(){return c(null,l.a.Browser)}}),a&&e.a.createElement(He.b,{onCancel:function(){return pe(!1)},visible:Se}),e.a.createElement(ot.a,{title:e.a.createElement("div",{style:{display:"flex",alignItems:"center"}},e.a.createElement(We.a,{name:"name",value:(a==null?void 0:a.name)||(s?"Loading\u2026":""),placeholder:"Name this dashboard",onSave:a?function(h){return E({id:a.id,name:h})}:void 0,minLength:1,maxLength:400,mode:r?void 0:"view",notice:a&&!r?{icon:e.a.createElement(ut.IconLock,null),tooltip:"You don't have edit permissions in this dashboard. Ask a dashboard collaborator with edit access to add you."}:void 0})),buttons:d===o.j.Edit?e.a.createElement(f.a,{"data-attr":"dashboard-edit-mode-save",type:"primary",onClick:function(){return c(null,l.a.DashboardHeader)},tabIndex:10,disabled:s},"Done editing"):d===o.j.Fullscreen?e.a.createElement(f.a,{type:"secondary",onClick:function(){return c(null,l.a.DashboardHeader)},"data-attr":"dashboard-exit-presentation-mode",disabled:s},"Exit full screen"):e.a.createElement(e.a.Fragment,null,e.a.createElement(st.a,{overlay:a?e.a.createElement(e.a.Fragment,null,a.created_by&&e.a.createElement(e.a.Fragment,null,e.a.createElement(rt.a,{fullWidth:!0,style:{color:"var(--muted-alt)"}},"Created by"," ",a.created_by.first_name||a.created_by.email||"-"," ","on ",Object(ze.M)(a.created_at)),e.a.createElement(Pe.a,null)),r&&e.a.createElement(f.a,{onClick:function(){return c(o.j.Edit,l.a.MoreDropdown)},type:"stealth",fullWidth:!0},"Edit layout (E)"),e.a.createElement(f.a,{onClick:function(){return c(o.j.Fullscreen,l.a.MoreDropdown)},type:"stealth",fullWidth:!0},"Go full screen (F)"),r&&(a.pinned?e.a.createElement(f.a,{onClick:function(){return F(a.id,l.a.MoreDropdown)},type:"stealth",fullWidth:!0},"Unpin dashboard"):e.a.createElement(f.a,{onClick:function(){return m(a.id,l.a.MoreDropdown)},type:"stealth",fullWidth:!0},"Pin dashboard")),Le&&e.a.createElement(mt.a,{dashboardId:a.id,fullWidth:!0,type:"stealth"}),e.a.createElement(Pe.a,null),e.a.createElement(f.a,{onClick:function(){return K({id:a.id,name:a.name,show:!0})},type:"stealth",fullWidth:!0},"Duplicate dashboard"),r&&e.a.createElement(f.a,{onClick:function(){return ae({id:a.id,redirect:!0})},status:"danger",type:"stealth",fullWidth:!0},"Delete dashboard")):void 0}),e.a.createElement(Pe.a,{vertical:!0}),a&&e.a.createElement(pt,{dashboard:a,onClick:function(){return pe(function(P){return!P})}}),e.a.createElement(f.a,{type:"secondary","data-attr":"dashboard-share-button",onClick:function(){return pe(function(P){return!P})}},"Share"),r&&e.a.createElement(X.a,{to:S.a.insightNew(void 0,a==null?void 0:a.id)},e.a.createElement(f.a,{type:"primary","data-attr":"dashboard-add-graph-header"},"Add insight"))),caption:e.a.createElement(e.a.Fragment,null,a&&!!(r||a.description)&&e.a.createElement(We.a,{multiline:!0,name:"description",value:a.description||"",placeholder:"Description (optional)",onSave:function(P){return E({id:a.id,description:P})},compactButtons:!0,mode:r?void 0:"view",paywall:!ye(o.d.DASHBOARD_COLLABORATION)}),(a==null?void 0:a.tags)&&e.a.createElement(e.a.Fragment,null,r?e.a.createElement(Ke.a,{tags:a.tags,onChange:function(P,Ae){return b({tags:Ae})},saving:me,tagsAvailable:g.filter(function(h){var P;return!((P=a.tags)!==null&&P!==void 0&&P.includes(h))}),className:"insight-metadata-tags"}):a.tags.length?e.a.createElement(Ke.a,{tags:a.tags,saving:me,staticOnly:!0,className:"insight-metadata-tags"}):null)),delimited:!0})):null}function pt(n){var a=n.dashboard,s=n.onClick,d=Object(u.useValues)(Object(ct.a)({dashboardId:a.id})),r=d.allCollaborators;if(!a)return null;var p=He.a[a.effective_restriction_level],c=[];return p!=null&&p.label&&c.push(p.label),a.is_shared&&c.push("Shared publicly"),e.a.createElement(it.a,{people:r.map(function(b){return{email:b.user.email,name:b.user.first_name,title:"".concat(b.user.first_name," (").concat(Me.C[b.level],")")}}),tooltip:c.join(" \u2022 "),onClick:s})}var ft=t("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),vt={component:Ye,logic:x.c,paramsToProps:function(a){var s=a.params,d=s.id,r=s.shareToken,p=s.placement;return{id:d?parseInt(d):void 0,shareToken:r,placement:p}}};function Ce(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.id,s=n.shareToken,d=n.placement;return e.a.createElement(u.BindLogic,{logic:x.c,props:{id:a?parseInt(a):void 0,shareToken:s,placement:d}},e.a.createElement(Ye,null))}function Ye(){var n,a,s=Object(u.useValues)(x.c),d=s.placement,r=s.dashboard,p=s.canEditDashboard,c=s.items,b=s.itemsLoading,C=s.filters,g=s.dashboardMode,L=s.receivedErrorsFromAPI,E=Object(u.useActions)(x.c),m=E.setDashboardMode,F=E.setDates,ae=E.reportDashboardViewed,K=E.setProperties,ue=Object(u.useValues)(ke.a),me=ue.featureFlags;return Object(A.useEffect)(function(){ae()},[]),Object(ie.a)([o.k.Public,o.k.InternalMetrics].includes(d)?{}:{e:{action:function(){return m(g===o.j.Edit?null:o.j.Edit,l.a.Hotkey)},disabled:!p||g!==null&&g!==o.j.Edit},f:{action:function(){return m(g===o.j.Fullscreen?null:o.j.Fullscreen,l.a.Hotkey)},disabled:g!==null&&g!==o.j.Fullscreen},escape:{action:function(){return m(null,l.a.Hotkey)},disabled:g!==o.j.Edit}},[m,g]),!r&&!b&&L?e.a.createElement(i.a,{object:"dashboard"}):e.a.createElement("div",{className:"dashboard"},![o.k.ProjectHomepage,o.k.Public,o.k.Export,o.k.InternalMetrics].includes(d)&&e.a.createElement(ht,null),L?e.a.createElement(nt.d,{title:"There was an error loading this dashboard"}):!c||c.length===0?e.a.createElement(te,{loading:b}):e.a.createElement("div",null,![o.k.Public,o.k.Export].includes(d)&&e.a.createElement("div",{className:"flex pb border-bottom space-x"},e.a.createElement("div",{className:"flex-grow flex",style:{height:30}},e.a.createElement(T.a,{style:{marginRight:8,fontWeight:"bold",lineHeight:"30px"}}),e.a.createElement(le.a,{defaultValue:"Custom",showCustom:!0,dateFrom:(n=C==null?void 0:C.date_from)!==null&&n!==void 0?n:void 0,dateTo:(a=C==null?void 0:C.date_to)!==null&&a!==void 0?a:void 0,onChange:F,disabled:!p,makeLabel:function(ye){return e.a.createElement(e.a.Fragment,null,e.a.createElement(_.a,null),e.a.createElement("span",{className:"hide-when-small"}," ",ye))}})),(me[Me.h.PROPERTY_FILTER_ON_DASHBOARD]||(r==null?void 0:r.filters.properties))&&e.a.createElement(ft.a,{onChange:K,pageKey:"dashboard_"+(r==null?void 0:r.id),propertyFilters:r==null?void 0:r.filters.properties,useLemonButton:!0})),d!==o.k.Export&&e.a.createElement("div",{className:"flex pt pb space-x dashoard-items-actions"},e.a.createElement("div",{className:"left-item",style:d===o.k.Public?{textAlign:"right"}:void 0},d===o.k.Public?e.a.createElement(Ve,null):e.a.createElement(at,null))),e.a.createElement($,null)))}try{Ce.displayName="Dashboard",Ce.__docgenInfo={description:"",displayName:"Dashboard",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},shareToken:{defaultValue:null,description:"",name:"shareToken",required:!1,type:{name:"string"}},placement:{defaultValue:null,description:"",name:"placement",required:!1,type:{name:"enum",value:[{value:'"dashboard"'},{value:'"internal-metrics"'},{value:'"project-homepage"'},{value:'"public"'},{value:'"export"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/dashboard/Dashboard.tsx#Dashboard"]={docgenInfo:Ce.__docgenInfo,name:"Dashboard",path:"frontend/src/scenes/dashboard/Dashboard.tsx#Dashboard"})}catch(n){}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/dashboard/Dashboard.scss":function(U,D,t){var H=t("./node_modules/css-loader/dist/runtime/api.js");D=H(!1),D.push([U.i,'.dashboard .empty-state .fade-out-graphs:after{content:"";width:100%;height:3rem;background:linear-gradient(0deg,#fff,transparent);position:absolute;pointer-events:none;bottom:0}.dashboard-header .dashboard-select{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.dashboard{margin-top:1rem}.dashboard .dashboard-items-action-icon{margin-right:6px}.dashboard .dashboard-items-action-refresh-text{visibility:visible}.dashboard .dashboard-items-action-refresh-text.hidden{visibility:hidden}.dashboard .dashboard-items-action-refresh-text.completed{position:absolute;left:30px}.dashboard .empty-state{position:relative}.dashboard .empty-state .skeleton-actions{text-align:right}.dashboard .empty-state .skeleton-actions .ant-skeleton-avatar{margin-right:8px}.dashboard .empty-state .pie-chart{height:200px;width:200px;max-width:100%;margin-top:1rem}@media(max-width:992px){.dashboard .empty-state .pie-chart{height:140px;width:140px}}.dashboard .empty-state .bar-chart{display:flex;margin-top:1rem;align-items:flex-end}.dashboard .empty-state .bar-chart .bar-el{width:12.5%;margin-left:4px;height:100px}.dashboard .empty-state .ant-col{flex-grow:1}.dashboard .empty-state .ant-col .ant-card{height:100%}.dashboard .empty-state .fade-out-graphs{margin-top:1rem;height:150px;overflow:hidden;position:relative}.dashboard .empty-state .fade-out-graphs:after{width:calc(100% - 16px);left:8px;height:150px}.dashboard .empty-state .cta{width:360px;max-width:calc(100% - 32px);position:absolute;top:16px;left:50%;transform:translateX(-50%);z-index:var(--z-content-overlay)}.dashboard-header{display:flex;justify-content:space-between;margin-bottom:1rem;width:100%}.dashboard-header.full-screen{margin-top:1rem}.dashboard-header .dashboard-select{flex:1;padding-right:2rem}.dashboard-header .dashboard-select .ant-select-single{max-width:100%;line-height:40px}.dashboard-header .dashboard-select .ant-select-single .ant-select-selector{align-items:center;padding-left:0;padding-right:8px;line-height:40px;height:40px}.dashboard-header .dashboard-select .ant-select-single .ant-select-selector .ant-select-selection-item{font-size:28px;font-weight:600;line-height:40px;width:100%;height:35px;display:flex;align-items:center}.dashboard-header .dashboard-select .ant-select-single .ant-select-selector .ant-select-selection-item .anticon-share-alt{font-size:16px;margin-left:6px!important;margin-right:4px}.dashboard-header .dashboard-select .ant-select-single.ant-select-open .ant-select-arrow{color:var(--depr-rgba-text-default-0-4)}.dashboard-header .dashboard-select .ant-select-single .ant-select-arrow{color:var(--text-default);font-size:14px}.dashboard-header .dashboard-meta{white-space:nowrap;display:flex;align-items:center}.dashboard-header .dashboard-meta .ant-btn{margin-left:10px}.dashboard-header .dashboard-meta .ant-btn .anticon{vertical-align:baseline}.dashboard-header .dashboard-meta .ant-btn.button-box{padding:4px 8px}@media(max-width:768px){.dashboard-header{flex-direction:column}.dashboard-header .dashboard-meta{padding-top:1rem;justify-content:flex-end}}#auto-refresh-check{padding:5px 12px;cursor:pointer}.CollaboratorRow{justify-content:space-between;height:2rem;margin-top:.5rem;padding-left:.5rem}.CollaboratorRow,.CollaboratorRow__details{display:flex;align-items:center}.CollaboratorRow__details>span{margin-right:.5rem}',""]),U.exports=D},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/dashboard/DashboardItems.scss":function(U,D,t){var H=t("./node_modules/css-loader/dist/runtime/api.js");D=H(!1),D.push([U.i,".dashboard-items-wrapper{width:100%}.react-grid-layout{position:relative;transition:height .1s ease;margin-bottom:2rem}.react-grid-layout.dashboard-view-mode .react-grid-item{transition:none}.react-grid-item{transition:all .1s ease;transition-property:left,top}.react-grid-item.cssTransforms{transition-property:transform}.react-grid-item.resizing{z-index:1;will-change:width,height}.react-grid-item.react-draggable{cursor:move}.react-grid-item.react-draggable-dragging{transition:none;z-index:105;will-change:transform}.react-grid-item.dropping{visibility:hidden}.react-grid-item.react-grid-placeholder{transition:.1s ease;max-width:100%;position:relative;border:1px solid var(--primary);outline:1px solid var(--primary);border-radius:var(--radius);z-index:2;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.react-resizable-hide>.react-resizable-handle{display:none}.react-grid-item>.react-resizable-handle{position:absolute;width:2rem;height:2rem;bottom:-.5rem;right:-.5rem;cursor:se-resize;z-index:10}.react-grid-item>.react-resizable-handle.react-resizable-handle-se{cursor:se-resize}.react-grid-item>.react-resizable-handle.react-resizable-handle-e{top:0;bottom:2rem;height:auto;cursor:ew-resize}.react-grid-item>.react-resizable-handle.react-resizable-handle-s{left:0;right:2rem;width:auto;cursor:ns-resize}.ant-dropdown{z-index:700}.dive-btn{margin-right:.5rem}.dive-btn.dive-btn-dive{border-color:var(--primary);color:var(--primary)}.dive-btn.dive-btn-dive:hover{border-color:var(--depr-darken-primary-30);color:var(--depr-darken-primary-30)}",""]),U.exports=D}}]);
