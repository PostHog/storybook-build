(window.webpackJsonp=window.webpackJsonp||[]).push([[298],{"./frontend/src/scenes/exports/CreateExport.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"CreateExport",(function(){return CreateExport}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),_lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),_lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx"),kea__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),_lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),_api__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/exports/api.ts"),_lib_lemon_ui_LemonSelect__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),_urls__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/urls.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const scene={component:CreateExport};function CreateExport(){const{currentTeamId:currentTeamId}=Object(_api__WEBPACK_IMPORTED_MODULE_6__.b)(),{currentLocation:currentLocation}=Object(kea__WEBPACK_IMPORTED_MODULE_3__.useValues)(kea_router__WEBPACK_IMPORTED_MODULE_4__.router),exportType=currentLocation.pathname.split("/").pop(),nameRef=Object(react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),bucketRef=Object(react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),prefixRef=Object(react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),accessKeyIdRef=Object(react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),secretAccessKeyRef=Object(react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),{createExport:createExport,loading:loading,error:error}=Object(_api__WEBPACK_IMPORTED_MODULE_6__.a)(),handleCreateExport=Object(react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((()=>{var _nameRef$current$valu,_nameRef$current,_bucketRef$current$va,_bucketRef$current,_prefixRef$current$va,_prefixRef$current,_accessKeyIdRef$curre,_accessKeyIdRef$curre2,_secretAccessKeyRef$c,_secretAccessKeyRef$c2;nameRef.current&&bucketRef.current&&prefixRef.current&&accessKeyIdRef.current&&secretAccessKeyRef.current||console.warn("Missing ref");const name=null!==(_nameRef$current$valu=null===(_nameRef$current=nameRef.current)||void 0===_nameRef$current?void 0:_nameRef$current.value)&&void 0!==_nameRef$current$valu?_nameRef$current$valu:"",bucket=null!==(_bucketRef$current$va=null===(_bucketRef$current=bucketRef.current)||void 0===_bucketRef$current?void 0:_bucketRef$current.value)&&void 0!==_bucketRef$current$va?_bucketRef$current$va:"",prefix=null!==(_prefixRef$current$va=null===(_prefixRef$current=prefixRef.current)||void 0===_prefixRef$current?void 0:_prefixRef$current.value)&&void 0!==_prefixRef$current$va?_prefixRef$current$va:"",accessKeyId=null!==(_accessKeyIdRef$curre=null===(_accessKeyIdRef$curre2=accessKeyIdRef.current)||void 0===_accessKeyIdRef$curre2?void 0:_accessKeyIdRef$curre2.value)&&void 0!==_accessKeyIdRef$curre?_accessKeyIdRef$curre:"",secretAccessKey=null!==(_secretAccessKeyRef$c=null===(_secretAccessKeyRef$c2=secretAccessKeyRef.current)||void 0===_secretAccessKeyRef$c2?void 0:_secretAccessKeyRef$c2.value)&&void 0!==_secretAccessKeyRef$c?_secretAccessKeyRef$c:"";createExport(currentTeamId,{name:name,destination:{type:"S3",config:{bucket_name:bucket,region:"us-east-1",prefix:prefix,batch_window_size:3600,aws_access_key_id:accessKeyId,aws_secret_access_key:secretAccessKey}},interval:"hour"}).then((()=>{kea_router__WEBPACK_IMPORTED_MODULE_4__.router.actions.push(_urls__WEBPACK_IMPORTED_MODULE_8__.a.exports())}))}),[]);return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div",{children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("h1",{children:["Create Export: ",exportType]}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__.b,{label:"Name",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_2__.a,{placeholder:"My export",ref:nameRef})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__.b,{label:"Bucket",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_2__.a,{placeholder:"my-bucket",ref:bucketRef})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__.b,{label:"Region",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_lemon_ui_LemonSelect__WEBPACK_IMPORTED_MODULE_7__.a,{options:[{value:"us-east-1",label:"US East (N. Virginia)"},{value:"us-east-2",label:"US East (Ohio)"},{value:"us-west-1",label:"US West (N. California)"},{value:"us-west-2",label:"US West (Oregon)"},{value:"af-south-1",label:"Africa (Cape Town)"},{value:"ap-east-1",label:"Asia Pacific (Hong Kong)"},{value:"ap-south-1",label:"Asia Pacific (Mumbai)"},{value:"ap-northeast-3",label:"Asia Pacific (Osaka-Local)"},{value:"ap-northeast-2",label:"Asia Pacific (Seoul)"},{value:"ap-southeast-1",label:"Asia Pacific (Singapore)"},{value:"ap-southeast-2",label:"Asia Pacific (Sydney)"},{value:"ap-northeast-1",label:"Asia Pacific (Tokyo)"},{value:"ca-central-1",label:"Canada (Central)"},{value:"cn-north-1",label:"China (Beijing)"},{value:"cn-northwest-1",label:"China (Ningxia)"},{value:"eu-central-1",label:"Europe (Frankfurt)"},{value:"eu-west-1",label:"Europe (Ireland)"},{value:"eu-west-2",label:"Europe (London)"},{value:"eu-south-1",label:"Europe (Milan)"},{value:"eu-west-3",label:"Europe (Paris)"},{value:"eu-north-1",label:"Europe (Stockholm)"},{value:"me-south-1",label:"Middle East (Bahrain)"},{value:"sa-east-1",label:"South America (SÃ£o Paulo)"}]})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__.b,{label:"Key prefix",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_2__.a,{placeholder:"posthog-events/",ref:prefixRef})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__.b,{label:"AWS Access Key ID",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_2__.a,{placeholder:"my-access-key-id",ref:accessKeyIdRef})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__.b,{label:"AWS Secret Access Key",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_2__.a,{placeholder:"my-secret-access-key",ref:secretAccessKeyRef})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__.b,{label:"Frequency",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_lemon_ui_LemonSelect__WEBPACK_IMPORTED_MODULE_7__.a,{options:[{value:"hour",label:"Hourly"},{value:"day",label:"Daily"}]})}),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_5__.a,{onClick:handleCreateExport,children:"Create Export"}),loading&&Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div",{children:"Saving..."}),error&&Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div",{children:["Error: ",null==error?void 0:error.toString()]})]})}},"./frontend/src/scenes/exports/api.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return useCurrentTeamId})),__webpack_require__.d(__webpack_exports__,"e",(function(){return useExports})),__webpack_require__.d(__webpack_exports__,"a",(function(){return useCreateExport})),__webpack_require__.d(__webpack_exports__,"c",(function(){return useExport})),__webpack_require__.d(__webpack_exports__,"d",(function(){return useExportRuns}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),_teamLogic__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),_lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts");const useCurrentTeamId=()=>{const{currentTeamId:currentTeamId}=Object(kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_teamLogic__WEBPACK_IMPORTED_MODULE_1__.b);if(null==currentTeamId)throw Error("currentTeamId should not be undefined");return{currentTeamId:currentTeamId}},useExports=teamId=>{const[state,setExports]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)({loading:!0,exports:void 0,error:void 0});return Object(react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((()=>{const controller=new AbortController,signal=controller.signal;return fetch(`/api/projects/${teamId}/batch_exports/`,{signal:signal}).then((response=>response.json())).then((data=>{setExports({loading:!1,exports:data.results,error:void 0})})).catch((error=>{setExports({loading:!1,exports:void 0,error:error})})),()=>controller.abort()}),[teamId]),state},useCreateExport=()=>{const[state,setState]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)({loading:!1,error:null});return{createExport:Object(react__WEBPACK_IMPORTED_MODULE_2__.useCallback)(((teamId,exportData)=>(setState({loading:!0,error:null}),_lib_api__WEBPACK_IMPORTED_MODULE_3__.b.createResponse(`/api/projects/${teamId}/batch_exports/`,exportData).then((response=>{if(!response.ok){const error=new Error(response.statusText);throw setState({loading:!1,error:error}),error}setState({loading:!1,error:null})})))),[]),...state}},useExport=(teamId,exportId)=>{const[loading,setLoading]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(!0),[export_,setExport]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(),[error,setError]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)();return Object(react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((()=>{const controller=new AbortController,signal=controller.signal;return setLoading(!0),setError(void 0),fetch(`/api/projects/${teamId}/batch_exports/${exportId}`,{signal:signal}).then((res=>res.json())).then((data=>{setExport(data),setLoading(!1)})).catch((error=>{setError(error),setLoading(!1)})),()=>controller.abort()}),[teamId,exportId]),{loading:loading,export_:export_,error:error}},useExportRuns=(teamId,exportId)=>{const[loading,setLoading]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(!0),[exportRuns,setExportRuns]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)(),[error,setError]=Object(react__WEBPACK_IMPORTED_MODULE_2__.useState)();return Object(react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((()=>{const controller=new AbortController,signal=controller.signal;return setLoading(!0),setError(void 0),fetch(`/api/projects/${teamId}/batch_exports/${exportId}/runs`,{signal:signal}).then((res=>res.json())).then((data=>{setExportRuns(data.results),setLoading(!1)})).catch((error=>{setError(error),setLoading(!1)})),()=>controller.abort()}),[teamId,exportId]),{loading:loading,exportRuns:exportRuns,error:error}}}}]);