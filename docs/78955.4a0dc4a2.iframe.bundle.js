"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[78955],{"../../frontend/src/scenes/data-warehouse/external/forms/SourceForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>SourceFormComponent,Z:()=>SourceFormContainer});var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),sourceWizardLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx"),IntegrationChoice=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/integrations/IntegrationChoice.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),types=__webpack_require__("../../frontend/src/types.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DataWarehouseIntegrationChoice(_ref){let{sourceConfig,...props}=_ref;return(0,jsx_runtime.jsx)(IntegrationChoice.a,{...props,integration:sourceConfig.name.toLowerCase(),redirectUrl:urls.j.pipelineNodeNew(types.We.Source,{kind:sourceConfig.name.toLowerCase()})})}function parseConnectionString(str){let result;let config={},dummyHost=!1;str.startsWith("postgres://")&&(str="postgresql://"+str.substring(11)),/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(str)&&(str=encodeURI(str).replace(/%25(\d\d)/g,"%$1"));try{result=new URL(str,"postgresql://base")}catch{result=new URL(str.replace("@/","@___DUMMY___/"),"postgresql://base"),dummyHost=!0}for(let[key,value]of result.searchParams.entries())config[key]=value;if(config.user=config.user||decodeURIComponent(result.username||""),config.password=config.password||decodeURIComponent(result.password||""),"socket:"===result.protocol)return config.host=decodeURI(result.pathname),config.database=result.searchParams.get("db"),config.client_encoding=result.searchParams.get("encoding"),config;let hostname=dummyHost?"":result.hostname;config.host?hostname&&/^%2f/i.test(hostname)&&(result.pathname=hostname+result.pathname):config.host=decodeURIComponent(hostname),config.port=config.port||result.port;let pathname=result.pathname.slice(1)||null;return config.database=pathname?decodeURIComponent(pathname):null,config.isValid=!!(config.user&&config.database&&config.host),config}let CONNECTION_STRING_DEFAULT_PORT={Postgres:5432},sourceFieldToElement=(field,sourceConfig,lastValue,isUpdateMode)=>{if("text"===field.type&&"connection_string"===field.name)return isUpdateMode?(0,jsx_runtime.jsx)(react.Fragment,{},field.name):(0,jsx_runtime.jsxs)(react.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref=>{let{onChange}=_ref;return(0,jsx_runtime.jsx)(src.DF,{className:"ph-connection-string","data-attr":field.name,placeholder:field.placeholder,type:"text",onChange:updatedConnectionString=>{onChange(updatedConnectionString);let{host,port,database,user,password,isValid}=parseConnectionString(updatedConnectionString);isValid&&(sourceWizardLogic.So.actions.setSourceConnectionDetailsValue(["payload","database"],database||""),sourceWizardLogic.So.actions.setSourceConnectionDetailsValue(["payload","host"],host||""),sourceWizardLogic.So.actions.setSourceConnectionDetailsValue(["payload","user"],user||""),sourceWizardLogic.So.actions.setSourceConnectionDetailsValue(["payload","port"],port||CONNECTION_STRING_DEFAULT_PORT[sourceConfig.name]),sourceWizardLogic.So.actions.setSourceConnectionDetailsValue(["payload","password"],password||""))}},field.name)}}),(0,jsx_runtime.jsx)(src.p2,{})]},field.name);if("switch-group"===field.type){let enabled=!!lastValue?.[field.name]?.enabled||lastValue?.[field.name]?.enabled==="True";return(0,jsx_runtime.jsx)(LemonField.D,{name:[field.name,"enabled"],label:field.label,children:_ref2=>{let{value,onChange}=_ref2,isEnabled=null==value||"False"===value?enabled:value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!!field.caption&&(0,jsx_runtime.jsx)("p",{children:field.caption}),(0,jsx_runtime.jsx)(src.f4,{checked:isEnabled,onChange:onChange}),isEnabled&&(0,jsx_runtime.jsx)(lib.Group,{name:field.name,children:field.fields.map(field=>sourceFieldToElement(field,sourceConfig,lastValue?.[field.name]))})]})}},field.name)}if("select"===field.type){let hasOptionFields=!!field.options.filter(n=>{var _n$fields$length;return(null!==(_n$fields$length=n.fields?.length)&&void 0!==_n$fields$length?_n$fields$length:0)>0}).length;return(0,jsx_runtime.jsx)(LemonField.D,{name:hasOptionFields?[field.name,"selection"]:field.name,label:field.label,children:_ref3=>{let{value,onChange}=_ref3;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Yv,{options:field.options,value:null==value?lastValue?.[field.name]:value||field.defaultValue,onChange:onChange}),(0,jsx_runtime.jsx)(lib.Group,{name:field.name,children:field.options.find(n=>n.value===(null!=value?value:field.defaultValue))?.fields?.map(field=>sourceFieldToElement(field,sourceConfig,lastValue?.[field.name]))})]})}},field.name)}return"textarea"===field.type?(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref4=>{let{value,onChange}=_ref4;return(0,jsx_runtime.jsx)(src._V,{className:"ph-ignore-input","data-attr":field.name,placeholder:field.placeholder,minRows:4,value:value||"",onChange:onChange})}},field.name):"oauth"===field.type?(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref5=>{let{value,onChange}=_ref5;return(0,jsx_runtime.jsx)(DataWarehouseIntegrationChoice,{sourceConfig:sourceConfig,value:value,onChange:onChange},field.name)}},field.name):"file-upload"===field.type?(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref6=>{let{value,onChange}=_ref6;return(0,jsx_runtime.jsx)("div",{className:"bg-[white] p-2 border rounded-[var(--radius)]",children:(0,jsx_runtime.jsx)(src.mH,{value:value,accept:field.fileFormat,multiple:!1,onChange:onChange})})}},field.name):(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref7=>{let{value,onChange}=_ref7;return(0,jsx_runtime.jsx)(src.DF,{className:"ph-ignore-input","data-attr":field.name,placeholder:field.placeholder,type:field.type,value:value||"",onChange:onChange})}},field.name)};function SourceFormContainer(props){return(0,jsx_runtime.jsx)(lib.Form,{logic:sourceWizardLogic.So,formKey:"sourceConnectionDetails",enableFormOnSubmit:!0,children:(0,jsx_runtime.jsx)(SourceFormComponent,{...props})})}function SourceFormComponent(_ref8){let{sourceConfig,showPrefix=!0,jobInputs,setSourceConfigValue}=_ref8;(0,react.useEffect)(()=>{if(jobInputs&&setSourceConfigValue)for(let input of Object.keys(jobInputs||{}))setSourceConfigValue(["payload",input],jobInputs[input])},[JSON.stringify(jobInputs),setSourceConfigValue]);let isUpdateMode=!!setSourceConfigValue;return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsx)(lib.Group,{name:"payload",children:sourceWizardLogic.l2[sourceConfig.name].fields.map(field=>sourceFieldToElement(field,sourceConfig,jobInputs?.[field.name],isUpdateMode))}),showPrefix&&(0,jsx_runtime.jsx)(LemonField.D,{name:"prefix",label:"Table prefix (optional)",children:_ref9=>{let{value,onChange}=_ref9,tableName=value?`${sourceConfig.name.toLowerCase()}.${value}.table_name`:`${sourceConfig.name.toLowerCase()}.table_name`;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.DF,{className:"ph-ignore-input","data-attr":"prefix",placeholder:"internal",value:value,onChange:onChange}),(0,jsx_runtime.jsxs)("p",{children:["Example table name:Â ",(0,jsx_runtime.jsx)("strong",{children:tableName})]})]})}})]})}},"../../frontend/src/scenes/data-warehouse/external/forms/SyncMethodForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>SyncMethodForm});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonRadio/index.ts"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let getIncrementalSyncSupported=schema=>schema.incremental_available?0===schema.incremental_fields.length?{disabled:!0,disabledReason:"No incremental fields found on table"}:{disabled:!1}:{disabled:!0,disabledReason:"Incremental replication isn't supported on this table"},getSaveDisabledReason=(syncType,incrementalField)=>syncType?"incremental"!==syncType||incrementalField?void 0:"You must select an incremental field":"You must select a sync method before saving",SyncMethodForm=_ref=>{var _schema$sync_type,_schema$incremental_f,_schema$incremental_f3;let{schema,onClose,onSave,saveButtonIsLoading}=_ref,incrementalSyncSupported=getIncrementalSyncSupported(schema),[radioValue,setRadioValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$sync_type=schema.sync_type)&&void 0!==_schema$sync_type?_schema$sync_type:incrementalSyncSupported?"incremental":void 0),[incrementalFieldValue,setIncrementalFieldValue]=(0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(null!==(_schema$incremental_f=schema.incremental_field)&&void 0!==_schema$incremental_f?_schema$incremental_f:null);return(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(()=>{var _schema$sync_type2,_schema$incremental_f2;setRadioValue(null!==(_schema$sync_type2=schema.sync_type)&&void 0!==_schema$sync_type2?_schema$sync_type2:incrementalSyncSupported?"incremental":void 0),setIncrementalFieldValue(null!==(_schema$incremental_f2=schema.incremental_field)&&void 0!==_schema$incremental_f2?_schema$incremental_f2:null)},[schema.table]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_1__._,{radioPosition:"top",value:radioValue,options:[{value:"incremental",disabledReason:incrementalSyncSupported.disabled&&incrementalSyncSupported.disabledReason||void 0,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-4 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h4",{className:"mb-0 mr-2 text-base font-semibold",children:"Incremental replication"}),!incrementalSyncSupported.disabled&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{type:"success",children:"Recommended"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"mb-1",children:"When using incremental replication, we'll store the max value of the below field on each sync and only sync rows with greater or equal value on the next run."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{className:"mb-1",children:["You should pick a field that increments or updates each time the row is updated, such as a ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("code",{children:"updated_at"})," timestamp."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Yv,{value:incrementalFieldValue,onChange:newValue=>setIncrementalFieldValue(newValue),options:null!==(_schema$incremental_f3=schema.incremental_fields.map(n=>({value:n.field,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{className:"leading-5",children:n.label}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{className:"ml-2",type:"success",children:n.type})]})})))&&void 0!==_schema$incremental_f3?_schema$incremental_f3:[],disabledReason:incrementalSyncSupported.disabled?"":void 0})]})},{value:"full_refresh",label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-6 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-1",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h4",{className:"mb-0 mr-2 text-base font-semibold",children:"Full table replication"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"m-0",children:"We'll replicate the whole table on every sync. This can take longer to sync and increase your monthly billing."})]})}],onChange:newValue=>setRadioValue(newValue)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"flex flex-row justify-end w-full",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{className:"mr-3",type:"secondary",onClick:onClose,children:"Close"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{type:"primary",loading:saveButtonIsLoading,disabledReason:getSaveDisabledReason(radioValue,incrementalFieldValue),onClick:()=>{if("incremental"===radioValue){let fieldSelected=schema.incremental_fields.find(n=>n.field===incrementalFieldValue);if(!fieldSelected){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.UJ.error("Selected field for incremental replication not found");return}onSave("incremental",incrementalFieldValue,fieldSelected.field_type)}else onSave("full_refresh",null,null)},children:"Save"})]})]})}},"../../frontend/src/scenes/data-warehouse/new/DataWarehouseTableForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>DatawarehouseTableForm});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/dataWarehouseTableLogic.tsx"),_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ProviderMappings={aws:{fileUrlPatternPlaceholder:"eg: https://your-org.s3.amazonaws.com/airbyte/stripe/invoices/*.pqt",accessKeyPlaceholder:"eg: AKIAIOSFODNN7EXAMPLE",accessKeyLabel:"Access key",accessSecretLabel:"Access secret"},"google-cloud":{fileUrlPatternPlaceholder:"eg: https://storage.googleapis.com/your-org/airbyte/stripe/invoices/*.pqt",accessKeyPlaceholder:"eg: GOOGTS7C7FUP3AIRVEXAMPLE",accessKeyLabel:"Access ID",accessSecretLabel:"Secret"},"cloudflare-r2":{fileUrlPatternPlaceholder:"eg: https://your-account-id.r2.cloudflarestorage.com/airbyte/stripe/invoices/*.pqt",accessKeyPlaceholder:"eg: AKIAIOSFODNN7EXAMPLE",accessKeyLabel:"Access key",accessSecretLabel:"Access secret"},azure:{fileUrlPatternPlaceholder:"https://your-storage-container.blob.core.windows.net/airbyte/stripe/invoices/*.parquet",accessKeyPlaceholder:"your-storage-container",accessKeyLabel:"Storage account name",accessSecretLabel:"Account key"}};function DatawarehouseTableForm(_ref){let{onUpdate}=_ref,{manualLinkingProvider}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_5__.So),provider=null!=manualLinkingProvider?manualLinkingProvider:"aws";return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(kea_forms__WEBPACK_IMPORTED_MODULE_2__.Form,{formKey:"table",logic:_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_4__.U,className:"deprecated-space-y-4",enableFormOnSubmit:!0,autoComplete:"off",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:"name",label:"Table name",children:_ref2=>{let{value="",onChange}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{"data-attr":"table-name",className:"ph-ignore-input",placeholder:"Examples: stripe_invoice, hubspot_contacts, users",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:value,onChange:onChange})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"text-secondary text-xs mb-4",children:"This will be the table name used when writing queries"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:"url_pattern",label:"Files URL pattern",children:_ref3=>{let{value="",onChange}=_ref3;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{"data-attr":"table-url-pattern",className:"ph-ignore-input",placeholder:ProviderMappings[provider].fileUrlPatternPlaceholder,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:value,onChange:onChange})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"text-secondary text-xs mb-4",children:["You can use ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("strong",{children:"*"})," to select multiple files."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:"format",label:"File format",className:"w-max mb-4",children:_ref4=>{let{value="",onChange}=_ref4;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Yv,{"data-attr":"table-format",options:[{label:"Parquet (recommended)",value:"Parquet"},{label:"CSV",value:"CSV"},{label:"CSV with headers",value:"CSVWithNames"},{label:"JSON",value:"JSONEachRow"},{label:"Delta",value:"Delta"}],value:value,onChange:onChange})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:["credential","access_key"],label:ProviderMappings[provider].accessKeyLabel,children:_ref5=>{let{value="",onChange}=_ref5;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{"data-attr":"access-key",className:"ph-ignore-input",placeholder:ProviderMappings[provider].accessKeyPlaceholder,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:value,onChange:onChange})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:["credential","access_secret"],label:ProviderMappings[provider].accessSecretLabel,children:_ref6=>{let{value="",onChange}=_ref6;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{"data-attr":"access-secret",className:"ph-ignore-input",type:"password",placeholder:"eg: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:value,onChange:onChange})}}),"google-cloud"===provider&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"text-secondary text-xs",children:["We use HMAC keys to access your Google Cloud Storage. Find more about generating them"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.rU,{to:"https://cloud.google.com/storage/docs/authentication/hmackeys",target:"_new",children:"here"})]})]}),!!onUpdate&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex justify-end",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Jp,{type:"primary",onClick:onUpdate,children:"Save"})})]})}},"../../frontend/src/scenes/pipeline/transformationsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>pipelineTransformationsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/projectLogic.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");let pipelineTransformationsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","transformationsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__.K,["currentProjectId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,openReorderModal:!0,closeReorderModal:!0,setTemporaryOrder:tempOrder=>({tempOrder}),savePluginConfigsOrder:newOrders=>({newOrders}),updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_transformations")}],temporaryOrder:[{},{setTemporaryOrder:async _ref2=>{let{tempOrder}=_ref2;return tempOrder},closeReorderModal:async()=>({})}],pluginConfigs:[{},{loadPluginConfigs:async()=>Object.fromEntries((await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentProjectId}/pipeline_transformation_configs`)).map(pluginConfig=>[pluginConfig.id,pluginConfig])),savePluginConfigsOrder:async _ref3=>{let{newOrders}=_ref3;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,!1))return values.pluginConfigs;let{pluginConfigs}=values,response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update("api/plugin_config/rearrange",{orders:newOrders}),newPluginConfigs={...pluginConfigs};for(let pluginConfig of response)Object.keys(values.plugins).map(Number).includes(pluginConfig.plugin)&&(newPluginConfigs[pluginConfig.id]=pluginConfig);return newPluginConfigs},toggleEnabled:async _ref4=>{let{id,enabled}=_ref4;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let order={};enabled&&(order={order:values.nextAvailableOrder});let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled,...order});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref5=>{let{pluginConfig}=_ref5;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],transformations:[s=>[s.pluginConfigs,s.plugins],(pluginConfigs,plugins)=>Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})).map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation))],sortedEnabledTransformations:[s=>[s.transformations,s.temporaryOrder],(transformations,temporaryOrder)=>(transformations=transformations.filter(t=>t.enabled),transformations=temporaryOrder&&Object.keys(temporaryOrder).length>0?Object.entries(temporaryOrder).sort((_ref6,_ref7)=>{let[,aIdx]=_ref6,[,bIdx]=_ref7;return aIdx-bIdx}).map(_ref8=>{let[pluginId]=_ref8;return transformations.find(t=>t.id===Number(pluginId))}):transformations.sort((a,b)=>a.order-b.order))],sortedTransformations:[s=>[s.transformations,s.sortedEnabledTransformations],(transformations,sortedEnabledTransformations)=>sortedEnabledTransformations.concat(transformations.filter(t=>!t.enabled).sort((a,b)=>a.id-b.id))],nextAvailableOrder:[s=>[s.transformations],transformations=>{let enabledTransformations=transformations.filter(t=>t.enabled);return enabledTransformations.length>0?Math.max(...enabledTransformations.map(t=>t.order),0)+1:0}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({reorderModalOpen:[!1,{openReorderModal:()=>!0,closeReorderModal:()=>!1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref9=>{let{actions}=_ref9;return{savePluginConfigsOrderSuccess:()=>{actions.closeReorderModal()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref10=>{let{actions}=_ref10;actions.loadPlugins(),actions.loadPluginConfigs()})])}}]);