(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"./frontend/src/scenes/session-recordings/SessionRecordingsTable.tsx":function(H,F,e){"use strict";e.d(F,"a",function(){return C});var K=e("./node_modules/react/index.js"),o=e.n(K),h=e("./node_modules/kea/lib/index.esm.js"),ce=e("./frontend/src/lib/utils.tsx"),L=e("./node_modules/antd/es/button/index.js"),S=e("./node_modules/antd/es/row/index.js"),B=e("./node_modules/antd/es/typography/index.js"),ue=e("./frontend/src/scenes/session-recordings/sessionRecordingsTableLogic.ts"),ee=e("./node_modules/@ant-design/icons/es/icons/PlayCircleOutlined.js"),te=e("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),ne=e("./node_modules/@ant-design/icons/es/icons/CalendarOutlined.js"),me=e("./frontend/src/scenes/session-recordings/SessionPlayerDrawer.tsx"),se=e("./frontend/src/scenes/insights/ActionFilter/ActionFilter.tsx"),N=e("./node_modules/@ant-design/icons/es/icons/LeftOutlined.js"),re=e("./node_modules/@ant-design/icons/es/icons/RightOutlined.js"),A=e("./frontend/src/types.ts"),oe=e("./node_modules/antd/es/space/index.js"),ae=e("./node_modules/antd/es/input/index.js"),U=e("./node_modules/antd/es/select/index.js"),Q=e("./frontend/src/lib/components/PropertyFilters/components/OperatorValueSelect.tsx"),ie=e("./frontend/src/lib/components/Popup/Popup.tsx"),Pe=e("./node_modules/core-js/modules/es.array.slice.js"),fe=e("./node_modules/core-js/modules/es.array.iterator.js"),Oe=e("./node_modules/core-js/modules/es.object.to-string.js"),ge=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),W;(function(l){l.SECONDS="seconds",l.MINUTES="minutes",l.HOURS="hours"})(W||(W={}));var J={seconds:1,minutes:60,hours:3600},pe=Object(h.kea)({path:function(d){return["scenes","session-recordings","DurationFilterLogic",d]},key:function(d){return d.pageKey||"global"},props:{},actions:{setTimeValue:function(d){return{timeValue:d}},setUnit:function(d){return{unit:d}},setIsOpen:function(d){return{isOpen:d}},setOperator:function(d){return{operator:d}}},reducers:function(d){var s,n=d.props;return{unit:[W.MINUTES,{setUnit:function(t,a){var i=a.unit;return i}}],operator:[n==null||(s=n.initialFilter)===null||s===void 0?void 0:s.operator,{setOperator:function(t,a){var i=a.operator;return i}}],timeValue:[Math.floor(n.initialFilter.value/J[W.MINUTES]),{setTimeValue:function(t,a){var i=a.timeValue;return i}}],isOpen:[!1,{setIsOpen:function(t,a){var i=a.isOpen;return i}}]}},selectors:{durationString:[function(l){return[l.operator,l.timeValue,l.unit]},function(l,d,s){var n="";return l===A.G.GreaterThan?n+="> ":n+="< ",n+=d||0,d===1?n+=" "+s.slice(0,-1):n+=" "+s,n}]},listeners:function(d){var s=d.props,n=d.values,r=function(a){var i=a.timeValue,v=a.unit,P=a.operator,f=i||n.timeValue||0,O=v||n.unit,E=f*J[O];s.onChange({operator:P||n.operator,value:E,type:"recording",key:"duration"})};return{setTimeValue:function(a){var i=a.timeValue;return r({timeValue:i})},setUnit:function(a){var i=a.unit;return r({unit:i})},setOperator:function(a){var i=a.operator;return r({operator:i})}}}});function x(l){var d=l.initialFilter,s=l.onChange,n=l.pageKey,r=pe({initialFilter:d,onChange:s,pageKey:n}),t=Object(h.useActions)(r),a=t.setTimeValue,i=t.setIsOpen,v=t.setOperator,P=t.setUnit,f=Object(h.useValues)(r),O=f.durationString,E=f.unit,g=f.timeValue,D=f.operator,u=f.isOpen;return o.a.createElement(ie.a,{visible:u,placement:"bottom-end",fallbackPlacements:["bottom-start"],onClickOutside:function(){return i(!1)},overlay:o.a.createElement(S.a,null,o.a.createElement(oe.b,null,o.a.createElement(Q.a,{operator:D,operators:[A.G.GreaterThan,A.G.LessThan],onChange:function(c){v(c)}}),o.a.createElement(ae.a,{type:"number",value:g!=null?g:void 0,placeholder:"0",min:0,autoFocus:!0,addonAfter:o.a.createElement(U.a,{showSearch:!1,value:E,onChange:function(c){P(c)}},o.a.createElement(U.a.Option,{value:"seconds"},"Seconds"),o.a.createElement(U.a.Option,{value:"minutes"},"Minutes"),o.a.createElement(U.a.Option,{value:"hours"},"Hours")),step:1,onChange:function(c){var b=c.target.value?parseFloat(c.target.value):null;a(b)}})))},o.a.createElement(L.a,{onClick:function(){i(!0)}},O))}try{x.displayName="DurationFilter",x.__docgenInfo={description:"",displayName:"DurationFilter",props:{initialFilter:{defaultValue:null,description:"",name:"initialFilter",required:!0,type:{name:"RecordingDurationFilter"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: RecordingDurationFilter) => void"}},pageKey:{defaultValue:null,description:"",name:"pageKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/session-recordings/DurationFilter.tsx#DurationFilter"]={docgenInfo:x.__docgenInfo,name:"DurationFilter",path:"frontend/src/scenes/session-recordings/DurationFilter.tsx#DurationFilter"})}catch(l){}var ve=e("./frontend/src/scenes/persons/PersonHeader.tsx"),I=e("./frontend/src/lib/utils/eventUsageLogic.ts"),le=e("./frontend/src/lib/components/DateFilter/DateFilter.tsx"),X=e("./frontend/src/lib/components/Tooltip.tsx"),T=e("./frontend/src/lib/components/TaxonomicFilter/types.ts"),V=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),_e=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Z=e.n(_e),de=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/session-recordings/SessionRecordingTable.scss"),M=e.n(de),Y={};Y.insert="head",Y.singleton=!1;var Ee=Z()(M.a,Y),ye=M.a.locals||{},w=e("./frontend/src/lib/components/LemonTable/index.ts"),R=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),G=e("./frontend/src/lib/components/icons.tsx"),$=e("./frontend/src/lib/components/LemonButton/index.ts"),k=e("./frontend/src/scenes/insights/ActionFilter/ActionFilterRow/ActionFilterRow.tsx");function C(l){var d=l.personUUID,s=l.isPersonPage,n=s===void 0?!1:s,r=Object(ue.a)({personUUID:d}),t=Object(h.useValues)(r),a=t.sessionRecordings,i=t.sessionRecordingsResponseLoading,v=t.sessionRecordingId,P=t.entityFilters,f=t.propertyFilters,O=t.hasNext,E=t.hasPrev,g=t.fromDate,D=t.toDate,u=t.durationFilter,p=t.showFilters,c=Object(h.useActions)(r),b=c.openSessionPlayer,_=c.closeSessionPlayer,z=c.setEntityFilters,De=c.setPropertyFilters,Re=c.loadNext,je=c.loadPrev,Te=c.setDateRange,be=c.setDurationFilter,Fe=c.enableFilter,q=c.reportRecordingsListFilterAdded,he=[{title:"Start time",render:function(m,j){return o.a.createElement(R.b,{time:j.start_time,formatString:"MMMM DD, YYYY h:mm"})}},{title:"Duration",render:function(m,j){return o.a.createElement("span",null,Object(ce.N)(j.recording_duration))}},{title:"Person",key:"person",render:function(m,j){return o.a.createElement(ve.a,{withIcon:!0,person:j.person})}},{render:function(m,j){return o.a.createElement("div",{className:"play-button-container"},o.a.createElement(L.a,{className:j.viewed?"play-button viewed":"play-button","data-attr":"session-recordings-button",icon:o.a.createElement(ee.a,null)},"Watch recording"))}}];return o.a.createElement("div",{className:"session-recordings-table","data-attr":"session-recordings-table"},o.a.createElement(S.a,{className:"filter-row"},o.a.createElement("div",{className:"filter-container",style:{display:p?void 0:"none"}},o.a.createElement("div",{className:"space-y-05"},o.a.createElement(B.a.Text,{strong:!0},"Filter by events and actions ",o.a.createElement(X.a,{title:"Show recordings where all of the events or actions listed below happen."},o.a.createElement(te.a,{className:"info-icon"}))),o.a.createElement(se.a,{bordered:!0,filters:P,setFilters:function(m){q(I.e.EventAndAction),z(m)},typeKey:n?"person-".concat(d):"session-recordings",mathAvailability:k.b.None,buttonCopy:"Add filter",hideRename:!0,hideDuplicate:!0,showNestedArrow:!1,actionsTaxonomicGroupTypes:[T.a.Actions,T.a.Events],propertiesTaxonomicGroupTypes:[T.a.EventProperties,T.a.Elements]})),!n&&o.a.createElement("div",{className:"mt-2 space-y-05"},o.a.createElement(B.a.Text,{strong:!0},"Filter by persons and cohorts ",o.a.createElement(X.a,{title:"Show recordings by persons who match the set criteria"},o.a.createElement(te.a,{className:"info-icon"}))),o.a.createElement(V.a,{popoverPlacement:"bottomRight",pageKey:n?"person-".concat(d):"session-recordings",taxonomicGroupTypes:[T.a.PersonProperties,T.a.Cohorts],propertyFilters:f,useLemonButton:!0,onChange:function(m){q(I.e.PersonAndCohort),De(m)}}))),!p&&o.a.createElement($.a,{type:"secondary",size:"small",icon:o.a.createElement(G.IconFilter,null),onClick:function(){if(Fe(),n){var m=document.querySelectorAll(".entity-filter-row button");m.length>0&&m[0].click()}}},"Filter recordings"),o.a.createElement(S.a,{className:"time-filter-row"},o.a.createElement(S.a,{className:"time-filter"},o.a.createElement(le.a,{makeLabel:function(m){return o.a.createElement(o.a.Fragment,null,o.a.createElement(ne.a,null),o.a.createElement("span",null," ",m))},defaultValue:"Last 7 days",bordered:!0,dateFrom:g!=null?g:void 0,dateTo:D!=null?D:void 0,onChange:function(m,j){q(I.e.DateRange),Te(m,j)},dateOptions:{Custom:{values:[]},"Last 24 hours":{values:["-24h"]},"Last 7 days":{values:["-7d"]},"Last 21 days":{values:["-21d"]}}})),o.a.createElement(S.a,{className:"time-filter"},o.a.createElement(B.a.Text,{className:"filter-label"},"Duration"),o.a.createElement(x,{onChange:function(m){q(I.e.Duration),be(m)},initialFilter:u,pageKey:n?"person-".concat(d):"session-recordings"})))),o.a.createElement(w.a,{dataSource:a,columns:he,loading:i,onRow:function(m){return{onClick:function(Se){Se.target.closest("a")||b(m.id,I.d.RecordingsList)}}},rowClassName:"cursor-pointer","data-attr":"session-recording-table",emptyState:"No matching recordings found"}),(E||O)&&o.a.createElement(S.a,{className:"pagination-control"},o.a.createElement(L.a,{type:"link",disabled:!E,onClick:function(){je(),window.scrollTo(0,0)}},o.a.createElement(N.a,null)," Previous"),o.a.createElement(L.a,{type:"link",disabled:!O,onClick:function(){Re(),window.scrollTo(0,0)}},"Next ",o.a.createElement(re.a,null))),o.a.createElement("div",{style:{marginBottom:64}}),!!v&&o.a.createElement(me.a,{isPersonPage:n,onClose:_}))}try{C.displayName="SessionRecordingsTable",C.__docgenInfo={description:"",displayName:"SessionRecordingsTable",props:{personUUID:{defaultValue:null,description:"",name:"personUUID",required:!1,type:{name:"string"}},isPersonPage:{defaultValue:{value:"false"},description:"",name:"isPersonPage",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/session-recordings/SessionRecordingsTable.tsx#SessionRecordingsTable"]={docgenInfo:C.__docgenInfo,name:"SessionRecordingsTable",path:"frontend/src/scenes/session-recordings/SessionRecordingsTable.tsx#SessionRecordingsTable"})}catch(l){}},"./frontend/src/scenes/session-recordings/sessionRecordingsTableLogic.ts":function(H,F,e){"use strict";e.d(F,"a",function(){return d});var K=e("./node_modules/core-js/modules/es.object.keys.js"),o=e.n(K),h=e("./node_modules/core-js/modules/es.symbol.js"),ce=e.n(h),L=e("./node_modules/core-js/modules/es.array.filter.js"),S=e.n(L),B=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),ue=e.n(B),ee=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),te=e.n(ee),ne=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),me=e.n(ne),se=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),N=e.n(se),re=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),A=e.n(re),oe=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ae=e.n(oe),U=e("./node_modules/@babel/runtime/regenerator/index.js"),Q=e.n(U),ie=e("./node_modules/core-js/modules/es.array.iterator.js"),Pe=e.n(ie),fe=e("./node_modules/core-js/modules/es.object.to-string.js"),Oe=e.n(fe),ge=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),W=e.n(ge),J=e("./node_modules/core-js/modules/es.array.concat.js"),pe=e.n(J),x=e("./node_modules/core-js/modules/es.array.map.js"),ve=e.n(x),I=e("./node_modules/kea/lib/index.esm.js"),le=e("./frontend/src/lib/api.ts"),X=e("./frontend/src/lib/utils.tsx"),T=e("./frontend/src/types.ts"),V=e("./node_modules/kea-router/lib/index.js"),_e=e.n(V),Z=e("./frontend/src/lib/utils/eventUsageLogic.ts"),de=e("./node_modules/fast-deep-equal/index.js"),M=e.n(de),Y=e("./frontend/src/scenes/teamLogic.tsx"),Ee=e("./frontend/src/lib/dayjs.ts"),ye=e("./frontend/src/lib/utils/getAppContext.ts");function w(s,n){var r=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);n&&(t=t.filter(function(a){return Object.getOwnPropertyDescriptor(s,a).enumerable})),r.push.apply(r,t)}return r}function R(s){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?w(Object(r),!0).forEach(function(t){A()(s,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})}return s}var G=50,$={type:"recording",key:"duration",value:60,operator:T.G.GreaterThan},k=[],C=Object(ye.b)(),l={events:[],actions:[],new_entity:[{id:C,type:T.m.EVENTS,order:0,name:C}]},d=Object(I.kea)({path:function(n){return["scenes","session-recordings","sessionRecordingsTableLogic",n]},key:function(n){return n.key||n.personUUID||"global"},props:{},connect:{values:[Y.a,["currentTeamId"]],actions:[Z.f,["reportRecordingsListFetched","reportRecordingsListFilterAdded"]]},actions:{getSessionRecordings:!0,openSessionPlayer:function(n,r){return{sessionRecordingId:n,source:r}},closeSessionPlayer:!0,setEntityFilters:function(n){return{filters:n}},setPropertyFilters:function(n){return{filters:n}},loadNext:!0,loadPrev:!0,enableFilter:!0,setOffset:function(n){return{offset:n}},setDateRange:function(n,r){return{incomingFromDate:n,incomingToDate:r}},setDurationFilter:function(n){return{durationFilter:n}}},loaders:function(n){var r=n.props,t=n.values,a=n.actions;return{sessionRecordingsResponse:[{results:[],has_next:!1},{getSessionRecordings:function(){var i=ae()(Q.a.mark(function P(f,O){var E,g,D,u,p,c;return Q.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return g=R(R({},t.filterQueryParams),{},{person_uuid:(E=r.personUUID)!==null&&E!==void 0?E:"",limit:G}),D=Object(X.zb)(g),_.next=4,O(100);case 4:return u=performance.now(),_.next=7,le.b.get("api/projects/".concat(t.currentTeamId,"/session_recordings?").concat(D));case 7:return p=_.sent,c=performance.now()-u,a.reportRecordingsListFetched(c),O(),_.abrupt("return",p);case 12:case"end":return _.stop()}},P)}));function v(P,f){return i.apply(this,arguments)}return v}()}]}},events:function(n){var r=n.actions;return{afterMount:function(){r.getSessionRecordings()}}},reducers:{filterEnabled:[!1,{enableFilter:function(){return!0}}],sessionRecordings:[[],{getSessionRecordingsSuccess:function(n,r){var t=r.sessionRecordingsResponse;return N()(t.results)},openSessionPlayer:function(n,r){var t=r.sessionRecordingId;return N()(n.map(function(a){return a.id===t?R(R({},a),{},{viewed:!0}):R({},a)}))}}],sessionRecordingId:[null,{openSessionPlayer:function(n,r){var t=r.sessionRecordingId;return t},closeSessionPlayer:function(){return null}}],entityFilters:[l,{setEntityFilters:function(n,r){var t=r.filters;return R({},t)}}],propertyFilters:[k,{setPropertyFilters:function(n,r){var t=r.filters;return N()(t)}}],durationFilter:[$,{setDurationFilter:function(n,r){var t=r.durationFilter;return t}}],offset:[0,{loadNext:function(n){return n+G},loadPrev:function(n){return Math.max(n-G)},setOffset:function(n,r){var t=r.offset;return t}}],fromDate:[Object(Ee.a)().subtract(7,"days").format("YYYY-MM-DD"),{setDateRange:function(n,r){var t=r.incomingFromDate;return t!=null?t:null}}],toDate:[null,{setDateRange:function(n,r){var t=r.incomingToDate;return t!=null?t:null}}]},listeners:function(n){var r=n.actions;return{setEntityFilters:function(){r.getSessionRecordings()},setPropertyFilters:function(){r.getSessionRecordings()},setDateRange:function(){r.getSessionRecordings()},setDurationFilter:function(){r.getSessionRecordings()},loadNext:function(){r.getSessionRecordings()},loadPrev:function(){r.getSessionRecordings()}}},selectors:{hasPrev:[function(s){return[s.offset]},function(s){return s>0}],hasNext:[function(s){return[s.sessionRecordingsResponse]},function(s){return s.has_next}],showFilters:[function(s){return[s.filterEnabled,s.entityFilters,s.propertyFilters]},function(s,n,r){return s||n!==l||r!==k}],filterQueryParams:[function(s){return[s.entityFilters,s.fromDate,s.toDate,s.offset,s.durationFilter,s.propertyFilters]},function(s,n,r,t,a,i){return{actions:s.actions,events:s.events,properties:i,date_from:n,date_to:r,offset:t,session_recording_duration:a}}]},actionToUrl:function(n){var r=n.values,t=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},v=arguments.length>1?arguments[1]:void 0,P=R({filters:r.filterQueryParams},i),f=R({},V.router.values.hashParams);return r.sessionRecordingId?f.sessionRecordingId=r.sessionRecordingId:delete f.sessionRecordingId,[V.router.values.location.pathname,P,f,{replace:v}]};return{loadSessionRecordings:function(){return t({},!0)},openSessionPlayer:function(i){var v=i.source;return t({source:v},!1)},closeSessionPlayer:function(){return t({},!1)},setEntityFilters:function(){return t({},!0)},setPropertyFilters:function(){return t({},!0)},setDateRange:function(){return t({},!0)},setDurationFilter:function(){return t({},!0)},loadNext:function(){return t({},!0)},loadPrev:function(){return t({},!0)}}},urlToAction:function(n){var r=n.actions,t=n.values,a=n.props,i=function(f,O,E){var g,D=(g=E.sessionRecordingId)!==null&&g!==void 0?g:null;D!==t.sessionRecordingId&&r.openSessionPlayer(D,Z.d.Direct);var u=O.filters;if(u){if((!M()(u.actions,t.entityFilters.actions)||!M()(u.events,t.entityFilters.events))&&r.setEntityFilters({events:u.events||[],actions:u.actions||[]}),!M()(u.properties,t.propertyFilters)){var p;r.setPropertyFilters((p=u.properties)!==null&&p!==void 0?p:[])}if(u.date_from!==t.fromDate||u.date_to!==t.toDate){var c,b;r.setDateRange((c=u.date_from)!==null&&c!==void 0?c:void 0,(b=u.date_to)!==null&&b!==void 0?b:void 0)}if(u.offset!==t.offset){var _;r.setOffset((_=u.offset)!==null&&_!==void 0?_:0)}if(!M()(u.session_recording_duration,t.durationFilter)){var z;r.setDurationFilter((z=u.session_recording_duration)!==null&&z!==void 0?z:$)}}},v=a.personUUID?"/person/*":"/recordings";return A()({},v,i)}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/session-recordings/SessionRecordingTable.scss":function(H,F,e){var K=e("./node_modules/css-loader/dist/runtime/api.js");F=K(!1),F.push([H.i,".session-recordings-table .filter-row{width:100%;justify-content:space-between;margin-bottom:1rem;align-items:flex-end}.session-recordings-table .filter-container{max-width:700px;padding:1rem;border:1px solid var(--border);flex:1;border-radius:var(--radius)}.session-recordings-table .filter-section{padding-bottom:1rem}.session-recordings-table .session-recording-action-property-filter{margin:0 0 0 68px;background-color:var(--antd-table-background-dark);border-top-width:1px;border:1px solid var(--border);border-top:0 solid var(--border);padding:.25rem 1rem}.session-recordings-table .time-filter-row{justify-content:flex-end;align-items:flex-end}.session-recordings-table .time-filter-row .time-filter{align-items:center;margin-left:1rem}.session-recordings-table .time-filter-row .time-filter .filter-label{margin-right:4px}.session-recordings-table .pagination-control{margin:1rem;justify-content:center}.session-recordings-table .entity-filter-row{width:100%;padding:1rem;border:1px solid var(--border);margin-top:1rem;border-radius:var(--radius)}.session-recordings-table .play-button-container{display:flex;justify-content:flex-end}.session-recordings-table .play-button-container .play-button .anticon-play-circle{color:var(--primary)}.session-recordings-table .play-button-container .play-button.viewed .anticon-play-circle{color:var(--text-muted)}.session-recordings-table .info-icon{color:var(--primary)}",""]),H.exports=F}}]);
