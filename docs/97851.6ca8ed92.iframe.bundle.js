"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[97851],{"../../node_modules/.pnpm/react-email-editor@1.7.11_react@18.2.0/node_modules/react-email-editor/dist/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("../../node_modules/.pnpm/react-email-editor@1.7.11_react@18.2.0/node_modules/react-email-editor/dist/react-email-editor.cjs.production.min.js")},"../../node_modules/.pnpm/react-email-editor@1.7.11_react@18.2.0/node_modules/react-email-editor/dist/react-email-editor.cjs.production.min.js":(__unused_webpack_module,exports,__webpack_require__)=>{var t=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),n=t&&"object"==typeof t&&"default"in t?t.default:t;function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}var r=[],i=!1,l=function(){if(i)for(var e;e=r.shift();)e()},d="undefined"==typeof window?{__unlayer_lastEditorId:0}:window;d.__unlayer_lastEditorId=d.__unlayer_lastEditorId||0,exports.default=n.forwardRef(function(e,a){var u,s,c,f,p,y,v,E,m,_=e.onLoad,h=e.onReady,j=e.scriptUrl,b=e.minHeight,O=e.style,w=t.useState(null),x=w[0],M=w[1],L=t.useState(!1),S=L[0],H=L[1],R=t.useMemo(function(){return e.editorId||"editor-"+ ++d.__unlayer_lastEditorId},[e.editorId]),k=o({},e.options||{},{appearance:null!=(u=e.appearance)?u:null==(s=e.options)?void 0:s.appearance,displayMode:(null==e?void 0:e.displayMode)||(null==(c=e.options)?void 0:c.displayMode)||"email",locale:null!=(f=e.locale)?f:null==(p=e.options)?void 0:p.locale,projectId:null!=(y=e.projectId)?y:null==(v=e.options)?void 0:v.projectId,tools:null!=(E=e.tools)?E:null==(m=e.options)?void 0:m.tools,id:R,source:{name:"react-email-editor",version:"1.7.11"}});t.useImperativeHandle(a,function(){return{editor:x}},[x]),t.useEffect(function(){return function(){null==x||x.destroy()}},[]),t.useEffect(function(){H(!1),function(e,t){if(void 0===t&&(t="https://editor.unlayer.com/embed.js?2"),r.push(function(){return H(!0)}),e1=t,t1=document.querySelectorAll("script"),n=!1,t1.forEach(function(t){t.src.includes(e1)&&(n=!0)}),n)l();else{var e1,t1,n,n1=document.createElement("script");n1.setAttribute("src",t),n1.onload=function(){i=!0,l()},document.head.appendChild(n1)}}(0,j)},[j]),t.useEffect(function(){S&&(null==x||x.destroy(),M(unlayer.createEditor(k)))},[JSON.stringify(k),S]);var q=Object.keys(e).filter(function(e){return/^on/.test(e)});return t.useEffect(function(){x&&(null==_||_(x),q.forEach(function(t){/^on/.test(t)&&"onLoad"!==t&&"onReady"!==t&&"function"==typeof e[t]&&x.addEventListener(t,e[t])}),h&&x.addEventListener("editor:ready",function(){h(x)}))},[x,Object.keys(q).join(",")]),n.createElement("div",{style:{flex:1,display:"flex",minHeight:void 0===b?500:b}},n.createElement("div",{id:R,style:o({},void 0===O?{}:O,{flex:1})}))})},"../../node_modules/.pnpm/liquidjs@10.21.1/node_modules/liquidjs/dist/liquid.browser.mjs":(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Kj:()=>Liquid});class Token{constructor(kind,input,begin,end,file){this.kind=kind,this.input=input,this.begin=begin,this.end=end,this.file=file}getText(){return this.input.slice(this.begin,this.end)}getPosition(){let[row,col]=[1,1];for(let i=0;i<this.begin;i++)"\n"===this.input[i]?(row++,col=1):col++;return[row,col]}size(){return this.end-this.begin}}class Drop{liquidMethodMissing(key){}}let toString$1=Object.prototype.toString,toLowerCase=String.prototype.toLowerCase,hasOwnProperty=Object.hasOwnProperty;function isString(value){return"string"==typeof value}function isFunction(value){return"function"==typeof value}function isPromise(val){return val&&isFunction(val.then)}function isIterator(val){return val&&isFunction(val.next)&&isFunction(val.throw)&&isFunction(val.return)}function escapeRegex(str){return str.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}function stringify(value){return isString(value=toValue(value))?value:isNil(value)?"":isArray(value)?value.map(x=>stringify(x)).join(""):String(value)}function toEnumerable(val){return isArray(val=toValue(val))?val:isString(val)&&val.length>0?[val]:isIterable(val)?Array.from(val):isObject(val)?Object.keys(val).map(key=>[key,val[key]]):[]}function toArray(val){return isNil(val=toValue(val))?[]:isArray(val)?val:[val]}function toValue(value){return value instanceof Drop&&isFunction(value.valueOf)?value.valueOf():value}function toNumber(value){return isNaN(value=Number(value))?0:value}function isNumber(value){return"number"==typeof value}function toLiquid(value){return value&&isFunction(value.toLiquid)?toLiquid(value.toLiquid()):value}function isNil(value){return null==value}function isUndefined(value){return void 0===value}function isArray(value){return"[object Array]"===toString$1.call(value)}function isArrayLike(value){return value&&isNumber(value.length)}function isIterable(value){return isObject(value)&&Symbol.iterator in value}function forOwn(obj,iteratee){for(let k in obj=obj||{})if(hasOwnProperty.call(obj,k)&&!1===iteratee(obj[k],k,obj))break;return obj}function last(arr){return arr[arr.length-1]}function isObject(value){let type=typeof value;return null!==value&&("object"===type||"function"===type)}function range(start,stop,step=1){let arr=[];for(let i=start;i<stop;i+=step)arr.push(i);return arr}function padStart(str,length,ch=" "){return pad(str,length,ch,(str,ch)=>ch+str)}function padEnd(str,length,ch=" "){return pad(str,length,ch,(str,ch)=>str+ch)}function pad(str,length,ch,add){let n=length-(str=String(str)).length;for(;n-- >0;)str=add(str,ch);return str}function identify(val){return val}function changeCase(str){return[...str].some(ch=>ch>="a"&&ch<="z")?str.toUpperCase():str.toLowerCase()}function ellipsis(str,N){return str.length>N?str.slice(0,N-3)+"...":str}function caseInsensitiveCompare(a,b){return null==a&&null==b?0:null==a?1:null==b?-1:(a=toLowerCase.call(a))<(b=toLowerCase.call(b))?-1:+(a>b)}function argumentsToValue(fn){return function(...args){return fn.call(this,...args.map(toValue))}}function escapeRegExp(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function*strictUniq(array){let seen=new Set;for(let element of array){let key=JSON.stringify(element);seen.has(key)||(seen.add(key),yield element)}}let TRAIT="__liquidClass__";class LiquidError extends Error{constructor(err,token){super("string"==typeof err?err:err.message),this.context="","string"!=typeof err&&Object.defineProperty(this,"originalError",{value:err,enumerable:!1}),Object.defineProperty(this,"token",{value:token,enumerable:!1}),Object.defineProperty(this,TRAIT,{value:"LiquidError",enumerable:!1})}update(){Object.defineProperty(this,"context",{value:mkContext(this.token),enumerable:!1}),this.message=mkMessage(this.message,this.token),this.stack=this.message+"\n"+this.context+"\n"+this.stack,this.originalError&&(this.stack+="\nFrom "+this.originalError.stack)}static is(obj){return(null==obj?void 0:obj[TRAIT])==="LiquidError"}}class TokenizationError extends LiquidError{constructor(message,token){super(message,token),this.name="TokenizationError",super.update()}}class ParseError extends LiquidError{constructor(err,token){super(err,token),this.name="ParseError",this.message=err.message,super.update()}}class RenderError extends LiquidError{constructor(err,tpl){super(err,tpl.token),this.name="RenderError",this.message=err.message,super.update()}static is(obj){return"RenderError"===obj.name}}class LiquidErrors extends LiquidError{constructor(errors){super(errors[0],errors[0].token),this.errors=errors,this.name="LiquidErrors";let s=errors.length>1?"s":"";this.message=`${errors.length} error${s} found`,super.update()}static is(obj){return"LiquidErrors"===obj.name}}class UndefinedVariableError extends LiquidError{constructor(err,token){super(err,token),this.name="UndefinedVariableError",this.message=err.message,super.update()}}class InternalUndefinedVariableError extends Error{constructor(variableName){super(`undefined variable: ${variableName}`),this.name="InternalUndefinedVariableError",this.variableName=variableName}}class AssertionError extends Error{constructor(message){super(message),this.name="AssertionError",this.message=message+""}}function mkContext(token){let[line,col]=token.getPosition(),lines=token.input.split("\n"),begin=Math.max(line-2,1),end=Math.min(line+3,lines.length);return range(begin,end+1).map(lineNumber=>{let num=padStart(String(lineNumber),String(end).length),text=`${lineNumber===line?">> ":"   "}${num}| `,colIndicator=lineNumber===line?"\n"+padStart("^",col+text.length):"";return text+=lines[lineNumber-1],text+=colIndicator}).join("\n")}function mkMessage(msg,token){token.file&&(msg+=`, file:${token.file}`);let[line,col]=token.getPosition();return msg+`, line:${line}, col:${col}`}let TYPES=[0,0,0,0,0,0,0,0,0,20,4,4,4,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,2,8,0,0,0,0,8,0,0,0,64,0,65,0,0,33,33,33,33,33,33,33,33,33,33,0,0,2,2,2,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0];function isWord(char){let code=char.charCodeAt(0);return code>=128?!TYPES[code]:!!(1&TYPES[code])}function assert(predicate,message){if(!predicate)throw new AssertionError("function"==typeof message?message():message||`expect ${predicate} to be true`)}function assertEmpty(predicate,message=`unexpected ${JSON.stringify(predicate)}`){assert(!predicate,message)}TYPES[160]=TYPES[5760]=TYPES[6158]=TYPES[8192]=TYPES[8193]=TYPES[8194]=TYPES[8195]=TYPES[8196]=TYPES[8197]=TYPES[8198]=TYPES[8199]=TYPES[8200]=TYPES[8201]=TYPES[8202]=TYPES[8232]=TYPES[8233]=TYPES[8239]=TYPES[8287]=TYPES[12288]=4,TYPES[8220]=TYPES[8221]=128;class EmptyDrop extends Drop{equals(value){return!(value instanceof EmptyDrop)&&(isString(value=toValue(value))||isArray(value)?0===value.length:!!isObject(value)&&0===Object.keys(value).length)}gt(){return!1}geq(){return!1}lt(){return!1}leq(){return!1}valueOf(){return""}static is(value){return value instanceof EmptyDrop}}class BlankDrop extends EmptyDrop{equals(value){return!!(!1===value||isNil(toValue(value)))||(isString(value)?/^\s*$/.test(value):super.equals(value))}static is(value){return value instanceof BlankDrop}}class ForloopDrop extends Drop{constructor(length,collection,variable){super(),this.i=0,this.length=length,this.name=`${variable}-${collection}`}next(){this.i++}index0(){return this.i}index(){return this.i+1}first(){return 0===this.i}last(){return this.i===this.length-1}rindex(){return this.length-this.i}rindex0(){return this.length-this.i-1}valueOf(){return JSON.stringify(this)}}class SimpleEmitter{constructor(){this.buffer=""}write(html){this.buffer+=stringify(html)}}class StreamedEmitter{constructor(){throw this.buffer="",this.stream=null,Error("streaming not supported in browser")}}class KeepingTypeEmitter{constructor(){this.buffer=""}write(html){"string"!=typeof(html=toValue(html))&&""===this.buffer?this.buffer=html:this.buffer=stringify(this.buffer)+stringify(html)}}class BlockDrop extends Drop{constructor(superBlockRender=()=>""){super(),this.superBlockRender=superBlockRender}*super(){let emitter=new SimpleEmitter;return yield this.superBlockRender(emitter),emitter.buffer}}function isComparable(arg){return arg&&isFunction(arg.equals)&&isFunction(arg.gt)&&isFunction(arg.geq)&&isFunction(arg.lt)&&isFunction(arg.leq)}let nil=new class extends Drop{equals(value){return isNil(toValue(value))}gt(){return!1}geq(){return!1}lt(){return!1}leq(){return!1}valueOf(){return null}},literalValues={true:!0,false:!1,nil:nil,null:nil,empty:new EmptyDrop,blank:new BlankDrop};function createTrie(input){let trie={};for(let[name,data]of Object.entries(input)){let node=trie;for(let i=0;i<name.length;i++){let c=name[i];node[c]=node[c]||{},i===name.length-1&&isWord(name[i])&&(node[c].needBoundary=!0),node=node[c]}node.data=data,node.end=!0}return trie}var LookupType,TokenKind,BlockMode,__assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __awaiter(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function toPromise(val){return __awaiter(this,void 0,void 0,function*(){let value;if(!isIterator(val))return val;let done=!1,next="next";do{let state=val[next](value);done=state.done,value=state.value,next="next";try{isIterator(value)&&(value=toPromise(value)),isPromise(value)&&(value=yield value)}catch(err){next="throw",value=err}}while(!done)return value})}function toValueSync(val){let value;if(!isIterator(val))return val;let done=!1,next="next";do{let state=val[next](value);if(done=state.done,value=state.value,next="next",isIterator(value))try{value=toValueSync(value)}catch(err){next="throw",value=err}}while(!done)return value}let rFormat=/%([-_0^#:]+)?(\d+)?([EO])?(.)/;function daysInMonth(d){return[31,isLeapYear(d)?29:28,31,30,31,30,31,31,30,31,30,31]}function getDayOfYear(d){let num=0;for(let i=0;i<d.getMonth();++i)num+=daysInMonth(d)[i];return num+d.getDate()}function getWeekOfYear(d,startDay){return String(Math.floor((getDayOfYear(d)+(startDay-d.getDay())-(7-new Date(d.getFullYear(),0,1).getDay()+startDay))/7)+1)}function isLeapYear(d){let year=d.getFullYear();return!!((3&year)==0&&(year%100||year%400==0&&year))}function ordinal(d){let date=d.getDate();if([11,12,13].includes(date))return"th";switch(date%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}function century(d){return parseInt(d.getFullYear().toString().substring(0,2),10)}let padWidths={d:2,e:2,H:2,I:2,j:3,k:2,l:2,L:3,m:2,M:2,S:2,U:2,W:2},padSpaceChars=new Set("aAbBceklpP");function getTimezoneOffset(d,opts){let nOffset=Math.abs(d.getTimezoneOffset()),h=Math.floor(nOffset/60);return(d.getTimezoneOffset()>0?"-":"+")+padStart(h,2,"0")+(opts.flags[":"]?":":"")+padStart(nOffset%60,2,"0")}let formatCodes={a:d=>d.getShortWeekdayName(),A:d=>d.getLongWeekdayName(),b:d=>d.getShortMonthName(),B:d=>d.getLongMonthName(),c:d=>d.toLocaleString(),C:d=>century(d),d:d=>d.getDate(),e:d=>d.getDate(),H:d=>d.getHours(),I:d=>String(d.getHours()%12||12),j:d=>getDayOfYear(d),k:d=>d.getHours(),l:d=>String(d.getHours()%12||12),L:d=>d.getMilliseconds(),m:d=>d.getMonth()+1,M:d=>d.getMinutes(),N:(d,opts)=>{let width=Number(opts.width)||9;return padEnd(String(d.getMilliseconds()).slice(0,width),width,"0")},p:d=>12>d.getHours()?"AM":"PM",P:d=>12>d.getHours()?"am":"pm",q:d=>ordinal(d),s:d=>Math.round(d.getTime()/1e3),S:d=>d.getSeconds(),u:d=>d.getDay()||7,U:d=>getWeekOfYear(d,0),w:d=>d.getDay(),W:d=>getWeekOfYear(d,1),x:d=>d.toLocaleDateString(),X:d=>d.toLocaleTimeString(),y:d=>d.getFullYear().toString().slice(2,4),Y:d=>d.getFullYear(),z:getTimezoneOffset,Z:(d,opts)=>d.getTimeZoneName()||getTimezoneOffset(d,opts),t:()=>"	",n:()=>"\n","%":()=>"%"};function strftime(d,formatStr){let match,output="",remaining=formatStr;for(;match=rFormat.exec(remaining);)output+=remaining.slice(0,match.index),remaining=remaining.slice(match.index+match[0].length),output+=format(d,match);return output+remaining}function format(d,match){let[input,flagStr="",width,modifier,conversion]=match,convert=formatCodes[conversion];if(!convert)return input;let flags={};for(let flag of flagStr)flags[flag]=!0;let ret=String(convert(d,{flags,width,modifier})),padChar=padSpaceChars.has(conversion)?" ":"0",padWidth=width||padWidths[conversion]||0;return flags["^"]?ret=ret.toUpperCase():flags["#"]&&(ret=changeCase(ret)),flags._?padChar=" ":flags["0"]&&(padChar="0"),flags["-"]&&(padWidth=0),padStart(ret,padWidth,padChar)}function getDateTimeFormat(){return"undefined"!=typeof Intl?Intl.DateTimeFormat:void 0}formatCodes.h=formatCodes.b;let TIMEZONE_PATTERN=/([zZ]|([+-])(\d{2}):?(\d{2}))$/,monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort=monthNames.map(name=>name.slice(0,3)),dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort=dayNames.map(name=>name.slice(0,3));class LiquidDate{constructor(init,locale,timezone){this.locale=locale,this.DateTimeFormat=getDateTimeFormat(),this.date=new Date(init),this.timezoneFixed=void 0!==timezone,void 0===timezone&&(timezone=this.date.getTimezoneOffset()),this.timezoneOffset=isString(timezone)?LiquidDate.getTimezoneOffset(timezone,this.date):timezone,this.timezoneName=isString(timezone)?timezone:"";let diff=(this.date.getTimezoneOffset()-this.timezoneOffset)*6e4,time=this.date.getTime()+diff;this.displayDate=new Date(time)}getTime(){return this.displayDate.getTime()}getMilliseconds(){return this.displayDate.getMilliseconds()}getSeconds(){return this.displayDate.getSeconds()}getMinutes(){return this.displayDate.getMinutes()}getHours(){return this.displayDate.getHours()}getDay(){return this.displayDate.getDay()}getDate(){return this.displayDate.getDate()}getMonth(){return this.displayDate.getMonth()}getFullYear(){return this.displayDate.getFullYear()}toLocaleString(locale,init){return(null==init?void 0:init.timeZone)?this.date.toLocaleString(locale,init):this.displayDate.toLocaleString(locale,init)}toLocaleTimeString(locale){return this.displayDate.toLocaleTimeString(locale)}toLocaleDateString(locale){return this.displayDate.toLocaleDateString(locale)}getTimezoneOffset(){return this.timezoneOffset}getTimeZoneName(){return this.timezoneFixed?this.timezoneName:this.DateTimeFormat?this.DateTimeFormat().resolvedOptions().timeZone:void 0}getLongMonthName(){var _a;return null!==(_a=this.format({month:"long"}))&&void 0!==_a?_a:monthNames[this.getMonth()]}getShortMonthName(){var _a;return null!==(_a=this.format({month:"short"}))&&void 0!==_a?_a:monthNamesShort[this.getMonth()]}getLongWeekdayName(){var _a;return null!==(_a=this.format({weekday:"long"}))&&void 0!==_a?_a:dayNames[this.displayDate.getDay()]}getShortWeekdayName(){var _a;return null!==(_a=this.format({weekday:"short"}))&&void 0!==_a?_a:dayNamesShort[this.displayDate.getDay()]}valid(){return!isNaN(this.getTime())}format(options){return this.DateTimeFormat&&this.DateTimeFormat(this.locale,options).format(this.displayDate)}static createDateFixedToTimezone(dateString,locale){let m=dateString.match(TIMEZONE_PATTERN);if(m&&"Z"===m[1])return new LiquidDate(+new Date(dateString),locale,0);if(m&&m[2]&&m[3]&&m[4]){let[,,sign,hours,minutes]=m,offset=("+"===sign?-1:1)*(60*parseInt(hours,10)+parseInt(minutes,10));return new LiquidDate(+new Date(dateString),locale,offset)}return new LiquidDate(dateString,locale)}static getTimezoneOffset(timezoneName,date){let localDateString=date.toLocaleString("en-US",{timeZone:timezoneName}),utcDateString=date.toLocaleString("en-US",{timeZone:"UTC"}),localDate=new Date(localDateString);return(+new Date(utcDateString)-+localDate)/6e4}}class Limiter{constructor(resource,limit){this.base=0,this.message=`${resource} limit exceeded`,this.limit=limit}use(count){count=toNumber(count),assert(this.base+count<=this.limit,this.message),this.base+=count}check(count){assert((count=toNumber(count))<=this.limit,this.message)}}class DelimitedToken extends Token{constructor(kind,[contentBegin,contentEnd],input,begin,end,trimLeft,trimRight,file){super(kind,input,begin,end,file),this.trimLeft=!1,this.trimRight=!1;let tl="-"===input[contentBegin],tr="-"===input[contentEnd-1],l=tl?contentBegin+1:contentBegin,r=tr?contentEnd-1:contentEnd;for(;l<r&&4&TYPES[input.charCodeAt(l)];)l++;for(;r>l&&4&TYPES[input.charCodeAt(r-1)];)r--;this.contentRange=[l,r],this.trimLeft=tl||trimLeft,this.trimRight=tr||trimRight}get content(){return this.input.slice(this.contentRange[0],this.contentRange[1])}}class TagToken extends DelimitedToken{constructor(input,begin,end,options,file){let{trimTagLeft,trimTagRight,tagDelimiterLeft,tagDelimiterRight}=options,[valueBegin,valueEnd]=[begin+tagDelimiterLeft.length,end-tagDelimiterRight.length];super(TokenKind.Tag,[valueBegin,valueEnd],input,begin,end,trimTagLeft,trimTagRight,file),this.tokenizer=new Tokenizer(input,options.operators,file,this.contentRange),this.name=this.tokenizer.readTagName(),this.tokenizer.assert(this.name,"illegal tag syntax, tag name expected"),this.tokenizer.skipBlank(),this.args=this.tokenizer.input.slice(this.tokenizer.p,this.contentRange[1])}}class OutputToken extends DelimitedToken{constructor(input,begin,end,options,file){let{trimOutputLeft,trimOutputRight,outputDelimiterLeft,outputDelimiterRight}=options;super(TokenKind.Output,[begin+outputDelimiterLeft.length,end-outputDelimiterRight.length],input,begin,end,trimOutputLeft,trimOutputRight,file)}}class HTMLToken extends Token{constructor(input,begin,end,file){super(TokenKind.HTML,input,begin,end,file),this.input=input,this.begin=begin,this.end=end,this.file=file,this.trimLeft=0,this.trimRight=0}getContent(){return this.input.slice(this.begin+this.trimLeft,this.end-this.trimRight)}}class NumberToken extends Token{constructor(input,begin,end,file){super(TokenKind.Number,input,begin,end,file),this.input=input,this.begin=begin,this.end=end,this.file=file,this.content=Number(this.getText())}}class IdentifierToken extends Token{constructor(input,begin,end,file){super(TokenKind.Word,input,begin,end,file),this.input=input,this.begin=begin,this.end=end,this.file=file,this.content=this.getText()}}class LiteralToken extends Token{constructor(input,begin,end,file){super(TokenKind.Literal,input,begin,end,file),this.input=input,this.begin=begin,this.end=end,this.file=file,this.literal=this.getText(),this.content=literalValues[this.literal]}}let operatorPrecedences={"==":2,"!=":2,">":2,"<":2,">=":2,"<=":2,contains:2,not:1,and:0,or:0},operatorTypes={"==":0,"!=":0,">":0,"<":0,">=":0,"<=":0,contains:0,not:1,and:0,or:0};class OperatorToken extends Token{constructor(input,begin,end,file){super(TokenKind.Operator,input,begin,end,file),this.input=input,this.begin=begin,this.end=end,this.file=file,this.operator=this.getText()}getPrecedence(){let key=this.getText();return key in operatorPrecedences?operatorPrecedences[key]:1}}class PropertyAccessToken extends Token{constructor(variable,props,input,begin,end,file){super(TokenKind.PropertyAccess,input,begin,end,file),this.variable=variable,this.props=props}}class FilterToken extends Token{constructor(name,args,input,begin,end,file){super(TokenKind.Filter,input,begin,end,file),this.name=name,this.args=args}}class HashToken extends Token{constructor(input,begin,end,name,value,file){super(TokenKind.Hash,input,begin,end,file),this.input=input,this.begin=begin,this.end=end,this.name=name,this.value=value,this.file=file}}let rHex=/[\da-fA-F]/,rOct=/[0-7]/,escapeChar={b:"\b",f:"\f",n:"\n",r:"\r",t:"	",v:"\v"};function hexVal(c){let code=c.charCodeAt(0);return code>=97?code-87:code>=65?code-55:code-48}function parseStringLiteral(str){let ret="";for(let i=1;i<str.length-1;i++){if("\\"!==str[i]){ret+=str[i];continue}if(void 0!==escapeChar[str[i+1]])ret+=escapeChar[str[++i]];else if("u"===str[i+1]){let val=0,j=i+2;for(;j<=i+5&&rHex.test(str[j]);)val=16*val+hexVal(str[j++]);i=j-1,ret+=String.fromCharCode(val)}else if(rOct.test(str[i+1])){let j=i+1,val=0;for(;j<=i+3&&rOct.test(str[j]);)val=8*val+hexVal(str[j++]);i=j-1,ret+=String.fromCharCode(val)}else ret+=str[++i]}return ret}class QuotedToken extends Token{constructor(input,begin,end,file){super(TokenKind.Quoted,input,begin,end,file),this.input=input,this.begin=begin,this.end=end,this.file=file,this.content=parseStringLiteral(this.getText())}}class RangeToken extends Token{constructor(input,begin,end,lhs,rhs,file){super(TokenKind.Range,input,begin,end,file),this.input=input,this.begin=begin,this.end=end,this.lhs=lhs,this.rhs=rhs,this.file=file}}class LiquidTagToken extends DelimitedToken{constructor(input,begin,end,options,file){super(TokenKind.Tag,[begin,end],input,begin,end,!1,!1,file),this.tokenizer=new Tokenizer(input,options.operators,file,this.contentRange),this.name=this.tokenizer.readTagName(),this.tokenizer.assert(this.name,"illegal liquid tag syntax"),this.tokenizer.skipBlank()}get args(){return this.tokenizer.input.slice(this.tokenizer.p,this.contentRange[1])}}class FilteredValueToken extends Token{constructor(initial,filters,input,begin,end,file){super(TokenKind.FilteredValue,input,begin,end,file),this.initial=initial,this.filters=filters,this.input=input,this.begin=begin,this.end=end,this.file=file}}let polyfill={now:()=>Date.now()};function getPerformance(){return"object"==typeof global&&global.performance||"object"==typeof window&&window.performance||polyfill}class Render{renderTemplatesToNodeStream(templates,ctx){let emitter=new StreamedEmitter;return Promise.resolve().then(()=>toPromise(this.renderTemplates(templates,ctx,emitter))).then(()=>emitter.end(),err=>emitter.error(err)),emitter.stream}*renderTemplates(templates,ctx,emitter){emitter||(emitter=ctx.opts.keepOutputType?new KeepingTypeEmitter:new SimpleEmitter);let errors=[];for(let tpl of templates){ctx.renderLimit.check(getPerformance().now());try{let html=yield tpl.render(ctx,emitter);if(html&&emitter.write(html),ctx.breakCalled||ctx.continueCalled)break}catch(e){let err=LiquidError.is(e)?e:new RenderError(e,tpl);if(ctx.opts.catchAllErrors)errors.push(err);else throw err}}if(errors.length)throw new LiquidErrors(errors);return emitter.buffer}}class Expression{constructor(tokens){this.postfix=[...toPostfix(tokens)]}*evaluate(ctx,lenient){assert(ctx,"unable to evaluate: context not defined");let operands=[];for(let token of this.postfix)if(isOperatorToken(token)){let result;let r=operands.pop();if(1===operatorTypes[token.operator])result=yield ctx.opts.operators[token.operator](r,ctx);else{let l=operands.pop();result=yield ctx.opts.operators[token.operator](l,r,ctx)}operands.push(result)}else operands.push((yield evalToken(token,ctx,lenient)));return operands[0]}valid(){return!!this.postfix.length}}function*evalToken(token,ctx,lenient=!1){if(token){if("content"in token)return token.content;if(isPropertyAccessToken(token))return yield evalPropertyAccessToken(token,ctx,lenient);if(isRangeToken(token))return yield evalRangeToken(token,ctx)}}function*evalPropertyAccessToken(token,ctx,lenient){let props=[];for(let prop of token.props)props.push((yield evalToken(prop,ctx,!1)));try{if(!token.variable)return yield ctx._get(props);{let variable=yield evalToken(token.variable,ctx,lenient);return yield ctx._getFromScope(variable,props)}}catch(e){if(lenient&&"InternalUndefinedVariableError"===e.name)return null;throw new UndefinedVariableError(e,token)}}function evalQuotedToken(token){return token.content}function*evalRangeToken(token,ctx){let low=yield evalToken(token.lhs,ctx),high=yield evalToken(token.rhs,ctx);return ctx.memoryLimit.use(high-low+1),range(+low,+high+1)}function*toPostfix(tokens){let ops=[];for(let token of tokens)if(isOperatorToken(token)){for(;ops.length&&ops[ops.length-1].getPrecedence()>token.getPrecedence();)yield ops.pop();ops.push(token)}else yield token;for(;ops.length;)yield ops.pop()}function isTruthy(val,ctx){return!isFalsy(val,ctx)}function isFalsy(val,ctx){return(val=toValue(val),ctx.opts.jsTruthy)?!val:!1===val||null==val}let defaultOperators={"==":equals,"!=":(l,r)=>!equals(l,r),">":(l,r)=>isComparable(l)?l.gt(r):isComparable(r)?r.lt(l):toValue(l)>toValue(r),"<":(l,r)=>isComparable(l)?l.lt(r):isComparable(r)?r.gt(l):toValue(l)<toValue(r),">=":(l,r)=>isComparable(l)?l.geq(r):isComparable(r)?r.leq(l):toValue(l)>=toValue(r),"<=":(l,r)=>isComparable(l)?l.leq(r):isComparable(r)?r.geq(l):toValue(l)<=toValue(r),contains:(l,r)=>isArray(l=toValue(l))?l.some(i=>equals(i,r)):!!isFunction(null==l?void 0:l.indexOf)&&l.indexOf(toValue(r))>-1,not:(v,ctx)=>isFalsy(toValue(v),ctx),and:(l,r,ctx)=>isTruthy(toValue(l),ctx)&&isTruthy(toValue(r),ctx),or:(l,r,ctx)=>isTruthy(toValue(l),ctx)||isTruthy(toValue(r),ctx)};function equals(lhs,rhs){return isComparable(lhs)?lhs.equals(rhs):isComparable(rhs)?rhs.equals(lhs):(lhs=toValue(lhs),rhs=toValue(rhs),isArray(lhs))?isArray(rhs)&&arrayEquals(lhs,rhs):lhs===rhs}function arrayEquals(lhs,rhs){return lhs.length===rhs.length&&!lhs.some((value,i)=>!equals(value,rhs[i]))}function arrayIncludes(arr,item){return arr.some(value=>equals(value,item))}class Node{constructor(key,value,next,prev){this.key=key,this.value=value,this.next=next,this.prev=prev}}class LRU{constructor(limit,size=0){this.limit=limit,this.size=size,this.cache={},this.head=new Node("HEAD",null,null,null),this.tail=new Node("TAIL",null,null,null),this.head.next=this.tail,this.tail.prev=this.head}write(key,value){if(this.cache[key])this.cache[key].value=value;else{let node=new Node(key,value,this.head.next,this.head);this.head.next.prev=node,this.head.next=node,this.cache[key]=node,this.size++,this.ensureLimit()}}read(key){if(!this.cache[key])return;let{value}=this.cache[key];return this.remove(key),this.write(key,value),value}remove(key){let node=this.cache[key];node.prev.next=node.next,node.next.prev=node.prev,delete this.cache[key],this.size--}clear(){this.head.next=this.tail,this.tail.prev=this.head,this.size=0,this.cache={}}ensureLimit(){this.size>this.limit&&this.remove(this.tail.prev.key)}}function domResolve(root,path){let base=document.createElement("base");base.href=root;let head=document.getElementsByTagName("head")[0];head.insertBefore(base,head.firstChild);let a=document.createElement("a");a.href=path;let resolved=a.href;return head.removeChild(base),resolved}var fs=Object.freeze({__proto__:null,resolve:function resolve(root,filepath,ext){return root.length&&"/"!==last(root)&&(root+="/"),domResolve(root,filepath).replace(/^(\w+:\/\/[^/]+)(\/[^?]+)/,(str,origin,path)=>{let last=path.split("/").pop();return/\.\w+$/.test(last)?str:origin+path+ext})},readFile:function readFile(url){return __awaiter(this,void 0,void 0,function*(){return new Promise((resolve,reject)=>{let xhr=new XMLHttpRequest;xhr.onload=()=>{xhr.status>=200&&xhr.status<300?resolve(xhr.responseText):reject(Error(xhr.statusText))},xhr.onerror=()=>{reject(Error("An error occurred whilst receiving the response."))},xhr.open("GET",url),xhr.send()})})},readFileSync:function readFileSync(url){let xhr=new XMLHttpRequest;if(xhr.open("GET",url,!1),xhr.send(),xhr.status<200||xhr.status>=300)throw Error(xhr.statusText);return xhr.responseText},exists:function exists(filepath){return __awaiter(this,void 0,void 0,function*(){return!0})},existsSync:function existsSync(filepath){return!0},dirname:function dirname(filepath){return domResolve(filepath,".")},sep:"/"});function json(value,space=0){return JSON.stringify(value,null,space)}var misc={default:function defaultFilter(value,defaultValue,...args){return isArray(value=toValue(value))||isString(value)?value.length?value:defaultValue:!(!1===value&&new Map(args).get("allow_false"))&&(isFalsy(value,this.context)?defaultValue:value)},raw:{raw:!0,handler:identify},jsonify:json,to_integer:function to_integer(value){return Number(value)},json,inspect:function inspect(value,space=0){let ancestors=[];return JSON.stringify(value,function(_key,value){if("object"!=typeof value||null===value)return value;for(;ancestors.length>0&&ancestors[ancestors.length-1]!==this;)ancestors.pop();return ancestors.includes(value)?"[Circular]":(ancestors.push(value),value)},space)}};let escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},unescapeMap={"&amp;":"&","&lt;":"<","&gt;":">","&#34;":'"',"&#39;":"'"};function escape(str){return str=stringify(str),this.context.memoryLimit.use(str.length),str.replace(/&|<|>|"|'/g,m=>escapeMap[m])}function xml_escape(str){return escape.call(this,str)}function unescape(str){return str=stringify(str),this.context.memoryLimit.use(str.length),str.replace(/&(amp|lt|gt|#34|#39);/g,m=>unescapeMap[m])}function escape_once(str){return escape.call(this,unescape.call(this,str))}var htmlFilters=Object.freeze({__proto__:null,escape:escape,xml_escape:xml_escape,escape_once:escape_once,newline_to_br:function newline_to_br(v){let str=stringify(v);return this.context.memoryLimit.use(str.length),str.replace(/\r?\n/gm,"<br />\n")},strip_html:function strip_html(v){let str=stringify(v);return this.context.memoryLimit.use(str.length),str.replace(/<script[\s\S]*?<\/script>|<style[\s\S]*?<\/style>|<.*?>|<!--[\s\S]*?-->/g,"")}});class MapFS{constructor(mapping){this.mapping=mapping,this.sep="/"}exists(filepath){return __awaiter(this,void 0,void 0,function*(){return this.existsSync(filepath)})}existsSync(filepath){return!isNil(this.mapping[filepath])}readFile(filepath){return __awaiter(this,void 0,void 0,function*(){return this.readFileSync(filepath)})}readFileSync(filepath){let content=this.mapping[filepath];if(isNil(content))throw Error(`ENOENT: ${filepath}`);return content}dirname(filepath){let segments=filepath.split(this.sep);return segments.pop(),segments.join(this.sep)}resolve(dir,file,ext){if(file+=ext,"."===dir)return file;let segments=dir.split(/\/+/);for(let segment of file.split(this.sep))"."!==segment&&""!==segment&&(".."===segment?(segments.length>1||""!==segments[0])&&segments.pop():segments.push(segment));return segments.join(this.sep)}}let defaultOptions={root:["."],layouts:["."],partials:["."],relativeReference:!0,jekyllInclude:!1,keyValueSeparator:":",cache:void 0,extname:"",fs:fs,dynamicPartials:!0,jsTruthy:!1,dateFormat:"%A, %B %-e, %Y at %-l:%M %P %z",locale:"",trimTagRight:!1,trimTagLeft:!1,trimOutputRight:!1,trimOutputLeft:!1,greedy:!0,tagDelimiterLeft:"{%",tagDelimiterRight:"%}",outputDelimiterLeft:"{{",outputDelimiterRight:"}}",preserveTimezones:!1,strictFilters:!1,strictVariables:!1,ownPropertyOnly:!0,lenientIf:!1,globals:{},keepOutputType:!1,operators:defaultOperators,memoryLimit:1/0,parseLimit:1/0,renderLimit:1/0};function normalize(options){var _a,_b;if(options.hasOwnProperty("root")&&(options.hasOwnProperty("partials")||(options.partials=options.root),options.hasOwnProperty("layouts")||(options.layouts=options.root)),options.hasOwnProperty("cache")){let cache;cache="number"==typeof options.cache?options.cache>0?new LRU(options.cache):void 0:"object"==typeof options.cache?options.cache:options.cache?new LRU(1024):void 0,options.cache=cache}return(options=Object.assign(Object.assign(Object.assign({},defaultOptions),options.jekyllInclude?{dynamicPartials:!1}:{}),options)).fs.dirname&&options.fs.sep||!options.relativeReference||(console.warn("[LiquidJS] `fs.dirname` and `fs.sep` are required for relativeReference, set relativeReference to `false` to suppress this warning"),options.relativeReference=!1),options.root=normalizeDirectoryList(options.root),options.partials=normalizeDirectoryList(options.partials),options.layouts=normalizeDirectoryList(options.layouts),options.outputEscape=options.outputEscape&&getOutputEscapeFunction(options.outputEscape),options.locale||(options.locale=null!==(_b=null===(_a=getDateTimeFormat())||void 0===_a?void 0:_a().resolvedOptions().locale)&&void 0!==_b?_b:"en-US"),options.templates&&(options.fs=new MapFS(options.templates),options.relativeReference=!0,options.root=options.partials=options.layouts="."),options}function getOutputEscapeFunction(nameOrFunction){return"escape"===nameOrFunction?escape:"json"===nameOrFunction?misc.json:(assert(isFunction(nameOrFunction),"`outputEscape` need to be of type string or function"),nameOrFunction)}function normalizeDirectoryList(value){let list=[];return isArray(value)&&(list=value),isString(value)&&(list=[value]),list}function whiteSpaceCtrl(tokens,options){let inRaw=!1;for(let i=0;i<tokens.length;i++){let token=tokens[i];isDelimitedToken(token)&&(!inRaw&&token.trimLeft&&trimLeft(tokens[i-1],options.greedy),isTagToken(token)&&("raw"===token.name?inRaw=!0:"endraw"===token.name&&(inRaw=!1)),!inRaw&&token.trimRight&&trimRight(tokens[i+1],options.greedy))}}function trimLeft(token,greedy){if(!token||!isHTMLToken(token))return;let mask=greedy?4:16;for(;TYPES[token.input.charCodeAt(token.end-1-token.trimRight)]&mask;)token.trimRight++}function trimRight(token,greedy){if(!token||!isHTMLToken(token))return;let mask=greedy?4:16;for(;TYPES[token.input.charCodeAt(token.begin+token.trimLeft)]&mask;)token.trimLeft++;"\n"===token.input.charAt(token.begin+token.trimLeft)&&token.trimLeft++}class Tokenizer{constructor(input,operators=defaultOptions.operators,file,range){this.input=input,this.file=file,this.rawBeginAt=-1,this.p=range?range[0]:0,this.N=range?range[1]:input.length,this.opTrie=createTrie(operators),this.literalTrie=createTrie(literalValues)}readExpression(){return new Expression(this.readExpressionTokens())}*readExpressionTokens(){for(;this.p<this.N;){let operator=this.readOperator();if(operator){yield operator;continue}let operand=this.readValue();if(operand){yield operand;continue}return}}readOperator(){this.skipBlank();let end=this.matchTrie(this.opTrie);if(-1!==end)return new OperatorToken(this.input,this.p,this.p=end,this.file)}matchTrie(trie){let info,node=trie,i=this.p;for(;node[this.input[i]]&&i<this.N;)(node=node[this.input[i++]]).end&&(info=node);return!info||info.needBoundary&&isWord(this.peek(i-this.p))?-1:i}readFilteredValue(){let begin=this.p,initial=this.readExpression();return this.assert(initial.valid(),`invalid value expression: ${this.snapshot()}`),new FilteredValueToken(initial,this.readFilters(),this.input,begin,this.p,this.file)}readFilters(){let filters=[];for(;;){let filter=this.readFilter();if(!filter)return filters;filters.push(filter)}}readFilter(){if(this.skipBlank(),this.end())return null;this.assert("|"===this.read(),'expected "|" before filter');let name=this.readIdentifier();if(!name.size())return this.assert(this.end(),"expected filter name"),null;let args=[];if(this.skipBlank(),":"===this.peek())do{++this.p;let arg=this.readFilterArg();arg&&args.push(arg),this.skipBlank(),this.assert(this.end()||","===this.peek()||"|"===this.peek(),()=>`unexpected character ${this.snapshot()}`)}while(","===this.peek())else if("|"===this.peek()||this.end());else throw this.error('expected ":" after filter name');return new FilterToken(name.getText(),args,this.input,name.begin,this.p,this.file)}readFilterArg(){let key=this.readValue();if(!key)return;if(this.skipBlank(),":"!==this.peek())return key;++this.p;let value=this.readValue();return[key.getText(),value]}readTopLevelTokens(options=defaultOptions){let tokens=[];for(;this.p<this.N;){let token=this.readTopLevelToken(options);tokens.push(token)}return whiteSpaceCtrl(tokens,options),tokens}readTopLevelToken(options){let{tagDelimiterLeft,outputDelimiterLeft}=options;return this.rawBeginAt>-1?this.readEndrawOrRawContent(options):this.match(tagDelimiterLeft)?this.readTagToken(options):this.match(outputDelimiterLeft)?this.readOutputToken(options):this.readHTMLToken([tagDelimiterLeft,outputDelimiterLeft])}readHTMLToken(stopStrings){let begin=this.p;for(;this.p<this.N&&!stopStrings.some(str=>this.match(str));)++this.p;return new HTMLToken(this.input,begin,this.p,this.file)}readTagToken(options){let{file,input}=this,begin=this.p;if(-1===this.readToDelimiter(options.tagDelimiterRight))throw this.error(`tag ${this.snapshot(begin)} not closed`,begin);let token=new TagToken(input,begin,this.p,options,file);return"raw"===token.name&&(this.rawBeginAt=begin),token}readToDelimiter(delimiter,respectQuoted=!1){for(this.skipBlank();this.p<this.N;){if(respectQuoted&&8&this.peekType()){this.readQuoted();continue}if(++this.p,this.rmatch(delimiter))return this.p}return -1}readOutputToken(options=defaultOptions){let{file,input}=this,{outputDelimiterRight}=options,begin=this.p;if(-1===this.readToDelimiter(outputDelimiterRight,!0))throw this.error(`output ${this.snapshot(begin)} not closed`,begin);return new OutputToken(input,begin,this.p,options,file)}readEndrawOrRawContent(options){let{tagDelimiterLeft,tagDelimiterRight}=options,begin=this.p,leftPos=this.readTo(tagDelimiterLeft)-tagDelimiterLeft.length;for(;this.p<this.N;){if("endraw"!==this.readIdentifier().getText()){leftPos=this.readTo(tagDelimiterLeft)-tagDelimiterLeft.length;continue}for(;this.p<=this.N;){if(this.rmatch(tagDelimiterRight)){let end=this.p;if(begin===leftPos)return this.rawBeginAt=-1,new TagToken(this.input,begin,end,options,this.file);return this.p=leftPos,new HTMLToken(this.input,begin,leftPos,this.file)}if(this.rmatch(tagDelimiterLeft))break;this.p++}}throw this.error(`raw ${this.snapshot(this.rawBeginAt)} not closed`,begin)}readLiquidTagTokens(options=defaultOptions){let tokens=[];for(;this.p<this.N;){let token=this.readLiquidTagToken(options);token&&tokens.push(token)}return tokens}readLiquidTagToken(options){if(this.skipBlank(),this.end())return;let begin=this.p;this.readToDelimiter("\n");let end=this.p;return new LiquidTagToken(this.input,begin,end,options,this.file)}error(msg,pos=this.p){return new TokenizationError(msg,new IdentifierToken(this.input,pos,this.N,this.file))}assert(pred,msg,pos){if(!pred)throw this.error("function"==typeof msg?msg():msg,pos)}snapshot(begin=this.p){return JSON.stringify(ellipsis(this.input.slice(begin,this.N),32))}readWord(){return this.readIdentifier()}readIdentifier(){this.skipBlank();let begin=this.p;for(;!this.end()&&isWord(this.peek());)++this.p;return new IdentifierToken(this.input,begin,this.p,this.file)}readNonEmptyIdentifier(){let id=this.readIdentifier();return id.size()?id:void 0}readTagName(){return(this.skipBlank(),"#"===this.input[this.p])?this.input.slice(this.p,++this.p):this.readIdentifier().getText()}readHashes(jekyllStyle){let hashes=[];for(;;){let hash=this.readHash(jekyllStyle);if(!hash)return hashes;hashes.push(hash)}}readHash(jekyllStyle){let value;this.skipBlank(),","===this.peek()&&++this.p;let begin=this.p,name=this.readNonEmptyIdentifier();if(!name)return;this.skipBlank();let sep=isString(jekyllStyle)?jekyllStyle:jekyllStyle?"=":":";return this.peek()===sep&&(++this.p,value=this.readValue()),new HashToken(this.input,begin,this.p,name,value,this.file)}remaining(){return this.input.slice(this.p,this.N)}advance(step=1){this.p+=step}end(){return this.p>=this.N}read(){return this.input[this.p++]}readTo(end){for(;this.p<this.N;)if(++this.p,this.rmatch(end))return this.p;return -1}readValue(){this.skipBlank();let begin=this.p,variable=this.readLiteral()||this.readQuoted()||this.readRange()||this.readNumber(),props=this.readProperties(!variable);return props.length?new PropertyAccessToken(variable,props,this.input,begin,this.p):variable}readScopeValue(){this.skipBlank();let begin=this.p,props=this.readProperties();if(props.length)return new PropertyAccessToken(void 0,props,this.input,begin,this.p)}readProperties(isBegin=!0){let props=[];for(;;){if("["===this.peek()){this.p++;let prop=this.readValue()||new IdentifierToken(this.input,this.p,this.p,this.file);this.assert(-1!==this.readTo("]"),"[ not closed"),props.push(prop);continue}if(isBegin&&!props.length){let prop=this.readNonEmptyIdentifier();if(prop){props.push(prop);continue}}if("."===this.peek()&&"."!==this.peek(1)){this.p++;let prop=this.readNonEmptyIdentifier();if(!prop)break;props.push(prop);continue}break}return props}readNumber(){this.skipBlank();let decimalFound=!1,digitFound=!1,n=0;for(64&this.peekType()&&n++;this.p+n<=this.N;)if(32&this.peekType(n))digitFound=!0,n++;else if("."===this.peek(n)&&"."!==this.peek(n+1)){if(decimalFound||!digitFound)return;decimalFound=!0,n++}else break;if(digitFound&&!isWord(this.peek(n))){let num=new NumberToken(this.input,this.p,this.p+n,this.file);return this.advance(n),num}}readLiteral(){this.skipBlank();let end=this.matchTrie(this.literalTrie);if(-1===end)return;let literal=new LiteralToken(this.input,this.p,end,this.file);return this.p=end,literal}readRange(){this.skipBlank();let begin=this.p;if("("!==this.peek())return;++this.p;let lhs=this.readValueOrThrow();this.skipBlank(),this.assert("."===this.read()&&"."===this.read(),"invalid range syntax");let rhs=this.readValueOrThrow();return this.skipBlank(),this.assert(")"===this.read(),"invalid range syntax"),new RangeToken(this.input,begin,this.p,lhs,rhs,this.file)}readValueOrThrow(){let value=this.readValue();return this.assert(value,()=>`unexpected token ${this.snapshot()}, value expected`),value}readQuoted(){this.skipBlank();let begin=this.p;if(!(8&this.peekType()))return;++this.p;let escaped=!1;for(;this.p<this.N&&(++this.p,this.input[this.p-1]!==this.input[begin]||escaped);)escaped?escaped=!1:"\\"===this.input[this.p-1]&&(escaped=!0);return new QuotedToken(this.input,begin,this.p,this.file)}*readFileNameTemplate(options){let{outputDelimiterLeft}=options,htmlStopStrings=[","," ",outputDelimiterLeft],htmlStopStringSet=new Set(htmlStopStrings);for(;this.p<this.N&&!htmlStopStringSet.has(this.peek());)yield this.match(outputDelimiterLeft)?this.readOutputToken(options):this.readHTMLToken(htmlStopStrings)}match(word){for(let i=0;i<word.length;i++)if(word[i]!==this.input[this.p+i])return!1;return!0}rmatch(pattern){for(let i=0;i<pattern.length;i++)if(pattern[pattern.length-1-i]!==this.input[this.p-1-i])return!1;return!0}peekType(n=0){return this.p+n>=this.N?0:TYPES[this.input.charCodeAt(this.p+n)]}peek(n=0){return this.p+n>=this.N?"":this.input[this.p+n]}skipBlank(){for(;4&this.peekType();)++this.p}}class ParseStream{constructor(tokens,parseToken){this.handlers={},this.stopRequested=!1,this.tokens=tokens,this.parseToken=parseToken}on(name,cb){return this.handlers[name]=cb,this}trigger(event,arg){let h=this.handlers[event];return!!h&&(h.call(this,arg),!0)}start(){let token;for(this.trigger("start");!this.stopRequested&&(token=this.tokens.shift());){if(this.trigger("token",token)||isTagToken(token)&&this.trigger(`tag:${token.name}`,token))continue;let template=this.parseToken(token,this.tokens);this.trigger("template",template)}return this.stopRequested||this.trigger("end"),this}stop(){return this.stopRequested=!0,this}}class TemplateImpl{constructor(token){this.token=token}}class Tag extends TemplateImpl{constructor(token,remainTokens,liquid){super(token),this.name=token.name,this.liquid=liquid,this.tokenizer=token.tokenizer}}class Hash{constructor(input,jekyllStyle){for(let hash of(this.hash={},(input instanceof Tokenizer?input:new Tokenizer(input,{})).readHashes(jekyllStyle)))this.hash[hash.name.content]=hash.value}*render(ctx){let hash={};for(let key of Object.keys(this.hash))hash[key]=void 0===this.hash[key]||(yield evalToken(this.hash[key],ctx));return hash}}function createTagClass(options){return class extends Tag{constructor(token,tokens,liquid){super(token,tokens,liquid),isFunction(options.parse)&&options.parse.call(this,token,tokens)}*render(ctx,emitter){let hash=yield new Hash(this.token.args,ctx.opts.keyValueSeparator).render(ctx);return yield options.render.call(this,ctx,emitter,hash)}}}class Filter{constructor(token,options,liquid){this.token=token,this.name=token.name,this.handler=isFunction(options)?options:isFunction(null==options?void 0:options.handler)?options.handler:identify,this.raw=!isFunction(options)&&!!(null==options?void 0:options.raw),this.args=token.args,this.liquid=liquid}*render(value,context){let argv=[];for(let arg of this.args)isArray(arg)?argv.push([arg[0],(yield evalToken(arg[1],context))]):argv.push((yield evalToken(arg,context)));return yield this.handler.apply({context,token:this.token,liquid:this.liquid},[value,...argv])}}class Value{constructor(input,liquid){this.filters=[];let token="string"==typeof input?new Tokenizer(input,liquid.options.operators).readFilteredValue():input;this.initial=token.initial,this.filters=token.filters.map(token=>new Filter(token,this.getFilter(liquid,token.name),liquid))}*value(ctx,lenient){lenient=lenient||ctx.opts.lenientIf&&this.filters.length>0&&"default"===this.filters[0].name;let val=yield this.initial.evaluate(ctx,lenient);for(let filter of this.filters)val=yield filter.render(val,ctx);return val}getFilter(liquid,name){let impl=liquid.filters[name];return assert(impl||!liquid.options.strictFilters,()=>`undefined filter: ${name}`),impl}}class Output extends TemplateImpl{constructor(token,liquid){var _a;super(token);let tokenizer=new Tokenizer(token.input,liquid.options.operators,token.file,token.contentRange);this.value=new Value(tokenizer.readFilteredValue(),liquid);let filters=this.value.filters,outputEscape=liquid.options.outputEscape;if(!(null===(_a=filters[filters.length-1])||void 0===_a?void 0:_a.raw)&&outputEscape){let token=new FilterToken(toString.call(outputEscape),[],"",0,0);filters.push(new Filter(token,outputEscape,liquid))}}*render(ctx,emitter){let val=yield this.value.value(ctx,!1);emitter.write(val)}*arguments(){yield this.value}}class HTML extends TemplateImpl{constructor(token){super(token),this.str=token.getContent()}*render(ctx,emitter){emitter.write(this.str)}}class Variable{constructor(segments,location){this.segments=segments,this.location=location}toString(){return segmentsString(this.segments,!0)}toArray(){function*_visit(...segments){for(let segment of segments)segment instanceof Variable?yield Array.from(_visit(...segment.segments)):yield segment}return Array.from(_visit(...this.segments))}}class VariableMap{constructor(){this.map=new Map}get(key){let k=segmentsString([key.segments[0]]);return this.map.has(k)||this.map.set(k,[]),this.map.get(k)}has(key){return this.map.has(segmentsString([key.segments[0]]))}push(variable){this.get(variable).push(variable)}asObject(){return Object.fromEntries(this.map)}}let defaultStaticAnalysisOptions={partials:!0};function*_analyze(templates,partials,sync){let variables=new VariableMap,globals=new VariableMap,locals=new VariableMap,rootScope=new DummyScope(new Set),seen=new Set;function updateVariables(variable,scope){variables.push(variable);let aliased=scope.alias(variable);if(void 0!==aliased){let root=aliased.segments[0];isString(root)&&!rootScope.has(root)&&globals.push(aliased)}else{let root=variable.segments[0];isString(root)&&!scope.has(root)&&globals.push(variable)}for(let segment of variable.segments)segment instanceof Variable&&updateVariables(segment,scope)}function*visit(template,scope){if(template.arguments)for(let arg of template.arguments())for(let variable of extractVariables(arg))updateVariables(variable,scope);if(template.localScope)for(let ident of template.localScope()){scope.add(ident.content),scope.deleteAlias(ident.content);let[row,col]=ident.getPosition();locals.push(new Variable([ident.content],{row,col,file:ident.file}))}if(template.children){if(template.partialScope){let partial=template.partialScope();if(void 0===partial){for(let child of yield template.children(partials,sync))yield visit(child,scope);return}if(seen.has(partial.name))return;let partialScopeNames=new Set,partialScope=partial.isolated?new DummyScope(partialScopeNames):scope.push(partialScopeNames);for(let name of partial.scope)if(isString(name))partialScopeNames.add(name);else{let[alias,argument]=name;partialScopeNames.add(alias);let variables=Array.from(extractVariables(argument));variables.length&&partialScope.setAlias(alias,variables[0].segments)}for(let child of yield template.children(partials,sync))yield visit(child,partialScope),seen.add(partial.name);partialScope.pop()}else{for(let child of(template.blockScope&&scope.push(new Set(template.blockScope())),yield template.children(partials,sync)))yield visit(child,scope);template.blockScope&&scope.pop()}}}for(let template of templates)yield visit(template,rootScope);return{variables:variables.asObject(),globals:globals.asObject(),locals:locals.asObject()}}function analyze(template,options={}){return toPromise(_analyze(template,Object.assign(Object.assign({},defaultStaticAnalysisOptions),options).partials,!1))}function analyzeSync(template,options={}){return toValueSync(_analyze(template,Object.assign(Object.assign({},defaultStaticAnalysisOptions),options).partials,!0))}class DummyScope{constructor(globals){this.stack=[{names:globals,aliases:new Map}]}has(name){for(let scope of this.stack)if(scope.names.has(name))return!0;return!1}push(scope){return this.stack.push({names:scope,aliases:new Map}),this}pop(){var _a;return null===(_a=this.stack.pop())||void 0===_a?void 0:_a.names}add(name){this.stack[0].names.add(name)}alias(variable){let root=variable.segments[0];if(!isString(root))return;let alias=this.getAlias(root);if(void 0!==alias)return new Variable([...alias,...variable.segments.slice(1)],variable.location)}setAlias(from,to){this.stack[this.stack.length-1].aliases.set(from,to)}deleteAlias(name){this.stack[this.stack.length-1].aliases.delete(name)}getAlias(name){for(let scope of this.stack){if(scope.aliases.has(name))return scope.aliases.get(name);if(scope.names.has(name))break}}}function*extractVariables(value){isValueToken(value)?yield*extractValueTokenVariables(value):value instanceof Value&&(yield*extractFilteredValueVariables(value))}function*extractFilteredValueVariables(value){for(let token of value.initial.postfix)isValueToken(token)&&(yield*extractValueTokenVariables(token));for(let filter of value.filters)for(let arg of filter.args)isArray(arg)&&arg[1]?yield*extractValueTokenVariables(arg[1]):isValueToken(arg)&&(yield*extractValueTokenVariables(arg))}function*extractValueTokenVariables(token){isRangeToken(token)?(yield*extractValueTokenVariables(token.lhs),yield*extractValueTokenVariables(token.rhs)):isPropertyAccessToken(token)&&(yield extractPropertyAccessVariable(token))}function extractPropertyAccessVariable(token){let segments=[],file=token.file,root=token.props[0];for(let prop of(file=file||root.file,isQuotedToken(root)||isNumberToken(root)||isWordToken(root)?segments.push(root.content):isPropertyAccessToken(root)&&segments.push(...extractPropertyAccessVariable(root).segments),token.props.slice(1)))file=file||prop.file,isQuotedToken(prop)||isNumberToken(prop)||isWordToken(prop)?segments.push(prop.content):isPropertyAccessToken(prop)&&segments.push(extractPropertyAccessVariable(prop));let[row,col]=token.getPosition();return new Variable(segments,{row,col,file})}let RE_PROPERTY=/^[\u0080-\uFFFFa-zA-Z_][\u0080-\uFFFFa-zA-Z0-9_-]*$/;function segmentsString(segments,bracketedRoot=!1){let buf=[],root=segments[0];for(let segment of(isString(root)&&(!bracketedRoot||root.match(RE_PROPERTY)?buf.push(`${root}`):buf.push(`['${root}']`)),segments.slice(1)))segment instanceof Variable?buf.push(`[${segmentsString(segment.segments)}]`):isString(segment)?segment.match(RE_PROPERTY)?buf.push(`.${segment}`):buf.push(`['${segment}']`):buf.push(`[${segment}]`);return buf.join("")}!function(LookupType){LookupType.Partials="partials",LookupType.Layouts="layouts",LookupType.Root="root"}(LookupType||(LookupType={}));class Loader{constructor(options){if(this.options=options,options.relativeReference){let sep=options.fs.sep;assert(sep,"`fs.sep` is required for relative reference");let rRelativePath=new RegExp(["."+sep,".."+sep,"./","../"].map(prefix=>escapeRegex(prefix)).join("|"));this.shouldLoadRelative=referencedFile=>rRelativePath.test(referencedFile)}else this.shouldLoadRelative=_referencedFile=>!1;this.contains=this.options.fs.contains||(()=>!0)}*lookup(file,type,sync,currentFile){let{fs}=this.options,dirs=this.options[type];for(let filepath of this.candidates(file,dirs,currentFile,type!==LookupType.Root))if(sync?fs.existsSync(filepath):yield fs.exists(filepath))return filepath;throw this.lookupError(file,dirs)}*candidates(file,dirs,currentFile,enforceRoot){let{fs,extname}=this.options;if(this.shouldLoadRelative(file)&&currentFile){let referenced=fs.resolve(this.dirname(currentFile),file,extname);for(let dir of dirs)if(!enforceRoot||this.contains(dir,referenced)){yield referenced;break}}for(let dir of dirs){let referenced=fs.resolve(dir,file,extname);(!enforceRoot||this.contains(dir,referenced))&&(yield referenced)}if(void 0!==fs.fallback){let filepath=fs.fallback(file);void 0!==filepath&&(yield filepath)}}dirname(path){let fs=this.options.fs;return assert(fs.dirname,"`fs.dirname` is required for relative reference"),fs.dirname(path)}lookupError(file,roots){let err=Error("ENOENT");return err.message=`ENOENT: Failed to lookup "${file}" in "${roots}"`,err.code="ENOENT",err}}class Parser{constructor(liquid){this.liquid=liquid,this.cache=this.liquid.options.cache,this.fs=this.liquid.options.fs,this.parseFile=this.cache?this._parseFileCached:this._parseFile,this.loader=new Loader(this.liquid.options),this.parseLimit=new Limiter("parse length",liquid.options.parseLimit)}parse(html,filepath){html=String(html),this.parseLimit.use(html.length);let tokens=new Tokenizer(html,this.liquid.options.operators,filepath).readTopLevelTokens(this.liquid.options);return this.parseTokens(tokens)}parseTokens(tokens){let token;let templates=[],errors=[];for(;token=tokens.shift();)try{templates.push(this.parseToken(token,tokens))}catch(err){if(this.liquid.options.catchAllErrors)errors.push(err);else throw err}if(errors.length)throw new LiquidErrors(errors);return templates}parseToken(token,remainTokens){try{if(isTagToken(token)){let TagClass=this.liquid.tags[token.name];return assert(TagClass,`tag "${token.name}" not found`),new TagClass(token,remainTokens,this.liquid,this)}if(isOutputToken(token))return new Output(token,this.liquid);return new HTML(token)}catch(e){if(LiquidError.is(e))throw e;throw new ParseError(e,token)}}parseStream(tokens){return new ParseStream(tokens,(token,tokens)=>this.parseToken(token,tokens))}*_parseFileCached(file,sync,type=LookupType.Root,currentFile){let cache=this.cache,key=this.loader.shouldLoadRelative(file)?currentFile+","+file:type+":"+file,tpls=yield cache.read(key);if(tpls)return tpls;let task=this._parseFile(file,sync,type,currentFile),taskOrTpl=sync?yield task:toPromise(task);cache.write(key,taskOrTpl);try{return yield taskOrTpl}catch(err){throw cache.remove(key),err}}*_parseFile(file,sync,type=LookupType.Root,currentFile){let filepath=yield this.loader.lookup(file,type,sync,currentFile);return this.parse(sync?this.fs.readFileSync(filepath):yield this.fs.readFile(filepath),filepath)}}function isDelimitedToken(val){return!!(getKind(val)&TokenKind.Delimited)}function isOperatorToken(val){return getKind(val)===TokenKind.Operator}function isHTMLToken(val){return getKind(val)===TokenKind.HTML}function isOutputToken(val){return getKind(val)===TokenKind.Output}function isTagToken(val){return getKind(val)===TokenKind.Tag}function isQuotedToken(val){return getKind(val)===TokenKind.Quoted}function isNumberToken(val){return getKind(val)===TokenKind.Number}function isPropertyAccessToken(val){return getKind(val)===TokenKind.PropertyAccess}function isWordToken(val){return getKind(val)===TokenKind.Word}function isRangeToken(val){return getKind(val)===TokenKind.Range}function isValueToken(val){return(1667&getKind(val))>0}function getKind(val){return val?val.kind:-1}!function(TokenKind){TokenKind[TokenKind.Number=1]="Number",TokenKind[TokenKind.Literal=2]="Literal",TokenKind[TokenKind.Tag=4]="Tag",TokenKind[TokenKind.Output=8]="Output",TokenKind[TokenKind.HTML=16]="HTML",TokenKind[TokenKind.Filter=32]="Filter",TokenKind[TokenKind.Hash=64]="Hash",TokenKind[TokenKind.PropertyAccess=128]="PropertyAccess",TokenKind[TokenKind.Word=256]="Word",TokenKind[TokenKind.Range=512]="Range",TokenKind[TokenKind.Quoted=1024]="Quoted",TokenKind[TokenKind.Operator=2048]="Operator",TokenKind[TokenKind.FilteredValue=4096]="FilteredValue",TokenKind[TokenKind.Delimited=12]="Delimited"}(TokenKind||(TokenKind={}));class Context{constructor(env={},opts=defaultOptions,renderOptions={},{memoryLimit,renderLimit}={}){var _a,_b,_c,_d,_e;this.scopes=[{}],this.registers={},this.breakCalled=!1,this.continueCalled=!1,this.sync=!!renderOptions.sync,this.opts=opts,this.globals=null!==(_a=renderOptions.globals)&&void 0!==_a?_a:opts.globals,this.environments=isObject(env)?env:Object(env),this.strictVariables=null!==(_b=renderOptions.strictVariables)&&void 0!==_b?_b:this.opts.strictVariables,this.ownPropertyOnly=null!==(_c=renderOptions.ownPropertyOnly)&&void 0!==_c?_c:opts.ownPropertyOnly,this.memoryLimit=null!=memoryLimit?memoryLimit:new Limiter("memory alloc",null!==(_d=renderOptions.memoryLimit)&&void 0!==_d?_d:opts.memoryLimit),this.renderLimit=null!=renderLimit?renderLimit:new Limiter("template render",getPerformance().now()+(null!==(_e=renderOptions.renderLimit)&&void 0!==_e?_e:opts.renderLimit))}getRegister(key){return this.registers[key]=this.registers[key]||{}}setRegister(key,value){return this.registers[key]=value}saveRegister(...keys){return keys.map(key=>[key,this.getRegister(key)])}restoreRegister(keyValues){return keyValues.forEach(([key,value])=>this.setRegister(key,value))}getAll(){return[this.globals,this.environments,...this.scopes].reduce((ctx,val)=>__assign(ctx,val),{})}get(paths){return this.getSync(paths)}getSync(paths){return toValueSync(this._get(paths))}*_get(paths){let scope=this.findScope(paths[0]);return yield this._getFromScope(scope,paths)}getFromScope(scope,paths){return toValueSync(this._getFromScope(scope,paths))}*_getFromScope(scope,paths,strictVariables=this.strictVariables){isString(paths)&&(paths=paths.split("."));for(let i=0;i<paths.length;i++)if(scope=yield readProperty(scope,paths[i],this.ownPropertyOnly),strictVariables&&isUndefined(scope))throw new InternalUndefinedVariableError(paths.slice(0,i+1).join("."));return scope}push(ctx){return this.scopes.push(ctx)}pop(){return this.scopes.pop()}bottom(){return this.scopes[0]}spawn(scope={}){return new Context(scope,this.opts,{sync:this.sync,globals:this.globals,strictVariables:this.strictVariables},{renderLimit:this.renderLimit,memoryLimit:this.memoryLimit})}findScope(key){for(let i=this.scopes.length-1;i>=0;i--){let candidate=this.scopes[i];if(key in candidate)return candidate}return key in this.environments?this.environments:this.globals}}function readProperty(obj,key,ownPropertyOnly){if(obj=toLiquid(obj),key=toValue(key),isNil(obj))return obj;if(isArray(obj)&&key<0)return obj[obj.length+ +key];let value=readJSProperty(obj,key,ownPropertyOnly);return void 0===value&&obj instanceof Drop?obj.liquidMethodMissing(key):isFunction(value)?value.call(obj):"size"===key?readSize(obj):"first"===key?readFirst(obj):"last"===key?readLast(obj):value}function readJSProperty(obj,key,ownPropertyOnly){if(!ownPropertyOnly||hasOwnProperty.call(obj,key)||obj instanceof Drop)return obj[key]}function readFirst(obj){return isArray(obj)?obj[0]:obj.first}function readLast(obj){return isArray(obj)?obj[obj.length-1]:obj.last}function readSize(obj){return hasOwnProperty.call(obj,"size")||void 0!==obj.size?obj.size:isArray(obj)||isString(obj)?obj.length:"object"==typeof obj?Object.keys(obj).length:void 0}!function(BlockMode){BlockMode[BlockMode.OUTPUT=0]="OUTPUT",BlockMode[BlockMode.STORE=1]="STORE"}(BlockMode||(BlockMode={}));let abs=argumentsToValue(Math.abs),at_least=argumentsToValue(Math.max),at_most=argumentsToValue(Math.min),ceil=argumentsToValue(Math.ceil),divided_by=argumentsToValue((dividend,divisor,integerArithmetic=!1)=>integerArithmetic?Math.floor(dividend/divisor):dividend/divisor),floor=argumentsToValue(Math.floor),minus=argumentsToValue((v,arg)=>v-arg);function round(v,arg=0){v=toValue(v);let amp=Math.pow(10,arg=toValue(arg));return Math.round(v*amp)/amp}function plus(v,arg){return v=toValue(v),arg=toValue(arg),Number(v)+Number(arg)}var mathFilters=Object.freeze({__proto__:null,abs:abs,at_least:at_least,at_most:at_most,ceil:ceil,divided_by:divided_by,floor:floor,minus:minus,modulo:argumentsToValue((v,arg)=>v%arg),times:argumentsToValue((v,arg)=>v*arg),round:round,plus:plus});let rSlugifyDefault=/[^\p{M}\p{L}\p{Nd}]+/ug,rSlugifyReplacers={raw:/\s+/g,default:rSlugifyDefault,pretty:/[^\p{M}\p{L}\p{Nd}._~!$&'()+,;=@]+/ug,ascii:/[^A-Za-z0-9]+/g,latin:rSlugifyDefault,none:null};function removeAccents(str){return str.replace(/[àáâãäå]/g,"a").replace(/[æ]/g,"ae").replace(/[ç]/g,"c").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[ð]/g,"d").replace(/[ñ]/g,"n").replace(/[òóôõöø]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ýÿ]/g,"y").replace(/[ß]/g,"ss").replace(/[œ]/g,"oe").replace(/[þ]/g,"th").replace(/[ẞ]/g,"SS").replace(/[Œ]/g,"OE").replace(/[Þ]/g,"TH")}var urlFilters=Object.freeze({__proto__:null,url_decode:x=>decodeURIComponent(stringify(x)).replace(/\+/g," "),url_encode:x=>encodeURIComponent(stringify(x)).replace(/%20/g,"+"),cgi_escape:x=>encodeURIComponent(stringify(x)).replace(/%20/g,"+").replace(/[!'()*]/g,c=>"%"+c.charCodeAt(0).toString(16).toUpperCase()),uri_escape:x=>encodeURI(stringify(x)).replace(/%5B/g,"[").replace(/%5D/g,"]"),slugify:function slugify(str,mode="default",cased=!1){str=stringify(str);let replacer=rSlugifyReplacers[mode];return replacer&&("latin"===mode&&(str=removeAccents(str)),str=str.replace(replacer,"-").replace(/^-|-$/g,"")),cased?str:str.toLowerCase()}});let join=argumentsToValue(function(v,arg){let array=toArray(v),sep=isNil(arg)?" ":stringify(arg),complexity=array.length*(1+sep.length);return this.context.memoryLimit.use(complexity),array.join(sep)}),last$1=argumentsToValue(v=>isArrayLike(v)?last(v):""),first=argumentsToValue(v=>isArrayLike(v)?v[0]:"");function*sort(arr,property){let values=[],array=toArray(arr);for(let item of(this.context.memoryLimit.use(array.length),array))values.push([item,property?yield this.context._getFromScope(item,stringify(property).split("."),!1):item]);return values.sort((lhs,rhs)=>{let lvalue=lhs[1],rvalue=rhs[1];return lvalue<rvalue?-1:+(lvalue>rvalue)}).map(tuple=>tuple[0])}function sort_natural(input,property){let propertyString=stringify(property),compare=void 0===property?caseInsensitiveCompare:(lhs,rhs)=>caseInsensitiveCompare(lhs[propertyString],rhs[propertyString]),array=toArray(input);return this.context.memoryLimit.use(array.length),[...array].sort(compare)}function concat(v,arg=[]){let lhs=toArray(v),rhs=toArray(arg);return this.context.memoryLimit.use(lhs.length+rhs.length),lhs.concat(rhs)}function push(v,arg){return concat.call(this,v,[arg])}function expectedMatcher(expected){return this.context.opts.jekyllWhere?v=>EmptyDrop.is(expected)?equals(v,expected):isArray(v)?arrayIncludes(v,expected):equals(v,expected):void 0===expected?v=>isTruthy(v,this.context):v=>equals(v,expected)}function*filter(include,arr,property,expected){let values=[];arr=toArray(arr),this.context.memoryLimit.use(arr.length);let token=new Tokenizer(stringify(property)).readScopeValue();for(let item of arr)values.push((yield evalToken(token,this.context.spawn(item))));let matcher=expectedMatcher.call(this,expected);return arr.filter((_,i)=>matcher(values[i])===include)}function*filter_exp(include,arr,itemName,exp){let filtered=[],keyTemplate=new Value(stringify(exp),this.liquid),array=toArray(arr);for(let item of(this.context.memoryLimit.use(array.length),array)){this.context.push({[itemName]:item});let value=yield keyTemplate.value(this.context);this.context.pop(),value===include&&filtered.push(item)}return filtered}function*search(arr,property,expected){let token=new Tokenizer(stringify(property)).readScopeValue(),array=toArray(arr),matcher=expectedMatcher.call(this,expected);for(let index=0;index<array.length;index++)if(matcher((yield evalToken(token,this.context.spawn(array[index])))))return[index,array[index]]}function*search_exp(arr,itemName,exp){let predicate=new Value(stringify(exp),this.liquid),array=toArray(arr);for(let index=0;index<array.length;index++){this.context.push({[itemName]:array[index]});let value=yield predicate.value(this.context);if(this.context.pop(),value)return[index,array[index]]}}var arrayFilters=Object.freeze({__proto__:null,join:join,last:last$1,first:first,reverse:argumentsToValue(function(v){let array=toArray(v);return this.context.memoryLimit.use(array.length),[...array].reverse()}),sort:sort,sort_natural:sort_natural,size:v=>v&&v.length||0,map:function* map(arr,property){let results=[],array=toArray(arr);for(let item of(this.context.memoryLimit.use(array.length),array))results.push((yield this.context._getFromScope(item,stringify(property),!1)));return results},sum:function* sum(arr,property){let sum=0;for(let item of toArray(arr)){let data=Number(property?yield this.context._getFromScope(item,stringify(property),!1):item);sum+=Number.isNaN(data)?0:data}return sum},compact:function compact(arr){let array=toArray(arr);return this.context.memoryLimit.use(array.length),array.filter(x=>!isNil(toValue(x)))},concat:concat,push:push,unshift:function unshift(v,arg){let array=toArray(v);this.context.memoryLimit.use(array.length);let clone=[...array];return clone.unshift(arg),clone},pop:function pop(v){let clone=[...toArray(v)];return clone.pop(),clone},shift:function shift(v){let array=toArray(v);this.context.memoryLimit.use(array.length);let clone=[...array];return clone.shift(),clone},slice:function slice(v,begin,length=1){return isNil(v=toValue(v))?[]:(isArray(v)||(v=stringify(v)),begin=begin<0?v.length+begin:begin,this.context.memoryLimit.use(length),v.slice(begin,begin+length))},where:function* where(arr,property,expected){return yield*filter.call(this,!0,arr,property,expected)},reject:function* reject(arr,property,expected){return yield*filter.call(this,!1,arr,property,expected)},where_exp:function* where_exp(arr,itemName,exp){return yield*filter_exp.call(this,!0,arr,itemName,exp)},reject_exp:function* reject_exp(arr,itemName,exp){return yield*filter_exp.call(this,!1,arr,itemName,exp)},group_by:function* group_by(arr,property){let map=new Map;arr=toEnumerable(arr);let token=new Tokenizer(stringify(property)).readScopeValue();for(let item of(this.context.memoryLimit.use(arr.length),arr)){let key=yield evalToken(token,this.context.spawn(item));map.has(key)||map.set(key,[]),map.get(key).push(item)}return[...map.entries()].map(([name,items])=>({name,items}))},group_by_exp:function* group_by_exp(arr,itemName,exp){let map=new Map,keyTemplate=new Value(stringify(exp),this.liquid);for(let item of(arr=toEnumerable(arr),this.context.memoryLimit.use(arr.length),arr)){this.context.push({[itemName]:item});let key=yield keyTemplate.value(this.context);this.context.pop(),map.has(key)||map.set(key,[]),map.get(key).push(item)}return[...map.entries()].map(([name,items])=>({name,items}))},has:function* has(arr,property,expected){return!!(yield*search.call(this,arr,property,expected))},has_exp:function* has_exp(arr,itemName,exp){return!!(yield*search_exp.call(this,arr,itemName,exp))},find_index:function* find_index(arr,property,expected){let result=yield*search.call(this,arr,property,expected);return result?result[0]:void 0},find_index_exp:function* find_index_exp(arr,itemName,exp){let result=yield*search_exp.call(this,arr,itemName,exp);return result?result[0]:void 0},find:function* find(arr,property,expected){let result=yield*search.call(this,arr,property,expected);return result?result[1]:void 0},find_exp:function* find_exp(arr,itemName,exp){let result=yield*search_exp.call(this,arr,itemName,exp);return result?result[1]:void 0},uniq:function uniq(arr){return arr=toArray(arr),this.context.memoryLimit.use(arr.length),[...new Set(arr)]},sample:function sample(v,count=1){if(isNil(v=toValue(v)))return[];isArray(v)||(v=stringify(v)),this.context.memoryLimit.use(count);let shuffled=[...v].sort(()=>Math.random()-.5);return 1===count?shuffled[0]:shuffled.slice(0,count)}});function date(v,format,timezoneOffset){var _a,_b,_c;let size=(null!==(_a=null==v?void 0:v.length)&&void 0!==_a?_a:0)+(null!==(_b=null==format?void 0:format.length)&&void 0!==_b?_b:0)+(null!==(_c=null==timezoneOffset?void 0:timezoneOffset.length)&&void 0!==_c?_c:0);this.context.memoryLimit.use(size);let date=parseDate(v,this.context.opts,timezoneOffset);return date?strftime(date,format=isNil(format=toValue(format))?this.context.opts.dateFormat:stringify(format)):v}function date_to_xmlschema(v){return date.call(this,v,"%Y-%m-%dT%H:%M:%S%:z")}function date_to_rfc822(v){return date.call(this,v,"%a, %d %b %Y %H:%M:%S %z")}function stringify_date(v,month_type,type,style){let date=parseDate(v,this.context.opts);if(!date)return v;if("ordinal"===type){let d=date.getDate();return"US"===style?strftime(date,`${month_type} ${d}%q, %Y`):strftime(date,`${d}%q ${month_type} %Y`)}return strftime(date,`%d ${month_type} %Y`)}function parseDate(v,opts,timezoneOffset){let date;let defaultTimezoneOffset=null!=timezoneOffset?timezoneOffset:opts.timezoneOffset,locale=opts.locale;return(date="now"===(v=toValue(v))||"today"===v?new LiquidDate(Date.now(),locale,defaultTimezoneOffset):isNumber(v)?new LiquidDate(1e3*v,locale,defaultTimezoneOffset):isString(v)?/^\d+$/.test(v)?new LiquidDate(1e3*+v,locale,defaultTimezoneOffset):opts.preserveTimezones&&void 0===timezoneOffset?LiquidDate.createDateFixedToTimezone(v,locale):new LiquidDate(v,locale,defaultTimezoneOffset):new LiquidDate(v,locale,defaultTimezoneOffset)).valid()?date:void 0}var dateFilters=Object.freeze({__proto__:null,date:date,date_to_xmlschema:date_to_xmlschema,date_to_rfc822:date_to_rfc822,date_to_string:function date_to_string(v,type,style){return stringify_date.call(this,v,"%b",type,style)},date_to_long_string:function date_to_long_string(v,type,style){return stringify_date.call(this,v,"%B",type,style)}});let rCJKWord=/[\u4E00-\u9FFF\uF900-\uFAFF\u3400-\u4DBF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF]/gu,rNonCJKWord=/[^\u4E00-\u9FFF\uF900-\uFAFF\u3400-\u4DBF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF\s]+/gu;var stringFilters=Object.freeze({__proto__:null,append:function append(v,arg){assert(2==arguments.length,"append expect 2 arguments");let lhs=stringify(v),rhs=stringify(arg);return this.context.memoryLimit.use(lhs.length+rhs.length),lhs+rhs},prepend:function prepend(v,arg){assert(2==arguments.length,"prepend expect 2 arguments");let lhs=stringify(v),rhs=stringify(arg);return this.context.memoryLimit.use(lhs.length+rhs.length),rhs+lhs},lstrip:function lstrip(v,chars){let str=stringify(v);return(this.context.memoryLimit.use(str.length),chars)?(chars=escapeRegExp(stringify(chars)),str.replace(RegExp(`^[${chars}]+`,"g"),"")):str.replace(/^\s+/,"")},downcase:function downcase(v){let str=stringify(v);return this.context.memoryLimit.use(str.length),str.toLowerCase()},upcase:function upcase(v){let str=stringify(v);return this.context.memoryLimit.use(str.length),stringify(str).toUpperCase()},remove:function remove(v,arg){let str=stringify(v);return this.context.memoryLimit.use(str.length),str.split(stringify(arg)).join("")},remove_first:function remove_first(v,l){let str=stringify(v);return this.context.memoryLimit.use(str.length),str.replace(stringify(l),"")},remove_last:function remove_last(v,l){let str=stringify(v);this.context.memoryLimit.use(str.length);let pattern=stringify(l),index=str.lastIndexOf(pattern);return -1===index?str:str.substring(0,index)+str.substring(index+pattern.length)},rstrip:function rstrip(str,chars){return(str=stringify(str),this.context.memoryLimit.use(str.length),chars)?(chars=escapeRegExp(stringify(chars)),str.replace(RegExp(`[${chars}]+$`,"g"),"")):str.replace(/\s+$/,"")},split:function split(v,arg){let str=stringify(v);this.context.memoryLimit.use(str.length);let arr=str.split(stringify(arg));for(;arr.length&&""===arr[arr.length-1];)arr.pop();return arr},strip:function strip(v,chars){let str=stringify(v);return(this.context.memoryLimit.use(str.length),chars)?(chars=escapeRegExp(stringify(chars)),str.replace(RegExp(`^[${chars}]+`,"g"),"").replace(RegExp(`[${chars}]+$`,"g"),"")):str.trim()},strip_newlines:function strip_newlines(v){let str=stringify(v);return this.context.memoryLimit.use(str.length),str.replace(/\r?\n/gm,"")},capitalize:function capitalize(str){return str=stringify(str),this.context.memoryLimit.use(str.length),str.charAt(0).toUpperCase()+str.slice(1).toLowerCase()},replace:function replace(v,pattern,replacement){let str=stringify(v);return this.context.memoryLimit.use(str.length),str.split(stringify(pattern)).join(replacement)},replace_first:function replace_first(v,arg1,arg2){let str=stringify(v);return this.context.memoryLimit.use(str.length),str.replace(stringify(arg1),arg2)},replace_last:function replace_last(v,arg1,arg2){let str=stringify(v);this.context.memoryLimit.use(str.length);let pattern=stringify(arg1),index=str.lastIndexOf(pattern);if(-1===index)return str;let replacement=stringify(arg2);return str.substring(0,index)+replacement+str.substring(index+pattern.length)},truncate:function truncate(v,l=50,o="..."){let str=stringify(v);return(this.context.memoryLimit.use(str.length),str.length<=l)?v:str.substring(0,l-o.length)+o},truncatewords:function truncatewords(v,words=15,o="..."){let str=stringify(v);this.context.memoryLimit.use(str.length);let arr=str.split(/\s+/);words<=0&&(words=1);let ret=arr.slice(0,words).join(" ");return arr.length>=words&&(ret+=o),ret},normalize_whitespace:function normalize_whitespace(v){let str=stringify(v);return this.context.memoryLimit.use(str.length),str.replace(/\s+/g," ")},number_of_words:function number_of_words(input,mode){let str=stringify(input);if(this.context.memoryLimit.use(str.length),!(input=str.trim()))return 0;switch(mode){case"cjk":return(input.match(rCJKWord)||[]).length+(input.match(rNonCJKWord)||[]).length;case"auto":return rCJKWord.test(input)?input.match(rCJKWord).length+(input.match(rNonCJKWord)||[]).length:input.split(/\s+/).length;default:return input.split(/\s+/).length}},array_to_sentence_string:function array_to_sentence_string(array,connector="and"){switch(this.context.memoryLimit.use(array.length),array.length){case 0:return"";case 1:return array[0];case 2:return`${array[0]} ${connector} ${array[1]}`;default:return`${array.slice(0,-1).join(", ")}, ${connector} ${array[array.length-1]}`}}});let filters=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},htmlFilters),mathFilters),urlFilters),arrayFilters),dateFilters),stringFilters),misc),MODIFIERS=["offset","limit","reversed"];function reversed(arr){return[...arr].reverse()}function offset(arr,count){return arr.slice(count)}function limit(arr,count){return arr.slice(0,count)}function parseFilePath(tokenizer,liquid,parser){if(liquid.options.dynamicPartials){let file=tokenizer.readValue();return(tokenizer.assert(file,"illegal file path"),"none"===file.getText())?void 0:isQuotedToken(file)?optimize(parser.parse(evalQuotedToken(file))):file}let tokens=[...tokenizer.readFileNameTemplate(liquid.options)],templates=optimize(parser.parseTokens(tokens));return"none"===templates?void 0:templates}function optimize(templates){return 1===templates.length&&isHTMLToken(templates[0].token)?templates[0].token.getContent():templates}function*renderFilePath(file,ctx,liquid){return"string"==typeof file?file:Array.isArray(file)?liquid.renderer.renderTemplates(file,ctx):yield evalToken(file,ctx)}class TablerowloopDrop extends ForloopDrop{constructor(length,cols,collection,variable){super(length,collection,variable),this.length=length,this.cols=cols}row(){return Math.floor(this.i/this.cols)+1}col0(){return this.i%this.cols}col(){return this.col0()+1}col_first(){return 0===this.col0()}col_last(){return this.col()===this.cols}}let tags={assign:class extends Tag{constructor(token,remainTokens,liquid){super(token,remainTokens,liquid),this.identifier=this.tokenizer.readIdentifier(),this.key=this.identifier.content,this.tokenizer.assert(this.key,"expected variable name"),this.tokenizer.skipBlank(),this.tokenizer.assert("="===this.tokenizer.peek(),'expected "="'),this.tokenizer.advance(),this.value=new Value(this.tokenizer.readFilteredValue(),this.liquid)}*render(ctx){ctx.bottom()[this.key]=yield this.value.value(ctx,this.liquid.options.lenientIf)}*arguments(){yield this.value}*localScope(){yield this.identifier}},for:class extends Tag{constructor(token,remainTokens,liquid,parser){let p;super(token,remainTokens,liquid);let variable=this.tokenizer.readIdentifier(),inStr=this.tokenizer.readIdentifier(),collection=this.tokenizer.readValue();if(!variable.size()||"in"!==inStr.content||!collection)throw Error(`illegal tag: ${token.getText()}`);this.variable=variable.content,this.collection=collection,this.hash=new Hash(this.tokenizer,liquid.options.keyValueSeparator),this.templates=[],this.elseTemplates=[];let stream=parser.parseStream(remainTokens).on("start",()=>p=this.templates).on("tag:else",tag=>{assertEmpty(tag.args),p=this.elseTemplates}).on("tag:endfor",tag=>{assertEmpty(tag.args),stream.stop()}).on("template",tpl=>p.push(tpl)).on("end",()=>{throw Error(`tag ${token.getText()} not closed`)});stream.start()}*render(ctx,emitter){let r=this.liquid.renderer,collection=toEnumerable((yield evalToken(this.collection,ctx)));if(!collection.length){yield r.renderTemplates(this.elseTemplates,ctx,emitter);return}let continueKey="continue-"+this.variable+"-"+this.collection.getText();ctx.push({continue:ctx.getRegister(continueKey)});let hash=yield this.hash.render(ctx);ctx.pop(),collection=(this.liquid.options.orderedFilterParameters?Object.keys(hash).filter(x=>MODIFIERS.includes(x)):MODIFIERS.filter(x=>void 0!==hash[x])).reduce((collection,modifier)=>"offset"===modifier?offset(collection,hash.offset):"limit"===modifier?limit(collection,hash.limit):reversed(collection),collection),ctx.setRegister(continueKey,(hash.offset||0)+collection.length);let scope={forloop:new ForloopDrop(collection.length,this.collection.getText(),this.variable)};for(let item of(ctx.push(scope),collection)){if(scope[this.variable]=item,ctx.continueCalled=ctx.breakCalled=!1,yield r.renderTemplates(this.templates,ctx,emitter),ctx.breakCalled)break;scope.forloop.next()}ctx.continueCalled=ctx.breakCalled=!1,ctx.pop()}*children(){let templates=this.templates.slice();return this.elseTemplates&&templates.push(...this.elseTemplates),templates}*arguments(){for(let v of(yield this.collection,Object.values(this.hash.hash)))isValueToken(v)&&(yield v)}blockScope(){return[this.variable,"forloop"]}},capture:class extends Tag{constructor(tagToken,remainTokens,liquid,parser){for(super(tagToken,remainTokens,liquid),this.templates=[],this.identifier=this.readVariable(),this.variable=this.identifier.content;remainTokens.length;){let token=remainTokens.shift();if(isTagToken(token)&&"endcapture"===token.name)return;this.templates.push(parser.parseToken(token,remainTokens))}throw Error(`tag ${tagToken.getText()} not closed`)}readVariable(){let ident=this.tokenizer.readIdentifier();if(ident.content||(ident=this.tokenizer.readQuoted()))return ident;throw this.tokenizer.error("invalid capture name")}*render(ctx){let r=this.liquid.renderer,html=yield r.renderTemplates(this.templates,ctx);ctx.bottom()[this.variable]=html}*children(){return this.templates}*localScope(){yield this.identifier}},case:class extends Tag{constructor(tagToken,remainTokens,liquid,parser){super(tagToken,remainTokens,liquid),this.branches=[],this.elseTemplates=[],this.value=new Value(this.tokenizer.readFilteredValue(),this.liquid),this.elseTemplates=[];let p=[],elseCount=0,stream=parser.parseStream(remainTokens).on("tag:when",token=>{if(elseCount>0)return;p=[];let values=[];for(;!token.tokenizer.end();)values.push(token.tokenizer.readValueOrThrow()),token.tokenizer.skipBlank(),","===token.tokenizer.peek()?token.tokenizer.readTo(","):token.tokenizer.readTo("or");this.branches.push({values,templates:p})}).on("tag:else",()=>{elseCount++,p=this.elseTemplates}).on("tag:endcase",()=>stream.stop()).on("template",tpl=>{(p!==this.elseTemplates||1===elseCount)&&p.push(tpl)}).on("end",()=>{throw Error(`tag ${tagToken.getText()} not closed`)});stream.start()}*render(ctx,emitter){let r=this.liquid.renderer,target=toValue((yield this.value.value(ctx,ctx.opts.lenientIf))),branchHit=!1;for(let branch of this.branches)for(let valueToken of branch.values)if(equals(target,(yield evalToken(valueToken,ctx,ctx.opts.lenientIf)))){yield r.renderTemplates(branch.templates,ctx,emitter),branchHit=!0;break}branchHit||(yield r.renderTemplates(this.elseTemplates,ctx,emitter))}*arguments(){yield this.value,yield*this.branches.flatMap(b=>b.values)}*children(){let templates=this.branches.flatMap(b=>b.templates);return this.elseTemplates&&templates.push(...this.elseTemplates),templates}},comment:class extends Tag{constructor(tagToken,remainTokens,liquid){for(super(tagToken,remainTokens,liquid);remainTokens.length;){let token=remainTokens.shift();if(isTagToken(token)&&"endcomment"===token.name)return}throw Error(`tag ${tagToken.getText()} not closed`)}render(){}},include:class extends Tag{constructor(token,remainTokens,liquid,parser){super(token,remainTokens,liquid);let{tokenizer}=token;this.file=parseFilePath(tokenizer,this.liquid,parser),this.currentFile=token.file;let begin=tokenizer.p;"with"===tokenizer.readIdentifier().content?(tokenizer.skipBlank(),":"!==tokenizer.peek()?this.withVar=tokenizer.readValue():tokenizer.p=begin):tokenizer.p=begin,this.hash=new Hash(tokenizer,liquid.options.jekyllInclude||liquid.options.keyValueSeparator)}*render(ctx,emitter){let{liquid,hash,withVar}=this,{renderer}=liquid,filepath=yield renderFilePath(this.file,ctx,liquid);assert(filepath,()=>`illegal file path "${filepath}"`);let saved=ctx.saveRegister("blocks","blockMode");ctx.setRegister("blocks",{}),ctx.setRegister("blockMode",BlockMode.OUTPUT);let scope=yield hash.render(ctx);withVar&&(scope[filepath]=yield evalToken(withVar,ctx));let templates=yield liquid._parsePartialFile(filepath,ctx.sync,this.currentFile);ctx.push(ctx.opts.jekyllInclude?{include:scope}:scope),yield renderer.renderTemplates(templates,ctx,emitter),ctx.pop(),ctx.restoreRegister(saved)}*children(partials,sync){return partials&&isString(this.file)?yield this.liquid._parsePartialFile(this.file,sync,this.currentFile):[]}partialScope(){if(isString(this.file)){let names;return this.liquid.options.jekyllInclude?names=["include"]:(names=Object.keys(this.hash.hash),this.withVar&&names.push([this.file,this.withVar])),{name:this.file,isolated:!1,scope:names}}}*arguments(){yield*Object.values(this.hash.hash).filter(isValueToken),isValueToken(this.file)&&(yield this.file),isValueToken(this.withVar)&&(yield this.withVar)}},render:class extends Tag{constructor(token,remainTokens,liquid,parser){super(token,remainTokens,liquid);let tokenizer=this.tokenizer;for(this.file=parseFilePath(tokenizer,this.liquid,parser),this.currentFile=token.file;!tokenizer.end();){tokenizer.skipBlank();let begin=tokenizer.p,keyword=tokenizer.readIdentifier();if(("with"===keyword.content||"for"===keyword.content)&&(tokenizer.skipBlank(),":"!==tokenizer.peek())){let value=tokenizer.readValue();if(value){let alias;let beforeAs=tokenizer.p;"as"===tokenizer.readIdentifier().content?alias=tokenizer.readIdentifier():tokenizer.p=beforeAs,this[keyword.content]={value,alias:alias&&alias.content},tokenizer.skipBlank(),","===tokenizer.peek()&&tokenizer.advance();continue}}tokenizer.p=begin;break}this.hash=new Hash(tokenizer,liquid.options.keyValueSeparator)}*render(ctx,emitter){let{liquid,hash}=this,filepath=yield renderFilePath(this.file,ctx,liquid);assert(filepath,()=>`illegal file path "${filepath}"`);let childCtx=ctx.spawn(),scope=childCtx.bottom();if(__assign(scope,(yield hash.render(ctx))),this.with){let{value,alias}=this.with;scope[alias||filepath]=yield evalToken(value,ctx)}if(this.for){let{value,alias}=this.for,collection=toEnumerable((yield evalToken(value,ctx)));for(let item of(scope.forloop=new ForloopDrop(collection.length,value.getText(),alias),collection)){scope[alias]=item;let templates=yield liquid._parsePartialFile(filepath,childCtx.sync,this.currentFile);yield liquid.renderer.renderTemplates(templates,childCtx,emitter),scope.forloop.next()}}else{let templates=yield liquid._parsePartialFile(filepath,childCtx.sync,this.currentFile);yield liquid.renderer.renderTemplates(templates,childCtx,emitter)}}*children(partials,sync){return partials&&isString(this.file)?yield this.liquid._parsePartialFile(this.file,sync,this.currentFile):[]}partialScope(){if(isString(this.file)){let names=Object.keys(this.hash.hash);if(this.with){let{value,alias}=this.with;isString(alias)?names.push([alias,value]):isString(this.file)&&names.push([this.file,value])}if(this.for){let{value,alias}=this.for;isString(alias)?names.push([alias,value]):isString(this.file)&&names.push([this.file,value])}return{name:this.file,isolated:!0,scope:names}}}*arguments(){for(let v of Object.values(this.hash.hash))isValueToken(v)&&(yield v);if(this.with){let{value}=this.with;isValueToken(value)&&(yield value)}if(this.for){let{value}=this.for;isValueToken(value)&&(yield value)}}},decrement:class extends Tag{constructor(token,remainTokens,liquid){super(token,remainTokens,liquid),this.identifier=this.tokenizer.readIdentifier(),this.variable=this.identifier.content}render(context,emitter){let scope=context.environments;isNumber(scope[this.variable])||(scope[this.variable]=0),emitter.write(stringify(--scope[this.variable]))}*localScope(){yield this.identifier}},increment:class extends Tag{constructor(token,remainTokens,liquid){super(token,remainTokens,liquid),this.identifier=this.tokenizer.readIdentifier(),this.variable=this.identifier.content}render(context,emitter){let scope=context.environments;isNumber(scope[this.variable])||(scope[this.variable]=0);let val=scope[this.variable];scope[this.variable]++,emitter.write(stringify(val))}*localScope(){yield this.identifier}},cycle:class extends Tag{constructor(token,remainTokens,liquid){super(token,remainTokens,liquid),this.candidates=[];let group=this.tokenizer.readValue();for(this.tokenizer.skipBlank(),group&&(":"===this.tokenizer.peek()?(this.group=group,this.tokenizer.advance()):this.candidates.push(group));!this.tokenizer.end();){let value=this.tokenizer.readValue();value&&this.candidates.push(value),this.tokenizer.readTo(",")}this.tokenizer.assert(this.candidates.length,()=>`empty candidates: "${token.getText()}"`)}*render(ctx,emitter){let group=yield evalToken(this.group,ctx),fingerprint=`cycle:${group}:`+this.candidates.join(","),groups=ctx.getRegister("cycle"),idx=groups[fingerprint];void 0===idx&&(idx=groups[fingerprint]=0);let candidate=this.candidates[idx];return idx=(idx+1)%this.candidates.length,groups[fingerprint]=idx,yield evalToken(candidate,ctx)}*arguments(){yield*this.candidates,this.group&&(yield this.group)}},if:class extends Tag{constructor(tagToken,remainTokens,liquid,parser){super(tagToken,remainTokens,liquid),this.branches=[];let p=[];parser.parseStream(remainTokens).on("start",()=>this.branches.push({value:new Value(tagToken.tokenizer.readFilteredValue(),this.liquid),templates:p=[]})).on("tag:elsif",token=>{assert(!this.elseTemplates,"unexpected elsif after else"),this.branches.push({value:new Value(token.tokenizer.readFilteredValue(),this.liquid),templates:p=[]})}).on("tag:else",tag=>{assertEmpty(tag.args),assert(!this.elseTemplates,"duplicated else"),p=this.elseTemplates=[]}).on("tag:endif",function(tag){assertEmpty(tag.args),this.stop()}).on("template",tpl=>p.push(tpl)).on("end",()=>{throw Error(`tag ${tagToken.getText()} not closed`)}).start()}*render(ctx,emitter){let r=this.liquid.renderer;for(let{value,templates}of this.branches)if(isTruthy((yield value.value(ctx,ctx.opts.lenientIf)),ctx)){yield r.renderTemplates(templates,ctx,emitter);return}yield r.renderTemplates(this.elseTemplates||[],ctx,emitter)}*children(){let templates=this.branches.flatMap(b=>b.templates);return this.elseTemplates&&templates.push(...this.elseTemplates),templates}arguments(){return this.branches.map(b=>b.value)}},layout:class extends Tag{constructor(token,remainTokens,liquid,parser){super(token,remainTokens,liquid),this.file=parseFilePath(this.tokenizer,this.liquid,parser),this.currentFile=token.file,this.args=new Hash(this.tokenizer,liquid.options.keyValueSeparator),this.templates=parser.parseTokens(remainTokens)}*render(ctx,emitter){let{liquid,args,file}=this,{renderer}=liquid;if(void 0===file){ctx.setRegister("blockMode",BlockMode.OUTPUT),yield renderer.renderTemplates(this.templates,ctx,emitter);return}let filepath=yield renderFilePath(this.file,ctx,liquid);assert(filepath,()=>`illegal file path "${filepath}"`);let templates=yield liquid._parseLayoutFile(filepath,ctx.sync,this.currentFile);ctx.setRegister("blockMode",BlockMode.STORE);let html=yield renderer.renderTemplates(this.templates,ctx),blocks=ctx.getRegister("blocks");void 0===blocks[""]&&(blocks[""]=(parent,emitter)=>emitter.write(html)),ctx.setRegister("blockMode",BlockMode.OUTPUT),ctx.push((yield args.render(ctx))),yield renderer.renderTemplates(templates,ctx,emitter),ctx.pop()}*children(partials){let templates=this.templates.slice();return partials&&isString(this.file)&&templates.push(...yield this.liquid._parsePartialFile(this.file,!0,this.currentFile)),templates}*arguments(){for(let v of Object.values(this.args.hash))isValueToken(v)&&(yield v);isValueToken(this.file)&&(yield this.file)}partialScope(){if(isString(this.file))return{name:this.file,isolated:!1,scope:Object.keys(this.args.hash)}}},block:class extends Tag{constructor(token,remainTokens,liquid,parser){super(token,remainTokens,liquid),this.templates=[];let match=/\w+/.exec(token.args);for(this.block=match?match[0]:"";remainTokens.length;){let token=remainTokens.shift();if(isTagToken(token)&&"endblock"===token.name)return;let template=parser.parseToken(token,remainTokens);this.templates.push(template)}throw Error(`tag ${token.getText()} not closed`)}*render(ctx,emitter){let blockRender=this.getBlockRender(ctx);ctx.getRegister("blockMode")===BlockMode.STORE?ctx.getRegister("blocks")[this.block]=blockRender:yield blockRender(new BlockDrop,emitter)}getBlockRender(ctx){let{liquid,templates}=this,renderChild=ctx.getRegister("blocks")[this.block],renderCurrent=function*(superBlock,emitter){ctx.push({block:superBlock}),yield liquid.renderer.renderTemplates(templates,ctx,emitter),ctx.pop()};return renderChild?(superBlock,emitter)=>renderChild(new BlockDrop(emitter=>renderCurrent(superBlock,emitter)),emitter):renderCurrent}*children(){return this.templates}blockScope(){return["block"]}},raw:class extends Tag{constructor(tagToken,remainTokens,liquid){for(super(tagToken,remainTokens,liquid),this.tokens=[];remainTokens.length;){let token=remainTokens.shift();if(isTagToken(token)&&"endraw"===token.name)return;this.tokens.push(token)}throw Error(`tag ${tagToken.getText()} not closed`)}render(){return this.tokens.map(token=>token.getText()).join("")}},tablerow:class extends Tag{constructor(tagToken,remainTokens,liquid,parser){let p;super(tagToken,remainTokens,liquid);let variable=this.tokenizer.readIdentifier();this.tokenizer.skipBlank();let predicate=this.tokenizer.readIdentifier(),collectionToken=this.tokenizer.readValue();if("in"!==predicate.content||!collectionToken)throw Error(`illegal tag: ${tagToken.getText()}`);this.variable=variable.content,this.collection=collectionToken,this.args=new Hash(this.tokenizer,liquid.options.keyValueSeparator),this.templates=[];let stream=parser.parseStream(remainTokens).on("start",()=>p=this.templates).on("tag:endtablerow",()=>stream.stop()).on("template",tpl=>p.push(tpl)).on("end",()=>{throw Error(`tag ${tagToken.getText()} not closed`)});stream.start()}*render(ctx,emitter){let collection=toEnumerable((yield evalToken(this.collection,ctx))),args=yield this.args.render(ctx),offset=args.offset||0,limit=void 0===args.limit?collection.length:args.limit;collection=collection.slice(offset,offset+limit);let cols=args.cols||collection.length,r=this.liquid.renderer,tablerowloop=new TablerowloopDrop(collection.length,cols,this.collection.getText(),this.variable),scope={tablerowloop};ctx.push(scope);for(let idx=0;idx<collection.length;idx++,tablerowloop.next())scope[this.variable]=collection[idx],0===tablerowloop.col0()&&(1!==tablerowloop.row()&&emitter.write("</tr>"),emitter.write(`<tr class="row${tablerowloop.row()}">`)),emitter.write(`<td class="col${tablerowloop.col()}">`),yield r.renderTemplates(this.templates,ctx,emitter),emitter.write("</td>");collection.length&&emitter.write("</tr>"),ctx.pop()}*children(){return this.templates}*arguments(){for(let v of(yield this.collection,Object.values(this.args.hash)))isValueToken(v)&&(yield v)}blockScope(){return[this.variable,"tablerowloop"]}},unless:class extends Tag{constructor(tagToken,remainTokens,liquid,parser){super(tagToken,remainTokens,liquid),this.branches=[],this.elseTemplates=[];let p=[],elseCount=0;parser.parseStream(remainTokens).on("start",()=>this.branches.push({value:new Value(tagToken.tokenizer.readFilteredValue(),this.liquid),test:isFalsy,templates:p=[]})).on("tag:elsif",token=>{if(elseCount>0){p=[];return}this.branches.push({value:new Value(token.tokenizer.readFilteredValue(),this.liquid),test:isTruthy,templates:p=[]})}).on("tag:else",()=>{elseCount++,p=this.elseTemplates}).on("tag:endunless",function(){this.stop()}).on("template",tpl=>{(p!==this.elseTemplates||1===elseCount)&&p.push(tpl)}).on("end",()=>{throw Error(`tag ${tagToken.getText()} not closed`)}).start()}*render(ctx,emitter){let r=this.liquid.renderer;for(let{value,test,templates}of this.branches)if(test((yield value.value(ctx,ctx.opts.lenientIf)),ctx)){yield r.renderTemplates(templates,ctx,emitter);return}yield r.renderTemplates(this.elseTemplates,ctx,emitter)}*children(){let children=this.branches.flatMap(b=>b.templates);return this.elseTemplates&&children.push(...this.elseTemplates),children}arguments(){return this.branches.map(b=>b.value)}},break:class extends Tag{render(ctx,_emitter){ctx.breakCalled=!0}},continue:class extends Tag{render(ctx,_emitter){ctx.continueCalled=!0}},echo:class extends Tag{constructor(token,remainTokens,liquid){super(token,remainTokens,liquid),this.tokenizer.skipBlank(),this.tokenizer.end()||(this.value=new Value(this.tokenizer.readFilteredValue(),this.liquid))}*render(ctx,emitter){if(!this.value)return;let val=yield this.value.value(ctx,!1);emitter.write(val)}*arguments(){this.value&&(yield this.value)}},liquid:class extends Tag{constructor(token,remainTokens,liquid,parser){super(token,remainTokens,liquid);let tokens=this.tokenizer.readLiquidTagTokens(this.liquid.options);this.templates=parser.parseTokens(tokens)}*render(ctx,emitter){yield this.liquid.renderer.renderTemplates(this.templates,ctx,emitter)}*children(){return this.templates}},"#":class extends Tag{constructor(tagToken,remainTokens,liquid){if(super(tagToken,remainTokens,liquid),-1!==tagToken.args.search(/\n\s*[^#\s]/g))throw Error("every line of an inline comment must start with a '#' character")}render(){}}};class Liquid{constructor(opts={}){this.renderer=new Render,this.filters={},this.tags={},this.options=normalize(opts),this.parser=new Parser(this),forOwn(tags,(conf,name)=>this.registerTag(name,conf)),forOwn(filters,(handler,name)=>this.registerFilter(name,handler))}parse(html,filepath){return new Parser(this).parse(html,filepath)}_render(tpl,scope,renderOptions){let ctx=scope instanceof Context?scope:new Context(scope,this.options,renderOptions);return this.renderer.renderTemplates(tpl,ctx)}render(tpl,scope,renderOptions){return __awaiter(this,void 0,void 0,function*(){return toPromise(this._render(tpl,scope,Object.assign(Object.assign({},renderOptions),{sync:!1})))})}renderSync(tpl,scope,renderOptions){return toValueSync(this._render(tpl,scope,Object.assign(Object.assign({},renderOptions),{sync:!0})))}renderToNodeStream(tpl,scope,renderOptions={}){let ctx=new Context(scope,this.options,renderOptions);return this.renderer.renderTemplatesToNodeStream(tpl,ctx)}_parseAndRender(html,scope,renderOptions){let tpl=this.parse(html);return this._render(tpl,scope,renderOptions)}parseAndRender(html,scope,renderOptions){return __awaiter(this,void 0,void 0,function*(){return toPromise(this._parseAndRender(html,scope,Object.assign(Object.assign({},renderOptions),{sync:!1})))})}parseAndRenderSync(html,scope,renderOptions){return toValueSync(this._parseAndRender(html,scope,Object.assign(Object.assign({},renderOptions),{sync:!0})))}_parsePartialFile(file,sync,currentFile){return new Parser(this).parseFile(file,sync,LookupType.Partials,currentFile)}_parseLayoutFile(file,sync,currentFile){return new Parser(this).parseFile(file,sync,LookupType.Layouts,currentFile)}_parseFile(file,sync,lookupType,currentFile){return new Parser(this).parseFile(file,sync,lookupType,currentFile)}parseFile(file,lookupType){return __awaiter(this,void 0,void 0,function*(){return toPromise(new Parser(this).parseFile(file,!1,lookupType))})}parseFileSync(file,lookupType){return toValueSync(new Parser(this).parseFile(file,!0,lookupType))}*_renderFile(file,ctx,renderFileOptions){let templates=yield this._parseFile(file,renderFileOptions.sync,renderFileOptions.lookupType);return yield this._render(templates,ctx,renderFileOptions)}renderFile(file,ctx,renderFileOptions){return __awaiter(this,void 0,void 0,function*(){return toPromise(this._renderFile(file,ctx,Object.assign(Object.assign({},renderFileOptions),{sync:!1})))})}renderFileSync(file,ctx,renderFileOptions){return toValueSync(this._renderFile(file,ctx,Object.assign(Object.assign({},renderFileOptions),{sync:!0})))}renderFileToNodeStream(file,scope,renderOptions){return __awaiter(this,void 0,void 0,function*(){let templates=yield this.parseFile(file);return this.renderToNodeStream(templates,scope,renderOptions)})}_evalValue(str,scope){let value=new Value(str,this),ctx=scope instanceof Context?scope:new Context(scope,this.options);return value.value(ctx)}evalValue(str,scope){return __awaiter(this,void 0,void 0,function*(){return toPromise(this._evalValue(str,scope))})}evalValueSync(str,scope){return toValueSync(this._evalValue(str,scope))}registerFilter(name,filter){this.filters[name]=filter}registerTag(name,tag){this.tags[name]=isFunction(tag)?tag:createTagClass(tag)}plugin(plugin){return plugin.call(this,Liquid)}express(){let self1=this,firstCall=!0;return function(filePath,ctx,callback){if(firstCall){firstCall=!1;let dirs=normalizeDirectoryList(this.root);self1.options.root.unshift(...dirs),self1.options.layouts.unshift(...dirs),self1.options.partials.unshift(...dirs)}self1.renderFile(filePath,ctx).then(html=>callback(null,html),callback)}}analyze(template,options={}){return __awaiter(this,void 0,void 0,function*(){return analyze(template,options)})}analyzeSync(template,options={}){return analyzeSync(template,options)}parseAndAnalyze(html,filename,options={}){return __awaiter(this,void 0,void 0,function*(){return analyze(this.parse(html,filename),options)})}parseAndAnalyzeSync(html,filename,options={}){return analyzeSync(this.parse(html,filename),options)}variables(template,options={}){return __awaiter(this,void 0,void 0,function*(){return Object.keys((yield analyze(isString(template)?this.parse(template):template,options)).variables)})}variablesSync(template,options={}){return Object.keys(analyzeSync(isString(template)?this.parse(template):template,options).variables)}fullVariables(template,options={}){return __awaiter(this,void 0,void 0,function*(){return Array.from(new Set(Object.values((yield analyze(isString(template)?this.parse(template):template,options)).variables).flatMap(a=>a.map(v=>String(v)))))})}fullVariablesSync(template,options={}){return Array.from(new Set(Object.values(analyzeSync(isString(template)?this.parse(template):template,options).variables).flatMap(a=>a.map(v=>String(v)))))}variableSegments(template,options={}){return __awaiter(this,void 0,void 0,function*(){return Array.from(strictUniq(Object.values((yield analyze(isString(template)?this.parse(template):template,options)).variables).flatMap(a=>a.map(v=>v.toArray()))))})}variableSegmentsSync(template,options={}){return Array.from(strictUniq(Object.values(analyzeSync(isString(template)?this.parse(template):template,options).variables).flatMap(a=>a.map(v=>v.toArray()))))}globalVariables(template,options={}){return __awaiter(this,void 0,void 0,function*(){return Object.keys((yield analyze(isString(template)?this.parse(template):template,options)).globals)})}globalVariablesSync(template,options={}){return Object.keys(analyzeSync(isString(template)?this.parse(template):template,options).globals)}globalFullVariables(template,options={}){return __awaiter(this,void 0,void 0,function*(){return Array.from(new Set(Object.values((yield analyze(isString(template)?this.parse(template):template,options)).globals).flatMap(a=>a.map(v=>String(v)))))})}globalFullVariablesSync(template,options={}){return Array.from(new Set(Object.values(analyzeSync(isString(template)?this.parse(template):template,options).globals).flatMap(a=>a.map(v=>String(v)))))}globalVariableSegments(template,options={}){return __awaiter(this,void 0,void 0,function*(){return Array.from(strictUniq(Object.values((yield analyze(isString(template)?this.parse(template):template,options)).globals).flatMap(a=>a.map(v=>v.toArray()))))})}globalVariableSegmentsSync(template,options={}){return Array.from(strictUniq(Object.values(analyzeSync(isString(template)?this.parse(template):template,options).globals).flatMap(a=>a.map(v=>v.toArray()))))}}}}]);