(window.webpackJsonp=window.webpackJsonp||[]).push([[2,6,9,13],{"./frontend/src/scenes/apps/AppMetricsScene.tsx":function(H,E,e){"use strict";e.r(E),e.d(E,"scene",function(){return o}),e.d(E,"AppMetrics",function(){return d});var b=e("./node_modules/core-js/modules/es.function.name.js"),A=e.n(b),_=e("./node_modules/antd/es/tabs/index.js"),n=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),f=e("./frontend/src/lib/components/PageHeader.tsx"),T=e("./node_modules/kea/lib/index.esm.js"),c=e("./frontend/src/scenes/apps/MetricsTab.tsx"),R=e("./frontend/src/scenes/apps/HistoricalExportsTab.tsx"),O=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),L=e("./frontend/src/scenes/apps/ErrorDetailsModal.tsx"),m=e("./frontend/src/lib/components/Tooltip.tsx"),C=e("./frontend/src/lib/components/icons.tsx"),i=e("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),s=e("./frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),t=e("./node_modules/react/jsx-runtime.js"),I=e.n(t),o={component:d,logic:n.appMetricsSceneLogic,paramsToProps:function(l){var r,u=l.params.pluginConfigId;return{pluginConfigId:(r=parseInt(u))!==null&&r!==void 0?r:0}}};function d(){var a=Object(T.useValues)(n.appMetricsSceneLogic),l=a.activeTab,r=a.pluginConfig,u=a.pluginConfigLoading,M=a.showTab,U=a.shouldShowAppMetrics,v=Object(T.useActions)(n.appMetricsSceneLogic),B=v.setActiveTab;return Object(t.jsxs)("div",{children:[Object(t.jsx)(f.a,{title:r?r.plugin_info.name:Object(t.jsx)(O.a,{}),caption:U&&r?"An overview of metrics and exports for this app.":void 0}),u||!l?Object(t.jsx)(O.a,{}):Object(t.jsxs)(_.a,{tabPosition:"top",animated:!1,activeKey:l,onTabClick:function(g){return B(g)},children:[M(n.AppMetricsTab.ProcessEvent)&&Object(t.jsx)(_.a.TabPane,{tab:"processEvent metrics",children:Object(t.jsx)(c.MetricsTab,{tab:n.AppMetricsTab.ProcessEvent})},n.AppMetricsTab.ProcessEvent),M(n.AppMetricsTab.OnEvent)&&Object(t.jsx)(_.a.TabPane,{tab:"onEvent metrics",children:Object(t.jsx)(c.MetricsTab,{tab:n.AppMetricsTab.OnEvent})},n.AppMetricsTab.OnEvent),M(n.AppMetricsTab.ExportEvents)&&Object(t.jsx)(_.a.TabPane,{tab:"exportEvents metrics",children:Object(t.jsx)(c.MetricsTab,{tab:n.AppMetricsTab.ExportEvents})},n.AppMetricsTab.ExportEvents),M(n.AppMetricsTab.ScheduledTask)&&Object(t.jsx)(_.a.TabPane,{tab:Object(t.jsxs)(t.Fragment,{children:["Scheduled tasks"," ",Object(t.jsx)(m.a,{title:"Shows metrics for app methods `runEveryMinute`, `runEveryHour` and `runEveryDay`",children:Object(t.jsx)(C.IconInfo,{})})]}),children:Object(t.jsx)(c.MetricsTab,{tab:n.AppMetricsTab.ScheduledTask})},n.AppMetricsTab.ScheduledTask),M(n.AppMetricsTab.HistoricalExports)&&Object(t.jsx)(_.a.TabPane,{tab:"Historical exports",children:Object(t.jsx)(R.HistoricalExportsTab,{})},n.AppMetricsTab.HistoricalExports),Object(t.jsx)(_.a.TabPane,{tab:"History",children:Object(t.jsx)(i.a,{scope:s.a.PLUGIN,id:r==null?void 0:r.id})},n.AppMetricsTab.History)]}),Object(t.jsx)(L.ErrorDetailsModal,{})]})}},"./frontend/src/scenes/apps/ErrorDetailsModal.tsx":function(H,E,e){"use strict";e.r(E),e.d(E,"ErrorDetailsModal",function(){return I});var b=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),A=e.n(b),_=e("./node_modules/react/index.js"),n=e.n(_),f=e("./node_modules/kea/lib/index.esm.js"),T=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),c=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),R=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),O=e("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),L=e("./frontend/src/lib/components/LemonButton/index.ts"),m=e("./frontend/src/lib/components/icons.tsx"),C=e("./frontend/src/lib/components/LemonModal/index.ts"),i=e("./frontend/src/lib/components/CodeSnippet/index.tsx"),s=e("./node_modules/react/jsx-runtime.js"),t=e.n(s);function I(){var d,a,l=Object(f.useValues)(T.appMetricsSceneLogic),r=l.errorDetails,u=l.errorDetailsModalError,M=l.errorDetailsLoading,U=Object(f.useActions)(T.appMetricsSceneLogic),v=U.closeErrorDetailsModal,B=Object(_.useState)(0),S=A()(B,2),g=S[0],N=S[1],j=r[g];return Object(s.jsx)(C.a,{isOpen:!!u,onClose:v,title:u,width:"min(50vw, 80rem)",description:Object(s.jsx)("span",{children:j==null||(d=j.error_details)===null||d===void 0||(a=d.error.message)===null||a===void 0?void 0:a.substring(0,200)}),footer:Object(s.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:M?Object(s.jsx)(c.a,{className:"1-10"}):Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("span",{children:[g+1," of ",r.length," sample",r.length>1?"s":""]}),Object(s.jsx)(L.a,{icon:Object(s.jsx)(m.IconChevronLeft,{}),onClick:function(){return N(g-1)},disabled:g==0}),Object(s.jsx)(L.a,{icon:Object(s.jsx)(m.IconChevronRight,{}),onClick:function(){return N(g+1)},disabled:g==r.length-1})]})}),children:!u||M?Object(s.jsx)(c.a,{className:"h-10"}):Object(s.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[Object(s.jsxs)("div",{children:[Object(s.jsx)(O.a,{children:"When:"})," ",Object(s.jsx)(R.b,{time:j.timestamp,showSeconds:!0})]}),j.error_details.eventCount&&Object(s.jsxs)("div",{children:[Object(s.jsx)(O.a,{children:"Event Count"}),Object(s.jsx)("div",{children:j.error_details.eventCount})]}),j.error_details.error.message&&Object(s.jsx)(o,{title:"Error message",defaultIsExpanded:!0,children:Object(s.jsx)(i.a,{wrap:!0,language:i.b.JavaScript,children:j.error_details.error.message})}),j.error_details.event&&Object(s.jsx)(o,{title:"Event payload",defaultIsExpanded:!1,children:Object(s.jsx)(i.a,{wrap:!0,language:i.b.JSON,children:JSON.stringify(j.error_details.event,null,2)})}),j.error_details.error.stack&&Object(s.jsx)(o,{title:"Stack trace",defaultIsExpanded:!1,children:Object(s.jsx)(i.a,{wrap:!0,language:i.b.JavaScript,children:j.error_details.error.stack})})]})})}function o(d){var a=Object(_.useState)(d.defaultIsExpanded),l=A()(a,2),r=l[0],u=l[1];return Object(s.jsxs)("div",{className:"bg-mid border rounded",children:[Object(s.jsx)(L.a,{status:"stealth",fullWidth:!0,onClick:function(){return u(!r)},sideIcon:r?Object(s.jsx)(m.IconUnfoldLess,{}):Object(s.jsx)(m.IconUnfoldMore,{}),title:r?"Show less":"Show more",className:"bg-mid",children:d.title}),r&&Object(s.jsx)("div",{className:"bg-light p-2",children:d.children})]})}},"./frontend/src/scenes/apps/HistoricalExport.tsx":function(H,E,e){"use strict";e.r(E),e.d(E,"HistoricalExport",function(){return O});var b=e("./node_modules/antd/es/card/index.js"),A=e("./node_modules/kea/lib/index.esm.js"),_=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),n=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),f=e("./frontend/src/scenes/apps/historicalExportLogic.ts"),T=e("./frontend/src/scenes/apps/MetricsTab.tsx"),c=e("./node_modules/react/jsx-runtime.js"),R=e.n(c);function O(L){var m,C,i,s,t,I=Object(A.useValues)(Object(f.historicalExportLogic)(L)),o=I.data,d=I.dataLoading;return Object(c.jsxs)("div",{className:"mt-4 mb-4 mr-8",children:[Object(c.jsx)(b.a,{title:"Overview",children:Object(c.jsx)(T.MetricsOverview,{tab:n.AppMetricsTab.HistoricalExports,metrics:(m=o==null?void 0:o.metrics)!==null&&m!==void 0?m:null,metricsLoading:d,exportDuration:o==null||(C=o.summary)===null||C===void 0?void 0:C.duration,exportFailureReason:o==null||(i=o.summary)===null||i===void 0?void 0:i.failure_reason})}),Object(c.jsx)(b.a,{title:"Delivery trends",className:"mt-4",children:Object(c.jsx)(_.AppMetricsGraph,{tab:n.AppMetricsTab.HistoricalExports,metrics:(s=o==null?void 0:o.metrics)!==null&&s!==void 0?s:null,metricsLoading:d})}),Object(c.jsx)(b.a,{title:"Errors",className:"mt-4",children:Object(c.jsx)(T.ErrorsOverview,{errors:(o==null?void 0:o.errors)||[],loading:d,category:"exportEvents",jobId:o==null||(t=o.summary)===null||t===void 0?void 0:t.job_id})})]})}try{O.displayName="HistoricalExport",O.__docgenInfo={description:"",displayName:"HistoricalExport",props:{pluginConfigId:{defaultValue:null,description:"",name:"pluginConfigId",required:!0,type:{name:"number"}},jobId:{defaultValue:null,description:"",name:"jobId",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"]={docgenInfo:O.__docgenInfo,name:"HistoricalExport",path:"frontend/src/scenes/apps/HistoricalExport.tsx#HistoricalExport"})}catch(L){}},"./frontend/src/scenes/apps/HistoricalExportsTab.tsx":function(H,E,e){"use strict";e.r(E),e.d(E,"HistoricalExportsTab",function(){return w});var b=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),A=e.n(b),_=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),n=e.n(_),f=e("./node_modules/core-js/modules/es.array.concat.js"),T=e.n(f),c=e("./node_modules/core-js/modules/es.object.keys.js"),R=e.n(c),O=e("./node_modules/core-js/modules/es.symbol.js"),L=e.n(O),m=e("./node_modules/core-js/modules/es.array.filter.js"),C=e.n(m),i=e("./node_modules/core-js/modules/es.object.to-string.js"),s=e.n(i),t=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),I=e.n(t),o=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),d=e.n(o),a=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),l=e.n(a),r=e("./node_modules/kea/lib/index.esm.js"),u=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),M=e("./frontend/src/lib/components/LemonTable/index.ts"),U=e("./frontend/src/scenes/apps/HistoricalExport.tsx"),v=e("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),B=e("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),S=e("./node_modules/antd/es/progress/index.js"),g=e("./frontend/src/lib/components/LemonButton/index.ts"),N=e("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),j=e("./node_modules/react/index.js"),$=e.n(j),P=e("./node_modules/react/jsx-runtime.js"),ee=e.n(P);function F(p,h){var x=Object.keys(p);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(p);h&&(D=D.filter(function(K){return Object.getOwnPropertyDescriptor(p,K).enumerable})),x.push.apply(x,D)}return x}function X(p){for(var h=1;h<arguments.length;h++){var x=arguments[h]!=null?arguments[h]:{};h%2?F(Object(x),!0).forEach(function(D){A()(p,D,x[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(x)):F(Object(x)).forEach(function(D){Object.defineProperty(p,D,Object.getOwnPropertyDescriptor(x,D))})}return p}var Z=2e4;function w(){var p=Object(r.useValues)(u.appMetricsSceneLogic),h=p.historicalExports,x=p.historicalExportsLoading,D=p.pluginConfig,K=p.interfaceJobsProps,G=p.hasRunningExports,z=Object(r.useActions)(u.appMetricsSceneLogic),k=z.openHistoricalExportModal,q=z.loadHistoricalExports;return Object(j.useEffect)(function(){var y;function W(){G&&(y=setTimeout(function(){q(),W()},Z))}return W(),function(){return y&&clearTimeout(y)}},[G]),Object(P.jsxs)("div",{className:"space-y-2",children:[Object(P.jsx)("div",{className:"flex items-center justify-end",children:Object(P.jsx)(g.a,{type:"primary",onClick:k,disabled:!K,children:"Start new export"})}),Object(P.jsx)(M.a,{dataSource:h,loading:x,columns:[{title:"Dates exported",render:function(W,J){var Y=n()(J.payload.dateRange,2),V=Y[0],Q=Y[1];return V===Q?V:"".concat(V," - ").concat(Q)}},{title:"Progress",width:130,render:function(W,J){switch(J.status){case"success":return Object(P.jsx)(B.a,{type:"success",className:"uppercase",children:"Success"});case"fail":return Object(P.jsx)(B.a,{type:"danger",className:"uppercase",children:"Failed"});case"not_finished":return Object(P.jsx)(S.a,{percent:Math.floor((J.progress||0)*100)})}},align:"right"},Object(v.b)(),Object(v.a)()],expandable:{expandedRowRender:function(W){if(!!D)return Object(P.jsx)(U.HistoricalExport,{pluginConfigId:D.id,jobId:W.job_id})}},useURLForSorting:!1,noSortingCancellation:!0,emptyState:Object(P.jsxs)("div",{className:"",children:[Object(P.jsx)("b",{children:"Nothing has been exported yet!"}),K&&Object(P.jsx)("p",{className:"m-0",children:'Use "Start new export" button above to export historical data in a given time range.'})]})}),K&&Object(P.jsx)(N.d,X({},K))]})}},"./frontend/src/scenes/apps/historicalExportLogic.ts":function(H,E,e){"use strict";e.r(E),e.d(E,"historicalExportLogic",function(){return d});var b=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),A=e.n(b),_=e("./node_modules/@babel/runtime/regenerator/index.js"),n=e.n(_),f=e("./node_modules/core-js/modules/es.array.concat.js"),T=e.n(f),c=e("./node_modules/core-js/modules/es.array.iterator.js"),R=e.n(c),O=e("./node_modules/core-js/modules/es.object.to-string.js"),L=e.n(O),m=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),C=e.n(m),i=e("./node_modules/kea/lib/index.esm.js"),s=e("./node_modules/kea-loaders/lib/index.js"),t=e.n(s),I=e("./frontend/src/lib/api.ts"),o=e("./frontend/src/scenes/teamLogic.tsx"),d=Object(i.kea)([Object(i.path)(["scenes","apps","historicalExportLogic"]),Object(i.props)({}),Object(i.key)(function(a){var l=a.pluginConfigId,r=a.jobId;return"".concat(l,"_").concat(r)}),Object(s.loaders)(function(a){var l=a.props;return{data:[null,{loadExportData:function(){var r=A()(n.a.mark(function M(){return n.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,I.b.get("api/projects/".concat(o.a.values.currentTeamId,"/app_metrics/").concat(l.pluginConfigId,"/historical_exports/").concat(l.jobId));case 2:return v.abrupt("return",v.sent);case 3:case"end":return v.stop()}},M)}));function u(){return r.apply(this,arguments)}return u}()}]}}),Object(i.events)(function(a){var l=a.actions;return{afterMount:l.loadExportData}})])}}]);
