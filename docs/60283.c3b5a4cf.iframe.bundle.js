"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[60283],{"../../products/messaging/frontend/MessagingTabs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{J:()=>MessagingTabs});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");let messagingTabsLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","messagingTabsLogic"]),(0,index_esm.actions)({setTab:function(tab){let fromUrl=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{tab,fromUrl}}}),(0,index_esm.reducers)({currentTab:["broadcasts",{setTab:(_,_ref)=>{let{tab}=_ref;return tab}}]}),(0,lib.actionToUrl)(_ref2=>{let{values}=_ref2;return{setTab:_ref3=>{let{fromUrl}=_ref3;if(!fromUrl){var _campaigns$broadcasts;return null!==(_campaigns$broadcasts=({campaigns:urls.j.messagingCampaigns(),broadcasts:urls.j.messagingBroadcasts(),library:urls.j.messagingLibrary(),senders:urls.j.messagingSenders()})[values.currentTab])&&void 0!==_campaigns$broadcasts?_campaigns$broadcasts:urls.j.messagingBroadcasts()}}}}),(0,lib.urlToAction)(_ref4=>{let{actions,values}=_ref4;return{"/messaging/:tab":_ref5=>{let{tab}=_ref5;tab!==values.currentTab&&actions.setTab(tab,!0)},"/messaging/:tab/*":_ref6=>{let{tab}=_ref6;tab!==values.currentTab&&actions.setTab(tab,!0)}}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function MessagingTabs(){let{currentTab}=(0,index_esm.useValues)(messagingTabsLogic),{setTab}=(0,index_esm.useActions)(messagingTabsLogic);return(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,onChange:tab=>setTab(tab),tabs:[{key:"broadcasts",label:"Broadcasts"},{key:"campaigns",label:"Campaigns"},{key:"library",label:"Templates"},{key:"senders",label:"Senders"}]})}},"../../products/messaging/frontend/Senders/MessageSenders.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.22.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),UserActivityIndicator=__webpack_require__("../../frontend/src/lib/components/UserActivityIndicator/UserActivityIndicator.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),integrationsLogic=__webpack_require__("../../frontend/src/lib/integrations/integrationsLogic.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts");let emailSetupModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","EmailSetup","emailSetupModalLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{integration}=_ref;return integration?`messaging-sender-setup-${integration.id}`:"messaging-sender-setup-new"}),(0,index_esm.connect)(()=>({values:[integrationsLogic.a,["integrations"]],actions:[integrationsLogic.a,["loadIntegrations"]]})),(0,lib.forms)(_ref2=>{let{actions}=_ref2;return{emailSender:{defaults:{domain:""},errors:_ref3=>{let domainError,{domain}=_ref3;return domain||(domainError="Domain is required"),/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(domain)||(domainError="Invalid domain format"),{domain:domainError}},submit:async()=>{actions.submitDomain()}}}}),(0,kea_loaders_lib.loaders)(_ref4=>{let{actions,values}=_ref4;return{integration:{submitDomain:async()=>{let integration=await api.ZP.integrations.create({kind:"email",config:{domain:values.emailSender.domain}});return actions.loadIntegrations(),integration},setIntegration:integration=>integration},verification:{verifyDomain:async()=>api.ZP.integrations.verifyEmail(values.integration.id)}}}),(0,index_esm.selectors)({dnsRecords:[s=>[s.verification],verification=>verification?.status||null]}),(0,index_esm.listeners)(_ref5=>{let{props,values,actions}=_ref5;return{setIntegrationSuccess:()=>{actions.verifyDomain()},submitDomainSuccess:()=>{actions.verifyDomain()},verifyDomainSuccess:_ref6=>{let{verification}=_ref6;"success"===verification.status&&(LemonToast.U.success("Domain verified successfully!"),actions.loadIntegrations(),props.onComplete(values.integration.id))}}}),(0,index_esm.afterMount)(_ref7=>{let{props,actions}=_ref7;props.integration&&actions.setIntegration(props.integration)})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let EmailSetupModal=props=>{let{integration,integrationLoading,verification,verificationLoading}=(0,index_esm.useValues)(emailSetupModalLogic(props)),{verifyDomain,submitEmailSender}=(0,index_esm.useActions)(emailSetupModalLogic(props)),modalContent=(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});return modalContent=integration?(0,jsx_runtime.jsxs)("div",{className:"space-y-2 max-w-[60rem]",children:[(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted",children:"These DNS records verify ownership of your domain. This ensures your emails are delivered to inboxes and not marked as spam."}),(0,jsx_runtime.jsx)("p",{className:"font-semibold mb-2",children:"Note: It can take up to 48 hours for DNS changes to propagate."}),(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto",children:(0,jsx_runtime.jsxs)("table",{className:"w-full border-collapse",children:[(0,jsx_runtime.jsx)("thead",{children:(0,jsx_runtime.jsxs)("tr",{className:"border-b",children:[(0,jsx_runtime.jsx)("th",{className:"py-2 text-left",children:"Type"}),(0,jsx_runtime.jsx)("th",{className:"py-2 text-left",children:"Hostname"}),(0,jsx_runtime.jsx)("th",{className:"py-2 text-left",children:"Value"}),(0,jsx_runtime.jsx)("th",{className:"py-2 text-left",children:"Status"})]})}),(0,jsx_runtime.jsx)("tbody",{children:verification?.dnsRecords?.map((record,index)=>jsx_runtime.jsxs("tr",{className:"border-b",children:[jsx_runtime.jsx("td",{className:"py-2",children:record.recordType}),jsx_runtime.jsx("td",{className:"py-2 max-w-[8rem]",children:jsx_runtime.jsxs("div",{className:"flex items-center gap-1 text-wrap break-all justify-between",children:[jsx_runtime.jsx("span",{children:record.recordHostname}),jsx_runtime.jsx(src.Jp,{size:"small",icon:jsx_runtime.jsx(posthog_icons_es.IconCopy,{}),onClick:()=>{navigator.clipboard.writeText(record.recordHostname),src.UJ.success("Hostname copied to clipboard")},tooltip:"Copy hostname"})]})}),jsx_runtime.jsx("td",{className:"py-2 max-w-[8rem]",children:jsx_runtime.jsxs("div",{className:"flex items-center gap-1 text-wrap break-all justify-between",children:[jsx_runtime.jsx("span",{children:record.recordValue}),jsx_runtime.jsx(src.Jp,{size:"small",icon:jsx_runtime.jsx(posthog_icons_es.IconCopy,{}),onClick:()=>{navigator.clipboard.writeText(record.recordValue),src.UJ.success("Value copied to clipboard")},tooltip:"Copy value"})]})}),jsx_runtime.jsx("td",{className:"py-2 w-[10rem]",children:verificationLoading?jsx_runtime.jsx(src.$j,{className:"text-lg"}):"pending"===record.status?jsx_runtime.jsxs("div",{className:"flex items-center gap-1",children:[jsx_runtime.jsx(posthog_icons_es.IconWarning,{className:"size-6 text-warning"})," Not present"]}):jsx_runtime.jsxs("div",{className:"flex items-center gap-1",children:[jsx_runtime.jsx(posthog_icons_es.IconCheckCircle,{className:"size-6 text-success"})," Verified"]})})]},index))})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:verifyDomain,disabledReason:verificationLoading?"Verifying...":void 0,loading:verificationLoading,children:"Verify DNS records"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>props.onComplete(integration.id),tooltip:"You will not be able to send emails until you verify the DNS records",children:"Finish later"})]})]}):(0,jsx_runtime.jsx)(lib.Form,{logic:emailSetupModalLogic,formKey:"emailSender",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"domain",label:"Domain",children:(0,jsx_runtime.jsx)(src.DF,{type:"text",placeholder:"example.com",disabled:integrationLoading})}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(src.Jp,{type:"primary",htmlType:"submit",disabledReason:integrationLoading?"Creating sender domain...":void 0,loading:integrationLoading,onClick:submitEmailSender,children:"Continue"})})]})}),(0,jsx_runtime.jsx)(src.fQ,{title:"Configure email sender domain",width:"auto",onClose:props.onComplete,children:modalContent})};var MessagingTabs=__webpack_require__("../../products/messaging/frontend/MessagingTabs.tsx"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts");let messageSendersLogic=(0,index_esm.kea)([(0,index_esm.path)(["products","messaging","frontend","messageSendersLogic"]),(0,index_esm.connect)(()=>({values:[integrationsLogic.a,["integrations","integrationsLoading"]],actions:[integrationsLogic.a,["deleteIntegration"]]})),(0,index_esm.actions)({openNewSenderModal:integration=>({integration}),closeNewSenderModal:()=>null}),(0,index_esm.reducers)(()=>({isNewSenderModalOpen:[!1,{openNewSenderModal:()=>!0,closeNewSenderModal:()=>!1}],selectedIntegration:[null,{openNewSenderModal:(_,_ref)=>{let{integration}=_ref;return integration||null},closeNewSenderModal:()=>null}]})),(0,index_esm.selectors)({breadcrumbs:[()=>[],()=>[{key:sceneTypes.x.MessagingLibrary,name:"Messaging",path:urls.j.messagingLibrary()},{key:"senders",name:"Senders",path:urls.j.messagingSenders()}]]})]);function MessageSender(_ref){let{integration}=_ref,{openNewSenderModal,deleteIntegration}=(0,index_esm.useActions)(messageSendersLogic),onDeleteClick=integration=>{src.dn.open({title:"Do you want to disconnect this domain?",description:"This cannot be undone. Campaigns and broadcasts configured to use this sender domain will remain but will stop working.",primaryButton:{children:"Yes, disconnect",status:"danger",onClick:()=>deleteIntegration(integration.id)},secondaryButton:{children:"No thanks"}})};return(0,jsx_runtime.jsx)("div",{className:"rounded border bg-surface-primary",children:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center p-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-4 ml-2",children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("strong",{children:integration.config.domain||integration.display_name}),void 0!==integration.config.mailjet_verified&&(0,jsx_runtime.jsx)(src.u,{title:integration.config.mailjet_verified?"This domain is ready to use":"You cannot send emails from this domain until it has been verified",children:(0,jsx_runtime.jsx)(src.oe,{type:integration.config.mailjet_verified?"success":"warning",children:integration.config.mailjet_verified?"Verified":"Unverified"})})]}),integration.created_by?(0,jsx_runtime.jsx)(UserActivityIndicator.F,{at:integration.created_at,by:integration.created_by,prefix:"Created",className:"text-secondary"}):null]})}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[!integration.config.mailjet_verified&&(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{openNewSenderModal(integration)},icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{}),children:"Verify domain"}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",status:"danger",onClick:()=>onDeleteClick(integration),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),children:"Remove"})]})]})})}let scene={component:function MessageSenders(){var _integrations$filter;let{isNewSenderModalOpen,selectedIntegration,integrations,integrationsLoading}=(0,index_esm.useValues)(messageSendersLogic),{openNewSenderModal,closeNewSenderModal}=(0,index_esm.useActions)(messageSendersLogic),emailIntegrations=null!==(_integrations$filter=integrations?.filter(integration=>"email"===integration.kind))&&void 0!==_integrations$filter?_integrations$filter:[];return(0,jsx_runtime.jsxs)("div",{className:"messaging-senders",children:[(0,jsx_runtime.jsx)(MessagingTabs.J,{},"senders-tabs"),(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Manage email sending domains",buttons:(0,jsx_runtime.jsx)(src.Jp,{"data-attr":"new-message-button",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),size:"small",type:"primary",onClick:()=>openNewSenderModal(),children:"New sender"})}),isNewSenderModalOpen&&(0,jsx_runtime.jsx)(EmailSetupModal,{integration:selectedIntegration,onComplete:()=>{closeNewSenderModal()}}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[integrationsLoading&&(0,jsx_runtime.jsx)(src.yW,{className:"h-10"}),!integrationsLoading&&(emailIntegrations?.length?emailIntegrations.map(integration=>(0,jsx_runtime.jsx)(MessageSender,{integration:integration},integration.id)):(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Email sender",thingName:"sender domain",description:"Configure domains to send emails from. This ensures your emails are delivered to inboxes and not marked as spam.",docsURL:"https://posthog.com/docs/messaging",action:()=>openNewSenderModal(),isEmpty:!0}))]})})]})},logic:messageSendersLogic}}}]);