(window.webpackJsonp=window.webpackJsonp||[]).push([[262],{"./frontend/src/scenes/instance/DeadLetterQueue/DeadLetterQueue.tsx":function(se,M,r){"use strict";r.r(M),r.d(M,"scene",function(){return ee}),r.d(M,"DeadLetterQueue",function(){return D});var I=r("./node_modules/react/index.js"),s=r.n(I),h=r("./frontend/src/lib/components/PageHeader.tsx"),L=r("./node_modules/antd/es/tabs/index.js"),i=r("./node_modules/kea/lib/index.esm.js"),ae=r("./node_modules/core-js/modules/es.object.keys.js"),oe=r("./node_modules/core-js/modules/es.symbol.js"),le=r("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),ue=r("./node_modules/core-js/modules/web.dom-collections.for-each.js"),ce=r("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),de=r("./node_modules/core-js/modules/es.array.slice.js"),ie=r("./node_modules/core-js/modules/es.function.name.js"),me=r("./node_modules/core-js/modules/es.array.from.js"),fe=r("./node_modules/core-js/modules/es.string.iterator.js"),ve=r("./node_modules/core-js/modules/es.regexp.exec.js"),ye=r("./node_modules/core-js/modules/es.symbol.description.js"),je=r("./node_modules/core-js/modules/es.symbol.iterator.js"),V=r("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),O=r.n(V),C=r("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),E=r.n(C),$=r("./node_modules/@babel/runtime/helpers/defineProperty.js"),T=r.n($),K=r("./node_modules/@babel/runtime/regenerator/index.js"),b=r.n(K),be=r("./node_modules/core-js/modules/es.array.concat.js"),ge=r("./node_modules/core-js/modules/es.array.iterator.js"),Me=r("./node_modules/core-js/modules/es.object.to-string.js"),pe=r("./node_modules/core-js/modules/web.dom-collections.iterator.js"),he=r("./node_modules/core-js/modules/es.array.filter.js"),A=r("./frontend/src/lib/api.ts"),p=r("./frontend/src/scenes/userLogic.ts"),F=r("./node_modules/kea-loaders/lib/index.js");function G(e,n){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=H(e))||n&&e&&typeof e.length=="number"){t&&(e=t);var a=0,l=function(){};return{s:l,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(m){throw m},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,f=!1,u;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){f=!0,u=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(f)throw u}}}}function H(e,n){if(!!e){if(typeof e=="string")return Q(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Q(e,n)}}function Q(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}function P(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),t.push.apply(t,a)}return t}function S(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?P(Object(t),!0).forEach(function(a){T()(e,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})}return e}var y;(function(e){e.Metrics="metrics",e.Management="management",e.Settings="settings"})(y||(y={}));var j=Object(i.kea)([Object(i.path)(["scenes","instance","DeadLetterQueue","deadLetterQueueLogic"]),Object(i.actions)({setActiveTab:function(n){return{tabKey:n}},loadMoreRows:function(n){return{key:n}},addRowsToMetric:function(n,t){return{key:n,rows:t}}}),Object(i.reducers)({activeTab:[y.Metrics,{setActiveTab:function(n,t){var a=t.tabKey;return a}}],rowsPerMetric:[{},{addRowsToMetric:function(n,t){var a=t.key,l=t.rows;return S(S({},n),{},T()({},a,[].concat(E()(n[a]||[]),E()(l))))},loadDeadLetterQueueMetricsSuccess:function(n,t){var a=t.deadLetterQueueMetrics,l={},o=G(a),f;try{for(o.s();!(f=o.n()).done;){var u=f.value;u.subrows&&(l[u.key]=u.subrows.rows)}}catch(c){o.e(c)}finally{o.f()}return l}}]}),Object(F.loaders)({deadLetterQueueMetrics:[[],{loadDeadLetterQueueMetrics:function(){var e=O()(b.a.mark(function t(){var a;return b.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if((a=p.a.values.user)!==null&&a!==void 0&&a.is_staff){o.next=2;break}return o.abrupt("return",[]);case 2:return o.next=4,A.b.get("api/dead_letter_queue");case 4:return o.abrupt("return",o.sent.results);case 5:case"end":return o.stop()}},t)}));function n(){return e.apply(this,arguments)}return n}()}]}),Object(i.listeners)(function(e){var n=e.values,t=e.actions;return{loadMoreRows:function(){var a=O()(b.a.mark(function o(f){var u,c,m,d;return b.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(c=f.key,m=((u=n.rowsPerMetric[c])===null||u===void 0?void 0:u.length)+1,!m){v.next=7;break}return v.next=5,A.b.get("api/dead_letter_queue/".concat(c,"?offset=").concat(m));case 5:d=v.sent,t.addRowsToMetric(c,d.subrows.rows);case 7:case"end":return v.stop()}},o)}));function l(o){return a.apply(this,arguments)}return l}()}}),Object(i.selectors)({singleValueMetrics:[function(e){return[e.deadLetterQueueMetrics]},function(e){return e.filter(function(n){return!n.subrows})}],tableMetrics:[function(e){return[e.deadLetterQueueMetrics]},function(e){return e.filter(function(n){return!!n.subrows})}]}),Object(i.afterMount)(function(e){var n=e.actions;n.loadDeadLetterQueueMetrics()})]),z=r("./node_modules/@babel/runtime/helpers/slicedToArray.js"),B=r.n(z),Le=r("./node_modules/core-js/modules/es.array.map.js"),J=r("./node_modules/antd/es/row/index.js"),U=r("./node_modules/antd/es/col/index.js"),N=r("./node_modules/antd/es/statistic/index.js"),x=r("./node_modules/antd/es/divider/index.js"),W=r("./node_modules/antd/es/button/index.js"),X=r("./frontend/src/lib/components/LemonTable/index.ts"),Y=r("./frontend/src/lib/components/LemonButton/index.ts"),Z=r("./frontend/src/lib/components/Spinner/Spinner.tsx"),k=r("./frontend/src/lib/components/icons.tsx"),q=10;function _(){var e=Object(i.useValues)(p.a),n=e.user,t=Object(i.useValues)(j),a=t.singleValueMetrics,l=t.tableMetrics,o=t.deadLetterQueueMetricsLoading,f=t.rowsPerMetric,u=Object(i.useActions)(j),c=u.loadDeadLetterQueueMetrics,m=u.loadMoreRows;return n!=null&&n.is_staff?s.a.createElement("div",null,s.a.createElement("br",null),s.a.createElement("div",{className:"mb float-right"},s.a.createElement(Y.a,{icon:o?s.a.createElement(Z.a,{size:"sm"}):s.a.createElement(k.IconRefresh,null),onClick:c,type:"secondary",size:"small"},"Refresh")),s.a.createElement(J.a,{gutter:32},a.map(function(d){return s.a.createElement(U.a,{key:d.key},s.a.createElement(N.a,{title:d.metric,value:(d.value||"0").toLocaleString("en-US"),loading:o}))})),s.a.createElement(x.a,null),l.map(function(d){var g,v;return s.a.createElement("div",{key:d.key},s.a.createElement("h2",null,d.metric),s.a.createElement(X.a,{columns:[{title:(g=d.subrows)===null||g===void 0?void 0:g.columns[0],dataIndex:"key"},{title:(v=d.subrows)===null||v===void 0?void 0:v.columns[1],dataIndex:"value"}],dataSource:f[d.key].map(function(R){var w=B()(R,2),re=w[0],ne=w[1];return{key:re,value:ne}})||[],loading:o,defaultSorting:{columnKey:"value",order:-1},embedded:!0}),s.a.createElement("div",{style:{margin:"1rem",textAlign:"center"}},s.a.createElement(W.a,{disabled:f[d.key].length%q!==0,onClick:function(){return m(d.key)}},"Load more values")),s.a.createElement(x.a,null))})):s.a.createElement(s.a.Fragment,null)}var ee={component:D,logic:j},te=L.a.TabPane;function D(){var e=Object(i.useValues)(p.a),n=e.user,t=Object(i.useValues)(j),a=t.activeTab,l=Object(i.useActions)(j),o=l.setActiveTab;return n!=null&&n.is_staff?s.a.createElement("div",null,s.a.createElement(h.a,{title:"Dead Letter Queue",caption:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Manage your instance's dead letter queue."))}),s.a.createElement(L.a,{activeKey:a,onChange:function(u){return o(u)}},s.a.createElement(te,{tab:"Metrics",key:y.Metrics})),a===y.Metrics?s.a.createElement(_,null):null):s.a.createElement(h.a,{title:"Dead Letter Queue",caption:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"Only users with staff access can manage the dead letter queue. Please contact your instance admin."),s.a.createElement("p",null,"If you're an admin and don't have access, set ",s.a.createElement("code",null,"is_staff=true")," for your user on the PostgreSQL ",s.a.createElement("code",null,"posthog_user")," table."))})}}}]);
