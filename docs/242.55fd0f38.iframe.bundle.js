(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{"./frontend/src/scenes/instance/SystemStatus/index.tsx":function(A,j,n){"use strict";n.r(j),n.d(j,"scene",function(){return lt}),n.d(j,"SystemStatus",function(){return he});var x=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),ee=n.n(x),Ee=n("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss"),te=n.n(Ee),D={};D.insert="head",D.singleton=!1;var it=ee()(te.a,D),ut=te.a.locals||{},P=n("./node_modules/react/index.js"),e=n.n(P),ne=n("./node_modules/antd/es/alert/index.js"),T=n("./node_modules/antd/es/tabs/index.js"),g=n("./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),p=n("./node_modules/kea/lib/index.esm.js"),Se=n("./frontend/src/lib/components/PageHeader.tsx"),ae=n("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),C=n("./frontend/src/lib/components/icons.tsx"),ct=n("./node_modules/core-js/modules/es.array.map.js"),se=n("./frontend/src/lib/components/Link.tsx"),dt=n("./node_modules/core-js/modules/es.array.iterator.js"),mt=n("./node_modules/core-js/modules/es.object.to-string.js"),ft=n("./node_modules/core-js/modules/es.set.js"),vt=n("./node_modules/core-js/modules/es.string.iterator.js"),yt=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),gt=n("./node_modules/core-js/modules/es.regexp.to-string.js"),I=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Y=n("./frontend/src/lib/utils.tsx"),je=new Set(["last_event_ingested_timestamp"]);function R(t,r){var s=r.key,a=r.value,l=r.value_type,i=r.emptyNullLabel,u=r.isSecret;return a&&u?e.a.createElement(I.a,{style:{color:"var(--muted)",backgroundColor:"#fee5b3"},icon:u?e.a.createElement(C.IconLock,{style:{color:"var(--warning)"}}):void 0},"Secret"):s&&je.has(s)&&typeof a=="string"?new Date(a).getTime()===new Date("1970-01-01T00:00:00").getTime()?"Never":Object(Y.M)(a):l==="bool"||typeof a=="boolean"?e.a.createElement(I.a,{type:a?"success":"danger"},a?"Yes":"No"):a==null||a===""?e.a.createElement(I.a,{style:{color:"var(--muted)"}},i!=null?i:"Unknown"):l==="int"||typeof a=="number"?a.toLocaleString("en-US"):a.toString()}var L=n("./frontend/@posthog/lemon-ui/src/index.ts"),re={async_migrations_ok:"/instance/async_migrations"};function Oe(t,r){return e.a.createElement("span",null,r.metric," ",re[r.key]?e.a.createElement(se.a,{to:re[r.key]},e.a.createElement(C.IconOpenInNew,{style:{verticalAlign:"middle"}})):null)}function Ce(){var t=Object(p.useValues)(g.b),r=t.overview,s=t.systemStatusLoading;return e.a.createElement(L.LemonTable,{className:"system-status-table",rowKey:"metric",dataSource:r,columns:[{title:"Metric",className:"metric-column",render:Oe},{title:"Value",render:R}],loading:s,expandable:{expandedRowRender:function(l){var i;return(i=l.subrows)!==null&&i!==void 0&&i.rows.length?e.a.createElement(Ie,l.subrows):null},rowExpandable:function(l){var i;return!!((i=l.subrows)!==null&&i!==void 0&&i.rows.length)}}})}function Ie(t){return console.log(t),e.a.createElement(L.LemonTable,{dataSource:t.rows,columns:t.columns.map(function(r,s){return{title:r,dataIndex:s}}),embedded:!0})}var ke=n("./node_modules/@babel/runtime/helpers/objectDestructuringEmpty.js"),Ae=n.n(ke),Te=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),$=n.n(Te),pt=n("./node_modules/core-js/modules/es.array.filter.js"),ht=n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),bt=n("./node_modules/core-js/modules/es.object.keys.js"),V=n("./node_modules/antd/es/collapse/index.js"),oe=n("./node_modules/antd/es/checkbox/index.js"),k=n("./node_modules/antd/es/button/index.js"),Le=n("./node_modules/antd/es/table/index.js"),W=n("./node_modules/@ant-design/icons/es/icons/ReloadOutlined.js"),Ue=n("./frontend/src/scenes/dashboard/Dashboard.tsx"),xe=n("./frontend/src/types.ts"),Et=n("./node_modules/core-js/modules/es.object.entries.js");function Ve(){var t=Object(p.useValues)(g.b),r=t.analyzeModalOpen,s=t.analyzeQuery,a=t.analyzeQueryResult,l=t.analyzeQueryResultLoading,i=Object(p.useActions)(g.b),u=i.setAnalyzeModalOpen,d=i.setAnalyzeQuery,c=i.runAnalyzeQuery;return e.a.createElement(L.LemonModal,{isOpen:r,title:"Analyze ClickHouse query performance",footer:e.a.createElement(e.a.Fragment,null,e.a.createElement(L.LemonButton,{type:"secondary",onClick:function(){return u(!1)}},"Cancel"),e.a.createElement(L.LemonButton,{type:"primary",onClick:function(){return void c()},disabled:l},"Analyze")),onClose:function(){return u(!1)},width:"80%"},e.a.createElement(L.LemonTextArea,{placeholder:"SQL query to analyze",onChange:d,value:s,rows:10}),a&&e.a.createElement("div",{className:"mt-2"},e.a.createElement("h2",null,"Analysis results"),e.a.createElement("ul",null,Object.entries(a.timing).map(function(o){var m=$()(o,2),v=m[0],f=m[1];return e.a.createElement("li",{key:v},v,": ",f)})),Object.entries(a.flamegraphs).map(function(o){var m=$()(o,2),v=m[0],f=m[1];return e.a.createElement("div",{key:v},e.a.createElement("h3",null,"Flamegraph: ",v),e.a.createElement("a",{className:"embedded-svg-wrapper",href:"data:image/svg+xml;utf8,".concat(encodeURIComponent(f)),dangerouslySetInnerHTML:{__html:f}}))})))}function Me(){var t=Object(p.useValues)(g.b),r=t.openSections,s=t.systemStatus,a=t.queries,l=t.queriesLoading,i=t.showAnalyzeQueryButton,u=Object(p.useActions)(g.b),d=u.setOpenSections,c=u.loadQueries,o=Object(P.useState)(!1),m=$()(o,2),v=m[0],f=m[1],b=Object(P.useMemo)(function(){var S;return a==null||(S=a.postgres_running)===null||S===void 0?void 0:S.filter(function(h){var N=h.state;return v||N!=="idle"})},[v,a]),y=s==null?void 0:s.internal_metrics.clickhouse,E=function(h){h.stopPropagation(),c()};return e.a.createElement(e.a.Fragment,null,e.a.createElement(V.a,{activeKey:r,onChange:function(h){return d(h)}},y?e.a.createElement(V.a.Panel,{header:"Dashboards",key:"0"},e.a.createElement(Ue.Dashboard,{id:y.id.toString(),dashboard:y,placement:xe.m.InternalMetrics})):null,e.a.createElement(V.a.Panel,{header:"PostgreSQL - currently running queries",key:"1"},e.a.createElement("div",{className:"mb-4 float-right"},e.a.createElement(oe.a,{checked:v,onChange:function(h){f(h.target.checked)}},"Show idle queries"),e.a.createElement(k.a,{style:{marginLeft:8},onClick:E},e.a.createElement(W.a,null)," Reload Queries")),e.a.createElement(G,{queries:b,loading:l})),(a==null?void 0:a.clickhouse_running)!=null?e.a.createElement(V.a.Panel,{header:"Clickhouse - currently running queries",key:"2"},e.a.createElement("div",{className:"mb-4 float-right"},e.a.createElement(k.a,{style:{marginLeft:8},onClick:E},e.a.createElement(W.a,null)," Reload Queries")),e.a.createElement(G,{queries:a==null?void 0:a.clickhouse_running,loading:l,showAnalyze:i})):null,(a==null?void 0:a.clickhouse_slow_log)!=null?e.a.createElement(V.a.Panel,{header:"Clickhouse - slow query log (past 6 hours)",key:"3"},e.a.createElement("div",{className:"mb-4 float-right"},e.a.createElement(k.a,{style:{marginLeft:8},onClick:E},e.a.createElement(W.a,null)," Reload Queries")),e.a.createElement(G,{queries:a==null?void 0:a.clickhouse_slow_log,loading:l,showAnalyze:i})):null),e.a.createElement(Ve,null))}function G(t){var r=Object(p.useActions)(g.b),s=r.openAnalyzeModalWithQuery,a=[{title:"duration",dataIndex:"duration",key:"duration",sorter:function(i,u){return+i.duration-+u.duration}},{title:"query",dataIndex:"query",render:function(i,u){return Ae()(i),t.showAnalyze?e.a.createElement(se.a,{to:"#",onClick:function(){return s(u.query)}},u.query):u.query},key:"query"}];return t.queries&&t.queries.length>0&&Object.keys(t.queries[0]).forEach(function(l){l!=="duration"&&l!=="query"&&a.push({title:l,dataIndex:l,key:l})}),e.a.createElement(Le.a,{dataSource:t.queries||[],columns:a,loading:t.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",bordered:!0,style:{overflowX:"auto",overflowY:"auto"},locale:{emptyText:"No queries found"}})}var St=n("./node_modules/core-js/modules/es.symbol.js"),jt=n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Ot=n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),Be=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),Ne=n.n(Be),Pe=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),Re=n.n(Pe),we=n("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/lib/components/HotkeyButton/HotkeyButton.scss"),le=n.n(we),J={};J.insert="head",J.singleton=!1;var Ct=ee()(le.a,J),It=le.a.locals||{},Ke=["hotkey","children"];function w(t){var r=t.hotkey,s=t.children,a=Re()(t,Ke);return e.a.createElement("span",{className:"hotkey-button"},e.a.createElement(k.a,a,s," ",e.a.createElement("span",{className:"hotkey"},r)))}try{w.displayName="HotkeyButton",w.__docgenInfo={description:"",displayName:"HotkeyButton",props:{hotkey:{defaultValue:null,description:"",name:"hotkey",required:!0,type:{name:"enum",value:[{value:'"d"'},{value:'"k"'},{value:'"r"'},{value:'"x"'},{value:'"y"'},{value:'"z"'},{value:'"h"'},{value:'"m"'},{value:'"s"'},{value:'"w"'},{value:'"a"'},{value:'"b"'},{value:'"i"'},{value:'"p"'},{value:'"q"'},{value:'"u"'},{value:'"c"'},{value:'"e"'},{value:'"f"'},{value:'"j"'},{value:'"l"'},{value:'"n"'},{value:'"o"'},{value:'"t"'},{value:'"v"'},{value:'"escape"'},{value:'"enter"'}]}},href:{defaultValue:null,description:"",name:"href",required:!1,type:{name:"string"}},target:{defaultValue:null,description:"",name:"target",required:!1,type:{name:"string"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"MouseEventHandler<HTMLElement>"}},htmlType:{defaultValue:null,description:"",name:"htmlType",required:!1,type:{name:"enum",value:[{value:'"button"'},{value:'"reset"'},{value:'"submit"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/HotkeyButton/HotkeyButton.tsx#HotkeyButton"]={docgenInfo:w.__docgenInfo,name:"HotkeyButton",path:"frontend/src/lib/components/HotkeyButton/HotkeyButton.tsx#HotkeyButton"})}catch(t){}var X=n("./frontend/src/lib/components/LemonTable/index.ts"),He=n("./frontend/src/lib/hooks/useKeyboardHotkeys.tsx"),ze=n("./node_modules/antd/es/input/index.js");function K(t){var r=t.key,s=t.value,a=t.value_type,l=t.onValueChanged,i=t.isSecret;if(a==="bool")return e.a.createElement(e.a.Fragment,null,e.a.createElement(oe.a,{defaultChecked:!!s,onChange:function(c){return l(r,c.target.checked)}}),e.a.createElement(I.a,{style:{marginLeft:4},type:s?"success":"danger"},s?"Yes":"No"));var u=i&&s?"":s;return e.a.createElement(ze.a,{defaultValue:u,type:a==="int"?"number":"text",placeholder:i&&s?"Keep existing secret value":void 0,onBlur:function(c){return l(r,c.target.value)}})}try{K.displayName="RenderMetricValueEdit",K.__docgenInfo={description:"",displayName:"RenderMetricValueEdit",props:{onValueChanged:{defaultValue:null,description:"",name:"onValueChanged",required:!0,type:{name:"(key: string, value: any) => void"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string | number | boolean | null"}},value_type:{defaultValue:null,description:"",name:"value_type",required:!1,type:{name:"enum",value:[{value:'"bool"'},{value:'"str"'},{value:'"int"'}]}},emptyNullLabel:{defaultValue:null,description:"",name:"emptyNullLabel",required:!1,type:{name:"string"}},isSecret:{defaultValue:null,description:"",name:"isSecret",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"]={docgenInfo:K.__docgenInfo,name:"RenderMetricValueEdit",path:"frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"})}catch(t){}var Fe=n("./node_modules/@ant-design/icons/es/icons/WarningOutlined.js"),kt=n("./node_modules/core-js/modules/es.array.find.js"),At=n("./node_modules/core-js/modules/es.string.starts-with.js"),Tt=n("./node_modules/core-js/modules/es.array.includes.js"),Lt=n("./node_modules/core-js/modules/es.string.includes.js"),ie=n("./node_modules/antd/es/modal/index.js"),ue=n("./frontend/src/lib/components/AlertMessage/index.ts");function Qe(t){var r=t.metricKey,s=t.oldValue,a=t.value,l=t.isSecret;return(a==null?void 0:a.toString())===(s==null?void 0:s.toString())?null:e.a.createElement("div",{style:{backgroundColor:"var(--border-light)",borderRadius:"var(--radius)",padding:8,marginTop:16}},e.a.createElement("div",null,e.a.createElement("code",null,r)),e.a.createElement("div",{style:{color:"var(--muted)"}},"Value will be changed",!l&&e.a.createElement(e.a.Fragment,null," from ",e.a.createElement("span",{style:{color:"var(--default)",fontWeight:"bold"}},R(null,{key:r,value:s,emptyNullLabel:"Unset",isSecret:l})))," to ",e.a.createElement("span",{style:{color:"var(--default)",fontWeight:"bold"}},R(null,{key:r,value:a,emptyNullLabel:"Unset"})),l&&e.a.createElement("div",{className:"text-danger"},"This field is secret \u2013 you won't see its value once saved")))}function H(t){var r=t.onClose,s=Object(p.useValues)(g.b),a=s.instanceConfigEditingState,l=s.editableInstanceSettings,i=s.updatedInstanceConfigCount,u=Object(p.useActions)(g.b),d=u.saveInstanceConfig,c=i!==null;return e.a.createElement(ie.a,{title:"Confirm new changes",visible:!0,okText:"Apply changes",okType:"danger",onCancel:r,maskClosable:!1,onOk:d,okButtonProps:{loading:c},cancelButtonProps:{loading:c},closable:!c},Object.keys(a).find(function(o){return o.startsWith("EMAIL")})&&e.a.createElement(ue.a,{type:"info"},e.a.createElement(e.a.Fragment,null,"As you are changing email settings, we'll attempt to send a ",e.a.createElement("b",null,"test email")," so you can verify everything works (unless you are turning email off).")),Object.keys(a).includes("RECORDINGS_TTL_WEEKS")&&e.a.createElement(ue.a,{type:"warning"},e.a.createElement(e.a.Fragment,null,"Changing your recordings TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately.")),e.a.createElement("div",null,"The following changes will be immediately applied to your instance."),Object.keys(a).map(function(o){var m,v;return e.a.createElement(Qe,{key:o,metricKey:o,value:a[o],oldValue:(m=l.find(function(f){return f.key===o}))===null||m===void 0?void 0:m.value,isSecret:(v=l.find(function(f){return f.key===o}))===null||v===void 0?void 0:v.is_secret})}),c&&e.a.createElement("div",{className:"mt-4 text-success"},e.a.createElement("b",null,Object(Y.rb)(i||0,"change")," updated successfully.")))}try{H.displayName="InstanceConfigSaveModal",H.__docgenInfo={description:"",displayName:"InstanceConfigSaveModal",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"]={docgenInfo:H.__docgenInfo,name:"InstanceConfigSaveModal",path:"frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"})}catch(t){}function ce(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),s.push.apply(s,a)}return s}function de(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?ce(Object(s),!0).forEach(function(a){Ne()(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ce(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function De(){var t=Object(p.useValues)(ae.a),r=t.configOptions,s=t.preflightLoading,a=Object(p.useValues)(g.b),l=a.editableInstanceSettings,i=a.instanceSettingsLoading,u=a.instanceConfigMode,d=a.instanceConfigEditingState,c=Object(p.useActions)(g.b),o=c.loadInstanceSettings,m=c.setInstanceConfigMode,v=c.updateInstanceConfigValue,f=c.clearInstanceConfigEditing;Object(He.a)({e:{action:function(){return m(g.a.Edit)},disabled:u!==g.a.View||i},escape:{action:function(){return y()},disabled:u!==g.a.Edit||i},enter:{action:function(){return b()},disabled:u!==g.a.Edit||i}});var b=function(){Object.keys(d).length?m(g.a.Saving):m(g.a.View)},y=function(){m(g.a.View),f()};Object(P.useEffect)(function(){o()},[]);var E=[{title:"Key",dataIndex:"key",render:function(N){return e.a.createElement("code",null,N)}},{title:"Description",dataIndex:"description"},{title:"Value",render:function(N,U){var _,be={value:U.value,key:U.key,emptyNullLabel:"Unset",value_type:U.value_type,isSecret:U.is_secret};return u===g.a.View?R(N,be):K(de(de({},be),{},{value:(_=d[U.key])!==null&&_!==void 0?_:U.value,onValueChanged:v}))},width:64}],S=[{key:"metric",title:"Metric",dataIndex:"metric"},{title:"Value",dataIndex:"value"}];return e.a.createElement("div",null,e.a.createElement("div",{className:"flex items-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("h3",{className:"l3",style:{marginTop:16}},"Instance configuration"),e.a.createElement("div",{className:"mb-4"},"Changing these settings will take effect on your entire instance."," ",e.a.createElement("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings",target:"_blank"},"Learn more ",e.a.createElement(C.IconOpenInNew,{style:{verticalAlign:"middle"}})),".")),u===g.a.View?e.a.createElement(e.a.Fragment,null,e.a.createElement(w,{type:"primary",onClick:function(){return m(g.a.Edit)},"data-attr":"instance-config-edit-button",hotkey:"e",disabled:i},"Edit")):e.a.createElement(e.a.Fragment,null,Object.keys(d).length>0&&e.a.createElement("span",{style:{color:"var(--warning)"}},e.a.createElement(Fe.a,null)," You have ",e.a.createElement("b",null,Object.keys(d).length)," ","unapplied"," ",Object(Y.rb)(Object.keys(d).length,"change",void 0,!1)),e.a.createElement(k.a,{type:"link",disabled:i,onClick:y},"Discard changes"),e.a.createElement(k.a,{type:"primary",disabled:i,onClick:b},"Save"))),e.a.createElement(X.a,{dataSource:l,columns:E,loading:i,rowKey:"key"}),e.a.createElement("h3",{className:"l3",style:{marginTop:32}},"Environment configuration"),e.a.createElement("div",{className:"mb-4"},"These settings can only be modified by environment variables."," ",e.a.createElement("a",{href:"https://posthog.com/docs/self-host/configure/environment-variables",target:"_blank"},"Learn more ",e.a.createElement(C.IconOpenInNew,{style:{verticalAlign:"middle"}})),"."),e.a.createElement(X.a,{dataSource:r,columns:S,loading:s,rowKey:"key"}),u===g.a.Saving&&e.a.createElement(H,{onClose:function(){return m(g.a.Edit)}}))}var z=n("./frontend/src/scenes/userLogic.ts"),me=n("./node_modules/antd/es/divider/index.js"),Ye=n("./frontend/src/lib/components/ProfilePicture/index.ts"),$e=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Z=n.n($e),We=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),M=n.n(We),Ge=n("./node_modules/@babel/runtime/regenerator/index.js"),O=n.n(Ge),Ut=n("./node_modules/core-js/modules/es.promise.js"),xt=n("./node_modules/core-js/modules/es.array.concat.js"),Vt=n("./node_modules/core-js/modules/es.array.sort.js"),Mt=n("./node_modules/core-js/modules/es.array.slice.js"),Bt=n("./node_modules/core-js/modules/es.function.name.js"),Nt=n("./node_modules/core-js/modules/es.array.from.js"),Pt=n("./node_modules/core-js/modules/es.regexp.exec.js"),Rt=n("./node_modules/core-js/modules/es.symbol.description.js"),wt=n("./node_modules/core-js/modules/es.symbol.iterator.js"),Je=n("./node_modules/kea-router/lib/index.js"),F=n("./frontend/src/lib/api.ts"),Xe=n("./frontend/src/scenes/urls.ts");function Ze(t,r){var s=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=qe(t))||r&&t&&typeof t.length=="number"){s&&(t=s);var a=0,l=function(){};return{s:l,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(o){throw o},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,u=!1,d;return{s:function(){s=s.call(t)},n:function(){var o=s.next();return i=o.done,o},e:function(o){u=!0,d=o},f:function(){try{!i&&s.return!=null&&s.return()}finally{if(u)throw d}}}}function qe(t,r){if(!!t){if(typeof t=="string")return fe(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return fe(t,r)}}function fe(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,a=new Array(r);s<r;s++)a[s]=t[s];return a}var ve=Object(p.kea)({path:["scenes","instance","SystemStatus","staffUsersLogic"],connect:{values:[z.a,["user"]],actions:[z.a,["loadUser"]]},actions:{setStaffUsersToBeAdded:function(r){return{userUuids:r}},addStaffUsers:!0,deleteStaffUser:function(r){return{userUuid:r}}},reducers:{staffUsersToBeAdded:[[],{setStaffUsersToBeAdded:function(r,s){var a=s.userUuids;return a}}]},loaders:function(r){var s=r.actions,a=r.values;return{allUsers:[[],{loadAllUsers:function(){var l=M()(O.a.mark(function u(){var d;return O.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,F.b.get("api/users");case 2:if(o.t1=d=o.sent.results,o.t0=o.t1!==null,!o.t0){o.next=6;break}o.t0=d!==void 0;case 6:if(!o.t0){o.next=10;break}o.t2=d,o.next=11;break;case 10:o.t2=[];case 11:return o.abrupt("return",o.t2);case 12:case"end":return o.stop()}},u)}));function i(){return l.apply(this,arguments)}return i}(),addStaffUsers:function(){var l=M()(O.a.mark(function u(){var d,c,o,m;return O.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return d=a.staffUsersToBeAdded,c=a.allUsers,s.setStaffUsersToBeAdded([]),f.next=4,Promise.all(d.map(function(){var b=M()(O.a.mark(function y(E){return O.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,F.b.update("api/users/".concat(E),{is_staff:!0});case 2:return h.abrupt("return",h.sent);case 3:case"end":return h.stop()}},y)}));return function(y){return b.apply(this,arguments)}}()));case 4:return o=f.sent,m=[].concat(Z()(c.filter(function(b){var y=b.uuid;return!d.includes(y)})),Z()(o)),m.sort(function(b,y){return b.first_name.localeCompare(y.first_name)}),f.abrupt("return",m);case 8:case"end":return f.stop()}},u)}));function i(){return l.apply(this,arguments)}return i}(),deleteStaffUser:function(){var l=M()(O.a.mark(function u(d){var c,o,m,v,f,b;return O.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return o=d.userUuid,E.next=3,F.b.update("api/users/".concat(o),{is_staff:!1});case 3:((c=a.user)===null||c===void 0?void 0:c.uuid)===o&&(s.loadUser(),Je.router.actions.push(Xe.a.projectHomepage())),m=Z()(a.allUsers),v=Ze(m);try{for(v.s();!(f=v.n()).done;)b=f.value,b.uuid===o&&(b.is_staff=!1)}catch(S){v.e(S)}finally{v.f()}return E.abrupt("return",m);case 8:case"end":return E.stop()}},u)}));function i(u){return l.apply(this,arguments)}return i}()}]}},selectors:{staffUsers:[function(t){return[t.allUsers]},function(t){return t.filter(function(r){return r.is_staff})}],nonStaffUsers:[function(t){return[t.allUsers]},function(t){return t.filter(function(r){return!r.is_staff})}]},events:function(r){var s=r.actions;return{afterMount:[s.loadAllUsers]}}}),ye=n("./frontend/src/lib/components/LemonButton/index.ts"),_e=n("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),et=n("./frontend/src/lib/components/UserSelectItem.tsx");function tt(){var t=Object(p.useValues)(z.a),r=t.user,s=Object(p.useValues)(ve),a=s.staffUsers,l=s.allUsersLoading,i=s.nonStaffUsers,u=s.staffUsersToBeAdded,d=Object(p.useActions)(ve),c=d.setStaffUsersToBeAdded,o=d.addStaffUsers,m=d.deleteStaffUser,v=[{key:"profile_picture",render:function(b,y){return e.a.createElement(Ye.b,{name:y.first_name,email:y.email})},width:32},{key:"name",title:"Name",dataIndex:"first_name",render:function(b,y){return e.a.createElement(e.a.Fragment,null,y.first_name,y.uuid===(r==null?void 0:r.uuid)&&e.a.createElement(I.a,{style:{marginLeft:4}},"Me"))}},{key:"email",title:"Email",dataIndex:"email"},{key:"actions",width:32,render:function(b,y){return e.a.createElement(ye.a,{"data-attr":"invite-delete",icon:e.a.createElement(C.IconDelete,null),status:"danger",disabled:a.length<2,title:a.length<2?"You should always have at least one staff user.":"Cancel the invite",onClick:function(){ie.a.confirm({title:"Remove ".concat((r==null?void 0:r.uuid)===y.uuid?"yourself":y.first_name," as a Staff User?"),icon:null,okText:"Remove user",okType:"primary",okButtonProps:{className:"btn-danger"},content:e.a.createElement("div",{style:{border:""}},(r==null?void 0:r.uuid)===y.uuid?e.a.createElement(e.a.Fragment,null,"Please confirm you want to ",e.a.createElement("b",null,"remove yourself")," as a staff user.",e.a.createElement("div",{style:{fontWeight:"normal",color:"var(--muted-alt)"}},"Only another staff user will be able to add you again.")):"Are you sure you want to remove ".concat(y.first_name," as a Staff User?")),onOk:function(){m(y.uuid)},cancelText:"Cancel"})}})}}];return e.a.createElement("div",null,e.a.createElement("h3",{className:"l3",style:{marginTop:16}},"Staff Users"),e.a.createElement("div",{className:"mb-4"},"Users who have permissions to manage instance-wide settings. Staff user permissions are set at the"," ",e.a.createElement("b",null,"instance-level and are independent of any organization or project permissions.")," ",e.a.createElement("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings#staff-users",target:"_blank"},"Learn more ",e.a.createElement(C.IconOpenInNew,{style:{verticalAlign:"middle"}})),"."),e.a.createElement(me.a,{style:{margin:0,marginBottom:16}}),e.a.createElement("section",null,e.a.createElement("div",{className:"flex gap-2 mb-4"},e.a.createElement("div",{style:{flex:1}},e.a.createElement(_e.a,{placeholder:"Add staff users here\u2026",loading:l,value:u,onChange:function(b){return c(b)},filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:Object(et.a)(i,"uuid")})),e.a.createElement(ye.a,{type:"primary",loading:l,disabled:u.length===0,onClick:o},"Add"))),e.a.createElement(X.a,{dataSource:a,columns:v,loading:l,rowKey:"uuid"}))}var nt=n("./frontend/src/lib/logic/featureFlagLogic.ts"),at=n("./frontend/src/lib/constants.tsx"),st=n("./node_modules/antd/es/row/index.js"),Q=n("./node_modules/antd/es/col/index.js"),ge=n("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),Kt=n("./node_modules/core-js/modules/es.number.constructor.js"),B=n("./node_modules/kea-forms/lib/index.js"),rt=n("./node_modules/kea-loaders/lib/index.js"),pe=Object(p.kea)([Object(p.path)(["scenes","instance","SystemStatus","kafkaInspectorLogic"]),Object(p.actions)({fetchKafkaMessage:function(r,s,a){return{topic:r,partition:s,offset:a}}}),Object(rt.loaders)({kafkaMessage:[null,{fetchKafkaMessage:function(){var t=M()(O.a.mark(function s(a){var l,i,u;return O.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return l=a.topic,i=a.partition,u=a.offset,c.next=3,F.b.create("api/kafka_inspector/fetch_message",{topic:l,partition:i,offset:u});case 3:return c.abrupt("return",c.sent);case 4:case"end":return c.stop()}},s)}));function r(s){return t.apply(this,arguments)}return r}()}]}),Object(B.forms)(function(t){var r=t.actions;return{fetchKafkaMessage:{defaults:{topic:"clickhouse_events_json",partition:0,offset:0},submit:function(a){var l=a.topic,i=a.partition,u=a.offset;r.fetchKafkaMessage(l,Number(i),Number(u))}}}})]),q=n("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function ot(){var t=Object(p.useValues)(pe),r=t.kafkaMessage;return e.a.createElement("div",null,e.a.createElement("h3",{className:"l3",style:{marginTop:16}},"Kafka Inspector"),e.a.createElement("div",{className:"mb-4"},"Debug Kafka messages using the inspector tool."),e.a.createElement(me.a,{style:{margin:0,marginBottom:16}}),e.a.createElement("section",null,e.a.createElement("div",{style:{display:"flex",marginBottom:"0.75rem"}},e.a.createElement(B.Form,{logic:pe,formKey:"fetchKafkaMessage",className:"ant-form-horizontal ant-form-hide-required-mark",enableFormOnSubmit:!0},e.a.createElement(st.a,{gutter:[24,24]},e.a.createElement(Q.a,{span:8},e.a.createElement(B.Field,{name:"topic"},e.a.createElement(q.a,{placeholder:"Topic"}))),e.a.createElement(Q.a,{span:4},e.a.createElement(B.Field,{name:"partition"},e.a.createElement(q.a,{placeholder:"Partition",type:"number"}))," "),e.a.createElement(Q.a,{span:4},e.a.createElement(B.Field,{name:"offset"},e.a.createElement(q.a,{placeholder:"Offset",type:"number"}))," "),e.a.createElement(Q.a,{span:6},e.a.createElement(k.a,{htmlType:"submit",type:"primary","data-attr":"fetch-kafka-message-submit-button"},"Fetch message"," ")))))),e.a.createElement(ge.a,{language:ge.b.JSON},r?JSON.stringify(r,null,4):`
`))}var lt={component:he,logic:g.b};function he(){var t=Object(p.useValues)(g.b),r=t.tab,s=t.error,a=Object(p.useActions)(g.b),l=a.setTab,i=Object(p.useValues)(ae.a),u=i.preflight,d=i.siteUrlMisconfigured,c=Object(p.useValues)(z.a),o=c.user,m=Object(p.useValues)(nt.a),v=m.featureFlags;return e.a.createElement("div",{className:"system-status-scene"},e.a.createElement(Se.a,{title:"Instance status & settings",caption:e.a.createElement(e.a.Fragment,null,"Here you can find all the critical runtime details and settings of your PostHog instance. You have access to this because you're a ",e.a.createElement("b",null,"staff user"),"."," ",e.a.createElement("a",{target:"_blank",style:{display:"inline-flex",alignItems:"center"},href:"https://posthog.com/docs/self-host/configure/instance-settings?utm_medium=in-product&utm_campaign=instance_status"},"Learn more ",e.a.createElement(C.IconOpenInNew,{style:{marginLeft:4}})),".")}),s&&e.a.createElement(ne.a,{message:"Something went wrong",description:s||e.a.createElement("span",null,"An unknown error occurred. Please try again or contact us."),type:"error",showIcon:!0}),d&&e.a.createElement(ne.a,{message:"Misconfiguration detected",description:e.a.createElement(e.a.Fragment,null,"Your ",e.a.createElement("code",null,"SITE_URL")," environment variable seems misconfigured. Your"," ",e.a.createElement("code",null,"SITE_URL")," is set to"," ",e.a.createElement("b",null,e.a.createElement("code",null,u==null?void 0:u.site_url))," ","but you're currently browsing this page from"," ",e.a.createElement("b",null,e.a.createElement("code",null,window.location.origin)),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig"},"Learn more ",e.a.createElement(C.IconOpenInNew,null))),showIcon:!0,type:"warning",style:{marginBottom:32}}),e.a.createElement(T.a,{tabPosition:"top",animated:!1,activeKey:r,onTabClick:function(b){return l(b)}},e.a.createElement(T.a.TabPane,{tab:"System overview",key:"overview"},e.a.createElement(Ce,null)),(o==null?void 0:o.is_staff)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(T.a.TabPane,{tab:"Internal metrics",key:"metrics"},e.a.createElement(Me,null)),e.a.createElement(T.a.TabPane,{tab:e.a.createElement(e.a.Fragment,null,"Settings ",e.a.createElement(I.a,{type:"warning"},"Beta")),key:"settings"},e.a.createElement(De,null))),(o==null?void 0:o.is_staff)&&e.a.createElement(T.a.TabPane,{tab:e.a.createElement(e.a.Fragment,null,"Staff Users"),key:"staff_users"},e.a.createElement(tt,null)),(o==null?void 0:o.is_staff)&&v[at.h.KAFKA_INSPECTOR]&&e.a.createElement(T.a.TabPane,{tab:e.a.createElement(e.a.Fragment,null,"Kafka Inspector ",e.a.createElement(I.a,{type:"warning"},"Beta")),key:"kafka_inspector"},e.a.createElement(ot,null))))}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/lib/components/HotkeyButton/HotkeyButton.scss":function(A,j,n){var x=n("./node_modules/css-loader/dist/runtime/api.js");j=x(!1),j.push([A.i,".hotkey{width:22px;height:22px;border-radius:var(--radius);font-weight:700;margin-left:6px;background-color:#fff;color:var(--primary);text-shadow:none;text-transform:uppercase;border:1px solid var(--border-light);margin-bottom:2px;font-size:.85rem;display:inline-flex;align-items:center;justify-content:center}.hotkey-button .ant-btn-primary .hotkey{border:0}",""]),A.exports=j},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss":function(A,j,n){var x=n("./node_modules/css-loader/dist/runtime/api.js");j=x(!1),j.push([A.i,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}.embedded-svg-wrapper{cursor:text}.embedded-svg-wrapper svg{width:100%;height:100%}",""]),A.exports=j}}]);
