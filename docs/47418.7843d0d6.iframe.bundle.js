(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[47418],{"./frontend/src/scenes/insights/InsightScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{InsightScene:()=>InsightScene,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Insight=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/insights/Insight.scss"),Insight_default=__webpack_require__.n(Insight),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(Insight_default(),options),Insight_default().locals;var react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.6.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),dashboardsModel=__webpack_require__("./frontend/src/models/dashboardsModel.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AddToDashboard(_ref){let{insight,setOpenModal}=_ref,{rawDashboards}=(0,index_esm.useValues)(dashboardsModel.h),dashboards=insight.dashboard_tiles?.map(tile=>rawDashboards[tile.dashboard_id]).filter(d=>!!d)||[];return(0,jsx_runtime.jsx)("span",{className:"save-to-dashboard","data-attr":"save-to-dashboard-button",children:(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>setOpenModal(!0),type:"secondary",icon:(0,jsx_runtime.jsx)(icons.Xd,{count:dashboards.length,showZero:!1,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconDashboard,{})}),children:0===dashboards.length?"Add to dashboard":"Manage dashboards"})})}var clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),fuse_esm=__webpack_require__("./node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),LemonToast=__webpack_require__("./frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),eventUsageLogic=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts"),newDashboardLogic=__webpack_require__("./frontend/src/scenes/dashboard/newDashboardLogic.ts"),insightLogic=__webpack_require__("./frontend/src/scenes/insights/insightLogic.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts");let addToDashboardModalLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{insight}=_ref;if(!insight.short_id)throw Error("must provide an insight with a short id");return insight.short_id}),(0,index_esm.path)(["lib","components","AddToDashboard","saveToDashboardModalLogic"]),(0,index_esm.connect)(props=>({actions:[(0,insightLogic.zm)({dashboardItemId:props.insight.short_id,cachedInsight:props.insight}),["updateInsight","updateInsightSuccess","updateInsightFailure"],eventUsageLogic.vx,["reportSavedInsightToDashboard","reportRemovedInsightFromDashboard","reportCreatedDashboardFromModal"],newDashboardLogic.Z,["showNewDashboardModal"]]})),(0,index_esm.actions)({addNewDashboard:!0,setSearchQuery:query=>({query}),setInsight:insight=>({insight}),setScrollIndex:index=>({index}),addToDashboard:(insight,dashboardId)=>({insight,dashboardId}),removeFromDashboard:(insight,dashboardId)=>({insight,dashboardId})}),(0,index_esm.reducers)({searchQuery:["",{setSearchQuery:(_,_ref2)=>{let{query}=_ref2;return query}}],scrollIndex:[-1,{setScrollIndex:(_,_ref3)=>{let{index}=_ref3;return index}}],dashboardWithActiveAPICall:[null,{addToDashboard:(_,_ref4)=>{let{dashboardId}=_ref4;return dashboardId},removeFromDashboard:(_,_ref5)=>{let{dashboardId}=_ref5;return dashboardId},updateInsightSuccess:()=>null,updateInsightFailure:()=>null}]}),(0,index_esm.selectors)({dashboardsFuse:[()=>[dashboardsModel.h.selectors.nameSortedDashboards],nameSortedDashboards=>new fuse_esm.Z(nameSortedDashboards||[],{keys:["name","description","tags"],threshold:.3})],filteredDashboards:[s=>[s.searchQuery,s.dashboardsFuse,dashboardsModel.h.selectors.nameSortedDashboards],(searchQuery,dashboardsFuse,nameSortedDashboards)=>searchQuery.length?dashboardsFuse.search(searchQuery).map(r=>r.item):nameSortedDashboards],currentDashboards:[(s,p)=>[s.filteredDashboards,p.insight],(filteredDashboards,insight)=>filteredDashboards.filter(d=>insight.dashboard_tiles?.map(dt=>dt.dashboard_id)?.includes(d.id))],availableDashboards:[s=>[s.filteredDashboards,s.currentDashboards],(filteredDashboards,currentDashboards)=>filteredDashboards.filter(d=>!currentDashboards?.map(cd=>cd.id).includes(d.id))],orderedDashboards:[s=>[s.currentDashboards,s.availableDashboards],(currentDashboards,availableDashboards)=>[...currentDashboards,...availableDashboards]]}),(0,index_esm.listeners)(_ref6=>{let{actions,values,props}=_ref6;return{addNewDashboard:async()=>{actions.showNewDashboardModal()},[dashboardsModel.h.actionTypes.addDashboardSuccess]:async _ref7=>{let{dashboard}=_ref7;actions.reportCreatedDashboardFromModal(),actions.addToDashboard(props.insight,dashboard.id),actions.setScrollIndex(values.orderedDashboards.findIndex(d=>d.id===dashboard.id))},addToDashboard:async _ref8=>{let{insight,dashboardId}=_ref8;actions.updateInsight({...insight,dashboards:[...insight.dashboards||[],dashboardId]},()=>{actions.reportSavedInsightToDashboard(),dashboardsModel.h.actions.tileAddedToDashboard(dashboardId),LemonToast.UJ.success("Insight added to dashboard",{button:{label:"View dashboard",action:()=>lib.router.actions.push(urls.j.dashboard(dashboardId))}})})},removeFromDashboard:async _ref9=>{let{insight,dashboardId}=_ref9;actions.updateInsight({...insight,dashboards:(insight.dashboards||[]).filter(d=>d!==dashboardId),dashboard_tiles:(insight.dashboard_tiles||[]).filter(dt=>dt.dashboard_id!==dashboardId)},()=>{actions.reportRemovedInsightFromDashboard(),LemonToast.UJ.success("Insight removed from dashboard")})}}})]);var LemonInput=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),AutoSizer=__webpack_require__("./node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),List=__webpack_require__("./node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0/node_modules/react-virtualized/dist/es/List/index.js"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");let DashboardRelationRow=_ref=>{let{style,isHighlighted,isAlreadyOnDashboard,dashboard,insight,canEditInsight}=_ref,logic=addToDashboardModalLogic({insight:insight,fromDashboard:insight.dashboards?.[0]||void 0}),{addToDashboard,removeFromDashboard}=(0,index_esm.useActions)(logic),{dashboardWithActiveAPICall}=(0,index_esm.useValues)(logic),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),isPrimary=dashboard.id===currentTeam?.primary_dashboard;return(0,jsx_runtime.jsxs)("div",{"data-attr":"dashboard-list-item",style:style,className:(0,clsx_m.default)("flex items-center space-x-2",isHighlighted&&"highlighted"),children:[(0,jsx_runtime.jsx)(Link.r,{to:urls.j.dashboard(dashboard.id),className:"overflow-hidden text-ellipsis whitespace-nowrap",title:dashboard.name,children:dashboard.name||"Untitled"}),isPrimary&&(0,jsx_runtime.jsx)(Tooltip.u,{title:"Primary dashboards are shown on the project home page",children:(0,jsx_runtime.jsx)("span",{className:"flex items-center",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconHome,{className:"text-warning text-base"})})}),(0,jsx_runtime.jsx)("span",{className:"grow"}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",status:isAlreadyOnDashboard?"danger":"default",loading:dashboardWithActiveAPICall===dashboard.id,disabledReason:canEditInsight?dashboardWithActiveAPICall?"Loading...":"":"You don't have permission to edit this dashboard",size:"small",onClick:e=>{e.preventDefault(),isAlreadyOnDashboard?removeFromDashboard(insight,dashboard.id):addToDashboard(insight,dashboard.id)},children:isAlreadyOnDashboard?"Remove from dashboard":"Add to dashboard"})]})};function AddToDashboardModal(_ref2){let{isOpen,closeModal,insight,canEditInsight}=_ref2,logic=addToDashboardModalLogic({insight:insight,fromDashboard:insight.dashboards?.[0]||void 0}),{searchQuery,currentDashboards,orderedDashboards,scrollIndex}=(0,index_esm.useValues)(logic),{setSearchQuery,addNewDashboard}=(0,index_esm.useActions)(logic),renderItem=_ref3=>{let{index:rowIndex,style}=_ref3;return(0,jsx_runtime.jsx)(DashboardRelationRow,{dashboard:orderedDashboards[rowIndex],insight:insight,canEditInsight:canEditInsight,isHighlighted:rowIndex===scrollIndex,isAlreadyOnDashboard:currentDashboards.some(currentDashboard=>currentDashboard.id===orderedDashboards[rowIndex].id),style:style},rowIndex)};return(0,jsx_runtime.jsx)(LemonModal.f,{onClose:closeModal,isOpen:isOpen,title:"Add to dashboard",footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",onClick:addNewDashboard,disabledReason:canEditInsight?void 0:"You do not have permission to add this Insight to dashboards",children:"Add to a new dashboard"})}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",onClick:closeModal,children:"Close"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-2 w-192 max-w-full",children:[(0,jsx_runtime.jsx)(LemonInput.D,{"data-attr":"dashboard-searchfield",type:"search",fullWidth:!0,placeholder:"Search for dashboards...",value:searchQuery,onChange:newValue=>setSearchQuery(newValue)}),(0,jsx_runtime.jsxs)("div",{className:"text-muted-alt",children:["This insight is referenced on"," ",(0,jsx_runtime.jsx)("strong",{className:"text-default",children:insight.dashboard_tiles?.length})," ",(0,utils._6)(insight.dashboard_tiles?.length||0,"dashboard","dashboards",!1)]}),(0,jsx_runtime.jsx)("div",{style:{minHeight:420},children:(0,jsx_runtime.jsx)(AutoSizer.q,{children:_ref4=>{let{height,width}=_ref4;return(0,jsx_runtime.jsx)(List.aV,{width:width,height:height,rowCount:orderedDashboards.length,overscanRowCount:100,rowHeight:40,rowRenderer:renderItem,scrollToIndex:scrollIndex})}})})]})})}var EditableField=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),ExportButton=__webpack_require__("./frontend/src/lib/components/ExportButton/ExportButton.tsx"),ObjectTags=__webpack_require__("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),SharingModal=__webpack_require__("./frontend/src/lib/components/Sharing/SharingModal.tsx"),SubscriptionsModal=__webpack_require__("./frontend/src/lib/components/Subscriptions/SubscriptionsModal.tsx"),UserActivityIndicator=__webpack_require__("./frontend/src/lib/components/UserActivityIndicator/UserActivityIndicator.tsx"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonDivider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDivider/index.ts"),LemonSwitch=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSwitch/index.ts"),deleteWithUndo=__webpack_require__("./frontend/src/lib/utils/deleteWithUndo.tsx"),NewDashboardModal=__webpack_require__("./frontend/src/scenes/dashboard/NewDashboardModal.tsx"),commandPaletteLogic=__webpack_require__("./frontend/src/lib/components/CommandPalette/commandPaletteLogic.tsx"),sharedUtils=__webpack_require__("./frontend/src/scenes/insights/sharedUtils.ts"),insightVizDataLogic=__webpack_require__("./frontend/src/scenes/insights/insightVizDataLogic.ts");let INSIGHT_COMMAND_SCOPE="insights",insightCommandLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)((0,sharedUtils.bk)("new")),(0,index_esm.path)(key=>["scenes","insights","insightCommandLogic",key]),(0,index_esm.connect)(props=>[commandPaletteLogic.M,(0,insightVizDataLogic.Z)(props)]),(0,index_esm.events)(_ref=>{let{props}=_ref;return{afterMount:()=>{let funnelCommands=[{key:"insight-graph",resolver:[{icon:posthog_icons_es.IconTrending,display:'Toggle "Compare Previous" on Graph',executor:()=>{let compare=(0,insightVizDataLogic.Z)(props).values.compare;(0,insightVizDataLogic.Z)(props).actions.updateInsightFilter({compare:!compare})}},...utils.bE.map(_ref2=>{let{key,values}=_ref2;return{icon:posthog_icons_es.IconTrending,display:`Set Time Range to ${key}`,executor:()=>{(0,insightVizDataLogic.Z)(props).actions.updateDateRange({date_from:values[0],date_to:values[1]})}}})],scope:INSIGHT_COMMAND_SCOPE}];for(let command of funnelCommands)commandPaletteLogic.M.actions.registerCommand(command)},beforeUnmount:()=>{commandPaletteLogic.M.actions.deregisterScope(INSIGHT_COMMAND_SCOPE)}}})]);var insightDataLogic=__webpack_require__("./frontend/src/scenes/insights/insightDataLogic.ts");function InsightSaveButton(_ref){let{saveAs,saveInsight,isSaved,insightSaving,insightChanged,addingToDashboard}=_ref,disabled=isSaved&&!insightChanged,saveAsAvailable=isSaved&&!addingToDashboard;return(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",onClick:()=>saveInsight(!0),"data-attr":"insight-save-button",disabled:disabled,loading:!disabled&&insightSaving,sideAction:{dropdown:{placement:"bottom-end",overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!disabled&&(0,jsx_runtime.jsxs)(LemonButton.J,{onClick:()=>saveInsight(!1),"data-attr":"insight-save-and-continue",fullWidth:!0,children:[addingToDashboard?"Save, add to dashboard":"Save"," & continue editing"]}),saveAsAvailable&&(0,jsx_runtime.jsx)(LemonButton.J,{onClick:saveAs,"data-attr":"insight-save-as-new-insight",fullWidth:!0,children:"Save as…"})]})},disabled:disabled&&!saveAsAvailable,"data-attr":"insight-save-dropdown"},children:disabled?"No changes to be saved":addingToDashboard?"Save & add to dashboard":"Save"})}var insightSceneLogic=__webpack_require__("./frontend/src/scenes/insights/insightSceneLogic.tsx"),NotebookSelectButton=__webpack_require__("./frontend/src/scenes/notebooks/NotebookSelectButton/NotebookSelectButton.tsx"),savedInsightsLogic=__webpack_require__("./frontend/src/scenes/saved-insights/savedInsightsLogic.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),tagsModel=__webpack_require__("./frontend/src/models/tagsModel.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),types=__webpack_require__("./frontend/src/types.ts");function InsightPageHeader(_ref){var _insight$tags;let{insightLogicProps}=_ref,{insightMode,subscriptionId}=(0,index_esm.useValues)(insightSceneLogic.T),{setInsightMode}=(0,index_esm.useActions)(insightSceneLogic.T),logic=(0,insightLogic.zm)(insightLogicProps),{insightProps,canEditInsight,insight,insightChanged,insightSaving,hasDashboardItemId}=(0,index_esm.useValues)(logic),{setInsightMetadata}=(0,index_esm.useActions)(logic),{duplicateInsight,loadInsights}=(0,index_esm.useActions)(savedInsightsLogic.w),{queryChanged,showQueryEditor,hogQL,exportContext}=(0,index_esm.useValues)((0,insightDataLogic.S)(insightProps)),{saveInsight,saveAs,toggleQueryEditorPanel}=(0,index_esm.useActions)((0,insightDataLogic.S)(insightProps));(0,index_esm.useMountedLogic)(insightCommandLogic(insightProps));let{hasAvailableFeature}=(0,index_esm.useValues)(userLogic.userLogic),{tags}=(0,index_esm.useValues)(tagsModel.x),{currentTeamId}=(0,index_esm.useValues)(teamLogic.teamLogic),{push}=(0,index_esm.useActions)(lib.router),[addToDashboardModalOpen,setAddToDashboardModalOpenModal]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[hasDashboardItemId&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SubscriptionsModal.r,{isOpen:insightMode===types.LO.Subscriptions,closeModal:()=>push(urls.j.insightView(insight.short_id)),insightShortId:insight.short_id,subscriptionId:subscriptionId}),(0,jsx_runtime.jsx)(SharingModal.PA,{title:"Insight sharing",isOpen:insightMode===types.LO.Sharing,closeModal:()=>push(urls.j.insightView(insight.short_id)),insightShortId:insight.short_id,insight:insight,previewIframe:!0}),(0,jsx_runtime.jsx)(AddToDashboardModal,{isOpen:addToDashboardModalOpen,closeModal:()=>setAddToDashboardModalOpenModal(!1),insight:insight,canEditInsight:canEditInsight}),(0,jsx_runtime.jsx)(NewDashboardModal.O,{})]}),(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center gap-2",children:[(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[hasDashboardItemId&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>duplicateInsight(insight,!0),fullWidth:!0,"data-attr":"duplicate-insight-from-insight-view",children:"Duplicate"}),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>setInsightMetadata({favorited:!insight.favorited}),fullWidth:!0,children:insight.favorited?"Remove from favorites":"Add to favorites"}),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>setAddToDashboardModalOpenModal(!0),fullWidth:!0,children:"Add to dashboard"}),(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>insight.short_id?push(urls.j.insightSharing(insight.short_id)):null,fullWidth:!0,children:"Share or embed"}),(0,jsx_runtime.jsx)(SubscriptionsModal.T,{insightShortId:insight.short_id}),exportContext?(0,jsx_runtime.jsx)(ExportButton.j,{fullWidth:!0,items:[{export_format:types.P5.PNG,insight:insight.id},{export_format:types.P5.CSV,export_context:exportContext},{export_format:types.P5.XLSX,export_context:exportContext}]}):null,(0,jsx_runtime.jsx)(LemonDivider.p,{})]}),(0,jsx_runtime.jsx)(LemonSwitch.f,{"data-attr":`${showQueryEditor?"hide":"show"}-insight-source`,className:"px-2 py-1",checked:showQueryEditor,onChange:()=>{hasDashboardItemId&&insightMode!==types.LO.Edit&&(setInsightMode(types.LO.Edit,null),showQueryEditor)||toggleQueryEditorPanel()},fullWidth:!0,label:"View source"}),hogQL&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"edit-insight-sql",onClick:()=>{lib.router.actions.push(urls.j.insightNew(void 0,void 0,JSON.stringify({kind:schema.OH.DataTableNode,source:{kind:schema.OH.HogQLQuery,query:hogQL},full:!0})))},fullWidth:!0,children:"Edit SQL directly"})]}),hasDashboardItemId&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(LemonButton.J,{status:"danger",onClick:()=>void(0,deleteWithUndo.S)({object:insight,endpoint:`projects/${currentTeamId}/insights`,callback:()=>{loadInsights(),push(urls.j.savedInsights())}}),fullWidth:!0,children:"Delete insight"})]})]})}),(0,jsx_runtime.jsx)(LemonDivider.p,{vertical:!0}),insightMode===types.LO.Edit&&hasDashboardItemId&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",onClick:()=>setInsightMode(types.LO.View,null),children:"Cancel"}),insightMode!==types.LO.Edit&&hasDashboardItemId&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(NotebookSelectButton.R,{resource:{type:types.Cz.Query,attrs:{query:{kind:schema.OH.SavedInsightNode,shortId:insight.short_id}}},type:"secondary"}),(0,jsx_runtime.jsx)(AddToDashboard,{insight:insight,setOpenModal:setAddToDashboardModalOpenModal})]}),insightMode!==types.LO.Edit?canEditInsight&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",onClick:()=>setInsightMode(types.LO.Edit,null),"data-attr":"insight-edit-button",children:"Edit"}):(0,jsx_runtime.jsx)(InsightSaveButton,{saveAs:saveAs,saveInsight:saveInsight,isSaved:hasDashboardItemId,addingToDashboard:!!insight.dashboards?.length&&!insight.id,insightSaving:insightSaving,insightChanged:insightChanged||queryChanged})]}),caption:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!!(canEditInsight||insight.description)&&(0,jsx_runtime.jsx)(EditableField.f,{multiline:!0,markdown:!0,name:"description",value:insight.description||"",placeholder:"Description (optional)",onSave:value=>setInsightMetadata({description:value}),saveOnBlur:!0,maxLength:400,mode:canEditInsight?void 0:"view","data-attr":"insight-description",compactButtons:!0,paywall:!hasAvailableFeature(types.P$.TEAM_COLLABORATION)}),canEditInsight?(0,jsx_runtime.jsx)(ObjectTags.D,{tags:null!==(_insight$tags=insight.tags)&&void 0!==_insight$tags?_insight$tags:[],saving:insightSaving,onChange:(_,tags)=>setInsightMetadata({tags:null!=tags?tags:[]}),tagsAvailable:tags,className:"mt-2","data-attr":"insight-tags"}):insight.tags?.length?(0,jsx_runtime.jsx)(ObjectTags.D,{tags:insight.tags,saving:insightSaving,className:"mt-2","data-attr":"insight-tags",staticOnly:!0}):null,(0,jsx_runtime.jsx)(UserActivityIndicator.F,{at:insight.last_modified_at,by:insight.last_modified_by,className:"mt-2"})]}),tabbedPage:insightMode===types.LO.Edit})]})}var LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.ts");function InsightSkeleton(){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"my-6 space-y-4",children:[(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-1/4 h-4"}),(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-1/2 h-4",repeat:3}),(0,jsx_runtime.jsx)(LemonSkeleton.y,{}),(0,jsx_runtime.jsxs)("div",{className:"border rounded p-6 flex items-center gap-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1 space-y-2",children:(0,jsx_runtime.jsx)(LemonSkeleton.y.Row,{repeat:3})}),(0,jsx_runtime.jsx)("div",{className:"flex-1 space-y-2",children:(0,jsx_runtime.jsx)(LemonSkeleton.y.Row,{repeat:3})})]}),(0,jsx_runtime.jsx)("div",{className:"border rounded p-6 min-h-100"})]})})}var Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),queries_utils=__webpack_require__("./frontend/src/queries/utils.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),insightNavLogic=__webpack_require__("./frontend/src/scenes/insights/InsightNav/insightNavLogic.tsx"),insights_utils=__webpack_require__("./frontend/src/scenes/insights/utils.tsx"),SavedInsights=__webpack_require__("./frontend/src/scenes/saved-insights/SavedInsights.tsx"),LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts");__webpack_require__("./node_modules/.pnpm/core-js@3.32.0/node_modules/core-js/modules/es.regexp.flags.js");var es=__webpack_require__("./node_modules/.pnpm/posthog-js@1.115.1/node_modules/posthog-js/dist/es.js");let funnelsCueLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)((0,sharedUtils.bk)("new")),(0,index_esm.path)(key=>["scenes","insights","InsightTabs","TrendTab","FunnelsCue",key]),(0,index_esm.connect)(props=>({values:[(0,insightLogic.zm)(props),["isFirstLoad"],(0,insightVizDataLogic.Z)(props),["query"],featureFlagLogic.h,["featureFlags"]],actions:[(0,insightVizDataLogic.Z)(props),["setQuery"],featureFlagLogic.h,["setFeatureFlags"]]})),(0,index_esm.actions)({optOut:userOptedOut=>({userOptedOut}),setShouldShow:show=>({show}),setPermanentOptOut:!0,displayAsFunnel:!0}),(0,index_esm.reducers)({_shouldShow:[!1,{setShouldShow:(_,_ref)=>{let{show}=_ref;return show}}],permanentOptOut:[!1,{setPermanentOptOut:()=>!0}]}),(0,index_esm.listeners)(_ref2=>{let{actions,values}=_ref2;return{optOut:async _ref3=>{let{userOptedOut}=_ref3;es.ZP.capture("funnel cue 7301 - terminated",{user_opted_out:userOptedOut}),es.ZP.people.set({funnels_cue_3701_opt_out:!0}),actions.setPermanentOptOut()},setQuery:_ref4=>{let{query}=_ref4;(0,queries_utils.KN)(query)&&(!values.isFirstLoad&&(0,queries_utils.kX)(query?.source)&&(query.source.series||[]).length>=3?(actions.setShouldShow(!0),values.permanentOptOut||es.ZP.capture("funnel cue 7301 - shown",{step_count:query.source.series.length})):values.shown&&(0,queries_utils.Wl)(query?.source)?actions.optOut(!1):actions.setShouldShow(!1))},setFeatureFlags:async _ref5=>{let{flags}=_ref5;flags[constants.y8.FUNNELS_CUE_OPT_OUT]&&actions.setPermanentOptOut()},displayAsFunnel:()=>{if(!(0,queries_utils.KN)(values.query)||!(0,queries_utils.kX)(values.query?.source))return;let query=JSON.parse(JSON.stringify(values.query));query.source.kind=schema.OH.FunnelsQuery,actions.setQuery(query)}}}),(0,index_esm.selectors)({shown:[s=>[s._shouldShow,s.permanentOptOut],(shouldShow,permanentOptout)=>shouldShow&&!permanentOptout]}),(0,index_esm.events)(_ref6=>{let{actions,values}=_ref6;return{afterMount:()=>{values.featureFlags[constants.y8.FUNNELS_CUE_OPT_OUT]&&actions.setPermanentOptOut()}}})]);function FunnelsCue(){let{insightProps}=(0,index_esm.useValues)(insightLogic.zm),{shown}=(0,index_esm.useValues)(funnelsCueLogic(insightProps)),{optOut,displayAsFunnel}=(0,index_esm.useActions)(funnelsCueLogic(insightProps));return shown?(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",action:{onClick:displayAsFunnel,children:"Try this insight as a funnel"},onClose:()=>optOut(!0),className:"mb-4",children:"Looks like you have multiple events. A funnel can help better visualize your user’s progression across each event."}):null}function InsightsNav(){let{insightProps}=(0,index_esm.useValues)(insightLogic.zm),{activeView,tabs}=(0,index_esm.useValues)((0,insightNavLogic.C)(insightProps)),{setActiveView}=(0,index_esm.useActions)((0,insightNavLogic.C)(insightProps)),insightTypeUrls=(0,insights_utils.Uz)(!!featureFlagLogic.h.findMounted()?.values.featureFlags?.[constants.y8.BI_VIZ]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(FunnelsCue,{}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeView,onChange:newKey=>setActiveView(newKey),tabs:tabs.map(_ref=>{let{label,type,dataAttr}=_ref;return{key:type,label:(0,jsx_runtime.jsx)(Link.r,{to:insightTypeUrls[type],preventClick:!0,"data-attr":dataAttr,children:(0,jsx_runtime.jsx)(Tooltip.u,{placement:"top",title:SavedInsights.INSIGHT_TYPES_METADATA[type].description,children:(0,jsx_runtime.jsx)("span",{children:label})})})}})})]})}function Insight_Insight(_ref){let{insightId}=_ref,{insightMode,insight}=(0,index_esm.useValues)(insightSceneLogic.T),logic=(0,insightLogic.zm)({dashboardItemId:insightId||"new",cachedInsight:insight?.short_id===insightId?insight:null}),{insightProps,insightLoading,filtersKnown}=(0,index_esm.useValues)(logic),{reportInsightViewedForRecentInsights}=(0,index_esm.useActions)(logic),{query,showQueryEditor}=(0,index_esm.useValues)((0,insightDataLogic.S)(insightProps)),{setQuery:setInsightQuery}=(0,index_esm.useActions)((0,insightDataLogic.S)(insightProps));if((0,index_esm.useMountedLogic)(insightCommandLogic(insightProps)),(0,react.useEffect)(()=>{reportInsightViewedForRecentInsights()},[insightId]),"new"!==insightId&&insightLoading&&!filtersKnown)return(0,jsx_runtime.jsx)(InsightSkeleton,{});let actuallyShowQueryEditor=insightMode===types.LO.Edit&&showQueryEditor;return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:insightLogic.zm,props:insightProps,children:(0,jsx_runtime.jsxs)("div",{className:"Insight",children:[(0,jsx_runtime.jsx)(InsightPageHeader,{insightLogicProps:insightProps}),insightMode===types.LO.Edit&&(0,jsx_runtime.jsx)(InsightsNav,{}),(0,jsx_runtime.jsx)(Query.A,{query:(0,queries_utils.KN)(query)?{...query,full:!0}:query,setQuery:insightMode===types.LO.Edit?query=>{(0,queries_utils.KN)(query)||setInsightQuery(query)}:void 0,readOnly:insightMode!==types.LO.Edit,context:{showOpenEditorButton:!1,showQueryEditor:actuallyShowQueryEditor,showQueryHelp:insightMode===types.LO.Edit&&!(0,queries_utils.KJ)(query),insightProps}})]})})}function InsightScene(){let{insightId,insight,insightLogicRef}=(0,index_esm.useValues)(insightSceneLogic.T);return"new"===insightId||insightId&&insight?.id&&insight?.short_id?(0,jsx_runtime.jsx)(Insight_Insight,{insightId:insightId}):insightLogicRef?.logic?.values?.insightLoading?(0,jsx_runtime.jsx)(InsightSkeleton,{}):(0,jsx_runtime.jsx)(NotFound.T,{object:"insight"})}let scene={component:InsightScene,logic:insightSceneLogic.T}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/insights/Insight.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".Insight .retention-date-picker{background-color:transparent;border:0}.Insight .retention-date-picker input::-moz-placeholder{color:var(--default)}.Insight .retention-date-picker input::placeholder{color:var(--default)}",""]),module.exports=exports}}]);