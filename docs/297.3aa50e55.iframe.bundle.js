(window.webpackJsonp=window.webpackJsonp||[]).push([[297],{"./frontend/src/scenes/experiments/Experiment.tsx":function(Le,q,o){"use strict";o.r(q),o.d(q,"scene",function(){return qt}),o.d(q,"Experiment",function(){return pt}),o.d(q,"CodeLanguageSelect",function(){return ft});var Ze=o("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),Fn=o("./node_modules/core-js/modules/web.dom-collections.for-each.js"),On=o("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),It=o("./node_modules/@babel/runtime/helpers/defineProperty.js"),xe=o.n(It),St=o("./node_modules/@babel/runtime/helpers/slicedToArray.js"),le=o.n(St),Tn=o("./node_modules/core-js/modules/es.object.to-string.js"),Mn=o("./node_modules/core-js/modules/es.function.name.js"),Dn=o("./node_modules/core-js/modules/es.symbol.js"),Pn=o("./node_modules/core-js/modules/es.symbol.description.js"),Ln=o("./node_modules/core-js/modules/es.array.map.js"),kn=o("./node_modules/core-js/modules/es.array.concat.js"),An=o("./node_modules/core-js/modules/es.regexp.to-string.js"),Rn=o("./node_modules/core-js/modules/es.array.filter.js"),Vn=o("./node_modules/core-js/modules/es.number.to-fixed.js"),Yn=o("./node_modules/core-js/modules/es.array.sort.js"),$n=o("./node_modules/core-js/modules/es.object.keys.js"),Un=o("./node_modules/core-js/modules/es.number.constructor.js"),W=o("./node_modules/antd/es/form/index.js"),be=o("./node_modules/antd/es/skeleton/index.js"),E=o("./node_modules/antd/es/row/index.js"),g=o("./node_modules/antd/es/col/index.js"),we=o("./node_modules/antd/es/input/index.js"),Ne=o("./node_modules/antd/es/tooltip/index.js"),z=o("./node_modules/antd/es/select/index.js"),ke=o("./node_modules/antd/es/card/index.js"),qe=o("./node_modules/antd/es/tag/index.js"),_e=o("./node_modules/antd/es/collapse/index.js"),et=o("./node_modules/antd/es/progress/index.js"),L=o("./node_modules/kea/lib/index.esm.js"),tt=o("./frontend/src/lib/components/PageHeader.tsx"),Ct=o("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Ft=o("./frontend/src/lib/components/PropertyFilters/utils.ts"),j=o("./frontend/src/lib/components/TaxonomicFilter/types.ts"),oe=o("./node_modules/react/index.js"),e=o.n(oe),je=o("./frontend/src/scenes/funnels/funnelLogic.ts"),ae=o("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),ce=o("./frontend/src/scenes/insights/insightLogic.ts"),p=o("./frontend/src/types.ts"),Ot=o("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),Tt=o.n(Ot),Mt=o("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss"),nt=o.n(Mt),Ae={};Ae.insert="head",Ae.singleton=!1;var zn=Tt()(nt.a,Ae),Bn=nt.a.locals||{},Dt=o("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),V=o.n(Dt),Pt=o("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),_=o.n(Pt),Lt=o("./node_modules/@babel/runtime/regenerator/index.js"),I=o.n(Lt),Gn=o("./node_modules/core-js/modules/es.array.splice.js"),Wn=o("./node_modules/core-js/modules/es.array.iterator.js"),Hn=o("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Kn=o("./node_modules/core-js/modules/es.array.find.js"),Jn=o("./node_modules/core-js/modules/es.array.includes.js"),Qn=o("./node_modules/core-js/modules/es.string.includes.js"),Xn=o("./node_modules/core-js/modules/es.promise.js"),Zn=o("./node_modules/core-js/modules/es.string.iterator.js"),qn=o("./node_modules/core-js/modules/es.array.find-index.js"),_n=o("./node_modules/core-js/modules/es.object.values.js"),er=o("./node_modules/core-js/modules/es.number.epsilon.js"),tr=o("./node_modules/core-js/modules/es.array.fill.js"),H=o("./frontend/src/lib/api.ts"),C=o("./frontend/src/lib/dayjs.ts"),Ie=o("./frontend/src/scenes/insights/utils/cleanFilters.ts"),Re=o("./frontend/src/scenes/teamLogic.tsx"),ee=o("./frontend/src/scenes/urls.ts"),ie=o("./node_modules/kea-router/lib/index.js"),kt=o("./frontend/src/scenes/experiments/experimentsLogic.ts"),me=o("./frontend/src/lib/constants.tsx"),Ve=o("./frontend/src/scenes/trends/trendsLogic.ts"),de=o("./frontend/src/lib/utils/eventUsageLogic.ts"),At=o("./frontend/src/scenes/userLogic.ts"),rt=o("./frontend/src/lib/components/Tooltip.tsx"),ue=o("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),Rt=o("./frontend/src/models/groupsModel.ts"),Ye=o("./frontend/src/lib/components/lemonToast.tsx"),O=o("./frontend/src/lib/utils.tsx");function at(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,a)}return r}function b(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?at(Object(r),!0).forEach(function(a){xe()(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):at(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}var pe=14,fe=Object(L.kea)({props:{},key:function(n){return n.experimentId||"new"},path:function(n){return["scenes","experiment","experimentLogic",n]},connect:{values:[Re.a,["currentTeamId"],At.a,["hasAvailableFeature"],Rt.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]],actions:[kt.a,["updateExperiments","addToExperiments"]]},actions:{setExperiment:function(n){return{experiment:n}},createExperiment:function(n,r,a){return{draft:n,runningTime:r,sampleSize:a}},setExperimentInsightId:function(n){return{shortId:n}},createNewExperimentInsight:function(n){return{filters:n}},setFilters:function(n){return{filters:n}},setNewExperimentData:function(n){return{experimentData:n}},updateExperimentGroup:function(n,r){return{variant:n,idx:r}},removeExperimentGroup:function(n){return{idx:n}},setExperimentInsightType:function(n){return{insightType:n}},setEditExperiment:function(n){return{editing:n}},setSecondaryMetrics:function(n){return{secondaryMetrics:n}},setExperimentResultCalculationError:function(n){return{error:n}},setFlagImplementationWarning:function(n){return{warning:n}},setFlagAvailabilityWarning:function(n){return{warning:n}},resetNewExperiment:!0,launchExperiment:!0,endExperiment:!0,addExperimentGroup:!0,archiveExperiment:!0},reducers:{newExperimentData:[null,{setNewExperimentData:function(n,r){var a=r.experimentData;if(a.filters){var l=b(b({},n==null?void 0:n.filters),a.filters);return b(b(b({},n),a),{},{filters:l})}if(a.parameters){var u=b(b({},n==null?void 0:n.parameters),a.parameters);return b(b(b({},n),a),{},{parameters:u})}return b(b({},n),a)},updateExperimentGroup:function(n,r){var a,l=r.variant,u=r.idx,m=_()((n==null||(a=n.parameters)===null||a===void 0?void 0:a.feature_flag_variants)||[]);return m[u]=b(b({},m[u]),l),b(b({},n),{},{parameters:b(b({},n==null?void 0:n.parameters),{},{feature_flag_variants:m})})},addExperimentGroup:function(n){var r;if(n!=null&&(r=n.parameters)!==null&&r!==void 0&&r.feature_flag_variants){var a=it(n.parameters.feature_flag_variants.length+1),l=n.parameters.feature_flag_variants.map(function(u,m){return b(b({},u),{},{rollout_percentage:a[m]})});return b(b({},n),{},{parameters:b(b({},n.parameters),{},{feature_flag_variants:[].concat(_()(l),[{key:"test_group_".concat(n.parameters.feature_flag_variants.length),rollout_percentage:a[a.length-1]}])})})}return n},removeExperimentGroup:function(n,r){var a,l,u=r.idx;if(!n)return n;var m=_()(((a=n.parameters)===null||a===void 0?void 0:a.feature_flag_variants)||[]);m.splice(u,1);var i=it(((n==null||(l=n.parameters)===null||l===void 0?void 0:l.feature_flag_variants)||[]).length-1),d=m.map(function(c,h){return b(b({},c),{},{rollout_percentage:i[h]})});return b(b({},n),{},{parameters:b(b({},n.parameters),{},{feature_flag_variants:d})})},setSecondaryMetrics:function(n,r){var a=r.secondaryMetrics,l=a.map(function(u){return u});return b(b({},n),{},{secondary_metrics:l})},resetNewExperiment:function(){return{parameters:{feature_flag_variants:[{key:"control",rollout_percentage:50},{key:"test",rollout_percentage:50}]}}}}],experimentInsightType:[p.C.TRENDS,{setExperimentInsightType:function(n,r){var a=r.insightType;return a}}],experimentInsightId:[null,{setExperimentInsightId:function(n,r){var a=r.shortId;return a}}],editingExistingExperiment:[!1,{setEditExperiment:function(n,r){var a=r.editing;return a}}],experimentResultCalculationError:[null,{setExperimentResultCalculationError:function(n,r){var a=r.error;return a}}],flagImplementationWarning:[!1,{setFlagImplementationWarning:function(n,r){var a=r.warning;return a}}],flagAvailabilityWarning:[!1,{setFlagAvailabilityWarning:function(n,r){var a=r.warning;return a}}]},listeners:function(n){var r=n.values,a=n.actions;return{createExperiment:function(){var l=V()(I.a.mark(function m(i){var d,c,h,v,w,y,s,M,S,Y;return I.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(c=i.draft,h=i.runningTime,v=i.sampleSize,w=null,y=!!r.experimentId&&r.experimentId!=="new",f.prev=3,!y){f.next=14;break}return f.next=7,H.b.update("api/projects/".concat(r.currentTeamId,"/experiments/").concat(r.experimentId),b(b({},r.newExperimentData),{},{parameters:b(b({},(s=r.newExperimentData)===null||s===void 0?void 0:s.parameters),{},{recommended_running_time:h,recommended_sample_size:v})},!c&&{start_date:Object(C.a)()}));case 7:if(w=f.sent,!((M=w)!==null&&M!==void 0&&M.id)){f.next=12;break}return a.updateExperiments(w),ie.router.actions.push(ee.a.experiment(w.id)),f.abrupt("return");case 12:f.next=18;break;case 14:return f.next=16,H.b.create("api/projects/".concat(r.currentTeamId,"/experiments"),b(b({},r.newExperimentData),{},{parameters:b(b({},(S=r.newExperimentData)===null||S===void 0?void 0:S.parameters),{},{recommended_running_time:h,recommended_sample_size:v})},!c&&{start_date:Object(C.a)()}));case 16:w=f.sent,w&&de.e.actions.reportExperimentCreated(w);case 18:f.next=24;break;case 20:return f.prev=20,f.t0=f.catch(3),Ye.d.error(f.t0.detail||"Failed to create experiment"),f.abrupt("return");case 24:(d=w)!==null&&d!==void 0&&d.id&&(Y=w.id,ie.router.actions.push(ee.a.experiment(Y)),a.addToExperiments(w),Ye.d.success("Experiment ".concat(y?"updated":"created"),{button:{label:"View it",action:function(){ie.router.actions.push(ee.a.experiment(Y))}}}));case 25:case"end":return f.stop()}},m,null,[[3,20]])}));function u(m){return l.apply(this,arguments)}return u}(),createNewExperimentInsight:function(){var l=V()(I.a.mark(function m(i){var d,c,h,v;return I.a.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return d=i.filters,r.experimentInsightType===p.C.FUNNELS?c=Object(Ie.a)(b({insight:p.C.FUNNELS,funnel_viz_type:p.y.Steps,display:p.j.FunnelViz,date_from:Object(C.a)().subtract(pe,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(C.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:me.k.horizontal},d)):c=Object(Ie.a)(b({insight:p.C.TRENDS,date_from:Object(C.a)().subtract(pe,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(C.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},d)),h={name:"",description:"",tags:[],filters:c,result:null},y.next=5,H.b.create("api/projects/".concat(r.currentTeamId,"/insights"),h);case 5:v=y.sent,a.setExperimentInsightId(v.short_id),a.setNewExperimentData({filters:b({},h.filters)});case 8:case"end":return y.stop()}},m)}));function u(m){return l.apply(this,arguments)}return u}(),setFilters:function(u){var m=u.filters;if(r.experimentInsightType===p.C.FUNNELS){var i;(i=je.a.findMounted({dashboardItemId:r.experimentInsightId}))===null||i===void 0||i.actions.setFilters(m)}else{var d;(d=Ve.a.findMounted({dashboardItemId:r.experimentInsightId}))===null||d===void 0||d.actions.setFilters(m)}},loadExperimentSuccess:function(){var l=V()(I.a.mark(function m(i){var d;return I.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:d=i.experimentData,d&&de.e.actions.reportExperimentViewed(d),a.setExperimentInsightType((d==null?void 0:d.filters.insight)||p.C.FUNNELS),d!=null&&d.start_date?(a.resetNewExperiment(),a.loadExperimentResults(),a.loadSecondaryMetricResults()):(a.setNewExperimentData(b({},d)),a.createNewExperimentInsight(d==null?void 0:d.filters));case 4:case"end":return h.stop()}},m)}));function u(m){return l.apply(this,arguments)}return u}(),launchExperiment:function(){var l=V()(I.a.mark(function m(){var i;return I.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=Object(C.a)(),a.updateExperiment({start_date:i.format("YYYY-MM-DDTHH:mm")}),r.experimentData&&de.e.actions.reportExperimentLaunched(r.experimentData,i);case 3:case"end":return c.stop()}},m)}));function u(){return l.apply(this,arguments)}return u}(),endExperiment:function(){var l=V()(I.a.mark(function m(){var i,d,c;return I.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:d=Object(C.a)(),a.updateExperiment({end_date:d.format("YYYY-MM-DDTHH:mm")}),c=d.diff((i=r.experimentData)===null||i===void 0?void 0:i.start_date,"second"),r.experimentData&&de.e.actions.reportExperimentCompleted(r.experimentData,d,c,r.areResultsSignificant);case 4:case"end":return v.stop()}},m)}));function u(){return l.apply(this,arguments)}return u}(),archiveExperiment:function(){var l=V()(I.a.mark(function m(){return I.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:a.updateExperiment({archived:!0}),r.experimentData&&de.e.actions.reportExperimentArchived(r.experimentData);case 2:case"end":return d.stop()}},m)}));function u(){return l.apply(this,arguments)}return u}(),setExperimentInsightType:function(){if(r.experimentId==="new"||r.editingExistingExperiment)a.createNewExperimentInsight();else{var u;a.createNewExperimentInsight((u=r.experimentData)===null||u===void 0?void 0:u.filters)}},updateExperimentSuccess:function(){var l=V()(I.a.mark(function m(i){var d;return I.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:d=i.experimentData,a.updateExperiments(d);case 2:case"end":return h.stop()}},m)}));function u(m){return l.apply(this,arguments)}return u}(),setNewExperimentData:function(){var l=V()(I.a.mark(function m(i,d){var c,h,v,w,y,s,M,S,Y;return I.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(w=i.experimentData,y=((c=w.filters)===null||c===void 0?void 0:c.events)&&w.filters.events.length>0||((h=w.filters)===null||h===void 0?void 0:h.actions)&&w.filters.actions.length>0,!(!w.filters||Object.keys(w.filters).length===0)){f.next=4;break}return f.abrupt("return");case 4:if(!y){f.next=18;break}return s="/api/projects/".concat(r.currentTeamId,"/experiments/requires_flag_implementation?").concat(Object(O.Fb)(w.filters||{})),f.next=8,d(100);case 8:return f.prev=8,f.next=11,H.b.get(s);case 11:M=f.sent,a.setFlagImplementationWarning(M.result),f.next=18;break;case 15:f.prev=15,f.t0=f.catch(8),a.setFlagImplementationWarning(!1);case 18:(v=w.filters)!==null&&v!==void 0&&v.properties&&(S=Object(O.r)(w.filters.properties)||[],S.length>0?(Y=!!S.find(function(J){return J.type==="cohort"||!me.l.includes(J.key||"")}),a.setFlagAvailabilityWarning(Y)):a.setFlagAvailabilityWarning(!1));case 19:case"end":return f.stop()}},m,null,[[8,15]])}));function u(m,i){return l.apply(this,arguments)}return u}()}},loaders:function(n){var r=n.actions,a=n.values;return{experimentData:[null,{loadExperiment:function(){var l=V()(I.a.mark(function m(){var i;return I.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!(a.experimentId&&a.experimentId!=="new")){c.next=16;break}return c.prev=1,c.next=4,H.b.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(a.experimentId));case 4:return i=c.sent,c.abrupt("return",i);case 8:if(c.prev=8,c.t0=c.catch(1),c.t0.status!==404){c.next=14;break}throw c.t0;case 14:throw Ye.d.error("Failed to load experiment ".concat(a.experimentId)),new Error("Failed to load experiment ".concat(a.experimentId));case 16:return c.abrupt("return",null);case 17:case"end":return c.stop()}},m,null,[[1,8]])}));function u(){return l.apply(this,arguments)}return u}(),updateExperiment:function(){var l=V()(I.a.mark(function m(i){var d;return I.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,H.b.update("api/projects/".concat(a.currentTeamId,"/experiments/").concat(a.experimentId),i);case 2:return d=h.sent,h.abrupt("return",d);case 4:case"end":return h.stop()}},m)}));function u(m){return l.apply(this,arguments)}return u}()}],experimentResults:[null,{loadExperimentResults:function(){var l=V()(I.a.mark(function m(){var i;return I.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,H.b.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(a.experimentId,"/results"));case 3:return i=c.sent,c.abrupt("return",b(b({},i),{},{itemID:Math.random().toString(36).substring(2,15)}));case 7:return c.prev=7,c.t0=c.catch(0),r.setExperimentResultCalculationError(c.t0.detail),c.abrupt("return",null);case 11:case"end":return c.stop()}},m,null,[[0,7]])}));function u(){return l.apply(this,arguments)}return u}()}],secondaryMetricResults:[null,{loadSecondaryMetricResults:function(){var l=V()(I.a.mark(function m(){var i;return I.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,Promise.all((((i=a.experimentData)===null||i===void 0?void 0:i.secondary_metrics)||[]).map(function(){var h=V()(I.a.mark(function v(w,y){var s;return I.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,H.b.get("api/projects/".concat(a.currentTeamId,"/experiments/").concat(a.experimentId,"/secondary_results?id=").concat(y));case 3:return s=S.sent,S.abrupt("return",s.result);case 7:return S.prev=7,S.t0=S.catch(0),S.abrupt("return",{});case 10:case"end":return S.stop()}},v,null,[[0,7]])}));return function(v,w){return h.apply(this,arguments)}}()));case 2:return c.abrupt("return",c.sent);case 3:case"end":return c.stop()}},m)}));function u(){return l.apply(this,arguments)}return u}()}]}},selectors:{experimentId:[function(){return[function(t,n){var r;return(r=n.experimentId)!==null&&r!==void 0?r:"new"}]},function(t){return t}],breadcrumbs:[function(t){return[t.experimentData,t.experimentId]},function(t,n){return[{name:"Experiments",path:ee.a.experiments()},{name:(t==null?void 0:t.name)||"New",path:ee.a.experiment(n||"new")}]}],variants:[function(t){return[t.newExperimentData,t.experimentData]},function(t,n){var r,a;if(n!=null&&n.start_date){var l;return(n==null||(l=n.parameters)===null||l===void 0?void 0:l.feature_flag_variants)||[]}return(t==null||(r=t.parameters)===null||r===void 0?void 0:r.feature_flag_variants)||(n==null||(a=n.parameters)===null||a===void 0?void 0:a.feature_flag_variants)||[]}],taxonomicGroupTypesForSelection:[function(t){return[t.newExperimentData,t.groupsTaxonomicTypes]},function(t,n){var r;return(t==null||(r=t.filters)===null||r===void 0?void 0:r.aggregation_group_type_index)!=null&&n.length>0?[n[t.filters.aggregation_group_type_index]]:[j.a.PersonProperties,j.a.Cohorts]}],parsedSecondaryMetrics:[function(t){return[t.newExperimentData,t.experimentData]},function(t,n){var r=(t==null?void 0:t.secondary_metrics)||(n==null?void 0:n.secondary_metrics)||[];return r}],minimumDetectableChange:[function(t){return[t.newExperimentData]},function(t){var n;return(t==null||(n=t.parameters)===null||n===void 0?void 0:n.minimum_detectable_effect)||5}],minimumSampleSizePerVariant:[function(t){return[t.minimumDetectableChange]},function(t){return function(n){return Math.ceil(1600*n*(1-n/100)/(t*t))}}],areResultsSignificant:[function(t){return[t.experimentResults]},function(t){return(t==null?void 0:t.significant)||!1}],significanceBannerDetails:[function(t){return[t.experimentResults]},function(t){if((t==null?void 0:t.significance_code)===p.U.HighLoss){var n;return e.a.createElement(e.a.Fragment,null,"This is because the expected loss in conversion is greater than 1%",e.a.createElement(rt.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(n=((t==null?void 0:t.expected_loss)||0)*100)===null||n===void 0?void 0:n.toFixed(2),"%")},e.a.createElement(ue.a,{style:{padding:"4px 2px"}})),".")}if((t==null?void 0:t.significance_code)===p.U.HighPValue){var r;return e.a.createElement(e.a.Fragment,null,"This is because the p value is greater than 0.05",e.a.createElement(rt.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(t==null||(r=t.p_value)===null||r===void 0?void 0:r.toFixed(3))||1,".")},e.a.createElement(ue.a,{style:{padding:"4px 2px"}})),".")}return(t==null?void 0:t.significance_code)===p.U.LowWinProbability?"This is because the win probability of all test variants combined is less than 90%.":(t==null?void 0:t.significance_code)===p.U.NotEnoughExposure?"This is because we need at least 100 people per variant to declare significance.":""}],recommendedExposureForCountData:[function(t){return[t.minimumDetectableChange]},function(t){return function(n){var r=n*t/100,a=n,l=r+n;return parseFloat((4/Math.pow(Math.sqrt(a/pe)-Math.sqrt(l/pe),2)).toFixed(1))}}],expectedRunningTime:[function(){return[]},function(){return function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:pe;return parseFloat((n/(t/r)).toFixed(1))}}],conversionRateForVariant:[function(t){return[t.experimentResults]},function(t){return function(n){var r="Can't find variant";if(!t)return r;var a=(t==null?void 0:t.insight).find(function(l){var u,m;return((u=l[0])===null||u===void 0||(m=u.breakdown_value)===null||m===void 0?void 0:m[0])===n});return a?(a[a.length-1].count/a[0].count*100).toFixed(1):r}}],getIndexForVariant:[function(t){return[t.experimentResults]},function(t){return function(n,r){var a;if(!t)a=0;else{var l=-1;r===p.C.FUNNELS?l=_()(t==null?void 0:t.insight).sort(function(u,m){var i,d;return((i=m[0])===null||i===void 0?void 0:i.count)-((d=u[0])===null||d===void 0?void 0:d.count)}).findIndex(function(u){var m,i;return((m=u[0])===null||m===void 0||(i=m.breakdown_value)===null||i===void 0?void 0:i[0])===n}):l=(t==null?void 0:t.insight).findIndex(function(u){return u.breakdown_value===n}),a=l===-1?0:l}return r===p.C.FUNNELS&&a++,a}}],countDataForVariant:[function(t){return[t.experimentResults]},function(t){return function(n){var r="Can't find variant";if(!t)return r;var a=(t==null?void 0:t.insight).find(function(l){return l.breakdown_value===n});return a?a.count.toString():r}}],highestProbabilityVariant:[function(t){return[t.experimentResults]},function(t){if(t){var n=Math.max.apply(Math,_()(Object.values(t.probability)));return Object.keys(t.probability).find(function(r){return Math.abs(t.probability[r]-n)<Number.EPSILON})}}],areTrendResultsConfusing:[function(t){return[t.experimentResults,t.highestProbabilityVariant]},function(t,n){if(!t)return!1;var r=(t==null?void 0:t.insight).reduce(function(a,l){return l.count>a.count?l:a},{count:0,breakdown_value:""});return r.count?r.breakdown_value!==n:!1}]},urlToAction:function(n){var r=n.actions,a=n.values;return{"/experiments/:id":function(u,m,i,d,c){var h=u.id;if(!a.hasAvailableFeature(p.d.EXPERIMENTATION)){ie.router.actions.push("/experiments");return}var v=d.initial||d.pathname!==(c==null?void 0:c.pathname);if(r.setEditExperiment(!1),h&&v){var w=h==="new"?"new":parseInt(h);w==="new"&&(r.createNewExperimentInsight(),r.resetNewExperiment(),r.setSecondaryMetrics([])),w!=="new"&&w===a.experimentId&&r.loadExperiment()}}}}});function it(t){var n=Math.round(100/t),r=n*t,a=r-100,l=new Array(t).fill(n);return l[t-1]=n-a,l}var $e=o("./frontend/src/scenes/insights/InsightContainer.tsx"),K=o("./frontend/src/lib/components/icons.tsx"),Vt=o("./node_modules/@ant-design/icons/es/icons/ExclamationCircleFilled.js"),Se=o("./node_modules/@ant-design/icons/es/icons/CaretDownOutlined.js"),Ue=o("./node_modules/@ant-design/icons/es/icons/CloseOutlined.js"),Yt=o("./frontend/src/lib/components/CopyToClipboard.tsx"),$t=o("./node_modules/antd/es/modal/index.js");function st(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,a)}return r}function ne(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?st(Object(r),!0).forEach(function(a){xe()(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):st(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}var lt=14,ze={name:"",filters:{insight:p.C.TRENDS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}]}},Ut={name:"",filters:{insight:p.C.FUNNELS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}],layout:me.k.horizontal}},zt=Object(L.kea)({props:{},path:["scenes","experiment","secondaryMetricsLogic"],connect:{values:[Re.a,["currentTeamId"]]},actions:{setSecondaryMetrics:function(n){return{secondaryMetrics:n}},createNewMetric:!0,addNewMetric:function(n){return{metric:n}},updateMetricFilters:function(n){return{filters:n}},setFilters:function(n){return{filters:n}},setPreviewInsightId:function(n){return{shortId:n}},createPreviewInsight:function(n){return{filters:n}},showModal:!0,hideModal:!0,changeInsightType:function(n){return{type:n}},setCurrentMetricName:function(n){return{name:n}},deleteMetric:function(n){return{metricId:n}}},loaders:function(n){var r=n.values;return{experiments:[[],{loadExperiments:function(){var a=V()(I.a.mark(function u(){var m;return I.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,H.b.get("api/projects/".concat(r.currentTeamId,"/experiments"));case 2:return m=d.sent,d.abrupt("return",m.results);case 4:case"end":return d.stop()}},u)}));function l(){return a.apply(this,arguments)}return l}()}]}},reducers:function(n){var r=n.props;return{previewInsightId:[null,{setPreviewInsightId:function(l,u){var m=u.shortId;return m}}],metrics:[r.initialMetrics,{addNewMetric:function(l,u){var m=u.metric;return[].concat(_()(l),[ne({},m)])},deleteMetric:function(l,u){var m=u.metricId;return l.filter(function(i,d){return d!==m})}}],modalVisible:[!1,{showModal:function(){return!0},hideModal:function(){return!1}}],currentMetricName:["",{setCurrentMetricName:function(l,u){var m=u.name;return m}}],currentMetric:[ze,{changeInsightType:function(l,u){var m=u.type;return m===p.C.TRENDS?ze:l.filters.insight===p.C.TRENDS?Ut:ze},updateMetricFilters:function(l,u){var m=u.filters;return ne(ne({},l),{},{filters:m})}}]}},listeners:function(n){var r=n.actions,a=n.values,l=n.props;return{createPreviewInsight:function(){var u=V()(I.a.mark(function i(d){var c,h,v,w;return I.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return c=d.filters,(c==null?void 0:c.insight)===p.C.FUNNELS?h=Object(Ie.a)(ne({insight:p.C.FUNNELS,funnel_viz_type:p.y.Steps,display:p.j.FunnelViz,date_from:Object(C.a)().subtract(lt,"day").format("YYYY-MM-DD"),date_to:Object(C.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:me.k.horizontal},c)):h=Object(Ie.a)(ne({insight:p.C.TRENDS,date_from:Object(C.a)().subtract(lt,"day").format("YYYY-MM-DD"),date_to:Object(C.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},c)),v={description:"",tags:[],filters:h,result:null},s.next=5,H.b.create("api/projects/".concat(Re.a.values.currentTeamId,"/insights"),v);case 5:w=s.sent,r.setPreviewInsightId(w.short_id);case 7:case"end":return s.stop()}},i)}));function m(i){return u.apply(this,arguments)}return m}(),setFilters:function(m){var i=m.filters;if(i.insight===p.C.FUNNELS){var d;(d=je.a.findMounted({dashboardItemId:a.previewInsightId}))===null||d===void 0||d.actions.setFilters(i)}else{var c;(c=Ve.a.findMounted({dashboardItemId:a.previewInsightId}))===null||c===void 0||c.actions.setFilters(i)}},createNewMetric:function(){r.addNewMetric(ne(ne({},a.currentMetric),{},{name:a.currentMetricName})),l.onMetricsChange(a.metrics),r.changeInsightType(p.C.TRENDS),r.setCurrentMetricName("")},deleteMetric:function(){l.onMetricsChange(a.metrics)},changeInsightType:function(){return r.createPreviewInsight(a.currentMetric.filters)}}},events:function(n){var r=n.actions;return{afterMount:function(){r.createPreviewInsight()}}}}),U=o("./frontend/src/lib/components/LemonButton/index.ts"),Be=o("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx");function ot(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,a)}return r}function te(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ot(Object(r),!0).forEach(function(a){xe()(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ot(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}function Ce(t){var n=t.onMetricsChange,r=t.initialMetrics,a=zt({onMetricsChange:n,initialMetrics:r}),l=Object(L.useValues)(a),u=l.previewInsightId,m=l.metrics,i=l.modalVisible,d=l.currentMetric,c=Object(L.useActions)(a),h=c.createNewMetric,v=c.updateMetricFilters,w=c.setFilters,y=c.showModal,s=c.hideModal,M=c.changeInsightType,S=c.setCurrentMetricName,Y=c.deleteMetric,Q=Object(L.useValues)(Object(ce.c)({dashboardItemId:u,syncWithUrl:!1})),f=Q.insightProps,J=Object(L.useValues)(Object(je.a)(f)),X=J.isStepsEmpty,F=J.filterSteps;return e.a.createElement(e.a.Fragment,null,e.a.createElement($t.a,{title:"Add secondary metric",visible:i,destroyOnClose:!0,onCancel:s,footer:null,style:{minWidth:600}},e.a.createElement(W.a,{layout:"vertical",initialValues:{type:p.C.TRENDS},onValuesChange:function(D){D.name&&S(D.name)},onFinish:function(){h(),s()},scrollToFirstError:!0,requiredMark:!1},e.a.createElement(W.a.Item,{name:"name",label:"Name",rules:[{required:!0,message:"You have to enter a name."}]},e.a.createElement(we.a,null)),e.a.createElement(W.a.Item,{name:"type",label:"Type"},e.a.createElement(z.a,{style:{display:"flex"},value:d.filters.insight,onChange:function(){M()},suffixIcon:e.a.createElement(Se.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(z.a.Option,{value:p.C.TRENDS},e.a.createElement(g.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(z.a.Option,{value:p.C.FUNNELS},e.a.createElement(g.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel")))))),e.a.createElement(W.a.Item,{name:"query",label:"Query"},d.filters.insight===p.C.FUNNELS&&e.a.createElement(ae.a,{bordered:!0,filters:d.filters,setFilters:function(D){var k=te(te({},d.filters),{},{insight:p.C.FUNNELS},D);v(k),w(k)},typeKey:"funnel-preview-metric",mathAvailability:Be.b.None,hideDeleteBtn:F.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!X,seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[j.a.EventProperties,j.a.PersonProperties,j.a.EventFeatureFlags,j.a.Cohorts,j.a.Elements]}),d.filters.insight===p.C.TRENDS&&e.a.createElement(ae.a,{bordered:!0,entitiesLimit:1,filters:d.filters,setFilters:function(D){var k=te(te({},d.filters),{},{insight:p.C.TRENDS},D);v(k),w(k)},typeKey:"trend-preview-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,propertiesTaxonomicGroupTypes:[j.a.EventProperties,j.a.PersonProperties,j.a.EventFeatureFlags,j.a.Cohorts,j.a.Elements]})),e.a.createElement(W.a.Item,{name:"metric-preview",label:"Metric preview"},e.a.createElement(L.BindLogic,{logic:ce.c,props:f},e.a.createElement($e.a,{disableHeader:!0,disableTable:!0,disableCorrelationTable:!0}))),e.a.createElement(E.a,{justify:"end"},e.a.createElement(U.a,{type:"secondary",className:"mr-2",onClick:function(){return s()}},"Cancel"),e.a.createElement(U.a,{type:"primary",htmlType:"submit"},"Save")))),e.a.createElement(E.a,null,e.a.createElement(g.a,null,m.map(function(T,D){return e.a.createElement(E.a,{key:D,className:"mt-4 border rounded p-4"},e.a.createElement(E.a,{align:"middle",justify:"space-between",className:"w-full mb-3 pb-2 border-b"},e.a.createElement("div",null,e.a.createElement("b",null,T.name)),e.a.createElement(U.a,{icon:e.a.createElement(K.IconDelete,null),size:"small",status:"muted",onClick:function(){return Y(D)}})),T.filters.insight===p.C.FUNNELS&&e.a.createElement(ae.a,{bordered:!0,filters:T.filters,setFilters:function(re){var $=te(te({},T.filters),{},{insight:p.C.FUNNELS},re);v($),w($)},typeKey:"funnel-preview-".concat(D),mathAvailability:Be.b.None,hideDeleteBtn:F.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!X,seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[j.a.EventProperties,j.a.PersonProperties,j.a.EventFeatureFlags,j.a.Cohorts,j.a.Elements],readOnly:!0}),T.filters.insight===p.C.TRENDS&&e.a.createElement(ae.a,{bordered:!0,filters:T.filters,setFilters:function(re){var $=te(te({},T.filters),{},{insight:p.C.TRENDS},re);v($),w($)},typeKey:"trend-preview-".concat(D),buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,propertiesTaxonomicGroupTypes:[j.a.EventProperties,j.a.PersonProperties,j.a.EventFeatureFlags,j.a.Cohorts,j.a.Elements],readOnly:!0}))}),m&&!(m.length>2)&&e.a.createElement(g.a,null,e.a.createElement("div",{className:"mb-2 mt-4"},e.a.createElement(U.a,{type:"secondary",onClick:y},"Add metric"))))))}try{Ce.displayName="SecondaryMetrics",Ce.__docgenInfo={description:"",displayName:"SecondaryMetrics",props:{onMetricsChange:{defaultValue:null,description:"",name:"onMetricsChange",required:!0,type:{name:"(metrics: SecondaryExperimentMetric[]) => void"}},initialMetrics:{defaultValue:null,description:"",name:"initialMetrics",required:!0,type:{name:"SecondaryExperimentMetric[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"]={docgenInfo:Ce.__docgenInfo,name:"SecondaryMetrics",path:"frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"})}catch(t){}var ct=o("./frontend/src/lib/colors.ts"),Bt=o("./frontend/src/lib/components/EntityFilterInfo.tsx"),Gt=o("./frontend/src/lib/components/EditableField/EditableField.tsx"),Wt=o("./frontend/src/lib/components/Link.tsx"),Ht=o("./node_modules/antd/es/slider/index.js"),Kt=o("./node_modules/antd/es/input-number/index.js"),Jt=o("./frontend/src/lib/components/InsightLabel/index.tsx"),mt=o("./frontend/src/lib/components/PropertyFilters/components/PropertyFilterButton.tsx");function Qt(){var t=Object(oe.useState)(!1),n=le()(t,2),r=n[0],a=n[1],l=Object(oe.useState)(!1),u=le()(l,2),m=u[0],i=u[1];return e.a.createElement(ke.a,{className:"experiment-workflow",title:e.a.createElement("span",{className:"card-secondary"},"Experiment workflow")},e.a.createElement(E.a,null,e.a.createElement(g.a,{className:"exp-workflow-step step-completed w-full"},e.a.createElement(E.a,{align:"middle"},e.a.createElement(K.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}),e.a.createElement("b",{className:"ml-2"},"Create experiment")),e.a.createElement("div",{className:"ml-8"},"Set variants, select participants, and add secondary metrics"))),e.a.createElement(E.a,null,e.a.createElement(g.a,{className:"w-full exp-workflow-step ".concat(r?"step-completed":""),onClick:function(){return a(!r)}},e.a.createElement(E.a,{align:"middle"},r?e.a.createElement(K.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(K.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-2"},"Validate experiment")),e.a.createElement("div",{className:"ml-8"},"Once you've written your code, it's a good idea to test that each variant behaves as you'd expect."))),e.a.createElement(E.a,null,e.a.createElement(g.a,{className:"w-full exp-workflow-step ".concat(m?"step-completed":""),onClick:function(){return i(!m)}},e.a.createElement(E.a,{align:"middle"},m?e.a.createElement(K.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(K.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-2"},"Launch experiment")),e.a.createElement("div",{className:"ml-8"},"Run your experiment, monitor results, and decide when to terminate your experiment."))))}function ve(t){var n,r,a,l,u,m,i=t.experiment,d=t.trendCount,c=t.funnelConversionRate,h=t.trendExposure,v=t.funnelSampleSize,w=t.funnelEntrants,y=(i==null?void 0:i.id)||"new",s=Object(L.useValues)(fe({experimentId:y})),M=s.experimentInsightType,S=s.editingExistingExperiment,Y=s.minimumDetectableChange,Q=s.expectedRunningTime,f=s.aggregationLabel,J=Object(L.useActions)(fe({experimentId:y})),X=J.setNewExperimentData,F=M===p.C.FUNNELS&&100-c<50?100-c:50,T=Object(C.a)().diff(Object(C.a)(i==null?void 0:i.start_date),"hour"),D=0;i!=null&&i.start_date?D=Q(w||1,v||0,T):D=Q(w||1,v||0);var k=Object(C.a)(i==null?void 0:i.start_date).add(D,"hour"),re=!(i!=null&&i.end_date)&&T>=24&&w&&v,$=Object(O.r)(i==null||(n=i.filters)===null||n===void 0?void 0:n.properties);return e.a.createElement(E.a,null,e.a.createElement(g.a,{span:!(i!=null&&i.start_date)&&y!=="new"&&!S?12:24},y==="new"&&e.a.createElement(E.a,{className:"experiment-preview-row"},e.a.createElement("div",null,e.a.createElement("div",null,e.a.createElement("b",null,"Experiment preview")),e.a.createElement("div",{className:"text-muted"},"Here are the baseline metrics for your experiment. Adjust your minimum detectible threshold to adjust for the smallest conversion value you\u2019ll accept, and the experiment duration."," "))),(y==="new"||S)&&e.a.createElement(E.a,{className:"mb-4"},e.a.createElement(g.a,{span:24},e.a.createElement("div",null,e.a.createElement("b",null,"Minimum acceptable improvement"),e.a.createElement(Ne.a,{title:"Minimum acceptable improvement is a calculation that estimates the smallest significant improvement you are willing to accept."},e.a.createElement(ue.a,{style:{marginLeft:4}}))),e.a.createElement(E.a,{className:"mde-slider"},e.a.createElement(g.a,{span:8},e.a.createElement(Ht.a,{defaultValue:5,value:Y,min:1,max:F,trackStyle:{background:"var(--primary)"},handleStyle:{background:"var(--primary)"},onChange:function(R){X({parameters:{minimum_detectable_effect:R}})},tipFormatter:function(R){return"".concat(R,"%")}})),e.a.createElement(Kt.a,{min:1,max:F,defaultValue:5,formatter:function(R){return"".concat(R,"%")},style:{margin:"0 16px"},value:Y,onChange:function(R){X({parameters:{minimum_detectable_effect:R}})}})))),e.a.createElement(E.a,{className:"experiment-preview-row ".concat(i!=null&&i.start_date?"mr":"")},M===p.C.TRENDS?e.a.createElement(e.a.Fragment,null,!(i!=null&&i.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Baseline Count"),e.a.createElement("div",{className:"l4"},Object(O.P)(d||0))),e.a.createElement(g.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Count"),e.a.createElement("div",{className:"l4"},Object(O.P)(d+Math.ceil(d*(Y/100))||0)))),e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",Object(O.P)(h||0))," days"))):e.a.createElement(e.a.Fragment,null,!(i!=null&&i.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Baseline Conversion Rate"),e.a.createElement("div",{className:"l4"},c.toFixed(1),"%")),e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Conversion Rate"),e.a.createElement("div",{className:"l4"},(c+Y).toFixed(1),"%"))),e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended Sample Size"),e.a.createElement("div",{className:"pb-4"},e.a.createElement("span",{className:"l4"},"~",Object(O.P)(v||0))," persons")),!(i!=null&&i.start_date)&&e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",Object(O.P)(D||0))," days"))),e.a.createElement(E.a,{className:"w-full mt-4"},e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Experiment variants"),e.a.createElement("ul",{className:"variants-list"},i==null||(r=i.parameters)===null||r===void 0||(a=r.feature_flag_variants)===null||a===void 0?void 0:a.map(function(A,R){return e.a.createElement("li",{key:R},A.key)}))),e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Participants"),e.a.createElement("div",null,$!=null&&$.length?e.a.createElement("div",null,$==null?void 0:$.map(function(A){return e.a.createElement(mt.a,{key:A.key,item:A,style:{margin:2,cursor:"default"}})})):e.a.createElement(e.a.Fragment,null,"100% of"," ",(i==null||(l=i.filters)===null||l===void 0?void 0:l.aggregation_group_type_index)!=null?Object(O.i)(f(i.filters.aggregation_group_type_index).plural):"users")))),e.a.createElement(E.a,{className:"w-full"},y!=="new"&&!S&&e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary mt-4"},"Start date"),i!=null&&i.start_date?e.a.createElement("span",null,Object(C.a)(i==null?void 0:i.start_date).format("D MMM YYYY")):e.a.createElement("span",{className:"description"},"Not started yet")),M===p.C.FUNNELS&&re?e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary mt-4"},"Expected end date"),e.a.createElement("span",null,k.isAfter(Object(C.a)())?k.format("D MMM YYYY"):Object(C.a)().format("D MMM YYYY"))):null,(i==null?void 0:i.end_date)&&e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"card-secondary mt-4"},"Completed date"),e.a.createElement("span",null,Object(C.a)(i==null?void 0:i.end_date).format("D MMM YYYY"))))),y!=="new"&&!S&&e.a.createElement(E.a,{className:"experiment-preview-row"},e.a.createElement(g.a,null,e.a.createElement("div",{className:"card-secondary mb-2"},M===p.C.FUNNELS?"Conversion goal steps":"Trend goal"),[].concat(_()((i==null||(u=i.filters)===null||u===void 0?void 0:u.events)||[]),_()((i==null||(m=i.filters)===null||m===void 0?void 0:m.actions)||[])).sort(function(A,R){return(A.order||0)-(R.order||0)}).map(function(A,R){var Ee;return e.a.createElement(g.a,{key:R,className:"mb-2"},e.a.createElement(E.a,{style:{marginBottom:4}},e.a.createElement("div",{className:"preview-conversion-goal-num"},M===p.C.FUNNELS?(A.order||0)+1:R+1),e.a.createElement("b",null,e.a.createElement(Jt.a,{action:A,showCountedByTag:M===p.C.TRENDS,hideIcon:!0}))),(Ee=A.properties)===null||Ee===void 0?void 0:Ee.map(function(Te){return e.a.createElement(mt.a,{key:Te.key,item:Te})}))})))),y!=="new"&&!S&&!(i!=null&&i.start_date)&&e.a.createElement(g.a,{span:12,className:"pl-4"},e.a.createElement(Qt,null)))}try{ve.displayName="ExperimentPreview",ve.__docgenInfo={description:"",displayName:"ExperimentPreview",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}},trendCount:{defaultValue:null,description:"",name:"trendCount",required:!0,type:{name:"number"}},trendExposure:{defaultValue:null,description:"",name:"trendExposure",required:!1,type:{name:"number"}},funnelSampleSize:{defaultValue:null,description:"",name:"funnelSampleSize",required:!1,type:{name:"number"}},funnelConversionRate:{defaultValue:null,description:"",name:"funnelConversionRate",required:!0,type:{name:"number"}},funnelEntrants:{defaultValue:null,description:"",name:"funnelEntrants",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"]={docgenInfo:ve.__docgenInfo,name:"ExperimentPreview",path:"frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"})}catch(t){}var Fe=o("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx");function ge(t){var n,r,a,l=t.experiment,u=Object(oe.useState)("control"),m=le()(u,2),i=m[0],d=m[1];return e.a.createElement(ke.a,{title:e.a.createElement("span",{className:"card-secondary"},"Feature flag usage and implementation"),className:"experiment-implementation-details"},e.a.createElement(E.a,{justify:"space-between",className:"mb-2"},e.a.createElement("div",null,e.a.createElement("span",{className:"mr-2"},"Variant group"),e.a.createElement(z.a,{onChange:d,defaultValue:"control",suffixIcon:e.a.createElement(Se.a,null)},l==null||(n=l.parameters)===null||n===void 0||(r=n.feature_flag_variants)===null||r===void 0?void 0:r.map(function(c,h){return e.a.createElement(z.a.Option,{key:h,value:c.key},c.key)}))),e.a.createElement("div",null,e.a.createElement(ft,null))),e.a.createElement("b",null,"Implement your experiment in code"),e.a.createElement(Fe.a,{language:Fe.b.JavaScript,wrap:!0},"if (posthog.getFeatureFlag('".concat((a=l==null?void 0:l.feature_flag_key)!==null&&a!==void 0?a:"","') === '").concat(i,`') {
    // where '`).concat(i,`' is the variant, run your code here
}`)),e.a.createElement("b",null,"Test that it works"),e.a.createElement(Fe.a,{language:Fe.b.JavaScript},"posthog.feature_flags.override({'".concat(l==null?void 0:l.feature_flag_key,"': '").concat(i,"'})")),e.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://posthog.com/docs/user-guides/feature-flags"},e.a.createElement(E.a,{align:"middle"},"Experiment implementation guide",e.a.createElement(K.IconOpenInNew,{className:"ml-2"}))))}try{ge.displayName="ExperimentImplementationDetails",ge.__docgenInfo={description:"",displayName:"ExperimentImplementationDetails",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"]={docgenInfo:ge.__docgenInfo,name:"ExperimentImplementationDetails",path:"frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"})}catch(t){}var Xt=o("./frontend/@posthog/lemon-ui/src/index.ts"),Zt=o("./frontend/src/lib/components/NotFound/index.tsx"),dt=o("./frontend/src/lib/components/AlertMessage/index.ts");function ut(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);n&&(a=a.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),r.push.apply(r,a)}return r}function Oe(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ut(Object(r),!0).forEach(function(a){xe()(t,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ut(Object(r)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(r,a))})}return t}var qt={component:pt,logic:fe,paramsToProps:function(n){var r=n.params.id;return{experimentId:r==="new"?"new":parseInt(r)}}};function pt(){var t,n,r,a,l,u,m,i,d,c,h,v=Object(L.useValues)(fe),w=v.experimentId,y=v.newExperimentData,s=v.experimentData,M=v.experimentInsightId,S=v.minimumSampleSizePerVariant,Y=v.recommendedExposureForCountData,Q=v.variants,f=v.experimentResults,J=v.countDataForVariant,X=v.editingExistingExperiment,F=v.experimentInsightType,T=v.experimentResultsLoading,D=v.parsedSecondaryMetrics,k=v.areResultsSignificant,re=v.conversionRateForVariant,$=v.getIndexForVariant,A=v.significanceBannerDetails,R=v.areTrendResultsConfusing,Ee=v.taxonomicGroupTypesForSelection,Te=v.groupTypes,_t=v.aggregationLabel,Z=v.secondaryMetricResults,en=v.experimentDataLoading,tn=v.secondaryMetricResultsLoading,vt=v.experimentResultCalculationError,nn=v.flagImplementationWarning,rn=v.flagAvailabilityWarning,B=Object(L.useActions)(fe),he=B.setNewExperimentData,an=B.createExperiment,sn=B.launchExperiment,Me=B.setFilters,ln=B.setEditExperiment,gt=B.endExperiment,on=B.addExperimentGroup,cn=B.updateExperiment,mn=B.updateExperimentGroup,dn=B.removeExperimentGroup,un=B.setSecondaryMetrics,pn=B.setExperimentInsightType,fn=B.archiveExperiment,vn=W.a.useForm(),gn=le()(vn,1),En=gn[0],hn=Object(oe.useState)(!0),Et=le()(hn,2),Ge=Et[0],We=Et[1],yn=Object(L.useValues)(Object(ce.c)({dashboardItemId:M})),He=yn.insightProps,ye=Object(L.useValues)(Object(je.a)(He)),xn=ye.isStepsEmpty,bn=ye.filterSteps,ht=ye.filters,Ke=ye.results,wn=ye.conversionMetrics,yt=Object(L.useValues)(Object(Ve.a)(He)),xt=yt.filters,Nn=yt.results,Je=wn.totalRate*100,jn=S(Je),bt=jn*Q.length,Qe=(t=Nn[0])===null||t===void 0?void 0:t.count,wt=Ke==null||(n=Ke[0])===null||n===void 0?void 0:n.count,Nt=Y(Qe),se=Math.floor(24/(Q.length+2)),De=F===p.C.FUNNELS&&f!==null&&f!==void 0&&f.insight?f.insight.reduce(function(N,x){var P;return((P=x[0])===null||P===void 0?void 0:P.count)+N},0):0,In=F===p.C.FUNNELS?(De||0)/((s==null||(r=s.parameters)===null||r===void 0?void 0:r.recommended_sample_size)||1)*100:Object(C.a)().diff(s==null?void 0:s.start_date,"day")/((s==null||(a=s.parameters)===null||a===void 0?void 0:a.recommended_running_time)||1)*100,Sn={running:"green",draft:"default",complete:"purple"},jt=function(){if(s!=null&&s.start_date){if(!(s!=null&&s.end_date))return"running"}else return"draft";return"complete"},Cn=[{background:"#35416b",color:"#fff"},{background:"#C278CE66",color:"#35416B"},{background:"#FFE6AE",color:"#35416B"},{background:"#8DA9E74D",color:"#35416B"}];return en?e.a.createElement(be.a,{active:!0}):!s&&w!=="new"?e.a.createElement(Zt.a,{object:"experiment"}):e.a.createElement(e.a.Fragment,null,w==="new"||X?e.a.createElement(e.a.Fragment,null,e.a.createElement(E.a,{align:"middle",justify:"space-between",style:{borderBottom:"1px solid var(--border)",marginBottom:"1rem",paddingBottom:8}},e.a.createElement(tt.a,{title:X?"Edit experiment":"New experiment"}),e.a.createElement(E.a,null,e.a.createElement(U.a,{type:"secondary",className:"mr-2",onClick:s?function(){return ie.router.actions.push(ee.a.experiment(s.id))}:function(){return ie.router.actions.push(ee.a.experiments())}},"Cancel"),e.a.createElement(U.a,{type:"primary",htmlType:"submit",form:"new-experiment"},"Save"))),e.a.createElement(W.a,{name:"new-experiment",layout:"vertical",className:"experiment-form",form:En,onValuesChange:function(x){return he(x)},initialValues:{name:y==null?void 0:y.name,feature_flag_key:y==null?void 0:y.feature_flag_key,description:y==null?void 0:y.description},onFinish:function(){return an(!0,Nt,bt)},requiredMark:!1,scrollToFirstError:!0},e.a.createElement("div",null,e.a.createElement(L.BindLogic,{logic:ce.c,props:He},e.a.createElement(E.a,null,e.a.createElement(g.a,{span:12,style:{paddingRight:24}},e.a.createElement(E.a,{className:"w-full"},e.a.createElement(W.a.Item,{style:{marginRight:16},label:"Name",name:"name",rules:[{required:!0,message:"You have to enter a name."}]},e.a.createElement(we.a,{"data-attr":"experiment-name",className:"ph-ignore-input"})),e.a.createElement(W.a.Item,{style:{marginBottom:"1rem"},label:e.a.createElement("div",null,"Feature flag key"," ",e.a.createElement(Ne.a,{title:"Enter a unique key. This will create a new feature flag which will be associated with this experiment."},e.a.createElement(ue.a,null))),name:"feature_flag_key",rules:[{required:!0,message:"You have to enter a feature flag key name."}]},e.a.createElement(we.a,{"data-attr":"experiment-feature-flag-key",disabled:X}))),e.a.createElement(W.a.Item,{label:e.a.createElement("div",null,"Description ",e.a.createElement("span",{className:"text-muted"},"(optional)")),name:"description"},e.a.createElement(Xt.LemonTextArea,{"data-attr":"experiment-description",className:"ph-ignore-input",placeholder:"Adding a helpful description can ensure others know what this experiment is about."})),(y==null||(l=y.parameters)===null||l===void 0?void 0:l.feature_flag_variants)&&e.a.createElement(g.a,null,e.a.createElement("label",null,e.a.createElement("b",null,"Experiment variants")),e.a.createElement("div",{className:"text-muted"},"Participants are divided into variant groups evenly. All experiments must consist of a control group and at least one test group. Experiments may have at most 3 test groups. Variant names can only contain letters, numbers, hyphens, and underscores."),e.a.createElement(g.a,{className:"variants"},y.parameters.feature_flag_variants.map(function(N,x){return e.a.createElement(W.a,{key:"".concat(N,"-").concat(x),initialValues:{key:N.key},onValuesChange:function(G){mn(G,x)}},e.a.createElement(E.a,{key:"".concat(N,"-").concat(x),className:"feature-flag-variant ".concat(x===0?"border-t":x>=3?"border-b":"")},e.a.createElement("div",{className:"variant-label",style:Oe({},Cn[x])},x===0?"Control":"Test"),e.a.createElement(W.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{required:!0,pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:e.a.createElement(e.a.Fragment,null,e.a.createElement(Vt.a,{style:{color:"#F96132"}})," ","Variant names can only contain letters, numbers, hyphens, and underscores.")}],style:{display:"contents"}},e.a.createElement(we.a,{disabled:x===0,"data-attr":"feature-flag-variant-key","data-key-index":x.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(x+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),e.a.createElement("div",{className:"float-right"},!(x===0||x===1)&&e.a.createElement(Ne.a,{title:"Delete this variant",placement:"bottomLeft"},e.a.createElement(U.a,{status:"primary-alt",size:"small",icon:e.a.createElement(K.IconDelete,null),onClick:function(){return dn(x)}})))))}),y.parameters.feature_flag_variants.length<4&&e.a.createElement("div",{className:"feature-flag-variant border-b"},e.a.createElement(U.a,{onClick:function(){return on()},fullWidth:!0,icon:e.a.createElement(K.IconPlusMini,null)},"Add test variant")))),e.a.createElement(E.a,{className:"person-selection"},e.a.createElement("div",{className:"mb-2"},e.a.createElement("strong",null,"Select participants")),e.a.createElement(g.a,null,e.a.createElement("div",{className:"text-muted"},"Select the entities who will participate in this experiment. If no filters are set, 100% of participants will be targeted."),e.a.createElement("div",{className:"mt-4 mb-2"},e.a.createElement("strong",null,"Participant type")),e.a.createElement(z.a,{value:(y==null||(u=y.filters)===null||u===void 0?void 0:u.aggregation_group_type_index)!=null?y.filters.aggregation_group_type_index:-1,onChange:function(x){var P,G=x!==-1?x:void 0;G!=(y==null||(P=y.filters)===null||P===void 0?void 0:P.aggregation_group_type_index)&&(Me({properties:[],aggregation_group_type_index:G}),he({filters:{aggregation_group_type_index:G,properties:[]}}))},"data-attr":"participant-aggregation-filter",dropdownMatchSelectWidth:!1},e.a.createElement(z.a.Option,{key:-1,value:-1},"Persons"),Te.map(function(N){return e.a.createElement(z.a.Option,{key:N.group_type_index,value:N.group_type_index},Object(O.i)(_t(N.group_type_index).plural))})),e.a.createElement("div",{className:"mt-4 mb-2"},e.a.createElement("strong",null,"Filters")),e.a.createElement("div",{className:"mb-4"},e.a.createElement(Ct.a,{pageKey:"experiment-participants-property",propertyFilters:F===p.C.FUNNELS?Object(O.r)(ht.properties):Object(O.r)(xt.properties),onChange:function(x){he({filters:{properties:x}}),Me({properties:x.filter(Ft.b)})},taxonomicGroupTypes:Ee})),rn&&e.a.createElement(dt.a,{type:"info",className:"mt-3 mb-3"},"These properties aren't immediately available on first page load for unidentified persons. This experiment requires that at least one event is sent prior to becoming available to your product or website."," ",e.a.createElement("a",{href:"https://posthog.com/docs/integrate/client/js#bootstrapping-flags",target:"_blank"}," ","Learn more about how to make feature flags available instantly."))))),e.a.createElement(E.a,{className:"metrics-selection"},e.a.createElement(g.a,{span:12},e.a.createElement("div",{className:"mb-2","data-attr":"experiment-goal-type"},e.a.createElement("b",null,"Goal type"),e.a.createElement("div",{className:"text-muted"},F===p.C.TRENDS?"Track counts of a specific event or action":"Track how many persons complete a sequence of actions and or events")),e.a.createElement(z.a,{style:{display:"flex"},value:F,onChange:pn,suffixIcon:e.a.createElement(Se.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(z.a.Option,{value:p.C.TRENDS},e.a.createElement(g.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(z.a.Option,{value:p.C.FUNNELS},e.a.createElement(g.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel"))))),e.a.createElement("div",{className:"my-4"},e.a.createElement("b",null,"Experiment goal"),F===p.C.TRENDS&&e.a.createElement("div",{className:"text-muted"},"Trend-based experiments can have at most one graph series. This metric is used to track the progress of your experiment.")),nn&&e.a.createElement(dt.a,{type:"info",className:"mt-3 mb-3"},"We can't detect any feature flag information for this target metric. Ensure that you're using the latest PostHog client libraries, and make sure you manually send feature flag information for server-side libraries if necessary."," ",e.a.createElement("a",{href:"https://posthog.com/docs/integrate/server/python#capture",target:"_blank"}," ","Read the docs for how to do this for server-side libraries.")),F===p.C.FUNNELS&&e.a.createElement(ae.a,{bordered:!0,filters:ht,setFilters:function(x){he({filters:x}),Me(x)},typeKey:"experiment-funnel-goal",mathAvailability:Be.b.None,hideDeleteBtn:bn.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!xn,seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[j.a.EventProperties,j.a.PersonProperties,j.a.EventFeatureFlags,j.a.Cohorts,j.a.Elements]}),F===p.C.TRENDS&&e.a.createElement(ae.a,{bordered:!0,filters:xt,setFilters:function(x){he({filters:x}),Me(x)},typeKey:"experiment-trends",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideDeleteBtn:!0,propertiesTaxonomicGroupTypes:[j.a.EventProperties,j.a.PersonProperties,j.a.EventFeatureFlags,j.a.Cohorts,j.a.Elements]}),e.a.createElement(E.a,{className:"secondary-metrics"},e.a.createElement("div",{className:"flex flex-col"},e.a.createElement("div",null,e.a.createElement("b",null,"Secondary metrics"),e.a.createElement("span",{className:"text-muted ml-2"},"(optional)")),e.a.createElement("div",{className:"text-muted",style:{marginTop:4}},"Use secondary metrics to monitor metrics related to your experiment goal. You can add up to three secondary metrics."," "),e.a.createElement(Ce,{onMetricsChange:function(x){return un(x)},initialMetrics:D})))),e.a.createElement(g.a,{span:12,className:"pl-4"},e.a.createElement("div",{className:"card-secondary mb-4","data-attr":"experiment-preview"},"Goal preview"),e.a.createElement($e.a,{disableHeader:F===p.C.TRENDS,disableTable:!0,disableCorrelationTable:!0})))),e.a.createElement(E.a,null,e.a.createElement(ke.a,{className:"experiment-preview"},e.a.createElement(ve,{experiment:y,trendCount:Qe,trendExposure:Nt,funnelSampleSize:bt,funnelEntrants:wt,funnelConversionRate:Je}))))),e.a.createElement(U.a,{className:"float-right",type:"primary",htmlType:"submit"},"Save"))):s?e.a.createElement("div",{className:"view-experiment"},e.a.createElement(E.a,{className:"draft-header"},e.a.createElement(E.a,{justify:"space-between",align:"middle",className:"w-full pb-4"},e.a.createElement(g.a,null,e.a.createElement(E.a,null,e.a.createElement(tt.a,{style:{paddingRight:8},title:"".concat(s==null?void 0:s.name),buttons:e.a.createElement(e.a.Fragment,null,e.a.createElement(Yt.a,{explicitValue:s.feature_flag_key,iconStyle:{color:"var(--muted-alt)"}},e.a.createElement("span",{className:"text-muted"},s.feature_flag_key)),e.a.createElement(qe.a,{style:{alignSelf:"center"},color:Sn[jt()]},e.a.createElement("b",{className:"uppercase"},jt())),f&&s.end_date&&e.a.createElement(qe.a,{style:{alignSelf:"center"},color:k?"green":"geekblue"},e.a.createElement("b",{className:"uppercase"},k?"Significant Results":"Results not significant")))})),e.a.createElement("span",{className:"exp-description"},s.start_date?e.a.createElement(Gt.a,{multiline:!0,name:"description",value:s.description||"",placeholder:"Description (optional)",onSave:function(x){return cn({description:x})},maxLength:400,"data-attr":"experiment-description",compactButtons:!0}):e.a.createElement(e.a.Fragment,null,s.description||"There is no description for this experiment."))),s&&!s.start_date&&e.a.createElement("div",{className:"flex items-center"},e.a.createElement(U.a,{type:"secondary",className:"mr-2",onClick:function(){return ln(!0)}},"Edit"),e.a.createElement(U.a,{type:"primary",onClick:function(){return sn()}},"Launch")),s&&s.start_date&&!s.end_date&&e.a.createElement(U.a,{type:"secondary",status:"danger",onClick:function(){return gt()}},"Stop"),(s==null?void 0:s.end_date)&&Object(C.a)().isSameOrAfter(Object(C.a)(s.end_date),"day")&&!s.archived&&e.a.createElement(U.a,{type:"secondary",status:"danger",onClick:function(){return fn()}},e.a.createElement("b",null,"Archive")))),e.a.createElement(E.a,null,Ge&&f&&k&&!s.end_date&&e.a.createElement(E.a,{align:"middle",className:"significant-results"},e.a.createElement(g.a,{span:20,style:{fontWeight:500,color:"#497342"}},e.a.createElement("div",null,"Experiment results are significant."," ",s.end_date?"":"You can end your experiment now or let it run until complete.")),e.a.createElement(g.a,{span:4},s.end_date?e.a.createElement(Ue.a,{className:"close-button",onClick:function(){return We(!1)}}):e.a.createElement(U.a,{type:"primary",onClick:function(){return gt()}},"End experiment"))),Ge&&f&&!k&&!s.end_date&&e.a.createElement(E.a,{align:"top",className:"not-significant-results"},e.a.createElement(g.a,{span:23,style:{fontWeight:500,color:"#2D2D2D"}},e.a.createElement("strong",null,"Your results are not statistically significant"),"."," ",A," ",s!=null&&s.end_date?"":"We don't recommend ending this experiment yet."," ","See our"," ",e.a.createElement("a",{href:"https://posthog.com/docs/user-guides/experimentation#funnel-experiment-calculations"}," ","experimentation guide"," "),"for more information."," "),e.a.createElement(g.a,{span:1},e.a.createElement(Ue.a,{className:"close-button",onClick:function(){return We(!1)}}))),Ge&&s.end_date&&e.a.createElement(E.a,{align:"top",className:"feature-flag-mods"},e.a.createElement(g.a,{span:23,style:{fontWeight:500}},e.a.createElement("strong",null,"Your experiment is complete, but the feature flag is still enabled.")," ","We recommend removing the feature flag from your code completely, instead of relying on this distribution."," ",e.a.createElement(Wt.a,{to:s.feature_flag?ee.a.featureFlag(s.feature_flag):void 0},e.a.createElement("b",null,"Adjust feature flag distribution"))),e.a.createElement(g.a,{span:1},e.a.createElement(Ue.a,{className:"close-button",onClick:function(){return We(!1)}})))),e.a.createElement(E.a,null,e.a.createElement(_e.a,{className:"w-full",defaultActiveKey:"experiment-details"},e.a.createElement(_e.a.Panel,{header:e.a.createElement("b",null,"Experiment details"),key:"experiment-details"},e.a.createElement(E.a,null,e.a.createElement(g.a,{span:s!=null&&s.start_date?12:24},e.a.createElement(ve,{experiment:s,trendCount:Qe,trendExposure:s==null?void 0:s.parameters.recommended_running_time,funnelSampleSize:s==null?void 0:s.parameters.recommended_sample_size,funnelConversionRate:Je,funnelEntrants:s!=null&&s.start_date?De:wt})),!T&&!f&&s.start_date&&e.a.createElement(g.a,{span:12},e.a.createElement(ge,{experiment:s})),(f||((m=s.secondary_metrics)===null||m===void 0?void 0:m.length)>0)&&e.a.createElement(g.a,{className:"secondary-progress",span:s!=null&&s.start_date?12:24},!!(s!=null&&s.secondary_metrics.length)&&e.a.createElement(g.a,{className:"border-b"},e.a.createElement(E.a,{align:"middle",justify:"space-between",className:"mb-2"},e.a.createElement(g.a,{className:"card-secondary",span:2*se},"Secondary metrics"),s==null||(i=s.parameters)===null||i===void 0||(d=i.feature_flag_variants)===null||d===void 0?void 0:d.map(function(N,x){return e.a.createElement(g.a,{key:x,span:se,style:{color:Object(ct.c)($(N.key,F))}},e.a.createElement("span",{className:"text-sm"},Object(O.i)(N.key)))})),s.start_date?tn?e.a.createElement(be.a,{active:!0,paragraph:!1}):e.a.createElement(e.a.Fragment,null,s.secondary_metrics.map(function(N,x){var P,G;return e.a.createElement(E.a,{className:"border-t",key:x,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement(g.a,{span:2*se},Object(O.i)(N.name)),s==null||(P=s.parameters)===null||P===void 0||(G=P.feature_flag_variants)===null||G===void 0?void 0:G.map(function(Pe,Xe){return e.a.createElement(g.a,{key:Xe,span:se},Z!=null&&Z[x][Pe.key]?N.filters.insight===p.C.FUNNELS?e.a.createElement(e.a.Fragment,null,((Z==null?void 0:Z[x][Pe.key])*100).toFixed(1),"%"):e.a.createElement(e.a.Fragment,null,Object(O.P)(Z==null?void 0:Z[x][Pe.key])):e.a.createElement(e.a.Fragment,null,"--"))}))})):e.a.createElement(e.a.Fragment,null,s.secondary_metrics.map(function(N,x){var P,G;return e.a.createElement(E.a,{className:"border-t",key:x,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement(g.a,{span:2*se},Object(O.i)(N.name)),s==null||(P=s.parameters)===null||P===void 0||(G=P.feature_flag_variants)===null||G===void 0?void 0:G.map(function(Pe,Xe){return e.a.createElement(g.a,{key:Xe,span:se},"--")}))}))),f&&e.a.createElement(g.a,{className:"mt-4"},e.a.createElement("div",{className:"mb-2"},e.a.createElement("b",null,"Experiment progress")),e.a.createElement(et.a,{strokeWidth:20,showInfo:!1,percent:In,strokeColor:"var(--success)"}),F===p.C.TRENDS&&s.start_date&&e.a.createElement(E.a,{justify:"space-between",className:"mt-2"},s.end_date?e.a.createElement("div",null,"Ran for"," ",e.a.createElement("b",null,Object(C.a)(s.end_date).diff(s.start_date,"day"))," ","days"):e.a.createElement("div",null,e.a.createElement("b",null,Object(C.a)().diff(s.start_date,"day"))," ","days running"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,s==null||(c=s.parameters)===null||c===void 0?void 0:c.recommended_running_time)," ","days")),F===p.C.FUNNELS&&e.a.createElement(E.a,{justify:"space-between",className:"mt-2"},s.end_date?e.a.createElement("div",null,"Saw"," ",e.a.createElement("b",null,Object(O.P)(De))," ","participants"):e.a.createElement("div",null,e.a.createElement("b",null,Object(O.P)(De))," ","participants seen"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,Object(O.P)((s==null||(h=s.parameters)===null||h===void 0?void 0:h.recommended_sample_size)||0))," ","participants"))))))),!(s!=null&&s.start_date)&&e.a.createElement("div",{className:"mt-4 w-full"},e.a.createElement(ge,{experiment:s}))),e.a.createElement("div",{className:"experiment-result"},f?e.a.createElement(e.a.Fragment,null,e.a.createElement(E.a,{justify:"space-around",style:{flexFlow:"nowrap"}},Object.keys(f.probability).sort(function(N,x){return f.probability[x]-f.probability[N]}).map(function(N,x){return e.a.createElement(g.a,{key:x,className:"pr-4"},e.a.createElement("div",null,e.a.createElement("b",null,Object(O.i)(N))),F===p.C.TRENDS?e.a.createElement(E.a,null,e.a.createElement("b",{style:{paddingRight:4}},e.a.createElement(E.a,null,"action"in f.insight[0]&&e.a.createElement(Bt.a,{filter:f.insight[0].action}),e.a.createElement("span",{style:{paddingLeft:4}},"count:")))," ",J(N)," ",R&&x===0&&e.a.createElement(Ne.a,{placement:"right",title:"It might seem confusing that the best variant has lower absolute count, but this can happen when fewer people are exposed to this variant, so its relative count is higher."},e.a.createElement(ue.a,{style:{padding:"4px 2px"}}))):e.a.createElement(E.a,null,e.a.createElement("b",{style:{paddingRight:4}},"Conversion rate:")," ",re(N),"%"),e.a.createElement(et.a,{percent:Number((f.probability[N]*100).toFixed(1)),size:"small",showInfo:!1,strokeColor:Object(ct.c)($(N,F))}),e.a.createElement("div",null,"Probability that this variant is the best:"," ",e.a.createElement("b",null,(f.probability[N]*100).toFixed(1),"%")))}))):T&&e.a.createElement("div",{className:"text-center"},e.a.createElement(be.a,{active:!0})),f?e.a.createElement(L.BindLogic,{logic:ce.c,props:{dashboardItemId:f.itemID,cachedInsight:{short_id:f.itemID,filters:Oe(Oe(Oe({},f.filters),{},{insight:F,display:s.filters.display},F===p.C.FUNNELS&&{layout:me.k.vertical,funnel_viz_type:p.y.Steps}),F===p.C.TRENDS&&{display:p.j.ActionsLineGraphCumulative}),result:f.insight,disable_baseline:!0},doNotLoad:!0}},e.a.createElement("div",{className:"mt-4"},e.a.createElement($e.a,{disableHeader:!0,disableCorrelationTable:F===p.C.FUNNELS,disableLastComputation:!0}))):s.start_date&&e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"no-experiment-results"},!T&&e.a.createElement("div",{className:"text-center"},e.a.createElement("b",null,"There are no results for this experiment yet."),e.a.createElement("div",{className:"text-sm "},!!vt&&"".concat(vt,". ")," ","Wait a bit longer for your users to be exposed to the experiment. Double check your feature flag implementation if you're still not seeing results.")))))):e.a.createElement(be.a,{active:!0}))}function ft(){return e.a.createElement(z.a,{defaultValue:"JavaScript",suffixIcon:e.a.createElement(Se.a,null)},e.a.createElement(z.a.Option,{value:"JavaScript"},e.a.createElement(E.a,{align:"middle"},e.a.createElement(K.IconJavascript,{style:{marginRight:6}})," JavaScript")))}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss":function(Le,q,o){var Ze=o("./node_modules/css-loader/dist/runtime/api.js");q=Ze(!1),q.push([Le.i,'.experiment-form .metrics-selection,.experiment-form .person-selection{border-top:1px solid var(--border);padding-top:1rem;width:100%}.experiment-form .person-selection{align-items:center;justify-content:space-between}.experiment-form .insights-graph-container{margin-bottom:1rem;background-color:#fff}.experiment-form .insights-graph-container .ant-card-head{border-bottom:1px solid var(--border);min-height:unset;background-color:var(--bg-light);padding-left:1rem;padding-right:1rem}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title{padding:.5rem 0}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter{font-size:14px}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter:not(:last-child),.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter span.head-title-item{margin-right:.5rem}.experiment-form .insights-graph-container .display-config-inner{display:flex;align-items:center;justify-content:space-between;overflow-x:auto}.experiment-form .insights-graph-container .ant-card-body{padding:0}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left{width:100%}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right{width:100%;height:min(calc(90vh - 16rem),36rem);max-width:300px;padding:0 1rem 1rem 0;display:flex;align-items:center}.experiment-form .insights-graph-container .LineGraph{width:calc(100% - 2rem);height:calc(100% - 3rem)}.experiment-form .insights-graph-header{margin-top:0!important;margin-bottom:0!important;padding-left:1rem;padding-right:1rem;min-height:48px}.experiment-form .experiment-preview{margin-bottom:1rem;border-bottom:1px solid var(--border)}.experiment-form .experiment-preview .mde-slider .ant-slider-handle{border:none}.experiment-form .experiment-preview .mde-slider .ant-slider-rail{background-color:#e5ebff}.experiment-form .variants{margin-top:.5rem;padding-bottom:1rem}.experiment-form .variants .ant-form-horizontal{min-height:32px}.experiment-form .variants .border-top{border-top-left-radius:4px;border-top-right-radius:4px}.experiment-form .variants .border-bottom{border-bottom-left-radius:4px;border-bottom-right-radius:4px}.experiment-form .variants .feature-flag-variant{display:flex;align-items:center;height:3.5rem;padding:0 .5rem;background:#fff;border-bottom-width:1px;border-bottom-color:var(--border);border-top:1px solid var(--border);border-left:1px solid var(--border);border-right:1px solid var(--border)}.experiment-form .variants .feature-flag-variant .ant-form-item-explain-error{margin-top:.5rem;color:var(--danger)}.experiment-form .variants .feature-flag-variant .ant-form-item-label{padding:0}.experiment-form .variants .variant-label{display:flex;flex-direction:row;justify-content:center;align-items:center;border-radius:4px;color:#fff;min-width:52px;padding:2px 6px;margin-right:8px;font-size:12px;font-weight:500;letter-spacing:.01em}.experiment-form .secondary-metrics{margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border);margin-bottom:1rem;width:100%}.experiment-form .ant-input-number-disabled,.experiment-form .ant-input[disabled]{color:#000}.view-experiment .draft-header{margin-bottom:1rem;border-bottom:1px solid var(--border)}.view-experiment .exp-description{font-style:italic;color:var(--muted)}.view-experiment .participants{background-color:#fff}.view-experiment .participants .ant-collapse-header{padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem}.view-experiment .variants-list li{display:inline}.view-experiment .variants-list li:after{content:", "}.view-experiment .variants-list li:last-child:after{content:""}.view-experiment .experiment-result{padding-top:1rem}.view-experiment .significant-results{padding:.5rem;width:100%;background:rgba(119,185,108,.1);border-radius:4px;text-align:center;margin-bottom:1rem}.view-experiment .not-significant-results{padding:.5rem;width:100%;background:rgba(83,117,255,.1);border-radius:4px;margin-bottom:1rem}.view-experiment .feature-flag-mods{padding:.5rem;width:100%;background:#f6ebf8;border-radius:4px;margin-bottom:1rem}.view-experiment .ant-collapse-content-box{display:flex;flex-flow:column}.view-experiment .secondary-progress{margin-top:.5rem}.view-experiment .secondary-progress li:before{content:"\u2022";display:inline-block;font-weight:900;margin-right:4px}.view-experiment .secondary-progress .ant-progress-inner,.view-experiment .secondary-progress .ant-progress-inner .ant-progress-bg{border-radius:4px}.view-experiment .no-experiment-results{display:flex;justify-content:center;align-items:center;margin-top:1rem;background-color:var(--side);border:1px solid var(--border);width:100%;min-height:320px;font-size:24px}.preview-conversion-goal-num{height:24px;width:24px;text-align:center;background-color:var(--side);color:var(--primary-alt);font-weight:700;margin-right:.5rem}.experiment-preview-row{border-bottom:1px solid var(--border);padding-bottom:1rem;margin-bottom:1rem}.experiment-preview-row:last-child{border-bottom:none;padding-bottom:0;margin-bottom:0}.metric-name{border:1px solid var(--border);border-radius:4px;padding:8px 8px 8px 16px;margin-left:.5rem;flex:1}.experiment-implementation-details,.experiment-workflow{border-color:var(--dark-grey)}.experiment-implementation-details .ant-card-head,.experiment-workflow .ant-card-head{padding-left:1rem;padding-right:1rem;border:none}.experiment-implementation-details .ant-card-head-title,.experiment-workflow .ant-card-head-title{border-bottom:1px solid var(--border)}.experiment-implementation-details .exp-workflow-step,.experiment-workflow .exp-workflow-step{margin-bottom:.5rem;padding:.5rem;border-radius:4px}.experiment-implementation-details .exp-workflow-step:hover,.experiment-workflow .exp-workflow-step:hover{cursor:pointer}.experiment-implementation-details .step-completed,.experiment-workflow .step-completed{background-color:#e5ebff}',""]),Le.exports=q}}]);
