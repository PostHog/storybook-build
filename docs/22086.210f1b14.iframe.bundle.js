(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[22086],{"./frontend/src/scenes/apps/AppMetricsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AppMetrics:()=>AppMetrics,scene:()=>scene});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),ActivityLog=__webpack_require__("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),PluginJobConfiguration=__webpack_require__("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),sceneTypes=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),interfaceJobsLogic=__webpack_require__("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts");let TabsWithMetrics=[types.xn.ProcessEvent,types.xn.OnEvent,types.xn.ComposeWebhook,types.xn.ExportEvents,types.xn.ScheduledTask,types.xn.HistoricalExports],DEFAULT_DATE_FROM="-30d",INITIAL_TABS=[types.xn.ProcessEvent,types.xn.OnEvent,types.xn.ComposeWebhook,types.xn.ExportEvents,types.xn.ScheduledTask],appMetricsSceneLogic=(0,index_esm.kea)([(0,index_esm.path)(key=>["scenes","apps","appMetricsSceneLogic",key]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.pluginConfigId),(0,index_esm.actions)({setActiveTab:tab=>({tab}),setDateFrom:dateFrom=>({dateFrom}),openErrorDetailsModal:(errorType,category,jobId)=>({errorType,category,jobId}),closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),(0,index_esm.reducers)({activeTab:[null,{setActiveTab:(_,_ref)=>{let{tab}=_ref;return tab}}],selectedDateFrom:[null,{setDateFrom:(_,_ref2)=>{let{dateFrom}=_ref2;return dateFrom}}],errorDetailsModalError:[null,{openErrorDetailsModal:(_,_ref3)=>{let{errorType}=_ref3;return errorType},closeErrorDetailsModal:()=>null}]}),(0,lib.loaders)(_ref4=>{let{values,props}=_ref4;return{pluginConfig:[null,{loadPluginConfig:async()=>await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/plugin_configs/${props.pluginConfigId}`)}],appMetricsResponse:[null,{loadMetrics:async()=>{if(!values.activeTab||!values.dateFrom)return null;let params=(0,utils.oZ)({category:values.activeTab,date_from:values.dateFrom});return await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}?${params}`)}}],historicalExports:[[],{loadHistoricalExports:async()=>{let{results}=await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}/historical_exports`);return results}}],errorDetails:[[],{openErrorDetailsModal:async _ref5=>{let{category,jobId,errorType}=_ref5,params=(0,utils.oZ)({category:category,job_id:jobId,error_type:errorType}),{result}=await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}/error_details?${params}`);return result}}]}}),(0,index_esm.selectors)(_ref6=>{let{values,actions}=_ref6;return{breadcrumbs:[(s,p)=>[s.pluginConfig,p.pluginConfigId],(pluginConfig,pluginConfigId)=>[{key:sceneTypes.x.Apps,name:"Data pipeline",path:urls.j.projectApps()},{key:[sceneTypes.x.AppMetrics,pluginConfigId],name:pluginConfig?.plugin_info?.name,path:urls.j.appMetrics(pluginConfigId)}]],defaultTab:[s=>[s.pluginConfig],()=>{var _INITIAL_TABS$filter$;return null!==(_INITIAL_TABS$filter$=INITIAL_TABS.filter(tab=>values.showTab(tab))[0])&&void 0!==_INITIAL_TABS$filter$?_INITIAL_TABS$filter$:types.xn.Logs}],defaultDateFrom:[s=>[s.pluginConfig],pluginConfig=>{if(!pluginConfig?.created_at)return DEFAULT_DATE_FROM;let installedAt=dayjs.Bv.utc(pluginConfig.created_at),daysSinceInstall=(0,dayjs.Bv)().diff(installedAt,"days",!0);return daysSinceInstall<=1?"-24h":daysSinceInstall<=7?"-7d":DEFAULT_DATE_FROM}],dateFrom:[s=>[s.selectedDateFrom,s.defaultDateFrom],(selectedDateFrom,defaultDateFrom)=>{var _ref7;return null!==(_ref7=null!=selectedDateFrom?selectedDateFrom:defaultDateFrom)&&void 0!==_ref7?_ref7:DEFAULT_DATE_FROM}],showTab:[()=>[()=>1],()=>tab=>{if(values.pluginConfigLoading||!values.pluginConfig||!values.pluginConfig.plugin_info.capabilities)return!1;let capabilities=values.pluginConfig.plugin_info.capabilities,isExportEvents=capabilities.methods?.includes("exportEvents");return!TabsWithMetrics.includes(tab)||(tab===types.xn.HistoricalExports?!!isExportEvents:(tab!==types.xn.OnEvent||!isExportEvents)&&(tab===types.xn.ScheduledTask?!isExportEvents&&["runEveryMinute","runEveryHour","runEveryDay"].some(method=>capabilities.scheduled_tasks?.includes(method)):!!capabilities.methods?.includes(tab)))}],interfaceJobsProps:[s=>[s.pluginConfig],pluginConfig=>pluginConfig&&pluginConfig.plugin_info.public_jobs&&pluginConfig?.enabled?{jobName:PluginJobConfiguration._F,jobSpec:pluginConfig.plugin_info.public_jobs[PluginJobConfiguration._F],pluginConfigId:pluginConfig.id,pluginId:pluginConfig.plugin,onSubmit:actions.loadHistoricalExports}:null],hasRunningExports:[s=>[s.historicalExports],historicalExports=>historicalExports.some(e=>"not_finished"==e.status)]}}),(0,index_esm.listeners)(_ref8=>{let{values,actions}=_ref8;return{loadPluginConfigSuccess:()=>{values.activeTab||actions.setActiveTab(values.defaultTab)},setActiveTab:_ref9=>{let{tab}=_ref9;tab===types.xn.HistoricalExports?actions.loadHistoricalExports():TabsWithMetrics.includes(tab)&&actions.loadMetrics()},setDateFrom:()=>{actions.loadMetrics()},openHistoricalExportModal:()=>{values.interfaceJobsProps&&(0,interfaceJobsLogic.D)(values.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}}),(0,kea_router_lib.actionToUrl)(_ref10=>{let{values,props}=_ref10;return{setActiveTab:()=>getUrl(values,props),setDateFrom:()=>getUrl(values,props),openErrorDetailsModal:()=>getUrl(values,props),closeErrorDetailsModal:()=>getUrl(values,props)}}),(0,kea_router_lib.urlToAction)(_ref11=>{let{values,actions,props}=_ref11;return{"/app/:pluginConfigId/:page":(url,params)=>{if(props.pluginConfigId===Number(url.pluginConfigId)){if(values.pluginConfig||actions.loadPluginConfig(),url.page===types.xn.HistoricalExports)actions.setActiveTab(types.xn.HistoricalExports);else if(url.page===types.xn.History)actions.setActiveTab(types.xn.History);else if(url.page===types.xn.Logs)actions.setActiveTab(types.xn.Logs);else if(params.tab&&INITIAL_TABS.includes(params.tab)&&params.tab!==values.activeTab?actions.setActiveTab(params.tab):values.pluginConfigLoading||values.activeTab===values.defaultTab||actions.setActiveTab(values.defaultTab),params.from&&values.selectedDateFrom!==params.from&&actions.setDateFrom(params.from),params.error){let[error,category]=params.error;values.errorDetailsModalError!==error&&(actions.setActiveTab(category),actions.openErrorDetailsModal(error,category))}else actions.closeErrorDetailsModal()}}}})]);function getUrl(values,props){if(values.activeTab===types.xn.HistoricalExports)return urls.j.appHistoricalExports(props.pluginConfigId);if(values.activeTab===types.xn.History)return urls.j.appHistory(props.pluginConfigId,kea_router_lib.router.values.searchParams);if(values.activeTab===types.xn.Logs)return urls.j.appLogs(props.pluginConfigId,kea_router_lib.router.values.searchParams);let params={};return values.activeTab&&values.activeTab!==values.defaultTab&&(params.tab=values.activeTab),values.selectedDateFrom&&(params.from=values.selectedDateFrom),values.errorDetailsModalError&&values.activeTab&&(params.error=[values.errorDetailsModalError,values.activeTab]),urls.j.appMetrics(props.pluginConfigId,params)}var PluginImage=__webpack_require__("./frontend/src/scenes/plugins/plugin/PluginImage.tsx"),pluginsLogic=__webpack_require__("./frontend/src/scenes/plugins/pluginsLogic.ts"),PipelineNodeLogs=__webpack_require__("./frontend/src/scenes/pipeline/PipelineNodeLogs.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AppLogsTab(){let{activeTab,pluginConfig,pluginConfigLoading}=(0,index_esm.useValues)(appMetricsSceneLogic);return pluginConfig&&!pluginConfigLoading&&activeTab?(0,jsx_runtime.jsx)("div",{className:"space-y-8",children:(0,jsx_runtime.jsx)(PipelineNodeLogs.e,{id:pluginConfig.id,stage:types.We.Destination})}):(0,jsx_runtime.jsx)(LemonSkeleton.y,{})}var CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonLabel=__webpack_require__("./frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");function ErrorDetailsModal(){let{errorDetails,errorDetailsModalError,errorDetailsLoading}=(0,index_esm.useValues)(appMetricsSceneLogic),{closeErrorDetailsModal}=(0,index_esm.useActions)(appMetricsSceneLogic),[page,setPage]=(0,react.useState)(0),activeErrorDetails=errorDetails[page];return(0,jsx_runtime.jsx)(LemonModal.f,{isOpen:!!errorDetailsModalError,onClose:closeErrorDetailsModal,title:errorDetailsModalError,width:"min(50vw, 80rem)",description:(0,jsx_runtime.jsx)("span",{children:activeErrorDetails?.error_details?.error.message?.substring(0,200)}),footer:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("span",{children:[page+1," of ",errorDetails.length," sample",errorDetails.length>1?"s":""]}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.ed9,{}),onClick:()=>setPage(page-1),disabled:0==page}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.VG8,{}),onClick:()=>setPage(page+1),disabled:page==errorDetails.length-1})]})}),children:!errorDetailsModalError||errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"When:"})," ",(0,jsx_runtime.jsx)(TZLabel.w,{time:activeErrorDetails.timestamp,showSeconds:!0})]}),activeErrorDetails.error_details.eventCount&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Event Count"}),(0,jsx_runtime.jsx)("div",{children:activeErrorDetails.error_details.eventCount})]}),activeErrorDetails.error_details.error.message&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Error message",defaultIsExpanded:!0,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.message})}),activeErrorDetails.error_details.event&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Event payload",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JSON,children:JSON.stringify(activeErrorDetails.error_details.event,null,2)})}),activeErrorDetails.error_details.error.stack&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Stack trace",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.stack})})]})})}function CollapsibleSection(props){let[isExpanded,setIsExpanded]=(0,react.useState)(props.defaultIsExpanded);return(0,jsx_runtime.jsxs)("div",{className:"bg-mid border rounded",children:[(0,jsx_runtime.jsx)(LemonButton.J,{fullWidth:!0,onClick:()=>setIsExpanded(!isExpanded),sideIcon:isExpanded?(0,jsx_runtime.jsx)(icons.GZ,{}):(0,jsx_runtime.jsx)(icons.So7,{}),title:isExpanded?"Show less":"Show more",className:"bg-mid",children:props.title}),isExpanded&&(0,jsx_runtime.jsx)("div",{className:"bg-bg-light p-2",children:props.children})]})}var LemonProgress=__webpack_require__("./frontend/src/lib/lemon-ui/LemonProgress/index.tsx"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),columnUtils=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),LemonTag=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTag/LemonTag.tsx"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),AppMetricsGraph=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/apps/AppMetricsGraph.scss"),AppMetricsGraph_default=__webpack_require__.n(AppMetricsGraph),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(AppMetricsGraph_default(),options),AppMetricsGraph_default().locals;var Chart=__webpack_require__("./frontend/src/lib/Chart.ts"),colors=__webpack_require__("./frontend/src/lib/colors.ts");let DescriptionColumns={[types.xn.ProcessEvent]:{successes:"Events processed",successes_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed and transformed by the ",(0,jsx_runtime.jsx)("i",{children:"processEvent"})," app method."]}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events had errors when being processed by the ",(0,jsx_runtime.jsx)("i",{children:"processEvent"})," app method, but were still ingested."]})},[types.xn.OnEvent]:{successes:"Events processed",successes_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed by the ",(0,jsx_runtime.jsx)("i",{children:"onEvent"})," app method on the first try."]}),successes_on_retry:"Events processed on retry",successes_on_retry_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed by the ",(0,jsx_runtime.jsx)("i",{children:"onEvent"})," app method after being retried."]}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events had errors when being processed by the ",(0,jsx_runtime.jsx)("i",{children:"onEvent"})," app method."]})},[types.xn.ComposeWebhook]:{successes:"Events processed",successes_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed by the ",(0,jsx_runtime.jsx)("i",{children:"composeWebhook"})," app method on the first try."]}),successes_on_retry:"Events processed on retry",successes_on_retry_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events were successfully processed by the ",(0,jsx_runtime.jsx)("i",{children:"composeWebhook"})," app method after being retried."]}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["These events had errors when being processed by the ",(0,jsx_runtime.jsx)("i",{children:"composeWebhook"})," app method."]})},[types.xn.ExportEvents]:{successes:"Events delivered",successes_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})},[types.xn.HistoricalExports]:{successes:"Events delivered",successes_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})},[types.xn.ScheduledTask]:{successes:"Successes",successes_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["How many times ",(0,jsx_runtime.jsx)("i",{children:"runEveryMinute"}),", ",(0,jsx_runtime.jsx)("i",{children:"runEveryHour"})," or ",(0,jsx_runtime.jsx)("i",{children:"runEveryDay"})," was called successfully."]}),failures:"Failures",failures_tooltip:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["How many times ",(0,jsx_runtime.jsx)("i",{children:"runEveryMinute"}),", ",(0,jsx_runtime.jsx)("i",{children:"runEveryHour"})," or ",(0,jsx_runtime.jsx)("i",{children:"runEveryDay"})," failed due to errors."]})}};function AppMetricsGraph_AppMetricsGraph(_ref){let{tab,metrics,metricsLoading}=_ref,canvasRef=(0,react.useRef)(null),descriptions=DescriptionColumns[tab];return((0,react.useEffect)(()=>{let chart;if(canvasRef.current&&metrics&&!(0,utils.es)())return chart=new Chart.k(canvasRef.current?.getContext("2d"),{type:"line",data:{labels:metrics.dates,datasets:[{label:descriptions.successes,data:metrics.successes,borderColor:"",...colorConfig("data-color-1")},...descriptions.successes_on_retry?[{label:descriptions.successes_on_retry,data:metrics.successes_on_retry,...colorConfig("data-color-13")}]:[],{label:descriptions.failures,data:metrics.failures,...colorConfig("data-color-5")}]},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}}),()=>{chart?.destroy()}},[metrics]),metricsLoading||!metrics)?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"AppMetricsGraph border rounded p-6"}):(0,jsx_runtime.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:(0,jsx_runtime.jsx)("canvas",{ref:canvasRef})})}function colorConfig(baseColorVar){let mainColor=(0,colors.cM)(baseColorVar);return{borderColor:mainColor,hoverBorderColor:(0,utils._$)(mainColor,-20),hoverBackgroundColor:(0,utils._$)(mainColor,-20),backgroundColor:mainColor,fill:!1,borderWidth:2,pointRadius:0}}let historicalExportLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","apps","historicalExportLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{pluginConfigId,jobId}=_ref;return`${pluginConfigId}_${jobId}`}),(0,lib.loaders)(_ref2=>{let{props}=_ref2;return{data:[null,{loadExportData:async()=>await api.ZP.get(`api/projects/${teamLogic.teamLogic.values.currentTeamId}/app_metrics/${props.pluginConfigId}/historical_exports/${props.jobId}`)}]}}),(0,index_esm.events)(_ref3=>{let{actions}=_ref3;return{afterMount:actions.loadExportData}})]);var LemonSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts");function MetricsTab(_ref){let{tab}=_ref,{appMetricsResponse,appMetricsResponseLoading,dateFrom}=(0,index_esm.useValues)(appMetricsSceneLogic),{setDateFrom}=(0,index_esm.useActions)(appMetricsSceneLogic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,jsx_runtime.jsx)(MetricsOverview,{tab:tab,metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{value:dateFrom,onChange:newValue=>setDateFrom(newValue),options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Delivery trends"}),(0,jsx_runtime.jsx)(AppMetricsGraph_AppMetricsGraph,{tab:tab,metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Errors"}),(0,jsx_runtime.jsx)(ErrorsOverview,{category:tab,errors:appMetricsResponse?.errors||[],loading:appMetricsResponseLoading,showExtendedEmptyState:!0})]})]})}function MetricsOverview(_ref2){let{tab,metrics,metricsLoading,exportDuration,exportFailureReason}=_ref2;return metricsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-20 h-4 mb-2",repeat:4}):(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:[DescriptionColumns[tab].successes," ",DescriptionColumns[tab].successes_tooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:DescriptionColumns[tab].successes_tooltip,children:(0,jsx_runtime.jsx)(icons.aUG,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.successes)})]}),DescriptionColumns[tab].successes_on_retry&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:[DescriptionColumns[tab].successes_on_retry," ",DescriptionColumns[tab].successes_on_retry_tooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:DescriptionColumns[tab].successes_on_retry_tooltip,children:(0,jsx_runtime.jsx)(icons.aUG,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.successes_on_retry)})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:[DescriptionColumns[tab].failures," ",DescriptionColumns[tab].failures_tooltip&&(0,jsx_runtime.jsx)(Tooltip.u,{title:DescriptionColumns[tab].failures_tooltip,children:(0,jsx_runtime.jsx)(icons.aUG,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.failures)})]}),exportDuration&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export duration"}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:(0,utils.C7)(exportDuration)})]})]}),exportFailureReason&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"text-muted font-semibold mb-2",children:"Export failure reason"}),(0,jsx_runtime.jsx)("div",{children:exportFailureReason})]})]})}function ErrorsOverview(_ref3){let{errors,loading,category,jobId,showExtendedEmptyState}=_ref3,{openErrorDetailsModal}=(0,index_esm.useActions)(appMetricsSceneLogic);return(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:errors,loading:loading,columns:[{title:"Error type",dataIndex:"error_type",render:function RenderErrorType(_,errorSummary){return(0,jsx_runtime.jsx)(Link.r,{title:"View details",className:"font-semibold",onClick:event=>{event.preventDefault(),openErrorDetailsModal(errorSummary.error_type,category,jobId)},children:errorSummary.error_type})},sorter:(a,b)=>a.error_type.localeCompare(b.error_type)},{title:"Count",dataIndex:"count",align:"right",sorter:(a,b)=>a.count-b.count},{title:"Last seen",dataIndex:"last_seen",render:function RenderCreatedAt(lastSeen){return(0,jsx_runtime.jsx)("div",{className:"whitespace-nowrap text-right",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:lastSeen})})},align:"right",sorter:(a,b)=>new Date(a.last_seen||0)>new Date(b.last_seen||0)?1:-1}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:(0,jsx_runtime.jsxs)("div",{className:"",children:[(0,jsx_runtime.jsx)("b",{children:"No errors! \uD83E\uDD73"}),showExtendedEmptyState&&(0,jsx_runtime.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})}function renderNumber(value){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value?(0,utils.Lc)(value):value})}function HistoricalExport(props){var _data$metrics,_data$metrics2;let{data,dataLoading}=(0,index_esm.useValues)(historicalExportLogic(props));return(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsx)(MetricsOverview,{tab:types.xn.HistoricalExports,metrics:null!==(_data$metrics=data?.metrics)&&void 0!==_data$metrics?_data$metrics:null,metricsLoading:dataLoading,exportDuration:data?.summary?.duration,exportFailureReason:data?.summary?.failure_reason}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Delivery trends"}),(0,jsx_runtime.jsx)(AppMetricsGraph_AppMetricsGraph,{tab:types.xn.HistoricalExports,metrics:null!==(_data$metrics2=data?.metrics)&&void 0!==_data$metrics2?_data$metrics2:null,metricsLoading:dataLoading})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Errors"}),(0,jsx_runtime.jsx)(ErrorsOverview,{errors:data?.errors||[],loading:dataLoading,category:"exportEvents",jobId:data?.summary?.job_id})]})]})}function HistoricalExportsTab(){let{historicalExports,historicalExportsLoading,pluginConfig,interfaceJobsProps,hasRunningExports}=(0,index_esm.useValues)(appMetricsSceneLogic),{openHistoricalExportModal,loadHistoricalExports}=(0,index_esm.useActions)(appMetricsSceneLogic),{user}=(0,index_esm.useValues)(userLogic.userLogic);return(0,react.useEffect)(()=>{let timer;return function updateTimer(){hasRunningExports&&(timer=setTimeout(()=>{loadHistoricalExports(),updateTimer()},2e4))}(),()=>timer&&clearTimeout(timer)},[hasRunningExports]),(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[user?.is_impersonated&&(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end",children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary",onClick:openHistoricalExportModal,disabled:!interfaceJobsProps,children:"Start new export"})}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:historicalExports,loading:historicalExportsLoading,columns:[{title:"Dates exported",render:function Render(_,historicalExport){let[dateFrom,dateTo]=historicalExport.payload.dateRange;return dateFrom===dateTo?dateFrom:`${dateFrom} - ${dateTo}`}},{title:"Progress",width:130,render:function RenderProgress(_,historicalExport){switch(historicalExport.status){case"success":return(0,jsx_runtime.jsx)(LemonTag.o,{type:"success",className:"uppercase",children:"Success"});case"fail":return(0,jsx_runtime.jsx)(LemonTag.o,{type:"danger",className:"uppercase",children:"Failed"});case"not_finished":return(0,jsx_runtime.jsx)(LemonProgress.b,{percent:Math.floor(100*(historicalExport.progress||0))})}},align:"right"},(0,columnUtils.JB)(),(0,columnUtils.rw)()],expandable:{expandedRowRender:function Render(historicalExport){if(pluginConfig)return(0,jsx_runtime.jsx)(HistoricalExport,{pluginConfigId:pluginConfig.id,jobId:historicalExport.job_id})}},useURLForSorting:!1,noSortingCancellation:!0,emptyState:(0,jsx_runtime.jsx)("div",{className:"",children:(0,jsx_runtime.jsx)("b",{children:"Nothing has been exported yet!"})})}),interfaceJobsProps&&(0,jsx_runtime.jsx)(PluginJobConfiguration.CC,{...interfaceJobsProps})]})}let scene={component:AppMetrics,logic:appMetricsSceneLogic,paramsToProps:_ref=>{var _parseInt;let{params:{pluginConfigId}}=_ref;return{pluginConfigId:null!==(_parseInt=parseInt(pluginConfigId))&&void 0!==_parseInt?_parseInt:0}}};function AppMetrics(){let{activeTab,pluginConfig,pluginConfigLoading,showTab}=(0,index_esm.useValues)(appMetricsSceneLogic),{editPlugin}=(0,index_esm.useActions)(pluginsLogic.C),{setActiveTab}=(0,index_esm.useActions)(appMetricsSceneLogic);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[pluginConfig?(0,jsx_runtime.jsx)(PluginImage.c,{plugin:pluginConfig?.plugin_info}):(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-10 h-10"}),(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(PageHeader.m,{caption:pluginConfig?"An overview of metrics and exports for this app.":void 0,buttons:pluginConfig?.plugin?(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",icon:(0,jsx_runtime.jsx)(icons.iCC,{}),onClick:()=>editPlugin(pluginConfig?.plugin),children:"Configure"}):void 0})})]}),pluginConfigLoading||!activeTab?(0,jsx_runtime.jsx)(LemonSkeleton.y,{}):(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:activeTab,onChange:newKey=>setActiveTab(newKey),tabs:[showTab(types.xn.ProcessEvent)&&{key:types.xn.ProcessEvent,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"processEvent metrics"}),content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.ProcessEvent})},showTab(types.xn.OnEvent)&&{key:types.xn.OnEvent,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"onEvent metrics"}),content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.OnEvent})},showTab(types.xn.ComposeWebhook)&&{key:types.xn.ComposeWebhook,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"composeWebhook metrics"}),content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.ComposeWebhook})},showTab(types.xn.ExportEvents)&&{key:types.xn.ExportEvents,label:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"exportEvents metrics"}),content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.ExportEvents})},showTab(types.xn.ScheduledTask)&&{key:types.xn.ScheduledTask,label:"Scheduled tasks",tooltip:"Metrics for app methods `runEveryMinute`, `runEveryHour` and `runEveryDay`.",content:(0,jsx_runtime.jsx)(MetricsTab,{tab:types.xn.ScheduledTask})},showTab(types.xn.HistoricalExports)&&{key:types.xn.HistoricalExports,label:"Historical exports",content:(0,jsx_runtime.jsx)(HistoricalExportsTab,{})},{key:types.xn.Logs,label:"Logs",content:(0,jsx_runtime.jsx)(AppLogsTab,{})},{key:types.xn.History,label:"History",content:(0,jsx_runtime.jsx)(ActivityLog.D,{scope:types.jc.PLUGIN,id:pluginConfig?.id})}]}),(0,jsx_runtime.jsx)(ErrorDetailsModal,{})]})}},"./frontend/src/scenes/pipeline/PipelineNodeLogs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{e:()=>PipelineNodeLogs});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_constants__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/constants.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/utils.tsx"),_pipelineNodeLogsLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/pipeline/pipelineNodeLogsLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelineNodeLogs(_ref){let{id,stage}=_ref,logic=(0,_pipelineNodeLogsLogic__WEBPACK_IMPORTED_MODULE_4__.Y)({id,stage}),{logs,logsLoading,backgroundLogs,columns,isThereMoreToLoad,selectedLogLevels}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(logic),{revealBackground,loadMoreLogs,setSelectedLogLevels,setSearchTerm}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)(logic);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"ph-no-capture space-y-2 flex-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonInput,{type:"search",placeholder:"Search for messages containingâ€¦",fullWidth:!0,onChange:setSearchTerm,allowClear:!0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex items-center gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{className:"mr-1",children:"Show logs of level:"}),Object.values(_pipelineNodeLogsLogic__WEBPACK_IMPORTED_MODULE_4__.i).map(level=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonCheckbox,{label:level,checked:selectedLogLevels.includes(level),onChange:checked=>{let newLogLevels=checked?[...selectedLogLevels,level]:selectedLogLevels.filter(t=>t!=level);setSelectedLogLevels(newLogLevels)}},level))]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{onClick:revealBackground,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:backgroundLogs.length?void 0:"There's nothing to load",children:backgroundLogs.length?`Load ${(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__._6)(backgroundLogs.length,"newer entry","newer entries")}`:"No new entries"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonTable,{dataSource:logs,columns:columns,loading:logsLoading,className:"ph-no-capture",rowKey:"timestamp",pagination:{pageSize:200,hideOnSinglePage:!0}}),!!logs.length&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{onClick:loadMoreLogs,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:isThereMoreToLoad?void 0:"There's nothing more to load",children:isThereMoreToLoad?`Load up to ${lib_constants__WEBPACK_IMPORTED_MODULE_2__.F2} older entries`:"No older entries"})]})}},"./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$f:()=>HISTORICAL_EXPORT_JOB_NAME,CC:()=>PluginJobModal,QZ:()=>PluginJobConfiguration,_F:()=>HISTORICAL_EXPORT_JOB_NAME_V2});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.5.1_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_components_CodeEditors__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/components/CodeEditors.tsx"),lib_components_DatePicker__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/components/DatePicker.tsx"),lib_dayjs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/dayjs.ts"),lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonCalendarRange_LemonCalendarRangeInline__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCalendarRange/LemonCalendarRangeInline.tsx"),lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/LemonInput.tsx"),lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/lib/utils.tsx"),react__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let HISTORICAL_EXPORT_JOB_NAME="Export historical events",HISTORICAL_EXPORT_JOB_NAME_V2="Export historical events V2";function PluginJobConfiguration(props){let{jobName,jobSpec,pluginConfigId,pluginId}=props,{playButtonOnClick}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)((0,_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D)(props)),{runJobAvailable}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)((0,_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D)(props)),jobHasEmptyPayload=0===Object.keys(jobSpec.payload||{}).length,configureOrRunJobTooltip=runJobAvailable?jobHasEmptyPayload?"Run job":"Configure and run job":"You already ran this job recently.";return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("span",{className:"ml-1",onClick:()=>playButtonOnClick(jobHasEmptyPayload),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Tooltip,{title:configureOrRunJobTooltip,children:jobHasEmptyPayload?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_7__.UdX,{className:runJobAvailable?"Plugin__RunJobButton":"Plugin__RunJobButton--disabled"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_7__.iCC,{className:runJobAvailable?"Plugin__RunJobButton":"Plugin__RunJobButton--disabled"})})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(PluginJobModal,{jobName:jobName,jobSpec:jobSpec,pluginConfigId:pluginConfigId,pluginId:pluginId})]})}function PluginJobModal(props){let{jobName,jobSpec}=props,{setIsJobModalOpen,submitJobPayload}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)((0,_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D)(props)),{isJobModalOpen}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)((0,_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D)(props)),{user}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(scenes_userLogic__WEBPACK_IMPORTED_MODULE_15__.userLogic),shownFields=(0,react__WEBPACK_IMPORTED_MODULE_14__.useMemo)(()=>Object.entries(jobSpec.payload||{}).filter(_ref=>{let[,options]=_ref;return!options.staff_only||user?.is_staff||user?.is_impersonated}).sort((a,b)=>a[0].localeCompare(b[0])),[jobSpec,user]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_12__.f,{isOpen:isJobModalOpen,onClose:()=>setIsJobModalOpen(!1),title:`Configuring job '${jobName}'`,footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_8__.J,{type:"secondary",className:"mr-2",onClick:()=>setIsJobModalOpen(!1),children:"Cancel"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_8__.J,{"data-attr":"run-job",type:"primary",onClick:()=>submitJobPayload(),children:"Run job now"})]}),children:shownFields.length>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(kea_forms__WEBPACK_IMPORTED_MODULE_3__.Form,{logic:_interfaceJobsLogic__WEBPACK_IMPORTED_MODULE_16__.D,props:props,formKey:"jobPayload",children:shownFields.map(_ref2=>{let[key,options]=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_10__.D,{name:key,label:options.title||key,className:"mb-4",children:props=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(FieldInput,{options:options,...props})},key)})}):null})}function FieldInput(_ref3){let{options,value,onChange}=_ref3;switch(options.type){case"string":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_11__.D,{value:value||"",onChange:onChange});case"number":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonInput_LemonInput__WEBPACK_IMPORTED_MODULE_11__.D,{type:"number",value:value,onChange:onChange});case"json":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_components_CodeEditors__WEBPACK_IMPORTED_MODULE_4__.p,{options:{codeLens:!1,lineNumbers:"off"},className:"Plugin__JobJsonEditor",language:"json",height:200,value:value,onChange:onChange});case"boolean":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonSegmentedButton,{onChange:onChange,value:value,options:[{value:!0,label:"True",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconCheck,{})},{value:!1,label:"False",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_7__.bMz,{})}]});case"date":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_components_DatePicker__WEBPACK_IMPORTED_MODULE_5__.M,{popupStyle:{zIndex:1061},allowClear:!0,placeholder:"Choose a date",className:"retention-date-picker",suffixIcon:null,use12Hours:!0,showTime:!0,value:value?(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value):null,onChange:date=>onChange(date?.toISOString())});case"daterange":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)("div",{className:"border rounded p-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("div",{className:"pb-4",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(lib_lemon_ui_LemonCalendarRange_LemonCalendarRangeInline__WEBPACK_IMPORTED_MODULE_9__.S,{value:value?[(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[0]),(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[1])]:null,onChange:_ref4=>{let[rangeStart,rangeEnd]=_ref4;return onChange([rangeStart.format("YYYY-MM-DD"),rangeEnd.format("YYYY-MM-DD")])}})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)("div",{className:"border-t pt-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("span",{className:"text-muted",children:"Selected period:"})," ",value?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("span",{children:value[0]===value[1]?(0,lib_utils__WEBPACK_IMPORTED_MODULE_13__.p6)((0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[0])):(0,lib_utils__WEBPACK_IMPORTED_MODULE_13__._Q)((0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[0]),(0,lib_dayjs__WEBPACK_IMPORTED_MODULE_6__.Bv)(value[1]))}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)("span",{className:"italic",children:"No period selected."})]})]})}}},"./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{D:()=>interfaceJobsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/utils.tsx");let interfaceJobsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","plugins","edit","interface-jobs","interfaceJobsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>`${props.pluginId}_${props.jobName}`),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setIsJobModalOpen:isOpen=>({isOpen}),setRunJobAvailable:isAvailable=>({isAvailable}),runJob:form=>({form}),playButtonOnClick:jobHasEmptyPayload=>({jobHasEmptyPayload}),setRunJobAvailableTimeout:timeout=>({timeout})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({isJobModalOpen:[!1,{setIsJobModalOpen:(_,_ref)=>{let{isOpen}=_ref;return isOpen}}],runJobAvailable:[!0,{setRunJobAvailable:(_,_ref2)=>{let{isAvailable}=_ref2;return isAvailable}}],runJobAvailableTimeout:[null,{setRunJobAvailableTimeout:(_,_ref3)=>{let{timeout}=_ref3;return timeout}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions,values}=_ref4;return{playButtonOnClick:_ref5=>{let{jobHasEmptyPayload}=_ref5;if(values.runJobAvailable){if(jobHasEmptyPayload){actions.submitJobPayload();return}actions.setIsJobModalOpen(!0)}}}}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_1__.forms)(_ref6=>{let{actions,props,values}=_ref6;return{jobPayload:{defaults:Object.fromEntries(Object.entries(props.jobSpec.payload||{}).filter(_ref7=>{let[,spec]=_ref7;return"default"in spec}).map(_ref8=>{let[key,spec]=_ref8;return[key,spec.default]})),errors:payload=>{let errors={};for(let key of Object.keys(props.jobSpec.payload||{})){let spec=props.jobSpec.payload?.[key];spec?.required&&void 0==payload[key]?errors[key]="Please enter a value":spec?.type!="json"||(0,lib_utils__WEBPACK_IMPORTED_MODULE_4__.XA)(payload[key])||(errors[key]="Please enter valid JSON")}return errors},submit:async payload=>{actions.setIsJobModalOpen(!1);try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.create(`api/plugin_config/${props.pluginConfigId}/job`,{job:{type:props.jobName,payload}})}catch(error){lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error(`Enqueuing job "${props.jobName}" failed`);return}props.onSubmit?.(),actions.setRunJobAvailable(!1),values.runJobAvailableTimeout&&clearTimeout(values.runJobAvailableTimeout);let timeout=window.setTimeout(()=>{actions.setRunJobAvailable(!0)},15e3);actions.setRunJobAvailableTimeout(timeout),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success("Job has been enqueued")}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.events)(_ref9=>{let{values}=_ref9;return{beforeUnmount:()=>{values.runJobAvailableTimeout&&clearTimeout(values.runJobAvailableTimeout)}}})])},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/apps/AppMetricsGraph.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".AppMetricsGraph{height:300px}",""]),module.exports=exports}}]);