(window.webpackJsonp=window.webpackJsonp||[]).push([[301],{"./frontend/src/scenes/data-management/database/databaseSceneLogic.ts":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return databaseSceneLogic}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),_queries_query__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/queries/query.ts"),_queries_schema__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/queries/schema.ts");const databaseSceneLogic=Object(kea__WEBPACK_IMPORTED_MODULE_0__.kea)([Object(kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-management","database","databaseSceneLogic"]),Object(kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setSearchTerm:searchTerm=>({searchTerm:searchTerm})}),Object(kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)({database:[null,{loadDatabase:async()=>await Object(_queries_query__WEBPACK_IMPORTED_MODULE_2__.c)({kind:_queries_schema__WEBPACK_IMPORTED_MODULE_3__.a.DatabaseSchemaQuery})}]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({searchTerm:["",{setSearchTerm:(_,_ref)=>{let{searchTerm:searchTerm}=_ref;return searchTerm}}]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({filteredTables:[s=>[s.database,s.searchTerm],(database,searchTerm)=>database?Object.entries(database).map((_ref2=>{let[key,value]=_ref2;return{name:key,columns:value}})).filter((_ref3=>{let{name:name}=_ref3;return name.toLowerCase().includes(searchTerm.toLowerCase())})).sort(((a,b)=>a.name.localeCompare(b.name))):[]]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((_ref4=>{let{actions:actions}=_ref4;return actions.loadDatabase()}))])},"./frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"DataWarehousetTable",(function(){return DataWarehousetTable})),__webpack_require__.d(__webpack_exports__,"TableForm",(function(){return TableForm}));var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),databaseSceneLogic=__webpack_require__("./frontend/src/scenes/data-management/database/databaseSceneLogic.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const NEW_WAREHOUSE_TABLE={id:"",name:"",url_pattern:"",format:"Parquet",credential:{access_key:"",access_secret:""},columns:[]},dataWarehouseTableLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","data-warehouse","tableLogic"]),Object(index_esm.props)({}),Object(index_esm.key)((_ref=>{let{id:id}=_ref;return id})),Object(index_esm.connect)((()=>({actions:[databaseSceneLogic.a,["loadDatabase"]]}))),Object(index_esm.actions)({editingTable:editing=>({editing:editing}),updateTargetingFlagFilters:(index,properties)=>({index:index,properties:properties}),addConditionSet:!0,removeConditionSet:index=>({index:index}),launchTable:!0,stopTable:!0,archiveTable:!0,setDataTableQuery:query=>({query:query})}),Object(kea_loaders_lib.loaders)((_ref2=>{let{props:props}=_ref2;return{table:{loadTable:async()=>props.id&&"new"!==props.id?await api.b.dataWarehouseTables.get(props.id):{...NEW_WAREHOUSE_TABLE},createTable:async tablePayload=>await api.b.dataWarehouseTables.create({...tablePayload}),updateTable:async tablePayload=>await api.b.dataWarehouseTables.update(props.id,tablePayload)}}})),Object(index_esm.listeners)((_ref3=>{let{actions:actions}=_ref3;return{createTableSuccess:async _ref4=>{let{table:table}=_ref4;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Table ",table.name," created"]})),actions.loadDatabase(),kea_router_lib.router.actions.replace(urls.a.dataWarehouse())},updateTableSuccess:async _ref5=>{let{table:table}=_ref5;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Table ",table.name," updated"]})),actions.editingTable(!1),kea_router_lib.router.actions.replace(urls.a.dataWarehouse())}}})),Object(index_esm.reducers)({isEditingTable:[!1,{editingTable:(_,_ref6)=>{let{editing:editing}=_ref6;return editing}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref7)=>{let{query:query}=_ref7;return query}}]}),Object(index_esm.selectors)({breadcrumbs:[s=>[s.table],table=>[{name:"Tables",path:urls.a.dataWarehouse()},...null!=table&&table.name?[{name:table.name}]:[]]]}),Object(lib.forms)((_ref8=>{let{actions:actions,props:props}=_ref8;return{table:{defaults:{...NEW_WAREHOUSE_TABLE},errors:_ref9=>{let{name:name,url_pattern:url_pattern,credential:credential,format:format}=_ref9;return{name:!name&&"Please enter a name.",url_pattern:!url_pattern&&"Please enter a url pattern.",credential:{access_secret:!credential.access_secret&&"Please enter an access secret.",access_key:!credential.access_key&&"Please enter an access key."},format:!format&&"Please enter the format of your files."}},submit:async tablePayload=>{props.id&&"new"!==props.id?actions.updateTable(tablePayload):actions.createTable(tablePayload)}}}})),Object(kea_router_lib.urlToAction)((_ref10=>{var _props$id;let{actions:actions,props:props}=_ref10;return{[urls.a.dataWarehouseTable(null!==(_props$id=props.id)&&void 0!==_props$id?_props$id:"new")]:(_,__,___,_ref11)=>{let{method:method}=_ref11;"PUSH"===method&&(props.id?actions.loadTable():actions.resetTable())}}})),Object(index_esm.afterMount)((async _ref12=>{let{props:props,actions:actions}=_ref12;"new"!==props.id&&await actions.loadTable(),"new"===props.id&&actions.resetTable()}))]);var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx");const scene={component:DataWarehousetTable,logic:dataWarehouseTableLogic,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{id:id}}};function DataWarehousetTable(){let{id:id}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{isEditingTable:isEditingTable}=Object(index_esm.useValues)(dataWarehouseTableLogic),showTableForm="new"===id||isEditingTable;return Object(jsx_runtime.jsx)("div",{children:id?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:showTableForm?Object(jsx_runtime.jsx)(TableForm,{id:id}):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{})}):Object(jsx_runtime.jsx)(LemonSkeleton.a,{})})}function TableForm(_ref2){let{id:id}=_ref2;const{table:table,tableLoading:tableLoading,isEditingTable:isEditingTable}=Object(index_esm.useValues)(dataWarehouseTableLogic),{loadTable:loadTable,editingTable:editingTable}=Object(index_esm.useActions)(dataWarehouseTableLogic);return Object(jsx_runtime.jsxs)(lib.Form,{formKey:"table",logic:dataWarehouseTableLogic,className:"space-y-4",enableFormOnSubmit:!0,children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:"new"===id?"New table":table.name,buttons:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-table",type:"secondary",loading:tableLoading,onClick:()=>{isEditingTable?(editingTable(!1),loadTable()):kea_router_lib.router.actions.push(urls.a.dataWarehouse())},children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:tableLoading,children:"Save"})]}),caption:Object(jsx_runtime.jsxs)("div",{children:["External tables are supported through object storage systems like S3."," ",Object(jsx_runtime.jsx)("a",{href:"https://posthog.com/docs/data/data-warehouse#step-1-creating-a-bucket-in-s3",target:"_blank",children:"Learn how to set up your data"})]})}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 max-w-160",children:[Object(jsx_runtime.jsx)(Field.a,{name:"name",label:"Table Name",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"Examples: stripe_invoice, hubspot_contacts, users",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),Object(jsx_runtime.jsx)("div",{className:"text-muted text-xs mb-4",children:"This will be the table name used when writing queries"}),Object(jsx_runtime.jsx)(Field.a,{name:"url_pattern",label:"Files URL pattern",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"table-name",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: https://your-org.s3.amazonaws.com/airbyte/stripe/invoices/*.pqt",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),Object(jsx_runtime.jsxs)("div",{className:"text-muted text-xs mb-4",children:["You can use ",Object(jsx_runtime.jsx)("strong",{children:"*"})," to select multiple files."]}),Object(jsx_runtime.jsx)(Field.a,{name:"format",label:"File format",className:"w-max",children:Object(jsx_runtime.jsx)(src.LemonSelect,{"data-attr":"table-format",options:[{label:"Parquet (recommended)",value:"Parquet"},{label:"CSV",value:"CSV"}]})}),Object(jsx_runtime.jsx)(Field.a,{name:["credential","access_key"],label:"Access Key",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"access-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"eg: AKIAIOSFODNN7EXAMPLE",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),Object(jsx_runtime.jsx)(Field.a,{name:["credential","access_secret"],label:"Access Secret",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"access-secret",className:"ph-ignore-input",autoFocus:!0,type:"password",placeholder:"eg: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})]})]})}try{DataWarehousetTable.displayName="DataWarehousetTable",DataWarehousetTable.__docgenInfo={description:"",displayName:"DataWarehousetTable",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx#DataWarehousetTable"]={docgenInfo:DataWarehousetTable.__docgenInfo,name:"DataWarehousetTable",path:"frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx#DataWarehousetTable"})}catch(__react_docgen_typescript_loader_error){}try{TableForm.displayName="TableForm",TableForm.__docgenInfo={description:"",displayName:"TableForm",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx#TableForm"]={docgenInfo:TableForm.__docgenInfo,name:"TableForm",path:"frontend/src/scenes/data-warehouse/DataWarehouseTable.tsx#TableForm"})}catch(__react_docgen_typescript_loader_error){}}}]);