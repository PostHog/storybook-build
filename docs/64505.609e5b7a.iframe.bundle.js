"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[64505,14415],{"../../frontend/src/lib/components/VersionChecker/VersionCheckerBanner.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{o:()=>VersionCheckerBanner});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),semver=__webpack_require__("../../frontend/src/lib/utils/semver.ts"),queries_utils=__webpack_require__("../../frontend/src/queries/utils.ts");let versionCheckerLogic=(0,index_esm.kea)([(0,index_esm.props)({teamId:null}),(0,index_esm.key)(_ref=>{let{teamId}=_ref;return teamId||"no-team-id"}),(0,index_esm.path)(key=>["components","VersionChecker","versionCheckerLogic",key]),(0,index_esm.actions)({setVersionWarning:versionWarning=>({versionWarning}),setSdkVersions:sdkVersions=>({sdkVersions})}),(0,lib.loaders)(_ref2=>{let{values}=_ref2;return{availableVersions:[{},{loadAvailableVersions:async()=>{let availableVersionsPromise=fetch("https://api.github.com/repos/posthog/posthog-js/tags").then(r=>r.json()).then(r=>r.map(x=>(0,semver.Jt)(x.name)).filter(utils.DX)),deprecationPromise=fetch("https://raw.githubusercontent.com/PostHog/posthog-js/main/deprecation.json").then(r=>r.json()),settled=await Promise.allSettled([availableVersionsPromise,deprecationPromise]),availableVersions="fulfilled"===settled[0].status?settled[0].value:[],deprecation="fulfilled"===settled[1].status?settled[1].value:{};return{...values.availableVersions,sdkVersions:availableVersions,deprecation:deprecation}}}],usedVersions:[null,{loadUsedVersions:async()=>{var _res$results$map$filt;let query=(0,queries_utils.zP)`
                        SELECT properties.$lib_version AS lib_version, max(timestamp) AS latest_timestamp, count(lib_version) as count
                        FROM events
                        WHERE timestamp >= now() - INTERVAL 1 DAY 
                        AND timestamp <= now()
                        AND properties.$lib = 'web'
                        GROUP BY lib_version
                        ORDER BY latest_timestamp DESC
                        limit 10`,res=await api.ZP.queryHogQL(query,{refresh:"force_blocking"});return null!==(_res$results$map$filt=res.results?.map(x=>{let version=semver.Jt(x[0]);return version?{version,timestamp:x[1]}:null}).filter(utils.DX))&&void 0!==_res$results$map$filt?_res$results$map$filt:null}}]}}),(0,index_esm.reducers)({lastCheckTimestamp:[0,{persist:!0},{loadUsedVersionsSuccess:()=>Date.now()}],versionWarning:[null,{persist:!0,prefix:"2024-02-12"},{setVersionWarning:(_,_ref3)=>{let{versionWarning}=_ref3;return versionWarning}}]}),(0,index_esm.sharedListeners)(_ref4=>{let{values,actions}=_ref4;return{checkForVersionWarning:()=>{if(!values.usedVersions?.length)return;let{deprecation,sdkVersions}=values.availableVersions,latestUsedVersion=(0,semver.ej)(values.usedVersions.map(v=>v.version)),latestAvailableVersion=sdkVersions?.[0],deprecateBeforeVersion=deprecation?.deprecateBeforeVersion?(0,semver.wy)(deprecation.deprecateBeforeVersion):null,warning=null;if(deprecateBeforeVersion){let diff=(0,semver.I4)(deprecateBeforeVersion,latestUsedVersion);diff&&diff.diff>0&&(warning={latestUsedVersion:(0,semver.L$)(latestUsedVersion),latestAvailableVersion:(0,semver.L$)(latestAvailableVersion||deprecateBeforeVersion),level:"error"})}if(!warning&&sdkVersions&&latestAvailableVersion){let diff=(0,semver.I4)(latestAvailableVersion,latestUsedVersion);if(diff&&diff.diff>0){let level,numVersionsBehind=sdkVersions.findIndex(v=>(0,semver.FL)(v,latestUsedVersion));-1===numVersionsBehind&&(numVersionsBehind=sdkVersions.length-1),numVersionsBehind<diff.diff&&(numVersionsBehind=diff.diff),"major"===diff.kind?level="info":"minor"===diff.kind&&(level=numVersionsBehind>=40?"warning":void 0),void 0===level&&numVersionsBehind>=50&&(level="error"),level&&(0,semver.L$)(latestUsedVersion).trim().length&&(warning={latestUsedVersion:(0,semver.L$)(latestUsedVersion),latestAvailableVersion:(0,semver.L$)(latestAvailableVersion),level,numVersionsBehind})}}actions.setVersionWarning(warning)}}}),(0,index_esm.listeners)(_ref5=>{let{sharedListeners}=_ref5;return{loadAvailableVersionsSuccess:sharedListeners.checkForVersionWarning,loadUsedVersionsSuccess:sharedListeners.checkForVersionWarning}}),(0,index_esm.afterMount)(_ref6=>{let{actions,values}=_ref6;values.lastCheckTimestamp<Date.now()-216e5&&(actions.loadAvailableVersions(),actions.loadUsedVersions())})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function VersionCheckerBanner(){let{currentTeamId}=(0,index_esm.useValues)(teamLogic.teamLogic),{versionWarning}=(0,index_esm.useValues)(versionCheckerLogic({teamId:currentTeamId}));if(!versionWarning)return null;let dismissKey=`version-checker-${versionWarning.latestAvailableVersion}-${versionWarning.latestUsedVersion}`;return(0,jsx_runtime.jsxs)(LemonBanner.V,{type:versionWarning.level,dismissKey:dismissKey,action:{children:"View the changelog",to:"https://github.com/PostHog/posthog-js/blob/main/packages/browser/CHANGELOG.md",targetBlank:!0},className:"mb-4",children:[(0,jsx_runtime.jsx)("b",{children:"Your PostHog SDK needs updating."})," The latest version of ",(0,jsx_runtime.jsx)("code",{children:"posthog-js"})," is"," ",(0,jsx_runtime.jsx)("b",{children:versionWarning.latestAvailableVersion}),", but you're using ",(0,jsx_runtime.jsx)("b",{children:versionWarning.latestUsedVersion}),"."," ",(0,jsx_runtime.jsx)("br",{}),"error"===versionWarning.level?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"If something is not working as expected, try updating the SDK to the latest version where new features and bug fixes are available."}):void 0]})}},"../../frontend/src/scenes/surveys/SurveyTemplates.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SurveyTemplates:()=>SurveyTemplates,TemplateCard:()=>TemplateCard,scene:()=>scene});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/utils/eventUsageLogic.ts"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_scenes_components_SceneBreadcrumbs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneBreadcrumbs.tsx"),_SurveyAppearancePreview__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/surveys/SurveyAppearancePreview.tsx"),_constants__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/scenes/surveys/constants.tsx"),_surveyLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/scenes/surveys/surveyLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let scene={component:SurveyTemplates,settingSectionId:"environment-surveys"};function TemplateCard(_ref){let{template,idx,handleTemplateClick,surveyAppearance,isMostPopular}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("button",{className:"relative flex flex-col bg-bg-light border border-border rounded-lg hover:border-primary-3000-hover focus:border-primary-3000-hover focus:outline-none transition-colors text-left h-full group p-4 cursor-pointer overflow-hidden","data-attr":"survey-template",onClick:()=>handleTemplateClick(template),children:[isMostPopular&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"absolute bottom-0 right-0 z-10",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"relative",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"bg-primary-3000/85 text-white text-xs font-semibold px-3 py-1 rounded-tl-lg rounded-br-lg shadow-md",children:"Most Popular"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"absolute bottom-full right-0 w-0 h-0 border-r-[8px] border-r-transparent border-b-[6px] border-b-primary-3000 opacity-60"})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"flex items-center justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("h3",{className:"text-sm font-semibold text-default line-clamp-2 flex-1 mb-0",children:template.templateType}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.oe,{type:template.tagType||"default",size:"small",className:"ml-2 flex-shrink-0",children:template.category||"General"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("p",{className:"text-sm text-secondary leading-relaxed line-clamp-3",children:template.description})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"transform scale-75 pointer-events-none",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_SurveyAppearancePreview__WEBPACK_IMPORTED_MODULE_7__.$,{survey:{id:`templateMock-${idx}`,questions:template.questions,appearance:{..._constants__WEBPACK_IMPORTED_MODULE_8__.R3,whiteLabel:!0,...template.appearance,...surveyAppearance,disabledButtonOpacity:"1",maxWidth:"320px"}},previewPageIndex:0},idx)})})]})}function SurveyTemplates(){let{setSurveyTemplateValues}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)((0,_surveyLogic__WEBPACK_IMPORTED_MODULE_9__.TL)({id:"new"})),{reportSurveyTemplateClicked}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(lib_utils_eventUsageLogic__WEBPACK_IMPORTED_MODULE_2__.vx),{currentTeam}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic),surveyAppearance={...currentTeam?.survey_config?.appearance};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"mb-2 -ml-[var(--button-padding-x-lg)]",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_layout_scenes_components_SceneBreadcrumbs__WEBPACK_IMPORTED_MODULE_6__.A,{forceBackTo:{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_3__.x.Surveys,name:"Surveys",path:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.surveys()}})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("div",{className:"space-y-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)("p",{className:"text-center text-base",children:["Choose a template based on your goal, or"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.rU,{to:scenes_urls__WEBPACK_IMPORTED_MODULE_5__.j.survey("new"),className:"text-primary-3000","data-attr":"new-blank-survey",children:"start from scratch with a blank survey"}),"."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4",children:_constants__WEBPACK_IMPORTED_MODULE_8__.nj.map((template,idx)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(TemplateCard,{template:template,idx:idx,setSurveyTemplateValues:setSurveyTemplateValues,reportSurveyTemplateClicked:reportSurveyTemplateClicked,surveyAppearance:surveyAppearance,isMostPopular:template.templateType===_constants__WEBPACK_IMPORTED_MODULE_8__.i8.OpenFeedback,handleTemplateClick:template=>{var _template$questions,_template$conditions;setSurveyTemplateValues({name:template.templateType,questions:null!==(_template$questions=template.questions)&&void 0!==_template$questions?_template$questions:[],appearance:{..._constants__WEBPACK_IMPORTED_MODULE_8__.R3,...template.appearance,...surveyAppearance},conditions:null!==(_template$conditions=template.conditions)&&void 0!==_template$conditions?_template$conditions:null}),reportSurveyTemplateClicked(template.templateType)}},idx))})]})]})}},"../../frontend/src/scenes/surveys/Surveys.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),AccessControlAction=__webpack_require__("../../frontend/src/lib/components/AccessControlAction.tsx"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),VersionCheckerBanner=__webpack_require__("../../frontend/src/lib/components/VersionChecker/VersionCheckerBanner.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),accessControlUtils=__webpack_require__("../../frontend/src/lib/utils/accessControlUtils.ts"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),product_intents=__webpack_require__("../../frontend/src/lib/utils/product-intents.ts"),LinkedHogFunctions=__webpack_require__("../../frontend/src/scenes/hog-functions/list/LinkedHogFunctions.tsx"),MaxTool=__webpack_require__("../../frontend/src/scenes/max/MaxTool.tsx"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes=__webpack_require__("../../frontend/src/scenes/scenes.ts"),SurveyFeedbackButton=__webpack_require__("../../frontend/src/scenes/surveys/components/SurveyFeedbackButton.tsx"),MemberSelect=__webpack_require__("../../frontend/src/lib/components/MemberSelect.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),columnUtils=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),stringWithWBR=__webpack_require__("../../frontend/src/lib/utils/stringWithWBR.tsx"),SurveyStatusTag=__webpack_require__("../../frontend/src/scenes/surveys/components/SurveyStatusTag.tsx"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.281.0/node_modules/posthog-js/dist/module.js"),react_toastify_esm=__webpack_require__("../../node_modules/.pnpm/react-toastify@8.2.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-toastify/dist/react-toastify.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),utils=__webpack_require__("../../frontend/src/scenes/surveys/utils.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),sidePanelLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/sidePanelLogic.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),SurveyTemplates=__webpack_require__("../../frontend/src/scenes/surveys/SurveyTemplates.tsx"),constants=__webpack_require__("../../frontend/src/scenes/surveys/constants.tsx"),surveysLogic=__webpack_require__("../../frontend/src/scenes/surveys/surveysLogic.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SurveysEmptyState(_ref){let{numOfSurveys}=_ref,{createSurveyFromTemplate,addProductIntent}=(0,index_esm.useActions)(surveysLogic.kT),{user}=(0,index_esm.useValues)(userLogic.userLogic),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),{openSidePanel}=(0,index_esm.useActions)(sidePanelLogic.x),{data:{surveysCount}}=(0,index_esm.useValues)(surveysLogic.kT),priorityTemplates=constants.nj.filter(template=>[constants.i8.OpenFeedback,constants.i8.NPS,constants.i8.CSAT].includes(template.templateType)).map(template=>({...template,name:template.templateType,appearance:{...template.appearance,...currentTeam?.survey_config?.appearance}})),handleCreateSurveyFromTemplate=async survey=>{try{await createSurveyFromTemplate(survey)}catch(error){dist_module.ZP.captureException(error,{action:"survey-creation-from-template-failed"}),react_toastify_esm.Am.error("Error while creating survey from template. Please try again.")}};return(0,jsx_runtime.jsx)("div",{className:"border-2 border-dashed border-primary w-full p-4 rounded",children:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{className:"mb-0",children:surveysCount>0?"Create your next survey":"Create your first survey"}),(0,jsx_runtime.jsx)("p",{className:"mb-0",children:"Choose from our most popular templates to get started quickly, or create your own from scratch."}),numOfSurveys>0&&(0,jsx_runtime.jsx)("p",{className:"mb-0",children:"Your team is already using surveys. You can take a look at what they're doing, or get started yourself."})]}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:priorityTemplates.map((template,idx)=>(0,jsx_runtime.jsx)(SurveyTemplates.TemplateCard,{template:template,idx:idx,setSurveyTemplateValues:()=>{},reportSurveyTemplateClicked:()=>{},surveyAppearance:template.appearance,handleTemplateClick:()=>handleCreateSurveyFromTemplate(template),isMostPopular:template.templateType===constants.i8.OpenFeedback},template.templateType))}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-x-4 gap-y-2 flex-wrap",children:[user?.uuid&&(0,jsx_runtime.jsx)(MaxTool.Z,{identifier:"create_survey",initialMaxPrompt:"Create a survey to collect ",suggestions:["Create an NPS survey for customers who completed checkout","Create a feedback survey asking about our new dashboard"],context:{user_id:user.uuid},callback:toolOutput=>{if(addProductIntent({product_type:types.Md.SURVEYS,intent_context:product_intents.kp.SURVEY_CREATED,metadata:{survey_id:toolOutput.survey_id,source:constants.o.SURVEY_EMPTY_STATE,created_successfully:!toolOutput?.error}}),toolOutput?.error||!toolOutput?.survey_id)return(0,utils.zY)(toolOutput.error,constants.o.SURVEY_EMPTY_STATE);lib.router.actions.push(urls.j.survey(toolOutput.survey_id))},children:(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconSparkles,{}),onClick:()=>openSidePanel(types.H$.Max,"Create a survey to collect "),children:"Create your own custom survey with PostHog AI"})}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>lib.router.actions.push(urls.j.surveyTemplates()),children:"See all other templates"})]})]})})})}function SurveysTable(){var _filters$created_by;let{data:{surveys},searchedSurveys,dataLoading,surveysResponsesCount,surveysResponsesCountLoading,searchTerm,filters,tab,hasNextPage,hasNextSearchPage}=(0,index_esm.useValues)(surveysLogic.kT),{deleteSurvey,updateSurvey,setSearchTerm,setSurveysFilters,loadNextPage,loadNextSearchPage}=(0,index_esm.useActions)(surveysLogic.kT);return dataLoading||0!==surveys.length?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:(0,css_classes.cn)("flex flex-wrap gap-2 justify-between mb-0"),children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search for surveys",onChange:setSearchTerm,value:searchTerm||""}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[tab===surveysLogic.Iq.Active&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)("b",{children:"Status"})}),(0,jsx_runtime.jsx)(src.Yv,{dropdownMatchSelectWidth:!1,onChange:status=>{setSurveysFilters({status})},size:"small",options:[{label:"Any",value:"any"},{label:"Draft",value:"draft"},{label:"Running",value:"running"},{label:"Complete",value:"complete"}],value:filters.status})]}),(0,jsx_runtime.jsx)("span",{className:"ml-1",children:(0,jsx_runtime.jsx)("b",{children:"Created by"})}),(0,jsx_runtime.jsx)(MemberSelect.a,{defaultLabel:"Any user",value:null!==(_filters$created_by=filters.created_by)&&void 0!==_filters$created_by?_filters$created_by:null,onChange:user=>setSurveysFilters({created_by:user?.id})})]})]})}),(0,jsx_runtime.jsx)(src.g3,{dataSource:searchedSurveys,defaultSorting:{columnKey:"created_at",order:-1},rowKey:"name",nouns:["survey","surveys"],"data-attr":"surveys-table",emptyState:tab===surveysLogic.Iq.Active?"No surveys. Create a new survey?":"No surveys found",loading:dataLoading,footer:(searchTerm?hasNextSearchPage:hasNextPage)&&(0,jsx_runtime.jsx)("div",{className:"flex justify-center p-1",children:(0,jsx_runtime.jsx)(src.Jp,{onClick:searchTerm?loadNextSearchPage:loadNextPage,className:"min-w-full text-center",disabledReason:dataLoading?"Loading surveys":"",children:(0,jsx_runtime.jsx)("span",{className:"flex-1 text-center",children:dataLoading?"Loading...":"Load more"})})}),columns:[{dataIndex:"name",title:"Name",render:function RenderName(_,survey){return(0,jsx_runtime.jsx)(LemonTableLink.i,{to:urls.j.survey(survey.id),title:(0,stringWithWBR.Z)(survey.name,17)})}},{title:"Responses",dataIndex:"id",render:function RenderResponses(_,survey){var _surveysResponsesCoun;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:surveysResponsesCountLoading?(0,jsx_runtime.jsx)(src.$j,{}):(0,jsx_runtime.jsx)("div",{children:null!==(_surveysResponsesCoun=surveysResponsesCount[survey.id])&&void 0!==_surveysResponsesCoun?_surveysResponsesCoun:0})})},sorter:(surveyA,surveyB)=>{var _surveysResponsesCoun2,_surveysResponsesCoun3;return(null!==(_surveysResponsesCoun2=surveysResponsesCount[surveyA.id])&&void 0!==_surveysResponsesCoun2?_surveysResponsesCoun2:0)-(null!==(_surveysResponsesCoun3=surveysResponsesCount[surveyB.id])&&void 0!==_surveysResponsesCoun3?_surveysResponsesCoun3:0)}},{dataIndex:"type",title:"Mode",render:function RenderType(_,survey){return constants.kK[survey.type]}},{title:"Question type",render:function RenderResponses(_,survey){return survey.questions?.length===1?constants.By[survey.questions[0].type]:"Multiple"}},...tab===surveysLogic.Iq.Active?[(0,columnUtils.rw)(),{title:"Status",width:100,render:function Render(_,survey){return(0,jsx_runtime.jsx)(SurveyStatusTag.v,{survey:survey})}}]:[],{width:0,render:function Render(_,survey){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,onClick:()=>lib.router.actions.push(urls.j.survey(survey.id)),children:"View"}),!survey.start_date&&(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Survey,minAccessLevel:types.W$.Editor,userAccessLevel:survey.user_access_level,children:(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,onClick:()=>src.dn.open({title:"Launch this survey?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"The survey will immediately start displaying to users matching the display conditions."}),primaryButton:{children:"Launch",type:"primary",onClick:()=>{updateSurvey({id:survey.id,updatePayload:{start_date:(0,dayjs.Bv)().toISOString()},intentContext:product_intents.kp.SURVEY_LAUNCHED})},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}}),children:"Launch survey"})}),(0,utils.Gq)(survey)&&(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Survey,minAccessLevel:types.W$.Editor,userAccessLevel:survey.user_access_level,children:(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,onClick:()=>{src.dn.open({title:"Stop this survey?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"The survey will no longer be visible to your users."}),primaryButton:{children:"Stop",type:"primary",onClick:()=>{updateSurvey({id:survey.id,updatePayload:{end_date:(0,dayjs.Bv)().toISOString()},intentContext:product_intents.kp.SURVEY_COMPLETED})},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Stop survey"})}),survey.end_date&&!survey.archived&&(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Survey,minAccessLevel:types.W$.Editor,userAccessLevel:survey.user_access_level,children:(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,onClick:()=>{src.dn.open({title:"Resume this survey?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"Once resumed, the survey will be visible to your users again."}),primaryButton:{children:"Resume",type:"primary",onClick:()=>{updateSurvey({id:survey.id,updatePayload:{end_date:null},intentContext:product_intents.kp.SURVEY_RESUMED})},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Resume survey"})}),(0,jsx_runtime.jsx)(src.p2,{}),survey.end_date&&survey.archived&&(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Survey,minAccessLevel:types.W$.Editor,userAccessLevel:survey.user_access_level,children:(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,onClick:()=>{updateSurvey({id:survey.id,updatePayload:{archived:!1},intentContext:product_intents.kp.SURVEY_UNARCHIVED})},children:"Unarchive"})}),survey.end_date&&!survey.archived&&(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Survey,minAccessLevel:types.W$.Editor,userAccessLevel:survey.user_access_level,children:(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,onClick:()=>{src.dn.open({title:"Archive this survey?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"This action will remove the survey from your active surveys list. It can be restored at any time."}),primaryButton:{children:"Archive",type:"primary",onClick:()=>{updateSurvey({id:survey.id,updatePayload:{archived:!0},intentContext:product_intents.kp.SURVEY_ARCHIVED})},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Archive"})}),(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Survey,minAccessLevel:types.W$.Editor,userAccessLevel:survey.user_access_level,children:(0,jsx_runtime.jsx)(src.Jp,{status:"danger",onClick:()=>{src.dn.open({title:"Delete this survey?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"This action cannot be undone. All survey data will be permanently removed."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>deleteSurvey(survey.id),size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},fullWidth:!0,children:"Delete"})})]})})}}]})]}):(0,jsx_runtime.jsx)(SurveysEmptyState,{numOfSurveys:surveys.length})}var SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),SurveySettings=__webpack_require__("../../frontend/src/scenes/surveys/SurveySettings.tsx");let scene={component:Surveys,logic:surveysLogic.kT,settingSectionId:"environment-surveys"};function NewSurveyButton(){let{loadSurveys,addProductIntent}=(0,index_esm.useActions)(surveysLogic.kT),{user}=(0,index_esm.useValues)(userLogic.userLogic);return(0,jsx_runtime.jsx)(MaxTool.Z,{identifier:"create_survey",initialMaxPrompt:"Create a survey to collect ",suggestions:["Create an NPS survey for customers who completed checkout","Create a feedback survey asking about our new dashboard","Create a product-market fit survey for trial users","Create a quick satisfaction survey for support interactions"],context:{user_id:user?.uuid},callback:toolOutput=>{if(addProductIntent({product_type:types.Md.SURVEYS,intent_context:product_intents.kp.SURVEY_CREATED,metadata:{survey_id:toolOutput.survey_id,source:constants.o.MAX_AI,created_successfully:!toolOutput?.error}}),toolOutput?.error||!toolOutput?.survey_id)return(0,utils.zY)(toolOutput.error,constants.o.MAX_AI);loadSurveys(),lib.router.actions.push(urls.j.survey(toolOutput.survey_id))},position:"bottom-right",active:!!user?.uuid&&(0,accessControlUtils.y9)(types.qR.Survey,types.W$.Editor),className:(0,css_classes.cn)("mr-3"),children:(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:types.qR.Survey,minAccessLevel:types.W$.Editor,children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",to:urls.j.surveyTemplates(),type:"primary","data-attr":"new-survey",children:(0,jsx_runtime.jsx)("span",{className:"pr-3",children:"New survey"})})})})}function Surveys(){let{tab}=(0,index_esm.useValues)(surveysLogic.kT),{setTab}=(0,index_esm.useActions)(surveysLogic.kT);return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SurveySettings.p,{}),(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:scenes.lc[sceneTypes.x.Surveys].name,description:scenes.lc[sceneTypes.x.Surveys].description,resourceType:{type:scenes.lc[sceneTypes.x.Surveys].iconType||"default_icon_type"},actions:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SurveyFeedbackButton.k,{}),(0,jsx_runtime.jsx)(NewSurveyButton,{})]})}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tab,onChange:newTab=>setTab(newTab),tabs:[{key:surveysLogic.Iq.Active,label:"Active"},{key:surveysLogic.Iq.Archived,label:"Archived"},{key:surveysLogic.Iq.Notifications,label:"Notifications"},{key:surveysLogic.Iq.History,label:"History"},{key:surveysLogic.Iq.Settings,label:"Settings"}],sceneInset:!0}),tab===surveysLogic.Iq.Settings&&(0,jsx_runtime.jsx)(SurveySettings.N,{}),tab===surveysLogic.Iq.Notifications&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("p",{children:"Get notified whenever a survey result is submitted"}),(0,jsx_runtime.jsx)(LinkedHogFunctions.k,{type:"destination",subTemplateIds:["survey-response"]})]}),tab===surveysLogic.Iq.History&&(0,jsx_runtime.jsx)(ActivityLog.DA,{scope:types.jc.SURVEY}),(tab===surveysLogic.Iq.Active||tab===surveysLogic.Iq.Archived)&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(VersionCheckerBanner.o,{}),(0,jsx_runtime.jsx)(SurveysTable,{})]})]})}}}]);
//# sourceMappingURL=64505.609e5b7a.iframe.bundle.js.map