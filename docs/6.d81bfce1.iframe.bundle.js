(window.webpackJsonp=window.webpackJsonp||[]).push([[6,7,8,9,307],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(C,_,e){"use strict";e.r(_);var v=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),p=e.n(v),u=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),i=e.n(u),j={};j.insert="head",j.singleton=!1;var M=p()(i.a,j);_.default=i.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(C,_,e){"use strict";e.r(_),e.d(_,"AppMetricsGraph",function(){return I});var v=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),p=e.n(v),u=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),i=e.n(u),j=e("./node_modules/core-js/modules/es.array.concat.js"),M=e.n(j),x=e("./node_modules/core-js/modules/es.object.keys.js"),F=e.n(x),a=e("./node_modules/core-js/modules/es.symbol.js"),V=e.n(a),g=e("./node_modules/core-js/modules/es.array.filter.js"),L=e.n(g),y=e("./node_modules/core-js/modules/es.object.to-string.js"),m=e.n(y),P=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),A=e.n(P),D=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),T=e.n(D),E=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),S=e.n(E),h=e("./node_modules/react/index.js"),Y=e.n(h),O=e("./frontend/src/lib/colors.ts"),N=e("./node_modules/chart.js/dist/chart.mjs"),J=e("./frontend/src/scenes/apps/constants.tsx"),K=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),H=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),U=e("./frontend/src/lib/utils.tsx"),b=e("./node_modules/react/jsx-runtime.js"),Z=e.n(b);function $(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),s.push.apply(s,n)}return s}function d(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$(Object(s),!0).forEach(function(n){p()(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function I(t){var r=t.tab,s=t.metrics,n=t.metricsLoading,o=Object(h.useRef)(null),c=J.DescriptionColumns[r];return Object(h.useEffect)(function(){var f;if(o.current&&s){var l;f=new N.a((l=o.current)===null||l===void 0?void 0:l.getContext("2d"),{type:"line",data:{labels:s.dates,datasets:[d({label:c.successes,data:s.successes,borderColor:""},G("data-brand-blue"))].concat(i()(c.successes_on_retry?[d({label:c.successes_on_retry,data:s.successes_on_retry},G("data-yellow"))]:[]),[d({label:c.failures,data:s.failures},G("data-pink"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var R;(R=f)===null||R===void 0||R.destroy()}},[s]),n||!s?Object(b.jsx)(K.a,{className:"AppMetricsGraph"}):Object(b.jsx)("div",{className:"AppMetricsGraph",children:Object(b.jsx)("canvas",{ref:o})})}function G(t){var r=Object(O.b)(t);return{borderColor:r,hoverBorderColor:Object(U.lb)(r,-20),hoverBackgroundColor:Object(U.lb)(r,-20),backgroundColor:r,fill:!1,borderWidth:2,pointRadius:0}}try{I.displayName="AppMetricsGraph",I.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:I.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(t){}},"./frontend/src/scenes/apps/MetricsTab.tsx":function(C,_,e){"use strict";e.r(_),e.d(_,"MetricsTab",function(){return g}),e.d(_,"MetricsOverview",function(){return L});var v=e("./node_modules/antd/es/card/index.js"),p=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),u=e("./frontend/src/scenes/apps/constants.tsx"),i=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),j=e("./frontend/src/lib/utils.tsx"),M=e("./frontend/src/scenes/apps/AppMetricsGraph.tsx"),x=e("./frontend/src/lib/components/LemonSelect.tsx"),F=e("./node_modules/kea/lib/index.esm.js"),a=e("./node_modules/react/jsx-runtime.js"),V=e.n(a);function g(m){var P=m.tab,A=Object(F.useValues)(p.appMetricsSceneLogic),D=A.metrics,T=A.metricsLoading,E=A.dateFrom,S=Object(F.useActions)(p.appMetricsSceneLogic),h=S.setDateFrom;return Object(a.jsxs)("div",{className:"mt-4",children:[Object(a.jsx)(v.a,{title:Object(a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[Object(a.jsx)("span",{children:"Metrics overview"}),Object(a.jsx)(x.a,{value:E,onChange:function(O){return h(O)},options:[{label:"Last 30 days",value:"-30d"},{label:"Last 7 days",value:"-7d"},{label:"Last 24 hours",value:"-24h"}]})]}),children:Object(a.jsx)(L,{tab:P,metrics:D,metricsLoading:T})}),Object(a.jsx)(v.a,{title:"Delivery trends",className:"mt-4",children:Object(a.jsx)(M.AppMetricsGraph,{tab:P,metrics:D,metricsLoading:T})})]})}function L(m){var P,A,D,T=m.tab,E=m.metrics,S=m.metricsLoading;return S?Object(a.jsx)(i.a,{className:"h-20"}):Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"card-secondary",children:u.DescriptionColumns[T].successes}),Object(a.jsx)("div",{children:y(E==null||(P=E.totals)===null||P===void 0?void 0:P.successes)})]}),u.DescriptionColumns[T].successes_on_retry&&Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"card-secondary",children:u.DescriptionColumns[T].successes_on_retry}),Object(a.jsx)("div",{children:y(E==null||(A=E.totals)===null||A===void 0?void 0:A.successes_on_retry)})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"card-secondary",children:u.DescriptionColumns[T].failures}),Object(a.jsx)("div",{children:y(E==null||(D=E.totals)===null||D===void 0?void 0:D.failures)})]})]})}function y(m){return Object(a.jsx)(a.Fragment,{children:m&&Object(j.P)(m)})}try{g.displayName="MetricsTab",g.__docgenInfo={description:"",displayName:"MetricsTab",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"]={docgenInfo:g.__docgenInfo,name:"MetricsTab",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsTab"})}catch(m){}try{L.displayName="MetricsOverview",L.__docgenInfo={description:"",displayName:"MetricsOverview",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!0,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"]={docgenInfo:L.__docgenInfo,name:"MetricsOverview",path:"frontend/src/scenes/apps/MetricsTab.tsx#MetricsOverview"})}catch(m){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(C,_,e){"use strict";e.r(_),e.d(_,"AppMetricsTab",function(){return d}),e.d(_,"appMetricsSceneLogic",function(){return G});var v=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),p=e.n(v),u=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),i=e.n(u),j=e("./node_modules/@babel/runtime/regenerator/index.js"),M=e.n(j),x=e("./node_modules/core-js/modules/es.array.iterator.js"),F=e.n(x),a=e("./node_modules/core-js/modules/es.object.to-string.js"),V=e.n(a),g=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),L=e.n(g),y=e("./node_modules/core-js/modules/es.array.concat.js"),m=e.n(y),P=e("./node_modules/core-js/modules/es.function.name.js"),A=e.n(P),D=e("./node_modules/core-js/modules/es.array.includes.js"),T=e.n(D),E=e("./node_modules/core-js/modules/es.string.includes.js"),S=e.n(E),h=e("./node_modules/core-js/modules/es.array.filter.js"),Y=e.n(h),O=e("./node_modules/kea/lib/index.esm.js"),N=e("./node_modules/kea-loaders/lib/index.js"),J=e.n(N),K=e("./frontend/src/scenes/urls.ts"),H=e("./frontend/src/lib/api.ts"),U=e("./frontend/src/scenes/teamLogic.tsx"),b=e("./node_modules/kea-router/lib/index.js"),Z=e.n(b),$=e("./frontend/src/lib/utils.tsx"),d;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.HistoricalExports="historical_exports"})(d||(d={}));var I=[d.ProcessEvent,d.OnEvent,d.ExportEvents],G=Object(O.kea)([Object(O.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(O.props)({}),Object(O.key)(function(t){return t.pluginConfigId}),Object(O.actions)({setActiveTab:function(r){return{tab:r}},setDateFrom:function(r){return{dateFrom:r}}}),Object(O.reducers)({activeTab:[null,{setActiveTab:function(r,s){var n=s.tab;return n}}],dateFrom:["-30d",{setDateFrom:function(r,s){var n=s.dateFrom;return n}}]}),Object(N.loaders)(function(t){var r=t.values,s=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var n=i()(M.a.mark(function c(){return M.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,H.b.get("api/projects/".concat(U.a.values.currentTeamId,"/plugin_configs/").concat(s.pluginConfigId));case 2:return l.abrupt("return",l.sent);case 3:case"end":return l.stop()}},c)}));function o(){return n.apply(this,arguments)}return o}()}],metrics:[null,{loadMetrics:function(){var n=i()(M.a.mark(function c(){var f,l,R;return M.a.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return f=Object($.Eb)({category:r.activeTab,date_from:r.dateFrom}),W.next=3,H.b.get("api/projects/".concat(U.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"?").concat(f));case 3:return l=W.sent,R=l.results,W.abrupt("return",R);case 6:case"end":return W.stop()}},c)}));function o(){return n.apply(this,arguments)}return o}()}],historicalExports:[[],{loadHistoricalExports:function(){var n=i()(M.a.mark(function c(){var f,l;return M.a.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,H.b.get("api/projects/".concat(U.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/historical_exports"));case 2:return f=B.sent,l=f.results,B.abrupt("return",l);case 5:case"end":return B.stop()}},c)}));function o(){return n.apply(this,arguments)}return o}()}]}}),Object(O.selectors)(function(t){var r=t.values;return{breadcrumbs:[function(s){return[s.pluginConfig,function(n,o){return o.pluginConfigId}]},function(s,n){var o;return[{name:"Apps",path:K.a.projectApps()},{name:s==null||(o=s.plugin_info)===null||o===void 0?void 0:o.name,path:K.a.appMetrics(n)}]}],showTab:[function(){return[]},function(){return function(s){var n;if(r.pluginConfigLoading||!r.pluginConfig)return!1;var o=((n=r.pluginConfig.plugin_info.capabilities)===null||n===void 0?void 0:n.methods)||[];return s===d.HistoricalExports?o.includes("exportEvents"):s===d.OnEvent&&o.includes("exportEvents")?!1:o.includes(s)}}]}}),Object(O.listeners)(function(t){var r=t.values,s=t.actions;return{loadPluginConfigSuccess:function(){if(!r.activeTab){var o=I.filter(function(l){return r.showTab(l)}),c=p()(o,1),f=c[0];s.setActiveTab(f)}},setActiveTab:function(o){var c=o.tab;c===d.HistoricalExports?s.loadHistoricalExports():s.loadMetrics()},setDateFrom:function(){s.loadMetrics()}}}),Object(b.actionToUrl)(function(t){var r=t.values,s=t.props;return{setActiveTab:function(){var o;return r.activeTab===d.HistoricalExports?K.a.appHistoricalExports(s.pluginConfigId):K.a.appMetrics(s.pluginConfigId,(o=r.activeTab)!==null&&o!==void 0?o:void 0)}}}),Object(b.urlToAction)(function(t){var r=t.values,s=t.actions;return{"/app/:pluginConfigId/:page":function(o,c){r.pluginConfig||s.loadPluginConfig(),o.page===d.HistoricalExports?s.setActiveTab(d.HistoricalExports):c.tab&&I.includes(c.tab)&&s.setActiveTab(c.tab)}}})])},"./frontend/src/scenes/apps/constants.tsx":function(C,_,e){"use strict";e.r(_),e.d(_,"DescriptionColumns",function(){return j});var v=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),p=e.n(v),u=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),i,j=(i={},p()(i,u.AppMetricsTab.ProcessEvent,{successes:"Events processed",failures:"Failed events"}),p()(i,u.AppMetricsTab.OnEvent,{successes:"Events processed",successes_on_retry:"Events processed on retry",failures:"Failed events"}),p()(i,u.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),p()(i,u.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_on_retry:"Events delivered on retry",failures:"Failed events"}),i)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(C,_,e){var v=e("./node_modules/css-loader/dist/runtime/api.js");_=v(!1),_.push([C.i,".AppMetricsGraph{height:300px}",""]),C.exports=_}}]);
