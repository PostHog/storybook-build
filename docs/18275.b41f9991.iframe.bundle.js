"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[18275],{"../../products/llm_observability/frontend/LLMObservabilityPlaygroundScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{LLMObservabilityPlaygroundScene:()=>LLMObservabilityPlaygroundScene,scene:()=>scene});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.20.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../products/llm_observability/frontend/llmObservabilityPlaygroundLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let formatMs=ms=>null==ms?"-":ms<1e3?`${ms.toFixed(0)} ms`:`${(ms/1e3).toFixed(2)} s`,scene={component:LLMObservabilityPlaygroundScene,logic:_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x};function LLMObservabilityPlaygroundScene(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(kea__WEBPACK_IMPORTED_MODULE_2__.BindLogic,{logic:_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x,props:{key:"llm-observability-playground-scene"},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(PlaygroundLayout,{})})}function PlaygroundLayout(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex flex-col gap-4 min-h-[calc(100vh-120px)]",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex gap-4 flex-1 h-[calc(100vh-120px)]",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"w-1/2 flex flex-col border rounded p-4 overflow-hidden",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("h3",{className:"text-lg font-semibold mb-4 shrink-0",children:"Input"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(InputPanel,{})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"w-1/2 flex flex-col border rounded overflow-hidden",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(OutputPanel,{})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(ComparisonTablePanel,{})]})}function InputPanel(){let{messages,submitting}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x),{addMessage,clearConversation}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x),scrollRef=(0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)(null);return(0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(()=>{scrollRef.current&&(scrollRef.current.scrollTop=scrollRef.current.scrollHeight)},[messages]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{ref:scrollRef,className:"flex-1 overflow-y-auto space-y-3 pr-2 mb-3",children:[messages.map((message,index)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(MessageEditor,{index:index,message:message},index)),0===messages.length&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-muted",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconMessage,{className:"text-3xl mb-2"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("p",{children:"Add messages to start the conversation."})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex gap-2 pt-2 border-t shrink-0",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconPlus,{}),onClick:()=>addMessage(),disabled:submitting,children:"Add Message"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"secondary",status:"danger",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconTrash,{}),onClick:clearConversation,disabled:submitting||0===messages.length,tooltip:"Clear all messages",className:"ml-auto",children:"Clear All"})]})]})}function MessageEditor(_ref){let{message,index}=_ref,{updateMessage,deleteMessage}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"border rounded p-3 relative group bg-bg-light dark:bg-bg-dark",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{size:"small",status:"danger",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconTrash,{}),tooltip:"Delete message",noPadding:!0,onClick:()=>deleteMessage(index)})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Yv,{size:"small",options:[{label:"Human",value:"user"},{label:"AI",value:"assistant"},{label:"System",value:"system"}],value:message.role,onChange:newRole=>{updateMessage(index,{role:newRole})},dropdownMatchSelectWidth:!1})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__._V,{className:"text-sm w-full",placeholder:`Enter ${message.role} message here...`,value:message.content,onChange:newContent=>{updateMessage(index,{content:newContent})},minRows:2})]})}function OutputPanel(){let runDisabledReason;let{submitting,currentResponse,model,lastRunDetails,messages}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x),{submitPrompt,addResponseToHistory,addCurrentRunToComparison}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x),[configOpen,setConfigOpen]=(0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(!0);return 0===messages.length&&(runDisabledReason="Add messages to start the conversation"),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex-1 flex flex-col h-full",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex justify-between items-center p-2 border-b shrink-0 gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex items-center gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"primary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconPlay,{}),onClick:submitPrompt,loading:submitting,disabledReason:submitting?"Generating...":runDisabledReason,children:"Run"}),model&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"text-sm text-muted",children:model})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconGear,{}),onClick:()=>setConfigOpen(!configOpen),active:configOpen,tooltip:configOpen?"Hide configuration":"Show configuration",children:"Toggle Config"})]}),configOpen&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"p-4 border-b overflow-y-auto shrink-0",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(ConfigurationPanel,{})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[" ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("h3",{className:"text-base font-semibold mb-2 text-muted",children:"AI Output"}),submitting&&(null===currentResponse||""===currentResponse)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.yW,{active:!0,className:"my-2"}),currentResponse&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("pre",{className:"whitespace-pre-wrap text-sm break-words",children:[currentResponse,submitting&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{className:"text-muted italic",children:" (streaming...)"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex gap-2",children:[!submitting&&currentResponse&&currentResponse.trim()&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"secondary",size:"small",onClick:()=>addResponseToHistory(currentResponse),className:"mt-2",children:"Add to Chat History"}),!submitting&&lastRunDetails&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"secondary",size:"small",className:"mt-2",onClick:addCurrentRunToComparison,tooltip:lastRunDetails?"Add this run to comparison table":"Run the prompt first to enable comparison",children:"Add to Compare"})]})]})]})}function ConfigurationPanel(){let{systemPrompt,temperature,maxTokens,thinking,model,modelOptions,modelOptionsLoading}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x),{setSystemPrompt,setTemperature,setMaxTokens,setThinking,setModel}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x),options=Array.isArray(modelOptions)?modelOptions:[];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"space-y-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"Model"}),modelOptionsLoading&&!options.length?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.yW,{className:"h-10"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Yv,{className:"w-full",placeholder:"Select model",value:model,onChange:value=>setModel(value),options:options.map(option=>({label:`${option.name} (${option.provider})`,value:option.id,tooltip:option.description||`Provider: ${option.provider}`})),loading:modelOptionsLoading,disabled:modelOptionsLoading||0===options.length}),0===options.length&&!modelOptionsLoading&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("p",{className:"text-xs text-danger mt-1",children:"No models available. Check proxy status."})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"System Prompt"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__._V,{className:"text-sm",placeholder:"Instructions for the AI assistant...",value:systemPrompt,onChange:val=>setSystemPrompt(val),rows:3})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("label",{className:"font-semibold mb-1 block text-sm",children:["Temperature: ",temperature.toFixed(1)]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("input",{type:"range",className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700",min:0,max:1,step:.1,value:temperature,onChange:e=>setTemperature(Number(e.target.value))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"text-xs text-muted mt-1 flex justify-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{children:"Precise"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("span",{children:"Creative"})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("label",{className:"font-semibold mb-1 block text-sm",children:"Max tokens"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.DF,{type:"number",value:maxTokens,onChange:val=>setMaxTokens(Number(val)),min:1,max:16384,step:64})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("input",{id:"thinkingToggle",type:"checkbox",className:"rounded text-primary focus:ring-primary",checked:thinking,onChange:e=>{setThinking(e.target.checked)}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("label",{htmlFor:"thinkingToggle",className:"text-sm font-medium",children:"Enable thinking/reasoning stream (if supported)"})]})]})}function ComparisonTablePanel(){let{comparisonItems}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x),{clearComparison}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(_llmObservabilityPlaygroundLogic__WEBPACK_IMPORTED_MODULE_4__.x),columns=[{title:"Model",dataIndex:"model",render:model=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.oe,{children:"string"==typeof model&&model||"-"}),sorter:(a,b)=>a.model.localeCompare(b.model)},{title:"Response",dataIndex:"response",render:response=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"max-h-40 overflow-y-auto whitespace-pre-wrap text-xs break-words p-1 border rounded bg-bg-light dark:bg-bg-dark",children:"string"==typeof response?response:"-"}),width:"40%"},{title:"TTFT",dataIndex:"ttftMs",render:ttftMs=>formatMs(ttftMs),sorter:(a,b)=>{var _a$ttftMs,_b$ttftMs;return(null!==(_a$ttftMs=a.ttftMs)&&void 0!==_a$ttftMs?_a$ttftMs:1/0)-(null!==(_b$ttftMs=b.ttftMs)&&void 0!==_b$ttftMs?_b$ttftMs:1/0)},align:"right",tooltip:"Time To First Token"},{title:"Latency",dataIndex:"latencyMs",render:latencyMs=>formatMs(latencyMs),sorter:(a,b)=>{var _a$latencyMs,_b$latencyMs;return(null!==(_a$latencyMs=a.latencyMs)&&void 0!==_a$latencyMs?_a$latencyMs:1/0)-(null!==(_b$latencyMs=b.latencyMs)&&void 0!==_b$latencyMs?_b$latencyMs:1/0)},align:"right",tooltip:"Total Request Latency"}];return 0===comparisonItems.length?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.Fragment,{}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"border rounded p-4 min-h-0 flex flex-col",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("div",{className:"flex justify-between items-center mb-4 shrink-0",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("h3",{className:"text-lg font-semibold",children:"Comparison"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"secondary",status:"danger",size:"small",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconTrash,{}),onClick:clearComparison,tooltip:"Clear all comparison items",children:"Clear All"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.g3,{dataSource:comparisonItems,columns:columns,rowKey:"id",loading:!1,embedded:!0})})]})}}}]);