(window.webpackJsonp=window.webpackJsonp||[]).push([[239],{"./frontend/src/lib/components/RestrictedArea.tsx":function(ce,x,n){"use strict";n.d(x,"b",function(){return S}),n.d(x,"a",function(){return k});var T=n("./node_modules/core-js/modules/es.array.concat.js"),V=n.n(T),F=n("./node_modules/kea/lib/index.esm.js"),E=n("./node_modules/react/index.js"),e=n.n(E),b=n("./frontend/src/scenes/organizationLogic.tsx"),Y=n("./frontend/src/lib/constants.tsx"),q=n("./frontend/src/lib/components/Tooltip.tsx"),$=n("./frontend/src/lib/utils/permissioning.ts"),P=n("./frontend/src/scenes/teamLogic.tsx"),S;(function(z){z.Organization="organization",z.Project="project"})(S||(S={}));function k(z){var de=z.Component,ee=z.minimumAccessLevel,ue=z.scope,_=ue===void 0?S.Organization:ue,K=Object(F.useValues)(b.a),m=K.currentOrganization,ne=Object(F.useValues)(P.a),U=ne.currentTeam,Z=Object(E.useMemo)(function(){var N;if(_===S.Project){if(!U)return"Loading current project\u2026";N=U.effective_membership_level}else{if(!m)return"Loading current organization\u2026";N=m.membership_level}return N===null?"You don't have access to the current ".concat(_,"."):N<ee?ee===Y.m.Owner?"This area is restricted to the ".concat(_," owner."):"This area is restricted to ".concat(_," ").concat($.b.get(ee),"s and up. Your level is ").concat($.b.get(N),"."):null},[m]);return Z?e.a.createElement(q.a,{title:Z,placement:"topLeft",delayMs:0},e.a.createElement("span",null,e.a.createElement(de,{isRestricted:!0,restrictionReason:Z}))):e.a.createElement(de,{isRestricted:!1,restrictionReason:null})}try{k.displayName="RestrictedArea",k.__docgenInfo={description:"",displayName:"RestrictedArea",props:{Component:{defaultValue:null,description:"",name:"Component",required:!0,type:{name:"(props: RestrictedComponentProps) => Element"}},minimumAccessLevel:{defaultValue:null,description:"",name:"minimumAccessLevel",required:!0,type:{name:"enum",value:[{value:"1"},{value:"8"},{value:"15"},{value:"1"},{value:"8"}]}},scope:{defaultValue:{value:"RestrictionScope.Organization"},description:"",name:"scope",required:!1,type:{name:"enum",value:[{value:'"organization"'},{value:'"project"'}]}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"]={docgenInfo:k.__docgenInfo,name:"RestrictedArea",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictedArea"})}catch(z){}try{S.Organization.displayName="RestrictionScope.Organization",S.Organization.__docgenInfo={description:"Current organization-wide membership level will be used.",displayName:"RestrictionScope.Organization",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"]={docgenInfo:S.Organization.__docgenInfo,name:"RestrictionScope.Organization",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Organization"})}catch(z){}try{S.Project.displayName="RestrictionScope.Project",S.Project.__docgenInfo={description:"Effective level for the current project will be used.",displayName:"RestrictionScope.Project",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"]={docgenInfo:S.Project.__docgenInfo,name:"RestrictionScope.Project",path:"frontend/src/lib/components/RestrictedArea.tsx#RestrictionScope.Project"})}catch(z){}},"./frontend/src/lib/hooks/useAnchor.ts":function(ce,x,n){"use strict";n.d(x,"a",function(){return F});var T=n("./node_modules/react/index.js"),V=n.n(T);function F(E){Object(T.useEffect)(function(){if(E&&document.getElementById(E.substr(1))){var e=document.getElementById(E.substr(1));if(!e)return;e.classList.add("highlighted");var b=e.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:b-50-32,behavior:"smooth"})}},[E])}},"./frontend/src/scenes/organization/Settings/index.tsx":function(ce,x,n){"use strict";n.r(x),n.d(x,"scene",function(){return On}),n.d(x,"OrganizationSettings",function(){return Re});var T=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),V=n.n(T),F=n("./node_modules/core-js/modules/es.function.name.js"),E=n("./node_modules/react/index.js"),e=n.n(E),b=n("./node_modules/antd/es/input/index.js"),Y=n("./node_modules/antd/es/button/index.js"),q=n("./node_modules/antd/es/switch/index.js"),$=n("./node_modules/antd/es/card/index.js"),P=n("./node_modules/antd/es/divider/index.js"),S=n("./frontend/src/lib/components/PageHeader.tsx"),k=n("./node_modules/core-js/modules/es.array.iterator.js"),z=n("./node_modules/core-js/modules/es.object.to-string.js"),de=n("./node_modules/core-js/modules/es.string.iterator.js"),ee=n("./node_modules/core-js/modules/web.dom-collections.iterator.js"),ue=n("./node_modules/core-js/modules/web.url.js"),_=n("./node_modules/core-js/modules/web.url-search-params.js"),K=n("./node_modules/antd/es/modal/index.js"),m=n("./node_modules/kea/lib/index.esm.js"),ne=n("./node_modules/@ant-design/icons/es/icons/ExclamationCircleOutlined.js"),U=n("./frontend/src/lib/components/CopyToClipboard.tsx"),Z=n("./frontend/src/lib/components/ProfilePicture/index.ts"),N=n("./frontend/src/scenes/organization/Settings/inviteLogic.ts"),Te=n("./frontend/src/scenes/organization/Settings/InviteModal.tsx"),ye=n("./frontend/src/lib/components/LemonTable/index.ts"),Oe=n("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),he=n("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),R=n("./frontend/src/lib/components/LemonButton/index.ts"),I=n("./frontend/src/lib/components/icons.tsx");function Pe(t,a){var l=new URL("/signup/".concat(t),document.baseURI).href;return a.is_expired?e.a.createElement("b",null,"Expired! Delete and recreate"):e.a.createElement(U.a,{"data-attr":"invite-link",description:"invite link"},l)}function Ne(t){return function(l,r){return e.a.createElement(R.a,{title:"Cancel the invite","data-attr":"invite-delete",icon:e.a.createElement(I.IconClose,null),status:"danger",onClick:function(){r.is_expired?t(r):K.a.confirm({title:"Do you want to cancel the invite for ".concat(r.target_email,"?"),icon:e.a.createElement(ne.a,null),okText:"Yes, cancel invite",okType:"danger",onOk:function(){t(r)},cancelText:"No, keep invite"})}})}}function we(){var t=Object(m.useValues)(N.a),a=t.invites,l=t.invitesLoading,r=Object(m.useActions)(N.a),c=r.deleteInvite,d=r.showInviteModal,o=Object(m.useValues)(he.a),s=o.preflight,i=[{title:"Invitee",dataIndex:"target_email",key:"target_email",render:function(v,g){return g.target_email?e.a.createElement("div",{className:"flex-center"},e.a.createElement(Z.b,{name:g.first_name,email:g.target_email,size:"md",style:{marginRight:8}}),g.target_email,g.first_name?" (".concat(g.first_name,")"):""):e.a.createElement("i",null,"no one")},width:"20%"},Object(Oe.b)(),Object(Oe.a)(),{title:"Invite Link",dataIndex:"id",key:"link",render:function(v,g){return Pe(g.id,g)}},{title:"",key:"actions",width:24,render:Ne(c)}];return e.a.createElement("div",null,e.a.createElement("h2",{id:"invites",className:"subtitle",style:{justifyContent:"space-between"}},"Pending Invites",e.a.createElement(R.a,{type:"primary",onClick:d,"data-attr":"invite-teammate-button"},"Invite team member")),!(s!=null&&s.email_service_available)&&e.a.createElement(Te.a,null),e.a.createElement(ye.a,{dataSource:a,columns:i,rowKey:"id",loading:l,style:{marginTop:"1rem"},"data-attr":"invites-table",emptyState:"There are no outstanding invitations. You can invite another team member above."}))}var jn=n("./node_modules/core-js/modules/es.array.filter.js"),An=n("./node_modules/core-js/modules/es.array.map.js"),Cn=n("./node_modules/core-js/modules/es.array.concat.js"),Be=n("./node_modules/antd/es/dropdown/index.js"),be=n("./node_modules/antd/es/menu/index.js"),Fe=n("./node_modules/antd/es/table/index.js"),me=n("./frontend/src/scenes/organization/Settings/membersLogic.tsx"),Se=n("./node_modules/@ant-design/icons/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),Ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M847.9 592H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h605.2L612.9 851c-4.1 5.2-.4 13 6.3 13h72.5c4.9 0 9.5-2.2 12.6-6.1l168.8-214.1c16.5-21 1.6-51.8-25.2-51.8zM872 356H266.8l144.3-183c4.1-5.2.4-13-6.3-13h-72.5c-4.9 0-9.5 2.2-12.6 6.1L150.9 380.2c-16.5 21-1.6 51.8 25.1 51.8h696c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"swap",theme:"outlined"},Ue=Ke,We=n("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),je=function(a,l){return E.createElement(We.a,Object(Se.a)(Object(Se.a)({},a),{},{ref:l,icon:Ue}))};je.displayName="SwapOutlined";var Ye=E.forwardRef(je),Ae=n("./node_modules/@ant-design/icons/es/icons/CrownFilled.js"),$e=n("./node_modules/@ant-design/icons/es/icons/UpOutlined.js"),Ze=n("./node_modules/@ant-design/icons/es/icons/DownOutlined.js"),Ce=n("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),Ge=n("./node_modules/@ant-design/icons/es/icons/LogoutOutlined.js"),He=n("./frontend/src/lib/utils.tsx"),h=n("./frontend/src/lib/constants.tsx"),L=n("./frontend/src/scenes/organizationLogic.tsx"),fe=n("./frontend/src/scenes/userLogic.ts"),te=n("./frontend/src/lib/components/Tooltip.tsx"),G=n("./frontend/src/lib/utils/permissioning.ts");function Qe(t){var a,l=Object(m.useValues)(fe.a),r=l.user,c=Object(m.useValues)(L.a),d=c.currentOrganization,o=Object(m.useActions)(me.a),s=o.changeMemberAccessLevel,i=d?d.membership_level:null;if(!r)return null;function f(u){return function(C){if(C.preventDefault(),!r)throw Error;if(u===h.m.Owner){var M;K.a.confirm({centered:!0,title:"Transfer organization ownership to ".concat(t.user.first_name,"?"),content:"You will no longer be the owner of ".concat((M=r.organization)===null||M===void 0?void 0:M.name,". After the transfer you will become an administrator."),icon:e.a.createElement(Ye,null),okType:"danger",okText:"Transfer Ownership",onOk:function(){s(t,u)}})}else s(t,u)}}var v=e.a.createElement(Y.a,{"data-attr":"change-membership-level",icon:t.level===h.m.Owner?e.a.createElement(Ae.a,null):void 0},(a=G.b.get(t.level))!==null&&a!==void 0?a:"unknown (".concat(t.level,")")),g=G.c.filter(function(u){return!Object(G.a)(i,r,t,u)}),y=Object(G.a)(i,r,t,g);return y?e.a.createElement(te.a,{title:y},v):e.a.createElement(Be.a,{overlay:e.a.createElement(be.a,null,g.map(function(u){return e.a.createElement(be.a.Item,{key:"".concat(t.user.uuid,"-level-").concat(u)},e.a.createElement("a",{href:"#",onClick:f(u),"data-test-level":u},u===h.m.Owner?e.a.createElement(e.a.Fragment,null,e.a.createElement(Ae.a,{style:{marginRight:"0.5rem"}}),"Transfer organization ownership"):u>t.level?e.a.createElement(e.a.Fragment,null,e.a.createElement($e.a,{style:{marginRight:"0.5rem"}}),"Upgrade to ",G.b.get(u)):e.a.createElement(e.a.Fragment,null,e.a.createElement(Ze.a,{style:{marginRight:"0.5rem"}}),"Downgrade to ",G.b.get(u))))}))},v)}function Je(t){var a,l=Object(m.useValues)(fe.a),r=l.user,c=Object(m.useValues)(L.a),d=c.currentOrganization,o=Object(m.useActions)(me.a),s=o.removeMember;if(!r)return null;var i=(a=d==null?void 0:d.membership_level)!==null&&a!==void 0?a:-1;function f(){var g;if(!r)throw Error;K.a.confirm({title:"".concat(t.user.uuid==r.uuid?"Leave":"Remove ".concat(t.user.first_name," from")," organization ").concat((g=r.organization)===null||g===void 0?void 0:g.name,"?"),icon:e.a.createElement(ne.a,null),okText:t.user.uuid==r.uuid?"Leave":"Remove",okType:"danger",cancelText:"Cancel",onOk:function(){s(t)}})}var v=(i>=h.m.Admin&&t.level<=i||t.user.uuid===r.uuid)&&t.level!==h.m.Owner;return e.a.createElement("div",null,v&&e.a.createElement("a",{className:"text-danger",onClick:f,"data-attr":"delete-org-membership"},t.user.uuid!==r.uuid?e.a.createElement(Ce.a,{title:"Remove from organization"}):e.a.createElement(Ge.a,{title:"Leave organization"})))}function ae(t){var a=t.user,l=Object(m.useValues)(me.a),r=l.members,c=l.membersLoading,d=[{key:"user_profile_picture",render:function(s,i){return e.a.createElement(Z.b,{name:i.user.first_name,email:i.user.email})},width:32},{title:"Name",key:"user_first_name",render:function(s,i){return i.user.uuid==a.uuid?"".concat(i.user.first_name," (me)"):i.user.first_name},sorter:function(s,i){return s.user.first_name.localeCompare(i.user.first_name)}},{title:"Email",key:"user_email",render:function(s,i){return i.user.email},sorter:function(s,i){return s.user.email.localeCompare(i.user.email)}},{title:"Level",dataIndex:"level",key:"level",render:function(s,i){return Qe(i)},sorter:function(s,i){return s.level-i.level},defaultSortOrder:"descend"},{title:"Joined\xA0At",dataIndex:"joined_at",key:"joined_at",render:function(s){return Object(He.M)(s)},sorter:function(s,i){return s.joined_at.localeCompare(i.joined_at)},defaultSortOrder:"ascend"},{dataIndex:"actions",key:"actions",align:"center",render:function(s,i){return Je(i)}}];return e.a.createElement(e.a.Fragment,null,e.a.createElement("h2",{className:"subtitle"},"Members"),e.a.createElement(Fe.a,{dataSource:r,columns:d,rowKey:"id",pagination:!1,style:{marginTop:"1rem"},loading:c,"data-attr":"org-members-table"}))}try{ae.displayName="Members",ae.__docgenInfo={description:"",displayName:"Members",props:{user:{defaultValue:null,description:"Currently logged-in user.",name:"user",required:!0,type:{name:"UserType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/Members.tsx#Members"]={docgenInfo:ae.__docgenInfo,name:"Members",path:"frontend/src/scenes/organization/Settings/Members.tsx#Members"})}catch(t){}var Xe=n("./node_modules/antd/lib/typography/Paragraph.js"),ke=n.n(Xe);function re(t){var a=t.isVisible,l=t.setIsVisible,r=Object(m.useValues)(L.a),c=r.currentOrganization,d=r.organizationBeingDeleted,o=Object(m.useActions)(L.a),s=o.deleteOrganization,i=Object(E.useState)(!1),f=V()(i,2),v=f[0],g=f[1],y=!!c&&(d==null?void 0:d.id)===c.id;return e.a.createElement(K.a,{title:"Delete the entire organization?",okText:"Delete ".concat(c?c.name:"the current organization"),onOk:c?function(){return s(c)}:void 0,okType:"primary",okButtonProps:{"data-attr":"delete-organization-ok",loading:y,disabled:!v,className:"btn-danger"},onCancel:function(){return l(!1)},cancelButtonProps:{disabled:y},visible:a},e.a.createElement("p",null,"Organization deletion ",e.a.createElement("b",null,"cannot be undone"),". You will lose all data, ",e.a.createElement("b",null,"including all events"),", related to all projects within this organization."),e.a.createElement("p",null,"Please type"," ",e.a.createElement("strong",null,c?c.name:"this organization's name")," to confirm."),e.a.createElement(b.a,{type:"text",onChange:function(w){if(c){var C=w.target.value;g(C.toLowerCase()===c.name.toLowerCase())}}}))}function ie(t){var a=t.isRestricted,l=Object(m.useValues)(L.a),r=l.currentOrganization,c=Object(E.useState)(!1),d=V()(c,2),o=d[0],s=d[1];return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{style:{color:"var(--danger)"}},e.a.createElement("h2",{style:{color:"var(--danger)"},className:"subtitle"},"Danger Zone"),e.a.createElement("div",{className:"mt"},!a&&e.a.createElement(ke.a,{type:"danger"},"This is ",e.a.createElement("b",null,"irreversible"),". Please be certain."),e.a.createElement(Y.a,{type:"primary",onClick:function(){return s(!0)},className:"mr-05 btn-danger","data-attr":"delete-project-button",icon:e.a.createElement(Ce.a,null),disabled:a},"Delete ",(r==null?void 0:r.name)||"the current organization"))),e.a.createElement(re,{isVisible:o,setIsVisible:s}))}try{re.displayName="DeleteOrganizationModal",re.__docgenInfo={description:"",displayName:"DeleteOrganizationModal",props:{isVisible:{defaultValue:null,description:"",name:"isVisible",required:!0,type:{name:"boolean"}},setIsVisible:{defaultValue:null,description:"",name:"setIsVisible",required:!0,type:{name:"Dispatch<SetStateAction<boolean>>"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"]={docgenInfo:re.__docgenInfo,name:"DeleteOrganizationModal",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DeleteOrganizationModal"})}catch(t){}try{ie.displayName="DangerZone",ie.__docgenInfo={description:"",displayName:"DangerZone",props:{isRestricted:{defaultValue:null,description:"",name:"isRestricted",required:!0,type:{name:"boolean"}},restrictionReason:{defaultValue:null,description:"",name:"restrictionReason",required:!0,type:{name:"string | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"]={docgenInfo:ie.__docgenInfo,name:"DangerZone",path:"frontend/src/scenes/organization/Settings/DangerZone.tsx#DangerZone"})}catch(t){}var oe=n("./frontend/src/lib/components/RestrictedArea.tsx"),_e=n("./frontend/src/lib/hooks/useAnchor.ts"),qe=n("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),se=n.n(qe),Le=n("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Ln=n("./node_modules/core-js/modules/es.object.keys.js"),Dn=n("./node_modules/core-js/modules/es.symbol.js"),Mn=n("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),xn=n("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Vn=n("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),en=n("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),nn=n.n(en),tn=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),an=n.n(tn),rn=n("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),H=n.n(rn),on=n("./node_modules/@babel/runtime/regenerator/index.js"),A=n.n(on),zn=n("./node_modules/core-js/modules/es.array.sort.js"),Rn=n("./node_modules/core-js/modules/es.array.find.js"),In=n("./node_modules/core-js/modules/es.array.includes.js"),Tn=n("./node_modules/core-js/modules/es.string.includes.js"),Pn=n("./node_modules/core-js/modules/es.regexp.exec.js"),Nn=n("./node_modules/core-js/modules/es.string.match.js"),Q=n("./frontend/src/lib/api.ts"),le=n("./frontend/src/lib/components/lemonToast.tsx"),De=n("./frontend/src/types.ts"),Me=n("./node_modules/kea-forms/lib/index.js"),sn=n("./node_modules/kea-loaders/lib/index.js"),ln=["id"];function xe(t,a){var l=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);a&&(r=r.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),l.push.apply(l,r)}return l}function ve(t){for(var a=1;a<arguments.length;a++){var l=arguments[a]!=null?arguments[a]:{};a%2?xe(Object(l),!0).forEach(function(r){an()(t,r,l[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):xe(Object(l)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(l,r))})}return t}var D=Object(m.kea)([Object(m.path)(["scenes","organization","verifiedDomainsLogic"]),Object(m.connect)({values:[L.a,["currentOrganization"]]}),Object(m.actions)({replaceDomain:function(a){return{domain:a}},setAddModalShown:function(a){return{shown:a}},setConfigureSAMLModalId:function(a){return{id:a}},setVerifyModal:function(a){return{id:a}}}),Object(m.reducers)({verifiedDomains:[[],{replaceDomain:function(a,l){var r=l.domain,c=[].concat(se()(a.filter(function(d){var o=d.id;return o!==r.id})),[r]);return c.sort(function(d,o){return d.domain.localeCompare(o.domain)}),c}}],addModalShown:[!1,{setAddModalShown:function(a,l){var r=l.shown;return r},addVerifiedDomainSuccess:function(){return!1}}],configureSAMLModalId:[null,{setConfigureSAMLModalId:function(a,l){var r=l.id;return r}}],verifyModal:[null,{setVerifyModal:function(a,l){var r=l.id;return r}}]}),Object(sn.loaders)(function(t){var a=t.values,l=t.actions;return{verifiedDomains:[[],{loadVerifiedDomains:function(){var r=H()(A.a.mark(function d(){var o;return A.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Q.b.get("api/organizations/".concat((o=a.currentOrganization)===null||o===void 0?void 0:o.id,"/domains"));case 2:return i.abrupt("return",i.sent.results);case 3:case"end":return i.stop()}},d)}));function c(){return r.apply(this,arguments)}return c}(),addVerifiedDomain:function(){var r=H()(A.a.mark(function d(o){var s,i;return A.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,Q.b.create("api/organizations/".concat((s=a.currentOrganization)===null||s===void 0?void 0:s.id,"/domains"),{domain:o});case 2:return i=v.sent,v.abrupt("return",[i].concat(se()(a.verifiedDomains)));case 4:case"end":return v.stop()}},d)}));function c(d){return r.apply(this,arguments)}return c}(),deleteVerifiedDomain:function(){var r=H()(A.a.mark(function d(o){var s;return A.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Q.b.delete("api/organizations/".concat((s=a.currentOrganization)===null||s===void 0?void 0:s.id,"/domains/").concat(o));case 2:return f.abrupt("return",se()(a.verifiedDomains.filter(function(v){return v.id!==o})));case 3:case"end":return f.stop()}},d)}));function c(d){return r.apply(this,arguments)}return c}()}],updatingDomain:[!1,{updateDomain:function(){var r=H()(A.a.mark(function d(o){var s,i;return A.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,Q.b.update("api/organizations/".concat((s=a.currentOrganization)===null||s===void 0?void 0:s.id,"/domains/").concat(o.id),ve(ve({},o),{},{id:void 0}));case 2:return i=v.sent,le.d.success("Domain updated successfully! Changes will take immediately."),l.replaceDomain(i),v.abrupt("return",!1);case 6:case"end":return v.stop()}},d)}));function c(d){return r.apply(this,arguments)}return c}(),verifyDomain:function(){var r=H()(A.a.mark(function d(){var o,s;return A.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,Q.b.create("api/organizations/".concat((o=a.currentOrganization)===null||o===void 0?void 0:o.id,"/domains/").concat(a.verifyModal,"/verify"));case 2:return s=f.sent,s.is_verified?le.d.success("Domain verified successfully."):le.d.warning("We could not verify your domain yet. DNS propagation may take up to 72 hours. Please try again later."),l.replaceDomain(s),l.setVerifyModal(null),f.abrupt("return",!1);case 7:case"end":return f.stop()}},d)}));function c(){return r.apply(this,arguments)}return c}()}]}}),Object(m.listeners)(function(t){var a=t.actions,l=t.values;return{setConfigureSAMLModalId:function(c){var d=c.id,o=l.verifiedDomains.find(function(v){var g=v.id;return g===d});if(d&&o){var s=o.saml_acs_url,i=o.saml_entity_id,f=o.saml_x509_cert;a.setSamlConfigValues({saml_acs_url:s,saml_entity_id:i,saml_x509_cert:f,id:d})}}}}),Object(m.selectors)({domainBeingVerified:[function(t){return[t.verifiedDomains,t.verifyModal]},function(t,a){return a&&t.find(function(l){var r=l.id;return r===a})||null}],isSSOEnforcementAvailable:[function(t){return[t.currentOrganization]},function(t){var a;return(a=t==null?void 0:t.available_features.includes(De.d.SSO_ENFORCEMENT))!==null&&a!==void 0?a:!1}],isSAMLAvailable:[function(t){return[t.currentOrganization]},function(t){var a;return(a=t==null?void 0:t.available_features.includes(De.d.SAML))!==null&&a!==void 0?a:!1}]}),Object(m.afterMount)(function(t){var a=t.actions;return a.loadVerifiedDomains()}),Object(Me.forms)(function(t){var a=t.actions,l=t.values;return{samlConfig:{defaults:{},errors:function(c){return{saml_acs_url:c.saml_acs_url&&!c.saml_acs_url.match(h.u)?"Please enter a valid URL, including https://":void 0}},submit:function(){var r=H()(A.a.mark(function d(o,s){var i,f,v,g;return A.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(f=o.id,v=nn()(o,ln),f){u.next=3;break}return u.abrupt("return");case 3:return u.next=5,Q.b.update("api/organizations/".concat((i=l.currentOrganization)===null||i===void 0?void 0:i.id,"/domains/").concat(o.id),ve({},v));case 5:g=u.sent,s(),a.replaceDomain(g),a.setConfigureSAMLModalId(null),a.setSamlConfigValues({}),le.d.success("SAML configuration for ".concat(g.domain," updated successfully."));case 11:case"end":return u.stop()}},d)}));function c(d,o){return r.apply(this,arguments)}return c}()}}})]),ge=n("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),cn=n("./frontend/src/lib/components/LemonButton/More.tsx"),pe=n("./frontend/src/lib/components/LemonModal/LemonModal.tsx");function dn(){var t=Object(m.useValues)(D),a=t.addModalShown,l=t.verifiedDomainsLoading,r=Object(m.useActions)(D),c=r.setAddModalShown,d=r.addVerifiedDomain,o=Object(E.useState)(""),s=V()(o,2),i=s[0],f=s[1],v=Object(E.useState)(!1),g=V()(v,2),y=g[0],u=g[1],w=!i||!i.match(h.c),C=function(){f(""),u(!1)},M=function(){c(!1),C()},p=function(){u(!0),w||(d(i),C())};return e.a.createElement(pe.a,{onCancel:M,visible:a,destroyOnClose:!0},e.a.createElement("section",null,e.a.createElement("h5",null,"Add authentication domain"),e.a.createElement(b.a,{placeholder:"posthog.com",autoFocus:!0,value:i,onChange:function(j){return f(j.target.value)},onPressEnter:p}),y&&w&&e.a.createElement("span",{className:"text-danger text-small"},"Please enter a valid domain or subdomain name (e.g. my.posthog.com)"),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e.a.createElement(R.a,{type:"primary",disabled:i===""||y&&w||l,onClick:p},"Add domain"))))}var un=n("./frontend/src/scenes/organization/Settings/VerifiedDomains/SSOSelect.tsx");function mn(){var t=Object(m.useValues)(D),a=t.domainBeingVerified,l=t.updatingDomainLoading,r=Object(m.useActions)(D),c=r.setVerifyModal,d=r.verifyDomain,o="_posthog-challenge.".concat(a==null?void 0:a.domain,".");return e.a.createElement(pe.a,{visible:!!a,onCancel:function(){return c(null)}},e.a.createElement("section",null,e.a.createElement("h5",null,"Verify your domain"),e.a.createElement(Le.a,null,(a==null?void 0:a.domain)||""),e.a.createElement("p",{className:"text-muted-alt"},"To verify your domain, you need to add a record to your DNS zone."),e.a.createElement("div",null,e.a.createElement("ol",null,e.a.createElement("li",null,"Sign in to your DNS provider."),e.a.createElement("li",null,"Add the following ",e.a.createElement("b",null,"TXT")," record.",e.a.createElement("div",{className:"mt mb"},e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-name"},"Name"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(b.a,{disabled:!0,value:o,name:"record-name"}),e.a.createElement(U.a,{explicitValue:o,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"Value or content"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(b.a,{disabled:!0,value:a==null?void 0:a.verification_challenge,name:"record-value"}),e.a.createElement(U.a,{explicitValue:a==null?void 0:a.verification_challenge,style:{marginLeft:4}}))),e.a.createElement("div",{className:"input-set"},e.a.createElement("label",{htmlFor:"record-value"},"TTL"),e.a.createElement("div",{className:"flex-center"},e.a.createElement(b.a,{disabled:!0,value:"Default or 3600",name:"record-value"}),e.a.createElement(U.a,{explicitValue:"3600",style:{marginLeft:4}}))))),e.a.createElement("li",null,"Press verify below."))),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e.a.createElement(R.a,{onClick:function(){return c(null)},style:{marginRight:8}},"Verify later"),e.a.createElement(R.a,{type:"primary",disabled:l,onClick:d},"Verify"))))}var Ve=n("./frontend/src/lib/components/Link.tsx"),fn=n("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),Ee=n("./frontend/src/lib/forms/Field.tsx"),vn=n("./frontend/src/lib/components/AlertMessage/index.ts"),ze=n("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),gn=n("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx");function pn(){var t=Object(m.useValues)(D),a=t.configureSAMLModalId,l=t.isSamlConfigSubmitting,r=t.samlConfig,c=Object(m.useActions)(D),d=c.setConfigureSAMLModalId,o=r.saml_acs_url&&r.saml_entity_id&&r.saml_x509_cert,s=function(){d(null)};return e.a.createElement(pe.a,{onCancel:s,visible:!!a,destroyOnClose:!0},e.a.createElement("section",null,e.a.createElement("h5",null,"Configure SAML authentication and provisioning"),e.a.createElement(Me.Form,{logic:D,formKey:"samlConfig",className:"ant-form-vertical ant-form-hide-required-mark"},e.a.createElement(Ee.a,{name:"saml_acs_url",label:"SAML ACS URL"},e.a.createElement(ze.a,{className:"ph-ignore-input",placeholder:"Your IdP's ACS or single sign-on URL."})),e.a.createElement(Ee.a,{name:"saml_entity_id",label:"SAML Entity ID"},e.a.createElement(ze.a,{className:"ph-ignore-input",placeholder:"Entity ID provided by your IdP."})),e.a.createElement(Ee.a,{name:"saml_x509_cert",label:"SAML X.509 Certificate"},e.a.createElement(gn.a,{className:"ph-ignore-input",style:{minHeight:150},placeholder:`Enter the public certificate of your IdP. Keep all line breaks.
-----BEGIN CERTIFICATE-----
MIICVjCCAb+gAwIBAgIBADANBgkqhkiG9w0BAQ0FADBIMQswCQYDVQQGEwJ1czEL
-----END CERTIFICATE-----`})),!o&&e.a.createElement(vn.a,{type:"info",style:{marginBottom:16}},"SAML will not be enabled unless you enter all attributes above. However you can still settings as draft."),e.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},e.a.createElement(R.a,{loading:l,type:"primary",htmlType:"submit"},"Save settings")))))}var J={marginRight:4,fontSize:"1.15em",paddingTop:2};function En(){var t=Object(m.useValues)(D),a=t.verifiedDomainsLoading,l=t.updatingDomainLoading,r=Object(m.useActions)(D),c=r.setAddModalShown;return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"flex-center"},e.a.createElement("div",{style:{flexGrow:1}},e.a.createElement("div",{id:"domain-whitelist"})," ",e.a.createElement("h2",{id:"authentication-domains",className:"subtitle"},"Authentication domains"),e.a.createElement("p",{className:"text-muted-alt"},"Enable users to sign up automatically with an email address on verified domains and enforce SSO for accounts under your domains.")),e.a.createElement(R.a,{type:"primary",onClick:function(){return c(!0)},disabled:a||l},"Add domain")),e.a.createElement(yn,null))}function yn(){var t=Object(m.useValues)(D),a=t.verifiedDomains,l=t.verifiedDomainsLoading,r=t.currentOrganization,c=t.updatingDomainLoading,d=t.isSSOEnforcementAvailable,o=t.isSAMLAvailable,s=Object(m.useActions)(D),i=s.updateDomain,f=s.deleteVerifiedDomain,v=s.setVerifyModal,g=s.setConfigureSAMLModalId,y=Object(m.useValues)(he.a),u=y.preflight,w=[{key:"domain",title:"Domain name",dataIndex:"domain",render:function(M,p){var O=p.domain;return e.a.createElement(Le.a,{style:{textTransform:"lowercase"}},O)}}].concat(se()(u!=null&&u.cloud?[{key:"is_verified",title:e.a.createElement(e.a.Fragment,null,"Verification",e.a.createElement(te.a,{title:"Verification (through DNS) is required to use domains for authentication (e.g. SAML or enforce SSO)."},e.a.createElement(ge.a,{style:{marginLeft:4}}))),render:function(M,p){var O=p.is_verified,j=p.verified_at;return O?e.a.createElement("div",{className:"flex-center text-success"},e.a.createElement(I.IconCheckmark,{style:J})," Verified"):j?e.a.createElement("div",{className:"flex-center text-danger"},e.a.createElement(I.IconExclamation,{style:J})," Verification expired"):e.a.createElement("div",{className:"flex-center text-warning"},e.a.createElement(I.IconWarningAmber,{style:J})," Pending verification")}}]:[]),[{key:"jit_provisioning_enabled",title:e.a.createElement(e.a.Fragment,null,"Automatic provisioning"," ",e.a.createElement(te.a,{title:"Enables just-in-time provisioning. If a user logs in with SSO with an email address on this domain an account will be created in ".concat((r==null?void 0:r.name)||"this organization"," if it does not exist.")},e.a.createElement(ge.a,null))),render:function(M,p){var O=p.jit_provisioning_enabled,j=p.id,B=p.is_verified;return B?e.a.createElement("div",{className:"flex-center"},e.a.createElement(fn.a,{checked:O,disabled:c||!B,onChange:function(X){return i({id:j,jit_provisioning_enabled:X})},label:O?"Enabled":"Disabled",style:{padding:0,fontWeight:400}})):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable automatic provisioning")}},{key:"sso_enforcement",title:e.a.createElement(e.a.Fragment,null,"Enforce SSO"," ",e.a.createElement(te.a,{title:"Require users with email addresses on this domain to always log in using a specific SSO provider."},e.a.createElement(ge.a,null))),render:function(M,p,O){var j=p.sso_enforcement,B=p.is_verified,W=p.id,X=p.has_saml;return d?B?e.a.createElement(un.a,{value:j,loading:c,onChange:function(Sn){return i({id:W,sso_enforcement:Sn})},samlAvailable:X}):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):O===0?e.a.createElement(Ve.a,{to:Object(h.z)(u==null?void 0:u.cloud).url,target:Object(h.z)(u==null?void 0:u.cloud).target,className:"flex-center"},e.a.createElement(I.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SSO enforcement"):e.a.createElement(e.a.Fragment,null)}},{key:"saml",title:"SAML",render:function(M,p,O){var j=p.is_verified,B=p.saml_acs_url,W=p.saml_entity_id,X=p.saml_x509_cert,Ie=p.has_saml;return o?j?e.a.createElement(e.a.Fragment,null,Ie?e.a.createElement("div",{className:"flex-center text-success"},e.a.createElement(I.IconCheckmark,{style:J})," SAML enabled"):B||W||X?e.a.createElement("div",{className:"flex-center text-warning"},e.a.createElement(I.IconWarningAmber,{style:J})," SAML partially configured"):e.a.createElement("div",{className:"flex-center"},e.a.createElement(I.IconOffline,{style:J})," SAML not set up")):e.a.createElement("i",{className:"text-muted-alt"},"Verify domain to enable"):O===0?e.a.createElement(Ve.a,{to:Object(h.z)(u==null?void 0:u.cloud).url,target:Object(h.z)(u==null?void 0:u.cloud).target,className:"flex-center"},e.a.createElement(I.IconLock,{style:{color:"var(--warning)",marginLeft:4}})," Upgrade to enable SAML"):e.a.createElement(e.a.Fragment,null)}},{key:"actions",width:32,align:"center",render:function(M,p){var O=p.is_verified,j=p.id,B=p.domain;return O?e.a.createElement(cn.a,{overlay:e.a.createElement(e.a.Fragment,null,e.a.createElement(R.a,{type:"stealth",onClick:function(){return g(j)},fullWidth:!0,disabled:!o,title:o?void 0:"Upgrade to enable SAML"},"Configure SAML"),e.a.createElement(R.a,{type:"stealth",style:{color:"var(--danger)"},onClick:function(){return K.a.confirm({title:"Remove ".concat(B,"?"),icon:null,okText:"Remove domain",okType:"primary",okButtonProps:{className:"btn-danger"},content:e.a.createElement("div",null,"This cannot be undone. If you have SAML configured or SSO enforced, it will be immediately disabled."),onOk:function(){f(j)},cancelText:"Cancel"})},fullWidth:!0},e.a.createElement(I.IconDelete,null)," Remove domain")),style:{display:"inline-block"}}):e.a.createElement(R.a,{type:"primary",onClick:function(){return v(j)}},"Verify")}}]);return e.a.createElement("div",null,e.a.createElement(ye.a,{dataSource:a,columns:w,loading:l,rowKey:"id",emptyState:"You haven't registered any authentication domains yet."}),e.a.createElement(dn,null),e.a.createElement(pn,null),e.a.createElement(mn,null))}var On={component:Re,logic:L.a};function hn(t){var a=t.isRestricted,l=Object(m.useValues)(L.a),r=l.currentOrganization,c=l.currentOrganizationLoading,d=Object(m.useActions)(L.a),o=d.updateOrganization,s=Object(E.useState)((r==null?void 0:r.name)||""),i=V()(s,2),f=i[0],v=i[1];return e.a.createElement("div",null,e.a.createElement("h2",{id:"name",className:"subtitle"},"Display Name"),e.a.createElement(b.a,{value:f,onChange:function(y){v(y.target.value)},style:{maxWidth:"40rem",marginBottom:"1rem",display:"block"},disabled:a}),e.a.createElement(Y.a,{type:"primary",onClick:function(y){y.preventDefault(),o({name:f})},disabled:a||!f||!r||f===r.name,loading:c},"Rename Organization"))}function bn(t){var a=t.isRestricted,l=Object(m.useValues)(L.a),r=l.currentOrganization,c=l.currentOrganizationLoading,d=Object(m.useActions)(L.a),o=d.updateOrganization;return e.a.createElement("div",null,e.a.createElement("h2",{id:"notification-preferences",className:"subtitle"},"Notification Preferences"),e.a.createElement("div",null,e.a.createElement(q.a,{id:"is-member-join-email-enabled-switch","data-attr":"is-member-join-email-enabled-switch",onChange:function(i){o({is_member_join_email_enabled:i})},checked:r==null?void 0:r.is_member_join_email_enabled,loading:c,disabled:a||!r}),e.a.createElement("label",{style:{marginLeft:"10px"},htmlFor:"is-member-join-email-enabled-switch"},"Email all current members when a new member joins")))}function Re(){var t=Object(m.useValues)(fe.a),a=t.user;return Object(_e.a)(location.hash),e.a.createElement(e.a.Fragment,null,e.a.createElement(S.a,{title:"Organization Settings",caption:"View and manage your organization here. Build an even better product together."}),e.a.createElement($.a,null,e.a.createElement(oe.a,{Component:hn,minimumAccessLevel:h.m.Admin}),e.a.createElement(P.a,null),e.a.createElement(we,null),e.a.createElement(P.a,null),a&&e.a.createElement(ae,{user:a}),e.a.createElement(P.a,null),e.a.createElement(oe.a,{Component:En,minimumAccessLevel:h.m.Admin}),e.a.createElement(P.a,null),e.a.createElement(oe.a,{Component:bn,minimumAccessLevel:h.m.Admin}),e.a.createElement(P.a,null),e.a.createElement(oe.a,{Component:ie,minimumAccessLevel:h.m.Owner})))}},"./node_modules/@ant-design/icons/es/icons/CrownFilled.js":function(ce,x,n){"use strict";var T=n("./node_modules/@ant-design/icons/node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),V=n("./node_modules/react/index.js"),F={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M899.6 276.5L705 396.4 518.4 147.5a8.06 8.06 0 00-12.9 0L319 396.4 124.3 276.5c-5.7-3.5-13.1 1.2-12.2 7.9L188.5 865c1.1 7.9 7.9 14 16 14h615.1c8 0 14.9-6 15.9-14l76.4-580.6c.8-6.7-6.5-11.4-12.3-7.9zM512 734.2c-62.1 0-112.6-50.5-112.6-112.6S449.9 509 512 509s112.6 50.5 112.6 112.6S574.1 734.2 512 734.2zm0-160.9c-26.6 0-48.2 21.6-48.2 48.3 0 26.6 21.6 48.3 48.2 48.3s48.2-21.6 48.2-48.3c0-26.6-21.6-48.3-48.2-48.3z"}}]},name:"crown",theme:"filled"},E=F,e=n("./node_modules/@ant-design/icons/es/components/AntdIcon.js"),b=function($,P){return V.createElement(e.a,Object(T.a)(Object(T.a)({},$),{},{ref:P,icon:E}))};b.displayName="CrownFilled";var Y=x.a=V.forwardRef(b)}}]);
