"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[76549],{"../../frontend/src/scenes/pipeline/NewButton.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{R:()=>NewButton});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.7_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/scenes/urls.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function NewButton(_ref){let{stage,size}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.J,{"data-attr":`new-${stage}`,to:scenes_urls__WEBPACK_IMPORTED_MODULE_2__.j.pipelineNodeNew(stage),type:"primary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconPlusSmall,{}),size:size,children:["New ",stage]})}},"../../frontend/src/scenes/pipeline/Pipeline.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Pipeline:()=>Pipeline,scene:()=>Pipeline_scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),scenes_urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),src_types=__webpack_require__("../../frontend/src/types.ts"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.7_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonInput=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),lemon_ui_Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),kea_forms_lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),CodeSnippet=__webpack_require__("../../frontend/src/lib/components/CodeSnippet/index.ts"),CodeEditor=__webpack_require__("../../frontend/src/lib/monaco/CodeEditor.tsx"),api=__webpack_require__("../../frontend/src/lib/api.ts");let appsCodeLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{pluginId}=_ref;return pluginId}),(0,index_esm.path)(id=>["scenes","pipeline","appsCodeLogic",id]),(0,index_esm.actions)({setCurrentFile:currentFile=>({currentFile}),editAppCode:!0,cancelEditing:!0,fetchPluginSource:!0,fetchPluginSourceComplete:!0,setFilenames:code=>({code})}),(0,index_esm.reducers)({currentFile:["plugin.json",{setCurrentFile:(_,_ref2)=>{let{currentFile}=_ref2;return currentFile}}],editingAppCode:[!1,{editAppCode:()=>!0,cancelEditing:()=>!1,submitPluginSourceSuccess:()=>!1}],pluginSourceLoading:[!1,{fetchPluginSource:()=>!0,fetchPluginSourceComplete:()=>!1}],filenames:[[],{setFilenames:(_,_ref3)=>{let{code}=_ref3;return code?Object.keys(code):[]}}]}),(0,index_esm.listeners)(_ref4=>{let{actions,props}=_ref4;return{cancelEditing:async()=>{actions.fetchPluginSource()},fetchPluginSource:async()=>{try{let response=await api.ZP.get(`api/organizations/@current/plugins/${props.pluginId}/source`),formattedCode={};for(let[file,source]of Object.entries(response||{}))if(source&&file.match(/\.(ts|tsx|js|jsx|json)$/))try{let prettySource=await formatSource(file,source);formattedCode[file]=prettySource}catch(e){formattedCode[file]=source}actions.setPluginSourceValues(formattedCode),actions.setFilenames(formattedCode)}finally{actions.fetchPluginSourceComplete()}}}}),(0,kea_forms_lib.forms)(_ref5=>{let{actions,props,values}=_ref5;return{pluginSource:{defaults:{},preSubmit:async()=>{let changes={},errors={};for(let[file,source]of Object.entries(values.pluginSource))if(source&&file.match(/\.(ts|tsx|js|jsx|json)$/))try{let prettySource=await formatSource(file,source);prettySource!==source&&(changes[file]=prettySource)}catch(e){errors[file]=e.message}Object.keys(changes).length>0&&actions.setPluginSourceValues(changes),actions.setPluginSourceManualErrors(errors)},submit:async()=>{let response=await api.ZP.update(`api/organizations/@current/plugins/${props.pluginId}/update_source`,values.pluginSource);actions.setPluginSourceValues(response)}}}}),(0,index_esm.afterMount)(_ref6=>{let{actions}=_ref6;actions.fetchPluginSource()})]);async function formatSource(filename,source){if(filename.endsWith(".json"))return JSON.stringify(JSON.parse(source),null,4)+"\n";let prettier=(await __webpack_require__.e(47486).then(__webpack_require__.t.bind(__webpack_require__,"../../node_modules/.pnpm/prettier@2.8.8/node_modules/prettier/standalone.js",23))).default,parserTypeScript=(await __webpack_require__.e(6621).then(__webpack_require__.t.bind(__webpack_require__,"../../node_modules/.pnpm/prettier@2.8.8/node_modules/prettier/parser-typescript.js",23))).default;return prettier.format(source,{filepath:filename,parser:"typescript",plugins:[parserTypeScript],semi:!1,trailingComma:"es5",singleQuote:!0,tabWidth:4,printWidth:120})}var appsManagementLogic=__webpack_require__("../../frontend/src/scenes/pipeline/appsManagementLogic.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function AppCode(_ref){let{pluginId,pluginType}=_ref,logicProps={pluginId},logic=appsCodeLogic(logicProps),{currentFile,filenames,pluginSource,pluginSourceLoading,editingAppCode,pluginSourceAllErrors,pluginSourceHasErrors,isPluginSourceSubmitting}=(0,index_esm.useValues)(logic),{setCurrentFile,cancelEditing,editAppCode,submitPluginSource}=(0,index_esm.useActions)(logic),{canGloballyManagePlugins,plugins}=(0,index_esm.useValues)(appsManagementLogic.k);if(pluginSourceLoading)return(0,jsx_runtime.jsx)(src.$j,{});let canEdit=canGloballyManagePlugins&&pluginType===src_types.ak.Source;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.fQ,{onClose:cancelEditing,isOpen:editingAppCode,width:600,title:"Editing source code of "+plugins[pluginId].name,description:(0,jsx_runtime.jsxs)("p",{children:["Read our"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/apps/build",target:"_blank",children:"app building overview in PostHog docs"})," ","for a good grasp of the possibilities."]}),footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:cancelEditing,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{loading:isPluginSourceSubmitting,type:"primary",onClick:()=>submitPluginSource(),children:"Save"})]}),children:(0,jsx_runtime.jsx)(kea_forms_lib.Form,{logic:appsCodeLogic,props:logicProps,formKey:"pluginSource",children:canEdit?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:pluginSourceLoading?(0,jsx_runtime.jsx)(src.$j,{}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.TP,{activeKey:currentFile,onChange:filename=>setCurrentFile(filename),tabs:Object.values(filenames).map(filename=>({label:filename,key:filename,content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[pluginSourceHasErrors&&(0,jsx_runtime.jsx)(src.Vp,{type:"error",children:Object.entries(pluginSourceAllErrors).map(_ref2=>{let[filename,error]=_ref2;return(0,jsx_runtime.jsxs)("p",{children:[filename,": ",error]},filename)})}),(0,jsx_runtime.jsx)(kea_forms_lib.Field,{name:[currentFile],children:_ref3=>{let{value,onChange}=_ref3;return(0,jsx_runtime.jsx)(CodeEditor.p,{path:currentFile,language:currentFile.endsWith(".json")?"json":"typescript",value:value,onChange:v=>onChange(null!=v?v:""),height:700,options:{minimap:{enabled:!1}}})}})]})}))})})}):null})}),(0,jsx_runtime.jsx)(src.TP,{activeKey:currentFile,onChange:filename=>setCurrentFile(filename),tabs:Object.values(filenames).map(filename=>{var _pluginSource$current;return{label:filename,key:filename,content:(0,jsx_runtime.jsx)("div",{className:"mr-4",children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:currentFile.endsWith(".json")?CodeSnippet.S.JSON:CodeSnippet.S.JavaScript,thing:currentFile,maxLinesWithoutExpansion:20,actions:canEdit?(0,jsx_runtime.jsx)(src.Jp,{onClick:editAppCode,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{}),title:"Edit the code",noPadding:!0}):void 0,wrap:!0,children:null!==(_pluginSource$current=pluginSource[currentFile])&&void 0!==_pluginSource$current?_pluginSource$current:""})})}})})]})}var sourceAppInitialCode=__webpack_require__("../../frontend/src/scenes/pipeline/sourceAppInitialCode.tsx"),utils=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");function AppsManagement(){appsManagementLogic.k.mount();let{canInstallPlugins,canGloballyManagePlugins,missingGlobalPlugins,shouldBeGlobalPlugins,shouldNotBeGlobalPlugins,globalPlugins,localPlugins,inlinePlugins,pluginsLoading}=(0,index_esm.useValues)(appsManagementLogic.k),{isDev,isCloudOrDev}=(0,index_esm.useValues)(preflightLogic.preflightLogic);return canInstallPlugins&&canGloballyManagePlugins?(0,jsx_runtime.jsxs)("div",{className:"pipeline-apps-management-scene",children:[isCloudOrDev&&!pluginsLoading&&(missingGlobalPlugins.length>0||shouldBeGlobalPlugins.length>0||shouldNotBeGlobalPlugins.length>0)&&(0,jsx_runtime.jsx)(OutOfSyncApps,{}),(0,jsx_runtime.jsx)("h2",{children:"Manual installation"}),(0,jsx_runtime.jsx)(InstallFromUrl,{}),isDev&&(0,jsx_runtime.jsx)(InstallLocalApp,{}),(0,jsx_runtime.jsx)(InstallSourceApp,{}),(0,jsx_runtime.jsx)(src.p2,{className:"my-6"}),(0,jsx_runtime.jsx)("h2",{children:"Installed apps"}),(0,jsx_runtime.jsx)(AppsToUpdate,{}),globalPlugins&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Global apps"}),(0,jsx_runtime.jsx)("p",{children:"These apps can be used in all organizations."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:globalPlugins})]}),localPlugins&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Local apps"}),(0,jsx_runtime.jsx)("p",{children:"These apps can only be used by this organization, or ones with an existing plugin config."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:localPlugins})]}),inlinePlugins&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Inline plugins"}),(0,jsx_runtime.jsx)("p",{children:"These plugins are inlined into plugin-server code, any updates should be done there."}),(0,jsx_runtime.jsx)(InlinePluginsTable,{plugins:inlinePlugins})]})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"You don't have permission to manage apps."})}function AppsToUpdate(){let{updatablePlugins,pluginsNeedingUpdates,checkingForUpdates}=(0,index_esm.useValues)(appsManagementLogic.k),{checkForUpdates}=(0,index_esm.useActions)(appsManagementLogic.k);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[updatablePlugins&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconRedo,{}),onClick:checkForUpdates,loading:checkingForUpdates,children:checkingForUpdates?`Checking ${Object.keys(updatablePlugins).length} apps for updates`:"Check again for updates"}),pluginsNeedingUpdates.length>0&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Apps to update"}),(0,jsx_runtime.jsx)("p",{children:"These apps have newer commits in the repository they link to."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:pluginsNeedingUpdates})]})]})}function AppsTable(_ref){let{plugins}=_ref,{unusedPlugins}=(0,index_esm.useValues)(appsManagementLogic.k),{uninstallPlugin,patchPlugin,updatePlugin}=(0,index_esm.useActions)(appsManagementLogic.k),onClickUninstall=pluginId=>{src.dn.open({title:"Are you sure you wish to uninstall this app completely?",primaryButton:{children:"Uninstall",type:"secondary",status:"danger",onClick:()=>uninstallPlugin(pluginId)},secondaryButton:{children:"Cancel"}})},data=plugins.map(plugin=>({...plugin,key:plugin.id}));return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.g3,{dataSource:data,columns:[{width:60,render:function RenderAppInfo(_,plugin){return(0,jsx_runtime.jsx)(utils.Wf,{plugin:plugin})}},{title:"Name",render:function RenderName(_,plugin){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold truncate",children:plugin.name}),plugin.latest_tag&&plugin.tag&&plugin.latest_tag!==plugin.tag&&(0,jsx_runtime.jsx)(lemon_ui_Link.r,{to:plugin.url+"/compare/"+plugin.tag+"..."+plugin.latest_tag,children:(0,jsx_runtime.jsx)(src.oe,{type:"completion",children:"See update diff"})})]}),(0,jsx_runtime.jsx)("div",{className:"text-sm",children:plugin.description})]})}},{title:"Capabilities",width:"30%",render:function RenderCapabilities(_,plugin){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Methods: ",JSON.stringify(plugin.capabilities?.methods)]}),(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Jobs: ",JSON.stringify(plugin.capabilities?.jobs)]}),(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Scheduled tasks: ",JSON.stringify(plugin.capabilities?.scheduled_tasks)]})]})}},{title:"Actions",width:240,align:"right",render:function RenderAccess(_,plugin){return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[plugin.latest_tag&&plugin.tag!=plugin.latest_tag&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),onClick:()=>updatePlugin(plugin.id),children:"Update"}),plugin.is_global?(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["This app can currently be used by other organizations in this instance of PostHog. This action will ",(0,jsx_runtime.jsx)("b",{children:"disable and hide it"})," for all organizations that do not have an existing pluginconfig."]}),children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconLock,{}),onClick:()=>patchPlugin(plugin.id,{is_global:!1}),children:"Make local"})}):(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["This action will mark this app as installed for"," ",(0,jsx_runtime.jsx)("b",{children:"all organizations"})," in this instance of PostHog."]}),children:(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconUnlock,{}),onClick:()=>patchPlugin(plugin.id,{is_global:!0}),children:"Make global"})}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",status:"danger",size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),disabledReason:unusedPlugins.includes(plugin.id)?void 0:"This app is still in use.","data-attr":"plugin-uninstall",onClick:()=>onClickUninstall(plugin.id),children:"Uninstall"})]})}}],expandable:{expandedRowRender:function Render(plugin){return(0,jsx_runtime.jsx)(AppCode,{pluginId:plugin.id,pluginType:plugin.plugin_type})}}})})}function InlinePluginsTable(_ref2){let{plugins}=_ref2,data=plugins.map(plugin=>({...plugin,key:plugin.id}));return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.g3,{dataSource:data,columns:[{title:"Name",render:function RenderName(_,plugin){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex gap-2 items-center",children:(0,jsx_runtime.jsx)("span",{className:"font-semibold truncate",children:plugin.name})}),(0,jsx_runtime.jsx)("div",{className:"text-sm",children:plugin.description})]})}},{title:"Capabilities",width:"30%",render:function RenderCapabilities(_,plugin){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Methods: ",JSON.stringify(plugin.capabilities?.methods)]}),(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Jobs: ",JSON.stringify(plugin.capabilities?.jobs)]}),(0,jsx_runtime.jsxs)("div",{className:"text-sm",children:["Scheduled tasks: ",JSON.stringify(plugin.capabilities?.scheduled_tasks)]})]})}},{title:"Global",render:function RenderGlobal(_,plugin){return(0,jsx_runtime.jsx)("span",{children:plugin.is_global?"Yes":"No"})}}]})})}function OutOfSyncApps(){let{shouldNotBeGlobalPlugins,shouldBeGlobalPlugins}=(0,index_esm.useValues)(appsManagementLogic.k);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{children:"Out-of-sync global apps"}),(0,jsx_runtime.jsx)(src.Vp,{type:"warning",children:"This PostHog Cloud instance is currently out of sync with the GLOBAL_PLUGINS list."}),(0,jsx_runtime.jsx)(MissingGlobalPlugins,{}),shouldNotBeGlobalPlugins&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Apps that should NOT be global"}),(0,jsx_runtime.jsx)("p",{children:"These apps should NOT be global according to repo."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:shouldNotBeGlobalPlugins})]}),shouldBeGlobalPlugins&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Apps that SHOULD be global"}),(0,jsx_runtime.jsx)("p",{children:"These already installed apps should be global according to repo."}),(0,jsx_runtime.jsx)(AppsTable,{plugins:shouldBeGlobalPlugins})]}),(0,jsx_runtime.jsx)(src.p2,{className:"my-6"})]})}function MissingGlobalPlugins(){let{missingGlobalPlugins,pluginsLoading,installingPluginUrl}=(0,index_esm.useValues)(appsManagementLogic.k),{installPlugin}=(0,index_esm.useActions)(appsManagementLogic.k);if(0===missingGlobalPlugins.length)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let data=missingGlobalPlugins.map(url=>({url}));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Missing global apps"}),(0,jsx_runtime.jsx)("p",{children:"These plugins are defined in the GLOBAL_PLUGINS list, but are not installed on this instance."}),(0,jsx_runtime.jsx)(src.g3,{dataSource:data,columns:[{title:"URL",key:"url",render:function RenderUrl(_,_ref3){let{url}=_ref3;return(0,jsx_runtime.jsx)(lemon_ui_Link.r,{to:url,target:"_blank",children:url})}},{title:"Actions",width:0,align:"right",render:function RenderInstallButton(_,_ref4){let{url}=_ref4;return(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",loading:pluginsLoading&&installingPluginUrl===url,onClick:()=>installPlugin(src_types.ak.Repository,url),id:`install-plugin-${url}`,children:"Install"})}}]})]})}function InstallFromUrl(){let{isCloudOrDev}=(0,index_esm.useValues)(preflightLogic.preflightLogic),{pluginUrl}=(0,index_esm.useValues)(appsManagementLogic.k),{setPluginUrl,installPlugin}=(0,index_esm.useActions)(appsManagementLogic.k),cloudRequiredPrefix="https://github.com/PostHog/",disabledReason=pluginUrl?void 0:"Please enter a url";return isCloudOrDev&&(disabledReason=pluginUrl.startsWith(cloudRequiredPrefix)?void 0:"Please enter a PostHog org repo url"),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Install from GitHub"}),(0,jsx_runtime.jsx)("p",{children:isCloudOrDev?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Only PostHog organization repositories are allowed, i.e. starting with"," ",(0,jsx_runtime.jsx)(lemon_ui_Link.r,{to:cloudRequiredPrefix,target:"blank",children:cloudRequiredPrefix})," "]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["For private repositories, append ",(0,jsx_runtime.jsx)("code",{children:"?private_token=TOKEN"})," to the end of the URL."]})}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonInput.D,{value:pluginUrl,onChange:setPluginUrl,placeholder:"https://github.com/PostHog/posthog-hello-world-plugin",className:"flex-1"}),(0,jsx_runtime.jsx)(LemonButton.J,{disabledReason:disabledReason,type:"primary",onClick:()=>installPlugin(src_types.ak.Custom),children:"Fetch and install"})]})]})}function InstallLocalApp(){let{localPluginPath}=(0,index_esm.useValues)(appsManagementLogic.k),{setLocalPluginPath,installPlugin}=(0,index_esm.useActions)(appsManagementLogic.k);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Install from local path"}),(0,jsx_runtime.jsx)("p",{children:"To install a local app from this computer/server, give its full path below."}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonInput.D,{value:localPluginPath,onChange:setLocalPluginPath,placeholder:"/var/posthog/apps/helloworldapp",className:"flex-1"}),(0,jsx_runtime.jsx)(LemonButton.J,{disabledReason:localPluginPath?void 0:"Please enter a path",type:"primary",onClick:()=>installPlugin(src_types.ak.Local),children:"Install"})]})]})})}function InstallSourceApp(){let{sourcePluginName,sourcePluginKind}=(0,index_esm.useValues)(appsManagementLogic.k),{setSourcePluginName,installPlugin,setSourcePluginKind}=(0,index_esm.useActions)(appsManagementLogic.k),menuItems=Object.values(sourceAppInitialCode.n).map(kind=>({label:kind,onClick:()=>{setSourcePluginKind(kind)}}));return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-3",children:"Install by writing source code"}),(0,jsx_runtime.jsxs)("p",{children:["To install a source app provide the name and start coding.",(0,jsx_runtime.jsxs)(lemon_ui_Link.r,{to:"https://posthog.com/docs/apps",target:"_blank",children:[" ","Read the documentation for more information!"]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonInput.D,{value:sourcePluginName,onChange:setSourcePluginName,placeholder:"Hello World App",className:"flex-1"}),(0,jsx_runtime.jsx)(src.d6,{items:menuItems,placement:"bottom-end",children:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",children:sourcePluginKind})}),(0,jsx_runtime.jsx)(LemonButton.J,{disabledReason:sourcePluginName?void 0:"Please enter a name",type:"primary",onClick:()=>installPlugin(src_types.ak.Source),children:"Install"})]})]})}appsManagementLogic.k;var destinations_constants=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/constants.ts"),core_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@dnd-kit/core/dist/core.esm.js"),modifiers_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+modifiers@6.0.1_@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0__react@18.2.0/node_modules/@dnd-kit/modifiers/dist/modifiers.esm.js"),sortable_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+sortable@7.0.2_@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0__react@18.2.0/node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),utilities_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+utilities@3.2.1_react@18.2.0/node_modules/@dnd-kit/utilities/dist/utilities.esm.js"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),PageHeader=__webpack_require__("../../frontend/src/lib/components/PageHeader.tsx"),PayGateMini=__webpack_require__("../../frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),LemonButton_More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonMenu=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/LemonMenu.tsx"),columnUtils=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),Sparkline=__webpack_require__("../../frontend/src/lib/components/Sparkline.tsx"),pipelineNodeMetricsLogic=__webpack_require__("../../frontend/src/scenes/pipeline/pipelineNodeMetricsLogic.tsx");function AppMetricSparkLine_AppMetricSparkLine(_ref){let{pipelineNode}=_ref,logic=(0,pipelineNodeMetricsLogic.j)({id:pipelineNode.id}),{appMetricsResponse}=(0,index_esm.useValues)(logic),successes=appMetricsResponse?appMetricsResponse.metrics.successes.slice(-7):[],failures=appMetricsResponse?appMetricsResponse.metrics.failures.slice(-7):[],dates=appMetricsResponse?appMetricsResponse.metrics.dates.slice(-7):[],displayData=[{color:"success",name:"Success",values:successes}];return appMetricsResponse?.metrics.failures.some(failure=>failure>0)&&displayData.push({color:"danger",name:"Failure",values:failures}),(0,jsx_runtime.jsx)(Sparkline.b,{loading:null===appMetricsResponse,labels:dates,data:displayData,className:"max-w-24 h-8",maximumIndicator:!1})}var frontendAppsLogic=__webpack_require__("../../frontend/src/scenes/pipeline/frontendAppsLogic.tsx"),NewButton=__webpack_require__("../../frontend/src/scenes/pipeline/NewButton.tsx");function FrontendApps(_ref){let{asLegacyList}=_ref,{loading,frontendApps}=(0,index_esm.useValues)(frontendAppsLogic.$),{toggleEnabled,loadPluginConfigs}=(0,index_esm.useActions)(frontendAppsLogic.$),shouldShowEmptyState=0===frontendApps.length&&!loading&&!asLegacyList;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!asLegacyList&&(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Extend your web app with custom functionality.",buttons:(0,jsx_runtime.jsx)(NewButton.R,{stage:src_types.We.SiteApp})}),!asLegacyList&&(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Site apps",thingName:"site app",productKey:src_types.Md.SITE_APPS,description:"Site apps allow you to add custom functionality to your website using PostHog.",docsURL:"https://posthog.com/docs/apps/pineapple-mode",actionElementOverride:(0,jsx_runtime.jsx)(NewButton.R,{stage:src_types.We.SiteApp}),isEmpty:shouldShowEmptyState}),!shouldShowEmptyState&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!loading&&asLegacyList&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{className:"mt-4",children:"Legacy Site apps"}),(0,jsx_runtime.jsx)("p",{children:"These site apps are using an older system and should eventually be migrated over."})]}),(0,jsx_runtime.jsx)(src.g3,{dataSource:frontendApps,size:"small",loading:loading,columns:[(0,utils.ny)(),(0,utils.HO)(),(0,columnUtils.yI)(),(0,columnUtils.T1)(),{width:0,render:function Render(_,frontendApp){return(0,jsx_runtime.jsx)(LemonButton_More.T,{overlay:(0,jsx_runtime.jsx)(LemonMenu.iy,{items:[...(0,utils.UL)(frontendApp,toggleEnabled,loadPluginConfigs)]})})}}]})]})]})}var HogFunctionIcon=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/HogFunctionIcon.tsx"),HogFunctionStatusIndicator=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/HogFunctionStatusIndicator.tsx"),hogfunctions_urls=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/urls.ts"),AppMetricsV2Sparkline=__webpack_require__("../../frontend/src/scenes/pipeline/metrics/AppMetricsV2Sparkline.tsx"),pipeline_pipelineAccessLogic=__webpack_require__("../../frontend/src/scenes/pipeline/pipelineAccessLogic.tsx"),pipeline_types=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),DestinationsFilters=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/DestinationsFilters.tsx"),destinationsFiltersLogic=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/destinationsFiltersLogic.tsx"),destinationsLogic=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/destinationsLogic.tsx"),NewDestinations=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/NewDestinations.tsx");function Destinations(_ref){let{types}=_ref,{destinations,loading}=(0,index_esm.useValues)((0,destinationsLogic.w)({types}));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[types.includes("destination")?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Send your data in real time or in batches to destinations outside of PostHog.",buttons:(0,jsx_runtime.jsx)(NewButton.R,{stage:src_types.We.Destination})}),(0,jsx_runtime.jsx)(PayGateMini.E,{feature:src_types.P$.DATA_PIPELINES,className:"mb-2",children:(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Pipeline destinations",thingName:"destination",productKey:src_types.Md.PIPELINE_DESTINATIONS,description:"Pipeline destinations allow you to export data outside of PostHog, such as webhooks to Slack.",docsURL:"https://posthog.com/docs/cdp",actionElementOverride:(0,jsx_runtime.jsx)(NewButton.R,{stage:src_types.We.Destination}),isEmpty:0===destinations.length&&!loading})})]}):types.includes("site_app")?(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Run custom scripts on your website.",buttons:(0,jsx_runtime.jsx)(NewButton.R,{stage:src_types.We.SiteApp})}):types.includes("transformation")?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(ReorderTransformationsModal,{types:types})}):null,(0,jsx_runtime.jsx)(DestinationsTable,{types:types}),(0,jsx_runtime.jsx)("div",{className:"mt-4"}),(0,jsx_runtime.jsx)("h2",{children:types.includes("destination")?"New destinations":types.includes("site_app")?"New site app":types.includes("transformation")?"New transformation":"New"}),(0,jsx_runtime.jsx)(NewDestinations.h,{types:types}),types.includes("site_app")?(0,jsx_runtime.jsx)(FrontendApps,{asLegacyList:!0}):null]})}function DestinationsTable(_ref2){let{hideFeedback,hideAddDestinationButton,types,hideChangeOrderButton=!1}=_ref2,{canConfigurePlugins,canEnableDestination}=(0,index_esm.useValues)(pipeline_pipelineAccessLogic.g),{loading,filteredDestinations,destinations,hiddenDestinations}=(0,index_esm.useValues)((0,destinationsLogic.w)({types})),{toggleNode,deleteNode,openReorderTransformationsModal}=(0,index_esm.useActions)((0,destinationsLogic.w)({types})),{resetFilters}=(0,index_esm.useActions)((0,destinationsFiltersLogic.T)({types})),showMetricsHistory=types.includes("destination")||types.includes("transformation"),showFrequencyInterval=types.includes("destination"),simpleName=types.includes("destination")||types.includes("site_destination")?"destination":types.includes("site_app")?"site app":"Hog function",enabledTransformations=destinations.filter(d=>d.stage===src_types.We.Transformation&&d.enabled),showPriorityColumn=types.includes("transformation");return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsx)(DestinationsFilters.B,{types:types,hideFeedback:hideFeedback,hideAddDestinationButton:hideAddDestinationButton}),types.includes("transformation")&&enabledTransformations.length>1&&!hideChangeOrderButton&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:["Processed sequentially.",(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>openReorderTransformationsModal(),noPadding:!0,id:"transformation-reorder",disabledReason:canConfigurePlugins?void 0:"You do not have permission to reorder Transformations.",children:"Change order"})]}),(0,jsx_runtime.jsx)(src.g3,{dataSource:filteredDestinations,size:"small",loading:loading,columns:[...showPriorityColumn?[{title:"Prio",key:"order",width:0,align:"center",sorter:(a,b)=>a.backend===pipeline_types.b.HogFunction&&b.backend===pipeline_types.b.HogFunction?(a.hog_function.execution_order||0)-(b.hog_function.execution_order||0):0,render:function RenderOrdering(_,destination){if(destination.backend===pipeline_types.b.HogFunction&&destination.enabled){let index=filteredDestinations.filter(d=>d.backend===pipeline_types.b.HogFunction&&d.enabled).sort((a,b)=>(a.hog_function.execution_order||0)-(b.hog_function.execution_order||0)).findIndex(t=>t.id===destination.id);return(0,jsx_runtime.jsx)("div",{className:"text-center",children:index+1})}return null}}]:[],{title:"App",width:0,render:function RenderAppInfo(_,destination){switch(destination.backend){case"plugin":return(0,jsx_runtime.jsx)(utils.Wf,{plugin:destination.plugin});case"hog_function":return(0,jsx_runtime.jsx)(HogFunctionIcon._,{src:destination.hog_function.icon_url,size:"small"});case"batch_export":return(0,jsx_runtime.jsx)(utils.oe,{type:destination.service.type});default:return null}}},{title:"Name",sticky:!0,key:"name",dataIndex:"name",sorter:(a,b)=>(a.name||"").localeCompare(b.name||""),render:function RenderPluginName(_,destination){return(0,jsx_runtime.jsx)(LemonTableLink.i,{to:scenes_urls.j.pipelineNode((0,hogfunctions_urls.R4)(destination.stage),destination.id,src_types.il.Configuration),title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.u,{title:"Click to update configuration, view metrics, and more",children:(0,jsx_runtime.jsx)("span",{children:destination.name})})}),description:destination.description})}},...showFrequencyInterval?[{title:"Frequency",key:"interval",render:function RenderFrequency(_,destination){return"interval"in destination?destination.interval:null}}]:[],...showMetricsHistory?[{title:"Last 7 days",render:function RenderSuccessRate(_,destination){return(0,jsx_runtime.jsx)(src.rU,{to:scenes_urls.j.pipelineNode((0,hogfunctions_urls.R4)(destination.stage),destination.id,src_types.il.Metrics),children:destination.backend===pipeline_types.b.HogFunction?(0,jsx_runtime.jsx)(AppMetricsV2Sparkline.A,{id:destination.hog_function.id}):(0,jsx_runtime.jsx)(AppMetricSparkLine_AppMetricSparkLine,{pipelineNode:destination})})}}]:[],(0,columnUtils.yI)(),{title:"Status",key:"enabled",sorter:a=>a.enabled?1:-1,width:0,render:function RenderStatus(_,destination){return destination.backend===pipeline_types.b.HogFunction?(0,jsx_runtime.jsx)(HogFunctionStatusIndicator.F,{hogFunction:destination.hog_function}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:destination.enabled?(0,jsx_runtime.jsx)(src.oe,{type:"success",children:"Active"}):(0,jsx_runtime.jsx)(src.oe,{type:"default",children:"Disabled"})})}},{width:0,render:function Render(_,destination){return(0,jsx_runtime.jsx)(LemonButton_More.T,{overlay:(0,jsx_runtime.jsx)(LemonMenu.iy,{items:[{label:destination.enabled?`Pause ${simpleName}`:`Unpause ${simpleName}`,onClick:()=>toggleNode(destination,!destination.enabled),disabledReason:canConfigurePlugins?canEnableDestination(destination)||destination.enabled?void 0:`Data pipelines add-on is required for enabling new ${simpleName}s`:`You do not have permission to toggle ${simpleName}s.`},...(0,utils.PU)(destination),{label:`Delete ${simpleName}`,status:"danger",onClick:()=>deleteNode(destination),disabledReason:canConfigurePlugins?void 0:`You do not have permission to delete ${simpleName}.`}]})})}}],emptyState:0!==destinations.length||loading?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["No destinations matching filters. ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>resetFilters(),children:"Clear filters"})," "]}):"No destinations found"}),hiddenDestinations.length>0&&(0,jsx_runtime.jsxs)("div",{className:"text-secondary",children:[hiddenDestinations.length," hidden. ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>resetFilters(),children:"Show all"})]})]})}function ReorderTransformationsModal(_ref3){let{types}=_ref3,{reorderTransformationsModalOpen,destinations,temporaryTransformationOrder,loading}=(0,index_esm.useValues)((0,destinationsLogic.w)({types})),{closeReorderTransformationsModal,setTemporaryTransformationOrder,saveTransformationsOrder}=(0,index_esm.useActions)((0,destinationsLogic.w)({types})),[initialOrders,setInitialOrders]=(0,react.useState)({}),enabledTransformations=destinations.filter(d=>d.stage===src_types.We.Transformation&&d.enabled);(0,react.useEffect)(()=>{reorderTransformationsModalOpen&&setInitialOrders(enabledTransformations.reduce((acc,transformation)=>({...acc,[transformation.hog_function.id]:transformation.hog_function.execution_order||0}),{}))},[reorderTransformationsModalOpen,enabledTransformations]);let sortedTransformations=[...enabledTransformations];return Object.keys(temporaryTransformationOrder).length>0&&sortedTransformations.sort((a,b)=>(temporaryTransformationOrder[a.hog_function.id]||0)-(temporaryTransformationOrder[b.hog_function.id]||0)),(0,jsx_runtime.jsx)(src.fQ,{onClose:closeReorderTransformationsModal,isOpen:reorderTransformationsModalOpen,width:600,title:"Reorder transformations",description:(0,jsx_runtime.jsxs)("p",{children:["The order of transformations is important as they are processed sequentially. You can"," ",(0,jsx_runtime.jsx)("b",{children:"drag and drop the transformations below"})," to change their order."]}),footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:closeReorderTransformationsModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{loading:loading,type:"primary",onClick:()=>{let changedOrders=Object.entries(temporaryTransformationOrder).reduce((acc,_ref5)=>{let[id,newOrder]=_ref5;return initialOrders[id]!==newOrder?{...acc,[id]:newOrder}:acc},{});Object.keys(changedOrders).length>0?saveTransformationsOrder(changedOrders):closeReorderTransformationsModal()},children:"Save order"})]}),children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col gap-2",children:(0,jsx_runtime.jsx)(core_esm.LB,{modifiers:[modifiers_esm.DL,modifiers_esm.F4],onDragEnd:_ref4=>{let{active,over}=_ref4;if(active.id&&over&&active.id!==over.id){let from=sortedTransformations.findIndex(d=>d.id===active.id),to=sortedTransformations.findIndex(d=>d.id===over.id);setTemporaryTransformationOrder((0,sortable_esm.Rp)(sortedTransformations,from,to).reduce((acc,destination,index)=>destination.hog_function?.id?{...acc,[destination.hog_function.id]:index+1}:acc,{}))}},children:(0,jsx_runtime.jsx)(sortable_esm.Fo,{items:sortedTransformations,strategy:sortable_esm.qw,children:sortedTransformations.map((transformation,index)=>(0,jsx_runtime.jsx)(MinimalTransformationView,{transformation:transformation,order:index},transformation.id))})})})})}let MinimalTransformationView=_ref6=>{let{transformation,order}=_ref6,{attributes,listeners,setNodeRef,transform,transition,isDragging}=(0,sortable_esm.nB)({id:transformation.id});return(0,jsx_runtime.jsxs)("div",{ref:setNodeRef,className:(0,clsx_m.clsx)("relative flex items-center gap-2 p-2 border rounded cursor-move bg-bg-light",isDragging&&"z-[999999]"),style:{transform:utilities_esm.ux.Transform.toString(transform),transition},...attributes,...listeners,children:[(0,jsx_runtime.jsx)(src.Mo.Number,{count:order+1,maxDigits:3}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:transformation.name})]})};var importAppsLogic=__webpack_require__("../../frontend/src/scenes/pipeline/importAppsLogic.tsx");function ImportApps(){let{loading,importApps}=(0,index_esm.useValues)(importAppsLogic.c),{toggleEnabled,loadPluginConfigs}=(0,index_esm.useActions)(importAppsLogic.c);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.g3,{dataSource:importApps,size:"small",loading:loading,columns:[(0,utils.ny)(),(0,utils.HO)(),(0,columnUtils.yI)(),(0,columnUtils.T1)(),{width:0,render:function Render(_,importApp){return(0,jsx_runtime.jsx)(LemonButton_More.T,{overlay:(0,jsx_runtime.jsx)(LemonMenu.iy,{items:[...(0,utils.UL)(importApp,toggleEnabled,loadPluginConfigs)]})})}}]})})}var lemon_ui_LemonMenu=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/index.ts"),DataWarehouseManagedSourcesTable=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/DataWarehouseManagedSourcesTable.tsx"),DataWarehouseSourceIcon=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/DataWarehouseSourceIcon.tsx"),dataWarehouseSettingsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts");function DataWarehouseSelfManagedSourcesTable(){let{selfManagedTables}=(0,index_esm.useValues)(dataWarehouseSettingsLogic.T),{deleteSelfManagedTable,refreshSelfManagedTableSchema}=(0,index_esm.useActions)(dataWarehouseSettingsLogic.T);return(0,jsx_runtime.jsx)(src.g3,{id:"self-managed-sources",dataSource:selfManagedTables,pagination:{pageSize:10},columns:[{width:0,render:(_,item)=>(0,jsx_runtime.jsx)(DataWarehouseSourceIcon.U,{type:(0,DataWarehouseSourceIcon.Z)(item.url_pattern)})},{title:"Source",dataIndex:"name",key:"name",render:(_,item)=>(0,jsx_runtime.jsx)(LemonTableLink.i,{to:scenes_urls.j.pipelineNode(src_types.We.Source,`self-managed-${item.id}`,src_types.il.SourceConfiguration),title:item.name})},{key:"actions",render:(_,item)=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-end",children:[(0,jsx_runtime.jsx)(src.Jp,{"data-attr":`refresh-data-warehouse-${item.name}`,onClick:()=>refreshSelfManagedTableSchema(item.id),children:"Update schema from source"},`refresh-data-warehouse-${item.name}`),(0,jsx_runtime.jsx)(src.Jp,{status:"danger","data-attr":`delete-data-warehouse-${item.name}`,onClick:()=>{src.dn.open({title:"Delete table?",description:"Table deletion cannot be undone. All views and joins related to this table will be deleted.",primaryButton:{children:"Delete",status:"danger",onClick:()=>{deleteSelfManagedTable(item.id)}},secondaryButton:{children:"Cancel"}})},children:"Delete"},`delete-data-warehouse-${item.name}`)]})}]})}function Overview(){let menuItems=[{label:"Source",to:scenes_urls.j.pipelineNodeNew(src_types.We.Source),"data-attr":"data-warehouse-data-pipelines-overview-new-source"},{label:"Transformation",to:scenes_urls.j.pipelineNodeNew(src_types.We.Transformation)},{label:"Destination",to:scenes_urls.j.pipelineNodeNew(src_types.We.Destination)}];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsx)("div",{className:"flex items-center m-2 shrink-0",children:(0,jsx_runtime.jsx)(lemon_ui_LemonMenu.d,{items:menuItems,children:(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"new-pipeline-button",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),size:"small",type:"primary",children:"New"})})})}),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.rU,{to:scenes_urls.j.pipeline(src_types.J9.Sources),children:(0,jsx_runtime.jsx)("h2",{children:"Managed sources"})}),(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:(0,jsx_runtime.jsx)(DataWarehouseManagedSourcesTable.lL,{})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.rU,{to:scenes_urls.j.pipeline(src_types.J9.Sources),children:(0,jsx_runtime.jsx)("h2",{children:"Self-managed sources"})}),(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:(0,jsx_runtime.jsx)(DataWarehouseSelfManagedSourcesTable,{})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.rU,{to:scenes_urls.j.pipeline(src_types.J9.Transformations),children:(0,jsx_runtime.jsx)("h2",{children:"Transformations"})}),(0,jsx_runtime.jsxs)("p",{children:["Modify and enrich your incoming data. Only active transformations are shown here."," ",(0,jsx_runtime.jsx)(src.rU,{to:scenes_urls.j.pipeline(src_types.J9.Transformations),children:"See all."})]}),(0,jsx_runtime.jsx)(DestinationsTable,{types:destinations_constants.Qg,hideFeedback:!0,hideAddDestinationButton:!1,hideChangeOrderButton:!0})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.rU,{to:scenes_urls.j.pipeline(src_types.J9.Destinations),children:(0,jsx_runtime.jsx)("h2",{children:"Destinations"})}),(0,jsx_runtime.jsxs)("p",{children:["Send your data to destinations in real time or with batch exports. Only active Destinations are shown here. ",(0,jsx_runtime.jsx)(src.rU,{to:scenes_urls.j.pipeline(src_types.J9.Destinations),children:"See all."})]}),(0,jsx_runtime.jsx)(DestinationsTable,{types:destinations_constants.SO,hideFeedback:!0,hideAddDestinationButton:!1,hideChangeOrderButton:!0})]})]})]})}var lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),types=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/types.ts");let humanFriendlyTabName=tab=>(0,lib_utils.fm)(tab).replace(/[-_]/g," "),pipelineLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","pipeline","pipelineLogic"]),(0,index_esm.connect)({values:[userLogic.userLogic,["user","hasAvailableFeature"]]}),(0,index_esm.actions)({setCurrentTab:function(){let tab=arguments.length>0&&void 0!==arguments[0]?arguments[0]:src_types.J9.Destinations;return{tab}}}),(0,index_esm.reducers)({currentTab:[src_types.J9.Destinations,{setCurrentTab:(_,_ref)=>{let{tab}=_ref;return tab}}]}),(0,index_esm.selectors)(()=>({breadcrumbs:[s=>[s.currentTab],tab=>[{key:sceneTypes.x.Pipeline,name:"Data pipeline"},{key:tab,name:humanFriendlyTabName(tab)}]],[types.f]:[()=>[],()=>({activity_scope:src_types.jc.PLUGIN})]})),(0,lib.actionToUrl)(_ref2=>{let{values}=_ref2;return{setCurrentTab:()=>[scenes_urls.j.pipeline(values.currentTab)]}}),(0,lib.urlToAction)(_ref3=>{let{actions,values}=_ref3;return{"/pipeline/:tab":_ref4=>{let{tab}=_ref4;tab!==values.currentTab&&actions.setCurrentTab(tab)}}})]);function Sources(){let{dataWarehouseSources,dataWarehouseSourcesLoading}=(0,index_esm.useValues)(dataWarehouseSettingsLogic.T);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsx)(NewButton.R,{stage:src_types.We.Source})}),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[dataWarehouseSourcesLoading||dataWarehouseSources?.results.length!==0?null:(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Data Warehouse Source",productKey:src_types.Md.DATA_WAREHOUSE,thingName:"data source",description:"Use data warehouse sources to import data from your external data into PostHog.",isEmpty:0===dataWarehouseSources.results.length&&!dataWarehouseSourcesLoading,docsURL:"https://posthog.com/docs/data-warehouse",actionElementOverride:(0,jsx_runtime.jsx)(NewButton.R,{stage:src_types.We.Source})}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Managed sources"}),(0,jsx_runtime.jsx)("p",{children:"PostHog can connect to external sources and automatically import data from them into the PostHog data warehouse"}),(0,jsx_runtime.jsx)(DataWarehouseManagedSourcesTable.lL,{})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Self-managed sources"}),(0,jsx_runtime.jsx)("p",{children:"Connect to your own data sources, making them queryable in PostHog"}),(0,jsx_runtime.jsx)(DataWarehouseSelfManagedSourcesTable,{})]})]})]})}var transformationsLogic=__webpack_require__("../../frontend/src/scenes/pipeline/transformationsLogic.tsx");function Transformations(){let{sortedTransformations,loading}=(0,index_esm.useValues)(transformationsLogic.P),shouldShowEmptyState=0===sortedTransformations.length&&!loading;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{caption:"Transform your incoming events before they are stored in PostHog or sent on to Destinations.",buttons:(0,jsx_runtime.jsx)(NewButton.R,{stage:src_types.We.Transformation})}),(0,jsx_runtime.jsx)(ProductIntroduction.C,{productName:"Pipeline transformations",thingName:"transformation",productKey:src_types.Md.PIPELINE_TRANSFORMATIONS,description:"Pipeline transformations allow you to enrich your data with additional information, such as geolocation.",docsURL:"https://posthog.com/docs/cdp",actionElementOverride:(0,jsx_runtime.jsx)(NewButton.R,{stage:src_types.We.Transformation}),isEmpty:shouldShowEmptyState}),(0,jsx_runtime.jsx)(Destinations,{types:destinations_constants.Qg})]})}function Pipeline(){let{canGloballyManagePlugins}=(0,index_esm.useValues)(pipeline_pipelineAccessLogic.g),{currentTab}=(0,index_esm.useValues)(pipelineLogic),{hasEnabledImportApps}=(0,index_esm.useValues)(importAppsLogic.c),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),tabs=[{key:src_types.J9.Overview,content:(0,jsx_runtime.jsx)(Overview,{})},{key:src_types.J9.Sources,content:(0,jsx_runtime.jsx)(Sources,{})},{key:src_types.J9.Transformations,content:(0,jsx_runtime.jsx)(Transformations,{})},{key:src_types.J9.Destinations,content:(0,jsx_runtime.jsx)(Destinations,{types:destinations_constants.SO})},{key:src_types.J9.SiteApps,content:featureFlags[constants.y8.SITE_APP_FUNCTIONS]?(0,jsx_runtime.jsx)(Destinations,{types:destinations_constants.hz}):(0,jsx_runtime.jsx)(FrontendApps,{})}];return hasEnabledImportApps&&tabs.push({key:src_types.J9.ImportApps,content:(0,jsx_runtime.jsx)(ImportApps,{})}),canGloballyManagePlugins&&tabs.push({key:src_types.J9.AppsManagement,content:(0,jsx_runtime.jsx)(AppsManagement,{})}),tabs.push({key:src_types.J9.History,content:(0,jsx_runtime.jsx)(ActivityLog.D,{scope:[src_types.jc.PLUGIN,src_types.jc.PLUGIN_CONFIG,src_types.jc.HOG_FUNCTION]})}),(0,jsx_runtime.jsx)("div",{className:"pipeline-scene",children:(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,onChange:tab=>lib.router.actions.push(scenes_urls.j.pipeline(tab)),tabs:tabs.map(tab=>({...tab,label:humanFriendlyTabName(tab.key)}))})})}let Pipeline_scene={component:Pipeline,logic:pipelineLogic}},"../../frontend/src/scenes/pipeline/appsManagementLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>appsManagementLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),posthog_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.232.7_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/types.ts"),_access__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/access.ts"),_pipelineAccessLogic__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/scenes/pipeline/pipelineAccessLogic.tsx"),_sourceAppInitialCode__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/scenes/pipeline/sourceAppInitialCode.tsx"),_utils__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");function capturePluginEvent(event,plugin,type){posthog_js__WEBPACK_IMPORTED_MODULE_4__.ZP.capture(event,{plugin_name:plugin.name,plugin_url:plugin.url?.startsWith("file:")?"file://masked-local-path":plugin.url,plugin_tag:plugin.tag,plugin_installation_type:type})}let appsManagementLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","appsManagementLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_userLogic__WEBPACK_IMPORTED_MODULE_5__.userLogic,["user"],_pipelineAccessLogic__WEBPACK_IMPORTED_MODULE_8__.g,["canGloballyManagePlugins"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setPluginUrl:pluginUrl=>({pluginUrl}),setLocalPluginPath:localPluginPath=>({localPluginPath}),setSourcePluginName:sourcePluginName=>({sourcePluginName}),setSourcePluginKind:sourcePluginKind=>({sourcePluginKind}),uninstallPlugin:id=>({id}),installPlugin:(pluginType,url)=>({pluginType,url}),installPluginFromUrl:url=>({url}),installSourcePlugin:name=>({name}),installLocalPlugin:path=>({path}),patchPlugin:function(id){let pluginChanges=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{id,pluginChanges}},updatePlugin:id=>({id}),checkForUpdates:!0,checkedForUpdates:!0,setPluginLatestTag:(id,latestTag)=>({id,latestTag})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_10__.c$)("api/organizations/@current/plugins"),installPlugin:async _ref2=>{let{pluginType,url}=_ref2;if(!values.canInstallPlugins)return lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("You don't have permission to install apps."),values.plugins;let payload={plugin_type:pluginType};if(url||pluginType===_types__WEBPACK_IMPORTED_MODULE_6__.ak.Repository)payload.url=url;else if(pluginType===_types__WEBPACK_IMPORTED_MODULE_6__.ak.Custom)payload.url=values.pluginUrl;else if(pluginType===_types__WEBPACK_IMPORTED_MODULE_6__.ak.Local)payload.url=`file:${values.localPluginPath}`;else{if(pluginType!==_types__WEBPACK_IMPORTED_MODULE_6__.ak.Source)return lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Unsupported installation type."),values.plugins;payload.name=values.sourcePluginName}let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.create("api/organizations/@current/plugins",payload);return pluginType===_types__WEBPACK_IMPORTED_MODULE_6__.ak.Source&&await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/organizations/@current/plugins/${response.id}/update_source`,(0,_sourceAppInitialCode__WEBPACK_IMPORTED_MODULE_9__.g)(values.sourcePluginName,values.sourcePluginKind)),capturePluginEvent("plugin installed",response,pluginType),{...values.plugins,[response.id]:response}},uninstallPlugin:async _ref3=>{let{id}=_ref3;values.canGloballyManagePlugins||lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("You don't have permission to manage apps."),await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.delete(`api/organizations/@current/plugins/${id}`),capturePluginEvent("plugin uninstalled",values.plugins[id],values.plugins[id].plugin_type);let{[id]:_discard,...rest}=values.plugins;return rest},patchPlugin:async _ref4=>{let{id,pluginChanges}=_ref4;values.canGloballyManagePlugins||lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("You don't have permission to update apps.");let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/organizations/@current/plugins/${id}`,pluginChanges);return{...values.plugins,[id]:response}},setPluginLatestTag:async _ref5=>{let{id,latestTag}=_ref5;return{...values.plugins,[id]:{...values.plugins[id],latest_tag:latestTag}}},updatePlugin:async _ref6=>{let{id}=_ref6;values.canGloballyManagePlugins||lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("You don't have permission to update apps.");let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.create(`api/organizations/@current/plugins/${id}/upgrade`);return capturePluginEvent("plugin updated",values.plugins[id],values.plugins[id].plugin_type),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success(`Plugin ${response.name} updated!`),{...values.plugins,[id]:response}}}],unusedPlugins:[[],{loadUnusedPlugins:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get("api/organizations/@current/plugins/unused")}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({installingPluginUrl:[null,{installPlugin:(_,_ref7)=>{let{url}=_ref7;return url||null},installPluginSuccess:()=>null,installPluginFailure:()=>null}],pluginUrl:["",{setPluginUrl:(_,_ref8)=>{let{pluginUrl}=_ref8;return pluginUrl},installPluginSuccess:()=>""}],localPluginPath:["",{setLocalPluginPath:(_,_ref9)=>{let{localPluginPath}=_ref9;return localPluginPath},installPluginSuccess:()=>""}],sourcePluginName:["",{setSourcePluginName:(_,_ref10)=>{let{sourcePluginName}=_ref10;return sourcePluginName},installPluginSuccess:()=>""}],sourcePluginKind:[_sourceAppInitialCode__WEBPACK_IMPORTED_MODULE_9__.n.FilterEvent,{setSourcePluginKind:(_,_ref11)=>{let{sourcePluginKind}=_ref11;return sourcePluginKind},installPluginSuccess:()=>_sourceAppInitialCode__WEBPACK_IMPORTED_MODULE_9__.n.FilterEvent}],checkingForUpdates:[!1,{checkForUpdates:()=>!0,checkedForUpdates:()=>!1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({canInstallPlugins:[s=>[s.user],user=>(0,_access__WEBPACK_IMPORTED_MODULE_7__.FZ)(user?.organization)],inlinePlugins:[s=>[s.plugins],plugins=>Object.values(plugins).filter(plugin=>plugin.plugin_type===_types__WEBPACK_IMPORTED_MODULE_6__.ak.Inline)],appPlugins:[s=>[s.plugins],plugins=>Object.values(plugins).filter(plugin=>plugin.plugin_type!==_types__WEBPACK_IMPORTED_MODULE_6__.ak.Inline)],globalPlugins:[s=>[s.appPlugins],plugins=>Object.values(plugins).filter(plugin=>plugin.is_global)],localPlugins:[s=>[s.appPlugins],plugins=>Object.values(plugins).filter(plugin=>!plugin.is_global)],missingGlobalPlugins:[s=>[s.appPlugins],plugins=>{let existingUrls=new Set(Object.values(plugins).map(p=>p.url));return Array.from(_utils__WEBPACK_IMPORTED_MODULE_10__.$V).filter(url=>!existingUrls.has(url))}],shouldBeGlobalPlugins:[s=>[s.appPlugins],plugins=>Object.values(plugins).filter(plugin=>plugin.url&&_utils__WEBPACK_IMPORTED_MODULE_10__.$V.has(plugin.url)&&!plugin.is_global)],shouldNotBeGlobalPlugins:[s=>[s.appPlugins],plugins=>Object.values(plugins).filter(plugin=>!(plugin.url&&_utils__WEBPACK_IMPORTED_MODULE_10__.$V.has(plugin.url))&&plugin.is_global)],updatablePlugins:[s=>[s.appPlugins],plugins=>Object.values(plugins).filter(plugin=>plugin.plugin_type!==_types__WEBPACK_IMPORTED_MODULE_6__.ak.Source&&!plugin.url?.startsWith("file:"))],pluginsNeedingUpdates:[s=>[s.updatablePlugins],plugins=>plugins.filter(plugin=>plugin.latest_tag&&plugin.tag!==plugin.latest_tag)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref12=>{let{actions,values}=_ref12;return{checkForUpdates:async()=>{await Promise.all(values.updatablePlugins.map(async plugin=>{try{let updates=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/organizations/@current/plugins/${plugin.id}/check_for_updates`);actions.setPluginLatestTag(plugin.id,updates.plugin.latest_tag)}catch(e){lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error(`Error checking for updates for ${plugin.name}: ${JSON.stringify(e)}`)}})),actions.checkedForUpdates()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref13=>{let{actions}=_ref13;actions.loadPlugins(),actions.loadUnusedPlugins(),actions.checkForUpdates()})])},"../../frontend/src/scenes/pipeline/batch-exports/utils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{x:()=>humanizeBatchExportName});let humanizeBatchExportName=service=>"HTTP"===service?"PostHog HTTP":service},"../../frontend/src/scenes/pipeline/destinations/DestinationsFilters.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>DestinationsFilters});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),scenes_pipeline_NewButton__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/scenes/pipeline/NewButton.tsx"),_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),_destinationsFiltersLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/destinationsFiltersLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DestinationsFilters(_ref){var _filters$search,_filters$kind;let{types,hideSearch,hideShowPaused,hideKind,hideFeedback,hideAddDestinationButton=!0}=_ref,{filters}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)((0,_destinationsFiltersLogic__WEBPACK_IMPORTED_MODULE_5__.T)({types})),{setFilters,openFeedbackDialog}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)((0,_destinationsFiltersLogic__WEBPACK_IMPORTED_MODULE_5__.T)({types})),isTransformationsOnly=types.includes("transformation");return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"deprecated-space-y-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex items-center gap-2",children:[!hideSearch&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.DF,{type:"search",placeholder:"Search...",value:null!==(_filters$search=filters.search)&&void 0!==_filters$search?_filters$search:"",onChange:e=>setFilters({search:e})}),hideFeedback?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.rU,{className:"text-sm font-semibold",subtle:!0,onClick:()=>openFeedbackDialog(),children:"Can't find what you're looking for?"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex-1"}),"boolean"!=typeof hideShowPaused&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Hw,{label:"Show paused",bordered:!0,size:"small",checked:filters.showPaused,onChange:e=>setFilters({showPaused:null!=e?e:void 0})}),!hideKind&&!isTransformationsOnly&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Yv,{type:"secondary",size:"small",options:[{label:"All kinds",value:null},{label:"Realtime",value:_types__WEBPACK_IMPORTED_MODULE_4__.b.HogFunction},{label:"Batch exports",value:_types__WEBPACK_IMPORTED_MODULE_4__.b.BatchExport}].filter(Boolean),value:null!==(_filters$kind=filters.kind)&&void 0!==_filters$kind?_filters$kind:null,onChange:e=>setFilters({kind:null!=e?e:null})}),hideAddDestinationButton?null:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(scenes_pipeline_NewButton__WEBPACK_IMPORTED_MODULE_2__.R,{stage:isTransformationsOnly?_types__WEBPACK_IMPORTED_MODULE_3__.We.Transformation:_types__WEBPACK_IMPORTED_MODULE_3__.We.Destination,size:"small"})]})})}},"../../frontend/src/scenes/pipeline/destinations/NewDestinations.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h:()=>DestinationOptionsTable,n:()=>NewDestinations});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.7_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),PayGateButton=__webpack_require__("../../frontend/src/lib/components/PayGateMini/PayGateButton.tsx"),PayGateMini=__webpack_require__("../../frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),LemonTableLink=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),src_types=__webpack_require__("../../frontend/src/types.ts"),pipelineAccessLogic=__webpack_require__("../../frontend/src/scenes/pipeline/pipelineAccessLogic.tsx"),DestinationsFilters=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/DestinationsFilters.tsx"),destinationsFiltersLogic=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/destinationsFiltersLogic.tsx"),DestinationTag=__webpack_require__("../../frontend/src/scenes/pipeline/destinations/DestinationTag.tsx"),fuse_esm=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),utils=__webpack_require__("../../frontend/src/scenes/pipeline/batch-exports/utils.ts"),HogFunctionIcon=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/HogFunctionIcon.tsx"),hogFunctionTemplateListLogic=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/list/hogFunctionTemplateListLogic.tsx"),hogfunctions_urls=__webpack_require__("../../frontend/src/scenes/pipeline/hogfunctions/urls.ts"),types=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),pipeline_utils=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let newDestinationsLogic=(0,index_esm.kea)([(0,index_esm.path)(()=>["scenes","pipeline","destinations","newDestinationsLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>{var _props$types$join;return null!==(_props$types$join=props.types.join(","))&&void 0!==_props$types$join?_props$types$join:""}),(0,index_esm.connect)(_ref=>{let{types}=_ref;return{values:[userLogic.userLogic,["user"],featureFlagLogic.featureFlagLogic,["featureFlags"],(0,destinationsFiltersLogic.T)({types}),["filters"]]}}),(0,index_esm.actions)({openFeedbackDialog:!0}),(0,lib.loaders)(_ref2=>{let{props,values}=_ref2;return{hogFunctionTemplates:[{},{loadHogFunctionTemplates:async()=>{let destinationTypes=values.featureFlags[constants.y8.SITE_DESTINATIONS]?props.types:props.types.filter(type=>"site_destination"!==type);return(await api.ZP.hogFunctions.listTemplates({types:destinationTypes})).results.reduce((acc,template)=>(acc[template.id]=template,acc),{})}}]}}),(0,index_esm.selectors)(()=>({loading:[s=>[s.hogFunctionTemplatesLoading],hogFunctionTemplatesLoading=>hogFunctionTemplatesLoading],types:[()=>[(_,p)=>p.types],types=>types],batchExportServiceNames:[s=>[s.user,s.featureFlags,s.types],(user,featureFlags,types)=>{if(!types.includes("destination"))return[];let httpEnabled=featureFlags[constants.y8.BATCH_EXPORTS_POSTHOG_HTTP]||user?.is_impersonated||user?.is_staff;return src_types.e2.filter(service=>!!httpEnabled||"HTTP"!==service)}],destinations:[s=>[s.hogFunctionTemplates,s.batchExportServiceNames,kea_router_lib.router.selectors.hashParams,s.user],(hogFunctionTemplates,batchExportServiceNames,hashParams,user)=>[...Object.values(hogFunctionTemplates).filter(hogFunction=>(0,hogFunctionTemplateListLogic.I)(hogFunction,user)).map(hogFunction=>({icon:(0,jsx_runtime.jsx)(HogFunctionIcon._,{size:"small",src:hogFunction.icon_url}),name:hogFunction.name,description:hogFunction.description,backend:types.b.HogFunction,url:(0,kea_router_lib.combineUrl)(urls.j.pipelineNodeNew((0,hogfunctions_urls.R4)(hogFunction.type),`hog-${hogFunction.id}`),{},hashParams).url,status:hogFunction.status,free:hogFunction.free})),...batchExportServiceNames.map(service=>({icon:(0,jsx_runtime.jsx)(pipeline_utils.oe,{type:service}),name:(0,utils.x)(service),description:`${service} batch export`,backend:types.b.BatchExport,url:urls.j.pipelineNodeNew(src_types.We.Destination,`${service}`),free:!1}))]],destinationsFuse:[s=>[s.destinations],destinations=>new fuse_esm.Z(destinations||[],{keys:["name","description"],threshold:.3})],filteredDestinations:[s=>[s.filters,s.destinations,s.destinationsFuse],(filters,destinations,destinationsFuse)=>{let{search,kind}=filters;return(search?destinationsFuse.search(search).map(x=>x.item):destinations).filter(dest=>!kind||dest.backend===kind)}],hiddenDestinations:[s=>[s.destinations,s.filteredDestinations],(destinations,filteredDestinations)=>destinations.filter(dest=>!filteredDestinations.includes(dest))]})),(0,index_esm.afterMount)(_ref3=>{let{actions}=_ref3;actions.loadHogFunctionTemplates()})]);function NewDestinations(_ref){let{types}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[types.includes("destination")?(0,jsx_runtime.jsx)(PayGateMini.E,{feature:src_types.P$.DATA_PIPELINES}):null,(0,jsx_runtime.jsx)(DestinationsFilters.B,{types:types,hideShowPaused:!0}),(0,jsx_runtime.jsx)(DestinationOptionsTable,{types:types})]})}function DestinationOptionsTable(_ref2){let{types}=_ref2,{loading,filteredDestinations,hiddenDestinations}=(0,index_esm.useValues)(newDestinationsLogic({types})),{canEnableDestination}=(0,index_esm.useValues)(pipelineAccessLogic.g),{resetFilters}=(0,index_esm.useActions)((0,destinationsFiltersLogic.T)({types})),{user}=(0,index_esm.useValues)(userLogic.userLogic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.g3,{dataSource:filteredDestinations,size:"small",loading:loading,columns:[{title:"App",width:0,render:(_,target)=>target.icon},{title:"Name",sticky:!0,key:"name",sorter:(a,b)=>a.name.localeCompare(b.name),render:function RenderName(_,target){return(0,jsx_runtime.jsx)(LemonTableLink.i,{to:canEnableDestination(target)?target.url:void 0,title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[target.name,target.status&&(0,jsx_runtime.jsx)(DestinationTag.F,{status:target.status})]}),description:target.description})}},{width:100,align:"right",render:function RenderActions(_,target){return canEnableDestination(target)?(0,jsx_runtime.jsx)(src.Jp,{type:"primary","data-attr":`new-${src_types.We.Destination}`,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),to:target.url,children:"Create"}):(0,jsx_runtime.jsxs)("span",{className:"flex items-center gap-2 whitespace-nowrap",children:[(0,jsx_runtime.jsx)(PayGateButton.R,{feature:src_types.P$.DATA_PIPELINES,type:"secondary"}),user?.is_impersonated&&(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),tooltip:"Staff users can create destinations as an override",to:target.url})]})}}]}),hiddenDestinations.length>0&&(0,jsx_runtime.jsxs)("div",{className:"text-secondary",children:[hiddenDestinations.length," hidden. ",(0,jsx_runtime.jsx)(src.rU,{onClick:()=>resetFilters(),children:"Show all"})]})]})}},"../../frontend/src/scenes/pipeline/frontendAppsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>frontendAppsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/projectLogic.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");let frontendAppsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","frontendAppsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__.K,["currentProjectId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_frontend_apps")}],pluginConfigs:[{},{loadPluginConfigs:async()=>Object.fromEntries((await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentProjectId}/pipeline_frontend_apps_configs`)).map(pluginConfig=>[pluginConfig.id,pluginConfig])),toggleEnabled:async _ref2=>{let{id,enabled}=_ref2;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.SiteApp,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref3=>{let{pluginConfig}=_ref3;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],frontendApps:[s=>[s.plugins,s.pluginConfigs],(plugins,pluginConfigs)=>Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})).map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.SiteApp)).sort((a,b)=>Number(b.enabled)-Number(a.enabled))]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadPlugins(),actions.loadPluginConfigs()})])},"../../frontend/src/scenes/pipeline/hogfunctions/HogFunctionStatusIndicator.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{F:()=>HogFunctionStatusIndicator});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/src/types.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let displayMap={[_types__WEBPACK_IMPORTED_MODULE_1__.si.healthy]:{tagType:"success",display:"Active",description:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:"The function is running as expected."})},[_types__WEBPACK_IMPORTED_MODULE_1__.si.overflowed]:{tagType:"caution",display:"Degraded",description:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:"The function is running slow or has issues performing async requests. It has been moved to the slow lane and may be processing slower than usual."})},[_types__WEBPACK_IMPORTED_MODULE_1__.si.disabledForPeriod]:{tagType:"danger",display:"Disabled temporarily",description:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:"The function has been disabled temporarily due to enough slow or failed requests. It will be re-enabled soon."})},[_types__WEBPACK_IMPORTED_MODULE_1__.si.disabledIndefinitely]:{tagType:"danger",display:"Disabled",description:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:'The function has been disabled indefinitely due to too many slow or failed requests. Please check your config. Updating your function will move it back to the "degraded" state for testing. If it performs well, it will then be moved to the healthy.'})}},DEFAULT_DISPLAY={tagType:"default",display:"Unknown",description:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:"The function status is unknown. The status will be derived once enough invocations have been performed."})},DISABLED_MANUALLY_DISPLAY={tagType:"default",display:"Paused",description:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:"This function is paused"})};function HogFunctionStatusIndicator(_ref){let{hogFunction}=_ref;if(!hogFunction)return null;let{tagType,display,description}="site_app"===hogFunction.type||"site_destination"===hogFunction.type?hogFunction.enabled?displayMap[_types__WEBPACK_IMPORTED_MODULE_1__.si.healthy]:DISABLED_MANUALLY_DISPLAY:hogFunction.status?.state?displayMap[hogFunction.status.state]:hogFunction.enabled?DEFAULT_DISPLAY:DISABLED_MANUALLY_DISPLAY;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.Qw,{overlay:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("div",{className:"p-2 deprecated-space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)("h2",{className:"flex items-center m-0 gap-2",children:["Function status - ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{type:tagType,children:display})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)("p",{children:description})]})}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.oe,{type:tagType,children:display})})}},"../../frontend/src/scenes/pipeline/importAppsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>importAppsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/projectLogic.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");let importAppsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","importAppsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__.K,["currentProjectId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_import_apps")}],pluginConfigs:[{},{loadPluginConfigs:async()=>Object.fromEntries((await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentProjectId}/pipeline_import_apps_configs`)).map(pluginConfig=>[pluginConfig.id,pluginConfig])),toggleEnabled:async _ref2=>{let{id,enabled}=_ref2;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.ImportApp,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref3=>{let{pluginConfig}=_ref3;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],importApps:[s=>[s.plugins,s.pluginConfigs],(plugins,pluginConfigs)=>Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})).map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.ImportApp)).sort((a,b)=>Number(b.enabled)-Number(a.enabled))],hasEnabledImportApps:[s=>[s.importApps],importApps=>importApps.some(app=>app.enabled)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadPlugins(),actions.loadPluginConfigs()})])},"../../frontend/src/scenes/pipeline/pipelineNodeMetricsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>pipelineNodeMetricsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/utils.tsx"),scenes_projectLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/projectLogic.ts");let pipelineNodeMetricsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{id}=_ref;return id}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(id=>["scenes","pipeline","appMetricsLogic",id]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_projectLogic__WEBPACK_IMPORTED_MODULE_4__.K,["currentProjectId"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setDateRange:(from,to)=>({from,to}),openErrorDetailsModal:errorType=>({errorType}),closeErrorDetailsModal:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values,props}=_ref2;return{appMetricsResponse:[null,{loadMetrics:async()=>{let params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({date_from:values.dateRange.from,date_to:values.dateRange.to});return await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${values.currentProjectId}/app_metrics/${props.id}?${params}`)}}],errorDetails:[[],{openErrorDetailsModal:async _ref3=>{let{errorType}=_ref3,params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({error_type:errorType}),{result}=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${values.currentProjectId}/app_metrics/${props.id}/error_details?${params}`);return result}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({dateRange:[{from:"-7d",to:null},{setDateRange:(_,_ref4)=>{let{from,to}=_ref4;return{from:null!=from?from:"-7d",to:to}}}],errorDetailsModalError:[null,{openErrorDetailsModal:(_,_ref5)=>{let{errorType}=_ref5;return errorType},closeErrorDetailsModal:()=>null}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref6=>{let{actions}=_ref6;return{setDateRange:()=>{actions.loadMetrics()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref7=>{let{actions}=_ref7;actions.loadMetrics()})])},"../../frontend/src/scenes/pipeline/sourceAppInitialCode.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>getInitialCode,n:()=>SourcePluginKind});let SourcePluginKind=function(SourcePluginKind){return SourcePluginKind.FilterEvent="filterEvent",SourcePluginKind.ModifyEvent="modifyEvent",SourcePluginKind.ComposeWebhook="composeWebhook",SourcePluginKind.Site="site",SourcePluginKind.Frontend="frontend",SourcePluginKind}({});function getInitialCode(name,kind){switch(kind){case SourcePluginKind.FilterEvent:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"eventToSkip",name:"Event to skip",type:"string",hint:"If the event name matches this, it will be skipped",default:"$pageview",required:!1}]},null,4),"index.ts":`// Learn more about plugins at: https://posthog.com/docs/apps/build

// Processes each event, optionally dropping it
export function processEvent(event, { config }) {
    if (event.event === config.eventToSkip) {
        return null
    }
    return event
}

// Runs when the plugin is loaded, allows for preparing it as needed
export function setupPlugin (meta) {
    console.log(\`The date is \${new Date().toDateString()}\`)
}`};case SourcePluginKind.ModifyEvent:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"propertyToRemove",name:"Property to remove",type:"string",hint:"This property will be removed from all events",default:"$browser",required:!1}]},null,4),"index.ts":`// Learn more about plugins at: https://posthog.com/docs/apps/build

// Processes each event, optionally modify it
export function processEvent(event, { config }) {
    event.properties[config.propertyToRemove] = undefined
    return event
}

// Runs when the plugin is loaded, allows for preparing it as needed
export function setupPlugin (meta) {
    console.log(\`The date is \${new Date().toDateString()}\`)
}`};case SourcePluginKind.ComposeWebhook:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"url",name:"The destination url",type:"string",hint:"Where the webhook will be sent to",default:"",required:!0}]},null,4),"index.ts":`// Learn more about plugins at: https://posthog.com/docs/apps/build
import { PostHogEvent, Webhook } from '@posthog/plugin-scaffold'

export function composeWebhook(event: PostHogEvent, { config }: any): Webhook {
    return {
        url: config.url,
        body: JSON.stringify(event),
        headers: {
            'Content-Type': 'application/json',
        },
        method: 'POST',
    }
}`};case SourcePluginKind.Site:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"name",name:"Person to greet",type:"string",hint:"Used to personalise the property `hello`",default:"world",required:!1}]},null,4),"site.ts":`export function inject({ config, posthog }) {
    console.log('Hello from PostHog-JS')
}
"`};case SourcePluginKind.Frontend:return{"plugin.json":JSON.stringify({name:name,config:[{markdown:"Specify your config here"},{key:"name",name:"Person to greet",type:"string",hint:"Used to personalise the property `hello`",default:"world",required:!1}]},null,4),"frontend.tsx":`import React from "react"

                export const scene = {
                    title: "My Stuff",
                    component: function MyStuff({ config }) {
                        return (
                            <div>
                                <h1>My Favourite Links</h1>
                                <ul>
                                    <li>
                                        <a href="https://news.ycombinator.com">The NEWS</a>
                                    </li>
                                </ul>
                                <h1>My Favourite Cow</h1>
                                <img src="https://media.giphy.com/media/RYKFEEjtYpxL2/giphy.gif" />
                            </div>
                        )
                    },
                }`}}}},"../../frontend/src/scenes/pipeline/transformationsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>pipelineTransformationsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/scenes/projectLogic.ts"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/pipeline/utils.tsx");let pipelineTransformationsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","transformationsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_projectLogic__WEBPACK_IMPORTED_MODULE_3__.K,["currentProjectId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,openReorderModal:!0,closeReorderModal:!0,setTemporaryOrder:tempOrder=>({tempOrder}),savePluginConfigsOrder:newOrders=>({newOrders}),updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_transformations")}],temporaryOrder:[{},{setTemporaryOrder:async _ref2=>{let{tempOrder}=_ref2;return tempOrder},closeReorderModal:async()=>({})}],pluginConfigs:[{},{loadPluginConfigs:async()=>Object.fromEntries((await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentProjectId}/pipeline_transformation_configs`)).map(pluginConfig=>[pluginConfig.id,pluginConfig])),savePluginConfigsOrder:async _ref3=>{let{newOrders}=_ref3;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,!1))return values.pluginConfigs;let{pluginConfigs}=values,response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update("api/plugin_config/rearrange",{orders:newOrders}),newPluginConfigs={...pluginConfigs};for(let pluginConfig of response)Object.keys(values.plugins).map(Number).includes(pluginConfig.plugin)&&(newPluginConfigs[pluginConfig.id]=pluginConfig);return newPluginConfigs},toggleEnabled:async _ref4=>{let{id,enabled}=_ref4;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let order={};enabled&&(order={order:values.nextAvailableOrder});let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled,...order});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref5=>{let{pluginConfig}=_ref5;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],transformations:[s=>[s.pluginConfigs,s.plugins],(pluginConfigs,plugins)=>Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})).map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation))],sortedEnabledTransformations:[s=>[s.transformations,s.temporaryOrder],(transformations,temporaryOrder)=>(transformations=transformations.filter(t=>t.enabled),transformations=temporaryOrder&&Object.keys(temporaryOrder).length>0?Object.entries(temporaryOrder).sort((_ref6,_ref7)=>{let[,aIdx]=_ref6,[,bIdx]=_ref7;return aIdx-bIdx}).map(_ref8=>{let[pluginId]=_ref8;return transformations.find(t=>t.id===Number(pluginId))}):transformations.sort((a,b)=>a.order-b.order))],sortedTransformations:[s=>[s.transformations,s.sortedEnabledTransformations],(transformations,sortedEnabledTransformations)=>sortedEnabledTransformations.concat(transformations.filter(t=>!t.enabled).sort((a,b)=>a.id-b.id))],nextAvailableOrder:[s=>[s.transformations],transformations=>{let enabledTransformations=transformations.filter(t=>t.enabled);return enabledTransformations.length>0?Math.max(...enabledTransformations.map(t=>t.order),0)+1:0}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({reorderModalOpen:[!1,{openReorderModal:()=>!0,closeReorderModal:()=>!1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref9=>{let{actions}=_ref9;return{savePluginConfigsOrderSuccess:()=>{actions.closeReorderModal()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref10=>{let{actions}=_ref10;actions.loadPlugins(),actions.loadPluginConfigs()})])}}]);
//# sourceMappingURL=76549.a400d276.iframe.bundle.js.map