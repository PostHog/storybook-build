(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[12115],{"../../frontend/src/scenes/experiments/Experiment.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Experiment:()=>Experiment,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.7_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),SeriesGlyph=__webpack_require__("../../frontend/src/lib/components/SeriesGlyph.tsx"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),groupsAccessLogic=__webpack_require__("../../frontend/src/lib/introductions/groupsAccessLogic.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonRadio=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonRadio/index.ts");__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSelect/index.ts");var utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),eventUsageLogic=__webpack_require__("../../frontend/src/lib/utils/eventUsageLogic.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),experimentsLogic=__webpack_require__("../../frontend/src/scenes/experiments/experimentsLogic.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),experiments_experimentLogic=__webpack_require__("../../frontend/src/scenes/experiments/experimentLogic.tsx"),experiments_utils=__webpack_require__("../../frontend/src/scenes/experiments/utils.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ExperimentFormFields=()=>{var _experiment$parameter;let{experiment,groupTypes,aggregationLabel,hasPrimaryMetricSet,validExistingFeatureFlag}=(0,index_esm.useValues)(experiments_experimentLogic.W),{addVariant,removeExperimentGroup,setExperiment,createExperiment,setExperimentType,validateFeatureFlag}=(0,index_esm.useActions)(experiments_experimentLogic.W),{webExperimentsAvailable,unavailableFeatureFlagKeys}=(0,index_esm.useValues)(experimentsLogic.OK),{groupsAccessStatus}=(0,index_esm.useValues)(groupsAccessLogic.e),{reportExperimentFeatureFlagModalOpened,reportExperimentFeatureFlagSelected}=(0,index_esm.useActions)(eventUsageLogic.vx),[showFeatureFlagSelector,setShowFeatureFlagSelector]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)("div",{children:[hasPrimaryMetricSet&&(0,jsx_runtime.jsx)(src.Vp,{type:"info",className:"my-4",children:"Fill out the details below to create your experiment based off of the insight."}),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-8",children:[(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-6 max-w-120",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"Pricing page conversion","data-attr":"experiment-name",onBlur:()=>{setExperiment({feature_flag_key:generateFeatureFlagKey(experiment.name,unavailableFeatureFlagKeys)})}})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"feature_flag_key",label:"Feature flag key",help:(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsx)("span",{children:"Each experiment is backed by a feature flag."}),(0,jsx_runtime.jsxs)(LemonButton.J,{type:"secondary",size:"xsmall",onClick:()=>{reportExperimentFeatureFlagModalOpened(),setShowFeatureFlagSelector(!0)},children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconToggle,{className:"mr-1"}),"Link to existing feature flag"]})]}),children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"pricing-page-conversion","data-attr":"experiment-feature-flag-key"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"description",label:"Description",children:(0,jsx_runtime.jsx)(src._V,{placeholder:"The goal of this experiment is ...","data-attr":"experiment-description"})})]}),(0,jsx_runtime.jsx)(SelectExistingFeatureFlagModal,{isOpen:showFeatureFlagSelector,onClose:()=>setShowFeatureFlagSelector(!1),onSelect:flag=>{reportExperimentFeatureFlagSelected(flag.key),setExperiment({feature_flag_key:flag.key,parameters:{...experiment.parameters,feature_flag_variants:flag.filters?.multivariate?.variants||[]}}),validateFeatureFlag(flag.key),setShowFeatureFlagSelector(!1)}}),webExperimentsAvailable&&(0,jsx_runtime.jsxs)("div",{className:"mt-10",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-1",children:"Experiment type"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-secondary font-medium tracking-normal",children:"Select your experiment setup, this cannot be changed once saved."}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(LemonRadio._,{value:experiment.type,className:"deprecated-space-y-2 -mt-2",onChange:type=>{setExperimentType(type)},options:[{value:"product",label:(0,jsx_runtime.jsxs)("div",{className:"translate-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"Product experiment"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-secondary",children:"Use custom code to manage how variants modify your product."})]})},{value:"web",label:(0,jsx_runtime.jsxs)("div",{className:"translate-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"No-code web experiment"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-secondary",children:"Define variants on your website using the PostHog toolbar, no coding required."})]})}]})]}),groupsAccessStatus===groupsAccessLogic.Q.AlreadyUsing&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-10",children:"Participant type"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-secondary",children:"The type on which to aggregate metrics. You can change this at any time during the experiment."}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(LemonRadio._,{value:void 0!=experiment.parameters.aggregation_group_type_index?experiment.parameters.aggregation_group_type_index:-1,onChange:rawGroupTypeIndex=>{let groupTypeIndex=-1!==rawGroupTypeIndex?rawGroupTypeIndex:void 0;setExperiment({parameters:{...experiment.parameters,aggregation_group_type_index:null!=groupTypeIndex?groupTypeIndex:void 0}})},options:[{value:-1,label:"Persons"},...Array.from(groupTypes.values()).map(groupType=>({value:groupType.group_type_index,label:(0,utils.fm)(aggregationLabel(groupType.group_type_index).plural)}))]})]}),validExistingFeatureFlag&&(0,jsx_runtime.jsxs)("div",{className:"mt-10",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-1",children:"Variants"}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(src.Vp,{type:"info",className:"mb-8",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("div",{children:"Existing feature flag configuration will be applied to the experiment."}),(0,jsx_runtime.jsx)(src.rU,{to:urls.j.featureFlag(validExistingFeatureFlag.id),target:"_blank",className:"flex items-center",children:(0,jsx_runtime.jsx)(icons.pF,{className:"ml-1"})})]})})]}),!validExistingFeatureFlag&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"mt-10",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-1",children:"Variants"}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-secondary",children:["Add up to ",constants.Rp-1," variants to test against your control."]}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-160",children:[(0,jsx_runtime.jsxs)("div",{className:"max-w-60",children:[(0,jsx_runtime.jsx)("h3",{children:"Control"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsxs)(lib.Group,{name:["parameters","feature_flag_variants",0],children:[(0,jsx_runtime.jsx)(SeriesGlyph.jc,{index:0,className:"h-7 w-7 text-base"}),(0,jsx_runtime.jsx)(LemonField.D,{name:"key",className:"ml-2 flex-grow",children:(0,jsx_runtime.jsx)(src.DF,{disabled:!0,"data-attr":"experiment-variant-key","data-key-index":0,className:"ph-ignore-input",fullWidth:!0,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})]},0)}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs mt-2",children:"Included automatically, cannot be edited or removed"})]}),(0,jsx_runtime.jsxs)("div",{className:"max-w-100",children:[(0,jsx_runtime.jsx)("h3",{children:"Test(s)"}),experiment.parameters.feature_flag_variants?.map((_,index)=>0===index?null:jsx_runtime.jsx(lib.Group,{name:["parameters","feature_flag_variants",index],children:jsx_runtime.jsxs("div",{className:`flex items-center deprecated-space-x-2 ${index>1&&"mt-2"}`,children:[jsx_runtime.jsx(SeriesGlyph.jc,{index:index,className:"h-7 w-7 text-base"}),jsx_runtime.jsx(LemonField.D,{name:"key",className:"flex-grow",children:jsx_runtime.jsx(src.DF,{"data-attr":"experiment-variant-key","data-key-index":index.toString(),className:"ph-ignore-input",fullWidth:!0,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),jsx_runtime.jsx("div",{className:`${1===index&&"pr-9"}`,children:1!==index&&jsx_runtime.jsx(src.u,{title:"Delete this variant",placement:"top-start",children:jsx_runtime.jsx(LemonButton.J,{size:"small",icon:jsx_runtime.jsx(posthog_icons_es.IconTrash,{}),onClick:()=>removeExperimentGroup(index)})})})]},`variant-${index}`)},index)),(0,jsx_runtime.jsx)("div",{className:"text-secondary text-xs ml-9 mr-20 mt-2",children:"Alphanumeric, hyphens and underscores only"}),(null!==(_experiment$parameter=experiment.parameters.feature_flag_variants.length)&&void 0!==_experiment$parameter?_experiment$parameter:0)<constants.Rp&&(0,jsx_runtime.jsx)(LemonButton.J,{className:"ml-9 mt-2",type:"secondary",onClick:()=>addVariant(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),"data-attr":"add-test-variant",children:"Add test variant"})]})]})]})})]}),(0,jsx_runtime.jsx)(LemonButton.J,{className:"mt-2",type:"primary","data-attr":"save-experiment",onClick:()=>createExperiment(!0),children:"Save as draft"})]})};function ExperimentForm(){let{props}=(0,index_esm.useValues)(experiments_experimentLogic.W);return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(lib.Form,{id:"experiment-step",logic:experiments_experimentLogic.W,formKey:"experiment",props:props,enableFormOnSubmit:!0,className:"deprecated-space-y-6 experiment-form",children:(0,jsx_runtime.jsx)(ExperimentFormFields,{})})})}let generateFeatureFlagKey=(name,unavailableFeatureFlagKeys)=>{let baseKey=name.toLowerCase().replace(/[^A-Za-z0-9-_]+/g,"-").replace(/-+$/,"").replace(/^-+/,""),key=baseKey,counter=1;for(;unavailableFeatureFlagKeys.has(key);)key=`${baseKey}-${counter}`,counter++;return key},SelectExistingFeatureFlagModal=_ref=>{let{isOpen,onClose,onSelect}=_ref,{featureFlags}=(0,index_esm.useValues)(experimentsLogic.OK);return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isOpen,onClose:onClose,title:"Choose an existing feature flag",children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted mb-2 max-w-xl",children:["Select an existing feature flag to use with this experiment. The feature flag must use multiple variants with ",(0,jsx_runtime.jsx)("code",{children:"'control'"})," as the first, and not be associated with an existing experiment."]}),(0,jsx_runtime.jsx)(src.g3,{dataSource:featureFlags.results,useURLForSorting:!1,columns:[{title:"Key",dataIndex:"key",sorter:(a,b)=>(a.key||"").localeCompare(b.key||""),render:(key,flag)=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:key}),(0,jsx_runtime.jsx)(src.rU,{to:urls.j.featureFlag(flag.id),target:"_blank",className:"flex items-center",children:(0,jsx_runtime.jsx)(icons.pF,{className:"ml-1"})})]})},{title:"Name",dataIndex:"name",sorter:(a,b)=>(a.name||"").localeCompare(b.name||"")},{title:null,render:function RenderActions(_,flag){let disabledReason;try{(0,experiments_utils.i3)(flag)}catch(error){disabledReason=error.message}return(0,jsx_runtime.jsx)(LemonButton.J,{size:"xsmall",type:"primary",disabledReason:disabledReason,onClick:()=>{onSelect(flag),onClose()},children:"Select"})}}]})]})})};var AuthorizedUrlList=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),authorizedUrlListLogic=__webpack_require__("../../frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),LemonDialog=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonDialog/index.ts");function WebExperimentImplementationDetails(_ref){let{experiment}=_ref;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-2",children:"Implementation"}),(0,jsx_runtime.jsxs)("div",{className:"border p-6 rounded bg-surface-primary deprecated-space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold leading-tight text-base text-current",children:"Define variant changes directly on your website"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"Use our toolbar to select elements and apply transformations for each variant."}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",type:"secondary",onClick:()=>{LemonDialog.d.open({title:"Select a domain",description:experiment?.id?"Choose the domain on which to edit this experiment":"Choose the domain on which to create this experiment",content:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(AuthorizedUrlList.t,{experimentId:experiment?.id,type:authorizedUrlListLogic.uw.TOOLBAR_URLS})}),primaryButton:{children:"Close",type:"secondary"}})},sideIcon:(0,jsx_runtime.jsx)(icons.UE,{}),children:"Launch toolbar on your website"})})]})]})})}var ExperimentImplementationDetails=__webpack_require__("../../frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx"),ExperimentMetricForm=__webpack_require__("../../frontend/src/scenes/experiments/ExperimentMetricForm.tsx");function ExperimentMetricModal(_ref){let{experimentId,isSecondary}=_ref,{experiment,experimentLoading,isPrimaryMetricModalOpen,isSecondaryMetricModalOpen,editingPrimaryMetricIndex,editingSecondaryMetricIndex}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),{setMetric,updateExperimentMetrics,setExperiment,closePrimaryMetricModal,closeSecondaryMetricModal,restoreUnmodifiedExperiment}=(0,index_esm.useActions)((0,experiments_experimentLogic.W)({experimentId})),metricIdx=isSecondary?editingSecondaryMetricIndex:editingPrimaryMetricIndex,metricsField=isSecondary?"metrics_secondary":"metrics",handleSetMetric=(0,react.useCallback)(newMetric=>{null!=metricIdx&&setMetric({metricIdx,metric:newMetric,isSecondary})},[metricIdx,isSecondary,setMetric]);if(null==metricIdx)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let metrics=experiment[metricsField],metric=metrics[metricIdx],onClose=()=>{restoreUnmodifiedExperiment(),isSecondary?closeSecondaryMetricModal():closePrimaryMetricModal()};return(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isSecondary?isSecondaryMetricModalOpen:isPrimaryMetricModalOpen,onClose:onClose,width:1e3,title:"Edit experiment metric",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center w-full",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",status:"danger",onClick:()=>{src.dn.open({title:"Delete this metric?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"This action cannot be undone."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>{setExperiment({[metricsField]:metrics.filter((_,idx)=>idx!==metricIdx)}),updateExperimentMetrics(),isSecondary?closeSecondaryMetricModal():closePrimaryMetricModal()},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Delete"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-metric-form",type:"secondary",onClick:onClose,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-metric-form",onClick:()=>{updateExperimentMetrics(),isSecondary?closeSecondaryMetricModal():closePrimaryMetricModal()},type:"primary",loading:experimentLoading,"data-attr":"save-experiment-metric",children:"Save"})]})]}),children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)(src.HQ,{className:"mb-1",children:"Name (optional)"}),(0,jsx_runtime.jsx)(src.DF,{value:metric.name,onChange:newName=>{setMetric({metricIdx,metric:{...metric,name:newName},isSecondary})}})]}),(0,jsx_runtime.jsx)(ExperimentMetricForm.U,{metric:metric,handleSetMetric:handleSetMetric,filterTestAccounts:experiment.exposure_criteria?.filterTestAccounts||!1})]})}var types=__webpack_require__("../../frontend/src/types.ts"),TaxonomicFilter_types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),TestAccountFiltersSwitch=__webpack_require__("../../frontend/src/lib/components/TestAccountFiltersSwitch.tsx"),LemonBanner=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonBanner/index.ts"),ActionFilter=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),ActionFilterRow=__webpack_require__("../../frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),AggregationSelect=__webpack_require__("../../frontend/src/scenes/insights/filters/AggregationSelect.tsx"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),filtersToQueryNode=__webpack_require__("../../frontend/src/queries/nodes/InsightQuery/utils/filtersToQueryNode.ts"),queryNodeToFilter=__webpack_require__("../../frontend/src/queries/nodes/InsightQuery/utils/queryNodeToFilter.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),Selectors=__webpack_require__("../../frontend/src/scenes/experiments/Metrics/Selectors.tsx");function FunnelsMetricForm(_ref){var _currentMetric$funnel,_currentMetric$funnel2;let{isSecondary=!1}=_ref,{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),{experiment,isExperimentRunning,editingPrimaryMetricIndex,editingSecondaryMetricIndex}=(0,index_esm.useValues)(experiments_experimentLogic.W),{setFunnelsMetric}=(0,index_esm.useActions)(experiments_experimentLogic.W),hasFilters=(currentTeam?.test_account_filters||[]).length>0,metrics=isSecondary?experiment.metrics_secondary:experiment.metrics,metricIdx=isSecondary?editingSecondaryMetricIndex:editingPrimaryMetricIndex;if(!metricIdx&&0!==metricIdx)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let currentMetric=metrics[metricIdx],actionFilterProps={...Selectors.dF,actionsTaxonomicGroupTypes:[TaxonomicFilter_types.t.Events,TaxonomicFilter_types.t.Actions]};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Name (optional)"}),(0,jsx_runtime.jsx)(src.DF,{value:currentMetric.name,onChange:newName=>{setFunnelsMetric({metricIdx,name:newName,isSecondary})}})]}),(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,queryNodeToFilter.ce)(currentMetric.funnels_query),setFilters:_ref2=>{let{actions,events,data_warehouse}=_ref2;setFunnelsMetric({metricIdx,series:(0,filtersToQueryNode.NG)({actions,events,data_warehouse},!0,ActionFilterRow.Qq.None),isSecondary})},typeKey:"experiment-metric",mathAvailability:ActionFilterRow.Qq.None,buttonCopy:"Add funnel step",showSeriesIndicator:!0,seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,...actionFilterProps}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 deprecated-space-y-4",children:[(0,jsx_runtime.jsx)(Selectors.xE,{value:(0,AggregationSelect.eV)(null!==(_currentMetric$funnel=currentMetric.funnels_query.aggregation_group_type_index)&&void 0!==_currentMetric$funnel?_currentMetric$funnel:void 0,null!==(_currentMetric$funnel2=currentMetric.funnels_query.funnelsFilter?.funnelAggregateByHogQL)&&void 0!==_currentMetric$funnel2?_currentMetric$funnel2:void 0),onChange:value=>{setFunnelsMetric({metricIdx,funnelAggregateByHogQL:value,isSecondary})}}),(0,jsx_runtime.jsx)(Selectors.IF,{funnelWindowInterval:currentMetric.funnels_query?.funnelsFilter?.funnelWindowInterval,funnelWindowIntervalUnit:currentMetric.funnels_query?.funnelsFilter?.funnelWindowIntervalUnit,onFunnelWindowIntervalChange:funnelWindowInterval=>{setFunnelsMetric({metricIdx,funnelWindowInterval:funnelWindowInterval,isSecondary})},onFunnelWindowIntervalUnitChange:funnelWindowIntervalUnit=>{setFunnelsMetric({metricIdx,funnelWindowIntervalUnit:funnelWindowIntervalUnit||void 0,isSecondary})}}),(0,jsx_runtime.jsx)(Selectors.f$,{value:(()=>{let breakdownAttributionType=currentMetric.funnels_query?.funnelsFilter?.breakdownAttributionType,breakdownAttributionValue=currentMetric.funnels_query?.funnelsFilter?.breakdownAttributionValue;return breakdownAttributionType?breakdownAttributionType===types.q9.Step?`${breakdownAttributionType}/${breakdownAttributionValue||0}`:breakdownAttributionType:types.q9.FirstTouch})(),onChange:value=>{let[breakdownAttributionType,breakdownAttributionValue]=(value||"").split("/");setFunnelsMetric({metricIdx,breakdownAttributionType:breakdownAttributionType,breakdownAttributionValue:breakdownAttributionValue?parseInt(breakdownAttributionValue):void 0,isSecondary})},stepsLength:currentMetric.funnels_query?.series?.length}),(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:(()=>{let val=currentMetric.funnels_query?.filterTestAccounts;return!!hasFilters&&!!val})(),onChange:checked=>{setFunnelsMetric({metricIdx,filterTestAccounts:checked,isSecondary})},fullWidth:!0})]}),isExperimentRunning&&(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(Query.A,{query:{kind:schema_general.OH.InsightVizNode,source:currentMetric.funnels_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})}var injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),TrendsMetricForm=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.3_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/experiments/Metrics/TrendsMetricForm.scss"),TrendsMetricForm_default=__webpack_require__.n(TrendsMetricForm),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(TrendsMetricForm_default(),options),TrendsMetricForm_default().locals;var dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),experiments_constants=__webpack_require__("../../frontend/src/scenes/experiments/constants.ts");function TrendsMetricForm_TrendsMetricForm(_ref){let{isSecondary=!1}=_ref,{experiment,isExperimentRunning,editingPrimaryMetricIndex,editingSecondaryMetricIndex}=(0,index_esm.useValues)(experiments_experimentLogic.W),{setTrendsMetric,setTrendsExposureMetric,setExperiment}=(0,index_esm.useActions)(experiments_experimentLogic.W),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),hasFilters=(currentTeam?.test_account_filters||[]).length>0,[activeTab,setActiveTab]=(0,react.useState)("main"),metrics=isSecondary?experiment.metrics_secondary:experiment.metrics,metricIdx=isSecondary?editingSecondaryMetricIndex:editingPrimaryMetricIndex;if(!metricIdx&&0!==metricIdx)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let currentMetric=metrics[metricIdx],isDataWarehouseMetric=currentMetric.count_query?.series[0]?.kind===schema_general.OH.DataWarehouseNode;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:newKey=>setActiveTab(newKey),tabs:[{key:"main",label:"Main metric",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Name (optional)"}),(0,jsx_runtime.jsx)(src.DF,{value:currentMetric.name,onChange:newName=>{setTrendsMetric({metricIdx,name:newName,isSecondary})}})]}),(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,queryNodeToFilter.ce)(currentMetric.count_query),setFilters:_ref2=>{let{actions,events,data_warehouse}=_ref2,series=(0,filtersToQueryNode.NG)({actions,events,data_warehouse},!0,ActionFilterRow.Qq.All);series[0].kind===schema_general.OH.DataWarehouseNode&&setExperiment({...experiment,[isSecondary?"metrics_secondary":"metrics"]:metrics.map((metric,idx)=>idx===metricIdx?{...metric,exposure_query:void 0}:metric)}),setTrendsMetric({metricIdx,series,isSecondary})},typeKey:"experiment-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,showNumericalPropsOnly:!0,allowedMathTypes:experiments_constants.BK,...Selectors.dF}),(0,jsx_runtime.jsx)("div",{className:"mt-4 deprecated-space-y-4",children:(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:!!hasFilters&&!!currentMetric.count_query?.filterTestAccounts,onChange:checked=>{setTrendsMetric({metricIdx,filterTestAccounts:checked,isSecondary})},fullWidth:!0})}),isExperimentRunning&&(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(Query.A,{query:{kind:schema_general.OH.InsightVizNode,source:currentMetric.count_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})},{key:"exposure",label:"Exposure",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,jsx_runtime.jsxs)(src.Jp,{className:`trends-metric-form__exposure-button flex-1 cursor-pointer p-4 rounded border ${currentMetric.exposure_query?"border-primary":"border-accent bg-accent-highlight-secondary"}`,onClick:()=>{setExperiment({...experiment,[isSecondary?"metrics_secondary":"metrics"]:metrics.map((metric,idx)=>idx===metricIdx?{...metric,exposure_query:void 0}:metric)})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Default"}),!currentMetric.exposure_query&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--accent)"})]}),(0,jsx_runtime.jsxs)("div",{className:"text-secondary text-sm leading-relaxed mt-1",children:["Uses the number of unique users who trigger the"," ",(0,jsx_runtime.jsx)(src.oe,{children:"$feature_flag_called"})," event as your exposure count. This is the recommended setting for most experiments, as it accurately tracks variant exposure."]})]}),(0,jsx_runtime.jsxs)(src.Jp,{className:`trends-metric-form__exposure-button flex-1 cursor-pointer p-4 rounded border ${currentMetric.exposure_query?"border-accent bg-accent-highlight-secondary":"border-primary"}`,disabledReason:isDataWarehouseMetric?"Custom exposure events are not supported for data warehouse metrics. Please contact support if you need this feature.":void 0,onClick:()=>{setExperiment({...experiment,[isSecondary?"metrics_secondary":"metrics"]:metrics.map((metric,idx)=>idx===metricIdx?{...metric,exposure_query:{kind:schema_general.OH.TrendsQuery,series:[{kind:schema_general.OH.EventsNode,name:"$feature_flag_called",event:"$feature_flag_called",math:types.vN.UniqueUsers}],interval:"day",dateRange:{date_from:(0,dayjs.Bv)().subtract(constants.uq,"day").format("YYYY-MM-DDTHH:mm"),date_to:(0,dayjs.Bv)().endOf("d").format("YYYY-MM-DDTHH:mm"),explicitDate:!0},trendsFilter:{display:types.Qb.ActionsLineGraph},filterTestAccounts:!0}}:metric)})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Custom"}),currentMetric.exposure_query&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--accent)"})]}),(0,jsx_runtime.jsx)("div",{className:"text-secondary text-sm leading-relaxed mt-1",children:"Define your own exposure metric for specific use cases, such as counting by sessions instead of users. This gives you full control but requires careful configuration."})]})]}),currentMetric.exposure_query&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,queryNodeToFilter.ce)(currentMetric.exposure_query),setFilters:_ref3=>{let{actions,events,data_warehouse}=_ref3;setTrendsExposureMetric({metricIdx,series:(0,filtersToQueryNode.NG)({actions,events,data_warehouse},!0,ActionFilterRow.Qq.All),isSecondary})},typeKey:"experiment-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,showNumericalPropsOnly:!0,...Selectors.dF}),(0,jsx_runtime.jsx)("div",{className:"mt-4 deprecated-space-y-4",children:(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:(()=>{let val=currentMetric.exposure_query?.filterTestAccounts;return!!hasFilters&&!!val})(),onChange:checked=>{setTrendsExposureMetric({metricIdx,filterTestAccounts:checked,isSecondary})},fullWidth:!0})}),isExperimentRunning&&(0,jsx_runtime.jsxs)(LemonBanner.V,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," ","days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(Query.A,{query:{kind:schema_general.OH.InsightVizNode,source:currentMetric.exposure_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})]})}]})})}function LegacyMetricModal(_ref){let{experimentId,isSecondary}=_ref,{experiment,experimentLoading,getInsightType,isPrimaryMetricModalOpen,isSecondaryMetricModalOpen,editingPrimaryMetricIndex,editingSecondaryMetricIndex}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),{updateExperimentMetrics,setExperiment,closePrimaryMetricModal,closeSecondaryMetricModal,restoreUnmodifiedExperiment}=(0,index_esm.useActions)((0,experiments_experimentLogic.W)({experimentId})),metricIdx=isSecondary?editingSecondaryMetricIndex:editingPrimaryMetricIndex,metricsField=isSecondary?"metrics_secondary":"metrics";if(!metricIdx&&0!==metricIdx)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let metrics=experiment[metricsField],metric=metrics[metricIdx],insightType=getInsightType(metric),funnelStepsLength=metric?.funnels_query?.series?.length||0,onClose=()=>{restoreUnmodifiedExperiment(),isSecondary?closeSecondaryMetricModal():closePrimaryMetricModal()};return(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isSecondary?isSecondaryMetricModalOpen:isPrimaryMetricModalOpen,onClose:onClose,width:1e3,title:"Edit experiment metric",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center w-full",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",status:"danger",onClick:()=>{src.dn.open({title:"Delete this metric?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-secondary",children:"This action cannot be undone."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>{setExperiment({[metricsField]:metrics.filter((_,idx)=>idx!==metricIdx)}),updateExperimentMetrics(),isSecondary?closeSecondaryMetricModal():closePrimaryMetricModal()},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Delete"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-goal-form",type:"secondary",onClick:onClose,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{disabledReason:insightType===types.dw.FUNNELS&&funnelStepsLength<2&&"The experiment needs at least two funnel steps.",form:"edit-experiment-goal-form",onClick:()=>{updateExperimentMetrics(),isSecondary?closeSecondaryMetricModal():closePrimaryMetricModal()},type:"primary",loading:experimentLoading,"data-attr":"create-annotation-submit",children:"Save"})]})]}),children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center w-full gap-2 mb-4",children:[(0,jsx_runtime.jsx)("span",{children:"Metric type"}),(0,jsx_runtime.jsx)(src.Yv,{"data-attr":"metrics-selector",value:insightType,onChange:newInsightType=>{setExperiment({...experiment,[metricsField]:[...metrics.slice(0,metricIdx),newInsightType===types.dw.TRENDS?(0,experiments_utils.ug)():(0,experiments_utils.xs)(),...metrics.slice(metricIdx+1)]})},options:[{value:types.dw.TRENDS,label:(0,jsx_runtime.jsx)("b",{children:"Trends"})},{value:types.dw.FUNNELS,label:(0,jsx_runtime.jsx)("b",{children:"Funnels"})}]})]}),insightType===types.dw.TRENDS?(0,jsx_runtime.jsx)(TrendsMetricForm_TrendsMetricForm,{isSecondary:isSecondary}):(0,jsx_runtime.jsx)(FunnelsMetricForm,{isSecondary:isSecondary})]})}function MetricSourceModal(_ref){let{experimentId,isSecondary}=_ref,{experiment,isPrimaryMetricSourceModalOpen,isSecondaryMetricSourceModalOpen,shouldUseExperimentMetrics}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),{setExperiment,closePrimaryMetricSourceModal,closeSecondaryMetricSourceModal,openPrimaryMetricModal,openSecondaryMetricModal,openPrimarySharedMetricModal,openSecondarySharedMetricModal}=(0,index_esm.useActions)((0,experiments_experimentLogic.W)({experimentId})),metricsField=isSecondary?"metrics_secondary":"metrics",closeCurrentModal=isSecondary?closeSecondaryMetricSourceModal:closePrimaryMetricSourceModal,openMetricModal=isSecondary?openSecondaryMetricModal:openPrimaryMetricModal,openSharedMetricModal=isSecondary?openSecondarySharedMetricModal:openPrimarySharedMetricModal;return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isSecondary?isSecondaryMetricSourceModalOpen:isPrimaryMetricSourceModalOpen,onClose:closeCurrentModal,width:1e3,title:"Choose metric source",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1 cursor-pointer p-4 rounded border hover:border-accent",onClick:()=>{closeCurrentModal();let defaultMetric=shouldUseExperimentMetrics?(0,experiments_utils.US)():(0,experiments_utils.xs)(),newMetrics=[...experiment[metricsField],defaultMetric];setExperiment({[metricsField]:newMetrics}),openMetricModal(newMetrics.length-1)},children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:(0,jsx_runtime.jsx)("span",{children:"Single-use"})}),(0,jsx_runtime.jsx)("div",{className:"text-secondary text-sm leading-relaxed",children:"Create a new metric specific to this experiment."})]}),(0,jsx_runtime.jsxs)("div",{className:"flex-1 cursor-pointer p-4 rounded border hover:border-accent",onClick:()=>{closeCurrentModal(),openSharedMetricModal(null)},children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:(0,jsx_runtime.jsx)("span",{children:"Shared"})}),(0,jsx_runtime.jsx)("div",{className:"text-secondary text-sm leading-relaxed",children:"Use a pre-configured metric that can be reused across experiments."})]})]})})}var ObjectTags=__webpack_require__("../../frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),LemonTable=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTable/index.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),components=__webpack_require__("../../frontend/src/scenes/experiments/ExperimentView/components.tsx");function SharedMetricModal(_ref){let{experimentId,isSecondary}=_ref,{experiment,compatibleSharedMetrics,isPrimarySharedMetricModalOpen,isSecondarySharedMetricModalOpen,editingSharedMetricId,primaryMetricsLengthWithSharedMetrics,secondaryMetricsLengthWithSharedMetrics}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),{closePrimarySharedMetricModal,closeSecondarySharedMetricModal,addSharedMetricsToExperiment,removeSharedMetricFromExperiment,restoreUnmodifiedExperiment}=(0,index_esm.useActions)((0,experiments_experimentLogic.W)({experimentId})),[selectedMetricIds,setSelectedMetricIds]=(0,react.useState)([]),mode=editingSharedMetricId?"edit":"create",{hasAvailableFeature}=(0,index_esm.useValues)(userLogic.userLogic);if(!compatibleSharedMetrics)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let onClose=()=>{restoreUnmodifiedExperiment(),isSecondary?closeSecondarySharedMetricModal():closePrimarySharedMetricModal()},availableSharedMetrics=compatibleSharedMetrics.filter(metric=>!experiment.saved_metrics.some(savedMetric=>savedMetric.saved_metric===metric.id)),availableTags=Array.from(new Set(availableSharedMetrics.filter(metric=>metric.tags).flatMap(metric=>metric.tags).filter(Boolean))).sort();return(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isSecondary?isSecondarySharedMetricModalOpen:isPrimarySharedMetricModalOpen,onClose:onClose,width:500,title:"create"===mode?"Select one or more shared metrics":"Shared metric",footer:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between w-full",children:[(0,jsx_runtime.jsx)("div",{children:editingSharedMetricId&&(0,jsx_runtime.jsx)(src.Jp,{status:"danger",onClick:()=>{removeSharedMetricFromExperiment(editingSharedMetricId),isSecondary?closeSecondarySharedMetricModal():closePrimarySharedMetricModal()},type:"secondary",children:"Remove from experiment"})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:onClose,type:"secondary",children:"Cancel"}),"create"===mode&&(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{addSharedMetricsToExperiment(selectedMetricIds,{type:isSecondary?"secondary":"primary"}),isSecondary?closeSecondarySharedMetricModal():closePrimarySharedMetricModal()},type:"primary",disabledReason:0===selectedMetricIds.length?"Please select at least one metric":!isSecondary&&primaryMetricsLengthWithSharedMetrics+selectedMetricIds.length>10?"You can only add up to 10 primary metrics.":isSecondary&&secondaryMetricsLengthWithSharedMetrics+selectedMetricIds.length>10?"You can only add up to 10 secondary metrics.":void 0,children:selectedMetricIds.length<2?"Add metric":"Add metrics"})]})]}),children:["create"===mode&&(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:availableSharedMetrics.length>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[experiment.saved_metrics.length>0&&(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:`Hiding ${experiment.saved_metrics.length} shared ${experiment.saved_metrics.length>1?"metrics":"metric"} already in use with this experiment.`}),hasAvailableFeature(types.P$.TAGGING)&&availableTags.length>0&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Quick select:"}),availableTags.map((tag,index)=>(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",onClick:()=>{setSelectedMetricIds(availableSharedMetrics.filter(metric=>metric.tags?.includes(tag)).map(metric=>metric.id))},children:tag},index))]}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:availableSharedMetrics,columns:[{title:"",key:"checkbox",render:(_,metric)=>(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:selectedMetricIds.includes(metric.id),onChange:e=>{e.target.checked?setSelectedMetricIds([...selectedMetricIds,metric.id]):setSelectedMetricIds(selectedMetricIds.filter(id=>id!==metric.id))}})},{title:"Name",dataIndex:"name",key:"name"},{title:"Description",dataIndex:"description",key:"description"},...hasAvailableFeature(types.P$.TAGGING)?[{title:"Tags",dataIndex:"tags",key:"tags",render:(_,metric)=>(0,jsx_runtime.jsx)(ObjectTags.D,{tags:metric.tags||[],staticOnly:!0})}]:[],{title:"Type",key:"type",render:(_,metric)=>metric.query.kind===schema_general.OH.ExperimentMetric?metric.query.metric_type:metric.query.kind===schema_general.OH.ExperimentTrendsQuery?"Trend":"Funnel"}],footer:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center m-2",children:(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.experimentsSharedMetrics(),size:"xsmall",type:"tertiary",children:"See all shared metrics"})})})]}):(0,jsx_runtime.jsx)(src.Vp,{className:"w-full",type:"info",action:{children:"New shared metric",to:urls.j.experimentsSharedMetric("new")},children:compatibleSharedMetrics.length>0?"All of your shared metrics are already in this experiment.":"You don't have any shared metrics that match the experiment type. Shared metrics let you create reusable metrics that you can quickly add to any experiment."})}),editingSharedMetricId&&(0,jsx_runtime.jsx)("div",{children:(()=>{let metric=compatibleSharedMetrics.find(m=>m.id===editingSharedMetricId);return metric?(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold m-0 flex items-center",children:metric.name}),(0,jsx_runtime.jsx)(src.rU,{target:"_blank",className:"font-semibold flex items-center",to:urls.j.experimentsSharedMetric(metric.id),children:(0,jsx_runtime.jsx)(icons.pF,{fontSize:"18"})})]}),metric.description&&(0,jsx_runtime.jsx)("p",{className:"mt-2",children:metric.description}),"ExperimentTrendsQuery"===metric.query.kind&&(0,jsx_runtime.jsx)(components.EV,{query:metric.query.count_query}),"ExperimentFunnelsQuery"===metric.query.kind&&(0,jsx_runtime.jsx)(components.AG,{query:metric.query.funnels_query})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})})()})]})}var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),LemonProgress=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonProgress/index.tsx"),themeLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts");function WinningVariantText(_ref){let{result,experimentId}=_ref,{getIndexForVariant,getHighestProbabilityVariant}=(0,index_esm.useValues)(experiments_experimentLogic.W),highestProbabilityVariant=getHighestProbabilityVariant(result),index=getIndexForVariant(result,highestProbabilityVariant||"");if(highestProbabilityVariant&&null!==index&&result){let{probability}=result;return(0,jsx_runtime.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:highestProbabilityVariant}),(0,jsx_runtime.jsx)("span",{children:" is winning with a "}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold items-center",children:[`${(100*probability[highestProbabilityVariant]).toFixed(2)}% probability`," "]}),(0,jsx_runtime.jsx)("span",{children:"of being best. "})]})}return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}function SignificanceText(_ref2){let{metricIndex,isSecondary=!1}=_ref2,{isPrimaryMetricSignificant,isSecondaryMetricSignificant}=(0,index_esm.useValues)(experiments_experimentLogic.W);return(0,jsx_runtime.jsxs)("div",{className:"flex-wrap",children:[(0,jsx_runtime.jsx)("span",{children:"Your results are "}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold",children:[`${isSecondary?isSecondaryMetricSignificant(metricIndex):isPrimaryMetricSignificant(metricIndex)?"significant":"not significant"}`,"."]})]})}function Overview(_ref3){let{metricIndex=0}=_ref3,{experimentId,metricResults}=(0,index_esm.useValues)(experiments_experimentLogic.W),result=metricResults?.[metricIndex];return result?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,jsx_runtime.jsx)(WinningVariantText,{result:result,experimentId:experimentId}),(0,jsx_runtime.jsx)(SignificanceText,{metricIndex:metricIndex})]})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}var SummaryTable=__webpack_require__("../../frontend/src/scenes/experiments/ExperimentView/SummaryTable.tsx"),LemonTag=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTag/index.ts");let getMetricTag=metric=>metric.kind===schema_general.OH.ExperimentMetric?metric.metric_type.charAt(0).toUpperCase()+metric.metric_type.slice(1).toLowerCase():metric.kind===schema_general.OH.ExperimentFunnelsQuery?"Funnel":"Trend",getDefaultName=source=>{switch(source.kind){case schema_general.OH.EventsNode:return source.name||source.event;case schema_general.OH.ActionsNode:return source.name||`Action ${source.id}`;case schema_general.OH.ExperimentDataWarehouseNode:return source.table_name}},getDefaultMetricTitle=metric=>{switch(metric.metric_type){case schema_general.Tu.MEAN:return getDefaultName(metric.source)||"Untitled metric";case schema_general.Tu.FUNNEL:return getDefaultName(metric.series[0])||"Untitled funnel"}},MetricTitle=_ref=>{let{metric,metricType}=_ref;if(metric.name)return(0,jsx_runtime.jsx)("span",{className:"truncate",children:metric.name});if(metric.kind===schema_general.OH.ExperimentMetric)return(0,jsx_runtime.jsx)("span",{className:"truncate",children:getDefaultMetricTitle(metric)});if(metricType===types.dw.TRENDS&&metric.count_query?.series?.[0]?.name)return(0,jsx_runtime.jsx)("span",{className:"truncate",children:metric.count_query.series[0].name});if(metricType===types.dw.FUNNELS&&metric.funnels_query?.series){let series=metric.funnels_query.series;if(series.length>0){let firstStep=series[0]?.name,lastStep=series[series.length-1]?.name;return(0,jsx_runtime.jsxs)("div",{className:"inline-flex flex-wrap items-center gap-1 min-w-0",children:[(0,jsx_runtime.jsxs)("div",{className:"inline-flex items-center gap-1 min-w-0",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconFunnels,{className:"text-secondary flex-shrink-0",fontSize:"14"}),(0,jsx_runtime.jsx)("span",{className:"truncate",children:firstStep})]}),(0,jsx_runtime.jsxs)("div",{className:"inline-flex items-center gap-1 min-w-0 @max-[200px]:ml-5",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowRight,{className:"text-secondary flex-shrink-0",fontSize:"14"}),(0,jsx_runtime.jsx)("span",{className:"truncate",children:lastStep})]})]})}}return(0,jsx_runtime.jsx)("span",{className:"text-secondary truncate",children:"Untitled metric"})},MetricHeader=_ref=>{let{metricIndex,metric,metricType,isPrimaryMetric}=_ref,{openPrimaryMetricModal,openSecondaryMetricModal,openPrimarySharedMetricModal,openSecondarySharedMetricModal}=(0,index_esm.useActions)(experiments_experimentLogic.W);return(0,jsx_runtime.jsx)("div",{className:"text-xs font-semibold whitespace-nowrap overflow-hidden",children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"@container cursor-default text-xs font-semibold whitespace-nowrap overflow-hidden text-ellipsis flex-grow flex items-start",children:[(0,jsx_runtime.jsxs)("span",{className:"mr-1",children:[metricIndex+1,"."]}),(0,jsx_runtime.jsx)(MetricTitle,{metric:metric,metricType:metricType})]}),(0,jsx_runtime.jsx)(LemonButton.J,{className:"flex-shrink-0",type:"secondary",size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{fontSize:"12"}),onClick:()=>{(isPrimaryMetric?metric.isSharedMetric?openPrimarySharedMetricModal:openPrimaryMetricModal:metric.isSharedMetric?openSecondarySharedMetricModal:openSecondaryMetricModal)(metric.isSharedMetric?metric.sharedMetricId:metricIndex)}})]}),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-x-1",children:[(0,jsx_runtime.jsx)(LemonTag.o,{type:"muted",size:"small",children:getMetricTag(metric)}),metric.isSharedMetric&&(0,jsx_runtime.jsx)(LemonTag.o,{type:"option",size:"small",children:"Shared"})]})]})})};var lib_utils=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/utils.js");let ResultErrorCode=function(ResultErrorCode){return ResultErrorCode.NO_CONTROL_VARIANT="no-control-variant",ResultErrorCode.NO_TEST_VARIANT="no-test-variant",ResultErrorCode.NO_EXPOSURES="no-exposures",ResultErrorCode}({});function NoResultEmptyState(_ref){let{error,metric}=_ref,{experiment,variants,getInsightType}=(0,index_esm.useValues)(experiments_experimentLogic.W);if(!error)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let{statusCode,hasDiagnostics}=error;function ChecklistItem(_ref2){let{errorCode,value}=_ref2,failureText={[ResultErrorCode.NO_CONTROL_VARIANT]:"Events with the control variant not received",[ResultErrorCode.NO_TEST_VARIANT]:"Events with at least one test variant not received",[ResultErrorCode.NO_EXPOSURES]:"Exposure events not received"},successText={[ResultErrorCode.NO_CONTROL_VARIANT]:"Events with the control variant received",[ResultErrorCode.NO_TEST_VARIANT]:"Events with at least one test variant received",[ResultErrorCode.NO_EXPOSURES]:"Exposure events have been received"},insightType=getInsightType(metric),hasMissingExposure=errorCode===ResultErrorCode.NO_EXPOSURES,requiredEvent=insightType===types.dw.TRENDS?hasMissingExposure?metric.exposure_query?.series[0]?.event||"$feature_flag_called":metric.count_query?.series[0]?.event:metric.funnels_query?.series[0]?.event,query={kind:schema_general.OH.DataTableNode,full:!0,source:{kind:schema_general.OH.EventsQuery,select:["*","event",`properties."$feature/${experiment.feature_flag?.key}"`,"timestamp"],orderBy:["timestamp DESC"],after:experiment.start_date,event:requiredEvent,properties:[{key:`$feature/${experiment.feature_flag?.key}`,value:hasMissingExposure?variants.map(variant=>variant.key):errorCode===ResultErrorCode.NO_CONTROL_VARIANT?["control"]:variants.slice(1).map(variant=>variant.key),operator:"exact",type:"event"},...hasMissingExposure?[{key:"$feature_flag",value:[experiment.feature_flag?.key],operator:"exact",type:"event"}]:[]],filterTestAccounts:metric.count_query?.filter_test_accounts},propertiesViaUrl:!0,showPersistentColumnConfigurator:!0};return(0,jsx_runtime.jsx)("div",{className:"flex items-center deprecated-space-x-2",children:!1===value?(0,jsx_runtime.jsxs)("span",{className:"flex items-center deprecated-space-x-2",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{className:"text-success",fontSize:16}),(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:successText[errorCode]})]}):(0,jsx_runtime.jsxs)("span",{className:"flex items-center deprecated-space-x-2",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{className:"text-danger",fontSize:16}),(0,jsx_runtime.jsx)("span",{children:failureText[errorCode]}),(0,jsx_runtime.jsx)(src.u,{title:"Verify missing events in the Activity tab",children:(0,jsx_runtime.jsx)(src.rU,{target:"_blank",className:"font-semibold",to:(0,lib_utils.combineUrl)(urls.j.activity(types.ZO.ExploreEvents),{},{q:query}).url,children:(0,jsx_runtime.jsx)(icons.pF,{fontSize:"16",className:"-ml-1"})})})]})})}if(hasDiagnostics){let checklistItems=[];for(let[errorCode,value]of Object.entries(error.detail))Object.values(ResultErrorCode).includes(errorCode)&&checklistItems.push((0,jsx_runtime.jsx)(ChecklistItem,{errorCode:errorCode,value:value},errorCode));return(0,jsx_runtime.jsx)("div",{children:checklistItems})}return 504===statusCode?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold leading-tight",children:"Experiment results timed out"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-center text-balance",children:"This may occur when the experiment has a large amount of data or is particularly complex. We are actively working on fixing this. In the meantime, please try refreshing the experiment to retrieve the results."})]}):(0,jsx_runtime.jsx)("div",{children:error.detail})}function formatTickValue(value){if(0===value)return"0%";let absValue=Math.abs(value),decimals=0;return decimals=absValue<.01?3:absValue<.1?2:+(absValue<1),`${(100*value).toFixed(decimals)}%`}function generateViolinPath(x1,x2,y,height,deltaX){let points=[],maxWidth=height/2;for(let i=0;i<=20;i++){let t=i/20,x=x1+(deltaX-x1)*t,z=(t-1)*2,width=Math.exp(-.5*z*z)*maxWidth;points.push([x,y+height/2-width])}for(let i=0;i<=20;i++){let t=i/20,x=deltaX+(x2-deltaX)*t,z=2*t,width=Math.exp(-.5*z*z)*maxWidth;points.push([x,y+height/2-width])}for(let i=20;i>=0;i--){let t=i/20,x=deltaX+(x2-deltaX)*t,z=2*t,width=Math.exp(-.5*z*z)*maxWidth;points.push([x,y+height/2+width])}for(let i=20;i>=0;i--){let t=i/20,x=x1+(deltaX-x1)*t,z=(t-1)*2,width=Math.exp(-.5*z*z)*maxWidth;points.push([x,y+height/2+width])}return`
        M ${points[0][0]} ${points[0][1]}
        ${points.map(point=>`L ${point[0]} ${point[1]}`).join(" ")}
        Z
    `}function DeltaChart(_ref){let{isSecondary,result,error,variants,metricType,metricIndex,isFirstMetric,metric,tickValues,chartBound}=_ref,{credibleIntervalForVariant,conversionRateForVariant,experimentId,experiment,countDataForVariant,exposureCountDataForVariant,metricResultsLoading,secondaryMetricResultsLoading,featureFlags,primaryMetricsLengthWithSharedMetrics,hasMinimumExposureForResults}=(0,index_esm.useValues)(experiments_experimentLogic.W),{openVariantDeltaTimeseriesModal}=(0,index_esm.useActions)(experiments_experimentLogic.W),[tooltipData,setTooltipData]=(0,react.useState)(null),[emptyStateTooltipVisible,setEmptyStateTooltipVisible]=(0,react.useState)(!0),[tooltipPosition,setTooltipPosition]=(0,react.useState)({x:0,y:0}),[isModalOpen,setIsModalOpen]=(0,react.useState)(!1),getScaleAddition=variantCount=>variantCount<3?6:variantCount<4?3:+(variantCount<5),resultsLoading=isSecondary?secondaryMetricResultsLoading:metricResultsLoading,BAR_HEIGHT=10+getScaleAddition(variants.length),BAR_PADDING=10+getScaleAddition(variants.length),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),COLORS={TICK_TEXT_COLOR:"var(--text-tertiary)",BOUNDARY_LINES:"var(--border-primary)",ZERO_LINE:"var(--border-bold)",BAR_NEGATIVE:isDarkModeOn?"#c32f45":"#f84257",BAR_POSITIVE:isDarkModeOn?"#12a461":"#36cd6f",BAR_CONTROL:isDarkModeOn?"rgba(217, 217, 217, 0.2)":"rgba(217, 217, 217, 0.4)",BAR_MIDDLE_POINT:"black",BAR_MIDDLE_POINT_CONTROL:"rgba(0, 0, 0, 0.4)"},chartHeight=BAR_PADDING+(BAR_HEIGHT+BAR_PADDING)*variants.length,valueToX=value=>20+(value/chartBound+1)/2*760,ticksSvgRef=(0,react.useRef)(null),chartSvgRef=(0,react.useRef)(null),[ticksSvgHeight,setTicksSvgHeight]=(0,react.useState)(0),[chartSvgHeight,setChartSvgHeight]=(0,react.useState)(0);return(0,react.useEffect)(()=>{let ticksSvg=ticksSvgRef.current,chartSvg=chartSvgRef.current,resizeObserver=new ResizeObserver(entries=>{for(let entry of entries)entry.target===ticksSvg?setTicksSvgHeight(entry.contentRect.height):entry.target===chartSvg&&setChartSvgHeight(entry.contentRect.height)});return ticksSvg&&resizeObserver.observe(ticksSvg),chartSvg&&resizeObserver.observe(chartSvg),()=>{resizeObserver.disconnect()}},[result]),(0,jsx_runtime.jsxs)("div",{className:"rounded bg-[var(--bg-table)]",children:[(0,jsx_runtime.jsxs)("div",{style:{width:"20%",verticalAlign:"top",display:"inline-block"},children:[isFirstMetric&&(0,jsx_runtime.jsx)("svg",{style:{height:`${ticksSvgHeight}px`}}),isFirstMetric&&(0,jsx_runtime.jsx)("div",{className:"w-full border-t border-primary"}),(0,jsx_runtime.jsx)("div",{style:{height:`${chartSvgHeight}px`,borderRight:`1px solid ${COLORS.BOUNDARY_LINES}`},className:"p-2 overflow-auto",children:(0,jsx_runtime.jsx)(MetricHeader,{metricIndex:metricIndex,metric:metric,metricType:metricType,isPrimaryMetric:!isSecondary})})]}),(0,jsx_runtime.jsxs)("div",{style:{width:"calc(100% - 20%)",verticalAlign:"top",display:"inline-block",minWidth:"780px"},children:[isFirstMetric&&(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsx)("svg",{ref:ticksSvgRef,viewBox:"0 0 800 20",preserveAspectRatio:"xMidYMid meet",className:result?"ml-12":void 0,style:{minHeight:"20px",maxWidth:"1000px"},children:tickValues.map((value,index)=>{let x=valueToX(value);return(0,jsx_runtime.jsx)("g",{children:(0,jsx_runtime.jsx)("text",{x:x,y:10,textAnchor:"middle",dominantBaseline:"middle",fontSize:9,fill:COLORS.TICK_TEXT_COLOR,fontWeight:"600",children:formatTickValue(value)})},index)})})}),isFirstMetric&&(0,jsx_runtime.jsx)("div",{className:"w-full border-t border-primary"}),result&&hasMinimumExposureForResults?(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsx)("div",{className:"absolute top-2 left-2",style:{zIndex:102},children:(0,jsx_runtime.jsx)(SignificanceHighlight,{metricIndex:metricIndex,isSecondary:isSecondary})}),(isSecondary||!isSecondary&&primaryMetricsLengthWithSharedMetrics>1)&&(0,jsx_runtime.jsx)("div",{className:"absolute bottom-2 left-2 flex justify-center bg-[var(--bg-table)]",style:{zIndex:101},children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGraph,{}),onClick:()=>setIsModalOpen(!0),children:"Details"})}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsxs)("svg",{ref:chartSvgRef,viewBox:`0 0 800 ${chartHeight}`,preserveAspectRatio:"xMidYMid meet",className:"ml-12",style:{minHeight:`${chartHeight}px`,maxWidth:"1000px"},children:[tickValues.map((value,index)=>{let x=valueToX(value);return(0,jsx_runtime.jsx)("line",{x1:x,y1:0,x2:x,y2:chartSvgHeight+20,stroke:0===value?COLORS.ZERO_LINE:COLORS.BOUNDARY_LINES,strokeWidth:0===value?1:.5},index)}),variants.map((variant,index)=>{let delta;let interval=credibleIntervalForVariant(result,variant.key,metricType),[lower,upper]=interval?[interval[0]/100,interval[1]/100]:[0,0];if(metricType===types.dw.TRENDS){let controlVariant=result.variants.find(v=>"control"===v.key),variantData=result.variants.find(v=>v.key===variant.key);if(variantData?.count&&variantData?.absolute_exposure&&controlVariant?.count&&controlVariant?.absolute_exposure){let controlMean=controlVariant.count/controlVariant.absolute_exposure;delta=(variantData.count/variantData.absolute_exposure-controlMean)/controlMean}else delta=0}else{let variantRate=conversionRateForVariant(result,variant.key),controlRate=conversionRateForVariant(result,"control");delta=variantRate&&controlRate?(variantRate-controlRate)/controlRate:0}let y=BAR_PADDING+(BAR_HEIGHT+BAR_PADDING)*index,x1=valueToX(lower),x2=valueToX(upper),deltaX=valueToX(delta);return(0,jsx_runtime.jsxs)("g",{onMouseEnter:e=>{let rect=e.currentTarget.getBoundingClientRect();setTooltipData({x:rect.left+rect.width/2,y:rect.top-10,variant:variant.key})},onMouseLeave:()=>setTooltipData(null),onClick:()=>{featureFlags[constants.y8.EXPERIMENT_INTERVAL_TIMESERIES]&&openVariantDeltaTimeseriesModal()},className:featureFlags[constants.y8.EXPERIMENT_INTERVAL_TIMESERIES]?"cursor-pointer":"",children:[(0,jsx_runtime.jsx)("foreignObject",{x:x1-8,y:y+BAR_HEIGHT/2-10,width:"90",height:"16",transform:"translate(-90, 0)",children:(0,jsx_runtime.jsx)(components.Aw,{className:"justify-end mt-0.5",experimentId:experimentId,variantKey:variant.key,fontSize:10,muted:!0})}),"control"===variant.key?(0,jsx_runtime.jsx)("path",{d:generateViolinPath(x1,x2,y,BAR_HEIGHT,deltaX),fill:COLORS.BAR_CONTROL,stroke:COLORS.BOUNDARY_LINES,strokeWidth:1,strokeDasharray:"2,2"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("defs",{children:(0,jsx_runtime.jsx)("linearGradient",{id:`gradient-${metricIndex}-${variant.key}-${isSecondary?"secondary":"primary"}`,x1:"0",x2:"1",y1:"0",y2:"0",children:lower<0&&upper>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("stop",{offset:"0%",stopColor:COLORS.BAR_NEGATIVE}),(0,jsx_runtime.jsx)("stop",{offset:`${-lower/(upper-lower)*100}%`,stopColor:COLORS.BAR_NEGATIVE}),(0,jsx_runtime.jsx)("stop",{offset:`${-lower/(upper-lower)*100}%`,stopColor:COLORS.BAR_POSITIVE}),(0,jsx_runtime.jsx)("stop",{offset:"100%",stopColor:COLORS.BAR_POSITIVE})]}):(0,jsx_runtime.jsx)("stop",{offset:"100%",stopColor:upper<=0?COLORS.BAR_NEGATIVE:COLORS.BAR_POSITIVE})})}),(0,jsx_runtime.jsx)("path",{d:generateViolinPath(x1,x2,y,BAR_HEIGHT,deltaX),fill:`url(#gradient-${metricIndex}-${variant.key}-${isSecondary?"secondary":"primary"})`})]}),(0,jsx_runtime.jsx)("g",{transform:`translate(${deltaX}, 0)`,children:(0,jsx_runtime.jsx)("line",{x1:0,y1:y,x2:0,y2:y+BAR_HEIGHT,stroke:"control"===variant.key?COLORS.BAR_MIDDLE_POINT_CONTROL:COLORS.BAR_MIDDLE_POINT,strokeWidth:2,vectorEffect:"non-scaling-stroke",shapeRendering:"crispEdges"})})]},variant.key)})]})})]}):resultsLoading?(0,jsx_runtime.jsx)("svg",{ref:chartSvgRef,viewBox:`0 0 800 ${chartHeight}`,preserveAspectRatio:"xMidYMid meet",children:(0,jsx_runtime.jsx)("foreignObject",{x:300,y:chartHeight/2-10,width:"200",height:"20",children:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center text-secondary cursor-default",style:{fontSize:"10px",fontWeight:400},children:(0,jsx_runtime.jsx)("span",{children:"Results loading…"})})})}):(0,jsx_runtime.jsx)("svg",{ref:chartSvgRef,viewBox:`0 0 800 ${chartHeight}`,preserveAspectRatio:"xMidYMid meet",children:experiment.start_date?hasMinimumExposureForResults?(0,jsx_runtime.jsx)("foreignObject",{x:0,y:chartHeight/2-10,width:800,height:"20",onMouseEnter:e=>{let rect=e.currentTarget.getBoundingClientRect();setTooltipPosition({x:rect.left+rect.width/2,y:rect.top}),setEmptyStateTooltipVisible(!0)},onMouseLeave:()=>setEmptyStateTooltipVisible(!1),children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center ml-2 xl:ml-0 xl:justify-center text-secondary cursor-default",style:{fontSize:"10px",fontWeight:400},children:[error?.hasDiagnostics?(0,jsx_runtime.jsxs)(src.oe,{size:"small",type:"highlight",className:"mr-2",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconActivity,{className:"mr-1",fontSize:"1em"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{try{return Object.values(error.detail).filter(v=>!1===v).length}catch{return"0"}})()}),"/",(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:metricType===types.dw.TRENDS?"3":"2"})]}):(0,jsx_runtime.jsx)(src.oe,{size:"small",type:"danger",className:"mr-1",children:"Error"}),(0,jsx_runtime.jsx)("span",{children:"Results not yet available"})]})}):(0,jsx_runtime.jsx)("foreignObject",{x:"0",y:chartHeight/2-10,width:800,height:"20",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center ml-2 xl:ml-0 xl:justify-center text-secondary cursor-default",style:{fontSize:"10px",fontWeight:400},children:[(0,jsx_runtime.jsx)(src.oe,{size:"small",className:"mr-2",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconActivity,{fontSize:"1em"})}),(0,jsx_runtime.jsxs)("span",{children:["Waiting for ",experiments_constants.Kn,"+ exposures per variant to show results"]})]})}):(0,jsx_runtime.jsx)("foreignObject",{x:"0",y:chartHeight/2-10,width:800,height:"20",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center ml-2 xl:ml-0 xl:justify-center text-secondary cursor-default",style:{fontSize:"10px",fontWeight:400},children:[(0,jsx_runtime.jsx)(src.oe,{size:"small",className:"mr-2",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconClock,{fontSize:"1em"})}),(0,jsx_runtime.jsx)("span",{children:"Waiting for experiment to start…"})]})})}),tooltipData&&(0,jsx_runtime.jsx)("div",{style:{position:"fixed",left:tooltipData.x,top:tooltipData.y,transform:"translate(-50%, -100%)",backgroundColor:"var(--bg-surface-primary)",border:"1px solid var(--border-primary)",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",pointerEvents:"none",zIndex:100,minWidth:"300px"},children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:tooltipData.variant}),(0,jsx_runtime.jsxs)("div",{className:"inline-flex",children:[(0,jsx_runtime.jsx)("span",{className:"text-secondary font-semibold mb-1",children:"Win probability:"}),result?.probability?.[tooltipData.variant]!==void 0?(0,jsx_runtime.jsxs)("span",{className:"flex items-center justify-between flex-1 pl-6",children:[(0,jsx_runtime.jsx)(LemonProgress.b,{className:"w-3/4 mr-4",percent:100*result.probability[tooltipData.variant]}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold",children:[(100*result.probability[tooltipData.variant]).toFixed(2),"%"]})]}):"—"]}),metricType===types.dw.TRENDS?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsxs)("span",{className:"text-secondary font-semibold",children:[metricType===types.dw.TRENDS&&result.exposure_query?.series?.[0]?.math?"Total":"Count",":"]}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{let count=countDataForVariant(result,tooltipData.variant);return null!==count?(0,utils.Lc)(count):"—"})()})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-secondary font-semibold",children:"Exposure:"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{let exposure=exposureCountDataForVariant(result,tooltipData.variant);return null!==exposure?(0,utils.Lc)(exposure):"—"})()})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-secondary font-semibold",children:"Mean:"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{let variant=result.variants.find(v=>v.key===tooltipData.variant);return variant?.count&&variant?.absolute_exposure?(variant.count/variant.absolute_exposure).toFixed(2):"—"})()})]})]}):(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-secondary font-semibold",children:"Conversion rate:"}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold",children:[conversionRateForVariant(result,tooltipData.variant)?.toFixed(2),"%"]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-secondary font-semibold",children:"Delta:"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"control"===tooltipData.variant?(0,jsx_runtime.jsx)("em",{className:"text-secondary",children:"Baseline"}):(()=>{if(metricType===types.dw.TRENDS){let controlVariant=result.variants.find(v=>"control"===v.key),variant=result.variants.find(v=>v.key===tooltipData.variant);if(!variant?.count||!variant?.absolute_exposure||!controlVariant?.count||!controlVariant?.absolute_exposure)return"—";let controlMean=controlVariant.count/controlVariant.absolute_exposure,delta=(variant.count/variant.absolute_exposure-controlMean)/controlMean;return delta?(0,jsx_runtime.jsx)("span",{className:delta>0?"text-success":"text-danger",children:`${delta>0?"+":""}${(100*delta).toFixed(2)}%`}):"—"}let variantRate=conversionRateForVariant(result,tooltipData.variant),controlRate=conversionRateForVariant(result,"control"),delta=variantRate&&controlRate?(variantRate-controlRate)/controlRate:0;return delta?(0,jsx_runtime.jsx)("span",{className:delta>0?"text-success":"text-danger",children:`${delta>0?"+":""}${(100*delta).toFixed(2)}%`}):"—"})()})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-secondary font-semibold",children:"Credible interval:"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{let interval=credibleIntervalForVariant(result,tooltipData.variant,metricType),[lower,upper]=interval?[interval[0]/100,interval[1]/100]:[0,0];return`[${lower>0?"+":""}${(100*lower).toFixed(2)}%, ${upper>0?"+":""}${(100*upper).toFixed(2)}%]`})()})]})]})}),emptyStateTooltipVisible&&(0,jsx_runtime.jsx)("div",{style:{position:"fixed",left:tooltipPosition.x,top:tooltipPosition.y,transform:"translate(-50%, -100%)",backgroundColor:"var(--bg-surface-primary)",border:"1px solid var(--border-primary)",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",zIndex:100,minWidth:"200px"},onMouseEnter:()=>setEmptyStateTooltipVisible(!0),onMouseLeave:()=>setEmptyStateTooltipVisible(!1),children:(0,jsx_runtime.jsx)(NoResultEmptyState,{error:error,metric:metric})})]}),(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isModalOpen,onClose:()=>setIsModalOpen(!1),width:1200,title:`Metric results: ${metric.name||"Untitled metric"}`,footer:(0,jsx_runtime.jsx)(src.Jp,{form:"secondary-metric-modal-form",type:"secondary",onClick:()=>setIsModalOpen(!1),children:"Close"}),children:[result&&(result.kind===schema_general.OH.ExperimentTrendsQuery||result.kind===schema_general.OH.ExperimentFunnelsQuery)&&(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(components.lM,{result:result})}),(0,jsx_runtime.jsx)(src.Vp,{type:result?.significant?"success":"info",className:"mb-4",children:(0,jsx_runtime.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,jsx_runtime.jsx)(WinningVariantText,{result:result,experimentId:experimentId}),(0,jsx_runtime.jsx)(SignificanceText,{metricIndex:metricIndex})]})}),(0,jsx_runtime.jsx)(SummaryTable.H,{metric:metric,metricIndex:metricIndex,isSecondary:isSecondary}),result&&(result.kind===schema_general.OH.ExperimentTrendsQuery||result.kind===schema_general.OH.ExperimentFunnelsQuery)&&(0,jsx_runtime.jsx)(components.MN,{result:result,showTable:!0})]})]})}function SignificanceHighlight(_ref2){let{metricIndex=0,isSecondary=!1,className=""}=_ref2,{isPrimaryMetricSignificant,isSecondaryMetricSignificant,significanceDetails}=(0,index_esm.useValues)(experiments_experimentLogic.W),isSignificant=isSecondary?isSecondaryMetricSignificant(metricIndex):isPrimaryMetricSignificant(metricIndex),result=isSignificant?{color:"success",label:"Significant"}:{color:"primary",label:"Not significant"},inner=isSignificant?(0,jsx_runtime.jsxs)("div",{className:"bg-success-highlight text-success-light px-1.5 py-0.5 flex items-center gap-1 rounded border border-success-light",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconTrending,{fontSize:20,fontWeight:600}),(0,jsx_runtime.jsx)("span",{className:"text-xs font-semibold",children:result.label})]}):(0,jsx_runtime.jsxs)("div",{className:"bg-warning-highlight text-warning-dark px-1.5 py-0.5 flex items-center gap-1 rounded border border-warning",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconMinus,{fontSize:20,fontWeight:600}),(0,jsx_runtime.jsx)("span",{className:"text-xs font-semibold",children:result.label})]}),details=significanceDetails(metricIndex);return details?(0,jsx_runtime.jsx)(src.u,{title:details,children:(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)({"cursor-default":!0,"bg-[var(--bg-table)]":!0,[className]:!0}),children:inner})}):(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)({"bg-[var(--bg-table)]":!0,[className]:!0}),children:inner})}function getNiceTickValues(maxAbsValue){let baseUnit;let magnitude=Math.floor(Math.log10(maxAbsValue=Math.ceil(10*maxAbsValue)/10)),power=Math.pow(10,magnitude),normalizedMax=maxAbsValue/power,unitsNeeded=Math.ceil(maxAbsValue/(baseUnit=normalizedMax<=1?.2*power:normalizedMax<=2?.5*power:normalizedMax<=5?+power:2*power)),decimalPlaces=Math.max(0,-magnitude+1),ticks=[];for(let i=-unitsNeeded;i<=unitsNeeded;i++){let tickValue=Number((baseUnit*i).toFixed(decimalPlaces));ticks.push(tickValue)}return ticks}function AddPrimaryMetric(){let{primaryMetricsLengthWithSharedMetrics}=(0,index_esm.useValues)(experiments_experimentLogic.W),{openPrimaryMetricSourceModal}=(0,index_esm.useActions)(experiments_experimentLogic.W);return(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),type:"secondary",size:"xsmall",onClick:()=>{openPrimaryMetricSourceModal()},disabledReason:primaryMetricsLengthWithSharedMetrics>=10?"You can only add up to 10 primary metrics.":void 0,children:"Add primary metric"})}function AddSecondaryMetric(){let{secondaryMetricsLengthWithSharedMetrics}=(0,index_esm.useValues)(experiments_experimentLogic.W),{openSecondaryMetricSourceModal}=(0,index_esm.useActions)(experiments_experimentLogic.W);return(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),type:"secondary",size:"xsmall",onClick:()=>{openSecondaryMetricSourceModal()},disabledReason:secondaryMetricsLengthWithSharedMetrics>=10?"You can only add up to 10 secondary metrics.":void 0,children:"Add secondary metric"})}function MetricsView(_ref){let{isSecondary}=_ref,{experiment,getInsightType,metricResults,secondaryMetricResults,primaryMetricsResultErrors,secondaryMetricsResultErrors,credibleIntervalForVariant}=(0,index_esm.useValues)(experiments_experimentLogic.W),variants=experiment?.feature_flag?.filters?.multivariate?.variants;if(!variants)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let results=isSecondary?secondaryMetricResults:metricResults,errors=isSecondary?secondaryMetricsResultErrors:primaryMetricsResultErrors,hasSomeResults=results?.some(result=>result?.insight),metrics=isSecondary?experiment.metrics_secondary:experiment.metrics,sharedMetrics=experiment.saved_metrics.filter(sharedMetric=>sharedMetric.metadata.type===(isSecondary?"secondary":"primary")).map(sharedMetric=>({...sharedMetric.query,name:sharedMetric.name,sharedMetricId:sharedMetric.saved_metric,isSharedMetric:!0}));sharedMetrics&&(metrics=[...metrics,...sharedMetrics]);let maxAbsValue=Math.max(...metrics.flatMap((metric,metricIndex)=>{let result=results?.[metricIndex];return result?variants.flatMap(variant=>{let insightType=getInsightType(metric),interval=credibleIntervalForVariant(result,variant.key,insightType);return interval?[Math.abs(interval[0]/100),Math.abs(interval[1]/100)]:[]}):[]})),padding=Math.max(.05*maxAbsValue,.1),chartBound=maxAbsValue+padding,commonTickValues=getNiceTickValues(chartBound);return(0,jsx_runtime.jsxs)("div",{className:"mb-4 -mt-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2 pt-5",children:(0,jsx_runtime.jsxs)("div",{className:"inline-flex items-center deprecated-space-x-2 mb-0",children:[(0,jsx_runtime.jsx)("h2",{className:"mb-0 font-semibold text-lg leading-6",children:isSecondary?"Secondary metrics":"Primary metrics"}),metrics.length>0&&(0,jsx_runtime.jsx)(src.u,{title:isSecondary?"Secondary metrics capture additional outcomes or behaviors affected by your experiment. They help you understand broader impacts and potential side effects beyond the primary goal.":"Primary metrics represent the main goal of your experiment. They directly measure whether your hypothesis was successful and are the key factor in deciding if the test achieved its primary objective.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary text-lg"})}),hasSomeResults&&!isSecondary&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.p2,{vertical:!0,className:"mx-2"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{className:"p-2",children:[(0,jsx_runtime.jsxs)("p",{className:"mb-4",children:["Each bar shows how a variant is performing compared to the control (the gray bar) for this metric, using a"," ",(0,jsx_runtime.jsx)("strong",{children:"95% credible interval."}),' That means there\'s a 95% chance the true difference for that variant falls within this range. The vertical "0%" line is your baseline:']}),(0,jsx_runtime.jsxs)("ul",{className:"mb-4 list-disc pl-4",children:[(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"To the right (green):"})," The metric is higher (an improvement)."]}),(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"To the left (red):"})," The metric is lower (a decrease)."]})]}),(0,jsx_runtime.jsx)("p",{className:"mb-4",children:"The shape of each bar represents the probability distribution. The true value is more likely to be near the center (where the bar is wider) than at the edges (where it tapers off)."}),(0,jsx_runtime.jsx)("p",{className:"mb-4",children:"The control (baseline) is always shown in gray. Other bars will be green or red—or even a mix—depending on whether the change is positive or negative."}),(0,jsx_runtime.jsx)("img",{src:"https://res.cloudinary.com/dmukukwp6/image/upload/violin_plot_screenshot_acca775d36.png",width:700,className:"rounded border object-contain",alt:"How to read metrics"})]}),children:(0,jsx_runtime.jsx)("span",{className:"text-xs text-secondary cursor-help",children:"How to read"})})]})]})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,jsx_runtime.jsx)("div",{className:"ml-auto",children:metrics.length>0&&(0,jsx_runtime.jsx)("div",{className:"mb-2 mt-4 justify-end",children:isSecondary?(0,jsx_runtime.jsx)(AddSecondaryMetric,{}):(0,jsx_runtime.jsx)(AddPrimaryMetric,{})})})})]}),metrics.length>0?(0,jsx_runtime.jsx)("div",{className:"w-full overflow-x-auto",children:(0,jsx_runtime.jsx)("div",{className:"min-w-[1000px]",children:metrics.map((metric,metricIndex)=>{let result=results?.[metricIndex],isFirstMetric=0===metricIndex;return(0,jsx_runtime.jsx)("div",{className:`w-full border border-primary bg-light ${1===metrics.length?"rounded":isFirstMetric?"rounded-t":metricIndex===metrics.length-1?"rounded-b":""}`,children:(0,jsx_runtime.jsx)(DeltaChart,{isSecondary:!!isSecondary,result:result,error:errors?.[metricIndex],variants:variants,metricType:getInsightType(metric),metricIndex:metricIndex,isFirstMetric:isFirstMetric,metric:metric,tickValues:commonTickValues,chartBound:chartBound})},metricIndex)})})}):(0,jsx_runtime.jsx)("div",{className:"border rounded bg-surface-primary pt-6 pb-8 text-secondary mt-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center mx-auto deprecated-space-y-3",children:[(0,jsx_runtime.jsx)(icons.Ii,{fontSize:"30"}),(0,jsx_runtime.jsxs)("div",{className:"text-sm text-center text-balance max-w-sm",children:[(0,jsx_runtime.jsxs)("p",{children:["Add up to ",10," ",isSecondary?"secondary":"primary"," metrics."]}),(0,jsx_runtime.jsx)("p",{children:isSecondary?"Secondary metrics provide additional context and help detect unintended side effects.":"Primary metrics represent the main goal of the experiment and directly measure if your hypothesis was successful."})]}),isSecondary?(0,jsx_runtime.jsx)(AddSecondaryMetric,{}):(0,jsx_runtime.jsx)(AddPrimaryMetric,{})]})})]})}var chart=__webpack_require__("../../node_modules/.pnpm/chart.js@4.4.3/node_modules/chart.js/dist/chart.js");chart.kL.register(...chart.zX);var LemonModal=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonModal/index.ts");let DELTA=[.16,.17,.15,.16,.14,.15,.145,.15,.155,.148,.15,.147,.152,.15],UPPER_BOUND=[.26,.27,.24,.24,.21,.21,.2,.2,.195,.183,.182,.177,.182,.18],LOWER_BOUND=[.06,.07,.06,.08,.07,.09,.09,.1,.115,.113,.118,.117,.122,.12],VariantDeltaTimeseries=()=>{let{closeVariantDeltaTimeseriesModal}=(0,index_esm.useActions)(experiments_experimentLogic.W),{isVariantDeltaTimeseriesModalOpen}=(0,index_esm.useValues)(experiments_experimentLogic.W);return(0,react.useEffect)(()=>{isVariantDeltaTimeseriesModalOpen&&setTimeout(()=>{let ctx=document.getElementById("variantDeltaChart");if(!ctx){console.error("Canvas element not found");return}let existingChart=chart.kL.getChart(ctx);existingChart&&existingChart.destroy(),ctx.style.width="100%",ctx.style.height="100%";let config={type:"line",data:{labels:["Day 1","Day 2","Day 3","Day 4","Day 5","Day 6","Day 7","Day 8","Day 9","Day 10","Day 11","Day 12","Day 13","Day 14"],datasets:[{label:"Upper Bound",data:UPPER_BOUND,borderColor:"rgba(200, 200, 200, 1)",fill:!1,tension:0,pointRadius:0},{label:"Lower Bound",data:LOWER_BOUND,borderColor:"rgba(200, 200, 200, 1)",fill:"-1",backgroundColor:"rgba(200, 200, 200, 0.2)",tension:0,pointRadius:0},{label:"Delta",data:DELTA,borderColor:"rgba(0, 100, 255, 1)",borderWidth:2,fill:!1,tension:0,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"nearest",axis:"x"},scales:{y:{beginAtZero:!0,grid:{display:!1},ticks:{count:6,callback:value=>`${(100*Number(value)).toFixed(1)}%`}}},plugins:{legend:{display:!1},tooltip:{callbacks:{labelPointStyle:function(){return{pointStyle:"circle",rotation:0}}},usePointStyle:!0,boxWidth:16,boxHeight:1},crosshair:!1}}};new chart.kL(ctx,config)},0)},[isVariantDeltaTimeseriesModalOpen]),(0,jsx_runtime.jsx)(LemonModal.f,{isOpen:isVariantDeltaTimeseriesModalOpen,onClose:()=>{closeVariantDeltaTimeseriesModal()},width:800,title:"Variant performance over time",footer:(0,jsx_runtime.jsx)(LemonButton.J,{form:"secondary-metric-modal-form",type:"secondary",onClick:()=>{},children:"Close"}),children:(0,jsx_runtime.jsx)("div",{className:"relative h-[400px]",children:(0,jsx_runtime.jsx)("canvas",{id:"variantDeltaChart"})})})};var kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),queries_query=__webpack_require__("../../frontend/src/queries/query.ts");let ConversionRateInputType=function(ConversionRateInputType){return ConversionRateInputType.MANUAL="manual",ConversionRateInputType.AUTOMATIC="automatic",ConversionRateInputType}({}),getKindField=metric=>{if((0,schema_general.N4)(metric))return schema_general.OH.EventsNode;if((0,schema_general.Gt)(metric)){let{kind}=metric.source;if([schema_general.OH.EventsNode,schema_general.OH.ActionsNode,schema_general.OH.ExperimentDataWarehouseNode].includes(kind))return kind}return schema_general.OH.EventsNode},getEventField=metric=>{if((0,schema_general.Gt)(metric)){let{source}=metric;return source.kind===schema_general.OH.ExperimentDataWarehouseNode?source.table_name:source.kind===schema_general.OH.EventsNode?source.event:source.kind===schema_general.OH.ActionsNode?source.id:null}if((0,schema_general.N4)(metric)){let step=metric.series.at(-1);return step.kind===schema_general.OH.EventsNode?step.event:step.kind===schema_general.OH.ActionsNode?step.id:null}return null},getTotalCountQuery=(metric,experiment)=>({kind:schema_general.OH.TrendsQuery,series:[{kind:getKindField(metric),event:getEventField(metric),math:types.vN.UniqueUsers},{kind:getKindField(metric),event:getEventField(metric),math:types.D7.Average}],trendsFilter:{},filterTestAccounts:experiment.exposure_criteria?.filterTestAccounts===!0,dateRange:{date_from:(0,dayjs.Bv)().subtract(constants.uq,"day").format("YYYY-MM-DDTHH:mm"),date_to:(0,dayjs.Bv)().endOf("d").format("YYYY-MM-DDTHH:mm"),explicitDate:!0}}),getSumQuery=(metric,experiment)=>({kind:schema_general.OH.TrendsQuery,series:[{kind:getKindField(metric),event:getEventField(metric),math:types.vN.UniqueUsers},{kind:getKindField(metric),event:getEventField(metric),math:types.O4.Sum,math_property_type:TaxonomicFilter_types.t.NumericalEventProperties,...metric.metric_type===schema_general.Tu.MEAN&&{math_property:metric.source.math_property}}],trendsFilter:{},filterTestAccounts:experiment.exposure_criteria?.filterTestAccounts===!0,dateRange:{date_from:(0,dayjs.Bv)().subtract(constants.uq,"day").format("YYYY-MM-DDTHH:mm"),date_to:(0,dayjs.Bv)().endOf("d").format("YYYY-MM-DDTHH:mm"),explicitDate:!0}}),getFunnelQuery=(metric,eventConfig,experiment)=>{var _eventConfig$event,_eventConfig$properti;return{kind:schema_general.OH.FunnelsQuery,series:[{kind:schema_general.OH.EventsNode,event:null!==(_eventConfig$event=eventConfig?.event)&&void 0!==_eventConfig$event?_eventConfig$event:"$pageview",properties:null!==(_eventConfig$properti=eventConfig?.properties)&&void 0!==_eventConfig$properti?_eventConfig$properti:[]},{kind:getKindField(metric),event:getEventField(metric)}],funnelsFilter:{funnelVizType:types.Ui.Steps},filterTestAccounts:experiment.exposure_criteria?.filterTestAccounts===!0,dateRange:{date_from:(0,dayjs.Bv)().subtract(constants.uq,"day").format("YYYY-MM-DDTHH:mm"),date_to:(0,dayjs.Bv)().endOf("d").format("YYYY-MM-DDTHH:mm"),explicitDate:!0},interval:"day"}},runningTimeCalculatorLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","experiments","RunningTimeCalculator","runningTimeCalculatorLogic"]),(0,index_esm.connect)(_ref=>{let{experimentId}=_ref;return{values:[(0,experiments_experimentLogic.W)({experimentId}),["experiment"]]}}),(0,index_esm.actions)({setMinimumDetectableEffect:value=>({value}),setMetricIndex:value=>({value}),setMetricResult:value=>({value}),setConversionRateInputType:value=>({value}),setManualConversionRate:value=>({value}),setExposureEstimateConfig:value=>({value})}),(0,index_esm.defaults)({exposureEstimateConfig:{event:"$pageview",properties:[]}}),(0,index_esm.reducers)({metricIndex:[null,{setMetricIndex:(_,_ref2)=>{let{value}=_ref2;return value}}],eventOrAction:["click",{setEventOrAction:(_,_ref3)=>{let{value}=_ref3;return value}}],minimumDetectableEffect:[experiments_experimentLogic.z,{setMinimumDetectableEffect:(_,_ref4)=>{let{value}=_ref4;return value}}],conversionRateInputType:[ConversionRateInputType.AUTOMATIC,{setConversionRateInputType:(_,_ref5)=>{let{value}=_ref5;return value}}],manualConversionRate:[2,{setManualConversionRate:(_,_ref6)=>{let{value}=_ref6;return value}}],exposureEstimateConfig:[null,{setExposureEstimateConfig:(_,_ref7)=>{let{value}=_ref7;return value}}]}),(0,kea_loaders_lib.loaders)(_ref8=>{let{values}=_ref8;return{metricResult:{loadMetricResult:async()=>{var _result$results$0$cou,_result$results$1$cou,_result$results$1$cou2,_result$results$0$cou2;if(null===values.metricIndex)return null;let metric=values.metric;if(!metric)return null;let query=metric.metric_type===schema_general.Tu.MEAN&&metric.source.math===types.xu.TotalCount?getTotalCountQuery(metric,values.experiment):metric.metric_type===schema_general.Tu.MEAN&&metric.source.math===types.xu.Sum?getSumQuery(metric,values.experiment):getFunnelQuery(metric,values.exposureEstimateConfig,values.experiment),result=await (0,queries_query.jr)(query,void 0,"force_blocking");if((0,schema_general.Gt)(metric))return{uniqueUsers:null!==(_result$results$0$cou=result?.results?.[0]?.count)&&void 0!==_result$results$0$cou?_result$results$0$cou:null,...metric.source.math===types.xu.TotalCount?{averageEventsPerUser:null!==(_result$results$1$cou=result?.results?.[1]?.count)&&void 0!==_result$results$1$cou?_result$results$1$cou:null}:{},...metric.source.math===types.xu.Sum?{averagePropertyValuePerUser:null!==(_result$results$1$cou2=result?.results?.[1]?.count)&&void 0!==_result$results$1$cou2?_result$results$1$cou2:null}:{}};if((0,schema_general.N4)(metric)){let firstStepCount=result?.results?.[0]?.count,automaticConversionRateDecimal=firstStepCount&&firstStepCount>0?(result?.results?.at(-1)?.count||0)/firstStepCount:null;return{uniqueUsers:null!==(_result$results$0$cou2=result?.results?.[0]?.count)&&void 0!==_result$results$0$cou2?_result$results$0$cou2:null,automaticConversionRateDecimal:automaticConversionRateDecimal}}return{}},setMetricResult:_ref9=>{let{value}=_ref9;return value}}}}),(0,index_esm.listeners)(_ref10=>{let{actions}=_ref10;return{setMetricIndex:()=>{actions.loadMetricResult()},setExposureEstimateConfig:()=>{actions.loadMetricResult()}}}),(0,index_esm.selectors)({metric:[s=>[s.metricIndex,s.experiment],(metricIndex,experiment)=>experiment.metrics[metricIndex]],uniqueUsers:[s=>[s.metricResult],metricResult=>{var _metricResult$uniqueU;return null!==(_metricResult$uniqueU=metricResult?.uniqueUsers)&&void 0!==_metricResult$uniqueU?_metricResult$uniqueU:null}],averageEventsPerUser:[s=>[s.metricResult],metricResult=>{var _metricResult$average;return null!==(_metricResult$average=metricResult?.averageEventsPerUser)&&void 0!==_metricResult$average?_metricResult$average:null}],averagePropertyValuePerUser:[s=>[s.metricResult],metricResult=>{var _metricResult$average2;return null!==(_metricResult$average2=metricResult?.averagePropertyValuePerUser)&&void 0!==_metricResult$average2?_metricResult$average2:null}],automaticConversionRateDecimal:[s=>[s.metricResult],metricResult=>{var _metricResult$automat;return null!==(_metricResult$automat=metricResult?.automaticConversionRateDecimal)&&void 0!==_metricResult$automat?_metricResult$automat:null}],variance:[s=>[s.metric,s.averageEventsPerUser,s.averagePropertyValuePerUser],(metric,averageEventsPerUser,averagePropertyValuePerUser)=>metric?metric.metric_type===schema_general.Tu.MEAN&&metric.source.math===types.xu.TotalCount?2*averageEventsPerUser:metric.metric_type===schema_general.Tu.MEAN&&metric.source.math===types.xu.Sum?.25*averagePropertyValuePerUser**2:null:null],standardDeviation:[s=>[s.variance],variance=>variance?Math.sqrt(variance):null],numberOfVariants:[s=>[s.experiment],experiment=>experiment.feature_flag?.filters.multivariate?.variants.length],recommendedSampleSize:[s=>[s.metric,s.minimumDetectableEffect,s.variance,s.averageEventsPerUser,s.averagePropertyValuePerUser,s.automaticConversionRateDecimal,s.manualConversionRate,s.conversionRateInputType,s.numberOfVariants],(metric,minimumDetectableEffect,variance,averageEventsPerUser,averagePropertyValuePerUser,automaticConversionRateDecimal,manualConversionRate,conversionRateInputType,numberOfVariants)=>{let d,sampleSizeFormula;if(!metric)return null;let minimumDetectableEffectDecimal=minimumDetectableEffect/100;if(metric.metric_type===schema_general.Tu.MEAN&&metric.source.math===types.xu.TotalCount)sampleSizeFormula=16*variance/(d=minimumDetectableEffectDecimal*averageEventsPerUser)**2;else if(metric.metric_type===schema_general.Tu.MEAN&&metric.source.math===types.xu.Sum)sampleSizeFormula=16*variance/(d=minimumDetectableEffectDecimal*averagePropertyValuePerUser)**2;else if(metric.metric_type===schema_general.Tu.FUNNEL){let conversionRate=conversionRateInputType===ConversionRateInputType.MANUAL?manualConversionRate/100:automaticConversionRateDecimal;if(d=minimumDetectableEffectDecimal*conversionRate,null===conversionRate)return null;sampleSizeFormula=16*conversionRate*(1-conversionRate)/d**2}return d&&sampleSizeFormula?sampleSizeFormula*numberOfVariants:null}],recommendedRunningTime:[s=>[s.recommendedSampleSize,s.uniqueUsers],(recommendedSampleSize,uniqueUsers)=>recommendedSampleSize/(uniqueUsers/14)]})]),RunningTimeCalculatorModalStep=_ref=>{let{children,stepNumber,title,description}=_ref;return(0,jsx_runtime.jsx)("div",{className:"space-y-6",children:(0,jsx_runtime.jsxs)("div",{className:"rounded bg-light p-4 space-y-3",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{className:"rounded-full bg-muted text-white w-6 h-6 flex items-center justify-center font-semibold",children:stepNumber}),(0,jsx_runtime.jsx)("h4",{className:"font-semibold m-0",children:title})]}),(0,jsx_runtime.jsx)("p",{className:"text-muted",children:description}),(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:children})]})})},exposureEstimateConfigToFilter=exposureEstimateConfig=>({events:[{id:exposureEstimateConfig?.event||"$pageview",kind:schema_general.OH.EventsNode,type:"events",name:exposureEstimateConfig?.event||"$pageview",properties:exposureEstimateConfig?.properties||[]}]}),EventSelectorStep=()=>{let{experimentId}=(0,index_esm.useValues)(experiments_experimentLogic.W),{exposureEstimateConfig}=(0,index_esm.useValues)(runningTimeCalculatorLogic({experimentId})),{setExposureEstimateConfig}=(0,index_esm.useActions)(runningTimeCalculatorLogic({experimentId}));return(0,jsx_runtime.jsx)(RunningTimeCalculatorModalStep,{stepNumber:1,title:"Estimate Experiment Traffic",description:"Choose an event to estimate the number of users who will be exposed to your experiment. We'll use data from the last 14 days to calculate the minimum sample size and estimated duration for your experiment.",children:(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,hideRename:!0,typeKey:"running-time-calculator",filters:exposureEstimateConfigToFilter(exposureEstimateConfig),entitiesLimit:1,mathAvailability:ActionFilterRow.Qq.None,setFilters:_ref=>{let{events}=_ref;events&&0!==events.length&&setExposureEstimateConfig({event:events[0].id,properties:events[0].properties})}})})};var LemonInput=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInput/index.ts"),LemonSegmentedButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSegmentedButton/index.ts"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts");let UniqueUsersPanel=_ref=>{let{uniqueUsers}=_ref;return uniqueUsers?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Unique users"}),(0,jsx_runtime.jsxs)("div",{className:"font-semibold",children:["~",(0,utils.Lc)(uniqueUsers,0)," persons"]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-muted",children:["Last ",14," days"]})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},AverageEventsPerUserPanel=_ref2=>{let{averageEventsPerUser}=_ref2;return averageEventsPerUser?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Avg. events per user"}),(0,jsx_runtime.jsxs)("div",{className:"font-semibold",children:["~",(0,utils.Lc)(averageEventsPerUser,0)]})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},AveragePropertyValuePerUserPanel=_ref3=>{let{averagePropertyValuePerUser}=_ref3;return averagePropertyValuePerUser?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Avg. property value per user"}),(0,jsx_runtime.jsxs)("div",{className:"font-semibold",children:["~",(0,utils.Lc)(averagePropertyValuePerUser,0)]})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},StandardDeviationPanel=_ref4=>{let{standardDeviation}=_ref4;return standardDeviation?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"card-secondary",children:[(0,jsx_runtime.jsx)("span",{children:"Est. standard deviation"}),(0,jsx_runtime.jsx)(src.u,{className:"ml-1",title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:'The estimated standard deviation of the metric in the last 14 days. It\'s the "human-readable" version of the amount of dispersion in the dataset, and is calculated as the square root of the variance. The variance informs the recommended sample size.'}),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary ml-1"})})]}),(0,jsx_runtime.jsxs)("div",{className:"font-semibold",children:["~",(0,utils.Lc)(standardDeviation,0)]})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},FunnelMetricDataPanel=()=>{let{experimentId}=(0,index_esm.useValues)(experiments_experimentLogic.W),{conversionRateInputType,uniqueUsers,automaticConversionRateDecimal,manualConversionRate}=(0,index_esm.useValues)(runningTimeCalculatorLogic({experimentId})),{setConversionRateInputType,setManualConversionRate}=(0,index_esm.useActions)(runningTimeCalculatorLogic({experimentId}));return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,jsx_runtime.jsx)(UniqueUsersPanel,{uniqueUsers:uniqueUsers}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"card-secondary",children:[(0,jsx_runtime.jsx)("span",{children:"Conversion rate input"}),(0,jsx_runtime.jsx)(Tooltip.u,{className:"ml-1",title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("strong",{children:"Automatic:"})," Uses historical conversion rate between your exposure event and the conversion event. It may not always be representative of expected performance.",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("strong",{children:"Manual:"})," Allows you to set a custom conversion rate based on your own knowledge of the funnel."]}),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary ml-1"})})]}),(0,jsx_runtime.jsx)(LemonSegmentedButton.P,{className:"mt-2",size:"small",options:[{label:"Manual",value:ConversionRateInputType.MANUAL},{label:"Automatic",value:ConversionRateInputType.AUTOMATIC}],onChange:value=>{setConversionRateInputType(value)},value:conversionRateInputType}),conversionRateInputType===ConversionRateInputType.MANUAL&&(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(LemonInput.D,{className:"w-[80px] mt-2",min:0,step:.01,max:100,type:"number",value:manualConversionRate||void 0,onChange:newValue=>{null!=newValue&&newValue>=0&&setManualConversionRate(newValue)}}),(0,jsx_runtime.jsx)("div",{children:"%"})]}),conversionRateInputType===ConversionRateInputType.AUTOMATIC&&(0,jsx_runtime.jsxs)("div",{className:"font-semibold mt-2",children:["~",(0,utils.Lc)(100*automaticConversionRateDecimal,2),"%"]})]})]})})},MeanMetricDataPanel=()=>{let{experimentId}=(0,index_esm.useValues)(experiments_experimentLogic.W),{uniqueUsers,averageEventsPerUser,averagePropertyValuePerUser,standardDeviation}=(0,index_esm.useValues)(runningTimeCalculatorLogic({experimentId}));return(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,jsx_runtime.jsx)(UniqueUsersPanel,{uniqueUsers:uniqueUsers}),(0,jsx_runtime.jsx)(AverageEventsPerUserPanel,{averageEventsPerUser:averageEventsPerUser}),(0,jsx_runtime.jsx)(AveragePropertyValuePerUserPanel,{averagePropertyValuePerUser:averagePropertyValuePerUser}),(0,jsx_runtime.jsx)(StandardDeviationPanel,{standardDeviation:standardDeviation})]})},MetricSelectorStep=()=>{let{experimentId}=(0,index_esm.useValues)(experiments_experimentLogic.W),{experiment,metric,metricIndex,metricResultLoading}=(0,index_esm.useValues)(runningTimeCalculatorLogic({experimentId})),{setMetricIndex}=(0,index_esm.useActions)(runningTimeCalculatorLogic({experimentId}));return(0,jsx_runtime.jsxs)(RunningTimeCalculatorModalStep,{stepNumber:2,title:"Select a Metric",description:"Choose a metric to analyze. We'll use historical data from this metric to estimate the experiment duration.",children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary mb-2",children:"Experiment metric"}),(0,jsx_runtime.jsx)(src.Yv,{options:experiment.metrics.map((metric,index)=>({label:(0,jsx_runtime.jsxs)("div",{className:"cursor-default text-xs font-semibold whitespace-nowrap overflow-hidden text-ellipsis flex-grow flex items-center",children:[(0,jsx_runtime.jsxs)("span",{className:"mr-1",children:[index+1,"."]}),(0,jsx_runtime.jsx)(MetricTitle,{metric:metric})]}),value:index})),value:metricIndex,onChange:value=>{null!==value&&setMetricIndex(value)}})]}),metricResultLoading?(0,jsx_runtime.jsx)("div",{className:"border-t pt-2",children:(0,jsx_runtime.jsx)("div",{className:"h-[100px] flex items-center justify-center",children:(0,jsx_runtime.jsx)(src.$j,{className:"text-3xl transform -translate-y-[-10px]"})})}):(0,jsx_runtime.jsxs)("div",{className:"border-t pt-2",children:[metric?.metric_type===schema_general.Tu.MEAN&&(0,jsx_runtime.jsx)(MeanMetricDataPanel,{}),metric?.metric_type===schema_general.Tu.FUNNEL&&(0,jsx_runtime.jsx)(FunnelMetricDataPanel,{})]})]})},RunningTimeCalculatorModalFooter=_ref=>{let{onClose,onSave}=_ref;return(0,jsx_runtime.jsx)("div",{className:"flex items-center w-full",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,jsx_runtime.jsx)(LemonButton.J,{form:"edit-experiment-metric-form",type:"secondary",onClick:onClose,children:"Cancel"}),(0,jsx_runtime.jsx)(LemonButton.J,{form:"edit-experiment-metric-form",onClick:onSave,type:"primary",children:"Save"})]})})};function RunningTimeCalculatorModal(){let{experimentId,isCalculateRunningTimeModalOpen}=(0,index_esm.useValues)(experiments_experimentLogic.W),{closeCalculateRunningTimeModal,updateExperiment}=(0,index_esm.useActions)(experiments_experimentLogic.W),{experiment,minimumDetectableEffect,recommendedSampleSize,recommendedRunningTime,uniqueUsers,metricResultLoading,exposureEstimateConfig}=(0,index_esm.useValues)(runningTimeCalculatorLogic({experimentId})),{setMinimumDetectableEffect}=(0,index_esm.useActions)(runningTimeCalculatorLogic({experimentId}));return(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isCalculateRunningTimeModalOpen,onClose:closeCalculateRunningTimeModal,width:700,title:"Calculate estimated running time",footer:(0,jsx_runtime.jsx)(RunningTimeCalculatorModalFooter,{onClose:closeCalculateRunningTimeModal,onSave:()=>{updateExperiment({parameters:{...experiment?.parameters,exposure_estimate_config:exposureEstimateConfig,recommended_running_time:recommendedRunningTime,recommended_sample_size:recommendedSampleSize||void 0,minimum_detectable_effect:minimumDetectableEffect||void 0}}),closeCalculateRunningTimeModal()}}),children:[(0,jsx_runtime.jsx)(EventSelectorStep,{}),exposureEstimateConfig&&(0,jsx_runtime.jsx)(MetricSelectorStep,{}),(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-6",children:!metricResultLoading&&null!==uniqueUsers&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(RunningTimeCalculatorModalStep,{stepNumber:3,title:"Choose minimum detectable effect",description:"The minimum detectable effect (MDE) is the smallest relative improvement you want to be able to detect with statistical significance. A smaller MDE requires more participants but can detect subtler changes.",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.DF,{className:"w-[80px]",min:0,step:1,type:"number",value:minimumDetectableEffect,onChange:newValue=>{newValue&&setMinimumDetectableEffect(newValue)}}),(0,jsx_runtime.jsx)("div",{children:"%"})]})}),null!==recommendedSampleSize&&null!==recommendedRunningTime&&(0,jsx_runtime.jsx)(RunningTimeCalculatorModalStep,{stepNumber:4,title:"Estimated experiment size & duration",description:"These are just statistical estimates – you can conclude the experiment earlier if a significant effect is detected. Running shorter may make results less reliable.",children:(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended sample size"}),(0,jsx_runtime.jsxs)("div",{className:"text-lg font-semibold",children:["~",(0,utils.Lc)(recommendedSampleSize,0)," users"]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Estimated running time"}),(0,jsx_runtime.jsxs)("div",{className:"text-lg font-semibold",children:["~",(0,utils.Lc)(recommendedRunningTime,1)," days"]})]})]})})]})})]})}var featureFlagLogic=__webpack_require__("../../frontend/src/scenes/feature-flags/featureFlagLogic.ts");function HoldoutSelector_HoldoutSelector(){let{experiment,holdouts,isExperimentRunning}=(0,index_esm.useValues)(experiments_experimentLogic.W),{setExperiment,reportExperimentHoldoutAssigned}=(0,index_esm.useActions)(experiments_experimentLogic.W),holdoutOptions=holdouts.map(holdout=>({value:holdout.id,label:holdout.name}));return holdoutOptions.unshift({value:null,label:"No holdout"}),(0,jsx_runtime.jsxs)("div",{className:"mt-3",children:[(0,jsx_runtime.jsxs)("div",{className:"inline-flex deprecated-space-x-1",children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold mb-0",children:"Holdout group"}),(0,jsx_runtime.jsx)(src.u,{title:"Exclude a stable group of users from the experiment. This cannot be changed once the experiment is launched.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary text-base"})})]}),(0,jsx_runtime.jsx)("div",{className:"mt-1",children:(0,jsx_runtime.jsx)(src.Yv,{disabledReason:isExperimentRunning&&!experiment.end_date&&"The holdout group cannot be changed once the experiment is launched.",size:"xsmall",options:holdoutOptions,value:experiment.holdout_id||null,onChange:value=>{setExperiment({...experiment,holdout_id:value}),reportExperimentHoldoutAssigned({experimentId:experiment.id,holdoutId:value})},"data-attr":"experiment-holdout-selector"})})]})}var useUploadFiles=__webpack_require__("../../frontend/src/lib/hooks/useUploadFiles.ts");function VariantScreenshot(_ref){let{variantKey,rolloutPercentage}=_ref,{experiment}=(0,index_esm.useValues)(experiments_experimentLogic.W),{updateExperimentVariantImages,reportExperimentVariantScreenshotUploaded}=(0,index_esm.useActions)(experiments_experimentLogic.W),[mediaIds,setMediaIds]=(0,react.useState)((()=>{let variantImages=experiment.parameters?.variant_screenshot_media_ids?.[variantKey];return variantImages?Array.isArray(variantImages)?variantImages:[variantImages]:[]})()),[loadingImages,setLoadingImages]=(0,react.useState)({}),[selectedImageIndex,setSelectedImageIndex]=(0,react.useState)(null),{setFilesToUpload,filesToUpload,uploading}=(0,useUploadFiles.nc)({onUpload:(_,__,id)=>{if(id&&mediaIds.length<5){let newMediaIds=[...mediaIds,id];setMediaIds(newMediaIds),updateExperimentVariantImages({...experiment.parameters?.variant_screenshot_media_ids,[variantKey]:newMediaIds}),reportExperimentVariantScreenshotUploaded(experiment.id)}else mediaIds.length>=5&&src.UJ.error("Maximum of 5 images allowed")},onError:detail=>{src.UJ.error(`Error uploading image: ${detail}`)}}),handleImageLoad=mediaId=>{setLoadingImages(prev=>({...prev,[mediaId]:!1}))},handleImageError=mediaId=>{setLoadingImages(prev=>({...prev,[mediaId]:!1}))},handleDelete=indexToDelete=>{let newMediaIds=mediaIds.filter((_,index)=>index!==indexToDelete);setMediaIds(newMediaIds),updateExperimentVariantImages({...experiment.parameters?.variant_screenshot_media_ids,[variantKey]:newMediaIds})},widthClass=(()=>{switch(mediaIds.length<5?mediaIds.length+1:mediaIds.length){case 1:case 2:default:return"w-20";case 3:return"w-16";case 4:return"w-14";case 5:return"w-12"}})();return(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 items-start",children:[mediaIds.map((mediaId,index)=>(0,jsx_runtime.jsx)("div",{className:"relative",children:(0,jsx_runtime.jsx)("div",{className:"text-secondary inline-flex flow-row items-center gap-1 cursor-pointer",children:(0,jsx_runtime.jsxs)("div",{onClick:()=>setSelectedImageIndex(index),className:"cursor-zoom-in relative",children:[(0,jsx_runtime.jsxs)("div",{className:`relative flex overflow-hidden select-none ${widthClass} h-16 rounded before:absolute before:inset-0 before:border before:rounded`,children:[loadingImages[mediaId]&&(0,jsx_runtime.jsx)(src.yW,{className:"absolute inset-0"}),(0,jsx_runtime.jsx)("img",{className:"w-full h-full object-cover",src:mediaId.startsWith("data:")?mediaId:`/uploaded_media/${mediaId}`,onError:()=>handleImageError(mediaId),onLoad:()=>handleImageLoad(mediaId)})]}),(0,jsx_runtime.jsx)("div",{className:"absolute -inset-2 group",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:e=>{e.stopPropagation(),handleDelete(index)},size:"small",tooltip:"Remove",tooltipPlacement:"right",noPadding:!0,className:"group-hover:flex hidden absolute right-0 top-0"})})]})})},mediaId)),mediaIds.length<5&&(0,jsx_runtime.jsx)("div",{className:`relative ${widthClass} h-16`,children:(0,jsx_runtime.jsx)(src.mH,{accept:"image/*",multiple:!1,onChange:setFilesToUpload,loading:uploading,value:filesToUpload,callToAction:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-full h-16 border border-dashed rounded cursor-pointer hover:border-accent",children:(0,jsx_runtime.jsx)("span",{className:"text-2xl text-secondary",children:"+"})})})})]}),(0,jsx_runtime.jsx)(src.fQ,{isOpen:null!==selectedImageIndex,onClose:()=>setSelectedImageIndex(null),title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsxs)("span",{children:["Screenshot ",null!==selectedImageIndex?selectedImageIndex+1:""]}),(0,jsx_runtime.jsx)(src.p2,{className:"my-0 mx-1",vertical:!0}),(0,jsx_runtime.jsx)(components.Aw,{experimentId:experiment.id,variantKey:variantKey}),void 0!==rolloutPercentage&&(0,jsx_runtime.jsxs)("span",{className:"text-secondary text-sm",children:["(",rolloutPercentage,"% rollout)"]})]}),children:null!==selectedImageIndex&&mediaIds[selectedImageIndex]&&(0,jsx_runtime.jsx)("img",{src:mediaIds[selectedImageIndex]?.startsWith("data:")?mediaIds[selectedImageIndex]:`/uploaded_media/${mediaIds[selectedImageIndex]}`,alt:`Screenshot ${selectedImageIndex+1}: ${variantKey}`,className:"max-w-full max-h-[80vh] overflow-auto"})})]})}function DistributionModal(_ref){var _experiment$feature_f;let{experimentId}=_ref,{experiment,experimentLoading,isDistributionModalOpen}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),{closeDistributionModal,updateDistributionModal}=(0,index_esm.useActions)((0,experiments_experimentLogic.W)({experimentId})),_featureFlagLogic=(0,featureFlagLogic.hk)({id:null!==(_experiment$feature_f=experiment.feature_flag?.id)&&void 0!==_experiment$feature_f?_experiment$feature_f:null}),{featureFlag,areVariantRolloutsValid,variantRolloutSum}=(0,index_esm.useValues)(_featureFlagLogic),{setFeatureFlagFilters,distributeVariantsEqually}=(0,index_esm.useActions)(_featureFlagLogic),handleRolloutPercentageChange=(index,value)=>{if(!featureFlag?.filters?.multivariate)return;let numericValue=value||0,updatedVariants=featureFlag.filters.multivariate.variants.map((variant,i)=>i===index?{...variant,rollout_percentage:numericValue}:variant);setFeatureFlagFilters({...featureFlag.filters,multivariate:{...featureFlag.filters.multivariate,variants:updatedVariants}},null)};return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isDistributionModalOpen,onClose:closeDistributionModal,width:600,title:"Change experiment distribution",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:closeDistributionModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{updateDistributionModal(featureFlag),closeDistributionModal()},type:"primary",loading:experimentLoading,disabled:!areVariantRolloutsValid,children:"Save"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:"Adjusting variant distribution may impact the validity of your results. Adjust only if you're aware of how changes will affect your experiment."}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold mb-0",children:"Variant distribution"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",onClick:distributeVariantsEqually,tooltip:"Redistribute variant rollout percentages equally",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBalance,{}),children:"Distribute equally"})]}),(0,jsx_runtime.jsx)(src.g3,{dataSource:featureFlag?.filters?.multivariate?.variants||[],columns:[{title:"Variant",dataIndex:"key",render:value=>(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:value})},{title:"Rollout Percentage",dataIndex:"rollout_percentage",render:(_,record,index)=>(0,jsx_runtime.jsx)(src.DF,{type:"number",value:record.rollout_percentage,onChange:value=>handleRolloutPercentageChange(index,value),min:0,max:100,suffix:(0,jsx_runtime.jsx)("span",{children:"%"})})}]}),!areVariantRolloutsValid&&(0,jsx_runtime.jsxs)("p",{className:"text-danger mt-2",children:["Percentage rollouts must sum to 100 (currently ",variantRolloutSum,")."]})]}),(0,jsx_runtime.jsx)(HoldoutSelector_HoldoutSelector,{})]})})}function DistributionTable(){let{openDistributionModal}=(0,index_esm.useActions)(experiments_experimentLogic.W),{experimentId,experiment,metricResults}=(0,index_esm.useValues)(experiments_experimentLogic.W),{reportExperimentReleaseConditionsViewed}=(0,index_esm.useActions)(experiments_experimentLogic.W),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),result=metricResults?.[0],onSelectElement=variant=>{src.dn.open({title:"Select a domain",description:"Choose the domain on which to preview this experiment variant",content:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(AuthorizedUrlList.t,{query:"?__experiment_id="+experiment?.id+"&__experiment_variant="+variant,experimentId:experiment?.id,type:authorizedUrlListLogic.uw.WEB_EXPERIMENTS})}),primaryButton:{children:"Close",type:"secondary"}})},className=experiment?.type==="web"?"w-1/2.5":"w-1/3",columns=[{className:className,key:"key",title:"Variant",render:function Key(_,item){return result&&result.insight?(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:item.key}):(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:item.key})}},{className:className,key:"rollout_percentage",title:"Rollout",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{children:`${item.rollout_percentage}%`})}},{className:className,key:"variant_screenshot",title:"Screenshot",render:function Key(_,item){return item.key===`holdout-${experiment.holdout?.id}`?(0,jsx_runtime.jsx)("div",{className:"h-16"}):(0,jsx_runtime.jsx)("div",{className:"my-2",children:(0,jsx_runtime.jsx)(VariantScreenshot,{variantKey:item.key,rolloutPercentage:item.rollout_percentage})})}}];"web"===experiment.type&&columns.push({className:className,key:"preview_web_experiment",title:"Preview",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{className:"my-2",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",onClick:e=>{e.preventDefault(),onSelectElement(item.key)},sideIcon:(0,jsx_runtime.jsx)(icons.UE,{}),children:"Preview variant"})})}});let holdoutData=experiment.holdout?[{key:`holdout-${experiment.holdout.id}`,rollout_percentage:experiment.holdout.filters[0].rollout_percentage}]:[],tableData=[...(experiment.feature_flag?.filters.multivariate?.variants||[]).map(variant=>({...variant,rollout_percentage:variant.rollout_percentage*((100-(experiment.holdout?.filters[0].rollout_percentage||0))/100)})),...holdoutData];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2",children:(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg",children:"Distribution"})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,jsx_runtime.jsx)("div",{className:"ml-auto mb-2",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFlag,{}),onClick:()=>{openDistributionModal(),reportExperimentReleaseConditionsViewed(experiment.id)},type:"secondary",size:"xsmall",className:"font-semibold",children:"Manage distribution"})})})]}),experiment.holdout&&(0,jsx_runtime.jsxs)(src.Vp,{type:"info",className:"mb-4",children:["This experiment has a holdout group of ",experiment.holdout.filters[0].rollout_percentage,"%. The variants are modified to show their relative rollout percentage."]}),(0,jsx_runtime.jsx)(src.g3,{loading:!1,columns:columns,dataSource:tableData,rowClassName:item=>item.key===`holdout-${experiment.holdout?.id}`?isDarkModeOn?"bg-fill-primary":"bg-mid":""})]})}function getExposureCriteriaLabel(exposureCriteria){let exposureConfig=exposureCriteria?.exposure_config;return exposureConfig?`Custom (${exposureConfig.event})`:"Default ($feature_flag_called)"}function Exposures(){let{experimentId,exposures,exposuresLoading,exposureCriteria}=(0,index_esm.useValues)(experiments_experimentLogic.W),{openExposureCriteriaModal}=(0,index_esm.useActions)(experiments_experimentLogic.W),chartRef=(0,react.useRef)(null);(0,react.useEffect)(()=>{if(chartRef.current&&(chartRef.current.destroy(),chartRef.current=null),!exposures||!exposures?.timeseries?.length)return;let ctx=document.getElementById("exposuresChart");if(!ctx)return;let config={type:"line",data:{labels:exposures.timeseries[0].days,datasets:exposures.timeseries.map(series=>({label:series.variant,data:series.exposure_counts,borderColor:"rgb(17 17 17 / 60%)",backgroundColor:"rgb(17 17 17 / 40%)",fill:!0,tension:0,stack:"stack1",borderWidth:2,pointRadius:0}))},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"nearest",axis:"x"},scales:{y:{stacked:!0,beginAtZero:!0,grid:{display:!0}}},plugins:{legend:{display:!1,labels:{boxWidth:4,boxPadding:20,pointStyle:"dash"}},crosshair:!1}}};try{chartRef.current=new chart.kL(ctx,config)}catch(error){console.error("Error creating chart:",error)}return()=>{chartRef.current&&(chartRef.current.destroy(),chartRef.current=null)}},[exposures]);let chartWrapperClasses="relative border rounded bg-surface-primary p-4 h-[280px]";return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center deprecated-space-x-2 mb-2",children:[(0,jsx_runtime.jsx)("h2",{className:"mb-0 font-semibold text-lg leading-6.5",children:"Exposures"}),(0,jsx_runtime.jsx)(src.u,{title:"Shows the daily cumulative count of unique users exposed to each variant throughout the experiment duration.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary text-lg"})})]}),exposuresLoading?(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)(chartWrapperClasses,"flex justify-center items-center"),children:(0,jsx_runtime.jsx)(src.$j,{className:"text-5xl"})}):exposures?.timeseries?.length?(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)(chartWrapperClasses,"w-full md:w-2/3"),children:(0,jsx_runtime.jsx)("canvas",{id:"exposuresChart"})}),(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)(chartWrapperClasses,"border rounded bg-surface-primary p-4"),children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-between mb-4",children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"card-secondary",children:"Exposure criteria"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("div",{className:"text-sm font-semibold",children:getExposureCriteriaLabel(exposureCriteria)}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{fontSize:"12"}),size:"xsmall",className:"flex items-center gap-2",type:"secondary",onClick:()=>openExposureCriteriaModal()})]})]})}),exposures?.timeseries.length>0&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"card-secondary",children:"Total exposures"}),(0,jsx_runtime.jsx)("div",{className:"overflow-auto max-h-[150px]",children:(0,jsx_runtime.jsx)(src.g3,{dataSource:exposures?.timeseries||[],columns:[{title:"Variant",key:"variant",render:function Variant(_,series){return(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:series.variant})}},{title:"Exposures",key:"exposures",render:function Exposures(_,series){return(0,utils.Lc)(exposures?.total_exposures[series.variant])}},{title:"%",key:"percentage",render:function Percentage(_,series){let total=0;if(exposures?.total_exposures)for(let[_,value]of Object.entries(exposures.total_exposures))total+=Number(value);return(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:total?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(exposures?.total_exposures[series.variant]/total*100).toFixed(1),"%"]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"-%"})})}}]})})]})]})]}):(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)(chartWrapperClasses,"flex justify-center items-center"),children:(0,jsx_runtime.jsxs)("div",{className:"text-center",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCorrelationAnalysis,{className:"text-3xl mb-2 text-tertiary"}),(0,jsx_runtime.jsx)("div",{className:"text-md font-semibold leading-tight mb-2",children:"No exposures yet"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-center text-balance text-tertiary",children:"Exposures will appear here once the first participant has been exposed."}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{fontSize:"12"}),size:"xsmall",className:"flex items-center gap-2",type:"secondary",onClick:()=>openExposureCriteriaModal(),children:"Edit exposure criteria"})})]})})]})}function PreLaunchChecklist(){let{experiment}=(0,index_esm.useValues)(experiments_experimentLogic.W),{openDescriptionModal,openPrimaryMetricSourceModal,openCalculateRunningTimeModal}=(0,index_esm.useActions)(experiments_experimentLogic.W);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center deprecated-space-x-2 mb-2",children:(0,jsx_runtime.jsx)("h2",{className:"mb-0 font-semibold text-lg leading-6",children:"Pre-launch checklist"})}),(0,jsx_runtime.jsx)("div",{className:"bg-bg-light rounded p-4 border",children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-3 mb-6",children:[experiment.description?(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"text-success flex-none w-6 h-6"}):(0,jsx_runtime.jsx)("div",{className:"flex-none w-5 h-5 rounded-full border-2 border-orange"}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("div",{className:`text-xs font-semibold ${experiment.description?"text-success":""}`,children:"Step 1"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:`font-semibold ${experiment.description?"text-muted line-through":""}`,children:"Add hypothesis"}),(0,jsx_runtime.jsx)("div",{className:`text-sm ${experiment.description?"text-muted line-through":"text-muted"}`,children:"Document what you expect to learn from this experiment"})]}),!experiment.description&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>{openDescriptionModal()},children:"Add hypothesis"})]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-3 mb-6",children:[experiment.metrics?.length>0?(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"text-success flex-none w-6 h-6"}):(0,jsx_runtime.jsx)("div",{className:"flex-none w-5 h-5 rounded-full border-2 border-orange"}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("div",{className:`text-xs font-semibold ${experiment.metrics?.length>0?"text-success":""}`,children:"Step 2"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:`font-semibold ${experiment.metrics?.length>0?"text-muted line-through":""}`,children:"Add first metric"}),(0,jsx_runtime.jsx)("div",{className:`text-sm ${experiment.metrics?.length>0?"text-muted line-through":"text-muted"}`,children:"Define your experiment's primary success metric"})]}),!(experiment.metrics?.length>0)&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>{openPrimaryMetricSourceModal()},children:"Add metric"})]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-3",children:[experiment.parameters?.recommended_running_time?(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"text-success flex-none w-6 h-6"}):(0,jsx_runtime.jsx)("div",{className:"flex-none w-5 h-5 rounded-full border-2 border-orange"}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("div",{className:`text-xs font-semibold ${experiment.parameters?.recommended_running_time?"text-success":""}`,children:"Step 3"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:`font-semibold ${experiment.parameters?.recommended_running_time?"text-muted line-through":""}`,children:"Calculate experiment duration"}),(0,jsx_runtime.jsx)("div",{className:`text-sm ${experiment.parameters?.recommended_running_time?"text-muted line-through":"text-muted"}`,children:"Determine how long your experiment needs to run"})]}),!experiment.parameters?.recommended_running_time&&experiment.metrics?.length>0&&(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:openCalculateRunningTimeModal,children:"Calculate"})]})]})]})]})})]})}function RunningTime(){let{experiment,actualRunningTime}=(0,index_esm.useValues)(experiments_experimentLogic.W),{openCalculateRunningTimeModal}=(0,index_esm.useActions)(experiments_experimentLogic.W),recommendedSampleSize=experiment.parameters.recommended_sample_size,minimumDetectableEffect=experiment.parameters.minimum_detectable_effect,recommendedRunningTime=experiment.parameters.recommended_running_time;return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center deprecated-space-x-2 mb-2",children:[(0,jsx_runtime.jsx)("h2",{className:"mb-0 font-semibold text-lg leading-6",children:"Running time"}),recommendedRunningTime?(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{fontSize:"12"}),size:"xsmall",className:"flex items-center gap-2",type:"secondary",onClick:()=>openCalculateRunningTimeModal()}):null]}),(0,jsx_runtime.jsx)("div",{className:"relative border rounded bg-surface-primary p-4 h-[280px] overflow-y-auto",children:recommendedSampleSize&&recommendedRunningTime?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonProgress.b,{className:"w-full border",bgColor:"var(--bg-table)",size:"medium",percent:actualRunningTime/recommendedRunningTime*100}),(0,jsx_runtime.jsxs)("div",{className:"text-center mt-2 mb-4 text-xs text-muted",children:[actualRunningTime," of ",(0,utils.Lc)(recommendedRunningTime,0)," days completed (",Math.round(actualRunningTime/recommendedRunningTime*100),"%)"]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary mb-1",children:"Recommended sample size"}),(0,jsx_runtime.jsxs)("div",{className:"text-sm font-semibold",children:[(0,utils.Lc)(recommendedSampleSize,0)," users"]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary mb-1",children:"Estimated running time"}),(0,jsx_runtime.jsxs)("div",{className:"text-sm font-semibold",children:[(0,utils.Lc)(recommendedRunningTime,0)," days"]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary mb-1",children:"Minimum detectable effect"}),(0,jsx_runtime.jsxs)("div",{className:"text-sm font-semibold",children:[minimumDetectableEffect,"%"]})]})]})]}):(0,jsx_runtime.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,jsx_runtime.jsxs)("div",{className:"text-center",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCalculator,{className:"text-3xl mb-2 text-tertiary"}),(0,jsx_runtime.jsx)("div",{className:"text-md font-semibold leading-tight mb-3",children:"No running time yet"}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{fontSize:"12"}),size:"xsmall",className:"flex items-center gap-2",type:"secondary",onClick:()=>openCalculateRunningTimeModal(),children:"Calculate running time"})})]})})})]})}function ExperimentHeader(){let{isExperimentRunning}=(0,index_esm.useValues)(experiments_experimentLogic.W);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!isExperimentRunning&&(0,jsx_runtime.jsx)("div",{className:"w-1/2",children:(0,jsx_runtime.jsx)(PreLaunchChecklist,{})}),(0,jsx_runtime.jsxs)("div",{className:"flex w-full space-x-4",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/4",children:(0,jsx_runtime.jsx)(RunningTime,{})}),(0,jsx_runtime.jsx)("div",{className:"w-3/4",children:(0,jsx_runtime.jsx)(Exposures,{})})]})]})}function ExposureCriteriaModal(){let{experiment,isExposureCriteriaModalOpen}=(0,index_esm.useValues)(experiments_experimentLogic.W),{closeExposureCriteriaModal,restoreUnmodifiedExperiment,setExposureCriteria,updateExposureCriteria}=(0,index_esm.useActions)(experiments_experimentLogic.W),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),hasFilters=(currentTeam?.test_account_filters||[]).length>0;return(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isExposureCriteriaModalOpen,onClose:closeExposureCriteriaModal,width:860,title:"Edit exposure criteria",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",type:"secondary",onClick:()=>{restoreUnmodifiedExperiment(),closeExposureCriteriaModal()},children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",onClick:()=>{updateExposureCriteria(),closeExposureCriteriaModal()},type:"primary",children:"Save"})]}),children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,jsx_runtime.jsxs)(src.Jp,{className:`trends-metric-form__exposure-button flex-1 cursor-pointer p-4 rounded border ${experiment.exposure_criteria?.exposure_config?"border-primary":"border-accent bg-accent-highlight-secondary"}`,onClick:()=>{setExposureCriteria({exposure_config:void 0})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Default"}),!experiment.exposure_criteria?.exposure_config&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--accent)"})]}),(0,jsx_runtime.jsxs)("div",{className:"text-secondary text-sm leading-relaxed mt-1",children:["Uses the number of unique users who trigger the ",(0,jsx_runtime.jsx)(src.oe,{children:"$feature_flag_called"})," event as your exposure count. This is the recommended setting for most experiments, as it accurately tracks variant exposure."]})]}),(0,jsx_runtime.jsxs)(src.Jp,{className:`trends-metric-form__exposure-button flex-1 cursor-pointer p-4 rounded border ${experiment.exposure_criteria?.exposure_config?"border-accent bg-accent-highlight-secondary":"border-primary"}`,onClick:()=>{setExposureCriteria({exposure_config:{kind:schema_general.OH.ExperimentEventExposureConfig,event:"$feature_flag_called",properties:[]}})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Custom"}),experiment.exposure_criteria?.exposure_config&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--accent)"})]}),(0,jsx_runtime.jsx)("div",{className:"text-secondary text-sm leading-relaxed mt-1",children:"Define your own exposure metric for specific use cases, such as counting by sessions instead of users. This gives you full control but requires careful configuration."})]})]}),experiment.exposure_criteria?.exposure_config&&(0,jsx_runtime.jsx)("div",{className:"mb-4",children:(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:(0,experiments_utils.m3)(experiment.exposure_criteria.exposure_config),setFilters:_ref=>{let{events}=_ref,entity=events?.[0];entity&&setExposureCriteria({exposure_config:(0,experiments_utils.ZE)(entity)})},typeKey:"experiment-exposure-config",buttonCopy:"Add graph series",showSeriesIndicator:!0,hideRename:!0,entitiesLimit:1,mathAvailability:ActionFilterRow.Qq.None,showNumericalPropsOnly:!0,actionsTaxonomicGroupTypes:[TaxonomicFilter_types.t.Events],propertiesTaxonomicGroupTypes:Selectors.dF.propertiesTaxonomicGroupTypes})}),(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:(()=>{let val=experiment.exposure_criteria?.filterTestAccounts;return!!hasFilters&&!!val})(),onChange:checked=>{setExposureCriteria({filterTestAccounts:checked})},fullWidth:!0})]})}var Info=__webpack_require__("../../frontend/src/scenes/experiments/ExperimentView/Info.tsx"),LoadingBar=__webpack_require__("../../frontend/src/lib/lemon-ui/LoadingBar/index.ts"),LemonSlider=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSlider/index.ts"),insightLogic=__webpack_require__("../../frontend/src/scenes/insights/insightLogic.tsx");function FunnelCalculation(_ref){let{experimentId}=_ref,{minimumDetectableEffect,experiment,conversionMetrics,minimumSampleSizePerVariant,recommendedRunningTime,variants}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),funnelConversionRate=conversionMetrics?.totalRate*100||0,funnelSampleSize=minimumSampleSizePerVariant(100*conversionMetrics.totalRate)*variants.length,baselineConversionRate=funnelConversionRate.toFixed(1),minimumAcceptableConversionRate=(funnelConversionRate+(minimumDetectableEffect||5)).toFixed(1),recommendedSampleSize=(0,utils.Lc)(funnelSampleSize||0);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap",children:[!experiment?.start_date&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Baseline Conversion Rate"}),(0,jsx_runtime.jsxs)("div",{className:"l4",children:[baselineConversionRate,"%"]})]}),(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Conversion Rate"}),(0,jsx_runtime.jsxs)("div",{className:"l4",children:[minimumAcceptableConversionRate,"%"]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended Sample Size"}),(0,jsx_runtime.jsxs)("div",{className:"pb-4",children:[(0,jsx_runtime.jsxs)("span",{className:"l4",children:["~",recommendedSampleSize]})," persons"]})]}),!experiment?.start_date&&(0,jsx_runtime.jsxs)("div",{className:"w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("span",{className:"l4",children:["~",recommendedRunningTime]})," days"]})]})]})}function TrendCalculation(_ref2){let{experimentId}=_ref2,{minimumDetectableEffect,experiment,trendResults,recommendedExposureForCountData}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),trendCount=trendResults[0]?.count||0,trendExposure=recommendedExposureForCountData(trendCount),baselineCount=(0,utils.Lc)(trendCount||0),minimumAcceptableCount=(0,utils.Lc)(trendCount+Math.ceil((minimumDetectableEffect||5)/100*trendCount)||0),recommendedRunningTime=(0,utils.Lc)(trendExposure||0);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap",children:[!experiment?.start_date&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Baseline Count"}),(0,jsx_runtime.jsx)("div",{className:"l4",children:baselineCount})]}),(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Count"}),(0,jsx_runtime.jsx)("div",{className:"l4",children:minimumAcceptableCount})]})]}),(0,jsx_runtime.jsxs)("div",{className:"w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("span",{className:"l4",children:["~",recommendedRunningTime]})," days"]})]})]})}function DataCollectionCalculator(_ref3){let{experimentId}=_ref3,{getInsightType,firstPrimaryMetric,minimumDetectableEffect,experiment,conversionMetrics}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),{setExperiment}=(0,index_esm.useActions)((0,experiments_experimentLogic.W)({experimentId})),insightType=getInsightType(firstPrimaryMetric),insightLogicInstance=(0,insightLogic.zm)({dashboardItemId:insightType===types.dw.FUNNELS?experiments_constants.Wx.Funnels:experiments_constants.Wx.Trends,syncWithUrl:!1}),{insightProps}=(0,index_esm.useValues)(insightLogicInstance),query=null;experiment.metrics.length>0&&(query={kind:schema_general.OH.InsightVizNode,source:insightType===types.dw.FUNNELS?firstPrimaryMetric.funnels_query:firstPrimaryMetric.count_query});let funnelConversionRate=conversionMetrics?.totalRate*100||0,sliderMaxValue=0;return sliderMaxValue=insightType===types.dw.FUNNELS?100-funnelConversionRate<50?100-funnelConversionRate:50:100,(0,jsx_runtime.jsx)("div",{className:"flex",children:(0,jsx_runtime.jsxs)("div",{className:"w-full",children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 experiment-preview-row",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("b",{children:"Minimum detectable effect"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"The Minimum detectable effect represents the smallest change that you want to be able to detect in your experiment."}),(0,jsx_runtime.jsx)("div",{children:"To make things easier, we initially set this value to a reasonable default. However, we encourage you to review and adjust it based on your specific goals."}),(0,jsx_runtime.jsxs)("div",{children:["Read more in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/experiments/sample-size-running-time#minimum-detectable-effect-mde",children:"documentation."})]})]}),closeDelayMs:200,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary text-base ml-1"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonSlider.j,{value:minimumDetectableEffect,min:1,max:sliderMaxValue,step:1,onChange:value=>{setExperiment({parameters:{...experiment.parameters,minimum_detectable_effect:value}})},className:"w-5/6"}),(0,jsx_runtime.jsx)(src.DF,{className:"w-1/6","data-attr":"min-detectable-effect",type:"number",min:1,max:sliderMaxValue,defaultValue:5,suffix:(0,jsx_runtime.jsx)("span",{children:"%"}),value:minimumDetectableEffect,onChange:value=>{value&&setExperiment({parameters:{...experiment.parameters,minimum_detectable_effect:value}})}})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col experiment-preview-row",children:[(0,jsx_runtime.jsx)(src.Vp,{type:"info",className:"mb-4",children:"The calculations are based on the events received in the last 14 days. This event count may differ from what was considered in earlier estimates."}),insightType===types.dw.TRENDS?(0,jsx_runtime.jsx)(TrendCalculation,{experimentId:experimentId}):(0,jsx_runtime.jsx)(FunnelCalculation,{experimentId:experimentId}),(0,jsx_runtime.jsx)("div",{className:"hidden",children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:insightLogic.zm,props:insightProps,children:(0,jsx_runtime.jsx)(Query.A,{query:query,context:{insightProps},readOnly:!0})})})]})]})})}function DataCollection(){let{experimentId,experiment,getInsightType,funnelResultsPersonsTotal,actualRunningTime,minimumDetectableEffect,firstPrimaryMetric}=(0,index_esm.useValues)(experiments_experimentLogic.W),{openExperimentCollectionGoalModal}=(0,index_esm.useActions)(experiments_experimentLogic.W),insightType=getInsightType(firstPrimaryMetric),recommendedRunningTime=experiment?.parameters?.recommended_running_time||1,recommendedSampleSize=experiment?.parameters?.recommended_sample_size||100,experimentProgressPercent=insightType===types.dw.FUNNELS?funnelResultsPersonsTotal(0)/recommendedSampleSize*100:actualRunningTime/recommendedRunningTime*100,hasHighRunningTime=recommendedRunningTime>62,GoalTooltip=()=>experiment?.parameters?.minimum_detectable_effect?(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{children:`Based on the Minimum detectable effect of ${experiment.parameters.minimum_detectable_effect}%.`}),hasHighRunningTime&&(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Given the current data, this experiment might take a while to reach statistical significance. Please make sure events are being tracked correctly and consider if this timeline works for you."})]}),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary text-base"})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"inline-flex items-center deprecated-space-x-2",children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-0",children:"Data collection"}),(0,jsx_runtime.jsx)(src.u,{title:"Estimated target for the number of participants. Actual data may reveal significance earlier or later than predicted.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary text-base"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsxs)("div",{className:"w-3/5 pr-4",children:[(0,jsx_runtime.jsx)("div",{className:"mt-2 mb-1 font-semibold",children:`${experimentProgressPercent>100?100:experimentProgressPercent.toFixed(2)}% complete`}),(0,jsx_runtime.jsx)(LemonProgress.b,{className:"w-full border",bgColor:"var(--bg-table)",size:"medium",percent:experimentProgressPercent}),insightType===types.dw.TRENDS&&(0,jsx_runtime.jsx)("div",{className:"flex justify-between mt-0",children:(0,jsx_runtime.jsxs)("span",{className:"flex items-center text-xs",children:["Completed ",(0,jsx_runtime.jsxs)("b",{children:[actualRunningTime," of"]}),hasHighRunningTime?(0,jsx_runtime.jsx)("b",{children:"  > 60 days"}):(0,jsx_runtime.jsxs)("span",{children:[" ",(0,jsx_runtime.jsx)("b",{children:recommendedRunningTime})," ",(0,experiments_utils.Du)(recommendedRunningTime,"day")]}),(0,jsx_runtime.jsx)("span",{className:"ml-1 text-xs",children:(0,jsx_runtime.jsx)(GoalTooltip,{})})]})}),insightType===types.dw.FUNNELS&&(0,jsx_runtime.jsx)("div",{className:"flex justify-between mt-0",children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-x-1 flex items-center text-xs",children:[(0,jsx_runtime.jsxs)("span",{children:["Saw ",(0,jsx_runtime.jsxs)("b",{children:[(0,utils.Lc)(funnelResultsPersonsTotal(0))," of"," ",(0,utils.Lc)(recommendedSampleSize)," "]})," ",(0,experiments_utils.Du)(recommendedSampleSize,"participant")]}),(0,jsx_runtime.jsx)(GoalTooltip,{})]})})]}),(0,jsx_runtime.jsx)(src.p2,{className:"my-0",vertical:!0}),(0,jsx_runtime.jsxs)("div",{className:"w-2/5 pl-4",children:[(0,jsx_runtime.jsxs)("div",{className:`text-lg font-semibold ${experiment.end_date?"mt-4":""}`,children:[minimumDetectableEffect,"%"]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs deprecated-space-x-1 text-sm flex",children:[(0,jsx_runtime.jsx)("span",{children:"Minimum detectable effect"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"The Minimum detectable effect represents the smallest change that you want to be able to detect in your experiment."}),(0,jsx_runtime.jsx)("div",{children:"To make things easier, we initially set this value to a reasonable default. However, we encourage you to review and adjust it based on your specific goals."}),(0,jsx_runtime.jsxs)("div",{children:["Read more in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/experiments/sample-size-running-time#minimum-detectable-effect-mde",children:"documentation."})]})]}),closeDelayMs:200,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-secondary text-base"})})]}),!experiment.end_date&&(0,jsx_runtime.jsx)("div",{className:"w-24",children:(0,jsx_runtime.jsx)(src.Jp,{className:"mt-2",size:"xsmall",type:"secondary",onClick:openExperimentCollectionGoalModal,children:(0,jsx_runtime.jsx)("span",{className:"px-0",children:"Edit"})})}),(0,jsx_runtime.jsx)(DataCollectionGoalModal,{experimentId:experimentId})]})]})]})}function DataCollectionGoalModal(_ref){let{experimentId}=_ref,{isExperimentCollectionGoalModalOpen,getInsightType,firstPrimaryMetric,trendMetricInsightLoading,funnelMetricInsightLoading}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),{closeExperimentCollectionGoalModal,updateExperimentCollectionGoal,restoreUnmodifiedExperiment}=(0,index_esm.useActions)((0,experiments_experimentLogic.W)({experimentId})),isInsightLoading=getInsightType(firstPrimaryMetric)===types.dw.TRENDS?trendMetricInsightLoading:funnelMetricInsightLoading;return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isExperimentCollectionGoalModalOpen,onClose:closeExperimentCollectionGoalModal,width:550,title:"Recalculate estimated sample size",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",type:"secondary",onClick:()=>{restoreUnmodifiedExperiment(),closeExperimentCollectionGoalModal()},children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",onClick:()=>{updateExperimentCollectionGoal(),closeExperimentCollectionGoalModal()},type:"primary","data-attr":"create-annotation-submit",children:"Save"})]}),children:isInsightLoading?(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 justify-center items-center mb-6",children:[(0,jsx_runtime.jsx)(LoadingBar.F,{}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-secondary w-60",children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:"Fetching past events for the estimation"}),(0,jsx_runtime.jsx)(components.QT,{})]})]}):(0,jsx_runtime.jsx)(DataCollectionCalculator,{experimentId:experimentId})})}function LegacyExperimentHeader(){return(0,jsx_runtime.jsx)("div",{className:"w-1/2 mt-8 xl:mt-0",children:(0,jsx_runtime.jsx)(DataCollection,{})})}var FeatureFlagReleaseConditions=__webpack_require__("../../frontend/src/scenes/feature-flags/FeatureFlagReleaseConditions.tsx"),groupsModel=__webpack_require__("../../frontend/src/models/groupsModel.ts");function ReleaseConditionsModal(_ref){var _experiment$feature_f,_featureFlag$filters;let{experimentId}=_ref,{experiment,isReleaseConditionsModalOpen}=(0,index_esm.useValues)((0,experiments_experimentLogic.W)({experimentId})),{closeReleaseConditionsModal}=(0,index_esm.useActions)((0,experiments_experimentLogic.W)({experimentId})),_featureFlagLogic=(0,featureFlagLogic.hk)({id:null!==(_experiment$feature_f=experiment.feature_flag?.id)&&void 0!==_experiment$feature_f?_experiment$feature_f:null}),{featureFlag,nonEmptyVariants}=(0,index_esm.useValues)(_featureFlagLogic),{setFeatureFlagFilters,saveSidebarExperimentFeatureFlag}=(0,index_esm.useActions)(_featureFlagLogic);return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isReleaseConditionsModalOpen,onClose:closeReleaseConditionsModal,width:600,title:"Change release conditions",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:closeReleaseConditionsModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{saveSidebarExperimentFeatureFlag(featureFlag),closeReleaseConditionsModal()},type:"primary",children:"Save"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:"Adjusting user targeting may impact the validity of your results. Adjust only if you're aware of how changes will affect your experiment."}),(0,jsx_runtime.jsx)(FeatureFlagReleaseConditions.I,{id:`${experiment.feature_flag?.id}`,filters:null!==(_featureFlag$filters=featureFlag?.filters)&&void 0!==_featureFlag$filters?_featureFlag$filters:[],onChange:setFeatureFlagFilters,nonEmptyFeatureFlagVariants:nonEmptyVariants})]})})}function ReleaseConditionsTable(){let{experiment}=(0,index_esm.useValues)(experiments_experimentLogic.W),{reportExperimentReleaseConditionsViewed,openReleaseConditionsModal}=(0,index_esm.useActions)(experiments_experimentLogic.W),{aggregationLabel}=(0,index_esm.useValues)(groupsModel.$),columns=[{key:"key",title:"",render:function Key(_,_item,index){return(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:`Set ${index+1}`})}},{key:"rollout_percentage",title:"Rollout",render:function Key(_,item){let aggregationTargetName=null!=experiment.filters.aggregation_group_type_index?aggregationLabel(experiment.filters.aggregation_group_type_index).plural:"users",releaseText=`${item.rollout_percentage}% of ${aggregationTargetName}`;return(0,jsx_runtime.jsx)("div",{children:releaseText.startsWith("100% of")?(0,jsx_runtime.jsx)(src.oe,{type:"highlight",children:releaseText}):releaseText})}},{key:"variant",title:"Override",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{children:item.variant||"--"})}}];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2",children:(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg",children:"Release conditions"})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,jsx_runtime.jsx)("div",{className:"ml-auto mb-2",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFlag,{}),onClick:()=>{openReleaseConditionsModal(),reportExperimentReleaseConditionsViewed(experiment.id)},type:"secondary",size:"xsmall",className:"font-semibold",children:"Manage release conditions"})})})]}),(0,jsx_runtime.jsx)(src.g3,{loading:!1,columns:columns,dataSource:experiment.feature_flag?.filters.groups||[]})]})}let ResultsTab=()=>{let{experiment,metricResults,firstPrimaryMetric,primaryMetricsLengthWithSharedMetrics,metricResultsLoading,hasMinimumExposureForResults}=(0,index_esm.useValues)(experiments_experimentLogic.W),hasSomeResults=metricResults?.some(result=>result?.insight),hasSinglePrimaryMetric=1===primaryMetricsLengthWithSharedMetrics;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!hasSomeResults&&!metricResultsLoading&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"web"===experiment.type?(0,jsx_runtime.jsx)(WebExperimentImplementationDetails,{experiment:experiment}):(0,jsx_runtime.jsx)(ExperimentImplementationDetails.aK,{experiment:experiment})}),hasSinglePrimaryMetric&&hasMinimumExposureForResults&&(0,jsx_runtime.jsx)("div",{className:"mb-4 mt-2",children:(0,jsx_runtime.jsx)(Overview,{})}),(0,jsx_runtime.jsx)(MetricsView,{isSecondary:!1}),hasSomeResults&&hasMinimumExposureForResults&&hasSinglePrimaryMetric&&firstPrimaryMetric&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"pb-4",children:(0,jsx_runtime.jsx)(SummaryTable.H,{metric:firstPrimaryMetric,metricIndex:0,isSecondary:!1})}),metricResults?.[0]&&("ExperimentTrendsQuery"===metricResults[0].kind||"ExperimentFunnelsQuery"===metricResults[0].kind)&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(components.lM,{result:metricResults[0],size:"xsmall"})}),(0,jsx_runtime.jsx)("div",{className:"pb-4",children:(0,jsx_runtime.jsx)(components.MN,{result:metricResults?.[0]||null,showTable:!0})})]})]}),(0,jsx_runtime.jsx)(MetricsView,{isSecondary:!0})]})},VariantsTab=()=>(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-8 mt-2",children:[(0,jsx_runtime.jsx)(ReleaseConditionsTable,{}),(0,jsx_runtime.jsx)(DistributionTable,{})]});function ExperimentView(){let{experimentLoading,experimentId,tabKey,shouldUseExperimentMetrics}=(0,index_esm.useValues)(experiments_experimentLogic.W),{setTabKey}=(0,index_esm.useActions)(experiments_experimentLogic.W);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(components.nt,{}),(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-8 experiment-view",children:experimentLoading?(0,jsx_runtime.jsx)(components.Gu,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Info.k,{}),shouldUseExperimentMetrics?(0,jsx_runtime.jsx)(ExperimentHeader,{}):(0,jsx_runtime.jsx)(LegacyExperimentHeader,{}),(0,jsx_runtime.jsx)(src.TP,{activeKey:tabKey,onChange:key=>setTabKey(key),tabs:[{key:"results",label:"Results",content:(0,jsx_runtime.jsx)(ResultsTab,{})},{key:"variants",label:"Variants",content:(0,jsx_runtime.jsx)(VariantsTab,{})}]}),(0,jsx_runtime.jsx)(MetricSourceModal,{experimentId:experimentId,isSecondary:!0}),(0,jsx_runtime.jsx)(MetricSourceModal,{experimentId:experimentId,isSecondary:!1}),shouldUseExperimentMetrics?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ExperimentMetricModal,{experimentId:experimentId,isSecondary:!0}),(0,jsx_runtime.jsx)(ExperimentMetricModal,{experimentId:experimentId,isSecondary:!1}),(0,jsx_runtime.jsx)(ExposureCriteriaModal,{}),(0,jsx_runtime.jsx)(RunningTimeCalculatorModal,{})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LegacyMetricModal,{experimentId:experimentId,isSecondary:!0}),(0,jsx_runtime.jsx)(LegacyMetricModal,{experimentId:experimentId,isSecondary:!1})]}),(0,jsx_runtime.jsx)(SharedMetricModal,{experimentId:experimentId,isSecondary:!0}),(0,jsx_runtime.jsx)(SharedMetricModal,{experimentId:experimentId,isSecondary:!1}),(0,jsx_runtime.jsx)(DistributionModal,{experimentId:experimentId}),(0,jsx_runtime.jsx)(ReleaseConditionsModal,{experimentId:experimentId}),(0,jsx_runtime.jsx)(VariantDeltaTimeseries,{})]})})]})}let scene={component:Experiment,logic:experiments_experimentLogic.W,paramsToProps:_ref=>{let{params:{id}}=_ref;return{experimentId:"new"===id?"new":parseInt(id)}}};function Experiment(){let{experimentId,editingExistingExperiment,experimentMissing}=(0,index_esm.useValues)(experiments_experimentLogic.W);return experimentMissing?(0,jsx_runtime.jsx)(NotFound.T,{object:"experiment"}):"new"===experimentId||editingExistingExperiment?(0,jsx_runtime.jsx)(ExperimentForm,{}):(0,jsx_runtime.jsx)(ExperimentView,{})}},"../../frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{aK:()=>ExperimentImplementationDetails,JY:()=>OPTIONS});var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),types=__webpack_require__("../../frontend/src/types.ts"),CodeSnippet=__webpack_require__("../../frontend/src/lib/components/CodeSnippet/index.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function ServerSideWarning(){return(0,jsx_runtime.jsx)("div",{className:"warning",children:(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("b",{children:"Warning:"})," Server side experiment metrics require you to manually send the feature flag information."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/experiments/adding-experiment-code",target:"_blank",children:"See this tutorial for more information."})]})})}function AndroidSnippet(_ref){let{flagKey,variant}=_ref;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Kotlin,wrap:!0,children:`if (PostHog.getFeatureFlag("${flagKey}") == "${variant}") {
    // do something
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`})})}function IOSSnippet(_ref2){let{flagKey,variant}=_ref2;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Swift,wrap:!0,children:`if (PostHogSDK.shared.getFeatureFlag("${flagKey}") as? String == "${variant}") {
    // do something
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`})})}function NodeJSSnippet(_ref3){let{flagKey,variant}=_ref3;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`const experimentFlagValue = await client.getFeatureFlag('${flagKey}', 'user distinct id')

if (experimentFlagValue === '${variant}' ) {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}function JSSnippet(_ref4){let{flagKey,variant}=_ref4;return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`if (posthog.getFeatureFlag('${flagKey}') === '${variant}') {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)("div",{className:"mt-4 mb-1",children:(0,jsx_runtime.jsx)("b",{children:"Test that it works"})}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`posthog.featureFlags.overrideFeatureFlags({ flags: {'${flagKey}': '${variant}'} })`})]})}function ReactSnippet(_ref5){let{flagKey,variant}=_ref5;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`// You can either use the useFeatureFlagVariantKey hook,
// or you can use the feature flags component - https://posthog.com/docs/libraries/react#feature-flags-react-component

// Method one: using the useFeatureFlagVariantKey hook
import { useFeatureFlagVariantKey } from 'posthog-js/react'

function App() {
    const variant = useFeatureFlagVariantKey('${flagKey}')
    if (variant === '${variant}') {
        // do something
    }
}

// Method two: using the feature flags component
import { PostHogFeature } from 'posthog-js/react'

function App() {
    return (
        <PostHogFeature flag='${flagKey}' match='${variant}'>
            <div>
                {/* the component to show */}
            </div>
        </PostHogFeature>
    )
}

// You can also test your code by overriding the feature flag:
posthog.featureFlags.overrideFeatureFlags({ flags: {'${flagKey}': '${variant}'} })`})})}function RNSnippet(_ref6){let{flagKey,variant}=_ref6;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`if (posthog.getFeatureFlag('${flagKey}') === '${variant}') {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`})})}function PHPSnippet(_ref7){let{flagKey,variant}=_ref7;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.PHP,wrap:!0,children:`if (PostHog::getFeatureFlag('${flagKey}', 'user distinct id') == '${variant}') {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}function GolangSnippet(_ref8){let{flagKey,variant}=_ref8;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Go,wrap:!0,children:`experimentFlagValue, err := client.GetFeatureFlag(
                    FeatureFlagPayload{
                        Key:        '${flagKey}',
                        DistinctId: "distinct-id",
                    })

if (experimentFlagValue == '${variant}' ) {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}function FlutterSnippet(_ref9){let{flagKey,variant}=_ref9,variantSuffix=` == '${variant}'`;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Dart,wrap:!0,children:`if (await Posthog().getFeatureFlag('${flagKey}')${variantSuffix}) {
  // Do something differently for this user
} else {
  // It's a good idea to let control variant always be the default behaviour,
  // so if something goes wrong with flag evaluation, you don't break your app.
}
            `})})}function RubySnippet(_ref10){let{flagKey,variant}=_ref10;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Ruby,wrap:!0,children:`experimentFlagValue = posthog.get_feature_flag('${flagKey}', 'user distinct id')


if experimentFlagValue == '${variant}'
    # Do something differently for this user
else
    # It's a good idea to let control variant always be the default behaviour,
    # so if something goes wrong with flag evaluation, you don't break your app.
end
`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}function PythonSnippet(_ref11){let{flagKey,variant}=_ref11;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Python,wrap:!0,children:`experiment_flag_value = posthog.get_feature_flag("${flagKey}", "user_distinct_id"):

if experiment_flag_value == '${variant}':
    # Do something differently for this user
else:
    # It's a good idea to let control variant always be the default behaviour,
    # so if something goes wrong with flag evaluation, you don't break your app.
`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})}let UTM_TAGS="?utm_medium=in-product&utm_campaign=experiment",DOC_BASE_URL="https://posthog.com/docs/",FF_ANCHOR="#feature-flags",LibraryType=function(LibraryType){return LibraryType.Client="Client",LibraryType.Server="Server",LibraryType}({}),OPTIONS=[{value:"JavaScript",key:types.lh.JS_WEB,documentationLink:`${DOC_BASE_URL}libraries/js${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.RQ,Snippet:JSSnippet,type:LibraryType.Client},{value:"Android",key:types.lh.ANDROID,documentationLink:`${DOC_BASE_URL}libraries/android${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.Kp,Snippet:AndroidSnippet,type:LibraryType.Client},{value:"Go",key:types.lh.GO,documentationLink:`${DOC_BASE_URL}libraries/go${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.GH,Snippet:GolangSnippet,type:LibraryType.Server},{value:"Flutter",key:types.lh.FLUTTER,documentationLink:`${DOC_BASE_URL}libraries/flutter${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.D_,Snippet:FlutterSnippet,type:LibraryType.Client},{value:"iOS",key:types.lh.IOS,documentationLink:`${DOC_BASE_URL}libraries/ios${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.in,Snippet:IOSSnippet,type:LibraryType.Client},{value:"Node.js",key:types.lh.NODE_JS,documentationLink:`${DOC_BASE_URL}libraries/node${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.fS,Snippet:NodeJSSnippet,type:LibraryType.Server},{value:"PHP",key:types.lh.PHP,documentationLink:`${DOC_BASE_URL}libraries/php${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.W7,Snippet:PHPSnippet,type:LibraryType.Server},{value:"Python",key:types.lh.PYTHON,documentationLink:`${DOC_BASE_URL}libraries/python${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.Bm,Snippet:PythonSnippet,type:LibraryType.Server},{value:"React",key:types.lh.REACT,documentationLink:`${DOC_BASE_URL}libraries/react${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.RQ,Snippet:ReactSnippet,type:LibraryType.Client},{value:"ReactNative",key:types.lh.REACT_NATIVE,documentationLink:`${DOC_BASE_URL}libraries/react-native${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.RQ,Snippet:RNSnippet,type:LibraryType.Client},{value:"Ruby",key:types.lh.RUBY,documentationLink:`${DOC_BASE_URL}libraries/ruby${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.gz,Snippet:RubySnippet,type:LibraryType.Server}];function CodeLanguageSelect(_ref){let{selectedOptionValue,selectOption}=_ref;return(0,jsx_runtime.jsx)(src.Yv,{size:"small",className:"min-w-[7.5rem]",onSelect:selectOption,value:selectedOptionValue,options:[{title:"Client libraries",options:OPTIONS.filter(option=>option.type==LibraryType.Client).map(_ref2=>{let{Icon,value}=_ref2;return{value,label:value,labelInMenu:(0,jsx_runtime.jsxs)("div",{className:"flex items-center deprecated-space-x-2",children:[(0,jsx_runtime.jsx)(Icon,{}),(0,jsx_runtime.jsx)("span",{children:value})]})}})},{title:"Server libraries",options:OPTIONS.filter(option=>option.type==LibraryType.Server).map(_ref3=>{let{Icon,value}=_ref3;return{value,label:value,labelInMenu:(0,jsx_runtime.jsxs)("div",{className:"flex items-center deprecated-space-x-2",children:[(0,jsx_runtime.jsx)(Icon,{}),(0,jsx_runtime.jsx)("span",{children:value})]})}})}]})}function ExperimentImplementationDetails(_ref4){var _experiment$parameter,_experiment$feature_f;let{experiment}=_ref4,defaultVariant=null!==(_experiment$parameter=experiment?.parameters?.feature_flag_variants?.[1]?.key)&&void 0!==_experiment$parameter?_experiment$parameter:"test",[currentVariant,setCurrentVariant]=(0,react.useState)(defaultVariant),[defaultSelectedOption]=OPTIONS,[selectedOption,setSelectedOption]=(0,react.useState)(defaultSelectedOption);return(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-2",children:"Implementation"}),(0,jsx_runtime.jsx)("div",{className:"border rounded bg-surface-primary",children:(0,jsx_runtime.jsxs)("div",{className:"p-6 deprecated-space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("span",{className:"mr-2",children:"Variant group"}),(0,jsx_runtime.jsx)(src.Yv,{size:"small",className:"min-w-[5rem]",onSelect:setCurrentVariant,value:currentVariant,options:(experiment?.parameters?.feature_flag_variants||[]).map(variant=>({value:variant.key,label:variant.key}))})]}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(CodeLanguageSelect,{selectOption:selectedValue=>{let option=OPTIONS.find(option=>option.value===selectedValue);option&&setSelectedOption(option)},selectedOptionValue:selectedOption.value})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"mb-1",children:(0,jsx_runtime.jsx)("b",{children:"Implement your experiment in code"})}),(0,jsx_runtime.jsx)("div",{className:"mb-1",children:(0,jsx_runtime.jsx)(selectedOption.Snippet,{variant:currentVariant,flagKey:null!==(_experiment$feature_f=experiment?.feature_flag?.key)&&void 0!==_experiment$feature_f?_experiment$feature_f:""})}),(0,jsx_runtime.jsx)(src.rU,{subtle:!0,to:selectedOption.documentationLink,target:"_blank",children:"See the docs for more implementation information."})]})]})})]})}},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.3_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/experiments/Metrics/TrendsMetricForm.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".trends-metric-form__exposure-button.LemonButton .LemonButton__chrome,.trends-metric-form__exposure-button.LemonButton .LemonButton__content{display:block}",""]),module.exports=exports}}]);
//# sourceMappingURL=12115.1a487093.iframe.bundle.js.map