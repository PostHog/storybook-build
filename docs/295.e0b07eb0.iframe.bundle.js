var Pe=Object.defineProperty,Ke=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var re=(h,j,a)=>j in h?Pe(h,j,{enumerable:!0,configurable:!0,writable:!0,value:a}):h[j]=a,J=(h,j)=>{for(var a in j||(j={}))Fe.call(j,a)&&re(h,a,j[a]);if(ce)for(var a of ce(j))Qe.call(j,a)&&re(h,a,j[a]);return h},de=(h,j)=>Ke(h,Be(j));var I=(h,j,a)=>new Promise((w,L)=>{var K=x=>{try{O(a.next(x))}catch(N){L(N)}},T=x=>{try{O(a.throw(x))}catch(N){L(N)}},O=x=>x.done?w(x.value):Promise.resolve(x.value).then(K,T);O((a=a.apply(h,j)).next())});(window.webpackJsonp=window.webpackJsonp||[]).push([[295],{"./frontend/src/scenes/instance/SystemStatus/index.tsx":function(h,j,a){"use strict";a.r(j),a.d(j,"scene",function(){return Ee}),a.d(j,"SystemStatus",function(){return ie});var w=a("./node_modules/.pnpm/style-loader@2.0.0_webpack@4.46.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),L=a.n(w),K=a("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss"),T=a.n(K),O={};O.insert="head",O.singleton=!1;var x=L()(T.a,O),N=T.a.locals||{},G=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/alert/index.js"),S=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),r=a("./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),d=a("./node_modules/.pnpm/kea@3.0.4_react@16.14.0/node_modules/kea/lib/index.esm.js"),ue=a("./frontend/src/lib/components/PageHeader.tsx"),X=a("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),y=a("./frontend/src/lib/components/icons.tsx"),Z=a("./frontend/src/lib/components/Link.tsx"),v=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),B=a("./frontend/src/lib/utils.tsx"),e=a("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const me=new Set(["last_event_ingested_timestamp"]);function A(n,s){let{key:o,value:t,value_type:i,emptyNullLabel:l,isSecret:u}=s;return t&&u?Object(e.jsx)(v.a,{style:{color:"var(--muted)",backgroundColor:"#fee5b3"},className:"uppercase",icon:u?Object(e.jsx)(y.IconLock,{style:{color:"var(--warning)"}}):void 0,children:"Secret"}):o&&me.has(o)&&typeof t=="string"?new Date(t).getTime()===new Date("1970-01-01T00:00:00").getTime()?"Never":Object(B.O)(t):i==="bool"||typeof t=="boolean"?Object(e.jsx)(v.a,{type:t?"success":"danger",children:t?"Yes":"No"}):t==null||t===""?Object(e.jsx)(v.a,{className:"uppercase",style:{color:"var(--muted)"},children:l!=null?l:"Unknown"}):i==="int"||typeof t=="number"?t.toLocaleString("en-US"):t.toString()}var p=a("./frontend/@posthog/lemon-ui/src/index.ts");const _={async_migrations_ok:"/instance/async_migrations"};function je(n,s){return Object(e.jsxs)("span",{children:[s.metric," ",_[s.key]?Object(e.jsx)(Z.a,{to:_[s.key],children:Object(e.jsx)(y.IconOpenInNew,{style:{verticalAlign:"middle"}})}):null]})}function fe(){const{overview:n,systemStatusLoading:s}=Object(d.useValues)(r.b);return Object(e.jsx)(p.LemonTable,{className:"system-status-table",rowKey:"metric",dataSource:n,columns:[{title:"Metric",className:"metric-column",render:je},{title:"Value",render:A}],loading:s,expandable:{expandedRowRender:function(t){var i;return(i=t.subrows)!==null&&i!==void 0&&i.rows.length?Object(e.jsx)(be,J({},t.subrows)):null},rowExpandable:o=>{var t;return!!((t=o.subrows)!==null&&t!==void 0&&t.rows.length)}}})}function be(n){return Object(e.jsx)(p.LemonTable,{dataSource:n.rows,columns:n.columns.map((s,o)=>({title:s,dataIndex:o})),embedded:!0})}var F=a("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),M=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/collapse/index.js"),ge=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/checkbox/index.js"),U=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/button/index.js"),he=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/table/index.js"),Q=a("./node_modules/.pnpm/@ant-design+icons@4.7.0_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/@ant-design/icons/es/icons/ReloadOutlined.js");function pe(){const{analyzeModalOpen:n,analyzeQuery:s,analyzeQueryResult:o,analyzeQueryResultLoading:t}=Object(d.useValues)(r.b),{setAnalyzeModalOpen:i,setAnalyzeQuery:l,runAnalyzeQuery:u}=Object(d.useActions)(r.b);return Object(e.jsxs)(p.LemonModal,{isOpen:n,title:"Analyze ClickHouse query performance",footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(p.LemonButton,{type:"secondary",onClick:()=>i(!1),children:"Cancel"}),Object(e.jsx)(p.LemonButton,{type:"primary",onClick:()=>void u(),disabled:t,children:"Analyze"})]}),onClose:()=>i(!1),width:"80%",children:[Object(e.jsx)(p.LemonTextArea,{placeholder:"SQL query to analyze",onChange:l,value:s,rows:10}),o&&Object(e.jsxs)("div",{className:"mt-2",children:[Object(e.jsx)("h2",{children:"Analysis results"}),Object(e.jsx)("ul",{children:Object.entries(o.timing).map(c=>{let[m,b]=c;return Object(e.jsxs)("li",{children:[m,": ",b]},m)})}),Object.entries(o.flamegraphs).map(c=>{let[m,b]=c;return Object(e.jsxs)("div",{children:[Object(e.jsxs)("h3",{children:["Flamegraph: ",m]}),Object(e.jsx)("a",{className:"embedded-svg-wrapper",href:`data:image/svg+xml;utf8,${encodeURIComponent(b)}`,dangerouslySetInnerHTML:{__html:b}})]},m)})]})]})}function ye(){const{openSections:n,queries:s,queriesLoading:o,showAnalyzeQueryButton:t}=Object(d.useValues)(r.b),{setOpenSections:i,loadQueries:l}=Object(d.useActions)(r.b),[u,c]=Object(F.useState)(!1),m=Object(F.useMemo)(()=>{var g;return s==null||(g=s.postgres_running)===null||g===void 0?void 0:g.filter(f=>{let{state:D}=f;return u||D!=="idle"})},[u,s]),b=g=>{g.stopPropagation(),l()};return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)(M.a,{activeKey:n,onChange:g=>i(g),children:[Object(e.jsxs)(M.a.Panel,{header:"PostgreSQL - currently running queries",children:[Object(e.jsxs)("div",{className:"mb-4 float-right",children:[Object(e.jsx)(ge.a,{checked:u,onChange:g=>{c(g.target.checked)},children:"Show idle queries"}),Object(e.jsxs)(U.a,{style:{marginLeft:8},onClick:b,children:[Object(e.jsx)(Q.a,{})," Reload Queries"]})]}),Object(e.jsx)(Y,{queries:m,loading:o})]},"1"),(s==null?void 0:s.clickhouse_running)!=null?Object(e.jsxs)(M.a.Panel,{header:"Clickhouse - currently running queries",children:[Object(e.jsx)("div",{className:"mb-4 float-right",children:Object(e.jsxs)(U.a,{style:{marginLeft:8},onClick:b,children:[Object(e.jsx)(Q.a,{})," Reload Queries"]})}),Object(e.jsx)(Y,{queries:s==null?void 0:s.clickhouse_running,loading:o,showAnalyze:t})]},"2"):null,(s==null?void 0:s.clickhouse_slow_log)!=null?Object(e.jsxs)(M.a.Panel,{header:"Clickhouse - slow query log (past 6 hours)",children:[Object(e.jsx)("div",{className:"mb-4 float-right",children:Object(e.jsxs)(U.a,{style:{marginLeft:8},onClick:b,children:[Object(e.jsx)(Q.a,{})," Reload Queries"]})}),Object(e.jsx)(Y,{queries:s==null?void 0:s.clickhouse_slow_log,loading:o,showAnalyze:t})]},"3"):null]}),Object(e.jsx)(pe,{})]})}function Y(n){const{openAnalyzeModalWithQuery:s}=Object(d.useActions)(r.b),o=[{title:"duration",dataIndex:"duration",key:"duration",sorter:(t,i)=>+t.duration-+i.duration},{title:"query",dataIndex:"query",render:function(i,l){let{}=i;return n.showAnalyze?Object(e.jsx)(Z.a,{to:"#",onClick:()=>s(l.query),children:l.query}):l.query},key:"query"}];return n.queries&&n.queries.length>0&&Object.keys(n.queries[0]).forEach(t=>{t!=="duration"&&t!=="query"&&o.push({title:t,dataIndex:t,key:t})}),Object(e.jsx)(he.a,{dataSource:n.queries||[],columns:o,loading:n.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",bordered:!0,style:{overflowX:"auto",overflowY:"auto"},locale:{emptyText:"No queries found"}})}var $=a("./frontend/src/lib/components/LemonTable/index.ts"),xe=a("./frontend/src/lib/hooks/useKeyboardHotkeys.tsx");function V(n){let{key:s,value:o,value_type:t,onValueChanged:i,isSecret:l}=n;if(t==="bool")return Object(e.jsx)(p.LemonCheckbox,{defaultChecked:!!o,onChange:c=>i(s,c),label:Object(e.jsx)(v.a,{type:o?"success":"danger",className:"uppercase",children:o?"Yes":"No"})});const u=l&&o?"":o;return Object(e.jsx)(p.LemonInput,{defaultValue:u,type:t==="int"?"number":"text",placeholder:l&&o?"Keep existing secret value":void 0,onBlur:c=>i(s,c.target.value)})}try{V.displayName="RenderMetricValueEdit",V.__docgenInfo={description:"",displayName:"RenderMetricValueEdit",props:{onValueChanged:{defaultValue:null,description:"",name:"onValueChanged",required:!0,type:{name:"(key: string, value: any) => void"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string | number | boolean | null"}},value_type:{defaultValue:null,description:"",name:"value_type",required:!1,type:{name:"enum",value:[{value:'"bool"'},{value:'"str"'},{value:'"int"'}]}},emptyNullLabel:{defaultValue:null,description:"",name:"emptyNullLabel",required:!1,type:{name:"string"}},isSecret:{defaultValue:null,description:"",name:"isSecret",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"]={docgenInfo:V.__docgenInfo,name:"RenderMetricValueEdit",path:"frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"})}catch(n){}var ee=a("./frontend/src/lib/components/AlertMessage/index.ts");function Oe(n){let{metricKey:s,oldValue:o,value:t,isSecret:i}=n;return(t==null?void 0:t.toString())===(o==null?void 0:o.toString())?null:Object(e.jsxs)("div",{className:"bg-border-light radius p-2",children:[Object(e.jsx)("div",{children:Object(e.jsx)("code",{children:s})}),Object(e.jsxs)("div",{className:"text-muted",children:["Value will be changed",!i&&Object(e.jsxs)(e.Fragment,{children:[" from ",Object(e.jsx)("span",{className:"font-bold text-default",children:A(null,{key:s,value:o,emptyNullLabel:"Unset",isSecret:i})})]})," to ",Object(e.jsx)("span",{className:"font-bold text-default",children:A(null,{key:s,value:t,emptyNullLabel:"Unset"})}),i&&Object(e.jsx)("div",{className:"text-danger",children:"This field is secret - you won't see its value once saved"})]})]})}function E(n){let{onClose:s,isOpen:o}=n;const{instanceConfigEditingState:t,editableInstanceSettings:i,updatedInstanceConfigCount:l}=Object(d.useValues)(r.b),{saveInstanceConfig:u}=Object(d.useActions)(r.b),c=l!==null;return Object(e.jsx)(p.LemonModal,{title:"Confirm new changes",isOpen:o,closable:!c,onClose:s,footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(p.LemonButton,{type:"secondary",onClick:s,loading:c,children:"Cancel"}),Object(e.jsx)(p.LemonButton,{type:"primary",status:"danger",loading:c,onClick:u,children:"Apply changes"})]}),children:Object(e.jsxs)("div",{className:"space-y-2",children:[Object.keys(t).find(m=>m.startsWith("EMAIL"))&&Object(e.jsx)(ee.a,{type:"info",children:Object(e.jsxs)(e.Fragment,{children:["As you are changing email settings, we'll attempt to send a ",Object(e.jsx)("b",{children:"test email"})," so you can verify everything works (unless you are turning email off)."]})}),Object.keys(t).includes("RECORDINGS_TTL_WEEKS")&&Object(e.jsx)(ee.a,{type:"warning",children:Object(e.jsx)(e.Fragment,{children:"Changing your recordings TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately."})}),Object(e.jsx)("div",{children:"The following changes will be immediately applied to your instance."}),Object.keys(t).map(m=>{var b,g;return Object(e.jsx)(Oe,{metricKey:m,value:t[m],oldValue:(b=i.find(f=>f.key===m))===null||b===void 0?void 0:b.value,isSecret:(g=i.find(f=>f.key===m))===null||g===void 0?void 0:g.is_secret},m)}),c&&Object(e.jsx)("div",{className:"mt-4 text-success",children:Object(e.jsxs)("b",{children:[Object(B.tb)(l||0,"change")," updated successfully."]})})]})})}try{E.displayName="InstanceConfigSaveModal",E.__docgenInfo={description:"",displayName:"InstanceConfigSaveModal",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"]={docgenInfo:E.__docgenInfo,name:"InstanceConfigSaveModal",path:"frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"})}catch(n){}function ve(){const{configOptions:n,preflightLoading:s}=Object(d.useValues)(X.a),{editableInstanceSettings:o,instanceSettingsLoading:t,instanceConfigMode:i,instanceConfigEditingState:l}=Object(d.useValues)(r.b),{loadInstanceSettings:u,setInstanceConfigMode:c,updateInstanceConfigValue:m,clearInstanceConfigEditing:b}=Object(d.useActions)(r.b);Object(F.useEffect)(()=>{u()},[]),Object(xe.a)({e:{action:()=>c(r.a.Edit),disabled:i!==r.a.View||t},escape:{action:()=>f(),disabled:i!==r.a.Edit||t},enter:{action:()=>g(),disabled:i!==r.a.Edit||t}});const g=()=>{Object.keys(l).length?c(r.a.Saving):c(r.a.View)},f=()=>{c(r.a.View),b()},D=[{title:"Key",dataIndex:"key",render:function(W){return Object(e.jsx)("code",{children:W})}},{title:"Description",dataIndex:"description"},{title:"Value",render:function(W,k){var q;const le={value:k.value,key:k.key,emptyNullLabel:"Unset",value_type:k.value_type,isSecret:k.is_secret};return i===r.a.View?A(W,le):V(de(J({},le),{value:(q=l[k.key])!==null&&q!==void 0?q:k.value,onValueChanged:m}))}}],Re=[{key:"metric",title:"Metric",dataIndex:"metric"},{title:"Value",dataIndex:"value"}];return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[Object(e.jsxs)("div",{className:"flex-1",children:[Object(e.jsx)("h3",{children:"Instance configuration"}),Object(e.jsxs)("div",{children:["Changing these settings will take effect on your entire instance."," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings",target:"_blank",children:["Learn more ",Object(e.jsx)(y.IconOpenInNew,{style:{verticalAlign:"middle"}})]}),"."]})]}),i===r.a.View?Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(p.LemonButton,{type:"primary",onClick:()=>c(r.a.Edit),"data-attr":"instance-config-edit-button",disabled:t,children:"Edit"})}):Object(e.jsxs)(e.Fragment,{children:[Object.keys(l).length>0&&Object(e.jsxs)("span",{className:"text-warning-dark flex items-center gap-2",children:[Object(e.jsx)(y.IconWarning,{className:"text-lg"})," You have"," ",Object(e.jsx)("b",{children:Object.keys(l).length})," unapplied"," ",Object(B.tb)(Object.keys(l).length,"change",void 0,!1)]}),Object(e.jsx)(p.LemonButton,{type:"secondary",disabled:t,onClick:f,children:"Discard changes"}),Object(e.jsx)(p.LemonButton,{type:"primary",disabled:t,onClick:g,children:"Save"})]})]}),Object(e.jsx)($.a,{dataSource:o,columns:D,loading:t,rowKey:"key"}),Object(e.jsxs)("div",{className:"my-4",children:[Object(e.jsx)("h3",{children:"Environment configuration"}),Object(e.jsxs)("div",{children:["These settings can only be modified by environment variables."," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/environment-variables",target:"_blank",children:["Learn more ",Object(e.jsx)(y.IconOpenInNew,{style:{verticalAlign:"middle"}})]}),"."]})]}),Object(e.jsx)($.a,{dataSource:n,columns:Re,loading:s,rowKey:"key"}),Object(e.jsx)(E,{isOpen:i===r.a.Saving,onClose:()=>c(r.a.Edit)})]})}var R=a("./frontend/src/scenes/userLogic.ts"),Se=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/modal/index.js"),te=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/divider/index.js"),ke=a("./frontend/src/lib/components/ProfilePicture/index.ts"),Ie=a("./node_modules/.pnpm/kea-router@3.1.3_kea@3.0.4/node_modules/kea-router/lib/index.js"),z=a("./frontend/src/lib/api.ts"),we=a("./frontend/src/scenes/urls.ts");const se=Object(d.kea)({path:["scenes","instance","SystemStatus","staffUsersLogic"],connect:{values:[R.a,["user"]],actions:[R.a,["loadUser"]]},actions:{setStaffUsersToBeAdded:n=>({userUuids:n}),addStaffUsers:!0,deleteStaffUser:n=>({userUuid:n})},reducers:{staffUsersToBeAdded:[[],{setStaffUsersToBeAdded:(n,s)=>{let{userUuids:o}=s;return o}}]},loaders:n=>{let{actions:s,values:o}=n;return{allUsers:[[],{loadAllUsers:()=>I(this,null,function*(){var t;return(t=(yield z.b.get("api/users")).results)!==null&&t!==void 0?t:[]}),addStaffUsers:()=>I(this,null,function*(){const{staffUsersToBeAdded:t,allUsers:i}=o;s.setStaffUsersToBeAdded([]);const l=yield Promise.all(t.map(c=>I(this,null,function*(){return yield z.b.update(`api/users/${c}`,{is_staff:!0})}))),u=[...i.filter(c=>{let{uuid:m}=c;return!t.includes(m)}),...l];return u.sort((c,m)=>c.first_name.localeCompare(m.first_name)),u}),deleteStaffUser:t=>I(this,null,function*(){var i;let{userUuid:l}=t;yield z.b.update(`api/users/${l}`,{is_staff:!1}),((i=o.user)===null||i===void 0?void 0:i.uuid)===l&&(s.loadUser(),Ie.router.actions.push(we.a.projectHomepage()));const u=[...o.allUsers];for(const c of u)c.uuid===l&&(c.is_staff=!1);return u})}]}},selectors:{staffUsers:[n=>[n.allUsers],n=>n.filter(s=>s.is_staff)],nonStaffUsers:[n=>[n.allUsers],n=>n.filter(s=>!s.is_staff)]},events:n=>{let{actions:s}=n;return{afterMount:[s.loadAllUsers]}}});var ne=a("./frontend/src/lib/components/LemonButton/index.ts"),Ce=a("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),Le=a("./frontend/src/lib/components/UserSelectItem.tsx");function Te(){const{user:n}=Object(d.useValues)(R.a),{staffUsers:s,allUsersLoading:o,nonStaffUsers:t,staffUsersToBeAdded:i}=Object(d.useValues)(se),{setStaffUsersToBeAdded:l,addStaffUsers:u,deleteStaffUser:c}=Object(d.useActions)(se),m=[{key:"profile_picture",render:function(g,f){return Object(e.jsx)(ke.b,{name:f.first_name,email:f.email})},width:32},{key:"name",title:"Name",dataIndex:"first_name",render:function(g,f){return Object(e.jsxs)(e.Fragment,{children:[f.first_name,f.uuid===(n==null?void 0:n.uuid)&&Object(e.jsx)(v.a,{className:"uppercase ml-1",children:"Me"})]})}},{key:"email",title:"Email",dataIndex:"email"},{key:"actions",width:32,render:function(g,f){return Object(e.jsx)(ne.a,{"data-attr":"invite-delete",icon:Object(e.jsx)(y.IconDelete,{}),status:"danger",disabled:s.length<2,title:s.length<2?"You should always have at least one staff user.":"Cancel the invite",onClick:()=>{Se.a.confirm({title:`Remove ${(n==null?void 0:n.uuid)===f.uuid?"yourself":f.first_name} as a Staff User?`,icon:null,okText:"Remove user",okType:"primary",okButtonProps:{className:"btn-danger"},content:Object(e.jsx)("div",{style:{border:""},children:(n==null?void 0:n.uuid)===f.uuid?Object(e.jsxs)(e.Fragment,{children:["Please confirm you want to ",Object(e.jsx)("b",{children:"remove yourself"})," as a staff user.",Object(e.jsx)("div",{style:{fontWeight:"normal",color:"var(--muted-alt)"},children:"Only another staff user will be able to add you again."})]}):`Are you sure you want to remove ${f.first_name} as a Staff User?`}),onOk(){c(f.uuid)},cancelText:"Cancel"})}})}}];return Object(e.jsxs)("div",{children:[Object(e.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Staff Users"}),Object(e.jsxs)("div",{className:"mb-4",children:["Users who have permissions to manage instance-wide settings. Staff user permissions are set at the"," ",Object(e.jsx)("b",{children:"instance-level and are independent of any organization or project permissions."})," ",Object(e.jsxs)("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings#staff-users",target:"_blank",children:["Learn more ",Object(e.jsx)(y.IconOpenInNew,{style:{verticalAlign:"middle"}})]}),"."]}),Object(e.jsx)(te.a,{style:{margin:0,marginBottom:16}}),Object(e.jsx)("section",{children:Object(e.jsxs)("div",{className:"flex gap-2 mb-4",children:[Object(e.jsx)("div",{style:{flex:1},children:Object(e.jsx)(Ce.a,{placeholder:"Add staff users here\u2026",loading:o,value:i,onChange:b=>l(b),filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:Object(Le.a)(t,"uuid")})}),Object(e.jsx)(ne.a,{type:"primary",loading:o,disabled:i.length===0,onClick:u,children:"Add"})]})}),Object(e.jsx)($.a,{dataSource:s,columns:m,loading:o,rowKey:"uuid"})]})}var Ne=a("./frontend/src/lib/logic/featureFlagLogic.ts"),Ae=a("./frontend/src/lib/constants.tsx"),Me=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/row/index.js"),P=a("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/col/index.js"),ae=a("./frontend/src/lib/components/CodeSnippet/index.tsx"),C=a("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.0.4/node_modules/kea-forms/lib/index.js"),Ue=a("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.0.4/node_modules/kea-loaders/lib/index.js");const oe=Object(d.kea)([Object(d.path)(["scenes","instance","SystemStatus","kafkaInspectorLogic"]),Object(d.actions)({fetchKafkaMessage:(n,s,o)=>({topic:n,partition:s,offset:o})}),Object(Ue.loaders)({kafkaMessage:[null,{fetchKafkaMessage:n=>I(this,null,function*(){let{topic:s,partition:o,offset:t}=n;return yield z.b.create("api/kafka_inspector/fetch_message",{topic:s,partition:o,offset:t})})}]}),Object(C.forms)(n=>{let{actions:s}=n;return{fetchKafkaMessage:{defaults:{topic:"clickhouse_events_json",partition:0,offset:0},submit:o=>{let{topic:t,partition:i,offset:l}=o;s.fetchKafkaMessage(t,Number(i),Number(l))}}}})]);var H=a("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function Ve(){const{kafkaMessage:n}=Object(d.useValues)(oe);return Object(e.jsxs)("div",{children:[Object(e.jsx)("h3",{className:"l3",style:{marginTop:16},children:"Kafka Inspector"}),Object(e.jsx)("div",{className:"mb-4",children:"Debug Kafka messages using the inspector tool."}),Object(e.jsx)(te.a,{style:{margin:0,marginBottom:16}}),Object(e.jsx)("section",{children:Object(e.jsx)("div",{style:{display:"flex",marginBottom:"0.75rem"},children:Object(e.jsx)(C.Form,{logic:oe,formKey:"fetchKafkaMessage",className:"ant-form-horizontal ant-form-hide-required-mark",enableFormOnSubmit:!0,children:Object(e.jsxs)(Me.a,{gutter:[24,24],children:[Object(e.jsx)(P.a,{span:8,children:Object(e.jsx)(C.Field,{name:"topic",children:Object(e.jsx)(H.a,{placeholder:"Topic"})})}),Object(e.jsxs)(P.a,{span:4,children:[Object(e.jsx)(C.Field,{name:"partition",children:Object(e.jsx)(H.a,{placeholder:"Partition",type:"number"})})," "]}),Object(e.jsxs)(P.a,{span:4,children:[Object(e.jsx)(C.Field,{name:"offset",children:Object(e.jsx)(H.a,{placeholder:"Offset",type:"number"})})," "]}),Object(e.jsx)(P.a,{span:6,children:Object(e.jsxs)(U.a,{htmlType:"submit",type:"primary","data-attr":"fetch-kafka-message-submit-button",children:["Fetch message"," "]})})]})})})}),Object(e.jsx)(ae.a,{language:ae.b.JSON,children:n?JSON.stringify(n,null,4):`
`})]})}const Ee={component:ie,logic:r.b};function ie(){const{tab:n,error:s}=Object(d.useValues)(r.b),{setTab:o}=Object(d.useActions)(r.b),{preflight:t,siteUrlMisconfigured:i}=Object(d.useValues)(X.a),{user:l}=Object(d.useValues)(R.a),{featureFlags:u}=Object(d.useValues)(Ne.a);return Object(e.jsxs)("div",{className:"system-status-scene",children:[Object(e.jsx)(ue.a,{title:"Instance status & settings",caption:Object(e.jsxs)(e.Fragment,{children:["Here you can find all the critical runtime details and settings of your PostHog instance. You have access to this because you're a ",Object(e.jsx)("b",{children:"staff user"}),"."," ",Object(e.jsxs)("a",{target:"_blank",style:{display:"inline-flex",alignItems:"center"},href:"https://posthog.com/docs/self-host/configure/instance-settings?utm_medium=in-product&utm_campaign=instance_status",children:["Learn more ",Object(e.jsx)(y.IconOpenInNew,{style:{marginLeft:4}})]}),"."]})}),s&&Object(e.jsx)(G.a,{message:"Something went wrong",description:s||Object(e.jsx)("span",{children:"An unknown error occurred. Please try again or contact us."}),type:"error",showIcon:!0}),i&&Object(e.jsx)(G.a,{message:"Misconfiguration detected",description:Object(e.jsxs)(e.Fragment,{children:["Your ",Object(e.jsx)("code",{children:"SITE_URL"})," environment variable seems misconfigured. Your"," ",Object(e.jsx)("code",{children:"SITE_URL"})," is set to"," ",Object(e.jsx)("b",{children:Object(e.jsx)("code",{children:t==null?void 0:t.site_url})})," ","but you're currently browsing this page from"," ",Object(e.jsx)("b",{children:Object(e.jsx)("code",{children:window.location.origin})}),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."," ",Object(e.jsxs)("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig",children:["Learn more ",Object(e.jsx)(y.IconOpenInNew,{})]})]}),showIcon:!0,type:"warning",style:{marginBottom:32}}),Object(e.jsxs)(S.a,{tabPosition:"top",animated:!1,activeKey:n,onTabClick:c=>o(c),children:[Object(e.jsx)(S.a.TabPane,{tab:"System overview",children:Object(e.jsx)(fe,{})},"overview"),(l==null?void 0:l.is_staff)&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(S.a.TabPane,{tab:"Internal metrics",children:Object(e.jsx)(ye,{})},"metrics"),Object(e.jsx)(S.a.TabPane,{tab:Object(e.jsxs)(e.Fragment,{children:["Settings"," ",Object(e.jsx)(v.a,{type:"warning",className:"uppercase",children:"Beta"})]}),children:Object(e.jsx)(ve,{})},"settings")]}),(l==null?void 0:l.is_staff)&&Object(e.jsx)(S.a.TabPane,{tab:Object(e.jsx)(e.Fragment,{children:"Staff Users"}),children:Object(e.jsx)(Te,{})},"staff_users"),(l==null?void 0:l.is_staff)&&u[Ae.i.KAFKA_INSPECTOR]&&Object(e.jsx)(S.a.TabPane,{tab:Object(e.jsxs)(e.Fragment,{children:["Kafka Inspector"," ",Object(e.jsx)(v.a,{type:"warning",className:"uppercase",children:"Beta"})]}),children:Object(e.jsx)(Ve,{})},"kafka_inspector")]})]})}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss":function(h,j,a){var w=a("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js");j=w(!1),j.push([h.i,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}.embedded-svg-wrapper{cursor:text}.embedded-svg-wrapper svg{width:100%;height:100%}",""]),h.exports=j}}]);
