(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[90710],{"./frontend/src/scenes/max/Max.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Max:()=>Max_Max,MaxInstance:()=>MaxInstance,scene:()=>scene});var injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),Max=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/max/Max.scss"),Max_default=__webpack_require__.n(Max),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(Max_default(),options),Max_default().locals;var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),HedgehogBuddy=__webpack_require__("./frontend/src/lib/components/HedgehogBuddy/HedgehogBuddy.tsx"),hedgehogBuddyLogic=__webpack_require__("./frontend/src/lib/components/HedgehogBuddy/hedgehogBuddyLogic.ts"),maxLogic=__webpack_require__("./frontend/src/scenes/max/maxLogic.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let HEADLINES=["How can I help you build?","What are you curious about?","How can I help you understand users?","What do you want to know today?"];function Intro(){let{hedgehogConfig}=(0,index_esm.useValues)(hedgehogBuddyLogic.r),{sessionId}=(0,index_esm.useValues)(maxLogic.v),headline=(0,react.useMemo)(()=>HEADLINES[parseInt(sessionId.split("-").at(-1),16)%HEADLINES.length],[]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex",children:(0,jsx_runtime.jsx)(HedgehogBuddy.CV,{static:!0,hedgehogConfig:{...hedgehogConfig,walking_enabled:!1,controls_enabled:!1},onClick:actor=>{.01>Math.random()?actor.setOnFire():actor.setRandomAnimation()},onActorLoaded:actor=>setTimeout(()=>actor.setAnimation("wave"),100)})}),(0,jsx_runtime.jsxs)("div",{className:"text-center mb-2",children:[(0,jsx_runtime.jsx)("h2",{className:"text-2xl font-bold mb-2 text-balance",children:headline}),(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"I'm Max, here to help you build a succesful product. Ask me about your product and your users."})]})]})}var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.8.5_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js");function QuestionInput(){let{question,thread,threadLoading}=(0,index_esm.useValues)(maxLogic.v),{askMax,setQuestion}=(0,index_esm.useActions)(maxLogic.v),textAreaRef=(0,react.useRef)(null),isFloating=thread.length>0;return(0,react.useEffect)(()=>{threadLoading||textAreaRef.current?.focus()},[threadLoading]),(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("w-full",isFloating?"max-w-200 sticky z-10 self-center p-1 mx-3 mb-3 bottom-3 border border-[var(--glass-border-3000)] rounded-[0.625rem] backdrop-blur bg-[var(--glass-bg-3000)]":"w-[min(40rem,100%)] relative"),children:[(0,jsx_runtime.jsx)(src._V,{ref:textAreaRef,value:question,onChange:value=>setQuestion(value),placeholder:threadLoading?"Thinking…":isFloating?"Ask follow-up":"Ask away",onPressEnter:()=>{question&&askMax(question)},disabled:threadLoading,minRows:1,maxRows:10,className:(0,clsx_m.default)("p-3",isFloating&&"border-border-bold")}),(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("absolute top-0 bottom-0 flex items-center",isFloating?"right-3":"right-2"),children:(0,jsx_runtime.jsx)(src.Jp,{type:isFloating&&!question?"secondary":"primary",onClick:()=>askMax(question),tooltip:"Let's go!",disabledReason:question?threadLoading?"Thinking…":void 0:"I need some input first",size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowRight,{})})})]})}function QuestionSuggestions(){let{visibleSuggestions,wasSuggestionLoadingInitiated,allSuggestionsLoading}=(0,index_esm.useValues)(maxLogic.v),{askMax,loadSuggestions,shuffleVisibleSuggestions}=(0,index_esm.useActions)(maxLogic.v);return(0,react.useEffect)(()=>{wasSuggestionLoadingInitiated||loadSuggestions()},[wasSuggestionLoadingInitiated,loadSuggestions]),(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center gap-2 min-w-full",children:visibleSuggestions?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[visibleSuggestions.map((suggestion,index)=>(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>askMax(suggestion),size:"xsmall",type:"secondary",sideIcon:(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowUpRight,{}),children:suggestion},index)),(0,jsx_runtime.jsx)(src.Jp,{onClick:shuffleVisibleSuggestions,size:"xsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconShuffle,{}),tooltip:"Shuffle suggestions"})]}):allSuggestionsLoading?Array.from({length:4}).map((_,index)=>(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",type:"secondary",disabled:!0,style:{flexGrow:[2,1.5,3,1][index]},children:(0,jsx_runtime.jsx)(src.yW,{className:"h-3 w-full"})},index)):null})}var InsightDetails=__webpack_require__("./frontend/src/lib/components/Cards/InsightCard/InsightDetails.tsx"),TopHeading=__webpack_require__("./frontend/src/lib/components/Cards/InsightCard/TopHeading.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),dist_module=__webpack_require__("./node_modules/.pnpm/posthog-js@1.174.2/node_modules/posthog-js/dist/module.js"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),schema=__webpack_require__("./frontend/src/queries/schema.ts");function Thread(){let{thread,threadLoading}=(0,index_esm.useValues)(maxLogic.v);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-stretch w-full max-w-200 self-center gap-2 grow m-4",children:[thread.map((message,index)=>"user"===message.role||"string"==typeof message.content?(0,jsx_runtime.jsx)(Message,{role:message.role,className:"error"===message.status?"border-danger":void 0,children:message.content||(0,jsx_runtime.jsx)("i",{children:"No text"})},index):(0,jsx_runtime.jsx)(Answer,{message:message,previousMessage:thread[index-1]},index)),threadLoading&&(0,jsx_runtime.jsx)(Message,{role:"assistant",className:"w-fit select-none",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:["Let me think…",(0,jsx_runtime.jsx)(src.$j,{className:"text-xl"})]})})]})}let Message=react.forwardRef(function Message(_ref,ref){let{role,children,className}=_ref;return"user"===role?(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("mt-1 mb-3 text-2xl font-medium",className),ref:ref,children:children}):(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("border p-2 rounded bg-bg-light",className),ref:ref,children:children})});function Answer(_ref2){let{message,previousMessage}=_ref2,query={kind:schema.OH.InsightVizNode,source:message.content?.answer,showHeader:!0};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[message.content?.reasoning_steps&&(0,jsx_runtime.jsx)(Message,{role:message.role,children:(0,jsx_runtime.jsx)("ul",{className:"list-disc ml-4",children:message.content.reasoning_steps.map((step,index)=>(0,jsx_runtime.jsx)("li",{children:step},index))})}),"completed"===message.status&&message.content?.answer&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(Message,{role:message.role,children:[(0,jsx_runtime.jsx)("div",{className:"h-96 flex",children:(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,embedded:!0})}),(0,jsx_runtime.jsxs)("div",{className:"relative mb-1",children:[(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.insightNew(void 0,void 0,query),sideIcon:(0,jsx_runtime.jsx)(icons.pF,{}),size:"xsmall",targetBlank:!0,className:"absolute right-0 -top-px",children:"Open as new insight"}),(0,jsx_runtime.jsx)(InsightDetails.qH,{query:query.source,heading:(0,jsx_runtime.jsx)(TopHeading.l,{query:query})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4 mt-1 *:grow",children:[(0,jsx_runtime.jsx)(InsightDetails.g4,{properties:query.source.properties}),(0,jsx_runtime.jsx)(InsightDetails.d8,{query:query.source})]})]})]}),(0,jsx_runtime.jsx)(AnswerActions,{message:message,previousMessage:previousMessage})]})]})}function AnswerActions(_ref3){let{message,previousMessage}=_ref3,[rating,setRating]=(0,react.useState)(null),[feedback,setFeedback]=(0,react.useState)(""),[feedbackInputStatus,setFeedbackInputStatus]=(0,react.useState)("hidden"),hasScrolledFeedbackInputIntoView=(0,react.useRef)(!1);function submitRating(newRating){rating||(setRating(newRating),dist_module.ZP.capture("chat rating",{question:previousMessage.content,answer:message.content,answer_rating:rating}),"bad"===newRating&&setFeedbackInputStatus("pending"))}function submitFeedback(){feedback&&(dist_module.ZP.capture("chat feedback",{question:previousMessage.content,answer:message.content,feedback}),setFeedbackInputStatus("submitted"))}return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:["bad"!==rating&&(0,jsx_runtime.jsx)(src.Jp,{icon:"good"===rating?(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsUpFilled,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsUp,{}),type:"tertiary",size:"small",tooltip:"Good answer",onClick:()=>submitRating("good")}),"good"!==rating&&(0,jsx_runtime.jsx)(src.Jp,{icon:"bad"===rating?(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsDownFilled,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsDown,{}),type:"tertiary",size:"small",tooltip:"Bad answer",onClick:()=>submitRating("bad")})]}),"hidden"!==feedbackInputStatus&&(0,jsx_runtime.jsxs)(Message,{role:"assistant",ref:el=>{el&&!hasScrolledFeedbackInputIntoView.current&&(el.scrollIntoView({behavior:"smooth"}),hasScrolledFeedbackInputIntoView.current=!0)},children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("h4",{className:"m-0 text-sm grow",children:"pending"===feedbackInputStatus?"What disappointed you about the answer?":"Thank you for your feedback!"}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),type:"tertiary",size:"xsmall",onClick:()=>setFeedbackInputStatus("hidden")})]}),"pending"===feedbackInputStatus&&(0,jsx_runtime.jsxs)("div",{className:"flex w-full gap-2 items-center mt-1.5",children:[(0,jsx_runtime.jsx)(src.DF,{placeholder:"Help us improve Max…",fullWidth:!0,value:feedback,onChange:newValue=>setFeedback(newValue),onPressEnter:()=>submitFeedback(),autoFocus:!0}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>submitFeedback(),disabledReason:feedback?void 0:"Please type a few words!",children:"Submit"})]})]})]})}let scene={component:Max_Max};function Max_Max(){let{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.h),sessionId=(0,react.useMemo)(()=>(0,utils.Vj)(),[]);return featureFlags[constants.y8.ARTIFICIAL_HOG]?(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:maxLogic.v,props:{sessionId},children:(0,jsx_runtime.jsx)(MaxInstance,{})}):(0,jsx_runtime.jsx)(NotFound.T,{object:"page",caption:"You don't have access to AI features yet."})}function MaxInstance(){let{thread}=(0,index_esm.useValues)(maxLogic.v);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:thread.length?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Thread,{}),(0,jsx_runtime.jsx)(QuestionInput,{})]}):(0,jsx_runtime.jsxs)("div",{className:"relative flex flex-col gap-4 px-4 items-center grow justify-center",children:[(0,jsx_runtime.jsx)(Intro,{}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-3 items-center w-[min(40rem,100%)]",children:[(0,jsx_runtime.jsx)(QuestionInput,{}),(0,jsx_runtime.jsx)(QuestionSuggestions,{})]})]})})}},"./frontend/src/scenes/max/maxLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{v:()=>maxLogic}),__webpack_require__("./node_modules/.pnpm/d3@7.8.2/node_modules/d3/src/index.js");var kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts"),_queries_schema__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/queries/schema.ts");let maxLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","max","maxLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.key)(_ref=>{let{sessionId}=_ref;return sessionId}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({askMax:prompt=>({prompt}),setThreadLoaded:function(){let testOnlyOverride=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{testOnlyOverride}},addMessage:message=>({message}),replaceMessage:(index,message)=>({index,message}),setMessageStatus:(index,status)=>({index,status}),setQuestion:question=>({question}),setVisibleSuggestions:suggestions=>({suggestions}),shuffleVisibleSuggestions:!0}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)({question:["",{setQuestion:(_,_ref2)=>{let{question}=_ref2;return question},askMax:()=>""}],thread:[[],{addMessage:(state,_ref3)=>{let{message}=_ref3;return[...state,message]},replaceMessage:(state,_ref4)=>{let{message,index}=_ref4;return[...state.slice(0,index),message,...state.slice(index+1)]},setMessageStatus:(state,_ref5)=>{let{index,status}=_ref5;return[...state.slice(0,index),{...state[index],status},...state.slice(index+1)]}}],threadLoading:[!1,{askMax:()=>!0,setThreadLoaded:(_,_ref6)=>{let{testOnlyOverride}=_ref6;return testOnlyOverride}}],wasSuggestionLoadingInitiated:[!1,{loadSuggestions:()=>!0}],visibleSuggestions:[null,{setVisibleSuggestions:(_,_ref7)=>{let{suggestions}=_ref7;return suggestions}}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_2__.loaders)({allSuggestions:[null,{loadSuggestions:async()=>{let response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.query({kind:_queries_schema__WEBPACK_IMPORTED_MODULE_4__.OH.SuggestedQuestionsQuery});return response.questions}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)(_ref8=>{let{actions,values,props}=_ref8;return{loadSuggestionsSuccess:()=>{actions.shuffleVisibleSuggestions()},shuffleVisibleSuggestions:()=>{if(!values.allSuggestions)throw Error("No question suggestions to shuffle");let allSuggestionsWithoutCurrentlyVisible=values.allSuggestions.filter(suggestion=>!values.visibleSuggestions?.includes(suggestion));actions.setVisibleSuggestions(allSuggestionsWithoutCurrentlyVisible.slice(0,3))},askMax:async _ref9=>{let{prompt}=_ref9;actions.addMessage({role:"user",content:prompt});let newIndex=values.thread.length;try{let response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.chat({session_id:props.sessionId,messages:values.thread.map(_ref10=>{let{role,content}=_ref10;return{role,content:"string"==typeof content?content:JSON.stringify(content)}})}),reader=response.body?.getReader(),decoder=new TextDecoder;if(reader){let firstChunk=!0;for(;;){let{done,value}=await reader.read();if(done){actions.setMessageStatus(newIndex,"completed");break}let text=decoder.decode(value),parsedResponse=function parseResponse(response){let recursive=!(arguments.length>1)||void 0===arguments[1]||arguments[1];try{let parsed=JSON.parse(response);return parsed}catch{if(!recursive)return null;let results=[],pair=[0,0],seq=0;for(let i=0;i<response.length;i++){let char=response[i];"{"===char&&(0===seq&&(pair[0]=i),seq+=1),"}"===char&&0==(seq-=1)&&(pair[1]=i),0===seq&&(results.push(pair),pair=[0,0])}let lastPair=results.pop();if(lastPair){let[left,right]=lastPair;return parseResponse(response.slice(left,right+1),!1)}return null}}(text);firstChunk?(firstChunk=!1,parsedResponse&&actions.addMessage({role:"assistant",content:parsedResponse,status:"loading"})):parsedResponse&&actions.replaceMessage(newIndex,{role:"assistant",content:parsedResponse,status:"loading"})}}}catch{actions.setMessageStatus(values.thread.length-1===newIndex?newIndex:newIndex-1,"error")}actions.setThreadLoaded()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.selectors)({sessionId:[(_,p)=>[p.sessionId],sessionId=>sessionId]})])},"./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.4.31_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!./frontend/src/scenes/max/Max.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".InsightVizDisplay{flex:1}",""]),module.exports=exports}}]);