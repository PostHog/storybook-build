"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[45013],{"./frontend/src/scenes/experiments/Experiment.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Experiment:()=>Experiment,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.9.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5/node_modules/kea-forms/lib/index.js"),SeriesGlyph=__webpack_require__("./frontend/src/lib/components/SeriesGlyph.tsx"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),groupsAccessLogic=__webpack_require__("./frontend/src/lib/introductions/groupsAccessLogic.ts"),lemon_ui_LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonField=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonRadio=__webpack_require__("./frontend/src/lib/lemon-ui/LemonRadio/index.ts"),LemonSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),experimentsLogic=__webpack_require__("./frontend/src/scenes/experiments/experimentsLogic.ts"),experiments_experimentLogic=__webpack_require__("./frontend/src/scenes/experiments/experimentLogic.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ExperimentFormFields=()=>{var _experiment$parameter;let{experiment,groupTypes,aggregationLabel,dynamicFeatureFlagKey}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{addExperimentGroup,removeExperimentGroup,setExperiment,createExperiment,setExperimentType}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),{webExperimentsAvailable}=(0,index_esm.useValues)(experimentsLogic.OK),{groupsAccessStatus}=(0,index_esm.useValues)(groupsAccessLogic.e);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsxs)("div",{className:"space-y-6 max-w-120",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"Pricing page conversion","data-attr":"experiment-name"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"feature_flag_key",label:"Feature flag key",help:(0,jsx_runtime.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,jsx_runtime.jsx)("span",{children:"Each experiment is backed by a feature flag. You'll use this key in your\xa0code."}),(0,jsx_runtime.jsxs)(lemon_ui_LemonButton.J,{type:"secondary",size:"xsmall",tooltip:dynamicFeatureFlagKey?"Use '"+dynamicFeatureFlagKey+"' as the feature flag key.":"Fill out the experiment name first.",onClick:()=>{setExperiment({feature_flag_key:dynamicFeatureFlagKey})},children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconMagicWand,{className:"mr-1"})," Generate"]})]}),children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"pricing-page-conversion","data-attr":"experiment-feature-flag-key"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"description",label:"Description",children:(0,jsx_runtime.jsx)(src._V,{placeholder:"The goal of this experiment is ...","data-attr":"experiment-description"})})]}),webExperimentsAvailable&&(0,jsx_runtime.jsxs)("div",{className:"mt-10",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-1",children:"Experiment type"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted font-medium tracking-normal",children:"Select your experiment setup, this cannot be changed once saved."}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(LemonRadio._,{value:experiment.type,className:"space-y-2 -mt-2",onChange:type=>{setExperimentType(type)},options:[{value:"product",label:(0,jsx_runtime.jsxs)("div",{className:"translate-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"Product experiment"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"Use custom code to manage how variants modify your product."})]})},{value:"web",label:(0,jsx_runtime.jsxs)("div",{className:"translate-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"No-code web experiment"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"Define variants on your website using the PostHog toolbar, no coding required."})]})}]})]}),groupsAccessStatus===groupsAccessLogic.Q.AlreadyUsing&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mt-10",children:"Participant type"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"The type on which to aggregate metrics. You can change this at any time during the experiment."}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(LemonRadio._,{value:void 0!=experiment.parameters.aggregation_group_type_index?experiment.parameters.aggregation_group_type_index:-1,onChange:rawGroupTypeIndex=>{let groupTypeIndex=-1!==rawGroupTypeIndex?rawGroupTypeIndex:void 0;setExperiment({parameters:{...experiment.parameters,aggregation_group_type_index:null!=groupTypeIndex?groupTypeIndex:void 0}})},options:[{value:-1,label:"Persons"},...Array.from(groupTypes.values()).map(groupType=>({value:groupType.group_type_index,label:(0,utils.fm)(aggregationLabel(groupType.group_type_index).plural)}))]})]}),(0,jsx_runtime.jsxs)("div",{className:"mt-10",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-1",children:"Variants"}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-muted",children:["Add up to ",constants.Rp-1," variants to test against your control."]}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-2 gap-4 max-w-160",children:[(0,jsx_runtime.jsxs)("div",{className:"max-w-60",children:[(0,jsx_runtime.jsx)("h3",{children:"Control"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsxs)(lib.Group,{name:["parameters","feature_flag_variants",0],children:[(0,jsx_runtime.jsx)(SeriesGlyph.jc,{index:0,className:"h-7 w-7 text-base"}),(0,jsx_runtime.jsx)(LemonField.D,{name:"key",className:"ml-2 flex-grow",children:(0,jsx_runtime.jsx)(src.DF,{disabled:!0,"data-attr":"experiment-variant-key","data-key-index":0,className:"ph-ignore-input",fullWidth:!0,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})})]},0)}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs mt-2",children:"Included automatically, cannot be edited or removed"})]}),(0,jsx_runtime.jsxs)("div",{className:"max-w-100",children:[(0,jsx_runtime.jsx)("h3",{children:"Test(s)"}),experiment.parameters.feature_flag_variants?.map((_,index)=>0===index?null:jsx_runtime.jsx(lib.Group,{name:["parameters","feature_flag_variants",index],children:jsx_runtime.jsxs("div",{className:`flex items-center space-x-2 ${index>1&&"mt-2"}`,children:[jsx_runtime.jsx(SeriesGlyph.jc,{index:index,className:"h-7 w-7 text-base"}),jsx_runtime.jsx(LemonField.D,{name:"key",className:"flex-grow",children:jsx_runtime.jsx(src.DF,{"data-attr":"experiment-variant-key","data-key-index":index.toString(),className:"ph-ignore-input",fullWidth:!0,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),jsx_runtime.jsx("div",{className:`${1===index&&"pr-9"}`,children:1!==index&&jsx_runtime.jsx(src.u,{title:"Delete this variant",placement:"top-start",children:jsx_runtime.jsx(lemon_ui_LemonButton.J,{size:"small",icon:jsx_runtime.jsx(posthog_icons_es.IconTrash,{}),onClick:()=>removeExperimentGroup(index)})})})]},`variant-${index}`)},index)),(0,jsx_runtime.jsx)("div",{className:"text-muted text-xs ml-9 mr-20 mt-2",children:"Alphanumeric, hyphens and underscores only"}),(null!==(_experiment$parameter=experiment.parameters.feature_flag_variants.length)&&void 0!==_experiment$parameter?_experiment$parameter:0)<constants.Rp&&(0,jsx_runtime.jsx)(lemon_ui_LemonButton.J,{className:"ml-9 mt-2",type:"secondary",onClick:()=>addExperimentGroup(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),"data-attr":"add-test-variant",children:"Add test variant"})]})]})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Holdout group"}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-muted",children:"Exclude a stable group of users from the experiment."}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(HoldoutSelector,{})]})]}),(0,jsx_runtime.jsx)(lemon_ui_LemonButton.J,{className:"mt-2",type:"primary","data-attr":"save-experiment",onClick:()=>createExperiment(!0),children:"Save as draft"})]})},HoldoutSelector=()=>{let{experiment,holdouts}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{setExperiment}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),holdoutOptions=holdouts.map(holdout=>({value:holdout.id,label:holdout.name}));return holdoutOptions.unshift({value:null,label:"No holdout"}),(0,jsx_runtime.jsx)("div",{className:"mt-4 mb-8",children:(0,jsx_runtime.jsx)(LemonSelect.Yv,{options:holdoutOptions,value:experiment.holdout_id||null,onChange:value=>{setExperiment({...experiment,holdout_id:value})},"data-attr":"experiment-holdout-selector"})})};function ExperimentForm(){let{props}=(0,index_esm.useValues)(experiments_experimentLogic.Wl);return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(lib.Form,{id:"experiment-step",logic:experiments_experimentLogic.Wl,formKey:"experiment",props:props,enableFormOnSubmit:!0,className:"space-y-6 experiment-form",children:(0,jsx_runtime.jsx)(ExperimentFormFields,{})})})}var esm=__webpack_require__("./node_modules/.pnpm/posthog-js@1.206.1/node_modules/posthog-js/react/dist/esm/index.js"),AuthorizedUrlList=__webpack_require__("./frontend/src/lib/components/AuthorizedUrlList/AuthorizedUrlList.tsx"),authorizedUrlListLogic=__webpack_require__("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonDialog=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDialog/index.ts");function WebExperimentImplementationDetails(_ref){let{experiment}=_ref;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-2",children:"Implementation"}),(0,jsx_runtime.jsxs)("div",{className:"border p-6 rounded bg-bg-light space-y-2",children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold leading-tight text-base text-current",children:"Define variant changes directly on your website"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"Use our toolbar to select elements and apply transformations for each variant."}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(lemon_ui_LemonButton.J,{size:"small",type:"secondary",onClick:()=>{LemonDialog.d.open({title:"Select a domain",description:experiment?.id?"Choose the domain on which to edit this experiment":"Choose the domain on which to create this experiment",content:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(AuthorizedUrlList.t,{experimentId:experiment?.id,type:authorizedUrlListLogic.uw.TOOLBAR_URLS})}),primaryButton:{children:"Close",type:"secondary"}})},sideIcon:(0,jsx_runtime.jsx)(icons.UE,{}),children:"Launch toolbar on your website"})})]})]})})}var ExperimentImplementationDetails=__webpack_require__("./frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx"),types=__webpack_require__("./frontend/src/types.ts"),TaxonomicFilter_types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),TestAccountFiltersSwitch=__webpack_require__("./frontend/src/lib/components/TestAccountFiltersSwitch.tsx"),lemon_ui_LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),ActionFilter_ActionFilter=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),ActionFilterRow=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),AggregationSelect=__webpack_require__("./frontend/src/scenes/insights/filters/AggregationSelect.tsx"),scenes_teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),filtersToQueryNode=__webpack_require__("./frontend/src/queries/nodes/InsightQuery/utils/filtersToQueryNode.ts"),utils_queryNodeToFilter=__webpack_require__("./frontend/src/queries/nodes/InsightQuery/utils/queryNodeToFilter.ts"),Query_Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),schema_general=__webpack_require__("./frontend/src/queries/schema/schema-general.ts"),Selectors=__webpack_require__("./frontend/src/scenes/experiments/Metrics/Selectors.tsx");function FunnelsMetricForm(_ref){var _currentMetric$funnel,_currentMetric$funnel2;let{isSecondary=!1}=_ref,{currentTeam}=(0,index_esm.useValues)(scenes_teamLogic.H),{experiment,isExperimentRunning,editingPrimaryMetricIndex,editingSecondaryMetricIndex}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{setFunnelsMetric}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),hasFilters=(currentTeam?.test_account_filters||[]).length>0,metrics=isSecondary?experiment.metrics_secondary:experiment.metrics,metricIdx=isSecondary?editingSecondaryMetricIndex:editingPrimaryMetricIndex;if(!metricIdx&&0!==metricIdx)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let currentMetric=metrics[metricIdx],actionFilterProps={...Selectors.dF,actionsTaxonomicGroupTypes:[TaxonomicFilter_types.t.Events,TaxonomicFilter_types.t.Actions]};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Name (optional)"}),(0,jsx_runtime.jsx)(src.DF,{value:currentMetric.name,onChange:newName=>{setFunnelsMetric({metricIdx,name:newName,isSecondary})}})]}),(0,jsx_runtime.jsx)(ActionFilter_ActionFilter.T,{bordered:!0,filters:(0,utils_queryNodeToFilter.ce)(currentMetric.funnels_query),setFilters:_ref2=>{let{actions,events,data_warehouse}=_ref2,series=(0,filtersToQueryNode.NG)({actions,events,data_warehouse},!0,ActionFilterRow.Qq.None);setFunnelsMetric({metricIdx,series,isSecondary})},typeKey:"experiment-metric",mathAvailability:ActionFilterRow.Qq.None,buttonCopy:"Add funnel step",showSeriesIndicator:!0,seriesIndicatorType:"numeric",sortable:!0,showNestedArrow:!0,...actionFilterProps}),(0,jsx_runtime.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,jsx_runtime.jsx)(Selectors.xE,{value:(0,AggregationSelect.eV)(null!==(_currentMetric$funnel=currentMetric.funnels_query.aggregation_group_type_index)&&void 0!==_currentMetric$funnel?_currentMetric$funnel:void 0,null!==(_currentMetric$funnel2=currentMetric.funnels_query.funnelsFilter?.funnelAggregateByHogQL)&&void 0!==_currentMetric$funnel2?_currentMetric$funnel2:void 0),onChange:value=>{setFunnelsMetric({metricIdx,funnelAggregateByHogQL:value,isSecondary})}}),(0,jsx_runtime.jsx)(Selectors.IF,{funnelWindowInterval:currentMetric.funnels_query?.funnelsFilter?.funnelWindowInterval,funnelWindowIntervalUnit:currentMetric.funnels_query?.funnelsFilter?.funnelWindowIntervalUnit,onFunnelWindowIntervalChange:funnelWindowInterval=>{setFunnelsMetric({metricIdx,funnelWindowInterval:funnelWindowInterval,isSecondary})},onFunnelWindowIntervalUnitChange:funnelWindowIntervalUnit=>{setFunnelsMetric({metricIdx,funnelWindowIntervalUnit:funnelWindowIntervalUnit||void 0,isSecondary})}}),(0,jsx_runtime.jsx)(Selectors.f$,{value:(()=>{let breakdownAttributionType=currentMetric.funnels_query?.funnelsFilter?.breakdownAttributionType,breakdownAttributionValue=currentMetric.funnels_query?.funnelsFilter?.breakdownAttributionValue,currentValue=breakdownAttributionType?breakdownAttributionType===types.q9.Step?`${breakdownAttributionType}/${breakdownAttributionValue||0}`:breakdownAttributionType:types.q9.FirstTouch;return currentValue})(),onChange:value=>{let[breakdownAttributionType,breakdownAttributionValue]=(value||"").split("/");setFunnelsMetric({metricIdx,breakdownAttributionType:breakdownAttributionType,breakdownAttributionValue:breakdownAttributionValue?parseInt(breakdownAttributionValue):void 0,isSecondary})},stepsLength:currentMetric.funnels_query?.series?.length}),(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:(()=>{let val=currentMetric.funnels_query?.filterTestAccounts;return!!hasFilters&&!!val})(),onChange:checked=>{setFunnelsMetric({metricIdx,filterTestAccounts:checked,isSecondary})},fullWidth:!0})]}),isExperimentRunning&&(0,jsx_runtime.jsxs)(lemon_ui_LemonBanner.V,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(Query_Query.A,{query:{kind:schema_general.OH.InsightVizNode,source:currentMetric.funnels_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})}var lib_dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");function TrendsMetricForm(_ref){let{isSecondary=!1}=_ref,{experiment,isExperimentRunning,editingPrimaryMetricIndex,editingSecondaryMetricIndex}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{setTrendsMetric,setTrendsExposureMetric,setExperiment}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),{currentTeam}=(0,index_esm.useValues)(scenes_teamLogic.H),hasFilters=(currentTeam?.test_account_filters||[]).length>0,[activeTab,setActiveTab]=(0,react.useState)("main"),metrics=isSecondary?experiment.metrics_secondary:experiment.metrics,metricIdx=isSecondary?editingSecondaryMetricIndex:editingPrimaryMetricIndex;if(!metricIdx&&0!==metricIdx)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let currentMetric=metrics[metricIdx];return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:newKey=>setActiveTab(newKey),tabs:[{key:"main",label:"Main metric",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Name (optional)"}),(0,jsx_runtime.jsx)(src.DF,{value:currentMetric.name,onChange:newName=>{setTrendsMetric({metricIdx,name:newName,isSecondary})}})]}),(0,jsx_runtime.jsx)(ActionFilter_ActionFilter.T,{bordered:!0,filters:(0,utils_queryNodeToFilter.ce)(currentMetric.count_query),setFilters:_ref2=>{let{actions,events,data_warehouse}=_ref2,series=(0,filtersToQueryNode.NG)({actions,events,data_warehouse},!0,ActionFilterRow.Qq.All);setTrendsMetric({metricIdx,series,isSecondary})},typeKey:"experiment-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,showNumericalPropsOnly:!0,onlyPropertyMathDefinitions:[types.O4.Sum],...Selectors.dF}),(0,jsx_runtime.jsx)("div",{className:"mt-4 space-y-4",children:(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:!!hasFilters&&!!currentMetric.count_query?.filterTestAccounts,onChange:checked=>{setTrendsMetric({metricIdx,filterTestAccounts:checked,isSecondary})},fullWidth:!0})}),isExperimentRunning&&(0,jsx_runtime.jsxs)(lemon_ui_LemonBanner.V,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(Query_Query.A,{query:{kind:schema_general.OH.InsightVizNode,source:currentMetric.count_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})},{key:"exposure",label:"Exposure",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,jsx_runtime.jsxs)("div",{className:`flex-1 cursor-pointer p-4 rounded border ${currentMetric.exposure_query?"border-border":"border-primary bg-primary-highlight"}`,onClick:()=>{let metricsField=isSecondary?"metrics_secondary":"metrics";setExperiment({...experiment,[metricsField]:metrics.map((metric,idx)=>idx===metricIdx?{...metric,exposure_query:void 0}:metric)})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Default"}),!currentMetric.exposure_query&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--primary)"})]}),(0,jsx_runtime.jsxs)("div",{className:"text-muted text-sm leading-relaxed",children:["Uses the number of unique users who trigger the"," ",(0,jsx_runtime.jsx)(src.oe,{children:"$feature_flag_called"})," event as your exposure count. This is the recommended setting for most experiments, as it accurately tracks variant exposure."]})]}),(0,jsx_runtime.jsxs)("div",{className:`flex-1 cursor-pointer p-4 rounded border ${currentMetric.exposure_query?"border-primary bg-primary-highlight":"border-border"}`,onClick:()=>{let metricsField=isSecondary?"metrics_secondary":"metrics";setExperiment({...experiment,[metricsField]:metrics.map((metric,idx)=>idx===metricIdx?{...metric,exposure_query:{kind:schema_general.OH.TrendsQuery,series:[{kind:schema_general.OH.EventsNode,name:"$feature_flag_called",event:"$feature_flag_called",math:types.vN.UniqueUsers}],interval:"day",dateRange:{date_from:(0,lib_dayjs.Bv)().subtract(constants.uq,"day").format("YYYY-MM-DDTHH:mm"),date_to:(0,lib_dayjs.Bv)().endOf("d").format("YYYY-MM-DDTHH:mm"),explicitDate:!0},trendsFilter:{display:types.Qb.ActionsLineGraph},filterTestAccounts:!0}}:metric)})},children:[(0,jsx_runtime.jsxs)("div",{className:"font-semibold flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{children:"Custom"}),currentMetric.exposure_query&&(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{fontSize:18,color:"var(--primary)"})]}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-sm leading-relaxed",children:"Define your own exposure metric for specific use cases, such as counting by sessions instead of users. This gives you full control but requires careful configuration."})]})]}),currentMetric.exposure_query&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ActionFilter_ActionFilter.T,{bordered:!0,filters:(0,utils_queryNodeToFilter.ce)(currentMetric.exposure_query),setFilters:_ref3=>{let{actions,events,data_warehouse}=_ref3,series=(0,filtersToQueryNode.NG)({actions,events,data_warehouse},!0,ActionFilterRow.Qq.All);setTrendsExposureMetric({metricIdx,series,isSecondary})},typeKey:"experiment-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,showNumericalPropsOnly:!0,...Selectors.dF}),(0,jsx_runtime.jsx)("div",{className:"mt-4 space-y-4",children:(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:(()=>{let val=currentMetric.exposure_query?.filterTestAccounts;return!!hasFilters&&!!val})(),onChange:checked=>{setTrendsExposureMetric({metricIdx,filterTestAccounts:checked,isSecondary})},fullWidth:!0})}),isExperimentRunning&&(0,jsx_runtime.jsxs)(lemon_ui_LemonBanner.V,{type:"info",className:"mt-3 mb-3",children:["Preview insights are generated based on ",constants.uq," ","days of data. This can cause a mismatch between the preview and the actual results."]}),(0,jsx_runtime.jsx)("div",{className:"mt-4",children:(0,jsx_runtime.jsx)(Query_Query.A,{query:{kind:schema_general.OH.InsightVizNode,source:currentMetric.exposure_query,showTable:!1,showLastComputation:!0,showLastComputationRefresh:!1},readOnly:!0})})]})]})}]})})}function MetricModal(_ref){let{experimentId,isSecondary}=_ref,{experiment,experimentLoading,_getMetricType,isPrimaryMetricModalOpen,isSecondaryMetricModalOpen,editingPrimaryMetricIndex,editingSecondaryMetricIndex}=(0,index_esm.useValues)((0,experiments_experimentLogic.Wl)({experimentId})),{updateExperimentGoal,setExperiment,closePrimaryMetricModal,closeSecondaryMetricModal,loadExperiment}=(0,index_esm.useActions)((0,experiments_experimentLogic.Wl)({experimentId})),metricIdx=isSecondary?editingSecondaryMetricIndex:editingPrimaryMetricIndex,metricsField=isSecondary?"metrics_secondary":"metrics";if(!metricIdx&&0!==metricIdx)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let metrics=experiment[metricsField],metric=metrics[metricIdx],metricType=_getMetricType(metric),funnelStepsLength=metric?.funnels_query?.series?.length||0,onClose=()=>{loadExperiment(),isSecondary?closeSecondaryMetricModal():closePrimaryMetricModal()};return(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isSecondary?isSecondaryMetricModalOpen:isPrimaryMetricModalOpen,onClose:onClose,width:1e3,title:"Edit experiment metric",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center w-full",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",status:"danger",onClick:()=>{src.dn.open({title:"Delete this metric?",content:(0,jsx_runtime.jsx)("div",{className:"text-sm text-muted",children:"This action cannot be undone."}),primaryButton:{children:"Delete",type:"primary",onClick:()=>{let newMetrics=metrics.filter((_,idx)=>idx!==metricIdx);setExperiment({[metricsField]:newMetrics}),updateExperimentGoal()},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})},children:"Delete"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-goal-form",type:"secondary",onClick:onClose,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{disabledReason:metricType===types.dw.FUNNELS&&funnelStepsLength<2&&"The experiment needs at least two funnel steps.",form:"edit-experiment-goal-form",onClick:()=>{updateExperimentGoal()},type:"primary",loading:experimentLoading,"data-attr":"create-annotation-submit",children:"Save"})]})]}),children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center w-full gap-2 mb-4",children:[(0,jsx_runtime.jsx)("span",{children:"Metric type"}),(0,jsx_runtime.jsx)(src.Yv,{"data-attr":"metrics-selector",value:metricType,onChange:newMetricType=>{setExperiment({...experiment,[metricsField]:[...metrics.slice(0,metricIdx),newMetricType===types.dw.TRENDS?(0,experiments_experimentLogic.ug)():(0,experiments_experimentLogic.xs)(),...metrics.slice(metricIdx+1)]})},options:[{value:types.dw.TRENDS,label:(0,jsx_runtime.jsx)("b",{children:"Trends"})},{value:types.dw.FUNNELS,label:(0,jsx_runtime.jsx)("b",{children:"Funnels"})}]})]}),metricType===types.dw.TRENDS?(0,jsx_runtime.jsx)(TrendsMetricForm,{isSecondary:isSecondary}):(0,jsx_runtime.jsx)(FunnelsMetricForm,{isSecondary:isSecondary})]})}function MetricSourceModal(_ref){let{experimentId,isSecondary}=_ref,{experiment,isPrimaryMetricSourceModalOpen,isSecondaryMetricSourceModalOpen}=(0,index_esm.useValues)((0,experiments_experimentLogic.Wl)({experimentId})),{setExperiment,closePrimaryMetricSourceModal,closeSecondaryMetricSourceModal,openPrimaryMetricModal,openPrimarySharedMetricModal,openSecondaryMetricModal,openSecondarySharedMetricModal}=(0,index_esm.useActions)((0,experiments_experimentLogic.Wl)({experimentId})),metricsField=isSecondary?"metrics_secondary":"metrics",closeCurrentModal=isSecondary?closeSecondaryMetricSourceModal:closePrimaryMetricSourceModal,openMetricModal=isSecondary?openSecondaryMetricModal:openPrimaryMetricModal,openSharedMetricModal=isSecondary?openSecondarySharedMetricModal:openPrimarySharedMetricModal;return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isSecondary?isSecondaryMetricSourceModalOpen:isPrimaryMetricSourceModalOpen,onClose:closeCurrentModal,width:1e3,title:"Choose metric source",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1 cursor-pointer p-4 rounded border hover:border-primary-3000",onClick:()=>{closeCurrentModal();let newMetrics=[...experiment[metricsField],(0,experiments_experimentLogic.xs)()];setExperiment({[metricsField]:newMetrics}),openMetricModal(newMetrics.length-1)},children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:(0,jsx_runtime.jsx)("span",{children:"Single-use"})}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-sm leading-relaxed",children:"Create a new metric specific to this experiment."})]}),(0,jsx_runtime.jsxs)("div",{className:"flex-1 cursor-pointer p-4 rounded border hover:border-primary-3000",onClick:()=>{closeCurrentModal(),openSharedMetricModal(null)},children:[(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:(0,jsx_runtime.jsx)("span",{children:"Shared"})}),(0,jsx_runtime.jsx)("div",{className:"text-muted text-sm leading-relaxed",children:"Use a pre-configured metric that can be reused across experiments."})]})]})})}var LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),InsightLabel=__webpack_require__("./frontend/src/lib/components/InsightLabel/index.tsx"),PropertyFilterButton=__webpack_require__("./frontend/src/lib/components/PropertyFilters/components/PropertyFilterButton.tsx");function MetricDisplayTrends(_ref){let{query}=_ref,event=query?.series?.[0];return event?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"mb-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex mb-1",children:(0,jsx_runtime.jsx)("b",{children:(0,jsx_runtime.jsx)(InsightLabel.q,{action:event,showCountedByTag:!0,hideIcon:!0,showEventName:!0})})}),(0,jsx_runtime.jsx)("div",{className:"space-y-1",children:event.properties?.map(prop=>jsx_runtime.jsx(PropertyFilterButton.C,{item:prop},prop.key))})]})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}function MetricDisplayFunnels(_ref2){let{query}=_ref2;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(query.series||[]).map((event,idx)=>(0,jsx_runtime.jsxs)("div",{className:"mb-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex mb-1",children:[(0,jsx_runtime.jsx)("div",{className:"shrink-0 w-6 h-6 mr-2 font-bold text-center text-primary-alt border rounded",style:{backgroundColor:"var(--bg-table)"},children:idx+1}),(0,jsx_runtime.jsx)("b",{children:(0,jsx_runtime.jsx)(InsightLabel.q,{action:event,hideIcon:!0,showEventName:!0})})]}),(0,jsx_runtime.jsx)("div",{className:"space-y-1",children:event.properties?.map(prop=>jsx_runtime.jsx(PropertyFilterButton.C,{item:prop},prop.key))})]},idx))})}function SharedMetricModal(_ref){let{experimentId,isSecondary}=_ref,{experiment,sharedMetrics,isPrimarySharedMetricModalOpen,isSecondarySharedMetricModalOpen,editingSharedMetricId,primaryMetricsLengthWithSharedMetrics,secondaryMetricsLengthWithSharedMetrics}=(0,index_esm.useValues)((0,experiments_experimentLogic.Wl)({experimentId})),{closePrimarySharedMetricModal,closeSecondarySharedMetricModal,addSharedMetricsToExperiment,removeSharedMetricFromExperiment,loadExperiment}=(0,index_esm.useActions)((0,experiments_experimentLogic.Wl)({experimentId})),[selectedMetricIds,setSelectedMetricIds]=(0,react.useState)([]),[selectedMetricId,setSelectedMetricId]=(0,react.useState)(null),[mode,setMode]=(0,react.useState)("create");if((0,react.useEffect)(()=>{editingSharedMetricId&&(setSelectedMetricId(editingSharedMetricId),setMode("edit"))},[editingSharedMetricId]),!sharedMetrics)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let closeModal=()=>{loadExperiment(),isSecondary?closeSecondarySharedMetricModal():closePrimarySharedMetricModal()},availableSharedMetrics=sharedMetrics.filter(metric=>!experiment.saved_metrics.some(savedMetric=>savedMetric.saved_metric===metric.id));return(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isSecondary?isSecondarySharedMetricModalOpen:isPrimarySharedMetricModalOpen,onClose:closeModal,width:500,title:"create"===mode?"Select one or more shared metrics":"Shared metric",footer:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between w-full",children:[(0,jsx_runtime.jsx)("div",{children:editingSharedMetricId&&(0,jsx_runtime.jsx)(src.Jp,{status:"danger",onClick:()=>removeSharedMetricFromExperiment(editingSharedMetricId),type:"secondary",children:"Remove from experiment"})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:closeModal,type:"secondary",children:"Cancel"}),"create"===mode&&(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{addSharedMetricsToExperiment(selectedMetricIds,{type:isSecondary?"secondary":"primary"})},type:"primary",disabledReason:0===selectedMetricIds.length?"Please select at least one metric":!isSecondary&&primaryMetricsLengthWithSharedMetrics+selectedMetricIds.length>10?"You can only add up to 10 primary metrics.":isSecondary&&secondaryMetricsLengthWithSharedMetrics+selectedMetricIds.length>10?"You can only add up to 10 secondary metrics.":void 0,children:selectedMetricIds.length<2?"Add metric":"Add metrics"})]})]}),children:["create"===mode&&(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:availableSharedMetrics.length>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[experiment.saved_metrics.length>0&&(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:`Hiding ${experiment.saved_metrics.length} shared ${experiment.saved_metrics.length>1?"metrics":"metric"} already in use with this experiment.`}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:availableSharedMetrics,columns:[{title:"",key:"checkbox",render:(_,metric)=>(0,jsx_runtime.jsx)("input",{type:"checkbox",checked:selectedMetricIds.includes(metric.id),onChange:e=>{e.target.checked?setSelectedMetricIds([...selectedMetricIds,metric.id]):setSelectedMetricIds(selectedMetricIds.filter(id=>id!==metric.id))}})},{title:"Name",dataIndex:"name",key:"name"},{title:"Description",dataIndex:"description",key:"description"},{title:"Type",key:"type",render:(_,metric)=>metric.query.kind.replace("Experiment","").replace("Query","")}],footer:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center m-2",children:(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.experimentsSharedMetrics(),size:"xsmall",type:"tertiary",children:"See all shared metrics"})})})]}):(0,jsx_runtime.jsx)(src.Vp,{className:"w-full",type:"info",action:{children:"New shared metric",to:urls.j.experimentsSharedMetric("new")},children:sharedMetrics.length>0?"All of your shared metrics are already in this experiment.":"You don't have any shared metrics that match the experiment type. Shared metrics let you create reusable metrics that you can quickly add to any experiment."})}),selectedMetricId&&(0,jsx_runtime.jsx)("div",{children:(()=>{let metric=sharedMetrics.find(m=>m.id===selectedMetricId);return metric?(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold m-0 flex items-center",children:metric.name}),(0,jsx_runtime.jsx)(src.rU,{target:"_blank",className:"font-semibold flex items-center",to:urls.j.experimentsSharedMetric(metric.id),children:(0,jsx_runtime.jsx)(icons.pF,{fontSize:"18"})})]}),metric.description&&(0,jsx_runtime.jsx)("p",{className:"mt-2",children:metric.description}),"ExperimentTrendsQuery"===metric.query.kind&&(0,jsx_runtime.jsx)(MetricDisplayTrends,{query:metric.query.count_query}),"ExperimentFunnelsQuery"===metric.query.kind&&(0,jsx_runtime.jsx)(MetricDisplayFunnels,{query:metric.query.funnels_query})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})})()})]})}var clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),LemonProgress=__webpack_require__("./frontend/src/lib/lemon-ui/LemonProgress/index.tsx"),themeLogic=__webpack_require__("./frontend/src/layout/navigation-3000/themeLogic.ts"),components=__webpack_require__("./frontend/src/scenes/experiments/ExperimentView/components.tsx");function WinningVariantText(_ref){let{result,experimentId}=_ref,{getIndexForVariant,getHighestProbabilityVariant}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),highestProbabilityVariant=getHighestProbabilityVariant(result),index=getIndexForVariant(result,highestProbabilityVariant||"");if(highestProbabilityVariant&&null!==index&&result){let{probability}=result;return(0,jsx_runtime.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:highestProbabilityVariant}),(0,jsx_runtime.jsx)("span",{children:"\xa0is winning with a\xa0"}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold text-success items-center",children:[`${(100*probability[highestProbabilityVariant]).toFixed(2)}% probability`,"\xa0"]}),(0,jsx_runtime.jsx)("span",{children:"of being best.\xa0"})]})}return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}function SignificanceText(_ref2){let{metricIndex,isSecondary=!1}=_ref2,{isPrimaryMetricSignificant,isSecondaryMetricSignificant}=(0,index_esm.useValues)(experiments_experimentLogic.Wl);return(0,jsx_runtime.jsxs)("div",{className:"flex-wrap",children:[(0,jsx_runtime.jsx)("span",{children:"Your results are\xa0"}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold",children:[`${isSecondary?isSecondaryMetricSignificant(metricIndex):isPrimaryMetricSignificant(metricIndex)?"significant":"not significant"}`,"."]})]})}function Overview(_ref3){let{metricIndex=0}=_ref3,{experimentId,metricResults}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),result=metricResults?.[metricIndex];return result?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,jsx_runtime.jsx)(WinningVariantText,{result:result,experimentId:experimentId}),(0,jsx_runtime.jsx)(SignificanceText,{metricIndex:metricIndex})]})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}var SummaryTable=__webpack_require__("./frontend/src/scenes/experiments/ExperimentView/SummaryTable.tsx");function NoResultEmptyState(_ref){let{error}=_ref;if(!error)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let{statusCode,hasDiagnostics}=error;function ChecklistItem(_ref2){let{errorCode,value}=_ref2;return(0,jsx_runtime.jsx)("div",{className:"flex items-center space-x-2",children:!1===value?(0,jsx_runtime.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{className:"text-success",fontSize:16}),(0,jsx_runtime.jsx)("span",{className:"text-muted",children:{"no-events":"Experiment events have been received","no-flag-info":"Feature flag information is present on the events","no-control-variant":"Events with the control variant received","no-test-variant":"Events with at least one test variant received","no-exposures":"Exposure events have been received"}[errorCode]})]}):(0,jsx_runtime.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{className:"text-danger",fontSize:16}),(0,jsx_runtime.jsx)("span",{children:{"no-events":"Metric events not received","no-flag-info":"Feature flag information not present on the events","no-control-variant":"Events with the control variant not received","no-test-variant":"Events with at least one test variant not received","no-exposures":"Exposure events not received"}[errorCode]})]})})}if(hasDiagnostics){let checklistItems=[];for(let[errorCode,value]of Object.entries(error.detail))checklistItems.push((0,jsx_runtime.jsx)(ChecklistItem,{errorCode:errorCode,value:value},errorCode));return(0,jsx_runtime.jsx)("div",{children:checklistItems})}return 504===statusCode?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl font-semibold leading-tight",children:"Experiment results timed out"}),(0,jsx_runtime.jsx)("div",{className:"text-sm text-center text-balance",children:"This may occur when the experiment has a large amount of data or is particularly complex. We are actively working on fixing this. In the meantime, please try refreshing the experiment to retrieve the results."})]}):(0,jsx_runtime.jsx)("div",{children:error.detail})}let getMetricTitle=(metric,metricType)=>{if(metric.name)return(0,jsx_runtime.jsx)("span",{className:"truncate",children:metric.name});if(metricType===types.dw.TRENDS&&metric.count_query?.series?.[0]?.name)return(0,jsx_runtime.jsx)("span",{className:"truncate",children:metric.count_query.series[0].name});if(metricType===types.dw.FUNNELS&&metric.funnels_query?.series){let series=metric.funnels_query.series;if(series.length>0){let firstStep=series[0]?.name,lastStep=series[series.length-1]?.name;return(0,jsx_runtime.jsxs)("span",{className:"inline-flex items-center gap-1 min-w-0",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconFunnels,{className:"text-muted flex-shrink-0",fontSize:"14"}),(0,jsx_runtime.jsx)("span",{className:"truncate",children:firstStep}),(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowRight,{className:"text-muted flex-shrink-0",fontSize:"14"}),(0,jsx_runtime.jsx)("span",{className:"truncate",children:lastStep})]})}}return(0,jsx_runtime.jsx)("span",{className:"text-muted truncate",children:"Untitled metric"})};function DeltaChart(_ref){let{isSecondary,result,error,variants,metricType,metricIndex,isFirstMetric,metric,tickValues,chartBound}=_ref,{credibleIntervalForVariant,conversionRateForVariant,experimentId,countDataForVariant,exposureCountDataForVariant,metricResultsLoading}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{experiment}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{openPrimaryMetricModal,openSecondaryMetricModal,openPrimarySharedMetricModal,openSecondarySharedMetricModal}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),[tooltipData,setTooltipData]=(0,react.useState)(null),[emptyStateTooltipVisible,setEmptyStateTooltipVisible]=(0,react.useState)(!0),[tooltipPosition,setTooltipPosition]=(0,react.useState)({x:0,y:0}),[isModalOpen,setIsModalOpen]=(0,react.useState)(!1),getScaleAddition=variantCount=>variantCount<3?6:variantCount<4?3:variantCount<5?1:0,BAR_HEIGHT=8+getScaleAddition(variants.length),BAR_PADDING=10+getScaleAddition(variants.length),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),COLORS={TICK_TEXT_COLOR:"var(--text-secondary-3000)",BOUNDARY_LINES:"var(--border-3000)",ZERO_LINE:"var(--border-bold)",BAR_NEGATIVE:isDarkModeOn?"#c32f45":"#f84257",BAR_POSITIVE:isDarkModeOn?"#12a461":"#36cd6f",BAR_CONTROL:isDarkModeOn?"rgba(217, 217, 217, 0.2)":"rgba(217, 217, 217, 0.4)",BAR_MIDDLE_POINT:"black",BAR_MIDDLE_POINT_CONTROL:"rgba(0, 0, 0, 0.4)"},chartHeight=BAR_PADDING+(BAR_HEIGHT+BAR_PADDING)*variants.length,valueToX=value=>20+(value/chartBound+1)/2*760,ticksSvgRef=(0,react.useRef)(null),chartSvgRef=(0,react.useRef)(null),[ticksSvgHeight,setTicksSvgHeight]=(0,react.useState)(0),[chartSvgHeight,setChartSvgHeight]=(0,react.useState)(0);return(0,react.useEffect)(()=>{let ticksSvg=ticksSvgRef.current,chartSvg=chartSvgRef.current,resizeObserver=new ResizeObserver(entries=>{for(let entry of entries)entry.target===ticksSvg?setTicksSvgHeight(entry.contentRect.height):entry.target===chartSvg&&setChartSvgHeight(entry.contentRect.height)});return ticksSvg&&resizeObserver.observe(ticksSvg),chartSvg&&resizeObserver.observe(chartSvg),()=>{resizeObserver.disconnect()}},[]),(0,jsx_runtime.jsxs)("div",{className:"rounded bg-[var(--bg-table)]",children:[(0,jsx_runtime.jsxs)("div",{style:{width:"20%",verticalAlign:"top",display:"inline-block"},children:[isFirstMetric&&(0,jsx_runtime.jsx)("svg",{style:{height:`${ticksSvgHeight}px`}}),isFirstMetric&&(0,jsx_runtime.jsx)("div",{className:"w-full border-t border-border"}),(0,jsx_runtime.jsx)("div",{style:{height:`${chartSvgHeight}px`,borderRight:`1px solid ${COLORS.BOUNDARY_LINES}`},className:"p-2 overflow-auto",children:(0,jsx_runtime.jsx)("div",{className:"text-xs font-semibold whitespace-nowrap overflow-hidden",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"cursor-default text-xs font-semibold whitespace-nowrap overflow-hidden text-ellipsis flex-grow flex items-center",children:[(0,jsx_runtime.jsxs)("span",{className:"mr-1",children:[metricIndex+1,"."]}),getMetricTitle(metric,metricType)]}),(0,jsx_runtime.jsx)(src.Jp,{className:"flex-shrink-0",type:"secondary",size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{fontSize:"12"}),onClick:()=>{if(metric.isSharedMetric){isSecondary?openSecondarySharedMetricModal(metric.sharedMetricId):openPrimarySharedMetricModal(metric.sharedMetricId);return}isSecondary?openSecondaryMetricModal(metricIndex):openPrimaryMetricModal(metricIndex)}})]}),(0,jsx_runtime.jsxs)("div",{className:"space-x-1",children:[(0,jsx_runtime.jsx)(src.oe,{type:"muted",size:"small",children:"ExperimentFunnelsQuery"===metric.kind?"Funnel":"Trend"}),metric.isSharedMetric&&(0,jsx_runtime.jsx)(src.oe,{type:"option",size:"small",children:"Shared"})]})]})})})]}),(0,jsx_runtime.jsxs)("div",{style:{width:"calc(100% - 20%)",verticalAlign:"top",display:"inline-block",minWidth:"780px"},children:[isFirstMetric&&(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsx)("svg",{ref:ticksSvgRef,viewBox:"0 0 800 20",preserveAspectRatio:"xMidYMid meet",className:result?"ml-12":void 0,style:{minHeight:"20px",maxWidth:"1000px"},children:tickValues.map((value,index)=>{let x=valueToX(value);return(0,jsx_runtime.jsx)("g",{children:(0,jsx_runtime.jsx)("text",{x:x,y:10,textAnchor:"middle",dominantBaseline:"middle",fontSize:9,fill:COLORS.TICK_TEXT_COLOR,fontWeight:"600",children:function(value){if(0===value)return"0%";let absValue=Math.abs(value),decimals=0;return decimals=absValue<.01?3:absValue<.1?2:absValue<1?1:0,`${(100*value).toFixed(decimals)}%`}(value)})},index)})})}),isFirstMetric&&(0,jsx_runtime.jsx)("div",{className:"w-full border-t border-border"}),result?(0,jsx_runtime.jsxs)("div",{className:"relative",children:[(0,jsx_runtime.jsx)("div",{className:"absolute top-2 left-2",style:{zIndex:102},children:(0,jsx_runtime.jsx)(SignificanceHighlight,{metricIndex:metricIndex,isSecondary:isSecondary})}),(isSecondary||!isSecondary&&experiment.metrics.length>1)&&(0,jsx_runtime.jsx)("div",{className:"absolute bottom-2 left-2 flex justify-center bg-[var(--bg-table)]",style:{zIndex:101},children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGraph,{}),onClick:()=>setIsModalOpen(!0),children:"Details"})}),(0,jsx_runtime.jsx)("div",{className:"flex justify-center",children:(0,jsx_runtime.jsxs)("svg",{ref:chartSvgRef,viewBox:`0 0 800 ${chartHeight}`,preserveAspectRatio:"xMidYMid meet",className:"ml-12",style:{minHeight:`${chartHeight}px`,maxWidth:"1000px"},children:[tickValues.map((value,index)=>{let x=valueToX(value);return(0,jsx_runtime.jsx)("line",{x1:x,y1:0,x2:x,y2:chartSvgHeight+20,stroke:0===value?COLORS.ZERO_LINE:COLORS.BOUNDARY_LINES,strokeWidth:0===value?1:.5},index)}),variants.map((variant,index)=>{let delta;let interval=credibleIntervalForVariant(result,variant.key,metricType),[lower,upper]=interval?[interval[0]/100,interval[1]/100]:[0,0];if(metricType===types.dw.TRENDS){let controlVariant=result.variants.find(v=>"control"===v.key),variantData=result.variants.find(v=>v.key===variant.key);if(variantData?.count&&variantData?.absolute_exposure&&controlVariant?.count&&controlVariant?.absolute_exposure){let controlMean=controlVariant.count/controlVariant.absolute_exposure,variantMean=variantData.count/variantData.absolute_exposure;delta=(variantMean-controlMean)/controlMean}else delta=0}else{let variantRate=conversionRateForVariant(result,variant.key),controlRate=conversionRateForVariant(result,"control");delta=variantRate&&controlRate?(variantRate-controlRate)/controlRate:0}let y=BAR_PADDING+(BAR_HEIGHT+BAR_PADDING)*index,x1=valueToX(lower),x2=valueToX(upper),deltaX=valueToX(delta);return(0,jsx_runtime.jsxs)("g",{onMouseEnter:e=>{let rect=e.currentTarget.getBoundingClientRect();setTooltipData({x:rect.left+rect.width/2,y:rect.top-10,variant:variant.key})},onMouseLeave:()=>setTooltipData(null),children:[(0,jsx_runtime.jsx)("foreignObject",{x:x1-8,y:y+BAR_HEIGHT/2-10,width:"90",height:"16",transform:"translate(-90, 0)",children:(0,jsx_runtime.jsx)(components.Aw,{className:"justify-end mt-0.5",experimentId:experimentId,variantKey:variant.key,fontSize:10,muted:!0})}),"control"===variant.key?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("rect",{x:x1,y:y,width:x2-x1,height:BAR_HEIGHT,fill:"transparent"}),(0,jsx_runtime.jsx)("rect",{x:x1,y:y,width:x2-x1,height:BAR_HEIGHT,fill:COLORS.BAR_CONTROL,stroke:COLORS.BOUNDARY_LINES,strokeWidth:1,strokeDasharray:"2,2",rx:4,ry:4})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("rect",{x:x1,y:y,width:x2-x1,height:BAR_HEIGHT,fill:"transparent"}),lower<0&&upper>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("path",{d:`
                                                                M ${x1+4} ${y}
                                                                H ${valueToX(0)}
                                                                V ${y+BAR_HEIGHT}
                                                                H ${x1+4}
                                                                Q ${x1} ${y+BAR_HEIGHT} ${x1} ${y+BAR_HEIGHT-4}
                                                                V ${y+4}
                                                                Q ${x1} ${y} ${x1+4} ${y}
                                                            `,fill:COLORS.BAR_NEGATIVE}),(0,jsx_runtime.jsx)("path",{d:`
                                                                M ${valueToX(0)} ${y}
                                                                H ${x2-4}
                                                                Q ${x2} ${y} ${x2} ${y+4}
                                                                V ${y+BAR_HEIGHT-4}
                                                                Q ${x2} ${y+BAR_HEIGHT} ${x2-4} ${y+BAR_HEIGHT}
                                                                H ${valueToX(0)}
                                                                V ${y}
                                                            `,fill:COLORS.BAR_POSITIVE})]}):(0,jsx_runtime.jsx)("rect",{x:x1,y:y,width:x2-x1,height:BAR_HEIGHT,fill:upper<=0?COLORS.BAR_NEGATIVE:COLORS.BAR_POSITIVE,rx:4,ry:4})]}),(0,jsx_runtime.jsx)("rect",{x:deltaX-1,y:y,width:2,height:BAR_HEIGHT,fill:"control"===variant.key?COLORS.BAR_MIDDLE_POINT_CONTROL:COLORS.BAR_MIDDLE_POINT})]},variant.key)})]})})]}):metricResultsLoading?(0,jsx_runtime.jsx)("svg",{ref:chartSvgRef,viewBox:`0 0 800 ${chartHeight}`,preserveAspectRatio:"xMidYMid meet",children:(0,jsx_runtime.jsx)("foreignObject",{x:300,y:chartHeight/2-10,width:"200",height:"20",children:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center text-muted cursor-default",style:{fontSize:"10px",fontWeight:400},children:(0,jsx_runtime.jsx)("span",{children:"Results loading"})})})}):(0,jsx_runtime.jsx)("svg",{ref:chartSvgRef,viewBox:`0 0 800 ${chartHeight}`,preserveAspectRatio:"xMidYMid meet",children:experiment.start_date?(0,jsx_runtime.jsx)("foreignObject",{x:0,y:chartHeight/2-10,width:800,height:"20",onMouseEnter:e=>{let rect=e.currentTarget.getBoundingClientRect();setTooltipPosition({x:rect.left+rect.width/2,y:rect.top}),setEmptyStateTooltipVisible(!0)},onMouseLeave:()=>setEmptyStateTooltipVisible(!1),children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center ml-2 xl:ml-0 xl:justify-center text-muted cursor-default",style:{fontSize:"10px",fontWeight:400},children:[error?.hasDiagnostics?(0,jsx_runtime.jsxs)(src.oe,{size:"small",type:"highlight",className:"mr-2",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconActivity,{className:"mr-1",fontSize:"1em"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{try{return Object.values(error.detail).filter(v=>!1===v).length}catch{return"0"}})()}),"/",(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:metricType===types.dw.TRENDS?"5":"4"})]}):(0,jsx_runtime.jsx)(src.oe,{size:"small",type:"danger",className:"mr-1",children:"Error"}),(0,jsx_runtime.jsx)("span",{children:"Results not yet available"})]})}):(0,jsx_runtime.jsx)("foreignObject",{x:"0",y:chartHeight/2-10,width:800,height:"20",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center ml-2 xl:ml-0 xl:justify-center text-muted cursor-default",style:{fontSize:"10px",fontWeight:400},children:[(0,jsx_runtime.jsx)(src.oe,{size:"small",className:"mr-2",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconClock,{fontSize:"1em"})}),(0,jsx_runtime.jsx)("span",{children:"Waiting for experiment to start"})]})})}),tooltipData&&(0,jsx_runtime.jsx)("div",{style:{position:"fixed",left:tooltipData.x,top:tooltipData.y,transform:"translate(-50%, -100%)",backgroundColor:"var(--bg-light)",border:"1px solid var(--border)",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",pointerEvents:"none",zIndex:100,minWidth:"300px"},children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:tooltipData.variant}),(0,jsx_runtime.jsxs)("div",{className:"inline-flex",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted font-semibold mb-1",children:"Win probability:"}),result?.probability?.[tooltipData.variant]!==void 0?(0,jsx_runtime.jsxs)("span",{className:"flex items-center justify-between flex-1 pl-6",children:[(0,jsx_runtime.jsx)(LemonProgress.b,{className:"w-3/4 mr-4",percent:100*result.probability[tooltipData.variant]}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold",children:[(100*result.probability[tooltipData.variant]).toFixed(2),"%"]})]}):""]}),metricType===types.dw.TRENDS?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsxs)("span",{className:"text-muted font-semibold",children:[metricType===types.dw.TRENDS&&result.exposure_query?.series?.[0]?.math?"Total":"Count",":"]}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{let count=countDataForVariant(result,tooltipData.variant);return null!==count?(0,utils.Lc)(count):""})()})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted font-semibold",children:"Exposure:"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{let exposure=exposureCountDataForVariant(result,tooltipData.variant);return null!==exposure?(0,utils.Lc)(exposure):""})()})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted font-semibold",children:"Mean:"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{let variant=result.variants.find(v=>v.key===tooltipData.variant);return variant?.count&&variant?.absolute_exposure?(variant.count/variant.absolute_exposure).toFixed(2):""})()})]})]}):(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted font-semibold",children:"Conversion rate:"}),(0,jsx_runtime.jsxs)("span",{className:"font-semibold",children:[conversionRateForVariant(result,tooltipData.variant)?.toFixed(2),"%"]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted font-semibold",children:"Delta:"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"control"===tooltipData.variant?(0,jsx_runtime.jsx)("em",{className:"text-muted",children:"Baseline"}):(()=>{if(metricType===types.dw.TRENDS){let controlVariant=result.variants.find(v=>"control"===v.key),variant=result.variants.find(v=>v.key===tooltipData.variant);if(!variant?.count||!variant?.absolute_exposure||!controlVariant?.count||!controlVariant?.absolute_exposure)return"";let controlMean=controlVariant.count/controlVariant.absolute_exposure,variantMean=variant.count/variant.absolute_exposure,delta=(variantMean-controlMean)/controlMean;return delta?(0,jsx_runtime.jsx)("span",{className:delta>0?"text-success":"text-danger",children:`${delta>0?"+":""}${(100*delta).toFixed(2)}%`}):""}let variantRate=conversionRateForVariant(result,tooltipData.variant),controlRate=conversionRateForVariant(result,"control"),delta=variantRate&&controlRate?(variantRate-controlRate)/controlRate:0;return delta?(0,jsx_runtime.jsx)("span",{className:delta>0?"text-success":"text-danger",children:`${delta>0?"+":""}${(100*delta).toFixed(2)}%`}):""})()})]}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)("span",{className:"text-muted font-semibold",children:"Credible interval:"}),(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:(()=>{let interval=credibleIntervalForVariant(result,tooltipData.variant,metricType),[lower,upper]=interval?[interval[0]/100,interval[1]/100]:[0,0];return`[${lower>0?"+":""}${(100*lower).toFixed(2)}%, ${upper>0?"+":""}${(100*upper).toFixed(2)}%]`})()})]})]})}),emptyStateTooltipVisible&&(0,jsx_runtime.jsx)("div",{style:{position:"fixed",left:tooltipPosition.x,top:tooltipPosition.y,transform:"translate(-50%, -100%)",backgroundColor:"var(--bg-light)",border:"1px solid var(--border)",padding:"8px 12px",borderRadius:"6px",fontSize:"13px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",pointerEvents:"none",zIndex:100,minWidth:"200px"},children:(0,jsx_runtime.jsx)(NoResultEmptyState,{error:error})})]}),(0,jsx_runtime.jsxs)(src.fQ,{isOpen:isModalOpen,onClose:()=>setIsModalOpen(!1),width:1200,title:`Metric results: ${metric.name||"Untitled metric"}`,footer:(0,jsx_runtime.jsx)(src.Jp,{form:"secondary-metric-modal-form",type:"secondary",onClick:()=>setIsModalOpen(!1),children:"Close"}),children:[(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(components.lM,{result:result})}),(0,jsx_runtime.jsx)(src.Vp,{type:"info",className:"mb-4",children:(0,jsx_runtime.jsxs)("div",{className:"items-center inline-flex flex-wrap",children:[(0,jsx_runtime.jsx)(WinningVariantText,{result:result,experimentId:experimentId}),(0,jsx_runtime.jsx)(SignificanceText,{metricIndex:metricIndex})]})}),(0,jsx_runtime.jsx)(SummaryTable.H,{metric:metric,metricIndex:metricIndex,isSecondary:isSecondary}),(0,jsx_runtime.jsx)(components.MN,{result:result,showTable:!0})]})]})}function SignificanceHighlight(_ref2){let{metricIndex=0,isSecondary=!1,className=""}=_ref2,{isPrimaryMetricSignificant,isSecondaryMetricSignificant,significanceDetails}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),isSignificant=isSecondary?isSecondaryMetricSignificant(metricIndex):isPrimaryMetricSignificant(metricIndex),result=isSignificant?{color:"success",label:"Significant"}:{color:"primary",label:"Not significant"},inner=isSignificant?(0,jsx_runtime.jsxs)("div",{className:"bg-success-highlight text-success-dark px-1.5 py-0.5 flex items-center gap-1 rounded border border-success-light",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconTrending,{fontSize:20,fontWeight:600}),(0,jsx_runtime.jsx)("span",{className:"text-xs font-semibold",children:result.label})]}):(0,jsx_runtime.jsxs)("div",{className:"bg-warning-highlight text-warning-dark px-1.5 py-0.5 flex items-center gap-1 rounded border border-warning",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconMinus,{fontSize:20,fontWeight:600}),(0,jsx_runtime.jsx)("span",{className:"text-xs font-semibold",children:result.label})]}),details=significanceDetails(metricIndex);return details?(0,jsx_runtime.jsx)(src.u,{title:details,children:(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)({"cursor-default":!0,"bg-[var(--bg-table)]":!0,[className]:!0}),children:inner})}):(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)({"bg-[var(--bg-table)]":!0,[className]:!0}),children:inner})}function AddPrimaryMetric(){let{primaryMetricsLengthWithSharedMetrics}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{openPrimaryMetricSourceModal}=(0,index_esm.useActions)(experiments_experimentLogic.Wl);return(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),type:"secondary",size:"xsmall",onClick:()=>{openPrimaryMetricSourceModal()},disabledReason:primaryMetricsLengthWithSharedMetrics>=10?"You can only add up to 10 primary metrics.":void 0,children:"Add primary metric"})}function AddSecondaryMetric(){let{secondaryMetricsLengthWithSharedMetrics}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{openSecondaryMetricSourceModal}=(0,index_esm.useActions)(experiments_experimentLogic.Wl);return(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),type:"secondary",size:"xsmall",onClick:()=>{openSecondaryMetricSourceModal()},disabledReason:secondaryMetricsLengthWithSharedMetrics>=10?"You can only add up to 10 secondary metrics.":void 0,children:"Add secondary metric"})}function MetricsView(_ref){let{isSecondary}=_ref,{experiment,_getMetricType,metricResults,secondaryMetricResults,primaryMetricsResultErrors,secondaryMetricsResultErrors,credibleIntervalForVariant}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),variants=experiment?.feature_flag?.filters?.multivariate?.variants;if(!variants)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let results=isSecondary?secondaryMetricResults:metricResults,errors=isSecondary?secondaryMetricsResultErrors:primaryMetricsResultErrors,hasSomeResults=results?.some(result=>result?.insight),metrics=isSecondary?experiment.metrics_secondary:experiment.metrics,sharedMetrics=experiment.saved_metrics.filter(sharedMetric=>sharedMetric.metadata.type===(isSecondary?"secondary":"primary")).map(sharedMetric=>({...sharedMetric.query,name:sharedMetric.name,sharedMetricId:sharedMetric.saved_metric,isSharedMetric:!0}));sharedMetrics&&(metrics=[...metrics,...sharedMetrics]);let maxAbsValue=Math.max(...metrics.flatMap((metric,metricIndex)=>{let result=results?.[metricIndex];return result?variants.flatMap(variant=>{let metricType=_getMetricType(metric),interval=credibleIntervalForVariant(result,variant.key,metricType);return interval?[Math.abs(interval[0]/100),Math.abs(interval[1]/100)]:[]}):[]})),chartBound=maxAbsValue+Math.max(.05*maxAbsValue,.1),commonTickValues=function(maxAbsValue){let baseUnit;maxAbsValue=Math.ceil(10*maxAbsValue)/10;let magnitude=Math.floor(Math.log10(maxAbsValue)),power=Math.pow(10,magnitude),normalizedMax=maxAbsValue/power;baseUnit=normalizedMax<=1?.2*power:normalizedMax<=2?.5*power:normalizedMax<=5?1*power:2*power;let unitsNeeded=Math.ceil(maxAbsValue/baseUnit),decimalPlaces=Math.max(0,-magnitude+1),ticks=[];for(let i=-unitsNeeded;i<=unitsNeeded;i++){let tickValue=Number((baseUnit*i).toFixed(decimalPlaces));ticks.push(tickValue)}return ticks}(chartBound);return(0,jsx_runtime.jsxs)("div",{className:"mb-4 -mt-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2 pt-5",children:(0,jsx_runtime.jsxs)("div",{className:"inline-flex items-center space-x-2 mb-0",children:[(0,jsx_runtime.jsx)("h2",{className:"mb-0 font-semibold text-lg leading-6",children:isSecondary?"Secondary metrics":"Primary metrics"}),metrics.length>0&&(0,jsx_runtime.jsx)(src.u,{title:isSecondary?"Secondary metrics capture additional outcomes or behaviors affected by your experiment. They help you understand broader impacts and potential side effects beyond the primary goal.":"Primary metrics represent the main goal of your experiment. They directly measure whether your hypothesis was successful and are the key factor in deciding if the test achieved its primary objective.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-lg"})}),hasSomeResults&&!isSecondary&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.p2,{vertical:!0,className:"mx-2"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{className:"p-2",children:[(0,jsx_runtime.jsxs)("p",{className:"mb-4",children:["Each bar shows how a variant is performing compared to the control (the gray bar) for this metric, using a"," ",(0,jsx_runtime.jsx)("strong",{children:"95% credible interval."}),' That means there\'s a 95% chance the true difference for that variant falls within this range. The vertical "0%" line is your baseline:']}),(0,jsx_runtime.jsxs)("ul",{className:"mb-4 list-disc pl-4",children:[(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"To the right (green):"})," The metric is higher (an improvement)."]}),(0,jsx_runtime.jsxs)("li",{children:[(0,jsx_runtime.jsx)("strong",{children:"To the left (red):"})," The metric is lower (a decrease)."]})]}),(0,jsx_runtime.jsxs)("p",{className:"mb-4",children:["The ",(0,jsx_runtime.jsx)("strong",{children:"width of the bar"})," represents uncertainty. A"," ",(0,jsx_runtime.jsx)("strong",{children:"narrower bar"})," means we're more confident in that result, while a ",(0,jsx_runtime.jsx)("strong",{children:"wider bar"})," means it could shift either way."]}),(0,jsx_runtime.jsx)("p",{className:"mb-4",children:"The control (baseline) is always shown in gray. Other bars will be green or redor even a mixdepending on whether the change is positive or negative."}),(0,jsx_runtime.jsx)("img",{src:"https://res.cloudinary.com/dmukukwp6/image/upload/Screenshot_2024_12_28_at_21_09_55_8828faf254.png",width:700,className:"rounded border object-contain",alt:"How to read metrics"})]}),children:(0,jsx_runtime.jsx)("span",{className:"text-xs text-muted-alt cursor-help",children:"How to read"})})]})]})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,jsx_runtime.jsx)("div",{className:"ml-auto",children:metrics.length>0&&(0,jsx_runtime.jsx)("div",{className:"mb-2 mt-4 justify-end",children:isSecondary?(0,jsx_runtime.jsx)(AddSecondaryMetric,{}):(0,jsx_runtime.jsx)(AddPrimaryMetric,{})})})})]}),metrics.length>0?(0,jsx_runtime.jsx)("div",{className:"w-full overflow-x-auto",children:(0,jsx_runtime.jsx)("div",{className:"min-w-[1000px]",children:metrics.map((metric,metricIndex)=>{let result=results?.[metricIndex],isFirstMetric=0===metricIndex;return(0,jsx_runtime.jsx)("div",{className:`w-full border border-border bg-light ${1===metrics.length?"rounded":isFirstMetric?"rounded-t":metricIndex===metrics.length-1?"rounded-b":""}`,children:(0,jsx_runtime.jsx)(DeltaChart,{isSecondary:!!isSecondary,result:result,error:errors?.[metricIndex],variants:variants,metricType:_getMetricType(metric),metricIndex:metricIndex,isFirstMetric:isFirstMetric,metric:metric,tickValues:commonTickValues,chartBound:chartBound})},metricIndex)})})}):(0,jsx_runtime.jsx)("div",{className:"border rounded bg-bg-light pt-6 pb-8 text-muted mt-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center mx-auto space-y-3",children:[(0,jsx_runtime.jsx)(icons.Ii,{fontSize:"30"}),(0,jsx_runtime.jsxs)("div",{className:"text-sm text-center text-balance",children:["Add up to ",10," ",isSecondary?"secondary":"primary"," metrics."]}),isSecondary?(0,jsx_runtime.jsx)(AddSecondaryMetric,{}):(0,jsx_runtime.jsx)(AddPrimaryMetric,{})]})})]})}var EmptyStates=__webpack_require__("./frontend/src/scenes/insights/EmptyStates/index.ts"),InsightViz=__webpack_require__("./frontend/src/queries/nodes/InsightViz/InsightViz.tsx");function CumulativeExposuresChart(){let query;let{experiment,metricResults,_getMetricType}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),metricType=_getMetricType(experiment.metrics[0]),result=metricResults?.[0],variants=experiment.parameters?.feature_flag_variants?.map(variant=>variant.key)||[];return experiment.holdout&&variants.push(`holdout-${experiment.holdout.id}`),query=metricType===types.dw.TRENDS?{kind:schema_general.OH.InsightVizNode,source:result?.exposure_query||{kind:schema_general.OH.TrendsQuery,series:[],interval:"day"}}:{kind:schema_general.OH.InsightVizNode,source:{kind:schema_general.OH.TrendsQuery,dateRange:{date_from:experiment.start_date,date_to:experiment.end_date},interval:"day",trendsFilter:{display:types.Qb.ActionsLineGraphCumulative,showLegend:!1,smoothingIntervals:1},series:[{kind:schema_general.OH.EventsNode,event:experiment.filters?.events?.[0]?.name,math:types.vN.UniqueUsers,properties:[{key:`$feature/${experiment.feature_flag_key}`,value:variants,operator:types.WV.Exact,type:types.FT.Event}]}],breakdownFilter:{breakdown:`$feature/${experiment.feature_flag_key}`,breakdown_type:"event"}}},(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex space-x-2 items-center mb-2",children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-0",children:"Cumulative exposures"}),(0,jsx_runtime.jsx)(src.u,{title:"Monitor number of unique users exposed to the experiment, and confirm the allocation matches the expected distribution between variants.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})})]}),experiment.start_date?(0,jsx_runtime.jsx)(InsightViz.hs,{query:{...query,showTable:!0},setQuery:()=>{},readOnly:!0,context:{emptyStateHeading:"No exposures to show yet",emptyStateDetail:"Hold tight! The chart will appear once some events are processed."}}):(0,jsx_runtime.jsx)("div",{className:"border rounded bg-bg-light",children:(0,jsx_runtime.jsx)(EmptyStates.dV,{heading:"No exposures to show yet",detail:"This chart will display once the experiment starts."})})]})}var animations=__webpack_require__("./frontend/src/lib/animations/animations.ts"),Animation=__webpack_require__("./frontend/src/lib/components/Animation/Animation.tsx"),experiments_utils=__webpack_require__("./frontend/src/scenes/experiments/utils.ts"),LemonSlider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSlider/index.ts"),insightLogic=__webpack_require__("./frontend/src/scenes/insights/insightLogic.tsx"),experiments_constants=__webpack_require__("./frontend/src/scenes/experiments/constants.ts");function FunnelCalculation(_ref){let{experimentId}=_ref,{minimumDetectableEffect,experiment,conversionMetrics,minimumSampleSizePerVariant,recommendedRunningTime,variants}=(0,index_esm.useValues)((0,experiments_experimentLogic.Wl)({experimentId})),funnelConversionRate=conversionMetrics?.totalRate*100||0,conversionRate=100*conversionMetrics.totalRate,sampleSizePerVariant=minimumSampleSizePerVariant(conversionRate),funnelSampleSize=sampleSizePerVariant*variants.length,baselineConversionRate=funnelConversionRate.toFixed(1),minimumAcceptableConversionRate=(funnelConversionRate+(minimumDetectableEffect||5)).toFixed(1),recommendedSampleSize=(0,utils.Lc)(funnelSampleSize||0);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap",children:[!experiment?.start_date&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Baseline Conversion Rate"}),(0,jsx_runtime.jsxs)("div",{className:"l4",children:[baselineConversionRate,"%"]})]}),(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Conversion Rate"}),(0,jsx_runtime.jsxs)("div",{className:"l4",children:[minimumAcceptableConversionRate,"%"]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended Sample Size"}),(0,jsx_runtime.jsxs)("div",{className:"pb-4",children:[(0,jsx_runtime.jsxs)("span",{className:"l4",children:["~",recommendedSampleSize]})," persons"]})]}),!experiment?.start_date&&(0,jsx_runtime.jsxs)("div",{className:"w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("span",{className:"l4",children:["~",recommendedRunningTime]})," days"]})]})]})}function TrendCalculation(_ref2){let{experimentId}=_ref2,{minimumDetectableEffect,experiment,trendResults,recommendedExposureForCountData}=(0,index_esm.useValues)((0,experiments_experimentLogic.Wl)({experimentId})),trendCount=trendResults[0]?.count||0,trendExposure=recommendedExposureForCountData(trendCount),baselineCount=(0,utils.Lc)(trendCount||0),minimumAcceptableCount=(0,utils.Lc)(trendCount+Math.ceil(trendCount*((minimumDetectableEffect||5)/100))||0),recommendedRunningTime=(0,utils.Lc)(trendExposure||0);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap",children:[!experiment?.start_date&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Baseline Count"}),(0,jsx_runtime.jsx)("div",{className:"l4",children:baselineCount})]}),(0,jsx_runtime.jsxs)("div",{className:"mb-4 w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Minimum Acceptable Count"}),(0,jsx_runtime.jsx)("div",{className:"l4",children:minimumAcceptableCount})]})]}),(0,jsx_runtime.jsxs)("div",{className:"w-1/2",children:[(0,jsx_runtime.jsx)("div",{className:"card-secondary",children:"Recommended running time"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("span",{className:"l4",children:["~",recommendedRunningTime]})," days"]})]})]})}function DataCollectionCalculator(_ref3){let{experimentId}=_ref3,{_getMetricType,minimumDetectableEffect,experiment,conversionMetrics}=(0,index_esm.useValues)((0,experiments_experimentLogic.Wl)({experimentId})),{setExperiment}=(0,index_esm.useActions)((0,experiments_experimentLogic.Wl)({experimentId})),metricType=_getMetricType(experiment.metrics[0]),insightLogicInstance=(0,insightLogic.zm)({dashboardItemId:metricType===types.dw.FUNNELS?experiments_constants.W.Funnels:experiments_constants.W.Trends,syncWithUrl:!1}),{insightProps}=(0,index_esm.useValues)(insightLogicInstance),query=null;experiment.metrics.length>0&&(query={kind:schema_general.OH.InsightVizNode,source:metricType===types.dw.FUNNELS?experiment.metrics[0].funnels_query:experiment.metrics[0].count_query});let funnelConversionRate=conversionMetrics?.totalRate*100||0,sliderMaxValue=0;return sliderMaxValue=metricType===types.dw.FUNNELS?100-funnelConversionRate<50?100-funnelConversionRate:50:100,(0,jsx_runtime.jsx)("div",{className:"flex",children:(0,jsx_runtime.jsxs)("div",{className:"w-full",children:[(0,jsx_runtime.jsxs)("div",{className:"mb-4 experiment-preview-row",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("b",{children:"Minimum detectable effect"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"The Minimum detectable effect represents the smallest change that you want to be able to detect in your experiment."}),(0,jsx_runtime.jsx)("div",{children:"To make things easier, we initially set this value to a reasonable default. However, we encourage you to review and adjust it based on your specific goals."}),(0,jsx_runtime.jsxs)("div",{children:["Read more in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/experiments/sample-size-running-time#minimum-detectable-effect-mde",children:"documentation."})]})]}),closeDelayMs:200,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base ml-1"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[(0,jsx_runtime.jsx)(LemonSlider.j,{value:minimumDetectableEffect,min:1,max:sliderMaxValue,step:1,onChange:value=>{setExperiment({parameters:{...experiment.parameters,minimum_detectable_effect:value}})},className:"w-5/6"}),(0,jsx_runtime.jsx)(src.DF,{className:"w-1/6","data-attr":"min-detectable-effect",type:"number",min:1,max:sliderMaxValue,defaultValue:5,suffix:(0,jsx_runtime.jsx)("span",{children:"%"}),value:minimumDetectableEffect,onChange:value=>{value&&setExperiment({parameters:{...experiment.parameters,minimum_detectable_effect:value}})}})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col experiment-preview-row",children:[(0,jsx_runtime.jsx)(src.Vp,{type:"info",className:"mb-4",children:"The calculations are based on the events received in the last 14 days. This event count may differ from what was considered in earlier estimates."}),_getMetricType(experiment.metrics[0])===types.dw.TRENDS?(0,jsx_runtime.jsx)(TrendCalculation,{experimentId:experimentId}):(0,jsx_runtime.jsx)(FunnelCalculation,{experimentId:experimentId}),(0,jsx_runtime.jsx)("div",{className:"hidden",children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:insightLogic.zm,props:insightProps,children:(0,jsx_runtime.jsx)(Query_Query.A,{query:query,context:{insightProps},readOnly:!0})})})]})]})})}function DataCollection(){let{experimentId,experiment,_getMetricType,funnelResultsPersonsTotal,actualRunningTime,minimumDetectableEffect}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{openExperimentCollectionGoalModal}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),metricType=_getMetricType(experiment.metrics[0]),recommendedRunningTime=experiment?.parameters?.recommended_running_time||1,recommendedSampleSize=experiment?.parameters?.recommended_sample_size||100,experimentProgressPercent=metricType===types.dw.FUNNELS?funnelResultsPersonsTotal(0)/recommendedSampleSize*100:actualRunningTime/recommendedRunningTime*100,hasHighRunningTime=recommendedRunningTime>62,GoalTooltip=()=>experiment?.parameters?.minimum_detectable_effect?(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{children:`Based on the Minimum detectable effect of ${experiment.parameters.minimum_detectable_effect}%.`}),hasHighRunningTime&&(0,jsx_runtime.jsx)("div",{className:"mt-2",children:"Given the current data, this experiment might take a while to reach statistical significance. Please make sure events are being tracked correctly and consider if this timeline works for you."})]}),children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"inline-flex items-center space-x-2",children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-0",children:"Data collection"}),(0,jsx_runtime.jsx)(src.u,{title:"Estimated target for the number of participants. Actual data may reveal significance earlier or later than predicted.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsxs)("div",{className:"w-3/5 pr-4",children:[(0,jsx_runtime.jsx)("div",{className:"mt-2 mb-1 font-semibold",children:`${experimentProgressPercent>100?100:experimentProgressPercent.toFixed(2)}% complete`}),(0,jsx_runtime.jsx)(LemonProgress.b,{className:"w-full border",bgColor:"var(--bg-table)",size:"medium",percent:experimentProgressPercent}),metricType===types.dw.TRENDS&&(0,jsx_runtime.jsx)("div",{className:"flex justify-between mt-0",children:(0,jsx_runtime.jsxs)("span",{className:"flex items-center text-xs",children:["Completed\xa0",(0,jsx_runtime.jsxs)("b",{children:[actualRunningTime," of"]}),hasHighRunningTime?(0,jsx_runtime.jsx)("b",{children:"\xa0 > 60 days"}):(0,jsx_runtime.jsxs)("span",{children:["\xa0",(0,jsx_runtime.jsx)("b",{children:recommendedRunningTime})," ",(0,experiments_utils.Du)(recommendedRunningTime,"day")]}),(0,jsx_runtime.jsx)("span",{className:"ml-1 text-xs",children:(0,jsx_runtime.jsx)(GoalTooltip,{})})]})}),metricType===types.dw.FUNNELS&&(0,jsx_runtime.jsx)("div",{className:"flex justify-between mt-0",children:(0,jsx_runtime.jsxs)("div",{className:"space-x-1 flex items-center text-xs",children:[(0,jsx_runtime.jsxs)("span",{children:["Saw\xa0",(0,jsx_runtime.jsxs)("b",{children:[(0,utils.Lc)(funnelResultsPersonsTotal(0))," of"," ",(0,utils.Lc)(recommendedSampleSize)," "]})," ",(0,experiments_utils.Du)(recommendedSampleSize,"participant")]}),(0,jsx_runtime.jsx)(GoalTooltip,{})]})})]}),(0,jsx_runtime.jsx)(src.p2,{className:"my-0",vertical:!0}),(0,jsx_runtime.jsxs)("div",{className:"w-2/5 pl-4",children:[(0,jsx_runtime.jsxs)("div",{className:`text-lg font-semibold ${experiment.end_date?"mt-4":""}`,children:[minimumDetectableEffect,"%"]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs space-x-1 text-sm flex",children:[(0,jsx_runtime.jsx)("span",{children:"Minimum detectable effect"}),(0,jsx_runtime.jsx)(src.u,{title:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)("div",{children:"The Minimum detectable effect represents the smallest change that you want to be able to detect in your experiment."}),(0,jsx_runtime.jsx)("div",{children:"To make things easier, we initially set this value to a reasonable default. However, we encourage you to review and adjust it based on your specific goals."}),(0,jsx_runtime.jsxs)("div",{children:["Read more in the"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/experiments/sample-size-running-time#minimum-detectable-effect-mde",children:"documentation."})]})]}),closeDelayMs:200,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})})]}),!experiment.end_date&&(0,jsx_runtime.jsx)("div",{className:"w-24",children:(0,jsx_runtime.jsx)(src.Jp,{className:"mt-2",size:"xsmall",type:"secondary",onClick:openExperimentCollectionGoalModal,children:(0,jsx_runtime.jsx)("span",{className:"px-0",children:"Edit"})})}),(0,jsx_runtime.jsx)(DataCollectionGoalModal,{experimentId:experimentId})]})]})]})}function DataCollectionGoalModal(_ref){let{experimentId}=_ref,{isExperimentCollectionGoalModalOpen,experiment,_getMetricType,trendMetricInsightLoading,funnelMetricInsightLoading}=(0,index_esm.useValues)((0,experiments_experimentLogic.Wl)({experimentId})),{closeExperimentCollectionGoalModal,updateExperimentCollectionGoal}=(0,index_esm.useActions)((0,experiments_experimentLogic.Wl)({experimentId})),isInsightLoading=_getMetricType(experiment.metrics[0])===types.dw.TRENDS?trendMetricInsightLoading:funnelMetricInsightLoading;return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isExperimentCollectionGoalModalOpen,onClose:closeExperimentCollectionGoalModal,width:550,title:"Recalculate estimated sample size",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",type:"secondary",onClick:closeExperimentCollectionGoalModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{form:"edit-experiment-exposure-form",onClick:()=>updateExperimentCollectionGoal(),type:"primary","data-attr":"create-annotation-submit",children:"Save"})]}),children:isInsightLoading?(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 justify-center items-center mb-6",children:[(0,jsx_runtime.jsx)(Animation.f,{type:animations.ru.LaptopHog}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-muted w-60",children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:"Fetching past events for the estimation"}),(0,jsx_runtime.jsx)(components.QT,{})]})]}):(0,jsx_runtime.jsx)(DataCollectionCalculator,{experimentId:experimentId})})}var featureFlagLogic=__webpack_require__("./frontend/src/scenes/feature-flags/featureFlagLogic.ts");function HoldoutSelector_HoldoutSelector(){let{experiment,holdouts,isExperimentRunning}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{setExperiment,reportExperimentHoldoutAssigned}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),holdoutOptions=holdouts.map(holdout=>({value:holdout.id,label:holdout.name}));return holdoutOptions.unshift({value:null,label:"No holdout"}),(0,jsx_runtime.jsxs)("div",{className:"mt-3",children:[(0,jsx_runtime.jsxs)("div",{className:"inline-flex space-x-1",children:[(0,jsx_runtime.jsx)("h4",{className:"font-semibold mb-0",children:"Holdout group"}),(0,jsx_runtime.jsx)(src.u,{title:"Exclude a stable group of users from the experiment. This cannot be changed once the experiment is launched.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt text-base"})})]}),(0,jsx_runtime.jsx)("div",{className:"mt-1",children:(0,jsx_runtime.jsx)(src.Yv,{disabledReason:isExperimentRunning&&!experiment.end_date&&"The holdout group cannot be changed once the experiment is launched.",size:"xsmall",options:holdoutOptions,value:experiment.holdout_id||null,onChange:value=>{setExperiment({...experiment,holdout_id:value}),reportExperimentHoldoutAssigned({experimentId:experiment.id,holdoutId:value})},"data-attr":"experiment-holdout-selector"})})]})}var useUploadFiles=__webpack_require__("./frontend/src/lib/hooks/useUploadFiles.ts");function VariantScreenshot(_ref){let{variantKey,rolloutPercentage}=_ref,{experiment}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{updateExperimentVariantImages,reportExperimentVariantScreenshotUploaded}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),[mediaIds,setMediaIds]=(0,react.useState)((()=>{let variantImages=experiment.parameters?.variant_screenshot_media_ids?.[variantKey];return variantImages?Array.isArray(variantImages)?variantImages:[variantImages]:[]})()),[loadingImages,setLoadingImages]=(0,react.useState)({}),[selectedImageIndex,setSelectedImageIndex]=(0,react.useState)(null),{setFilesToUpload,filesToUpload,uploading}=(0,useUploadFiles.nc)({onUpload:(_,__,id)=>{if(id&&mediaIds.length<5){let newMediaIds=[...mediaIds,id];setMediaIds(newMediaIds);let updatedVariantImages={...experiment.parameters?.variant_screenshot_media_ids,[variantKey]:newMediaIds};updateExperimentVariantImages(updatedVariantImages),reportExperimentVariantScreenshotUploaded(experiment.id)}else mediaIds.length>=5&&src.UJ.error("Maximum of 5 images allowed")},onError:detail=>{src.UJ.error(`Error uploading image: ${detail}`)}}),handleImageLoad=mediaId=>{setLoadingImages(prev=>({...prev,[mediaId]:!1}))},handleImageError=mediaId=>{setLoadingImages(prev=>({...prev,[mediaId]:!1}))},handleDelete=indexToDelete=>{let newMediaIds=mediaIds.filter((_,index)=>index!==indexToDelete);setMediaIds(newMediaIds);let updatedVariantImages={...experiment.parameters?.variant_screenshot_media_ids,[variantKey]:newMediaIds};updateExperimentVariantImages(updatedVariantImages)},widthClass=(()=>{let totalItems=mediaIds.length<5?mediaIds.length+1:mediaIds.length;switch(totalItems){case 1:case 2:default:return"w-20";case 3:return"w-16";case 4:return"w-14";case 5:return"w-12"}})();return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 items-start",children:[mediaIds.map((mediaId,index)=>(0,jsx_runtime.jsx)("div",{className:"relative",children:(0,jsx_runtime.jsx)("div",{className:"text-muted inline-flex flow-row items-center gap-1 cursor-pointer",children:(0,jsx_runtime.jsxs)("div",{onClick:()=>setSelectedImageIndex(index),className:"cursor-zoom-in relative",children:[(0,jsx_runtime.jsxs)("div",{className:`relative flex overflow-hidden select-none ${widthClass} h-16 rounded before:absolute before:inset-0 before:border before:rounded`,children:[loadingImages[mediaId]&&(0,jsx_runtime.jsx)(src.yW,{className:"absolute inset-0"}),(0,jsx_runtime.jsx)("img",{className:"w-full h-full object-cover",src:mediaId.startsWith("data:")?mediaId:`/uploaded_media/${mediaId}`,onError:()=>handleImageError(mediaId),onLoad:()=>handleImageLoad(mediaId)})]}),(0,jsx_runtime.jsx)("div",{className:"absolute -inset-2 group",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:e=>{e.stopPropagation(),handleDelete(index)},size:"small",tooltip:"Remove",tooltipPlacement:"right",noPadding:!0,className:"group-hover:flex hidden absolute right-0 top-0"})})]})})},mediaId)),mediaIds.length<5&&(0,jsx_runtime.jsx)("div",{className:`relative ${widthClass} h-16`,children:(0,jsx_runtime.jsx)(src.mH,{accept:"image/*",multiple:!1,onChange:setFilesToUpload,loading:uploading,value:filesToUpload,callToAction:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-full h-16 border border-dashed rounded cursor-pointer hover:border-[var(--primary)]",children:(0,jsx_runtime.jsx)("span",{className:"text-2xl text-muted",children:"+"})})})})]}),(0,jsx_runtime.jsx)(src.fQ,{isOpen:null!==selectedImageIndex,onClose:()=>setSelectedImageIndex(null),title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsxs)("span",{children:["Screenshot ",null!==selectedImageIndex?selectedImageIndex+1:""]}),(0,jsx_runtime.jsx)(src.p2,{className:"my-0 mx-1",vertical:!0}),(0,jsx_runtime.jsx)(components.Aw,{experimentId:experiment.id,variantKey:variantKey}),void 0!==rolloutPercentage&&(0,jsx_runtime.jsxs)("span",{className:"text-muted text-sm",children:["(",rolloutPercentage,"% rollout)"]})]}),children:null!==selectedImageIndex&&mediaIds[selectedImageIndex]&&(0,jsx_runtime.jsx)("img",{src:mediaIds[selectedImageIndex]?.startsWith("data:")?mediaIds[selectedImageIndex]:`/uploaded_media/${mediaIds[selectedImageIndex]}`,alt:`Screenshot ${selectedImageIndex+1}: ${variantKey}`,className:"max-w-full max-h-[80vh] overflow-auto"})})]})}function DistributionModal(_ref){var _experiment$feature_f;let{experimentId}=_ref,{experiment,experimentLoading,isDistributionModalOpen}=(0,index_esm.useValues)((0,experiments_experimentLogic.Wl)({experimentId})),{closeDistributionModal,updateDistributionModal}=(0,index_esm.useActions)((0,experiments_experimentLogic.Wl)({experimentId})),_featureFlagLogic=(0,featureFlagLogic.hk)({id:null!==(_experiment$feature_f=experiment.feature_flag?.id)&&void 0!==_experiment$feature_f?_experiment$feature_f:null}),{featureFlag,areVariantRolloutsValid,variantRolloutSum}=(0,index_esm.useValues)(_featureFlagLogic),{setFeatureFlagFilters,distributeVariantsEqually}=(0,index_esm.useActions)(_featureFlagLogic),handleRolloutPercentageChange=(index,value)=>{if(!featureFlag?.filters?.multivariate||!value)return;let updatedVariants=featureFlag.filters.multivariate.variants.map((variant,i)=>i===index?{...variant,rollout_percentage:value}:variant);setFeatureFlagFilters({...featureFlag.filters,multivariate:{...featureFlag.filters.multivariate,variants:updatedVariants}},null)};return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isDistributionModalOpen,onClose:closeDistributionModal,width:600,title:"Change experiment distribution",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:closeDistributionModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{updateDistributionModal(featureFlag),closeDistributionModal()},type:"primary",loading:experimentLoading,disabled:!areVariantRolloutsValid,children:"Save"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:"Adjusting variant distribution may impact the validity of your results. Adjust only if you're aware of how changes will affect your experiment."}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,jsx_runtime.jsx)("h3",{className:"font-semibold mb-0",children:"Variant Distribution"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",onClick:distributeVariantsEqually,tooltip:"Redistribute variant rollout percentages equally",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBalance,{}),children:"Distribute equally"})]}),(0,jsx_runtime.jsx)(src.g3,{dataSource:featureFlag?.filters?.multivariate?.variants||[],columns:[{title:"Variant",dataIndex:"key",render:value=>(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:value})},{title:"Rollout Percentage",dataIndex:"rollout_percentage",render:(_,record,index)=>(0,jsx_runtime.jsx)(src.DF,{type:"number",value:record.rollout_percentage,onChange:value=>handleRolloutPercentageChange(index,value),min:0,max:100,suffix:(0,jsx_runtime.jsx)("span",{children:"%"})})}]}),!areVariantRolloutsValid&&(0,jsx_runtime.jsxs)("p",{className:"text-danger mt-2",children:["Percentage rollouts must sum to 100 (currently ",variantRolloutSum,")."]})]}),(0,jsx_runtime.jsx)(HoldoutSelector_HoldoutSelector,{})]})})}function DistributionTable(){let{openDistributionModal}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),{experimentId,experiment,metricResults}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{reportExperimentReleaseConditionsViewed}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),result=metricResults?.[0],onSelectElement=variant=>{src.dn.open({title:"Select a domain",description:"Choose the domain on which to preview this experiment variant",content:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(AuthorizedUrlList.t,{query:"?__experiment_id="+experiment?.id+"&__experiment_variant="+variant,experimentId:experiment?.id,type:authorizedUrlListLogic.uw.WEB_EXPERIMENTS})}),primaryButton:{children:"Close",type:"secondary"}})},className=experiment?.type==="web"?"w-1/2.5":"w-1/3",columns=[{className:className,key:"key",title:"Variant",render:function Key(_,item){return result&&result.insight?(0,jsx_runtime.jsx)(components.Aw,{experimentId:experimentId,variantKey:item.key}):(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:item.key})}},{className:className,key:"rollout_percentage",title:"Rollout",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{children:`${item.rollout_percentage}%`})}},{className:className,key:"variant_screenshot",title:"Screenshot",render:function Key(_,item){return item.key===`holdout-${experiment.holdout?.id}`?(0,jsx_runtime.jsx)("div",{className:"h-16"}):(0,jsx_runtime.jsx)("div",{className:"my-2",children:(0,jsx_runtime.jsx)(VariantScreenshot,{variantKey:item.key,rolloutPercentage:item.rollout_percentage})})}}];"web"===experiment.type&&columns.push({className:className,key:"preview_web_experiment",title:"Preview",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{className:"my-2",children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",type:"secondary",onClick:e=>{e.preventDefault(),onSelectElement(item.key)},sideIcon:(0,jsx_runtime.jsx)(icons.UE,{}),children:"Preview variant"})})}});let holdoutData=experiment.holdout?[{key:`holdout-${experiment.holdout.id}`,rollout_percentage:experiment.holdout.filters[0].rollout_percentage}]:[],variantData=(experiment.feature_flag?.filters.multivariate?.variants||[]).map(variant=>({...variant,rollout_percentage:variant.rollout_percentage*((100-(experiment.holdout?.filters[0].rollout_percentage||0))/100)})),tableData=[...variantData,...holdoutData];return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2",children:(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg",children:"Distribution"})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,jsx_runtime.jsx)("div",{className:"ml-auto mb-2",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFlag,{}),onClick:()=>{openDistributionModal(),reportExperimentReleaseConditionsViewed(experiment.id)},type:"secondary",size:"xsmall",className:"font-semibold",children:"Manage distribution"})})})]}),experiment.holdout&&(0,jsx_runtime.jsxs)(src.Vp,{type:"info",className:"mb-4",children:["This experiment has a holdout group of ",experiment.holdout.filters[0].rollout_percentage,"%. The variants are modified to show their relative rollout percentage."]}),(0,jsx_runtime.jsx)(src.g3,{loading:!1,columns:columns,dataSource:tableData,rowClassName:item=>item.key===`holdout-${experiment.holdout?.id}`?"bg-mid":""})]})}var Info=__webpack_require__("./frontend/src/scenes/experiments/ExperimentView/Info.tsx"),FeatureFlagReleaseConditions=__webpack_require__("./frontend/src/scenes/feature-flags/FeatureFlagReleaseConditions.tsx"),groupsModel=__webpack_require__("./frontend/src/models/groupsModel.ts");function ReleaseConditionsModal(_ref){var _experiment$feature_f,_featureFlag$filters;let{experimentId}=_ref,{experiment,isReleaseConditionsModalOpen}=(0,index_esm.useValues)((0,experiments_experimentLogic.Wl)({experimentId})),{closeReleaseConditionsModal}=(0,index_esm.useActions)((0,experiments_experimentLogic.Wl)({experimentId})),_featureFlagLogic=(0,featureFlagLogic.hk)({id:null!==(_experiment$feature_f=experiment.feature_flag?.id)&&void 0!==_experiment$feature_f?_experiment$feature_f:null}),{featureFlag,nonEmptyVariants}=(0,index_esm.useValues)(_featureFlagLogic),{setFeatureFlagFilters,saveSidebarExperimentFeatureFlag}=(0,index_esm.useActions)(_featureFlagLogic);return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isReleaseConditionsModalOpen,onClose:closeReleaseConditionsModal,width:600,title:"Change release conditions",footer:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:closeReleaseConditionsModal,children:"Cancel"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{saveSidebarExperimentFeatureFlag(featureFlag),closeReleaseConditionsModal()},type:"primary",children:"Save"})]}),children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)(src.Vp,{type:"info",children:"Adjusting user targeting may impact the validity of your results. Adjust only if you're aware of how changes will affect your experiment."}),(0,jsx_runtime.jsx)(FeatureFlagReleaseConditions.I,{id:`${experiment.feature_flag?.id}`,filters:null!==(_featureFlag$filters=featureFlag?.filters)&&void 0!==_featureFlag$filters?_featureFlag$filters:[],onChange:setFeatureFlagFilters,nonEmptyFeatureFlagVariants:nonEmptyVariants})]})})}function ReleaseConditionsTable(){let{experiment}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{reportExperimentReleaseConditionsViewed,openReleaseConditionsModal}=(0,index_esm.useActions)(experiments_experimentLogic.Wl),{aggregationLabel}=(0,index_esm.useValues)(groupsModel.$);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)("div",{className:"w-1/2",children:(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg",children:"Release conditions"})}),(0,jsx_runtime.jsx)("div",{className:"w-1/2 flex flex-col justify-end",children:(0,jsx_runtime.jsx)("div",{className:"ml-auto mb-2",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFlag,{}),onClick:()=>{openReleaseConditionsModal(),reportExperimentReleaseConditionsViewed(experiment.id)},type:"secondary",size:"xsmall",className:"font-semibold",children:"Manage release conditions"})})})]}),(0,jsx_runtime.jsx)(src.g3,{loading:!1,columns:[{key:"key",title:"",render:function Key(_,_item,index){return(0,jsx_runtime.jsx)("div",{className:"font-semibold",children:`Set ${index+1}`})}},{key:"rollout_percentage",title:"Rollout",render:function Key(_,item){let aggregationTargetName=null!=experiment.filters.aggregation_group_type_index?aggregationLabel(experiment.filters.aggregation_group_type_index).plural:"users",releaseText=`${item.rollout_percentage}% of ${aggregationTargetName}`;return(0,jsx_runtime.jsx)("div",{children:releaseText.startsWith("100% of")?(0,jsx_runtime.jsx)(src.oe,{type:"highlight",children:releaseText}):releaseText})}},{key:"variant",title:"Override",render:function Key(_,item){return(0,jsx_runtime.jsx)("div",{children:item.variant||"--"})}}],dataSource:experiment.feature_flag?.filters.groups||[]})]})}let ResultsTab=()=>{let{experiment,metricResults}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),hasSomeResults=metricResults?.some(result=>result?.insight),hasSinglePrimaryMetric=1===experiment.metrics.length;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!hasSomeResults&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"web"===experiment.type?(0,jsx_runtime.jsx)(WebExperimentImplementationDetails,{experiment:experiment}):(0,jsx_runtime.jsx)(ExperimentImplementationDetails.aK,{experiment:experiment})}),hasSinglePrimaryMetric&&(0,jsx_runtime.jsx)("div",{className:"mb-4",children:(0,jsx_runtime.jsx)(Overview,{})}),(0,jsx_runtime.jsx)(MetricsView,{isSecondary:!1}),hasSomeResults&&hasSinglePrimaryMetric&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"pb-4",children:(0,jsx_runtime.jsx)(SummaryTable.H,{metric:experiment.metrics[0],metricIndex:0,isSecondary:!1})}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(components.lM,{result:metricResults?.[0]||null,size:"xsmall"})}),(0,jsx_runtime.jsx)("div",{className:"pb-4",children:(0,jsx_runtime.jsx)(components.MN,{result:metricResults?.[0]||null,showTable:!0})})]}),(0,jsx_runtime.jsx)(MetricsView,{isSecondary:!0})]})},VariantsTab=()=>(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsx)(ReleaseConditionsTable,{}),(0,jsx_runtime.jsx)(DistributionTable,{}),(0,jsx_runtime.jsx)(esm.EO,{flag:"experiments-cumulative-exposures-chart",match:"test",children:(0,jsx_runtime.jsx)(CumulativeExposuresChart,{})})]});function ExperimentView(){let{experimentLoading,metricResultsLoading,secondaryMetricResultsLoading,experimentId,tabKey}=(0,index_esm.useValues)(experiments_experimentLogic.Wl),{setTabKey}=(0,index_esm.useActions)(experiments_experimentLogic.Wl);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(components.nt,{}),(0,jsx_runtime.jsx)("div",{className:"space-y-8 experiment-view",children:experimentLoading?(0,jsx_runtime.jsx)(components.Gu,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Info.k,{}),metricResultsLoading||secondaryMetricResultsLoading?(0,jsx_runtime.jsx)(components.f7,{}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"xl:flex",children:(0,jsx_runtime.jsx)("div",{className:"w-1/2 mt-8 xl:mt-0",children:(0,jsx_runtime.jsx)(DataCollection,{})})}),(0,jsx_runtime.jsx)(src.TP,{activeKey:tabKey,onChange:key=>setTabKey(key),tabs:[{key:"results",label:"Results",content:(0,jsx_runtime.jsx)(ResultsTab,{})},{key:"variants",label:"Variants",content:(0,jsx_runtime.jsx)(VariantsTab,{})}]})]}),(0,jsx_runtime.jsx)(MetricSourceModal,{experimentId:experimentId,isSecondary:!0}),(0,jsx_runtime.jsx)(MetricSourceModal,{experimentId:experimentId,isSecondary:!1}),(0,jsx_runtime.jsx)(MetricModal,{experimentId:experimentId,isSecondary:!0}),(0,jsx_runtime.jsx)(MetricModal,{experimentId:experimentId,isSecondary:!1}),(0,jsx_runtime.jsx)(SharedMetricModal,{experimentId:experimentId,isSecondary:!0}),(0,jsx_runtime.jsx)(SharedMetricModal,{experimentId:experimentId,isSecondary:!1}),(0,jsx_runtime.jsx)(DistributionModal,{experimentId:experimentId}),(0,jsx_runtime.jsx)(ReleaseConditionsModal,{experimentId:experimentId})]})})]})}let scene={component:Experiment,logic:experiments_experimentLogic.Wl,paramsToProps:_ref=>{let{params:{id}}=_ref;return{experimentId:"new"===id?"new":parseInt(id)}}};function Experiment(){let{experimentId,editingExistingExperiment,experimentMissing}=(0,index_esm.useValues)(experiments_experimentLogic.Wl);return experimentMissing?(0,jsx_runtime.jsx)(NotFound.T,{object:"experiment"}):"new"===experimentId||editingExistingExperiment?(0,jsx_runtime.jsx)(ExperimentForm,{}):(0,jsx_runtime.jsx)(ExperimentView,{})}},"./frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{aK:()=>ExperimentImplementationDetails,JY:()=>OPTIONS});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),types=__webpack_require__("./frontend/src/types.ts"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function ServerSideWarning(){return(0,jsx_runtime.jsx)("div",{className:"warning",children:(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("b",{children:"Warning:"})," Server side experiment metrics require you to manually send the feature flag information."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/tutorials/experiments#step-2-sending-the-right-events",target:"_blank",children:"See this tutorial for more information."})]})})}let UTM_TAGS="?utm_medium=in-product&utm_campaign=experiment",DOC_BASE_URL="https://posthog.com/docs/",FF_ANCHOR="#feature-flags",LibraryType=function(LibraryType){return LibraryType.Client="Client",LibraryType.Server="Server",LibraryType}({}),OPTIONS=[{value:"JavaScript",key:types.lh.JS_WEB,documentationLink:`${DOC_BASE_URL}libraries/js${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.RQ,Snippet:function(_ref4){let{flagKey,variant}=_ref4;return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`if (posthog.getFeatureFlag('${flagKey}') === '${variant}') {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)("div",{className:"mt-4 mb-1",children:(0,jsx_runtime.jsx)("b",{children:"Test that it works"})}),(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`posthog.featureFlags.override({'${flagKey}': '${variant}'})`})]})},type:LibraryType.Client},{value:"Android",key:types.lh.ANDROID,documentationLink:`${DOC_BASE_URL}libraries/android${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.Kp,Snippet:function(_ref){let{flagKey,variant}=_ref;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Kotlin,wrap:!0,children:`if (PostHog.getFeatureFlag("${flagKey}") == "${variant}") {
    // do something
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`})})},type:LibraryType.Client},{value:"Go",key:types.lh.GO,documentationLink:`${DOC_BASE_URL}libraries/go${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.GH,Snippet:function(_ref8){let{flagKey,variant}=_ref8;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Go,wrap:!0,children:`experimentFlagValue, err := client.GetFeatureFlag(
                    FeatureFlagPayload{
                        Key:        '${flagKey}',
                        DistinctId: "distinct-id",
                    })

if (experimentFlagValue == '${variant}' ) {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})},type:LibraryType.Server},{value:"Flutter",key:types.lh.FLUTTER,documentationLink:`${DOC_BASE_URL}libraries/flutter${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.D_,Snippet:function(_ref9){let{flagKey,variant}=_ref9,variantSuffix=` == '${variant}'`;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Dart,wrap:!0,children:`if (await Posthog().getFeatureFlag('${flagKey}')${variantSuffix}) {
  // Do something differently for this user
} else {
  // It's a good idea to let control variant always be the default behaviour,
  // so if something goes wrong with flag evaluation, you don't break your app.
}
            `})})},type:LibraryType.Client},{value:"iOS",key:types.lh.IOS,documentationLink:`${DOC_BASE_URL}libraries/ios${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.in,Snippet:function(_ref2){let{flagKey,variant}=_ref2;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Swift,wrap:!0,children:`if (PostHogSDK.shared.getFeatureFlag("${flagKey}") as? String == "${variant}") {
    // do something
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`})})},type:LibraryType.Client},{value:"Node.js",key:types.lh.NODE_JS,documentationLink:`${DOC_BASE_URL}libraries/node${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.fS,Snippet:function(_ref3){let{flagKey,variant}=_ref3;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`const experimentFlagValue = await client.getFeatureFlag('${flagKey}', 'user distinct id')

if (experimentFlagValue === '${variant}' ) {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})},type:LibraryType.Server},{value:"PHP",key:types.lh.PHP,documentationLink:`${DOC_BASE_URL}libraries/php${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.W7,Snippet:function(_ref7){let{flagKey,variant}=_ref7;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.PHP,wrap:!0,children:`if (PostHog::getFeatureFlag('${flagKey}', 'user distinct id') == '${variant}') {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})},type:LibraryType.Server},{value:"Python",key:types.lh.PYTHON,documentationLink:`${DOC_BASE_URL}libraries/python${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.Bm,Snippet:function(_ref11){let{flagKey,variant}=_ref11;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Python,wrap:!0,children:`experiment_flag_value = posthog.get_feature_flag("${flagKey}", "user_distinct_id"):

if experiment_flag_value == '${variant}':
    # Do something differently for this user
else:
    # It's a good idea to let control variant always be the default behaviour,
    # so if something goes wrong with flag evaluation, you don't break your app.
`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})},type:LibraryType.Server},{value:"React",key:types.lh.REACT,documentationLink:`${DOC_BASE_URL}libraries/react${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.RQ,Snippet:function(_ref5){let{flagKey,variant}=_ref5;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`// You can either use the useFeatureFlagVariantKey hook,
// or you can use the feature flags component - https://posthog.com/docs/libraries/react#feature-flags-react-component

// Method one: using the useFeatureFlagVariantKey hook
import { useFeatureFlagVariantKey } from 'posthog-js/react'

function App() {
    const variant = useFeatureFlagVariantKey('${flagKey}')
    if (variant === '${variant}') {
        // do something
    }
}

// Method two: using the feature flags component
import { PostHogFeature } from 'posthog-js/react'

function App() {
    return (
        <PostHogFeature flag='${flagKey}' match='${variant}'>
            <div>
                {/* the component to show */}
            </div>
        </PostHogFeature>
    )
}

// You can also test your code by overriding the feature flag:
posthog.featureFlags.override({'${flagKey}': '${variant}'})`})})},type:LibraryType.Client},{value:"ReactNative",key:types.lh.REACT_NATIVE,documentationLink:`${DOC_BASE_URL}libraries/react-native${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.RQ,Snippet:function(_ref6){let{flagKey,variant}=_ref6;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.JavaScript,wrap:!0,children:`if (posthog.getFeatureFlag('${flagKey}') === '${variant}') {
    // Do something differently for this user
} else {
    // It's a good idea to let control variant always be the default behaviour,
    // so if something goes wrong with flag evaluation, you don't break your app.
}`})})},type:LibraryType.Client},{value:"Ruby",key:types.lh.RUBY,documentationLink:`${DOC_BASE_URL}libraries/ruby${UTM_TAGS}${FF_ANCHOR}`,Icon:icons.gz,Snippet:function(_ref10){let{flagKey,variant}=_ref10;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CodeSnippet.O,{language:CodeSnippet.S.Ruby,wrap:!0,children:`experimentFlagValue = posthog.get_feature_flag('${flagKey}', 'user distinct id')


if experimentFlagValue == '${variant}'
    # Do something differently for this user
else
    # It's a good idea to let control variant always be the default behaviour,
    # so if something goes wrong with flag evaluation, you don't break your app.
end
`}),(0,jsx_runtime.jsx)(ServerSideWarning,{})]})},type:LibraryType.Server}];function CodeLanguageSelect(_ref){let{selectedOptionValue,selectOption}=_ref;return(0,jsx_runtime.jsx)(src.Yv,{size:"small",className:"min-w-[7.5rem]",onSelect:selectOption,value:selectedOptionValue,options:[{title:"Client libraries",options:OPTIONS.filter(option=>option.type==LibraryType.Client).map(_ref2=>{let{Icon,value}=_ref2;return{value,label:value,labelInMenu:(0,jsx_runtime.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,jsx_runtime.jsx)(Icon,{}),(0,jsx_runtime.jsx)("span",{children:value})]})}})},{title:"Server libraries",options:OPTIONS.filter(option=>option.type==LibraryType.Server).map(_ref3=>{let{Icon,value}=_ref3;return{value,label:value,labelInMenu:(0,jsx_runtime.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,jsx_runtime.jsx)(Icon,{}),(0,jsx_runtime.jsx)("span",{children:value})]})}})}]})}function ExperimentImplementationDetails(_ref4){var _experiment$parameter,_experiment$feature_f;let{experiment}=_ref4,defaultVariant=null!==(_experiment$parameter=experiment?.parameters?.feature_flag_variants?.[1]?.key)&&void 0!==_experiment$parameter?_experiment$parameter:"test",[currentVariant,setCurrentVariant]=(0,react.useState)(defaultVariant),[defaultSelectedOption]=OPTIONS,[selectedOption,setSelectedOption]=(0,react.useState)(defaultSelectedOption);return(0,jsx_runtime.jsxs)("div",{className:"mb-4",children:[(0,jsx_runtime.jsx)("h2",{className:"font-semibold text-lg mb-2",children:"Implementation"}),(0,jsx_runtime.jsx)("div",{className:"border rounded bg-bg-light",children:(0,jsx_runtime.jsxs)("div",{className:"p-6 space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)("span",{className:"mr-2",children:"Variant group"}),(0,jsx_runtime.jsx)(src.Yv,{size:"small",className:"min-w-[5rem]",onSelect:setCurrentVariant,value:currentVariant,options:(experiment?.parameters?.feature_flag_variants||[]).map(variant=>({value:variant.key,label:variant.key}))})]}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(CodeLanguageSelect,{selectOption:selectedValue=>{let option=OPTIONS.find(option=>option.value===selectedValue);option&&setSelectedOption(option)},selectedOptionValue:selectedOption.value})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{className:"mb-1",children:(0,jsx_runtime.jsx)("b",{children:"Implement your experiment in code"})}),(0,jsx_runtime.jsx)("div",{className:"mb-1",children:(0,jsx_runtime.jsx)(selectedOption.Snippet,{variant:currentVariant,flagKey:null!==(_experiment$feature_f=experiment?.feature_flag?.key)&&void 0!==_experiment$feature_f?_experiment$feature_f:""})}),(0,jsx_runtime.jsx)(src.rU,{subtle:!0,to:selectedOption.documentationLink,target:"_blank",children:"See the docs for more implementation information."})]})]})})]})}},"./frontend/src/scenes/experiments/Metrics/Selectors.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{IF:()=>FunnelConversionWindowFilter,dF:()=>commonActionFilterProps,f$:()=>FunnelAttributionSelect,xE:()=>FunnelAggregationSelect});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.9.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_components_HogQLEditor_HogQLEditor__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/components/HogQLEditor/HogQLEditor.tsx"),lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/introductions/groupsAccessLogic.ts"),lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/utils.tsx"),scenes_groups_GroupsIntroduction__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/scenes/groups/GroupsIntroduction.tsx"),scenes_insights_EditorFilters_FunnelsQuerySteps__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/scenes/insights/EditorFilters/FunnelsQuerySteps.tsx"),scenes_insights_views_Funnels_FunnelConversionWindowFilter__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/scenes/insights/views/Funnels/FunnelConversionWindowFilter.tsx"),_models_groupsModel__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/models/groupsModel.ts"),_types__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/types.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let commonActionFilterProps={actionsTaxonomicGroupTypes:[lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.Events,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.Actions,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.DataWarehouse],propertiesTaxonomicGroupTypes:[lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.EventProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.PersonProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.EventFeatureFlags,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.Cohorts,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.Elements,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.SessionProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.HogQLExpression,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.DataWarehouseProperties,lib_components_TaxonomicFilter_types__WEBPACK_IMPORTED_MODULE_4__.t.DataWarehousePersonProperties]};function FunnelAggregationSelect(_ref){let{value,onChange}=_ref,{groupTypes,aggregationLabel}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(_models_groupsModel__WEBPACK_IMPORTED_MODULE_11__.$),{needsUpgradeForGroups,canStartUsingGroups}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(lib_introductions_groupsAccessLogic__WEBPACK_IMPORTED_MODULE_5__.e),UNIQUE_USERS="person_id",baseValues=[UNIQUE_USERS],optionSections=[{title:"Event Aggregation",options:[{value:UNIQUE_USERS,label:"Unique users"}]}];return needsUpgradeForGroups||canStartUsingGroups?optionSections[0].footer=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(scenes_groups_GroupsIntroduction__WEBPACK_IMPORTED_MODULE_8__.b,{needsUpgrade:needsUpgradeForGroups}):Array.from(groupTypes.values()).forEach(groupType=>{baseValues.push(`$group_${groupType.group_type_index}`),optionSections[0].options.push({value:`$group_${groupType.group_type_index}`,label:`Unique ${aggregationLabel(groupType.group_type_index).plural}`})}),baseValues.push("properties.$session_id"),optionSections[0].options.push({value:"properties.$session_id",label:"Unique sessions"}),optionSections[0].options.push({label:"Custom HogQL expression",options:[{value:!value||baseValues.includes(value)?"":value,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{className:"font-mono",children:value}),labelInMenu:function CustomHogQLOptionWrapped(_ref2){let{onSelect}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"w-120",style:{maxWidth:"max(60vw, 20rem)"},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_components_HogQLEditor_HogQLEditor__WEBPACK_IMPORTED_MODULE_3__.E,{onChange:onSelect,value:value,placeholder:"Enter HogQL expression, such as:\n- distinct_id\n- properties.$session_id\n- concat(distinct_id, ' ', properties.$session_id)\n- if(1 < 2, 'one', 'two')"})})}}]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex items-center w-full gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{children:"Aggregating by"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Yv,{className:"flex-1",value:value,onChange:onChange,options:optionSections,dropdownMatchSelectWidth:!1})]})}function FunnelConversionWindowFilter(_ref3){let{funnelWindowInterval,funnelWindowIntervalUnit,onFunnelWindowIntervalChange,onFunnelWindowIntervalUnitChange}=_ref3,options=Object.keys(scenes_insights_views_Funnels_FunnelConversionWindowFilter__WEBPACK_IMPORTED_MODULE_10__.V).map(unit=>({label:(0,lib_utils__WEBPACK_IMPORTED_MODULE_7__.fm)((0,lib_utils__WEBPACK_IMPORTED_MODULE_7__.Zi)(null!=funnelWindowInterval?funnelWindowInterval:7,unit,`${unit}s`,!1)),value:unit})),intervalBounds=scenes_insights_views_Funnels_FunnelConversionWindowFilter__WEBPACK_IMPORTED_MODULE_10__.V[null!=funnelWindowIntervalUnit?funnelWindowIntervalUnit:_types__WEBPACK_IMPORTED_MODULE_12__.ih.Day];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex items-center gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("span",{className:"flex whitespace-nowrap",children:["Conversion window limit",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_6__.u,{title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("b",{children:"Recommended!"})," Limit to participants that converted within a specific time frame. Participants that do not convert in this time frame will be considered as drop-offs."]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconInfo,{className:"w-4 info-indicator"})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex items-center gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.DF,{type:"number",className:"max-w-20",fullWidth:!1,min:intervalBounds[0],max:intervalBounds[1],value:funnelWindowInterval,onChange:onFunnelWindowIntervalChange}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Yv,{dropdownMatchSelectWidth:!1,value:funnelWindowIntervalUnit,onChange:onFunnelWindowIntervalUnitChange,options:options})]})]})}function FunnelAttributionSelect(_ref4){let{value,onChange,stepsLength}=_ref4,funnelOrderType=void 0;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex items-center w-full gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{children:"Attribution type"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_6__.u,{closeDelayMs:200,title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"space-y-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{children:"When breaking down funnels, it's possible that the same properties don't exist on every event. For example, if you want to break down by browser on a funnel that contains both frontend and backend events."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{children:"In this case, you can choose from which step the properties should be selected from by modifying the attribution type. There are four modes to choose from:"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("ul",{className:"list-disc pl-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("li",{children:"First touchpoint: the first property value seen in any of the steps is chosen."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("li",{children:"Last touchpoint: the last property value seen from all steps is chosen."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("li",{children:"All steps: the property value must be seen in all steps to be considered in the funnel."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("li",{children:"Specific step: only the property value seen at the selected step is chosen."})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{children:["Read more in the"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.rU,{to:"https://posthog.com/docs/product-analytics/funnels#attribution-types",children:"documentation."})]})]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconInfo,{className:"text-xl text-muted-alt shrink-0 ml-1"})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Yv,{value:value,placeholder:"Attribution",options:[{value:_types__WEBPACK_IMPORTED_MODULE_12__.q9.FirstTouch,label:"First touchpoint"},{value:_types__WEBPACK_IMPORTED_MODULE_12__.q9.LastTouch,label:"Last touchpoint"},{value:_types__WEBPACK_IMPORTED_MODULE_12__.q9.AllSteps,label:"All steps"},{value:_types__WEBPACK_IMPORTED_MODULE_12__.q9.Step,label:"Any step",hidden:funnelOrderType!==_types__WEBPACK_IMPORTED_MODULE_12__.kO.UNORDERED},{label:"Specific step",options:Array(scenes_insights_EditorFilters_FunnelsQuerySteps__WEBPACK_IMPORTED_MODULE_9__.i).fill(null).map((_,stepIndex)=>({value:`${_types__WEBPACK_IMPORTED_MODULE_12__.q9.Step}/${stepIndex}`,label:`Step ${stepIndex+1}`,hidden:stepIndex>=stepsLength})),hidden:funnelOrderType===_types__WEBPACK_IMPORTED_MODULE_12__.kO.UNORDERED}],onChange:onChange,dropdownMaxContentWidth:!0,"data-attr":"breakdown-attributions"})]})}},"./node_modules/.pnpm/posthog-js@1.206.1/node_modules/posthog-js/react/dist/esm/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{EO:()=>PostHogFeature});var posthog_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/posthog-js@1.206.1/node_modules/posthog-js/dist/module.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),PostHogContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)({client:posthog_js__WEBPACK_IMPORTED_MODULE_0__.ZP}),usePostHog=function(){return(0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(PostHogContext).client},__assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&0>e.indexOf(p)&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)0>e.indexOf(p[i])&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t}function PostHogFeature(_a){var client,_a1,featureFlagPayload,setFeatureFlagPayload,client1,_a2,featureFlagVariantKey,setFeatureFlagVariantKey,flag=_a.flag,match=_a.match,children=_a.children,fallback=_a.fallback,visibilityObserverOptions=_a.visibilityObserverOptions,trackInteraction=_a.trackInteraction,trackView=_a.trackView,props=__rest(_a,["flag","match","children","fallback","visibilityObserverOptions","trackInteraction","trackView"]),payload=(client=usePostHog(),featureFlagPayload=(_a1=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)())[0],setFeatureFlagPayload=_a1[1],(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function(){return client.onFeatureFlags(function(){setFeatureFlagPayload(client.getFeatureFlagPayload(flag))})},[client,flag]),featureFlagPayload),variant=(client1=usePostHog(),featureFlagVariantKey=(_a2=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)())[0],setFeatureFlagVariantKey=_a2[1],(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function(){return client1.onFeatureFlags(function(){setFeatureFlagVariantKey(client1.getFeatureFlag(flag))})},[client1,flag]),featureFlagVariantKey);if(void 0===match||variant===match){var childNode="function"==typeof children?children(payload):children;return react__WEBPACK_IMPORTED_MODULE_1__.createElement(VisibilityAndClickTrackers,__assign({flag:flag,options:visibilityObserverOptions,trackInteraction:null==trackInteraction||trackInteraction,trackView:null==trackView||trackView},props),childNode)}return react__WEBPACK_IMPORTED_MODULE_1__.createElement(react__WEBPACK_IMPORTED_MODULE_1__.Fragment,null,fallback)}function VisibilityAndClickTracker(_a){var flag=_a.flag,children=_a.children,onIntersect=_a.onIntersect,onClick=_a.onClick,trackView=_a.trackView,options=_a.options,props=__rest(_a,["flag","children","onIntersect","onClick","trackView","options"]),ref=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),posthog=usePostHog();return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(function(){if(null!==ref.current&&trackView){var observer=new IntersectionObserver(function(_a){return onIntersect(_a[0])},__assign({threshold:.1},options));return observer.observe(ref.current),function(){return observer.disconnect()}}},[flag,options,posthog,ref,trackView,onIntersect]),react__WEBPACK_IMPORTED_MODULE_1__.createElement("div",__assign({ref:ref},props,{onClick:onClick}),children)}function VisibilityAndClickTrackers(_a){var flag=_a.flag,children=_a.children,trackInteraction=_a.trackInteraction,trackView=_a.trackView,options=_a.options,props=__rest(_a,["flag","children","trackInteraction","trackView","options"]),clickTrackedRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(!1),visibilityTrackedRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(!1),posthog=usePostHog(),cachedOnClick=(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(function(){!clickTrackedRef.current&&trackInteraction&&(!function(flag,posthog){var _a;posthog.capture("$feature_interaction",{feature_flag:flag,$set:((_a={})["$feature_interaction/".concat(flag)]=!0,_a)})}(flag,posthog),clickTrackedRef.current=!0)},[flag,posthog,trackInteraction]),onIntersect=function(entry){!visibilityTrackedRef.current&&entry.isIntersecting&&(!function(flag,posthog){posthog.capture("$feature_view",{feature_flag:flag})}(flag,posthog),visibilityTrackedRef.current=!0)},trackedChildren=react__WEBPACK_IMPORTED_MODULE_1__.Children.map(children,function(child){return react__WEBPACK_IMPORTED_MODULE_1__.createElement(VisibilityAndClickTracker,__assign({flag:flag,onClick:cachedOnClick,onIntersect:onIntersect,trackView:trackView,options:options},props),child)});return react__WEBPACK_IMPORTED_MODULE_1__.createElement(react__WEBPACK_IMPORTED_MODULE_1__.Fragment,null,trackedChildren)}}}]);
//# sourceMappingURL=45013.fbf5d1a3.iframe.bundle.js.map