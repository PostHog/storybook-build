(window.webpackJsonp=window.webpackJsonp||[]).push([[234],{"./frontend/src/lib/api.mock.ts":function(Ae,ae,a){"use strict";a.d(ae,"a",function(){return je});var De=a("./node_modules/core-js/modules/es.array.concat.js"),St=a.n(De),He=a("./node_modules/core-js/modules/es.array.includes.js"),Dt=a.n(He),Je=a("./node_modules/core-js/modules/es.array.join.js"),Tt=a.n(Je),Xe=a("./node_modules/core-js/modules/es.function.name.js"),Ct=a.n(Xe),Ze=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),ct=a.n(Ze),Qe=a("./node_modules/@babel/runtime/regenerator/index.js"),he=a.n(Qe),Le=a("./node_modules/regenerator-runtime/runtime.js"),be=a.n(Le),Re=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),Y=a.n(Re),W=a("./frontend/src/lib/api.ts"),g=a("./node_modules/kea-router/lib/index.js"),h=a.n(g),ie=a("./frontend/src/lib/constants.tsx");function pe(f,o){var E=Object.keys(f);if(Object.getOwnPropertySymbols){var M=Object.getOwnPropertySymbols(f);o&&(M=M.filter(function(F){return Object.getOwnPropertyDescriptor(f,F).enumerable})),E.push.apply(E,M)}return E}function k(f){for(var o=1;o<arguments.length;o++){var E=arguments[o]!=null?arguments[o]:{};o%2?pe(Object(E),!0).forEach(function(M){ct()(f,M,E[M])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(E)):pe(Object(E)).forEach(function(M){Object.defineProperty(f,M,Object.getOwnPropertyDescriptor(E,M))})}return f}function B(f,o){var E;if(typeof Symbol=="undefined"||f[Symbol.iterator]==null){if(Array.isArray(f)||(E=Z(f))||o&&f&&typeof f.length=="number"){E&&(f=E);var M=0,F=function(){};return{s:F,n:function(){return M>=f.length?{done:!0}:{done:!1,value:f[M++]}},e:function(se){throw se},f:F}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var P=!0,H=!1,Pe;return{s:function(){E=f[Symbol.iterator]()},n:function(){var se=E.next();return P=se.done,se},e:function(se){H=!0,Pe=se},f:function(){try{!P&&E.return!=null&&E.return()}finally{if(H)throw Pe}}}}function Z(f,o){if(!!f){if(typeof f=="string")return Oe(f,o);var E=Object.prototype.toString.call(f).slice(8,-1);if(E==="Object"&&f.constructor&&(E=f.constructor.name),E==="Map"||E==="Set")return Array.from(f);if(E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E))return Oe(f,o)}}function Oe(f,o){(o==null||o>f.length)&&(o=f.length);for(var E=0,M=new Array(o);E<o;E++)M[E]=f[E];return M}var le;(function(f){f.Create="create",f.Get="get",f.Update="update",f.Delete="delete"})(le||(le={}));var Te=[le.Create,le.Get,le.Update,le.Delete],w=997,ye="ABCD",je=W.a,Ce={id:w,ingested_event:!0,completed_snippet_onboarding:!0,effective_membership_level:ie.s.Admin},N={id:ye,membership_level:ie.s.Admin},oe=function(o,E){var M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];beforeEach(Y()(he.a.mark(function F(){var P,H,Pe,ue,se,qe;return he.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:P=B(Te);try{for(Pe=function(){var _e=H.value;je[_e].mockImplementation(function(){var dt=Y()(he.a.mark(function nt(Fe,S){var fe,de;return he.a.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return de=k(k({},Object(g.combineUrl)(Fe)),{},{data:S,method:_e}),D.next=3,o==null?void 0:o(de);case 3:if(D.t1=fe=D.sent,D.t0=D.t1!==null,!D.t0){D.next=7;break}D.t0=fe!==void 0;case 7:if(!D.t0){D.next=11;break}D.t2=fe,D.next=12;break;case 11:D.t2=e(de,M);case 12:return D.abrupt("return",D.t2);case 13:case"end":return D.stop()}},nt)}));return function(nt,Fe){return dt.apply(this,arguments)}}())},P.s();!(H=P.n()).done;)Pe()}catch(tt){P.e(tt)}finally{P.f()}for(ue=function(){var _e=qe[se];je[_e]=new Proxy({},{get:function(nt,Fe){var S,fe=[_e,Fe].join(".");return(E==null||(S=E.constructor)===null||S===void 0?void 0:S.name)==="AsyncFunction"?Y()(he.a.mark(function de(){var L,D,U,Q,T=arguments;return he.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:for(D=T.length,U=new Array(D),Q=0;Q<D;Q++)U[Q]=T[Q];return R.next=3,E==null?void 0:E(fe,U);case 3:if(R.t1=L=R.sent,R.t0=R.t1!==null,!R.t0){R.next=7;break}R.t0=L!==void 0;case 7:if(!R.t0){R.next=11;break}R.t2=L,R.next=12;break;case 11:R.t2=ce(fe,U);case 12:return R.abrupt("return",R.t2);case 13:case"end":return R.stop()}},de)})):function(){for(var de,L=arguments.length,D=new Array(L),U=0;U<L;U++)D[U]=arguments[U];return(de=E==null?void 0:E(fe,D))!==null&&de!==void 0?de:ce(fe,D)}}})},se=0,qe=["actions","cohorts","pluginLogs","events","eventDefinitions","propertyDefinitions"];se<qe.length;se++)ue();case 4:case"end":return et.stop()}},F)})))};function e(f){var o=f.pathname,E=f.searchParams,M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],F=k(k({},N),{},{available_features:M});if(o==="_preflight/")return{};if(o==="api/users/@me/")return{organization:F,team:Ce};if(o==="api/projects/@current")return Ce;if(o==="api/organizations/@current")return F;if(["api/projects/".concat(w,"/actions/"),"api/projects/".concat(w,"/annotations/"),"api/projects/".concat(w,"/event_definitions/"),"api/projects/".concat(w,"/dashboards/"),"api/projects/".concat(w,"/dashboards"),"api/projects/".concat(w,"/groups/"),"api/projects/".concat(w,"/insights/"),"api/projects/".concat(w,"/annotations/"),"api/projects/".concat(w,"/property_definitions/")].includes(o))return{results:[],next:null};K("Unmocked fetch to: ".concat(o," with params: ").concat(JSON.stringify(E)))}function ce(f,o){if(["actions.list","cohorts.list","events.list","eventDefinitions.list","propertyDefinitions.list"].includes(f))return{results:[],next:null};K("Unmocked API call on: api.".concat(f,"() with args: ").concat(JSON.stringify(o)))}function K(f){throw console.error(f),new Error(f)}},"./frontend/src/scenes/experiments/Experiment.tsx":function(Ae,ae,a){"use strict";a.r(ae),a.d(ae,"scene",function(){return jn}),a.d(ae,"Experiment_",function(){return zt}),a.d(ae,"CodeLanguageSelect",function(){return Gt});var De=a("./node_modules/core-js/modules/es.symbol.js"),St=a("./node_modules/core-js/modules/es.symbol.description.js"),He=a("./node_modules/core-js/modules/es.array.concat.js"),Dt=a("./node_modules/core-js/modules/es.array.filter.js"),Je=a("./node_modules/core-js/modules/es.array.map.js"),Tt=a("./node_modules/core-js/modules/es.array.reduce.js"),Xe=a("./node_modules/core-js/modules/es.function.name.js"),Ct=a("./node_modules/core-js/modules/es.number.constructor.js"),Ze=a("./node_modules/core-js/modules/es.number.to-fixed.js"),ct=a("./node_modules/core-js/modules/es.object.keys.js"),Qe=a("./node_modules/core-js/modules/es.object.to-string.js"),he=a("./node_modules/core-js/modules/es.regexp.to-string.js"),Le=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),be=a.n(Le),Re=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),Y=a.n(Re),W=a("./node_modules/antd/es/form/index.js"),g=a("./node_modules/antd/es/row/index.js"),h=a("./node_modules/antd/es/col/index.js"),ie=a("./node_modules/antd/es/input/index.js"),pe=a("./node_modules/antd/es/tooltip/index.js"),k=a("./node_modules/antd/es/button/index.js"),B=a("./node_modules/antd/es/select/index.js"),Z=a("./node_modules/antd/es/card/index.js"),Oe=a("./node_modules/antd/es/tag/index.js"),le=a("./node_modules/antd/es/collapse/index.js"),Te=a("./node_modules/antd/es/progress/index.js"),w=a("./node_modules/kea/lib/index.esm.js"),ye=a("./frontend/src/lib/components/PageHeader.tsx"),je=a("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),Ce=a("./frontend/src/lib/components/PropertyFilters/utils.ts"),N=a("./frontend/src/lib/components/TaxonomicFilter/types.ts"),oe=a("./node_modules/react/index.js"),e=a.n(oe),ce=a("./frontend/src/scenes/funnels/funnelLogic.ts"),K=a("./frontend/src/scenes/insights/ActionFilter/ActionFilter.tsx"),f=a("./frontend/src/scenes/insights/insightLogic.tsx"),o=a("./frontend/src/types.ts"),E=a("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),M=a.n(E),F=a("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss"),P=a.n(F),H={};H.insert="head",H.singleton=!1;var Pe=M()(P.a,H),ue=P.a.locals||{},se=a("./node_modules/core-js/modules/es.array.fill.js"),qe=a("./node_modules/core-js/modules/es.array.find.js"),nn=a("./node_modules/core-js/modules/es.array.find-index.js"),et=a("./node_modules/core-js/modules/es.array.iterator.js"),tt=a("./node_modules/core-js/modules/es.array.splice.js"),_e=a("./node_modules/core-js/modules/es.number.epsilon.js"),dt=a("./node_modules/core-js/modules/es.object.values.js"),nt=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Fe=a("./node_modules/@babel/runtime/regenerator/index.js"),S=a.n(Fe),fe=a("./node_modules/regenerator-runtime/runtime.js"),de=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),L=a.n(de),D=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),U=a.n(D),Q=a("./frontend/src/lib/api.ts"),T=a("./frontend/src/lib/dayjs.ts"),q=a("./frontend/src/lib/utils.tsx"),R=["furry","amusing","charming","tame","swift","clever","pleasant","tiny","wild","herbivorous","admirable","adorable","agile","beautiful","bossy","candid","cold","colorful","cuddly","curious","cute","energetic","fast","feisty","fierce","fluffy","friendly","fuzzy","grumpy","hairy","heavy","large","lazy","loud","lovable","loving","enchanted","maternal","sweet","messy","nocturnal","noisy","nosy","picky","playful","quick","sassy","scaly","short","shy","slow","small","smart","soft","strong","tall","tenacious","glorious","warm","cheerful","gracious"],rn=["aardvark","albatross","alligator","alpaca","ant","anteater","antelope","ape","armadillo","donkey","baboon","badger","barracuda","bat","bear","beaver","bee","bison","boar","buffalo","butterfly","camel","capybara","caribou","cassowary","cat","caterpillar","cattle","chamois","cheetah","chicken","chimpanzee","chinchilla","chough","clam","cobra","cockroach","cod","cormorant","coyote","crab","crane","crocodile","crow","curlew","deer","dinosaur","dog","dogfish","dolphin","dotterel","dove","dragonfly","duck","dugong","dunlin","eagle","echidna","eel","eland","elephant","elk","emu","falcon","ferret","finch","firefox","fish","flamingo","fly","fox","frog","gaur","gazelle","gerbil","giraffe","gnat","gnu","goat","goldfinch","goldfish","goose","gorilla","goshawk","grasshopper","grouse","guanaco","gull","hamster","hare","hawk","hedgehog","heron","herring","hippopotamus","hornet","horse","human","hummingbird","hyena","ibex","ibis","jackal","jaguar","jay","jellyfish","kangaroo","kingfisher","koala","kookabura","kouprey","kudu","lapwing","lark","lemur","leopard","lion","llama","lobster","locust","loris","louse","lyrebird","magpie","mallard","manatee","mandrill","mantis","marten","meerkat","mink","mole","mongoose","monkey","moose","mosquito","mouse","mule","narwhal","newt","nightingale","octopus","okapi","opossum","oryx","ostrich","otter","owl","oyster","panther","parrot","partridge","peafowl","pelican","penguin","pheasant","pig","pigeon","pony","porcupine","porpoise","quail","quelea","quetzal","rabbit","raccoon","rail","ram","rat","raven","reindeer","rhinoceros","rook","salamander","salmon","sandpiper","sardine","scorpion","seahorse","seal","shark","sheep","shrew","skunk","snail","snake","sparrow","spider","spoonbill","squid","squirrel","starling","stingray","stinkbug","stork","swallow","swan","tapir","tarsier","termite","tiger","toad","trout","turkey","turtle","viper","vulture","wallaby","walrus","wasp","weasel","whale","wildcat","wolf","wolverine","wombat","woodcock","woodpecker","worm","wren","yak","zebra"];function Pt(){return"".concat(Object(q.j)(Object(q.rb)(R))," ").concat(Object(q.j)(Object(q.rb)(rn)))}var an=a("./node_modules/react-toastify/esm/react-toastify.js"),rt=a("./frontend/src/scenes/insights/utils/cleanFilters.ts"),mt=a("./frontend/src/scenes/teamLogic.tsx"),Ie=a("./frontend/src/scenes/urls.ts"),Ue=a("./node_modules/kea-router/lib/index.js"),sn=a("./frontend/src/scenes/experiments/experimentsLogic.tsx"),we=a("./frontend/src/lib/constants.tsx"),ut=a("./frontend/src/scenes/trends/trendsLogic.ts"),ke=a("./frontend/src/lib/utils/eventUsageLogic.ts"),ln=a("./frontend/src/scenes/userLogic.tsx"),_t=a("./frontend/src/lib/components/Tooltip.tsx"),Be=a("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),on=a("./frontend/src/models/groupsModel.ts");function Ft(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,i)}return r}function y(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ft(Object(r),!0).forEach(function(i){be()(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ft(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var Ke=14,Ye=Object(w.kea)({path:["scenes","experiment","experimentLogic"],connect:{values:[mt.a,["currentTeamId"],ln.a,["hasAvailableFeature"],on.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]],actions:[sn.a,["updateExperiments","addToExperiments"]]},actions:{setExperiment:function(n){return{experiment:n}},createExperiment:function(n,r,i){return{draft:n,runningTime:r,sampleSize:i}},setExperimentInsightId:function(n){return{shortId:n}},createNewExperimentInsight:function(n){return{filters:n}},setFilters:function(n){return{filters:n}},setExperimentId:function(n){return{experimentId:n}},setNewExperimentData:function(n){return{experimentData:n}},updateExperimentGroup:function(n,r){return{variant:n,idx:r}},removeExperimentGroup:function(n){return{idx:n}},setExperimentInsightType:function(n){return{insightType:n}},setEditExperiment:function(n){return{editing:n}},setSecondaryMetrics:function(n){return{secondaryMetrics:n}},resetNewExperiment:!0,launchExperiment:!0,endExperiment:!0,addExperimentGroup:!0,archiveExperiment:!0},reducers:{experimentId:[null,{setExperimentId:function(n,r){var i=r.experimentId;return i}}],newExperimentData:[null,{setNewExperimentData:function(n,r){var i=r.experimentData;if(i.filters){var c=y(y({},n==null?void 0:n.filters),i.filters);return y(y(y({},n),i),{},{filters:c})}if(i.parameters){var m=y(y({},n==null?void 0:n.parameters),i.parameters);return y(y(y({},n),i),{},{parameters:m})}return y(y({},n),i)},updateExperimentGroup:function(n,r){var i,c=r.variant,m=r.idx,d=U()((n==null||(i=n.parameters)===null||i===void 0?void 0:i.feature_flag_variants)||[]);return d[m]=y(y({},d[m]),c),y(y({},n),{},{parameters:y(y({},n==null?void 0:n.parameters),{},{feature_flag_variants:d})})},addExperimentGroup:function(n){var r;if(!(n==null||(r=n.parameters)===null||r===void 0)&&r.feature_flag_variants){var i=At(n.parameters.feature_flag_variants.length+1),c=n.parameters.feature_flag_variants.map(function(m,d){return y(y({},m),{},{rollout_percentage:i[d]})});return y(y({},n),{},{parameters:y(y({},n.parameters),{},{feature_flag_variants:[].concat(U()(c),[{key:"test_group_".concat(n.parameters.feature_flag_variants.length),rollout_percentage:i[i.length-1]}])})})}return n},removeExperimentGroup:function(n,r){var i,c,m=r.idx;if(!n)return n;var d=U()(((i=n.parameters)===null||i===void 0?void 0:i.feature_flag_variants)||[]);d.splice(m,1);var p=At(((n==null||(c=n.parameters)===null||c===void 0?void 0:c.feature_flag_variants)||[]).length-1),s=d.map(function(u,v){return y(y({},u),{},{rollout_percentage:p[v]})});return y(y({},n),{},{parameters:y(y({},n.parameters),{},{feature_flag_variants:s})})},setSecondaryMetrics:function(n,r){var i=r.secondaryMetrics,c=i.map(function(m){return m});return y(y({},n),{},{secondary_metrics:c})},resetNewExperiment:function(){return{parameters:{feature_flag_variants:[{key:"control",rollout_percentage:50},{key:"test",rollout_percentage:50}]}}}}],experimentInsightType:[o.s.FUNNELS,{setExperimentInsightType:function(n,r){var i=r.insightType;return i}}],experimentInsightId:[null,{setExperimentInsightId:function(n,r){var i=r.shortId;return i}}],editingExistingExperiment:[!1,{setEditExperiment:function(n,r){var i=r.editing;return i}}]},listeners:function(n){var r=n.values,i=n.actions;return{createExperiment:function(){var c=L()(S.a.mark(function d(p){var s,u,v,b,l,C,A,J,X,I,ee;return S.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=p.draft,b=p.runningTime,l=p.sampleSize,C=null,A=!!(!((s=r.newExperimentData)===null||s===void 0)&&s.id),x.prev=3,!(!((J=r.newExperimentData)===null||J===void 0)&&J.id)){x.next=14;break}return x.next=7,Q.a.update("api/projects/".concat(r.currentTeamId,"/experiments/").concat(r.experimentId),y(y({},r.newExperimentData),{},{parameters:y(y({},r.newExperimentData.parameters),{},{recommended_running_time:b,recommended_sample_size:l})},!v&&{start_date:Object(T.a)()}));case 7:if(C=x.sent,!(!((X=C)===null||X===void 0)&&X.id)){x.next=12;break}return i.updateExperiments(C),Ue.router.actions.push(Ie.a.experiment(C.id)),x.abrupt("return");case 12:x.next=18;break;case 14:return x.next=16,Q.a.create("api/projects/".concat(r.currentTeamId,"/experiments"),y(y({},r.newExperimentData),{},{parameters:y(y({},(I=r.newExperimentData)===null||I===void 0?void 0:I.parameters),{},{recommended_running_time:b,recommended_sample_size:l})},!v&&{start_date:Object(T.a)()}));case 16:C=x.sent,C&&ke.f.actions.reportExperimentCreated(C);case 18:x.next=24;break;case 20:return x.prev=20,x.t0=x.catch(3),Object(q.z)("Error creating your experiment","Attempting to create this experiment returned an error:",x.t0.status!==0?x.t0.detail:"Check your internet connection and make sure you don't have an extension blocking our requests.",x.t0.code),x.abrupt("return");case 24:!((u=C)===null||u===void 0)&&u.id&&(ee=C.id,Ue.router.actions.push(Ie.a.experiment(ee)),i.addToExperiments(C),an.c.success(e.a.createElement("div",{"data-attr":"success-toast"},e.a.createElement("h1",null,"Experiment ",A?"updated":"created"," successfully!"),!A&&e.a.createElement("p",null,"Click here to view this experiment.")),{onClick:function(){Ue.router.actions.push(Ie.a.experiment(ee))},closeOnClick:!0,onClose:function(){Ue.router.actions.push(Ie.a.experiment(ee))}}));case 25:case"end":return x.stop()}},d,null,[[3,20]])}));function m(d){return c.apply(this,arguments)}return m}(),createNewExperimentInsight:function(){var c=L()(S.a.mark(function d(p){var s,u,v,b;return S.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return s=p.filters,r.experimentInsightType===o.s.FUNNELS?u=Object(rt.a)(y({insight:o.s.FUNNELS,funnel_viz_type:o.o.Steps,display:o.d.FunnelViz,date_from:Object(T.a)().subtract(Ke,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:we.q.horizontal},s)):u=Object(rt.a)(y({insight:o.s.TRENDS,date_from:Object(T.a)().subtract(Ke,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},s)),v={name:Pt(),description:"",tags:[],filters:u,result:null},C.next=5,Q.a.create("api/projects/".concat(r.currentTeamId,"/insights"),v);case 5:b=C.sent,i.setExperimentInsightId(b.short_id),i.setNewExperimentData({filters:y({},v.filters)});case 8:case"end":return C.stop()}},d)}));function m(d){return c.apply(this,arguments)}return m}(),setFilters:function(m){var d=m.filters;if(r.experimentInsightType===o.s.FUNNELS){var p;(p=ce.a.findMounted({dashboardItemId:r.experimentInsightId}))===null||p===void 0||p.actions.setFilters(d)}else{var s;(s=ut.a.findMounted({dashboardItemId:r.experimentInsightId}))===null||s===void 0||s.actions.setFilters(d)}},loadExperimentSuccess:function(){var c=L()(S.a.mark(function d(p){var s;return S.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:s=p.experimentData,s&&ke.f.actions.reportExperimentViewed(s),i.setExperimentInsightType((s==null?void 0:s.filters.insight)||o.s.FUNNELS),s!=null&&s.start_date?(i.resetNewExperiment(),i.loadExperimentResults(),i.loadSecondaryMetricResults()):(i.setNewExperimentData(y({},s)),i.createNewExperimentInsight(s==null?void 0:s.filters));case 4:case"end":return v.stop()}},d)}));function m(d){return c.apply(this,arguments)}return m}(),launchExperiment:function(){var c=L()(S.a.mark(function d(){var p;return S.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:p=Object(T.a)(),i.updateExperiment({start_date:p.format("YYYY-MM-DDTHH:mm")}),r.experimentData&&ke.f.actions.reportExperimentLaunched(r.experimentData,p);case 3:case"end":return u.stop()}},d)}));function m(){return c.apply(this,arguments)}return m}(),endExperiment:function(){var c=L()(S.a.mark(function d(){var p,s,u;return S.a.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:s=Object(T.a)(),i.updateExperiment({end_date:s.format("YYYY-MM-DDTHH:mm")}),u=s.diff((p=r.experimentData)===null||p===void 0?void 0:p.start_date,"second"),r.experimentData&&ke.f.actions.reportExperimentCompleted(r.experimentData,s,u,r.areResultsSignificant);case 4:case"end":return b.stop()}},d)}));function m(){return c.apply(this,arguments)}return m}(),archiveExperiment:function(){var c=L()(S.a.mark(function d(){return S.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i.updateExperiment({archived:!0}),r.experimentData&&ke.f.actions.reportExperimentArchived(r.experimentData);case 2:case"end":return s.stop()}},d)}));function m(){return c.apply(this,arguments)}return m}(),setExperimentInsightType:function(){if(r.experimentId==="new"||r.editingExistingExperiment)i.createNewExperimentInsight();else{var m;i.createNewExperimentInsight((m=r.experimentData)===null||m===void 0?void 0:m.filters)}}}},loaders:function(n){var r=n.values,i=n.actions;return{experimentData:[null,{loadExperiment:function(){var c=L()(S.a.mark(function d(){var p;return S.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(r.experimentId&&r.experimentId!=="new")){u.next=5;break}return u.next=3,Q.a.get("api/projects/".concat(r.currentTeamId,"/experiments/").concat(r.experimentId));case 3:return p=u.sent,u.abrupt("return",p);case 5:return u.abrupt("return",null);case 6:case"end":return u.stop()}},d)}));function m(){return c.apply(this,arguments)}return m}(),updateExperiment:function(){var c=L()(S.a.mark(function d(p){var s;return S.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,Q.a.update("api/projects/".concat(r.currentTeamId,"/experiments/").concat(r.experimentId),p);case 2:return s=v.sent,i.setExperimentId(s.id||"new"),v.abrupt("return",s);case 5:case"end":return v.stop()}},d)}));function m(d){return c.apply(this,arguments)}return m}()}],experimentResults:[null,{loadExperimentResults:function(){var c=L()(S.a.mark(function d(){var p;return S.a.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,Q.a.get("api/projects/".concat(r.currentTeamId,"/experiments/").concat(r.experimentId,"/results"));case 3:return p=u.sent,u.abrupt("return",y(y({},p),{},{itemID:Math.random().toString(36).substring(2,15)}));case 7:if(u.prev=7,u.t0=u.catch(0),u.t0.code!=="no_data"){u.next=11;break}return u.abrupt("return",null);case 11:return Object(q.z)("Error loading experiment results","Attempting to load results returned an error:",u.t0.status!==0?u.t0.detail:"Check your internet connection and make sure you don't have an extension blocking our requests.",u.t0.code),u.abrupt("return",null);case 13:case"end":return u.stop()}},d,null,[[0,7]])}));function m(){return c.apply(this,arguments)}return m}(),emptyExperimentResults:function(){return null}}],secondaryMetricResults:[null,{loadSecondaryMetricResults:function(){var c=L()(S.a.mark(function d(){var p,s,u,v;return S.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:p=[],s=0;case 2:if(!(s<(((u=r.experimentData)===null||u===void 0?void 0:u.secondary_metrics.length)||0))){l.next=10;break}return l.next=5,Q.a.get("api/projects/".concat(r.currentTeamId,"/experiments/").concat(r.experimentId,"/secondary_results?id=").concat(s));case 5:v=l.sent,p.push(v.result);case 7:s++,l.next=2;break;case 10:return l.abrupt("return",p);case 11:case"end":return l.stop()}},d)}));function m(){return c.apply(this,arguments)}return m}()}]}},selectors:{breadcrumbs:[function(t){return[t.experimentData,t.experimentId]},function(t,n){return[{name:"Experiments",path:Ie.a.experiments()},{name:(t==null?void 0:t.name)||"New Experiment",path:Ie.a.experiment(n||"new")}]}],variants:[function(t){return[t.newExperimentData,t.experimentData]},function(t,n){var r,i;if(n!=null&&n.start_date){var c;return(n==null||(c=n.parameters)===null||c===void 0?void 0:c.feature_flag_variants)||[]}return(t==null||(r=t.parameters)===null||r===void 0?void 0:r.feature_flag_variants)||(n==null||(i=n.parameters)===null||i===void 0?void 0:i.feature_flag_variants)||[]}],taxonomicGroupTypesForSelection:[function(t){return[t.newExperimentData,t.groupsTaxonomicTypes]},function(t,n){var r;return(t==null||(r=t.filters)===null||r===void 0?void 0:r.aggregation_group_type_index)!=null&&n.length>0?[n[t.filters.aggregation_group_type_index]]:[N.a.PersonProperties,N.a.Cohorts]}],parsedSecondaryMetrics:[function(t){return[t.newExperimentData,t.experimentData]},function(t,n){var r=(t==null?void 0:t.secondary_metrics)||(n==null?void 0:n.secondary_metrics)||[];return r}],minimumDetectableChange:[function(t){return[t.newExperimentData]},function(t){var n;return(t==null||(n=t.parameters)===null||n===void 0?void 0:n.minimum_detectable_effect)||5}],minimumSampleSizePerVariant:[function(t){return[t.minimumDetectableChange]},function(t){return function(n){return Math.ceil(1600*n*(1-n/100)/(t*t))}}],areResultsSignificant:[function(t){return[t.experimentResults]},function(t){return(t==null?void 0:t.significant)||!1}],significanceBannerDetails:[function(t){return[t.experimentResults]},function(t){if((t==null?void 0:t.significance_code)===o.E.HighLoss){var n;return e.a.createElement(e.a.Fragment,null,"This is because the expected loss in conversion is greater than 1%",e.a.createElement(_t.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(n=((t==null?void 0:t.expected_loss)||0)*100)===null||n===void 0?void 0:n.toFixed(2),"%")},e.a.createElement(Be.a,{style:{padding:"4px 2px"}})),".")}if((t==null?void 0:t.significance_code)===o.E.HighPValue){var r;return e.a.createElement(e.a.Fragment,null,"This is because the p value is greater than 0.05",e.a.createElement(_t.a,{placement:"right",title:e.a.createElement(e.a.Fragment,null,"Current value is ",(t==null||(r=t.p_value)===null||r===void 0?void 0:r.toFixed(3))||1,".")},e.a.createElement(Be.a,{style:{padding:"4px 2px"}})),".")}return(t==null?void 0:t.significance_code)===o.E.LowWinProbability?"This is because the win probability of all test variants combined is less than 90%.":(t==null?void 0:t.significance_code)===o.E.NotEnoughExposure?"This is because we need at least 100 people per variant to declare significance.":""}],recommendedExposureForCountData:[function(t){return[t.minimumDetectableChange]},function(t){return function(n){var r=n*t/100,i=n,c=r+n;return parseFloat((4/Math.pow(Math.sqrt(i/Ke)-Math.sqrt(c/Ke),2)).toFixed(1))}}],expectedRunningTime:[function(){return[]},function(){return function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ke;return parseFloat((n/(t/r)).toFixed(1))}}],conversionRateForVariant:[function(t){return[t.experimentResults]},function(t){return function(n){var r="Can't find variant";if(!t)return r;var i=(t==null?void 0:t.insight).find(function(c){var m,d;return((m=c[0])===null||m===void 0||(d=m.breakdown_value)===null||d===void 0?void 0:d[0])===n});return i?(i[i.length-1].count/i[0].count*100).toFixed(1):r}}],getIndexForVariant:[function(t){return[t.experimentResults]},function(t){return function(n,r){if(!t)return 0;var i=-1;return r===o.s.FUNNELS?i=U()(t==null?void 0:t.insight).sort(function(c,m){var d,p;return((d=m[0])===null||d===void 0?void 0:d.count)-((p=c[0])===null||p===void 0?void 0:p.count)}).findIndex(function(c){var m,d;return((m=c[0])===null||m===void 0||(d=m.breakdown_value)===null||d===void 0?void 0:d[0])===n}):i=(t==null?void 0:t.insight).findIndex(function(c){return c.breakdown_value===n}),i===-1?0:i}}],countDataForVariant:[function(t){return[t.experimentResults]},function(t){return function(n){var r="Can't find variant";if(!t)return r;var i=(t==null?void 0:t.insight).find(function(c){return c.breakdown_value===n});return i?i.count.toString():r}}],highestProbabilityVariant:[function(t){return[t.experimentResults]},function(t){if(t){var n=Math.max.apply(Math,U()(Object.values(t.probability)));return Object.keys(t.probability).find(function(r){return Math.abs(t.probability[r]-n)<Number.EPSILON})}}],areTrendResultsConfusing:[function(t){return[t.experimentResults,t.highestProbabilityVariant]},function(t,n){if(!t)return!1;var r=(t==null?void 0:t.insight).reduce(function(i,c){return c.count>i.count?c:i},{count:0,breakdown_value:""});return r.count?r.breakdown_value!==n:!1}]},urlToAction:function(n){var r=n.actions,i=n.values;return{"/experiments/:id":function(m){var d=m.id;if(r.emptyExperimentResults(),!i.hasAvailableFeature(o.c.EXPERIMENTATION)){Ue.router.actions.push("/experiments");return}if(d){var p=d==="new"?"new":parseInt(d);p==="new"&&(r.createNewExperimentInsight(),r.resetNewExperiment(),r.setSecondaryMetrics([])),r.setEditExperiment(!1),p!==i.experimentId&&r.setExperimentId(p),p!=="new"&&r.loadExperiment()}}}}});function At(t){var n=Math.round(100/t),r=n*t,i=r-100,c=new Array(t).fill(n);return c[t-1]=n-i,c}var pt=a("./frontend/src/scenes/insights/InsightContainer.tsx"),Ne=a("./frontend/src/lib/components/icons.tsx"),Lt=a("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),cn=a("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),at=a("./node_modules/@ant-design/icons/es/icons/CaretDownOutlined.js"),dn=a("./node_modules/@ant-design/icons/es/icons/SaveOutlined.js"),Rt=a("./node_modules/@ant-design/icons/es/icons/CloseOutlined.js"),mn=a("./frontend/src/lib/components/CopyToClipboard.tsx"),ft=a("./frontend/src/lib/components/Spinner/Spinner.tsx"),Ut=a("./frontend/src/scenes/funnels/funnelUtils.ts"),un=a("./node_modules/antd/es/modal/index.js"),kt=a("./frontend/src/lib/api.mock.ts");function Bt(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,i)}return r}function Me(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Bt(Object(r),!0).forEach(function(i){be()(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Bt(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var Kt=14,vt={name:"",filters:{insight:o.s.TRENDS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}]}},pn={name:"",filters:{insight:o.s.FUNNELS,events:[{id:"$pageview",name:"$pageview",type:"events",order:0}],layout:we.q.horizontal}},fn=Object(w.kea)({props:{},path:["scenes","experiment","secondaryMetricsLogic"],connect:{values:[mt.a,["currentTeamId"]]},actions:{setSecondaryMetrics:function(n){return{secondaryMetrics:n}},createNewMetric:!0,addNewMetric:function(n){return{metric:n}},updateMetricFilters:function(n){return{filters:n}},setFilters:function(n){return{filters:n}},setPreviewInsightId:function(n){return{shortId:n}},createPreviewInsight:function(n){return{filters:n}},showModal:!0,hideModal:!1,changeInsightType:function(n){return{type:n}},setCurrentMetricName:function(n){return{name:n}},deleteMetric:function(n){return{metricId:n}}},loaders:function(n){var r=n.values;return{experiments:[[],{loadExperiments:function(){var i=L()(S.a.mark(function m(){var d;return S.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,kt.a.get("api/projects/".concat(r.currentTeamId,"/experiments"));case 2:return d=s.sent,s.abrupt("return",d.results);case 4:case"end":return s.stop()}},m)}));function c(){return i.apply(this,arguments)}return c}()}]}},reducers:function(n){var r=n.props;return{previewInsightId:[null,{setPreviewInsightId:function(c,m){var d=m.shortId;return d}}],metrics:[r.initialMetrics,{addNewMetric:function(c,m){var d=m.metric;return[].concat(U()(c),[Me({},d)])},deleteMetric:function(c,m){var d=m.metricId;return c.filter(function(p,s){return s!==d})}}],modalVisible:[!1,{showModal:function(){return!0},hideModal:function(){return!1}}],currentMetricName:["",{setCurrentMetricName:function(c,m){var d=m.name;return d}}],currentMetric:[vt,{changeInsightType:function(c,m){var d=m.type;return d===o.s.TRENDS?vt:c.filters.insight===o.s.TRENDS?pn:vt},updateMetricFilters:function(c,m){var d=m.filters;return Me(Me({},c),{},{filters:d})}}]}},listeners:function(n){var r=n.actions,i=n.values,c=n.props;return{createPreviewInsight:function(){var m=L()(S.a.mark(function p(s){var u,v,b,l;return S.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=s.filters,(u==null?void 0:u.insight)===o.s.FUNNELS?v=Object(rt.a)(Me({insight:o.s.FUNNELS,funnel_viz_type:o.o.Steps,display:o.d.FunnelViz,date_from:Object(T.a)().subtract(Kt,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm"),layout:we.q.horizontal},u)):v=Object(rt.a)(Me({insight:o.s.TRENDS,date_from:Object(T.a)().subtract(Kt,"day").format("YYYY-MM-DDTHH:mm"),date_to:Object(T.a)().endOf("d").format("YYYY-MM-DDTHH:mm")},u)),b={name:Pt(),description:"",tags:[],filters:v,result:null},A.next=5,kt.a.create("api/projects/".concat(mt.a.values.currentTeamId,"/insights"),b);case 5:l=A.sent,r.setPreviewInsightId(l.short_id);case 7:case"end":return A.stop()}},p)}));function d(p){return m.apply(this,arguments)}return d}(),setFilters:function(d){var p=d.filters;if(p.insight===o.s.FUNNELS){var s;(s=ce.a.findMounted({dashboardItemId:i.previewInsightId}))===null||s===void 0||s.actions.setFilters(p)}else{var u;(u=ut.a.findMounted({dashboardItemId:i.previewInsightId}))===null||u===void 0||u.actions.setFilters(p)}},createNewMetric:function(){r.addNewMetric(Me(Me({},i.currentMetric),{},{name:i.currentMetricName})),c.onMetricsChange(i.metrics),r.changeInsightType(o.s.TRENDS),r.setCurrentMetricName("")},deleteMetric:function(){c.onMetricsChange(i.metrics)},changeInsightType:function(){return r.createPreviewInsight(i.currentMetric.filters)}}},events:function(n){var r=n.actions;return{afterMount:function(){r.createPreviewInsight()}}}});function Yt(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,i)}return r}function xe(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Yt(Object(r),!0).forEach(function(i){be()(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Yt(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}function it(t){var n=t.onMetricsChange,r=t.initialMetrics,i=fn({onMetricsChange:n,initialMetrics:r}),c=Object(w.useValues)(i),m=c.previewInsightId,d=c.metrics,p=c.modalVisible,s=c.currentMetric,u=Object(w.useActions)(i),v=u.createNewMetric,b=u.updateMetricFilters,l=u.setFilters,C=u.showModal,A=u.hideModal,J=u.changeInsightType,X=u.setCurrentMetricName,I=u.deleteMetric,ee=Object(w.useValues)(Object(f.b)({dashboardItemId:m,syncWithUrl:!1})),ve=ee.insightProps,x=Object(w.useValues)(Object(ce.a)(ve)),ge=x.isStepsEmpty,Se=x.filterSteps;return e.a.createElement(e.a.Fragment,null,e.a.createElement(un.a,{title:"Add secondary metric",visible:p,destroyOnClose:!0,onCancel:A,onOk:function(){v(),A()},okText:"Save",style:{minWidth:600}},e.a.createElement(W.a,{layout:"vertical",initialValues:{name:"",type:o.s.TRENDS},onValuesChange:function(V){V.name&&X(V.name)}},e.a.createElement(W.a.Item,{name:"name",label:"Name"},e.a.createElement(ie.a,null)),e.a.createElement(W.a.Item,{name:"type",label:"Type"},e.a.createElement(B.a,{style:{display:"flex"},value:s.filters.insight,onChange:function(){J()},suffixIcon:e.a.createElement(at.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(B.a.Option,{value:o.s.TRENDS},e.a.createElement(h.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(B.a.Option,{value:o.s.FUNNELS},e.a.createElement(h.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel")))))),e.a.createElement(W.a.Item,{name:"query",label:"Query"},e.a.createElement(Z.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},s.filters.insight===o.s.FUNNELS&&e.a.createElement(K.a,{filters:s.filters,setFilters:function(V){var G=xe(xe({},s.filters),{},{insight:o.s.FUNNELS},V);b(G),l(G)},typeKey:"funnel-preview-metric",hideMathSelector:!0,hideDeleteBtn:Se.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!ge,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[N.a.EventProperties,N.a.PersonProperties,N.a.Cohorts,N.a.Elements],rowClassName:"action-filters-bordered"}),s.filters.insight===o.s.TRENDS&&e.a.createElement(K.a,{entitiesLimit:1,horizontalUI:!0,filters:s.filters,setFilters:function(V){var G=xe(xe({},s.filters),{},{insight:o.s.TRENDS},V);b(G),l(G)},typeKey:"trend-preview-metric",buttonCopy:"Add graph series",showSeriesIndicator:!0,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[N.a.EventProperties,N.a.PersonProperties,N.a.Cohorts,N.a.Elements]}))),e.a.createElement(W.a.Item,{name:"metric-preview",label:"Metric preview"},e.a.createElement(w.BindLogic,{logic:f.b,props:ve},e.a.createElement(pt.a,{disableHeader:!0,disableTable:!0}))))),e.a.createElement(g.a,null,e.a.createElement(h.a,null,d.map(function(_,V){return e.a.createElement(g.a,{key:V,className:"mt"},e.a.createElement(g.a,{align:"middle",className:"full-width border-all",style:{padding:8}},e.a.createElement("div",{style:{fontWeight:500}},"Name")," ",e.a.createElement("div",{className:"metric-name"},_.name?_.name:"".concat(_.filters.insight," metric")),e.a.createElement(Lt.a,{className:"text-danger",style:{padding:8},onClick:function(){return I(V)}})),e.a.createElement(Z.a,{className:"full-width",style:{borderTop:"none"},bodyStyle:{padding:0}},_.filters.insight===o.s.FUNNELS&&e.a.createElement(K.a,{filters:_.filters,setFilters:function(me){var Ee=xe(xe({},_.filters),{},{insight:o.s.FUNNELS},me);b(Ee),l(Ee)},typeKey:"funnel-preview-".concat(V),hideMathSelector:!0,hideDeleteBtn:Se.length===1,buttonCopy:"Add funnel step",showSeriesIndicator:!ge,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[N.a.EventProperties,N.a.PersonProperties,N.a.Cohorts,N.a.Elements],rowClassName:"action-filters-bordered",readOnly:!0}),_.filters.insight===o.s.TRENDS&&e.a.createElement(K.a,{horizontalUI:!0,filters:_.filters,setFilters:function(me){var Ee=xe(xe({},_.filters),{},{insight:o.s.TRENDS},me);b(Ee),l(Ee)},typeKey:"trend-preview-".concat(V),buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[N.a.EventProperties,N.a.PersonProperties,N.a.Cohorts,N.a.Elements],readOnly:!0})))}),d&&!(d.length>2)&&e.a.createElement(h.a,null,e.a.createElement("div",{className:"mb-05 mt"},e.a.createElement(k.a,{style:{color:"var(--primary)",minWidth:240},onClick:C},"Add metric"))))))}try{it.displayName="SecondaryMetrics",it.__docgenInfo={description:"",displayName:"SecondaryMetrics",props:{onMetricsChange:{defaultValue:null,description:"",name:"onMetricsChange",required:!0,type:{name:"(metrics: SecondaryExperimentMetric[]) => void"}},initialMetrics:{defaultValue:null,description:"",name:"initialMetrics",required:!0,type:{name:"SecondaryExperimentMetric[]"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"]={docgenInfo:it.__docgenInfo,name:"SecondaryMetrics",path:"frontend/src/scenes/experiments/SecondaryMetrics.tsx#SecondaryMetrics"})}catch(t){}var Wt=a("./frontend/src/lib/colors.ts"),vn=a("./frontend/src/lib/components/EntityFilterInfo.tsx"),gn=a("./frontend/src/lib/components/EditableField/EditableField.tsx"),En=a("./frontend/src/lib/components/Link.tsx"),hn=a("./frontend/src/lib/logic/featureFlagLogic.ts"),yn=a("./node_modules/antd/es/slider/index.js"),xn=a("./node_modules/antd/es/input-number/index.js"),bn=a("./frontend/src/lib/components/InsightLabel/index.tsx"),Vt=a("./frontend/src/lib/components/PropertyFilters/components/PropertyFilterButton.tsx");function On(){var t=Object(oe.useState)(!1),n=Y()(t,2),r=n[0],i=n[1],c=Object(oe.useState)(!1),m=Y()(c,2),d=m[0],p=m[1];return e.a.createElement(Z.a,{className:"experiment-workflow",title:e.a.createElement("span",{className:"card-secondary"},"Experiment workflow")},e.a.createElement(g.a,null,e.a.createElement(h.a,{className:"exp-workflow-step step-completed full-width"},e.a.createElement(g.a,{align:"middle"},e.a.createElement(Ne.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}),e.a.createElement("b",{className:"ml-05"},"Create experiment")),e.a.createElement("div",{className:"ml-2"},"Set variants, select participants, and add secondary metrics"))),e.a.createElement(g.a,null,e.a.createElement(h.a,{className:"full-width exp-workflow-step ".concat(r?"step-completed":""),onClick:function(){return i(!r)}},e.a.createElement(g.a,{align:"middle"},r?e.a.createElement(Ne.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(Ne.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-05"},"Validate experiment")),e.a.createElement("div",{className:"ml-2"},"Once you've written your code, it's a good idea to test that each variant behaves as you'd expect."))),e.a.createElement(g.a,null,e.a.createElement(h.a,{className:"full-width exp-workflow-step ".concat(d?"step-completed":""),onClick:function(){return p(!d)}},e.a.createElement(g.a,{align:"middle"},d?e.a.createElement(Ne.IconCheckmark,{style:{color:"var(--primary)",fontSize:24}}):e.a.createElement(Ne.IconRadioButtonUnchecked,null),e.a.createElement("b",{className:"ml-05"},"Launch experiment")),e.a.createElement("div",{className:"ml-2"},"Run your experiment, monitor results, and decide when to terminate your experiment."))))}function We(t){var n,r,i,c,m,d,p,s=t.experiment,u=t.trendCount,v=t.funnelConversionRate,b=t.trendExposure,l=t.funnelSampleSize,C=t.funnelEntrants,A=Object(w.useValues)(Ye),J=A.experimentInsightType,X=A.experimentId,I=A.editingExistingExperiment,ee=A.minimumDetectableChange,ve=A.expectedRunningTime,x=A.aggregationLabel,ge=Object(w.useActions)(Ye),Se=ge.setNewExperimentData,_=J===o.s.FUNNELS&&100-v<50?100-v:50,V=Object(T.a)().diff(Object(T.a)(s==null?void 0:s.start_date),"hour"),G=0;s!=null&&s.start_date?G=ve(C||1,l||0,V):G=ve(C||1,l||0);var me=Object(T.a)(s==null?void 0:s.start_date).add(G,"hour"),Ee=!(s!=null&&s.end_date)&&V>=24&&C&&l;return e.a.createElement(g.a,null,e.a.createElement(h.a,{span:!(s!=null&&s.start_date)&&X!=="new"&&!I?12:24},X==="new"&&e.a.createElement(g.a,{className:"experiment-preview-row"},e.a.createElement("div",null,e.a.createElement("div",null,e.a.createElement("b",null,"Experiment preview")),e.a.createElement("div",{className:"text-muted"},"Here are the baseline metrics for your experiment. Adjust your minimum detectible threshold to adjust for the smallest conversion value you\u2019ll accept, and the experiment duration."," "))),(X==="new"||I)&&e.a.createElement(g.a,{className:"mb"},e.a.createElement(h.a,{span:24},e.a.createElement("div",null,e.a.createElement("b",null,"Minimum acceptable improvement"),e.a.createElement(pe.a,{title:"Minimum acceptable improvement is a calculation that estimates the smallest significant improvement you are willing to accept."},e.a.createElement(Be.a,{style:{marginLeft:4}}))),e.a.createElement(g.a,{className:"mde-slider"},e.a.createElement(h.a,{span:8},e.a.createElement(yn.a,{defaultValue:5,value:ee,min:1,max:_,trackStyle:{background:"var(--primary)"},handleStyle:{background:"var(--primary)"},onChange:function(z){Se({parameters:{minimum_detectable_effect:z}})},tipFormatter:function(z){return"".concat(z,"%")}})),e.a.createElement(xn.a,{min:1,max:_,defaultValue:5,formatter:function(z){return"".concat(z,"%")},style:{margin:"0 16px"},value:ee,onChange:function(z){Se({parameters:{minimum_detectable_effect:z}})}})))),e.a.createElement(g.a,{className:"experiment-preview-row ".concat(s!=null&&s.start_date?"mr":"")},J===o.s.TRENDS?e.a.createElement(e.a.Fragment,null,!(s!=null&&s.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(h.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Baseline Count"),e.a.createElement("div",{className:"l4"},u)),e.a.createElement(h.a,{span:6},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Count"),e.a.createElement("div",{className:"l4"},u+Math.ceil(u*(ee/100))))),e.a.createElement(h.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",b)," days"))):e.a.createElement(e.a.Fragment,null,!(s!=null&&s.start_date)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(h.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Baseline Conversion Rate"),e.a.createElement("div",{className:"l4"},v.toFixed(1),"%")),e.a.createElement(h.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Minimum Acceptable Conversion Rate"),e.a.createElement("div",{className:"l4"},(v+ee).toFixed(1),"%"))),e.a.createElement(h.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended Sample Size"),e.a.createElement("div",{className:"pb"},e.a.createElement("span",{className:"l4"},"~",l)," persons")),!(s!=null&&s.start_date)&&e.a.createElement(h.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Recommended running time"),e.a.createElement("div",null,e.a.createElement("span",{className:"l4"},"~",G)," days"))),e.a.createElement(g.a,{className:"full-width mt"},e.a.createElement(h.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Experiment variants"),e.a.createElement("ul",{className:"variants-list"},s==null||(n=s.parameters)===null||n===void 0||(r=n.feature_flag_variants)===null||r===void 0?void 0:r.map(function($,z){return e.a.createElement("li",{key:z},$.key)}))),e.a.createElement(h.a,{span:12},e.a.createElement("div",{className:"card-secondary"},"Participants"),e.a.createElement("div",null,!(s==null||(i=s.filters)===null||i===void 0||(c=i.properties)===null||c===void 0)&&c.length?e.a.createElement("div",null,s==null?void 0:s.filters.properties.map(function($){return e.a.createElement(Vt.c,{key:$.key,item:$})})):e.a.createElement(e.a.Fragment,null,"100% of"," ",(s==null||(m=s.filters)===null||m===void 0?void 0:m.aggregation_group_type_index)!=null?Object(q.j)(x(s.filters.aggregation_group_type_index).plural):"users")))),e.a.createElement(g.a,null,X!=="new"&&!I&&e.a.createElement(e.a.Fragment,null,e.a.createElement(h.a,{className:"mr"},e.a.createElement("div",{className:"card-secondary mt"},"Start date"),s!=null&&s.start_date?e.a.createElement("span",null,Object(T.a)(s==null?void 0:s.start_date).format("D MMM YYYY")):e.a.createElement("span",{className:"description"},"Not started yet")),J===o.s.FUNNELS&&Ee?e.a.createElement(h.a,{className:"mr"},e.a.createElement("div",{className:"card-secondary mt"},"Expected end date"),e.a.createElement("span",null,me.isAfter(Object(T.a)())?me.format("D MMM YYYY"):Object(T.a)().format("D MMM YYYY"))):null),(s==null?void 0:s.end_date)&&e.a.createElement(h.a,{className:"ml"},e.a.createElement("div",{className:"card-secondary mt"},"Completed date"),e.a.createElement("span",null,Object(T.a)(s==null?void 0:s.end_date).format("D MMM YYYY"))))),X!=="new"&&!I&&e.a.createElement(g.a,{className:"experiment-preview-row"},e.a.createElement(h.a,null,e.a.createElement("div",{className:"card-secondary mb-05"},J===o.s.FUNNELS?"Conversion goal steps":"Trend goal"),[].concat(U()((s==null||(d=s.filters)===null||d===void 0?void 0:d.events)||[]),U()((s==null||(p=s.filters)===null||p===void 0?void 0:p.actions)||[])).sort(function($,z){return($.order||0)-(z.order||0)}).map(function($,z){var $e;return e.a.createElement(h.a,{key:z,className:"mb-05"},e.a.createElement(g.a,{style:{marginBottom:4}},e.a.createElement("div",{className:"preview-conversion-goal-num"},J===o.s.FUNNELS?($.order||0)+1:z+1),e.a.createElement("b",null,e.a.createElement(bn.b,{action:$,showCountedByTag:J===o.s.TRENDS,hideIcon:!0}))),($e=$.properties)===null||$e===void 0?void 0:$e.map(function(lt){return e.a.createElement(Vt.c,{key:lt.key,item:lt})}))})))),X!=="new"&&!I&&!(s!=null&&s.start_date)&&e.a.createElement(h.a,{span:12,className:"pl"},e.a.createElement(On,null)))}try{We.displayName="ExperimentPreview",We.__docgenInfo={description:"",displayName:"ExperimentPreview",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}},trendCount:{defaultValue:null,description:"",name:"trendCount",required:!0,type:{name:"number"}},trendExposure:{defaultValue:null,description:"",name:"trendExposure",required:!1,type:{name:"number"}},funnelSampleSize:{defaultValue:null,description:"",name:"funnelSampleSize",required:!1,type:{name:"number"}},funnelConversionRate:{defaultValue:null,description:"",name:"funnelConversionRate",required:!0,type:{name:"number"}},funnelEntrants:{defaultValue:null,description:"",name:"funnelEntrants",required:!1,type:{name:"number"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"]={docgenInfo:We.__docgenInfo,name:"ExperimentPreview",path:"frontend/src/scenes/experiments/ExperimentPreview.tsx#ExperimentPreview"})}catch(t){}var st=a("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx");function Ve(t){var n,r,i,c=t.experiment,m=Object(oe.useState)("control"),d=Y()(m,2),p=d[0],s=d[1];return e.a.createElement(Z.a,{title:e.a.createElement("span",{className:"card-secondary"},"Feature flag usage and implementation"),className:"experiment-implementation-details"},e.a.createElement(g.a,{justify:"space-between",className:"mb-05"},e.a.createElement("div",null,e.a.createElement("span",{className:"mr-05"},"Variant group"),e.a.createElement(B.a,{onChange:s,defaultValue:"control",suffixIcon:e.a.createElement(at.a,null)},c==null||(n=c.parameters)===null||n===void 0||(r=n.feature_flag_variants)===null||r===void 0?void 0:r.map(function(u,v){return e.a.createElement(B.a.Option,{key:v,value:u.key},u.key)}))),e.a.createElement("div",null,e.a.createElement(Gt,null))),e.a.createElement("b",null,"Implement your experiment in code"),e.a.createElement(st.a,{language:st.b.JavaScript,wrap:!0},"if (posthog.getFeatureFlag('".concat((i=c==null?void 0:c.feature_flag_key)!==null&&i!==void 0?i:"","') === '").concat(p,`') {
    // where '`).concat(p,`' is the variant, run your code here
}`)),e.a.createElement("b",null,"Test that it works"),e.a.createElement(st.a,{language:st.b.JavaScript},"posthog.feature_flags.override({'".concat(c==null?void 0:c.feature_flag_key,"': '").concat(p,"'})")),e.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://posthog.com/docs/user-guides/feature-flags"},e.a.createElement(g.a,{align:"middle"},"Experiment implementation guide",e.a.createElement(Ne.IconOpenInNew,{className:"ml-05"}))))}try{Ve.displayName="ExperimentImplementationDetails",Ve.__docgenInfo={description:"",displayName:"ExperimentImplementationDetails",props:{experiment:{defaultValue:null,description:"",name:"experiment",required:!0,type:{name:"Partial<Experiment> | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"]={docgenInfo:Ve.__docgenInfo,name:"ExperimentImplementationDetails",path:"frontend/src/scenes/experiments/ExperimentImplementationDetails.tsx#ExperimentImplementationDetails"})}catch(t){}function $t(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,i)}return r}function gt(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?$t(Object(r),!0).forEach(function(i){be()(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$t(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}var jn={component:zt,logic:Ye};function zt(){var t,n,r,i,c,m,d,p,s,u,v=Object(w.useValues)(Ye),b=v.newExperimentData,l=v.experimentData,C=v.experimentInsightId,A=v.minimumSampleSizePerVariant,J=v.recommendedExposureForCountData,X=v.variants,I=v.experimentResults,ee=v.countDataForVariant,ve=v.editingExistingExperiment,x=v.experimentInsightType,ge=v.experimentResultsLoading,Se=v.parsedSecondaryMetrics,_=v.areResultsSignificant,V=v.experimentId,G=v.conversionRateForVariant,me=v.getIndexForVariant,Ee=v.significanceBannerDetails,$=v.areTrendResultsConfusing,z=v.taxonomicGroupTypesForSelection,$e=v.groupTypes,lt=v.aggregationLabel,Et=v.secondaryMetricResults,te=Object(w.useActions)(Ye),ze=te.setNewExperimentData,In=te.createExperiment,wn=te.launchExperiment,ot=te.setFilters,Nn=te.setEditExperiment,Mn=te.endExperiment,Sn=te.addExperimentGroup,Dn=te.updateExperiment,Tn=te.updateExperimentGroup,Cn=te.removeExperimentGroup,Pn=te.setSecondaryMetrics,_n=te.setExperimentInsightType,Fn=te.archiveExperiment,An=Object(w.useValues)(hn.a),ht=An.featureFlags,Ln=W.a.useForm(),Rn=Y()(Ln,1),Un=Rn[0],kn=Object(oe.useState)(!0),Ht=Y()(kn,2),yt=Ht[0],xt=Ht[1],Bn=Object(w.useValues)(Object(f.b)({dashboardItemId:C,syncWithUrl:!1})),bt=Bn.insightProps,Ge=Object(w.useValues)(Object(ce.a)(bt)),Kn=Ge.isStepsEmpty,Yn=Ge.filterSteps,Jt=Ge.filters,Ot=Ge.results,Wn=Ge.conversionMetrics,Xt=Object(w.useValues)(Object(ut.a)(bt)),jt=Xt.filters,Vn=Xt.results,It=Wn.totalRate*100,$n=A(It),Zt=$n*X.length,wt=(t=Vn[0])===null||t===void 0?void 0:t.count,Qt=Ot==null||(n=Ot[0])===null||n===void 0?void 0:n.count,qt=J(wt),Nt=x===o.s.FUNNELS&&(I==null?void 0:I.insight)?I.insight.reduce(function(O,j){return j[0].count+O},0):0,zn=x===o.s.FUNNELS?(Nt||0)/((l==null||(r=l.parameters)===null||r===void 0?void 0:r.recommended_sample_size)||1)*100:Object(T.a)().diff(l==null?void 0:l.start_date,"day")/((l==null||(i=l.parameters)===null||i===void 0?void 0:i.recommended_running_time)||1)*100,Gn={running:"green",draft:"default",complete:"purple"},en=function(){if(l!=null&&l.start_date){if(!(l!=null&&l.end_date))return"running"}else return"draft";return"complete"};return e.a.createElement(e.a.Fragment,null,V==="new"||ve?e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{align:"middle",justify:"space-between",style:{borderBottom:"1px solid var(--border)",marginBottom:"1rem",paddingBottom:8}},e.a.createElement(ye.a,{title:"New Experiment"})),e.a.createElement(W.a,{name:"new-experiment",layout:"vertical",className:"experiment-form",form:Un,onValuesChange:function(j){return ze(j)},initialValues:{name:b==null?void 0:b.name,feature_flag_key:b==null?void 0:b.feature_flag_key,description:b==null?void 0:b.description},onFinish:function(){return In(!0,qt,Zt)},scrollToFirstError:!0},e.a.createElement("div",null,e.a.createElement(w.BindLogic,{logic:f.b,props:bt},e.a.createElement(g.a,null,e.a.createElement(h.a,{span:12,style:{paddingRight:24}},e.a.createElement(g.a,{className:"full-width"},e.a.createElement(W.a.Item,{label:"Name",name:"name",rules:[{required:!0,message:"You have to enter a name."}],requiredMark:!1},e.a.createElement(ie.a,{"data-attr":"experiment-name",className:"ph-ignore-input"})),e.a.createElement(W.a.Item,{style:{paddingLeft:16},label:e.a.createElement("div",null,"Feature flag key"," ",e.a.createElement(pe.a,{title:"Choose a unique key. This will create a new feature flag which will be associated with this experiment."},e.a.createElement(Be.a,null))),name:"feature_flag_key",requiredMark:!1,rules:[{required:!0,message:"You have to enter a feature flag key name."}]},e.a.createElement(ie.a,{"data-attr":"experiment-feature-flag-key",disabled:ve}))),e.a.createElement(W.a.Item,{label:e.a.createElement("div",null,"Description ",e.a.createElement("span",{className:"text-muted"},"(optional)")),name:"description"},e.a.createElement(ie.a.TextArea,{"data-attr":"experiment-description",className:"ph-ignore-input",placeholder:"Adding a helpful description can ensure others know what this experiment is about."})),(b==null||(c=b.parameters)===null||c===void 0?void 0:c.feature_flag_variants)&&e.a.createElement(h.a,null,e.a.createElement("label",null,e.a.createElement("b",null,"Experiment variants")),e.a.createElement("div",{className:"text-muted"},"Participants are divided into variant groups evenly. All experiments must consist of a control group and at least one test group. Experiments may have at most 3 test groups."),e.a.createElement(h.a,{className:"variants"},b.parameters.feature_flag_variants.map(function(O,j){return e.a.createElement(W.a,{key:"".concat(O,"-").concat(j),initialValues:{key:O.key},onValuesChange:function(re){Tn(re,j)},validateTrigger:["onChange","onBlur"]},e.a.createElement(g.a,{className:"feature-flag-variant"},e.a.createElement(W.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}]},e.a.createElement(ie.a,{disabled:j===0,"data-attr":"feature-flag-variant-key","data-key-index":j.toString(),className:"ph-ignore-input",style:{minWidth:300},placeholder:"example-variant-".concat(j+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),e.a.createElement("div",{className:"float-right"},!(j===0||j===1)&&e.a.createElement(pe.a,{title:"Delete this variant",placement:"bottomLeft"},e.a.createElement(k.a,{type:"link",icon:e.a.createElement(Lt.a,null),onClick:function(){return Cn(j)},style:{color:"var(--danger)",float:"right"}})))))}),b.parameters.feature_flag_variants.length<4&&e.a.createElement("div",null,e.a.createElement(k.a,{style:{color:"var(--primary)",border:"none",boxShadow:"none",marginTop:"1rem",paddingLeft:0},icon:e.a.createElement(cn.a,null),onClick:function(){return Sn()}},"Add test variant")))),e.a.createElement(g.a,{className:"person-selection"},e.a.createElement("span",null,e.a.createElement("b",null,"Select Participants")),e.a.createElement("span",null,e.a.createElement("b",null,"Participant Type"),e.a.createElement(B.a,{value:(b==null||(m=b.filters)===null||m===void 0?void 0:m.aggregation_group_type_index)!=null?b.filters.aggregation_group_type_index:-1,onChange:function(j){var ne,re=j!==-1?j:void 0;re!=(b==null||(ne=b.filters)===null||ne===void 0?void 0:ne.aggregation_group_type_index)&&(ot({properties:[],aggregation_group_type_index:re}),ze({filters:{aggregation_group_type_index:re,properties:[]}}))},style:{marginLeft:8},"data-attr":"participant-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]}},e.a.createElement(B.a.Option,{key:-1,value:-1},"Users"),$e.map(function(O){return e.a.createElement(B.a.Option,{key:O.group_type_index,value:O.group_type_index},Object(q.j)(lt(O.group_type_index).plural))}))),e.a.createElement(h.a,null,e.a.createElement("div",{className:"text-muted"},"Select the entities who will participate in this experiment. If no filters are set, 100% of participants will be targeted."),e.a.createElement("div",{style:{flex:3,marginRight:5}},e.a.createElement(je.a,{pageKey:"EditFunnel-property",propertyFilters:x===o.s.FUNNELS?Jt.properties:jt.properties,onChange:function(j){ze({filters:{properties:j}}),ot({properties:j.filter(Ce.b)})},style:{margin:"1rem 0 0"},taxonomicGroupTypes:z,popoverPlacement:"top",taxonomicPopoverPlacement:"auto"})))),e.a.createElement(g.a,{className:"metrics-selection"},e.a.createElement(h.a,{style:{paddingRight:8}},e.a.createElement("div",{className:"mb-05"},e.a.createElement("b",null,"Goal type"),e.a.createElement("div",{className:"text-muted"},x===o.s.TRENDS?"Track counts of a specific event or action":"Track how many persons complete a sequence of actions and or events")),e.a.createElement(B.a,{style:{display:"flex"},value:x,onChange:_n,suffixIcon:e.a.createElement(at.a,null),dropdownMatchSelectWidth:!1},e.a.createElement(B.a.Option,{value:o.s.TRENDS},e.a.createElement(h.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Trend")))),e.a.createElement(B.a.Option,{value:o.s.FUNNELS},e.a.createElement(h.a,null,e.a.createElement("span",null,e.a.createElement("b",null,"Conversion funnel"))))),e.a.createElement("div",{className:"mb mt"},e.a.createElement("b",null,"Experiment goal"),x===o.s.TRENDS&&e.a.createElement("div",{className:"text-muted"},"Trend-based experiments can have at most one graph series. This metric is used to track the progress of your experiment.")),e.a.createElement(g.a,null,e.a.createElement(Z.a,{className:"action-filters-bordered",style:{width:"100%",marginRight:8},bodyStyle:{padding:0}},x===o.s.FUNNELS&&e.a.createElement(K.a,{filters:Jt,setFilters:function(j){ze({filters:j}),ot(j)},typeKey:"EditFunnel-action",hideMathSelector:!0,hideDeleteBtn:Yn.length===1,buttonCopy:"Add funnel step",buttonType:"link",showSeriesIndicator:!Kn,seriesIndicatorType:"numeric",fullWidth:!0,sortable:!0,showNestedArrow:!0,propertiesTaxonomicGroupTypes:[N.a.EventProperties,N.a.PersonProperties,N.a.Cohorts,N.a.Elements],rowClassName:"action-filters-bordered"}),x===o.s.TRENDS&&e.a.createElement(K.a,{horizontalUI:!0,filters:jt,setFilters:function(j){ze({filters:j}),ot(j)},typeKey:"experiment-trends",buttonCopy:"Add graph series",showSeriesIndicator:!0,entitiesLimit:1,hideMathSelector:!1,propertiesTaxonomicGroupTypes:[N.a.EventProperties,N.a.PersonProperties,N.a.Cohorts,N.a.Elements],customRowPrefix:jt.insight===o.s.LIFECYCLE?e.a.createElement(e.a.Fragment,null,"Showing ",e.a.createElement("b",null,"Unique users")," who did"):void 0}))))),ht[we.o.EXPERIMENTS_SECONDARY_METRICS]&&e.a.createElement(g.a,{className:"mt"},e.a.createElement(h.a,null,e.a.createElement("div",null,e.a.createElement("b",null,"Secondary metrics"),e.a.createElement("span",{className:"text-muted ml-05"},"(optional)")),e.a.createElement("div",{className:"text-muted",style:{marginTop:4}},"Use secondary metrics to monitor metrics related to your experiment goal. You can add up to three secondary metrics."," ")),e.a.createElement(it,{onMetricsChange:function(j){return Pn(j)},initialMetrics:Se}))),e.a.createElement(h.a,{span:12},e.a.createElement(Z.a,{className:"experiment-preview"},e.a.createElement(We,{experiment:b,trendCount:wt,trendExposure:qt,funnelSampleSize:Zt,funnelEntrants:Qt,funnelConversionRate:It}),e.a.createElement(pt.a,{disableHeader:x===o.s.TRENDS,disableTable:!0})))))),e.a.createElement(k.a,{icon:e.a.createElement(dn.a,null),className:"float-right",type:"primary",htmlType:"submit"},"Save"))):l?e.a.createElement("div",{className:"view-experiment"},e.a.createElement(g.a,{className:"draft-header"},e.a.createElement(g.a,{justify:"space-between",align:"middle",className:"full-width pb"},e.a.createElement(h.a,null,e.a.createElement(g.a,null,e.a.createElement(ye.a,{style:{margin:0,paddingRight:8},title:"".concat(l==null?void 0:l.name)}),e.a.createElement(mn.a,{explicitValue:l.feature_flag_key,iconStyle:{color:"var(--text-muted-alt)"}},e.a.createElement("span",{className:"text-muted"},l.feature_flag_key)),e.a.createElement(Oe.a,{style:{alignSelf:"center",marginLeft:"1rem"},color:Gn[en()]},e.a.createElement("b",{className:"uppercase"},en())),I&&l.end_date&&e.a.createElement(Oe.a,{style:{alignSelf:"center"},color:_?"green":"geekblue"},e.a.createElement("b",{className:"uppercase"},_?"Significant Results":"Results not significant"))),e.a.createElement("span",{className:"exp-description"},l.start_date?e.a.createElement(gn.a,{multiline:!0,name:"description",value:l.description||"",placeholder:"Description (optional)",onSave:function(j){return Dn({description:j})},maxLength:400,"data-attr":"experiment-description",compactButtons:!0}):e.a.createElement(e.a.Fragment,null,l.description||"There is no description for this experiment."))),l&&!l.start_date&&e.a.createElement("div",null,e.a.createElement(k.a,{className:"mr-05",onClick:function(){return Nn(!0)}},"Edit"),e.a.createElement(k.a,{type:"primary",onClick:function(){return wn()}},"Launch")),l&&l.start_date&&!l.end_date&&e.a.createElement(k.a,{className:"stop-experiment",onClick:function(){return Mn()}},"Stop experiment"),(l==null?void 0:l.end_date)&&Object(T.a)().isSameOrAfter(Object(T.a)(l.end_date),"day")&&!l.archived&&e.a.createElement(k.a,{className:"archive-experiment",onClick:function(){return Fn()}},e.a.createElement("b",null,"Archive experiment")))),e.a.createElement(g.a,null,yt&&I&&_&&!l.end_date&&e.a.createElement(g.a,{align:"middle",className:"significant-results"},e.a.createElement(h.a,{span:19,style:{color:"#497342"}},"Your results are ",e.a.createElement("b",null,"statistically significant"),"."," ",l.end_date?"":"You can end this experiment now or let it run to completion."),e.a.createElement(h.a,{span:5},e.a.createElement(k.a,{style:{color:"#497342"},onClick:function(){return xt(!1)}},"Dismiss"))),yt&&I&&!_&&!l.end_date&&e.a.createElement(g.a,{align:"middle",className:"not-significant-results"},e.a.createElement(h.a,{span:23,style:{color:"#2D2D2D"}},e.a.createElement("b",null,"Your results are not statistically significant"),". ",Ee," ",l!=null&&l.end_date?"":"We don't recommend ending this experiment yet."," ","See our"," ",e.a.createElement("a",{href:"https://posthog.com/docs/user-guides/experimentation#funnel-experiment-calculations"}," ","experimentation guide"," "),"for more information."," "),e.a.createElement(h.a,{span:1},e.a.createElement(Rt.a,{className:"close-button",onClick:function(){return xt(!1)}}))),yt&&l.end_date&&e.a.createElement(g.a,{align:"middle",className:"feature-flag-mods"},e.a.createElement(h.a,{span:23},e.a.createElement("b",null,"Your experiment is complete.")," We recommend removing the feature flag from your code completely, instead of relying on this distribution:"," ",e.a.createElement(En.a,{to:l.feature_flag?Ie.a.featureFlag(l.feature_flag):void 0},e.a.createElement("b",null,"Adjust feature flag distribution."))),e.a.createElement(h.a,{span:1},e.a.createElement(Rt.a,{className:"close-button",onClick:function(){return xt(!1)}})))),e.a.createElement(g.a,null,e.a.createElement(le.a,{className:"full-width",defaultActiveKey:"experiment-details"},e.a.createElement(le.a.Panel,{header:e.a.createElement("b",null,"Experiment details"),key:"experiment-details"},e.a.createElement(g.a,null,e.a.createElement(h.a,{span:l!=null&&l.start_date?12:24},e.a.createElement(We,{experiment:l,trendCount:wt,trendExposure:l==null?void 0:l.parameters.recommended_running_time,funnelSampleSize:l==null?void 0:l.parameters.recommended_sample_size,funnelConversionRate:It,funnelEntrants:l!=null&&l.start_date?Nt:Qt})),!I&&l.start_date&&e.a.createElement(h.a,{span:12},e.a.createElement(Ve,{experiment:l})),(I||l.secondary_metrics.length>0)&&e.a.createElement(h.a,{className:"secondary-progress",span:l!=null&&l.start_date?12:24},ht[we.o.EXPERIMENTS_SECONDARY_METRICS]&&!!(l!=null&&l.secondary_metrics.length)&&e.a.createElement(h.a,{className:"border-bottom"},e.a.createElement(g.a,{align:"middle",justify:"space-between",className:"mb-05"},e.a.createElement("div",{className:"card-secondary"},"Secondary metrics"),l==null||(d=l.parameters)===null||d===void 0||(p=d.feature_flag_variants)===null||p===void 0?void 0:p.map(function(O,j){return e.a.createElement("li",{key:j,style:{color:"".concat(x===o.s.FUNNELS?Object(Ut.k)(me(O.key,o.s.FUNNELS)+1):Object(Wt.c)("white")[me(O.key,o.s.TRENDS)])},className:"pr"},e.a.createElement("span",{className:"text-default"},Object(q.j)(O.key)))})),ht[we.o.EXPERIMENTS_SECONDARY_METRICS]&&(l.start_date?e.a.createElement(e.a.Fragment,null,l.secondary_metrics.map(function(O,j){var ne,re;return e.a.createElement(g.a,{className:"border-top",key:j,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement("div",null,Object(q.j)(O.name)),l==null||(ne=l.parameters)===null||ne===void 0||(re=ne.feature_flag_variants)===null||re===void 0?void 0:re.map(function(tn,Mt){return e.a.createElement("div",{key:Mt},Et==null?void 0:Et[j][tn.key])}))})):e.a.createElement(e.a.Fragment,null,l.secondary_metrics.map(function(O,j){var ne,re;return e.a.createElement(g.a,{className:"border-top",key:j,justify:"space-between",style:{paddingTop:8,paddingBottom:8}},e.a.createElement("div",null,Object(q.j)(O.name)),l==null||(ne=l.parameters)===null||ne===void 0||(re=ne.feature_flag_variants)===null||re===void 0?void 0:re.map(function(tn,Mt){return e.a.createElement("div",{key:Mt},"--")}))})))),I&&e.a.createElement(h.a,{className:"mt"},e.a.createElement("div",{className:"mb-05"},e.a.createElement("b",null,"Experiment progress")),e.a.createElement(Te.a,{strokeWidth:20,showInfo:!1,percent:zn,strokeColor:"var(--success)"}),x===o.s.TRENDS&&l.start_date&&e.a.createElement(g.a,{justify:"space-between",className:"mt-05"},e.a.createElement("div",null,e.a.createElement("b",null,Object(T.a)().diff(l.start_date,"day"))," ","days running"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,l==null||(s=l.parameters)===null||s===void 0?void 0:s.recommended_running_time)," ","days")),x===o.s.FUNNELS&&e.a.createElement(g.a,{justify:"space-between",className:"mt-05"},e.a.createElement("div",null,e.a.createElement("b",null,Nt)," participants seen"),e.a.createElement("div",null,"Goal:"," ",e.a.createElement("b",null,l==null||(u=l.parameters)===null||u===void 0?void 0:u.recommended_sample_size)," ","participants"))))))),!(l!=null&&l.start_date)&&e.a.createElement("div",{className:"mt full-width"},e.a.createElement(Ve,{experiment:l}))),e.a.createElement("div",{className:"experiment-result"},I?e.a.createElement(e.a.Fragment,null,e.a.createElement(g.a,{justify:"space-around",style:{flexFlow:"nowrap"}},Object.keys(I.probability).sort(function(O,j){return I.probability[j]-I.probability[O]}).map(function(O,j){return e.a.createElement(h.a,{key:j,className:"pr"},e.a.createElement("div",null,e.a.createElement("b",null,Object(q.j)(O))),x===o.s.TRENDS?e.a.createElement(g.a,null,e.a.createElement("b",{style:{paddingRight:4}},e.a.createElement(g.a,null,"action"in I.insight[0]&&e.a.createElement(vn.a,{filter:I.insight[0].action}),e.a.createElement("span",{style:{paddingLeft:4}},"count:")))," ",ee(O)," ",$&&j===0&&e.a.createElement(pe.a,{placement:"right",title:"It might seem confusing that the best variant has lower absolute count, but this can happen when fewer people are exposed to this variant, so its relative count is higher."},e.a.createElement(Be.a,{style:{padding:"4px 2px"}}))):e.a.createElement(g.a,null,e.a.createElement("b",{style:{paddingRight:4}},"Conversion rate:")," ",G(O),"%"),e.a.createElement(Te.a,{percent:Number((I.probability[O]*100).toFixed(1)),size:"small",showInfo:!1,strokeColor:x===o.s.FUNNELS?Object(Ut.k)(me(O,o.s.FUNNELS)+1):Object(Wt.c)("white")[me(O,o.s.TRENDS)]}),e.a.createElement("div",null,"Probability that this variant is the best:"," ",e.a.createElement("b",null,(I.probability[O]*100).toFixed(1),"%")))}))):ge&&e.a.createElement("div",{className:"text-center"},e.a.createElement(ft.a,null)),I?e.a.createElement(w.BindLogic,{logic:f.b,props:{dashboardItemId:I.itemID,filters:gt(gt(gt({},I.filters),{},{insight:x,display:l.filters.display},x===o.s.FUNNELS&&{layout:we.q.vertical,funnel_viz_type:o.o.Steps}),x===o.s.TRENDS&&{display:o.d.ActionsLineGraphCumulative}),cachedResults:I.insight,syncWithUrl:!1,doNotLoad:!0}},e.a.createElement("div",{className:"mt"},e.a.createElement(pt.a,{disableHeader:x===o.s.TRENDS,disableTable:x===o.s.FUNNELS}))):l.start_date&&e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"no-experiment-results"},ge?e.a.createElement(ft.a,null):e.a.createElement("div",{className:"text-center"},e.a.createElement("b",null,"There are no results for this experiment yet."),e.a.createElement("div",{className:"text-default"},"Double check your feature flag implementation if you're still not seeing results.")))))):e.a.createElement(ft.a,null))}function Gt(){return e.a.createElement(B.a,{defaultValue:"JavaScript",suffixIcon:e.a.createElement(at.a,null)},e.a.createElement(B.a.Option,{value:"JavaScript"},e.a.createElement(g.a,{align:"middle"},e.a.createElement(Ne.IconJavascript,{style:{marginRight:6}})," JavaScript")))}},"./frontend/src/scenes/experiments/experimentsLogic.tsx":function(Ae,ae,a){"use strict";a.d(ae,"a",function(){return Ce});var De=a("./node_modules/core-js/modules/es.array.concat.js"),St=a.n(De),He=a("./node_modules/core-js/modules/es.array.filter.js"),Dt=a.n(He),Je=a("./node_modules/core-js/modules/es.array.iterator.js"),Tt=a.n(Je),Xe=a("./node_modules/core-js/modules/es.array.map.js"),Ct=a.n(Xe),Ze=a("./node_modules/core-js/modules/es.object.to-string.js"),ct=a.n(Ze),Qe=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),he=a.n(Qe),Le=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),be=a.n(Le),Re=a("./node_modules/@babel/runtime/regenerator/index.js"),Y=a.n(Re),W=a("./node_modules/regenerator-runtime/runtime.js"),g=a.n(W),h=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ie=a.n(h),pe=a("./node_modules/kea/lib/index.esm.js"),k=a("./frontend/src/lib/api.mock.ts"),B=a("./frontend/src/scenes/teamLogic.tsx"),Z=a("./frontend/src/types.ts"),Oe=a("./node_modules/@ant-design/icons/es/icons/CheckCircleOutlined.js"),le=a("./node_modules/react-toastify/esm/react-toastify.js"),Te=a("./node_modules/react/index.js"),w=a.n(Te),ye=a("./frontend/src/lib/utils.tsx"),je=a("./frontend/src/scenes/userLogic.tsx"),Ce=Object(pe.kea)({path:["scenes","experiments","experimentsLogic"],connect:{values:[B.a,["currentTeamId"],je.a,["hasAvailableFeature"]]},actions:{},loaders:function(oe){var e=oe.values,ce=oe.actions;return{experiments:[[],{loadExperiments:function(){var K=ie()(Y.a.mark(function o(E){var M;return Y.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(e.hasAvailableFeature(Z.c.EXPERIMENTATION)){P.next=2;break}return P.abrupt("return",[]);case 2:return P.next=4,k.a.get("api/projects/".concat(e.currentTeamId,"/experiments?").concat(E||""));case 4:return M=P.sent,P.abrupt("return",M.results);case 6:case"end":return P.stop()}},o)}));function f(o){return K.apply(this,arguments)}return f}(),deleteExperiment:function(){var K=ie()(Y.a.mark(function o(E){return Y.a.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,k.a.delete("api/projects/".concat(e.currentTeamId,"/experiments/").concat(E));case 2:return Object(le.c)(w.a.createElement("div",null,w.a.createElement("h1",{className:"text-success"},w.a.createElement(Oe.a,null)," Experiment removed"))),F.abrupt("return",e.experiments.filter(function(P){return P.id!==E}));case 4:case"end":return F.stop()}},o)}));function f(o){return K.apply(this,arguments)}return f}(),addToExperiments:function(f){return[].concat(be()(e.experiments),[f])},updateExperiments:function(f){return e.experiments.map(function(o){return o.id===f.id?f:o})}}],tab:[Z.h.All,{setExperimentsFilters:function(){var K=ie()(Y.a.mark(function o(E){var M,F;return Y.a.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return M=E.tab,F=M===Z.h.Yours?Object(ye.zb)({user:!0}):Object(ye.zb)({archived:!0}),M===Z.h.All?ce.loadExperiments(Object(ye.zb)({all:!0})):ce.loadExperiments(F),H.abrupt("return",M);case 4:case"end":return H.stop()}},o)}));function f(o){return K.apply(this,arguments)}return f}()}]}},events:function(oe){var e=oe.actions;return{afterMount:function(){e.loadExperiments()}}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/experiments/Experiment.scss":function(Ae,ae,a){var De=a("./node_modules/css-loader/dist/runtime/api.js");ae=De(!1),ae.push([Ae.i,'.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.experiment-form .metrics-selection{width:100%;border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;margin-top:1rem}.experiment-form .metrics-selection .action-filters-bordered .draggable-action-filter{border-bottom:1px solid rgba(0,0,0,.15);padding:1rem .25rem;margin-top:0}.experiment-form .metrics-selection .action-filters-bordered .row-action-btn{color:#35416b}.experiment-form .person-selection{width:100%;border-top:1px solid rgba(0,0,0,.15);padding-top:1rem;margin-top:1rem;align-items:center;justify-content:space-between}.experiment-form .insights-graph-container{margin-bottom:1rem;background-color:#fff}.experiment-form .insights-graph-container .ant-card-head{border-bottom:1px solid rgba(0,0,0,.15);min-height:unset;background-color:#fff;padding-left:1rem;padding-right:1rem}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title{padding:.5rem 0}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter{font-size:14px}.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter:not(:last-child),.experiment-form .insights-graph-container .ant-card-head .ant-card-head-title span.filter span.head-title-item{margin-right:.5rem}.experiment-form .insights-graph-container .display-config-inner{display:flex;align-items:center;justify-content:space-between;overflow-x:auto}.experiment-form .insights-graph-container .ant-card-body{padding:0}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-left{width:100%}.experiment-form .insights-graph-container .insights-graph-container-row .insights-graph-container-row-right{width:100%;height:min(calc(90vh - 16rem),36rem);max-width:300px;padding:0 1rem 1rem 0;display:flex;align-items:center}.experiment-form .insights-graph-container .graph-container{width:calc(100% - 48px);height:calc(100% - 48px);margin-top:2rem}.experiment-form .insights-graph-header{margin-top:0!important;margin-bottom:0!important;padding-left:1rem;padding-right:1rem;min-height:48px}.experiment-form .experiment-preview{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.experiment-form .experiment-preview .mde-slider .ant-slider-handle{border:none}.experiment-form .experiment-preview .mde-slider .ant-slider-rail{background-color:#e5ebff}.experiment-form .variants{border:1px solid rgba(0,0,0,.15);border-radius:4px;padding-left:1rem;margin-top:.5rem;margin-bottom:1rem}.experiment-form .variants .feature-flag-variant{margin-top:20px}.experiment-form .variants .feature-flag-variant .ant-form-item-explain-error{padding-top:.5rem}.experiment-form .ant-input-number-disabled,.experiment-form .ant-input[disabled]{color:#000}.view-experiment .draft-header{margin-bottom:1rem;border-bottom:1px solid rgba(0,0,0,.15)}.view-experiment .stop-experiment{background-color:#f96132;color:#fff}.view-experiment .archive-experiment{color:#f96132}.view-experiment .exp-description{font-style:italic;color:rgba(0,0,0,.5)}.view-experiment .participants{background-color:#fff}.view-experiment .participants .ant-collapse-header{padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem}.view-experiment .variants-list{list-style:none;margin:0;padding:0}.view-experiment .variants-list li{display:inline}.view-experiment .variants-list li:after{content:", "}.view-experiment .variants-list li:last-child:after{content:""}.view-experiment .experiment-result{padding-top:1rem}.view-experiment .significant-results{padding:.5rem;width:100%;background:rgba(119,185,108,.1);border-radius:4px;text-align:center;margin-bottom:1rem}.view-experiment .not-significant-results{padding:.5rem;width:100%;background:rgba(83,117,255,.1);border-radius:4px;margin-bottom:1rem}.view-experiment .feature-flag-mods{padding:.5rem;width:100%;background:#f6ebf8;border-radius:4px;margin-bottom:1rem}.view-experiment .ant-collapse-content-box{display:flex;flex-flow:column}.view-experiment .secondary-progress{margin-top:.5rem}.view-experiment .secondary-progress li:before{content:"\u2022";display:inline-block;font-weight:900;margin-right:4px}.view-experiment .no-experiment-results{display:flex;justify-content:center;align-items:center;margin-top:1rem;background-color:#fafaf9;border:1px solid rgba(0,0,0,.15);width:100%;min-height:320px;font-size:24px}.preview-conversion-goal-num{height:24px;width:24px;text-align:center;background-color:#fafaf9;color:#35416b;font-weight:700;margin-right:.5rem}.experiment-preview-row{border-bottom:1px solid rgba(0,0,0,.15);padding-bottom:1rem;margin-bottom:1rem}.experiment-preview-row:last-child{border-bottom:none;padding-bottom:0;margin-bottom:0}.metric-name{border:1px solid rgba(0,0,0,.15);border-radius:4px;padding:8px 8px 8px 16px;margin-left:.5rem;flex:1}.experiment-implementation-details,.experiment-workflow{border-color:#d9d9d9}.experiment-implementation-details .ant-card-head,.experiment-workflow .ant-card-head{padding-left:1rem;padding-right:1rem;border:none}.experiment-implementation-details .ant-card-head-title,.experiment-workflow .ant-card-head-title{border-bottom:1px solid rgba(0,0,0,.15)}.experiment-implementation-details .exp-workflow-step,.experiment-workflow .exp-workflow-step{margin-bottom:.5rem;padding:.5rem;border-radius:4px}.experiment-implementation-details .exp-workflow-step:hover,.experiment-workflow .exp-workflow-step:hover{cursor:pointer}.experiment-implementation-details .step-completed,.experiment-workflow .step-completed{background-color:#e5ebff}',""]),Ae.exports=ae}}]);
