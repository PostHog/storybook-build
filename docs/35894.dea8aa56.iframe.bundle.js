"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[35894],{"../../frontend/src/lib/components/FilterBar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>FilterBar});var clsx__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_posthog_icons__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),_layout_scenes_components_SceneStickyBar__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/layout/scenes/components/SceneStickyBar.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let FilterBar=_ref=>{let{top,left,right,className}=_ref,[expanded,setExpanded]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)(_layout_scenes_components_SceneStickyBar__WEBPACK_IMPORTED_MODULE_3__.S,{className:className,children:[top,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"flex items-start shrink-0",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsxs)("div",{className:"flex flex-1 flex-row gap-2 items-center",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"flex flex-row gap-1 items-center flex-1 md:flex-none",children:left}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.Jp,{type:"secondary",size:"small",className:"sm:hidden",onClick:()=>setExpanded(expanded=>!expanded),icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_1__.IconFilter,{})})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"hidden sm:flex gap-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(FoldableFilters,{children:right})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:(0,clsx__WEBPACK_IMPORTED_MODULE_5__.default)("flex sm:hidden flex-col gap-2 overflow-hidden transition-all duration-200",expanded?"max-h-[500px]":"max-h-0"),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)(FoldableFilters,{children:right})})]})]})},FoldableFilters=_ref2=>{let{children}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_4__.jsx)("div",{className:"flex flex-row md:flex-row-reverse flex-wrap gap-2 md:[&>*]:grow-0 [&>*]:grow w-full",children:children})}},"../../frontend/src/scenes/data-management/managed-viewsets/DataWarehouseManagedViewsetCard.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>DataWarehouseManagedViewsetCard});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),AccessControlAction=__webpack_require__("../../frontend/src/lib/components/AccessControlAction.tsx"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),LemonToast=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/index.ts"),disableDataWarehouseManagedViewsetModalLogic=__webpack_require__("../../frontend/src/scenes/data-management/managed-viewsets/disableDataWarehouseManagedViewsetModalLogic.ts");let dataWarehouseManagedViewsetsLogic=(0,index_esm.kea)([(0,index_esm.props)({type:"root"}),(0,index_esm.key)(_ref=>{let{type}=_ref;return`dataWarehouseManagedViewsetsLogic-${type}`}),(0,index_esm.path)(key=>["scenes","data-management","managed-viewsets",key]),(0,index_esm.connect)(props=>({values:[teamLogic.teamLogic,["currentTeam"]],actions:[teamLogic.teamLogic,["loadCurrentTeam"],(0,disableDataWarehouseManagedViewsetModalLogic.M)({type:props.type}),["openModal"]]})),(0,index_esm.actions)({toggleViewset:(kind,enabled)=>({kind,enabled})}),(0,index_esm.reducers)({togglingViewset:[null,{toggleViewset:(_,_ref2)=>{let{kind}=_ref2;return kind}}]}),(0,lib.loaders)(_ref3=>{let{actions}=_ref3;return{toggleResult:[null,{toggleViewset:async _ref4=>{let{kind,enabled}=_ref4;if(!enabled){actions.openModal(kind);return}try{await api.ZP.dataWarehouseManagedViewsets.toggle(kind,!0),LemonToast.U.success("Viewset enabled successfully"),actions.loadCurrentTeam()}catch(error){throw LemonToast.U.error(`Failed to enable viewset: ${error.message||"Unknown error"}`),error}}}]}})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let VIEWSET_DESCRIPTIONS={revenue_analytics:{title:"Revenue Analytics",description:"Track and analyze revenue data from your payment providers and custom events. Automatically creates optimized views for revenue metrics, trends, and customer lifetime value.",docsUrl:"https://posthog.com/docs/revenue-analytics",configUrl:"/data-management/revenue",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPiggyBank,{className:"text-xl"})}};function DataWarehouseManagedViewsetCard(_ref){let{type,kind,resourceType,displayDocsLink=!0,displayConfigLink=!0}=_ref,{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),{toggleViewset}=(0,index_esm.useActions)(dataWarehouseManagedViewsetsLogic({type})),{togglingViewset,toggleResultLoading}=(0,index_esm.useValues)(dataWarehouseManagedViewsetsLogic({type})),{title,description,docsUrl,configUrl,icon}=VIEWSET_DESCRIPTIONS[kind],isEnabled=currentTeam.managed_viewsets[kind];return(0,jsx_runtime.jsx)("div",{className:"border rounded p-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[icon,(0,jsx_runtime.jsx)("h3",{className:"font-semibold text-lg mb-0",children:title})]}),(0,jsx_runtime.jsx)("p",{className:"text-muted mb-2",children:description}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[displayConfigLink&&(0,jsx_runtime.jsx)(src.rU,{to:configUrl,className:"text-sm",children:"Configure"}),displayDocsLink&&displayConfigLink&&(0,jsx_runtime.jsx)("span",{children:"|"}),displayDocsLink&&(0,jsx_runtime.jsx)(src.rU,{to:docsUrl,target:"_blank",className:"text-sm",children:"Learn more in the docs"})]})]}),(0,jsx_runtime.jsx)(AccessControlAction.b,{resourceType:resourceType,minAccessLevel:types.W$.Editor,children:(0,jsx_runtime.jsx)(src.f4,{checked:isEnabled,onChange:enabled=>toggleViewset(kind,enabled),disabled:togglingViewset===kind&&toggleResultLoading,label:isEnabled?"Enabled":"Disabled",bordered:!0})})]})})}},"../../products/revenue_analytics/frontend/Onboarding/Onboarding.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{T:()=>Onboarding});var ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes=__webpack_require__("../../frontend/src/scenes/scenes.ts"),RevenueAnalyticsScene=__webpack_require__("../../products/revenue_analytics/frontend/RevenueAnalyticsScene.tsx"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),DataWarehouseManagedViewsetCard=__webpack_require__("../../frontend/src/scenes/data-management/managed-viewsets/DataWarehouseManagedViewsetCard.tsx"),NewSourceWizard=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/NewSourceWizard.tsx"),DataWarehouseSourceIcon=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/DataWarehouseSourceIcon.tsx"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),types=__webpack_require__("../../frontend/src/types.ts"),EventConfigurationModal=__webpack_require__("../../products/revenue_analytics/frontend/settings/EventConfigurationModal.tsx"),revenueAnalyticsSettingsLogic=__webpack_require__("../../products/revenue_analytics/frontend/settings/revenueAnalyticsSettingsLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let REVENUE_SOURCE_TYPES=["Stripe","Chargebee","Polar","RevenueCat"],AVAILABLE_REVENUE_SOURCE_TYPES=new Set(["Stripe"]);function InlineSetup(_ref){var _currentTeam$managed_,_dataWarehouseSources;let{closeOnboarding,initialSetupView}=_ref,{events,enabledDataWarehouseSources,dataWarehouseSources}=(0,index_esm.useValues)(revenueAnalyticsSettingsLogic.m),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),managedViewsetsEnabled=featureFlags[constants.y8.MANAGED_VIEWSETS],isViewsetEnabled=null!==(_currentTeam$managed_=currentTeam?.managed_viewsets?.revenue_analytics)&&void 0!==_currentTeam$managed_&&_currentTeam$managed_,hasEvents=events.length>0,hasSources=enabledDataWarehouseSources.length>0,hasConnectedButDisabledStripeSources=null!==(_dataWarehouseSources=dataWarehouseSources?.results?.some(source=>"Stripe"===source.source_type&&!source.revenue_analytics_config?.enabled))&&void 0!==_dataWarehouseSources&&_dataWarehouseSources,[currentView,setCurrentView]=(0,react.useState)(null!=initialSetupView?initialSetupView:"overview"),[selectedSource,setSelectedSource]=(0,react.useState)(null),[showEventModal,setShowEventModal]=(0,react.useState)(!1),shouldShowViewsetStep=managedViewsetsEnabled&&!isViewsetEnabled,revenueSources=REVENUE_SOURCE_TYPES.map(source_type=>({id:source_type,description:`Import revenue data from ${source_type}`,isAvailable:AVAILABLE_REVENUE_SOURCE_TYPES.has(source_type),isConnected:enabledDataWarehouseSources.some(source=>source.source_type===source_type)})),handleSourceSelect=sourceId=>{revenueSources.find(s=>s.id===sourceId)&&(setSelectedSource(sourceId),setCurrentView("add-source"))};return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[shouldShowViewsetStep?(0,jsx_runtime.jsx)(src.Mi,{hoverEffect:!1,children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-primary text-primary-3000 font-bold text-lg",children:"1"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold mb-1",children:"Enable Revenue Analytics"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted-alt",children:"First, enable revenue analytics to create optimized database views for your revenue data"})]})]}),(0,jsx_runtime.jsx)(DataWarehouseManagedViewsetCard.V,{type:"onboarding",kind:"revenue_analytics",resourceType:types.qR.RevenueAnalytics,displayDocsLink:!0,displayConfigLink:!1}),(0,jsx_runtime.jsxs)("div",{className:"text-sm text-muted-alt p-3 bg-bg-light rounded",children:[(0,jsx_runtime.jsx)("strong",{children:"Note:"})," Once enabled, you'll be able to configure your revenue sources and events in the next step."]})]})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.Mi,{hoverEffect:!1,children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-between",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3",children:[managedViewsetsEnabled&&(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-primary text-primary-3000 font-bold text-lg",children:"2"}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold mb-1",children:"Configure Revenue Sources"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted-alt",children:"Set up your revenue tracking to get started"})]})]})}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border border-primary",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-bg-light border border-primary",children:hasEvents?(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"w-6 h-6"}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPieChart,{className:"w-6 h-6 text-muted"})}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium text-sm",children:hasEvents?`${events.length} Event${1!==events.length?"s":""} Configured`:"No Events Configured"}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted-alt mt-0.5",children:hasEvents?"Revenue events are set up":"Configure events to track revenue"})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg border border-primary",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-10 h-10 rounded-full bg-bg-light border border-primary",children:hasSources?(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{className:"w-6 h-6"}):(0,jsx_runtime.jsx)(posthog_icons_es.IconDatabase,{className:"w-6 h-6 text-muted"})}),(0,jsx_runtime.jsxs)("div",{className:"flex-1",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium text-sm",children:hasSources?"Revenue source connected":"No revenue sources connected"}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted-alt mt-0.5",children:hasSources?"Revenue data source is set up":hasConnectedButDisabledStripeSources?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Connect Stripe to import revenue data. Wanna reuse your existing Stripe source?"," ",(0,jsx_runtime.jsx)(src.rU,{to:urls.j.revenueSettings(),className:"text-link",children:"Enable it here"})]}):"Connect Stripe to import revenue data"})]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-2 border-t border-primary",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>setShowEventModal(!0),size:"small","data-attr":"add-revenue-event",children:"Add Revenue Event"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>{setSelectedSource(null),setCurrentView("add-source")},size:"small","data-attr":"add-revenue-source",children:"Connect Revenue Source"}),hasConnectedButDisabledStripeSources&&(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconArrowRight,{}),onClick:()=>{lib.router.actions.push(urls.j.revenueSettings())},size:"small","data-attr":"enable-existing-stripe-source",children:"Enable Existing Stripe Source"}),(hasEvents||hasSources)&&(0,jsx_runtime.jsx)(src.Jp,{type:"primary",size:"small",onClick:closeOnboarding,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCheckCircle,{}),className:"ml-auto",children:"You're all set! View Dashboard"})]})]})})}),"add-source"===currentView&&!selectedSource&&(0,jsx_runtime.jsx)(src.Mi,{hoverEffect:!1,children:(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-white border border-primary",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconDatabase,{className:"w-7 h-7",style:{color:"var(--primary-3000)"}})}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h4",{className:"text-lg font-semibold",children:"Connect Revenue Source"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-muted-alt",children:"Choose a revenue platform to import data from"})]})]}),(0,jsx_runtime.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:revenueSources.map(source=>(0,jsx_runtime.jsxs)("div",{className:(0,css_classes.cn)("relative p-4 rounded-lg border-2",source.isAvailable?source.isConnected?"border-primary bg-primary-lightest":"border-primary bg-bg-light":"border-primary bg-bg-light opacity-60",source.isAvailable?"cursor-pointer":"cursor-not-allowed"),onClick:source.isAvailable?()=>handleSourceSelect(source.id):void 0,children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,jsx_runtime.jsx)(DataWarehouseSourceIcon.Ug,{type:source.id,size:"small",disableTooltip:!0}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h5",{className:"font-medium text-sm",children:source.id}),!source.isAvailable&&(0,jsx_runtime.jsx)("span",{className:"text-xs text-warning bg-warning-light p-1 rounded-full",children:"Coming Soon"}),source.isConnected&&(0,jsx_runtime.jsx)("span",{className:"text-xs text-white p-1 rounded-full",style:{backgroundColor:"var(--primary-3000)"},children:"Connected"})]})]}),(0,jsx_runtime.jsx)("p",{className:"text-xs text-muted-alt",children:source.description})]},source.id))}),(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>setCurrentView("overview"),children:"Cancel"})})]})}),"add-source"===currentView&&selectedSource&&(0,jsx_runtime.jsx)(src.Mi,{hoverEffect:!1,children:(0,jsx_runtime.jsx)(NewSourceWizard.NewSourcesWizard,{onComplete:()=>{setCurrentView("overview"),setSelectedSource(null)},allowedSources:revenueSources.map(source=>source.id),initialSource:selectedSource})}),(0,jsx_runtime.jsx)("div",{className:"text-center",children:(0,jsx_runtime.jsxs)("p",{className:"text-xs text-muted-alt",children:["Need help? Check our"," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/revenue-analytics",target:"_blank",children:"documentation"})]})}),showEventModal&&(0,jsx_runtime.jsx)(EventConfigurationModal.e,{onClose:()=>{setShowEventModal(!1)}})]})}let Onboarding=_ref=>{let{initialSetupView,closeOnboarding}=_ref;return(0,jsx_runtime.jsxs)("div",{className:"space-y-6",children:[(0,jsx_runtime.jsx)(ProductIntroduction.C,{isEmpty:!0,productName:scenes.lc[sceneTypes.x.RevenueAnalytics].name||"",productKey:RevenueAnalyticsScene.PRODUCT_KEY,thingName:RevenueAnalyticsScene.PRODUCT_THING_NAME,description:scenes.lc[sceneTypes.x.RevenueAnalytics].description||"",titleOverride:"Get started with Revenue Analytics"}),(0,jsx_runtime.jsx)(InlineSetup,{initialSetupView:initialSetupView,closeOnboarding:closeOnboarding})]})}},"../../products/revenue_analytics/frontend/RevenueAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PRODUCT_KEY:()=>PRODUCT_KEY,PRODUCT_THING_NAME:()=>PRODUCT_THING_NAME,RevenueAnalyticsScene:()=>RevenueAnalyticsScene,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes=__webpack_require__("../../frontend/src/scenes/scenes.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),SceneDivider=__webpack_require__("../../frontend/src/layout/scenes/components/SceneDivider.tsx"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),dataNodeCollectionLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeCollectionLogic.ts"),types=__webpack_require__("../../frontend/src/types.ts"),Onboarding=__webpack_require__("../../products/revenue_analytics/frontend/Onboarding/Onboarding.tsx"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.34.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),DateFilter_types=__webpack_require__("../../frontend/src/lib/components/DateFilter/types.ts"),FilterBar=__webpack_require__("../../frontend/src/lib/components/FilterBar.tsx"),PropertyFilters=__webpack_require__("../../frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),utils=__webpack_require__("../../frontend/src/lib/components/PropertyFilters/utils.ts"),TaxonomicFilter=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/TaxonomicFilter.tsx"),TaxonomicFilter_types=__webpack_require__("../../frontend/src/lib/components/TaxonomicFilter/types.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),lib_utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),BreakdownTag=__webpack_require__("../../frontend/src/scenes/insights/filters/BreakdownFilter/BreakdownTag.tsx"),MaxTool=__webpack_require__("../../frontend/src/scenes/max/MaxTool.tsx"),Reload=__webpack_require__("../../frontend/src/queries/nodes/DataNode/Reload.tsx"),revenueAnalyticsLogic=__webpack_require__("../../products/revenue_analytics/frontend/revenueAnalyticsLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let DATE_FILTER_DATE_OPTIONS=[{key:DateFilter_types.Q2,values:[]},{key:"Month to date",values:["mStart"],getFormattedDate:date=>date.startOf("m").format(lib_utils.zT),defaultInterval:"day"},{key:"This month",values:["mStart","mEnd"],getFormattedDate:date=>(0,lib_utils._Q)(date.startOf("m"),date.endOf("m")),defaultInterval:"day"},{key:"Last month",values:["-1mStart","-1mEnd"],getFormattedDate:date=>(0,lib_utils._Q)(date.subtract(1,"month").startOf("month"),date.subtract(1,"month").endOf("month")),defaultInterval:"day"},{key:"This year",values:["yStart","yEnd"],getFormattedDate:date=>(0,lib_utils._Q)(date.startOf("y"),date.endOf("y")),defaultInterval:"month"},{key:"Year to date",values:["yStart"],getFormattedDate:date=>(0,lib_utils._Q)(date.startOf("y"),date.endOf("y")),defaultInterval:"month"},{key:"Previous year",values:["-1yStart","-1yEnd"],getFormattedDate:date=>(0,lib_utils._Q)(date.subtract(1,"year").startOf("y"),date.subtract(1,"year").endOf("y")),defaultInterval:"month"},{key:"All time",values:["all"],defaultInterval:"month"}],DISPLAY_MODE_OPTIONS=[{value:"line",label:"Line chart",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconLineGraph,{})},{value:"area",label:"Area chart",icon:(0,jsx_runtime.jsx)(icons.Ii,{})},{value:"bar",label:"Bar chart",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGraph,{})}],RevenueAnalyticsFilters=()=>{let{dateFilter:{dateTo,dateFrom},insightsDisplayMode}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{setDates,setInsightsDisplayMode}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km);return(0,jsx_runtime.jsx)(FilterBar.f,{left:(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:dateFrom,dateTo:dateTo,onChange:setDates,dateOptions:DATE_FILTER_DATE_OPTIONS,size:"small"}),right:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.u,{title:"Refresh data",children:(0,jsx_runtime.jsx)(Reload.H,{iconOnly:!0})}),(0,jsx_runtime.jsx)(src.Yv,{value:insightsDisplayMode,onChange:setInsightsDisplayMode,options:DISPLAY_MODE_OPTIONS,size:"small"}),(0,jsx_runtime.jsx)(RevenueAnalyticsPropertyFilters,{})]})})},RevenueAnalyticsPropertyFilters=()=>{let{revenueAnalyticsFilter,breakdownProperties,dateFilter:{dateTo,dateFrom}}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{setRevenueAnalyticsFilters,setDates,setBreakdownProperties}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km),[displayFilters,setDisplayFilters]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(MaxTool.Z,{identifier:"filter_revenue_analytics",context:{current_filters:{date_from:dateFrom,date_to:dateTo,breakdown:breakdownProperties,properties:revenueAnalyticsFilter}},callback:toolOutput=>{setRevenueAnalyticsFilters(toolOutput.properties),setDates(toolOutput.date_from,toolOutput.date_to),setBreakdownProperties(toolOutput.breakdown)},initialMaxPrompt:"Show my revenue for ",suggestions:["Show my revenue from the last year","Show what my revenue is in France","Break down my revenue by product for the last year"],onMaxOpen:()=>setDisplayFilters(!1),children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,jsx_runtime.jsx)(src.J2,{visible:displayFilters,onClickOutside:()=>setDisplayFilters(!1),placement:"bottom",className:"max-w-200",overlay:(0,jsx_runtime.jsx)("div",{className:"p-2",children:(0,jsx_runtime.jsx)(PropertyFilters.t,{disablePopover:!0,taxonomicGroupTypes:[TaxonomicFilter_types.t.RevenueAnalyticsProperties],onChange:filters=>setRevenueAnalyticsFilters(filters.filter(utils.YN)),propertyFilters:revenueAnalyticsFilter,pageKey:"revenue-analytics",buttonSize:"small"})}),children:(0,jsx_runtime.jsx)(src.Jp,{"data-attr":"show-revenue-analytics-filters",icon:(0,jsx_runtime.jsx)(icons.Xd,{count:revenueAnalyticsFilter.length,showZero:!1,children:(0,jsx_runtime.jsx)(posthog_icons_es.IconFilter,{})}),type:"secondary",size:"small",onClick:()=>setDisplayFilters(displayFilters=>!displayFilters),children:"Filters"})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-1",children:[breakdownProperties.map(breakdown=>(0,jsx_runtime.jsx)(EditableBreakdownTag,{breakdown:breakdown},breakdown.property)),(0,jsx_runtime.jsx)(AddBreakdownButton,{})]})]})})},AddBreakdownButton=()=>{let[open,setOpen]=(0,react.useState)(!1),{breakdownProperties}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{addBreakdown}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km);return(0,jsx_runtime.jsx)(BreakdownPopover,{open:open,setOpen:setOpen,onSelect:breakdown=>addBreakdown(breakdown),children:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),"data-attr":"add-breakdown-button",onClick:()=>setOpen(!open),sideIcon:null,disabledReason:breakdownProperties.length>=2?"You can only have up to 2 breakdowns":void 0,size:"small",children:"Add breakdown"})})},EditableBreakdownTag=_ref=>{let{breakdown}=_ref,{removeBreakdown}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km);return(0,jsx_runtime.jsx)(BreakdownTag.d,{breakdown:breakdown.property,breakdownType:breakdown.type,onClose:()=>removeBreakdown(breakdown)})},BreakdownPopover=_ref2=>{let{open,setOpen,onSelect,children}=_ref2;return(0,jsx_runtime.jsx)(src.J2,{style:{minHeight:"200px"},overlay:(0,jsx_runtime.jsx)(TaxonomicFilter.I,{groupType:TaxonomicFilter_types.t.RevenueAnalyticsProperties,onChange:(_taxonomicGroup,value)=>{onSelect({property:value,type:"revenue_analytics"}),setOpen(!1)},taxonomicGroupTypes:[TaxonomicFilter_types.t.RevenueAnalyticsProperties]}),visible:open,onClickOutside:()=>setOpen(!1),children:children})};var revenueAnalyticsSettingsLogic=__webpack_require__("../../products/revenue_analytics/frontend/settings/revenueAnalyticsSettingsLogic.ts"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx");let QUERY_ID=revenueAnalyticsLogic.nf.GROSS_REVENUE,INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(QUERY_ID),loadPriority:QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},GrossRevenueTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),query=queries[QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...INSIGHT_PROPS,query},emptyStateHeading:"No gross revenue data available",emptyStateDetail:"Please try adjusting your query or filters. Also, make sure your revenue events are properly configured in the settings."}),[query]);return(0,jsx_runtime.jsx)(Query.A,{attachTo:revenueAnalyticsLogic.Km,query:query,readOnly:!0,context:context})},OverviewTile_QUERY_ID=revenueAnalyticsLogic.nf.OVERVIEW,OverviewTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(OverviewTile_QUERY_ID),loadPriority:OverviewTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},OverviewTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),query=queries[OverviewTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...OverviewTile_INSIGHT_PROPS,query}}),[query]);return(0,jsx_runtime.jsx)(Query.A,{attachTo:revenueAnalyticsLogic.Km,query:query,readOnly:!0,context:context})},MetricsTile_QUERY_ID=revenueAnalyticsLogic.nf.METRICS,MetricsTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(MetricsTile_QUERY_ID),loadPriority:MetricsTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},EMPTY_STATE_DETAIL_WITH_EVENTS=(0,jsx_runtime.jsxs)("span",{children:["Please try adjusting your query or filters. If you're using revenue events then make sure you've configured what the ",(0,jsx_runtime.jsx)("code",{children:"subscription_id"})," property is to properly track subscriptions/customer churn metrics."]}),MetricsTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{events}=(0,index_esm.useValues)(revenueAnalyticsSettingsLogic.m),query=queries[MetricsTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...MetricsTile_INSIGHT_PROPS,query},emptyStateHeading:"No data available",emptyStateDetail:events.length>0?EMPTY_STATE_DETAIL_WITH_EVENTS:"Please try adjusting your query or filters."}),[query,events.length]);return(0,jsx_runtime.jsx)(Query.A,{attachTo:revenueAnalyticsLogic.Km,query:query,readOnly:!0,context:context})},MRRTile_QUERY_ID=revenueAnalyticsLogic.nf.MRR,MRRTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(MRRTile_QUERY_ID),loadPriority:MRRTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},MRRTile_EMPTY_STATE_DETAIL_WITH_EVENTS=(0,jsx_runtime.jsxs)("span",{children:["Please try adjusting your query or filters. If you're using revenue events then make sure you've configured what the ",(0,jsx_runtime.jsx)("code",{children:"subscription_id"})," property is to properly track subscriptions/MRR."]}),MRRTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{events}=(0,index_esm.useValues)(revenueAnalyticsSettingsLogic.m),query=queries[MRRTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...MRRTile_INSIGHT_PROPS,query},emptyStateHeading:"No MRR data available",emptyStateDetail:events.length>0?MRRTile_EMPTY_STATE_DETAIL_WITH_EVENTS:"Please try adjusting your query or filters."}),[query,events.length]);return(0,jsx_runtime.jsx)(Query.A,{attachTo:revenueAnalyticsLogic.Km,query:query,readOnly:!0,context:context})};var geography_currency=__webpack_require__("../../frontend/src/lib/utils/geography/currency.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx");let TopCustomersTile_QUERY_ID=revenueAnalyticsLogic.nf.TOP_CUSTOMERS,TopCustomersTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(TopCustomersTile_QUERY_ID),loadPriority:TopCustomersTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},TopCustomersTile=()=>{let{baseCurrency}=(0,index_esm.useValues)(teamLogic.teamLogic),{queries,topCustomersDisplayMode,disabledGrowthModeSelection}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{setTopCustomersDisplayMode}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km),query=queries[TopCustomersTile_QUERY_ID],columns=(0,react.useMemo)(()=>({name:{title:"Name"},customer_id:{title:(0,jsx_runtime.jsxs)("span",{children:["Customer ID"," ",(0,jsx_runtime.jsx)(src.u,{title:"As seen in your Data Warehouse",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]})},month:{title:" ",width:"0px",render:()=>null},amount:{title:"Amount",render:_ref=>{let{value}=_ref;return(0,jsx_runtime.jsx)(AmountCell,{value:value,currency:baseCurrency})}}}),[baseCurrency]),context=(0,react.useMemo)(()=>({columns,insightProps:{...TopCustomersTile_INSIGHT_PROPS,query}}),[columns,query]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,jsx_runtime.jsxs)("h3",{className:"text-lg font-semibold",children:["Top customers ",(0,jsx_runtime.jsx)(src.u,{title:"Top customers by revenue in the selected period.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]}),(0,jsx_runtime.jsx)(src.P4,{value:topCustomersDisplayMode,onChange:setTopCustomersDisplayMode,options:[{value:"line",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconLineGraph,{}),disabledReason:disabledGrowthModeSelection?"Select data that spans multiple months to see growth rate as a line graph":void 0},{value:"table",icon:(0,jsx_runtime.jsx)(icons.p$,{})}],size:"small"})]}),(0,jsx_runtime.jsx)(Query.A,{attachTo:revenueAnalyticsLogic.Km,query:query,readOnly:!0,context:context})]})},AmountCell=_ref2=>{let{value,currency}=_ref2,{symbol,isPrefix}=(0,geography_currency.jK)(currency);return(0,jsx_runtime.jsxs)("span",{children:[isPrefix?symbol:null,(0,lib_utils.Lc)(value,2,2),isPrefix?null:" "+symbol]})},scene={component:RevenueAnalyticsScene,logic:revenueAnalyticsLogic.Km,settingSectionId:"environment-revenue-analytics"},PRODUCT_KEY=types.Md.REVENUE_ANALYTICS,PRODUCT_THING_NAME="revenue source";function RevenueAnalyticsScene(){let{dataWarehouseSources}=(0,index_esm.useValues)(revenueAnalyticsSettingsLogic.m),{revenueEnabledDataWarehouseSources}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),sourceRunningForTheFirstTime=revenueEnabledDataWarehouseSources?.find(source=>"Running"===source.status&&!source.last_run_at);return null===dataWarehouseSources?(0,jsx_runtime.jsx)(src.t2,{sceneLevel:!0}):(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeCollectionLogic.y,props:{key:revenueAnalyticsLogic.hP},children:(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:scenes.lc[sceneTypes.x.RevenueAnalytics].name,description:scenes.lc[sceneTypes.x.RevenueAnalytics].description,resourceType:{type:scenes.lc[sceneTypes.x.RevenueAnalytics].iconType||"default"}}),(0,jsx_runtime.jsx)(SceneDivider.V,{}),(0,jsx_runtime.jsxs)(src.Vp,{type:"info",action:{children:"Send feedback",id:"revenue-analytics-feedback-button"},children:[(0,jsx_runtime.jsx)("p",{children:"Revenue Analytics is in beta. Please let us know what you'd like to see here and/or report any issues directly to us!"}),(0,jsx_runtime.jsx)("p",{children:"At this stage, Revenue Analytics is optimized for small/medium-sized companies. If you process more than 20,000 transactions/month you might have performance issues."}),(0,jsx_runtime.jsx)("p",{children:"Similarly, at this stage we're optimized for customers running on a subscription model (mostly SaaS). If you're running a business where your revenue is not coming from recurring payments, you might find Revenue analytics to be less useful/more empty than expected."})]}),sourceRunningForTheFirstTime&&(0,jsx_runtime.jsxs)(src.Vp,{type:"success",dismissKey:`revenue-analytics-sync-in-progress-banner-${sourceRunningForTheFirstTime.id}`,action:{children:"Refresh",onClick:()=>window.location.reload()},children:["One of your revenue data warehouse sources is running for the first time. ",(0,jsx_runtime.jsx)("br",{}),"This means you might not see all of your revenue data yet. ",(0,jsx_runtime.jsx)("br",{}),"We display partial data - most recent months first - while the initial sync is running. ",(0,jsx_runtime.jsx)("br",{}),"Refresh the page to see the latest data."]}),(0,jsx_runtime.jsx)(RevenueAnalyticsSceneContent,{})]})})}let RevenueAnalyticsSceneContent=()=>{let[isOnboarding,setIsOnboarding]=(0,react.useState)(!1),{hasRevenueTables,hasRevenueEvents}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km);return((0,react.useEffect)(()=>{isOnboarding||hasRevenueTables||hasRevenueEvents||setIsOnboarding(!0)},[hasRevenueTables,hasRevenueEvents,isOnboarding]),null===hasRevenueTables)?(0,jsx_runtime.jsx)(src.t2,{sceneLevel:!0}):!isOnboarding&&(hasRevenueTables||hasRevenueEvents)?(0,jsx_runtime.jsxs)("div",{className:(0,css_classes.cn)("RevenueAnalyticsDashboard -mt-2"),children:[(0,jsx_runtime.jsx)(RevenueAnalyticsFilters,{}),(0,jsx_runtime.jsx)(RevenueAnalyticsTables,{})]}):(0,jsx_runtime.jsx)(Onboarding.T,{closeOnboarding:()=>setIsOnboarding(!1)})},RevenueAnalyticsTables=()=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4 mt-4",children:[(0,jsx_runtime.jsx)(OverviewTile,{}),(0,jsx_runtime.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,jsx_runtime.jsx)(MRRTile,{}),(0,jsx_runtime.jsx)(GrossRevenueTile,{}),(0,jsx_runtime.jsx)(MetricsTile,{}),(0,jsx_runtime.jsx)(TopCustomersTile,{})]})]})}}]);