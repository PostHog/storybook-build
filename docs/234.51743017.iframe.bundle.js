(window.webpackJsonp=window.webpackJsonp||[]).push([[234,242],{"./frontend/src/lib/components/DropdownSelector/DropdownSelector.tsx":function(Z,O,e){"use strict";e.d(O,"a",function(){return p});var b=e("./node_modules/core-js/modules/es.symbol.js"),i=e("./node_modules/core-js/modules/es.symbol.description.js"),W=e("./node_modules/core-js/modules/es.array.find.js"),D=e("./node_modules/core-js/modules/es.array.map.js"),_=e("./node_modules/@babel/runtime/helpers/extends.js"),ie=e.n(_),k=e("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),$=e.n(k),o=e("./node_modules/antd/es/row/index.js"),R=e("./node_modules/antd/es/menu/index.js"),q=e("./node_modules/antd/es/dropdown/index.js"),z=e("./node_modules/clsx/dist/clsx.m.js"),J=e("./node_modules/react/index.js"),u=e.n(J),F=e("./frontend/src/lib/components/icons.tsx"),T=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),x=e.n(T),ee=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/lib/components/DropdownSelector/DropdownSelector.scss"),ce=e.n(ee),Q={};Q.insert="head",Q.singleton=!1;var pe=x()(ce.a,Q),fe=ce.a.locals||{};function v(a){var j=a.icon,C=a.label,M=a.description,A=a.onClick;return u.a.createElement("div",{onClick:A},u.a.createElement(o.a,{align:"middle"},j,u.a.createElement("div",{style:{fontSize:14,fontWeight:500,marginLeft:8}},C)),M&&u.a.createElement("div",{style:{fontSize:12,color:"rgba(0, 0, 0, 0.5)"}},M))}function p(a){var j=a.label,C=a.value,M=a.onValueChange,A=a.options,Y=a.hideDescriptionOnDisplay,te=a.disabled,f=a.compact,I=A.find(function(P){return P.key===C}),H=u.a.createElement(R.a,null,A.map(function(P){var N=P.key,oe=P.hidden,B=$()(P,["key","hidden"]);return oe?null:u.a.createElement(R.a.Item,{key:N},u.a.createElement(v,ie()({},B,{onClick:function(){return M(N)}})))}));return u.a.createElement(u.a.Fragment,null,j&&u.a.createElement("label",{className:"ant-form-item-label"},j),u.a.createElement(q.a,{overlay:H,trigger:["click"],disabled:te},u.a.createElement("div",{className:Object(z.a)("dropdown-selector",te&&" disabled",f&&"compact"),onClick:function(N){return N.preventDefault()}},u.a.createElement("div",{style:{flexGrow:1}},I&&u.a.createElement(v,ie()({},I,{onClick:function(){},description:Y?void 0:I.description}))),u.a.createElement("div",{className:"dropdown-arrow"},u.a.createElement(F.IconArrowDropDown,null)))))}try{p.displayName="DropdownSelector",p.__docgenInfo={description:"",displayName:"DropdownSelector",props:{label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string | null"}},onValueChange:{defaultValue:null,description:"",name:"onValueChange",required:!0,type:{name:"(value: string) => void"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"DropdownOption[]"}},hideDescriptionOnDisplay:{defaultValue:null,description:"",name:"hideDescriptionOnDisplay",required:!1,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},compact:{defaultValue:null,description:"",name:"compact",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/DropdownSelector/DropdownSelector.tsx#DropdownSelector"]={docgenInfo:p.__docgenInfo,name:"DropdownSelector",path:"frontend/src/lib/components/DropdownSelector/DropdownSelector.tsx#DropdownSelector"})}catch(a){}},"./frontend/src/scenes/cohorts/Cohort.tsx":function(Z,O,e){"use strict";e.r(O),e.d(O,"scene",function(){return ke}),e.d(O,"Cohort",function(){return ve});var b=e("./node_modules/core-js/modules/es.symbol.js"),i=e("./node_modules/core-js/modules/es.symbol.description.js"),W=e("./node_modules/core-js/modules/es.function.name.js"),D=e("./node_modules/@babel/runtime/helpers/extends.js"),_=e.n(D),ie=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),k=e.n(ie),$=e("./node_modules/react/index.js"),o=e.n($),R=e("./node_modules/kea/lib/index.esm.js"),q=e("./node_modules/antd/es/input/index.js");function z(r){var n=r.input,t=r.onChange;return o.a.createElement(o.a.Fragment,null,o.a.createElement("label",{className:"ant-form-item-label",htmlFor:"cohort-name"},"Name"),o.a.createElement(q.a,{required:!0,autoFocus:!0,placeholder:"Name your cohort",value:n||"","data-attr":"cohort-name",onChange:function(d){return t(d.target.value)},id:"cohort-name",className:"ph-ignore-input"}))}try{z.displayName="CohortNameInput",z.__docgenInfo={description:"",displayName:"CohortNameInput",props:{input:{defaultValue:null,description:"",name:"input",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(input: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortNameInput.tsx#CohortNameInput"]={docgenInfo:z.__docgenInfo,name:"CohortNameInput",path:"frontend/src/scenes/cohorts/CohortNameInput.tsx#CohortNameInput"})}catch(r){}function J(r){var n=r.description,t=r.onChange;return o.a.createElement(o.a.Fragment,null,o.a.createElement("label",{className:"ant-form-item-label",htmlFor:"cohort-description"},"Description"),o.a.createElement(q.a.TextArea,{placeholder:"Add a useful description for other team members",value:n||"","data-attr":"cohort-description",id:"cohort-description",onChange:function(d){return t(d.target.value)},maxLength:1e3}))}try{J.displayName="CohortDescriptionInput",J.__docgenInfo={description:"",displayName:"CohortDescriptionInput",props:{description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(input: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortDescriptionInput.tsx#CohortDescriptionInput"]={docgenInfo:J.__docgenInfo,name:"CohortDescriptionInput",path:"frontend/src/scenes/cohorts/CohortDescriptionInput.tsx#CohortDescriptionInput"})}catch(r){}var u=e("./node_modules/antd/es/divider/index.js"),F=e("./node_modules/antd/es/row/index.js"),T=e("./node_modules/antd/es/col/index.js"),x=e("./node_modules/antd/es/tooltip/index.js"),ee=e("./node_modules/core-js/modules/es.array.concat.js"),ce=e("./node_modules/core-js/modules/es.array.filter.js"),Q=e("./node_modules/core-js/modules/es.array.map.js"),pe=e("./node_modules/core-js/modules/es.object.to-string.js"),fe=e("./node_modules/core-js/modules/es.regexp.to-string.js"),v=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),p=e.n(v),a=e("./frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/MatchCriteriaSelector.tsx"),j=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),C=e("./frontend/src/lib/constants.tsx");function M(r,n){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);n&&(s=s.filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable})),t.push.apply(t,s)}return t}function A(r){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?M(Object(t),!0).forEach(function(s){k()(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):M(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}function Y(r){var n=r.logic,t=Object(R.useActions)(n),s=t.setCohort,d=t.onCriteriaChange,E=Object(R.useValues)(n),h=E.cohort,S=E.submitted,g=function(){s(A(A({},h),{},{groups:[].concat(p()(h.groups),[{id:Math.random().toString().substr(2,5),matchType:C.p,properties:[]}])}))},l=function(m){s(A(A({},h),{},{groups:h.groups.filter(function(V,le){return le!==m})}))},y=o.a.createElement("div",{style:{marginTop:8,marginBottom:8}},o.a.createElement("a",{href:"#add",style:{padding:0},onClick:function(){return g()},"data-attr":"add-match-criteria"},o.a.createElement(j.a,null)," Add matching criteria"));return o.a.createElement(T.a,null,o.a.createElement("h3",{className:"l3"},"Matching Criteria"),o.a.createElement("div",{className:"mb"},"Users who match the following criteria will be part of the cohort. Continuously updated automatically."),o.a.createElement("div",null,h.groups.map(function(L,m){return o.a.createElement(o.a.Fragment,{key:m},o.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}},o.a.createElement(a.b,{onCriteriaChange:function(le){return d(le,L.id)},onRemove:function(){return l(m)},group:L,showErrors:S}),m<h.groups.length-1&&o.a.createElement("div",{className:"stateful-badge or mt mb"},"OR")))})),o.a.createElement("span",{id:"add"}),y)}try{Y.displayName="CohortMatchingCriteriaSection",Y.__docgenInfo={description:"",displayName:"CohortMatchingCriteriaSection",props:{logic:{defaultValue:null,description:"",name:"logic",required:!0,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/CohortMatchingCriteriaSection.tsx#CohortMatchingCriteriaSection"]={docgenInfo:Y.__docgenInfo,name:"CohortMatchingCriteriaSection",path:"frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/CohortMatchingCriteriaSection.tsx#CohortMatchingCriteriaSection"})}catch(r){}try{CohortMatchingCriteriaSection.displayName="CohortMatchingCriteriaSection",CohortMatchingCriteriaSection.__docgenInfo={description:"",displayName:"CohortMatchingCriteriaSection",props:{logic:{defaultValue:null,description:"",name:"logic",required:!0,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/index.tsx#CohortMatchingCriteriaSection"]={docgenInfo:CohortMatchingCriteriaSection.__docgenInfo,name:"CohortMatchingCriteriaSection",path:"frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/index.tsx#CohortMatchingCriteriaSection"})}catch(r){}var te=e("./frontend/src/types.ts"),f=e("./node_modules/@ant-design/icons/es/icons/OrderedListOutlined.js"),I=e("./node_modules/@ant-design/icons/es/icons/CalculatorOutlined.js"),H=e("./node_modules/@ant-design/icons/es/icons/InboxOutlined.js"),P=e("./node_modules/antd/lib/upload/Dragger.js"),N=e.n(P),oe=e("./frontend/src/lib/components/ProfilePicture/index.ts");function B(r){var n=r.person;return o.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},n?o.a.createElement(o.a.Fragment,null,o.a.createElement(oe.a,{name:n==null?void 0:n.first_name,email:n==null?void 0:n.email,size:"md"}),o.a.createElement("span",{style:{marginLeft:4}},(n==null?void 0:n.first_name)||(n==null?void 0:n.email))):o.a.createElement("span",{className:"text-muted"},"Unknown"))}try{B.displayName="TeamMemberID",B.__docgenInfo={description:"",displayName:"TeamMemberID",props:{person:{defaultValue:null,description:"",name:"person",required:!1,type:{name:"UserBasicType | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/TeamMemberID.tsx#TeamMemberID"]={docgenInfo:B.__docgenInfo,name:"TeamMemberID",path:"frontend/src/lib/components/TeamMemberID.tsx#TeamMemberID"})}catch(r){}var U=e("./frontend/src/lib/dayjs.ts");function w(r){var n=r.cohort,t=12;return o.a.createElement(F.a,{justify:"space-between",align:"top",className:"mt text-center"},o.a.createElement(T.a,{span:t},o.a.createElement("label",{className:"ant-form-item-label"},"Created at"),o.a.createElement("div",null,Object(U.a)(n.created_at).fromNow())),o.a.createElement(T.a,{span:t},o.a.createElement("label",{className:"ant-form-item-label"},"Created by"),o.a.createElement("div",null,o.a.createElement(B,{person:n.created_by}))),o.a.createElement(T.a,{span:t},o.a.createElement("label",{className:"ant-form-item-label"},"Last calculated at"),o.a.createElement("div",null,n.last_calculation?Object(U.a)(n.last_calculation).fromNow():"in progress")))}try{w.displayName="CohortDetailsRow",w.__docgenInfo={description:"",displayName:"CohortDetailsRow",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!0,type:{name:"CohortType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortDetailsRow.tsx#CohortDetailsRow"]={docgenInfo:w.__docgenInfo,name:"CohortDetailsRow",path:"frontend/src/scenes/cohorts/CohortDetailsRow.tsx#CohortDetailsRow"})}catch(r){}var se=e("./frontend/src/scenes/persons/Persons.tsx"),de=e("./node_modules/core-js/modules/es.array.find-index.js"),X=e("./node_modules/core-js/modules/es.array.iterator.js"),K=e("./node_modules/core-js/modules/es.number.constructor.js"),Ee=e("./node_modules/core-js/modules/es.object.entries.js"),be=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Ke=e("./node_modules/@babel/runtime/regenerator/index.js"),ue=e.n(Ke),Ve=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),Fe=e.n(Ve),tt=e("./node_modules/regenerator-runtime/runtime.js"),Ue=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),Oe=e.n(Ue),Se=e("./frontend/src/lib/api.ts"),ge=e("./frontend/src/models/cohortsModel.ts"),we=e("./frontend/src/lib/utils.tsx"),Ge=e("./frontend/src/scenes/persons/personsLogic.ts"),Pe=e("./frontend/src/lib/components/lemonToast.tsx"),De=e("./frontend/src/scenes/urls.ts"),We=e("./node_modules/kea-router/lib/index.js");function Ye(r,n){var t;if(typeof Symbol=="undefined"||r[Symbol.iterator]==null){if(Array.isArray(r)||(t=He(r))||n&&r&&typeof r.length=="number"){t&&(r=t);var s=0,d=function(){};return{s:d,n:function(){return s>=r.length?{done:!0}:{done:!1,value:r[s++]}},e:function(l){throw l},f:d}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E=!0,h=!1,S;return{s:function(){t=r[Symbol.iterator]()},n:function(){var l=t.next();return E=l.done,l},e:function(l){h=!0,S=l},f:function(){try{!E&&t.return!=null&&t.return()}finally{if(h)throw S}}}}function He(r,n){if(!!r){if(typeof r=="string")return xe(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xe(r,n)}}function xe(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,s=new Array(n);t<n;t++)s[t]=r[t];return s}function Ae(r,n){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);n&&(s=s.filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable})),t.push.apply(t,s)}return t}function ne(r){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?Ae(Object(t),!0).forEach(function(s){k()(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Ae(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}var Ie={id:"new",groups:[{id:Math.random().toString().substr(2,5),matchType:C.p,properties:[]}]};function $e(r){return ne(ne({},r),{},{id:void 0,matchType:void 0})}function ze(r){return ne({matchType:Je(r),id:Math.random().toString().substr(2,5)},r)}function Je(r){return r.action_id||r.event_id?C.g:C.p}function je(r){return r.groups&&(r.groups=r.groups.map(function(n){return ze(n)}),r.groups=r.groups.map(function(n){return n.properties?ne(ne({},n),{},{properties:Object(we.s)(n.properties)}):n})),r}var Le=Object(R.kea)({props:{},key:function(n){var t;return(t=n.id==="new"?"new-".concat(n.pageKey):n.id)!==null&&t!==void 0?t:"new"},path:function(n){return["scenes","cohorts","cohortLogic",n]},connect:[ge.a],actions:function(){return{saveCohort:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return{cohortParams:t,filterParams:s}},setCohort:function(t){return{cohort:t}},deleteCohort:!0,onCriteriaChange:function(t,s){return{newGroup:t,id:s}},fetchCohort:function(t){return{cohort:t}},setPollTimeout:function(t){return{pollTimeout:t}},setLastSavedAt:function(t){return{lastSavedAt:t}},checkIfFinishedCalculating:function(t){return{cohort:t}},setSubmitted:function(t){return{submitted:t}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(t,s){var d=s.pollTimeout;return d}}],cohort:[je(Ie),{setCohort:function(t,s){var d=s.cohort;return je(d)},onCriteriaChange:function(t,s){var d=s.newGroup,E=s.id,h=ne({},t),S=h.groups.findIndex(function(g){return g.id===E});return d.matchType?h.groups[S]=ne({id:h.groups[S].id,matchType:C.g},d):h.groups[S]=ne(ne({},h.groups[S]),d),je(h)}}],lastSavedAt:[!1,{setLastSavedAt:function(t,s){var d=s.lastSavedAt;return d}}],submitted:[!1,{setSubmitted:function(t,s){var d=s.submitted;return d}}]}},selectors:{breadcrumbs:[function(r){return[r.cohort]},function(r){return[{name:"Cohorts",path:De.a.cohorts()}].concat(p()(r?[{name:r.name||"Untitled"}]:[]))}]},listeners:function(n){var t=n.actions,s=n.values,d=n.key;return{saveCohort:function(){var E=Oe()(ue.a.mark(function S(g,l){var y,L,m,V,le,ye,Ce,me,re,G,Ne,Te,he,Be;return ue.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:y=g.cohortParams,L=g.filterParams,m=ne(ne({},s.cohort),y),V=new FormData,le=0,ye=Object.entries(m);case 4:if(!(le<ye.length)){c.next=42;break}if(Ce=Fe()(ye[le],2),me=Ce[0],re=Ce[1],me!=="groups"){c.next=38;break}if(!m.is_static){c.next=13;break}if(!(!m.csv&&m.id==="new")){c.next=11;break}return t.setSubmitted(!0),c.abrupt("return");case 11:c.next=34;break;case 13:G=Ye(re),c.prev=14,G.s();case 16:if((Ne=G.n()).done){c.next=26;break}if(he=Ne.value,!(he.matchType===C.p&&!(!((Te=he.properties)===null||Te===void 0)&&Te.length))){c.next=21;break}return t.setSubmitted(!0),c.abrupt("return");case 21:if(!(he.matchType===C.g&&!(he.action_id||he.event_id))){c.next=24;break}return t.setSubmitted(!0),c.abrupt("return");case 24:c.next=16;break;case 26:c.next=31;break;case 28:c.prev=28,c.t0=c.catch(14),G.e(c.t0);case 31:return c.prev=31,G.f(),c.finish(31);case 34:Be=re.map(function(et){return $e(et)}),m.csv?V.append(me,"[]"):V.append(me,JSON.stringify(Be)),c.next=39;break;case 38:V.append(me,re);case 39:le++,c.next=4;break;case 42:if(c.prev=42,m.id==="new"){c.next=50;break}return c.next=46,Se.b.cohorts.update(m.id,V,L);case 46:m=c.sent,ge.a.actions.updateCohort(m),c.next=54;break;case 50:return c.next=52,Se.b.cohorts.create(V,L);case 52:m=c.sent,ge.a.actions.cohortCreated(m);case 54:c.next=60;break;case 56:return c.prev=56,c.t1=c.catch(42),Pe.a.error(c.t1.detail||"Failed to save cohort"),c.abrupt("return");case 60:t.setSubmitted(!1),m.is_calculating=!0,l(),delete m.csv,t.setCohort(m),Pe.a.success("Cohort saved. Please wait up to a few minutes for it to be calculated",{toastId:"cohort-saved-".concat(d)}),t.checkIfFinishedCalculating(m);case 67:case"end":return c.stop()}},S,null,[[14,28,31,34],[42,56]])}));function h(S,g){return E.apply(this,arguments)}return h}(),deleteCohort:function(){ge.a.actions.deleteCohort(s.cohort),We.router.actions.push(De.a.cohorts())},fetchCohort:function(){var E=Oe()(ue.a.mark(function S(g,l){var y;return ue.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return y=g.cohort,m.next=3,Se.b.cohorts.get(y.id);case 3:y=m.sent,l(),t.checkIfFinishedCalculating(y);case 6:case"end":return m.stop()}},S)}));function h(S,g){return E.apply(this,arguments)}return h}(),checkIfFinishedCalculating:function(){var E=Oe()(ue.a.mark(function S(g,l){var y,L;return ue.a.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:y=g.cohort,l(),y.is_calculating?t.setPollTimeout(setTimeout(function(){return t.fetchCohort(y)},1e3)):(t.setLastSavedAt(new Date().toISOString()),t.setCohort(y),ge.a.actions.updateCohort(y),(L=Ge.a.findMounted({syncWithUrl:!0}))===null||L===void 0||L.actions.loadCohorts(),s.pollTimeout&&(clearTimeout(s.pollTimeout),t.setPollTimeout(null)));case 3:case"end":return V.stop()}},S)}));function h(S,g){return E.apply(this,arguments)}return h}()}},events:function(n){var t=n.values,s=n.actions,d=n.props;return{afterMount:function(){var E=Oe()(ue.a.mark(function S(){var g;return ue.a.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(!d.id||d.id==="new")){y.next=4;break}s.setCohort(Ie),y.next=8;break;case 4:return y.next=6,Se.b.cohorts.get(Number(d.id));case 6:g=y.sent,s.setCohort(g);case 8:case"end":return y.stop()}},S)}));function h(){return E.apply(this,arguments)}return h}(),beforeUnmount:function(){t.pollTimeout&&clearTimeout(t.pollTimeout)}}}}),Qe=e("./frontend/src/lib/components/DropdownSelector/DropdownSelector.tsx"),Xe=e("./frontend/src/scenes/userLogic.ts"),nt=e("./node_modules/antd/lib/dropdown/style/index.css"),Ze=e("./frontend/src/lib/components/Spinner/Spinner.tsx"),Re=e("./frontend/src/lib/components/LemonButton/index.ts"),_e=e("./frontend/src/lib/components/PageHeader.tsx");function Me(r,n){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);n&&(s=s.filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable})),t.push.apply(t,s)}return t}function ae(r){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?Me(Object(t),!0).forEach(function(s){k()(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Me(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}var ke={component:ve,logic:Le,paramsToProps:function(n){var t=n.params.id;return{id:t&&t!=="new"?parseInt(t):"new",pageKey:0}}},qe=0;function ve(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=r.id,t=Object($.useMemo)(function(){return qe++},[n]),s=Le({pageKey:t,id:n}),d=Object(R.useActions)(s),E=d.setCohort,h=d.saveCohort,S=d.deleteCohort,g=Object(R.useValues)(s),l=g.cohort,y=g.submitted,L=Object(R.useValues)(Xe.a),m=L.hasAvailableFeature,V=function(G){E(ae(ae({},l),{},{description:G}))},le=function(G){G===C.c?E(ae(ae({},l),{},{is_static:!0})):G===C.b&&E(ae(ae({},l),{},{is_static:!1}))},ye={name:"file",multiple:!1,fileList:l.csv?[l.csv]:[],beforeUpload:function(G){return E(ae(ae({},l),{},{csv:G})),!1},accept:".csv"},Ce=[{key:C.c,label:"Static",description:"Upload a list of users. Updates manually",icon:o.a.createElement(f.a,null)},{key:C.b,label:"Dynamic",description:"Cohort updates dynamically based on properties",icon:o.a.createElement(I.a,null)}],me=function(){return o.a.createElement(Qe.a,{options:Ce,disabled:l.id!=="new",value:l.is_static?C.c:C.b,onValueChange:le})};return o.a.createElement("div",{className:"cohort"},o.a.createElement(_e.a,{title:l.id==="new"?"New cohort":l.name||"Untitled",buttons:o.a.createElement("div",{className:"flex-center"},l.id!=="new"&&o.a.createElement(Re.a,{"data-attr":"delete-cohort",status:"danger",type:"secondary",onClick:function(){S()},style:{marginRight:16}},"Delete"),o.a.createElement(Re.a,{type:"primary","data-attr":"save-cohort",htmlType:"submit",onClick:function(){h()}},"Save ",l.id==="new"?"cohort":"changes"))}),o.a.createElement(u.a,null),o.a.createElement(F.a,{gutter:16},o.a.createElement(T.a,{md:14},o.a.createElement(z,{input:l.name,onChange:function(G){return E(ae(ae({},l),{},{name:G}))}})),o.a.createElement(T.a,{md:10},l.id==="new"?me():o.a.createElement(x.a,{title:"Create a new cohort to use a different type of cohort."},o.a.createElement("div",null,me())))),m(te.c.DASHBOARD_COLLABORATION)&&o.a.createElement(F.a,{gutter:16,className:"mt"},o.a.createElement(T.a,{span:24},o.a.createElement(J,{description:l.description,onChange:V}))),l.id&&l.id!=="new"&&o.a.createElement(w,{cohort:l}),o.a.createElement(u.a,null),l.is_static?o.a.createElement("div",null,o.a.createElement("h3",{className:"l3"},"Add Users"),o.a.createElement("span",null,"Drop a ",o.a.createElement("pre",{style:{display:"inline"}},".csv")," file here to add users to your cohort"),o.a.createElement(N.a,_()({},ye,{className:"cohort-csv-dragger"}),o.a.createElement("p",{className:"ant-upload-drag-icon"},o.a.createElement(H.a,null)),o.a.createElement("div",null,o.a.createElement("p",{className:"ant-upload-text"},"Click or drag file to this area to upload"),o.a.createElement("p",{className:"ant-upload-hint"},"The CSV file only requires a single column with the user\u2019s distinct ID."),y&&!l.csv&&o.a.createElement("p",{style:{color:"var(--danger)",marginTop:16}},"You need to upload a CSV file.")))):o.a.createElement(Y,{logic:s}),l.id!=="new"&&o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,null),o.a.createElement("div",null,o.a.createElement("h3",{className:"l3"},"Matched Users"),o.a.createElement("span",null,"List of users that currently match the criteria defined"),l.is_calculating?o.a.createElement("div",{className:"cohort-recalculating flex-center"},o.a.createElement(Ze.a,{size:"sm",style:{marginRight:4}}),"We're recalculating who belongs to this cohort. This could take up to a couple of minutes."):o.a.createElement("div",{style:{marginTop:15}},o.a.createElement(se.Persons,{cohort:l})))))}try{ve.displayName="Cohort",ve.__docgenInfo={description:"",displayName:"Cohort",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:'number | "new"'}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/Cohort.tsx#Cohort"]={docgenInfo:ve.__docgenInfo,name:"Cohort",path:"frontend/src/scenes/cohorts/Cohort.tsx#Cohort"})}catch(r){}},"./frontend/src/scenes/groups/groupsListLogic.ts":function(Z,O,e){"use strict";e.d(O,"a",function(){return fe});var b=e("./node_modules/core-js/modules/es.array.concat.js"),i=e.n(b),W=e("./node_modules/core-js/modules/es.array.iterator.js"),D=e.n(W),_=e("./node_modules/core-js/modules/es.object.to-string.js"),ie=e.n(_),k=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),$=e.n(k),o=e("./node_modules/@babel/runtime/regenerator/index.js"),R=e.n(o),q=e("./node_modules/regenerator-runtime/runtime.js"),z=e.n(q),J=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),u=e.n(J),F=e("./node_modules/kea/lib/index.esm.js"),T=e("./frontend/src/lib/api.ts"),x=e("./frontend/src/lib/introductions/groupsAccessLogic.ts"),ee=e("./frontend/src/lib/utils.tsx"),ce=e("./frontend/src/scenes/teamLogic.ts"),Q=e("./frontend/src/scenes/urls.ts"),pe=e("./frontend/src/models/groupsModel.ts"),fe=Object(F.kea)({path:["groups","groupsListLogic"],connect:{values:[ce.a,["currentTeamId"],pe.a,["groupTypes","aggregationLabel"],x.b,["groupsEnabled"]]},actions:function(){return{loadGroups:function(a){return{url:a}},setTab:function(a){return{tab:a}}}},loaders:function(p){var a=p.values;return{groups:[{next:null,previous:null,results:[]},{loadGroups:function(){var j=u()(R.a.mark(function M(A){var Y;return R.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(Y=A.url,!a.groupsEnabled){f.next=6;break}return Y=Y||"api/projects/".concat(a.currentTeamId,"/groups/?group_type_index=").concat(a.currentTab),f.next=5,T.b.get(Y);case 5:return f.abrupt("return",f.sent);case 6:case"end":return f.stop()}},M)}));function C(M){return j.apply(this,arguments)}return C}()}]}},reducers:{currentTab:["-1",{setTab:function(p,a){var j=a.tab;return j}}]},selectors:{currentTabName:[function(v){return[v.currentTab,v.groupTypes,v.aggregationLabel]},function(v,p,a){return v==="-1"?"Persons":p!=null&&p.length?Object(ee.j)(a(parseInt(v)).singular):""}],breadcrumbs:[function(v){return[v.currentTabName,v.currentTab]},function(v,p){return[{name:v,path:Q.a.groups(p)}]}]},actionToUrl:function(){return{setTab:function(a){var j=a.tab;return j!=="-1"?Q.a.groups(j):Q.a.persons()}}},urlToAction:function(p){var a=p.actions,j=p.values;return{"/groups/:id":function(M){var A=M.id;A&&(a.setTab(A),a.loadGroups())},"/persons":function(){j.currentTab!=="-1"&&a.setTab("-1")}}}})},"./frontend/src/scenes/persons/PersonPageHeader.tsx":function(Z,O,e){"use strict";e.d(O,"a",function(){return u});var b=e("./node_modules/kea/lib/index.esm.js"),i=e("./frontend/src/lib/components/PageHeader.tsx"),W=e("./node_modules/react/index.js"),D=e.n(W),_=e("./node_modules/core-js/modules/es.array.includes.js"),ie=e("./node_modules/core-js/modules/es.array.map.js"),k=e("./node_modules/core-js/modules/es.string.includes.js"),$=e("./node_modules/antd/es/tabs/index.js"),o=e("./frontend/src/lib/introductions/groupsAccessLogic.ts"),R=e("./frontend/src/lib/utils.tsx"),q=e("./frontend/src/models/groupsModel.ts"),z=e("./frontend/src/scenes/groups/groupsListLogic.ts");function J(){var F=Object(b.useActions)(z.a),T=F.setTab,x=Object(b.useValues)(z.a),ee=x.currentTab,ce=Object(b.useValues)(q.a),Q=ce.groupTypes,pe=ce.aggregationLabel,fe=Object(b.useValues)(o.b),v=fe.groupsAccessStatus,p=[o.a.HasAccess,o.a.HasGroupTypes,o.a.NoAccess].includes(v);return D.a.createElement($.a,{activeKey:ee,onChange:function(j){return T(j)}},D.a.createElement($.a.TabPane,{tab:"Persons",key:"-1"}),p?D.a.createElement($.a.TabPane,{tab:"Introducing Group Analytics",key:"0"}):Q.map(function(a){return D.a.createElement($.a.TabPane,{tab:Object(R.j)(pe(a.group_type_index).plural),key:a.group_type_index})}))}function u(F){var T=F.hideGroupTabs,x=Object(b.useValues)(q.a),ee=x.showGroupsOptions;return D.a.createElement(D.a.Fragment,null,D.a.createElement(i.a,{title:"Persons".concat(ee?" & Groups":""),caption:"A catalog of your product's end users".concat(ee?" and groups":"",".")}),!T&&ee&&D.a.createElement(J,null))}try{u.displayName="PersonPageHeader",u.__docgenInfo={description:"",displayName:"PersonPageHeader",props:{hideGroupTabs:{defaultValue:null,description:"",name:"hideGroupTabs",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonPageHeader.tsx#PersonPageHeader"]={docgenInfo:u.__docgenInfo,name:"PersonPageHeader",path:"frontend/src/scenes/persons/PersonPageHeader.tsx#PersonPageHeader"})}catch(F){}},"./frontend/src/scenes/persons/Persons.scss":function(Z,O,e){"use strict";var b=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),i=e.n(b),W=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/persons/Persons.scss"),D=e.n(W),_={};_.insert="head",_.singleton=!1;var ie=i()(D.a,_),k=D.a.locals||{}},"./frontend/src/scenes/persons/Persons.tsx":function(Z,O,e){"use strict";e.r(O),e.d(O,"scene",function(){return Y}),e.d(O,"Persons",function(){return te});var b=e("./node_modules/react/index.js"),i=e.n(b),W=e("./node_modules/kea/lib/index.esm.js"),D=e("./node_modules/core-js/modules/es.array.concat.js"),_=e("./node_modules/core-js/modules/es.object.keys.js"),ie=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),k=e.n(ie),$=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),o=e("./frontend/src/lib/components/PropertiesTable.tsx"),R=e("./frontend/src/scenes/persons/Persons.scss"),q=e("./frontend/src/lib/components/CopyToClipboard.tsx"),z=e("./frontend/src/scenes/persons/PersonHeader.tsx"),J=e("./frontend/src/lib/components/LemonTable/index.ts");function u(f){var I=f.people,H=f.loading,P=H===void 0?!1:H,N=f.hasPrevious,oe=f.hasNext,B=f.loadPrevious,U=f.loadNext,w=f.compact,se=[{title:"Person",key:"person",render:function(X,K){return i.a.createElement(z.a,{withIcon:!0,person:K})}},{title:"ID",key:"id",render:function(X,K){return i.a.createElement("div",{style:{overflow:"hidden"}},K.distinct_ids.length&&i.a.createElement(q.a,{explicitValue:K.distinct_ids[0],iconStyle:{color:"var(--primary)"},description:"person distinct ID"},K.distinct_ids[0]))}}].concat(k()(w?[]:[{title:"First seen",dataIndex:"created_at",render:function(X){return X?i.a.createElement($.b,{time:X}):i.a.createElement(i.a.Fragment,null)}}]));return i.a.createElement(J.a,{columns:se,loading:P,rowKey:"id",pagination:{controlled:!0,pageSize:100,onForward:oe?function(){U==null||U(),window.scrollTo(0,0)}:void 0,onBackward:N?function(){B==null||B(),window.scrollTo(0,0)}:void 0},expandable:{expandedRowRender:function(X){var K=X.properties;return Object.keys(K).length?i.a.createElement(o.a,{properties:K}):"This person has no properties."}},dataSource:I,emptyState:"No persons",nouns:["person","persons"]})}try{u.displayName="PersonsTable",u.__docgenInfo={description:"",displayName:"PersonsTable",props:{people:{defaultValue:null,description:"",name:"people",required:!0,type:{name:"PersonType[]"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}},hasPrevious:{defaultValue:null,description:"",name:"hasPrevious",required:!1,type:{name:"boolean"}},hasNext:{defaultValue:null,description:"",name:"hasNext",required:!1,type:{name:"boolean"}},loadPrevious:{defaultValue:null,description:"",name:"loadPrevious",required:!1,type:{name:"(() => void)"}},loadNext:{defaultValue:null,description:"",name:"loadNext",required:!1,type:{name:"(() => void)"}},compact:{defaultValue:null,description:"",name:"compact",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonsTable.tsx#PersonsTable"]={docgenInfo:u.__docgenInfo,name:"PersonsTable",path:"frontend/src/scenes/persons/PersonsTable.tsx#PersonsTable"})}catch(f){}var F=e("./node_modules/antd/es/row/index.js"),T=e("./node_modules/antd/es/popconfirm/index.js"),x=e("./frontend/src/scenes/persons/personsLogic.ts"),ee=e("./node_modules/core-js/modules/es.regexp.exec.js"),ce=e("./node_modules/core-js/modules/es.string.search.js"),Q=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),pe=e.n(Q),fe=e("./node_modules/antd/es/input/index.js"),v=e("./frontend/src/lib/components/LemonRow/index.ts"),p=e("./frontend/src/lib/components/icons.tsx"),a=function(I){var H=I.autoFocus,P=H===void 0?!0:H,N=Object(W.useActions)(x.a),oe=N.loadPersons,B=N.setListFilters,U=Object(W.useValues)(x.a),w=U.listFilters,se=Object(b.useState)(""),de=pe()(se,2),X=de[0],K=de[1];return Object(b.useEffect)(function(){K(w.search||"")},[]),i.a.createElement("div",{style:{display:"flex",alignItems:"center",width:"min(100%, 24rem)"}},i.a.createElement(fe.a.Search,{"data-attr":"persons-search",placeholder:"Search for persons",autoFocus:P,value:X,onChange:function(be){K(be.target.value),be.target.value||(B({search:void 0}),oe())},enterButton:!0,allowClear:!0,onSearch:function(){B({search:X||void 0}),oe()},style:{width:"100%"}}),i.a.createElement(v.a,{className:"ml-05",type:"stealth",tooltip:i.a.createElement(i.a.Fragment,null,"Search by email, name, ID, or even contents of properties. You can also search for persons who just ",i.a.createElement("i",null,"have"),' a property like so: "has:your_property".'),icon:i.a.createElement(p.IconInfo,null)}))};try{a.displayName="PersonsSearch",a.__docgenInfo={description:"",displayName:"PersonsSearch",props:{autoFocus:{defaultValue:{value:"true"},description:"",name:"autoFocus",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"]={docgenInfo:a.__docgenInfo,name:"PersonsSearch",path:"frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"})}catch(f){}var j=e("./frontend/src/scenes/persons/PersonPageHeader.tsx"),C=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),M=e("./frontend/src/lib/components/TaxonomicFilter/types.ts"),A=e("./frontend/src/lib/components/LemonButton/index.ts"),Y={component:te,logic:x.a,paramsToProps:function(){return{syncWithUrl:!0}}};function te(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},I=f.cohort,H={cohort:I==null?void 0:I.id,syncWithUrl:!I},P=Object(W.useActions)(Object(x.a)(H)),N=P.loadPersons,oe=P.setListFilters,B=P.exportCsv,U=Object(W.useValues)(Object(x.a)(H)),w=U.persons,se=U.listFilters,de=U.personsLoading,X=U.exportUrl;return i.a.createElement(W.BindLogic,{logic:x.a,props:H},i.a.createElement("div",{className:"persons-list"},!I&&i.a.createElement(j.a,null),i.a.createElement(F.a,{align:"middle",justify:"space-between",className:"mb-05",style:{gap:"0.75rem"}},i.a.createElement(a,{autoFocus:!I}),i.a.createElement("div",null,i.a.createElement(T.a,{placement:"topRight",title:i.a.createElement(i.a.Fragment,null,"Exporting by csv is limited to 10,000 users.",i.a.createElement("br",null),"To return more, please use"," ",i.a.createElement("a",{href:"https://posthog.com/docs/api/persons"},"the API"),". Do you want to export by CSV?"),onConfirm:B},X&&i.a.createElement(A.a,{type:"secondary",icon:i.a.createElement(p.IconExport,{style:{color:"var(--primary)"}})},se.properties&&se.properties.length>0?i.a.createElement("div",{style:{display:"block"}},"Export (",i.a.createElement("strong",null,se.properties.length)," filter)"):"Export")))),i.a.createElement(C.a,{pageKey:"persons-list-page",propertyFilters:se.properties,onChange:function(Ee){oe({properties:Ee}),N()},endpoint:"person",taxonomicGroupTypes:[M.a.PersonProperties,M.a.Cohorts],showConditionBadge:!0}),i.a.createElement(u,{people:w.results,loading:de,hasPrevious:!!w.previous,hasNext:!!w.next,loadPrevious:function(){return N(w.previous)},loadNext:function(){return N(w.next)}})))}try{te.displayName="Persons",te.__docgenInfo={description:"",displayName:"Persons",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!1,type:{name:"CohortType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/Persons.tsx#Persons"]={docgenInfo:te.__docgenInfo,name:"Persons",path:"frontend/src/scenes/persons/Persons.tsx#Persons"})}catch(f){}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/lib/components/DropdownSelector/DropdownSelector.scss":function(Z,O,e){var b=e("./node_modules/css-loader/dist/runtime/api.js");O=b(!1),O.push([Z.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.dropdown-selector{padding:.5rem;border:1px solid rgba(0,0,0,.08);border-radius:4px;display:flex;align-items:center;cursor:pointer}.dropdown-selector.disabled{color:rgba(0,0,0,.5);cursor:not-allowed}.dropdown-selector.compact{padding:.3333333333rem .5rem}.dropdown-selector .dropdown-arrow{display:flex;align-items:center;padding-left:4px;font-size:1.2em;color:#747ea1}",""]),Z.exports=O},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/persons/Persons.scss":function(Z,O,e){var b=e("./node_modules/css-loader/dist/runtime/api.js");O=b(!1),O.push([Z.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.extra-ids{display:inline-flex;align-items:center;height:1.25rem;line-height:1.125rem;margin:0 0 0 .25rem;padding:0 .25rem 0 .375rem;color:#5375ff;cursor:pointer}.extra-ids svg{margin-left:.25rem}",""]),Z.exports=O}}]);
