(window.webpackJsonp=window.webpackJsonp||[]).push([[5,9,10,309],{"./frontend/src/scenes/apps/AppMetricsGraph.scss":function(A,E,e){"use strict";e.r(E);var D=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),v=e.n(D),O=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss"),r=e.n(O),b={};b.insert="head",b.singleton=!1;var _=v()(r.a,b);E.default=r.a.locals||{}},"./frontend/src/scenes/apps/AppMetricsGraph.tsx":function(A,E,e){"use strict";e.r(E),e.d(E,"AppMetricsGraph",function(){return h});var D=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),v=e.n(D),O=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),r=e.n(O),b=e("./node_modules/core-js/modules/es.array.concat.js"),_=e.n(b),B=e("./node_modules/core-js/modules/es.object.keys.js"),Q=e.n(B),F=e("./node_modules/core-js/modules/es.symbol.js"),X=e.n(F),S=e("./node_modules/core-js/modules/es.array.filter.js"),w=e.n(S),G=e("./node_modules/core-js/modules/es.object.to-string.js"),k=e.n(G),H=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),q=e.n(H),J=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),ee=e.n(J),N=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),se=e.n(N),K=e("./node_modules/react/index.js"),re=e.n(K),$=e("./frontend/src/lib/colors.ts"),V=e("./node_modules/chart.js/dist/chart.mjs"),M=e("./frontend/src/scenes/apps/constants.tsx"),W=e("./frontend/src/lib/components/LemonSkeleton/index.tsx"),te=e("./frontend/src/scenes/apps/AppMetricsGraph.scss"),g=e("./frontend/src/lib/utils.tsx"),P=e("./node_modules/react/jsx-runtime.js"),U=e.n(P);function C(d,u){var a=Object.keys(d);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(d);u&&(f=f.filter(function(T){return Object.getOwnPropertyDescriptor(d,T).enumerable})),a.push.apply(a,f)}return a}function x(d){for(var u=1;u<arguments.length;u++){var a=arguments[u]!=null?arguments[u]:{};u%2?C(Object(a),!0).forEach(function(f){v()(d,f,a[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(a)):C(Object(a)).forEach(function(f){Object.defineProperty(d,f,Object.getOwnPropertyDescriptor(a,f))})}return d}function h(d){var u=d.tab,a=d.metrics,f=d.metricsLoading,T=Object(K.useRef)(null),L=M.DescriptionColumns[u];return Object(K.useEffect)(function(){var y;if(T.current&&a){var t;y=new V.a((t=T.current)===null||t===void 0?void 0:t.getContext("2d"),{type:"line",data:{labels:a.dates,datasets:[x({label:L.successes,data:a.successes,borderColor:""},I("data-brand-blue"))].concat(r()(L.successes_on_retry?[x({label:L.successes_on_retry,data:a.successes_on_retry},I("data-yellow"))]:[]),[x({label:L.failures,data:a.failures},I("data-vermilion"))])},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}})}return function(){var o;(o=y)===null||o===void 0||o.destroy()}},[a]),f||!a?Object(P.jsx)(W.a,{className:"AppMetricsGraph border rounded p-6"}):Object(P.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:Object(P.jsx)("canvas",{ref:T})})}function I(d){var u=Object($.b)(d);return{borderColor:u,hoverBorderColor:Object(g.lb)(u,-20),hoverBackgroundColor:Object(g.lb)(u,-20),backgroundColor:u,fill:!1,borderWidth:2,pointRadius:0}}try{h.displayName="AppMetricsGraph",h.__docgenInfo={description:"",displayName:"AppMetricsGraph",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"processEvent"'},{value:'"onEvent"'},{value:'"exportEvents"'},{value:'"scheduledTask"'},{value:'"historical_exports"'}]}},metrics:{defaultValue:null,description:"",name:"metrics",required:!1,type:{name:"AppMetrics | null"}},metricsLoading:{defaultValue:null,description:"",name:"metricsLoading",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"]={docgenInfo:h.__docgenInfo,name:"AppMetricsGraph",path:"frontend/src/scenes/apps/AppMetricsGraph.tsx#AppMetricsGraph"})}catch(d){}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(A,E,e){"use strict";e.r(E),e.d(E,"AppMetricsTab",function(){return a}),e.d(E,"appMetricsSceneLogic",function(){return L});var D=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),v=e.n(D),O=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),r=e.n(O),b=e("./node_modules/@babel/runtime/regenerator/index.js"),_=e.n(b),B=e("./node_modules/core-js/modules/es.array.iterator.js"),Q=e.n(B),F=e("./node_modules/core-js/modules/es.object.to-string.js"),X=e.n(F),S=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),w=e.n(S),G=e("./node_modules/core-js/modules/es.array.concat.js"),k=e.n(G),H=e("./node_modules/core-js/modules/es.function.name.js"),q=e.n(H),J=e("./node_modules/core-js/modules/es.array.filter.js"),ee=e.n(J),N=e("./node_modules/core-js/modules/es.array.includes.js"),se=e.n(N),K=e("./node_modules/core-js/modules/es.string.includes.js"),re=e.n(K),$=e("./node_modules/core-js/modules/es.number.constructor.js"),V=e.n($),M=e("./node_modules/kea/lib/index.esm.js"),W=e("./node_modules/kea-loaders/lib/index.js"),te=e.n(W),g=e("./frontend/src/scenes/urls.ts"),P=e("./frontend/src/lib/api.ts"),U=e("./frontend/src/scenes/teamLogic.tsx"),C=e("./node_modules/kea-router/lib/index.js"),x=e.n(C),h=e("./frontend/src/lib/utils.tsx"),I=e("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),d=e("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),u=e("./frontend/src/lib/dayjs.ts"),a;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.ScheduledTask="scheduledTask",t.HistoricalExports="historical_exports"})(a||(a={}));var f="-30d",T=[a.ProcessEvent,a.OnEvent,a.ExportEvents,a.ScheduledTask],L=Object(M.kea)([Object(M.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(M.props)({}),Object(M.key)(function(t){return t.pluginConfigId}),Object(M.actions)({setActiveTab:function(o){return{tab:o}},setDateFrom:function(o){return{dateFrom:o}},openErrorDetailsModal:function(o,n,s){return{errorType:o,category:n,jobId:s}},closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),Object(M.reducers)({activeTab:[null,{setActiveTab:function(o,n){var s=n.tab;return s}}],selectedDateFrom:[null,{setDateFrom:function(o,n){var s=n.dateFrom;return s}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(o,n){var s=n.errorType;return s},closeErrorDetailsModal:function(){return null}}]}),Object(W.loaders)(function(t){var o=t.values,n=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var s=r()(_.a.mark(function l(){return _.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,P.b.get("api/projects/".concat(U.a.values.currentTeamId,"/plugin_configs/").concat(n.pluginConfigId));case 2:return p.abrupt("return",p.sent);case 3:case"end":return p.stop()}},l)}));function c(){return s.apply(this,arguments)}return c}()}],appMetricsResponse:[null,{loadMetrics:function(){var s=r()(_.a.mark(function l(){var i;return _.a.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!(o.activeTab&&o.dateFrom)){j.next=5;break}return i=Object(h.Eb)({category:o.activeTab,date_from:o.dateFrom}),j.next=4,P.b.get("api/projects/".concat(U.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"?").concat(i));case 4:return j.abrupt("return",j.sent);case 5:case"end":return j.stop()}},l)}));function c(){return s.apply(this,arguments)}return c}()}],historicalExports:[[],{loadHistoricalExports:function(){var s=r()(_.a.mark(function l(){var i,p;return _.a.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,P.b.get("api/projects/".concat(U.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/historical_exports"));case 2:return i=m.sent,p=i.results,m.abrupt("return",p);case 5:case"end":return m.stop()}},l)}));function c(){return s.apply(this,arguments)}return c}()}],errorDetails:[[],{openErrorDetailsModal:function(){var s=r()(_.a.mark(function l(i){var p,j,m,Y,Z,z;return _.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return p=i.category,j=i.jobId,m=i.errorType,Y=Object(h.Eb)({category:p,job_id:j,error_type:m}),R.next=4,P.b.get("api/projects/".concat(U.a.values.currentTeamId,"/app_metrics/").concat(n.pluginConfigId,"/error_details?").concat(Y));case 4:return Z=R.sent,z=Z.result,R.abrupt("return",z);case 7:case"end":return R.stop()}},l)}));function c(l){return s.apply(this,arguments)}return c}()}]}}),Object(M.selectors)(function(t){var o=t.values,n=t.actions;return{breadcrumbs:[function(s){return[s.pluginConfig,function(c,l){return l.pluginConfigId}]},function(s,c){var l;return[{name:"Apps",path:g.a.projectApps()},{name:s==null||(l=s.plugin_info)===null||l===void 0?void 0:l.name,path:g.a.appMetrics(c)}]}],defaultTab:[function(s){return[s.pluginConfig]},function(){return T.filter(function(s){return o.showTab(s)})[0]}],currentTime:[function(){return[]},function(){return Date.now()}],defaultDateFrom:[function(s){return[s.pluginConfig,s.currentTime]},function(s,c){if(!(s!=null&&s.created_at))return f;var l=u.a.utc(s.created_at),i=Object(u.a)(c).diff(l,"days",!0);return i<=1?"-24h":i<=7?"-7d":f}],dateFrom:[function(s){return[s.selectedDateFrom,s.defaultDateFrom]},function(s,c){var l;return(l=s!=null?s:c)!==null&&l!==void 0?l:f}],showTab:[function(){return[]},function(){return function(s){if(o.pluginConfigLoading||!o.pluginConfig||!o.pluginConfig.plugin_info.capabilities)return!1;var c=o.pluginConfig.plugin_info.capabilities,l=c.methods.includes("exportEvents");return s===a.HistoricalExports?l:s===a.OnEvent&&l?!1:s===a.ScheduledTask?!l&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(i){return c.scheduled_tasks.includes(i)}):c.methods.includes(s)}}],interfaceJobsProps:[function(s){return[s.pluginConfig]},function(s){return!s||!s.plugin_info.public_jobs||!(s!=null&&s.enabled)?null:{jobName:I.b,jobSpec:s.plugin_info.public_jobs[I.b],pluginConfigId:s.id,pluginId:s.plugin,onSubmit:n.loadHistoricalExports}}],hasRunningExports:[function(s){return[s.historicalExports]},function(s){return s.some(function(c){return c.status=="not_finished"})}]}}),Object(M.listeners)(function(t){var o=t.values,n=t.actions;return{loadPluginConfigSuccess:function(){o.activeTab||n.setActiveTab(o.defaultTab)},setActiveTab:function(c){var l=c.tab;l===a.HistoricalExports?n.loadHistoricalExports():n.loadMetrics()},setDateFrom:function(){n.loadMetrics()},openHistoricalExportModal:function(){o.interfaceJobsProps&&Object(d.a)(o.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}}),Object(C.actionToUrl)(function(t){var o=t.values,n=t.props;return{setActiveTab:function(){return y(o,n)},setDateFrom:function(){return y(o,n)},openErrorDetailsModal:function(){return y(o,n)},closeErrorDetailsModal:function(){return y(o,n)}}}),Object(C.urlToAction)(function(t){var o=t.values,n=t.actions,s=t.props;return{"/app/:pluginConfigId/:page":function(l,i){if(s.pluginConfigId===Number(l.pluginConfigId))if(o.pluginConfig||n.loadPluginConfig(),l.page===a.HistoricalExports)n.setActiveTab(a.HistoricalExports);else if(i.tab&&T.includes(i.tab)&&i.tab!==o.activeTab?n.setActiveTab(i.tab):o.defaultTab&&o.activeTab!==o.defaultTab&&n.setActiveTab(o.defaultTab),i.from&&o.selectedDateFrom!==i.from&&n.setDateFrom(i.from),i.error){var p=v()(i.error,2),j=p[0],m=p[1];o.errorDetailsModalError!==j&&(n.setActiveTab(m),n.openErrorDetailsModal(j,m))}else n.closeErrorDetailsModal()}}})]);function y(t,o){if(t.activeTab===a.HistoricalExports)return g.a.appHistoricalExports(o.pluginConfigId);var n={};return t.activeTab&&t.activeTab!==t.defaultTab&&(n.tab=t.activeTab),t.selectedDateFrom&&(n.from=t.selectedDateFrom),t.errorDetailsModalError&&t.activeTab&&(n.error=[t.errorDetailsModalError,t.activeTab]),g.a.appMetrics(o.pluginConfigId,n)}},"./frontend/src/scenes/apps/constants.tsx":function(A,E,e){"use strict";e.r(E),e.d(E,"DescriptionColumns",function(){return B});var D=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),v=e.n(D),O=e("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),r=e("./node_modules/react/jsx-runtime.js"),b=e.n(r),_,B=(_={},v()(_,O.AppMetricsTab.ProcessEvent,{successes:"Events processed",successes_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events were successfully processed and transformed by the ",Object(r.jsx)("i",{children:"processEvent"})," app method."]}),failures:"Failed events",failures_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events had errors when being processed by the ",Object(r.jsx)("i",{children:"processEvent"})," app method, but were still ingested."]})}),v()(_,O.AppMetricsTab.OnEvent,{successes:"Events processed",successes_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events were successfully processed by the ",Object(r.jsx)("i",{children:"onEvent"})," app method on the first try."]}),successes_on_retry:"Events processed on retry",successes_on_retry_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events were successfully processed by the ",Object(r.jsx)("i",{children:"onEvent"})," app method after being retried."]}),failures:"Failed events",failures_tooltip:Object(r.jsxs)(r.Fragment,{children:["These events had errors when being processed by the ",Object(r.jsx)("i",{children:"onEvent"})," app method."]})}),v()(_,O.AppMetricsTab.ExportEvents,{successes:"Events delivered",successes_tooltip:Object(r.jsx)(r.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:Object(r.jsx)(r.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:Object(r.jsx)(r.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})}),v()(_,O.AppMetricsTab.HistoricalExports,{successes:"Events delivered",successes_tooltip:Object(r.jsx)(r.Fragment,{children:"These events were successfully delivered to the configured destination on the first try."}),successes_on_retry:"Events delivered on retry",successes_on_retry_tooltip:Object(r.jsx)(r.Fragment,{children:"These events were successfully delivered to the configured destination after being retried."}),failures:"Failed events",failures_tooltip:Object(r.jsx)(r.Fragment,{children:"These events failed to be delivered to the configured destination due to errors."})}),v()(_,O.AppMetricsTab.ScheduledTask,{successes:"Successes",successes_tooltip:Object(r.jsxs)(r.Fragment,{children:["How many times ",Object(r.jsx)("i",{children:"runEveryMinute"}),", ",Object(r.jsx)("i",{children:"runEveryHour"})," or ",Object(r.jsx)("i",{children:"runEveryDay"})," was called successfully."]}),failures:"Failures",failures_tooltip:Object(r.jsxs)(r.Fragment,{children:["How many times ",Object(r.jsx)("i",{children:"runEveryMinute"}),", ",Object(r.jsx)("i",{children:"runEveryHour"})," or ",Object(r.jsx)("i",{children:"runEveryDay"})," failed due to errors."]})}),_)},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/apps/AppMetricsGraph.scss":function(A,E,e){var D=e("./node_modules/css-loader/dist/runtime/api.js");E=D(!1),E.push([A.i,".AppMetricsGraph{height:300px}",""]),A.exports=E}}]);
