"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[99303],{"./frontend/src/scenes/pipeline/PipelineNodeNew.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PipelineNodeNew:()=>PipelineNodeNew,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),LemonTableLink=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/LemonTableLink.tsx"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),destinationsLogic=__webpack_require__("./frontend/src/scenes/pipeline/destinationsLogic.tsx"),frontendAppsLogic=__webpack_require__("./frontend/src/scenes/pipeline/frontendAppsLogic.tsx"),PipelineNode=__webpack_require__("./frontend/src/scenes/pipeline/PipelineNode.tsx"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),sceneTypes=__webpack_require__("./frontend/src/scenes/sceneTypes.ts"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts");let NODE_STAGE_TO_PIPELINE_TAB={[types.We.Transformation]:types.J9.Transformations,[types.We.Destination]:types.J9.Destinations,[types.We.SiteApp]:types.J9.SiteApps},pipelineNodeNewLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.connect)({values:[userLogic.userLogic,["user"]]}),(0,index_esm.path)(pluginIdOrBatchExportDestination=>["scenes","pipeline","pipelineNodeNewLogic",pluginIdOrBatchExportDestination]),(0,index_esm.actions)({createNewButtonPressed:(stage,id)=>({stage,id})}),(0,index_esm.selectors)(()=>({breadcrumbs:[(_,p)=>[p.stage,p.pluginId,p.batchExportDestination],(stage,pluginId,batchDestination)=>[{key:sceneTypes.x.Pipeline,name:"Data pipeline",path:urls.j.pipeline()},{key:stage||"unknown",name:stage?(0,utils.fm)(NODE_STAGE_TO_PIPELINE_TAB[stage]||""):"Unknown",path:urls.j.pipeline(stage?NODE_STAGE_TO_PIPELINE_TAB[stage]:void 0)},{key:pluginId||batchDestination||"Unknown",name:pluginId?"New":batchDestination?`New ${batchDestination} destination`:"Options"}]],batchExportServiceNames:[s=>[s.user],user=>{let services=["BigQuery","Postgres","Redshift","Snowflake","S3"];return(user?.is_impersonated||user?.is_staff)&&services.push("HTTP"),services}]}))]);var transformationsLogic=__webpack_require__("./frontend/src/scenes/pipeline/transformationsLogic.tsx"),pipeline_types=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),pipeline_utils=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let paramsToProps=_ref=>{let{params:{stage,pluginIdOrBatchExportDestination}}=_ref,numericId=pluginIdOrBatchExportDestination&&/^\d+$/.test(pluginIdOrBatchExportDestination)?parseInt(pluginIdOrBatchExportDestination):void 0,pluginId=numericId&&!isNaN(numericId)?numericId:null,batchExportDestination=pluginId?null:null!=pluginIdOrBatchExportDestination?pluginIdOrBatchExportDestination:null;return{stage:PipelineNode.PIPELINE_TAB_TO_NODE_STAGE[stage+"s"]||null,pluginId:pluginId,batchExportDestination:batchExportDestination}},scene={component:PipelineNodeNew,logic:pipelineNodeNewLogic,paramsToProps};function convertPluginToTableEntry(plugin){return{backend:pipeline_types.b.Plugin,id:plugin.id,name:plugin.name,description:plugin.description||"",plugin:plugin,url:plugin.url}}function convertBatchExportToTableEntry(service){return{backend:pipeline_types.b.BatchExport,id:service,name:service,description:`${service} batch export`,url:(0,pipeline_utils.n1)(service)}}function PipelineNodeNew(){let params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stage,pluginId,batchExportDestination}=paramsToProps({params});return stage?pluginId?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Plugin ID ",pluginId]}):batchExportDestination?stage!==types.We.Destination?(0,jsx_runtime.jsx)(NotFound.T,{object:batchExportDestination}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Batch Export Destination ",batchExportDestination]}):stage===types.We.Transformation?(0,jsx_runtime.jsx)(TransformationOptionsTable,{}):stage===types.We.Destination?(0,jsx_runtime.jsx)(DestinationOptionsTable,{}):stage===types.We.SiteApp?(0,jsx_runtime.jsx)(SiteAppOptionsTable,{}):(0,jsx_runtime.jsx)(NotFound.T,{object:"pipeline new options"}):(0,jsx_runtime.jsx)(NotFound.T,{object:"pipeline app stage"})}function TransformationOptionsTable(){let{plugins,loading}=(0,index_esm.useValues)(transformationsLogic.P),targets=Object.values(plugins).map(convertPluginToTableEntry);return(0,jsx_runtime.jsx)(NodeOptionsTable,{stage:types.We.Transformation,targets:targets,loading:loading})}function DestinationOptionsTable(){let{batchExportServiceNames}=(0,index_esm.useValues)(pipelineNodeNewLogic),{plugins,loading}=(0,index_esm.useValues)(destinationsLogic.w),pluginTargets=Object.values(plugins).map(convertPluginToTableEntry),batchExportTargets=Object.values(batchExportServiceNames).map(convertBatchExportToTableEntry),targets=[...batchExportTargets,...pluginTargets];return(0,jsx_runtime.jsx)(NodeOptionsTable,{stage:types.We.Destination,targets:targets,loading:loading})}function SiteAppOptionsTable(){let{plugins,loading}=(0,index_esm.useValues)(frontendAppsLogic.$),targets=Object.values(plugins).map(convertPluginToTableEntry);return(0,jsx_runtime.jsx)(NodeOptionsTable,{stage:types.We.SiteApp,targets:targets,loading:loading})}function NodeOptionsTable(_ref2){let{stage,targets,loading}=_ref2;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:targets,size:"small",loading:loading,columns:[{title:"Name",sticky:!0,render:function RenderName(_,target){return(0,jsx_runtime.jsx)(LemonTableLink.i,{to:target.url,target:target.backend==pipeline_types.b.Plugin?"_blank":void 0,title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(Tooltip.u,{title:`Click to view ${target.backend==pipeline_types.b.Plugin?"source code":"documentation"}`,children:(0,jsx_runtime.jsx)("span",{children:target.name})})}),description:target.description})}},{title:"App",render:function RenderAppInfo(_,target){return target.backend===pipeline_types.b.Plugin?(0,jsx_runtime.jsx)(pipeline_utils.Wf,{plugin:target.plugin}):(0,jsx_runtime.jsx)(pipeline_utils.oe,{type:target.id})}},{title:"Actions",width:100,align:"right",render:function RenderActions(_,target){return(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary","data-attr":`new-${stage}-${target.id}`,to:urls.j.pipelineNodeNew(stage,target.id),children:"Create"})}}]})})}}}]);