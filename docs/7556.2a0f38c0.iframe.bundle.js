"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[7556],{"./frontend/src/scenes/dashboard/DashboardHeader.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{o:function(){return DASHBOARD_CANNOT_EDIT_MESSAGE},x:function(){return DashboardHeader}});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),EditableField=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js");function FullScreen(_ref){let{onExit:onExit}=_ref;const selector="aside.ant-layout-sider, .layout-top-content";return(0,react.useEffect)((()=>{const myClasses=window.document.querySelectorAll(selector);for(let i=0;i<myClasses.length;i++)myClasses[i].style.display="none";const handler=()=>{null===window.document.fullscreenElement&&onExit?.()};try{window.document.body.requestFullscreen().then((()=>{window.addEventListener("fullscreenchange",handler,!1)}))}catch{}try{window.dispatchEvent(new window.Event("scroll")),window.dispatchEvent(new window.Event("resize"))}catch{}return()=>{const elements=window.document.querySelectorAll(selector);for(let i=0;i<elements.length;i++)elements[i].style.display="block";try{window.removeEventListener("fullscreenchange",handler,!1),null!==window.document.fullscreenElement&&window.document.exitFullscreen()}catch{}try{window.dispatchEvent(new window.Event("scroll")),window.dispatchEvent(new window.Event("resize"))}catch{}}}),[]),null}try{FullScreen.displayName="FullScreen",FullScreen.__docgenInfo={description:"",displayName:"FullScreen",props:{onExit:{defaultValue:null,description:"",name:"onExit",required:!1,type:{name:"(() => any)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/FullScreen.tsx#FullScreen"]={docgenInfo:FullScreen.__docgenInfo,name:"FullScreen",path:"frontend/src/lib/components/FullScreen.tsx#FullScreen"})}catch(__react_docgen_typescript_loader_error){}var LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonDivider=__webpack_require__("./frontend/src/lib/lemon-ui/LemonDivider/index.ts"),ObjectTags=__webpack_require__("./frontend/src/lib/components/ObjectTags/ObjectTags.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),eventUsageLogic=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts"),dashboardsModel=__webpack_require__("./frontend/src/models/dashboardsModel.tsx"),types=__webpack_require__("./frontend/src/types.ts"),dashboardLogic=__webpack_require__("./frontend/src/scenes/dashboard/dashboardLogic.tsx"),DashboardCollaborators=__webpack_require__("./frontend/src/scenes/dashboard/DashboardCollaborators.tsx"),userLogic=__webpack_require__("./frontend/src/scenes/userLogic.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),ProfileBubbles=__webpack_require__("./frontend/src/lib/lemon-ui/ProfilePicture/ProfileBubbles.tsx"),dashboardCollaboratorsLogic=__webpack_require__("./frontend/src/scenes/dashboard/dashboardCollaboratorsLogic.ts"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),ExportButton=__webpack_require__("./frontend/src/lib/components/ExportButton/ExportButton.tsx"),SubscriptionsModal=__webpack_require__("./frontend/src/lib/components/Subscriptions/SubscriptionsModal.tsx"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),SharingModal=__webpack_require__("./frontend/src/lib/components/Sharing/SharingModal.tsx"),LemonSelect=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSelect/index.ts"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea_forms_lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js");const getTileBody=(dashboard,textTileId)=>{const dashboardTiles=dashboard.tiles,matchedTile=dashboardTiles?.find((tt=>tt.id===textTileId));return matchedTile?.text?.body||""},textCardModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","dashboard","dashboardTextTileModal","logic"]),(0,index_esm.props)({}),(0,index_esm.key)((props=>`textCardModalLogic-${props.dashboard.id}-${props.textTileId}`)),(0,index_esm.connect)({actions:[dashboardsModel.h,["updateDashboard"]]}),(0,index_esm.listeners)((_ref=>{let{props:props,actions:actions}=_ref;return{submitTextTileFailure:error=>{props.dashboard&&props.textTileId&&src.lemonToast.error(`Could not save text: ${error.error} (${JSON.stringify(error.errors)})`),actions.resetTextTile(),props?.onClose?.()},submitTextTileSuccess:()=>{actions.resetTextTile(),props?.onClose?.()}}})),(0,kea_forms_lib.forms)((_ref2=>{let{props:props,actions:actions}=_ref2;return{textTile:{defaults:{body:props.textTileId&&"new"!==props.textTileId?getTileBody(props.dashboard,props.textTileId):""},errors:_ref3=>{let{body:body}=_ref3;return{body:body?null:"This card would be empty! Type something first"}},submit:formValues=>{const textTiles=(props.dashboard.tiles||[]).map((t=>({id:t.id,text:t.text})));if("new"===props.textTileId)actions.updateDashboard({id:props.dashboard.id,tiles:[{text:formValues}]});else{const updatedTiles=[...textTiles].reduce(((acc,tile)=>(tile.id===props.textTileId&&tile.text&&(tile.text.body=formValues.body,acc.push(tile)),acc)),[]);actions.updateDashboard({id:props.dashboard.id,tiles:updatedTiles})}}}}}))]);var LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),LemonTextArea=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTextArea/LemonTextArea.tsx"),PayGateMini=__webpack_require__("./frontend/src/lib/components/PayGateMini/PayGateMini.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function TextCardModal(_ref){let{isOpen:isOpen,onClose:onClose,dashboard:dashboard,textTileId:textTileId}=_ref;const modalLogic=textCardModalLogic({dashboard:dashboard,textTileId:null!=textTileId?textTileId:"new",onClose:onClose}),{isTextTileSubmitting:isTextTileSubmitting,textTileValidationErrors:textTileValidationErrors}=(0,index_esm.useValues)(modalLogic),{submitTextTile:submitTextTile,resetTextTile:resetTextTile}=(0,index_esm.useActions)(modalLogic),{hasAvailableFeature:hasAvailableFeature}=(0,index_esm.useValues)(userLogic.userLogic),handleClose=()=>{resetTextTile(),onClose()};return(0,jsx_runtime.jsx)(LemonModal.f,{closable:!0,isOpen:isOpen,title:"",onClose:handleClose,footer:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.Jp,{disabledReason:isTextTileSubmitting?"Cannot cancel card creation in progress":null,type:"secondary",onClick:handleClose,children:"Cancel"}),hasAvailableFeature(types.P$.DASHBOARD_COLLABORATION)&&(0,jsx_runtime.jsx)(LemonButton.Jp,{disabledReason:textTileValidationErrors.body,loading:isTextTileSubmitting,form:"text-tile-form",htmlType:"submit",type:"primary",onClick:submitTextTile,"data-attr":"new"===textTileId?"save-new-text-tile":"edit-text-tile-text",children:"Save"})]}),children:(0,jsx_runtime.jsx)(kea_forms_lib.Form,{logic:textCardModalLogic,props:{dashboard:dashboard,textTileId:textTileId},formKey:"textTile",id:"text-tile-form",className:"",enableFormOnSubmit:!0,children:(0,jsx_runtime.jsx)(PayGateMini.E,{feature:types.P$.DASHBOARD_COLLABORATION,children:(0,jsx_runtime.jsx)(kea_forms_lib.Field,{name:"body",label:"",children:(0,jsx_runtime.jsx)(LemonTextArea.M,{"data-attr":"text-card-edit-area"})})})})})}try{TextCardModal.displayName="TextCardModal",TextCardModal.__docgenInfo={description:"",displayName:"TextCardModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},dashboard:{defaultValue:null,description:"",name:"dashboard",required:!0,type:{name:"DashboardType"}},textTileId:{defaultValue:null,description:"",name:"textTileId",required:!0,type:{name:'number | "new" | null'}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/Cards/TextCard/TextCardModal.tsx#TextCardModal"]={docgenInfo:TextCardModal.__docgenInfo,name:"TextCardModal",path:"frontend/src/lib/components/Cards/TextCard/TextCardModal.tsx#TextCardModal"})}catch(__react_docgen_typescript_loader_error){}var DeleteDashboardModal=__webpack_require__("./frontend/src/scenes/dashboard/DeleteDashboardModal.tsx"),deleteDashboardLogic=__webpack_require__("./frontend/src/scenes/dashboard/deleteDashboardLogic.ts"),DuplicateDashboardModal=__webpack_require__("./frontend/src/scenes/dashboard/DuplicateDashboardModal.tsx"),duplicateDashboardLogic=__webpack_require__("./frontend/src/scenes/dashboard/duplicateDashboardLogic.ts"),tagsModel=__webpack_require__("./frontend/src/models/tagsModel.ts"),DashboardTemplateEditor=__webpack_require__("./frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx"),dashboardTemplateEditorLogic=__webpack_require__("./frontend/src/scenes/dashboard/dashboardTemplateEditorLogic.ts");const DASHBOARD_CANNOT_EDIT_MESSAGE="You don't have edit permissions for this dashboard. Ask a dashboard collaborator with edit access to add you.";function DashboardHeader(){const{dashboard:dashboard,dashboardLoading:dashboardLoading,dashboardMode:dashboardMode,canEditDashboard:canEditDashboard,showSubscriptions:showSubscriptions,subscriptionId:subscriptionId,apiUrl:apiUrl,showTextTileModal:showTextTileModal,textTileId:textTileId}=(0,index_esm.useValues)(dashboardLogic.BM),{setDashboardMode:setDashboardMode,triggerDashboardUpdate:triggerDashboardUpdate}=(0,index_esm.useActions)(dashboardLogic.BM),{asDashboardTemplate:asDashboardTemplate}=(0,index_esm.useValues)(dashboardLogic.BM),{updateDashboard:updateDashboard,pinDashboard:pinDashboard,unpinDashboard:unpinDashboard}=(0,index_esm.useActions)(dashboardsModel.h),{setDashboardTemplate:setDashboardTemplate,openDashboardTemplateEditor:openDashboardTemplateEditor}=(0,index_esm.useActions)(dashboardTemplateEditorLogic.X),{hasAvailableFeature:hasAvailableFeature,user:user}=(0,index_esm.useValues)(userLogic.userLogic),{showDuplicateDashboardModal:showDuplicateDashboardModal}=(0,index_esm.useActions)(duplicateDashboardLogic.T),{showDeleteDashboardModal:showDeleteDashboardModal}=(0,index_esm.useActions)(deleteDashboardLogic.r),{tags:tags}=(0,index_esm.useValues)(tagsModel.x),{push:push}=(0,index_esm.useActions)(lib.router),exportOptions=[{export_format:types.P5.PNG,dashboard:dashboard?.id,export_context:{path:apiUrl()}}];return user?.is_staff&&exportOptions.push({export_format:types.P5.JSON,export_context:{localData:JSON.stringify(asDashboardTemplate),filename:`dashboard-${(0,utils.lV)(dashboard?.name||"nameless dashboard")}.json`,mediaType:types.P5.JSON}}),dashboard||dashboardLoading?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[dashboardMode===types.MN.Fullscreen&&(0,jsx_runtime.jsx)(FullScreen,{onExit:()=>setDashboardMode(null,eventUsageLogic.GU.Browser)}),dashboard&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SubscriptionsModal.r,{isOpen:showSubscriptions,closeModal:()=>push(urls.j.dashboard(dashboard.id)),dashboardId:dashboard.id,subscriptionId:subscriptionId}),(0,jsx_runtime.jsx)(SharingModal.PA,{title:"Dashboard Permissions",isOpen:dashboardMode===types.MN.Sharing,closeModal:()=>push(urls.j.dashboard(dashboard.id)),dashboardId:dashboard.id}),canEditDashboard&&(0,jsx_runtime.jsx)(TextCardModal,{isOpen:showTextTileModal,onClose:()=>push(urls.j.dashboard(dashboard.id)),dashboard:dashboard,textTileId:textTileId}),canEditDashboard&&(0,jsx_runtime.jsx)(DeleteDashboardModal.y,{}),canEditDashboard&&(0,jsx_runtime.jsx)(DuplicateDashboardModal.i,{})]}),(0,jsx_runtime.jsx)(PageHeader.m,{title:(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsx)(EditableField.f,{name:"name",value:dashboard?.name||(dashboardLoading?"Loading…":""),placeholder:"Name this dashboard",onSave:dashboard?value=>updateDashboard({id:dashboard.id,name:value,allowUndo:!0}):void 0,saveOnBlur:!0,minLength:1,maxLength:400,mode:canEditDashboard?void 0:"view",notice:dashboard&&!canEditDashboard?{icon:(0,jsx_runtime.jsx)(icons._V1,{}),tooltip:DASHBOARD_CANNOT_EDIT_MESSAGE}:void 0,"data-attr":"dashboard-name"})}),buttons:dashboardMode===types.MN.Edit?(0,jsx_runtime.jsx)(LemonButton.Jp,{"data-attr":"dashboard-edit-mode-save",type:"primary",onClick:()=>setDashboardMode(null,eventUsageLogic.GU.DashboardHeader),tabIndex:10,disabled:dashboardLoading,children:"Done editing"}):dashboardMode===types.MN.Fullscreen?(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"secondary",onClick:()=>setDashboardMode(null,eventUsageLogic.GU.DashboardHeader),"data-attr":"dashboard-exit-presentation-mode",disabled:dashboardLoading,children:"Exit full screen"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(More.T,{"data-attr":"dashboard-three-dots-options-menu",overlay:dashboard?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[dashboard.created_by&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex p-2 text-muted-alt",children:["Created by"," ",dashboard.created_by.first_name||dashboard.created_by.email||"-"," ","on ",(0,utils.bo)(dashboard.created_at)]}),(0,jsx_runtime.jsx)(LemonDivider.p,{})]}),canEditDashboard&&(0,jsx_runtime.jsx)(LemonButton.Jp,{onClick:()=>setDashboardMode(types.MN.Edit,eventUsageLogic.GU.MoreDropdown),status:"stealth",fullWidth:!0,children:"Edit layout (E)"}),(0,jsx_runtime.jsx)(LemonButton.Jp,{onClick:()=>setDashboardMode(types.MN.Fullscreen,eventUsageLogic.GU.MoreDropdown),status:"stealth",fullWidth:!0,children:"Go full screen (F)"}),canEditDashboard&&(dashboard.pinned?(0,jsx_runtime.jsx)(LemonButton.Jp,{onClick:()=>unpinDashboard(dashboard.id,eventUsageLogic.GU.MoreDropdown),status:"stealth",fullWidth:!0,children:"Unpin dashboard"}):(0,jsx_runtime.jsx)(LemonButton.Jp,{onClick:()=>pinDashboard(dashboard.id,eventUsageLogic.GU.MoreDropdown),status:"stealth",fullWidth:!0,children:"Pin dashboard"})),(0,jsx_runtime.jsx)(SubscriptionsModal.T,{dashboardId:dashboard.id}),(0,jsx_runtime.jsx)(ExportButton.j,{fullWidth:!0,status:"stealth",items:exportOptions}),user?.is_staff&&(0,jsx_runtime.jsx)(LemonButton.Jp,{onClick:()=>{asDashboardTemplate&&(setDashboardTemplate(asDashboardTemplate),openDashboardTemplateEditor())},fullWidth:!0,status:"stealth",children:"Save as template"}),(0,jsx_runtime.jsx)(LemonDivider.p,{}),(0,jsx_runtime.jsx)(LemonButton.Jp,{onClick:()=>{showDuplicateDashboardModal(dashboard.id,dashboard.name)},status:"stealth",fullWidth:!0,children:"Duplicate dashboard"}),canEditDashboard&&(0,jsx_runtime.jsx)(LemonButton.Jp,{onClick:()=>{showDeleteDashboardModal(dashboard.id)},status:"danger",fullWidth:!0,children:"Delete dashboard"})]}):void 0}),(0,jsx_runtime.jsx)(LemonDivider.p,{vertical:!0}),dashboard&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(CollaboratorBubbles,{dashboard:dashboard,onClick:()=>push(urls.j.dashboardSharing(dashboard.id))}),(0,jsx_runtime.jsx)(LemonButton.Jp,{type:"secondary","data-attr":"dashboard-share-button",onClick:()=>push(urls.j.dashboardSharing(dashboard.id)),children:"Share"})]}),dashboard?(0,jsx_runtime.jsx)(LemonButton.QR,{to:urls.j.insightNew(void 0,dashboard.id),type:"primary","data-attr":"dashboard-add-graph-header",disabledReason:canEditDashboard?null:DASHBOARD_CANNOT_EDIT_MESSAGE,sideAction:{dropdown:{placement:"bottom-end",overlay:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonButton.Jp,{status:"stealth",fullWidth:!0,onClick:()=>{push(urls.j.dashboardTextTile(dashboard.id,"new"))},"data-attr":"add-text-tile-to-dashboard",children:"Add text card"})})},disabled:!1,"data-attr":"dashboard-add-dropdown"},children:"Add insight"}):null]}),caption:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[dashboard&&!(!canEditDashboard&&!dashboard.description)&&(0,jsx_runtime.jsx)(EditableField.f,{multiline:!0,name:"description",value:dashboard.description||"",placeholder:"Description (optional)",onSave:value=>updateDashboard({id:dashboard.id,description:value,allowUndo:!0}),saveOnBlur:!0,compactButtons:!0,mode:canEditDashboard?void 0:"view",paywall:!hasAvailableFeature(types.P$.DASHBOARD_COLLABORATION)}),dashboard?.tags&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:canEditDashboard?(0,jsx_runtime.jsx)(ObjectTags.D,{tags:dashboard.tags,onChange:(_,tags)=>triggerDashboardUpdate({tags:tags}),saving:dashboardLoading,tagsAvailable:tags.filter((tag=>!dashboard.tags?.includes(tag))),className:"insight-metadata-tags"}):dashboard.tags.length?(0,jsx_runtime.jsx)(ObjectTags.D,{tags:dashboard.tags,saving:dashboardLoading,staticOnly:!0,className:"insight-metadata-tags"}):null})]}),delimited:!0}),(0,jsx_runtime.jsx)(DashboardTemplateEditor.v,{})]}):null}function CollaboratorBubbles(_ref){let{dashboard:dashboard,onClick:onClick}=_ref;const{allCollaborators:allCollaborators}=(0,index_esm.useValues)((0,dashboardCollaboratorsLogic.B)({dashboardId:dashboard.id}));if(!dashboard)return null;const effectiveRestrictionLevelOption=DashboardCollaborators.R[dashboard.effective_restriction_level],tooltipParts=[];return(0,LemonSelect.u7)(effectiveRestrictionLevelOption)&&"string"==typeof effectiveRestrictionLevelOption?.title&&tooltipParts.push(effectiveRestrictionLevelOption.title),dashboard.is_shared&&tooltipParts.push("Shared publicly"),(0,jsx_runtime.jsx)(ProfileBubbles.r,{people:allCollaborators.map((collaborator=>({email:collaborator.user.email,name:collaborator.user.first_name,title:`${collaborator.user.first_name} <${collaborator.user.email}> (${constants.KN[collaborator.level]})`}))),tooltip:tooltipParts.join(" • "),onClick:onClick})}},"./frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{v:function(){return DashboardTemplateEditor}});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),_monaco_editor_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@monaco-editor+react@4.4.6_monaco-editor@0.39.0_react-dom@16.14.0_react@16.14.0/node_modules/@monaco-editor/react/lib/es/index.js"),react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),kea__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/dashboard/dashboardTemplateEditorLogic.ts"),lib_components_CodeEditors__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/components/CodeEditors.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function DashboardTemplateEditor(_ref){let{inline:inline=!1}=_ref;const monaco=(0,_monaco_editor_react__WEBPACK_IMPORTED_MODULE_1__.Ik)(),{closeDashboardTemplateEditor:closeDashboardTemplateEditor,createDashboardTemplate:createDashboardTemplate,updateDashboardTemplate:updateDashboardTemplate,setEditorValue:setEditorValue,updateValidationErrors:updateValidationErrors}=(0,kea__WEBPACK_IMPORTED_MODULE_3__.useActions)(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_4__.X),{isOpenNewDashboardTemplateModal:isOpenNewDashboardTemplateModal,editorValue:editorValue,validationErrors:validationErrors,templateSchema:templateSchema,id:id}=(0,kea__WEBPACK_IMPORTED_MODULE_3__.useValues)(_dashboardTemplateEditorLogic__WEBPACK_IMPORTED_MODULE_4__.X);return(0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)((()=>{if(!monaco)return;const schemas=[];templateSchema&&schemas.push({uri:"http://internal/node-schema.json",fileMatch:["*"],schema:templateSchema}),monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:schemas})}),[monaco,templateSchema]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonModal,{title:id?"Edit dashboard template":"New dashboard template",isOpen:isOpenNewDashboardTemplateModal,width:1e3,onClose:()=>{closeDashboardTemplateEditor()},inline:inline,footer:id?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{type:"primary","data-attr":"update-dashboard-template-button",onClick:()=>{updateDashboardTemplate({id:id})},disabledReason:validationErrors.length?`There are ${validationErrors.length} errors to resolve: ${validationErrors.map((e=>" "+e))}`:void 0,children:"Update template"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonButton,{type:"primary","data-attr":"create-dashboard-template-button",onClick:()=>{createDashboardTemplate()},disabledReason:validationErrors.length?`There are ${validationErrors.length} errors to resolve:${validationErrors.map((e=>" "+e))}`:void 0,children:"Create new template"}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_components_CodeEditors__WEBPACK_IMPORTED_MODULE_5__.p,{className:"border",language:"json",value:editorValue,onChange:v=>{setEditorValue(null!=v?v:"")},onValidate:markers=>{updateValidationErrors(markers)},height:600})})}try{DashboardTemplateEditor.displayName="DashboardTemplateEditor",DashboardTemplateEditor.__docgenInfo={description:"",displayName:"DashboardTemplateEditor",props:{inline:{defaultValue:{value:"false"},description:"",name:"inline",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx#DashboardTemplateEditor"]={docgenInfo:DashboardTemplateEditor.__docgenInfo,name:"DashboardTemplateEditor",path:"frontend/src/scenes/dashboard/DashboardTemplateEditor.tsx#DashboardTemplateEditor"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/dashboard/DeleteDashboardModal.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{y:function(){return DeleteDashboardModal}});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),kea_forms__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),scenes_dashboard_deleteDashboardLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/dashboard/deleteDashboardLogic.ts"),lib_forms_Field__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),lib_lemon_ui_LemonCheckbox__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCheckbox/index.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function DeleteDashboardModal(){const{hideDeleteDashboardModal:hideDeleteDashboardModal}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(scenes_dashboard_deleteDashboardLogic__WEBPACK_IMPORTED_MODULE_4__.r),{isDeleteDashboardSubmitting:isDeleteDashboardSubmitting,deleteDashboardModalVisible:deleteDashboardModalVisible}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(scenes_dashboard_deleteDashboardLogic__WEBPACK_IMPORTED_MODULE_4__.r);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_2__.f,{title:"Delete dashboard",onClose:hideDeleteDashboardModal,isOpen:deleteDashboardModalVisible,footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.Jp,{form:"delete-dashboard-form",type:"secondary","data-attr":"dashboard-delete",disabled:isDeleteDashboardSubmitting,onClick:hideDeleteDashboardModal,children:"Cancel"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_1__.Jp,{form:"delete-dashboard-form",htmlType:"submit",type:"primary",status:"danger","data-attr":"dashboard-delete-submit",loading:isDeleteDashboardSubmitting,disabled:isDeleteDashboardSubmitting,children:"Delete dashboard"})]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(kea_forms__WEBPACK_IMPORTED_MODULE_3__.Form,{logic:scenes_dashboard_deleteDashboardLogic__WEBPACK_IMPORTED_MODULE_4__.r,formKey:"deleteDashboard",id:"delete-dashboard-form",enableFormOnSubmit:!0,className:"space-y-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_5__.g,{name:"deleteInsights",help:"This will only delete insights if they're not on any other dashboards.",children:_ref=>{let{value:value,onChange:onChange}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonCheckbox__WEBPACK_IMPORTED_MODULE_6__.H,{"data-attr":"delete-dashboard-insights-checkbox",checked:value,label:"Delete this dashboard's insights",onChange:onChange})}})})})}},"./frontend/src/scenes/dashboard/DuplicateDashboardModal.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{i:function(){return DuplicateDashboardModal}});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),kea_forms__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_lemon_ui_LemonCheckbox__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonCheckbox/index.ts"),scenes_dashboard_duplicateDashboardLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/dashboard/duplicateDashboardLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");function DuplicateDashboardModal(){const{hideDuplicateDashboardModal:hideDuplicateDashboardModal,duplicateAndGoToDashboard:duplicateAndGoToDashboard}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(scenes_dashboard_duplicateDashboardLogic__WEBPACK_IMPORTED_MODULE_6__.T),{isDuplicateDashboardSubmitting:isDuplicateDashboardSubmitting,duplicateDashboardModalVisible:duplicateDashboardModalVisible}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(scenes_dashboard_duplicateDashboardLogic__WEBPACK_IMPORTED_MODULE_6__.T);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonModal__WEBPACK_IMPORTED_MODULE_3__.f,{title:"Duplicate dashboard",onClose:hideDuplicateDashboardModal,isOpen:duplicateDashboardModalVisible,footer:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__.Jp,{form:"new-dashboard-form",type:"secondary","data-attr":"dashboard-cancel",disabled:isDuplicateDashboardSubmitting,onClick:hideDuplicateDashboardModal,children:"Cancel"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__.Jp,{form:"new-dashboard-form",type:"secondary","data-attr":"dashboard-submit-and-go",disabled:isDuplicateDashboardSubmitting,onClick:duplicateAndGoToDashboard,children:"Duplicate and go to dashboard"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_2__.Jp,{form:"duplicate-dashboard-form",htmlType:"submit",type:"primary","data-attr":"duplicate-dashboard-submit",loading:isDuplicateDashboardSubmitting,disabled:isDuplicateDashboardSubmitting,children:"Duplicate"})]}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(kea_forms__WEBPACK_IMPORTED_MODULE_4__.Form,{logic:scenes_dashboard_duplicateDashboardLogic__WEBPACK_IMPORTED_MODULE_6__.T,formKey:"duplicateDashboard",id:"duplicate-dashboard-form",enableFormOnSubmit:!0,className:"space-y-2",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_forms_Field__WEBPACK_IMPORTED_MODULE_1__.g,{name:"duplicateTiles",help:"Choose whether to duplicate this dashboard's insights and text or attach them to the new dashboard.",children:_ref=>{let{value:value,onChange:onChange}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(lib_lemon_ui_LemonCheckbox__WEBPACK_IMPORTED_MODULE_5__.H,{checked:value,label:"Duplicate this dashboard's tiles",onChange:onChange})}})})})}},"./frontend/src/scenes/dashboard/dashboardTemplateEditorLogic.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{X:function(){return dashboardTemplateEditorLogic}});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/api.ts"),_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/dashboard/dashboards/templates/dashboardTemplatesLogic.tsx"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts");const dashboardTemplateEditorLogic=(0,kea__WEBPACK_IMPORTED_MODULE_1__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_1__.path)(["scenes","dashboard","dashboardTemplateEditorLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_1__.connect)({logic:[_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__.R],values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_5__.h,["featureFlags"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.actions)({setEditorValue:value=>({value:value}),setDashboardTemplate:dashboardTemplate=>({dashboardTemplate:dashboardTemplate}),clear:!0,setDashboardTemplateId:id=>({id:id}),openDashboardTemplateEditor:!0,closeDashboardTemplateEditor:!0,updateValidationErrors:markers=>({markers:markers})}),(0,kea__WEBPACK_IMPORTED_MODULE_1__.reducers)({editorValue:["",{setEditorValue:(_,_ref)=>{let{value:value}=_ref;return value},clear:()=>""}],dashboardTemplate:[null,{clear:()=>null,setDashboardTemplate:(_,_ref2)=>{let{dashboardTemplate:dashboardTemplate}=_ref2;return dashboardTemplate}}],validationErrors:[[],{updateValidationErrors:(_,_ref3)=>{let{markers:markers}=_ref3;return markers&&0!==markers.length?markers.map((marker=>marker.message)):[]},clear:()=>[]}],id:[null,{setDashboardTemplateId:(_,_ref4)=>{let{id:id}=_ref4;return id},clear:()=>null}],isOpenNewDashboardTemplateModal:[!1,{openDashboardTemplateEditor:()=>!0,closeDashboardTemplateEditor:()=>!1}]}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_2__.loaders)((_ref5=>{let{values:values}=_ref5;return{dashboardTemplate:[void 0,{createDashboardTemplate:async()=>{if(!values.dashboardTemplate)return void _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("Unable to create dashboard template");const response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.create(values.dashboardTemplate);return _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success("Dashboard template created"),response},getDashboardTemplate:async id=>await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.get(id),updateDashboardTemplate:async _ref6=>{let{id:id,dashboardTemplateUpdates:dashboardTemplateUpdates}=_ref6,response=null;if(dashboardTemplateUpdates)response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.update(id,dashboardTemplateUpdates);else{if(!values.dashboardTemplate)return void _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("Unable to update dashboard template");response=await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.update(id,values.dashboardTemplate)}return _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success("Dashboard template updated"),response},deleteDashboardTemplate:async id=>(await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.delete(id),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.success("Dashboard template deleted"),null)}],templateSchema:[null,{getTemplateSchema:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_3__.ZP.dashboardTemplates.getSchema()}]}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.listeners)((_ref7=>{let{values:values,actions:actions}=_ref7;return{createDashboardTemplateSuccess:async()=>{actions.closeDashboardTemplateEditor(),_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__.R.actions.getAllTemplates()},updateDashboardTemplateSuccess:async()=>{actions.closeDashboardTemplateEditor(),_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__.R.actions.getAllTemplates()},deleteDashboardTemplateSuccess:async()=>{_dashboards_templates_dashboardTemplatesLogic__WEBPACK_IMPORTED_MODULE_4__.R.actions.getAllTemplates()},closeDashboardTemplateEditor:()=>{actions.clear()},setDashboardTemplateId:_ref8=>{let{id:id}=_ref8;id&&actions.getDashboardTemplate(id)},getDashboardTemplateSuccess:async _ref9=>{let{dashboardTemplate:dashboardTemplate}=_ref9;dashboardTemplate&&actions.setEditorValue(JSON.stringify(dashboardTemplate))},setEditorValue:async(_ref10,breakpoint)=>{let{value:value}=_ref10;if(await breakpoint(500),0==values.validationErrors.length&&value?.length)try{const dashboardTemplate=JSON.parse(value);actions.setDashboardTemplate(dashboardTemplate)}catch(error){console.error("error",error),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.lemonToast.error("Unable to parse dashboard template")}},updateValidationErrors:async _ref11=>{let{markers:markers}=_ref11;markers?.length||actions.setEditorValue(values.editorValue)},setDashboardTemplate:async _ref12=>{let{dashboardTemplate:dashboardTemplate}=_ref12;dashboardTemplate&&actions.setEditorValue(JSON.stringify(dashboardTemplate,null,4))}}})),(0,kea__WEBPACK_IMPORTED_MODULE_1__.afterMount)((_ref13=>{let{actions:actions}=_ref13;actions.getTemplateSchema()}))])}}]);