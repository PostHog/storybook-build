(window.webpackJsonp=window.webpackJsonp||[]).push([[236],{"./frontend/src/lib/components/DropdownSelector/DropdownSelector.tsx":function(J,C,e){"use strict";e.d(C,"a",function(){return Y});var L=e("./node_modules/core-js/modules/es.symbol.js"),i=e("./node_modules/core-js/modules/es.symbol.description.js"),Q=e("./node_modules/core-js/modules/es.array.find.js"),se=e("./node_modules/core-js/modules/es.array.map.js"),Z=e("./node_modules/@babel/runtime/helpers/extends.js"),re=e.n(Z),k=e("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),le=e.n(k),r=e("./node_modules/antd/es/row/index.js"),B=e("./node_modules/antd/es/menu/index.js"),ie=e("./node_modules/antd/es/dropdown/index.js"),q=e("./node_modules/clsx/dist/clsx.m.js"),_=e("./node_modules/react/index.js"),p=e.n(_),ae=e("./frontend/src/lib/components/icons.tsx"),w=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),K=e.n(w),Se=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/lib/components/DropdownSelector/DropdownSelector.scss"),ve=e.n(Se),ce={};ce.insert="head",ce.singleton=!1;var Ee=K()(ve.a,ce),je=ve.a.locals||{};function de(g){var ee=g.icon,y=g.label,U=g.description,M=g.onClick;return p.a.createElement("div",{onClick:M},p.a.createElement(r.a,{align:"middle"},ee,p.a.createElement("div",{style:{fontSize:14,fontWeight:500,marginLeft:8}},y)),U&&p.a.createElement("div",{style:{fontSize:12,color:"rgba(0, 0, 0, 0.5)"}},U))}function Y(g){var ee=g.label,y=g.value,U=g.onValueChange,M=g.options,te=g.hideDescriptionOnDisplay,G=g.disabled,S=g.compact,j=M.find(function(E){return E.key===y}),R=p.a.createElement(B.a,null,M.map(function(E){var b=E.key,W=E.hidden,T=le()(E,["key","hidden"]);return W?null:p.a.createElement(B.a.Item,{key:b},p.a.createElement(de,re()({},T,{onClick:function(){return U(b)}})))}));return p.a.createElement(p.a.Fragment,null,ee&&p.a.createElement("label",{className:"ant-form-item-label"},ee),p.a.createElement(ie.a,{overlay:R,trigger:["click"],disabled:G},p.a.createElement("div",{className:Object(q.a)("dropdown-selector",G&&" disabled",S&&"compact"),onClick:function(b){return b.preventDefault()}},p.a.createElement("div",{style:{flexGrow:1}},j&&p.a.createElement(de,re()({},j,{onClick:function(){},description:te?void 0:j.description}))),p.a.createElement("div",{className:"dropdown-arrow"},p.a.createElement(ae.IconArrowDropDown,null)))))}try{Y.displayName="DropdownSelector",Y.__docgenInfo={description:"",displayName:"DropdownSelector",props:{label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string | null"}},onValueChange:{defaultValue:null,description:"",name:"onValueChange",required:!0,type:{name:"(value: string) => void"}},options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"DropdownOption[]"}},hideDescriptionOnDisplay:{defaultValue:null,description:"",name:"hideDescriptionOnDisplay",required:!1,type:{name:"boolean"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},compact:{defaultValue:null,description:"",name:"compact",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/DropdownSelector/DropdownSelector.tsx#DropdownSelector"]={docgenInfo:Y.__docgenInfo,name:"DropdownSelector",path:"frontend/src/lib/components/DropdownSelector/DropdownSelector.tsx#DropdownSelector"})}catch(g){}},"./frontend/src/scenes/cohorts/Cohort.tsx":function(J,C,e){"use strict";e.r(C),e.d(C,"scene",function(){return qe}),e.d(C,"Cohort",function(){return pe});var L=e("./node_modules/core-js/modules/es.symbol.js"),i=e("./node_modules/core-js/modules/es.symbol.description.js"),Q=e("./node_modules/core-js/modules/es.function.name.js"),se=e("./node_modules/@babel/runtime/helpers/extends.js"),Z=e.n(se),re=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),k=e.n(re),le=e("./node_modules/react/index.js"),r=e.n(le),B=e("./node_modules/kea/lib/index.esm.js"),ie=e("./node_modules/antd/es/input/index.js");function q(o){var n=o.input,t=o.onChange;return r.a.createElement(r.a.Fragment,null,r.a.createElement("label",{className:"ant-form-item-label",htmlFor:"cohort-name"},"Name"),r.a.createElement(ie.a,{required:!0,autoFocus:!0,placeholder:"Name your cohort",value:n||"","data-attr":"cohort-name",onChange:function(c){return t(c.target.value)},id:"cohort-name",className:"ph-ignore-input"}))}try{q.displayName="CohortNameInput",q.__docgenInfo={description:"",displayName:"CohortNameInput",props:{input:{defaultValue:null,description:"",name:"input",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(input: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortNameInput.tsx#CohortNameInput"]={docgenInfo:q.__docgenInfo,name:"CohortNameInput",path:"frontend/src/scenes/cohorts/CohortNameInput.tsx#CohortNameInput"})}catch(o){}function _(o){var n=o.description,t=o.onChange;return r.a.createElement(r.a.Fragment,null,r.a.createElement("label",{className:"ant-form-item-label",htmlFor:"cohort-description"},"Description"),r.a.createElement(ie.a.TextArea,{placeholder:"Add a useful description for other team members",value:n||"","data-attr":"cohort-description",id:"cohort-description",onChange:function(c){return t(c.target.value)},maxLength:1e3}))}try{_.displayName="CohortDescriptionInput",_.__docgenInfo={description:"",displayName:"CohortDescriptionInput",props:{description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(input: string) => void"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortDescriptionInput.tsx#CohortDescriptionInput"]={docgenInfo:_.__docgenInfo,name:"CohortDescriptionInput",path:"frontend/src/scenes/cohorts/CohortDescriptionInput.tsx#CohortDescriptionInput"})}catch(o){}var p=e("./node_modules/antd/es/divider/index.js"),ae=e("./node_modules/antd/es/row/index.js"),w=e("./node_modules/antd/es/col/index.js"),K=e("./node_modules/antd/es/tooltip/index.js"),Se=e("./node_modules/core-js/modules/es.array.concat.js"),ve=e("./node_modules/core-js/modules/es.array.filter.js"),ce=e("./node_modules/core-js/modules/es.array.map.js"),Ee=e("./node_modules/core-js/modules/es.object.to-string.js"),je=e("./node_modules/core-js/modules/es.regexp.to-string.js"),de=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Y=e.n(de),g=e("./frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/MatchCriteriaSelector.tsx"),ee=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),y=e("./frontend/src/lib/constants.tsx");function U(o,n){var t=Object.keys(o);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(o);n&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),t.push.apply(t,a)}return t}function M(o){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?U(Object(t),!0).forEach(function(a){k()(o,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):U(Object(t)).forEach(function(a){Object.defineProperty(o,a,Object.getOwnPropertyDescriptor(t,a))})}return o}function te(o){var n=o.logic,t=Object(B.useActions)(n),a=t.setCohort,c=t.onCriteriaChange,h=Object(B.useValues)(n),u=h.cohort,v=h.submitted,m=function(){a(M(M({},u),{},{groups:[].concat(Y()(u.groups),[{id:Math.random().toString().substr(2,5),matchType:y.p,properties:[]}])}))},s=function(d){a(M(M({},u),{},{groups:u.groups.filter(function(x,H){return H!==d})}))},f=r.a.createElement("div",{style:{marginTop:8,marginBottom:8}},r.a.createElement("a",{href:"#add",style:{padding:0},onClick:function(){return m()},"data-attr":"add-match-criteria"},r.a.createElement(ee.a,null)," Add matching criteria"));return r.a.createElement(w.a,null,r.a.createElement("h3",{className:"l3"},"Matching Criteria"),r.a.createElement("div",{className:"mb"},"Users who match the following criteria will be part of the cohort. Continuously updated automatically."),r.a.createElement("div",null,u.groups.map(function(O,d){return r.a.createElement(r.a.Fragment,{key:d},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}},r.a.createElement(g.b,{onCriteriaChange:function(H){return c(H,O.id)},onRemove:function(){return s(d)},group:O,showErrors:v}),d<u.groups.length-1&&r.a.createElement("div",{className:"stateful-badge or mt mb"},"OR")))})),r.a.createElement("span",{id:"add"}),f)}try{te.displayName="CohortMatchingCriteriaSection",te.__docgenInfo={description:"",displayName:"CohortMatchingCriteriaSection",props:{logic:{defaultValue:null,description:"",name:"logic",required:!0,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/CohortMatchingCriteriaSection.tsx#CohortMatchingCriteriaSection"]={docgenInfo:te.__docgenInfo,name:"CohortMatchingCriteriaSection",path:"frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/CohortMatchingCriteriaSection.tsx#CohortMatchingCriteriaSection"})}catch(o){}try{CohortMatchingCriteriaSection.displayName="CohortMatchingCriteriaSection",CohortMatchingCriteriaSection.__docgenInfo={description:"",displayName:"CohortMatchingCriteriaSection",props:{logic:{defaultValue:null,description:"",name:"logic",required:!0,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/index.tsx#CohortMatchingCriteriaSection"]={docgenInfo:CohortMatchingCriteriaSection.__docgenInfo,name:"CohortMatchingCriteriaSection",path:"frontend/src/scenes/cohorts/CohortMatchingCriteriaSection/index.tsx#CohortMatchingCriteriaSection"})}catch(o){}var G=e("./frontend/src/types.ts"),S=e("./node_modules/@ant-design/icons/es/icons/OrderedListOutlined.js"),j=e("./node_modules/@ant-design/icons/es/icons/CalculatorOutlined.js"),R=e("./node_modules/@ant-design/icons/es/icons/InboxOutlined.js"),E=e("./node_modules/antd/lib/upload/Dragger.js"),b=e.n(E),W=e("./frontend/src/lib/components/ProfilePicture/index.ts");function T(o){var n=o.person;return r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},n?r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,{name:n==null?void 0:n.first_name,email:n==null?void 0:n.email,size:"md"}),r.a.createElement("span",{style:{marginLeft:4}},(n==null?void 0:n.first_name)||(n==null?void 0:n.email))):r.a.createElement("span",{className:"text-muted"},"Unknown"))}try{T.displayName="TeamMemberID",T.__docgenInfo={description:"",displayName:"TeamMemberID",props:{person:{defaultValue:null,description:"",name:"person",required:!1,type:{name:"UserBasicType | null"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/TeamMemberID.tsx#TeamMemberID"]={docgenInfo:T.__docgenInfo,name:"TeamMemberID",path:"frontend/src/lib/components/TeamMemberID.tsx#TeamMemberID"})}catch(o){}var I=e("./frontend/src/lib/dayjs.ts");function D(o){var n=o.cohort,t=12;return r.a.createElement(ae.a,{justify:"space-between",align:"top",className:"mt text-center"},r.a.createElement(w.a,{span:t},r.a.createElement("label",{className:"ant-form-item-label"},"Created at"),r.a.createElement("div",null,Object(I.a)(n.created_at).fromNow())),r.a.createElement(w.a,{span:t},r.a.createElement("label",{className:"ant-form-item-label"},"Created by"),r.a.createElement("div",null,r.a.createElement(T,{person:n.created_by}))),r.a.createElement(w.a,{span:t},r.a.createElement("label",{className:"ant-form-item-label"},"Last calculated at"),r.a.createElement("div",null,n.last_calculation?Object(I.a)(n.last_calculation).fromNow():"in progress")))}try{D.displayName="CohortDetailsRow",D.__docgenInfo={description:"",displayName:"CohortDetailsRow",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!0,type:{name:"CohortType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/CohortDetailsRow.tsx#CohortDetailsRow"]={docgenInfo:D.__docgenInfo,name:"CohortDetailsRow",path:"frontend/src/scenes/cohorts/CohortDetailsRow.tsx#CohortDetailsRow"})}catch(o){}var $=e("./frontend/src/scenes/persons/Persons.tsx"),X=e("./node_modules/core-js/modules/es.array.find-index.js"),N=e("./node_modules/core-js/modules/es.array.iterator.js"),P=e("./node_modules/core-js/modules/es.number.constructor.js"),ge=e("./node_modules/core-js/modules/es.object.entries.js"),Oe=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Fe=e("./node_modules/@babel/runtime/regenerator/index.js"),ne=e.n(Fe),Ve=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),Be=e.n(Ve),tt=e("./node_modules/regenerator-runtime/runtime.js"),Ke=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ye=e.n(Ke),Ce=e("./frontend/src/lib/api.ts"),me=e("./frontend/src/models/cohortsModel.ts"),Ye=e("./frontend/src/lib/utils.tsx"),Ue=e("./frontend/src/scenes/persons/personsLogic.ts"),Pe=e("./frontend/src/lib/components/lemonToast.tsx"),xe=e("./frontend/src/scenes/urls.ts"),Ge=e("./node_modules/kea-router/lib/index.js");function We(o,n){var t;if(typeof Symbol=="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(t=$e(o))||n&&o&&typeof o.length=="number"){t&&(o=t);var a=0,c=function(){};return{s:c,n:function(){return a>=o.length?{done:!0}:{done:!1,value:o[a++]}},e:function(s){throw s},f:c}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var h=!0,u=!1,v;return{s:function(){t=o[Symbol.iterator]()},n:function(){var s=t.next();return h=s.done,s},e:function(s){u=!0,v=s},f:function(){try{!h&&t.return!=null&&t.return()}finally{if(u)throw v}}}}function $e(o,n){if(!!o){if(typeof o=="string")return Ie(o,n);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ie(o,n)}}function Ie(o,n){(n==null||n>o.length)&&(n=o.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=o[t];return a}function De(o,n){var t=Object.keys(o);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(o);n&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),t.push.apply(t,a)}return t}function F(o){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?De(Object(t),!0).forEach(function(a){k()(o,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):De(Object(t)).forEach(function(a){Object.defineProperty(o,a,Object.getOwnPropertyDescriptor(t,a))})}return o}var Ae={id:"new",groups:[{id:Math.random().toString().substr(2,5),matchType:y.p,properties:[]}]};function ze(o){return F(F({},o),{},{id:void 0,matchType:void 0})}function He(o){return F({matchType:Je(o),id:Math.random().toString().substr(2,5)},o)}function Je(o){return o.action_id||o.event_id?y.g:y.p}function be(o){return o.groups&&(o.groups=o.groups.map(function(n){return He(n)}),o.groups=o.groups.map(function(n){return n.properties?F(F({},n),{},{properties:Object(Ye.s)(n.properties)}):n})),o}var Re=Object(B.kea)({props:{},key:function(n){var t;return(t=n.id==="new"?"new-".concat(n.pageKey):n.id)!==null&&t!==void 0?t:"new"},path:function(n){return["scenes","cohorts","cohortLogic",n]},connect:[me.a],actions:function(){return{saveCohort:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return{cohortParams:t,filterParams:a}},setCohort:function(t){return{cohort:t}},deleteCohort:!0,onCriteriaChange:function(t,a){return{newGroup:t,id:a}},fetchCohort:function(t){return{cohort:t}},setPollTimeout:function(t){return{pollTimeout:t}},setLastSavedAt:function(t){return{lastSavedAt:t}},checkIfFinishedCalculating:function(t){return{cohort:t}},setSubmitted:function(t){return{submitted:t}}}},reducers:function(){return{pollTimeout:[null,{setPollTimeout:function(t,a){var c=a.pollTimeout;return c}}],cohort:[be(Ae),{setCohort:function(t,a){var c=a.cohort;return be(c)},onCriteriaChange:function(t,a){var c=a.newGroup,h=a.id,u=F({},t),v=u.groups.findIndex(function(m){return m.id===h});return c.matchType?u.groups[v]=F({id:u.groups[v].id,matchType:y.g},c):u.groups[v]=F(F({},u.groups[v]),c),be(u)}}],lastSavedAt:[!1,{setLastSavedAt:function(t,a){var c=a.lastSavedAt;return c}}],submitted:[!1,{setSubmitted:function(t,a){var c=a.submitted;return c}}]}},selectors:{breadcrumbs:[function(o){return[o.cohort]},function(o){return[{name:"Cohorts",path:xe.a.cohorts()}].concat(Y()(o?[{name:o.name||"Untitled"}]:[]))}]},listeners:function(n){var t=n.actions,a=n.values,c=n.key;return{saveCohort:function(){var h=ye()(ne.a.mark(function v(m,s){var f,O,d,x,H,fe,he,oe,V,A,we,Te,ue,Me;return ne.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:f=m.cohortParams,O=m.filterParams,d=F(F({},a.cohort),f),x=new FormData,H=0,fe=Object.entries(d);case 4:if(!(H<fe.length)){l.next=42;break}if(he=Be()(fe[H],2),oe=he[0],V=he[1],oe!=="groups"){l.next=38;break}if(!d.is_static){l.next=13;break}if(!(!d.csv&&d.id==="new")){l.next=11;break}return t.setSubmitted(!0),l.abrupt("return");case 11:l.next=34;break;case 13:A=We(V),l.prev=14,A.s();case 16:if((we=A.n()).done){l.next=26;break}if(ue=we.value,!(ue.matchType===y.p&&!(!((Te=ue.properties)===null||Te===void 0)&&Te.length))){l.next=21;break}return t.setSubmitted(!0),l.abrupt("return");case 21:if(!(ue.matchType===y.g&&!(ue.action_id||ue.event_id))){l.next=24;break}return t.setSubmitted(!0),l.abrupt("return");case 24:l.next=16;break;case 26:l.next=31;break;case 28:l.prev=28,l.t0=l.catch(14),A.e(l.t0);case 31:return l.prev=31,A.f(),l.finish(31);case 34:Me=V.map(function(et){return ze(et)}),d.csv?x.append(oe,"[]"):x.append(oe,JSON.stringify(Me)),l.next=39;break;case 38:x.append(oe,V);case 39:H++,l.next=4;break;case 42:if(l.prev=42,d.id==="new"){l.next=50;break}return l.next=46,Ce.b.cohorts.update(d.id,x,O);case 46:d=l.sent,me.a.actions.updateCohort(d),l.next=54;break;case 50:return l.next=52,Ce.b.cohorts.create(x,O);case 52:d=l.sent,me.a.actions.cohortCreated(d);case 54:l.next=60;break;case 56:return l.prev=56,l.t1=l.catch(42),Pe.a.error(l.t1.detail||"Failed to save cohort"),l.abrupt("return");case 60:t.setSubmitted(!1),d.is_calculating=!0,s(),delete d.csv,t.setCohort(d),Pe.a.success("Cohort saved. Please wait up to a few minutes for it to be calculated",{toastId:"cohort-saved-".concat(c)}),t.checkIfFinishedCalculating(d);case 67:case"end":return l.stop()}},v,null,[[14,28,31,34],[42,56]])}));function u(v,m){return h.apply(this,arguments)}return u}(),deleteCohort:function(){me.a.actions.deleteCohort(a.cohort),Ge.router.actions.push(xe.a.cohorts())},fetchCohort:function(){var h=ye()(ne.a.mark(function v(m,s){var f;return ne.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return f=m.cohort,d.next=3,Ce.b.cohorts.get(f.id);case 3:f=d.sent,s(),t.checkIfFinishedCalculating(f);case 6:case"end":return d.stop()}},v)}));function u(v,m){return h.apply(this,arguments)}return u}(),checkIfFinishedCalculating:function(){var h=ye()(ne.a.mark(function v(m,s){var f,O;return ne.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:f=m.cohort,s(),f.is_calculating?t.setPollTimeout(setTimeout(function(){return t.fetchCohort(f)},1e3)):(t.setLastSavedAt(new Date().toISOString()),t.setCohort(f),me.a.actions.updateCohort(f),(O=Ue.a.findMounted({syncWithUrl:!0}))===null||O===void 0||O.actions.loadCohorts(),a.pollTimeout&&(clearTimeout(a.pollTimeout),t.setPollTimeout(null)));case 3:case"end":return x.stop()}},v)}));function u(v,m){return h.apply(this,arguments)}return u}()}},events:function(n){var t=n.values,a=n.actions,c=n.props;return{afterMount:function(){var h=ye()(ne.a.mark(function v(){var m;return ne.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(!c.id||c.id==="new")){f.next=4;break}a.setCohort(Ae),f.next=8;break;case 4:return f.next=6,Ce.b.cohorts.get(Number(c.id));case 6:m=f.sent,a.setCohort(m);case 8:case"end":return f.stop()}},v)}));function u(){return h.apply(this,arguments)}return u}(),beforeUnmount:function(){t.pollTimeout&&clearTimeout(t.pollTimeout)}}}}),Qe=e("./frontend/src/lib/components/DropdownSelector/DropdownSelector.tsx"),Xe=e("./frontend/src/scenes/userLogic.ts"),nt=e("./node_modules/antd/lib/dropdown/style/index.css"),Ze=e("./frontend/src/lib/components/Spinner/Spinner.tsx"),Ne=e("./frontend/src/lib/components/LemonButton/index.ts"),ke=e("./frontend/src/lib/components/PageHeader.tsx");function Le(o,n){var t=Object.keys(o);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(o);n&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),t.push.apply(t,a)}return t}function z(o){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?Le(Object(t),!0).forEach(function(a){k()(o,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):Le(Object(t)).forEach(function(a){Object.defineProperty(o,a,Object.getOwnPropertyDescriptor(t,a))})}return o}var qe={component:pe,logic:Re,paramsToProps:function(n){var t=n.params.id;return{id:t&&t!=="new"?parseInt(t):"new",pageKey:0}}},_e=0;function pe(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=o.id,t=Object(le.useMemo)(function(){return _e++},[n]),a=Re({pageKey:t,id:n}),c=Object(B.useActions)(a),h=c.setCohort,u=c.saveCohort,v=c.deleteCohort,m=Object(B.useValues)(a),s=m.cohort,f=m.submitted,O=Object(B.useValues)(Xe.a),d=O.hasAvailableFeature,x=function(A){h(z(z({},s),{},{description:A}))},H=function(A){A===y.c?h(z(z({},s),{},{is_static:!0})):A===y.b&&h(z(z({},s),{},{is_static:!1}))},fe={name:"file",multiple:!1,fileList:s.csv?[s.csv]:[],beforeUpload:function(A){return h(z(z({},s),{},{csv:A})),!1},accept:".csv"},he=[{key:y.c,label:"Static",description:"Upload a list of users. Updates manually",icon:r.a.createElement(S.a,null)},{key:y.b,label:"Dynamic",description:"Cohort updates dynamically based on properties",icon:r.a.createElement(j.a,null)}],oe=function(){return r.a.createElement(Qe.a,{options:he,disabled:s.id!=="new",value:s.is_static?y.c:y.b,onValueChange:H})};return r.a.createElement("div",{className:"cohort"},r.a.createElement(ke.a,{title:s.id==="new"?"New cohort":s.name||"Untitled",buttons:r.a.createElement("div",{className:"flex-center"},s.id!=="new"&&r.a.createElement(Ne.a,{"data-attr":"delete-cohort",status:"danger",type:"secondary",onClick:function(){v()},style:{marginRight:16}},"Delete"),r.a.createElement(Ne.a,{type:"primary","data-attr":"save-cohort",htmlType:"submit",onClick:function(){u()}},"Save ",s.id==="new"?"cohort":"changes"))}),r.a.createElement(p.a,null),r.a.createElement(ae.a,{gutter:16},r.a.createElement(w.a,{md:14},r.a.createElement(q,{input:s.name,onChange:function(A){return h(z(z({},s),{},{name:A}))}})),r.a.createElement(w.a,{md:10},s.id==="new"?oe():r.a.createElement(K.a,{title:"Create a new cohort to use a different type of cohort."},r.a.createElement("div",null,oe())))),d(G.c.DASHBOARD_COLLABORATION)&&r.a.createElement(ae.a,{gutter:16,className:"mt"},r.a.createElement(w.a,{span:24},r.a.createElement(_,{description:s.description,onChange:x}))),s.id&&s.id!=="new"&&r.a.createElement(D,{cohort:s}),r.a.createElement(p.a,null),s.is_static?r.a.createElement("div",null,r.a.createElement("h3",{className:"l3"},"Add Users"),r.a.createElement("span",null,"Drop a ",r.a.createElement("pre",{style:{display:"inline"}},".csv")," file here to add users to your cohort"),r.a.createElement(b.a,Z()({},fe,{className:"cohort-csv-dragger"}),r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(R.a,null)),r.a.createElement("div",null,r.a.createElement("p",{className:"ant-upload-text"},"Click or drag file to this area to upload"),r.a.createElement("p",{className:"ant-upload-hint"},"The CSV file only requires a single column with the user\u2019s distinct ID."),f&&!s.csv&&r.a.createElement("p",{style:{color:"var(--danger)",marginTop:16}},"You need to upload a CSV file.")))):r.a.createElement(te,{logic:a}),s.id!=="new"&&r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,null),r.a.createElement("div",null,r.a.createElement("h3",{className:"l3"},"Matched Users"),r.a.createElement("span",null,"List of users that currently match the criteria defined"),s.is_calculating?r.a.createElement("div",{className:"cohort-recalculating flex-center"},r.a.createElement(Ze.a,{size:"sm",style:{marginRight:4}}),"We're recalculating who belongs to this cohort. This could take up to a couple of minutes."):r.a.createElement("div",{style:{marginTop:15}},r.a.createElement($.Persons,{cohort:s})))))}try{pe.displayName="Cohort",pe.__docgenInfo={description:"",displayName:"Cohort",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:'number | "new"'}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/Cohort.tsx#Cohort"]={docgenInfo:pe.__docgenInfo,name:"Cohort",path:"frontend/src/scenes/cohorts/Cohort.tsx#Cohort"})}catch(o){}},"./frontend/src/scenes/persons/Persons.scss":function(J,C,e){"use strict";var L=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),i=e.n(L),Q=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/persons/Persons.scss"),se=e.n(Q),Z={};Z.insert="head",Z.singleton=!1;var re=i()(se.a,Z),k=se.a.locals||{}},"./frontend/src/scenes/persons/Persons.tsx":function(J,C,e){"use strict";e.r(C),e.d(C,"scene",function(){return te}),e.d(C,"Persons",function(){return G});var L=e("./node_modules/react/index.js"),i=e.n(L),Q=e("./node_modules/kea/lib/index.esm.js"),se=e("./node_modules/core-js/modules/es.array.concat.js"),Z=e("./node_modules/core-js/modules/es.object.keys.js"),re=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),k=e.n(re),le=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),r=e("./frontend/src/lib/components/PropertiesTable.tsx"),B=e("./frontend/src/scenes/persons/Persons.scss"),ie=e("./frontend/src/lib/components/CopyToClipboard.tsx"),q=e("./frontend/src/scenes/persons/PersonHeader.tsx"),_=e("./frontend/src/lib/components/LemonTable/index.ts");function p(S){var j=S.people,R=S.loading,E=R===void 0?!1:R,b=S.hasPrevious,W=S.hasNext,T=S.loadPrevious,I=S.loadNext,D=S.compact,$=[{title:"Person",key:"person",render:function(N,P){return i.a.createElement(q.a,{withIcon:!0,person:P})}},{title:"ID",key:"id",render:function(N,P){return i.a.createElement("div",{style:{overflow:"hidden"}},P.distinct_ids.length&&i.a.createElement(ie.a,{explicitValue:P.distinct_ids[0],iconStyle:{color:"var(--primary)"},description:"person distinct ID"},P.distinct_ids[0]))}}].concat(k()(D?[]:[{title:"First seen",dataIndex:"created_at",render:function(N){return N?i.a.createElement(le.b,{time:N}):i.a.createElement(i.a.Fragment,null)}}]));return i.a.createElement(_.a,{columns:$,loading:E,rowKey:"id",pagination:{controlled:!0,pageSize:100,onForward:W?function(){I==null||I(),window.scrollTo(0,0)}:void 0,onBackward:b?function(){T==null||T(),window.scrollTo(0,0)}:void 0},expandable:{expandedRowRender:function(N){var P=N.properties;return Object.keys(P).length?i.a.createElement(r.a,{properties:P}):"This person has no properties."}},dataSource:j,emptyState:"No persons",nouns:["person","persons"]})}try{p.displayName="PersonsTable",p.__docgenInfo={description:"",displayName:"PersonsTable",props:{people:{defaultValue:null,description:"",name:"people",required:!0,type:{name:"PersonType[]"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}},hasPrevious:{defaultValue:null,description:"",name:"hasPrevious",required:!1,type:{name:"boolean"}},hasNext:{defaultValue:null,description:"",name:"hasNext",required:!1,type:{name:"boolean"}},loadPrevious:{defaultValue:null,description:"",name:"loadPrevious",required:!1,type:{name:"(() => void)"}},loadNext:{defaultValue:null,description:"",name:"loadNext",required:!1,type:{name:"(() => void)"}},compact:{defaultValue:null,description:"",name:"compact",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonsTable.tsx#PersonsTable"]={docgenInfo:p.__docgenInfo,name:"PersonsTable",path:"frontend/src/scenes/persons/PersonsTable.tsx#PersonsTable"})}catch(S){}var ae=e("./node_modules/antd/es/row/index.js"),w=e("./node_modules/antd/es/popconfirm/index.js"),K=e("./frontend/src/scenes/persons/personsLogic.ts"),Se=e("./node_modules/core-js/modules/es.regexp.exec.js"),ve=e("./node_modules/core-js/modules/es.string.search.js"),ce=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),Ee=e.n(ce),je=e("./node_modules/antd/es/input/index.js"),de=e("./frontend/src/lib/components/LemonRow/index.ts"),Y=e("./frontend/src/lib/components/icons.tsx"),g=function(j){var R=j.autoFocus,E=R===void 0?!0:R,b=Object(Q.useActions)(K.a),W=b.loadPersons,T=b.setListFilters,I=Object(Q.useValues)(K.a),D=I.listFilters,$=Object(L.useState)(""),X=Ee()($,2),N=X[0],P=X[1];return Object(L.useEffect)(function(){P(D.search||"")},[]),i.a.createElement("div",{style:{display:"flex",alignItems:"center",width:"min(100%, 24rem)"}},i.a.createElement(je.a.Search,{"data-attr":"persons-search",placeholder:"Search for persons",autoFocus:E,value:N,onChange:function(Oe){P(Oe.target.value),Oe.target.value||(T({search:void 0}),W())},enterButton:!0,allowClear:!0,onSearch:function(){T({search:N||void 0}),W()},style:{width:"100%"}}),i.a.createElement(de.a,{className:"ml-05",type:"stealth",tooltip:i.a.createElement(i.a.Fragment,null,"Search by email, name, ID, or even contents of properties. You can also search for persons who just ",i.a.createElement("i",null,"have"),' a property like so: "has:your_property".'),icon:i.a.createElement(Y.IconInfo,null)}))};try{g.displayName="PersonsSearch",g.__docgenInfo={description:"",displayName:"PersonsSearch",props:{autoFocus:{defaultValue:{value:"true"},description:"",name:"autoFocus",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"]={docgenInfo:g.__docgenInfo,name:"PersonsSearch",path:"frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"})}catch(S){}var ee=e("./frontend/src/scenes/persons/PersonPageHeader.tsx"),y=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),U=e("./frontend/src/lib/components/TaxonomicFilter/types.ts"),M=e("./frontend/src/lib/components/LemonButton/index.ts"),te={component:G,logic:K.a,paramsToProps:function(){return{syncWithUrl:!0}}};function G(){var S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=S.cohort,R={cohort:j==null?void 0:j.id,syncWithUrl:!j},E=Object(Q.useActions)(Object(K.a)(R)),b=E.loadPersons,W=E.setListFilters,T=E.exportCsv,I=Object(Q.useValues)(Object(K.a)(R)),D=I.persons,$=I.listFilters,X=I.personsLoading,N=I.exportUrl;return i.a.createElement(Q.BindLogic,{logic:K.a,props:R},i.a.createElement("div",{className:"persons-list"},!j&&i.a.createElement(ee.a,null),i.a.createElement(ae.a,{align:"middle",justify:"space-between",className:"mb-05",style:{gap:"0.75rem"}},i.a.createElement(g,{autoFocus:!j}),i.a.createElement("div",null,i.a.createElement(w.a,{placement:"topRight",title:i.a.createElement(i.a.Fragment,null,"Exporting by csv is limited to 10,000 users.",i.a.createElement("br",null),"To return more, please use"," ",i.a.createElement("a",{href:"https://posthog.com/docs/api/persons"},"the API"),". Do you want to export by CSV?"),onConfirm:T},N&&i.a.createElement(M.a,{type:"secondary",icon:i.a.createElement(Y.IconExport,{style:{color:"var(--primary)"}})},$.properties&&$.properties.length>0?i.a.createElement("div",{style:{display:"block"}},"Export (",i.a.createElement("strong",null,$.properties.length)," filter)"):"Export")))),i.a.createElement(y.a,{pageKey:"persons-list-page",propertyFilters:$.properties,onChange:function(ge){W({properties:ge}),b()},endpoint:"person",taxonomicGroupTypes:[U.a.PersonProperties,U.a.Cohorts],showConditionBadge:!0}),i.a.createElement(p,{people:D.results,loading:X,hasPrevious:!!D.previous,hasNext:!!D.next,loadPrevious:function(){return b(D.previous)},loadNext:function(){return b(D.next)}})))}try{G.displayName="Persons",G.__docgenInfo={description:"",displayName:"Persons",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!1,type:{name:"CohortType"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/Persons.tsx#Persons"]={docgenInfo:G.__docgenInfo,name:"Persons",path:"frontend/src/scenes/persons/Persons.tsx#Persons"})}catch(S){}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/lib/components/DropdownSelector/DropdownSelector.scss":function(J,C,e){var L=e("./node_modules/css-loader/dist/runtime/api.js");C=L(!1),C.push([J.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.dropdown-selector{padding:.5rem;border:1px solid rgba(0,0,0,.08);border-radius:4px;display:flex;align-items:center;cursor:pointer}.dropdown-selector.disabled{color:rgba(0,0,0,.5);cursor:not-allowed}.dropdown-selector.compact{padding:.3333333333rem .5rem}.dropdown-selector .dropdown-arrow{display:flex;align-items:center;padding-left:4px;font-size:1.2em;color:#747ea1}",""]),J.exports=C},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/persons/Persons.scss":function(J,C,e){var L=e("./node_modules/css-loader/dist/runtime/api.js");C=L(!1),C.push([J.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.extra-ids{display:inline-flex;align-items:center;height:1.25rem;line-height:1.125rem;margin:0 0 0 .25rem;padding:0 .25rem 0 .375rem;color:#5375ff;cursor:pointer}.extra-ids svg{margin-left:.25rem}",""]),J.exports=C}}]);
