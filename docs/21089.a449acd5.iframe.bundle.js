"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[21089],{"./frontend/src/lib/hooks/useAsyncHandler.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>useAsyncHandler});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js");function useAsyncHandler(onEvent){let[loading,setLoading]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),onEventWrapper=onEvent?e=>{if(onEvent){let result=onEvent(e);result instanceof Promise&&(setLoading(!0),result.finally(()=>setLoading(!1)))}}:void 0;return{loading:loading,onEvent:onEventWrapper}}},"./frontend/src/scenes/session-recordings/SessionRecordings.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SessionsRecordings:()=>SessionsRecordings,scene:()=>scene});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.8.5_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.2.0_kea@3.1.5/node_modules/kea-router/lib/index.js"),authorizedUrlListLogic=__webpack_require__("./frontend/src/lib/components/AuthorizedUrlList/authorizedUrlListLogic.ts"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),upgradeModalLogic=__webpack_require__("./frontend/src/lib/components/UpgradeModal/upgradeModalLogic.ts"),VersionCheckerBanner=__webpack_require__("./frontend/src/lib/components/VersionChecker/VersionCheckerBanner.tsx"),useAsyncHandler=__webpack_require__("./frontend/src/lib/hooks/useAsyncHandler.ts"),LemonBanner=__webpack_require__("./frontend/src/lib/lemon-ui/LemonBanner/index.ts"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/Spinner.tsx"),eventUsageLogic=__webpack_require__("./frontend/src/lib/utils/eventUsageLogic.ts"),NotebookSelectButton=__webpack_require__("./frontend/src/scenes/notebooks/NotebookSelectButton/NotebookSelectButton.tsx"),sessionRecordingsPlaylistLogic=__webpack_require__("./frontend/src/scenes/session-recordings/playlist/sessionRecordingsPlaylistLogic.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),sidePanelSettingsLogic=__webpack_require__("./frontend/src/layout/navigation-3000/sidepanel/panels/sidePanelSettingsLogic.tsx"),types=__webpack_require__("./frontend/src/types.ts"),esm_exports=__webpack_require__("./node_modules/.pnpm/@sentry+core@7.112.1/node_modules/@sentry/core/esm/exports.js"),JSONViewer=__webpack_require__("./frontend/src/lib/components/JSONViewer.tsx"),Sparkline=__webpack_require__("./frontend/src/lib/components/Sparkline.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),sessionPlayerModalLogic=__webpack_require__("./frontend/src/scenes/session-recordings/player/modal/sessionPlayerModalLogic.ts"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),playlistUtils=__webpack_require__("./frontend/src/scenes/session-recordings/playlist/playlistUtils.ts");let sessionRecordingErrorsLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","session-recordings","detail","sessionRecordingErrorsLogic"]),(0,index_esm.actions)({createPlaylist:(name,sessionIds)=>({name,sessionIds})}),(0,kea_loaders_lib.loaders)(()=>({errors:[null,{loadErrorClusters:async function(){let refresh=!(arguments.length>0)||void 0===arguments[0]||arguments[0],response=await api.ZP.recordings.errorClusters(refresh);return response}}]})),(0,index_esm.listeners)(()=>({createPlaylist:async _ref=>{let{name,sessionIds}=_ref,playlist=await (0,playlistUtils.cg)({name:name});if(playlist){let samples=sessionIds.slice(0,10);await Promise.all(samples.map(sessionId=>api.ZP.recordings.addRecordingToPlaylist(playlist.short_id,sessionId))),lib.router.actions.push(urls.j.replayPlaylist(playlist.short_id))}}})),(0,index_esm.afterMount)(_ref2=>{let{actions}=_ref2;actions.loadErrorClusters(!1)})]);var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function SessionRecordingErrors(){let{openSessionPlayer}=(0,index_esm.useActions)(sessionPlayerModalLogic.A),{errors,errorsLoading}=(0,index_esm.useValues)(sessionRecordingErrorsLogic),{loadErrorClusters,createPlaylist}=(0,index_esm.useActions)(sessionRecordingErrorsLogic);return errors||errorsLoading?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.g3,{columns:[{title:"Error",dataIndex:"cluster",render:(_,cluster)=>{let displayTitle=parseTitle(cluster.sample);return(0,jsx_runtime.jsx)("div",{title:displayTitle,className:"font-semibold text-sm text-text-3000 line-clamp-1",children:displayTitle})},width:"50%"},{title:"",render:(_,cluster)=>(0,jsx_runtime.jsx)(Sparkline.b,{className:"h-8",labels:Object.keys(cluster.sparkline),data:Object.values(cluster.sparkline)})},{title:"Occurrences",dataIndex:"occurrences",sorter:(a,b)=>a.occurrences-b.occurrences},{title:"Sessions",dataIndex:"unique_sessions",sorter:(a,b)=>a.unique_sessions-b.unique_sessions},{title:"Viewed",tooltip:"How many of these you've already viewed",dataIndex:"viewed",render:function Render(_,cluster){return`${(cluster.viewed/cluster.unique_sessions*100).toFixed(0)}%`},sorter:(a,b)=>a.viewed/a.unique_sessions-b.viewed/b.unique_sessions},{title:"Actions",render:function Render(_,cluster){return(0,jsx_runtime.jsxs)("div",{className:"p-2 flex space-x-2",children:[(0,jsx_runtime.jsx)(src.Jp,{to:urls.j.replaySingle(cluster.session_ids[0]),onClick:e=>{e.preventDefault(),openSessionPlayer({id:cluster.session_ids[0]})},className:"whitespace-nowrap",type:"primary",children:"Watch example"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{createPlaylist(`Examples of '${parseTitle(cluster.sample)}'`,cluster.session_ids)},className:"whitespace-nowrap",type:"secondary",tooltip:"Create a playlist of recordings containing this issue",children:"Create playlist"})]})}}],loading:errorsLoading,dataSource:errors||[],expandable:{expandedRowRender:cluster=>(0,jsx_runtime.jsx)(ExpandedError,{error:cluster.sample})}})}):(0,jsx_runtime.jsx)(src.Jp,{size:"large",type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFeatures,{}),onClick:()=>loadErrorClusters(),children:"Automagically find errors"})}let ExpandedError=_ref=>{let{error}=_ref,hasJson=function(str){try{return JSON.parse(str),!0}catch{return!1}}(error),[activeTab,setActiveTab]=(0,react.useState)(hasJson?"json":"raw");return hasJson?(0,jsx_runtime.jsx)("div",{className:"pb-3",children:(0,jsx_runtime.jsx)(src.TP,{activeKey:activeTab,onChange:setActiveTab,tabs:[hasJson&&{key:"json",label:"JSON",content:(0,jsx_runtime.jsx)(JSONViewer.C,{src:JSON.parse(error),style:{whiteSpace:"pre-wrap"}})},{key:"raw",label:"Raw",content:(0,jsx_runtime.jsx)("span",{className:"whitespace-pre-line",children:error})}]})}):(0,jsx_runtime.jsxs)("div",{className:"py-3 space-y-1",children:[(0,jsx_runtime.jsx)("h3",{children:"Example error"}),(0,jsx_runtime.jsx)("div",{className:"whitespace-pre-line",children:error})]})};function parseTitle(error){let input;try{let parsedError=JSON.parse(error);input=parsedError.error||error}catch{input=error}if(!input)return error;try{return"string"!=typeof input&&(input=JSON.stringify(input)),input.split("\n")[0].trim().substring(0,75)||error}catch(e){return(0,esm_exports.Tb)(e,{extra:{error},tags:{feature:"replay/error-clustering"}}),error}}var SessionRecordingsPlaylist=__webpack_require__("./frontend/src/scenes/session-recordings/playlist/SessionRecordingsPlaylist.tsx"),apps_common_src=__webpack_require__("./frontend/@posthog/apps-common/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),DateFilter=__webpack_require__("./frontend/src/lib/components/DateFilter/DateFilter.tsx"),MemberSelect=__webpack_require__("./frontend/src/lib/components/MemberSelect.tsx"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),columnUtils=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/columnUtils.tsx"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),router_utils=__webpack_require__("./frontend/src/lib/utils/router-utils.ts");let DEFAULT_PLAYLIST_FILTERS={createdBy:"All users",page:1,dateFrom:"all"},savedSessionRecordingPlaylistsLogic=(0,index_esm.kea)([(0,index_esm.path)(key=>["scenes","session-recordings","saved-playlists","savedSessionRecordingPlaylistsLogic",key]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.tab),(0,index_esm.connect)({actions:[eventUsageLogic.vx,["reportRecordingPlaylistCreated"]]}),(0,index_esm.actions)(()=>({setSavedPlaylistsFilters:filters=>({filters}),loadPlaylists:!0,updatePlaylist:(shortId,properties)=>({shortId,properties}),deletePlaylist:playlist=>({playlist}),duplicatePlaylist:playlist=>({playlist})})),(0,index_esm.reducers)(()=>({filters:[DEFAULT_PLAYLIST_FILTERS,{setSavedPlaylistsFilters:(state,_ref)=>{let{filters}=_ref;return(0,utils.hO)({...state||{},...filters,..."page"in filters?{}:{page:1}})}}],loadPlaylistsFailed:[!1,{loadPlaylists:()=>!1,loadPlaylistsSuccess:()=>!1,loadPlaylistsFailure:()=>!0}]})),(0,kea_loaders_lib.loaders)(_ref2=>{let{values,actions}=_ref2;return{playlists:{__default:{results:[],count:0,filters:null},loadPlaylists:async(_,breakpoint)=>{var _filters$order,_filters$dateTo;null!==values.playlists.filters&&await breakpoint(300);let filters={...values.filters},createdBy="All users"===filters.createdBy?void 0:filters.createdBy,params={limit:30,offset:Math.max(0,(filters.page-1)*30),order:null!==(_filters$order=filters.order)&&void 0!==_filters$order?_filters$order:"-last_modified_at",created_by:null!=createdBy?createdBy:void 0,search:filters.search||void 0,date_from:filters.dateFrom&&"all"!=filters.dateFrom?filters.dateFrom:void 0,date_to:null!==(_filters$dateTo=filters.dateTo)&&void 0!==_filters$dateTo?_filters$dateTo:void 0,pinned:!!filters.pinned||void 0},response=await api.ZP.recordings.listPlaylists((0,utils.oZ)(params));return breakpoint(),response},updatePlaylist:async(_ref3,breakpoint)=>{let{shortId,properties}=_ref3;await breakpoint(100);let updatedPlaylist=await api.ZP.recordings.updatePlaylist(shortId,properties);breakpoint();let index=values.playlists.results.findIndex(x=>x.short_id===updatedPlaylist.short_id);return index>-1&&(values.playlists.results[index]=updatedPlaylist),{...values.playlists,results:[...values.playlists.results]}},deletePlaylist:async _ref4=>{let{playlist}=_ref4;return await (0,playlistUtils.l8)(playlist,()=>actions.loadPlaylists()),values.playlists.results=values.playlists.results.filter(x=>x.short_id!==playlist.short_id),values.playlists},duplicatePlaylist:async(_ref5,breakpoint)=>{let{playlist}=_ref5;await breakpoint(100);let{id,short_id,...partialPlaylist}=playlist;partialPlaylist.name=partialPlaylist.name?partialPlaylist.name+" (copy)":"";let newPlaylist=await (0,playlistUtils.cg)(partialPlaylist);return actions.reportRecordingPlaylistCreated("duplicate"),breakpoint(),newPlaylist&&(src.UJ.success("Playlist duplicated successfully"),values.playlists.results=[newPlaylist,...values.playlists.results]),values.playlists}}}}),(0,index_esm.listeners)(_ref6=>{let{actions}=_ref6;return{setSavedPlaylistsFilters:()=>{actions.loadPlaylists()}}}),(0,index_esm.selectors)(_ref7=>{let{actions}=_ref7;return{sorting:[s=>[s.filters],filters=>filters.order?filters.order.startsWith("-")?{columnKey:filters.order.slice(1),order:-1}:{columnKey:filters.order,order:1}:{columnKey:"last_modified_at",order:-1}],pagination:[s=>[s.filters,s.playlists],(filters,playlists)=>({controlled:!0,pageSize:30,currentPage:filters.page,entryCount:playlists.count,onBackward:playlists.previous?()=>actions.setSavedPlaylistsFilters({page:filters.page-1}):void 0,onForward:playlists.next?()=>actions.setSavedPlaylistsFilters({page:filters.page+1}):void 0})]}}),(0,lib.actionToUrl)(_ref8=>{let{values}=_ref8,changeUrl=()=>{if((0,router_utils.sv)(lib.router.values.location.pathname)===urls.j.replay(types.yd.Playlists)){let nextValues=values.filters,urlValues=(0,utils.hO)(lib.router.values.searchParams);if(!(0,utils.h0)(nextValues,urlValues))return[urls.j.replay(types.yd.Playlists),nextValues,{},{replace:!1}]}};return{loadPlaylists:changeUrl,setSavedPlaylistsFilters:changeUrl}}),(0,lib.urlToAction)(_ref9=>{let{actions,values}=_ref9;return{[urls.j.replay(types.yd.Playlists)]:(_,searchParams)=>{let currentFilters=values.filters,nextFilters=(0,utils.hO)(searchParams);(0,utils.h0)(currentFilters,nextFilters)||actions.setSavedPlaylistsFilters(nextFilters)}}}),(0,index_esm.afterMount)(_ref10=>{let{actions}=_ref10;actions.loadPlaylists()})]);function SavedSessionRecordingPlaylistsEmptyState(){let{guardAvailableFeature}=(0,index_esm.useValues)(upgradeModalLogic.J),playlistsLogic=savedSessionRecordingPlaylistsLogic({tab:types.yd.Home}),{playlists,loadPlaylistsFailed}=(0,index_esm.useValues)(playlistsLogic);return loadPlaylistsFailed?(0,jsx_runtime.jsx)(LemonBanner.V,{type:"error",children:"Error while trying to load playlist."}):(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-center",children:(0,jsx_runtime.jsxs)("div",{className:"max-w-248 mt-12 flex flex-col items-center",children:[(0,jsx_runtime.jsx)("h2",{className:"text-xl",children:"There are no playlists that match these filters"}),(0,jsx_runtime.jsx)("p",{className:"text-muted",children:"Once you create a playlist, it will show up here."}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"primary","data-attr":"add-session-playlist-button-empty-state",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>guardAvailableFeature(types.P$.RECORDINGS_PLAYLISTS,()=>void(0,playlistUtils.cg)({},!0),{currentUsage:playlists.count}),children:"New playlist"})]})})}function SavedSessionRecordingPlaylists(_ref2){let{tab}=_ref2,logic=savedSessionRecordingPlaylistsLogic({tab}),{playlists,playlistsLoading,filters,sorting,pagination}=(0,index_esm.useValues)(logic),{setSavedPlaylistsFilters,updatePlaylist,duplicatePlaylist,deletePlaylist}=(0,index_esm.useActions)(logic),columns=[{width:0,dataIndex:"pinned",render:function Render(pinned,_ref3){let{short_id}=_ref3;return(0,jsx_runtime.jsx)(src.Jp,{size:"small",onClick:()=>updatePlaylist(short_id,{pinned:!pinned}),icon:pinned?(0,jsx_runtime.jsx)(posthog_icons_es.IconPinFilled,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPin,{})})}},{title:"Name",dataIndex:"name",render:function Render(name,_ref){let{short_id,derived_name,description}=_ref;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.rU,{className:(0,clsx_m.default)("font-semibold",!name&&"italic"),to:urls.j.replayPlaylist(short_id),children:name||derived_name||"Unnamed"}),description?(0,jsx_runtime.jsx)("div",{className:"truncate",children:description}):null]})}},{...(0,columnUtils.JB)(),width:0},{title:"Last modified",sorter:!0,dataIndex:"last_modified_at",width:0,render:function Render(last_modified_at){return(0,jsx_runtime.jsx)("div",{children:last_modified_at&&"string"==typeof last_modified_at&&(0,jsx_runtime.jsx)(apps_common_src.w4,{time:last_modified_at})})}},{width:0,render:function Render(_,playlist){return(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>duplicatePlaylist(playlist),fullWidth:!0,"data-attr":"duplicate-playlist",loading:playlistsLoading,children:"Duplicate"}),(0,jsx_runtime.jsx)(src.p2,{}),(0,jsx_runtime.jsx)(src.Jp,{status:"danger",onClick:()=>deletePlaylist(playlist),fullWidth:!0,loading:playlistsLoading,children:"Delete playlist"})]})})}}];return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between gap-2 mb-2 items-center flex-wrap",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search for playlists",onChange:value=>setSavedPlaylistsFilters({search:value||void 0}),value:filters.search||""}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center gap-2",children:(0,jsx_runtime.jsx)(src.Jp,{"data-attr":"session-recording-playlist-pinned-filter",active:filters.pinned,size:"small",type:"secondary",status:"alt",center:!0,onClick:()=>setSavedPlaylistsFilters({pinned:!filters.pinned}),icon:filters.pinned?(0,jsx_runtime.jsx)(posthog_icons_es.IconPinFilled,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPin,{}),children:"Pinned"})}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Last modified:"}),(0,jsx_runtime.jsx)(DateFilter.f,{disabled:!1,dateFrom:filters.dateFrom,dateTo:filters.dateTo,onChange:(fromDate,toDate)=>setSavedPlaylistsFilters({dateFrom:fromDate,dateTo:null!=toDate?toDate:void 0}),makeLabel:key=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCalendar,{}),(0,jsx_runtime.jsxs)("span",{className:"hide-when-small",children:[" ",key]})]}),max:21})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Created by:"}),(0,jsx_runtime.jsx)(MemberSelect.a,{value:"All users"===filters.createdBy?null:filters.createdBy,onChange:user=>setSavedPlaylistsFilters({createdBy:user?.id||"All users"})})]})]})]}),!playlistsLoading&&playlists.count<1?(0,jsx_runtime.jsx)(SavedSessionRecordingPlaylistsEmptyState,{}):(0,jsx_runtime.jsx)(src.g3,{loading:playlistsLoading,columns:columns,dataSource:playlists.results,pagination:pagination,noSortingCancellation:!0,sorting:sorting,onSort:newSorting=>setSavedPlaylistsFilters({order:newSorting?`${-1===newSorting.order?"-":""}${newSorting.columnKey}`:void 0}),rowKey:"id",loadingSkeletonRows:30,nouns:["playlist","playlists"]})]})}var sessionReplaySceneLogic=__webpack_require__("./frontend/src/scenes/session-recordings/sessionReplaySceneLogic.ts"),TaxonomicFilter_types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),UniversalFilters=__webpack_require__("./frontend/src/lib/components/UniversalFilters/UniversalFilters.tsx"),universalFiltersLogic=__webpack_require__("./frontend/src/lib/components/UniversalFilters/universalFiltersLogic.ts"),UniversalFilters_utils=__webpack_require__("./frontend/src/lib/components/UniversalFilters/utils.ts"),actionsModel=__webpack_require__("./frontend/src/models/actionsModel.ts");let replayTemplates=[{key:"signup-flow",name:"Signup flow",description:"Watch how users sign up for your website. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Signup page URL",key:"signup-page-url",value:"/signup",description:"Complete or partial URL"}],categories:["B2B"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconUser,{})},{key:"pricing-page",name:"Pricing page",description:"Watch how users navigate your pricing page. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Pricing page URL",key:"pricing-page-url",description:"Complete or partial URL"}],categories:["B2B"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconHandMoney,{})},{key:"upgrade-flow",name:"Upgrade / subscribe flow",description:"Watch how users upgrade to the paid plan on your website. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Upgrade / subscribe page URL",key:"upgrade-subscribe-page-url",description:"Complete or partial URL"},{type:"event",name:"Upgrade / subscribe event",key:"upgrade-subscribe-event",description:"The event that triggers the upgrade / subscribe flow."}],categories:["B2B"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconHandMoney,{})},{key:"onboarding-flow",name:"Onboarding flow",description:"Watch how users onboard to your website. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Onboarding page URL",key:"onboarding-page-url",description:"Complete or partial URL"}],categories:["B2B"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconApp,{})},{key:"feature-usage",name:"Feature usage",description:"Think of a feature you want to improve. Watch how users interact with it, and see where they get stuck.",variables:[{type:"event",name:"Feature event",key:"feature-event",description:"The event that indicates a user has interacted with the feature."},{type:"pageview",name:"Feature page URL",key:"feature-page-url",description:"Complete or partial URL where the feature is located."}],categories:["B2B","B2C"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCursorClick,{})},{key:"purchase-flow",name:"Purchase flow",description:"Watch how users purchase from your website. Look for any areas or steps that cause friction.",variables:[{type:"pageview",name:"Purchase page URL",key:"purchase-page-url",description:"Complete or partial URL"}],categories:["B2C"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconHandMoney,{})},{key:"product-search",name:"Product search",description:"Watch how users search for products on your website. Look for any areas or steps that cause friction.",variables:[{type:"event",name:"Product search event",key:"product-search-event",description:"The event that indicates a user has searched for something on your website."}],categories:["B2C"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconSearch,{})},{key:"experiment",name:"A/B test results",description:"Watch how users interact with your A/B test. Look for any areas or steps that cause friction.",variables:[{type:"flag",name:"Feature flag",key:"feature-flag",description:"The feature flag that you want to observe."}],categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconFlag,{})},{key:"rageclicks",name:"Rageclicks",description:'See where users are "rageclicking" on your website to find things that don\'t work as expected.',variables:[{type:"event",name:"Rageclick event",key:"rageclick-event",description:'The event that indicates a user has "rageclicked" on your website.',noTouch:!0,filterGroup:{id:"$rageclick",name:"$rageclick",type:TaxonomicFilter_types.t.Events}}],categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconThumbsDown,{})},{key:"scattershot",name:"Scattershot",description:"Watch all recent replays, and see where users are getting stuck.",variables:[],categories:["More"],order:"start_time",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconVideoCamera,{})},{key:"person-property",name:"Person property",description:"Watch all replays for users with a specific property, like a specific email address.",variables:[{type:"person-property",name:"Person property",key:"person-property",description:"The person property that you want to observe."}],categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconUser,{})},{key:"mobile-devices",name:"Mobile devices",description:"Watch replays from mobile device web browsers to look for problems with your responsive design.",variables:[{type:"snapshot_source",name:"Mobile device",key:"mobile-device",description:"Users who used your website on a mobile device.",noTouch:!0,filterGroup:{id:"$pageview",name:"$pageview",type:"events",properties:[{key:"$screen_width",value:"600",operator:types.WV.LessThan,type:types.FT.Event}]}}],categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPhone,{})},{key:"activity-score",name:"Most active users",description:"Watch recordings of the most active sessions. Lots of valuable insights, guaranteed!",order:"activity_score",categories:["More"],icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCursorClick,{})}];var dist_module=__webpack_require__("./node_modules/.pnpm/posthog-js@1.184.0/node_modules/posthog-js/dist/module.js");let getPageviewFilterValue=pageview=>({key:"visited_page",value:pageview,operator:types.WV.IContains,type:types.FT.Recording}),getFlagFilterValue=flag=>({id:"$feature_flag_called",name:"$feature_flag_called",type:"events",properties:[{key:`$feature/${flag}`,type:types.FT.Event,value:["false"],operator:types.WV.IsNot},{key:`$feature/${flag}`,type:types.FT.Event,value:"is_set",operator:types.WV.IsSet},{key:"$feature_flag",type:types.FT.Event,value:flag,operator:types.WV.Exact}]}),sessionReplayTemplatesLogic=(0,index_esm.kea)([(0,index_esm.path)(()=>["scenes","session-recordings","templates","sessionReplayTemplatesLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>`${props.category}-${props.template.key}`),(0,index_esm.connect)({values:[teamLogic.H,["currentTeam"]]}),(0,index_esm.actions)({setVariables:variables=>({variables}),setVariable:variable=>({variable}),resetVariable:variable=>({variable}),navigate:!0,showVariables:!0,hideVariables:!0}),(0,index_esm.reducers)(_ref=>{var _props$template$varia;let{props,values}=_ref;return{variables:[null!==(_props$template$varia=props.template.variables)&&void 0!==_props$template$varia?_props$template$varia:[],{persist:!0,storageKey:(0,clsx_m.default)("session-recordings.templates.variables",values.currentTeam?.id,props.category,props.template.key)},{setVariables:(_,_ref2)=>{let{variables}=_ref2;return null!=variables?variables:[]},setVariable:(state,_ref3)=>{let{variable}=_ref3;return state.map(v=>v.key===variable.key?{...variable,touched:!0}:v)},resetVariable:(state,_ref4)=>{let{variable}=_ref4;return state.map(v=>v.key===variable.key?{...variable,touched:!1}:v)}}],variablesVisible:[!1,{showVariables:()=>!0,hideVariables:()=>!1}]}}),(0,index_esm.selectors)({filterGroup:[s=>[s.variables],variables=>{let filters=variables.map(variable=>"pageview"===variable.type&&variable.value?getPageviewFilterValue(variable.value):"flag"===variable.type&&variable.value?getFlagFilterValue(variable.value):["snapshot_source","event","person-property"].includes(variable.type)&&variable.filterGroup?variable.filterGroup:void 0).filter(filter=>void 0!==filter),filterGroup={filter_group:{type:types.J2.And,values:[{type:types.J2.And,values:filters}]}};return filterGroup}],canApplyFilters:[s=>[s.variables,s.areAnyVariablesTouched],(variables,areAnyVariablesTouched)=>areAnyVariablesTouched||0===variables.length],areAnyVariablesTouched:[s=>[s.variables],variables=>variables.some(v=>v.touched)||variables.some(v=>v.noTouch)],editableVariables:[s=>[s.variables],variables=>variables.filter(v=>!v.noTouch)]}),(0,index_esm.listeners)(_ref5=>{let{values,props}=_ref5;return{navigate:()=>{dist_module.ZP.capture("session replay template used",{template:props.template.key,category:props.category});let filterGroup=values.variables.length>0?values.filterGroup:void 0;lib.router.actions.push(urls.j.replay(types.yd.Home,filterGroup,void 0,props.template.order))}}}),(0,index_esm.events)(_ref6=>{let{actions,props,values}=_ref6;return{afterMount:()=>{0===values.variables.length&&actions.setVariables(props.template.variables)}}})]),allCategories=replayTemplates.flatMap(template=>template.categories).filter((category,index,self1)=>self1.indexOf(category)===index),NestedFilterGroup=_ref=>{let{rootKey,buttonTitle,selectOne}=_ref,{filterGroup}=(0,index_esm.useValues)(universalFiltersLogic.d),{replaceGroupValue,removeGroupValue}=(0,index_esm.useActions)(universalFiltersLogic.d);return(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"inline-flex flex-col gap-2",children:[filterGroup.values.map((filterOrGroup,index)=>(0,UniversalFilters_utils.pU)(filterOrGroup)?(0,jsx_runtime.jsx)(UniversalFilters.Z.Group,{index:index,group:filterOrGroup,children:(0,jsx_runtime.jsx)(NestedFilterGroup,{rootKey:rootKey})},index):(0,jsx_runtime.jsx)(UniversalFilters.Z.Value,{index:index,filter:filterOrGroup,onRemove:()=>removeGroupValue(index),onChange:value=>replaceGroupValue(index,value)},index)),!selectOne||selectOne&&0===filterGroup.values.length?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(UniversalFilters.Z.AddFilterButton,{title:buttonTitle,type:"secondary",size:"xsmall"})}):null]})})},SingleTemplateVariable=_ref2=>{let{variable,...props}=_ref2,{setVariable,resetVariable}=(0,index_esm.useActions)(sessionReplayTemplatesLogic(props));return(0,index_esm.useMountedLogic)(actionsModel.D),"pageview"===variable.type?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{info:variable.description,children:variable.name}),(0,jsx_runtime.jsx)(src.DF,{placeholder:variable.value,value:variable.value,onChange:e=>e?setVariable({...variable,value:e}):resetVariable({...variable,value:void 0}),size:"small"})]}):["event","flag","person-property"].includes(variable.type)?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(src.HQ,{info:variable.description,children:variable.name}),(0,jsx_runtime.jsx)(UniversalFilters.Z,{rootKey:`session-recordings-${variable.key}`,group:{type:types.J2.And,values:variable.filterGroup?[variable.filterGroup]:[]},taxonomicGroupTypes:"event"===variable.type?[TaxonomicFilter_types.t.Events,TaxonomicFilter_types.t.Actions]:"flag"===variable.type?[TaxonomicFilter_types.t.FeatureFlags]:"person-property"===variable.type?[TaxonomicFilter_types.t.PersonProperties]:[],onChange:thisFilterGroup=>{0===thisFilterGroup.values.length?resetVariable({...variable,filterGroup:void 0}):"flag"===variable.type?setVariable({...variable,value:thisFilterGroup.values[0].key}):setVariable({...variable,filterGroup:thisFilterGroup.values[0]})},children:(0,jsx_runtime.jsx)(NestedFilterGroup,{rootKey:"session-recordings",buttonTitle:`Select ${"event"===variable.type?"event":"flag"===variable.type?"flag":"person property"}`,selectOne:"flag"==variable.type})})]}):null},TemplateVariables=props=>{let{navigate}=(0,index_esm.useActions)(sessionReplayTemplatesLogic(props)),{variables,canApplyFilters}=(0,index_esm.useValues)(sessionReplayTemplatesLogic(props));return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[variables.filter(v=>!v.noTouch).map(variable=>(0,jsx_runtime.jsx)(SingleTemplateVariable,{variable:variable,...props},variable.key)),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>navigate(),type:"primary",className:"mt-2",disabledReason:canApplyFilters?void 0:"Please set a value for at least one variable",children:"Apply filters"})})]})},RecordingTemplateCard=props=>{let{showVariables,hideVariables}=(0,index_esm.useActions)(sessionReplayTemplatesLogic(props)),{variablesVisible}=(0,index_esm.useValues)(sessionReplayTemplatesLogic(props));return(0,jsx_runtime.jsx)(src.Mi,{className:"w-80",onClick:()=>{showVariables()},closeable:variablesVisible,onClose:hideVariables,focused:variablesVisible,"data-attr":"session-replay-template","data-ph-capture-attribute-category":props.category,"data-ph-capture-attribute-template":props.template.key,children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[props.template.icon&&(0,jsx_runtime.jsx)("div",{className:"bg-accent-3000 rounded p-2 w-8 h-8 flex items-center justify-center",children:props.template.icon}),(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:(0,jsx_runtime.jsx)(src.rU,{onClick:()=>showVariables(),className:"text-primary",children:props.template.name})})]}),(0,jsx_runtime.jsx)("p",{children:props.template.description}),variablesVisible?(0,jsx_runtime.jsx)(TemplateVariables,{...props}):null]})})},templates_SessionRecordingTemplates=()=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Figure out what to watch"}),(0,jsx_runtime.jsx)("p",{children:"To get the most out of session replay, you just need to know where to start. "}),(0,jsx_runtime.jsx)("p",{children:"Use our templates to find a focus area, then watch the filtered replays to see where users struggle, what could be made more clear, and other ways to improve."}),allCategories.map(category=>(0,jsx_runtime.jsxs)("div",{className:"mb-6",children:[(0,jsx_runtime.jsx)("h2",{children:category}),(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap gap-2",children:replayTemplates.filter(template=>template.categories.includes(category)).map(template=>(0,jsx_runtime.jsx)(RecordingTemplateCard,{template:template,category:category},template.key))})]},`replay-template-category-${category}`))]});function Header(){let{guardAvailableFeature}=(0,index_esm.useValues)(upgradeModalLogic.J),playlistsLogic=savedSessionRecordingPlaylistsLogic({tab:types.yd.Home}),{playlists}=(0,index_esm.useValues)(playlistsLogic),{tab}=(0,index_esm.useValues)(sessionReplaySceneLogic.fk),{currentTeam}=(0,index_esm.useValues)(teamLogic.H),recordingsDisabled=currentTeam&&!currentTeam?.session_recording_opt_in,{reportRecordingPlaylistCreated}=(0,index_esm.useActions)(eventUsageLogic.vx),{openSettingsPanel}=(0,index_esm.useActions)(sidePanelSettingsLogic.A),{filters,totalFiltersCount}=(0,index_esm.useValues)((0,sessionRecordingsPlaylistLogic.YV)({updateSearchParams:!0})),saveFiltersPlaylistHandler=(0,useAsyncHandler.N)(async()=>{await (0,playlistUtils.cg)({filters},!0),reportRecordingPlaylistCreated("filters")}),newPlaylistHandler=(0,useAsyncHandler.N)(async()=>{await (0,playlistUtils.cg)({},!0),reportRecordingPlaylistCreated("new")});return(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[tab===types.yd.Home&&!recordingsDisabled&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.d6,{items:[{label:"Playback from file",to:urls.j.replayFilePlayback()}],children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconEllipsis,{})})}),(0,jsx_runtime.jsx)(NotebookSelectButton.R,{resource:{type:types.Cz.RecordingPlaylist,attrs:{filters:filters}},type:"secondary"}),(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!1,"data-attr":"session-recordings-filters-save-as-playlist",type:"primary",onClick:e=>guardAvailableFeature(types.P$.RECORDINGS_PLAYLISTS,()=>{0===totalFiltersCount?newPlaylistHandler.onEvent?.(e):saveFiltersPlaylistHandler.onEvent?.(e)},{currentUsage:playlists.count}),children:"Save as playlist"}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>openSettingsPanel({sectionId:"project-replay"}),children:"Configure"})]}),tab===types.yd.Playlists&&(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:e=>guardAvailableFeature(types.P$.RECORDINGS_PLAYLISTS,()=>newPlaylistHandler.onEvent?.(e),{currentUsage:playlists.count}),"data-attr":"save-recordings-playlist-button",loading:newPlaylistHandler.loading,children:"New playlist"})]})})}function Warnings(){let{currentTeam}=(0,index_esm.useValues)(teamLogic.H),recordingsDisabled=currentTeam&&!currentTeam?.session_recording_opt_in,{openSettingsPanel}=(0,index_esm.useActions)(sidePanelSettingsLogic.A),theAuthorizedUrlsLogic=(0,authorizedUrlListLogic.zl)({...authorizedUrlListLogic.P1,type:authorizedUrlListLogic.uw.RECORDING_DOMAINS}),{suggestions,authorizedUrls}=(0,index_esm.useValues)(theAuthorizedUrlsLogic),mightBeRefusingRecordings=suggestions.length>0&&authorizedUrls.length>0;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(VersionCheckerBanner.o,{}),recordingsDisabled?(0,jsx_runtime.jsx)(LemonBanner.V,{type:"info",action:{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>openSettingsPanel({sectionId:"project-replay"}),children:"Configure"},children:"Session recordings are currently disabled for this project."}):null,!recordingsDisabled&&mightBeRefusingRecordings?(0,jsx_runtime.jsx)(LemonBanner.V,{type:"warning",action:{type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>openSettingsPanel({sectionId:"project-replay"}),children:"Configure"},dismissKey:`session-recordings-authorized-domains-warning/${suggestions.join(",")}`,children:"You have unauthorized domains trying to send recordings. To accept recordings from these domains, please check your config."}):null]})}function MainPanel(){let{tab}=(0,index_esm.useValues)(sessionReplaySceneLogic.fk);return(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)(Warnings,{}),tab?tab===types.yd.Home?(0,jsx_runtime.jsx)("div",{className:"SessionRecordingPlaylistHeightWrapper",children:(0,jsx_runtime.jsx)(SessionRecordingsPlaylist.m,{updateSearchParams:!0})}):tab===types.yd.Playlists?(0,jsx_runtime.jsx)(SavedSessionRecordingPlaylists,{tab:types.yd.Playlists}):tab===types.yd.Errors?(0,jsx_runtime.jsx)(SessionRecordingErrors,{}):tab===types.yd.Templates?(0,jsx_runtime.jsx)(templates_SessionRecordingTemplates,{}):null:(0,jsx_runtime.jsx)(Spinner.$,{})]})}function PageTabs(){let{tab,tabs,shouldShowNewBadge}=(0,index_esm.useValues)(sessionReplaySceneLogic.fk);return(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:tab,onChange:t=>lib.router.actions.push(urls.j.replay(t)),tabs:tabs.map(replayTab=>({label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,sessionReplaySceneLogic.$Y)(replayTab),replayTab===types.yd.Templates&&shouldShowNewBadge&&(0,jsx_runtime.jsx)(src.Mo,{className:"ml-1",size:"small"})]}),key:replayTab}))})}function SessionsRecordings(){return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Header,{}),(0,jsx_runtime.jsx)(PageTabs,{}),(0,jsx_runtime.jsx)(MainPanel,{})]})}let scene={component:SessionsRecordings,logic:sessionReplaySceneLogic.fk}}}]);