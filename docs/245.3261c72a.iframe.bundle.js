(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{4480:function(module,exports,__webpack_require__){(exports=__webpack_require__(49)(!1)).push([module.i,'.mixin-gradient-overlay{width:100%;height:3rem;background:linear-gradient(0deg,#fff,transparent)}.mixin-gradient-overlay,.mixin-gradient-overlay-right{content:"";position:absolute;pointer-events:none;bottom:0}.mixin-gradient-overlay-right{width:3rem;height:100%;background:linear-gradient(270deg,#fff,transparent)}.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.events .event-row-new{height:2.5rem}.events .event-row-date-separator{background-color:var(--bg-mid);color:var(--text-muted);font-weight:600;font-size:.75rem;height:2rem;text-align:center}.events .event-row-is-exception{background-color:#fffaf8}.events td{max-width:20rem}',""]),module.exports=exports},4727:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Events",(function(){return Events}));var react=__webpack_require__(0),react_default=__webpack_require__.n(react),regenerator=(__webpack_require__(42),__webpack_require__(64),__webpack_require__(158),__webpack_require__(50),__webpack_require__(160),__webpack_require__(33),__webpack_require__(300),__webpack_require__(646),__webpack_require__(40),__webpack_require__(159),__webpack_require__(53),__webpack_require__(8)),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(69),__webpack_require__(13)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),defineProperty=__webpack_require__(3),defineProperty_default=__webpack_require__.n(defineProperty),toConsumableArray=__webpack_require__(15),toConsumableArray_default=__webpack_require__.n(toConsumableArray),index_esm=__webpack_require__(1),utils=__webpack_require__(10),lib=__webpack_require__(32),api=__webpack_require__(23),PropertyFilters_utils=__webpack_require__(168),teamLogic=__webpack_require__(31),urls=__webpack_require__(18),dayjs=__webpack_require__(37),featureFlagLogic=__webpack_require__(74);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var eventsTableLogic=Object(index_esm.kea)({path:function path(key){return["scenes","events","eventsTableLogic",key]},props:{},key:function key(props){return[props.fixedFilters?JSON.stringify(props.fixedFilters):"all",props.key,props.sceneUrl].filter((function(keyPart){return!!keyPart})).join("-")},connect:{values:[teamLogic.a,["currentTeamId"],featureFlagLogic.a,["featureFlags"]]},actions:{setPollingActive:function setPollingActive(pollingActive){return{pollingActive:pollingActive}},setProperties:function setProperties(properties){return Array.isArray(properties)?0===properties.length?{properties:[{}]}:{properties:properties}:{properties:[properties]}},fetchEvents:function fetchEvents(){var nextParams=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return{nextParams:nextParams}},fetchEventsSuccess:function fetchEventsSuccess(apiResponse){return apiResponse},fetchNextEvents:!0,fetchOrPollFailure:function fetchOrPollFailure(error){return{error:error}},pollEvents:!0,pollEventsSuccess:function pollEventsSuccess(events){return{events:events}},prependEvents:function prependEvents(events){return{events:events}},prependNewEvents:!0,setSelectedEvent:function setSelectedEvent(selectedEvent){return{selectedEvent:selectedEvent}},setPollTimeout:function setPollTimeout(pollTimeout){return{pollTimeout:pollTimeout}},setDelayedLoading:!0,setEventFilter:function setEventFilter(event){return{event:event}},toggleAutomaticLoad:function toggleAutomaticLoad(automaticLoadEnabled){return{automaticLoadEnabled:automaticLoadEnabled}},noop:function noop(s){return s},startDownload:!0},reducers:function reducers(_ref){var props=_ref.props;return{sceneIsEventsPage:[!!props.sceneUrl&&props.sceneUrl===urls.a.LEGACY_events(),{}],pollingIsActive:[!0,{setPollingActive:function setPollingActive(_,_ref2){return _ref2.pollingActive}}],properties:[[],{setProperties:function setProperties(_,_ref3){return _ref3.properties.filter(PropertyFilters_utils.b)}}],eventFilter:["",{setEventFilter:function setEventFilter(_,_ref4){return _ref4.event}}],isLoading:[!0,{fetchEvents:function fetchEvents(){return!0},setDelayedLoading:function setDelayedLoading(){return!0},fetchEventsSuccess:function fetchEventsSuccess(){return!1},fetchOrPollFailure:function fetchOrPollFailure(){return!1}}],isLoadingNext:[!1,{fetchNextEvents:function fetchNextEvents(){return!0},fetchEventsSuccess:function fetchEventsSuccess(){return!1}}],events:[[],{fetchEventsSuccess:function fetchEventsSuccess(state,_ref5){var events=_ref5.events;return _ref5.isNext?[].concat(toConsumableArray_default()(state),toConsumableArray_default()(events)):events},prependEvents:function prependEvents(state,_ref6){var events=_ref6.events;return[].concat(toConsumableArray_default()(events),toConsumableArray_default()(state))}}],hasNext:[!1,{fetchEvents:function fetchEvents(){return!1},fetchNextEvents:function fetchNextEvents(){return!1},fetchEventsSuccess:function fetchEventsSuccess(_,_ref7){return _ref7.hasNext}}],orderBy:["-timestamp",{}],selectedEvent:[null,{setSelectedEvent:function setSelectedEvent(_,_ref8){return _ref8.selectedEvent}}],newEvents:[[],{setProperties:function setProperties(){return[]},pollEventsSuccess:function pollEventsSuccess(_,_ref9){return _ref9.events||[]},prependEvents:function prependEvents(){return[]}}],highlightEvents:[{},{prependEvents:function prependEvents(_,_ref10){return _ref10.events.reduce((function(highlightEvents,event){return highlightEvents[event.id]=!0,highlightEvents}),{})}}],pollTimeout:[0,{setPollTimeout:function setPollTimeout(_,payload){return payload.pollTimeout}}],automaticLoadEnabled:[!1,{persist:!0},{toggleAutomaticLoad:function toggleAutomaticLoad(_,_ref11){return _ref11.automaticLoadEnabled}}]}},selectors:function selectors(_ref12){var _selectors=_ref12.selectors,props=_ref12.props;return{eventsFormatted:[function(){return[_selectors.events,_selectors.newEvents]},function(events,newEvents){return function formatEvents(events,newEvents){var eventsFormatted=[];return(eventsFormatted=events.map((function(item){return{event:item}}))).forEach((function(event,index){var previous=eventsFormatted[index-1];index>0&&event.event&&previous.event&&!Object(dayjs.a)(event.event.timestamp).isSame(previous.event.timestamp,"day")&&eventsFormatted.splice(index,0,{date_break:Object(dayjs.a)(event.event.timestamp).format("LL")})})),newEvents.length>0&&eventsFormatted.splice(0,0,{new_events:!0}),eventsFormatted}(events,newEvents)}],exportUrl:[function(){return[_selectors.currentTeamId,_selectors.eventFilter,_selectors.orderBy,_selectors.properties,_selectors.afterParam]},function(teamId,eventFilter,orderBy,properties,after){var _props$fixedFilters;return"/api/projects/".concat(teamId,"/events.csv?").concat(Object(utils.yb)(_objectSpread(_objectSpread(_objectSpread({},props.fixedFilters||{}),{},{properties:[].concat(toConsumableArray_default()(properties),toConsumableArray_default()((null===(_props$fixedFilters=props.fixedFilters)||void 0===_props$fixedFilters?void 0:_props$fixedFilters.properties)||[]))},eventFilter?{event:eventFilter}:{}),{},{orderBy:[orderBy],after:after})))}],months:[function(){return[]},function(){return props.fetchMonths||12}],afterParam:[function(){return[_selectors.events,_selectors.months]},function(events,months){return(null==events?void 0:events.length)>0&&events[0].timestamp?events[0].timestamp:Object(dayjs.b)().subtract(months,"months").toISOString()}]}},actionToUrl:function actionToUrl(_ref13){var values=_ref13.values;return{setProperties:function setProperties(){return[lib.router.values.location.pathname,_objectSpread(_objectSpread({},lib.router.values.searchParams),{},{properties:values.properties}),lib.router.values.hashParams,{replace:!0}]},setEventFilter:function setEventFilter(){return[lib.router.values.location.pathname,_objectSpread(_objectSpread({},lib.router.values.searchParams),{},{eventFilter:values.eventFilter}),lib.router.values.hashParams,{replace:!0}]}}},urlToAction:function urlToAction(_ref14){var actions=_ref14.actions,values=_ref14.values,props=_ref14.props;return defineProperty_default()({},props.sceneUrl,(function(_,searchParams){actions.setProperties(searchParams.properties||values.properties||{}),searchParams.eventFilter&&actions.setEventFilter(searchParams.eventFilter)}))},events:function events(_ref16){var values=_ref16.values,actions=_ref16.actions;return{beforeUnmount:function beforeUnmount(){return clearTimeout(values.pollTimeout||void 0)},afterMount:function afterMount(){return actions.fetchEvents()}}},listeners:function listeners(_ref17){var _pollEvents,_fetchNextEvents,actions=_ref17.actions,values=_ref17.values,props=_ref17.props;return{startDownload:function startDownload(){Object(utils.wb)("The export is starting","It should finish soon."),window.location.href=values.exportUrl},setProperties:function setProperties(){return actions.fetchEvents()},setEventFilter:function setEventFilter(){return actions.fetchEvents()},fetchNextEvents:(_fetchNextEvents=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var events;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:0===(events=values.events).length?actions.fetchEvents():actions.fetchEvents({before:events[events.length-1].timestamp});case 2:case"end":return _context.stop()}}),_callee)}))),function fetchNextEvents(){return _fetchNextEvents.apply(this,arguments)}),fetchEvents:[function(){var _ref18=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(_,breakpoint){return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(!(values.events.length>0)){_context2.next=3;break}return _context2.next=3,breakpoint(500);case 3:null===values.isLoading&&actions.setDelayedLoading();case 4:case"end":return _context2.stop()}}),_callee2)})));return function(_x,_x2){return _ref18.apply(this,arguments)}}(),function(){var _ref20=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(_ref19,breakpoint){var _props$fixedFilters2,nextParams,properties,params,apiResponse,timeout;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return nextParams=_ref19.nextParams,clearTimeout(values.pollTimeout),properties=[].concat(toConsumableArray_default()(values.properties),toConsumableArray_default()((null===(_props$fixedFilters2=props.fixedFilters)||void 0===_props$fixedFilters2?void 0:_props$fixedFilters2.properties)||[])),params=_objectSpread(_objectSpread(_objectSpread(_objectSpread({},props.fixedFilters||{}),{},{properties:properties},nextParams||{}),values.eventFilter?{event:values.eventFilter}:{}),{},{orderBy:[values.orderBy],after:values.afterParam}),apiResponse=null,_context3.prev=5,_context3.next=8,api.a.get("api/projects/".concat(values.currentTeamId,"/events/?").concat(Object(utils.yb)(params)));case 8:apiResponse=_context3.sent,_context3.next=15;break;case 11:return _context3.prev=11,_context3.t0=_context3.catch(5),actions.fetchOrPollFailure(_context3.t0),_context3.abrupt("return");case 15:breakpoint(),actions.fetchEventsSuccess({events:apiResponse.results,hasNext:!!apiResponse.next,isNext:!!nextParams}),props.disableActions||(timeout=window.setTimeout(actions.pollEvents,5e3),actions.setPollTimeout(timeout));case 18:case"end":return _context3.stop()}}),_callee3,null,[[5,11]])})));return function(_x3,_x4){return _ref20.apply(this,arguments)}}()],pollEvents:(_pollEvents=asyncToGenerator_default()(regenerator_default.a.mark((function _callee4(_,breakpoint){var _props$fixedFilters3,setNextPoll,properties,params,urlParams,apiResponse;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(setNextPoll=function _setNextPoll(){var timeout=window.setTimeout(actions.pollEvents,5e3);actions.setPollTimeout(timeout)},"-timestamp"===values.orderBy){_context4.next=3;break}return _context4.abrupt("return");case 3:if(props.sceneUrl===lib.router.values.location.pathname){_context4.next=5;break}return _context4.abrupt("return");case 5:if(!props.disableActions){_context4.next=7;break}return _context4.abrupt("return");case 7:if(values.pollingIsActive){_context4.next=10;break}return setNextPoll(),_context4.abrupt("return");case 10:return properties=[].concat(toConsumableArray_default()(values.properties),toConsumableArray_default()((null===(_props$fixedFilters3=props.fixedFilters)||void 0===_props$fixedFilters3?void 0:_props$fixedFilters3.properties)||[])),params=_objectSpread(_objectSpread(_objectSpread({},props.fixedFilters||{}),{},{properties:properties},values.eventFilter?{event:values.eventFilter}:{}),{},{orderBy:[values.orderBy],after:values.afterParam}),urlParams=Object(utils.yb)(params),apiResponse=null,_context4.prev=14,_context4.next=17,api.a.get("api/projects/".concat(values.currentTeamId,"/events/?").concat(urlParams));case 17:apiResponse=_context4.sent,_context4.next=23;break;case 20:return _context4.prev=20,_context4.t0=_context4.catch(14),_context4.abrupt("return");case 23:breakpoint(),values.automaticLoadEnabled?actions.prependEvents(apiResponse.results):actions.pollEventsSuccess(apiResponse.results),setNextPoll();case 26:case"end":return _context4.stop()}}),_callee4,null,[[14,20]])}))),function pollEvents(_x5,_x6){return _pollEvents.apply(this,arguments)}),prependNewEvents:function prependNewEvents(){values.newEvents.length&&actions.prependEvents(values.newEvents)},fetchOrPollFailure:function fetchOrPollFailure(_ref21){var error=_ref21.error;Object(utils.A)(void 0,"There was a problem fetching your events. Please refresh this page to try again.",error.statusText,error.status)},toggleAutomaticLoad:function toggleAutomaticLoad(_ref22){_ref22.automaticLoadEnabled&&actions.prependNewEvents()}}}}),slicedToArray=(__webpack_require__(126),__webpack_require__(323),__webpack_require__(122),__webpack_require__(118),__webpack_require__(12)),slicedToArray_default=__webpack_require__.n(slicedToArray),PropertyKeyInfo=__webpack_require__(63),PropertiesTable=__webpack_require__(910);__webpack_require__(1250),__webpack_require__(149),__webpack_require__(127),__webpack_require__(84),__webpack_require__(175);function indent(level){return Array(level).fill("    ").join("")}function EventElements(_ref){var event=_ref.event,elements=toConsumableArray_default()(event.elements||[]).reverse();return elements=elements.slice(Math.max(elements.length-10,1)),react_default.a.createElement("div",null,elements.map((function(element,index){return react_default.a.createElement("pre",{className:"code",key:index,style:{margin:0,padding:0,borderRadius:0,backgroundColor:index===elements.length-1?"var(--primary)":void 0}},indent(index),"<",element.tag_name,element.attr_id&&' id="'.concat(element.attr_id,'"'),Object.entries(element.attributes).map((function(_ref2){var _ref3=slicedToArray_default()(_ref2,2),key=_ref3[0],value=_ref3[1];return react_default.a.createElement("span",{key:key}," ".concat(key.replace("attr__",""),'="').concat(value,'"'))})),">",element.text,index===elements.length-1&&react_default.a.createElement("span",null,"</",element.tag_name,">"))})),toConsumableArray_default()(elements).reverse().slice(1).map((function(element,index){return react_default.a.createElement("pre",{className:"code",key:index,style:{margin:0,padding:0,borderRadius:0}},indent(elements.length-index-2),"</",element.tag_name,">")})))}try{EventElements.displayName="EventElements",EventElements.__docgenInfo={description:"",displayName:"EventElements",props:{event:{defaultValue:null,description:"",name:"event",required:!0,type:{name:"EventType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/events/EventElements.tsx#EventElements"]={docgenInfo:EventElements.__docgenInfo,name:"EventElements",path:"frontend/src/scenes/events/EventElements.tsx#EventElements"})}catch(__react_docgen_typescript_loader_error){}var tabs=__webpack_require__(565),es_button=__webpack_require__(140),objectWithoutProperties=__webpack_require__(43),objectWithoutProperties_default=__webpack_require__.n(objectWithoutProperties),CodeSnippet=__webpack_require__(52);function EventJSON_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function EventJSON_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?EventJSON_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):EventJSON_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function EventJSON(props){var _props$event=props.event,event=_props$event.event,id=_props$event.id,uuid=_props$event.uuid,distinct_id=_props$event.distinct_id,properties=_props$event.properties,elements=_props$event.elements,timestamp=_props$event.timestamp,otherProps=(_props$event.person,objectWithoutProperties_default()(_props$event,["event","id","uuid","distinct_id","properties","elements","timestamp","person"])),newEvent=EventJSON_objectSpread(EventJSON_objectSpread(EventJSON_objectSpread(EventJSON_objectSpread({},id?{id:id}:null),uuid?{uuid:uuid}:null),{},{timestamp:timestamp,event:event,distinct_id:distinct_id,properties:Object(utils.ub)(properties)},elements&&elements.length>0?{elements:elements}:null),otherProps);return react_default.a.createElement(CodeSnippet.a,{language:CodeSnippet.b.JSON},JSON.stringify(newEvent,null,4))}try{EventJSON.displayName="EventJSON",EventJSON.__docgenInfo={description:"",displayName:"EventJSON",props:{event:{defaultValue:null,description:"",name:"event",required:!0,type:{name:"Record<string, any>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/events/EventJSON.tsx#EventJSON"]={docgenInfo:EventJSON.__docgenInfo,name:"EventJSON",path:"frontend/src/scenes/events/EventJSON.tsx#EventJSON"})}catch(__react_docgen_typescript_loader_error){}function EventDetails_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function EventDetails_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?EventDetails_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):EventDetails_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var TabPane=tabs.a.TabPane;function EventDetails(_ref){for(var event=_ref.event,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),showHiddenProps=_useState2[0],setShowHiddenProps=_useState2[1],displayedEventProperties={},visibleHiddenProperties={},hiddenPropsCount=0,_i=0,_Object$keys=Object.keys(event.properties);_i<_Object$keys.length;_i++){var key=_Object$keys[_i];PropertyKeyInfo.f.event[key]&&PropertyKeyInfo.f.event[key].hide&&(hiddenPropsCount+=1,showHiddenProps&&(visibleHiddenProperties[key]=event.properties[key])),PropertyKeyInfo.f.event[key]&&PropertyKeyInfo.f.event[key].hide||(displayedEventProperties[key]=event.properties[key])}return react_default.a.createElement(tabs.a,{"data-attr":"event-details",defaultActiveKey:"properties",style:{float:"left",width:"100%"},tabBarStyle:{margin:0}},react_default.a.createElement(TabPane,{tab:"Properties",key:"properties"},react_default.a.createElement(PropertiesTable.a,{properties:EventDetails_objectSpread(EventDetails_objectSpread({$timestamp:Object(dayjs.a)(event.timestamp).toISOString()},displayedEventProperties),visibleHiddenProperties)}),hiddenPropsCount>0&&react_default.a.createElement("small",null,react_default.a.createElement(es_button.a,{style:{margin:"8px 0 0 8px"},type:"link",onClick:function onClick(){return setShowHiddenProps(!showHiddenProps)}},showHiddenProps?"Showing ":"",hiddenPropsCount," hidden properties. Click to ",showHiddenProps?"hide":"show","."))),react_default.a.createElement(TabPane,{tab:"JSON",key:"json"},react_default.a.createElement(EventJSON,{event:event})),event.elements&&event.elements.length>0&&react_default.a.createElement(TabPane,{tab:"Elements",key:"elements"},react_default.a.createElement(EventElements,{event:event})))}try{EventDetails.displayName="EventDetails",EventDetails.__docgenInfo={description:"",displayName:"EventDetails",props:{event:{defaultValue:null,description:"",name:"event",required:!0,type:{name:"EventType"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/events/EventDetails.tsx#EventDetails"]={docgenInfo:EventDetails.__docgenInfo,name:"EventDetails",path:"frontend/src/scenes/events/EventDetails.tsx#EventDetails"})}catch(__react_docgen_typescript_loader_error){}var DownloadOutlined=__webpack_require__(4241),Link=__webpack_require__(55),FilterPropertyLink=__webpack_require__(1207),Property=__webpack_require__(715),injectStylesIntoStyleTag=__webpack_require__(19),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),EventsTable=__webpack_require__(4480),EventsTable_default=__webpack_require__.n(EventsTable),options={insert:"head",singleton:!1},PersonHeader=(injectStylesIntoStyleTag_default()(EventsTable_default.a,options),EventsTable_default.a.locals,__webpack_require__(385)),TimezoneAware=__webpack_require__(316),ResizableTable=__webpack_require__(1148),types=__webpack_require__(6),propertyDefinitionsModel=__webpack_require__(235),es_select=(__webpack_require__(383),__webpack_require__(298)),eventDefinitionsModel=__webpack_require__(437);function EventName(_ref){var value=_ref.value,onChange=_ref.onChange,_ref$isActionStep=_ref.isActionStep,isActionStep=void 0!==_ref$isActionStep&&_ref$isActionStep,eventNamesGrouped=Object(index_esm.useValues)(eventDefinitionsModel.a).eventNamesGrouped;return react_default.a.createElement("span",null,react_default.a.createElement(es_select.a,{showSearch:!0,allowClear:!0,style:{width:"100%",maxWidth:"24rem"},onChange:onChange,filterOption:function filterOption(input,option){var _option$value;return(null==option||null===(_option$value=option.value)||void 0===_option$value?void 0:_option$value.toLowerCase().indexOf(input.toLowerCase()))>=0},disabled:isActionStep&&0===eventNamesGrouped[0].options.length,value:value||void 0,placeholder:"Choose an event","data-attr":"event-name-box"},eventNamesGrouped.map((function(typeGroup){if(typeGroup.options.length>0)return react_default.a.createElement(es_select.a.OptGroup,{key:typeGroup.label,label:typeGroup.label},typeGroup.options.map((function(item,index){var _item$label;return react_default.a.createElement(es_select.a.Option,{key:item.value,value:item.value,"data-attr":"prop-val-"+index},react_default.a.createElement(PropertyKeyInfo.b,{value:null!==(_item$label=item.label)&&void 0!==_item$label?_item$label:item.value}))})))}))),isActionStep&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("br",null),react_default.a.createElement("small",null,0===eventNamesGrouped[0].options.length&&"You haven't sent any custom events."," ",react_default.a.createElement("a",{href:"https://posthog.com/docs/libraries",target:"_blank",rel:"noopener noreferrer"},"See documentation")," ","on how to send custom events in lots of languages.")))}try{EventName.displayName="EventName",EventName.__docgenInfo={description:"",displayName:"EventName",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: string) => void"}},isActionStep:{defaultValue:{value:"false"},description:"",name:"isActionStep",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/events/EventName.tsx#EventName"]={docgenInfo:EventName.__docgenInfo,name:"EventName",path:"frontend/src/scenes/events/EventName.tsx#EventName"})}catch(__react_docgen_typescript_loader_error){}var PropertyFilters=__webpack_require__(315),Tooltip=__webpack_require__(46),clsx_m=__webpack_require__(44),tableConfigLogic=__webpack_require__(494),LemonTable=__webpack_require__(242),icons=__webpack_require__(36),LemonButton=__webpack_require__(82),More=__webpack_require__(647),LemonSwitch=__webpack_require__(622),propertyFilterLogic=__webpack_require__(268),react_toastify=(__webpack_require__(92),__webpack_require__(62),__webpack_require__(108),__webpack_require__(104),__webpack_require__(566),__webpack_require__(70)),actionUtils=__webpack_require__(347);function createActionFromEvent_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function createActionFromEvent_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?createActionFromEvent_ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):createActionFromEvent_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function recurseSelector(elements,parts,index){var element=elements[index];return element.attr_id?'[id="'.concat(element.attr_id,'"] > ').concat(parts):(parts=index>0?element.tag_name+" > "+parts:element.tag_name,10!==index&&elements[index+1]?recurseSelector(elements,parts,index+1):parts)}function elementsToAction(elements){return createActionFromEvent_objectSpread({tag_name:elements[0].tag_name,href:elements[0].href,text:elements[0].text},elements[0].href||elements[0].text?"":{selector:recurseSelector(elements,"",0)})}function createActionFromEvent(_x,_x2,_x3,_x4){return _createActionFromEvent.apply(this,arguments)}function _createActionFromEvent(){return(_createActionFromEvent=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(teamId,event,increment,dataAttributes){var _actionData$steps2,recurse,actionData,i,element,_actionData$steps,selector,clickedTagName,action,_args=arguments;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(recurse=_args.length>4&&void 0!==_args[4]?_args[4]:createActionFromEvent,actionData={name:"",steps:[createActionFromEvent_objectSpread(createActionFromEvent_objectSpread({event:event.event},"$pageview"===event.event||"$autocapture"===event.event?{url:event.properties.$current_url,url_matching:types.a.Exact}:{}),event.elements.length>0?elementsToAction(event.elements):{})]},"$autocapture"!==event.event){_context.next=18;break}if(actionData.name=Object(utils.g)(event),!((null==dataAttributes?void 0:dataAttributes.length)>0&&event.elements.length>0)){_context.next=16;break}i=0;case 6:if(!(i<event.elements.length)){_context.next=16;break}if(element=event.elements[i],!Object(actionUtils.f)(element,dataAttributes)&&!element.attr_id){_context.next=13;break}return selector=Object(actionUtils.d)(element,dataAttributes),i>0&&!actionUtils.a.includes(element.tag_name)&&(clickedTagName=event.elements[0].tag_name,selector="".concat(selector," > ").concat(clickedTagName||"*")),(null===(_actionData$steps=actionData.steps)||void 0===_actionData$steps?void 0:_actionData$steps[0])&&(actionData.steps[0].selector=selector),_context.abrupt("break",16);case 13:i++,_context.next=6;break;case 16:_context.next=19;break;case 18:"$pageview"===event.event?actionData.name="Pageview on ".concat(new URL(event.properties.$current_url).pathname):actionData.name="".concat(event.event," event");case 19:return increment&&(actionData.name=actionData.name+" "+increment),"submit"===event.properties.$event_type&&(null===(_actionData$steps2=actionData.steps)||void 0===_actionData$steps2?void 0:_actionData$steps2.length)&&(actionData.steps[0].properties=[{key:"$event_type",value:"submit"}]),_context.prev=21,_context.next=24,api.a.actions.create(actionData);case 24:action=_context.sent,_context.next=35;break;case 27:if(_context.prev=27,_context.t0=_context.catch(21),!("validation_error"===_context.t0.type&&"unique"===_context.t0.code&&increment<30)){_context.next=33;break}return _context.abrupt("return",recurse(teamId,event,increment+1,dataAttributes,recurse));case 33:return react_toastify.c.error(react_default.a.createElement(react_default.a.Fragment,null,"Couldn't create this action. You can try"," ",react_default.a.createElement(Link.a,{to:"/action"},"manually creating an action instead."))),_context.abrupt("return");case 35:action.id&&(lib.router.actions.push(urls.a.taxonomyCalculatedEventsEdit(action.id)),Object(react_toastify.c)(react_default.a.createElement("span",null,"Action succesfully created."," ",react_default.a.createElement("a",{href:"#",onClick:function onClick(e){e.preventDefault(),window.history.back()}},"Click here to go back."))));case 36:case"end":return _context.stop()}}),_callee,null,[[21,27]])})))).apply(this,arguments)}try{elementsToAction.displayName="elementsToAction",elementsToAction.__docgenInfo={description:"",displayName:"elementsToAction",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/events/createActionFromEvent.tsx#elementsToAction"]={docgenInfo:elementsToAction.__docgenInfo,name:"elementsToAction",path:"frontend/src/scenes/events/createActionFromEvent.tsx#elementsToAction"})}catch(__react_docgen_typescript_loader_error){}var usePageVisibility=__webpack_require__(2542),PageHeader=__webpack_require__(259);function EventsTable_EventsTable(_ref){var fixedFilters=_ref.fixedFilters,pageKey=_ref.pageKey,hidePersonColumn=_ref.hidePersonColumn,hideTableConfig=_ref.hideTableConfig,sceneUrl=_ref.sceneUrl,disableActions=_ref.disableActions,fetchMonths=_ref.fetchMonths,currentTeam=Object(index_esm.useValues)(teamLogic.a).currentTeam,logic=eventsTableLogic({fixedFilters:fixedFilters,key:pageKey,sceneUrl:sceneUrl||urls.a.LEGACY_events(),disableActions:disableActions,fetchMonths:fetchMonths}),_useValues2=Object(index_esm.useValues)(logic),properties=_useValues2.properties,eventsFormatted=_useValues2.eventsFormatted,isLoading=_useValues2.isLoading,hasNext=_useValues2.hasNext,isLoadingNext=_useValues2.isLoadingNext,newEvents=_useValues2.newEvents,eventFilter=_useValues2.eventFilter,automaticLoadEnabled=_useValues2.automaticLoadEnabled,exportUrl=_useValues2.exportUrl,highlightEvents=_useValues2.highlightEvents,months=_useValues2.months,_useValues3=Object(index_esm.useValues)(tableConfigLogic.a),tableWidth=_useValues3.tableWidth,selectedColumns=_useValues3.selectedColumns,propertyNames=Object(index_esm.useValues)(propertyDefinitionsModel.a).propertyNames,_useActions=Object(index_esm.useActions)(logic),fetchNextEvents=_useActions.fetchNextEvents,prependNewEvents=_useActions.prependNewEvents,setEventFilter=_useActions.setEventFilter,toggleAutomaticLoad=_useActions.toggleAutomaticLoad,startDownload=_useActions.startDownload,setPollingActive=_useActions.setPollingActive,filters=Object(index_esm.useValues)(Object(propertyFilterLogic.a)({pageKey:pageKey})).filters,showLinkToPerson=!(null==fixedFilters?void 0:fixedFilters.person_id);Object(usePageVisibility.a)(setPollingActive);var newEventsRender=function newEventsRender(_ref2,colSpan){var date_break=_ref2.date_break,new_events=_ref2.new_events;return{children:date_break||(new_events?react_default.a.createElement(LemonButton.a,{icon:react_default.a.createElement(icons.IconSync,null),style:{borderRadius:0},onClick:function onClick(){return prependNewEvents()},center:!0,fullWidth:!0},1===newEvents.length?"There is 1 new event. Click here to load it":"There are ".concat(newEvents.length||""," new events. Click here to load them")):"???"),props:{colSpan:colSpan+1,style:new_events?{padding:0}:void 0}}},personColumn={title:"Person",key:"person",render:function renderPerson(_,_ref3){var _event$person,_event$person$distinc,event=_ref3.event;return event?showLinkToPerson&&(null===(_event$person=event.person)||void 0===_event$person||null===(_event$person$distinc=_event$person.distinct_ids)||void 0===_event$person$distinc?void 0:_event$person$distinc.length)?react_default.a.createElement(Link.a,{to:urls.a.person(event.person.distinct_ids[0])},react_default.a.createElement(PersonHeader.a,{withIcon:!0,person:event.person})):react_default.a.createElement(PersonHeader.a,{withIcon:!0,person:event.person}):{props:{colSpan:0}}}},defaultColumns=Object(react.useMemo)((function(){var _localColumns=[{title:"Event",key:"event",width:"16rem",render:function render(_,item){if(!item.event)return newEventsRender(item,tableWidth);var event=item.event;return react_default.a.createElement(PropertyKeyInfo.b,{value:Object(utils.g)(event)})},ellipsis:!0},{title:"URL / Screen",key:"url",width:"4rem",render:function renderURL(_,_ref4){var event=_ref4.event;if(!event)return{props:{colSpan:0}};var param=event.properties.$current_url?"$current_url":"$screen_name";return disableActions?react_default.a.createElement(Property.a,{value:event.properties[param]}):react_default.a.createElement(FilterPropertyLink.a,{className:"ph-no-capture",property:param,value:event.properties[param],filters:{properties:properties}})},ellipsis:!0},{title:"Source",key:"source",render:function renderSource(_,_ref5){var event=_ref5.event;return event?disableActions?react_default.a.createElement(Property.a,{value:event.properties.$lib}):react_default.a.createElement(FilterPropertyLink.a,{property:"$lib",value:event.properties.$lib,filters:{properties:properties}}):{props:{colSpan:0}}}}];return hidePersonColumn||_localColumns.splice(1,0,personColumn),_localColumns}),[tableWidth]),columns=Object(react.useMemo)((function(){var columnsSoFar="DEFAULT"===selectedColumns?defaultColumns:selectedColumns.map((function(e,index){return defaultColumns.find((function(d){return d.key===e}))||{title:PropertyKeyInfo.f.event[e]?PropertyKeyInfo.f.event[e].label:e,key:e,render:function render(_,item){var event=item.event;return event?disableActions?react_default.a.createElement(Property.a,{value:event.properties[e]}):react_default.a.createElement(FilterPropertyLink.a,{className:"ph-no-capture ",property:e,value:event.properties[e],filters:{properties:properties}}):0===index?newEventsRender(item,tableWidth):{props:{colSpan:0}}}}}));return columnsSoFar.push({title:"Time",key:"time",render:function renderTime(_,_ref6){var event=_ref6.event;return event?react_default.a.createElement(TimezoneAware.b,{time:event.timestamp,showSeconds:!0}):{props:{colSpan:0}}}}),columnsSoFar.push({key:"actions",width:0,render:function renderActions(_,_ref7){var insightParams,event=_ref7.event;return event?("$pageview"===event.event?insightParams={insight:types.p.TRENDS,interval:"day",display:types.d.ActionsLineGraphLinear,actions:[],events:[{id:"$pageview",name:"$pageview",type:"events",order:0,properties:[{key:"$current_url",value:event.properties.$current_url,type:"event"}]}]}:"$autocapture"!==event.event&&(insightParams={insight:types.p.TRENDS,interval:"day",display:types.d.ActionsLineGraphLinear,actions:[],events:[{id:event.event,name:event.event,type:"events",order:0,properties:[]}]}),react_default.a.createElement(More.a,{overlay:react_default.a.createElement(react_default.a.Fragment,null,currentTeam&&react_default.a.createElement(LemonButton.a,{type:"stealth",onClick:function onClick(){return createActionFromEvent(currentTeam.id,event,0,currentTeam.data_attributes||[])},fullWidth:!0,"data-attr":"events-table-create-action"},"Create action from event"),insightParams&&react_default.a.createElement(LemonButton.a,{type:"stealth",to:urls.a.insightNew(insightParams),fullWidth:!0,"data-attr":"events-table-usage"},"Try out in Insights"))})):{props:{colSpan:0}}}}),columnsSoFar}),[selectedColumns]);return react_default.a.createElement("div",{"data-attr":"manage-events-table"},react_default.a.createElement("div",{className:"events","data-attr":"events-table"},!disableActions&&react_default.a.createElement(PageHeader.a,{title:"Events & Actions",caption:"See events being sent to this project in real time.",tabbedPage:!0}),!disableActions&&react_default.a.createElement("div",{className:"mb",style:{display:"flex",gap:"0.75rem",flexWrap:"wrap",justifyContent:"space-between",alignItems:"start"}},react_default.a.createElement("div",{style:{display:"flex",gap:"0.75rem",flexDirection:"column",flexGrow:1}},react_default.a.createElement(EventName,{value:eventFilter,onChange:function onChange(value){setEventFilter(value||"")}}),react_default.a.createElement(PropertyFilters.a,{pageKey:pageKey,style:{marginBottom:0},eventNames:eventFilter?[eventFilter]:[]})),react_default.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.75rem"}},react_default.a.createElement(LemonSwitch.a,{id:"autoload-switch",label:"Automatically load new events",checked:automaticLoadEnabled,onChange:toggleAutomaticLoad}),!hideTableConfig&&react_default.a.createElement(ResizableTable.c,{availableColumns:propertyNames,immutableColumns:["event","person"],defaultColumns:defaultColumns.map((function(e){return e.key||""}))}),exportUrl&&react_default.a.createElement(Tooltip.a,{title:"Export up to 10,000 latest events.",placement:"left"},react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(DownloadOutlined.a,null),onClick:startDownload},"Export events")))),react_default.a.createElement(LemonTable.a,{dataSource:eventsFormatted,loading:isLoading,columns:columns,key:"DEFAULT"===selectedColumns?"default":selectedColumns.join("-"),className:"ph-no-capture",emptyState:isLoading?void 0:filters.some((function(filter){return Object.keys(filter).length}))||eventFilter?"No events matching filters found in the last ".concat(months," months!"):react_default.a.createElement(react_default.a.Fragment,null,"This project doesn't have any events. If you haven't integrated PostHog yet,"," ",react_default.a.createElement(Link.a,{to:"/project/settings"},"click here to instrument analytics with PostHog in your product"),"."),rowKey:function rowKey(row){var _row$date_break;return row.event?row.event.id+"-"+row.event.event:(null===(_row$date_break=row.date_break)||void 0===_row$date_break?void 0:_row$date_break.toString())||""},rowClassName:function rowClassName(row){return Object(clsx_m.a)({"event-row":row.event,highlighted:row.event&&highlightEvents[row.event.id],"event-row-is-exception":row.event&&"$exception"===row.event.event,"event-row-date-separator":row.date_break,"event-row-new":row.new_events})},expandable:{expandedRowRender:function renderExpand(_ref8){var event=_ref8.event;return event&&react_default.a.createElement(EventDetails,{event:event})},rowExpandable:function rowExpandable(_ref9){var event=_ref9.event,date_break=_ref9.date_break,new_events=_ref9.new_events;return date_break||new_events?-1:!!event}}}),react_default.a.createElement(es_button.a,{type:"primary",onClick:fetchNextEvents,loading:isLoadingNext,style:{display:hasNext||isLoadingNext?"block":"none",margin:"2rem auto 1rem"}},"Load more events")))}try{EventsTable_EventsTable.displayName="EventsTable",EventsTable_EventsTable.__docgenInfo={description:"",displayName:"EventsTable",props:{fixedFilters:{defaultValue:null,description:"",name:"fixedFilters",required:!1,type:{name:"FixedFilters"}},disableActions:{defaultValue:null,description:"",name:"disableActions",required:!1,type:{name:"boolean"}},pageKey:{defaultValue:null,description:"",name:"pageKey",required:!0,type:{name:"string"}},hidePersonColumn:{defaultValue:null,description:"",name:"hidePersonColumn",required:!1,type:{name:"boolean"}},hideTableConfig:{defaultValue:null,description:"",name:"hideTableConfig",required:!1,type:{name:"boolean"}},sceneUrl:{defaultValue:null,description:"",name:"sceneUrl",required:!1,type:{name:"string"}},fetchMonths:{defaultValue:null,description:"",name:"fetchMonths",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/events/EventsTable.tsx#EventsTable"]={docgenInfo:EventsTable_EventsTable.__docgenInfo,name:"EventsTable",path:"frontend/src/scenes/events/EventsTable.tsx#EventsTable"})}catch(__react_docgen_typescript_loader_error){}var scene={component:Events,logic:eventsTableLogic,paramsToProps:function paramsToProps(_ref){return{fixedFilters:_ref.params.fixedFilters,key:"EventsTable",sceneUrl:urls.a.events()}}};function Events(){return react_default.a.createElement(EventsTable_EventsTable,{pageKey:"EventsTable"})}}}]);