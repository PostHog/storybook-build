(window.webpackJsonp=window.webpackJsonp||[]).push([[7,10],{"./frontend/src/scenes/apps/ErrorDetailsModal.tsx":function(ee,g,r){"use strict";r.r(g),r.d(g,"ErrorDetailsModal",function(){return z});var F=r("./node_modules/@babel/runtime/helpers/slicedToArray.js"),U=r.n(F),C=r("./node_modules/react/index.js"),L=r.n(C),R=r("./node_modules/kea/lib/index.esm.js"),f=r("./frontend/src/scenes/apps/appMetricsSceneLogic.ts"),B=r("./frontend/src/lib/components/LemonSkeleton/index.tsx"),N=r("./frontend/src/lib/components/TimezoneAware/index.tsx"),W=r("./frontend/src/lib/components/LemonLabel/LemonLabel.tsx"),y=r("./frontend/src/lib/components/LemonButton/index.ts"),P=r("./frontend/src/lib/components/icons.tsx"),$=r("./frontend/src/lib/components/LemonModal/index.ts"),p=r("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),o=r("./node_modules/react/jsx-runtime.js"),G=r.n(o);function z(){var O,D,M=Object(R.useValues)(f.appMetricsSceneLogic),m=M.errorDetails,T=M.errorDetailsModalError,A=M.errorDetailsLoading,V=Object(R.useActions)(f.appMetricsSceneLogic),j=V.closeErrorDetailsModal,K=Object(C.useState)(0),H=U()(K,2),v=H[0],b=H[1],c=m[v];return Object(o.jsx)($.a,{isOpen:!!T,onClose:j,title:T,width:"min(50vw, 80rem)",description:Object(o.jsx)("span",{children:c==null||(O=c.error_details)===null||O===void 0||(D=O.error.message)===null||D===void 0?void 0:D.substring(0,200)}),footer:Object(o.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:A?Object(o.jsx)(B.a,{className:"1-10"}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("span",{children:[v+1," of ",m.length," sample",m.length>1?"s":""]}),Object(o.jsx)(y.a,{icon:Object(o.jsx)(P.IconChevronLeft,{}),onClick:function(){return b(v-1)},disabled:v==0}),Object(o.jsx)(y.a,{icon:Object(o.jsx)(P.IconChevronRight,{}),onClick:function(){return b(v+1)},disabled:v==m.length-1})]})}),children:!T||A?Object(o.jsx)(B.a,{className:"h-10"}):Object(o.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[Object(o.jsxs)("div",{children:[Object(o.jsx)(W.a,{children:"When:"})," ",Object(o.jsx)(N.b,{time:c.timestamp,showSeconds:!0})]}),c.error_details.eventCount&&Object(o.jsxs)("div",{children:[Object(o.jsx)(W.a,{children:"Event Count"}),Object(o.jsx)("div",{children:c.error_details.eventCount})]}),c.error_details.error.message&&Object(o.jsx)(h,{title:"Error message",defaultIsExpanded:!0,children:Object(o.jsx)(p.a,{wrap:!0,language:p.b.JavaScript,children:c.error_details.error.message})}),c.error_details.event&&Object(o.jsx)(h,{title:"Event payload",defaultIsExpanded:!1,children:Object(o.jsx)(p.a,{wrap:!0,language:p.b.JSON,children:JSON.stringify(c.error_details.event,null,2)})}),c.error_details.error.stack&&Object(o.jsx)(h,{title:"Stack trace",defaultIsExpanded:!1,children:Object(o.jsx)(p.a,{wrap:!0,language:p.b.JavaScript,children:c.error_details.error.stack})})]})})}function h(O){var D=Object(C.useState)(O.defaultIsExpanded),M=U()(D,2),m=M[0],T=M[1];return Object(o.jsxs)("div",{className:"bg-mid border rounded",children:[Object(o.jsx)(y.a,{status:"stealth",fullWidth:!0,onClick:function(){return T(!m)},sideIcon:m?Object(o.jsx)(P.IconUnfoldLess,{}):Object(o.jsx)(P.IconUnfoldMore,{}),title:m?"Show less":"Show more",className:"bg-mid",children:O.title}),m&&Object(o.jsx)("div",{className:"bg-light p-2",children:O.children})]})}},"./frontend/src/scenes/apps/appMetricsSceneLogic.ts":function(ee,g,r){"use strict";r.r(g),r.d(g,"AppMetricsTab",function(){return u}),r.d(g,"appMetricsSceneLogic",function(){return te});var F=r("./node_modules/@babel/runtime/helpers/slicedToArray.js"),U=r.n(F),C=r("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),L=r.n(C),R=r("./node_modules/@babel/runtime/regenerator/index.js"),f=r.n(R),B=r("./node_modules/core-js/modules/es.array.iterator.js"),N=r.n(B),W=r("./node_modules/core-js/modules/es.object.to-string.js"),y=r.n(W),P=r("./node_modules/core-js/modules/web.dom-collections.iterator.js"),$=r.n(P),p=r("./node_modules/core-js/modules/es.array.concat.js"),o=r.n(p),G=r("./node_modules/core-js/modules/es.function.name.js"),z=r.n(G),h=r("./node_modules/core-js/modules/es.array.filter.js"),O=r.n(h),D=r("./node_modules/core-js/modules/es.array.includes.js"),M=r.n(D),m=r("./node_modules/core-js/modules/es.string.includes.js"),T=r.n(m),A=r("./node_modules/core-js/modules/es.number.constructor.js"),V=r.n(A),j=r("./node_modules/kea/lib/index.esm.js"),K=r("./node_modules/kea-loaders/lib/index.js"),H=r.n(K),v=r("./frontend/src/scenes/urls.ts"),b=r("./frontend/src/lib/api.ts"),c=r("./frontend/src/scenes/teamLogic.tsx"),x=r("./node_modules/kea-router/lib/index.js"),ne=r.n(x),Q=r("./frontend/src/lib/utils.tsx"),X=r("./frontend/src/scenes/plugins/edit/interface-jobs/PluginJobConfiguration.tsx"),re=r("./frontend/src/scenes/plugins/edit/interface-jobs/interfaceJobsLogic.ts"),Y=r("./frontend/src/lib/dayjs.ts"),u;(function(t){t.ProcessEvent="processEvent",t.OnEvent="onEvent",t.ExportEvents="exportEvents",t.ScheduledTask="scheduledTask",t.HistoricalExports="historical_exports"})(u||(u={}));var J="-30d",Z=[u.ProcessEvent,u.OnEvent,u.ExportEvents,u.ScheduledTask],te=Object(j.kea)([Object(j.path)(function(t){return["scenes","apps","appMetricsSceneLogic",t]}),Object(j.props)({}),Object(j.key)(function(t){return t.pluginConfigId}),Object(j.actions)({setActiveTab:function(n){return{tab:n}},setDateFrom:function(n){return{dateFrom:n}},openErrorDetailsModal:function(n,s,e){return{errorType:n,category:s,jobId:e}},closeErrorDetailsModal:!0,openHistoricalExportModal:!0}),Object(j.reducers)({activeTab:[null,{setActiveTab:function(n,s){var e=s.tab;return e}}],selectedDateFrom:[null,{setDateFrom:function(n,s){var e=s.dateFrom;return e}}],errorDetailsModalError:[null,{openErrorDetailsModal:function(n,s){var e=s.errorType;return e},closeErrorDetailsModal:function(){return null}}]}),Object(K.loaders)(function(t){var n=t.values,s=t.props;return{pluginConfig:[null,{loadPluginConfig:function(){var e=L()(f.a.mark(function a(){return f.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,b.b.get("api/projects/".concat(c.a.values.currentTeamId,"/plugin_configs/").concat(s.pluginConfigId));case 2:return d.abrupt("return",d.sent);case 3:case"end":return d.stop()}},a)}));function l(){return e.apply(this,arguments)}return l}()}],appMetricsResponse:[null,{loadMetrics:function(){var e=L()(f.a.mark(function a(){var i;return f.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(n.activeTab&&n.dateFrom)){_.next=5;break}return i=Object(Q.Eb)({category:n.activeTab,date_from:n.dateFrom}),_.next=4,b.b.get("api/projects/".concat(c.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"?").concat(i));case 4:return _.abrupt("return",_.sent);case 5:case"end":return _.stop()}},a)}));function l(){return e.apply(this,arguments)}return l}()}],historicalExports:[[],{loadHistoricalExports:function(){var e=L()(f.a.mark(function a(){var i,d;return f.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,b.b.get("api/projects/".concat(c.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/historical_exports"));case 2:return i=E.sent,d=i.results,E.abrupt("return",d);case 5:case"end":return E.stop()}},a)}));function l(){return e.apply(this,arguments)}return l}()}],errorDetails:[[],{openErrorDetailsModal:function(){var e=L()(f.a.mark(function a(i){var d,_,E,k,w,q;return f.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return d=i.category,_=i.jobId,E=i.errorType,k=Object(Q.Eb)({category:d,job_id:_,error_type:E}),I.next=4,b.b.get("api/projects/".concat(c.a.values.currentTeamId,"/app_metrics/").concat(s.pluginConfigId,"/error_details?").concat(k));case 4:return w=I.sent,q=w.result,I.abrupt("return",q);case 7:case"end":return I.stop()}},a)}));function l(a){return e.apply(this,arguments)}return l}()}]}}),Object(j.selectors)(function(t){var n=t.values,s=t.actions;return{breadcrumbs:[function(e){return[e.pluginConfig,function(l,a){return a.pluginConfigId}]},function(e,l){var a;return[{name:"Apps",path:v.a.projectApps()},{name:e==null||(a=e.plugin_info)===null||a===void 0?void 0:a.name,path:v.a.appMetrics(l)}]}],defaultTab:[function(e){return[e.pluginConfig]},function(){return Z.filter(function(e){return n.showTab(e)})[0]}],currentTime:[function(){return[]},function(){return Date.now()}],defaultDateFrom:[function(e){return[e.pluginConfig,e.currentTime]},function(e,l){if(!(e!=null&&e.created_at))return J;var a=Y.a.utc(e.created_at),i=Object(Y.a)(l).diff(a,"days",!0);return i<=1?"-24h":i<=7?"-7d":J}],dateFrom:[function(e){return[e.selectedDateFrom,e.defaultDateFrom]},function(e,l){var a;return(a=e!=null?e:l)!==null&&a!==void 0?a:J}],showTab:[function(){return[]},function(){return function(e){if(n.pluginConfigLoading||!n.pluginConfig||!n.pluginConfig.plugin_info.capabilities)return!1;var l=n.pluginConfig.plugin_info.capabilities,a=l.methods.includes("exportEvents");return e===u.HistoricalExports?a:e===u.OnEvent&&a?!1:e===u.ScheduledTask?!a&&["runEveryMinute","runEveryHour","runEveryDay"].some(function(i){return l.scheduled_tasks.includes(i)}):l.methods.includes(e)}}],interfaceJobsProps:[function(e){return[e.pluginConfig]},function(e){return!e||!e.plugin_info.public_jobs||!(e!=null&&e.enabled)?null:{jobName:X.b,jobSpec:e.plugin_info.public_jobs[X.b],pluginConfigId:e.id,pluginId:e.plugin,onSubmit:s.loadHistoricalExports}}],hasRunningExports:[function(e){return[e.historicalExports]},function(e){return e.some(function(l){return l.status=="not_finished"})}]}}),Object(j.listeners)(function(t){var n=t.values,s=t.actions;return{loadPluginConfigSuccess:function(){n.activeTab||s.setActiveTab(n.defaultTab)},setActiveTab:function(l){var a=l.tab;a===u.HistoricalExports?s.loadHistoricalExports():s.loadMetrics()},setDateFrom:function(){s.loadMetrics()},openHistoricalExportModal:function(){n.interfaceJobsProps&&Object(re.a)(n.interfaceJobsProps).actions.setIsJobModalOpen(!0)}}}),Object(x.actionToUrl)(function(t){var n=t.values,s=t.props;return{setActiveTab:function(){return S(n,s)},setDateFrom:function(){return S(n,s)},openErrorDetailsModal:function(){return S(n,s)},closeErrorDetailsModal:function(){return S(n,s)}}}),Object(x.urlToAction)(function(t){var n=t.values,s=t.actions,e=t.props;return{"/app/:pluginConfigId/:page":function(a,i){if(e.pluginConfigId===Number(a.pluginConfigId))if(n.pluginConfig||s.loadPluginConfig(),a.page===u.HistoricalExports)s.setActiveTab(u.HistoricalExports);else if(i.tab&&Z.includes(i.tab)&&i.tab!==n.activeTab?s.setActiveTab(i.tab):n.defaultTab&&n.activeTab!==n.defaultTab&&s.setActiveTab(n.defaultTab),i.from&&n.selectedDateFrom!==i.from&&s.setDateFrom(i.from),i.error){var d=U()(i.error,2),_=d[0],E=d[1];n.errorDetailsModalError!==_&&(s.setActiveTab(E),s.openErrorDetailsModal(_,E))}else s.closeErrorDetailsModal()}}})]);function S(t,n){if(t.activeTab===u.HistoricalExports)return v.a.appHistoricalExports(n.pluginConfigId);var s={};return t.activeTab&&t.activeTab!==t.defaultTab&&(s.tab=t.activeTab),t.selectedDateFrom&&(s.from=t.selectedDateFrom),t.errorDetailsModalError&&t.activeTab&&(s.error=[t.errorDetailsModalError,t.activeTab]),v.a.appMetrics(n.pluginConfigId,s)}}}]);
