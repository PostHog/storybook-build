(window.webpackJsonp=window.webpackJsonp||[]).push([[240],{"./frontend/src/lib/forms/Field.tsx":function(k,C,e){"use strict";e.d(C,"a",function(){return y});var K=e("./node_modules/core-js/modules/es.function.name.js"),ie=e.n(K),H=e("./node_modules/@babel/runtime/helpers/extends.js"),ne=e.n(H),B=e("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),W=e.n(B),I=e("./node_modules/clsx/dist/clsx.m.js"),t=e("./node_modules/kea-forms/lib/components.js"),S=e.n(t),b=e("./node_modules/react/index.js"),p=e.n(b),y=function(x){var J=x.showOptional,q=x.name,ue=W()(x,["showOptional","name"]),ce=function(z){var M=z.label,X=z.kids,Q=z.hint,G=z.error;return p.a.createElement("div",{className:Object(I.a)("ant-row","ant-form-item",Q||G?"ant-form-item-with-help":"",G?"ant-form-item-has-error":"")},M?p.a.createElement("div",{className:"ant-col ant-form-item-label"},p.a.createElement("label",{htmlFor:String(q),title:typeof M=="string"?M:void 0},J?p.a.createElement(p.a.Fragment,null,M,J?p.a.createElement("span",{className:"ant-form-item-optional",title:""},"(optional)"):null):M)):null,p.a.createElement("div",{className:"ant-col ant-form-item-control"},p.a.createElement("div",{className:"ant-form-item-control-input"},p.a.createElement("div",{className:"ant-form-item-control-input-content"},X)),Q||G?p.a.createElement("div",{className:"ant-form-item-explain ant-form-item-explain-connected"},G?p.a.createElement("div",{role:"alert",className:"ant-form-item-explain-error"},"Error: ",G):null,Q?p.a.createElement("div",{role:"alert",className:"ant-form-item-explain-warning"},"Hint: ",Q):null):null))};return p.a.createElement(t.Field,ne()({},ue,{name:q,template:ce}))};try{y.displayName="Field",y.__docgenInfo={description:"Compatible replacement for Form.Item",displayName:"Field",props:{showOptional:{defaultValue:null,description:"",name:"showOptional",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/forms/Field.tsx#Field"]={docgenInfo:y.__docgenInfo,name:"Field",path:"frontend/src/lib/forms/Field.tsx#Field"})}catch(L){}},"./frontend/src/lib/forms/VerticalForm.tsx":function(k,C,e){"use strict";e.d(C,"a",function(){return t});var K=e("./node_modules/@babel/runtime/helpers/extends.js"),ie=e.n(K),H=e("./node_modules/react/index.js"),ne=e.n(H),B=e("./node_modules/kea-forms/lib/index.js"),W=e.n(B),I=e("./node_modules/clsx/dist/clsx.m.js");function t(S){return ne.a.createElement(B.Form,ie()({},S,{className:Object(I.a)("antd-form ant-form-vertical",S.className)}),S.children)}try{t.displayName="VerticalForm",t.__docgenInfo={description:"",displayName:"VerticalForm",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/forms/VerticalForm.tsx#VerticalForm"]={docgenInfo:t.__docgenInfo,name:"VerticalForm",path:"frontend/src/lib/forms/VerticalForm.tsx#VerticalForm"})}catch(S){}},"./frontend/src/lib/introductions/GroupsIntroductionOption.tsx":function(k,C,e){"use strict";e.d(C,"a",function(){return y});var K=e("./node_modules/core-js/modules/es.array.includes.js"),ie=e.n(K),H=e("./node_modules/core-js/modules/es.string.includes.js"),ne=e.n(H),B=e("./node_modules/react/index.js"),W=e.n(B),I=e("./node_modules/kea/lib/index.esm.js"),t=e("./node_modules/@ant-design/icons/es/icons/LockOutlined.js"),S=e("./node_modules/rc-select/es/index.js"),b=e("./frontend/src/lib/components/Link.tsx"),p=e("./frontend/src/lib/introductions/groupsAccessLogic.ts");function y(L){var x=L.value,J=Object(I.useValues)(p.b),q=J.groupsAccessStatus;return[p.a.HasAccess,p.a.HasGroupTypes,p.a.NoAccess].includes(q)?W.a.createElement(S.default.Option,{key:"groups",value:x,disabled:!0,style:{height:"100%",width:"100%",overflow:"hidden",textOverflow:"ellipsis",backgroundColor:"var(--bg-side)",color:"var(--text-muted)"}},W.a.createElement(t.a,{style:{marginRight:6,color:"var(--warning)"}}),"Unique groups \u2013"," ",W.a.createElement(b.a,{to:"https://posthog.com/docs/user-guides/group-analytics?utm_medium=in-product&utm_campaign=group-analytics-learn-more",target:"_blank","data-attr":"group-analytics-learn-more",style:{fontWeight:600}},"Learn more")):null}try{y.displayName="GroupsIntroductionOption",y.__docgenInfo={description:"",displayName:"GroupsIntroductionOption",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"any"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/introductions/GroupsIntroductionOption.tsx#GroupsIntroductionOption"]={docgenInfo:y.__docgenInfo,name:"GroupsIntroductionOption",path:"frontend/src/lib/introductions/GroupsIntroductionOption.tsx#GroupsIntroductionOption"})}catch(L){}},"./frontend/src/scenes/feature-flags/FeatureFlag.tsx":function(k,C,e){"use strict";e.r(C),e.d(C,"scene",function(){return yt}),e.d(C,"FeatureFlag",function(){return me});var K=e("./node_modules/core-js/modules/es.array.concat.js"),ie=e("./node_modules/core-js/modules/es.array.map.js"),H=e("./node_modules/core-js/modules/es.object.to-string.js"),ne=e("./node_modules/core-js/modules/es.regexp.to-string.js"),B=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),W=e.n(B),I=e("./node_modules/react/index.js"),t=e.n(I),S=e("./node_modules/kea-forms/lib/index.js"),b=e("./node_modules/antd/es/button/index.js"),p=e("./node_modules/antd/es/row/index.js"),y=e("./node_modules/antd/es/col/index.js"),L=e("./node_modules/antd/es/input/index.js"),x=e("./node_modules/antd/es/collapse/index.js"),J=e("./node_modules/antd/es/popconfirm/index.js"),q=e("./node_modules/antd/es/radio/index.js"),ue=e("./node_modules/antd/es/slider/index.js"),ce=e("./node_modules/antd/es/input-number/index.js"),re=e("./node_modules/antd/es/select/index.js"),z=e("./node_modules/antd/es/card/index.js"),M=e("./node_modules/kea/lib/index.esm.js"),X=e("./frontend/src/lib/utils.tsx"),Q=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),G=e("./node_modules/@ant-design/icons/es/icons/DeleteOutlined.js"),ge=e("./node_modules/@ant-design/icons/es/icons/SaveOutlined.js"),ve=e("./node_modules/@ant-design/icons/es/icons/ApiFilled.js"),Te=e("./node_modules/@ant-design/icons/es/icons/LockOutlined.js"),pe=e("./node_modules/@ant-design/icons/es/icons/MergeCellsOutlined.js"),Ee=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),ee=e("./node_modules/core-js/modules/es.array.every.js"),Be=e("./node_modules/core-js/modules/es.array.filter.js"),nt=e("./node_modules/core-js/modules/es.array.find.js"),We=e("./node_modules/core-js/modules/es.array.for-each.js"),_e=e("./node_modules/core-js/modules/es.array.iterator.js"),Ue=e("./node_modules/core-js/modules/es.array.reduce.js"),Ce=e("./node_modules/core-js/modules/es.array.splice.js"),Ve=e("./node_modules/core-js/modules/es.function.name.js"),Ne=e("./node_modules/core-js/modules/es.regexp.exec.js"),Me=e("./node_modules/core-js/modules/es.string.match.js"),de=e("./node_modules/core-js/modules/es.string.replace.js"),rt=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),Ae=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),De=e("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),R=e.n(De),be=e("./node_modules/@babel/runtime/regenerator/index.js"),c=e.n(be),d=e("./node_modules/regenerator-runtime/runtime.js"),f=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),m=e.n(f),h=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),O=e.n(h),$=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),Y=e.n($),F=e("./frontend/src/lib/api.ts"),U=e("./node_modules/kea-router/lib/index.js"),oe=e("./frontend/src/scenes/urls.ts"),A=e("./frontend/src/scenes/teamLogic.ts"),le=e("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),Ge=e("./frontend/src/models/groupsModel.ts"),$e=e("./frontend/src/lib/components/TaxonomicFilter/types.ts"),ot=e("./frontend/src/lib/components/lemonToast.tsx");function Ye(n,a){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);a&&(o=o.filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable})),r.push.apply(r,o)}return r}function l(n){for(var a=1;a<arguments.length;a++){var r=arguments[a]!=null?arguments[a]:{};a%2?Ye(Object(r),!0).forEach(function(o){Y()(n,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Ye(Object(r)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(r,o))})}return n}var Ie={id:null,created_at:null,key:"",name:"",filters:{groups:[{properties:[],rollout_percentage:null}],multivariate:null},deleted:!1,active:!0,created_by:null,is_simple_flag:!1,rollout_percentage:null},lt={key:"",name:"",rollout_percentage:0},st={variants:[{key:"",name:"",rollout_percentage:100}]},ye=Object(M.kea)({path:function(a){return["scenes","feature-flags","featureFlagLogic",a]},props:{},key:function(a){var r=a.id;return r!=null?r:"new"},connect:{values:[A.a,["currentTeamId"],Ge.a,["groupTypes","groupsTaxonomicTypes","aggregationLabel"]]},actions:{setFeatureFlag:function(a){return{featureFlag:a}},addConditionSet:!0,setAggregationGroupTypeIndex:function(a){return{value:a}},removeConditionSet:function(a){return{index:a}},duplicateConditionSet:function(a){return{index:a}},updateConditionSet:function(a,r,o){return{index:a,newRolloutPercentage:r,newProperties:o}},deleteFeatureFlag:function(a){return{featureFlag:a}},setMultivariateEnabled:function(a){return{enabled:a}},setMultivariateOptions:function(a){return{multivariateOptions:a}},addVariant:!0,removeVariant:function(a){return{index:a}},distributeVariantsEqually:!0},forms:function(a){var r=a.actions;return{featureFlag:{defaults:l({},Ie),validator:function(u){var i,s,E,g=u.key,D=u.filters;return{key:g?!((i=g.match)===null||i===void 0)&&i.call(g,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key",filters:{multivariate:{variants:D==null||(s=D.multivariate)===null||s===void 0||(E=s.variants)===null||E===void 0?void 0:E.map(function(T){var ae,P=T.key;return{key:P?!((ae=P.match)===null||ae===void 0)&&ae.call(P,/^([A-z]|[a-z]|[0-9]|-|_)+$/)?void 0:"Only letters, numbers, hyphens (-) & underscores (_) are allowed.":"You need to set a key"}})}}}},submit:function(u){r.saveFeatureFlag(u)}}}},reducers:{featureFlag:[l({},Ie),{setFeatureFlag:function(a,r){var o=r.featureFlag;if(o.filters.groups){var u=o.filters.groups.map(function(i){return i.properties?l(l({},i),{},{properties:Object(X.s)(i.properties)}):i});return l(l({},o),{},{filters:l(l({},o==null?void 0:o.filters),{},{groups:u})})}return o},addConditionSet:function(a){if(!a)return a;var r=[].concat(O()(a==null?void 0:a.filters.groups),[{properties:[],rollout_percentage:null}]);return l(l({},a),{},{filters:l(l({},a.filters),{},{groups:r})})},updateConditionSet:function(a,r){var o=r.index,u=r.newRolloutPercentage,i=r.newProperties;if(!a)return a;var s=O()(a==null?void 0:a.filters.groups);return u!==void 0&&(s[o]=l(l({},s[o]),{},{rollout_percentage:u})),i!==void 0&&(s[o]=l(l({},s[o]),{},{properties:i})),l(l({},a),{},{filters:l(l({},a.filters),{},{groups:s})})},removeConditionSet:function(a,r){var o=r.index;if(!a)return a;var u=O()(a.filters.groups);return u.splice(o,1),l(l({},a),{},{filters:l(l({},a.filters),{},{groups:u})})},duplicateConditionSet:function(a,r){var o=r.index;if(!a)return a;var u=a.filters.groups.concat([a.filters.groups[o]]);return l(l({},a),{},{filters:l(l({},a.filters),{},{groups:u})})},setMultivariateOptions:function(a,r){var o=r.multivariateOptions;return a&&l(l({},a),{},{filters:l(l({},a.filters),{},{multivariate:o})})},addVariant:function(a){var r;if(!a)return a;var o=O()(((r=a.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]);return l(l({},a),{},{filters:l(l({},a.filters),{},{multivariate:l(l({},a.filters.multivariate||{}),{},{variants:[].concat(O()(o),[lt])})})})},removeVariant:function(a,r){var o,u=r.index;if(!a)return a;var i=O()(((o=a.filters.multivariate)===null||o===void 0?void 0:o.variants)||[]);return i.splice(u,1),l(l({},a),{},{filters:l(l({},a.filters),{},{multivariate:l(l({},a.filters.multivariate),{},{variants:i})})})},distributeVariantsEqually:function(a){var r;if(!a)return a;var o=O()(((r=a.filters.multivariate)===null||r===void 0?void 0:r.variants)||[]),u=o.length;if(u>0&&u<=100){var i=Math.round(100/u),s=i*u,E=s-100;o.forEach(function(g,D){o[D]=l(l({},g),{},{rollout_percentage:i})}),o[u-1]=l(l({},o[u-1]),{},{rollout_percentage:i-E})}return l(l({},a),{},{filters:l(l({},a.filters),{},{multivariate:l(l({},a.filters.multivariate),{},{variants:o})})})},setAggregationGroupTypeIndex:function(a,r){var o=r.value;return!a||a.filters.aggregation_group_type_index==o?a:l(l({},a),{},{filters:l(l({},a.filters),{},{aggregation_group_type_index:o,groups:[{properties:[],rollout_percentage:null}]})})}}]},loaders:function(a){var r=a.values,o=a.props;return{featureFlag:{loadFeatureFlag:function(){var u=m()(c.a.mark(function s(){return c.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(o.id&&o.id!=="new")){g.next=4;break}return g.next=3,F.a.get("api/projects/".concat(r.currentTeamId,"/feature_flags/").concat(o.id));case 3:return g.abrupt("return",g.sent);case 4:return g.abrupt("return",Ie);case 5:case"end":return g.stop()}},s)}));function i(){return u.apply(this,arguments)}return i}(),saveFeatureFlag:function(){var u=m()(c.a.mark(function s(E){var g,D,T;return c.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(g=E.created_at,D=E.id,T=R()(E,["created_at","id"]),E.id){P.next=7;break}return P.next=4,F.a.create("api/projects/".concat(r.currentTeamId,"/feature_flags"),T);case 4:return P.abrupt("return",P.sent);case 7:return P.next=9,F.a.update("api/projects/".concat(r.currentTeamId,"/feature_flags/").concat(E.id),T);case 9:return P.abrupt("return",P.sent);case 10:case"end":return P.stop()}},s)}));function i(s){return u.apply(this,arguments)}return i}()}}},listeners:function(a){var r=a.actions,o=a.values;return{saveFeatureFlagSuccess:function(i){var s,E=i.featureFlag;ot.a.success("Feature flag saved"),(s=le.a.findMounted())===null||s===void 0||s.actions.updateFlag(E),U.router.actions.replace(oe.a.featureFlag(E.id))},deleteFeatureFlag:function(){var u=m()(c.a.mark(function s(E){var g;return c.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:g=E.featureFlag,Object(X.x)({endpoint:"projects/".concat(o.currentTeamId,"/feature_flags"),object:{name:g.name,id:g.id},callback:function(){var P;g.id&&((P=le.a.findMounted())===null||P===void 0||P.actions.deleteFlag(g.id)),U.router.actions.push(oe.a.featureFlags())}});case 2:case"end":return T.stop()}},s)}));function i(s){return u.apply(this,arguments)}return i}(),setMultivariateEnabled:function(){var u=m()(c.a.mark(function s(E){var g;return c.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:g=E.enabled,g?r.setMultivariateOptions(st):r.setMultivariateOptions(null);case 2:case"end":return T.stop()}},s)}));function i(s){return u.apply(this,arguments)}return i}()}},selectors:{multivariateEnabled:[function(n){return[n.featureFlag]},function(n){return!!(n!=null&&n.filters.multivariate)}],variants:[function(n){return[n.featureFlag]},function(n){var a;return(n==null||(a=n.filters.multivariate)===null||a===void 0?void 0:a.variants)||[]}],nonEmptyVariants:[function(n){return[n.variants]},function(n){return n.filter(function(a){var r=a.key;return!!r})}],variantRolloutSum:[function(n){return[n.variants]},function(n){return n.reduce(function(a,r){var o=r.rollout_percentage;return a+o},0)}],areVariantRolloutsValid:[function(n){return[n.variants,n.variantRolloutSum]},function(n,a){return n.every(function(r){var o=r.rollout_percentage;return o>=0&&o<=100})&&a===100}],aggregationTargetName:[function(n){return[n.featureFlag,n.groupTypes,n.aggregationLabel]},function(n,a,r){return n&&n.filters.aggregation_group_type_index!=null&&a.length>0?r(n.filters.aggregation_group_type_index).plural:"users"}],taxonomicGroupTypes:[function(n){return[n.featureFlag,n.groupsTaxonomicTypes]},function(n,a){return n&&n.filters.aggregation_group_type_index!=null&&a.length>0?[a[n.filters.aggregation_group_type_index]]:[$e.a.PersonProperties,$e.a.Cohorts]}],breadcrumbs:[function(n){return[n.featureFlag]},function(n){return[{name:"Feature Flags",path:oe.a.featureFlags()}].concat(O()(n?[{name:n.key||"Unnamed"}]:[]))}]},urlToAction:function(a){var r,o=a.actions,u=a.props;return Y()({},oe.a.featureFlag((r=u.id)!==null&&r!==void 0?r:"new"),function(i,s,E,g){var D=g.method;D==="PUSH"&&(u.id?o.loadFeatureFlag():o.resetFeatureFlag())})},events:function(a){var r=a.props,o=a.actions;return{afterMount:function(){var i,s=(i=le.a.findMounted())===null||i===void 0?void 0:i.values.featureFlags.find(function(E){return E.id===r.id});s?o.setFeatureFlag(s):r.id!=="new"&&o.loadFeatureFlag()}}}}),it=e("./frontend/src/lib/components/PageHeader.tsx"),ut=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),ct=e.n(ut),dt=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss"),He=e.n(dt),Se={};Se.insert="head",Se.singleton=!1;var Wt=ct()(He.a,Se),Ut=He.a.locals||{},Z=e("./frontend/src/lib/components/icons.tsx"),he=e("./frontend/src/lib/components/Tooltip.tsx"),se=e("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),Oe="?utm_medium=in-product&utm_campaign=feature-flag";function je(n){var a=n.flagKey;return t.a.createElement(t.a.Fragment,null,t.a.createElement(se.a,{language:se.b.JavaScript,wrap:!0},"if\xA0(posthog.isFeatureEnabled('".concat(a!=null?a:"",`')) {
    // run your activation code here
}`)),t.a.createElement("div",{className:"mt"},"Need more information?"," ",t.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/js-integration".concat(Oe,"#feature-flags")},"Check the docs ",t.a.createElement(Z.IconOpenInNew,null))))}function Pe(n){var a=n.flagKey;return t.a.createElement(t.a.Fragment,null,t.a.createElement(se.a,{language:se.b.Python,wrap:!0},'if\xA0posthog.feature_enabled("'.concat(a,`", "user_distinct_id"):
    runAwesomeFeature()
`)),t.a.createElement("div",{className:"mt"},"Need more information?"," ",t.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/python-integration".concat(Oe,"#feature-flags")},"Check the docs ",t.a.createElement(Z.IconOpenInNew,null))))}function mt(){var n=Object(M.useValues)(A.a),a=n.currentTeam;return t.a.createElement(t.a.Fragment,null,t.a.createElement(se.a,{language:se.b.Bash,wrap:!0},"curl ".concat(window.location.origin,`/decide/ \\
-X POST -H 'Content-Type: application/json' \\
-d '{
    "api_key": "`).concat(a?a.api_token:"[project_api_key]",`",
    "distinct_id": "[user distinct id]"
}'
                `)),t.a.createElement("div",{className:"mt"},"Need more information?"," ",t.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/api/feature-flags".concat(Oe)},"Check the docs ",t.a.createElement(Z.IconOpenInNew,null))))}try{je.displayName="JSSnippet",je.__docgenInfo={description:"",displayName:"JSSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"]={docgenInfo:je.__docgenInfo,name:"JSSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#JSSnippet"})}catch(n){}try{Pe.displayName="PythonSnippet",Pe.__docgenInfo={description:"",displayName:"PythonSnippet",props:{flagKey:{defaultValue:null,description:"",name:"flagKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"]={docgenInfo:Pe.__docgenInfo,name:"PythonSnippet",path:"frontend/src/scenes/feature-flags/FeatureFlagSnippets.tsx#PythonSnippet"})}catch(n){}var Je=e("./frontend/src/lib/components/LemonRow/index.ts"),ft=e("./frontend/src/lib/introductions/GroupsIntroductionOption.tsx"),gt=e("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),vt=e("./frontend/src/scenes/userLogic.ts"),Le=e("./frontend/src/types.ts"),pt=e("./frontend/src/lib/components/Link.tsx"),ze=e("./frontend/src/lib/components/LemonButton/index.ts"),Et=e("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),te=e("./frontend/src/lib/forms/Field.tsx"),_t=e("./frontend/src/lib/forms/VerticalForm.tsx"),yt={component:me,logic:ye,paramsToProps:function(a){var r=a.params.id;return{id:r&&r!=="new"?parseInt(r):"new"}}};function Xe(n){setTimeout(function(){var a;return(a=document.querySelector('.variant-form-list input[data-key-index="'.concat(n,'"]')))===null||a===void 0?void 0:a.focus()},50)}function me(){var n,a,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=r.id,u={id:o&&o!=="new"?parseInt(o):"new"},i=Object(M.useValues)(ye(u)),s=i.featureFlag,E=i.multivariateEnabled,g=i.variants,D=i.nonEmptyVariants,T=i.areVariantRolloutsValid,ae=i.variantRolloutSum,P=i.groupTypes,fe=i.aggregationTargetName,ht=i.taxonomicGroupTypes,Ot=i.featureFlagLoading,V=Object(M.useActions)(ye(u)),jt=V.addConditionSet,Qe=V.updateConditionSet,Pt=V.removeConditionSet,Ft=V.duplicateConditionSet,Tt=V.deleteFeatureFlag,Ze=V.setMultivariateEnabled,Ct=V.addVariant,Mt=V.removeVariant,At=V.distributeVariantsEqually,Dt=V.setAggregationGroupTypeIndex,we=Object(M.useValues)(Ge.a),bt=we.showGroupsOptions,It=we.aggregationLabel,ke=Object(M.useValues)(vt.a),xe=ke.hasAvailableFeature,St=ke.upgradeLink,Lt=Object(I.useState)(!1),qe=W()(Lt,2),et=qe[0],xt=qe[1],Rt=Object(I.useState)(!1),tt=W()(Rt,2),Kt=tt[0],Re=tt[1],Bt=Object(ft.a)({value:-2});return t.a.createElement("div",{className:"feature-flag"},s?t.a.createElement(_t.a,{logic:ye,props:u,formKey:"featureFlag"},t.a.createElement(it.a,{title:"Feature Flag",buttons:t.a.createElement("div",{style:{display:"flex"}},t.a.createElement(te.a,{name:"active"},function(_){var v=_.value,j=_.onValueChange;return t.a.createElement(Et.a,{checked:v,onChange:j,label:v?t.a.createElement("span",{className:"text-success"},"Enabled"):t.a.createElement("span",{className:"text-danger"},"Disabled")})}),(s==null?void 0:s.id)&&t.a.createElement(b.a,{"data-attr":"delete-flag",danger:!0,icon:t.a.createElement(G.a,null),onClick:function(){Tt(s)},style:{marginRight:16}},"Delete"),t.a.createElement(b.a,{icon:t.a.createElement(ge.a,null),type:"primary","data-attr":"feature-flag-submit",loading:Ot,htmlType:"submit"},"Save changes"))}),t.a.createElement("h3",{className:"l3"},"General configuration"),t.a.createElement("div",{className:"text-muted mb"},"General settings for your feature flag and integration instructions."),t.a.createElement(p.a,{gutter:16,style:{marginBottom:32}},t.a.createElement(y.a,{span:12},t.a.createElement(te.a,{name:"key",label:"Key (must be unique)",validateStatus:et?"warning":void 0,hint:et&&o!=="new"?t.a.createElement("small",null,t.a.createElement("b",null,"Warning! "),"Changing this key will",t.a.createElement("a",{href:"https://posthog.com/docs/features/feature-flags".concat(Oe,"#feature-flag-persistence"),target:"_blank",rel:"noopener"}," ","affect the persistence of your flag ",t.a.createElement(Z.IconOpenInNew,null))):void 0},function(_){var v=_.value,j=_.onChange;return t.a.createElement(L.a,{value:v,onChange:function(N){N.target.value!==v&&xt(!0),j(N)},"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})}),t.a.createElement(te.a,{name:"name",label:"Description"},function(_){var v=_.value,j=_.onChange;return t.a.createElement(L.a.TextArea,{value:v,onChange:j,className:"ph-ignore-input","data-attr":"feature-flag-description",placeholder:"Adding a helpful description can ensure others know what this feature is for."})})),t.a.createElement(y.a,{span:12,style:{paddingTop:31}},t.a.createElement(x.a,null,t.a.createElement(x.a.Panel,{header:t.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},t.a.createElement(Z.IconJavascript,{style:{marginRight:6}})," Javascript integration instructions"),key:"js"},t.a.createElement(je,{flagKey:s.key||"my-flag"})),t.a.createElement(x.a.Panel,{header:t.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},t.a.createElement(Z.IconPython,{style:{marginRight:6}})," Python integration instructions"),key:"python"},t.a.createElement(Pe,{flagKey:s.key||"my-flag"})),t.a.createElement(x.a.Panel,{header:t.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},t.a.createElement(ve.a,{style:{marginRight:6}})," API integration instructions"),key:"api"},t.a.createElement(mt,null))))),t.a.createElement("div",{className:"mb-2"},t.a.createElement("h3",{className:"l3"},"Served value"),t.a.createElement("div",{className:"mb-05"},t.a.createElement(J.a,{placement:"top",title:"Change value type? The variants below will be lost.",visible:Kt,onConfirm:function(){Ze(!1),Re(!1)},onCancel:function(){return Re(!1)},okText:"OK",cancelText:"Cancel"},t.a.createElement(q.a.Group,{options:[{label:"Boolean value (A/B test)",value:!1},{label:t.a.createElement(he.a,{title:xe(Le.c.MULTIVARIATE_FLAGS)?"":"This feature is not available on your current plan."},t.a.createElement("div",null,!xe(Le.c.MULTIVARIATE_FLAGS)&&t.a.createElement(pt.a,{to:St,target:"_blank"},t.a.createElement(Te.a,{style:{marginRight:4,color:"var(--warning)"}})),"String value (Multivariate test)"," ",t.a.createElement(gt.a,{type:"warning"},"Beta"))),value:!0,disabled:!xe(Le.c.MULTIVARIATE_FLAGS)}],onChange:function(v){var j=v.target.value;j===!1&&D.length?Re(!0):(Ze(j),Xe(0))},value:E,optionType:"button"}))),t.a.createElement("div",{className:"text-muted mb"},Object(X.j)(fe)," will be served"," ",E?t.a.createElement(t.a.Fragment,null,t.a.createElement("strong",null,"a variant key")," according to the below distribution"):t.a.createElement("strong",null,t.a.createElement("code",null,"true"))," ","if they match one or more release condition groups."),E&&t.a.createElement("div",{className:"variant-form-list"},t.a.createElement(p.a,{gutter:8,className:"label-row"},t.a.createElement(y.a,{span:7},"Variant key"),t.a.createElement(y.a,{span:7},"Description"),t.a.createElement(y.a,{span:9},t.a.createElement("span",null,"Rollout percentage"),t.a.createElement(b.a,{type:"link",onClick:At,icon:t.a.createElement(pe.a,null),style:{padding:"0 0 0 0.5em"},title:"Distribute variants equally"},"Distribute"))),g.map(function(_,v){return t.a.createElement(S.Group,{key:v,name:["filters","multivariate","variants",v]},t.a.createElement(p.a,{gutter:8},t.a.createElement(y.a,{span:7},t.a.createElement(te.a,{name:"key"},t.a.createElement(L.a,{"data-attr":"feature-flag-variant-key","data-key-index":v.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(v+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}))),t.a.createElement(y.a,{span:7},t.a.createElement(te.a,{name:"name"},t.a.createElement(L.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"}))),t.a.createElement(y.a,{span:7},t.a.createElement(te.a,{name:"rollout_percentage"},function(j){var w=j.value,N=j.onValueChange;return t.a.createElement(ue.a,{tooltipPlacement:"top",value:w,onChange:N})})),t.a.createElement(y.a,{span:2},t.a.createElement(te.a,{name:"rollout_percentage"},function(j){var w=j.value,N=j.onValueChange;return t.a.createElement(ce.a,{min:0,max:100,value:w,onChange:function(Ke){if(Ke!=null){var at=parseInt(Ke.toString());isNaN(at)||N(at)}},style:{width:"100%",borderColor:T?void 0:"var(--danger)"}})})),g.length>1&&t.a.createElement(y.a,{span:1},t.a.createElement(he.a,{title:"Delete this variant",placement:"bottomLeft"},t.a.createElement(b.a,{type:"link",icon:t.a.createElement(G.a,null),onClick:function(){return Mt(v)},style:{color:"var(--danger)"}})))))}),g.length>0&&!T&&t.a.createElement("p",{className:"text-danger"},"Percentage rollouts for variants must sum to 100 (currently ",ae,")."),t.a.createElement(b.a,{type:"dashed",block:!0,icon:t.a.createElement(Ee.a,null),onClick:function(){var v=g.length;Ct(),Xe(v)},style:{marginBottom:16}},"Add Variant"))),t.a.createElement("div",{className:"feature-flag-form-row"},t.a.createElement("div",null,t.a.createElement("h3",{className:"l3"},"Release conditions"),t.a.createElement("div",{className:"text-muted mb"},"Specify the ",fe," to which you want to release this flag. Note that condition sets are rolled out independently of each other.")),bt&&t.a.createElement("div",{className:"centered"},"Match by",t.a.createElement(re.a,{value:((n=s.filters)===null||n===void 0?void 0:n.aggregation_group_type_index)!=null?(a=s.filters)===null||a===void 0?void 0:a.aggregation_group_type_index:-1,onChange:function(v){var j=v!==-1?v:null;Dt(j)},style:{marginLeft:8},"data-attr":"feature-flag-aggregation-filter",dropdownMatchSelectWidth:!1,dropdownAlign:{points:["tr","br"]}},t.a.createElement(re.a.Option,{key:-1,value:-1},"Users"),P.map(function(_){return t.a.createElement(re.a.Option,{key:_.group_type_index,value:_.group_type_index},Object(X.j)(It(_.group_type_index).plural))}),Bt))),t.a.createElement(p.a,{gutter:16},s.filters.groups.map(function(_,v){var j,w;return t.a.createElement(y.a,{span:24,md:24,key:"".concat(v,"-").concat(s.filters.groups.length)},v>0&&t.a.createElement("div",{style:{display:"flex",marginLeft:16}},t.a.createElement("div",{className:"stateful-badge or-light-grey mb"},"OR")),t.a.createElement(z.a,{style:{marginBottom:16}},t.a.createElement("div",{className:"feature-flag-form-row",style:{height:24}},t.a.createElement("div",null,t.a.createElement("span",{className:"simple-tag tag-light-blue",style:{marginRight:8}},"Set ",v+1),!((j=_.properties)===null||j===void 0)&&j.length?t.a.createElement(t.a.Fragment,null,"Matching ",t.a.createElement("b",null,fe)," with filters"):t.a.createElement(t.a.Fragment,null,"Condition set will match ",t.a.createElement("b",null,"all ",fe))),t.a.createElement(p.a,{align:"middle"},t.a.createElement(he.a,{title:"Duplicate this condition set",placement:"bottomLeft"},t.a.createElement(ze.a,{icon:t.a.createElement(Z.IconCopy,null),compact:!0,onClick:function(){return Ft(v)}})),s.filters.groups.length>1&&t.a.createElement(he.a,{title:"Delete this condition set",placement:"bottomLeft"},t.a.createElement(ze.a,{icon:t.a.createElement(Z.IconDelete,null),compact:!0,onClick:function(){return Pt(v)}})))),t.a.createElement(Je.b,{large:!0}),t.a.createElement(Q.a,{style:{marginLeft:15},pageKey:"feature-flag-".concat(s.id,"-").concat(v,"-").concat(s.filters.groups.length,"-").concat((w=s.filters.aggregation_group_type_index)!==null&&w!==void 0?w:""),propertyFilters:_==null?void 0:_.properties,onChange:function(Fe){return Qe(v,void 0,Fe)},taxonomicGroupTypes:ht,showConditionBadge:!0}),t.a.createElement(Je.b,{large:!0}),t.a.createElement("div",{className:"feature-flag-form-row"},t.a.createElement("div",{className:"centered"},"Roll out to"," ",t.a.createElement(ce.a,{style:{width:100,marginLeft:8,marginRight:8},onChange:function(Fe){Qe(v,Fe)},value:_.rollout_percentage!=null?_.rollout_percentage:100,min:0,max:100,addonAfter:"%"})," ","of ",t.a.createElement("b",null,fe)," in this set"))))})),t.a.createElement(z.a,{size:"small",style:{marginBottom:16}},t.a.createElement(b.a,{type:"link",onClick:jt,style:{marginLeft:5}},t.a.createElement(Ee.a,{style:{marginRight:15}})," Add condition set")),t.a.createElement("div",{className:"text-right"},t.a.createElement(b.a,{icon:t.a.createElement(ge.a,null),htmlType:"submit",type:"primary","data-attr":"feature-flag-submit-bottom"},"Save changes"))):t.a.createElement(X.c,null))}try{me.displayName="FeatureFlag",me.__docgenInfo={description:"",displayName:"FeatureFlag",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"]={docgenInfo:me.__docgenInfo,name:"FeatureFlag",path:"frontend/src/scenes/feature-flags/FeatureFlag.tsx#FeatureFlag"})}catch(n){}},"./frontend/src/scenes/feature-flags/featureFlagsLogic.ts":function(k,C,e){"use strict";e.d(C,"a",function(){return be});var K=e("./node_modules/core-js/modules/es.array.concat.js"),ie=e.n(K),H=e("./node_modules/core-js/modules/es.array.filter.js"),ne=e.n(H),B=e("./node_modules/core-js/modules/es.array.find.js"),W=e.n(B),I=e("./node_modules/core-js/modules/es.array.includes.js"),t=e.n(I),S=e("./node_modules/core-js/modules/es.array.iterator.js"),b=e.n(S),p=e("./node_modules/core-js/modules/es.array.map.js"),y=e.n(p),L=e("./node_modules/core-js/modules/es.object.to-string.js"),x=e.n(L),J=e("./node_modules/core-js/modules/es.object.values.js"),q=e.n(J),ue=e("./node_modules/core-js/modules/es.regexp.exec.js"),ce=e.n(ue),re=e("./node_modules/core-js/modules/es.string.includes.js"),z=e.n(re),M=e("./node_modules/core-js/modules/es.string.search.js"),X=e.n(M),Q=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),G=e.n(Q),ge=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),ve=e.n(ge),Te=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),pe=e.n(Te),Ee=e("./node_modules/@babel/runtime/regenerator/index.js"),ee=e.n(Ee),Be=e("./node_modules/regenerator-runtime/runtime.js"),nt=e.n(Be),We=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),_e=e.n(We),Ue=e("./node_modules/kea/lib/index.esm.js"),Ce=e("./frontend/src/lib/api.ts"),Ve=e("./node_modules/fuse.js/dist/fuse.esm.js"),Ne=e("./frontend/src/scenes/teamLogic.ts"),Me=e("./frontend/src/scenes/urls.ts"),de=e("./node_modules/kea-router/lib/index.js"),rt=e.n(de);function Ae(c,d){var f=Object.keys(c);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(c);d&&(m=m.filter(function(h){return Object.getOwnPropertyDescriptor(c,h).enumerable})),f.push.apply(f,m)}return f}function De(c){for(var d=1;d<arguments.length;d++){var f=arguments[d]!=null?arguments[d]:{};d%2?Ae(Object(f),!0).forEach(function(m){ve()(c,m,f[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(f)):Ae(Object(f)).forEach(function(m){Object.defineProperty(c,m,Object.getOwnPropertyDescriptor(f,m))})}return c}var R;(function(c){c.OVERVIEW="overview",c.HISTORY="history"})(R||(R={}));var be=Object(Ue.kea)({path:["scenes","feature-flags","featureFlagsLogic"],connect:{values:[Ne.a,["currentTeamId"]]},actions:{updateFlag:function(d){return{flag:d}},deleteFlag:function(d){return{id:d}},setSearchTerm:function(d){return{searchTerm:d}},setActiveTab:function(d){return{tabKey:d}},setHistoryPage:function(d){return{page:d}}},loaders:function(d){var f=d.values;return{featureFlags:{__default:[],loadFeatureFlags:function(){var m=_e()(ee.a.mark(function O(){var $;return ee.a.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,Ce.a.get("api/projects/".concat(f.currentTeamId,"/feature_flags/"));case 2:return $=F.sent,F.abrupt("return",$.results);case 4:case"end":return F.stop()}},O)}));function h(){return m.apply(this,arguments)}return h}(),updateFeatureFlag:function(){var m=_e()(ee.a.mark(function O($){var Y,F,U;return ee.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return Y=$.id,F=$.payload,A.next=3,Ce.a.update("api/projects/".concat(f.currentTeamId,"/feature_flags/").concat(Y),F);case 3:return U=A.sent,A.abrupt("return",pe()(f.featureFlags).map(function(le){return le.id===U.id?U:le}));case 5:case"end":return A.stop()}},O)}));function h(O){return m.apply(this,arguments)}return h}()}}},selectors:{searchedFeatureFlags:[function(c){return[c.featureFlags,c.searchTerm]},function(c,d){return d?new Ve.a(c,{keys:["key","name"],threshold:.3}).search(d).map(function(f){return f.item}):c}],breadcrumbs:[function(){return[]},function(){return[{name:"Feature Flags",path:Me.a.featureFlags()}]}]},reducers:{searchTerm:{setSearchTerm:function(d,f){var m=f.searchTerm;return m}},featureFlags:{updateFlag:function(d,f){var m=f.flag;return d.find(function(h){var O=h.id;return O===m.id})?d.map(function(h){return h.id===m.id?m:h}):[m].concat(pe()(d))},deleteFlag:function(d,f){var m=f.id;return d.filter(function(h){return h.id!==m})}},activeTab:[R.OVERVIEW,{setActiveTab:function(d,f){var m=f.tabKey;return Object.values(R).includes(m)?m:d}}],historyPage:[null,{setHistoryPage:function(d,f){var m=f.page;return m}}]},actionToUrl:function(d){var f=d.values;return{setActiveTab:function(){var h=De({},de.router.values.searchParams),O=!1;return!h.tab&&f.activeTab===R.OVERVIEW&&(O=!0),h.tab=f.activeTab,f.activeTab!==R.HISTORY&&delete h.page,[de.router.values.location.pathname,h,de.router.values.hashParams,{replace:O}]}}},urlToAction:function(d){var f=d.actions,m=d.values;return ve()({},Me.a.featureFlags(),function(){var h=_e()(ee.a.mark(function O($,Y){var F,U;return ee.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:F=Y.tab,F?F!==m.activeTab&&f.setActiveTab(F):m.activeTab!==R.OVERVIEW&&f.setActiveTab(R.OVERVIEW),U=Y.page,U&&m.activeTab===R.HISTORY&&f.setHistoryPage(U);case 4:case"end":return A.stop()}},O)}));return function(O,$){return h.apply(this,arguments)}}())},events:function(d){var f=d.actions;return{afterMount:function(){f.loadFeatureFlags()}}}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/feature-flags/FeatureFlag.scss":function(k,C,e){var K=e("./node_modules/css-loader/dist/runtime/api.js");C=K(!1),C.push([k.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.feature-flag .LemonSwitch{margin-right:1rem!important}.variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{margin-bottom:4px;font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}.feature-flag-form-row{display:flex;justify-content:space-between;align-items:center;width:100%}.feature-flag-form-row .centered{display:flex;align-items:center;white-space:pre-wrap}",""]),k.exports=C}}]);
