(window.webpackJsonp=window.webpackJsonp||[]).push([[306],{"./frontend/src/scenes/surveys/Survey.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"Survey",(function(){return Survey})),__webpack_require__.d(__webpack_exports__,"SurveyForm",(function(){return SurveyForm})),__webpack_require__.d(__webpack_exports__,"SurveyView",(function(){return SurveyView}));var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.0.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),schema=__webpack_require__("./frontend/src/queries/schema.ts"),surveysLogic=__webpack_require__("./frontend/src/scenes/surveys/surveysLogic.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),pluginsLogic=__webpack_require__("./frontend/src/scenes/plugins/pluginsLogic.ts"),plugins_types=__webpack_require__("./frontend/src/scenes/plugins/types.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");const NEW_SURVEY={name:"",description:"",questions:[{type:types.kb.Open,question:""}],type:types.lb.Popover,linked_flag_id:void 0,targeting_flag_filters:void 0,linked_flag:null,targeting_flag:null,start_date:null,end_date:null,conditions:null,archived:!1},getSurveyEventName=surveyName=>`${surveyName} survey sent`,getSurveyDataQuery=surveyName=>({kind:schema.a.DataTableNode,source:{kind:schema.a.EventsQuery,select:["*","event","properties.$survey_answer","timestamp","person"],orderBy:["timestamp DESC"],after:"-30d",limit:100,event:getSurveyEventName(surveyName)},propertiesViaUrl:!0,showExport:!0,showReload:!0,showColumnConfigurator:!0,showEventFilter:!0,showPropertyFilter:!0}),surveyLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","surveys","surveyLogic"]),Object(index_esm.props)({}),Object(index_esm.key)((_ref=>{let{id:id}=_ref;return id})),Object(index_esm.connect)((()=>({actions:[surveysLogic.b,["loadSurveys"],pluginsLogic.b,["installPlugin"]],values:[pluginsLogic.b,["installedPlugins"]]}))),Object(index_esm.actions)({editingSurvey:editing=>({editing:editing}),setTargetingFlagFilters:groups=>({groups:groups}),updateTargetingFlagFilters:(index,properties)=>({index:index,properties:properties}),addConditionSet:!0,removeConditionSet:index=>({index:index}),setInstallingPlugin:installing=>({installing:installing}),launchSurvey:!0,installSurveyPlugin:!0,stopSurvey:!0,archiveSurvey:!0,setDataTableQuery:query=>({query:query})}),Object(kea_loaders_lib.loaders)((_ref2=>{let{props:props}=_ref2;return{survey:{loadSurvey:async()=>props.id&&"new"!==props.id?await api.b.surveys.get(props.id):{...NEW_SURVEY},createSurvey:async surveyPayload=>await api.b.surveys.create(surveyPayload),updateSurvey:async surveyPayload=>await api.b.surveys.update(props.id,surveyPayload),launchSurvey:async()=>{const startDate=Object(dayjs.a)();return await api.b.surveys.update(props.id,{start_date:startDate.toISOString()})}}}})),Object(index_esm.listeners)((_ref3=>{let{actions:actions}=_ref3;return{loadSurveySuccess:_ref4=>{var _survey$targeting_fla,_survey$targeting_fla2;let{survey:survey}=_ref4;survey.start_date&&actions.setDataTableQuery(getSurveyDataQuery(survey.name)),null!==(_survey$targeting_fla=survey.targeting_flag)&&void 0!==_survey$targeting_fla&&null!==(_survey$targeting_fla2=_survey$targeting_fla.filters)&&void 0!==_survey$targeting_fla2&&_survey$targeting_fla2.groups&&actions.setTargetingFlagFilters(survey.targeting_flag.filters.groups)},createSurveySuccess:_ref5=>{let{survey:survey}=_ref5;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," created"]})),actions.loadSurveys(),kea_router_lib.router.actions.replace(urls.a.survey(survey.id))},updateSurveySuccess:_ref6=>{let{survey:survey}=_ref6;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," updated"]})),actions.editingSurvey(!1),actions.loadSurveys()},launchSurveySuccess:_ref7=>{let{survey:survey}=_ref7;src.lemonToast.success(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Survey ",survey.name," launched"]})),actions.setDataTableQuery(getSurveyDataQuery(survey.name)),actions.loadSurveys()},installSurveyPlugin:async(_,breakpoint)=>{actions.setInstallingPlugin(!0);await(async()=>actions.installPlugin("https://github.com/PostHog/feature-surveys",plugins_types.a.Repository))(),await breakpoint(600),actions.setInstallingPlugin(!1)},stopSurvey:async()=>{const endDate=Object(dayjs.a)();actions.updateSurvey({end_date:endDate.toISOString()})},archiveSurvey:async()=>{actions.updateSurvey({archived:!0})}}})),Object(index_esm.reducers)({isEditingSurvey:[!1,{editingSurvey:(_,_ref8)=>{let{editing:editing}=_ref8;return editing}}],targetingFlagFilters:[null,{setTargetingFlagFilters:(_,_ref9)=>{let{groups:groups}=_ref9;return{groups:groups}},updateTargetingFlagFilters:(state,_ref10)=>{let{index:index,properties:properties}=_ref10;if(null!=state&&state.groups){const groups=[...state.groups];return void 0!==properties&&(groups[index]={...groups[index],properties:properties,rollout_percentage:100}),{...state,groups:groups}}return state},removeConditionSet:(state,_ref11)=>{let{index:index}=_ref11;const groups=[...(null==state?void 0:state.groups)||[]];return groups.splice(index,1),{...state,groups:groups}},addConditionSet:state=>{if(null!=state&&state.groups){const groups=[...state.groups,{properties:[],rollout_percentage:0,variant:null}];return{...state,groups:groups}}return{groups:[{properties:[],rollout_percentage:0,variant:null}]}}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref12)=>{let{query:query}=_ref12;return query}}],installingPlugin:[!1,{setInstallingPlugin:(_,_ref13)=>{let{installing:installing}=_ref13;return installing}}]}),Object(index_esm.selectors)({isSurveyRunning:[s=>[s.survey],survey=>!(!survey.start_date||survey.end_date)],propertySelectErrors:[s=>[s.survey],survey=>{var _survey$targeting_fla3,_survey$targeting_fla4;return null===(_survey$targeting_fla3=survey.targeting_flag_filters)||void 0===_survey$targeting_fla3||null===(_survey$targeting_fla4=_survey$targeting_fla3.groups)||void 0===_survey$targeting_fla4?void 0:_survey$targeting_fla4.map((_ref14=>{let{properties:properties}=_ref14;return{properties:null==properties?void 0:properties.map((property=>({value:null===property.value||void 0===property.value||Array.isArray(property.value)&&0===property.value.length?"Property filters can't be empty":void 0})))}}))}],breadcrumbs:[s=>[s.survey],survey=>[{name:"Surveys",path:urls.a.surveys()},...null!=survey&&survey.name?[{name:survey.name}]:[]]],surveyPlugin:[s=>[s.installedPlugins],installedPlugins=>installedPlugins.find((plugin=>"Surveys app"===plugin.name))]}),Object(lib.forms)((_ref15=>{let{actions:actions,props:props,values:values}=_ref15;return{survey:{defaults:{...NEW_SURVEY},errors:_ref16=>{let{name:name,questions:questions}=_ref16;return{name:!name&&"Please enter a name.",questions:questions.map((_ref17=>{let{question:question}=_ref17;return{question:!question&&"Please enter a question."}}))}},submit:async surveyPayload=>{const surveyPayloadWithTargetingFlagFilters={...surveyPayload,...values.targetingFlagFilters?{targeting_flag_filters:values.targetingFlagFilters}:{}};props.id&&"new"!==props.id?actions.updateSurvey(surveyPayloadWithTargetingFlagFilters):actions.createSurvey(surveyPayloadWithTargetingFlagFilters)}}}})),Object(kea_router_lib.urlToAction)((_ref18=>{var _props$id;let{actions:actions,props:props}=_ref18;return{[urls.a.survey(null!==(_props$id=props.id)&&void 0!==_props$id?_props$id:"new")]:(_,__,___,_ref19)=>{let{method:method}=_ref19;"PUSH"===method&&(props.id?actions.loadSurvey():actions.resetSurvey())}}})),Object(index_esm.afterMount)((async _ref20=>{let{props:props,actions:actions}=_ref20;"new"!==props.id&&await actions.loadSurvey(),"new"===props.id&&actions.resetSurvey()}))]);try{getSurveyEventName.displayName="getSurveyEventName",getSurveyEventName.__docgenInfo={description:"",displayName:"getSurveyEventName",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyEventName"]={docgenInfo:getSurveyEventName.__docgenInfo,name:"getSurveyEventName",path:"frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyEventName"})}catch(__react_docgen_typescript_loader_error){}try{getSurveyDataQuery.displayName="getSurveyDataQuery",getSurveyDataQuery.__docgenInfo={description:"",displayName:"getSurveyDataQuery",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyDataQuery"]={docgenInfo:getSurveyDataQuery.__docgenInfo,name:"getSurveyDataQuery",path:"frontend/src/scenes/surveys/surveyLogic.tsx#getSurveyDataQuery"})}catch(__react_docgen_typescript_loader_error){}var PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.tsx"),Field=__webpack_require__("./frontend/src/lib/forms/Field.tsx"),EarlyAccessFeature=__webpack_require__("./frontend/src/scenes/early-access-features/EarlyAccessFeature.tsx"),PropertyFilters=__webpack_require__("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),TaxonomicFilter_types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),EditableField=__webpack_require__("./frontend/src/lib/components/EditableField/EditableField.tsx"),Query=__webpack_require__("./frontend/src/queries/Query/Query.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),CohortCriteriaRowBuilder=__webpack_require__("./frontend/src/scenes/cohorts/CohortFilters/CohortCriteriaRowBuilder.tsx"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),PropertyFilters_utils=__webpack_require__("./frontend/src/lib/components/PropertyFilters/utils.ts"),DefinitionPopover_utils=__webpack_require__("./frontend/src/lib/components/DefinitionPopover/utils.ts"),cohortsModel=__webpack_require__("./frontend/src/models/cohortsModel.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.tsx"),Spinner=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/index.ts");const scene={component:Survey,logic:surveyLogic,paramsToProps:_ref=>{let{params:{id:id}}=_ref;return{id:id}}},OPT_IN_SNIPPET="posthog.init('YOUR_PROJECT_API_KEY', {\n    api_host: 'YOUR API HOST',\n    opt_in_site_apps: true // <--- Add this line\n})";function Survey(){let{id:id}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{isEditingSurvey:isEditingSurvey}=Object(index_esm.useValues)(surveyLogic),showSurveyForm="new"===id||isEditingSurvey;return Object(jsx_runtime.jsx)("div",{children:id?Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:showSurveyForm?Object(jsx_runtime.jsx)(SurveyForm,{id:id}):Object(jsx_runtime.jsx)(SurveyView,{id:id})}):Object(jsx_runtime.jsx)(LemonSkeleton.a,{})})}function SurveyForm(_ref2){let{id:id}=_ref2;const{survey:survey,surveyLoading:surveyLoading,isEditingSurvey:isEditingSurvey,propertySelectErrors:propertySelectErrors,targetingFlagFilters:targetingFlagFilters}=Object(index_esm.useValues)(surveyLogic),{loadSurvey:loadSurvey,editingSurvey:editingSurvey,updateTargetingFlagFilters:updateTargetingFlagFilters,removeConditionSet:removeConditionSet,addConditionSet:addConditionSet}=Object(index_esm.useActions)(surveyLogic);return Object(jsx_runtime.jsxs)(lib.Form,{formKey:"survey",logic:surveyLogic,className:"space-y-4",enableFormOnSubmit:!0,children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:"new"===id?"New survey":survey.name,buttons:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-survey",type:"secondary",loading:surveyLoading,onClick:()=>{isEditingSurvey?(editingSurvey(!1),loadSurvey()):kea_router_lib.router.actions.push(urls.a.surveys())},children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:surveyLoading,children:"Save"})]})}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2 max-w-160",children:[Object(jsx_runtime.jsx)(Field.a,{name:"name",label:"Name",children:Object(jsx_runtime.jsx)(src.LemonInput,{"data-attr":"survey-name"})}),Object(jsx_runtime.jsx)(Field.a,{name:"description",label:"Description (optional)",children:Object(jsx_runtime.jsx)(src.LemonTextArea,{"data-attr":"survey-description"})}),Object(jsx_runtime.jsx)(Field.a,{name:"type",label:"Type",className:"w-max",children:Object(jsx_runtime.jsx)(src.LemonSelect,{"data-attr":"survey-type",options:[{label:"Popover",value:types.lb.Popover}]})}),Object(jsx_runtime.jsx)(Field.a,{name:"linked_flag_id",label:"Link feature flag (optional)",info:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"Feature you want to connect this survey to."}),children:_ref3=>{let{value:value,onChange:onChange}=_ref3;return Object(jsx_runtime.jsxs)("div",{className:"flex",children:[Object(jsx_runtime.jsx)(EarlyAccessFeature.FlagSelector,{value:value,onChange:onChange}),value&&Object(jsx_runtime.jsx)(src.LemonButton,{className:"ml-2",icon:Object(jsx_runtime.jsx)(icons.y,{}),size:"small",status:"stealth",onClick:()=>onChange(void 0),"aria-label":"close"})]})}}),survey.questions.map(((question,index)=>Object(jsx_runtime.jsx)(lib.Group,{name:`questions.${index}`,children:Object(jsx_runtime.jsx)(Field.a,{name:"question",label:"Question",children:Object(jsx_runtime.jsx)(src.LemonInput,{value:question.question})})},index))),Object(jsx_runtime.jsxs)(Field.b,{label:"Targeting (optional)",className:"mt-4",children:[Object(jsx_runtime.jsx)("span",{className:"text-muted",children:"Choose when the survey appears based on url, selector, and user properties."}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsx)(Field.a,{name:"conditions",children:_ref4=>{let{value:value,onChange:onChange}=_ref4;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(Field.b,{label:"Url",children:Object(jsx_runtime.jsx)(src.LemonInput,{value:null==value?void 0:value.url,onChange:urlVal=>onChange({...value,url:urlVal}),placeholder:"ex: https://app.posthog.com"})}),Object(jsx_runtime.jsx)(CohortCriteriaRowBuilder.b,{logicalOperator:types.v.And}),Object(jsx_runtime.jsx)(Field.b,{label:"Selector",children:Object(jsx_runtime.jsx)(src.LemonInput,{value:null==value?void 0:value.selector,onChange:selectorVal=>onChange({...value,selector:selectorVal}),placeholder:"ex: .className or #id"})})]})}}),Object(jsx_runtime.jsx)(CohortCriteriaRowBuilder.b,{logicalOperator:types.v.And}),Object(jsx_runtime.jsx)(Field.b,{label:"User properties",children:((null==targetingFlagFilters?void 0:targetingFlagFilters.groups)||[]).map(((group,index)=>{var _propertySelectErrors,_propertySelectErrors2;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[index>0&&Object(jsx_runtime.jsx)("div",{className:"text-primary-alt font-semibold text-xs ml-2",children:"OR"}),Object(jsx_runtime.jsxs)("div",{className:"border rounded p-4",children:[Object(jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[Object(jsx_runtime.jsxs)("div",{children:["Matching ",Object(jsx_runtime.jsx)("b",{children:"users"})," against the criteria"]}),Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)(icons.Q,{}),status:"muted",size:"small",noPadding:!0,onClick:()=>removeConditionSet(index)})]}),Object(jsx_runtime.jsx)(src.LemonDivider,{className:"my-3"}),Object(jsx_runtime.jsx)("div",{children:Object(jsx_runtime.jsx)(PropertyFilters.a,{orFiltering:!0,pageKey:`survey-${id}-targeting-${index}`,propertyFilters:group.properties,logicalRowDivider:!0,addButton:Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)(icons.sc,{}),sideIcon:null,noPadding:!0,children:"Add condition"}),onChange:properties=>updateTargetingFlagFilters(index,properties),taxonomicGroupTypes:[TaxonomicFilter_types.a.PersonProperties,TaxonomicFilter_types.a.Cohorts],hasRowOperator:!1,sendAllKeyUpdates:!0,errorMessages:null!=propertySelectErrors&&null!==(_propertySelectErrors=propertySelectErrors[index])&&void 0!==_propertySelectErrors&&null!==(_propertySelectErrors2=_propertySelectErrors.properties)&&void 0!==_propertySelectErrors2&&_propertySelectErrors2.some((message=>!!message.value))?propertySelectErrors[index].properties.map(((message,index)=>message.value?Object(jsx_runtime.jsxs)("div",{className:"text-danger flex items-center gap-1 text-sm",children:[Object(jsx_runtime.jsx)(icons.Z,{className:"text-xl"})," ",message.value]},index):Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{}))):null})})]})]})}))}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",className:"mt-0 w-max",onClick:addConditionSet,icon:Object(jsx_runtime.jsx)(icons.rc,{}),children:"Add condition set"})]})]}),Object(jsx_runtime.jsx)(src.LemonDivider,{}),Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"cancel-survey",type:"secondary",loading:surveyLoading,onClick:()=>{isEditingSurvey?(editingSurvey(!1),loadSurvey()):kea_router_lib.router.actions.push(urls.a.surveys())},children:"Cancel"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary","data-attr":"save-feature-flag",htmlType:"submit",loading:surveyLoading,children:"Save"})]})]})}function SurveyView(_ref5){var _survey$conditions2,_survey$conditions3,_survey$conditions4;let{id:id}=_ref5;const{survey:survey,dataTableQuery:dataTableQuery,surveyLoading:surveyLoading,surveyPlugin:surveyPlugin,installingPlugin:installingPlugin}=Object(index_esm.useValues)(surveyLogic),{editingSurvey:editingSurvey,updateSurvey:updateSurvey,launchSurvey:launchSurvey,stopSurvey:stopSurvey,archiveSurvey:archiveSurvey,installSurveyPlugin:installSurveyPlugin}=Object(index_esm.useActions)(surveyLogic),{deleteSurvey:deleteSurvey}=Object(index_esm.useActions)(surveysLogic.b),{cohortsById:cohortsById}=Object(index_esm.useValues)(cohortsModel.a),{editPlugin:editPlugin}=Object(index_esm.useActions)(pluginsLogic.b),[setupModalIsOpen,setSetupModalIsOpen]=Object(react.useState)(!1),[tabKey,setTabKey]=Object(react.useState)(survey.start_date?"results":"overview");return Object(react.useEffect)((()=>{survey.start_date&&setTabKey("results")}),[survey.start_date]),Object(jsx_runtime.jsxs)("div",{children:[surveyLoading?Object(jsx_runtime.jsx)(LemonSkeleton.a,{}):Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:survey.name,buttons:Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[Object(jsx_runtime.jsx)(More.a,{overlay:Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!survey.end_date&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)(src.LemonButton,{"data-attr":"edit-survey",fullWidth:!0,onClick:()=>editingSurvey(!0),children:"Edit"}),Object(jsx_runtime.jsx)(src.LemonDivider,{})]}),Object(jsx_runtime.jsx)(src.LemonButton,{status:"danger",onClick:()=>deleteSurvey(id),children:"Delete survey"})]})}),Object(jsx_runtime.jsx)(src.LemonDivider,{vertical:!0}),survey.start_date?survey.end_date&&!survey.archived?Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:()=>archiveSurvey(),children:"Archive"}):!survey.archived&&Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",status:"danger",onClick:()=>stopSurvey(),children:"Stop"}):Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>{var _survey$conditions;surveyPlugin||null!==(_survey$conditions=survey.conditions)&&void 0!==_survey$conditions&&_survey$conditions.is_headless?launchSurvey():setSetupModalIsOpen(!0)},children:"Launch"})]}),caption:Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:survey&&!!survey.description&&Object(jsx_runtime.jsx)(EditableField.a,{multiline:!0,name:"description",value:survey.description||"",placeholder:"Description (optional)",onSave:value=>updateSurvey({id:id,description:value}),saveOnBlur:!0,compactButtons:!0})})}),Object(jsx_runtime.jsx)(LemonTabs.a,{activeKey:tabKey,onChange:key=>setTabKey(key),tabs:[{content:Object(jsx_runtime.jsxs)("div",{className:"flex flex-row",children:[Object(jsx_runtime.jsxs)("div",{className:"flex flex-col w-full",children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Type"}),Object(jsx_runtime.jsx)("span",{children:Object(utils.i)(types.lb.Popover)}),Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Questions"}),survey.questions.map(((q,idx)=>Object(jsx_runtime.jsx)("span",{children:q.question},idx))),Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Linked feature flag"}),survey.linked_flag?Object(jsx_runtime.jsx)(src.Link,{to:urls.a.featureFlag(survey.linked_flag.id),children:survey.linked_flag.key}):Object(jsx_runtime.jsx)("span",{children:"None"}),Object(jsx_runtime.jsxs)("div",{className:"flex flex-row gap-8",children:[survey.start_date&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Start date"}),Object(jsx_runtime.jsx)(TZLabel.a,{time:survey.start_date})]}),survey.end_date&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"End date"}),Object(jsx_runtime.jsx)(TZLabel.a,{time:survey.end_date})]})]}),(survey.conditions||survey.targeting_flag)&&Object(jsx_runtime.jsxs)("div",{className:"flex flex-col mt-6",children:[Object(jsx_runtime.jsx)("span",{className:"font-medium text-lg",children:"Targeting"}),(null===(_survey$conditions2=survey.conditions)||void 0===_survey$conditions2?void 0:_survey$conditions2.url)&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4 mb-1 underline",children:"Url"}),Object(jsx_runtime.jsx)("span",{children:survey.conditions.url}),((null===(_survey$conditions3=survey.conditions)||void 0===_survey$conditions3?void 0:_survey$conditions3.selector)||survey.targeting_flag)&&Object(jsx_runtime.jsx)(CohortCriteriaRowBuilder.b,{logicalOperator:types.v.And})]}),(null===(_survey$conditions4=survey.conditions)||void 0===_survey$conditions4?void 0:_survey$conditions4.selector)&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4",children:"Selector"}),Object(jsx_runtime.jsx)("span",{children:survey.conditions.selector})]}),survey.targeting_flag&&Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[Object(jsx_runtime.jsx)("span",{className:"card-secondary mt-4 pb-1 underline",children:"Release conditions"}),survey.targeting_flag.filters.groups.map(((group,index)=>Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[index>0&&Object(jsx_runtime.jsx)("div",{className:"text-primary-alt font-semibold text-xs ml-2 py-1",children:"OR"}),group.properties.map(((property,idx)=>{var _cohortsById$property;return Object(jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object(jsx_runtime.jsxs)("div",{className:"feature-flag-property-display",children:[0===idx?Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)(icons.Zc,{className:"arrow-right"}),status:"muted",size:"small"}):Object(jsx_runtime.jsx)(src.LemonButton,{icon:Object(jsx_runtime.jsx)("span",{className:"text-sm",children:"&"}),status:"muted",size:"small"}),Object(jsx_runtime.jsxs)("span",{className:"simple-tag tag-light-blue text-primary-alt",children:["cohort"===property.type?"Cohort":property.key," "]}),Object(PropertyFilters_utils.e)(property)?Object(jsx_runtime.jsxs)("span",{children:[Object(DefinitionPopover_utils.a)(property.operator)," "]}):null,"cohort"===property.type?Object(jsx_runtime.jsx)("a",{href:urls.a.cohort(property.value),target:"_blank",rel:"noopener",className:"simple-tag tag-light-blue text-primary-alt display-value",children:property.value&&(null===(_cohortsById$property=cohortsById[property.value])||void 0===_cohortsById$property?void 0:_cohortsById$property.name)||`ID ${property.value}`}):[...Array.isArray(property.value)?property.value:[property.value]].map(((val,idx)=>Object(jsx_runtime.jsx)("span",{className:"simple-tag tag-light-blue text-primary-alt display-value",children:val},idx)))]},idx)})}))]})))]})]})]}),Object(jsx_runtime.jsx)("div",{className:"w-full",children:Object(jsx_runtime.jsx)(src.LemonCollapse,{className:"w-full",panels:[{key:"1",header:"Survey setup help",content:Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsxs)("div",{className:"flex flex-col",children:[Object(jsx_runtime.jsx)("span",{className:"font-medium mb-2",children:"Option 1: Enable the surveys app (recommended)"}),Object(jsx_runtime.jsxs)("div",{className:"flex gap-2 items-start",children:[Object(jsx_runtime.jsx)(src.LemonCheckbox,{})," Add the following option to your PostHog instance:"]}),Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:OPT_IN_SNIPPET}),Object(jsx_runtime.jsxs)("div",{className:"flex gap-1 items-center",children:[Object(jsx_runtime.jsx)(src.LemonCheckbox,{checked:!!surveyPlugin})," ",surveyPlugin?Object(jsx_runtime.jsx)("span",{children:"Install survey app"}):Object(jsx_runtime.jsx)(src.LemonButton,{onClick:installSurveyPlugin,children:"Install the survey app"})," ",installingPlugin&&Object(jsx_runtime.jsx)(Spinner.a,{})]}),Object(jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[Object(jsx_runtime.jsx)(src.LemonCheckbox,{})," ",Object(jsx_runtime.jsx)(src.LemonButton,{onClick:()=>(null==surveyPlugin?void 0:surveyPlugin.id)&&editPlugin(surveyPlugin.id),children:"Enable and save the surveys app"})]})]}),Object(jsx_runtime.jsxs)("div",{className:"flex flex-col mt-3",children:[Object(jsx_runtime.jsx)("span",{className:"font-medium",children:"Option 2: Create your own custom survey UI with our headless API"}),Object(jsx_runtime.jsx)(src.Link,{to:"/docs/features/surveys",children:"See documentation"})]})]})}]})})]}),key:"overview",label:"Overview"},survey.start_date?{content:Object(jsx_runtime.jsxs)("div",{children:[Object(jsx_runtime.jsx)("div",{className:"flex flex-row gap-4"}),surveyLoading?Object(jsx_runtime.jsx)(LemonSkeleton.a,{}):Object(jsx_runtime.jsx)(Query.a,{query:dataTableQuery})]}),key:"results",label:"Results"}:null]})]}),Object(jsx_runtime.jsx)(SurveyLaunchSetupModal,{isOpen:setupModalIsOpen,closeModal:()=>setSetupModalIsOpen(!1),launchSurvey:()=>{installSurveyPlugin(),launchSurvey(),setSetupModalIsOpen(!1)}})]})}function SurveyLaunchSetupModal(_ref6){let{isOpen:isOpen,closeModal:closeModal,launchSurvey:launchSurvey}=_ref6;return Object(jsx_runtime.jsxs)(src.LemonModal,{isOpen:isOpen,onClose:closeModal,width:600,title:"Launch setup instructions",description:"To launch this survey, you'll need to make sure you've enabled site apps in your PostHog instance by adding this option:",footer:Object(jsx_runtime.jsxs)("div",{className:"flex gap-4",children:[Object(jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:launchSurvey,children:"Launch"}),Object(jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:closeModal,children:"Cancel"})]}),children:[Object(jsx_runtime.jsx)(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0,children:OPT_IN_SNIPPET}),"Launching this survey will install the surveys app for your project. You can then enable the app and save it to complete the setup."]})}try{Survey.displayName="Survey",Survey.__docgenInfo={description:"",displayName:"Survey",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#Survey"]={docgenInfo:Survey.__docgenInfo,name:"Survey",path:"frontend/src/scenes/surveys/Survey.tsx#Survey"})}catch(__react_docgen_typescript_loader_error){}try{SurveyForm.displayName="SurveyForm",SurveyForm.__docgenInfo={description:"",displayName:"SurveyForm",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#SurveyForm"]={docgenInfo:SurveyForm.__docgenInfo,name:"SurveyForm",path:"frontend/src/scenes/surveys/Survey.tsx#SurveyForm"})}catch(__react_docgen_typescript_loader_error){}try{SurveyView.displayName="SurveyView",SurveyView.__docgenInfo={description:"",displayName:"SurveyView",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/Survey.tsx#SurveyView"]={docgenInfo:SurveyView.__docgenInfo,name:"SurveyView",path:"frontend/src/scenes/surveys/Survey.tsx#SurveyView"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/surveys/surveysLogic.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getSurveyStatus})),__webpack_require__.d(__webpack_exports__,"b",(function(){return surveysLogic}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@16.14.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/types.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/urls.ts"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea_router__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.3_kea@3.1.5/node_modules/kea-router/lib/index.js");function getSurveyStatus(survey){return survey.start_date?survey.end_date?_types__WEBPACK_IMPORTED_MODULE_3__.Q.Complete:_types__WEBPACK_IMPORTED_MODULE_3__.Q.Running:_types__WEBPACK_IMPORTED_MODULE_3__.Q.Draft}const surveysLogic=Object(kea__WEBPACK_IMPORTED_MODULE_0__.kea)([Object(kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","surveys","surveysLogic"]),Object(kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)((_ref=>{let{values:values}=_ref;return{surveys:{__default:[],loadSurveys:async()=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.surveys.list()).results,deleteSurvey:async id=>(await lib_api__WEBPACK_IMPORTED_MODULE_2__.b.surveys.delete(id),values.surveys.filter((survey=>survey.id!==id)))}}})),Object(kea__WEBPACK_IMPORTED_MODULE_0__.listeners)((()=>({deleteSurveySuccess:()=>{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.lemonToast.success("Survey deleted"),kea_router__WEBPACK_IMPORTED_MODULE_6__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_4__.a.surveys())}}))),Object(kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({breadcrumbs:[()=>[],()=>[{name:"Surveys",path:scenes_urls__WEBPACK_IMPORTED_MODULE_4__.a.surveys()}]],nonArchivedSurveys:[s=>[s.surveys],surveys=>surveys.filter((survey=>!survey.archived))],archivedSurveys:[s=>[s.surveys],surveys=>surveys.filter((survey=>survey.archived))]}),Object(kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)((async _ref2=>{let{actions:actions}=_ref2;await actions.loadSurveys()}))]);try{getSurveyStatus.displayName="getSurveyStatus",getSurveyStatus.__docgenInfo={description:"",displayName:"getSurveyStatus",props:{id:{defaultValue:null,description:"UUID",name:"id",required:!0,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},description:{defaultValue:null,description:"",name:"description",required:!0,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"popover"'},{value:'"button"'},{value:'"full_screen"'},{value:'"email"'}]}},linked_flag:{defaultValue:null,description:"",name:"linked_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag:{defaultValue:null,description:"",name:"targeting_flag",required:!0,type:{name:"FeatureFlagBasicType | null"}},targeting_flag_filters:{defaultValue:null,description:"",name:"targeting_flag_filters",required:!0,type:{name:'Pick<FeatureFlagFilters, "groups"> | undefined'}},conditions:{defaultValue:null,description:"",name:"conditions",required:!0,type:{name:"{ url: string; selector: string; is_headless?: boolean | undefined; } | null"}},appearance:{defaultValue:null,description:"",name:"appearance",required:!0,type:{name:"SurveyAppearance"}},questions:{defaultValue:null,description:"",name:"questions",required:!0,type:{name:"SurveyQuestion[]"}},created_at:{defaultValue:null,description:"",name:"created_at",required:!0,type:{name:"string"}},created_by:{defaultValue:null,description:"",name:"created_by",required:!0,type:{name:"UserBasicType | null"}},start_date:{defaultValue:null,description:"",name:"start_date",required:!0,type:{name:"string | null"}},end_date:{defaultValue:null,description:"",name:"end_date",required:!0,type:{name:"string | null"}},archived:{defaultValue:null,description:"",name:"archived",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/surveys/surveysLogic.tsx#getSurveyStatus"]={docgenInfo:getSurveyStatus.__docgenInfo,name:"getSurveyStatus",path:"frontend/src/scenes/surveys/surveysLogic.tsx#getSurveyStatus"})}catch(__react_docgen_typescript_loader_error){}}}]);