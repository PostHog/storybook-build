(window.webpackJsonp=window.webpackJsonp||[]).push([[291],{"./frontend/src/scenes/data-management/DataManagementPageTabs.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return DataManagementTab})),__webpack_require__.d(__webpack_exports__,"a",(function(){return DataManagementPageTabs}));var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),antd__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/antd@4.17.1_wcqkhtmu7mswc6yz4uyexck3ty/node_modules/antd/es/tabs/index.js"),scenes_urls__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/scenes/urls.ts"),lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip.tsx"),lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),lib_components_TitleWithIcon__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/components/TitleWithIcon.tsx"),lib_constants__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/constants.tsx"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js");let DataManagementTab;!function(DataManagementTab){DataManagementTab.Actions="actions",DataManagementTab.EventDefinitions="events",DataManagementTab.PropertyDefinitions="properties",DataManagementTab.IngestionWarnings="warnings"}(DataManagementTab||(DataManagementTab={}));const tabUrls={[DataManagementTab.PropertyDefinitions]:scenes_urls__WEBPACK_IMPORTED_MODULE_2__.a.propertyDefinitions(),[DataManagementTab.EventDefinitions]:scenes_urls__WEBPACK_IMPORTED_MODULE_2__.a.eventDefinitions(),[DataManagementTab.Actions]:scenes_urls__WEBPACK_IMPORTED_MODULE_2__.a.actions(),[DataManagementTab.IngestionWarnings]:scenes_urls__WEBPACK_IMPORTED_MODULE_2__.a.ingestionWarnings()},eventsTabsLogic=Object(kea__WEBPACK_IMPORTED_MODULE_0__.kea)({path:["scenes","events","eventsTabsLogic"],connect:{values:[lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_7__.a,["featureFlags"]]},actions:{setTab:tab=>({tab:tab})},reducers:{tab:[DataManagementTab.EventDefinitions,{setTab:(_,_ref)=>{let{tab:tab}=_ref;return tab}}]},selectors:{showWarningsTab:[s=>[s.featureFlags],featureFlags=>!!featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_6__.i.INGESTION_WARNINGS_ENABLED]]},actionToUrl:()=>({setTab:_ref2=>{let{tab:tab}=_ref2;return tabUrls[tab]||scenes_urls__WEBPACK_IMPORTED_MODULE_2__.a.events()}}),urlToAction:_ref3=>{let{actions:actions,values:values}=_ref3;return Object.fromEntries(Object.entries(tabUrls).map((_ref4=>{let[key,url]=_ref4;return[url,()=>{values.tab!==key&&actions.setTab(key)}]})))}});function DataManagementPageTabs(_ref5){let{tab:tab}=_ref5;const{showWarningsTab:showWarningsTab}=Object(kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(eventsTabsLogic),{setTab:setTab}=Object(kea__WEBPACK_IMPORTED_MODULE_0__.useActions)(eventsTabsLogic);return Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(antd__WEBPACK_IMPORTED_MODULE_1__.a,{tabPosition:"top",animated:!1,activeKey:tab,onTabClick:t=>setTab(t),children:[Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(antd__WEBPACK_IMPORTED_MODULE_1__.a.TabPane,{tab:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("span",{"data-attr":"data-management-events-tab",children:"Events"})},DataManagementTab.EventDefinitions),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(antd__WEBPACK_IMPORTED_MODULE_1__.a.TabPane,{tab:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_components_TitleWithIcon__WEBPACK_IMPORTED_MODULE_5__.a,{icon:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_3__.a,{title:"Actions consist of one or more events that you have decided to put into a deliberately-labeled bucket. They're used in insights and dashboards.",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_4__.tb,{})}),"data-attr":"data-management-actions-tab",children:"Actions"})},DataManagementTab.Actions),Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(antd__WEBPACK_IMPORTED_MODULE_1__.a.TabPane,{tab:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_components_TitleWithIcon__WEBPACK_IMPORTED_MODULE_5__.a,{icon:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_Tooltip__WEBPACK_IMPORTED_MODULE_3__.a,{title:"Properties are additional data sent along with an event capture. Use properties to understand additional information about events and the actors that generate them.",children:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(lib_lemon_ui_icons__WEBPACK_IMPORTED_MODULE_4__.tb,{})}),"data-attr":"data-management-event-properties-tab",children:"Properties"})},DataManagementTab.PropertyDefinitions),showWarningsTab&&Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(antd__WEBPACK_IMPORTED_MODULE_1__.a.TabPane,{tab:Object(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("span",{"data-attr":"data-management-warnings-tab",children:"Ingestion Warnings"})},DataManagementTab.IngestionWarnings)]})}try{DataManagementPageTabs.displayName="DataManagementPageTabs",DataManagementPageTabs.__docgenInfo={description:"",displayName:"DataManagementPageTabs",props:{tab:{defaultValue:null,description:"",name:"tab",required:!0,type:{name:"enum",value:[{value:'"actions"'},{value:'"events"'},{value:'"properties"'},{value:'"warnings"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-management/DataManagementPageTabs.tsx#DataManagementPageTabs"]={docgenInfo:DataManagementPageTabs.__docgenInfo,name:"DataManagementPageTabs",path:"frontend/src/scenes/data-management/DataManagementPageTabs.tsx#DataManagementPageTabs"})}catch(__react_docgen_typescript_loader_error){}},"./frontend/src/scenes/data-management/ingestion-warnings/IngestionWarningsView.tsx":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"IngestionWarningsView",(function(){return IngestionWarningsView}));var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.0_react@16.14.0/node_modules/kea/lib/index.esm.js"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),DataManagementPageTabs=__webpack_require__("./frontend/src/scenes/data-management/DataManagementPageTabs.tsx"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.0/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");const ingestionWarningsLogic=Object(index_esm.kea)([Object(index_esm.path)(["scenes","data-management","ingestion-warnings","ingestionWarningsLogic"]),Object(index_esm.connect)({values:[teamLogic.a,["currentTeamId"]]}),Object(lib.loaders)((_ref=>{let{values:values}=_ref;return{data:[[],{loadData:async()=>{const{results:results}=await api.b.get(`api/projects/${values.currentTeamId}/ingestion_warnings`);return results}}]}})),Object(index_esm.selectors)({breadcrumbs:[()=>[],()=>[{name:"Data Management",path:urls.a.eventDefinitions()},{name:"Ingestion Warnings",path:urls.a.ingestionWarnings()}]]}),Object(index_esm.events)((_ref2=>{let{actions:actions}=_ref2;return{afterMount:()=>{actions.loadData()}}}))]);var LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link.tsx"),react=__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/index.js"),dist_chart=__webpack_require__("./node_modules/.pnpm/chart.js@3.9.1/node_modules/chart.js/dist/chart.mjs"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),Popover=__webpack_require__("./frontend/src/lib/lemon-ui/Popover/Popover.tsx"),floating_ui_core_esm=__webpack_require__("./node_modules/.pnpm/@floating-ui+core@1.2.1/node_modules/@floating-ui/core/dist/floating-ui.core.esm.js"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/.pnpm/style-loader@2.0.0_webpack@4.46.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),WarningEventsGraph=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/data-management/ingestion-warnings/WarningEventsGraph.scss"),WarningEventsGraph_default=__webpack_require__.n(WarningEventsGraph),options={insert:"head",singleton:!1},jsx_runtime=(injectStylesIntoStyleTag_default()(WarningEventsGraph_default.a,options),WarningEventsGraph_default.a.locals,__webpack_require__("./node_modules/.pnpm/react@16.14.0/node_modules/react/jsx-runtime.js"));function WarningEventsGraph_WarningEventsGraph(_ref){let{summary:summary}=_ref;const canvasRef=Object(react.useRef)(null),tooltipRef=Object(react.useRef)(null),{timezone:timezone}=Object(index_esm.useValues)(teamLogic.a),[popoverContent,setPopoverContent]=Object(react.useState)(null),[popoverOffset,setPopoverOffset]=Object(react.useState)(0),dates=Object(react.useMemo)((()=>Object(utils.xb)(0,30).map((i=>Object(dayjs.a)().subtract(i,"days").format("D MMM YYYY"))).reverse()),[]),data=Object(react.useMemo)((()=>{const result=new Array(30).fill(0);for(const warning of summary.warnings){const date=Object(dayjs.c)(warning.timestamp,timezone);result[Object(dayjs.a)().diff(date,"days")]+=1}return result.reverse()}),[summary]);return Object(react.useEffect)((()=>{let chart;var _canvasRef$current;canvasRef.current&&(chart=new dist_chart.c(null===(_canvasRef$current=canvasRef.current)||void 0===_canvasRef$current?void 0:_canvasRef$current.getContext("2d"),{type:"bar",data:{labels:dates,datasets:[{data:data,minBarLength:3,hoverBackgroundColor:"brand-blue"}]},options:{scales:{x:{display:!1},y:{beginAtZero:!0,display:!1}},plugins:{crosshair:!1,legend:{display:!1},tooltip:{enabled:!1,external(_ref2){let{tooltip:tooltip}=_ref2;if(0===tooltip.opacity)return void setPopoverContent(null);const datapoint=tooltip.dataPoints[0];setPopoverContent(Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[datapoint.label,": ",datapoint.formattedValue]})),setPopoverOffset(tooltip.x)}}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}}));return()=>{var _chart;null===(_chart=chart)||void 0===_chart||_chart.destroy()}}),[summary,dates,data]),Object(jsx_runtime.jsxs)("div",{className:"warning-events-graph",children:[Object(jsx_runtime.jsx)("canvas",{ref:canvasRef}),Object(jsx_runtime.jsx)(Popover.a,{visible:!!popoverContent,overlay:popoverContent,placement:"bottom-start",middleware:[Object(floating_ui_core_esm.e)({crossAxis:popoverOffset})],children:Object(jsx_runtime.jsx)("div",{ref:tooltipRef})})]})}try{WarningEventsGraph_WarningEventsGraph.displayName="WarningEventsGraph",WarningEventsGraph_WarningEventsGraph.__docgenInfo={description:"",displayName:"WarningEventsGraph",props:{summary:{defaultValue:null,description:"",name:"summary",required:!0,type:{name:"IngestionWarningSummary"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/data-management/ingestion-warnings/WarningEventsGraph.tsx#WarningEventsGraph"]={docgenInfo:WarningEventsGraph_WarningEventsGraph.__docgenInfo,name:"WarningEventsGraph",path:"frontend/src/scenes/data-management/ingestion-warnings/WarningEventsGraph.tsx#WarningEventsGraph"})}catch(__react_docgen_typescript_loader_error){}const scene={component:IngestionWarningsView,logic:ingestionWarningsLogic},WARNING_TYPE_TO_DESCRIPTION={cannot_merge_already_identified:"Refused to merge an already identified user",cannot_merge_with_illegal_distinct_id:"Refused to merge with an illegal distinct id",skipping_event_invalid_uuid:"Refused to process event with invalid uuid",ignored_invalid_timestamp:"Ignored an invalid timestamp, event was still ingested",event_timestamp_in_future:"An event was sent more than 23 hours in the future",ingestion_capacity_overflow:"Event ingestion has overflowed capacity"},WARNING_TYPE_RENDERER={cannot_merge_already_identified:function Render(warning){const details=warning.details;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Refused to merge already identified person"," ",Object(jsx_runtime.jsx)(Link.a,{to:urls.a.person(details.sourcePersonDistinctId),children:details.sourcePersonDistinctId})," into"," ",Object(jsx_runtime.jsx)(Link.a,{to:urls.a.person(details.targetPersonDistinctId),children:details.targetPersonDistinctId})," via an $identify or $create_alias call"]})},cannot_merge_with_illegal_distinct_id:function Render(warning){const details=warning.details;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Refused to merge an illegal distinct_id"," ",Object(jsx_runtime.jsx)(Link.a,{to:urls.a.person(details.illegalDistinctId),children:details.illegalDistinctId})," with"," ",Object(jsx_runtime.jsx)(Link.a,{to:urls.a.person(details.otherDistinctId),children:details.otherDistinctId})," via an $identify or $create_alias call"]})},skipping_event_invalid_uuid:function Render(warning){const details=warning.details;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Refused to process event with invalid uuid: ",Object(jsx_runtime.jsx)("code",{children:details.eventUuid}),"."]})},ignored_invalid_timestamp:function Render(warning){const details=warning.details;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Used server timestamp when ingesting event due to invalid value ",Object(jsx_runtime.jsx)("code",{children:details.value})," in field"," ",Object(jsx_runtime.jsx)("code",{children:details.field}),": ",details.reason]})},event_timestamp_in_future:function Render(warning){const details=warning.details;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["The event timestamp computed too far in the future, so the capture time was used instead. Event values:",Object(jsx_runtime.jsxs)("ul",{children:[Object(jsx_runtime.jsxs)("li",{children:["Computed timestamp: ",details.result]}),details.timestamp?Object(jsx_runtime.jsxs)("li",{children:["Client provided timestamp: ",details.timestamp]}):"",details.sentAt?Object(jsx_runtime.jsxs)("li",{children:["Client provided sent_at: ",details.sentAt]}):"",details.offset?Object(jsx_runtime.jsxs)("li",{children:["Client provided time offset: ",details.offset]}):"",Object(jsx_runtime.jsxs)("li",{children:["PostHog server capture time: ",details.now]})]})]})},ingestion_capacity_overflow:function Render(warning){const details=warning.details;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Event ingestion has overflowed capacity for distinct_id"," ",Object(jsx_runtime.jsx)(Link.a,{to:urls.a.person(details.overflowDistinctId),children:details.overflowDistinctId}),". Events will still be processed, but are likely to be delayed longer than usual."]})}};function IngestionWarningsView(){const{data:data,dataLoading:dataLoading}=Object(index_esm.useValues)(ingestionWarningsLogic);return Object(jsx_runtime.jsxs)("div",{"data-attr":"manage-events-table",children:[Object(jsx_runtime.jsx)(PageHeader.a,{title:"Data Management",caption:"Use data management to organize events that come into PostHog. Reduce noise, clarify usage, and help collaborators get the most value from your data.",tabbedPage:!0}),Object(jsx_runtime.jsx)(DataManagementPageTabs.a,{tab:DataManagementPageTabs.b.IngestionWarnings}),Object(jsx_runtime.jsx)("div",{className:"mb-4",children:"Data ingestion related warnings from past 30 days."}),Object(jsx_runtime.jsx)(LemonTable.a,{dataSource:data,loading:dataLoading,columns:[{title:"Warning",dataIndex:"type",render:function Render(_,summary){const type=WARNING_TYPE_TO_DESCRIPTION[summary.type]||summary.type;return Object(jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[type," (",Object(jsx_runtime.jsxs)(Link.a,{to:`https://posthog.com/manual/data-management#${type.toLowerCase().replace(",","").split(" ").join("-")}`,children:["docs",")"]})]})}},{title:"Graph",render:function Render(_,summary){return Object(jsx_runtime.jsx)(WarningEventsGraph_WarningEventsGraph,{summary:summary})}},{title:"Events",dataIndex:"count",align:"right",sorter:(a,b)=>a.count-b.count},{title:"Last Seen",dataIndex:"lastSeen",render:function Render(_,summary){return Object(jsx_runtime.jsx)(TZLabel.a,{time:summary.lastSeen,showSeconds:!0})},align:"right",sorter:(a,b)=>new Date(a.lastSeen)>new Date(b.lastSeen)?1:-1}],expandable:{expandedRowRender:RenderNestedWarnings},defaultSorting:{columnKey:"lastSeen",order:-1},noSortingCancellation:!0})]})}function RenderNestedWarnings(warningSummary){return Object(jsx_runtime.jsx)(LemonTable.a,{dataSource:warningSummary.warnings,columns:[{title:"Description",key:"description",render:function Render(_,warning){const renderer=WARNING_TYPE_RENDERER[warning.type];return renderer?renderer(warning):Object(jsx_runtime.jsx)("pre",{children:JSON.stringify(warning.details,null,2)})}},{title:"Time",dataIndex:"timestamp",render:function Render(_,warning){return Object(jsx_runtime.jsx)(TZLabel.a,{time:warning.timestamp,showSeconds:!0})},align:"right"}],embedded:!0,size:"small",showHeader:!1})}},"./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js!./node_modules/.pnpm/postcss-loader@4.3.0_dhonik3q6ff6ozbzdscnovq2ka/node_modules/postcss-loader/dist/cjs.js!./node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/data-management/ingestion-warnings/WarningEventsGraph.scss":function(module,exports,__webpack_require__){(exports=__webpack_require__("./node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.i,".warning-events-graph{width:150px}.warning-events-graph canvas{height:36px}",""]),module.exports=exports}}]);