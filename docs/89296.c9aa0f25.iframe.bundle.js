"use strict";(self.webpackChunkposthog=self.webpackChunkposthog||[]).push([[89296],{"./frontend/src/scenes/pipeline/PipelineBatchExportConfiguration.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>PipelineBatchExportConfiguration});var _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),lib_constants__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/lib/constants.tsx"),lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./frontend/src/lib/lemon-ui/LemonInput/index.ts"),lib_lemon_ui_Spinner__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./frontend/src/lib/lemon-ui/Spinner/index.ts"),lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),scenes_batch_exports_BatchExportEditForm__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./frontend/src/scenes/batch_exports/BatchExportEditForm.tsx"),scenes_data_management_database_DatabaseTable__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./frontend/src/scenes/data-management/database/DatabaseTable.tsx"),_types__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./frontend/src/types.ts"),_pipelineBatchExportConfigurationLogic__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./frontend/src/scenes/pipeline/pipelineBatchExportConfigurationLogic.tsx"),_utils__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelineBatchExportConfiguration(_ref){let{service,id}=_ref,logicProps={service:service||null,id:id||null},logic=(0,_pipelineBatchExportConfigurationLogic__WEBPACK_IMPORTED_MODULE_14__.t)(logicProps),{isNew,configuration,tables,savedConfiguration,isConfigurationSubmitting,batchExportConfigLoading,configurationChanged,batchExportConfig,selectedModel}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(logic),{resetConfiguration,submitConfiguration,setSelectedModel}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useActions)(logic),{featureFlags}=(0,kea__WEBPACK_IMPORTED_MODULE_1__.useValues)(lib_logic_featureFlagLogic__WEBPACK_IMPORTED_MODULE_10__.h);if(service&&!_types__WEBPACK_IMPORTED_MODULE_13__.e2.includes(service))return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_components_NotFound__WEBPACK_IMPORTED_MODULE_3__.T,{object:`batch export service ${service}`});if(!batchExportConfig&&batchExportConfigLoading)return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_Spinner__WEBPACK_IMPORTED_MODULE_9__.t,{});let buttons=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_6__.J,{type:"secondary",htmlType:"reset",onClick:()=>resetConfiguration(savedConfiguration||{}),disabledReason:configurationChanged?isConfigurationSubmitting?"Saving in progress…":void 0:"No changes",children:isNew?"Reset":"Cancel"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_LemonButton__WEBPACK_IMPORTED_MODULE_6__.J,{type:"primary",htmlType:"submit",onClick:submitConfiguration,loading:isConfigurationSubmitting,children:isNew?"Create":"Save"})]});return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{className:"space-y-3",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_components_PageHeader__WEBPACK_IMPORTED_MODULE_4__.m,{buttons:buttons}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(kea_forms__WEBPACK_IMPORTED_MODULE_2__.Form,{logic:_pipelineBatchExportConfigurationLogic__WEBPACK_IMPORTED_MODULE_14__.t,props:logicProps,formKey:"configuration",className:"space-y-3",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{className:"flex items-start gap-2 flex-wrap",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{className:"border bg-bg-light p-3 rounded space-y-2 flex-1 min-w-100",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{className:"flex flex-row gap-2 min-h-16 items-center",children:[configuration.destination?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_utils__WEBPACK_IMPORTED_MODULE_15__.oe,{size:"medium",type:configuration.destination}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{className:"flex-1 font-semibold text-sm",children:configuration.destination})]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{className:"flex-1"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_7__.D,{name:"paused",info:"Start in a paused state or continuously exporting from now",children:_ref2=>{let{value,onChange}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonSwitch,{label:"Paused",onChange:()=>onChange(!value),checked:value,bordered:!0})}})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_7__.D,{name:"name",label:"Name",info:"Customising the name can be useful if multiple instances of the same type are used.",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_LemonInput__WEBPACK_IMPORTED_MODULE_8__.D,{type:"text"})}),featureFlags[lib_constants__WEBPACK_IMPORTED_MODULE_5__.y8.PERSON_BATCH_EXPORTS]&&("S3"===configuration.destination||"BigQuery"===configuration.destination||"Snowflake"===configuration.destination)&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_7__.D,{name:"model",label:"Model",info:"A model defines the data that will be exported.",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_0__.LemonSelect,{options:tables.map(table=>({value:table.name,label:table.id})),value:selectedModel,onSelect:newValue=>{setSelectedModel(newValue)}})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(scenes_data_management_database_DatabaseTable__WEBPACK_IMPORTED_MODULE_12__.B,{table:selectedModel||"events",tables:tables,inEditSchemaMode:!1})]})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{className:"border bg-bg-light p-3 rounded flex-2 min-w-100",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(BatchExportConfigurationFields,{isNew:isNew,formValues:configuration})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{className:"flex gap-2 justify-end",children:buttons})]})]})})}function BatchExportConfigurationFields(_ref3){let{isNew,formValues}=_ref3;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(scenes_batch_exports_BatchExportEditForm__WEBPACK_IMPORTED_MODULE_11__.pU,{isNew:isNew,isPipeline:!0,batchExportConfigForm:formValues}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(scenes_batch_exports_BatchExportEditForm__WEBPACK_IMPORTED_MODULE_11__.g3,{isNew:isNew,batchExportConfigForm:formValues})]})}},"./frontend/src/scenes/pipeline/PipelineNode.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PIPELINE_TAB_TO_NODE_STAGE:()=>PIPELINE_TAB_TO_NODE_STAGE,PipelineNode:()=>PipelineNode,scene:()=>scene});var index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),ActivityLog=__webpack_require__("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),LemonTabs=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTabs/LemonTabs.tsx"),utils=__webpack_require__("./frontend/src/lib/utils.tsx"),PipelineNodeLogs=__webpack_require__("./frontend/src/scenes/pipeline/PipelineNodeLogs.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),types=__webpack_require__("./frontend/src/types.ts"),BatchExportRuns=__webpack_require__("./frontend/src/scenes/pipeline/BatchExportRuns.tsx"),HogFunctionConfiguration=__webpack_require__("./frontend/src/scenes/pipeline/hogfunctions/HogFunctionConfiguration.tsx"),PipelineBatchExportConfiguration=__webpack_require__("./frontend/src/scenes/pipeline/PipelineBatchExportConfiguration.tsx"),pipelineNodeLogic=__webpack_require__("./frontend/src/scenes/pipeline/pipelineNodeLogic.tsx"),PipelinePluginConfiguration=__webpack_require__("./frontend/src/scenes/pipeline/PipelinePluginConfiguration.tsx"),pipeline_types=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelineNodeConfiguration(){let{node,stage}=(0,index_esm.useValues)(pipelineNodeLogic.y);return stage?(0,jsx_runtime.jsx)("div",{className:"space-y-3",children:node.backend===pipeline_types.b.HogFunction?(0,jsx_runtime.jsx)(HogFunctionConfiguration.g,{id:node.id}):node.backend===pipeline_types.b.Plugin?(0,jsx_runtime.jsx)(PipelinePluginConfiguration.s,{stage:stage,pluginConfigId:node.id}):(0,jsx_runtime.jsx)(PipelineBatchExportConfiguration.B,{id:node.id})}):(0,jsx_runtime.jsx)(NotFound.T,{object:"pipeline app stage"})}var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),Chart=__webpack_require__("./frontend/src/lib/Chart.ts"),colors=__webpack_require__("./frontend/src/lib/colors.ts"),CodeSnippet=__webpack_require__("./frontend/src/lib/components/CodeSnippet/index.ts"),DateFilter=__webpack_require__("./frontend/src/lib/components/DateFilter/DateFilter.tsx"),TZLabel=__webpack_require__("./frontend/src/lib/components/TZLabel/index.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),LemonButton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/index.ts"),LemonLabel=__webpack_require__("./frontend/src/lib/lemon-ui/LemonLabel/LemonLabel.tsx"),LemonModal=__webpack_require__("./frontend/src/lib/lemon-ui/LemonModal/index.ts"),LemonSkeleton=__webpack_require__("./frontend/src/lib/lemon-ui/LemonSkeleton/index.ts"),LemonTable=__webpack_require__("./frontend/src/lib/lemon-ui/LemonTable/index.ts"),Link=__webpack_require__("./frontend/src/lib/lemon-ui/Link/index.ts"),Tooltip=__webpack_require__("./frontend/src/lib/lemon-ui/Tooltip/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),pipelineNodeMetricsLogic=__webpack_require__("./frontend/src/scenes/pipeline/pipelineNodeMetricsLogic.tsx");function PipelineNodeMetrics(_ref){let{id}=_ref,logic=(0,pipelineNodeMetricsLogic.j)({id}),{appMetricsResponse,appMetricsResponseLoading,dateRange}=(0,index_esm.useValues)(logic),{setDateRange}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-8",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,jsx_runtime.jsx)(MetricsOverview,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading}),(0,jsx_runtime.jsx)(DateFilter.f,{dateTo:dateRange.to,dateFrom:dateRange.from,onChange:(from,to)=>setDateRange(from,to),allowedRollingDateOptions:["days","weeks","months","years"],makeLabel:key=>(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconCalendar,{})," ",key]})})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Delivery trends"}),(0,jsx_runtime.jsx)(AppMetricsGraph,{metrics:appMetricsResponse?.metrics,metricsLoading:appMetricsResponseLoading})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h2",{children:"Errors"}),(0,jsx_runtime.jsx)(ErrorsOverview,{id:id})]})]})}function MetricsOverview(_ref2){let{metrics,metricsLoading}=_ref2;return metricsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"w-20 h-4 mb-2",repeat:4}):(0,jsx_runtime.jsx)("div",{className:"space-y-4",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-start gap-8 flex-wrap",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:["Events Processed successfully",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Total number of events processed successfully",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.successes)})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"text-muted font-semibold mb-2",children:["Events Failed",(0,jsx_runtime.jsx)(Tooltip.u,{title:"Total number of events that threw an error during processing",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})})]}),(0,jsx_runtime.jsx)("div",{className:"text-4xl",children:renderNumber(metrics?.totals?.failures)})]})]})})}function renderNumber(value){return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:value?(0,utils.Lc)(value):value})}function AppMetricsGraph(_ref3){let{metrics,metricsLoading}=_ref3,canvasRef=(0,react.useRef)(null);return((0,react.useEffect)(()=>{let chart;if(canvasRef.current&&metrics&&!(0,utils.es)())return chart=new Chart.k(canvasRef.current?.getContext("2d"),{type:"line",data:{labels:metrics.dates,datasets:[{label:"events processed successfully",data:metrics.successes,borderColor:"",...colorConfig("data-color-1")},{label:"events failed",data:metrics.failures,...colorConfig("data-color-5")}]},options:{scales:{x:{ticks:{maxRotation:0},grid:{display:!1}},y:{beginAtZero:!0}},plugins:{crosshair:!1,legend:{display:!1}},maintainAspectRatio:!1,interaction:{mode:"index",axis:"x",intersect:!1}}}),()=>{chart?.destroy()}},[metrics]),metricsLoading||!metrics)?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"AppMetricsGraph border rounded p-6"}):(0,jsx_runtime.jsx)("div",{className:"AppMetricsGraph border rounded p-6",children:(0,jsx_runtime.jsx)("canvas",{ref:canvasRef})})}function colorConfig(baseColorVar){let mainColor=(0,colors.cM)(baseColorVar);return{borderColor:mainColor,hoverBorderColor:(0,utils._$)(mainColor,-20),hoverBackgroundColor:(0,utils._$)(mainColor,-20),backgroundColor:mainColor,fill:!1,borderWidth:2,pointRadius:0}}function ErrorsOverview(_ref4){let{id}=_ref4,logic=(0,pipelineNodeMetricsLogic.j)({id}),{appMetricsResponse,appMetricsResponseLoading}=(0,index_esm.useValues)(logic),{openErrorDetailsModal}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ErrorDetailsModal,{id:id}),(0,jsx_runtime.jsx)(LemonTable.g,{dataSource:appMetricsResponse?.errors||[],loading:appMetricsResponseLoading,columns:[{title:"Error type",dataIndex:"error_type",render:function RenderErrorType(_,errorSummary){return(0,jsx_runtime.jsx)(Link.r,{title:"View details",className:"font-semibold",onClick:event=>{event.preventDefault(),openErrorDetailsModal(errorSummary.error_type)},children:errorSummary.error_type})},sorter:(a,b)=>a.error_type.localeCompare(b.error_type)},{title:"Count",dataIndex:"count",align:"right",sorter:(a,b)=>a.count-b.count},{title:"Last seen",dataIndex:"last_seen",render:function RenderCreatedAt(lastSeen){return(0,jsx_runtime.jsx)("div",{className:"whitespace-nowrap text-right",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:lastSeen})})},align:"right",sorter:(a,b)=>new Date(a.last_seen||0)>new Date(b.last_seen||0)?1:-1}],defaultSorting:{columnKey:"last_seen",order:-1},useURLForSorting:!1,noSortingCancellation:!0,emptyState:(0,jsx_runtime.jsxs)("div",{className:"",children:[(0,jsx_runtime.jsx)("b",{children:"No errors! \uD83E\uDD73"}),(0,jsx_runtime.jsx)("p",{className:"m-0",children:"If this app has any errors in the future, this table will contain information to help solve the issue."})]})})]})}function ErrorDetailsModal(_ref5){let{id}=_ref5,logic=(0,pipelineNodeMetricsLogic.j)({id}),{errorDetails,errorDetailsModalError,errorDetailsLoading}=(0,index_esm.useValues)(logic),{closeErrorDetailsModal}=(0,index_esm.useActions)(logic),[page,setPage]=(0,react.useState)(0),activeErrorDetails=errorDetails[page];return(0,jsx_runtime.jsx)(LemonModal.f,{isOpen:!!errorDetailsModalError,onClose:closeErrorDetailsModal,title:errorDetailsModalError,width:"min(50vw, 80rem)",description:(0,jsx_runtime.jsx)("span",{children:activeErrorDetails?.error_details?.error.message?.substring(0,200)}),footer:(0,jsx_runtime.jsx)("div",{className:"flex items-center justify-end gap-1 h-",children:errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("span",{children:[page+1," of ",errorDetails.length," sample",errorDetails.length>1?"s":""]}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.ed,{}),onClick:()=>setPage(page-1),disabledReason:0==page?"First page":void 0}),(0,jsx_runtime.jsx)(LemonButton.J,{icon:(0,jsx_runtime.jsx)(icons.VG,{}),onClick:()=>setPage(page+1),disabledReason:page==errorDetails.length-1?"Last page":void 0})]})}),children:!errorDetailsModalError||errorDetailsLoading?(0,jsx_runtime.jsx)(LemonSkeleton.y,{className:"h-10"}):(0,jsx_runtime.jsxs)("div",{className:"flex flex-col space-y-2",style:{height:"80vh"},children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:"When:"})," ",(0,jsx_runtime.jsx)(TZLabel.w,{time:activeErrorDetails.timestamp,showSeconds:!0})]}),activeErrorDetails.error_details.eventCount&&(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Event Count"}),(0,jsx_runtime.jsx)("div",{children:activeErrorDetails.error_details.eventCount})]}),activeErrorDetails.error_details.error.message&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Error message",defaultIsExpanded:!0,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.message})}),activeErrorDetails.error_details.event&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Event payload",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JSON,children:JSON.stringify(activeErrorDetails.error_details.event,null,2)})}),activeErrorDetails.error_details.error.stack&&(0,jsx_runtime.jsx)(CollapsibleSection,{title:"Stack trace",defaultIsExpanded:!1,children:(0,jsx_runtime.jsx)(CodeSnippet.O,{wrap:!0,language:CodeSnippet.S.JavaScript,children:activeErrorDetails.error_details.error.stack})})]})})}function CollapsibleSection(props){let[isExpanded,setIsExpanded]=(0,react.useState)(props.defaultIsExpanded);return(0,jsx_runtime.jsxs)("div",{className:"bg-bg-3000 border rounded",children:[(0,jsx_runtime.jsx)(LemonButton.J,{fullWidth:!0,onClick:()=>setIsExpanded(!isExpanded),sideIcon:isExpanded?(0,jsx_runtime.jsx)(posthog_icons_es.IconCollapse,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand,{}),title:isExpanded?"Show less":"Show more",className:"bg-bg-3000",children:props.title}),isExpanded&&(0,jsx_runtime.jsx)("div",{className:"bg-bg-light p-2",children:props.children})]})}let PIPELINE_TAB_TO_NODE_STAGE={[types.J9.Transformations]:types.We.Transformation,[types.J9.Destinations]:types.We.Destination,[types.J9.SiteApps]:types.We.SiteApp,[types.J9.ImportApps]:types.We.ImportApp,[types.J9.DataImport]:types.We.DataImport},paramsToProps=_ref=>{let{params:{stage,id}}=_ref,numericId=id&&/^\d+$/.test(id)?parseInt(id):void 0;if(!stage||!id)throw Error("Loaded PipelineNode without either `stage` or `id` passed in");return{stage:PIPELINE_TAB_TO_NODE_STAGE[stage]||null,id:numericId&&!isNaN(numericId)?numericId:id}},scene={component:PipelineNode,logic:pipelineNodeLogic.y,paramsToProps};function PipelineNode(){let params=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stage,id}=paramsToProps({params}),{currentTab,node}=(0,index_esm.useValues)(pipelineNodeLogic.y);if(!stage)return(0,jsx_runtime.jsx)(NotFound.T,{object:"pipeline stage"});let tabToContent={[types.il.Configuration]:(0,jsx_runtime.jsx)(PipelineNodeConfiguration,{})};return[pipeline_types.b.Plugin,pipeline_types.b.BatchExport].includes(node.backend)&&(tabToContent[types.il.Metrics]=(0,jsx_runtime.jsx)(PipelineNodeMetrics,{id:id})),tabToContent[types.il.Logs]=(0,jsx_runtime.jsx)(PipelineNodeLogs.e,{id:id,stage:stage}),node.backend===pipeline_types.b.BatchExport&&(tabToContent[types.il.Runs]=(0,jsx_runtime.jsx)(BatchExportRuns.t_,{id:node.id})),[pipeline_types.b.Plugin,pipeline_types.b.BatchExport].includes(node.backend)&&(tabToContent[types.il.History]=(0,jsx_runtime.jsx)(ActivityLog.D,{id:id,scope:types.jc.PLUGIN})),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(PageHeader.m,{}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,tabs:Object.entries(tabToContent).map(_ref2=>{let[tab,content]=_ref2;return{label:(0,utils.fm)(tab),key:tab,content:content,link:params.stage?urls.j.pipelineNode(stage,id,tab):void 0}})})]})}},"./frontend/src/scenes/pipeline/PipelineNodeLogs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{e:()=>PipelineNodeLogs});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),kea__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib_constants__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/constants.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/lib/utils.tsx"),_pipelineNodeLogsLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/scenes/pipeline/pipelineNodeLogsLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelineNodeLogs(_ref){let{id,stage}=_ref,logic=(0,_pipelineNodeLogsLogic__WEBPACK_IMPORTED_MODULE_5__.Y)({id,stage}),{logs,logsLoading,backgroundLogs,columns,isThereMoreToLoad,selectedLogLevels,instanceId}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useValues)(logic),{revealBackground,loadMoreLogs,setSelectedLogLevels,setSearchTerm,setInstanceId}=(0,kea__WEBPACK_IMPORTED_MODULE_2__.useActions)(logic);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"ph-no-capture space-y-2 flex-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonInput,{type:"search",placeholder:"Search for messages containing…",fullWidth:!0,onChange:setSearchTerm,allowClear:!0,prefix:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconSearch,{}),instanceId&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonSnack,{onClose:()=>setInstanceId(null),children:instanceId})]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex items-center gap-4",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("span",{className:"mr-1",children:"Show logs of level:"}),Object.values(_pipelineNodeLogsLogic__WEBPACK_IMPORTED_MODULE_5__.i).map(level=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonCheckbox,{label:level,checked:selectedLogLevels.includes(level),onChange:checked=>{let newLogLevels=checked?[...selectedLogLevels,level]:selectedLogLevels.filter(t=>t!=level);setSelectedLogLevels(newLogLevels)}},level))]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonButton,{onClick:revealBackground,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:backgroundLogs.length?void 0:"There's nothing to load",children:backgroundLogs.length?`Load ${(0,lib_utils__WEBPACK_IMPORTED_MODULE_4__.Zi)(backgroundLogs.length,"newer entry","newer entries")}`:"No new entries"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonTable,{dataSource:logs,columns:columns,loading:logsLoading,className:"ph-no-capture",rowKey:"timestamp",pagination:{pageSize:200,hideOnSinglePage:!0}}),!!logs.length&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonButton,{onClick:loadMoreLogs,loading:logsLoading,type:"secondary",fullWidth:!0,center:!0,disabledReason:isThereMoreToLoad?void 0:"There's nothing more to load",children:isThereMoreToLoad?`Load up to ${lib_constants__WEBPACK_IMPORTED_MODULE_3__.F2} older entries`:"No older entries"})]})}},"./frontend/src/scenes/pipeline/PipelinePluginConfiguration.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{s:()=>PipelinePluginConfiguration});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),TestAccountFiltersSwitch=__webpack_require__("./frontend/src/lib/components/TestAccountFiltersSwitch.tsx"),LemonField=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),LemonMarkdown=__webpack_require__("./frontend/src/lib/lemon-ui/LemonMarkdown/index.ts"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),ActionFilter=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),ActionFilterRow=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),configUtils=__webpack_require__("./frontend/src/scenes/pipeline/configUtils.ts"),PluginField=__webpack_require__("./frontend/src/scenes/plugins/edit/PluginField.tsx"),src_types=__webpack_require__("./frontend/src/types.ts"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),constants=__webpack_require__("./frontend/src/lib/constants.tsx"),featureFlagLogic=__webpack_require__("./frontend/src/lib/logic/featureFlagLogic.ts"),teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts"),destinationsLogic=__webpack_require__("./frontend/src/scenes/pipeline/destinationsLogic.tsx"),frontendAppsLogic=__webpack_require__("./frontend/src/scenes/pipeline/frontendAppsLogic.tsx"),importAppsLogic=__webpack_require__("./frontend/src/scenes/pipeline/importAppsLogic.tsx"),pipelineAccessLogic=__webpack_require__("./frontend/src/scenes/pipeline/pipelineAccessLogic.tsx"),transformationsLogic=__webpack_require__("./frontend/src/scenes/pipeline/transformationsLogic.tsx");function getConfigurationFromPluginConfig(pluginConfig){return{...pluginConfig.config,filters:pluginConfig.filters,enabled:pluginConfig.enabled,order:pluginConfig.order,name:pluginConfig.name?pluginConfig.name:pluginConfig.plugin_info.name,description:pluginConfig.description?pluginConfig.description:pluginConfig.plugin_info.description||""}}function getDefaultConfiguration(plugin){return{...(0,configUtils.NM)(plugin),enabled:!1,name:plugin.name,description:plugin.description}}let pipelinePluginConfigurationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{pluginId,pluginConfigId}=_ref;return pluginConfigId?`ID:${pluginConfigId}`:`NEW:${pluginId}`}),(0,index_esm.path)(id=>["scenes","pipeline","pipelinePluginConfigurationLogic",id]),(0,index_esm.connect)(()=>({values:[teamLogic.teamLogic,["currentTeamId"],transformationsLogic.P,["nextAvailableOrder"],featureFlagLogic.h,["featureFlags"],pipelineAccessLogic.g,["canEnableNewDestinations"]]})),(0,kea_loaders_lib.loaders)(_ref2=>{let{props,values}=_ref2;return{pluginFromPluginId:[null,{loadPlugin:async()=>props.pluginId?await api.ZP.get(`api/organizations/@current/plugins/${props.pluginId}`):null}],pluginConfig:[null,{loadPluginConfig:async()=>props.pluginConfigId?await api.ZP.pluginConfigs.get(props.pluginConfigId):null,updatePluginConfig:async formdata=>{if(!values.plugin||!props.stage)return null;if((!values.pluginConfig||!values.pluginConfig.enabled&&formdata.enabled)&&props.stage===src_types.We.Destination&&!values.canEnableNewDestinations)return src.lemonToast.error("Data pipelines add-on is required for enabling new destinations."),values.pluginConfig;let{enabled,order,name,description,filters,...config}=formdata,formData=(0,configUtils.Ge)(values.plugin.config_schema,(0,configUtils.NM)(values.plugin),config);formData.append("enabled",enabled),formData.append("name",name),formData.append("description",description);let sanitizedFilters=function(filters){if(!filters)return null;let sanitized={};return filters.events&&(sanitized.events=filters.events.map(f=>({id:f.id,type:"events",name:f.name,order:f.order,properties:f.properties}))),filters.actions&&(sanitized.actions=filters.actions.map(f=>({id:f.id,type:"actions",name:f.name,order:f.order,properties:f.properties}))),filters.filter_test_accounts&&(sanitized.filter_test_accounts=filters.filter_test_accounts),Object.keys(sanitized).length>0?sanitized:void 0}(filters);filters&&formData.append("filters",sanitizedFilters?JSON.stringify(sanitizedFilters):"");let orderFixed=enabled&&values.pluginConfig&&!values.pluginConfig.enabled?values.nextAvailableOrder:order||0;if(formData.append("order",orderFixed),props.pluginConfigId)return await api.ZP.pluginConfigs.update(props.pluginConfigId,formData);formData.append("plugin",values.plugin.id.toString());let res=await api.ZP.pluginConfigs.create(formData);return kea_router_lib.router.actions.replace(urls.j.pipelineNode(props.stage,res.id,src_types.il.Configuration)),res}}]}}),(0,index_esm.listeners)(_ref3=>{let{props,actions,values}=_ref3;return{updatePluginConfigSuccess:_ref4=>{let{pluginConfig}=_ref4;pluginConfig&&(actions.resetConfiguration(values.configuration),props.stage===src_types.We.Transformation?transformationsLogic.P.findMounted()?.actions.updatePluginConfig(pluginConfig):props.stage===src_types.We.Destination?destinationsLogic.w.findMounted()?.actions.updatePluginConfig(pluginConfig):props.stage===src_types.We.SiteApp?frontendAppsLogic.$.findMounted()?.actions.updatePluginConfig(pluginConfig):props.stage===src_types.We.ImportApp&&importAppsLogic.c.findMounted()?.actions.updatePluginConfig(pluginConfig))}}}),(0,index_esm.reducers)(()=>({configuration:[{},{loadPluginSuccess:(state,_ref5)=>{let{pluginFromPluginId}=_ref5;return Object.keys(state).length>0||!pluginFromPluginId?state:getDefaultConfiguration(pluginFromPluginId)},loadPluginConfigSuccess:(state,_ref6)=>{let{pluginConfig}=_ref6;return pluginConfig?getConfigurationFromPluginConfig(pluginConfig):state},updatePluginConfigSuccess:(state,_ref7)=>{let{pluginConfig}=_ref7;return pluginConfig?getConfigurationFromPluginConfig(pluginConfig):state}}]})),(0,index_esm.selectors)(()=>({plugin:[s=>[s.pluginFromPluginId,s.pluginConfig],(pluginFromId,pluginConfig)=>pluginConfig?.plugin_info||pluginFromId],loading:[s=>[s.pluginFromPluginIdLoading,s.pluginConfigLoading],(pluginLoading,pluginConfigLoading)=>pluginLoading||pluginConfigLoading],savedConfiguration:[s=>[s.pluginConfig,s.plugin],(pluginConfig,plugin)=>pluginConfig&&plugin?pluginConfig?getConfigurationFromPluginConfig(pluginConfig):plugin?getDefaultConfiguration(plugin):void 0:{}],requiredFields:[s=>[s.plugin,s.configuration],(plugin,configuration)=>plugin&&configuration?(0,configUtils.fY)(fieldName=>configuration[fieldName],plugin):[]],hiddenFields:[s=>[s.plugin,s.configuration],(plugin,configuration)=>plugin&&configuration?(0,configUtils.zl)(fieldName=>configuration[fieldName],plugin):[]],isNew:[(_,p)=>[p.pluginConfigId],pluginConfigId=>!pluginConfigId],stage:[(_,p)=>[p.stage],stage=>stage],pluginFilteringEnabled:[s=>[s.featureFlags,s.pluginConfig,s.plugin],(featureFlags,pluginConfig,plugin)=>{let pluginFilteringEnabled=featureFlags[constants.y8.PLUGINS_FILTERING];return(pluginFilteringEnabled||pluginConfig?.filters)&&plugin?.url==="https://github.com/PostHog/legacy-action-webhook"}]})),(0,lib.forms)(_ref8=>{let{asyncActions,values}=_ref8;return{configuration:{errors:formdata=>Object.fromEntries(values.requiredFields.map(field=>[field,formdata[field]?void 0:"This field is required"])),submit:async formdata=>{await asyncActions.updatePluginConfig(formdata)}}}}),(0,kea_router_lib.beforeUnload)(_ref9=>{let{actions,values}=_ref9;return{enabled:()=>values.configurationChanged,message:"Leave action?\nChanges you made will be discarded.",onConfirm:()=>{actions.resetConfiguration()}}}),(0,index_esm.afterMount)(_ref10=>{let{props,actions}=_ref10;props.pluginConfigId?actions.loadPluginConfig():props.pluginId&&actions.loadPlugin()})]);var utils=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function PipelinePluginConfiguration(_ref){let{stage,pluginId,pluginConfigId}=_ref,logicProps={stage:stage,pluginId:pluginId||null,pluginConfigId:pluginConfigId||null},logic=pipelinePluginConfigurationLogic(logicProps),{plugin,isNew,isConfigurationSubmitting,savedConfiguration,hiddenFields,requiredFields,loading,configurationChanged,pluginFilteringEnabled}=(0,index_esm.useValues)(logic),{submitConfiguration,resetConfiguration}=(0,index_esm.useActions)(logic);if(!stage)return(0,jsx_runtime.jsx)(NotFound.T,{object:"pipeline stage"});if(loading&&!plugin)return(0,jsx_runtime.jsx)(src.SpinnerOverlay,{});if(!plugin)return(0,jsx_runtime.jsx)(NotFound.T,{object:`pipeline ${stage}`});let loadingOrSubmitting=loading||isConfigurationSubmitting,configSchemaArray=(0,configUtils.fN)(plugin.config_schema),fields=configSchemaArray.map((fieldConfig,index)=>(0,jsx_runtime.jsx)(react.Fragment,{children:fieldConfig.key&&fieldConfig.type&&(0,configUtils.Zs)(fieldConfig)&&!hiddenFields.includes(fieldConfig.key)?(0,jsx_runtime.jsx)(LemonField.D,{name:fieldConfig.key,label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[fieldConfig.secret&&(0,jsx_runtime.jsx)(src.Tooltip,{placement:"top-start",title:"This field is write-only. Its value won't be visible after saving.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconLock,{})}),fieldConfig.markdown&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{children:fieldConfig.markdown}),fieldConfig.name||fieldConfig.key]}),help:fieldConfig.hint&&(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"mt-0.5",children:fieldConfig.hint}),showOptional:!requiredFields.includes(fieldConfig.key),children:(0,jsx_runtime.jsx)(PluginField.B,{fieldConfig:fieldConfig,disabled:loadingOrSubmitting})}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:fieldConfig.type?(0,jsx_runtime.jsxs)("p",{className:"text-danger",children:["Invalid config field ",(0,jsx_runtime.jsx)("i",{children:fieldConfig.name||fieldConfig.key}),"."]}):null})},fieldConfig.key||`__key__${index}`)),buttons=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",htmlType:"reset",onClick:()=>resetConfiguration(savedConfiguration||{}),disabledReason:configurationChanged?isConfigurationSubmitting?"Saving in progress…":void 0:"No changes",children:"Clear changes"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",htmlType:"submit",onClick:submitConfiguration,loading:isConfigurationSubmitting,children:isNew?"Create":"Save"})]});return(0,jsx_runtime.jsxs)("div",{className:"space-y-3",children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:buttons}),(0,jsx_runtime.jsx)(lib.Form,{logic:pipelinePluginConfigurationLogic,props:logicProps,formKey:"configuration",className:"space-y-3",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4 items-start",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4 flex-1 min-w-100",children:[(0,jsx_runtime.jsxs)("div",{className:"border bg-bg-light rounded p-3 space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 min-h-16 items-center",children:[(0,jsx_runtime.jsx)(utils.Wf,{plugin:plugin,imageSize:"medium"}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col py-1 flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"flex flex-row items-center font-semibold text-sm gap-1",children:plugin.name}),plugin.description?(0,jsx_runtime.jsx)("div",{className:"text-text-3000 text-xs text-text-secondary-3000 mt-1",children:(0,jsx_runtime.jsx)(LemonMarkdown.j,{className:"max-w-[30rem]",lowKeyHeadings:!0,children:plugin.description})}):null]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"enabled",children:_ref2=>{let{value,onChange}=_ref2;return(0,jsx_runtime.jsx)(src.LemonSwitch,{label:"Enabled",onChange:()=>onChange(!value),checked:value,disabled:loadingOrSubmitting,bordered:!0})}})]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",info:"Customising the name can be useful if multiple instances of the same type are used.",children:(0,jsx_runtime.jsx)(src.LemonInput,{type:"text",disabled:loadingOrSubmitting})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"description",label:"Description",info:"Add a description to share context with other team members",children:(0,jsx_runtime.jsx)(src.LemonTextArea,{disabled:loadingOrSubmitting})})]}),pluginFilteringEnabled?(0,jsx_runtime.jsxs)("div",{className:"border bg-bg-light rounded p-3 space-y-2",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"filters",label:"Filters by events and actions",children:_ref3=>{var _value$filter_test_ac;let{value,onChange}=_ref3;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:null!==(_value$filter_test_ac=value?.filter_test_accounts)&&void 0!==_value$filter_test_ac&&_value$filter_test_ac,onChange:val=>onChange({...value,filter_test_accounts:val}),fullWidth:!0}),(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:null!=value?value:{},setFilters:payload=>{onChange({...payload,filter_test_accounts:value?.filter_test_accounts})},typeKey:"plugin-filters",mathAvailability:ActionFilterRow.Qq.None,hideRename:!0,hideDuplicate:!0,showNestedArrow:!1,actionsTaxonomicGroupTypes:[types.t.Events,types.t.Actions],propertiesTaxonomicGroupTypes:[types.t.EventProperties,types.t.EventFeatureFlags,types.t.Elements,types.t.PersonProperties],propertyFiltersPopover:!0,addFilterDefaultOptions:{id:"$pageview",name:"$pageview",type:src_types.DC.EVENTS},buttonCopy:"Add event filter"})]})}}),(0,jsx_runtime.jsxs)("p",{className:"italic text-muted-alt",children:["This destination will be triggered if ",(0,jsx_runtime.jsx)("b",{children:"any of"})," the above filters match."]})]}):null]}),(0,jsx_runtime.jsxs)("div",{className:"flex-2 min-w-100 space-y-4",children:[(0,jsx_runtime.jsx)("div",{className:"border bg-bg-light rounded p-3  space-y-2",children:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:fields.length?fields:(0,jsx_runtime.jsx)("span",{className:"italic text-muted-alt",children:"This app does not have specific configuration options"})})}),(0,jsx_runtime.jsx)("div",{className:"flex gap-2 justify-end",children:buttons})]})]})})]})}},"./frontend/src/scenes/pipeline/frontendAppsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>frontendAppsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");let frontendAppsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","frontendAppsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic,["currentTeamId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_frontend_apps")}],pluginConfigs:[{},{loadPluginConfigs:async()=>{let res=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/pipeline_frontend_apps_configs`);return Object.fromEntries(res.map(pluginConfig=>[pluginConfig.id,pluginConfig]))},toggleEnabled:async _ref2=>{let{id,enabled}=_ref2;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.SiteApp,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref3=>{let{pluginConfig}=_ref3;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],frontendApps:[s=>[s.plugins,s.pluginConfigs],(plugins,pluginConfigs)=>{let rawFrontendApp=Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})),convertedFrontendApps=rawFrontendApp.map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.SiteApp)),enabledFirst=convertedFrontendApps.sort((a,b)=>Number(b.enabled)-Number(a.enabled));return enabledFirst}],shouldShowProductIntroduction:[s=>[s.user],user=>!user?.has_seen_product_intro_for?.[_types__WEBPACK_IMPORTED_MODULE_5__.Md.SITE_APPS]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadPlugins(),actions.loadPluginConfigs()})])},"./frontend/src/scenes/pipeline/hogfunctions/HogFunctionConfiguration.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{g:()=>HogFunctionConfiguration});var posthog_icons_es=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("./node_modules/.pnpm/kea-forms@3.1.3_kea@3.1.5/node_modules/kea-forms/lib/index.js"),NotFound=__webpack_require__("./frontend/src/lib/components/NotFound/index.tsx"),PageHeader=__webpack_require__("./frontend/src/lib/components/PageHeader.tsx"),types=__webpack_require__("./frontend/src/lib/components/TaxonomicFilter/types.ts"),TestAccountFiltersSwitch=__webpack_require__("./frontend/src/lib/components/TestAccountFiltersSwitch.tsx"),useFeatureFlag=__webpack_require__("./frontend/src/lib/hooks/useFeatureFlag.ts"),More=__webpack_require__("./frontend/src/lib/lemon-ui/LemonButton/More.tsx"),LemonField=__webpack_require__("./frontend/src/lib/lemon-ui/LemonField/index.ts"),CodeEditorResizable=__webpack_require__("./frontend/src/lib/monaco/CodeEditorResizable.tsx"),ActionFilter=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilter.tsx"),ActionFilterRow=__webpack_require__("./frontend/src/scenes/insights/filters/ActionFilter/ActionFilterRow/ActionFilterRow.tsx"),groupsModel=__webpack_require__("./frontend/src/models/groupsModel.ts"),src_types=__webpack_require__("./frontend/src/types.ts"),kea_loaders_lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),kea_router_lib=__webpack_require__("./node_modules/.pnpm/kea-router@3.1.4_kea@3.1.5/node_modules/kea-router/lib/index.js"),kea_subscriptions_lib=__webpack_require__("./node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.5/node_modules/kea-subscriptions/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts"),deleteWithUndo=__webpack_require__("./frontend/src/lib/utils/deleteWithUndo.tsx"),dayjs=__webpack_require__("./frontend/src/lib/dayjs.ts"),utils=__webpack_require__("./frontend/src/lib/utils.tsx");let createExampleEvent=()=>({uuid:(0,utils.Vj)(),event:"$pageview",distinct_id:"12345",properties:{$browser:"Chrome",$device_type:"Desktop",$current_url:`${window.location.origin}/project/1/activity/explore`,$pathname:"/project/1/activity/explore",$browser_version:125},timestamp:(0,dayjs.Bv)().toISOString(),created_at:(0,dayjs.Bv)().toISOString(),url:`${window.location.origin}/project/1/activity/explore`,person_id:(0,utils.Vj)(),person_created_at:(0,dayjs.Bv)().toISOString(),person_properties:{email:"user@example.com"}});var teamLogic=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("./frontend/src/scenes/urls.ts");let NEW_FUNCTION_TEMPLATE={id:"new",name:"",description:"",inputs_schema:[],hog:"print('Hello, world!');",status:"stable"};function sanitizeConfiguration(data){let sanitizedInputs={};data.inputs_schema?.forEach(input=>{let value=data.inputs?.[input.key]?.value;if("json"===input.type&&"string"==typeof value)try{sanitizedInputs[input.key]={value:JSON.parse(value)}}catch(e){}else sanitizedInputs[input.key]={value:value}});let payload={...data,filters:data.filters?function(filters){if(!filters)return null;let sanitized={};return filters.events&&(sanitized.events=filters.events.map(f=>({id:f.id,type:"events",name:f.name,order:f.order,properties:f.properties}))),filters.actions&&(sanitized.actions=filters.actions.map(f=>({id:f.id,type:"actions",name:f.name,order:f.order,properties:f.properties}))),filters.filter_test_accounts&&(sanitized.filter_test_accounts=filters.filter_test_accounts),Object.keys(sanitized).length>0?sanitized:void 0}(data.filters):null,inputs:sanitizedInputs,icon_url:data.icon_url?.replace("&temp=true","")};return payload}let hogFunctionConfigurationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{var _ref2;let{id,templateId}=_ref;return null!==(_ref2=null!=id?id:templateId)&&void 0!==_ref2?_ref2:"new"}),(0,index_esm.path)(id=>["scenes","pipeline","hogFunctionConfigurationLogic",id]),(0,index_esm.actions)({setShowSource:showSource=>({showSource}),resetForm:configuration=>({configuration}),upsertHogFunction:configuration=>({configuration}),duplicate:!0,duplicateFromTemplate:!0,resetToTemplate:!0,deleteHogFunction:!0}),(0,index_esm.reducers)({showSource:[!1,{setShowSource:(_,_ref3)=>{let{showSource}=_ref3;return showSource}}]}),(0,kea_loaders_lib.loaders)(_ref4=>{let{props}=_ref4;return{template:[null,{loadTemplate:async()=>{if(!props.templateId)return null;if("new"===props.templateId)return{...NEW_FUNCTION_TEMPLATE};let res=await api.ZP.hogFunctions.getTemplate(props.templateId);if(!res)throw Error("Template not found");return res}}],hogFunction:[null,{loadHogFunction:async()=>props.id?await api.ZP.hogFunctions.get(props.id):null,upsertHogFunction:async _ref5=>{let{configuration}=_ref5,res=props.id?await api.ZP.hogFunctions.update(props.id,configuration):await api.ZP.hogFunctions.create(configuration);return src.lemonToast.success("Configuration saved"),res}}]}}),(0,lib.forms)(_ref6=>{let{values,props,asyncActions}=_ref6;return{configuration:{defaults:{},alwaysShowErrors:!0,errors:data=>({name:data.name?void 0:"Name is required",...values.inputFormErrors}),submit:async data=>{let payload=sanitizeConfiguration(data);props.templateId&&(payload.template_id=props.templateId),await asyncActions.upsertHogFunction(payload)}}}}),(0,index_esm.selectors)(()=>({defaultFormState:[s=>[s.template,s.hogFunction],(template,hogFunction)=>{if(template){let inputs={};return template.inputs_schema?.forEach(schema=>{schema.default&&(inputs[schema.key]={value:schema.default})}),{...template,inputs,enabled:!1}}return hogFunction||{}}],loading:[s=>[s.hogFunctionLoading,s.templateLoading],(hogFunctionLoading,templateLoading)=>hogFunctionLoading||templateLoading],loaded:[s=>[s.hogFunction,s.template],(hogFunction,template)=>!!hogFunction||!!template],inputFormErrors:[s=>[s.configuration],configuration=>{var _configuration$inputs;let inputs=null!==(_configuration$inputs=configuration.inputs)&&void 0!==_configuration$inputs?_configuration$inputs:{},inputErrors={};return configuration.inputs_schema?.forEach(input=>{let key=input.key,value=inputs[key]?.value;if(input.required&&!value&&(inputErrors[key]="This field is required"),"json"===input.type&&"string"==typeof value)try{JSON.parse(value)}catch(e){inputErrors[key]="Invalid JSON"}}),Object.keys(inputErrors).length>0?{inputs:inputErrors}:null}],willReEnableOnSave:[s=>[s.configuration,s.hogFunction],(configuration,hogFunction)=>{var _hogFunction$status$s;return configuration?.enabled&&(null!==(_hogFunction$status$s=hogFunction?.status?.state)&&void 0!==_hogFunction$status$s?_hogFunction$status$s:0)>=3}],globalVars:[s=>[s.hogFunction],()=>createExampleEvent()]})),(0,index_esm.listeners)(_ref7=>{let{actions,values,cache}=_ref7;return{loadTemplateSuccess:()=>actions.resetForm(),loadHogFunctionSuccess:()=>actions.resetForm(),upsertHogFunctionSuccess:()=>actions.resetForm(),upsertHogFunctionFailure:_ref8=>{let{errorObject}=_ref8,maybeValidationError=errorObject.data;maybeValidationError?.type==="validation_error"?setTimeout(()=>{maybeValidationError.attr.includes("inputs__")?actions.setConfigurationManualErrors({inputs:{[maybeValidationError.attr.split("__")[1]]:maybeValidationError.detail}}):actions.setConfigurationManualErrors({[maybeValidationError.attr]:maybeValidationError.detail})},1):(console.error(errorObject),src.lemonToast.error("Error submitting configuration"))},resetForm:()=>{actions.resetConfiguration({...values.defaultFormState,...cache.configFromUrl||{}})},duplicate:async()=>{if(values.hogFunction){var _values$hogFunction$t;let newConfig={...values.configuration,name:`${values.configuration.name} (copy)`},originalTemplate=null!==(_values$hogFunction$t=values.hogFunction.template?.id)&&void 0!==_values$hogFunction$t?_values$hogFunction$t:"new";kea_router_lib.router.actions.push(urls.j.pipelineNodeNew(src_types.We.Destination,`hog-${originalTemplate}`),void 0,{configuration:newConfig})}},duplicateFromTemplate:async()=>{if(values.hogFunction?.template){let newConfig={...values.hogFunction.template};kea_router_lib.router.actions.push(urls.j.pipelineNodeNew(src_types.We.Destination,`hog-${values.hogFunction.template.id}`),void 0,{configuration:newConfig})}},resetToTemplate:async()=>{if(values.hogFunction?.template){var _values$configuration;let template=values.hogFunction.template,inputs={};template.inputs_schema?.forEach(schema=>{schema.default&&(inputs[schema.key]={value:schema.default})}),actions.setConfigurationValues({...values.hogFunction.template,filters:null!==(_values$configuration=values.configuration.filters)&&void 0!==_values$configuration?_values$configuration:template.filters,name:values.configuration.name,description:values.configuration.description,inputs,enabled:!1})}},setConfigurationValue:()=>{actions.setConfigurationManualErrors({})},deleteHogFunction:async()=>{if(!values.hogFunction)return;let{id,name}=values.hogFunction;await (0,deleteWithUndo.S)({endpoint:`projects/${teamLogic.teamLogic.values.currentTeamId}/hog_functions`,object:{id,name},callback(undo){undo&&kea_router_lib.router.actions.replace(urls.j.pipelineNode(src_types.We.Destination,`hog-${id}`,src_types.il.Configuration))}}),kea_router_lib.router.actions.replace(urls.j.pipeline(src_types.J9.Destinations))}}}),(0,index_esm.afterMount)(_ref9=>{let{props,actions,cache}=_ref9;props.templateId?(cache.configFromUrl=kea_router_lib.router.values.hashParams.configuration,actions.loadTemplate()):props.id&&actions.loadHogFunction()}),(0,kea_subscriptions_lib.subscriptions)(_ref10=>{let{props,cache}=_ref10;return{configuration:configuration=>{props.templateId&&(cache.ignoreUrlChange=!0,kea_router_lib.router.actions.replace(kea_router_lib.router.values.location.pathname,void 0,{configuration}))},hogFunction:hogFunction=>{hogFunction&&props.templateId&&kea_router_lib.router.actions.replace(urls.j.pipelineNode(src_types.We.Destination,`hog-${hogFunction.id}`,src_types.il.Configuration))}}})]);var HogFunctionIcon=__webpack_require__("./frontend/src/scenes/pipeline/hogfunctions/HogFunctionIcon.tsx"),core_esm=__webpack_require__("./node_modules/.pnpm/@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0/node_modules/@dnd-kit/core/dist/core.esm.js"),sortable_esm=__webpack_require__("./node_modules/.pnpm/@dnd-kit+sortable@7.0.2_@dnd-kit+core@6.0.8_react@18.2.0/node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),utilities_esm=__webpack_require__("./node_modules/.pnpm/@dnd-kit+utilities@3.2.1_react@18.2.0/node_modules/@dnd-kit/utilities/dist/utilities.esm.js"),CodeEditorInline=__webpack_require__("./frontend/src/lib/monaco/CodeEditorInline.tsx"),editor_main=__webpack_require__("./node_modules/.pnpm/monaco-editor@0.49.0/node_modules/monaco-editor/esm/vs/editor/editor.main.js"),react=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),integrationsLogic=__webpack_require__("./frontend/src/lib/integrations/integrationsLogic.ts"),SlackIntegrationHelpers=__webpack_require__("./frontend/src/lib/integrations/SlackIntegrationHelpers.tsx"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function HogFunctionInputIntegration(_ref){let{schema,...props}=_ref;return"slack"===schema.integration?(0,jsx_runtime.jsx)(HogFunctionIntegrationSlackConnection,{...props}):(0,jsx_runtime.jsx)("div",{className:"text-danger",children:(0,jsx_runtime.jsxs)("p",{children:["Unsupported integration type: ",schema.integration]})})}function HogFunctionIntegrationSlackConnection(_ref2){let{onChange,value}=_ref2,{integrationsLoading,slackIntegrations,addToSlackButtonUrl}=(0,index_esm.useValues)(integrationsLogic.a),integration=slackIntegrations?.find(integration=>integration.id===value);if(integrationsLoading)return(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"h-10"});let button=(0,jsx_runtime.jsx)(src.LemonMenu,{items:[...slackIntegrations?.map(integration=>({icon:jsx_runtime.jsx(icons.gx,{}),onClick:()=>onChange?.(integration.id),label:integration.config.team.name}))||[],{to:addToSlackButtonUrl(window.location.pathname+"?target_type=slack")||"",label:"Add to different Slack workspace"}],children:integration?(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",children:"Change"}):(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",children:" Choose Slack connection"})});return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:integration?(0,jsx_runtime.jsx)(SlackIntegrationHelpers.W,{integration:integration,suffix:button}):button})}function HogFunctionInputIntegrationField(_ref){let{schema,value,onChange}=_ref,{configuration}=(0,index_esm.useValues)(hogFunctionConfigurationLogic),{integrationsLoading,integrations}=(0,index_esm.useValues)(integrationsLogic.a);if(integrationsLoading)return(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"h-10"});let relatedSchemaIntegration=configuration.inputs_schema?.find(input=>input.key===schema.integration_key);if(!relatedSchemaIntegration)return(0,jsx_runtime.jsxs)("div",{className:"text-danger",children:["Bad configuration: integration key ",schema.integration_key," not found in schema"]});let integrationId=configuration.inputs?.[relatedSchemaIntegration.key]?.value,integration=integrations?.find(integration=>integration.id===integrationId);return integration?"slack_channel"===schema.integration_field?(0,jsx_runtime.jsx)(SlackIntegrationHelpers.a,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):(0,jsx_runtime.jsx)("div",{className:"text-danger",children:(0,jsx_runtime.jsxs)("p",{children:["Unsupported integration type: ",schema.integration]})}):(0,jsx_runtime.jsxs)("div",{className:"border border-dashed h-10 rounded p-2 text-muted-alt italic",children:["Configure ",relatedSchemaIntegration.label," to continue"]})}let typeList=["string","boolean","dictionary","choice","json","integration"];function JsonConfigField(props){let suggestions=function(){let{groupTypes}=(0,index_esm.useValues)(groupsModel.$);return(0,react.useMemo)(()=>{let options=[["event","The entire event payload as a JSON object"],["event.name","The name of the event e.g. $pageview"],["event.distinct_id","The distinct_id of the event"],["event.timestamp","The timestamp of the event"],["event.url","URL to the event in PostHog"],["event.properties","Properties of the event"],["event.properties.<key>","The individual property of the event"],["person","The entire person payload as a JSON object"],["project.uuid","The UUID of the Person in PostHog"],["person.url","URL to the person in PostHog"],["person.properties","Properties of the person"],["person.properties.<key>","The individual property of the person"],["project.id","ID of the project in PostHog"],["project.name","Name of the project"],["project.url","URL to the project in PostHog"],["source.name","Name of the source of this message"],["source.url","URL to the source of this message in PostHog"]];groupTypes.forEach(groupType=>{options.push([`groups.${groupType.group_type}`,"The entire group payload as a JSON object"]),options.push([`groups.${groupType.group_type}.id`,"The ID or 'key' of the group"]),options.push([`groups.${groupType.group_type}.url`,"URL to the group in PostHog"]),options.push([`groups.${groupType.group_type}.properties`,"Properties of the group"]),options.push([`groups.${groupType.group_type}.properties.<key>`,"The individual property of the group"]),options.push([`groups.${groupType.group_type}.index`,"Index of the group"])});let items=options.map(_ref=>{let[key,value]=_ref;return{label:key,kind:editor_main.Mj.CompletionItemKind.Variable,detail:value,insertText:key,range:{startLineNumber:1,endLineNumber:1,startColumn:0,endColumn:0}}});return items},[groupTypes])}(),[monaco,setMonaco]=(0,react.useState)();return(0,react.useEffect)(()=>{if(!monaco)return;monaco.languages.setLanguageConfiguration("json",{wordPattern:/[a-zA-Z0-9_\-.]+/});let provider=monaco.languages.registerCompletionItemProvider("json",{triggerCharacters:["{","{{"],provideCompletionItems:async(model,position)=>{let word=model.getWordUntilPosition(position),wordWithTrigger=model.getValueInRange({startLineNumber:position.lineNumber,startColumn:0,endLineNumber:position.lineNumber,endColumn:position.column});if(-1===wordWithTrigger.indexOf("{"))return{suggestions:[]};let localSuggestions=suggestions.map(x=>({...x,insertText:x.insertText,range:{startLineNumber:position.lineNumber,endLineNumber:position.lineNumber,startColumn:word.startColumn,endColumn:word.endColumn}}));return{suggestions:localSuggestions,incomplete:!1}}});return()=>provider.dispose()},[suggestions,monaco]),(0,jsx_runtime.jsx)(CodeEditorResizable.Y,{language:"json",value:"string"!=typeof props.value?JSON.stringify(props.value,null,2):props.value,onChange:v=>props.onChange?.(null!=v?v:""),options:{lineNumbers:"off",minimap:{enabled:!1},quickSuggestions:{other:!0,strings:!0},suggest:{showWords:!1,showFields:!1,showKeywords:!1},scrollbar:{vertical:"hidden",verticalScrollbarSize:0}},onMount:(_editor,monaco)=>{setMonaco(monaco)}})}function HogFunctionTemplateInput(props){let{globalVars}=(0,index_esm.useValues)(hogFunctionConfigurationLogic);return(0,jsx_runtime.jsx)(CodeEditorInline.s,{...props,globals:globalVars})}function DictionaryField(_ref2){let{onChange,value}=_ref2,[entries,setEntries]=(0,react.useState)(Object.entries(null!=value?value:{}));return(0,react.useEffect)(()=>{let val=Object.fromEntries(entries.filter(_ref3=>{let[key,val]=_ref3;return""!==key.trim()||""!==val.trim()}));onChange?.(val)},[entries]),(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[entries.map((_ref4,index)=>{let[key,val]=_ref4;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.LemonInput,{value:key,className:"flex-1",onChange:key=>{let newEntries=[...entries];newEntries[index]=[key,newEntries[index][1]],setEntries(newEntries)},placeholder:"Key"}),(0,jsx_runtime.jsx)(HogFunctionTemplateInput,{className:"flex-2",value:val,language:"hogTemplate",onChange:val=>{let newEntries=[...entries];newEntries[index]=[newEntries[index][0],null!=val?val:""],setEntries(newEntries)}}),(0,jsx_runtime.jsx)(src.LemonButton,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),size:"small",onClick:()=>{let newEntries=[...entries];newEntries.splice(index,1),setEntries(newEntries)}})]},index)}),(0,jsx_runtime.jsx)(src.LemonButton,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),size:"small",type:"secondary",onClick:()=>{setEntries([...entries,["",""]])},children:"Add entry"})]})}function HogFunctionInputRenderer(_ref5){var _schema$choices;let{value,onChange,schema,disabled}=_ref5;switch(schema.type){case"string":return(0,jsx_runtime.jsx)(HogFunctionTemplateInput,{language:"hogTemplate",value:value,onChange:disabled?()=>{}:onChange,className:"ph-no-capture"});case"json":return(0,jsx_runtime.jsx)(JsonConfigField,{value:value,onChange:onChange,className:"ph-no-capture"});case"choice":return(0,jsx_runtime.jsx)(src.LemonSelect,{fullWidth:!0,value:value,className:"ph-no-capture",onChange:onChange,options:null!==(_schema$choices=schema.choices)&&void 0!==_schema$choices?_schema$choices:[],disabled:disabled});case"dictionary":return(0,jsx_runtime.jsx)(DictionaryField,{value:value,onChange:onChange});case"boolean":return(0,jsx_runtime.jsx)(src.LemonCheckbox,{checked:value,onChange:checked=>onChange?.(checked),disabled:disabled});case"integration":return(0,jsx_runtime.jsx)(HogFunctionInputIntegration,{schema:schema,value:value,onChange:onChange});case"integration_field":return(0,jsx_runtime.jsx)(HogFunctionInputIntegrationField,{schema:schema,value:value,onChange:onChange});default:return(0,jsx_runtime.jsxs)("strong",{className:"text-danger",children:['Unknown field type "',(0,jsx_runtime.jsx)("code",{children:schema.type}),'".']})}}function HogFunctionInputSchemaControls(_ref6){let{value,onChange,onDone}=_ref6,_onChange=data=>{onChange(data?{...value,...data}:null)};return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex-1 flex items-center gap-2 flex-wrap",children:[(0,jsx_runtime.jsx)(src.LemonSelect,{size:"small",options:typeList.map(type=>({label:(0,utils.fm)(type),value:type})),value:value.type,className:"w-30",onChange:type=>_onChange({type})}),(0,jsx_runtime.jsx)(src.LemonCheckbox,{size:"small",checked:value.required,onChange:required=>_onChange({required}),label:"Required",bordered:!0}),(0,jsx_runtime.jsx)(src.LemonCheckbox,{size:"small",checked:value.secret,onChange:secret=>_onChange({secret}),label:"Secret",bordered:!0}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(src.LemonButton,{status:"danger",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),size:"small",onClick:()=>onChange(null)}),(0,jsx_runtime.jsx)(src.LemonButton,{size:"small",onClick:()=>onDone(),children:"Done"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex-1 flex gap-2 flex-wrap",children:[(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Display label",children:(0,jsx_runtime.jsx)(src.LemonInput,{className:"min-w-60",size:"small",value:value.label,onChange:label=>_onChange({label}),placeholder:"Display label"})}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Input variable name",children:(0,jsx_runtime.jsx)(src.LemonInput,{size:"small",value:value.key,onChange:key=>_onChange({key}),placeholder:"Variable name"})})]}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Description",children:(0,jsx_runtime.jsx)(src.LemonTextArea,{minRows:1,value:value.description,onChange:description=>_onChange({description}),placeholder:"Description"})}),"choice"===value.type&&(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Choices",children:(0,jsx_runtime.jsx)(src.LemonInputSelect,{mode:"multiple",allowCustomValues:!0,value:value.choices?.map(choice=>choice.value),onChange:choices=>_onChange({choices:choices.map(value=>({label:value,value}))}),placeholder:"Choices"})}),"integration"===value.type&&(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Integration kind",children:(0,jsx_runtime.jsx)(src.LemonSelect,{value:value.integration,onChange:integration=>_onChange({integration}),options:[{label:"Slack",value:"slack"}],placeholder:"Choose kind"})}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Default value",children:(0,jsx_runtime.jsx)(HogFunctionInputRenderer,{schema:value,value:value.default,onChange:val=>_onChange({default:val})})})]})}function HogFunctionInputWithSchema(_ref7){let{schema}=_ref7,{attributes,listeners,setNodeRef,transform,transition}=(0,sortable_esm.nB)({id:schema.key}),{showSource,configuration}=(0,index_esm.useValues)(hogFunctionConfigurationLogic),{setConfigurationValue}=(0,index_esm.useActions)(hogFunctionConfigurationLogic),[editing,setEditing]=(0,react.useState)(showSource),value=configuration.inputs?.[schema.key];return(0,react.useEffect)(()=>{showSource||setEditing(!1)},[showSource]),(0,jsx_runtime.jsx)("div",{ref:setNodeRef,style:{transform:utilities_esm.ux.Transform.toString(transform),transition},children:editing?(0,jsx_runtime.jsx)("div",{className:"border rounded p-2 border-dashed space-y-4",children:(0,jsx_runtime.jsx)(HogFunctionInputSchemaControls,{value:schema,onChange:newSchema=>{let inputsSchema=configuration.inputs_schema||[];if(newSchema){let modifiedSchema={...schema,...newSchema};inputsSchema=inputsSchema.map(s=>s.key===schema.key?modifiedSchema:s)}else inputsSchema=inputsSchema.filter(s=>s.key!==schema.key);newSchema?.key&&setConfigurationValue(`inputs.${newSchema.key}`,value),newSchema?.type&&newSchema.type!==schema.type&&setConfigurationValue(`inputs.${schema.key}`,null),setConfigurationValue("inputs_schema",inputsSchema)},onDone:()=>setEditing(!1)})}):(0,jsx_runtime.jsx)(LemonField.D,{name:`inputs.${schema.key}`,help:schema.description,children:_ref8=>{let{value,onChange}=_ref8;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.LemonLabel,{className:showSource?"cursor-grab":"",showOptional:!schema.required,...attributes,...listeners,children:schema.label||schema.key}),showSource?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(src.LemonTag,{type:"muted",className:"font-mono",children:["inputs.",schema.key]}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(src.LemonButton,{size:"small",noPadding:!0,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>setEditing(!0)})]}):null]}),(0,jsx_runtime.jsx)(HogFunctionInputRenderer,{schema:schema,value:value?.value,onChange:val=>onChange({value:val})})]})}})})}function HogFunctionInputs(){let{showSource,configuration}=(0,index_esm.useValues)(hogFunctionConfigurationLogic),{setConfigurationValue}=(0,index_esm.useActions)(hogFunctionConfigurationLogic);if(!configuration?.inputs_schema?.length)return(0,jsx_runtime.jsx)("span",{className:"italic text-muted-alt",children:"This function does not require any input variables."});let inputSchemas=configuration.inputs_schema,inputSchemaIds=inputSchemas.map(schema=>schema.key);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(core_esm.LB,{collisionDetection:core_esm.pE,onDragEnd:_ref9=>{let{active,over}=_ref9;if(over&&active.id!==over.id){let oldIndex=inputSchemaIds.indexOf(active.id),newIndex=inputSchemaIds.indexOf(over.id);setConfigurationValue("inputs_schema",(0,sortable_esm.Rp)(inputSchemas,oldIndex,newIndex))}},children:(0,jsx_runtime.jsx)(sortable_esm.Fo,{disabled:!showSource,items:inputSchemaIds,strategy:sortable_esm.qw,children:configuration.inputs_schema?.map(schema=>jsx_runtime.jsx(HogFunctionInputWithSchema,{schema:schema},schema.key))})})})}var apps_common_src=__webpack_require__("./frontend/@posthog/apps-common/src/index.ts");let displayMap={[src_types.si.healthy]:{tagType:"success",display:"Healthy",description:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"The function is running as expected."})},[src_types.si.overflowed]:{tagType:"caution",display:"Degraded",description:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"The function is running slow or has issues performing async requests. It has been moved to the slow lane and may be processing slower than usual."})},[src_types.si.disabledForPeriod]:{tagType:"danger",display:"Disabled temporarily",description:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"The function has been disabled temporarily due to enough slow or failed requests. It will be re-enabled soon."})},[src_types.si.disabledIndefinitely]:{tagType:"danger",display:"Disabled",description:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:'The function has been disabled indefinitely due to too many slow or failed requests. Please check your config. Updating your function will move it back to the "degraded" state for testing. If it performs well, it will then be moved to the healthy.'})}},DEFAULT_DISPLAY={tagType:"default",display:"Unknown",description:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"The function status is unknown. The status will be derived once enough invocations have been performed."})};function HogFunctionStatusIndicator(){var _hogFunction$status$s;let{hogFunction}=(0,index_esm.useValues)(hogFunctionConfigurationLogic);if(!hogFunction||!hogFunction.enabled)return null;let{tagType,display,description}=hogFunction.status?.state?displayMap[hogFunction.status.state]:DEFAULT_DISPLAY,noRatings=hogFunction.status?.ratings.length===0,averageRating=hogFunction.status?.ratings.length?hogFunction.status.ratings.reduce((acc,x)=>acc+x.rating,0)/hogFunction.status.ratings.length:0;return(0,jsx_runtime.jsx)(src.LemonDropdown,{overlay:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"p-2 space-y-2",children:[(0,jsx_runtime.jsxs)("h2",{className:"flex items-center m-0 gap-2",children:["Function status - ",(0,jsx_runtime.jsx)(src.LemonTag,{type:tagType,children:display})]}),(0,jsx_runtime.jsxs)("p",{children:["Your function has"," ",noRatings?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"no ratings yet. There are either no recent invocations or data is still being gathered."}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["a rating of ",(0,jsx_runtime.jsxs)("b",{children:[Math.round(100*averageRating),"%"]}),"."]})," ","A rating of 100% means the function is running perfectly, with 0% meaning it is failing every time."]}),(0,jsx_runtime.jsx)("p",{children:description}),(0,jsx_runtime.jsx)("h4",{children:"History"}),(0,jsx_runtime.jsx)("ul",{children:(0,jsx_runtime.jsx)(src.LemonTable,{columns:[{title:"Timestamp",key:"timestamp",render:(_,_ref)=>{let{timestamp}=_ref;return(0,jsx_runtime.jsx)(apps_common_src.TZLabel,{time:(0,dayjs.Bv)(timestamp)})}},{title:"Status",key:"state",render:(_,_ref2)=>{let{state}=_ref2,{tagType,display}=displayMap[state]||DEFAULT_DISPLAY;return(0,jsx_runtime.jsx)(src.LemonTag,{type:tagType,children:display})}}],dataSource:null!==(_hogFunction$status$s=hogFunction.status?.states)&&void 0!==_hogFunction$status$s?_hogFunction$status$s:[]})})]})}),children:(0,jsx_runtime.jsx)(src.LemonTag,{type:tagType,children:display})})}var clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js");let hogFunctionTestLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(id=>["scenes","pipeline","hogfunctions","hogFunctionTestLogic",id]),(0,index_esm.connect)(props=>({values:[hogFunctionConfigurationLogic({id:props.id}),["configuration","configurationHasErrors"]],actions:[hogFunctionConfigurationLogic({id:props.id}),["touchConfigurationField"]]})),(0,index_esm.actions)({setTestResult:result=>({result}),toggleExpanded:expanded=>({expanded})}),(0,index_esm.reducers)({expanded:[!1,{toggleExpanded:(_,_ref)=>{let{expanded}=_ref;return void 0===expanded?!_:expanded}}],testResult:[null,{setTestResult:(_,_ref2)=>{let{result}=_ref2;return result}}]}),(0,lib.forms)(_ref3=>{let{props,actions,values}=_ref3;return{testInvocation:{defaults:{mock_async_functions:!0},alwaysShowErrors:!0,errors:_ref4=>{let{globals}=_ref4;return{globals:globals?(0,utils.Cy)(globals)?void 0:"Invalid JSON":"Required"}},submit:async data=>{if(values.configurationHasErrors){src.lemonToast.error("Please fix the configuration errors before testing.");return}let event=(0,utils.Cy)(data.globals),configuration=sanitizeConfiguration(values.configuration);try{let res=await api.ZP.hogFunctions.createTestInvocation(props.id,{event,mock_async_functions:data.mock_async_functions,configuration});actions.setTestResult(res)}catch(e){src.lemonToast.error(`An unexpected serror occurred while trying to testing the function. ${e}`)}}}}}),(0,index_esm.afterMount)(_ref5=>{let{actions}=_ref5;actions.setTestInvocationValue("globals",JSON.stringify(createExampleEvent(),null,2))})]),HogFunctionTestEditor=_ref=>{let{value,onChange}=_ref;return(0,jsx_runtime.jsx)(CodeEditorResizable.Y,{language:"json",value:value,height:300,onChange:onChange,options:{lineNumbers:"off",minimap:{enabled:!1},quickSuggestions:{other:!0,strings:!0},suggest:{showWords:!1,showFields:!1,showKeywords:!1},scrollbar:{vertical:"hidden",verticalScrollbarSize:0}}})};function HogFunctionTestPlaceholder(){return(0,jsx_runtime.jsxs)("div",{className:"border bg-accent-3000 rounded p-3 space-y-2",children:[(0,jsx_runtime.jsx)("h2",{className:"flex-1 m-0",children:"Testing"}),(0,jsx_runtime.jsx)("p",{children:"Save your configuration to enable testing"})]})}function HogFunctionTest(props){var _testResult$logs;let{isTestInvocationSubmitting,testResult,expanded}=(0,index_esm.useValues)(hogFunctionTestLogic(props)),{submitTestInvocation,setTestResult,toggleExpanded}=(0,index_esm.useActions)(hogFunctionTestLogic(props));return(0,jsx_runtime.jsx)(lib.Form,{logic:hogFunctionTestLogic,props:props,formKey:"testInvocation",enableFormOnSubmit:!0,children:(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("border bg-bg-light rounded p-3 space-y-2",expanded&&"min-h-120"),children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-end",children:[expanded?(0,jsx_runtime.jsx)("h2",{className:"flex-1 m-0",children:"Testing"}):(0,jsx_runtime.jsx)(src.LemonButton,{className:"flex-1",onClick:()=>toggleExpanded(),children:(0,jsx_runtime.jsx)("h2",{className:"m-0",children:"Testing"})}),expanded&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[testResult?(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:()=>setTestResult(null),loading:isTestInvocationSubmitting,children:"Clear test result"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"mock_async_functions",children:_ref2=>{let{value,onChange}=_ref2;return(0,jsx_runtime.jsx)(src.LemonSwitch,{bordered:!0,onChange:onChange,checked:value,label:(0,jsx_runtime.jsx)(src.Tooltip,{title:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"When selected, async functions such as `fetch` will not actually be called but instead will be mocked out with the fetch content logged instead"}),children:(0,jsx_runtime.jsxs)("span",{className:"flex gap-2",children:["Mock out async functions",(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-lg"})]})})})}}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",onClick:submitTestInvocation,loading:isTestInvocationSubmitting,children:"Test function"})]}),(0,jsx_runtime.jsx)(src.LemonButton,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:()=>toggleExpanded(),tooltip:"Hide testing"})]})]}),expanded&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:testResult?(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-center",children:[(0,jsx_runtime.jsx)(src.LemonLabel,{children:"Test invocation result "}),(0,jsx_runtime.jsx)(src.LemonTag,{type:"success"===testResult.status?"success":"danger",children:testResult.status})]}),(0,jsx_runtime.jsx)(src.LemonTable,{dataSource:null!==(_testResult$logs=testResult.logs)&&void 0!==_testResult$logs?_testResult$logs:[],columns:[{title:"Timestamp",key:"timestamp",dataIndex:"timestamp",render:timestamp=>(0,jsx_runtime.jsx)(apps_common_src.TZLabel,{time:timestamp}),width:0},{width:100,title:"Level",key:"level",dataIndex:"level"},{title:"Message",key:"message",dataIndex:"message",render:message=>(0,jsx_runtime.jsx)("code",{className:"whitespace-pre-wrap",children:message})}],className:"ph-no-capture",rowKey:"timestamp",pagination:{pageSize:200,hideOnSinglePage:!0}})]}):(0,jsx_runtime.jsx)("div",{className:"space-y-2",children:(0,jsx_runtime.jsx)(LemonField.D,{name:"globals",label:"Test invocation context",children:_ref3=>{let{value,onChange}=_ref3;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex items-start justify-end",children:(0,jsx_runtime.jsx)("p",{className:"flex-1",children:"The globals object is the context in which your function will be tested. It should contain all the data that your function will need to run"})}),(0,jsx_runtime.jsx)(HogFunctionTestEditor,{value:value,onChange:onChange})]})}})})})]})})}function HogFunctionConfiguration(_ref){let{templateId,id}=_ref,logicProps={templateId,id},logic=hogFunctionConfigurationLogic(logicProps),{isConfigurationSubmitting,configurationChanged,showSource,configuration,loading,loaded,hogFunction,willReEnableOnSave}=(0,index_esm.useValues)(logic),{submitConfiguration,resetForm,setShowSource,duplicate,resetToTemplate,duplicateFromTemplate,setConfigurationValue,deleteHogFunction}=(0,index_esm.useActions)(logic),hogFunctionsEnabled=!!(0,useFeatureFlag.y)("HOG_FUNCTIONS"),{groupsTaxonomicTypes}=(0,index_esm.useValues)(groupsModel.$);if(loading&&!loaded)return(0,jsx_runtime.jsx)(src.SpinnerOverlay,{});if(!loaded)return(0,jsx_runtime.jsx)(NotFound.T,{object:"Hog function"});if(!hogFunctionsEnabled&&!id)return(0,jsx_runtime.jsx)("div",{className:"space-y-3",children:(0,jsx_runtime.jsxs)("div",{className:"border rounded text-center p-4",children:[(0,jsx_runtime.jsx)("h2",{children:"Feature not enabled"}),(0,jsx_runtime.jsx)("p",{children:"Hog functions are not enabled for you yet. If you think they should be, contact support."})]})});let headerButtons=(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:!templateId&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonButton,{fullWidth:!0,onClick:()=>duplicate(),children:"Duplicate"}),(0,jsx_runtime.jsx)(src.LemonDivider,{}),(0,jsx_runtime.jsx)(src.LemonButton,{status:"danger",fullWidth:!0,onClick:()=>deleteHogFunction(),children:"Delete"})]})}),(0,jsx_runtime.jsx)(src.LemonDivider,{vertical:!0})]})}),saveButtons=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",htmlType:"reset",onClick:()=>resetForm(),disabledReason:configurationChanged?isConfigurationSubmitting?"Saving in progress…":void 0:"No changes",children:"Clear changes"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"primary",htmlType:"submit",onClick:submitConfiguration,loading:isConfigurationSubmitting,children:templateId?"Create":willReEnableOnSave?"Save & re-enable":"Save"})]});return(0,jsx_runtime.jsx)("div",{className:"space-y-3",children:(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:hogFunctionConfigurationLogic,props:logicProps,children:[(0,jsx_runtime.jsx)(PageHeader.m,{buttons:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[headerButtons,saveButtons]})}),(0,jsx_runtime.jsxs)(src.LemonBanner,{type:"info",children:["Hog Functions are in ",(0,jsx_runtime.jsx)("b",{children:"alpha"})," and are the next generation of our data pipeline destinations. You can use pre-existing templates or modify the source Hog code to create your own custom functions."]}),(0,jsx_runtime.jsx)(lib.Form,{logic:hogFunctionConfigurationLogic,props:logicProps,formKey:"configuration",className:"space-y-3",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap gap-4 items-start",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4 flex-1 min-w-100",children:[(0,jsx_runtime.jsxs)("div",{className:"border bg-bg-light rounded p-3 space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-2 min-h-16 items-center",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"icon_url",children:_ref2=>{var _ref3;let{value,onChange}=_ref2;return(0,jsx_runtime.jsx)(HogFunctionIcon.g,{logicKey:null!==(_ref3=null!=id?id:templateId)&&void 0!==_ref3?_ref3:"new",search:configuration.name,src:value,onChange:val=>onChange(val)})}}),(0,jsx_runtime.jsx)("div",{className:"flex flex-col py-1 flex-1 justify-start",children:(0,jsx_runtime.jsx)("span",{className:"font-semibold",children:configuration.name})}),(0,jsx_runtime.jsx)(HogFunctionStatusIndicator,{}),(0,jsx_runtime.jsx)(LemonField.D,{name:"enabled",children:_ref4=>{let{value,onChange}=_ref4;return(0,jsx_runtime.jsx)(src.LemonSwitch,{label:"Enabled",onChange:()=>onChange(!value),checked:value,disabled:loading,bordered:!0})}})]}),(0,jsx_runtime.jsx)(LemonField.D,{name:"name",label:"Name",info:"Customising the name can be useful if multiple instances of the same type are used.",children:(0,jsx_runtime.jsx)(src.LemonInput,{type:"text",disabled:loading})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"description",label:"Description",info:"Add a description to share context with other team members",children:(0,jsx_runtime.jsx)(src.LemonTextArea,{disabled:loading})}),hogFunction?.template?(0,jsx_runtime.jsxs)("p",{className:"border border-dashed rounded text-muted-alt p-2",children:["Built from template:"," ",(0,jsx_runtime.jsx)(src.LemonDropdown,{showArrow:!0,overlay:(0,jsx_runtime.jsxs)("div",{className:"max-w-120 p-1",children:[(0,jsx_runtime.jsxs)("p",{children:["This function was built from the template"," ",(0,jsx_runtime.jsx)("b",{children:hogFunction.template.name}),". If the template is updated, this function is not affected unless you choose to update it."]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 gap-2 items-center border-t pt-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1",children:(0,jsx_runtime.jsx)(src.LemonButton,{children:"Close"})}),(0,jsx_runtime.jsx)(src.LemonButton,{onClick:()=>resetToTemplate(),children:"Reset to template"}),(0,jsx_runtime.jsx)(src.LemonButton,{type:"secondary",onClick:()=>duplicateFromTemplate(),children:"New function from template"})]})]}),children:(0,jsx_runtime.jsxs)(src.Link,{subtle:!0,className:"font-semibold",children:[hogFunction?.template.name," ",(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{})]})})]}):null]}),(0,jsx_runtime.jsxs)("div",{className:"border bg-bg-light rounded p-3 space-y-2",children:[(0,jsx_runtime.jsx)(LemonField.D,{name:"filters",label:"Filters by events and actions",children:_ref5=>{var _value$filter_test_ac;let{value,onChange}=_ref5;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(TestAccountFiltersSwitch.Z,{checked:null!==(_value$filter_test_ac=value?.filter_test_accounts)&&void 0!==_value$filter_test_ac&&_value$filter_test_ac,onChange:val=>onChange({...value,filter_test_accounts:val}),fullWidth:!0}),(0,jsx_runtime.jsx)(ActionFilter.T,{bordered:!0,filters:null!=value?value:{},setFilters:payload=>{onChange({...payload,filter_test_accounts:value?.filter_test_accounts})},typeKey:"plugin-filters",mathAvailability:ActionFilterRow.Qq.None,hideRename:!0,hideDuplicate:!0,showNestedArrow:!1,actionsTaxonomicGroupTypes:[types.t.Events,types.t.Actions],propertiesTaxonomicGroupTypes:[types.t.EventProperties,types.t.EventFeatureFlags,types.t.Elements,types.t.PersonProperties,types.t.HogQLExpression,...groupsTaxonomicTypes],propertyFiltersPopover:!0,addFilterDefaultOptions:{id:"$pageview",name:"$pageview",type:src_types.DC.EVENTS},buttonCopy:"Add event filter"})]})}}),(0,jsx_runtime.jsxs)("p",{className:"italic text-muted-alt",children:["This destination will be triggered if ",(0,jsx_runtime.jsx)("b",{children:"any of"})," the above filters match."]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex-2 min-w-100 space-y-4",children:[(0,jsx_runtime.jsx)("div",{className:"border bg-bg-light rounded p-3 space-y-2",children:(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsx)(HogFunctionInputs,{}),showSource?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.LemonButton,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),size:"small",type:"secondary",className:"my-4",onClick:()=>{var _configuration$inputs,_configuration$inputs2;setConfigurationValue("inputs_schema",[...null!==(_configuration$inputs=configuration.inputs_schema)&&void 0!==_configuration$inputs?_configuration$inputs:[],{type:"string",key:`input_${(null!==(_configuration$inputs2=configuration.inputs_schema?.length)&&void 0!==_configuration$inputs2?_configuration$inputs2:0)+1}`,label:"",required:!1}])},children:"Add input variable"}),(0,jsx_runtime.jsx)(LemonField.D,{name:"hog",children:_ref6=>{let{value,onChange}=_ref6;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex justify-between gap-2",children:[(0,jsx_runtime.jsx)(src.LemonLabel,{children:"Function source code"}),(0,jsx_runtime.jsx)(src.LemonButton,{size:"xsmall",type:"secondary",onClick:()=>setShowSource(!1),children:"Hide source code"})]}),(0,jsx_runtime.jsx)(CodeEditorResizable.Y,{language:"hog",value:null!=value?value:"",onChange:v=>onChange(null!=v?v:""),options:{minimap:{enabled:!1},wordWrap:"on",scrollBeyondLastLine:!1,automaticLayout:!0,fixedOverflowWidgets:!0,suggest:{showInlineDetails:!0},quickSuggestionsDelay:300}})]})}})]}):(0,jsx_runtime.jsx)("div",{className:"flex justify-end mt-2",children:(0,jsx_runtime.jsx)(src.LemonButton,{size:"xsmall",type:"secondary",onClick:()=>setShowSource(!0),children:"Show function source code"})})]})}),id?(0,jsx_runtime.jsx)(HogFunctionTest,{id:id}):(0,jsx_runtime.jsx)(HogFunctionTestPlaceholder,{}),(0,jsx_runtime.jsx)("div",{className:"flex gap-2 justify-end",children:saveButtons})]})]})})]})})}},"./frontend/src/scenes/pipeline/hogfunctions/HogFunctionIcon.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{_:()=>HogFunctionIcon,g:()=>HogFunctionIconEditable});var src=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("./node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),icons=__webpack_require__("./frontend/src/lib/lemon-ui/icons/index.ts"),lib=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("./frontend/src/lib/api.ts");let hogFunctionIconLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>{var _props$logicKey;return null!==(_props$logicKey=props.logicKey)&&void 0!==_props$logicKey?_props$logicKey:"default"}),(0,index_esm.path)(key=>["scenes","pipeline","hogfunctions","hogFunctionIconLogic",key]),(0,index_esm.actions)({loadPossibleIcons:!0,setShowPopover:show=>({show}),setSearchTerm:search=>({search})}),(0,index_esm.reducers)({showPopover:[!1,{setShowPopover:(_,_ref)=>{let{show}=_ref;return show}}],searchTerm:[null,{setSearchTerm:(_,_ref2)=>{let{search}=_ref2;return search},setShowPopover:()=>null}]}),(0,lib.loaders)(_ref3=>{let{props,values}=_ref3;return{possibleIcons:[null,{loadPossibleIcons:async(_,breakpoint)=>{var _values$searchTerm;let search=null!==(_values$searchTerm=values.searchTerm)&&void 0!==_values$searchTerm?_values$searchTerm:props.search;if(!search)return[];await breakpoint(1e3);let res=await api.ZP.hogFunctions.listIcons({query:search});return res.map(icon=>({...icon,url:icon.url+"&temp=true"}))}}]}}),(0,index_esm.listeners)(_ref4=>{let{actions,values,props}=_ref4;return{loadPossibleIconsSuccess:async()=>{let autoChange=props.onChange&&(!props.src||props.src.includes("temp=true"));if(!autoChange)return;let firstValue=values.possibleIcons?.[0];firstValue&&props.onChange?.(firstValue.url)},setShowPopover:_ref5=>{let{show}=_ref5;show&&actions.loadPossibleIcons()},setSearchTerm:()=>{actions.loadPossibleIcons()}}}),(0,index_esm.propsChanged)((_ref6,oldProps)=>{let{props,actions}=_ref6;props.onChange&&(!props.src||props.search!==oldProps.search&&props.src.includes("temp=true"))&&actions.loadPossibleIcons()})]);var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let fileToBase64=file=>new Promise(resolve=>{if(!file)return;let reader=new FileReader;reader.onload=e=>{let img=new Image;img.onload=()=>{let canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=128,canvas.height=128,ctx.drawImage(img,0,0,128,128);let dataURI=canvas.toDataURL();resolve(dataURI)},img.src=e.target?.result},reader.readAsDataURL(file)});function HogFunctionIconEditable(_ref){var _possibleIcons$map;let{size="medium",...props}=_ref,{possibleIconsLoading,showPopover,possibleIcons,searchTerm}=(0,index_esm.useValues)(hogFunctionIconLogic(props)),{setShowPopover,setSearchTerm}=(0,index_esm.useActions)(hogFunctionIconLogic(props)),content=(0,jsx_runtime.jsxs)("span",{className:(0,clsx_m.default)("relative cursor-pointer",{"w-8 h-8":"small"===size,"w-10 h-10":"medium"===size,"w-12 h-12":"large"===size}),onClick:()=>setShowPopover(!showPopover),children:[possibleIconsLoading?(0,jsx_runtime.jsx)(src.Spinner,{className:"absolute -top-1 -right-1"}):null,(0,jsx_runtime.jsx)(HogFunctionIcon,{size:size,src:props.src})]});return props.onChange?(0,jsx_runtime.jsx)(src.Popover,{showArrow:!0,visible:showPopover,onClickOutside:()=>setShowPopover(!1),overlay:(0,jsx_runtime.jsxs)("div",{className:"p-1 w-100 space-y-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 justify-between",children:[(0,jsx_runtime.jsx)("h2",{className:"m-0",children:"Choose an icon"}),(0,jsx_runtime.jsx)(src.LemonFileInput,{multiple:!1,accept:"image/*",showUploadedFiles:!1,onChange:files=>{fileToBase64(files[0]).then(dataURI=>{props.onChange?.(dataURI)}).catch(()=>{src.lemonToast.error("Error uploading image")})},callToAction:(0,jsx_runtime.jsx)(src.LemonButton,{size:"small",type:"secondary",icon:(0,jsx_runtime.jsx)(icons.bn,{}),children:"Upload image"})})]}),(0,jsx_runtime.jsx)(src.LemonInput,{size:"small",type:"search",placeholder:"Search for company logos",fullWidth:!0,value:null!=searchTerm?searchTerm:"",onChange:setSearchTerm,prefix:possibleIconsLoading?(0,jsx_runtime.jsx)(src.Spinner,{}):void 0}),(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap gap-2",children:null!==(_possibleIcons$map=possibleIcons?.map(icon=>jsx_runtime.jsx("span",{className:"w-14 h-14 cursor-pointer",onClick:()=>{let nonTempUrl=icon.url.replace("&temp=true","");props.onChange?.(nonTempUrl),setShowPopover(!1)},children:jsx_runtime.jsx("img",{src:icon.url,title:icon.name,className:"w-full h-full rounded overflow-hidden"})},icon.id)))&&void 0!==_possibleIcons$map?_possibleIcons$map:possibleIconsLoading?(0,jsx_runtime.jsx)(src.LemonSkeleton,{className:"w-14 h-14",repeat:4}):"No icons found"})]}),children:content}):content}function HogFunctionIcon(_ref2){let{src,size="medium"}=_ref2;return(0,jsx_runtime.jsx)("span",{className:(0,clsx_m.default)("flex items-center justify-center",{"w-8 h-8 text-2xl":"small"===size,"w-10 h-10 text-4xl":"medium"===size,"w-12 h-12 text-6xl":"large"===size}),children:src?(0,jsx_runtime.jsx)("img",{className:"w-full h-full rounded overflow-hidden",src:src}):(0,jsx_runtime.jsx)("span",{children:"\uD83E\uDD94"})})}},"./frontend/src/scenes/pipeline/importAppsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>importAppsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");let importAppsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","importAppsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic,["currentTeamId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_import_apps")}],pluginConfigs:[{},{loadPluginConfigs:async()=>{let res=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/pipeline_import_apps_configs`);return Object.fromEntries(res.map(pluginConfig=>[pluginConfig.id,pluginConfig]))},toggleEnabled:async _ref2=>{let{id,enabled}=_ref2;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.ImportApp,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref3=>{let{pluginConfig}=_ref3;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],importApps:[s=>[s.plugins,s.pluginConfigs],(plugins,pluginConfigs)=>{let rawImportApp=Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})),convertedImportApps=rawImportApp.map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.ImportApp)),enabledFirst=convertedImportApps.sort((a,b)=>Number(b.enabled)-Number(a.enabled));return enabledFirst}],hasEnabledImportApps:[s=>[s.importApps],importApps=>importApps.some(app=>app.enabled)]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref4=>{let{actions}=_ref4;actions.loadPlugins(),actions.loadPluginConfigs()})])},"./frontend/src/scenes/pipeline/pipelineNodeMetricsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>pipelineNodeMetricsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),lib_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/lib/utils.tsx"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx");let pipelineNodeMetricsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{id}=_ref;return id}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(id=>["scenes","pipeline","appMetricsLogic",id]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic,["currentTeamId"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setDateRange:(from,to)=>({from,to}),openErrorDetailsModal:errorType=>({errorType}),closeErrorDetailsModal:!0}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref2=>{let{values,props}=_ref2;return{appMetricsResponse:[null,{loadMetrics:async()=>{var _values$dateRange$to;let params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({date_from:values.dateRange.from,date_to:null!==(_values$dateRange$to=values.dateRange.to)&&void 0!==_values$dateRange$to?_values$dateRange$to:"now"});return await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic.values.currentTeamId}/app_metrics/${props.id}?${params}`)}}],errorDetails:[[],{openErrorDetailsModal:async _ref3=>{let{errorType}=_ref3,params=(0,lib_utils__WEBPACK_IMPORTED_MODULE_3__.oZ)({error_type:errorType}),{result}=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.get(`api/projects/${scenes_teamLogic__WEBPACK_IMPORTED_MODULE_4__.teamLogic.values.currentTeamId}/app_metrics/${props.id}/error_details?${params}`);return result}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({dateRange:[{from:"-7d",to:null},{setDateRange:(_,_ref4)=>{let{from,to}=_ref4;return{from:null!=from?from:"-7d",to:to}}}],errorDetailsModalError:[null,{openErrorDetailsModal:(_,_ref5)=>{let{errorType}=_ref5;return errorType},closeErrorDetailsModal:()=>null}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref6=>{let{actions}=_ref6;return{setDateRange:()=>{actions.loadMetrics()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref7=>{let{actions}=_ref7;actions.loadMetrics()})])},"./frontend/src/scenes/pipeline/transformationsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{P:()=>pipelineTransformationsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/kea-loaders@3.0.0_kea@3.1.5/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/api.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./frontend/src/scenes/teamLogic.tsx"),scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./frontend/src/scenes/userLogic.ts"),_types__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./frontend/src/types.ts"),_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/pipeline/types.ts"),_utils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./frontend/src/scenes/pipeline/utils.tsx");let pipelineTransformationsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","pipeline","transformationsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)({values:[scenes_teamLogic__WEBPACK_IMPORTED_MODULE_3__.teamLogic,["currentTeamId"],scenes_userLogic__WEBPACK_IMPORTED_MODULE_4__.userLogic,["user"]]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({loadPluginConfigs:!0,openReorderModal:!0,closeReorderModal:!0,setTemporaryOrder:tempOrder=>({tempOrder}),savePluginConfigsOrder:newOrders=>({newOrders}),updatePluginConfig:pluginConfig=>({pluginConfig})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(_ref=>{let{values}=_ref;return{plugins:[{},{loadPlugins:async()=>(0,_utils__WEBPACK_IMPORTED_MODULE_7__.c$)("api/organizations/@current/pipeline_transformations")}],temporaryOrder:[{},{setTemporaryOrder:async _ref2=>{let{tempOrder}=_ref2;return tempOrder},closeReorderModal:async()=>({})}],pluginConfigs:[{},{loadPluginConfigs:async()=>{let res=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.loadPaginatedResults(`api/projects/${values.currentTeamId}/pipeline_transformation_configs`);return Object.fromEntries(res.map(pluginConfig=>[pluginConfig.id,pluginConfig]))},savePluginConfigsOrder:async _ref3=>{let{newOrders}=_ref3;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,!1))return values.pluginConfigs;let{pluginConfigs}=values,response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update("api/plugin_config/rearrange",{orders:newOrders}),newPluginConfigs={...pluginConfigs};for(let pluginConfig of response)Object.keys(values.plugins).map(Number).includes(pluginConfig.plugin)&&(newPluginConfigs[pluginConfig.id]=pluginConfig);return newPluginConfigs},toggleEnabled:async _ref4=>{let{id,enabled}=_ref4;if(!(0,_utils__WEBPACK_IMPORTED_MODULE_7__.FH)(_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation,enabled))return values.pluginConfigs;let{pluginConfigs,plugins}=values,pluginConfig=pluginConfigs[id],plugin=plugins[pluginConfig.plugin];(0,_utils__WEBPACK_IMPORTED_MODULE_7__.SO)(`plugin ${enabled?"enabled":"disabled"}`,plugin,pluginConfig);let order={};enabled&&(order={order:values.nextAvailableOrder});let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.update(`api/plugin_config/${id}`,{enabled,...order});return{...pluginConfigs,[id]:response}},updatePluginConfig:_ref5=>{let{pluginConfig}=_ref5;return{...values.pluginConfigs,[pluginConfig.id]:pluginConfig}}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({loading:[s=>[s.pluginsLoading,s.pluginConfigsLoading],(pluginsLoading,pluginConfigsLoading)=>pluginsLoading||pluginConfigsLoading],transformations:[s=>[s.pluginConfigs,s.plugins],(pluginConfigs,plugins)=>{let rawTransformations=Object.values(pluginConfigs).map(pluginConfig=>({...pluginConfig,plugin_info:plugins[pluginConfig.plugin]||null})),convertedTransformations=rawTransformations.map(t=>(0,_types__WEBPACK_IMPORTED_MODULE_6__.n)(t,_types__WEBPACK_IMPORTED_MODULE_5__.We.Transformation));return convertedTransformations}],sortedEnabledTransformations:[s=>[s.transformations,s.temporaryOrder],(transformations,temporaryOrder)=>(transformations=transformations.filter(t=>t.enabled),transformations=temporaryOrder&&Object.keys(temporaryOrder).length>0?Object.entries(temporaryOrder).sort((_ref6,_ref7)=>{let[,aIdx]=_ref6,[,bIdx]=_ref7;return aIdx-bIdx}).map(_ref8=>{let[pluginId]=_ref8;return transformations.find(t=>t.id===Number(pluginId))}):transformations.sort((a,b)=>a.order-b.order))],sortedTransformations:[s=>[s.transformations,s.sortedEnabledTransformations],(transformations,sortedEnabledTransformations)=>sortedEnabledTransformations.concat(transformations.filter(t=>!t.enabled).sort((a,b)=>a.id-b.id))],shouldShowProductIntroduction:[s=>[s.user],user=>!user?.has_seen_product_intro_for?.[_types__WEBPACK_IMPORTED_MODULE_5__.Md.PIPELINE_TRANSFORMATIONS]],nextAvailableOrder:[s=>[s.transformations],transformations=>{let enabledTransformations=transformations.filter(t=>t.enabled);return enabledTransformations.length>0?Math.max(...enabledTransformations.map(t=>t.order),0)+1:0}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({reorderModalOpen:[!1,{openReorderModal:()=>!0,closeReorderModal:()=>!1}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref9=>{let{actions}=_ref9;return{savePluginConfigsOrderSuccess:()=>{actions.closeReorderModal()}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref10=>{let{actions}=_ref10;actions.loadPlugins(),actions.loadPluginConfigs()})])},"./frontend/src/scenes/plugins/edit/PluginField.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{B:()=>PluginField});var _posthog_icons__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/@posthog+icons@0.7.3_react-dom@18.2.0_react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./frontend/@posthog/lemon-ui/src/index.ts"),lib_monaco_CodeEditor__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./frontend/src/lib/monaco/CodeEditor.tsx"),react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),react_virtualized_dist_es_AutoSizer__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),scenes_pipeline_configUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./frontend/src/scenes/pipeline/configUtils.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function JsonConfigField(props){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(react_virtualized_dist_es_AutoSizer__WEBPACK_IMPORTED_MODULE_4__.q,{disableWidth:!0,className:"min-h-60",children:_ref=>{let{height}=_ref;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(lib_monaco_CodeEditor__WEBPACK_IMPORTED_MODULE_2__.p,{className:"border",language:"json",value:props.value,onChange:v=>props.onChange?.(null!=v?v:""),height:height,options:{minimap:{enabled:!1}}})}})}function PluginField(_ref2){let{value,onChange,fieldConfig,disabled}=_ref2,[editingSecret,setEditingSecret]=(0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(!1);return fieldConfig.secret&&!editingSecret&&value&&(value===scenes_pipeline_configUtils__WEBPACK_IMPORTED_MODULE_6__.ue||value.name===scenes_pipeline_configUtils__WEBPACK_IMPORTED_MODULE_6__.ue)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonButton,{type:"secondary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_0__.IconPencil,{}),onClick:()=>{onChange?.(fieldConfig.default||""),setEditingSecret(!0)},disabled:disabled,children:["Reset secret ","attachment"===fieldConfig.type?"attachment":"field"]}):"attachment"===fieldConfig.type?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.Fragment,{children:[value?.name?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("span",{children:["Selected file: ",value.name]}):null,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonFileInput,{accept:"*",multiple:!1,onChange:files=>onChange?.(files[0]),value:value?.size?[value]:[],showUploadedFiles:!1})]}):"string"===fieldConfig.type?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonInput,{value:value,onChange:onChange,autoFocus:editingSecret,className:"ph-no-capture",disabled:disabled}):"json"===fieldConfig.type?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(JsonConfigField,{value:value,onChange:onChange,autoFocus:editingSecret,className:"ph-no-capture"}):"choice"===fieldConfig.type?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.LemonSelect,{fullWidth:!0,value:value,className:"ph-no-capture",onChange:onChange,options:fieldConfig.choices.map(choice=>({label:choice,value:choice})),disabled:disabled}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsxs)("strong",{className:"text-danger",children:['Unknown field type "',(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("code",{children:fieldConfig.type}),'".',(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_5__.jsx)("br",{}),"You may need to upgrade PostHog!"]})}}}]);