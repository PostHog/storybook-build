(window.webpackJsonp=window.webpackJsonp||[]).push([[322],{"./frontend/src/scenes/instance/Licenses/index.tsx":function(Q,M,n){"use strict";n.r(M),n.d(M,"scene",function(){return $}),n.d(M,"Licenses",function(){return x});var y=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),A=n.n(y),T=n("./node_modules/core-js/modules/es.array.filter.js"),X=n.n(T),B=n("./node_modules/core-js/modules/es.object.to-string.js"),Z=n.n(B),I=n("./node_modules/core-js/modules/es.array.sort.js"),k=n.n(I),W=n("./node_modules/core-js/modules/es.array.slice.js"),w=n.n(W),K=n("./node_modules/core-js/modules/es.array.map.js"),q=n.n(K),U=n("./node_modules/core-js/modules/es.function.name.js"),ee=n.n(U),L=n("./node_modules/react/index.js"),ne=n.n(L),R=n("./frontend/src/lib/components/LemonButton/More.tsx"),m=n("./node_modules/antd/es/form/index.js"),p=n("./node_modules/antd/es/alert/index.js"),F=n("./node_modules/antd/es/input/index.js"),V=n("./node_modules/antd/es/button/index.js"),O=n("./frontend/src/scenes/instance/Licenses/licenseLogic.ts"),E=n("./node_modules/kea/lib/index.esm.js"),g=n("./frontend/src/lib/utils.tsx"),z=n("./frontend/src/lib/components/PageHeader.tsx"),N=n("./frontend/src/lib/components/LemonTable/index.ts"),f=n("./frontend/src/lib/components/LemonButton/index.ts"),H=n("./frontend/src/scenes/organizationLogic.tsx"),C=n("./frontend/src/lib/dayjs.ts"),Y=n("./frontend/src/lib/components/LemonModal/index.ts"),S=n("./frontend/src/scenes/billing/billingLogic.ts"),b=n("./node_modules/kea-router/lib/index.js"),se=n.n(b),J=n("./frontend/src/scenes/urls.ts"),e=n("./node_modules/react/jsx-runtime.js"),te=n.n(e),$={component:x,logic:O.b};function G(i){var v=i.licenses,_=i.isOpen,r=i.onCancel,P=i.onOk,h=Object(E.useValues)(H.a),a=h.currentOrganization,u=Object(E.useValues)(S.b),c=u.billingVersion,D=v.filter(function(s){return Object(C.a)().isBefore(s.valid_until)}).length>1,d=((a==null?void 0:a.teams)||[]).filter(function(s){return!s.is_demo}).sort(function(s,o){return s.id-o.id}),j=!D&&d.slice(1,d.length).length>0;return Object(L.useEffect)(function(){c==="v2"&&b.router.actions.push(J.a.organizationBilling())},[c]),Object(e.jsx)(Y.a,{isOpen:_,onClose:r,title:"Are you sure you want to deactivate your license?",footer:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(f.a,{form:"new-dashboard-form",type:"secondary","data-attr":"deactivate-license-cancel",className:"mr-2",onClick:r,children:"Cancel"}),Object(e.jsx)(f.a,{"data-attr":"deactivate-license-proceed",type:"primary",status:"danger",onClick:P,children:j?Object(e.jsxs)(e.Fragment,{children:["Deactivate license & delete ",d.length," project(s)"]}):"Deactivate license"})]}),children:Object(e.jsxs)("ul",{className:"pl-3 list-disc",children:[D?Object(e.jsxs)("li",{children:["You will ",Object(e.jsx)("strong",{children:"keep"})," all premium features available with your other valid license."]}):Object(e.jsxs)("li",{children:["You will ",Object(e.jsx)("strong",{children:"IMMEDIATELY"})," lose access to all premium features such as"," ",Object(e.jsx)("strong",{children:"multiple projects"}),", ",Object(e.jsx)("strong",{children:"single sign on"}),","," ",Object(e.jsx)("strong",{children:"group analytics"}),", ",Object(e.jsx)("strong",{children:"multivariate feature flags"})," and many more."]}),j&&Object(e.jsxs)("li",{children:["We will ",Object(e.jsx)("strong",{className:"text-danger",children:"DELETE"})," the following projects:",Object(e.jsx)("ul",{className:"pl-6 list-disc mb-2",children:d.map(function(s){return Object(e.jsx)("li",{children:Object(e.jsx)("strong",{children:s.name})},s.id)})}),"To keep one of these projects instead, remove all other projects first."]}),Object(e.jsx)("li",{children:"You will immediately be billed for usage in the current period, if any."})]})})}function x(){var i=m.a.useForm(),v=A()(i,1),_=v[0],r=Object(E.useValues)(O.b),P=r.licenses,h=r.licensesLoading,a=r.error,u=r.showConfirmCancel,c=Object(E.useActions)(O.b),D=c.createLicense,d=c.deleteLicense,j=c.setShowConfirmCancel,s=[{title:"Active",render:function(l,t){return Object(O.a)(t)?"expired":"active"}},{title:"Valid until",render:function(l,t){return Object(g.N)(t.valid_until)}},{title:"Plan",dataIndex:"plan"},{title:"License added on",render:function(l,t){return Object(g.N)(t.created_at)}},{width:0,render:function(l,t){return Object(C.a)().isAfter(t.valid_until)?null:Object(e.jsx)(R.a,{overlay:Object(e.jsx)(e.Fragment,{children:Object(e.jsx)(f.a,{status:"danger",onClick:function(){return j(t)},fullWidth:!0,children:"Deactivate license"})})})}}];return Object(e.jsxs)("div",{children:[Object(e.jsx)(G,{licenses:P,isOpen:!!u,onCancel:function(){return j(null)},onOk:function(){return u?d(u):null}}),Object(e.jsx)(z.a,{title:"Licenses",caption:Object(e.jsxs)(e.Fragment,{children:["Here you can add and manage your PostHog enterprise licenses. When you activate a license key, enterprise functionality will be enabled immediately. Contact"," ",Object(e.jsx)("a",{href:"mailto:sales@posthog.com",children:"sales@posthog.com"})," to buy a license or if you have any issues with a license."]})}),a&&Object(e.jsx)(p.a,{message:a.detail||Object(e.jsx)("span",{children:"Could not validate license key. Please try again or contact us."}),type:"error",style:{marginBottom:"1em"}}),Object(e.jsxs)(m.a,{form:_,name:"horizontal_login",layout:"inline",onFinish:function(l){return D({key:l.key})},style:{marginBottom:"1rem"},children:[Object(e.jsx)(m.a.Item,{name:"key",rules:[{required:!0,message:"Please input a license key!"}],children:Object(e.jsx)(F.a,{placeholder:"License key",style:{minWidth:400}})}),Object(e.jsx)(m.a.Item,{shouldUpdate:!0,children:function(){return Object(e.jsx)(V.a,{type:"primary",htmlType:"submit",disabled:!_.isFieldsTouched(!0)||!!_.getFieldsError().filter(function(l){var t=l.errors;return t.length}).length,children:"Activate License Key"})}})]}),Object(e.jsx)(N.a,{"data-attr":"license-table",size:"small",rowKey:"id",rowClassName:"cursor-pointer",dataSource:P,columns:s,loading:h})]})}}}]);
