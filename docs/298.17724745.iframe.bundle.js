(window.webpackJsonp=window.webpackJsonp||[]).push([[298],{"./frontend/src/scenes/instance/SystemStatus/index.tsx":function(F,I,a){"use strict";a.r(I),a.d(I,"scene",function(){return qe}),a.d(I,"SystemStatus",function(){return me});var Q=a("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),ge=a.n(Q),ve=a("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss"),q=a.n(ve),D={};D.insert="head",D.singleton=!1;var _e=ge()(q.a,D),et=q.a.locals||{},N=a("./node_modules/react/index.js"),e=a.n(N),_=a("./node_modules/antd/es/alert/index.js"),L=a("./node_modules/antd/es/tabs/index.js"),y=a("./frontend/src/scenes/instance/SystemStatus/systemStatusLogic.ts"),h=a("./node_modules/kea/lib/index.esm.js"),ye=a("./frontend/src/lib/components/PageHeader.tsx"),ee=a("./frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),C=a("./frontend/src/lib/components/icons.tsx"),tt=a("./node_modules/core-js/modules/es.array.map.js"),te=a("./frontend/src/lib/components/Link.tsx"),nt=a("./node_modules/core-js/modules/es.array.iterator.js"),at=a("./node_modules/core-js/modules/es.object.to-string.js"),st=a("./node_modules/core-js/modules/es.set.js"),rt=a("./node_modules/core-js/modules/es.string.iterator.js"),lt=a("./node_modules/core-js/modules/web.dom-collections.iterator.js"),ot=a("./node_modules/core-js/modules/es.regexp.to-string.js"),A=a("./frontend/src/lib/components/LemonTag/LemonTag.tsx"),Y=a("./frontend/src/lib/utils.tsx"),pe=new Set(["last_event_ingested_timestamp"]);function M(t,s){var r=s.key,n=s.value,o=s.value_type,i=s.emptyNullLabel,u=s.isSecret;return n&&u?e.a.createElement(A.a,{style:{color:"var(--muted)",backgroundColor:"#fee5b3"},className:"uppercase",icon:u?e.a.createElement(C.IconLock,{style:{color:"var(--warning)"}}):void 0},"Secret"):r&&pe.has(r)&&typeof n=="string"?new Date(n).getTime()===new Date("1970-01-01T00:00:00").getTime()?"Never":Object(Y.N)(n):o==="bool"||typeof n=="boolean"?e.a.createElement(A.a,{type:n?"success":"danger"},n?"Yes":"No"):n==null||n===""?e.a.createElement(A.a,{className:"uppercase",style:{color:"var(--muted)"}},i!=null?i:"Unknown"):o==="int"||typeof n=="number"?n.toLocaleString("en-US"):n.toString()}var b=a("./frontend/@posthog/lemon-ui/src/index.ts"),ne={async_migrations_ok:"/instance/async_migrations"};function he(t,s){return e.a.createElement("span",null,s.metric," ",ne[s.key]?e.a.createElement(te.a,{to:ne[s.key]},e.a.createElement(C.IconOpenInNew,{style:{verticalAlign:"middle"}})):null)}function Ee(){var t=Object(h.useValues)(y.b),s=t.overview,r=t.systemStatusLoading;return e.a.createElement(b.LemonTable,{className:"system-status-table",rowKey:"metric",dataSource:s,columns:[{title:"Metric",className:"metric-column",render:he},{title:"Value",render:M}],loading:r,expandable:{expandedRowRender:function(o){var i;return(i=o.subrows)!==null&&i!==void 0&&i.rows.length?e.a.createElement(be,o.subrows):null},rowExpandable:function(o){var i;return!!((i=o.subrows)!==null&&i!==void 0&&i.rows.length)}}})}function be(t){return e.a.createElement(b.LemonTable,{dataSource:t.rows,columns:t.columns.map(function(s,r){return{title:s,dataIndex:r}}),embedded:!0})}var Se=a("./node_modules/@babel/runtime/helpers/objectDestructuringEmpty.js"),je=a.n(Se),Oe=a("./node_modules/@babel/runtime/helpers/slicedToArray.js"),$=a.n(Oe),it=a("./node_modules/core-js/modules/es.array.filter.js"),ut=a("./node_modules/core-js/modules/web.dom-collections.for-each.js"),ct=a("./node_modules/core-js/modules/es.object.keys.js"),U=a("./node_modules/antd/es/collapse/index.js"),Ce=a("./node_modules/antd/es/checkbox/index.js"),w=a("./node_modules/antd/es/button/index.js"),Ie=a("./node_modules/antd/es/table/index.js"),H=a("./node_modules/@ant-design/icons/es/icons/ReloadOutlined.js"),Ae=a("./frontend/src/scenes/dashboard/Dashboard.tsx"),Le=a("./frontend/src/types.ts"),dt=a("./node_modules/core-js/modules/es.object.entries.js");function Te(){var t=Object(h.useValues)(y.b),s=t.analyzeModalOpen,r=t.analyzeQuery,n=t.analyzeQueryResult,o=t.analyzeQueryResultLoading,i=Object(h.useActions)(y.b),u=i.setAnalyzeModalOpen,m=i.setAnalyzeQuery,c=i.runAnalyzeQuery;return e.a.createElement(b.LemonModal,{isOpen:s,title:"Analyze ClickHouse query performance",footer:e.a.createElement(e.a.Fragment,null,e.a.createElement(b.LemonButton,{type:"secondary",onClick:function(){return u(!1)}},"Cancel"),e.a.createElement(b.LemonButton,{type:"primary",onClick:function(){return void c()},disabled:o},"Analyze")),onClose:function(){return u(!1)},width:"80%"},e.a.createElement(b.LemonTextArea,{placeholder:"SQL query to analyze",onChange:m,value:r,rows:10}),n&&e.a.createElement("div",{className:"mt-2"},e.a.createElement("h2",null,"Analysis results"),e.a.createElement("ul",null,Object.entries(n.timing).map(function(l){var d=$()(l,2),g=d[0],f=d[1];return e.a.createElement("li",{key:g},g,": ",f)})),Object.entries(n.flamegraphs).map(function(l){var d=$()(l,2),g=d[0],f=d[1];return e.a.createElement("div",{key:g},e.a.createElement("h3",null,"Flamegraph: ",g),e.a.createElement("a",{className:"embedded-svg-wrapper",href:"data:image/svg+xml;utf8,".concat(encodeURIComponent(f)),dangerouslySetInnerHTML:{__html:f}}))})))}function Ue(){var t=Object(h.useValues)(y.b),s=t.openSections,r=t.systemStatus,n=t.queries,o=t.queriesLoading,i=t.showAnalyzeQueryButton,u=Object(h.useActions)(y.b),m=u.setOpenSections,c=u.loadQueries,l=Object(N.useState)(!1),d=$()(l,2),g=d[0],f=d[1],p=Object(N.useMemo)(function(){var j;return n==null||(j=n.postgres_running)===null||j===void 0?void 0:j.filter(function(E){var V=E.state;return g||V!=="idle"})},[g,n]),v=r==null?void 0:r.internal_metrics.clickhouse,S=function(E){E.stopPropagation(),c()};return e.a.createElement(e.a.Fragment,null,e.a.createElement(U.a,{activeKey:s,onChange:function(E){return m(E)}},v?e.a.createElement(U.a.Panel,{header:"Dashboards",key:"0"},e.a.createElement(Ae.Dashboard,{id:v.id.toString(),dashboard:v,placement:Le.l.InternalMetrics})):null,e.a.createElement(U.a.Panel,{header:"PostgreSQL - currently running queries",key:"1"},e.a.createElement("div",{className:"mb-4 float-right"},e.a.createElement(Ce.a,{checked:g,onChange:function(E){f(E.target.checked)}},"Show idle queries"),e.a.createElement(w.a,{style:{marginLeft:8},onClick:S},e.a.createElement(H.a,null)," Reload Queries")),e.a.createElement(W,{queries:p,loading:o})),(n==null?void 0:n.clickhouse_running)!=null?e.a.createElement(U.a.Panel,{header:"Clickhouse - currently running queries",key:"2"},e.a.createElement("div",{className:"mb-4 float-right"},e.a.createElement(w.a,{style:{marginLeft:8},onClick:S},e.a.createElement(H.a,null)," Reload Queries")),e.a.createElement(W,{queries:n==null?void 0:n.clickhouse_running,loading:o,showAnalyze:i})):null,(n==null?void 0:n.clickhouse_slow_log)!=null?e.a.createElement(U.a.Panel,{header:"Clickhouse - slow query log (past 6 hours)",key:"3"},e.a.createElement("div",{className:"mb-4 float-right"},e.a.createElement(w.a,{style:{marginLeft:8},onClick:S},e.a.createElement(H.a,null)," Reload Queries")),e.a.createElement(W,{queries:n==null?void 0:n.clickhouse_slow_log,loading:o,showAnalyze:i})):null),e.a.createElement(Te,null))}function W(t){var s=Object(h.useActions)(y.b),r=s.openAnalyzeModalWithQuery,n=[{title:"duration",dataIndex:"duration",key:"duration",sorter:function(i,u){return+i.duration-+u.duration}},{title:"query",dataIndex:"query",render:function(i,u){return je()(i),t.showAnalyze?e.a.createElement(te.a,{to:"#",onClick:function(){return r(u.query)}},u.query):u.query},key:"query"}];return t.queries&&t.queries.length>0&&Object.keys(t.queries[0]).forEach(function(o){o!=="duration"&&o!=="query"&&n.push({title:o,dataIndex:o,key:o})}),e.a.createElement(Ie.a,{dataSource:t.queries||[],columns:n,loading:t.loading,pagination:{pageSize:30,hideOnSinglePage:!0},size:"small",bordered:!0,style:{overflowX:"auto",overflowY:"auto"},locale:{emptyText:"No queries found"}})}var mt=a("./node_modules/core-js/modules/es.symbol.js"),ft=a("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),gt=a("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),xe=a("./node_modules/@babel/runtime/helpers/defineProperty.js"),ke=a.n(xe),G=a("./frontend/src/lib/components/LemonTable/index.ts"),Ve=a("./frontend/src/lib/hooks/useKeyboardHotkeys.tsx");function P(t){var s=t.key,r=t.value,n=t.value_type,o=t.onValueChanged,i=t.isSecret;if(n==="bool")return e.a.createElement(b.LemonCheckbox,{defaultChecked:!!r,onChange:function(c){return o(s,c)},label:e.a.createElement(A.a,{type:r?"success":"danger",className:"uppercase"},r?"Yes":"No")});var u=i&&r?"":r;return e.a.createElement(b.LemonInput,{defaultValue:u,type:n==="int"?"number":"text",placeholder:i&&r?"Keep existing secret value":void 0,onBlur:function(c){return o(s,c.target.value)}})}try{P.displayName="RenderMetricValueEdit",P.__docgenInfo={description:"",displayName:"RenderMetricValueEdit",props:{onValueChanged:{defaultValue:null,description:"",name:"onValueChanged",required:!0,type:{name:"(key: string, value: any) => void"}},key:{defaultValue:null,description:"",name:"key",required:!0,type:{name:"string"}},value:{defaultValue:null,description:"",name:"value",required:!1,type:{name:"string | number | boolean | null"}},value_type:{defaultValue:null,description:"",name:"value_type",required:!1,type:{name:"enum",value:[{value:'"bool"'},{value:'"str"'},{value:'"int"'}]}},emptyNullLabel:{defaultValue:null,description:"",name:"emptyNullLabel",required:!1,type:{name:"string"}},isSecret:{defaultValue:null,description:"",name:"isSecret",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"]={docgenInfo:P.__docgenInfo,name:"RenderMetricValueEdit",path:"frontend/src/scenes/instance/SystemStatus/RenderMetricValueEdit.tsx#RenderMetricValueEdit"})}catch(t){}var vt=a("./node_modules/core-js/modules/es.array.find.js"),yt=a("./node_modules/core-js/modules/es.string.starts-with.js"),pt=a("./node_modules/core-js/modules/es.array.includes.js"),ht=a("./node_modules/core-js/modules/es.string.includes.js"),ae=a("./frontend/src/lib/components/AlertMessage/index.ts");function Ne(t){var s=t.metricKey,r=t.oldValue,n=t.value,o=t.isSecret;return(n==null?void 0:n.toString())===(r==null?void 0:r.toString())?null:e.a.createElement("div",{className:"bg-border-light radius p-2"},e.a.createElement("div",null,e.a.createElement("code",null,s)),e.a.createElement("div",{className:"text-muted"},"Value will be changed",!o&&e.a.createElement(e.a.Fragment,null," from ",e.a.createElement("span",{className:"font-bold text-default"},M(null,{key:s,value:r,emptyNullLabel:"Unset",isSecret:o})))," to ",e.a.createElement("span",{className:"font-bold text-default"},M(null,{key:s,value:n,emptyNullLabel:"Unset"})),o&&e.a.createElement("div",{className:"text-danger"},"This field is secret - you won't see its value once saved")))}function R(t){var s=t.onClose,r=t.isOpen,n=Object(h.useValues)(y.b),o=n.instanceConfigEditingState,i=n.editableInstanceSettings,u=n.updatedInstanceConfigCount,m=Object(h.useActions)(y.b),c=m.saveInstanceConfig,l=u!==null;return e.a.createElement(b.LemonModal,{title:"Confirm new changes",isOpen:r,closable:!l,onClose:s,footer:e.a.createElement(e.a.Fragment,null,e.a.createElement(b.LemonButton,{type:"secondary",onClick:s,loading:l},"Cancel"),e.a.createElement(b.LemonButton,{type:"primary",status:"danger",loading:l,onClick:c},"Apply changes"))},e.a.createElement("div",{className:"space-y-2"},Object.keys(o).find(function(d){return d.startsWith("EMAIL")})&&e.a.createElement(ae.a,{type:"info"},e.a.createElement(e.a.Fragment,null,"As you are changing email settings, we'll attempt to send a ",e.a.createElement("b",null,"test email")," so you can verify everything works (unless you are turning email off).")),Object.keys(o).includes("RECORDINGS_TTL_WEEKS")&&e.a.createElement(ae.a,{type:"warning"},e.a.createElement(e.a.Fragment,null,"Changing your recordings TTL requires ClickHouse to have enough free space to perform the operation (even when reducing this value). In addition, please mind that removing old recordings will be removed asynchronously, not immediately.")),e.a.createElement("div",null,"The following changes will be immediately applied to your instance."),Object.keys(o).map(function(d){var g,f;return e.a.createElement(Ne,{key:d,metricKey:d,value:o[d],oldValue:(g=i.find(function(p){return p.key===d}))===null||g===void 0?void 0:g.value,isSecret:(f=i.find(function(p){return p.key===d}))===null||f===void 0?void 0:f.is_secret})}),l&&e.a.createElement("div",{className:"mt-4 text-success"},e.a.createElement("b",null,Object(Y.sb)(u||0,"change")," updated successfully."))))}try{R.displayName="InstanceConfigSaveModal",R.__docgenInfo={description:"",displayName:"InstanceConfigSaveModal",props:{onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"]={docgenInfo:R.__docgenInfo,name:"InstanceConfigSaveModal",path:"frontend/src/scenes/instance/SystemStatus/InstanceConfigSaveModal.tsx#InstanceConfigSaveModal"})}catch(t){}function se(t,s){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);s&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function re(t){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?se(Object(r),!0).forEach(function(n){ke()(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Me(){var t=Object(h.useValues)(ee.a),s=t.configOptions,r=t.preflightLoading,n=Object(h.useValues)(y.b),o=n.editableInstanceSettings,i=n.instanceSettingsLoading,u=n.instanceConfigMode,m=n.instanceConfigEditingState,c=Object(h.useActions)(y.b),l=c.loadInstanceSettings,d=c.setInstanceConfigMode,g=c.updateInstanceConfigValue,f=c.clearInstanceConfigEditing;Object(Ve.a)({e:{action:function(){return d(y.a.Edit)},disabled:u!==y.a.View||i},escape:{action:function(){return v()},disabled:u!==y.a.Edit||i},enter:{action:function(){return p()},disabled:u!==y.a.Edit||i}});var p=function(){Object.keys(m).length?d(y.a.Saving):d(y.a.View)},v=function(){d(y.a.View),f()};Object(N.useEffect)(function(){l()},[]);var S=[{title:"Key",dataIndex:"key",render:function(V){return e.a.createElement("code",null,V)}},{title:"Description",dataIndex:"description"},{title:"Value",render:function(V,T){var Z,fe={value:T.value,key:T.key,emptyNullLabel:"Unset",value_type:T.value_type,isSecret:T.is_secret};return u===y.a.View?M(V,fe):P(re(re({},fe),{},{value:(Z=m[T.key])!==null&&Z!==void 0?Z:T.value,onValueChanged:g}))}}],j=[{key:"metric",title:"Metric",dataIndex:"metric"},{title:"Value",dataIndex:"value"}];return e.a.createElement(e.a.Fragment,null,e.a.createElement("div",{className:"flex items-center gap-2 mb-4"},e.a.createElement("div",{className:"flex-1"},e.a.createElement("h3",null,"Instance configuration"),e.a.createElement("div",null,"Changing these settings will take effect on your entire instance."," ",e.a.createElement("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings",target:"_blank"},"Learn more ",e.a.createElement(C.IconOpenInNew,{style:{verticalAlign:"middle"}})),".")),u===y.a.View?e.a.createElement(e.a.Fragment,null,e.a.createElement(b.LemonButton,{type:"primary",onClick:function(){return d(y.a.Edit)},"data-attr":"instance-config-edit-button",disabled:i},"Edit")):e.a.createElement(e.a.Fragment,null,Object.keys(m).length>0&&e.a.createElement("span",{className:"text-warning-dark flex items-center gap-2"},e.a.createElement(C.IconWarning,{className:"text-lg"})," You have"," ",e.a.createElement("b",null,Object.keys(m).length)," unapplied"," ",Object(Y.sb)(Object.keys(m).length,"change",void 0,!1)),e.a.createElement(b.LemonButton,{type:"secondary",disabled:i,onClick:v},"Discard changes"),e.a.createElement(b.LemonButton,{type:"primary",disabled:i,onClick:p},"Save"))),e.a.createElement(G.a,{dataSource:o,columns:S,loading:i,rowKey:"key"}),e.a.createElement("div",{className:"my-4"},e.a.createElement("h3",null,"Environment configuration"),e.a.createElement("div",null,"These settings can only be modified by environment variables."," ",e.a.createElement("a",{href:"https://posthog.com/docs/self-host/configure/environment-variables",target:"_blank"},"Learn more ",e.a.createElement(C.IconOpenInNew,{style:{verticalAlign:"middle"}})),".")),e.a.createElement(G.a,{dataSource:s,columns:j,loading:r,rowKey:"key"}),e.a.createElement(R,{isOpen:u===y.a.Saving,onClose:function(){return d(y.a.Edit)}}))}var B=a("./frontend/src/scenes/userLogic.ts"),we=a("./node_modules/antd/es/modal/index.js"),le=a("./node_modules/antd/es/divider/index.js"),Pe=a("./frontend/src/lib/components/ProfilePicture/index.ts"),Re=a("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),J=a.n(Re),Be=a("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),x=a.n(Be),Ke=a("./node_modules/@babel/runtime/regenerator/index.js"),O=a.n(Ke),Et=a("./node_modules/core-js/modules/es.promise.js"),bt=a("./node_modules/core-js/modules/es.array.concat.js"),St=a("./node_modules/core-js/modules/es.array.sort.js"),jt=a("./node_modules/core-js/modules/es.array.slice.js"),Ot=a("./node_modules/core-js/modules/es.function.name.js"),Ct=a("./node_modules/core-js/modules/es.array.from.js"),It=a("./node_modules/core-js/modules/es.regexp.exec.js"),At=a("./node_modules/core-js/modules/es.symbol.description.js"),Lt=a("./node_modules/core-js/modules/es.symbol.iterator.js"),ze=a("./node_modules/kea-router/lib/index.js"),K=a("./frontend/src/lib/api.ts"),Fe=a("./frontend/src/scenes/urls.ts");function Qe(t,s){var r=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=De(t))||s&&t&&typeof t.length=="number"){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(l){throw l},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,u=!1,m;return{s:function(){r=r.call(t)},n:function(){var l=r.next();return i=l.done,l},e:function(l){u=!0,m=l},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(u)throw m}}}}function De(t,s){if(!!t){if(typeof t=="string")return oe(t,s);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oe(t,s)}}function oe(t,s){(s==null||s>t.length)&&(s=t.length);for(var r=0,n=new Array(s);r<s;r++)n[r]=t[r];return n}var ie=Object(h.kea)({path:["scenes","instance","SystemStatus","staffUsersLogic"],connect:{values:[B.a,["user"]],actions:[B.a,["loadUser"]]},actions:{setStaffUsersToBeAdded:function(s){return{userUuids:s}},addStaffUsers:!0,deleteStaffUser:function(s){return{userUuid:s}}},reducers:{staffUsersToBeAdded:[[],{setStaffUsersToBeAdded:function(s,r){var n=r.userUuids;return n}}]},loaders:function(s){var r=s.actions,n=s.values;return{allUsers:[[],{loadAllUsers:function(){var o=x()(O.a.mark(function u(){var m;return O.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,K.b.get("api/users");case 2:if(l.t1=m=l.sent.results,l.t0=l.t1!==null,!l.t0){l.next=6;break}l.t0=m!==void 0;case 6:if(!l.t0){l.next=10;break}l.t2=m,l.next=11;break;case 10:l.t2=[];case 11:return l.abrupt("return",l.t2);case 12:case"end":return l.stop()}},u)}));function i(){return o.apply(this,arguments)}return i}(),addStaffUsers:function(){var o=x()(O.a.mark(function u(){var m,c,l,d;return O.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return m=n.staffUsersToBeAdded,c=n.allUsers,r.setStaffUsersToBeAdded([]),f.next=4,Promise.all(m.map(function(){var p=x()(O.a.mark(function v(S){return O.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,K.b.update("api/users/".concat(S),{is_staff:!0});case 2:return E.abrupt("return",E.sent);case 3:case"end":return E.stop()}},v)}));return function(v){return p.apply(this,arguments)}}()));case 4:return l=f.sent,d=[].concat(J()(c.filter(function(p){var v=p.uuid;return!m.includes(v)})),J()(l)),d.sort(function(p,v){return p.first_name.localeCompare(v.first_name)}),f.abrupt("return",d);case 8:case"end":return f.stop()}},u)}));function i(){return o.apply(this,arguments)}return i}(),deleteStaffUser:function(){var o=x()(O.a.mark(function u(m){var c,l,d,g,f,p;return O.a.wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return l=m.userUuid,S.next=3,K.b.update("api/users/".concat(l),{is_staff:!1});case 3:((c=n.user)===null||c===void 0?void 0:c.uuid)===l&&(r.loadUser(),ze.router.actions.push(Fe.a.projectHomepage())),d=J()(n.allUsers),g=Qe(d);try{for(g.s();!(f=g.n()).done;)p=f.value,p.uuid===l&&(p.is_staff=!1)}catch(j){g.e(j)}finally{g.f()}return S.abrupt("return",d);case 8:case"end":return S.stop()}},u)}));function i(u){return o.apply(this,arguments)}return i}()}]}},selectors:{staffUsers:[function(t){return[t.allUsers]},function(t){return t.filter(function(s){return s.is_staff})}],nonStaffUsers:[function(t){return[t.allUsers]},function(t){return t.filter(function(s){return!s.is_staff})}]},events:function(s){var r=s.actions;return{afterMount:[r.loadAllUsers]}}}),ue=a("./frontend/src/lib/components/LemonButton/index.ts"),Ye=a("./frontend/src/lib/components/LemonSelectMultiple/LemonSelectMultiple.tsx"),$e=a("./frontend/src/lib/components/UserSelectItem.tsx");function He(){var t=Object(h.useValues)(B.a),s=t.user,r=Object(h.useValues)(ie),n=r.staffUsers,o=r.allUsersLoading,i=r.nonStaffUsers,u=r.staffUsersToBeAdded,m=Object(h.useActions)(ie),c=m.setStaffUsersToBeAdded,l=m.addStaffUsers,d=m.deleteStaffUser,g=[{key:"profile_picture",render:function(p,v){return e.a.createElement(Pe.b,{name:v.first_name,email:v.email})},width:32},{key:"name",title:"Name",dataIndex:"first_name",render:function(p,v){return e.a.createElement(e.a.Fragment,null,v.first_name,v.uuid===(s==null?void 0:s.uuid)&&e.a.createElement(A.a,{className:"uppercase ml-1"},"Me"))}},{key:"email",title:"Email",dataIndex:"email"},{key:"actions",width:32,render:function(p,v){return e.a.createElement(ue.a,{"data-attr":"invite-delete",icon:e.a.createElement(C.IconDelete,null),status:"danger",disabled:n.length<2,title:n.length<2?"You should always have at least one staff user.":"Cancel the invite",onClick:function(){we.a.confirm({title:"Remove ".concat((s==null?void 0:s.uuid)===v.uuid?"yourself":v.first_name," as a Staff User?"),icon:null,okText:"Remove user",okType:"primary",okButtonProps:{className:"btn-danger"},content:e.a.createElement("div",{style:{border:""}},(s==null?void 0:s.uuid)===v.uuid?e.a.createElement(e.a.Fragment,null,"Please confirm you want to ",e.a.createElement("b",null,"remove yourself")," as a staff user.",e.a.createElement("div",{style:{fontWeight:"normal",color:"var(--muted-alt)"}},"Only another staff user will be able to add you again.")):"Are you sure you want to remove ".concat(v.first_name," as a Staff User?")),onOk:function(){d(v.uuid)},cancelText:"Cancel"})}})}}];return e.a.createElement("div",null,e.a.createElement("h3",{className:"l3",style:{marginTop:16}},"Staff Users"),e.a.createElement("div",{className:"mb-4"},"Users who have permissions to manage instance-wide settings. Staff user permissions are set at the"," ",e.a.createElement("b",null,"instance-level and are independent of any organization or project permissions.")," ",e.a.createElement("a",{href:"https://posthog.com/docs/self-host/configure/instance-settings#staff-users",target:"_blank"},"Learn more ",e.a.createElement(C.IconOpenInNew,{style:{verticalAlign:"middle"}})),"."),e.a.createElement(le.a,{style:{margin:0,marginBottom:16}}),e.a.createElement("section",null,e.a.createElement("div",{className:"flex gap-2 mb-4"},e.a.createElement("div",{style:{flex:1}},e.a.createElement(Ye.a,{placeholder:"Add staff users here\u2026",loading:o,value:u,onChange:function(p){return c(p)},filterOption:!0,mode:"multiple","data-attr":"subscribed-emails",options:Object($e.a)(i,"uuid")})),e.a.createElement(ue.a,{type:"primary",loading:o,disabled:u.length===0,onClick:l},"Add"))),e.a.createElement(G.a,{dataSource:n,columns:g,loading:o,rowKey:"uuid"}))}var We=a("./frontend/src/lib/logic/featureFlagLogic.ts"),Ge=a("./frontend/src/lib/constants.tsx"),Je=a("./node_modules/antd/es/row/index.js"),z=a("./node_modules/antd/es/col/index.js"),ce=a("./frontend/src/scenes/ingestion/frameworks/CodeSnippet.tsx"),Tt=a("./node_modules/core-js/modules/es.number.constructor.js"),k=a("./node_modules/kea-forms/lib/index.js"),Xe=a("./node_modules/kea-loaders/lib/index.js"),de=Object(h.kea)([Object(h.path)(["scenes","instance","SystemStatus","kafkaInspectorLogic"]),Object(h.actions)({fetchKafkaMessage:function(s,r,n){return{topic:s,partition:r,offset:n}}}),Object(Xe.loaders)({kafkaMessage:[null,{fetchKafkaMessage:function(){var t=x()(O.a.mark(function r(n){var o,i,u;return O.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=n.topic,i=n.partition,u=n.offset,c.next=3,K.b.create("api/kafka_inspector/fetch_message",{topic:o,partition:i,offset:u});case 3:return c.abrupt("return",c.sent);case 4:case"end":return c.stop()}},r)}));function s(r){return t.apply(this,arguments)}return s}()}]}),Object(k.forms)(function(t){var s=t.actions;return{fetchKafkaMessage:{defaults:{topic:"clickhouse_events_json",partition:0,offset:0},submit:function(n){var o=n.topic,i=n.partition,u=n.offset;s.fetchKafkaMessage(o,Number(i),Number(u))}}}})]),X=a("./frontend/src/lib/components/LemonInput/LemonInput.tsx");function Ze(){var t=Object(h.useValues)(de),s=t.kafkaMessage;return e.a.createElement("div",null,e.a.createElement("h3",{className:"l3",style:{marginTop:16}},"Kafka Inspector"),e.a.createElement("div",{className:"mb-4"},"Debug Kafka messages using the inspector tool."),e.a.createElement(le.a,{style:{margin:0,marginBottom:16}}),e.a.createElement("section",null,e.a.createElement("div",{style:{display:"flex",marginBottom:"0.75rem"}},e.a.createElement(k.Form,{logic:de,formKey:"fetchKafkaMessage",className:"ant-form-horizontal ant-form-hide-required-mark",enableFormOnSubmit:!0},e.a.createElement(Je.a,{gutter:[24,24]},e.a.createElement(z.a,{span:8},e.a.createElement(k.Field,{name:"topic"},e.a.createElement(X.a,{placeholder:"Topic"}))),e.a.createElement(z.a,{span:4},e.a.createElement(k.Field,{name:"partition"},e.a.createElement(X.a,{placeholder:"Partition",type:"number"}))," "),e.a.createElement(z.a,{span:4},e.a.createElement(k.Field,{name:"offset"},e.a.createElement(X.a,{placeholder:"Offset",type:"number"}))," "),e.a.createElement(z.a,{span:6},e.a.createElement(w.a,{htmlType:"submit",type:"primary","data-attr":"fetch-kafka-message-submit-button"},"Fetch message"," ")))))),e.a.createElement(ce.a,{language:ce.b.JSON},s?JSON.stringify(s,null,4):`
`))}var qe={component:me,logic:y.b};function me(){var t=Object(h.useValues)(y.b),s=t.tab,r=t.error,n=Object(h.useActions)(y.b),o=n.setTab,i=Object(h.useValues)(ee.a),u=i.preflight,m=i.siteUrlMisconfigured,c=Object(h.useValues)(B.a),l=c.user,d=Object(h.useValues)(We.a),g=d.featureFlags;return e.a.createElement("div",{className:"system-status-scene"},e.a.createElement(ye.a,{title:"Instance status & settings",caption:e.a.createElement(e.a.Fragment,null,"Here you can find all the critical runtime details and settings of your PostHog instance. You have access to this because you're a ",e.a.createElement("b",null,"staff user"),"."," ",e.a.createElement("a",{target:"_blank",style:{display:"inline-flex",alignItems:"center"},href:"https://posthog.com/docs/self-host/configure/instance-settings?utm_medium=in-product&utm_campaign=instance_status"},"Learn more ",e.a.createElement(C.IconOpenInNew,{style:{marginLeft:4}})),".")}),r&&e.a.createElement(_.a,{message:"Something went wrong",description:r||e.a.createElement("span",null,"An unknown error occurred. Please try again or contact us."),type:"error",showIcon:!0}),m&&e.a.createElement(_.a,{message:"Misconfiguration detected",description:e.a.createElement(e.a.Fragment,null,"Your ",e.a.createElement("code",null,"SITE_URL")," environment variable seems misconfigured. Your"," ",e.a.createElement("code",null,"SITE_URL")," is set to"," ",e.a.createElement("b",null,e.a.createElement("code",null,u==null?void 0:u.site_url))," ","but you're currently browsing this page from"," ",e.a.createElement("b",null,e.a.createElement("code",null,window.location.origin)),". In order for PostHog to work properly, please set this to the origin where your instance is hosted."," ",e.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/configuring-posthog/environment-variables?utm_medium=in-product&utm_campaign=system-status-site-url-misconfig"},"Learn more ",e.a.createElement(C.IconOpenInNew,null))),showIcon:!0,type:"warning",style:{marginBottom:32}}),e.a.createElement(L.a,{tabPosition:"top",animated:!1,activeKey:s,onTabClick:function(p){return o(p)}},e.a.createElement(L.a.TabPane,{tab:"System overview",key:"overview"},e.a.createElement(Ee,null)),(l==null?void 0:l.is_staff)&&e.a.createElement(e.a.Fragment,null,e.a.createElement(L.a.TabPane,{tab:"Internal metrics",key:"metrics"},e.a.createElement(Ue,null)),e.a.createElement(L.a.TabPane,{tab:e.a.createElement(e.a.Fragment,null,"Settings"," ",e.a.createElement(A.a,{type:"warning",className:"uppercase"},"Beta")),key:"settings"},e.a.createElement(Me,null))),(l==null?void 0:l.is_staff)&&e.a.createElement(L.a.TabPane,{tab:e.a.createElement(e.a.Fragment,null,"Staff Users"),key:"staff_users"},e.a.createElement(He,null)),(l==null?void 0:l.is_staff)&&g[Ge.i.KAFKA_INSPECTOR]&&e.a.createElement(L.a.TabPane,{tab:e.a.createElement(e.a.Fragment,null,"Kafka Inspector"," ",e.a.createElement(A.a,{type:"warning",className:"uppercase"},"Beta")),key:"kafka_inspector"},e.a.createElement(Ze,null))))}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/instance/SystemStatus/index.scss":function(F,I,a){var Q=a("./node_modules/css-loader/dist/runtime/api.js");I=Q(!1),I.push([F.i,".system-status-scene{margin-bottom:64px}@media(min-width:750px){.system-status-scene .metric-column{width:33%}}.embedded-svg-wrapper{cursor:text}.embedded-svg-wrapper svg{width:100%;height:100%}",""]),F.exports=I}}]);
