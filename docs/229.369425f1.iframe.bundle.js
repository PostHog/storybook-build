(window.webpackJsonp=window.webpackJsonp||[]).push([[229,240],{"./frontend/src/lib/components/LemonSelect.tsx":function(oe,E,e){"use strict";e.d(E,"a",function(){return R});var P=e("./node_modules/@babel/runtime/helpers/extends.js"),r=e.n(P),D=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),v=e.n(D),F=e("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),se=e.n(F),Q=e("./node_modules/core-js/modules/es.array.map.js"),M=e.n(Q),S=e("./node_modules/core-js/modules/es.object.entries.js"),ue=e.n(S),h=e("./node_modules/react/index.js"),V=e.n(h),Z=e("./frontend/src/lib/components/icons.tsx"),_=e("./frontend/src/lib/components/LemonButton/index.ts"),Y=["value","onChange","options","placeholder","dropdownMatchSelectWidth","allowClear"];function R(t){var c,K,w=t.value,d=t.onChange,l=t.options,m=t.placeholder,i=t.dropdownMatchSelectWidth,O=i===void 0?!0:i,k=t.allowClear,ae=k===void 0?!1:k,q=se()(t,Y),pe=Object(h.useState)(w),B=v()(pe,2),$=B[0],le=B[1],C=Object(h.useState)(!1),j=v()(C,2),re=j[0],ie=j[1],J=ae&&re&&!!$;return Object(h.useEffect)(function(){q.loading||le(w)},[w,q.loading]),V.a.createElement("div",{className:"LemonButtonWithSideAction",onMouseEnter:function(){return ie(!0)},onMouseLeave:function(){return ie(!1)}},V.a.createElement(_.b,r()({popup:{overlay:Object.entries(l).map(function(X){var W=v()(X,2),b=W[0],U=W[1];return V.a.createElement(_.a,{key:b,icon:U.icon,onClick:function(){b!=$&&(d(b),le(b))},type:b==$?"highlighted":"stealth",disabled:U.disabled,fullWidth:!0,"data-attr":U["data-attr"]},U.label||b)}),sameWidth:O,actionable:!0},icon:$&&((c=l[$])===null||c===void 0?void 0:c.icon),sideIcon:J?V.a.createElement("div",null):void 0},q),$&&(((K=l[$])===null||K===void 0?void 0:K.label)||$)||V.a.createElement("span",{className:"text-muted"},m)),J&&V.a.createElement(_.a,{className:"side-button",type:"tertiary",icon:V.a.createElement(Z.IconClose,{style:{fontSize:"1rem"}}),tooltip:"Clear selection",onClick:function(){d(null),le(null)}}))}try{R.displayName="LemonSelect",R.__docgenInfo={description:"",displayName:"LemonSelect",props:{options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"LemonSelectOptions"}},value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"string | number | symbol | null"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(newValue: keyof O | null) => void"}},dropdownMatchSelectWidth:{defaultValue:{value:"true"},description:"",name:"dropdownMatchSelectWidth",required:!1,type:{name:"boolean"}},allowClear:{defaultValue:{value:"false"},description:"",name:"allowClear",required:!1,type:{name:"boolean"}},type:{defaultValue:null,description:"",name:"type",required:!1,type:{name:"enum",value:[{value:'"default"'},{value:'"primary"'},{value:'"secondary"'},{value:'"tertiary"'},{value:'"stealth"'},{value:'"highlighted"'},{value:'"primary-alt"'}]}},ref:{defaultValue:null,description:"",name:"ref",required:!1,type:{name:"Ref<HTMLButtonElement>"}},size:{defaultValue:null,description:"Variation on sizes - default is medium. Small looks better inline with text. Large is a chunkier row.",name:"size",required:!1,type:{name:"enum",value:[{value:'"small"'},{value:'"medium"'},{value:'"large"'}]}},relaxedIconWidth:{defaultValue:null,description:"If icon width is relaxed, width of icon box is set to auto. Default icon width is 1em",name:"relaxedIconWidth",required:!1,type:{name:"boolean"}},status:{defaultValue:null,description:"",name:"status",required:!1,type:{name:"enum",value:[{value:'"warning"'},{value:'"danger"'},{value:'"success"'},{value:'"muted"'},{value:'"highlighted"'}]}},extendedContent:{defaultValue:null,description:"Extended content, e.g. a description, to show in the lower button area.",name:"extendedContent",required:!1,type:{name:"ReactNode"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},tooltip:{defaultValue:null,description:"Tooltip to display on hover.",name:"tooltip",required:!1,type:{name:"any"}},fullWidth:{defaultValue:null,description:"Whether the row should take up the parent's full width.",name:"fullWidth",required:!1,type:{name:"boolean"}},center:{defaultValue:null,description:"Whether the row's contents should be centered.",name:"center",required:!1,type:{name:"boolean"}},outlined:{defaultValue:null,description:"Whether the element should be outlined with a standard border.",name:"outlined",required:!1,type:{name:"any"}},"data-attr":{defaultValue:null,description:"",name:"data-attr",required:!1,type:{name:"string"}},sideIcon:{defaultValue:null,description:"",name:"sideIcon",required:!1,type:{name:"ReactElement<any, string | JSXElementConstructor<any>> | null"}},htmlType:{defaultValue:null,description:"",name:"htmlType",required:!1,type:{name:"string"}},translucent:{defaultValue:null,description:"Whether the button should have transparent background in its base state (i.e. non-hover).",name:"translucent",required:!1,type:{name:"boolean"}},active:{defaultValue:null,description:"Whether hover style should be applied, signaling that the button is held active in some way.",name:"active",required:!1,type:{name:"boolean"}},to:{defaultValue:null,description:"URL to link to.",name:"to",required:!1,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/components/LemonSelect.tsx#LemonSelect"]={docgenInfo:R.__docgenInfo,name:"LemonSelect",path:"frontend/src/lib/components/LemonSelect.tsx#LemonSelect"})}catch(t){}},"./frontend/src/lib/forms/Field.tsx":function(oe,E,e){"use strict";e.d(E,"a",function(){return Z});var P=e("./node_modules/@babel/runtime/helpers/extends.js"),r=e.n(P),D=e("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),v=e.n(D),F=e("./node_modules/core-js/modules/es.function.name.js"),se=e.n(F),Q=e("./node_modules/clsx/dist/clsx.m.js"),M=e("./node_modules/kea-forms/lib/components.js"),S=e.n(M),ue=e("./node_modules/react/index.js"),h=e.n(ue),V=["showOptional","name"],Z=function(Y){var R=Y.showOptional,t=Y.name,c=v()(Y,V),K=function(d){var l=d.label,m=d.kids,i=d.hint,O=d.error;return h.a.createElement("div",{className:Object(Q.a)("ant-row","ant-form-item",i||O?"ant-form-item-with-help":"",O?"ant-form-item-has-error":"")},l?h.a.createElement("div",{className:"ant-col ant-form-item-label"},h.a.createElement("label",{htmlFor:String(t),title:typeof l=="string"?l:void 0},R?h.a.createElement(h.a.Fragment,null,l,R?h.a.createElement("span",{className:"ant-form-item-optional",title:""},"(optional)"):null):l)):null,h.a.createElement("div",{className:"ant-col ant-form-item-control"},h.a.createElement("div",{className:"ant-form-item-control-input"},h.a.createElement("div",{className:"ant-form-item-control-input-content"},m)),i||O?h.a.createElement("div",{className:"ant-form-item-explain ant-form-item-explain-connected"},O?h.a.createElement("div",{role:"alert",className:"ant-form-item-explain-error"},"Error: ",O):null,i?h.a.createElement("div",{role:"alert",className:"ant-form-item-explain-warning"},"Hint: ",i):null):null))};return h.a.createElement(M.Field,r()({},c,{name:t,template:K}))};try{Z.displayName="Field",Z.__docgenInfo={description:"Compatible replacement for Form.Item",displayName:"Field",props:{showOptional:{defaultValue:null,description:"",name:"showOptional",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/forms/Field.tsx#Field"]={docgenInfo:Z.__docgenInfo,name:"Field",path:"frontend/src/lib/forms/Field.tsx#Field"})}catch(_){}},"./frontend/src/lib/forms/VerticalForm.tsx":function(oe,E,e){"use strict";e.d(E,"a",function(){return M});var P=e("./node_modules/@babel/runtime/helpers/extends.js"),r=e.n(P),D=e("./node_modules/react/index.js"),v=e.n(D),F=e("./node_modules/kea-forms/lib/index.js"),se=e.n(F),Q=e("./node_modules/clsx/dist/clsx.m.js");function M(S){return v.a.createElement(F.Form,r()({},S,{className:Object(Q.a)("antd-form ant-form-vertical",S.className)}),S.children)}try{M.displayName="VerticalForm",M.__docgenInfo={description:"",displayName:"VerticalForm",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/lib/forms/VerticalForm.tsx#VerticalForm"]={docgenInfo:M.__docgenInfo,name:"VerticalForm",path:"frontend/src/lib/forms/VerticalForm.tsx#VerticalForm"})}catch(S){}},"./frontend/src/scenes/cohorts/Cohort.tsx":function(oe,E,e){"use strict";e.r(E),e.d(E,"scene",function(){return Ne}),e.d(E,"Cohort",function(){return ge});var P=e("./node_modules/core-js/modules/es.object.keys.js"),r=e("./node_modules/core-js/modules/es.symbol.js"),D=e("./node_modules/core-js/modules/es.object.get-own-property-descriptor.js"),v=e("./node_modules/core-js/modules/web.dom-collections.for-each.js"),F=e("./node_modules/core-js/modules/es.object.get-own-property-descriptors.js"),se=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),Q=e.n(se),M=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),S=e.n(M),ue=e("./node_modules/core-js/modules/es.array.concat.js"),h=e("./node_modules/core-js/modules/es.object.to-string.js"),V=e("./node_modules/core-js/modules/es.regexp.to-string.js"),Z=e("./node_modules/core-js/modules/es.array.filter.js"),_=e("./node_modules/core-js/modules/es.function.name.js"),Y=e("./node_modules/core-js/modules/es.array.map.js"),R=e("./node_modules/react/index.js"),t=e.n(R),c=e("./node_modules/kea/lib/index.esm.js"),K=e("./node_modules/kea-forms/lib/index.js"),w=e("./node_modules/antd/es/divider/index.js"),d=e("./node_modules/antd/es/row/index.js"),l=e("./node_modules/antd/es/col/index.js"),m=e("./frontend/src/types.ts"),i=e("./frontend/src/lib/constants.tsx"),O=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),k=e("./node_modules/antd/lib/upload/Dragger.js"),ae=e.n(k),q=e("./frontend/src/scenes/persons/Persons.tsx"),pe=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),B=e.n(pe),$=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),le=e.n($),C=e("./node_modules/@babel/runtime/regenerator/index.js"),j=e.n(C),re=e("./node_modules/core-js/modules/es.symbol.description.js"),ie=e("./node_modules/core-js/modules/es.object.entries.js"),J=e("./node_modules/core-js/modules/es.array.find-index.js"),X=e("./node_modules/core-js/modules/es.array.iterator.js"),W=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),b=e("./frontend/src/lib/api.ts"),U=e("./frontend/src/models/cohortsModel.ts"),ce=e("./frontend/src/lib/utils.tsx"),ne=e("./frontend/src/scenes/persons/personsLogic.ts"),N=e("./frontend/src/lib/components/lemonToast.tsx"),G=e("./frontend/src/scenes/urls.ts"),fe=e("./node_modules/kea-router/lib/index.js"),he=e("./node_modules/kea-loaders/lib/index.js");function Se(n,o){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);o&&(s=s.filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable})),a.push.apply(a,s)}return a}function z(n){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?Se(Object(a),!0).forEach(function(s){S()(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Se(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function De(n){for(var o=z(z(z(z(z({},n.name?{name:n.name}:{}),n.description?{description:n.description}:{}),n.csv?{csv:n.csv}:{}),n.is_static?{is_static:n.is_static}:{}),{},{groups:JSON.stringify(n.is_static?[]:n.groups.map(function(x){return z(z({},x),{},{id:void 0,matchType:void 0})}))}),a=new FormData,s=0,g=Object.entries(o);s<g.length;s++){var T=le()(g[s],2),y=T[0],L=T[1];a.append(y,L)}return a}function Me(n){var o=n.action_id||n.event_id?i.f:i.p;return z({matchType:o,id:Math.random().toString().substr(2,5)},n)}function Ee(n){return n.groups&&(n.groups=n.groups.map(function(o){return Me(o)}),n.groups=n.groups.map(function(o){return o.properties?z(z({},o),{},{properties:Object(ce.r)(o.properties)}):o})),n}var ye=Ee({id:"new",groups:[{id:Math.random().toString().substr(2,5),matchType:i.p,properties:[]}]}),je=Object(c.kea)([Object(c.props)({}),Object(c.key)(function(n){return n.id||"new"}),Object(c.path)(["scenes","cohorts","cohortLogic"]),Object(c.actions)({saveCohort:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return{cohortParams:o}},setCohort:function(o){return{cohort:o}},deleteCohort:!0,fetchCohort:function(o){return{id:o}},onCriteriaChange:function(o,a){return{newGroup:o,id:a}},setPollTimeout:function(o){return{pollTimeout:o}},checkIfFinishedCalculating:function(o){return{cohort:o}}}),Object(c.reducers)(function(){return{cohort:[ye,{onCriteriaChange:function(o,a){var s=a.newGroup,g=a.id,T=z({},o),y=T.groups.findIndex(function(L){return L.id===g});return s.matchType?T.groups[y]=z({id:T.groups[y].id,matchType:i.f},s):T.groups[y]=z(z({},T.groups[y]),s),Ee(T)}}],pollTimeout:[null,{setPollTimeout:function(o,a){var s=a.pollTimeout;return s}}]}}),Object(K.forms)(function(n){var o=n.actions;return{cohort:{defaults:ye,errors:function(s){var g=s.name,T=s.csv,y=s.is_static,L=s.groups;return{name:g?void 0:"You need to set a name",csv:y&&!T?"You need to upload a CSV file":null,groups:y?void 0:!L||L.length<1?[{id:"You need at least one matching group"}]:L==null?void 0:L.map(function(x){var u=x.matchType,p=x.properties,te=x.action_id,A=x.event_id;return u===i.p&&!(p!=null&&p.length)?{id:"Please select at least one property or remove this match group."}:u===i.f&&!(te||A)?{id:"Please select an event or action."}:{id:void 0}})}},submit:function(s){o.saveCohort(s)}}}}),Object(he.loaders)(function(n){var o=n.actions,a=n.values,s=n.key;return{cohort:[ye,{setCohort:function(T){var y=T.cohort;return Ee(y)},fetchCohort:function(){var g=B()(j.a.mark(function y(L,x){var u,p;return j.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return u=L.id,A.prev=1,A.next=4,b.b.cohorts.get(u);case 4:return p=A.sent,x(),U.a.actions.updateCohort(p),o.checkIfFinishedCalculating(p),A.abrupt("return",Ee(p));case 11:return A.prev=11,A.t0=A.catch(1),N.a.error(A.t0.detail||"Failed to fetch cohort"),A.abrupt("return",a.cohort);case 15:case"end":return A.stop()}},y,null,[[1,11]])}));function T(y,L){return g.apply(this,arguments)}return T}(),saveCohort:function(){var g=B()(j.a.mark(function y(L,x){var u,p,te;return j.a.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(u=L.cohortParams,p=z({},u),te=De(p),f.prev=3,p.id==="new"){f.next=11;break}return f.next=7,b.b.cohorts.update(p.id,te);case 7:p=f.sent,U.a.actions.updateCohort(p),f.next=15;break;case 11:return f.next=13,b.b.cohorts.create(te);case 13:p=f.sent,U.a.actions.cohortCreated(p);case 15:f.next=22;break;case 17:return f.prev=17,f.t0=f.catch(3),x(),N.a.error(f.t0.detail||"Failed to save cohort"),f.abrupt("return",a.cohort);case 22:return p.is_calculating=!0,x(),delete p.csv,o.setCohort(p),N.a.success("Cohort saved. Please wait up to a few minutes for it to be calculated",{toastId:"cohort-saved-".concat(s)}),o.checkIfFinishedCalculating(p),f.abrupt("return",p);case 29:case"end":return f.stop()}},y,null,[[3,17]])}));function T(y,L){return g.apply(this,arguments)}return T}()}]}}),Object(c.selectors)({breadcrumbs:[function(n){return[n.cohort]},function(n){return[{name:"Cohorts",path:G.a.cohorts()}].concat(Q()(n?[{name:n.name||"Untitled"}]:[]))}]}),Object(c.listeners)(function(n){var o=n.actions,a=n.values;return{deleteCohort:function(){var g;(g=U.a.findMounted())===null||g===void 0||g.actions.deleteCohort(a.cohort),fe.router.actions.push(G.a.cohorts())},checkIfFinishedCalculating:function(){var s=B()(j.a.mark(function T(y,L){var x,u;return j.a.wrap(function(te){for(;;)switch(te.prev=te.next){case 0:x=y.cohort,x.is_calculating?o.setPollTimeout(setTimeout(B()(j.a.mark(function A(){var f;return j.a.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return me.next=2,b.b.cohorts.get(x.id);case 2:f=me.sent,L(),o.checkIfFinishedCalculating(f);case 5:case"end":return me.stop()}},A)})),1e3)):(o.setCohort(x),U.a.actions.updateCohort(x),(u=ne.a.findMounted({syncWithUrl:!0}))===null||u===void 0||u.actions.loadCohorts(),a.pollTimeout&&(clearTimeout(a.pollTimeout),o.setPollTimeout(null)));case 2:case"end":return te.stop()}},T)}));function g(T,y){return s.apply(this,arguments)}return g}()}}),Object(fe.actionToUrl)(function(n){var o=n.values;return{saveCohortSuccess:function(){return G.a.cohort(o.cohort.id)}}}),Object(c.afterMount)(function(n){var o=n.actions,a=n.props;!a.id||a.id==="new"?o.setCohort(ye):o.fetchCohort(a.id)}),Object(c.beforeUnmount)(function(n){var o=n.values;o.pollTimeout&&clearTimeout(o.pollTimeout)})]),_e=e("./frontend/src/scenes/userLogic.ts"),He=e("./node_modules/antd/lib/dropdown/style/index.css"),Ie=e("./frontend/src/lib/components/Spinner/Spinner.tsx"),be=e("./frontend/src/lib/components/LemonButton/index.ts"),Re=e("./frontend/src/lib/components/PageHeader.tsx"),Be=e("./frontend/src/lib/components/LemonInput/LemonInput.tsx"),Pe=e("./frontend/src/lib/forms/Field.tsx"),We=e("./frontend/src/lib/forms/VerticalForm.tsx"),Fe=e("./frontend/src/lib/components/LemonSelect.tsx"),Ve=e("./frontend/src/lib/components/LemonTextArea/LemonTextArea.tsx"),xe=e("./frontend/src/lib/components/icons.tsx"),Ke=e("./frontend/src/scenes/cohorts/MatchCriteriaSelector.tsx"),Ue=e("./frontend/src/lib/components/Tooltip.tsx"),Oe;function Le(n,o){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);o&&(s=s.filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable})),a.push.apply(a,s)}return a}function Ce(n){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?Le(Object(a),!0).forEach(function(s){S()(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Le(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Ne={component:ge,logic:je,paramsToProps:function(o){var a=o.params.id;return{id:a&&a!=="new"?parseInt(a):"new"}}},Ge=(Oe={},S()(Oe,i.b.Static,{label:"Static \xB7 Updated manually"}),S()(Oe,i.b.Dynamic,{label:"Dynamic \xB7 Updates automatically"}),Oe);function ge(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=n.id,a={id:o},s=je(a),g=Object(c.useActions)(s),T=g.deleteCohort,y=g.setCohort,L=g.onCriteriaChange,x=Object(c.useValues)(s),u=x.cohort,p=x.cohortLoading,te=Object(c.useValues)(_e.a),A=te.hasAvailableFeature,f=u.id==="new"||u.id===void 0,Ae=function(){y(Ce(Ce({},u),{},{groups:[].concat(Q()(u.groups),[{id:Math.random().toString().substr(2,5),matchType:i.p,properties:[]}])}))},me=function(H){y(Ce(Ce({},u),{},{groups:u.groups.filter(function(ee,de){return de!==H})}))};return t.a.createElement("div",{className:"cohort"},t.a.createElement(We.a,{logic:je,props:a,formKey:"cohort",enableFormOnSubmit:!0},t.a.createElement(Re.a,{title:f?"New cohort":u.name||"Untitled",buttons:t.a.createElement("div",{className:"flex-center"},f?t.a.createElement(be.a,{"data-attr":"cancel-cohort",type:"secondary",onClick:function(){fe.router.actions.push(G.a.cohorts())},style:{marginRight:8},disabled:p},"Cancel"):t.a.createElement(be.a,{"data-attr":"delete-cohort",status:"danger",type:"secondary",onClick:function(){T()},style:{marginRight:8},disabled:p},"Delete"),t.a.createElement(be.a,{type:"primary","data-attr":"save-cohort",htmlType:"submit",loading:p},"Save"))}),t.a.createElement(w.a,null),t.a.createElement(d.a,{gutter:[16,24],style:{maxWidth:640}},t.a.createElement(l.a,{xs:24,sm:12},t.a.createElement(Pe.a,{name:"name",label:"Name"},function(I){var H=I.value,ee=I.onValueChange;return t.a.createElement(Be.a,{value:H,onChange:ee,"data-attr":"cohort-name"})})),t.a.createElement(l.a,{xs:24,sm:12},t.a.createElement(Pe.a,{name:"is_static",label:"Type"},function(I){var H=I.value,ee=I.onValueChange;return t.a.createElement(Ue.a,{title:f?null:"Create a new cohort to use a different type of cohort."},t.a.createElement("div",null,t.a.createElement(Fe.a,{disabled:!f,options:Ge,value:H?i.b.Static:i.b.Dynamic,onChange:function(ve){ee(ve===i.b.Static)},type:"stealth",outlined:!0,style:{width:"100%"},"data-attr":"cohort-type"})))}))),A(m.d.DASHBOARD_COLLABORATION)&&t.a.createElement(d.a,{gutter:[16,24],className:"mt ph-ignore-input",style:{maxWidth:640}},t.a.createElement(l.a,{span:24},t.a.createElement(Pe.a,{name:"description",label:"Description","data-attr":"cohort-description"},function(I){var H=I.value,ee=I.onValueChange;return t.a.createElement(Ve.a,{value:H,onChange:ee})}))),u.is_static?t.a.createElement(d.a,{gutter:24,className:"mt ph-ignore-input"},t.a.createElement(l.a,{span:24},t.a.createElement(Pe.a,{name:"csv",label:f?"Upload users":"Add users","data-attr":"cohort-csv"},function(I){var H,ee,de=I.onValueChange;return t.a.createElement(t.a.Fragment,null,t.a.createElement("span",{className:"mb"},"Upload a CSV file to add users to your cohort. The CSV file only requires a single column with the user\u2019s distinct ID."),t.a.createElement(ae.a,{name:"file",multiple:!1,fileList:u.csv?[u.csv]:[],accept:".csv",showUploadList:!1,beforeUpload:function(Te){return de(Te),!1},className:"cohort-csv-dragger"},u.csv?t.a.createElement(t.a.Fragment,null,t.a.createElement(xe.IconUploadFile,{style:{fontSize:"3rem",color:"var(--muted-alt)"}}),t.a.createElement("div",{className:"ant-upload-text"},(H=(ee=u.csv)===null||ee===void 0?void 0:ee.name)!==null&&H!==void 0?H:"File chosen")):t.a.createElement(t.a.Fragment,null,t.a.createElement(xe.IconUploadFile,{style:{fontSize:"3rem",color:"var(--muted-alt)"}}),t.a.createElement("div",{className:"ant-upload-text"},"Drag a file here or click to browse for a file"))))}))):t.a.createElement(t.a.Fragment,null,t.a.createElement(w.a,null),t.a.createElement(d.a,{gutter:24,className:"mt"},t.a.createElement(l.a,{span:24},t.a.createElement(t.a.Fragment,null,t.a.createElement("div",{className:"ant-row ant-form-item ant-form-item-label",style:{display:"flex"}},t.a.createElement("label",{htmlFor:"groups",title:"Matching criteria"},"Matching criteria"),t.a.createElement("span",null,"Actors who match the following criteria will be part of the cohort. Continuously updated automatically.")),u.groups.map(function(I,H){return t.a.createElement(K.Group,{key:H,name:["groups",H]},t.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}},t.a.createElement(K.Field,{name:"id",template:function(de){var ve=de.error,Te=de.kids;return t.a.createElement("div",{style:{padding:15,border:ve?"1px solid var(--danger)":"1px solid rgba(0, 0, 0, 0.1)",borderRadius:4,width:"100%"}},Te,t.a.createElement(d.a,null,ve&&t.a.createElement("div",{style:{color:"var(--danger)",marginTop:16}},ve)))}},t.a.createElement(Ke.b,{onCriteriaChange:function(de){return L(de,I.id)},onRemove:function(){return me(H)},group:I,hideRemove:u.groups.length===1})),H<u.groups.length-1&&t.a.createElement("div",{className:"stateful-badge or mt mb"},"OR")))})),t.a.createElement("span",{id:"add"}),t.a.createElement("div",{style:{marginTop:8,marginBottom:8}},t.a.createElement("a",{href:"#add",style:{padding:0},onClick:function(){return Ae()},"data-attr":"add-match-criteria"},t.a.createElement(O.a,null)," Add matching criteria"))))),!f&&t.a.createElement(t.a.Fragment,null,t.a.createElement(w.a,null),t.a.createElement("div",null,t.a.createElement("h3",{className:"l3"},"Persons in this cohort"),u.is_calculating?t.a.createElement("div",{className:"cohort-recalculating flex-center"},t.a.createElement(Ie.a,{size:"sm",style:{marginRight:4}}),"We're recalculating who belongs to this cohort. This could take up to a couple of minutes."):t.a.createElement("div",{style:{marginTop:15}},t.a.createElement(q.Persons,{cohort:u.id}))))))}try{ge.displayName="Cohort",ge.__docgenInfo={description:"",displayName:"Cohort",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:'number | "new"'}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/cohorts/Cohort.tsx#Cohort"]={docgenInfo:ge.__docgenInfo,name:"Cohort",path:"frontend/src/scenes/cohorts/Cohort.tsx#Cohort"})}catch(n){}},"./frontend/src/scenes/groups/groupsListLogic.ts":function(oe,E,e){"use strict";e.d(E,"a",function(){return w});var P=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),r=e.n(P),D=e("./node_modules/@babel/runtime/regenerator/index.js"),v=e.n(D),F=e("./node_modules/core-js/modules/es.array.iterator.js"),se=e.n(F),Q=e("./node_modules/core-js/modules/es.object.to-string.js"),M=e.n(Q),S=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),ue=e.n(S),h=e("./node_modules/core-js/modules/es.array.concat.js"),V=e.n(h),Z=e("./node_modules/kea/lib/index.esm.js"),_=e("./frontend/src/lib/api.ts"),Y=e("./frontend/src/lib/introductions/groupsAccessLogic.ts"),R=e("./frontend/src/lib/utils.tsx"),t=e("./frontend/src/scenes/teamLogic.ts"),c=e("./frontend/src/scenes/urls.ts"),K=e("./frontend/src/models/groupsModel.ts"),w=Object(Z.kea)({path:["groups","groupsListLogic"],connect:{values:[t.a,["currentTeamId"],K.a,["groupTypes","aggregationLabel"],Y.b,["groupsEnabled"]]},actions:function(){return{loadGroups:function(m){return{url:m}},setTab:function(m){return{tab:m}}}},loaders:function(l){var m=l.values;return{groups:[{next:null,previous:null,results:[]},{loadGroups:function(){var i=r()(v.a.mark(function k(ae){var q;return v.a.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(q=ae.url,!m.groupsEnabled){B.next=6;break}return q=q||"api/projects/".concat(m.currentTeamId,"/groups/?group_type_index=").concat(m.currentTab),B.next=5,_.b.get(q);case 5:return B.abrupt("return",B.sent);case 6:case"end":return B.stop()}},k)}));function O(k){return i.apply(this,arguments)}return O}()}]}},reducers:{currentTab:["-1",{setTab:function(l,m){var i=m.tab;return i}}]},selectors:{currentTabName:[function(d){return[d.currentTab,d.groupTypes,d.aggregationLabel]},function(d,l,m){return d==="-1"?"Persons":l!=null&&l.length?Object(R.i)(m(parseInt(d)).singular):""}],breadcrumbs:[function(d){return[d.currentTabName,d.currentTab]},function(d,l){return[{name:d,path:c.a.groups(l)}]}]},actionToUrl:function(){return{setTab:function(m){var i=m.tab;return i!=="-1"?c.a.groups(i):c.a.persons()}}},urlToAction:function(l){var m=l.actions,i=l.values;return{"/groups/:id":function(k){var ae=k.id;ae&&(m.setTab(ae),m.loadGroups())},"/persons":function(){i.currentTab!=="-1"&&m.setTab("-1")}}}})},"./frontend/src/scenes/persons/PersonPageHeader.tsx":function(oe,E,e){"use strict";e.d(E,"a",function(){return _});var P=e("./node_modules/kea/lib/index.esm.js"),r=e("./frontend/src/lib/components/PageHeader.tsx"),D=e("./node_modules/react/index.js"),v=e.n(D),F=e("./node_modules/core-js/modules/es.array.includes.js"),se=e("./node_modules/core-js/modules/es.string.includes.js"),Q=e("./node_modules/core-js/modules/es.array.map.js"),M=e("./node_modules/antd/es/tabs/index.js"),S=e("./frontend/src/lib/introductions/groupsAccessLogic.ts"),ue=e("./frontend/src/lib/utils.tsx"),h=e("./frontend/src/models/groupsModel.ts"),V=e("./frontend/src/scenes/groups/groupsListLogic.ts");function Z(){var Y=Object(P.useActions)(V.a),R=Y.setTab,t=Object(P.useValues)(V.a),c=t.currentTab,K=Object(P.useValues)(h.a),w=K.groupTypes,d=K.aggregationLabel,l=Object(P.useValues)(S.b),m=l.groupsAccessStatus,i=[S.a.HasAccess,S.a.HasGroupTypes,S.a.NoAccess].includes(m);return v.a.createElement(M.a,{activeKey:c,onChange:function(k){return R(k)}},v.a.createElement(M.a.TabPane,{tab:"Persons",key:"-1"}),i?v.a.createElement(M.a.TabPane,{tab:"Introducing Group Analytics",key:"0"}):w.map(function(O){return v.a.createElement(M.a.TabPane,{tab:Object(ue.i)(d(O.group_type_index).plural),key:O.group_type_index})}))}function _(Y){var R=Y.hideGroupTabs,t=Object(P.useValues)(h.a),c=t.showGroupsOptions;return v.a.createElement(v.a.Fragment,null,v.a.createElement(r.a,{title:"Persons".concat(c?" & Groups":""),caption:"A catalog of your product's end users".concat(c?" and groups":"",".")}),!R&&c&&v.a.createElement(Z,null))}try{_.displayName="PersonPageHeader",_.__docgenInfo={description:"",displayName:"PersonPageHeader",props:{hideGroupTabs:{defaultValue:null,description:"",name:"hideGroupTabs",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonPageHeader.tsx#PersonPageHeader"]={docgenInfo:_.__docgenInfo,name:"PersonPageHeader",path:"frontend/src/scenes/persons/PersonPageHeader.tsx#PersonPageHeader"})}catch(Y){}},"./frontend/src/scenes/persons/Persons.scss":function(oe,E,e){"use strict";var P=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),r=e.n(P),D=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/persons/Persons.scss"),v=e.n(D),F={};F.insert="head",F.singleton=!1;var se=r()(v.a,F),Q=v.a.locals||{}},"./frontend/src/scenes/persons/Persons.tsx":function(oe,E,e){"use strict";e.r(E),e.d(E,"scene",function(){return B}),e.d(E,"Persons",function(){return $}),e.d(E,"PersonsScene",function(){return le});var P=e("./node_modules/react/index.js"),r=e.n(P),D=e("./node_modules/kea/lib/index.esm.js"),v=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),F=e.n(v),se=e("./node_modules/core-js/modules/es.array.concat.js"),Q=e("./node_modules/core-js/modules/es.object.keys.js"),M=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),S=e("./frontend/src/lib/components/PropertiesTable.tsx"),ue=e("./frontend/src/scenes/persons/Persons.scss"),h=e("./frontend/src/lib/components/CopyToClipboard.tsx"),V=e("./frontend/src/scenes/persons/PersonHeader.tsx"),Z=e("./frontend/src/lib/components/LemonTable/index.ts");function _(C){var j=C.people,re=C.loading,ie=re===void 0?!1:re,J=C.hasPrevious,X=C.hasNext,W=C.loadPrevious,b=C.loadNext,U=C.compact,ce=[{title:"Person",key:"person",render:function(N,G){return r.a.createElement(V.a,{withIcon:!0,person:G})}},{title:"ID",key:"id",render:function(N,G){return r.a.createElement("div",{style:{overflow:"hidden"}},G.distinct_ids.length&&r.a.createElement(h.a,{explicitValue:G.distinct_ids[0],iconStyle:{color:"var(--primary)"},description:"person distinct ID"},G.distinct_ids[0]))}}].concat(F()(U?[]:[{title:"First seen",dataIndex:"created_at",render:function(N){return N?r.a.createElement(M.b,{time:N}):r.a.createElement(r.a.Fragment,null)}}]));return r.a.createElement(Z.a,{columns:ce,loading:ie,rowKey:"id",pagination:{controlled:!0,pageSize:100,onForward:X?function(){b==null||b(),window.scrollTo(0,0)}:void 0,onBackward:J?function(){W==null||W(),window.scrollTo(0,0)}:void 0},expandable:{expandedRowRender:function(N){var G=N.properties;return Object.keys(G).length?r.a.createElement(S.a,{properties:G}):"This person has no properties."}},dataSource:j,emptyState:"No persons",nouns:["person","persons"]})}try{_.displayName="PersonsTable",_.__docgenInfo={description:"",displayName:"PersonsTable",props:{people:{defaultValue:null,description:"",name:"people",required:!0,type:{name:"PersonType[]"}},loading:{defaultValue:{value:"false"},description:"",name:"loading",required:!1,type:{name:"boolean"}},hasPrevious:{defaultValue:null,description:"",name:"hasPrevious",required:!1,type:{name:"boolean"}},hasNext:{defaultValue:null,description:"",name:"hasNext",required:!1,type:{name:"boolean"}},loadPrevious:{defaultValue:null,description:"",name:"loadPrevious",required:!1,type:{name:"(() => void)"}},loadNext:{defaultValue:null,description:"",name:"loadNext",required:!1,type:{name:"(() => void)"}},compact:{defaultValue:null,description:"",name:"compact",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonsTable.tsx#PersonsTable"]={docgenInfo:_.__docgenInfo,name:"PersonsTable",path:"frontend/src/scenes/persons/PersonsTable.tsx#PersonsTable"})}catch(C){}var Y=e("./node_modules/antd/es/row/index.js"),R=e("./node_modules/antd/es/popconfirm/index.js"),t=e("./frontend/src/scenes/persons/personsLogic.ts"),c=e("./node_modules/@babel/runtime/helpers/slicedToArray.js"),K=e.n(c),w=e("./node_modules/core-js/modules/es.regexp.exec.js"),d=e("./node_modules/core-js/modules/es.string.search.js"),l=e("./node_modules/antd/es/input/index.js"),m=e("./frontend/src/lib/components/LemonRow/index.ts"),i=e("./frontend/src/lib/components/icons.tsx"),O=function(j){var re=j.autoFocus,ie=re===void 0?!0:re,J=Object(D.useActions)(t.a),X=J.loadPersons,W=J.setListFilters,b=Object(D.useValues)(t.a),U=b.listFilters,ce=Object(P.useState)(""),ne=K()(ce,2),N=ne[0],G=ne[1];return Object(P.useEffect)(function(){G(U.search||"")},[]),r.a.createElement("div",{style:{display:"flex",alignItems:"center",width:"min(100%, 24rem)"}},r.a.createElement(l.a.Search,{"data-attr":"persons-search",placeholder:"Search for persons",autoFocus:ie,value:N,onChange:function(he){G(he.target.value),he.target.value||(W({search:void 0}),X())},enterButton:!0,onPressEnter:function(he){he.preventDefault(),W({search:N||void 0}),X()},allowClear:!0,onSearch:function(){W({search:N||void 0}),X()},style:{width:"100%"}}),r.a.createElement(m.a,{className:"ml-05",type:"stealth",tooltip:r.a.createElement(r.a.Fragment,null,"Search by email, name, ID, or even contents of properties. You can also search for persons who just ",r.a.createElement("i",null,"have"),' a property like so: "has:your_property".'),icon:r.a.createElement(i.IconInfo,null)}))};try{O.displayName="PersonsSearch",O.__docgenInfo={description:"",displayName:"PersonsSearch",props:{autoFocus:{defaultValue:{value:"true"},description:"",name:"autoFocus",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"]={docgenInfo:O.__docgenInfo,name:"PersonsSearch",path:"frontend/src/scenes/persons/PersonsSearch.tsx#PersonsSearch"})}catch(C){}var k=e("./frontend/src/scenes/persons/PersonPageHeader.tsx"),ae=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),q=e("./frontend/src/lib/components/TaxonomicFilter/types.ts"),pe=e("./frontend/src/lib/components/LemonButton/index.ts"),B={component:le,logic:t.a,paramsToProps:function(){return{syncWithUrl:!0}}};function $(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},j=C.cohort;return r.a.createElement(D.BindLogic,{logic:t.a,props:{cohort:j,syncWithUrl:!j}},r.a.createElement(le,null))}function le(){var C=Object(D.useActions)(t.a),j=C.loadPersons,re=C.setListFilters,ie=C.exportCsv,J=Object(D.useValues)(t.a),X=J.cohortId,W=J.persons,b=J.listFilters,U=J.personsLoading,ce=J.exportUrl;return r.a.createElement("div",{className:"persons-list"},!X&&r.a.createElement(k.a,null),r.a.createElement(Y.a,{align:"middle",justify:"space-between",className:"mb-05",style:{gap:"0.75rem"}},r.a.createElement(O,{autoFocus:!X}),r.a.createElement("div",null,r.a.createElement(R.a,{placement:"topRight",title:r.a.createElement(r.a.Fragment,null,"Exporting by csv is limited to 10,000 users.",r.a.createElement("br",null),"To return more, please use ",r.a.createElement("a",{href:"https://posthog.com/docs/api/persons"},"the API"),". Do you want to export by CSV?"),onConfirm:ie},ce&&r.a.createElement(pe.a,{type:"secondary",icon:r.a.createElement(i.IconExport,{style:{color:"var(--primary)"}})},b.properties&&b.properties.length>0?r.a.createElement("div",{style:{display:"block"}},"Export (",r.a.createElement("strong",null,b.properties.length)," filter)"):"Export")))),r.a.createElement(ae.a,{pageKey:"persons-list-page",propertyFilters:b.properties,onChange:function(N){re({properties:N}),j()},endpoint:"person",taxonomicGroupTypes:[q.a.PersonProperties,q.a.Cohorts],showConditionBadge:!0}),r.a.createElement(_,{people:W.results,loading:U,hasPrevious:!!W.previous,hasNext:!!W.next,loadPrevious:function(){return j(W.previous)},loadNext:function(){return j(W.next)}}))}try{$.displayName="Persons",$.__docgenInfo={description:"",displayName:"Persons",props:{cohort:{defaultValue:null,description:"",name:"cohort",required:!1,type:{name:'number | "new"'}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/persons/Persons.tsx#Persons"]={docgenInfo:$.__docgenInfo,name:"Persons",path:"frontend/src/scenes/persons/Persons.tsx#Persons"})}catch(C){}},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/persons/Persons.scss":function(oe,E,e){var P=e("./node_modules/css-loader/dist/runtime/api.js");E=P(!1),E.push([oe.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.extra-ids{display:inline-flex;align-items:center;height:1.25rem;line-height:1.125rem;margin:0 0 0 .25rem;padding:0 .25rem 0 .375rem;color:#5375ff;cursor:pointer}.extra-ids svg{margin-left:.25rem}",""]),oe.exports=E}}]);
