(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{6036:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Annotations",(function(){return Annotations}));__webpack_require__(57);var regenerator=__webpack_require__(8),regenerator_default=__webpack_require__.n(regenerator),asyncToGenerator=(__webpack_require__(68),__webpack_require__(16)),asyncToGenerator_default=__webpack_require__.n(asyncToGenerator),slicedToArray=__webpack_require__(17),slicedToArray_default=__webpack_require__.n(slicedToArray),react=__webpack_require__(0),react_default=__webpack_require__.n(react),index_esm=__webpack_require__(4),es_input=__webpack_require__(666),tag=__webpack_require__(1128),es_button=__webpack_require__(137),table=__webpack_require__(5404),spin=__webpack_require__(562),modal=__webpack_require__(2504),dropdown=__webpack_require__(817),menu=__webpack_require__(306),row=__webpack_require__(448),utils=__webpack_require__(12),dayjs_min=__webpack_require__(31),dayjs_min_default=__webpack_require__.n(dayjs_min),annotationsModel=__webpack_require__(788),defineProperty=(__webpack_require__(46),__webpack_require__(49),__webpack_require__(37),__webpack_require__(50),__webpack_require__(5)),defineProperty_default=__webpack_require__.n(defineProperty),toConsumableArray=__webpack_require__(19),toConsumableArray_default=__webpack_require__.n(toConsumableArray),api=__webpack_require__(23),annotationsTableLogic=Object(index_esm.kea)({loaders:function loaders(_ref){var _loadAnnotations,actions=_ref.actions;return{annotations:{__default:[],loadAnnotations:(_loadAnnotations=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(){var response;return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,api.a.get("api/annotation/?"+Object(utils.mb)({order:"-updated_at"}));case 2:return response=_context.sent,actions.setNext(response.next),_context.abrupt("return",response.results);case 5:case"end":return _context.stop()}}),_callee)}))),function loadAnnotations(){return _loadAnnotations.apply(this,arguments)})}}},reducers:function reducers(){return{annotations:{appendAnnotations:function appendAnnotations(state,_ref2){var annotations=_ref2.annotations;return[].concat(toConsumableArray_default()(state),toConsumableArray_default()(annotations))}},next:[null,{setNext:function setNext(_,_ref3){return _ref3.next}}],loadingNext:[!1,{loadAnnotationsNext:function loadAnnotationsNext(){return!0},appendAnnotations:function appendAnnotations(){return!1}}]}},actions:function actions(){return{updateAnnotation:function updateAnnotation(id,content){return{id:id,content:content}},deleteAnnotation:function deleteAnnotation(id){return{id:id}},restoreAnnotation:function restoreAnnotation(id){return{id:id}},loadAnnotationsNext:function loadAnnotationsNext(){return!0},setNext:function setNext(next){return{next:next}},appendAnnotations:function appendAnnotations(annotations){return{annotations:annotations}}}},listeners:function listeners(_ref4){var _loadAnnotationsNext,_restoreAnnotation,_updateAnnotation,actions=_ref4.actions,values=_ref4.values;return defineProperty_default()({updateAnnotation:(_updateAnnotation=asyncToGenerator_default()(regenerator_default.a.mark((function _callee2(_ref5){var id,content;return regenerator_default.a.wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return id=_ref5.id,content=_ref5.content,_context2.next=3,api.a.update("api/annotation/".concat(id),{content:content});case 3:actions.loadAnnotations();case 4:case"end":return _context2.stop()}}),_callee2)}))),function updateAnnotation(_x){return _updateAnnotation.apply(this,arguments)}),restoreAnnotation:(_restoreAnnotation=asyncToGenerator_default()(regenerator_default.a.mark((function _callee3(_ref6){var id;return regenerator_default.a.wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return id=_ref6.id,_context3.next=3,api.a.update("api/annotation/".concat(id),{deleted:!1});case 3:actions.loadAnnotations();case 4:case"end":return _context3.stop()}}),_callee3)}))),function restoreAnnotation(_x2){return _restoreAnnotation.apply(this,arguments)}),deleteAnnotation:function deleteAnnotation(_ref7){var id=_ref7.id;Object(utils.r)({endpoint:"annotation",object:{name:"Annotation",id:id},callback:function callback(){return actions.loadAnnotations()}})},loadAnnotationsNext:(_loadAnnotationsNext=asyncToGenerator_default()(regenerator_default.a.mark((function _callee4(){var results,response;return regenerator_default.a.wrap((function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(results=[],!values.next){_context4.next=7;break}return _context4.next=4,api.a.get(values.next);case 4:response=_context4.sent,actions.setNext(response.next),results=response.results;case 7:actions.appendAnnotations(results);case 8:case"end":return _context4.stop()}}),_callee4)}))),function loadAnnotationsNext(){return _loadAnnotationsNext.apply(this,arguments)})},annotationsModel.a.actionTypes.createGlobalAnnotationSuccess,(function(){actions.loadAnnotations()}))},events:function events(_ref9){return{afterMount:_ref9.actions.loadAnnotations}},path:function path(){return["scenes","annotations","logic"]}}),ProjectOutlined=__webpack_require__(5472),DeploymentUnitOutlined=__webpack_require__(5506),DownOutlined=__webpack_require__(557),DeleteOutlined=__webpack_require__(5422),asn_RedoOutlined={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"}}]},name:"redo",theme:"outlined"},AntdIcon=__webpack_require__(18),icons_RedoOutlined_RedoOutlined=function RedoOutlined(props,ref){return react.createElement(AntdIcon.a,Object.assign({},props,{ref:ref,icon:asn_RedoOutlined}))};icons_RedoOutlined_RedoOutlined.displayName="RedoOutlined";var ModalMode,icons_RedoOutlined=react.forwardRef(icons_RedoOutlined_RedoOutlined),constants=__webpack_require__(20),userLogic=__webpack_require__(33),PageHeader=__webpack_require__(222),PlusOutlined=__webpack_require__(1705),Table=__webpack_require__(1132),types=__webpack_require__(9),dayjs=__webpack_require__(836),dayjs_default=__webpack_require__.n(dayjs),generatePicker=__webpack_require__(831),Table_utils=__webpack_require__(673),DatePicker=Object(generatePicker.b)(dayjs_default.a),TextArea=es_input.a.TextArea;function Annotations(){var _useValues=Object(index_esm.useValues)(annotationsTableLogic),annotations=_useValues.annotations,annotationsLoading=_useValues.annotationsLoading,next=_useValues.next,loadingNext=_useValues.loadingNext,_useActions=Object(index_esm.useActions)(annotationsTableLogic),updateAnnotation=_useActions.updateAnnotation,deleteAnnotation=_useActions.deleteAnnotation,loadAnnotationsNext=_useActions.loadAnnotationsNext,restoreAnnotation=_useActions.restoreAnnotation,createGlobalAnnotation=Object(index_esm.useActions)(annotationsModel.a).createGlobalAnnotation,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),open=_useState2[0],setOpen=_useState2[1],_useState3=Object(react.useState)(null),_useState4=slicedToArray_default()(_useState3,2),selectedAnnotation=_useState4[0],setSelected=_useState4[1],tableScrollX=Object(Table_utils.b)("lg").tableScrollX,columns=[{title:Object(Table_utils.a)("Annotation"),key:"annotation",fixed:!0,render:function RenderAnnotation(annotation){return react_default.a.createElement("div",{className:"ph-no-capture",style:{width:"auto",maxWidth:250}},annotation.content)}},Object(Table.b)(annotations),{title:Object(Table_utils.a)("Date Marker"),render:function RenderDateMarker(annotation){return react_default.a.createElement("span",null,dayjs_min_default()(annotation.date_marker).format("YYYY-MM-DD"))}},{title:Object(Table_utils.a)("Last Updated"),render:function RenderLastUpdated(annotation){return react_default.a.createElement("span",null,Object(utils.H)(annotation.updated_at))}},{title:Object(Table_utils.a)("Status"),render:function RenderStatus(annotation){return annotation.deleted?react_default.a.createElement(tag.a,{color:"red"},"Deleted"):react_default.a.createElement(tag.a,{color:"green"},"Active")}},{title:Object(Table_utils.a)("Type"),render:function RenderType(annotation){return"dashboard_item"!==annotation.scope?react_default.a.createElement(tag.a,{color:"blue"},"Global"):react_default.a.createElement(tag.a,{color:"purple"},"Dashboard Item")}}];function closeModal(){setOpen(!1),setTimeout((function(){return setSelected(null)}),500)}return react_default.a.createElement("div",null,react_default.a.createElement(PageHeader.a,{title:"Annotations",caption:"Here you can add organization- and project-wide annotations. Dashboard-specific ones can be added directly in the dashboard."}),react_default.a.createElement("div",null,react_default.a.createElement("div",{className:"mb text-right"},react_default.a.createElement(es_button.a,{type:"primary","data-attr":"create-annotation",onClick:function onClick(){return setOpen(!0)},icon:react_default.a.createElement(PlusOutlined.a,null)},"Create Annotation")),react_default.a.createElement(table.a,{"data-attr":"annotations-table",size:"small",rowKey:"id",pagination:{pageSize:99999,hideOnSinglePage:!0},rowClassName:"cursor-pointer",dataSource:annotations,columns:columns,loading:annotationsLoading,onRow:function onRow(annotation){return{onClick:function onClick(){setSelected(annotation),setOpen(!0)}}},scroll:{x:tableScrollX}}),react_default.a.createElement("div",{style:{visibility:next?"visible":"hidden",margin:"2rem auto 5rem",textAlign:"center"}},loadingNext?react_default.a.createElement(spin.a,null):react_default.a.createElement(es_button.a,{type:"primary",onClick:function onClick(){loadAnnotationsNext()}},"Load more annotations"))),react_default.a.createElement(CreateAnnotationModal,{visible:open,onCancel:function onCancel(){closeModal()},onSubmit:function(){var _ref=asyncToGenerator_default()(regenerator_default.a.mark((function _callee(input,selectedDate){return regenerator_default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(_context.t0=selectedAnnotation,!_context.t0){_context.next=5;break}return _context.next=4,selectedAnnotation;case 4:_context.t0=_context.sent;case 5:if(!_context.t0){_context.next=9;break}updateAnnotation(selectedAnnotation.id,input),_context.next=10;break;case 9:createGlobalAnnotation(input,selectedDate.format("YYYY-MM-DD"));case 10:closeModal();case 11:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}(),onDelete:function onDelete(){selectedAnnotation&&deleteAnnotation(selectedAnnotation.id),closeModal()},onRestore:function onRestore(){selectedAnnotation&&restoreAnnotation(selectedAnnotation.id),closeModal()},annotation:selectedAnnotation}))}function CreateAnnotationModal(props){var _user$team,_user$organization,_props$annotation,_useState5=Object(react.useState)(types.b.Project),_useState6=slicedToArray_default()(_useState5,2),scope=_useState6[0],setScope=_useState6[1],_useState7=Object(react.useState)(""),_useState8=slicedToArray_default()(_useState7,2),textInput=_useState8[0],setTextInput=_useState8[1],_useState9=Object(react.useState)(ModalMode.CREATE),_useState10=slicedToArray_default()(_useState9,2),modalMode=_useState10[0],setModalMode=_useState10[1],_useState11=Object(react.useState)(dayjs_min_default()()),_useState12=slicedToArray_default()(_useState11,2),selectedDate=_useState12[0],setDate=_useState12[1],user=Object(index_esm.useValues)(userLogic.a).user;Object(react.useEffect)((function(){props.annotation?(setModalMode(ModalMode.EDIT),setTextInput(props.annotation.content)):(setModalMode(ModalMode.CREATE),setTextInput(""))}),[props.annotation]);return react_default.a.createElement(modal.a,{footer:[react_default.a.createElement(es_button.a,{key:"create-annotation-cancel",onClick:function onClick(){return props.onCancel()}},"Cancel"),react_default.a.createElement(es_button.a,{type:"primary",key:"create-annotation-submit","data-attr":"create-annotation-submit",onClick:function onClick(){!function _onSubmit(input,date){props.onSubmit(input,date),setTextInput(""),setDate(dayjs_min_default()()),setScope(types.b.Project)}(textInput,selectedDate)}},modalMode===ModalMode.CREATE?"Submit":"Update")],closable:!1,visible:props.visible,onCancel:props.onCancel,title:modalMode===ModalMode.CREATE?"Create Global Annotation":"Edit Annotation"},modalMode===ModalMode.CREATE?react_default.a.createElement("span",null,"This annotation will appear on all",react_default.a.createElement(dropdown.a,{overlay:react_default.a.createElement(menu.a,null,scope===types.b.Project?react_default.a.createElement(menu.a.Item,{onClick:function onClick(){setScope(types.b.Project)},key:types.b.Project,icon:react_default.a.createElement(ProjectOutlined.a,null)},"Project ",null==user||null===(_user$team=user.team)||void 0===_user$team?void 0:_user$team.name):react_default.a.createElement(menu.a.Item,{onClick:function onClick(){setScope(types.b.Organization)},key:types.b.Organization,icon:react_default.a.createElement(DeploymentUnitOutlined.a,null)},"Organization ",null==user||null===(_user$organization=user.organization)||void 0===_user$organization?void 0:_user$organization.name))},react_default.a.createElement(es_button.a,{style:{marginLeft:8,marginRight:8}},constants.E.get(scope)," ",react_default.a.createElement(DownOutlined.a,null)))," ","charts"):react_default.a.createElement(row.a,{justify:"space-between"},react_default.a.createElement("span",null,"Change existing annotation text"),(null===(_props$annotation=props.annotation)||void 0===_props$annotation?void 0:_props$annotation.deleted)?react_default.a.createElement(icons_RedoOutlined,{className:"button-border clickable",onClick:function onClick(){props.onRestore()}}):react_default.a.createElement(DeleteOutlined.a,{className:"text-danger",onClick:function onClick(){props.onDelete()}})),react_default.a.createElement("br",null),modalMode===ModalMode.CREATE&&react_default.a.createElement("div",null,"Date:",react_default.a.createElement(DatePicker,{style:{marginTop:16,marginLeft:8,marginBottom:16},getPopupContainer:function getPopupContainer(trigger){return trigger.parentElement},value:selectedDate,onChange:function onChange(date){return setDate(date)},allowClear:!1})),react_default.a.createElement(TextArea,{"data-attr":"create-annotation-input",maxLength:300,style:{marginBottom:12,marginTop:5},rows:4,value:textInput,onChange:function onChange(e){return setTextInput(e.target.value)}}))}!function(ModalMode){ModalMode[ModalMode.CREATE=0]="CREATE",ModalMode[ModalMode.EDIT=1]="EDIT"}(ModalMode||(ModalMode={}))}}]);