"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[10810],{"../../frontend/src/scenes/data-warehouse/external/forms/SourceForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>SourceFormComponent,Z:()=>SourceFormContainer});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),availableSourcesDataLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/availableSourcesDataLogic.ts"),sourceWizardLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx"),IntegrationChoice=__webpack_require__("../../frontend/src/lib/components/CyclotronJob/integrations/IntegrationChoice.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function DataWarehouseIntegrationChoice(_ref){let{sourceConfig,integration,...props}=_ref;return(0,jsx_runtime.jsx)(IntegrationChoice.a,{...props,integration:null!=integration?integration:sourceConfig.name.toLowerCase(),redirectUrl:urls.j.dataWarehouseSourceNew(sourceConfig.name.toLowerCase())})}function parseConnectionString(str){let result;let config={},dummyHost=!1;str.startsWith("postgres://")&&(str="postgresql://"+str.substring(11)),/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(str)&&(str=encodeURI(str).replace(/%25(\d\d)/g,"%$1"));try{result=new URL(str,"postgresql://base")}catch{result=new URL(str.replace("@/","@___DUMMY___/"),"postgresql://base"),dummyHost=!0}for(let[key,value]of result.searchParams.entries())config[key]=value;if(config.user=config.user||decodeURIComponent(result.username||""),config.password=config.password||decodeURIComponent(result.password||""),"socket:"===result.protocol)return config.host=decodeURI(result.pathname),config.database=result.searchParams.get("db"),config.client_encoding=result.searchParams.get("encoding"),config;let hostname=dummyHost?"":result.hostname;config.host?hostname&&/^%2f/i.test(hostname)&&(result.pathname=hostname+result.pathname):config.host=decodeURIComponent(hostname),config.port=config.port||result.port;let pathname=result.pathname.slice(1)||null;return config.database=pathname?decodeURIComponent(pathname):null,config.isValid=!!(config.user&&config.database&&config.host),config}let CONNECTION_STRING_DEFAULT_PORT={Postgres:5432},sourceFieldToElement=(field,sourceConfig,lastValue,isUpdateMode)=>{if("text"===field.type&&"connection_string"===field.name)return isUpdateMode?(0,jsx_runtime.jsx)(react.Fragment,{},field.name):(0,jsx_runtime.jsxs)(react.Fragment,{children:[(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref=>{let{onChange}=_ref;return(0,jsx_runtime.jsx)(src.DF,{className:"ph-connection-string","data-attr":field.name,placeholder:field.placeholder,type:"text",onChange:updatedConnectionString=>{onChange(updatedConnectionString);let{host,port,database,user,password,isValid}=parseConnectionString(updatedConnectionString);isValid&&(sourceWizardLogic.sourceWizardLogic.actions.setSourceConnectionDetailsValue(["payload","database"],database||""),sourceWizardLogic.sourceWizardLogic.actions.setSourceConnectionDetailsValue(["payload","host"],host||""),sourceWizardLogic.sourceWizardLogic.actions.setSourceConnectionDetailsValue(["payload","user"],user||""),sourceWizardLogic.sourceWizardLogic.actions.setSourceConnectionDetailsValue(["payload","port"],port||CONNECTION_STRING_DEFAULT_PORT[sourceConfig.name]),sourceWizardLogic.sourceWizardLogic.actions.setSourceConnectionDetailsValue(["payload","password"],password||""))}},field.name)}}),(0,jsx_runtime.jsx)(src.p2,{})]},field.name);if("switch-group"===field.type){let enabled=!!lastValue?.[field.name]?.enabled||lastValue?.[field.name]?.enabled==="True";return(0,jsx_runtime.jsx)(LemonField.D,{name:[field.name,"enabled"],label:field.label,children:_ref2=>{let{value,onChange}=_ref2,isEnabled=null==value||"False"===value?enabled:value;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!!field.caption&&(0,jsx_runtime.jsx)("p",{className:"mb-0",children:field.caption}),(0,jsx_runtime.jsx)(src.f4,{checked:isEnabled,onChange:onChange}),isEnabled&&(0,jsx_runtime.jsx)(lib.Group,{name:field.name,children:field.fields.map(field=>sourceFieldToElement(field,sourceConfig,lastValue?.[field.name]))})]})}},field.name)}if("select"===field.type){let hasOptionFields=!!field.options.filter(n=>{var _n$fields$length;return(null!==(_n$fields$length=n.fields?.length)&&void 0!==_n$fields$length?_n$fields$length:0)>0}).length,getOptions=value=>field.options.find(n=>n.value===(null!=value?value:field.defaultValue))?.fields?.map(optionField=>sourceFieldToElement(optionField,sourceConfig,lastValue?.[optionField.name]));return(0,jsx_runtime.jsx)(LemonField.D,{name:hasOptionFields?[field.name,"selection"]:field.name,label:field.label,children:_ref3=>{let{value,onChange}=_ref3;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Yv,{options:field.options,value:(null==value?lastValue?.[field.name]:value)||field.defaultValue,onChange:onChange}),(0,jsx_runtime.jsx)(lib.Group,{name:field.name,children:getOptions(value)})]})}},field.name)}return"textarea"===field.type?(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref4=>{let{value,onChange}=_ref4;return(0,jsx_runtime.jsx)(src._V,{className:"ph-ignore-input","data-attr":field.name,placeholder:field.placeholder,minRows:4,value:value||"",onChange:onChange})}},field.name):"oauth"===field.type?(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref5=>{let{value,onChange}=_ref5;return(0,jsx_runtime.jsx)(DataWarehouseIntegrationChoice,{sourceConfig:sourceConfig,value:value,onChange:onChange,integration:field.kind},field.name)}},field.name):"file-upload"===field.type?(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref6=>{let{value,onChange}=_ref6;return(0,jsx_runtime.jsx)("div",{className:"bg-fill-input p-2 border rounded-[var(--radius)]",children:(0,jsx_runtime.jsx)(src.mH,{value:value,accept:field.fileFormat.format,multiple:!1,onChange:onChange})})}},field.name):"ssh-tunnel"===field.type?sourceFieldToElement({...sourceWizardLogic.pb,name:field.name,label:field.label},sourceConfig,lastValue,isUpdateMode):(0,jsx_runtime.jsx)(LemonField.D,{name:field.name,label:field.label,children:_ref7=>{let{value,onChange}=_ref7;return(0,jsx_runtime.jsx)(src.DF,{className:"ph-ignore-input","data-attr":field.name,placeholder:field.placeholder,type:field.type,value:value||"",onChange:onChange})}},field.name)};function SourceFormContainer(props){return(0,jsx_runtime.jsx)(lib.Form,{logic:sourceWizardLogic.sourceWizardLogic,formKey:"sourceConnectionDetails",enableFormOnSubmit:!0,children:(0,jsx_runtime.jsx)(SourceFormComponent,{...props})})}function SourceFormComponent(_ref8){let{sourceConfig,showPrefix=!0,jobInputs,setSourceConfigValue}=_ref8,{availableSources,availableSourcesLoading}=(0,index_esm.useValues)(availableSourcesDataLogic.t);(0,react.useEffect)(()=>{if(jobInputs&&setSourceConfigValue)for(let input of Object.keys(jobInputs||{}))setSourceConfigValue(["payload",input],jobInputs[input])},[JSON.stringify(jobInputs),setSourceConfigValue,jobInputs]);let isUpdateMode=!!setSourceConfigValue;return availableSourcesLoading||!availableSources?(0,jsx_runtime.jsx)(src.yW,{}):(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[(0,jsx_runtime.jsx)(lib.Group,{name:"payload",children:availableSources[sourceConfig.name].fields.map(field=>sourceFieldToElement(field,sourceConfig,jobInputs?.[field.name],isUpdateMode))}),showPrefix&&(0,jsx_runtime.jsx)(LemonField.D,{name:"prefix",label:"Table prefix (optional)",help:"Use only letters, numbers, and underscores. Must start with a letter or underscore.",children:_ref9=>{let{value,onChange}=_ref9,cleaned=value?value.trim().replace(/^_+|_+$/g,""):"",validationError="";cleaned&&!/^[A-Za-z_][A-Za-z0-9_]*$/.test(cleaned)?validationError="Prefix must contain only letters, numbers, and underscores, and start with a letter or underscore":value&&!cleaned&&(validationError="Prefix cannot consist of only underscores");let displayValue=value?value.trim().replace(/^_+|_+$/g,""):"",tableName=displayValue?`${sourceConfig.name.toLowerCase()}.${displayValue}.table_name`:`${sourceConfig.name.toLowerCase()}.table_name`;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.DF,{className:"ph-ignore-input","data-attr":"prefix",placeholder:"internal",value:value,onChange:onChange,status:validationError?"danger":void 0}),validationError&&(0,jsx_runtime.jsx)("p",{className:"text-danger text-xs mt-1",children:validationError}),(0,jsx_runtime.jsxs)("p",{className:"mb-0",children:["Table name will look like: ",(0,jsx_runtime.jsx)("strong",{children:tableName})]})]})}})]})}},"../../frontend/src/scenes/data-warehouse/external/forms/SyncMethodForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>SyncMethodForm});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonRadio/index.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let getIncrementalSyncSupported=schema=>schema.incremental_available?0===schema.incremental_fields.length?{disabled:!0,disabledReason:"No incremental fields found on table"}:{disabled:!1}:{disabled:!0,disabledReason:"Incremental replication isn't supported on this table"},getAppendOnlySyncSupported=schema=>schema.append_available?0===schema.incremental_fields.length?{disabled:!0,disabledReason:"No incremental fields found on table"}:{disabled:!1}:{disabled:!0,disabledReason:"Append only replication isn't supported on this table"},getSaveDisabledReason=(syncType,incrementalField,appendField)=>syncType?"incremental"!==syncType||incrementalField?"append"!==syncType||appendField?void 0:"You must select an append field":"You must select an incremental field":"You must select a sync method before saving",getInitialRadioState=(schema,incrementalSyncSupported,appendSyncSupported)=>schema.sync_type?schema.sync_type:incrementalSyncSupported?"incremental":appendSyncSupported?"append":"full_refresh",SyncMethodForm=_ref=>{var _schema$incremental_f,_schema$incremental_f2,_schema$incremental_f5,_schema$incremental_f6;let{schema,onClose,onSave,saveButtonIsLoading}=_ref,incrementalSyncSupported=getIncrementalSyncSupported(schema),appendSyncSupported=getAppendOnlySyncSupported(schema),[radioValue,setRadioValue]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(getInitialRadioState(schema,!incrementalSyncSupported.disabled,!appendSyncSupported.disabled)),[incrementalFieldValue,setIncrementalFieldValue]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null!==(_schema$incremental_f=schema.incremental_field)&&void 0!==_schema$incremental_f?_schema$incremental_f:null),[appendFieldValue,setAppendFieldValue]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null!==(_schema$incremental_f2=schema.incremental_field)&&void 0!==_schema$incremental_f2?_schema$incremental_f2:null);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{var _schema$sync_type,_schema$incremental_f3,_schema$incremental_f4;setRadioValue(null!==(_schema$sync_type=schema.sync_type)&&void 0!==_schema$sync_type?_schema$sync_type:incrementalSyncSupported.disabled?"append":"incremental"),setIncrementalFieldValue(null!==(_schema$incremental_f3=schema.incremental_field)&&void 0!==_schema$incremental_f3?_schema$incremental_f3:null),setAppendFieldValue(null!==(_schema$incremental_f4=schema.incremental_field)&&void 0!==_schema$incremental_f4?_schema$incremental_f4:null)},[schema.table]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(lib_lemon_ui_LemonRadio__WEBPACK_IMPORTED_MODULE_2__._,{radioPosition:"top",value:radioValue,options:[{value:"incremental",disabledReason:incrementalSyncSupported.disabled&&incrementalSyncSupported.disabledReason||void 0,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-4 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-1",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h4",{className:"mb-0 mr-2 text-base font-semibold",children:"Incremental replication"}),!incrementalSyncSupported.disabled&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.oe,{type:"success",children:"Recommended"})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"mb-2",children:"When using incremental replication, we'll store the max value of the below field on each sync and only sync rows with greater or equal value on the next run."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{className:"mb-2",children:["You should pick a field that increments or updates each time the row is updated, such as a ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("code",{children:"updated_at"})," timestamp."]}),!incrementalSyncSupported.disabled&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Yv,{value:incrementalFieldValue,onChange:newValue=>setIncrementalFieldValue(newValue),options:null!==(_schema$incremental_f5=schema.incremental_fields.map(n=>({value:n.field,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{className:"leading-5",children:n.label}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.oe,{className:"ml-2",type:"success",children:n.type})]})})))&&void 0!==_schema$incremental_f5?_schema$incremental_f5:[]})]})},{value:"append",disabledReason:appendSyncSupported.disabled&&appendSyncSupported.disabledReason||void 0,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-4 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-1",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h4",{className:"mb-0 mr-2 text-base font-semibold",children:"Append only replication"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"mb-2",children:"When using append only replication, similar to incremental above, we'll store the max value of the below field on each sync and only sync rows with greater or equal value on the next run. But unlike incremental replication, we'll append the rows as opposed to merge them into the existing table, meaning you can have duplicate data if the value for the below field changes on a row. You should only use append only replication for sources that don't support incremental."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("p",{className:"mb-2",children:["You should pick a field that doesn't change each time the row is updated, such as a"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("code",{children:"created_at"})," timestamp."]}),!appendSyncSupported.disabled&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Yv,{value:appendFieldValue,onChange:newValue=>setAppendFieldValue(newValue),options:null!==(_schema$incremental_f6=schema.incremental_fields.map(n=>({value:n.field,label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("span",{className:"leading-5",children:n.label}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.oe,{className:"ml-2",type:"success",children:n.type})]})})))&&void 0!==_schema$incremental_f6?_schema$incremental_f6:[]})]})},{value:"full_refresh",label:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"mb-6 font-normal",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"items-center flex leading-[normal] overflow-hidden mb-1",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("h4",{className:"mb-0 mr-2 text-base font-semibold",children:"Full table replication"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("p",{className:"m-0",children:"We'll replicate the whole table on every sync. This can take longer to sync and increase your monthly billing."})]})}],onChange:newValue=>setRadioValue(newValue)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{className:"flex flex-row justify-end w-full",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{className:"mr-3",type:"secondary",onClick:onClose,children:"Close"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.Jp,{type:"primary",loading:saveButtonIsLoading,disabledReason:getSaveDisabledReason(radioValue,incrementalFieldValue,appendFieldValue),onClick:()=>{if("incremental"===radioValue){let fieldSelected=schema.incremental_fields.find(n=>n.field===incrementalFieldValue);if(!fieldSelected){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.UJ.error("Selected field for incremental replication not found");return}onSave("incremental",incrementalFieldValue,fieldSelected.field_type)}else if("append"===radioValue){let fieldSelected=schema.incremental_fields.find(n=>n.field===appendFieldValue);if(!fieldSelected){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_1__.UJ.error("Selected field for append replication not found");return}onSave("append",appendFieldValue,fieldSelected.field_type)}else onSave("full_refresh",null,null)},children:"Save"})]})]})}},"../../frontend/src/scenes/data-warehouse/new/DataWarehouseTableForm.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{V:()=>DatawarehouseTableForm});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/dataWarehouseTableLogic.tsx"),_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let ProviderMappings={aws:{fileUrlPatternPlaceholder:"eg: https://your-org.s3.amazonaws.com/airbyte/stripe/invoices/*.pqt",accessKeyPlaceholder:"eg: AKIAIOSFODNN7EXAMPLE",accessKeyLabel:"Access key",accessSecretLabel:"Access secret"},"google-cloud":{fileUrlPatternPlaceholder:"eg: https://storage.googleapis.com/your-org/airbyte/stripe/invoices/*.pqt",accessKeyPlaceholder:"eg: GOOGTS7C7FUP3AIRVEXAMPLE",accessKeyLabel:"Access ID",accessSecretLabel:"Secret"},"cloudflare-r2":{fileUrlPatternPlaceholder:"eg: https://your-account-id.r2.cloudflarestorage.com/airbyte/stripe/invoices/*.pqt",accessKeyPlaceholder:"eg: AKIAIOSFODNN7EXAMPLE",accessKeyLabel:"Access key",accessSecretLabel:"Access secret"},azure:{fileUrlPatternPlaceholder:"https://your-storage-container.blob.core.windows.net/airbyte/stripe/invoices/*.parquet",accessKeyPlaceholder:"your-storage-container",accessKeyLabel:"Storage account name",accessSecretLabel:"Account key"}};function DatawarehouseTableForm(_ref){let{onUpdate}=_ref,{manualLinkingProvider}=(0,kea__WEBPACK_IMPORTED_MODULE_0__.useValues)(_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_5__.sourceWizardLogic),provider=null!=manualLinkingProvider?manualLinkingProvider:"aws";return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)(kea_forms__WEBPACK_IMPORTED_MODULE_1__.Form,{formKey:"table",logic:_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_4__.U,className:"deprecated-space-y-4",enableFormOnSubmit:!0,autoComplete:"off",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:"name",label:"Table name",children:_ref2=>{let{value="",onChange}=_ref2;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.DF,{"data-attr":"table-name",className:"ph-ignore-input",placeholder:"Examples: stripe_invoice, hubspot_contacts, users",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:value,onChange:onChange})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"mb-4 text-xs text-secondary",children:"This will be the table name used when writing queries"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:"url_pattern",label:"Files URL pattern",children:_ref3=>{let{value="",onChange}=_ref3;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.DF,{"data-attr":"table-url-pattern",className:"ph-ignore-input",placeholder:ProviderMappings[provider].fileUrlPatternPlaceholder,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:value,onChange:onChange})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"mb-4 text-xs text-secondary",children:["You can use ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("strong",{children:"*"})," to select multiple files."]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:"format",label:"File format",className:"mb-4 w-max",children:_ref4=>{let{value="",onChange}=_ref4;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.Yv,{"data-attr":"table-format",options:[{label:"Parquet (recommended)",value:"Parquet"},{label:"CSV",value:"CSV"},{label:"CSV with headers",value:"CSVWithNames"},{label:"JSON",value:"JSONEachRow"},{label:"Delta",value:"Delta"}],value:value,onChange:onChange})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:["credential","access_key"],label:ProviderMappings[provider].accessKeyLabel,children:_ref5=>{let{value="",onChange}=_ref5;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.DF,{"data-attr":"access-key",className:"ph-ignore-input",placeholder:ProviderMappings[provider].accessKeyPlaceholder,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:value,onChange:onChange})}}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(lib_lemon_ui_LemonField__WEBPACK_IMPORTED_MODULE_3__.D,{name:["credential","access_secret"],label:ProviderMappings[provider].accessSecretLabel,children:_ref6=>{let{value="",onChange}=_ref6;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.DF,{"data-attr":"access-secret",className:"ph-ignore-input",type:"password",placeholder:"eg: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1,value:value,onChange:onChange})}}),"google-cloud"===provider&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsxs)("div",{className:"text-xs text-secondary",children:["We use HMAC keys to access your Google Cloud Storage. Find more about generating them"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.rU,{to:"https://cloud.google.com/storage/docs/authentication/hmackeys",target:"_new",children:"here"})]})]}),!!onUpdate&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)("div",{className:"flex justify-end",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_6__.jsx)(_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_2__.Jp,{type:"primary",onClick:onUpdate,children:"Save"})})]})}},"../../frontend/src/scenes/data-warehouse/new/dataWarehouseTableLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{U:()=>dataWarehouseTableLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_api__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/data-management/database/databaseTableListLogic.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_settings_DataWarehouseSourceScene__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/DataWarehouseSourceScene.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let NEW_WAREHOUSE_TABLE={id:"",name:"",url_pattern:"",format:"Parquet",credential:{access_key:"",access_secret:""}},dataWarehouseTableLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-warehouse","tableLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({actions:[scenes_data_management_database_databaseTableListLogic__WEBPACK_IMPORTED_MODULE_6__.A,["loadDatabase"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({editingTable:editing=>({editing}),updateTargetingFlagFilters:(index,properties)=>({index,properties}),addConditionSet:!0,removeConditionSet:index=>({index}),launchTable:!0,stopTable:!0,archiveTable:!0,setDataTableQuery:query=>({query})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_2__.loaders)(_ref=>{let{props}=_ref;return{table:{loadTable:async()=>props.id&&"new"!==props.id?await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.get(props.id):{...NEW_WAREHOUSE_TABLE},createTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.create({...tablePayload}),updateTable:async tablePayload=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.dataWarehouseTables.update(props.id,tablePayload)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref2=>{let{actions,props}=_ref2;return{createTableSuccess:async _ref3=>{let{table}=_ref3;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:["Table ",table.name," created"]})),actions.loadDatabase(),kea_router__WEBPACK_IMPORTED_MODULE_3__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataPipelines("sources"))},updateTableSuccess:async _ref4=>{let{table}=_ref4;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.Fragment,{children:["Table ",table.name," updated"]})),actions.editingTable(!1),actions.loadDatabase(),kea_router__WEBPACK_IMPORTED_MODULE_3__.router.actions.replace(scenes_urls__WEBPACK_IMPORTED_MODULE_7__.j.dataPipelines("sources"))},loadTableSuccess:async _ref5=>{let{table}=_ref5;props.id&&_settings_DataWarehouseSourceScene__WEBPACK_IMPORTED_MODULE_8__.dataWarehouseSourceSceneLogic.findMounted({id:`self-managed-${props.id}`})?.actions.setBreadcrumbName(table.name)}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({isEditingTable:[!1,{editingTable:(_,_ref6)=>{let{editing}=_ref6;return editing}}],dataTableQuery:[null,{setDataTableQuery:(_,_ref7)=>{let{query}=_ref7;return query}}]}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_1__.forms)(_ref8=>{let{actions,props}=_ref8;return{table:{defaults:{...NEW_WAREHOUSE_TABLE},errors:_ref9=>{let{name,url_pattern,credential,format}=_ref9;return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(name)?url_pattern?.startsWith("s3://")?{url_pattern:"Please use the https version of your bucket url e.g. https://your-org.s3.amazonaws.com/airbyte/stripe/invoices/*.pqt"}:url_pattern?.startsWith("https://storage.cloud.google.com")?{url_pattern:'Google Cloud links must start with "https://storage.googleapis.com". Please update your URL pattern.'}:{name:!name&&"Please enter a name.",url_pattern:!url_pattern&&"Please enter a url pattern.",credential:{access_secret:!credential.access_secret&&"Please enter an access secret.",access_key:!credential.access_key&&"Please enter an access key."},format:!format&&"Please enter the format of your files."}:{name:"Invalid table name. Table names must start with a letter or underscore and contain only alphanumeric characters or underscores."}},submit:async tablePayload=>{try{props.id&&"new"!==props.id?actions.updateTable(tablePayload):actions.createTable(tablePayload)}catch(e){var _e$data$message;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error(null!==(_e$data$message=e.data?.message)&&void 0!==_e$data$message?_e$data$message:e.message)}}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.events)(_ref10=>{let{actions}=_ref10;return{propsChanged:()=>{actions.loadTable()}}})])},"../../frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{HM:()=>getErrorsForFields,pb:()=>SSH_FIELD,sourceWizardLogic:()=>sourceWizardLogic,zC:()=>buildKeaFormDefaultFromSourceDetails});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),kea_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),posthog_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.297.0/node_modules/posthog-js/dist/module.js"),_posthog_icons__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_api__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx"),scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),scenes_teamLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),scenes_urls__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_layout_navigation_3000_sidepanel_panels_activation_activationLogic__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("../../frontend/src/layout/navigation-3000/sidepanel/panels/activation/activationLogic.tsx"),_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),_types__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("../../frontend/src/types.ts"),_settings_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts"),_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/dataWarehouseTableLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let SSH_FIELD={name:"ssh_tunnel",label:"Use SSH tunnel?",type:"switch-group",default:!1,fields:[{name:"host",label:"Tunnel host",type:"text",required:!0,placeholder:"localhost"},{name:"port",label:"Tunnel port",type:"number",required:!0,placeholder:"22"},{type:"select",name:"auth",label:"Authentication type",required:!0,defaultValue:"password",options:[{label:"Password",value:"password",fields:[{name:"username",label:"Tunnel username",type:"text",required:!0,placeholder:"User1"},{name:"password",label:"Tunnel password",type:"password",required:!0,placeholder:""}]},{label:"Key pair",value:"keypair",fields:[{name:"username",label:"Tunnel username",type:"text",required:!1,placeholder:"User1"},{name:"private_key",label:"Tunnel private key",type:"textarea",required:!0,placeholder:""},{name:"passphrase",label:"Tunnel passphrase",type:"password",required:!1,placeholder:""}]}]}]},buildKeaFormDefaultFromSourceDetails=sourceDetails=>{if(!sourceDetails)return{};let fieldDefaults=(field,obj)=>{if("switch-group"===field.type){obj[field.name]={},obj[field.name].enabled=field.default,field.fields.forEach(f=>fieldDefaults(f,obj[field.name]));return}if("select"===field.type){field.options.filter(n=>{var _n$fields$length;return(null!==(_n$fields$length=n.fields?.length)&&void 0!==_n$fields$length?_n$fields$length:0)>0}).length?(obj[field.name]={},obj[field.name].selection=field.defaultValue,field.options.flatMap(n=>{var _n$fields;return null!==(_n$fields=n.fields)&&void 0!==_n$fields?_n$fields:[]}).forEach(f=>fieldDefaults(f,obj[field.name]))):obj[field.name]=field.defaultValue;return}obj[field.name]=""};return Object.keys(sourceDetails).reduce((defaults,cur)=>(sourceDetails[cur].fields.forEach(f=>{"ssh-tunnel"===f.type?fieldDefaults(SSH_FIELD,defaults.payload):fieldDefaults(f,defaults.payload)}),defaults),{prefix:"",payload:{}})},manualLinkSourceMap={aws:"S3","google-cloud":"Google Cloud Storage","cloudflare-r2":"Cloudflare R2",azure:"Azure"},isTimestampType=field=>{let type=field.type||field.field_type;return"timestamp"===type||"datetime"===type||"date"===type},resolveIncrementalField=fields=>{let updatedAt=fields.find(field=>/^updated/i.test(field.label)&&isTimestampType(field));if(updatedAt)return updatedAt;let createdAt=fields.find(field=>/^created/i.test(field.label)&&isTimestampType(field));if(createdAt)return createdAt;let timestamp=fields.find(field=>isTimestampType(field));if(timestamp)return timestamp;let id=fields.find(field=>(/^id/i.test(field.label)||/^uuid/i.test(field.label))&&"integer"===field.type);if(id)return id},sourceWizardLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-warehouse","external","sourceWizardLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({selectConnector:connector=>({connector}),setInitialConnector:connector=>({connector}),toggleManualLinkFormVisible:visible=>({visible}),handleRedirect:(source,searchParams)=>({source,searchParams}),onClear:!0,onBack:!0,onNext:!0,onSubmit:!0,setDatabaseSchemas:schemas=>({schemas}),toggleSchemaShouldSync:(schema,shouldSync)=>({schema,shouldSync}),updateSchemaSyncType:(schema,syncType,incrementalField,incrementalFieldType)=>({schema,syncType,incrementalField,incrementalFieldType}),clearSource:!0,updateSource:source=>({source}),createSource:!0,setIsLoading:isLoading=>({isLoading}),setSourceId:id=>({sourceId:id}),closeWizard:!0,cancelWizard:!0,setStep:step=>({step}),getDatabaseSchemas:!0,setManualLinkingProvider:provider=>({provider}),openSyncMethodModal:schema=>({schema}),cancelSyncMethodModal:!0,toggleAllTables:selectAll=>({selectAll})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_15__.U,["tableLoading"],_settings_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_14__.T,["dataWarehouseSources"],scenes_PreflightCheck_preflightLogic__WEBPACK_IMPORTED_MODULE_7__.preflightLogic,["preflight"]],actions:[_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_15__.U,["resetTable","createTableSuccess"],_settings_dataWarehouseSettingsLogic__WEBPACK_IMPORTED_MODULE_14__.T,["loadSources"],scenes_teamLogic__WEBPACK_IMPORTED_MODULE_9__.teamLogic,["addProductIntent"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({tablesAllToggledOn:[!0,{toggleAllTables:(_,_ref)=>{let{selectAll}=_ref;return selectAll}}],manualLinkingProvider:[null,{setManualLinkingProvider:(_,_ref2)=>{let{provider}=_ref2;return provider}}],selectedConnector:[null,{selectConnector:(_,_ref3)=>{let{connector}=_ref3;return connector},setInitialConnector:(_,_ref4)=>{let{connector}=_ref4;return connector}}],isManualLinkFormVisible:[!1,{toggleManualLinkFormVisible:(_,_ref5)=>{let{visible}=_ref5;return visible}}],currentStep:[1,{onNext:state=>state+1,onBack:state=>state-1,onClear:()=>1,setStep:(_,_ref6)=>{let{step}=_ref6;return step},setInitialConnector:()=>2}],databaseSchema:[[],{setDatabaseSchemas:(_,_ref7)=>{let{schemas}=_ref7;return schemas},toggleSchemaShouldSync:(state,_ref8)=>{let{schema,shouldSync}=_ref8;return state.map(s=>({...s,should_sync:s.table===schema.table?shouldSync:s.should_sync}))},updateSchemaSyncType:(state,_ref9)=>{let{schema,syncType,incrementalField,incrementalFieldType}=_ref9;return state.map(s=>({...s,sync_type:s.table===schema.table?syncType:s.sync_type,incremental_field:s.table===schema.table?incrementalField:s.incremental_field,incremental_field_type:s.table===schema.table?incrementalFieldType:s.incremental_field_type}))}}],source:[{payload:{},prefix:""},{updateSource:(state,_ref10)=>{var _source$prefix;let{source}=_ref10;return{prefix:null!==(_source$prefix=source.prefix)&&void 0!==_source$prefix?_source$prefix:state.prefix,payload:{...state.payload,...source.payload}}},clearSource:()=>({payload:{},prefix:""})}],isLoading:[!1,{onNext:()=>!1,setIsLoading:(_,_ref11)=>{let{isLoading}=_ref11;return isLoading}}],sourceId:[null,{setSourceId:(_,_ref12)=>{let{sourceId}=_ref12;return sourceId}}],syncMethodModalOpen:[!1,{openSyncMethodModal:()=>!0,cancelSyncMethodModal:()=>!1}],currentSyncMethodModalSchema:[null,{openSyncMethodModal:(_,_ref13)=>{let{schema}=_ref13;return schema},cancelSyncMethodModal:()=>null,updateSchemaSyncType:(_,_ref14)=>{let{schema,syncType,incrementalField,incrementalFieldType}=_ref14;return{...schema,sync_type:syncType,incremental_field:incrementalField,incremental_field_type:incrementalFieldType}}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({availableSources:[()=>[(_,p)=>p.availableSources],availableSources=>availableSources],suggestedTablesMap:[s=>[s.selectedConnector],selectedConnector=>selectedConnector?.suggestedTables?selectedConnector.suggestedTables.reduce((acc,suggested)=>{var _suggested$tooltip;return acc[suggested.table]=null!==(_suggested$tooltip=suggested.tooltip)&&void 0!==_suggested$tooltip?_suggested$tooltip:null,acc},{}):{}],breadcrumbs:[s=>[s.selectedConnector,s.manualLinkingProvider,s.manualConnectors],(selectedConnector,manualLinkingProvider,manualConnectors)=>{var _selectedConnector$la;return[{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_8__.x.DataPipelines,name:"Data pipelines",path:scenes_urls__WEBPACK_IMPORTED_MODULE_10__.j.dataPipelines("overview"),iconType:"data_pipeline"},{key:[scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_8__.x.DataPipelines,"sources"],name:"Sources",path:scenes_urls__WEBPACK_IMPORTED_MODULE_10__.j.dataPipelines("sources"),iconType:"data_pipeline"},{key:scenes_sceneTypes__WEBPACK_IMPORTED_MODULE_8__.x.DataWarehouseSource,name:null!==(_selectedConnector$la=selectedConnector?.label)&&void 0!==_selectedConnector$la?_selectedConnector$la:manualLinkingProvider?manualConnectors.find(c=>c.type===manualLinkingProvider)?.name:"New",iconType:"data_pipeline"}]}],isManualLinkingSelected:[s=>[s.selectedConnector],selectedConnector=>!selectedConnector],canGoBack:[s=>[s.currentStep],currentStep=>4!==currentStep],canGoNext:[s=>[s.currentStep,s.isManualLinkingSelected,s.databaseSchema],(currentStep,isManualLinkingSelected,databaseSchema)=>(!isManualLinkingSelected||1!==currentStep)&&(!!isManualLinkingSelected||3!==currentStep||0!==databaseSchema.filter(n=>n.should_sync).length&&0===databaseSchema.filter(n=>n.should_sync&&!n.sync_type).length)],showSkipButton:[s=>[s.currentStep],currentStep=>4===currentStep],nextButtonText:[s=>[s.currentStep,s.isManualLinkingSelected,(_,props)=>props.onComplete],(currentStep,isManualLinkingSelected,onComplete)=>3===currentStep&&isManualLinkingSelected?"Link":3===currentStep?"Import":4===currentStep?onComplete?"Next":"Return to sources":"Next"],showFooter:[s=>[s.selectedConnector,s.isManualLinkFormVisible],(selectedConnector,isManualLinkFormVisible)=>selectedConnector||isManualLinkFormVisible],connectors:[s=>[s.dataWarehouseSources,s.availableSources],(sources,availableSources)=>availableSources?Object.values(availableSources).map(connector=>({...connector,disabledReason:sources&&sources.results.find(source=>source.source_type===connector.name)?"Already linked":null,existingSource:!!(sources&&sources.results.find(source=>source.source_type===connector.name))})):[]],manualConnectors:[()=>[],()=>_types__WEBPACK_IMPORTED_MODULE_13__.zD.map(source=>({name:manualLinkSourceMap[source],type:source}))],modalTitle:[s=>[s.currentStep],currentStep=>1===currentStep?"":2===currentStep?"Link your data source":3===currentStep?"Select tables to import":4===currentStep?"Importing your data...":""],isWrapped:[()=>[(_,props)=>props.onComplete],onComplete=>!!onComplete]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref15=>{let{actions,values,props}=_ref15;return{onBack:()=>{values.currentStep<=1&&actions.onClear()},onClear:()=>{actions.selectConnector(null),actions.resetSourceConnectionDetails(),actions.clearSource(),actions.toggleManualLinkFormVisible(!1),actions.resetTable(),actions.setIsLoading(!1)},onSubmit:()=>{if(1!==values.currentStep){if(2===values.currentStep&&values.selectedConnector?.name?actions.submitSourceConnectionDetails():2===values.currentStep&&values.isManualLinkFormVisible&&(_dataWarehouseTableLogic__WEBPACK_IMPORTED_MODULE_15__.U.actions.submitTable(),posthog_js__WEBPACK_IMPORTED_MODULE_3__.ZP.capture("source created",{sourceType:"Manual"})),3===values.currentStep&&values.selectedConnector?.name){let ignoredTables=values.databaseSchema.filter(schema=>!schema.should_sync||null===schema.sync_type),appendOnlyTables=values.databaseSchema.filter(schema=>schema.should_sync&&"append"===schema.sync_type),incrementalTables=values.databaseSchema.filter(schema=>schema.should_sync&&"incremental"===schema.sync_type),fullRefreshTables=values.databaseSchema.filter(schema=>schema.should_sync&&"full_refresh"===schema.sync_type),confirmation=(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("h4",{className:"mt-2",children:"Full refresh tables"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{className:fullRefreshTables.length>0?"text-warning":"",children:[fullRefreshTables.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_posthog_icons__WEBPACK_IMPORTED_MODULE_4__.IconWarning,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("span",{className:fullRefreshTables.length>0?"pl-2":"",children:["Full refresh syncs can dramatically increase your spend if you aren't mindful of them."," ",fullRefreshTables.length>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:"You have the following tables setup for full refresh syncs:"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:"None of your tables are setup for full refresh syncs. Yay!"})]})]}),fullRefreshTables.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{className:"px-4 grid grid-cols-1 gap-2 my-4 lg:grid-cols-2",children:fullRefreshTables.slice(0,Math.min(fullRefreshTables.length,4)).map(table=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{className:"font-mono px-2 rounded bg-surface-secondary w-min",children:table.table},table.table))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{children:fullRefreshTables.length>4&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{className:"my-4",children:["and"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("span",{className:"text-warning font-bold",children:fullRefreshTables.length-4})," ","more..."]})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("h4",{className:"mt-2",children:"Append-only tables"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{children:["Append-only syncs, while preferrable to full refresh syncs, still need to be configured with care. The field you select for append-only syncing should not change when a row is updated – for example, ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("span",{className:"font-mono",children:"created_at"}),"."," ",appendOnlyTables.length>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:"You have the following tables setup for append-only syncs:"}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:"None of your tables are setup for append-only syncs. Sick!"})]}),appendOnlyTables.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{className:"px-4 grid grid-cols-1 gap-2 my-4 lg:grid-cols-2",children:appendOnlyTables.slice(0,Math.min(appendOnlyTables.length,4)).map(table=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{className:"font-mono px-2 rounded bg-surface-secondary w-min",children:table.table},table.table))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div",{children:appendOnlyTables.length>4&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{className:"my-4",children:["and"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("span",{className:"text-warning font-bold",children:appendOnlyTables.length-4})," ","more..."]})})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("h4",{className:"mt-2",children:"Ignored tables"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{children:["If you do not enable the checkbox for a table or configure its sync method, it will be ignored."," ",ignoredTables.length>0?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:["You currently have"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("span",{className:"text-warning font-bold",children:ignoredTables.length})," table(s) set to be ignored from future syncs."]}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:"You are syncing all of your tables. You'll be bathing in data soon."})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("h4",{className:"mt-2",children:"Incremental tables"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div",{children:["The remainder of your tables are setup for incremental syncs, which are typically ideal. The field you select for syncing incrementally should change each time the row is updated - for example, ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("span",{className:"font-mono",children:"updated_at"}),"."," ",incrementalTables.length>0&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.Fragment,{children:["You currently have"," ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("span",{className:"text-warning font-bold",children:[incrementalTables.length," ",69===incrementalTables.length&&" (nice)"]})," ","table(s) set to sync incrementally."]})]})]});_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.dn.open({title:"Confirm your table configurations",content:confirmation,primaryButton:{children:"Confirm",type:"primary",onClick:()=>{actions.updateSource({payload:{schemas:values.databaseSchema.map(schema=>({name:schema.table,should_sync:schema.should_sync,sync_type:schema.sync_type,incremental_field:schema.incremental_field,incremental_field_type:schema.incremental_field_type,sync_time_of_day:schema.sync_time_of_day}))}}),actions.setIsLoading(!0),actions.createSource(),values.selectedConnector&&posthog_js__WEBPACK_IMPORTED_MODULE_3__.ZP.capture("source created",{sourceType:values.selectedConnector.name})},size:"small"},secondaryButton:{children:"Cancel",type:"tertiary",size:"small"}})}4===values.currentStep&&(props.onComplete?props.onComplete():actions.closeWizard())}},createTableSuccess:()=>{actions.cancelWizard()},closeWizard:()=>{actions.cancelWizard(),kea_router__WEBPACK_IMPORTED_MODULE_2__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_10__.j.dataPipelines("sources"))},cancelWizard:()=>{actions.onClear(),actions.clearSource(),actions.loadSources(null),actions.resetSourceConnectionDetails()},createSource:async()=>{if(null!==values.selectedConnector)try{let{id}=await lib_api__WEBPACK_IMPORTED_MODULE_6__.ZP.externalDataSources.create({...values.source,source_type:values.selectedConnector.name});_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.UJ.success("New data resource created"),_layout_navigation_3000_sidepanel_panels_activation_activationLogic__WEBPACK_IMPORTED_MODULE_11__.zH.findMounted()?.actions.markTaskAsCompleted(_layout_navigation_3000_sidepanel_panels_activation_activationLogic__WEBPACK_IMPORTED_MODULE_11__.K_.ConnectSource),actions.setSourceId(id),actions.resetSourceConnectionDetails(),actions.loadSources(null),actions.onNext()}catch(e){var _e$data$message;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.UJ.error(null!==(_e$data$message=e.data?.message)&&void 0!==_e$data$message?_e$data$message:e.message)}finally{actions.setIsLoading(!1)}},handleRedirect:async _ref16=>{let{source}=_ref16;_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_12__.$O.includes(source)?actions.updateSource({source_type:source}):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.UJ.error("Something went wrong.")},submitSourceConnectionDetailsSuccess:()=>{actions.getDatabaseSchemas()},getDatabaseSchemas:async()=>{var _values$source$payloa,_e$data$message2;if(values.selectedConnector){actions.setIsLoading(!0);try{let schemas=await lib_api__WEBPACK_IMPORTED_MODULE_6__.ZP.externalDataSources.database_schema(values.selectedConnector.name,null!==(_values$source$payloa=values.source.payload)&&void 0!==_values$source$payloa?_values$source$payloa:{}),showToast=!1;for(let schema of schemas)if(null===schema.sync_type){if(showToast=!0,schema.should_sync=!0,schema.incremental_available||schema.append_available){let method=schema.incremental_available?"incremental":"append",resolvedField=resolveIncrementalField(schema.incremental_fields);schema.sync_type=method,resolvedField?(schema.incremental_field=resolvedField.field,schema.incremental_field_type=resolvedField.field_type):schema.sync_type="full_refresh"}else schema.sync_type="full_refresh"}showToast&&_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.UJ.info("We've setup some defaults for you! Please take a look to make sure you're happy with the results."),actions.setDatabaseSchemas(schemas),actions.onNext()}catch(e){let errorMessage=null!==(_e$data$message2=e.data?.message)&&void 0!==_e$data$message2?_e$data$message2:e.message;_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.UJ.error(errorMessage),posthog_js__WEBPACK_IMPORTED_MODULE_3__.ZP.capture("warehouse credentials invalid",{sourceType:values.selectedConnector.name,errorMessage})}actions.setIsLoading(!1)}},setManualLinkingProvider:()=>{actions.onNext()},selectConnector:()=>{actions.addProductIntent({product_type:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_12__.Md.DATA_WAREHOUSE,intent_context:_queries_schema_schema_general__WEBPACK_IMPORTED_MODULE_12__.kp.SELECTED_CONNECTOR})},toggleAllTables:_ref17=>{let{selectAll}=_ref17;actions.setDatabaseSchemas(values.databaseSchema.map(schema=>({...schema,should_sync:selectAll})))}}}),(0,kea_router__WEBPACK_IMPORTED_MODULE_2__.urlToAction)(_ref18=>{let{actions,values}=_ref18;return{[scenes_urls__WEBPACK_IMPORTED_MODULE_10__.j.dataWarehouseSourceNew()]:(_,searchParams)=>{let kind=searchParams.kind?.toLowerCase(),source=values.connectors?.find(s=>s?.name?.toLowerCase?.()===kind),manualSource=values.manualConnectors?.find(s=>s?.type?.toLowerCase()===kind);if(manualSource){actions.toggleManualLinkFormVisible(!0),actions.setManualLinkingProvider(manualSource.type);return}if(source){actions.selectConnector(source),actions.handleRedirect(source.name),actions.setStep(2);return}actions.selectConnector(null),actions.setStep(1)}}}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_1__.forms)(_ref19=>{let{actions,values,props}=_ref19;return{sourceConnectionDetails:{defaults:buildKeaFormDefaultFromSourceDetails(props.availableSources),errors:sourceValues=>{var _values$selectedConne;let errors=getErrorsForFields(null!==(_values$selectedConne=values.selectedConnector?.fields)&&void 0!==_values$selectedConne?_values$selectedConne:[],sourceValues);return values.sourceConnectionDetailsManualErrors.prefix&&sourceValues.prefix&&actions.setSourceConnectionDetailsManualErrors({prefix:void 0}),errors},submit:async sourceValues=>{if(values.selectedConnector){let payload={...sourceValues,source_type:values.selectedConnector.name};actions.setIsLoading(!0);try{var _values$selectedConne2;await lib_api__WEBPACK_IMPORTED_MODULE_6__.ZP.externalDataSources.source_prefix(payload.source_type,sourceValues.prefix);let payloadKeys=(null!==(_values$selectedConne2=values.selectedConnector?.fields)&&void 0!==_values$selectedConne2?_values$selectedConne2:[]).map(n=>({name:n.name,type:n.type})),fieldPayload={source_type:values.selectedConnector.name};for(let{name,type}of payloadKeys)if("file-upload"===type)try{let loadedFile=await new Promise((resolve,reject)=>{let fileReader=new FileReader;fileReader.onload=e=>resolve(e.target?.result),fileReader.onerror=e=>reject(e),fileReader.readAsText(payload.payload[name][0])});fieldPayload[name]=JSON.parse(loadedFile)}catch{return _posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_5__.UJ.error("File is not valid")}else fieldPayload[name]=payload.payload[name];actions.updateSource({...payload,payload:{source_type:values.selectedConnector.name,...fieldPayload}}),actions.setIsLoading(!1)}catch(e){throw e?.data?.message&&actions.setSourceConnectionDetailsManualErrors({prefix:e.data.message}),actions.setIsLoading(!1),e}}}}}})]),getErrorsForFields=(fields,values)=>{var _values$prefix,_values$payload,_values$payload2;let errors={payload:{}};/^[a-zA-Z0-9_-]*$/.test(null!==(_values$prefix=values?.prefix)&&void 0!==_values$prefix?_values$prefix:"")||(errors.prefix="Please enter a valid prefix (only letters, numbers, and '_' or '-').");let validateField=(field,valueObj,errorsObj)=>{if("switch-group"===field.type){valueObj[field.name]?.enabled&&valueObj[field.name]?.enabled!=="False"&&(errorsObj[field.name]={},field.fields.forEach(f=>validateField(f,valueObj[field.name],errorsObj[field.name])));return}if("select"===field.type){if(field.options.filter(n=>{var _n$fields$length2;return(null!==(_n$fields$length2=n.fields?.length)&&void 0!==_n$fields$length2?_n$fields$length2:0)>0}).length){errorsObj[field.name]={};let selection=valueObj[field.name]?.selection;field.options.find(n=>n.value===selection)?.fields?.forEach(f=>validateField(f,valueObj[field.name],errorsObj[field.name]))}else field.required&&!valueObj[field.name]&&(errorsObj[field.name]=`Please select a ${field.label.toLowerCase()}`);return}"required"in field&&field.required&&!valueObj[field.name]&&(errorsObj[field.name]=`Please enter a ${field.label.toLowerCase()}`)};for(let field of fields)"ssh-tunnel"===field.type?validateField(SSH_FIELD,null!==(_values$payload=values?.payload)&&void 0!==_values$payload?_values$payload:{},errors.payload):validateField(field,null!==(_values$payload2=values?.payload)&&void 0!==_values$payload2?_values$payload2:{},errors.payload);return errors}},"../../frontend/src/scenes/data-warehouse/settings/DataWarehouseSourceScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DataWarehouseSourceScene:()=>DataWarehouseSourceScene,dataWarehouseSourceSceneLogic:()=>dataWarehouseSourceSceneLogic,scene:()=>scene});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),NotFound=__webpack_require__("../../frontend/src/lib/components/NotFound/index.tsx"),LemonTabs=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTabs/index.ts"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),DataWarehouseTableForm=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/DataWarehouseTableForm.tsx"),dataWarehouseTableLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/dataWarehouseTableLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),SceneTitleSection=__webpack_require__("../../frontend/src/layout/scenes/components/SceneTitleSection.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let DataPipelinesSelfManagedSource=_ref=>{let{id}=_ref,{table}=(0,index_esm.useValues)((0,dataWarehouseTableLogic.U)({id})),{updateTable,editingTable}=(0,index_esm.useActions)((0,dataWarehouseTableLogic.U)({id}));return(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:dataWarehouseTableLogic.U,props:{id},children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:table.name,description:table.url_pattern,resourceType:{type:"data_pipeline"},actions:(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",onClick:()=>{editingTable(!1),lib.router.actions.push(urls.j.dataPipelines("sources"))},size:"small",children:"Cancel"})}),(0,jsx_runtime.jsx)(DataPipelinesSelfManagedSourceTable,{table:table,updateTable:updateTable,editingTable:editingTable})]})};function DataPipelinesSelfManagedSourceTable(_ref2){let{table,updateTable}=_ref2;return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-4",children:(0,jsx_runtime.jsx)(DataWarehouseTableForm.V,{onUpdate:()=>updateTable({name:table.name,url_pattern:table.url_pattern,format:table.format,...table.credential?.access_key||table.credential?.access_secret?{credential:{...table.credential.access_key?{access_key:table.credential.access_key}:{},...table.credential.access_secret?{access_secret:table.credential.access_secret}:{}}}:{}})})})})}var sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),SceneContent=__webpack_require__("../../frontend/src/layout/scenes/components/SceneContent.tsx"),Schemas=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/source/Schemas.tsx"),kea_forms_lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),SourceForm=__webpack_require__("../../frontend/src/scenes/data-warehouse/external/forms/SourceForm.tsx"),availableSourcesDataLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/availableSourcesDataLogic.ts"),sourceWizardLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx"),dataWarehouseSourceSettingsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/source/dataWarehouseSourceSettingsLogic.ts");let SourceConfiguration=_ref=>{let{id}=_ref,{availableSources,availableSourcesLoading}=(0,index_esm.useValues)(availableSourcesDataLogic.t);return availableSourcesLoading||null===availableSources?(0,jsx_runtime.jsx)(src.yW,{}):(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataWarehouseSourceSettingsLogic.j,props:{id,availableSources},children:(0,jsx_runtime.jsx)(UpdateSourceConnectionFormContainer,{})})};function UpdateSourceConnectionFormContainer(){var _source$job_inputs;let{sourceFieldConfig,source,sourceConfigLoading}=(0,index_esm.useValues)(dataWarehouseSourceSettingsLogic.j),{setSourceConfigValue}=(0,index_esm.useActions)(dataWarehouseSourceSettingsLogic.j),[jobInputs,setJobInputs]=(0,react.useState)({});return((0,react.useEffect)(()=>{source&&sourceFieldConfig&&setJobInputs({...(0,sourceWizardLogic.zC)({[source.source_type]:sourceFieldConfig}).payload,...source.job_inputs})},[JSON.stringify(null!==(_source$job_inputs=source?.job_inputs)&&void 0!==_source$job_inputs?_source$job_inputs:{}),JSON.stringify(sourceFieldConfig)]),sourceFieldConfig&&source)?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:"block mb-2",children:"Overwrite your existing configuration here"}),(0,jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:dataWarehouseSourceSettingsLogic.j,formKey:"sourceConfig",enableFormOnSubmit:!0,children:[(0,jsx_runtime.jsx)(SourceForm.S,{showPrefix:!1,sourceConfig:sourceFieldConfig,jobInputs:jobInputs,setSourceConfigValue:setSourceConfigValue}),(0,jsx_runtime.jsx)("div",{className:"mt-4 flex flex-row justify-end gap-2",children:(0,jsx_runtime.jsx)(src.Jp,{loading:sourceConfigLoading,type:"primary",center:!0,htmlType:"submit","data-attr":"source-update",children:"Save"})})]})]}):(0,jsx_runtime.jsx)(src.yW,{})}var TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),LemonInputSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonInputSelect/LemonInputSelect.tsx"),LemonLabel=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonLabel/index.ts"),LogsViewer=__webpack_require__("../../frontend/src/scenes/hog-functions/logs/LogsViewer.tsx"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),types=__webpack_require__("../../frontend/src/types.ts");let StatusTagSetting={Running:"primary",Completed:"success",Failed:"danger",[types.mZ.BillingLimits]:"danger",[types.mZ.BillingLimitTooLow]:"danger"},LOG_LEVELS=["LOG","INFO","WARN","WARNING","ERROR"],Syncs=_ref=>{let{id}=_ref,{timezone}=(0,index_esm.useValues)(teamLogic.teamLogic),{user}=(0,index_esm.useValues)(userLogic.userLogic),{jobs,jobsLoading,canLoadMoreJobs,selectedSchemas}=(0,index_esm.useValues)((0,dataWarehouseSourceSettingsLogic.j)({id,availableSources:{}})),{loadMoreJobs,setSelectedSchemas}=(0,index_esm.useActions)((0,dataWarehouseSourceSettingsLogic.j)({id,availableSources:{}})),showDebugLogs=user?.is_staff||user?.is_impersonated,schemaOptions=Array.from(new Set(jobs.map(job=>job.schema.name))).sort().map(schemaName=>({key:schemaName,label:schemaName})),filteredJobs=selectedSchemas.length>0?jobs.filter(job=>selectedSchemas.includes(job.schema.name)):jobs;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[schemaOptions.length>1&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,jsx_runtime.jsx)(LemonLabel.H,{children:"Schema"}),(0,jsx_runtime.jsx)(LemonInputSelect.n,{mode:"multiple",bulkActions:"select-and-clear-all",displayMode:"count",size:"small",value:selectedSchemas,onChange:setSelectedSchemas,options:schemaOptions,placeholder:"All",allowCustomValues:!1})]}),(0,jsx_runtime.jsx)(src.p2,{className:"my-4"})]}),(0,jsx_runtime.jsx)(src.g3,{hideScrollbar:!0,dataSource:filteredJobs,loading:jobsLoading,disableTableWhileLoading:!1,columns:[{title:"Schema",render:(_,job)=>job.schema.name},{title:"Status",render:(_,job)=>{let tagContent=(0,jsx_runtime.jsx)(src.oe,{type:StatusTagSetting[job.status]||"default",children:job.status});return job.latest_error&&job.status===types.mZ.Failed?(0,jsx_runtime.jsx)(src.u,{title:job.latest_error,children:tagContent}):tagContent}},{title:"Rows synced",render:(_,job)=>job.rows_synced.toLocaleString()},{title:"Synced at",render:(_,job)=>(0,jsx_runtime.jsx)(TZLabel.w,{time:job.created_at,formatDate:"MMM DD, YYYY",formatTime:"HH:mm"})}],expandable:filteredJobs.length>0?{expandedRowRender:job=>(0,jsx_runtime.jsx)("div",{className:"p-4",children:(0,jsx_runtime.jsx)(LogsViewer.FW,{sourceType:"external_data_jobs",sourceId:job.schema.id,groupByInstanceId:!1,hideDateFilter:!0,hideLevelsFilter:!0,hideInstanceIdColumn:!0,defaultFilters:{instanceId:job.workflow_run_id,dateFrom:(0,dayjs.fp)(job.created_at,timezone).format("YYYY-MM-DD HH:mm:ss"),dateTo:job.finished_at?(0,dayjs.fp)(job.finished_at,timezone).add(1,"hour").format("YYYY-MM-DD HH:mm:ss"):void 0,levels:showDebugLogs?["DEBUG",...LOG_LEVELS]:LOG_LEVELS}})}),rowExpandable:()=>!0,noIndent:!0}:void 0,footer:(0,jsx_runtime.jsx)(src.Jp,{onClick:loadMoreJobs,type:"tertiary",fullWidth:!0,center:!0,disabledReason:canLoadMoreJobs?void 0:"There's nothing more to load",children:canLoadMoreJobs?"Load older jobs":"No older jobs"})})]})},DATA_WAREHOUSE_SOURCE_SCENE_TABS=["schemas","syncs","configuration"],dataWarehouseSourceSceneLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref=>{let{id}=_ref;return id}),(0,index_esm.path)(key=>["scenes","data-warehouse","dataWarehouseSourceSceneLogic",key]),(0,index_esm.actions)({setCurrentTab:tab=>({tab}),setBreadcrumbName:name=>({name}),_setCurrentTab:tab=>({tab})}),(0,index_esm.reducers)(()=>({currentTab:["configuration",{setCurrentTab:(_,_ref2)=>{let{tab}=_ref2;return tab},_setCurrentTab:(_,_ref3)=>{let{tab}=_ref3;return tab}}],breadcrumbName:["Source",{setBreadcrumbName:(_,_ref4)=>{let{name}=_ref4;return name}}]})),(0,index_esm.selectors)({logicProps:[()=>[(_,props)=>props],props=>props],breadcrumbs:[s=>[s.breadcrumbName],breadcrumbName=>[{key:sceneTypes.x.DataPipelines,name:"Data pipelines",path:urls.j.dataPipelines("overview"),iconType:"data_pipeline"},{key:[sceneTypes.x.DataPipelines,"sources"],name:"Sources",path:urls.j.dataPipelines("sources"),iconType:"data_pipeline"},{key:sceneTypes.x.DataWarehouseSource,name:breadcrumbName,iconType:"data_pipeline"}]]}),(0,lib.actionToUrl)(_ref5=>{let{props,values}=_ref5;return{setCurrentTab:()=>urls.j.dataWarehouseSource(props.id,values.currentTab)}}),(0,lib.urlToAction)(_ref6=>{let{actions,values}=_ref6;return{[urls.j.dataWarehouseSource(":id",":tab")]:params=>{var _params$tab;let possibleTab=null!==(_params$tab=params.tab)&&void 0!==_params$tab?_params$tab:"configuration";params.id?.startsWith("self-managed-")&&(possibleTab="configuration");let tab=DATA_WAREHOUSE_SOURCE_SCENE_TABS.includes(possibleTab)?possibleTab:"configuration";tab!==values.currentTab&&actions._setCurrentTab(tab)}}})]),scene={component:DataWarehouseSourceScene,logic:dataWarehouseSourceSceneLogic,paramsToProps:_ref7=>{let{params:{id}}=_ref7;return{id}}};function DataWarehouseSourceScene(){let{currentTab,logicProps,breadcrumbName}=(0,index_esm.useValues)(dataWarehouseSourceSceneLogic),{setCurrentTab}=(0,index_esm.useActions)(dataWarehouseSourceSceneLogic),{id}=logicProps;if(!id)return(0,jsx_runtime.jsx)(NotFound.T,{object:"Data warehouse source"});let cleanId=id.replace("self-managed-","").replace("managed-",""),tabs=id.startsWith("managed-")?[{label:"Schemas",key:"schemas",content:(0,jsx_runtime.jsx)(Schemas.l,{id:cleanId})},{label:"Syncs",key:"syncs",content:(0,jsx_runtime.jsx)(Syncs,{id:cleanId})},{label:"Configuration",key:"configuration",content:(0,jsx_runtime.jsx)(SourceConfiguration,{id:cleanId})}]:[{label:"Configuration",key:"configuration",content:(0,jsx_runtime.jsx)(DataPipelinesSelfManagedSource,{id:cleanId})}];return(0,jsx_runtime.jsxs)(SceneContent._,{children:[(0,jsx_runtime.jsx)(SceneTitleSection.s,{name:breadcrumbName,resourceType:{type:"data_pipeline"},isLoading:"Source"===breadcrumbName}),(0,jsx_runtime.jsx)(LemonTabs.T,{activeKey:currentTab,tabs:tabs,onChange:setCurrentTab,sceneInset:!0})]})}},"../../frontend/src/scenes/data-warehouse/settings/source/Schemas.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{l:()=>Schemas});var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.35.2_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),dayjs=__webpack_require__("../../frontend/src/lib/dayjs.ts"),More=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/More.tsx"),utils=__webpack_require__("../../frontend/src/scenes/data-warehouse/utils.ts"),teamLogic=__webpack_require__("../../frontend/src/scenes/teamLogic.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),SyncMethodForm=__webpack_require__("../../frontend/src/scenes/data-warehouse/external/forms/SyncMethodForm.tsx"),dataWarehouseSettingsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/dataWarehouseSettingsLogic.ts"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let dataWarehouseSourcesTableSyncMethodModalLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","settings","DataWarehouseSourcesTableSyncMethodModalLogic"]),(0,index_esm.props)({schema:{}}),(0,index_esm.key)(props=>props.schema.id),(0,index_esm.connect)(()=>({actions:[dataWarehouseSettingsLogic.T,["updateSchema","updateSchemaSuccess","updateSchemaFailure","loadSources"]]})),(0,index_esm.actions)({openSyncMethodModal:schema=>({schema}),closeSyncMethodModal:!0}),(0,kea_loaders_lib.loaders)({schemaIncrementalFields:[null,{loadSchemaIncrementalFields:async schemaId=>await api.ZP.externalDataSchemas.incremental_fields(schemaId),resetSchemaIncrementalFields:()=>null}]}),(0,index_esm.reducers)({syncMethodModalIsOpen:[!1,{openSyncMethodModal:()=>!0,closeSyncMethodModal:()=>!1}],currentSyncMethodModalSchema:[null,{openSyncMethodModal:(_,_ref)=>{let{schema}=_ref;return schema},closeSyncMethodModal:()=>null}],saveButtonIsLoading:[!1,{updateSchema:()=>!0,updateSchemaFailure:()=>!1,updateSchemaSuccess:()=>!1}]}),(0,index_esm.listeners)(_ref2=>{let{actions}=_ref2;return{updateSchemaSuccess:()=>{actions.loadSources(null),actions.resetSchemaIncrementalFields(),actions.closeSyncMethodModal()}}})]);var dataWarehouseSourceSettingsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/source/dataWarehouseSourceSettingsLogic.ts"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let REVENUE_ENABLED_SOURCES=["Stripe"],Schemas=_ref=>{var _source$schemas;let{id}=_ref,{source,sourceLoading}=(0,index_esm.useValues)((0,dataWarehouseSourceSettingsLogic.j)({id,availableSources:{}})),{addProductIntentForCrossSell}=(0,index_esm.useActions)(teamLogic.teamLogic);return(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:dataWarehouseSourceSettingsLogic.j,props:{id,availableSources:{}},children:[(0,jsx_runtime.jsx)(SchemaTable,{schemas:null!==(_source$schemas=source?.schemas)&&void 0!==_source$schemas?_source$schemas:[],isLoading:sourceLoading}),source?.source_type&&REVENUE_ENABLED_SOURCES.includes(source.source_type)&&(0,jsx_runtime.jsx)("div",{className:"flex justify-end",children:(0,jsx_runtime.jsxs)(src.Jp,{type:"primary",className:"mt-2",tooltip:"This source is feeding data into our Revenue analytics product - currently in beta.",onClick:()=>{addProductIntentForCrossSell({from:schema_general.Md.DATA_WAREHOUSE,to:schema_general.Md.REVENUE_ANALYTICS,intent_context:schema_general.kp.DATA_WAREHOUSE_STRIPE_SOURCE_CREATED}),lib.router.actions.push(urls.j.revenueAnalytics())},children:["See data in Revenue analytics",(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"warning",size:"small",children:"BETA"})]})})]})},StatusTagSetting={Running:"primary",Completed:"success",Failed:"danger","Billing limits":"danger","Billing limit too low":"danger",Cancelled:"warning",Paused:"warning"},SchemaTable=_ref2=>{let{schemas,isLoading}=_ref2,{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),{updateSchema,reloadSchema,resyncSchema,deleteTable,setIsProjectTime}=(0,index_esm.useActions)(dataWarehouseSourceSettingsLogic.j),{isProjectTime,source}=(0,index_esm.useValues)(dataWarehouseSourceSettingsLogic.j),{schemaReloadingById}=(0,index_esm.useValues)(dataWarehouseSettingsLogic.T),[initialLoad,setInitialLoad]=(0,react.useState)(!0);return(0,react.useEffect)(()=>{initialLoad&&!isLoading&&setInitialLoad(!1)},[isLoading,initialLoad]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.g3,{dataSource:schemas,loading:initialLoad,disableTableWhileLoading:!1,columns:[{title:"Schema Name",key:"name",render:function RenderName(_,schema){return(0,jsx_runtime.jsx)("span",{children:schema.name})}},{title:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)("span",{children:"Anchor Time"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[(0,jsx_runtime.jsx)("span",{children:"UTC"}),currentTeam?.timezone!=="UTC"&&currentTeam?.timezone!=="GMT"&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.f4,{size:"xsmall",checked:isProjectTime,onChange:setIsProjectTime}),(0,jsx_runtime.jsx)("span",{children:currentTeam?.timezone||"UTC"})]})]})]}),tooltip:"The sync frequency will be offset from the anchor time. This will not apply to sync intervals one hour or less.",key:"sync_time_of_day",render:function RenderSyncTimeOfDayLocal(_,schema){return(0,jsx_runtime.jsx)(AnchorTime,{schema:schema})}},{title:"Sync Frequency",key:"frequency",className:"px-1",render:function RenderFrequency(_,schema){return(0,jsx_runtime.jsx)(src.Yv,{className:"my-1",size:"xsmall",disabled:!schema.should_sync,value:schema.sync_frequency||"6hour",onChange:value=>updateSchema({...schema,sync_frequency:value}),options:[{value:"5min",label:"5 mins"},{value:"30min",label:"30 mins"},{value:"1hour",label:"1 hour"},{value:"6hour",label:"6 hours"},{value:"12hour",label:"12 hours"},{value:"24hour",label:"Daily"},{value:"7day",label:"Weekly"},{value:"30day",label:"Monthly"}]})}},{title:"Sync method",key:"incremental",className:"px-1",render:function RenderIncremental(_,schema){let{openSyncMethodModal}=(0,index_esm.useActions)(dataWarehouseSourcesTableSyncMethodModalLogic({schema}));return schema.sync_type?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{className:"my-1",size:"xsmall",type:"secondary",onClick:()=>openSyncMethodModal(schema),children:utils.It[schema.sync_type]}),(0,jsx_runtime.jsx)(SyncMethodModal,{schema:schema})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jp,{className:"my-1",type:"primary",size:"xsmall",onClick:()=>openSyncMethodModal(schema),children:"Set up"}),(0,jsx_runtime.jsx)(SyncMethodModal,{schema:schema})]})}},{title:"Enabled",key:"should_sync",sorter:(a,b)=>Number(a.should_sync)-Number(b.should_sync),render:function RenderShouldSync(_,schema){return(0,jsx_runtime.jsx)(src.f4,{disabledReason:null===schema.sync_type?"You must set up the sync method first":void 0,checked:schema.should_sync,onChange:active=>{updateSchema({...schema,should_sync:active})}})}},{title:"Synced Table",key:"table",render:function RenderTable(_,schema){if(schema.table){let query=(0,utils.wi)(schema.table.name,schema.table.columns);return(0,jsx_runtime.jsx)(src.rU,{to:urls.j.sqlEditor(query.source.query),children:(0,jsx_runtime.jsx)("code",{children:schema.table.name})})}return"Completed"===schema.status?(0,jsx_runtime.jsx)("div",{children:"No rows to query"}):"Running"===schema.status?(0,jsx_runtime.jsx)("div",{children:"Syncing..."}):(0,jsx_runtime.jsx)("div",{children:"Not yet synced"})}},{title:"Last Synced At",key:"last_synced_at",render:function Render(_,schema){return schema.last_synced_at?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(TZLabel.w,{time:schema.last_synced_at,formatDate:"MMM DD, YYYY",formatTime:"HH:mm"})}):null}},{title:"Rows Synced",key:"rows_synced",render:function Render(_,schema){return schema.table?schema.table.row_count.toLocaleString():"Completed"===schema.status?0:""}},{title:"Status",key:"status",render:(_,schema)=>{if(!schema.status)return null;let tagContent=(0,jsx_runtime.jsxs)(src.oe,{type:StatusTagSetting[schema.status]||"default",children:[schema.status,schema.latest_error&&"Failed"===schema.status&&(0,jsx_runtime.jsx)("span",{className:"ml-0.5 inline-flex items-center justify-center w-3 h-3 bg-danger/90 text-white rounded-full text-[10px] font-medium tracking-tight shadow-md backdrop-blur-sm border border-danger/20",children:"?"})]});return schema.latest_error&&"Failed"===schema.status?(0,jsx_runtime.jsx)(src.u,{title:schema.latest_error,children:tagContent}):tagContent}},{key:"actions",width:0,render:function RenderActions(_,schema){return schemaReloadingById[schema.id]?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(src.$j,{})}):(0,jsx_runtime.jsx)("div",{className:"flex flex-row justify-end",children:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(More.T,{overlay:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.u,{title:schema.incremental?"Sync incremental data since the last run.":"Sync all data.",children:(0,jsx_runtime.jsx)(src.Jp,{type:"tertiary",size:"xsmall",fullWidth:!0,id:"data-warehouse-schema-reload",onClick:()=>{reloadSchema(schema)},children:"Sync now"},`reload-data-warehouse-schema-${schema.id}`)}),schema.incremental&&(0,jsx_runtime.jsx)(src.u,{title:"Completely resync incrementally loaded data. Only recommended if there is an issue with data quality in previously imported data.",children:(0,jsx_runtime.jsx)(src.Jp,{type:"tertiary",size:"xsmall",fullWidth:!0,id:"data-warehouse-schema-resync",onClick:()=>{resyncSchema(schema)},status:"danger",children:"Delete table and resync"},`resync-data-warehouse-schema-${schema.id}`)}),schema.table&&(0,jsx_runtime.jsx)(src.u,{title:`Delete this table from PostHog. ${source?.source_type?`This will not delete the data in ${source.source_type}`:""}`,children:(0,jsx_runtime.jsx)(src.Jp,{status:"danger",id:"data-warehouse-schema-delete",type:"tertiary",fullWidth:!0,size:"xsmall",onClick:()=>{window.confirm(`Are you sure you want to delete the table ${schema?.table?.name} from PostHog?`)&&deleteTable(schema)},children:"Delete table from PostHog"})})]})})})})}}]})})},SyncMethodModal=_ref3=>{var _currentSyncMethodMod,_currentSyncMethodMod2,_currentSyncMethodMod3;let{schema}=_ref3,logic=dataWarehouseSourcesTableSyncMethodModalLogic({schema}),{syncMethodModalIsOpen,currentSyncMethodModalSchema,schemaIncrementalFields,schemaIncrementalFieldsLoading,saveButtonIsLoading}=(0,index_esm.useValues)(logic),{closeSyncMethodModal,loadSchemaIncrementalFields,resetSchemaIncrementalFields,updateSchema}=(0,index_esm.useActions)(logic);(0,react.useEffect)(()=>{currentSyncMethodModalSchema?.id&&(resetSchemaIncrementalFields(),loadSchemaIncrementalFields(currentSyncMethodModalSchema.id))},[currentSyncMethodModalSchema?.id,resetSchemaIncrementalFields,loadSchemaIncrementalFields]);let schemaLoading=schemaIncrementalFieldsLoading||!schemaIncrementalFields,showForm=!schemaLoading&&schemaIncrementalFields;return currentSyncMethodModalSchema?(0,jsx_runtime.jsxs)(src.fQ,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Sync method for ",(0,jsx_runtime.jsx)("span",{className:"font-mono",children:currentSyncMethodModalSchema.name})]}),isOpen:syncMethodModalIsOpen,onClose:closeSyncMethodModal,footer:schemaLoading&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.yW.Button,{}),(0,jsx_runtime.jsx)(src.yW.Button,{})]}),children:[schemaLoading&&(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(src.yW,{className:"w-1/2 h-4"}),(0,jsx_runtime.jsx)(src.yW.Row,{repeat:3})]}),showForm&&(0,jsx_runtime.jsx)(SyncMethodForm.m,{saveButtonIsLoading:saveButtonIsLoading,schema:{table:currentSyncMethodModalSchema.name,should_sync:currentSyncMethodModalSchema.should_sync,sync_type:currentSyncMethodModalSchema.sync_type,sync_time_of_day:null!==(_currentSyncMethodMod=currentSyncMethodModalSchema.sync_time_of_day)&&void 0!==_currentSyncMethodMod?_currentSyncMethodMod:"00:00:00",incremental_field:null!==(_currentSyncMethodMod2=currentSyncMethodModalSchema.incremental_field)&&void 0!==_currentSyncMethodMod2?_currentSyncMethodMod2:null,incremental_field_type:null!==(_currentSyncMethodMod3=currentSyncMethodModalSchema.incremental_field_type)&&void 0!==_currentSyncMethodMod3?_currentSyncMethodMod3:null,incremental_available:schemaIncrementalFields.incremental_available,append_available:schemaIncrementalFields.append_available,incremental_fields:schemaIncrementalFields.incremental_fields},onClose:()=>{resetSchemaIncrementalFields(),closeSyncMethodModal()},onSave:(syncType,incrementalField,incrementalFieldType)=>{var _currentSyncMethodMod4,_currentSyncMethodMod5;"full_refresh"===syncType?updateSchema({...currentSyncMethodModalSchema,should_sync:!0,sync_type:syncType,incremental_field:null,incremental_field_type:null,sync_time_of_day:null!==(_currentSyncMethodMod4=currentSyncMethodModalSchema.sync_time_of_day)&&void 0!==_currentSyncMethodMod4?_currentSyncMethodMod4:"00:00:00"}):updateSchema({...currentSyncMethodModalSchema,should_sync:!0,sync_type:syncType,incremental_field:incrementalField,incremental_field_type:incrementalFieldType,sync_time_of_day:null!==(_currentSyncMethodMod5=currentSyncMethodModalSchema.sync_time_of_day)&&void 0!==_currentSyncMethodMod5?_currentSyncMethodMod5:"00:00:00"})}})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})},AnchorTime=_ref4=>{let{schema}=_ref4,{isProjectTime}=(0,index_esm.useValues)(dataWarehouseSourceSettingsLogic.j),{currentTeam}=(0,index_esm.useValues)(teamLogic.teamLogic),{updateSchema}=(0,index_esm.useActions)(dataWarehouseSourceSettingsLogic.j),[isSyncTimeSet,setIsSyncTimeSet]=(0,react.useState)(!!schema.sync_time_of_day),utcTime=schema.sync_time_of_day||"00:00:00",localTime=isProjectTime?dayjs.Bv.utc(`${(0,dayjs.Bv)().format("YYYY-MM-DD")}T${utcTime}`).local().tz(currentTeam?.timezone||"UTC").format("HH:mm:00"):utcTime,disabledReasonForInput=(0,react.useCallback)(()=>schema.should_sync||isSyncTimeSet?schema.should_sync?isSyncTimeSet?"5min"===schema.sync_frequency||"30min"===schema.sync_frequency||"1hour"===schema.sync_frequency?"Anchor time does not apply to sync intervals one hour or less":void 0:"Enable anchor times to set anchor time":"Enable syncing to set anchor time":"Enable syncing and anchor times to set anchor time",[isSyncTimeSet,schema.should_sync,schema.sync_frequency]);return(0,jsx_runtime.jsxs)("div",{className:"flex",children:[(0,jsx_runtime.jsx)(src.DF,{type:"time",size:"xsmall",disabledReason:disabledReasonForInput(),value:isSyncTimeSet?localTime.substring(0,5):void 0,onChange:value=>{let newValue=`${value}:00`,utcValue=isProjectTime?(0,dayjs.Bv)(`${(0,dayjs.Bv)().format("YYYY-MM-DD")}T${newValue}`).tz(currentTeam?.timezone||"UTC").utc().format("HH:mm:00"):newValue;updateSchema({...schema,sync_time_of_day:utcValue})},suffix:isSyncTimeSet?(0,jsx_runtime.jsx)(src.u,{title:(0,utils.HZ)(utcTime,schema.sync_frequency),children:schema.should_sync&&(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"text-muted-alt"})}):void 0}),(0,jsx_runtime.jsx)(src.f4,{className:"ml-2",checked:isSyncTimeSet,disabledReason:!schema.should_sync&&"Enable syncing to set anchor time",onChange:checked=>{setIsSyncTimeSet(checked),updateSchema({...schema,sync_time_of_day:checked?isProjectTime?localTime:utcTime:null})}})]})}},"../../frontend/src/scenes/data-warehouse/settings/source/dataWarehouseSourceSettingsLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>dataWarehouseSourceSettingsLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_forms__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),posthog_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.297.0/node_modules/posthog-js/dist/module.js"),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),lib_api__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/api.ts"),scenes_data_warehouse_new_availableSourcesDataLogic__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/availableSourcesDataLogic.ts"),scenes_data_warehouse_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../frontend/src/scenes/data-warehouse/new/sourceWizardLogic.tsx"),_types__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../frontend/src/types.ts"),_externalDataSourcesLogic__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("../../frontend/src/scenes/data-warehouse/externalDataSourcesLogic.ts"),_DataWarehouseSourceScene__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("../../frontend/src/scenes/data-warehouse/settings/DataWarehouseSourceScene.tsx");let dataWarehouseSourceSettingsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["scenes","data-warehouse","settings","source","dataWarehouseSourceSettingsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(_ref=>{let{id}=_ref;return id}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({values:[scenes_data_warehouse_new_availableSourcesDataLogic__WEBPACK_IMPORTED_MODULE_6__.t,["availableSources"]],actions:[_externalDataSourcesLogic__WEBPACK_IMPORTED_MODULE_9__.W,["updateSource"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setSourceId:id=>({id}),reloadSchema:schema=>({schema}),resyncSchema:schema=>({schema}),deleteTable:schema=>({schema}),setCanLoadMoreJobs:canLoadMoreJobs=>({canLoadMoreJobs}),setIsProjectTime:isProjectTime=>({isProjectTime}),setSelectedSchemas:schemaNames=>({schemaNames})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_2__.loaders)(_ref2=>{let{actions,values}=_ref2;return{source:[null,{loadSource:async()=>await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.externalDataSources.get(values.sourceId),updateSchema:async schema=>{let clonedSource=JSON.parse(JSON.stringify(values.source)),schemaIndex=clonedSource.schemas.findIndex(n=>n.id===schema.id);clonedSource.schemas[schemaIndex]=schema,actions.loadSourceSuccess(clonedSource);let updatedSchema=await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.externalDataSchemas.update(schema.id,{...schema}),source=values.source;return void 0!==schemaIndex&&(source.schemas[schemaIndex]=updatedSchema),source}}],jobs:[[],{loadJobs:async()=>0===values.jobs.length?await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.externalDataSources.jobs(values.sourceId,null,null):[...await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.externalDataSources.jobs(values.sourceId,null,values.jobs[0].created_at),...values.jobs],loadMoreJobs:async()=>{if(values.jobs.length>=0){let lastJobCreatedAt=values.jobs[values.jobs.length-1].created_at,oldJobs=await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.externalDataSources.jobs(values.sourceId,lastJobCreatedAt,null);return 0===oldJobs.length?(actions.setCanLoadMoreJobs(!1),values.jobs):[...values.jobs,...oldJobs]}return values.jobs}}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)(_ref3=>{let{props}=_ref3;return{sourceId:[props.id,{setSourceId:(_,_ref4)=>{let{id}=_ref4;return id}}],canLoadMoreJobs:[!0,{setCanLoadMoreJobs:(_,_ref5)=>{let{canLoadMoreJobs}=_ref5;return canLoadMoreJobs},setSourceId:()=>!0}],isProjectTime:[!1,{setIsProjectTime:(_,_ref6)=>{let{isProjectTime}=_ref6;return isProjectTime}}],selectedSchemas:[[],{setSelectedSchemas:(_,_ref7)=>{let{schemaNames}=_ref7;return schemaNames}}],sourceConfigLoading:[!1,{submitSourceConfigRequest:()=>!0,submitSourceConfigSuccess:()=>!1,submitSourceConfigFailure:()=>!1}]}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({sourceFieldConfig:[s=>[s.source,s.availableSources],(source,availableSources)=>source&&availableSources?availableSources[source.source_type]:null]}),(0,kea_forms__WEBPACK_IMPORTED_MODULE_1__.forms)(_ref8=>{let{values,actions,props}=_ref8;return{sourceConfig:{defaults:(0,scenes_data_warehouse_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_7__.zC)(props.availableSources),errors:sourceValues=>{var _values$sourceFieldCo;return(0,scenes_data_warehouse_new_sourceWizardLogic__WEBPACK_IMPORTED_MODULE_7__.HM)(null!==(_values$sourceFieldCo=values.sourceFieldConfig?.fields)&&void 0!==_values$sourceFieldCo?_values$sourceFieldCo:[],sourceValues)},submit:async _ref9=>{let{payload={}}=_ref9,newJobInputs={...values.source?.job_inputs,...payload},sourceFieldConfig=values.sourceFieldConfig;if(sourceFieldConfig?.fields){for(let field of sourceFieldConfig.fields)if("file-upload"===field.type&&payload[field.name])try{let loadedFile=await new Promise((resolve,reject)=>{let fileReader=new FileReader;fileReader.onload=e=>resolve(e.target?.result),fileReader.onerror=e=>reject(e),fileReader.readAsText(payload[field.name][0])});newJobInputs[field.name]=JSON.parse(loadedFile)}catch{_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error("File is not valid");return}}try{await _externalDataSourcesLogic__WEBPACK_IMPORTED_MODULE_9__.W.asyncActions.updateSource({...values.source,job_inputs:newJobInputs}),actions.loadSource(),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.success("Source updated")}catch(e){e.message?_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Cant update source at this time")}}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref10=>{let{values,actions,props,cache}=_ref10;return{loadSourceSuccess:()=>{var _values$source$source;cache.disposables.add(()=>{let timerId=setTimeout(()=>{actions.loadSource()},5e3);return()=>clearTimeout(timerId)},"sourceRefreshTimeout"),_DataWarehouseSourceScene__WEBPACK_IMPORTED_MODULE_10__.dataWarehouseSourceSceneLogic.findMounted({id:`managed-${props.id}`})?.actions.setBreadcrumbName(null!==(_values$source$source=values.source?.source_type)&&void 0!==_values$source$source?_values$source$source:"Source")},loadSourceFailure:()=>{cache.disposables.add(()=>{let timerId=setTimeout(()=>{actions.loadSource()},5e3);return()=>clearTimeout(timerId)},"sourceRefreshTimeout")},loadJobsSuccess:()=>{cache.disposables.add(()=>{let timerId=setTimeout(()=>{actions.loadJobs()},5e3);return()=>clearTimeout(timerId)},"jobsRefreshTimeout")},loadJobsFailure:()=>{cache.disposables.add(()=>{let timerId=setTimeout(()=>{actions.loadJobs()},5e3);return()=>clearTimeout(timerId)},"jobsRefreshTimeout")},reloadSchema:async _ref11=>{let{schema}=_ref11,clonedSource=JSON.parse(JSON.stringify(values.source)),schemaIndex=clonedSource.schemas.findIndex(n=>n.id===schema.id);clonedSource.status="Running",clonedSource.schemas[schemaIndex].status=_types__WEBPACK_IMPORTED_MODULE_8__.b_.Running,actions.loadSourceSuccess(clonedSource);try{await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.externalDataSchemas.reload(schema.id),posthog_js__WEBPACK_IMPORTED_MODULE_3__.ZP.capture("schema reloaded",{sourceType:clonedSource.source_type})}catch(e){e.message?_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Cant reload schema at this time")}},resyncSchema:async _ref12=>{let{schema}=_ref12,clonedSource=JSON.parse(JSON.stringify(values.source)),schemaIndex=clonedSource.schemas.findIndex(n=>n.id===schema.id);clonedSource.status="Running",clonedSource.schemas[schemaIndex].status=_types__WEBPACK_IMPORTED_MODULE_8__.b_.Running,actions.loadSourceSuccess(clonedSource);try{await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.externalDataSchemas.resync(schema.id),posthog_js__WEBPACK_IMPORTED_MODULE_3__.ZP.capture("schema resynced",{sourceType:clonedSource.source_type})}catch(e){e.message?_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Cant refresh schema at this time")}},deleteTable:async _ref13=>{let{schema}=_ref13,clonedSource=JSON.parse(JSON.stringify(values.source)),schemaIndex=clonedSource.schemas.findIndex(n=>n.id===schema.id);if(-1===schemaIndex){_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Schema not found");return}clonedSource.schemas[schemaIndex].table=void 0,clonedSource.schemas[schemaIndex].status=void 0,clonedSource.schemas[schemaIndex].last_synced_at=void 0,actions.loadSourceSuccess(clonedSource);try{await lib_api__WEBPACK_IMPORTED_MODULE_5__.ZP.externalDataSchemas.delete_data(schema.id),posthog_js__WEBPACK_IMPORTED_MODULE_3__.ZP.capture("schema data deleted",{sourceType:clonedSource.source_type}),_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.success(`Data for ${schema.name} has been deleted`)}catch(e){e.message?_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error(e.message):_posthog_lemon_ui__WEBPACK_IMPORTED_MODULE_4__.UJ.error("Can't delete data at this time")}}}}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref14=>{let{actions}=_ref14;actions.loadSource(),actions.loadJobs()}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.beforeUnmount)(()=>{})])}}]);