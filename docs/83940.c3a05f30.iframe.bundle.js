"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[83940],{"../../frontend/src/lib/components/CyclotronJob/CyclotronJobInputs.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{c:()=>CyclotronJobInputs});var core_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@dnd-kit/core/dist/core.esm.js"),sortable_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+sortable@7.0.2_@dnd-kit+core@6.0.8_react-dom@18.2.0_react@18.2.0__react@18.2.0__react@18.2.0/node_modules/@dnd-kit/sortable/dist/sortable.esm.js"),utilities_esm=__webpack_require__("../../node_modules/.pnpm/@dnd-kit+utilities@3.2.1_react@18.2.0/node_modules/@dnd-kit/utilities/dist/utilities.esm.js"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.22.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),CodeEditorInline=__webpack_require__("../../frontend/src/lib/monaco/CodeEditorInline.tsx"),CodeEditorResizable=__webpack_require__("../../frontend/src/lib/monaco/CodeEditorResizable.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),copyToClipboard=__webpack_require__("../../frontend/src/lib/utils/copyToClipboard.tsx"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),EmailTemplater=__webpack_require__("../../frontend/src/scenes/hog-functions/email-templater/EmailTemplater.tsx");function formatJsonValue(value){return null==value?"{}":"string"!=typeof value?JSON.stringify(value,null,2):value}let cyclotronJobInputLogic=(0,index_esm.kea)({path:["lib","components","CyclotronJob","cyclotronJobInputLogic"],props:{},key:props=>`json_validation_${props.fieldKey}`,actions:{setJsonValue:value=>({value}),validateJson:value=>({value}),setError:error=>({error})},reducers:{jsonValue:["",{setJsonValue:(_state,_ref)=>{let{value}=_ref;return value}}],error:[null,{setError:(_state,_ref2)=>{let{error}=_ref2;return error}}]},selectors:{hasError:[s=>[s.error],error=>!!error]},listeners:_ref3=>{let{actions,props}=_ref3;return{setJsonValue:async(_ref4,breakpoint)=>{let{value}=_ref4;if(!value||""===value.trim()){actions.setError(null);return}props.onChange?.(value),await breakpoint(600);try{JSON.parse(value),actions.setError(null)}catch(e){let errorMessage=e.message||"Invalid JSON";errorMessage.includes("'u'")&&value.includes("undefined")&&(errorMessage="Error: 'undefined' is not allowed in JSON. Use null instead."),actions.setError(errorMessage)}}}},propsChanged(_ref5){let{actions,props}=_ref5;void 0!==props.initialValue&&actions.setJsonValue(formatJsonValue(props.initialValue))}});var FlaggedFeature=__webpack_require__("../../frontend/src/lib/components/FlaggedFeature.tsx"),dist_module=__webpack_require__("../hogvm/typescript/dist/module.js"),fuse_esm=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js");let HOG_USAGE_EXAMPLES=[{key:"ternary",example:"$1 = true ? 'Yes' : 'No'",description:"Ternary operation (if this then that else other)"},{key:"default",example:"$1 ?? 'Default value'",description:"Default value (if this is null or undefined, use this)"}],HOG_STL_EXAMPLES=Object.entries(dist_module.iG).map(_ref=>{let[key,value]=_ref;return{key,example:value.example,description:value.description}}),cyclotronJobTemplateSuggestionsLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(_ref2=>{let{templating}=_ref2;return templating}),(0,index_esm.path)(key=>["components","cyclotron-jobs","cyclotronJobTemplateSuggestionsLogic",key]),(0,index_esm.actions)({setSearch:search=>({search})}),(0,index_esm.reducers)({search:["",{setSearch:(_,_ref3)=>{let{search}=_ref3;return search}}]}),(0,index_esm.selectors)({allOptions:[(_,p)=>[p.templating],templating=>"hog"===templating?[...HOG_USAGE_EXAMPLES,...HOG_STL_EXAMPLES]:[]],optionsFuse:[s=>[s.allOptions],allOptions=>new fuse_esm.Z(allOptions,{keys:["description","example"],threshold:.3})],optionsFiltered:[s=>[s.allOptions,s.optionsFuse,s.search],(allOptions,optionsFuse,search)=>search?optionsFuse.search(search).map(result=>result.item):allOptions]})]);var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function CyclotronJobTemplateSuggestionsItem(_ref){let{option,onSelect}=_ref;return(0,jsx_runtime.jsx)(src.Jp,{fullWidth:!0,role:"menuitem",size:"small",onClick:()=>onSelect(option),children:(0,jsx_runtime.jsxs)("div",{className:"flex-col flex-1",children:[(0,jsx_runtime.jsx)("code",{className:"text-sm font-semibold font-monospace",children:option.example}),(0,jsx_runtime.jsx)("div",{className:"text-xs text-secondary",children:option.description})]})})}function CyclotronJobTemplateSuggestions(_ref2){let{templating,setTemplating,onOptionSelect}=_ref2,logic=cyclotronJobTemplateSuggestionsLogic({templating}),{search,optionsFiltered}=(0,index_esm.useValues)(logic),{setSearch}=(0,index_esm.useActions)(logic);return(0,jsx_runtime.jsxs)("div",{className:"flex overflow-hidden flex-col flex-1 gap-1 max-w-100",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1 p-2 flex-0",children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-1",children:[(0,jsx_runtime.jsx)(src.DF,{type:"search",placeholder:"Search templating options",autoFocus:!0,value:search,onChange:setSearch,fullWidth:!0}),setTemplating?(0,jsx_runtime.jsx)(FlaggedFeature.P,{flag:"cdp-hog-input-liquid",children:(0,jsx_runtime.jsx)(src.Yv,{value:templating,onChange:setTemplating,options:[{label:"Hog",value:"hog"},{label:"Liquid",value:"liquid"}],tooltip:"Change the templating language"})}):null]}),(0,jsx_runtime.jsxs)("div",{className:"text-xs text-secondary",children:["Below are a list of available functions for templating your inputs using ",(0,jsx_runtime.jsx)("b",{children:templating}),"."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/cdp/destinations/customizing-destinations#customizing-payload",children:"Learn more"})]})]}),(0,jsx_runtime.jsxs)("ul",{className:"flex overflow-y-auto flex-col flex-1 gap-px p-2 border-t max-w-100",children:[optionsFiltered.map(value=>(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestionsItem,{option:value,onSelect:onOptionSelect})},value.key)),"liquid"===templating?(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",sideIcon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExternal,{}),to:"https://liquidjs.com/filters/overview.html",targetBlank:!0,children:"Liquid documentation"})}):null]})]})}function CyclotronJobTemplateSuggestionsButton(_ref3){let{onOptionSelect,...props}=_ref3,[showPopover,setShowPopover]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(src.Qw,{closeOnClickInside:!1,visible:showPopover,matchWidth:!1,actionable:!0,onVisibilityChange:visible=>setShowPopover(visible),overlay:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestions,{...props,onOptionSelect:option=>{onOptionSelect(option),setShowPopover(!1)}}),overflowHidden:!0,children:(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode,{}),tooltip:"Supports templating - click to see available options"})})}var IntegrationChoice=__webpack_require__("../../frontend/src/lib/components/CyclotronJob/integrations/IntegrationChoice.tsx");function CyclotronJobInputIntegration(_ref){let{schema,persistForUnload,...props}=_ref;return(0,jsx_runtime.jsx)(IntegrationChoice.a,{...props,schema:schema,integration:schema.integration,redirectUrl:`${window.location.pathname}?integration_target=${schema.key}`,beforeRedirect:()=>persistForUnload?.()})}var lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let googleAdsIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","googleAdsIntegrationLogic",key]),(0,index_esm.actions)({loadGoogleAdsConversionActions:(customerId,parentId)=>({customerId,parentId}),loadGoogleAdsAccessibleAccounts:!0}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{googleAdsConversionActions:[null,{loadGoogleAdsConversionActions:async _ref2=>{let{customerId,parentId}=_ref2;return(await api.ZP.integrations.googleAdsConversionActions(props.id,{customerId,parentId})).conversionActions}}],googleAdsAccessibleAccounts:[null,{loadGoogleAdsAccessibleAccounts:async()=>(await api.ZP.integrations.googleAdsAccounts(props.id)).accessibleAccounts}]}})]),getGoogleAdsAccountOptions=googleAdsAccounts=>googleAdsAccounts?googleAdsAccounts.map(customer=>({key:`${customer.id}/${customer.parent_id}`,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[customer.name," (",customer.id.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3"),")"]}),label:`${customer.name} (${customer.id.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")})`})):null,getGoogleAdsConversionActionOptions=googleAdsConversionActions=>googleAdsConversionActions?googleAdsConversionActions.map(_ref=>{let{id,name}=_ref;return{key:id,labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[name," (",id,")"]}),label:`${name} (${id})`}}):null;function GoogleAdsConversionActionPicker(_ref2){let{onChange,value,requiresFieldValue,integration,disabled}=_ref2,{googleAdsConversionActions,googleAdsConversionActionsLoading}=(0,index_esm.useValues)(googleAdsIntegrationLogic({id:integration.id})),{loadGoogleAdsConversionActions}=(0,index_esm.useActions)(googleAdsIntegrationLogic({id:integration.id})),googleAdsConversionActionOptions=(0,react.useMemo)(()=>getGoogleAdsConversionActionOptions(googleAdsConversionActions),[googleAdsConversionActions]);return(0,react.useEffect)(()=>{requiresFieldValue&&loadGoogleAdsConversionActions(requiresFieldValue.split("/")[0],requiresFieldValue.split("/")[1])},[loadGoogleAdsConversionActions,requiresFieldValue]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!googleAdsConversionActions&&!googleAdsConversionActionsLoading&&requiresFieldValue&&loadGoogleAdsConversionActions(requiresFieldValue.split("/")[0],requiresFieldValue.split("/")[1]),disabled:disabled,mode:"single","data-attr":"select-google-ads-conversion-action",placeholder:"Select a Conversion Action...",options:null!=googleAdsConversionActionOptions?googleAdsConversionActionOptions:value?[{key:value,label:value}]:[],loading:googleAdsConversionActionsLoading})})}function GoogleAdsCustomerIdPicker(_ref3){let{onChange,value,integration,disabled}=_ref3,{googleAdsAccessibleAccounts,googleAdsAccessibleAccountsLoading}=(0,index_esm.useValues)(googleAdsIntegrationLogic({id:integration.id})),{loadGoogleAdsAccessibleAccounts}=(0,index_esm.useActions)(googleAdsIntegrationLogic({id:integration.id})),googleAdsAccountOptions=(0,react.useMemo)(()=>getGoogleAdsAccountOptions(googleAdsAccessibleAccounts),[googleAdsAccessibleAccounts]);return(0,react.useEffect)(()=>{disabled||loadGoogleAdsAccessibleAccounts()},[loadGoogleAdsAccessibleAccounts,disabled]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$2;return onChange?.(null!==(_val$2=val[0])&&void 0!==_val$2?_val$2:null)},value:value?[value]:[],onFocus:()=>!googleAdsAccessibleAccounts&&!googleAdsAccessibleAccountsLoading&&loadGoogleAdsAccessibleAccounts(),disabled:disabled,mode:"single","data-attr":"select-google-ads-customer-id-channel",placeholder:"Select a Customer ID...",options:null!=googleAdsAccountOptions?googleAdsAccountOptions:value?[{key:value,label:value.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}]:[],loading:googleAdsAccessibleAccountsLoading})})}var integrationsLogic=__webpack_require__("../../frontend/src/lib/integrations/integrationsLogic.ts"),preflightLogic=__webpack_require__("../../frontend/src/scenes/PreflightCheck/preflightLogic.tsx");let linearIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","linearIntegrationLogic",key]),(0,index_esm.connect)({values:[preflightLogic.preflightLogic,["siteUrlMisconfigured","preflight"]]}),(0,index_esm.actions)({loadAllLinearTeams:()=>({})}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{linearTeams:[[],{loadAllLinearTeams:async()=>(await api.ZP.integrations.linearTeams(props.id)).teams}]}})]);function LinearTeamPicker(_ref){let{onChange,value,integration,disabled}=_ref,logic=linearIntegrationLogic({id:integration.id}),{linearTeams,linearTeamsLoading}=(0,index_esm.useValues)(logic),{loadAllLinearTeams}=(0,index_esm.useActions)(logic),linearTeamOptions=(0,react.useMemo)(()=>linearTeams?linearTeams.map(x=>({key:x.id,label:x.name})):[],[linearTeams]);return(0,react.useEffect)(()=>{disabled||loadAllLinearTeams()},[loadAllLinearTeams,disabled]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!linearTeams.length&&!linearTeamsLoading&&loadAllLinearTeams(),disabled:disabled,mode:"single","data-attr":"select-linear-team",placeholder:"Select a team...",options:linearTeamOptions,loading:linearTeamsLoading})})}let linkedInAdsIntegrationLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.key)(props=>props.id),(0,index_esm.path)(key=>["lib","integrations","linkedInAdsIntegrationLogic",key]),(0,index_esm.actions)({loadLinkedInAdsConversionRules:accountId=>accountId,loadLinkedInAdsAccounts:!0}),(0,lib.loaders)(_ref=>{let{props}=_ref;return{linkedInAdsConversionRules:[null,{loadLinkedInAdsConversionRules:async customerId=>(await api.ZP.integrations.linkedInAdsConversionRules(props.id,customerId)).conversionRules}],linkedInAdsAccounts:[null,{loadLinkedInAdsAccounts:async()=>(await api.ZP.integrations.linkedInAdsAccounts(props.id)).adAccounts}]}})]),getLinkedInAdsAccountOptions=linkedInAdsAccounts=>linkedInAdsAccounts?linkedInAdsAccounts.map(account=>({key:account.id.toString(),labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[account.name," (",account.id.toString(),")"]}),label:`${account.name}`})):null,getLinkedInAdsConversionRuleOptions=linkedInAdsConversionRules=>linkedInAdsConversionRules?linkedInAdsConversionRules.map(_ref=>{let{id,name}=_ref;return{key:id.toString(),labelComponent:(0,jsx_runtime.jsxs)("span",{className:"flex items-center",children:[name," (",id,")"]}),label:`${name} (${id})`}}):null;function LinkedInAdsConversionRulePicker(_ref2){let{onChange,value,requiresFieldValue,integration,disabled}=_ref2,{linkedInAdsConversionRules,linkedInAdsConversionRulesLoading}=(0,index_esm.useValues)(linkedInAdsIntegrationLogic({id:integration.id})),{loadLinkedInAdsConversionRules}=(0,index_esm.useActions)(linkedInAdsIntegrationLogic({id:integration.id})),linkedInAdsConversionRuleOptions=(0,react.useMemo)(()=>getLinkedInAdsConversionRuleOptions(linkedInAdsConversionRules),[linkedInAdsConversionRules]);return(0,react.useEffect)(()=>{requiresFieldValue&&loadLinkedInAdsConversionRules(requiresFieldValue)},[loadLinkedInAdsConversionRules,requiresFieldValue]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$;return onChange?.(null!==(_val$=val[0])&&void 0!==_val$?_val$:null)},value:value?[value]:[],onFocus:()=>!linkedInAdsConversionRules&&!linkedInAdsConversionRulesLoading&&requiresFieldValue&&loadLinkedInAdsConversionRules(requiresFieldValue),disabled:disabled,mode:"single","data-attr":"select-linkedin-ads-conversion-action",placeholder:"Select a Conversion Action...",options:null!=linkedInAdsConversionRuleOptions?linkedInAdsConversionRuleOptions:value?[{key:value,label:value}]:[],loading:linkedInAdsConversionRulesLoading})})}function LinkedInAdsAccountIdPicker(_ref3){let{onChange,value,integration,disabled}=_ref3,{linkedInAdsAccounts,linkedInAdsAccountsLoading}=(0,index_esm.useValues)(linkedInAdsIntegrationLogic({id:integration.id})),{loadLinkedInAdsAccounts}=(0,index_esm.useActions)(linkedInAdsIntegrationLogic({id:integration.id})),linkedInAdsAccountOptions=(0,react.useMemo)(()=>getLinkedInAdsAccountOptions(linkedInAdsAccounts),[linkedInAdsAccounts]);return(0,react.useEffect)(()=>{disabled||loadLinkedInAdsAccounts()},[loadLinkedInAdsAccounts]),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(src.nt,{onChange:val=>{var _val$2;return onChange?.(null!==(_val$2=val[0])&&void 0!==_val$2?_val$2:null)},value:value?[value]:[],onFocus:()=>!linkedInAdsAccounts&&!linkedInAdsAccountsLoading&&loadLinkedInAdsAccounts(),disabled:disabled,mode:"single","data-attr":"select-linkedin-ads-customer-id-channel",placeholder:"Select a Account ID...",options:null!=linkedInAdsAccountOptions?linkedInAdsAccountOptions:value?[{key:value,label:value.replace(/(\d{3})(\d{3})(\d{4})/,"$1-$2-$3")}]:[],loading:linkedInAdsAccountsLoading})})}var SlackIntegrationHelpers=__webpack_require__("../../frontend/src/lib/integrations/SlackIntegrationHelpers.tsx");function CyclotronJobInputIntegrationField(_ref){var _configuration$inputs,_parentConfiguration$,_configuration$inputs2,_parentConfiguration$2;let requiresFieldValue;let{schema,value,onChange,configuration,parentConfiguration}=_ref,combinedInputs={...null!==(_configuration$inputs=configuration?.inputs)&&void 0!==_configuration$inputs?_configuration$inputs:{},...null!==(_parentConfiguration$=parentConfiguration?.inputs)&&void 0!==_parentConfiguration$?_parentConfiguration$:{}},combinedInputsSchema=[...null!==(_configuration$inputs2=configuration?.inputs_schema)&&void 0!==_configuration$inputs2?_configuration$inputs2:[],...null!==(_parentConfiguration$2=parentConfiguration?.inputs_schema)&&void 0!==_parentConfiguration$2?_parentConfiguration$2:[]],{integrationsLoading,integrations}=(0,index_esm.useValues)(integrationsLogic.a);if(integrationsLoading)return(0,jsx_runtime.jsx)(src.yW,{className:"h-10"});let relatedSchemaIntegration=combinedInputsSchema.find(input=>input.key===schema.integration_key);if(!relatedSchemaIntegration)return(0,jsx_runtime.jsxs)("div",{className:"text-danger",children:["Bad configuration: integration key ",schema.integration_key," not found in schema"]});let integrationId=combinedInputs[relatedSchemaIntegration.key]?.value,integration=integrations?.find(integration=>integration.id===integrationId);if(schema.requires_field){let requiresFieldSchema=combinedInputsSchema.find(input=>input.key===schema.requires_field);if(!requiresFieldSchema)return(0,jsx_runtime.jsxs)("div",{className:"text-danger",children:["Bad configuration: required key ",schema.requires_field," not found in schema"]});let requiresField=combinedInputs?.[requiresFieldSchema.key];if(!(requiresFieldValue=requiresField?.value))return(0,jsx_runtime.jsxs)("div",{className:"p-2 h-10 italic rounded border border-dashed text-secondary",children:["Configure ",requiresFieldSchema.label," to continue"]})}return integration?"slack_channel"===schema.integration_field?(0,jsx_runtime.jsx)(SlackIntegrationHelpers.a,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"google_ads_conversion_action"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(GoogleAdsConversionActionPicker,{value:value,requiresFieldValue:requiresFieldValue,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"google_ads_customer_id"===schema.integration_field?(0,jsx_runtime.jsx)(GoogleAdsCustomerIdPicker,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"linkedin_ads_conversion_rule_id"===schema.integration_field&&requiresFieldValue?(0,jsx_runtime.jsx)(LinkedInAdsConversionRulePicker,{value:value,requiresFieldValue:requiresFieldValue,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"linkedin_ads_account_id"===schema.integration_field?(0,jsx_runtime.jsx)(LinkedInAdsAccountIdPicker,{value:value,onChange:x=>onChange?.(x?.split("|")[0]),integration:integration}):"linear_team"===schema.integration_field?(0,jsx_runtime.jsx)(LinearTeamPicker,{value:value,onChange:x=>onChange?.(x),integration:integration}):(0,jsx_runtime.jsx)("div",{className:"text-danger",children:(0,jsx_runtime.jsxs)("p",{children:["Unsupported integration type: ",schema.integration]})}):(0,jsx_runtime.jsxs)("div",{className:"p-2 h-10 italic rounded border border-dashed text-secondary",children:["Configure ",relatedSchemaIntegration.label," to continue"]})}let INPUT_TYPE_LIST=["string","number","boolean","dictionary","choice","json","integration","email"];function CyclotronJobInputs(_ref){let{configuration,parentConfiguration,onInputSchemaChange,onInputChange,showSource}=_ref;if(!configuration.inputs_schema?.length)return(0,jsx_runtime.jsx)("span",{className:"italic text-secondary",children:"This function does not require any input variables."});let inputSchemas=configuration.inputs_schema,inputSchemaIds=inputSchemas.map(schema=>schema.key);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(core_esm.LB,{collisionDetection:core_esm.pE,onDragEnd:_ref2=>{let{active,over}=_ref2;if(over&&active.id!==over.id){let oldIndex=inputSchemaIds.indexOf(active.id),newIndex=inputSchemaIds.indexOf(over.id);onInputSchemaChange?.(sortable_esm.Rp(inputSchemas,oldIndex,newIndex))}},children:(0,jsx_runtime.jsx)(sortable_esm.Fo,{disabled:!showSource,items:inputSchemaIds,strategy:sortable_esm.qw,children:configuration.inputs_schema?.filter(i=>!i.hidden).map(schema=>jsx_runtime.jsx(CyclotronJobInputWithSchema,{schema:schema,configuration:configuration,parentConfiguration:parentConfiguration,onInputSchemaChange:onInputSchemaChange,onInputChange:onInputChange,showSource:showSource},schema.key))})})})}function JsonConfigField(props){var _props$input$templati;let key=(0,react.useMemo)(()=>`json_field_${(0,utils.Vj)()}`,[]),templatingKind=null!==(_props$input$templati=props.input.templating)&&void 0!==_props$input$templati?_props$input$templati:"hog",logic=cyclotronJobInputLogic({fieldKey:key,initialValue:props.input.value,onChange:value=>props.onChange?.({...props.input,value})}),{error,jsonValue}=(0,index_esm.useValues)(logic),{setJsonValue}=(0,index_esm.useActions)(logic),formattedValue=(0,react.useMemo)(()=>formatJsonValue(props.input.value),[props.input.value]),panels=[{key:1,header:"Click to edit",content:(0,jsx_runtime.jsx)(LemonField.D.Pure,{error:error,children:(0,jsx_runtime.jsxs)("span",{className:(0,clsx_m.default)("group relative",props.className),children:[(0,jsx_runtime.jsx)(CodeEditorResizable.Y,{language:props.templating?"hog"===templatingKind?"hogJson":"liquid":"json",value:formattedValue,embedded:!0,onChange:value=>setJsonValue(value||"{}"),options:{lineNumbers:"off",minimap:{enabled:!1},scrollbar:{vertical:"hidden",verticalScrollbarSize:0}},globals:props.templating?props.sampleGlobalsWithInputs:void 0}),props.templating?(0,jsx_runtime.jsx)("span",{className:"absolute top-0 right-0 z-10 p-px opacity-0 transition-opacity group-hover:opacity-100",children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestionsButton,{templating:templatingKind,value:jsonValue,setTemplating:templating=>props.onChange?.({...props.input,templating}),onOptionSelect:option=>{(0,copyToClipboard.v)(`{${option.example}}`,"template code")}})}):null]})}),className:"p-0"}];return(0,jsx_runtime.jsx)(src.JL,{embedded:!1,panels:panels,size:"xsmall"})}function EmailTemplateField(_ref3){let{value,onChange,sampleGlobalsWithInputs}=_ref3;return(0,jsx_runtime.jsx)(EmailTemplater.N,{variables:sampleGlobalsWithInputs,value:value,onChange:onChange})}function CyclotronJobTemplateInput(props){var _props$input$templati2,_props$input$value;let templating=null!==(_props$input$templati2=props.input.templating)&&void 0!==_props$input$templati2?_props$input$templati2:"hog";return props.templating?(0,jsx_runtime.jsxs)("span",{className:(0,clsx_m.default)("group relative",props.className),children:[(0,jsx_runtime.jsx)(CodeEditorInline.s,{minHeight:"37",value:null!==(_props$input$value=props.input.value)&&void 0!==_props$input$value?_props$input$value:"",onChange:val=>props.onChange?.({...props.input,value:null!=val?val:""}),language:"hog"===props.input.templating?"hogTemplate":"liquid",globals:props.sampleGlobalsWithInputs}),(0,jsx_runtime.jsx)("span",{className:"absolute top-0 right-0 z-10 p-px opacity-0 transition-opacity group-hover:opacity-100",children:(0,jsx_runtime.jsx)(CyclotronJobTemplateSuggestionsButton,{templating:templating,value:props.input.value,setTemplating:templating=>props.onChange?.({...props.input,templating}),onOptionSelect:option=>{props.onChange?.({...props.input,value:`${props.input.value} {${option.example}}`})}})})]}):(0,jsx_runtime.jsx)(src.DF,{type:"text",value:props.input.value,onChange:val=>props.onChange?.({...props.input,value:val})})}function DictionaryField(_ref4){var _input$value;let{input,onChange,templating}=_ref4,value=null!==(_input$value=input.value)&&void 0!==_input$value?_input$value:{},[entries,setEntries]=(0,react.useState)(Object.entries(value)),prevFilteredEntriesRef=(0,react.useRef)(entries);return(0,react.useEffect)(()=>{let filteredEntries=entries.filter(_ref5=>{let[key,val]=_ref5;return""!==key.trim()||""!==val.trim()});if((0,utils.h0)(filteredEntries,prevFilteredEntriesRef.current))return;prevFilteredEntriesRef.current=filteredEntries;let val=Object.fromEntries(filteredEntries);onChange?.({...input,value:val})},[entries,onChange]),(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[entries.map((_ref6,index)=>{let[key,val]=_ref6;return(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.DF,{value:key,className:"flex-1 min-w-60",onChange:key=>{let newEntries=[...entries];newEntries[index]=[key,newEntries[index][1]],setEntries(newEntries)},placeholder:"Key"}),(0,jsx_runtime.jsx)(CyclotronJobTemplateInput,{className:"overflow-hidden flex-2",input:{...input,value:val},onChange:val=>{var _val$value;let newEntries=[...entries];newEntries[index]=[newEntries[index][0],null!==(_val$value=val.value)&&void 0!==_val$value?_val$value:""],val.templating&&onChange?.({...input,templating:val.templating}),setEntries(newEntries)},templating:templating}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),size:"small",onClick:()=>{let newEntries=[...entries];newEntries.splice(index,1),setEntries(newEntries)}})]},index)}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),size:"small",type:"secondary",onClick:()=>{setEntries([...entries,["",""]])},children:"Add entry"})]})}function CyclotronJobInputRenderer(_ref7){var _schema$templating,_schema$choices;let{onChange,schema,disabled,input,configuration,parentConfiguration}=_ref7,templating=null===(_schema$templating=schema.templating)||void 0===_schema$templating||_schema$templating,onValueChange=value=>onChange?.({...input,value});switch(schema.type){case"string":return(0,jsx_runtime.jsx)(CyclotronJobTemplateInput,{input:input,onChange:disabled?()=>{}:onChange,className:"ph-no-capture",templating:templating});case"number":return(0,jsx_runtime.jsx)(src.DF,{type:"number",value:input.value,onChange:onValueChange,className:"ph-no-capture"});case"json":return(0,jsx_runtime.jsx)(JsonConfigField,{input:input,onChange:onChange,className:"ph-no-capture",templating:templating});case"choice":return(0,jsx_runtime.jsx)(src.Yv,{fullWidth:!0,value:input.value,className:"ph-no-capture",onChange:onValueChange,options:null!==(_schema$choices=schema.choices)&&void 0!==_schema$choices?_schema$choices:[],disabled:disabled});case"dictionary":return(0,jsx_runtime.jsx)(DictionaryField,{input:input,onChange:onChange,templating:templating});case"boolean":return(0,jsx_runtime.jsx)(src.f4,{checked:input.value,onChange:checked=>onValueChange(checked),disabled:disabled});case"integration":return(0,jsx_runtime.jsx)(CyclotronJobInputIntegration,{schema:schema,value:input.value,onChange:onValueChange});case"integration_field":return(0,jsx_runtime.jsx)(CyclotronJobInputIntegrationField,{schema:schema,value:input.value,onChange:onValueChange,parentConfiguration:parentConfiguration,configuration:configuration});case"email":return(0,jsx_runtime.jsx)(EmailTemplateField,{schema:schema,value:input.value,onChange:onValueChange});default:return(0,jsx_runtime.jsxs)("strong",{className:"text-danger",children:['Unknown field type "',(0,jsx_runtime.jsx)("code",{children:schema.type}),'".']})}}function CyclotronJobInputSchemaControls(_ref8){let{value,onChange,onDone,configuration,parentConfiguration}=_ref8,_onChange=data=>{if(data?.key?.length===0){setLocalVariableError("Input variable name cannot be empty");return}onChange(data?{...value,...data}:null)},[localVariableValue,setLocalVariableValue]=(0,react.useState)(value.key),[localVariableError,setLocalVariableError]=(0,react.useState)(null);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap flex-1 gap-2 items-center",children:[(0,jsx_runtime.jsx)(src.Yv,{size:"small",options:INPUT_TYPE_LIST.map(type=>({label:(0,utils.fm)(type),value:type})),value:value.type,className:"w-30",onChange:type=>_onChange({type})}),(0,jsx_runtime.jsx)(src.Hw,{size:"small",checked:value.required,onChange:required=>_onChange({required}),label:"Required",bordered:!0}),(0,jsx_runtime.jsx)(src.Hw,{size:"small",checked:value.secret,onChange:secret=>_onChange({secret}),label:"Secret",bordered:!0}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(src.Jp,{status:"danger",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),size:"small",onClick:()=>onChange(null)}),(0,jsx_runtime.jsx)(src.Jp,{type:"secondary",size:"small",onClick:()=>onDone(),children:"Done"})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-wrap flex-1 gap-2",children:[(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Display label",children:(0,jsx_runtime.jsx)(src.DF,{className:"min-w-60",size:"small",value:value.label,onChange:label=>_onChange({label}),placeholder:"Display label"})}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Input variable name",error:localVariableError,children:(0,jsx_runtime.jsx)(src.DF,{size:"small",value:localVariableValue,onChange:key=>setLocalVariableValue(key),onBlur:()=>_onChange({key:localVariableValue}),placeholder:"Variable name"})})]}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Description",children:(0,jsx_runtime.jsx)(src._V,{minRows:1,value:value.description,onChange:description=>_onChange({description}),placeholder:"Description"})}),"choice"===value.type&&(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Choices",children:(0,jsx_runtime.jsx)(src.nt,{mode:"multiple",allowCustomValues:!0,value:value.choices?.map(choice=>choice.value),onChange:choices=>_onChange({choices:choices.map(value=>({label:value,value}))}),placeholder:"Choices"})}),"integration"===value.type&&(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Integration kind",children:(0,jsx_runtime.jsx)(src.Yv,{value:value.integration,onChange:integration=>_onChange({integration}),options:[{label:"Slack",value:"slack"},{label:"Salesforce",value:"salesforce"},{label:"Hubspot",value:"hubspot"}],placeholder:"Choose kind"})}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Default value",children:(0,jsx_runtime.jsx)(CyclotronJobInputRenderer,{schema:value,input:{value:value.default},onChange:val=>_onChange({default:val.value}),configuration:configuration,parentConfiguration:parentConfiguration})})]})}function CyclotronJobInputWithSchema(_ref9){var _configuration$inputs;let{schema,configuration,parentConfiguration,onInputSchemaChange,onInputChange,showSource}=_ref9,{attributes,listeners,setNodeRef,transform,transition}=(0,sortable_esm.nB)({id:schema.key}),[editing,setEditing]=(0,react.useState)(!1),value=null!==(_configuration$inputs=configuration.inputs?.[schema.key])&&void 0!==_configuration$inputs?_configuration$inputs:{value:null};return(0,react.useEffect)(()=>{showSource||setEditing(!1)},[showSource]),(0,jsx_runtime.jsx)("div",{ref:setNodeRef,style:{transform:utilities_esm.ux.Transform.toString(transform),transition},children:editing?(0,jsx_runtime.jsx)("div",{className:"p-2 rounded border border-dashed deprecated-space-y-4",children:(0,jsx_runtime.jsx)(CyclotronJobInputSchemaControls,{value:schema,onChange:newSchema=>{let inputsSchema=configuration.inputs_schema||[];if(newSchema){let modifiedSchema={...schema,...newSchema};inputsSchema=inputsSchema.map(s=>s.key===schema.key?modifiedSchema:s)}else inputsSchema=inputsSchema.filter(s=>s.key!==schema.key);newSchema?.key&&onInputChange?.(newSchema.key,value),newSchema?.type&&newSchema.type!==schema.type&&onInputChange?.(schema.key,{value:null}),onInputSchemaChange?.(inputsSchema)},onDone:()=>setEditing(!1),configuration:configuration,parentConfiguration:parentConfiguration})}):(0,jsx_runtime.jsx)(LemonField.D,{name:`inputs.${schema.key}`,help:schema.description,children:_ref10=>{let{value,onChange:_onChange}=_ref10,onChange=newValue=>{_onChange({...value,...newValue})};return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,jsx_runtime.jsxs)(src.HQ,{className:showSource?"cursor-grab":"",showOptional:!schema.required,...attributes,...listeners,children:[schema.label||schema.key,schema.secret?(0,jsx_runtime.jsx)(src.u,{title:"This input is marked as secret. It will be encrypted and not visible after saving.",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconLock,{})}):void 0]}),showSource&&(0,jsx_runtime.jsxs)(src.oe,{type:"muted",className:"font-mono",children:["inputs.",schema.key]}),(0,jsx_runtime.jsx)("div",{className:"flex-1"}),showSource&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",noPadding:!0,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>setEditing(!0)})]}),value?.secret?(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center p-1 rounded border border-dashed",children:[(0,jsx_runtime.jsx)("span",{className:"flex-1 p-1 italic text-secondary",children:"This value is secret and is not displayed here."}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>{onChange({value:""})},size:"small",type:"secondary",children:"Edit"})]}):(0,jsx_runtime.jsx)(CyclotronJobInputRenderer,{schema:schema,input:null!=value?value:{value:""},onChange:onChange,configuration:configuration,parentConfiguration:parentConfiguration})]})}})})}},"../../frontend/src/scenes/hog-functions/email-templater/EmailTemplater.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{N:()=>EmailTemplater});var src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.5_react@18.2.0_/node_modules/kea-forms/lib/index.js"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),CodeEditorInline=__webpack_require__("../../frontend/src/lib/monaco/CodeEditorInline.tsx"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),dist=__webpack_require__("../../node_modules/.pnpm/react-email-editor@1.7.11_react@18.2.0/node_modules/react-email-editor/dist/index.js"),kea_loaders_lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.5_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts"),types=__webpack_require__("../../frontend/src/types.ts");let emailTemplaterLogic=(0,index_esm.kea)([(0,index_esm.props)({}),(0,index_esm.path)(["scenes","hog-functions","email-templater","emailTemplaterLogic"]),(0,index_esm.actions)({setEmailEditorRef:emailEditorRef=>({emailEditorRef}),onEmailEditorReady:!0,setIsModalOpen:isModalOpen=>({isModalOpen}),applyTemplate:template=>({template}),closeWithConfirmation:!0}),(0,index_esm.reducers)({emailEditorRef:[null,{setEmailEditorRef:(_,_ref)=>{let{emailEditorRef}=_ref;return emailEditorRef}}],isEmailEditorReady:[!1,{setIsModalOpen:()=>!1,onEmailEditorReady:()=>!0}],isModalOpen:[!1,{setIsModalOpen:(_,_ref2)=>{let{isModalOpen}=_ref2;return isModalOpen}}],appliedTemplate:[null,{applyTemplate:(_,_ref3)=>{let{template}=_ref3;return template}}]}),(0,kea_loaders_lib.loaders)(()=>({templates:[[],{loadTemplates:async()=>(await api.ZP.messaging.getTemplates()).results}],personPropertyDefinitions:[[],{loadPersonPropertyDefinitions:async()=>(await api.ZP.propertyDefinitions.list({type:types.ll.Person,limit:1e3})).results}]})),(0,index_esm.selectors)({logicProps:[()=>[(_,props)=>props],props=>props],mergeTags:[s=>[s.personPropertyDefinitions],personPropertyDefinitions=>{let tags={};return personPropertyDefinitions.forEach(property=>{tags[property.name]={name:property.name,value:`{{person.properties["${property.name}"]}}`,sample:property.example||`Sample ${property.name}`}}),tags}]}),(0,lib.forms)(_ref4=>{let{actions,values,props}=_ref4;return{emailTemplate:{defaults:{from:"",subject:"",to:"",html:"",design:null,text:""},submit:async value=>{let editor=values.emailEditorRef?.editor;if(!editor||!values.isEmailEditorReady)return;let[htmlData,textData]=await Promise.all([new Promise(res=>editor.exportHtml(res)),new Promise(res=>editor.exportPlainText(res))]),finalValues={...value,html:escapeHTMLStringCurlies(htmlData.html),text:textData.text,design:htmlData.design};props.onChange(finalValues),actions.setIsModalOpen(!1)}}}}),(0,index_esm.listeners)(_ref5=>{let{props,values,actions}=_ref5;return{onEmailEditorReady:()=>{props.value?.design&&values.emailEditorRef?.editor?.loadDesign(props.value.design)},setEmailTemplateValue:_ref6=>{let{name,value}=_ref6;if(values.isModalOpen||"html"===name)return;let key=Array.isArray(name)?name[0]:name;props.onChange({...props.value,[key]:value})},applyTemplate:_ref7=>{let{template}=_ref7,emailTemplateContent=template.content.email;actions.setEmailTemplateValues(emailTemplateContent)},closeWithConfirmation:()=>{values.emailTemplateChanged?src.dn.open({title:"Discard changes",description:"Are you sure you want to discard your changes?",primaryButton:{onClick:()=>{var _props$value;actions.resetEmailTemplate(null!==(_props$value=props.value)&&void 0!==_props$value?_props$value:void 0),actions.setIsModalOpen(!1)},children:"Discard"},secondaryButton:{children:"Keep editing"}}):actions.setIsModalOpen(!1)}}}),(0,index_esm.propsChanged)((_ref8,oldProps)=>{let{actions,props}=_ref8;props.value&&!(0,utils.h0)(props.value,oldProps.value)&&actions.resetEmailTemplate(props.value)}),(0,index_esm.afterMount)(_ref9=>{let{actions,props}=_ref9;props.value&&actions.resetEmailTemplate(props.value),actions.loadTemplates(),actions.loadPersonPropertyDefinitions()})]);function escapeHTMLStringCurlies(htmlString){let doc=new DOMParser().parseFromString(htmlString,"text/html");function escapeCurlyBraces(text){return text.replace(/{/g,"\\{")}function processNode(node){node.nodeType===Node.ELEMENT_NODE?"STYLE"===node.tagName||"SCRIPT"===node.tagName?node.textContent=escapeCurlyBraces(node.textContent||""):Array.from(node.childNodes).forEach(processNode):node.nodeType===Node.COMMENT_NODE&&(node.nodeValue=escapeCurlyBraces(node.nodeValue||""))}return processNode(doc.head),processNode(doc.body),new XMLSerializer().serializeToString(doc)}var jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function EmailTemplaterForm(_ref){let{mode}=_ref,{logicProps,appliedTemplate,templates,templatesLoading,mergeTags}=(0,index_esm.useValues)(emailTemplaterLogic),{setEmailEditorRef,onEmailEditorReady,setIsModalOpen,applyTemplate}=(0,index_esm.useActions)(emailTemplaterLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),isMessagingTemplatesEnabled=featureFlags[constants.y8.MESSAGING_LIBRARY];return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[isMessagingTemplatesEnabled&&templates.length>0&&(0,jsx_runtime.jsx)(src.Yv,{className:"mb-2",placeholder:"Start from a template (optional)",loading:templatesLoading,value:appliedTemplate?.id,options:templates.map(template=>({label:template.name,value:template.id})),onChange:id=>{let template=templates.find(t=>t.id===id);template&&applyTemplate(template)},"data-attr":"email-template-selector"}),(0,jsx_runtime.jsxs)(lib.Form,{className:"flex overflow-hidden flex-col flex-1 rounded border",logic:emailTemplaterLogic,props:logicProps,formKey:"emailTemplate",children:[(logicProps.emailMetaFields||["from","to","subject"]).map(field=>(0,jsx_runtime.jsx)(LemonField.D,{name:field,className:"gap-1 pl-2 border-b shrink-0",renderError:()=>null,children:_ref2=>{let{value,onChange,error}=_ref2;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center",children:[(0,jsx_runtime.jsx)(src.HQ,{className:error?"text-danger":"",children:(0,utils.fm)(field)}),(0,jsx_runtime.jsx)(CodeEditorInline.s,{embedded:!0,className:"flex-1",globals:logicProps.variables,value:value,onChange:onChange})]})}},field)),"full"===mode?(0,jsx_runtime.jsx)(dist.default,{ref:r=>setEmailEditorRef(r),onReady:()=>onEmailEditorReady(),minHeight:20,options:{mergeTags,displayMode:"email",features:{preview:!0,imageEditor:!0,stockImages:!1}}}):(0,jsx_runtime.jsx)(LemonField.D,{name:"html",className:"flex relative flex-col",children:_ref3=>{let{value}=_ref3;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex absolute inset-0 justify-center items-end p-2 opacity-0 transition-opacity hover:opacity-100",children:[(0,jsx_runtime.jsx)("div",{className:"absolute inset-0 opacity-50 bg-surface-primary"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",size:"small",onClick:()=>setIsModalOpen(!0),children:"Click to modify content"})]}),(0,jsx_runtime.jsx)("iframe",{srcDoc:value,className:"flex-1"})]})}})]})]})}function EmailTemplaterModal(){let{isModalOpen,isEmailEditorReady,emailTemplateChanged}=(0,index_esm.useValues)(emailTemplaterLogic),{closeWithConfirmation,submitEmailTemplate}=(0,index_esm.useActions)(emailTemplaterLogic);return(0,jsx_runtime.jsx)(src.fQ,{isOpen:isModalOpen,width:"90vw",onClose:()=>closeWithConfirmation(),hasUnsavedInput:emailTemplateChanged,children:(0,jsx_runtime.jsx)("div",{className:"h-[80vh] flex",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,jsx_runtime.jsx)("div",{className:"shrink-0",children:(0,jsx_runtime.jsx)("h2",{children:"Editing email template"})}),(0,jsx_runtime.jsx)(EmailTemplaterForm,{mode:"full"}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center mt-2",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1"}),(0,jsx_runtime.jsx)(src.Jp,{onClick:()=>closeWithConfirmation(),children:"Discard changes"}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>submitEmailTemplate(),disabledReason:isEmailEditorReady?void 0:"Loading email editor...",children:"Save"})]})]})})})}function EmailTemplater(props){return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:emailTemplaterLogic,props:props,children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,jsx_runtime.jsx)(EmailTemplaterForm,{mode:"preview"}),(0,jsx_runtime.jsx)(EmailTemplaterModal,{})]})})}}}]);