(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"./frontend/src/scenes/session-recordings/SessionRecordingsTable.tsx":function(Z,j,e){"use strict";e.d(j,"a",function(){return R});var $=e("./node_modules/core-js/modules/es.array.filter.js"),Re=e("./node_modules/react/index.js"),o=e.n(Re),M=e("./node_modules/kea/lib/index.esm.js"),oe=e("./frontend/src/lib/utils.tsx"),D=e("./node_modules/antd/es/row/index.js"),W=e("./node_modules/antd/es/col/index.js"),Y=e("./node_modules/antd/es/button/index.js"),w=e("./node_modules/antd/es/typography/index.js"),Oe=e("./frontend/src/scenes/session-recordings/sessionRecordingsTableLogic.ts"),ae=e("./node_modules/@ant-design/icons/es/icons/PlayCircleOutlined.js"),x=e("./node_modules/@ant-design/icons/es/icons/InfoCircleOutlined.js"),ie=e("./node_modules/@ant-design/icons/es/icons/CalendarOutlined.js"),k=e("./frontend/src/scenes/session-recordings/SessionPlayerDrawer.tsx"),le=e("./frontend/src/scenes/insights/ActionFilter/ActionFilter.tsx"),q=e("./node_modules/@ant-design/icons/es/icons/LeftOutlined.js"),ce=e("./node_modules/@ant-design/icons/es/icons/RightOutlined.js"),ee=e("./frontend/src/types.ts"),de=e("./node_modules/antd/es/space/index.js"),ue=e("./node_modules/antd/es/input/index.js"),A=e("./node_modules/antd/es/select/index.js"),me=e("./frontend/src/lib/components/PropertyFilters/components/OperatorValueSelect.tsx"),fe=e("./frontend/src/lib/components/Popup/Popup.tsx"),ge=e("./node_modules/core-js/modules/es.array.iterator.js"),te=e("./node_modules/core-js/modules/es.array.slice.js"),De=e("./node_modules/core-js/modules/es.object.to-string.js"),pe=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),U;(function(a){a.SECONDS="seconds",a.MINUTES="minutes",a.HOURS="hours"})(U||(U={}));var I={seconds:1,minutes:60,hours:3600},ve=Object(M.kea)({path:function(i){return["scenes","session-recordings","DurationFilterLogic",i]},key:function(i){return i.pageKey||"global"},props:{},actions:{setTimeValue:function(i){return{timeValue:i}},setUnit:function(i){return{unit:i}},setIsOpen:function(i){return{isOpen:i}},setOperator:function(i){return{operator:i}}},reducers:function(i){var m,l=i.props;return{unit:[U.MINUTES,{setUnit:function(c,f){var g=f.unit;return g}}],operator:[l==null||(m=l.initialFilter)===null||m===void 0?void 0:m.operator,{setOperator:function(c,f){var g=f.operator;return g}}],timeValue:[Math.floor(l.initialFilter.value/I[U.MINUTES]),{setTimeValue:function(c,f){var g=f.timeValue;return g}}],isOpen:[!1,{setIsOpen:function(c,f){var g=f.isOpen;return g}}]}},selectors:{durationString:[function(a){return[a.operator,a.timeValue,a.unit]},function(a,i,m){var l="";return a===ee.z.GreaterThan?l+="> ":l+="< ",l+=i,i===1?l+=" "+m.slice(0,-1):l+=" "+m,l}]},listeners:function(i){var m=i.props,l=i.values,d=function(f){var g=f.timeValue,H=f.unit,Q=f.operator,h=g||l.timeValue,B=H||l.unit,V=h*I[B];m.onChange({operator:Q||l.operator,value:V,type:"recording",key:"duration"})};return{setTimeValue:function(f){var g=f.timeValue;return d({timeValue:g})},setUnit:function(f){var g=f.unit;return d({unit:g})},setOperator:function(f){var g=f.operator;return d({operator:g})}}}});function N(a){var i=a.initialFilter,m=a.onChange,l=a.pageKey,d=ve({initialFilter:i,onChange:m,pageKey:l}),c=Object(M.useActions)(d),f=c.setTimeValue,g=c.setIsOpen,H=c.setOperator,Q=c.setUnit,h=Object(M.useValues)(d),B=h.durationString,V=h.unit,J=h.timeValue,X=h.operator,Ee=h.isOpen;return o.a.createElement(fe.a,{visible:Ee,placement:"bottom-end",fallbackPlacements:["bottom-start"],onClickOutside:function(){return g(!1)},overlay:o.a.createElement(D.a,null,o.a.createElement(de.b,null,o.a.createElement(me.a,{operator:X,operators:[ee.z.GreaterThan,ee.z.LessThan],onChange:function(v){H(v)}}),o.a.createElement(ue.a,{type:"number",value:J,placeholder:"0",min:0,autoFocus:!0,addonAfter:o.a.createElement(A.a,{showSearch:!1,value:V,onChange:function(v){Q(v)}},o.a.createElement(A.a.Option,{value:"seconds"},"Seconds"),o.a.createElement(A.a.Option,{value:"minutes"},"Minutes"),o.a.createElement(A.a.Option,{value:"hours"},"Hours")),step:1,onChange:function(v){var Pe=parseFloat(v.target.value);f(Pe)}})))},o.a.createElement(Y.a,{onClick:function(){g(!0)}},B))}try{N.displayName="DurationFilter",N.__docgenInfo={description:"",displayName:"DurationFilter",props:{initialFilter:{defaultValue:null,description:"",name:"initialFilter",required:!0,type:{name:"RecordingDurationFilter"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(value: RecordingDurationFilter) => void"}},pageKey:{defaultValue:null,description:"",name:"pageKey",required:!0,type:{name:"string"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/session-recordings/DurationFilter.tsx#DurationFilter"]={docgenInfo:N.__docgenInfo,name:"DurationFilter",path:"frontend/src/scenes/session-recordings/DurationFilter.tsx#DurationFilter"})}catch(a){}var ne=e("./frontend/src/scenes/persons/PersonHeader.tsx"),y=e("./frontend/src/lib/utils/eventUsageLogic.ts"),G=e("./frontend/src/lib/components/DateFilter/DateFilter.tsx"),z=e("./frontend/src/lib/components/Tooltip.tsx"),T=e("./frontend/src/lib/components/TaxonomicFilter/types.ts"),re=e("./frontend/src/lib/components/PropertyFilters/PropertyFilters.tsx"),ye=e("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),n=e.n(ye),s=e("./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/session-recordings/SessionRecordingTable.scss"),r=e.n(s),t={};t.insert="head",t.singleton=!1;var u=n()(r.a,t),P=r.a.locals||{},F=e("./frontend/src/lib/components/LemonTable/index.ts"),C=e("./frontend/src/lib/components/TimezoneAware/index.tsx"),b=e("./frontend/src/lib/components/icons.tsx"),K=e("./frontend/src/lib/components/LemonButton/index.ts"),_=e("./frontend/src/scenes/insights/ActionFilter/ActionFilterRow/ActionFilterRow.tsx");function S(a){var i=a.filter,m=a.propertyFiltersButton,l=a.deleteButton;return o.a.createElement(D.a,{className:"entity-filter-row",wrap:!1,align:"middle"},o.a.createElement(W.a,{flex:"1",className:"mr"},o.a.createElement(D.a,{align:"middle"},i)),o.a.createElement(W.a,{className:"mr"},m),o.a.createElement(W.a,null,l))}function R(a){var i=a.personUUID,m=a.isPersonPage,l=m===void 0?!1:m,d=Object(Oe.a)({personUUID:i}),c=Object(M.useValues)(d),f=c.sessionRecordings,g=c.sessionRecordingsResponseLoading,H=c.sessionRecordingId,Q=c.entityFilters,h=c.propertyFilters,B=c.hasNext,V=c.hasPrev,J=c.fromDate,X=c.toDate,Ee=c.durationFilter,L=c.showFilters,v=Object(M.useActions)(d),Pe=v.openSessionPlayer,Te=v.closeSessionPlayer,Fe=v.setEntityFilters,he=v.setPropertyFilters,be=v.loadNext,Se=v.loadPrev,je=v.setDateRange,Ie=v.setDurationFilter,Ce=v.enableFilter,se=v.reportRecordingsListFilterAdded,_e=[{title:"Start time",render:function(p,O){return o.a.createElement(C.b,{time:O.start_time,formatString:"MMMM DD, YYYY h:mm"})}},{title:"Duration",render:function(p,O){return o.a.createElement("span",null,Object(oe.N)(O.recording_duration))}},{title:"Person",key:"person",render:function(p,O){return o.a.createElement(ne.a,{withIcon:!0,person:O.person})}},{render:function(p,O){return o.a.createElement("div",{className:"play-button-container"},o.a.createElement(Y.a,{className:O.viewed?"play-button viewed":"play-button","data-attr":"session-recordings-button",icon:o.a.createElement(ae.a,null)},"Watch recording"))}}];return o.a.createElement("div",{className:"session-recordings-table","data-attr":"session-recordings-table"},o.a.createElement(D.a,{className:"filter-row"},o.a.createElement("div",{className:"filter-container",style:{display:L?void 0:"none"}},o.a.createElement("div",null,o.a.createElement(w.a.Text,{strong:!0},"Filter by events and actions ",o.a.createElement(z.a,{title:"Show recordings where all of the events or actions listed below happen."},o.a.createElement(x.a,{className:"info-icon"}))),o.a.createElement(le.a,{fullWidth:!0,filters:Q,setFilters:function(p){se(y.e.EventAndAction),Fe(p)},typeKey:l?"person-".concat(i):"session-recordings",mathAvailability:_.b.None,buttonCopy:"Add another filter",horizontalUI:!0,stripeActionRow:!1,propertyFilterWrapperClassName:"session-recording-action-property-filter",customRowPrefix:"",hideRename:!0,showOr:!0,renderRow:function(p){return o.a.createElement(S,p)},showNestedArrow:!1,actionsTaxonomicGroupTypes:[T.a.Actions,T.a.Events],propertiesTaxonomicGroupTypes:[T.a.EventProperties,T.a.Elements]})),!l&&o.a.createElement("div",{className:"mt-2"},o.a.createElement(w.a.Text,{strong:!0},"Filter by persons and cohorts ",o.a.createElement(z.a,{title:"Show recordings by persons who match the set criteria"},o.a.createElement(x.a,{className:"info-icon"}))),o.a.createElement(re.a,{popoverPlacement:"bottomRight",pageKey:l?"person-".concat(i):"session-recordings",taxonomicGroupTypes:[T.a.PersonProperties,T.a.Cohorts],propertyFilters:h,onChange:function(p){se(y.e.PersonAndCohort),he(p)}}))),!L&&o.a.createElement(K.a,{type:"secondary",compact:!0,icon:o.a.createElement(b.IconFilter,null),onClick:function(){if(Ce(),l){var p=document.querySelectorAll(".entity-filter-row button");p.length>0&&p[0].click()}}},"Filter recordings"),o.a.createElement(D.a,{className:"time-filter-row"},o.a.createElement(D.a,{className:"time-filter"},o.a.createElement(G.a,{makeLabel:function(p){return o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null),o.a.createElement("span",null," ",p))},defaultValue:"Last 7 days",bordered:!0,dateFrom:J!=null?J:void 0,dateTo:X!=null?X:void 0,onChange:function(p,O){se(y.e.DateRange),je(p,O)},dateOptions:{Custom:{values:[]},"Last 24 hours":{values:["-24h"]},"Last 7 days":{values:["-7d"]},"Last 21 days":{values:["-21d"]}}})),o.a.createElement(D.a,{className:"time-filter"},o.a.createElement(w.a.Text,{className:"filter-label"},"Duration"),o.a.createElement(N,{onChange:function(p){se(y.e.Duration),Ie(p)},initialFilter:Ee,pageKey:l?"person-".concat(i):"session-recordings"})))),o.a.createElement(F.a,{dataSource:f,columns:_e,loading:g,onRow:function(p){return{onClick:function(Le){Le.target.closest("a")||Pe(p.id,y.d.RecordingsList)}}},rowClassName:"cursor-pointer","data-attr":"session-recording-table",emptyState:"No matching recordings found"}),(V||B)&&o.a.createElement(D.a,{className:"pagination-control"},o.a.createElement(Y.a,{type:"link",disabled:!V,onClick:function(){Se(),window.scrollTo(0,0)}},o.a.createElement(q.a,null)," Previous"),o.a.createElement(Y.a,{type:"link",disabled:!B,onClick:function(){be(),window.scrollTo(0,0)}},"Next ",o.a.createElement(ce.a,null))),o.a.createElement("div",{style:{marginBottom:64}}),!!H&&o.a.createElement(k.a,{isPersonPage:l,onClose:Te}))}try{R.displayName="SessionRecordingsTable",R.__docgenInfo={description:"",displayName:"SessionRecordingsTable",props:{personUUID:{defaultValue:null,description:"",name:"personUUID",required:!1,type:{name:"string"}},isPersonPage:{defaultValue:{value:"false"},description:"",name:"isPersonPage",required:!1,type:{name:"boolean"}}}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/session-recordings/SessionRecordingsTable.tsx#SessionRecordingsTable"]={docgenInfo:R.__docgenInfo,name:"SessionRecordingsTable",path:"frontend/src/scenes/session-recordings/SessionRecordingsTable.tsx#SessionRecordingsTable"})}catch(a){}},"./frontend/src/scenes/session-recordings/sessionRecordingsTableLogic.ts":function(Z,j,e){"use strict";e.d(j,"a",function(){return ye});var $=e("./node_modules/core-js/modules/es.array.concat.js"),Re=e.n($),o=e("./node_modules/core-js/modules/es.array.iterator.js"),M=e.n(o),oe=e("./node_modules/core-js/modules/es.array.map.js"),D=e.n(oe),W=e("./node_modules/core-js/modules/es.object.to-string.js"),Y=e.n(W),w=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),Oe=e.n(w),ae=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),x=e.n(ae),ie=e("./node_modules/@babel/runtime/regenerator/index.js"),k=e.n(ie),le=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),q=e.n(le),ce=e("./node_modules/regenerator-runtime/runtime.js"),ee=e.n(ce),de=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),ue=e.n(de),A=e("./node_modules/kea/lib/index.esm.js"),me=e("./frontend/src/lib/api.ts"),fe=e("./frontend/src/lib/utils.tsx"),ge=e("./frontend/src/types.ts"),te=e("./node_modules/kea-router/lib/index.js"),De=e.n(te),pe=e("./frontend/src/lib/utils/eventUsageLogic.ts"),U=e("./node_modules/fast-deep-equal/index.js"),I=e.n(U),ve=e("./frontend/src/scenes/teamLogic.ts"),N=e("./frontend/src/lib/dayjs.ts");function ne(n,s){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);s&&(t=t.filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable})),r.push.apply(r,t)}return r}function y(n){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?ne(Object(r),!0).forEach(function(t){q()(n,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):ne(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}var G=50,z={type:"recording",key:"duration",value:60,operator:ge.z.GreaterThan},T=[],re={events:[],actions:[],new_entity:[{id:null,type:ge.g.EVENTS,order:0,name:null}]},ye=Object(A.kea)({path:function(s){return["scenes","session-recordings","sessionRecordingsTableLogic",s]},key:function(s){return s.key||s.personUUID||"global"},props:{},connect:{values:[ve.a,["currentTeamId"]],actions:[pe.f,["reportRecordingsListFetched","reportRecordingsListFilterAdded"]]},actions:{getSessionRecordings:!0,openSessionPlayer:function(s,r){return{sessionRecordingId:s,source:r}},closeSessionPlayer:!0,setEntityFilters:function(s){return{filters:s}},setPropertyFilters:function(s){return{filters:s}},loadNext:!0,loadPrev:!0,enableFilter:!0,setOffset:function(s){return{offset:s}},setDateRange:function(s,r){return{incomingFromDate:s,incomingToDate:r}},setDurationFilter:function(s){return{durationFilter:s}}},loaders:function(s){var r=s.props,t=s.values,u=s.actions;return{sessionRecordingsResponse:[{results:[],has_next:!1},{getSessionRecordings:function(){var P=ue()(k.a.mark(function C(b,K){var _,S,R,a,i,m;return k.a.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return S=y(y({},t.filterQueryParams),{},{person_uuid:(_=r.personUUID)!==null&&_!==void 0?_:"",limit:G}),R=Object(fe.zb)(S),d.next=4,K(100);case 4:return a=performance.now(),d.next=7,me.b.get("api/projects/".concat(t.currentTeamId,"/session_recordings?").concat(R));case 7:return i=d.sent,m=performance.now()-a,u.reportRecordingsListFetched(m),K(),d.abrupt("return",i);case 12:case"end":return d.stop()}},C)}));function F(C,b){return P.apply(this,arguments)}return F}()}]}},events:function(s){var r=s.actions;return{afterMount:function(){r.getSessionRecordings()}}},reducers:{filterEnabled:[!1,{enableFilter:function(){return!0}}],sessionRecordings:[[],{getSessionRecordingsSuccess:function(s,r){var t=r.sessionRecordingsResponse;return x()(t.results)},openSessionPlayer:function(s,r){var t=r.sessionRecordingId;return x()(s.map(function(u){return u.id===t?y(y({},u),{},{viewed:!0}):y({},u)}))}}],sessionRecordingId:[null,{openSessionPlayer:function(s,r){var t=r.sessionRecordingId;return t},closeSessionPlayer:function(){return null}}],entityFilters:[re,{setEntityFilters:function(s,r){var t=r.filters;return y({},t)}}],propertyFilters:[T,{setPropertyFilters:function(s,r){var t=r.filters;return x()(t)}}],durationFilter:[z,{setDurationFilter:function(s,r){var t=r.durationFilter;return t}}],offset:[0,{loadNext:function(s){return s+G},loadPrev:function(s){return Math.max(s-G)},setOffset:function(s,r){var t=r.offset;return t}}],fromDate:[Object(N.a)().subtract(7,"days").format("YYYY-MM-DD"),{setDateRange:function(s,r){var t=r.incomingFromDate;return t!=null?t:null}}],toDate:[null,{setDateRange:function(s,r){var t=r.incomingToDate;return t!=null?t:null}}]},listeners:function(s){var r=s.actions;return{setEntityFilters:function(){r.getSessionRecordings()},setPropertyFilters:function(){r.getSessionRecordings()},setDateRange:function(){r.getSessionRecordings()},setDurationFilter:function(){r.getSessionRecordings()},loadNext:function(){r.getSessionRecordings()},loadPrev:function(){r.getSessionRecordings()}}},selectors:{hasPrev:[function(n){return[n.offset]},function(n){return n>0}],hasNext:[function(n){return[n.sessionRecordingsResponse]},function(n){return n.has_next}],showFilters:[function(n){return[n.filterEnabled,n.entityFilters,n.propertyFilters]},function(n,s,r){return n||s!==re||r!==T}],filterQueryParams:[function(n){return[n.entityFilters,n.fromDate,n.toDate,n.offset,n.durationFilter,n.propertyFilters]},function(n,s,r,t,u,P){return{actions:n.actions,events:n.events,properties:P,date_from:s,date_to:r,offset:t,session_recording_duration:u}}]},actionToUrl:function(s){var r=s.values,t=function(){var P=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=arguments.length>1?arguments[1]:void 0,C=y({filters:r.filterQueryParams},P),b=y({},te.router.values.hashParams);return r.sessionRecordingId?b.sessionRecordingId=r.sessionRecordingId:delete b.sessionRecordingId,[te.router.values.location.pathname,C,b,{replace:F}]};return{loadSessionRecordings:function(){return t({},!0)},openSessionPlayer:function(P){var F=P.source;return t({source:F},!1)},closeSessionPlayer:function(){return t({},!1)},setEntityFilters:function(){return t({},!0)},setPropertyFilters:function(){return t({},!0)},setDateRange:function(){return t({},!0)},setDurationFilter:function(){return t({},!0)},loadNext:function(){return t({},!0)},loadPrev:function(){return t({},!0)}}},urlToAction:function(s){var r=s.actions,t=s.values,u=s.props,P=function(b,K,_){var S,R=(S=_.sessionRecordingId)!==null&&S!==void 0?S:null;R!==t.sessionRecordingId&&r.openSessionPlayer(R,pe.d.Direct);var a=K.filters;if(a){if((!I()(a.actions,t.entityFilters.actions)||!I()(a.events,t.entityFilters.events))&&r.setEntityFilters({events:a.events||[],actions:a.actions||[]}),!I()(a.properties,t.propertyFilters)){var i;r.setPropertyFilters((i=a.properties)!==null&&i!==void 0?i:[])}if(a.date_from!==t.fromDate||a.date_to!==t.toDate){var m,l;r.setDateRange((m=a.date_from)!==null&&m!==void 0?m:void 0,(l=a.date_to)!==null&&l!==void 0?l:void 0)}if(a.offset!==t.offset){var d;r.setOffset((d=a.offset)!==null&&d!==void 0?d:0)}if(!I()(a.session_recording_duration,t.durationFilter)){var c;r.setDurationFilter((c=a.session_recording_duration)!==null&&c!==void 0?c:z)}}},F=u.personUUID?"/person/*":"/recordings";return q()({},F,P)}})},"./node_modules/css-loader/dist/cjs.js!./node_modules/postcss-loader/src/index.js!./node_modules/sass-loader/dist/cjs.js?!./frontend/src/scenes/session-recordings/SessionRecordingTable.scss":function(Z,j,e){var $=e("./node_modules/css-loader/dist/runtime/api.js");j=$(!1),j.push([Z.i,".text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.session-recordings-table .filter-row{width:100%;justify-content:space-between;margin-bottom:1rem;align-items:flex-end}.session-recordings-table .filter-container{max-width:700px;padding:1rem;border:1px solid rgba(0,0,0,.15);flex:1;border-radius:4px}.session-recordings-table .filter-section{padding-bottom:1rem}.session-recordings-table .session-recording-action-property-filter{margin:0 0 0 68px;background-color:#fafafa;border:1px solid rgba(0,0,0,.15);border-top:0 solid rgba(0,0,0,.15);padding:.25rem 1rem}.session-recordings-table .time-filter-row{justify-content:flex-end;align-items:flex-end}.session-recordings-table .time-filter-row .time-filter{align-items:center;margin-left:1rem}.session-recordings-table .time-filter-row .time-filter .filter-label{margin-right:4px}.session-recordings-table .pagination-control{margin:1rem;justify-content:center}.session-recordings-table .entity-filter-row{width:100%;padding:1rem;border:1px solid rgba(0,0,0,.15);margin-top:1rem;border-radius:4px}.session-recordings-table .play-button-container{display:flex;justify-content:flex-end}.session-recordings-table .play-button-container .play-button .anticon-play-circle{color:#5375ff}.session-recordings-table .play-button-container .play-button.viewed .anticon-play-circle{color:rgba(0,0,0,.5)}.session-recordings-table .info-icon{color:#5375ff}",""]),Z.exports=j}}]);
