(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[92130],{"../../frontend/src/scenes/data-warehouse/editor/EditorScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EditorScene:()=>EditorScene_EditorScene,scene:()=>scene});var injectStylesIntoStyleTag=__webpack_require__("../../node_modules/.pnpm/style-loader@2.0.0_webpack@5.88.2/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),EditorScene=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/EditorScene.scss"),EditorScene_default=__webpack_require__.n(EditorScene),options={};options.insert="head",options.singleton=!1,injectStylesIntoStyleTag_default()(EditorScene_default(),options),EditorScene_default().locals;var index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),dataNodeLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeLogic.ts"),variableModalLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/variableModalLogic.ts"),variablesLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/variablesLogic.ts"),dataVisualizationLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/dataVisualizationLogic.ts"),displayLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/displayLogic.ts"),ViewLinkModal=__webpack_require__("../../frontend/src/scenes/data-warehouse/ViewLinkModal.tsx"),posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.33.0_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),constants=__webpack_require__("../../frontend/src/lib/constants.tsx"),LemonButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonButton/index.ts"),Link=__webpack_require__("../../frontend/src/lib/lemon-ui/Link/index.ts"),icons=__webpack_require__("../../frontend/src/lib/lemon-ui/icons/index.ts"),featureFlagLogic=__webpack_require__("../../frontend/src/lib/logic/featureFlagLogic.ts"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),panelLayoutLogic=__webpack_require__("../../frontend/src/layout/panel-layout/panelLayoutLogic.tsx"),schema_general=__webpack_require__("../../frontend/src/queries/schema/schema-general.ts"),dataWarehouseViewsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/saved_queries/dataWarehouseViewsLogic.tsx"),DataGrid=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/DataGrid.scss"),DataGrid_default=__webpack_require__.n(DataGrid),DataGrid_options={};DataGrid_options.insert="head",DataGrid_options.singleton=!1,injectStylesIntoStyleTag_default()(DataGrid_default(),DataGrid_options),DataGrid_default().locals,__webpack_require__("../../node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-data-grid/lib/styles.css");var clsx_m=__webpack_require__("../../node_modules/.pnpm/clsx@1.2.1/node_modules/clsx/dist/clsx.m.js"),bundle=__webpack_require__("../../node_modules/.pnpm/react-data-grid@7.0.0-beta.47_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-data-grid/lib/bundle.js"),ExportButton=__webpack_require__("../../frontend/src/lib/components/ExportButton/ExportButton.tsx"),JSONViewer=__webpack_require__("../../frontend/src/lib/components/JSONViewer.tsx"),LemonMenu=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonMenu/LemonMenu.tsx"),LoadingBar=__webpack_require__("../../frontend/src/lib/lemon-ui/LoadingBar/index.ts"),copyToClipboard=__webpack_require__("../../frontend/src/lib/utils/copyToClipboard.tsx");function transformDataTableToDataTableRows(rows,columns){return columns.length&&rows.length?rows.map(row=>({result:columns.map(col=>row[col])})):[]}var EmptyStates=__webpack_require__("../../frontend/src/scenes/insights/EmptyStates/index.ts"),BoldNumber=__webpack_require__("../../frontend/src/scenes/insights/views/BoldNumber/BoldNumber.tsx"),KeyboardShortcut=__webpack_require__("../../frontend/src/layout/navigation-3000/components/KeyboardShortcut.tsx"),themeLogic=__webpack_require__("../../frontend/src/layout/navigation-3000/themeLogic.ts"),DateRange=__webpack_require__("../../frontend/src/queries/nodes/DataNode/DateRange.tsx"),ElapsedTime=__webpack_require__("../../frontend/src/queries/nodes/DataNode/ElapsedTime.tsx"),LoadNext=__webpack_require__("../../frontend/src/queries/nodes/DataNode/LoadNext.tsx"),dist_module=__webpack_require__("../../node_modules/.pnpm/posthog-js@1.273.1_@rrweb+types@2.0.0-alpha.17/node_modules/posthog-js/dist/module.js"),Popover=__webpack_require__("../../frontend/src/lib/lemon-ui/Popover/index.ts"),Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");function QueryExecutionDetails(){var microseconds;let{queryLog,queryId,queryLogLoading,queryLogQueryId}=(0,index_esm.useValues)(dataNodeLogic.M),{loadQueryLog}=(0,index_esm.useActions)(dataNodeLogic.M),[popoverVisible,setPopoverVisible]=(0,react.useState)(!1);if(!queryId)return null;let executionDetails=queryLog?.results?.[0],columns=queryLog?.columns||[],memoryUsage=null,cpuMicroseconds=null,readBytes=null,queryDurationMs=null;if(executionDetails&&columns.length>0){let memoryUsageIndex=columns.indexOf("memory_usage"),cpuMicrosecondsIndex=columns.indexOf("cpu_microseconds"),readBytesIndex=columns.indexOf("read_bytes"),queryDurationMsIndex=columns.indexOf("query_duration_ms");memoryUsage=memoryUsageIndex>=0?executionDetails[memoryUsageIndex]:null,cpuMicroseconds=cpuMicrosecondsIndex>=0?executionDetails[cpuMicrosecondsIndex]:null,readBytes=readBytesIndex>=0?executionDetails[readBytesIndex]:null,queryDurationMs=queryDurationMsIndex>=0?executionDetails[queryDurationMsIndex]:null}let hasData=null!==memoryUsage||null!==cpuMicroseconds||null!==readBytes||null!==queryDurationMs;return(0,jsx_runtime.jsx)(Popover.J2,{onClickOutside:()=>setPopoverVisible(!1),onMouseEnterInside:()=>setPopoverVisible(!0),onMouseLeaveInside:()=>setPopoverVisible(!1),visible:popoverVisible,placement:"bottom",showArrow:!0,overlay:(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-1 p-2",children:queryLogLoading?(0,jsx_runtime.jsx)("div",{className:"py-1",children:"Loading execution details..."}):hasData?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[null!==memoryUsage&&(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-start deprecated-space-x-2 py-1",children:[(0,jsx_runtime.jsx)("span",{children:"Memory usage:"}),(0,jsx_runtime.jsx)(Tooltip.u,{title:`${memoryUsage} bytes`,children:(0,jsx_runtime.jsx)("span",{className:"font-mono",children:(0,utils.kK)(memoryUsage)})})]}),null!==readBytes&&(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-start deprecated-space-x-2 py-1",children:[(0,jsx_runtime.jsx)("span",{children:"Data read:"}),(0,jsx_runtime.jsx)(Tooltip.u,{title:`${readBytes} bytes`,children:(0,jsx_runtime.jsx)("span",{className:"font-mono",children:(0,utils.kK)(readBytes)})})]}),null!==cpuMicroseconds&&(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-start deprecated-space-x-2 py-1",children:[(0,jsx_runtime.jsx)("span",{children:"CPU time:"}),(0,jsx_runtime.jsx)(Tooltip.u,{title:`${cpuMicroseconds} microseconds`,children:(0,jsx_runtime.jsx)("span",{className:"font-mono",children:(microseconds=cpuMicroseconds)<1e3?`${microseconds}μs`:microseconds<1e6?`${(microseconds/1e3).toFixed(2)}ms`:`${(microseconds/1e6).toFixed(2)}s`})})]}),null!==queryDurationMs&&(0,jsx_runtime.jsxs)("div",{className:"flex justify-between items-start deprecated-space-x-2 py-1",children:[(0,jsx_runtime.jsx)("span",{children:"Duration:"}),queryDurationMs>999?(0,jsx_runtime.jsx)(Tooltip.u,{title:`${queryDurationMs}ms`,children:(0,jsx_runtime.jsx)("span",{className:"font-mono",children:(0,utils.pg)(queryDurationMs)})}):(0,jsx_runtime.jsx)("span",{className:"font-mono",children:(0,utils.pg)(queryDurationMs)})]})]}):(0,jsx_runtime.jsx)("div",{className:"py-1",children:"No execution details available."})}),children:(0,jsx_runtime.jsxs)("div",{onClick:()=>{let newVisible=!popoverVisible;setPopoverVisible(newVisible),newVisible&&dist_module.ZP.capture("query execution details viewed")},onMouseEnter:()=>{!queryLogLoading&&queryId&&queryId!==queryLogQueryId&&loadQueryLog(queryId),popoverVisible||(setPopoverVisible(!0),dist_module.ZP.capture("query execution details viewed"))},onMouseLeave:()=>setPopoverVisible(!1),className:"cursor-help text-xs flex items-center gap-1",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconChip,{}),"Execution details"]})})}var LineGraph=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Charts/LineGraph.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),ConditionalFormattingTab=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/queries/nodes/DataVisualization/Components/ConditionalFormatting/ConditionalFormattingTab.scss"),ConditionalFormattingTab_default=__webpack_require__.n(ConditionalFormattingTab),ConditionalFormattingTab_options={};ConditionalFormattingTab_options.insert="head",ConditionalFormattingTab_options.singleton=!1,injectStylesIntoStyleTag_default()(ConditionalFormattingTab_default(),ConditionalFormattingTab_options),ConditionalFormattingTab_default().locals;var DataVisualization_types=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/types.ts"),lib=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),kea_subscriptions_lib=__webpack_require__("../../node_modules/.pnpm/kea-subscriptions@3.0.1_kea@3.1.7_react@18.2.0_/node_modules/kea-subscriptions/lib/index.js"),api=__webpack_require__("../../frontend/src/lib/api.ts");let conditionalFormattingLogic=(0,index_esm.kea)([(0,index_esm.key)(props=>props.rule.id),(0,index_esm.path)(["queries","nodes","DataVisualization","Components","conditionalFormattingLogic"]),(0,index_esm.props)({rule:{id:""},key:""}),(0,index_esm.connect)(()=>({actions:[dataVisualizationLogic.H8,["updateConditionalFormattingRule"]]})),(0,index_esm.actions)({selectColumn:columnName=>({columnName}),updateInput:input=>({input}),selectTemplate:templateId=>({templateId}),updateBytecode:bytecode=>({bytecode}),selectColor:color=>({color}),deleteRule:!0}),(0,index_esm.reducers)(_ref=>{let{props}=_ref;return{rule:[props.rule,{selectColumn:(state,_ref2)=>{let{columnName}=_ref2;return{...state,columnName}},updateInput:(state,_ref3)=>{let{input}=_ref3;return{...state,input}},selectTemplate:(state,_ref4)=>{let{templateId}=_ref4;return{...state,templateId}},updateBytecode:(state,_ref5)=>{let{bytecode}=_ref5;return{...state,bytecode}},selectColor:(state,_ref6)=>{let{color}=_ref6;return{...state,color}}}]}}),(0,index_esm.selectors)({template:[s=>[s.rule],rule=>{let template=DataVisualization_types.p.find(n=>n.id===rule.templateId);return template||DataVisualization_types.p[0]}]}),(0,lib.loaders)({hog:[null,{compileHog:async _ref7=>{let{hog}=_ref7;return(await api.ZP.hog.create(hog)).bytecode}}]}),(0,index_esm.listeners)(_ref8=>{let{actions,values}=_ref8;return{compileHogSuccess:_ref9=>{let{hog}=_ref9;actions.updateBytecode(hog)},deleteRule:()=>{actions.updateConditionalFormattingRule(values.rule,!0)}}}),(0,kea_subscriptions_lib.Vt)(_ref10=>{let{actions}=_ref10;return{template:(template,oldTemplate)=>{actions.compileHog({hog:template.hog}),!oldTemplate?.hideInput&&template.hideInput&&actions.updateInput("")},rule:rule=>{actions.updateConditionalFormattingRule(rule)}}})]),DEFAULT_PICKER_COLORS=["#FFADAD","#E8A598","#FFD6A5","#FFCFD2","#FDFFB6","#C1FBA4","#9BF6FF","#A0C4FF","#BDB2FF","#FFC6FF"],getRuleHeader=rule=>{if(!rule.columnName||!rule.input)return"New rule";let template=DataVisualization_types.p.find(n=>n.id===rule.templateId);return template?template.hideInput?`${rule.columnName} ${template.label.toLowerCase()}`:`${rule.columnName} ${template.label.toLowerCase()} ${rule.input}`:"New rule"},RuleItem=_ref=>{let{rule:propsRule}=_ref,{columns,responseLoading,dataVisualizationProps}=(0,index_esm.useValues)(dataVisualizationLogic.H8),builtCFLogic=conditionalFormattingLogic({key:dataVisualizationProps.key,rule:propsRule}),{selectColumn,updateInput,selectTemplate,selectColor,deleteRule}=(0,index_esm.useActions)(builtCFLogic),{rule,template}=(0,index_esm.useValues)(builtCFLogic);return(0,jsx_runtime.jsxs)("div",{className:"gap-2 flex flex-col",children:[(0,jsx_runtime.jsx)(src.Yv,{placeholder:"Column",className:"w-full",value:rule.columnName||null,options:columns.map(_ref2=>{let{name:name1,type}=_ref2;return{value:name1,label:(0,jsx_runtime.jsxs)("div",{className:"items-center flex-1",children:[name1,(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"default",children:type.name})]})}}),disabledReason:responseLoading?"Query loading...":void 0,onChange:value=>{let column=columns.find(n=>n.name===value);column&&selectColumn(column.name)}}),(0,jsx_runtime.jsx)(src.Yv,{className:"w-full",options:DataVisualization_types.p.filter(n=>{let column=columns.find(n=>n.name===rule.columnName);return!column||n.availableColumnTypes.includes(column.type.name)}).map(_ref3=>{let{id,label}=_ref3;return{label,value:id}}),value:rule.templateId,onSelect:value=>selectTemplate(value)}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-1",children:[(0,jsx_runtime.jsx)(src.zn,{selectedColor:rule.color,onSelectColor:selectColor,colors:DEFAULT_PICKER_COLORS,showCustomColor:!0,hideDropdown:!0}),(0,jsx_runtime.jsx)(src.DF,{placeholder:"value",className:"ml-2 flex-1",onChange:value=>updateInput(value),value:rule.input,disabled:template.hideInput}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",title:"Delete rule",className:"ml-1",noPadding:!0,tooltip:"Delete formatting rule",onClick:()=>deleteRule()})]})]})};var SeriesGlyph=__webpack_require__("../../frontend/src/lib/components/SeriesGlyph.tsx"),kea_forms_lib=__webpack_require__("../../node_modules/.pnpm/kea-forms@3.2.0_kea@3.1.7_react@18.2.0_/node_modules/kea-forms/lib/index.js"),colors=__webpack_require__("../../frontend/src/lib/colors.ts"),LemonField=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonField/index.ts"),seriesBreakdownLogic=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/seriesBreakdownLogic.ts");let YSeriesSettingsTab=function(YSeriesSettingsTab){return YSeriesSettingsTab.Formatting="formatting",YSeriesSettingsTab.Display="display",YSeriesSettingsTab}({}),ySeriesLogic=(0,index_esm.kea)([(0,index_esm.path)(["queries","nodes","DataVisualization","Components","ySeriesLogic"]),(0,index_esm.key)(props=>{var _props$series$column$,_props$seriesIndex;return`${null!==(_props$series$column$=props.series?.column?.name)&&void 0!==_props$series$column$?_props$series$column$:"new"}-${null!==(_props$seriesIndex=props.seriesIndex)&&void 0!==_props$seriesIndex?_props$seriesIndex:0}`}),(0,index_esm.connect)(props=>({actions:[(0,dataVisualizationLogic.H8)(props.dataVisualizationProps),["updateSeriesIndex"]]})),(0,index_esm.props)({series:dataVisualizationLogic.pf}),(0,index_esm.actions)({setSettingsOpen:open=>({open}),setSettingsTab:tab=>({tab})}),(0,index_esm.reducers)({isSettingsOpen:[!1,{setSettingsOpen:(_,_ref)=>{let{open}=_ref;return open}}],activeSettingsTab:[YSeriesSettingsTab.Formatting,{setSettingsTab:(_state,_ref2)=>{let{tab}=_ref2;return tab}}]}),(0,index_esm.selectors)({canOpenSettings:[(_s,p)=>[p.series],series=>series!==dataVisualizationLogic.pf]}),(0,kea_forms_lib.forms)(_ref3=>{var _props$series$setting,_props$series$setting2,_props$series$setting3,_props$series$setting4,_props$series$setting5,_props$series$setting6,_props$series$setting7,_props$series$setting8;let{actions,props}=_ref3;return{formatting:{defaults:{prefix:null!==(_props$series$setting=props.series?.settings?.formatting?.prefix)&&void 0!==_props$series$setting?_props$series$setting:"",suffix:null!==(_props$series$setting2=props.series?.settings?.formatting?.suffix)&&void 0!==_props$series$setting2?_props$series$setting2:"",style:null!==(_props$series$setting3=props.series?.settings?.formatting?.style)&&void 0!==_props$series$setting3?_props$series$setting3:"none",decimalPlaces:props.series?.settings?.formatting?.decimalPlaces},submit:async format=>{actions.updateSeriesIndex(props.seriesIndex,props.series.column.name,{formatting:{prefix:format.prefix,suffix:format.suffix,style:format.style,decimalPlaces:Number.isNaN(format.decimalPlaces)?void 0:format.decimalPlaces}}),actions.setSettingsOpen(!1)}},display:{defaults:{color:null!==(_props$series$setting4=props.series?.settings?.display?.color)&&void 0!==_props$series$setting4?_props$series$setting4:(0,colors._r)(props.seriesIndex),label:null!==(_props$series$setting5=props.series?.settings?.display?.label)&&void 0!==_props$series$setting5?_props$series$setting5:"",trendLine:null!==(_props$series$setting6=props.series?.settings?.display?.trendLine)&&void 0!==_props$series$setting6&&_props$series$setting6,yAxisPosition:null!==(_props$series$setting7=props.series?.settings?.display?.yAxisPosition)&&void 0!==_props$series$setting7?_props$series$setting7:"left",displayType:null!==(_props$series$setting8=props.series?.settings?.display?.displayType)&&void 0!==_props$series$setting8?_props$series$setting8:"auto"},submit:async display=>{actions.updateSeriesIndex(props.seriesIndex,props.series.column.name,{display:{color:display.color,label:display.label,trendLine:display.trendLine,yAxisPosition:display.yAxisPosition,displayType:display.displayType}}),actions.setSettingsOpen(!1)}}}})]),YSeries=_ref2=>{var _series$settings$disp;let{series,index}=_ref2,{columns,numericalColumns,responseLoading,dataVisualizationProps,showTableSettings}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{updateSeriesIndex,deleteYSeries}=(0,index_esm.useActions)(dataVisualizationLogic.H8),{selectedSeriesBreakdownColumn}=(0,index_esm.useValues)((0,seriesBreakdownLogic.h)({key:dataVisualizationProps.key})),seriesLogicProps={series,seriesIndex:index,dataVisualizationProps},seriesLogic=ySeriesLogic(seriesLogicProps),{isSettingsOpen,canOpenSettings,activeSettingsTab}=(0,index_esm.useValues)(seriesLogic),{setSettingsOpen,submitFormatting,submitDisplay,setSettingsTab}=(0,index_esm.useActions)(seriesLogic),seriesColor=null!==(_series$settings$disp=series.settings?.display?.color)&&void 0!==_series$settings$disp?_series$settings$disp:(0,colors._r)(index),showSeriesColor=!showTableSettings&&!selectedSeriesBreakdownColumn,options=(showTableSettings?columns:numericalColumns).map(_ref3=>{let{name:name1,type}=_ref3;return{value:name1,label:(0,jsx_runtime.jsxs)("div",{className:"items-center flex flex-1",children:[showSeriesColor&&(0,jsx_runtime.jsx)(src.Jw,{className:"mr-2",color:seriesColor}),series.settings?.display?.label&&series.column.name===name1?series.settings.display.label:name1,(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"default",children:type.name})]})}});return(0,jsx_runtime.jsxs)("div",{className:"flex gap-1 mb-1",children:[(0,jsx_runtime.jsx)(src.Yv,{className:"grow flex-1 break-all",value:null!==series?series.column.name:"None",options:options,disabledReason:responseLoading?"Query loading...":void 0,onChange:value=>{let column=columns.find(n=>n.name===value);column&&updateSeriesIndex(index,column.name)}}),(0,jsx_runtime.jsx)(src.J2,{overlay:(0,jsx_runtime.jsx)("div",{className:"m-2",children:(0,jsx_runtime.jsx)(src.TP,{activeKey:activeSettingsTab,barClassName:"justify-around",onChange:tab=>setSettingsTab(tab),tabs:Object.values(Y_SERIES_SETTINGS_TABS).map((_ref4,index)=>{let{label,Component}=_ref4;return{label:label,key:Object.keys(Y_SERIES_SETTINGS_TABS)[index],content:(0,jsx_runtime.jsx)(Component,{ySeriesLogicProps:seriesLogicProps})}})})}),visible:isSettingsOpen,placement:"bottom",onClickOutside:()=>{submitFormatting(),submitDisplay()},children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),noPadding:!0,onClick:()=>setSettingsOpen(!0),disabledReason:!canOpenSettings&&"Select a column first"},"seriesSettings")}),!showTableSettings&&(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",title:"Delete Y-series",noPadding:!0,onClick:()=>deleteYSeries(index)},"delete")]})},Y_SERIES_SETTINGS_TABS={[YSeriesSettingsTab.Formatting]:{label:"Formatting",Component:_ref5=>{let{ySeriesLogicProps}=_ref5;return(0,jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:ySeriesLogic,props:ySeriesLogicProps,formKey:"formatting",className:"deprecated-space-y-4",children:[ySeriesLogicProps.series.column.type.isNumerical&&(0,jsx_runtime.jsx)(LemonField.D,{name:"style",label:"Style",className:"gap-1",children:(0,jsx_runtime.jsx)(src.Yv,{options:[{value:"none",label:"None"},{value:"number",label:"Number"},{value:"percent",label:"Percentage"}]})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"prefix",label:"Prefix",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"$"})}),(0,jsx_runtime.jsx)(LemonField.D,{name:"suffix",label:"Suffix",children:(0,jsx_runtime.jsx)(src.DF,{placeholder:"USD"})}),ySeriesLogicProps.series.column.type.isNumerical&&(0,jsx_runtime.jsx)(LemonField.D,{name:"decimalPlaces",label:"Decimal places",children:(0,jsx_runtime.jsx)(src.DF,{type:"number",min:0})})]})}},[YSeriesSettingsTab.Display]:{label:"Display",Component:_ref6=>{let{ySeriesLogicProps}=_ref6,{showTableSettings,dataVisualizationProps}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{selectedSeriesBreakdownColumn}=(0,index_esm.useValues)((0,seriesBreakdownLogic.h)({key:dataVisualizationProps.key})),{updateSeriesIndex}=(0,index_esm.useActions)(dataVisualizationLogic.H8),showColorPicker=!showTableSettings&&!selectedSeriesBreakdownColumn,showLabelInput=showTableSettings||!selectedSeriesBreakdownColumn;return(0,jsx_runtime.jsxs)(kea_forms_lib.Form,{logic:ySeriesLogic,props:ySeriesLogicProps,formKey:"display",className:"deprecated-space-y-4",children:[(showColorPicker||showLabelInput)&&(0,jsx_runtime.jsxs)("div",{className:"flex gap-3",children:[showColorPicker&&(0,jsx_runtime.jsx)(LemonField.D,{name:"color",label:"Color",children:_ref7=>{let{value,onChange}=_ref7;return(0,jsx_runtime.jsx)(src.zn,{selectedColor:value,onSelectColor:color=>{onChange(color),updateSeriesIndex(ySeriesLogicProps.seriesIndex,ySeriesLogicProps.series.column.name,{display:{color:color}})},colors:(0,colors.Qu)(),showCustomColor:!0,hideDropdown:!0,preventPopoverClose:!0,customColorValue:value})}}),showLabelInput&&(0,jsx_runtime.jsx)(LemonField.D,{name:"label",label:"Label",children:_ref8=>{let{value,onChange}=_ref8;return(0,jsx_runtime.jsx)(src.DF,{value:value,onChange:label=>{onChange(label),updateSeriesIndex(ySeriesLogicProps.seriesIndex,ySeriesLogicProps.series.column.name,{display:{label:label}})}})}})]}),!showTableSettings&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[!selectedSeriesBreakdownColumn&&(0,jsx_runtime.jsx)(LemonField.D,{name:"trendLine",label:"Trend line",children:_ref9=>{let{value,onChange}=_ref9;return(0,jsx_runtime.jsx)(src.f4,{checked:value,onChange:newValue=>{onChange(newValue),updateSeriesIndex(ySeriesLogicProps.seriesIndex,ySeriesLogicProps.series.column.name,{display:{trendLine:newValue}})}})}}),(0,jsx_runtime.jsx)(LemonField.D,{name:"yAxisPosition",label:"Y-axis position",children:_ref10=>{let{value,onChange}=_ref10;return(0,jsx_runtime.jsx)(src.P4,{value:value,className:"w-full",options:[{label:"Left",value:"left"},{label:"Right",value:"right"}],onChange:newValue=>{onChange(newValue),updateSeriesIndex(ySeriesLogicProps.seriesIndex,ySeriesLogicProps.series.column.name,{display:{yAxisPosition:newValue}})}})}}),(0,jsx_runtime.jsx)(LemonField.D,{name:"displayType",label:"Display type",children:_ref11=>{let{value,onChange}=_ref11;return(0,jsx_runtime.jsx)(src.P4,{value:value,className:"w-full",options:[{label:"Auto",value:"auto"},{label:"Line",value:"line"},{label:"Bar",value:"bar"}],onChange:newValue=>{onChange(newValue),updateSeriesIndex(ySeriesLogicProps.seriesIndex,ySeriesLogicProps.series.column.name,{display:{displayType:newValue}})}})}})]})]})}}},SeriesBreakdownSelector=()=>{let{columns,responseLoading,selectedXAxis,dataVisualizationProps}=(0,index_esm.useValues)(dataVisualizationLogic.H8),breakdownLogic=(0,seriesBreakdownLogic.h)({key:dataVisualizationProps.key}),{selectedSeriesBreakdownColumn,seriesBreakdownData}=(0,index_esm.useValues)(breakdownLogic),{addSeriesBreakdown,deleteSeriesBreakdown}=(0,index_esm.useActions)(breakdownLogic),seriesBreakdownOptions=columns.map(_ref12=>{let{name:name1,type}=_ref12;return{value:name1,label:(0,jsx_runtime.jsxs)("div",{className:"items-center flex-1",children:[name1,(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"default",children:type.name})]})}}).filter(column=>column.value!==selectedXAxis);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-1 my-1",children:[(0,jsx_runtime.jsx)(src.Yv,{className:"grow",value:null!==selectedSeriesBreakdownColumn?selectedSeriesBreakdownColumn:"None",options:seriesBreakdownOptions,disabledReason:responseLoading?"Query loading...":void 0,onChange:value=>{let column=columns.find(n=>n.name===value);column&&addSeriesBreakdown(column.name)}}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",title:"Delete series breakdown",noPadding:!0,onClick:()=>deleteSeriesBreakdown()},"delete")]}),(0,jsx_runtime.jsx)("div",{className:"ml-4 mt-2",children:seriesBreakdownData.error?(0,jsx_runtime.jsx)("div",{className:"text-danger font-bold mt-1",children:seriesBreakdownData.error}):seriesBreakdownData.seriesData.map((series,index)=>(0,jsx_runtime.jsx)(BreakdownSeries,{series:series,index:index},`${series.name}-${index}`))})]})},BreakdownSeries=_ref13=>{var _series$settings$disp2;let{series,index}=_ref13,seriesColor=null!==(_series$settings$disp2=series.settings?.display?.color)&&void 0!==_series$settings$disp2?_series$settings$disp2:(0,colors._r)(index);return(0,jsx_runtime.jsx)("div",{className:"flex gap-1 mb-2",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2",children:[(0,jsx_runtime.jsx)(src.Jw,{color:seriesColor,className:"mr-2"}),(0,jsx_runtime.jsx)("span",{children:series.name?series.name:"[No value]"})]})})},TABS_TO_CONTENT={[dataVisualizationLogic.B8.Series]:{label:"Series",content:(0,jsx_runtime.jsx)(()=>{let{columns,numericalColumns,xData,yData,responseLoading,showTableSettings,tabularColumns,selectedXAxis,dataVisualizationProps}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{updateXSeries,addYSeries}=(0,index_esm.useActions)(dataVisualizationLogic.H8),breakdownLogic=(0,seriesBreakdownLogic.h)({key:dataVisualizationProps.key}),{showSeriesBreakdown}=(0,index_esm.useValues)(breakdownLogic),{addSeriesBreakdown}=(0,index_esm.useActions)(breakdownLogic),hideAddYSeries=yData.length>=numericalColumns.length,hideAddSeriesBreakdown=!(!showSeriesBreakdown&&selectedXAxis&&columns.length>yData.length);if(showTableSettings)return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full p-3",children:[(0,jsx_runtime.jsx)(src.HQ,{children:"Columns"}),tabularColumns.map((series,index)=>(0,jsx_runtime.jsx)(YSeries,{series:series,index:index},`${series.column.name}-${index}`))]});let options=columns.map(_ref=>{let{name:name1,type}=_ref;return{value:name1,label:(0,jsx_runtime.jsxs)("div",{className:"items-center flex-1",children:[name1,(0,jsx_runtime.jsx)(src.oe,{className:"ml-2",type:"default",children:type.name})]})}});return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col w-full p-3",children:[(0,jsx_runtime.jsx)(src.HQ,{className:"mb-1",children:"X-axis"}),(0,jsx_runtime.jsx)(src.Yv,{className:"w-full",value:null!==xData?xData.column.name:"None",options:options,disabledReason:responseLoading?"Query loading...":void 0,onChange:value=>{let column=columns.find(n=>n.name===value);column&&updateXSeries(column.name)}}),!hideAddSeriesBreakdown&&(0,jsx_runtime.jsx)(src.Jp,{className:"mt-1",type:"tertiary",onClick:()=>addSeriesBreakdown(null),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),fullWidth:!0,children:"Add series breakdown"}),showSeriesBreakdown&&(0,jsx_runtime.jsx)(SeriesBreakdownSelector,{}),(0,jsx_runtime.jsx)(src.HQ,{className:"mt-4 mb-1",children:"Y-axis"}),yData.map((series,index)=>(0,jsx_runtime.jsx)(YSeries,{series:series,index:index},`${series?.column.name}-${index}`)),!hideAddYSeries&&(0,jsx_runtime.jsx)(src.Jp,{className:"mt-1",type:"tertiary",onClick:()=>addYSeries(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),fullWidth:!0,children:"Add Y-series"})]})},{}),shouldShow:()=>!0},[dataVisualizationLogic.B8.ConditionalFormatting]:{label:"Conditional formatting",content:(0,jsx_runtime.jsx)(()=>{let{conditionalFormattingRules,conditionalFormattingRulesPanelActiveKeys}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{addConditionalFormattingRule,setConditionalFormattingRulesPanelActiveKeys}=(0,index_esm.useActions)(dataVisualizationLogic.H8);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col ConditionalFormattingTab p-3",children:[(0,jsx_runtime.jsx)("p",{children:"You can add rules to make the cells in the table change color if they meet certain conditions."}),conditionalFormattingRules.length>0&&(0,jsx_runtime.jsx)(src.JL,{activeKeys:conditionalFormattingRulesPanelActiveKeys,onChange:activeKeys=>setConditionalFormattingRulesPanelActiveKeys(activeKeys),multiple:!0,className:"mb-2",size:"small",panels:conditionalFormattingRules.map(rule=>({key:rule.id,header:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.Jw,{color:rule.color}),(0,jsx_runtime.jsx)("span",{className:"ml-2",children:getRuleHeader(rule)})]}),content:(0,jsx_runtime.jsx)(RuleItem,{rule:rule},rule.id),className:"p-2"}))}),(0,jsx_runtime.jsx)(src.Jp,{className:"mt-1",onClick:()=>addConditionalFormattingRule(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),fullWidth:!0,type:"secondary",children:"Add rule"})]})},{}),shouldShow:displayType=>displayType===types.Qb.ActionsTable},[dataVisualizationLogic.B8.Display]:{label:"Display",content:(0,jsx_runtime.jsx)(()=>{var _chartSettings$showLe,_chartSettings$showTo,_chartSettings$showXA,_chartSettings$showXA2,_chartSettings$showYA,_chartSettings$stackB;let{visualizationType}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{goalLines,chartSettings}=(0,index_esm.useValues)(displayLogic.Y),{addGoalLine,updateGoalLine,removeGoalLine,updateChartSettings}=(0,index_esm.useActions)(displayLogic.Y),isStackedBarChart=visualizationType===types.Qb.ActionsStackedBar,renderYAxisSettings=name1=>{var _chartSettings$name$s,_chartSettings$name$s2,_ref,_chartSettings$name$s3,_chartSettings$name$s4;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center justify-between",children:[(0,jsx_runtime.jsx)("span",{className:"font-medium",children:"Scale"}),(0,jsx_runtime.jsx)(src.Yv,{size:"xsmall",value:null!==(_chartSettings$name$s=chartSettings[name1]?.scale)&&void 0!==_chartSettings$name$s?_chartSettings$name$s:"linear",options:[{value:"linear",label:"Linear"},{value:"logarithmic",label:"Logarithmic"}],onChange:value=>{updateChartSettings({[name1]:{scale:value}})}})]}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 w-full",label:"Show labels",checked:null===(_chartSettings$name$s2=chartSettings[name1]?.showTicks)||void 0===_chartSettings$name$s2||_chartSettings$name$s2,onChange:value=>{updateChartSettings({[name1]:{showTicks:value}})}}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 w-full",label:"Begin at zero",checked:null===(_ref=null!==(_chartSettings$name$s3=chartSettings[name1]?.startAtZero)&&void 0!==_chartSettings$name$s3?_chartSettings$name$s3:chartSettings.yAxisAtZero)||void 0===_ref||_ref,onChange:value=>{updateChartSettings({[name1]:{startAtZero:value}})}}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 w-full",label:"Show grid lines",checked:null===(_chartSettings$name$s4=chartSettings[name1]?.showGridLines)||void 0===_chartSettings$name$s4||_chartSettings$name$s4,onChange:value=>{updateChartSettings({[name1]:{showGridLines:value}})}})]})};return(0,jsx_runtime.jsx)("div",{className:"flex flex-col w-full",children:(0,jsx_runtime.jsx)(src.JL,{embedded:!0,defaultActiveKeys:["general"],multiple:!0,panels:[{key:"general",header:"General",className:"p-2 flex flex-col gap-2",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 w-full",label:"Show legend",checked:null!==(_chartSettings$showLe=chartSettings.showLegend)&&void 0!==_chartSettings$showLe&&_chartSettings$showLe,onChange:value=>{updateChartSettings({showLegend:value})}}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 w-full",label:"Show total row",checked:null===(_chartSettings$showTo=chartSettings.showTotalRow)||void 0===_chartSettings$showTo||_chartSettings$showTo,onChange:value=>{updateChartSettings({showTotalRow:value})}}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 w-full",label:"Show X-axis labels",checked:null===(_chartSettings$showXA=chartSettings.showXAxisTicks)||void 0===_chartSettings$showXA||_chartSettings$showXA,onChange:value=>{updateChartSettings({showXAxisTicks:value})}}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 w-full",label:"Show X-axis border",checked:null===(_chartSettings$showXA2=chartSettings.showXAxisBorder)||void 0===_chartSettings$showXA2||_chartSettings$showXA2,onChange:value=>{updateChartSettings({showXAxisBorder:value})}}),(0,jsx_runtime.jsx)(src.f4,{className:"flex-1 w-full",label:"Show Y-axis border",checked:null===(_chartSettings$showYA=chartSettings.showYAxisBorder)||void 0===_chartSettings$showYA||_chartSettings$showYA,onChange:value=>{updateChartSettings({showYAxisBorder:value})}})]})},{key:"left-y-axis",header:"Left Y-axis",className:"p-2 flex flex-col gap-2",content:renderYAxisSettings("leftYAxisSettings")},{key:"right-y-axis",header:"Right Y-axis",className:"p-2 flex flex-col gap-2",content:renderYAxisSettings("rightYAxisSettings")},isStackedBarChart?{key:"stacked-bar-chart",header:"Stack bars",className:"p-2 flex flex-col gap-2",content:(0,jsx_runtime.jsx)(src.f4,{className:"flex-1",label:"Stack bars 100%",checked:null!==(_chartSettings$stackB=chartSettings.stackBars100)&&void 0!==_chartSettings$stackB&&_chartSettings$stackB,onChange:value=>{updateChartSettings({stackBars100:value})}})}:null,{key:"goals",header:{children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1 flex-1",children:[(0,jsx_runtime.jsx)("span",{className:"flex-1",children:"Goals"}),goalLines.length>0&&(0,jsx_runtime.jsx)(src.Mo.Number,{status:"muted",size:"small",count:goalLines.length})]})},className:"p-2",content:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[goalLines.map((_ref2,goalLineIndex)=>{let{label,value=0,displayLabel=!0}=_ref2;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 gap-1 mb-1",children:[(0,jsx_runtime.jsx)(SeriesGlyph.rF,{className:"self-center",hasBreakdown:!1,seriesIndex:goalLineIndex}),(0,jsx_runtime.jsx)(src.DF,{placeholder:"Label",className:"grow-2",value:label,suffix:(0,jsx_runtime.jsx)(src.Jp,{size:"small",noPadding:!0,icon:displayLabel?(0,jsx_runtime.jsx)(posthog_icons_es.IconEye,{}):(0,jsx_runtime.jsx)(icons.$L,{}),tooltip:displayLabel?"Display label":"Hide label",onClick:e=>{e.stopPropagation(),updateGoalLine(goalLineIndex,"displayLabel",!displayLabel)}}),onChange:value=>updateGoalLine(goalLineIndex,"label",value)}),(0,jsx_runtime.jsx)(src.DF,{placeholder:"Value",className:"grow",value:value.toString(),inputMode:"numeric",onChange:value=>updateGoalLine(goalLineIndex,"value",parseInt(value))}),(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconTrash,{}),status:"danger",title:"Delete Goal Line",noPadding:!0,onClick:()=>removeGoalLine(goalLineIndex)},"delete")]},`${goalLineIndex}`)}),(0,jsx_runtime.jsx)(src.Jp,{className:"mt-1",onClick:addGoalLine,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPlusSmall,{}),fullWidth:!0,children:"Add goal line"})]})}]})})},{}),shouldShow:displayType=>displayType!==types.Qb.ActionsTable&&displayType!==types.Qb.BoldNumber}},SideBar=()=>{let{activeSideBarTab,visualizationType}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{setSideBarTab}=(0,index_esm.useActions)(dataVisualizationLogic.H8),tabs=(0,react.useMemo)(()=>Object.entries(TABS_TO_CONTENT).filter(_ref=>{let[_,tab]=_ref;return tab.shouldShow(visualizationType)}).map(_ref2=>{let[key,tab]=_ref2;return{label:tab.label,key}}),[visualizationType]);return(0,jsx_runtime.jsxs)("div",{className:"bg-surface-primary w-[18rem] flex flex-col",children:[(0,jsx_runtime.jsx)(src.TP,{size:"small",activeKey:activeSideBarTab,onChange:tab=>setSideBarTab(tab),tabs:tabs,className:"pt-1",barClassName:"px-3"}),(0,jsx_runtime.jsx)("div",{className:"flex-1 overflow-y-auto",children:TABS_TO_CONTENT[activeSideBarTab].content})]})};var Table=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Table.tsx"),TableDisplay=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/TableDisplay.tsx"),render=__webpack_require__("../../frontend/src/queries/nodes/HogQLX/render.tsx"),clipboardUtils=__webpack_require__("../../frontend/src/queries/nodes/DataTable/clipboardUtils.ts");function TabScroller(_ref){let{children}=_ref;return(0,jsx_runtime.jsx)("div",{className:"relative w-full overflow-auto",children:(0,jsx_runtime.jsx)("div",{className:"flex-1 absolute top-0 left-0 right-0 bottom-0",children:children})})}let fixSQLErrorsLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","fixSQLErrorsLogic"]),(0,index_esm.actions)({fixErrors:(query,error)=>({query,error})}),(0,lib.loaders)({response:[null,{fixErrors:async _ref=>{let{query,error}=_ref;return await api.ZP.fixHogQLErrors.fix(query,error)}}]})]);var kea_router_lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),lodash_isequal=__webpack_require__("../../node_modules/.pnpm/lodash.isequal@4.5.0/node_modules/lodash.isequal/index.js"),lodash_isequal_default=__webpack_require__.n(lodash_isequal),tabAwareActionToUrl=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareActionToUrl.ts"),tabAwareScene=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareScene.ts"),tabAwareUrlToAction=__webpack_require__("../../frontend/src/lib/logic/scenes/tabAwareUrlToAction.ts"),CodeEditor=__webpack_require__("../../frontend/src/lib/monaco/CodeEditor.tsx"),codeEditorLogic=__webpack_require__("../../frontend/src/lib/monaco/codeEditorLogic.tsx"),insightLogic=__webpack_require__("../../frontend/src/scenes/insights/insightLogic.tsx"),utils_api=__webpack_require__("../../frontend/src/scenes/insights/utils/api.ts"),sceneTypes=__webpack_require__("../../frontend/src/scenes/sceneTypes.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),query=__webpack_require__("../../frontend/src/queries/query.ts"),useOnMountEffect=__webpack_require__("../../frontend/src/lib/hooks/useOnMountEffect.ts");let VIEW_EMPTY_STATE_COPY=["Resolving joins between your tables…","Saving references to your tables…","Searching saved queries for references…","Fetching all references to optimize view…","Constructing SQL expressions…"];function ViewEmptyState(){let[messageIndex,setMessageIndex]=(0,react.useState)(0),[isMessageVisible,setIsMessageVisible]=(0,react.useState)(!0);return(0,useOnMountEffect.x)(()=>{let fadeTimeoutId=null,interval=setInterval(()=>{setIsMessageVisible(!1),fadeTimeoutId=setTimeout(()=>{setMessageIndex(current=>{let newIndex=Math.floor(Math.random()*VIEW_EMPTY_STATE_COPY.length);return newIndex===current&&(newIndex=(newIndex+1)%VIEW_EMPTY_STATE_COPY.length),newIndex}),setIsMessageVisible(!0)},300)},3e3);return()=>{clearInterval(interval),fadeTimeoutId&&clearTimeout(fadeTimeoutId)}}),(0,jsx_runtime.jsx)("div",{"data-attr":"view-empty-state",className:"flex flex-col flex-1 items-center justify-center",children:(0,jsx_runtime.jsx)("span",{className:`text-center transition-opacity duration-300 ${isMessageVisible?"opacity-100":"opacity-0"}`,children:VIEW_EMPTY_STATE_COPY[messageIndex]})})}var draftsLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/draftsLogic.tsx"),editorSceneLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/editorSceneLogic.tsx"),outputPaneLogic=__webpack_require__("../../frontend/src/scenes/data-warehouse/editor/outputPaneLogic.ts");let aiSuggestionOnAccept=(shouldRunQuery,actions,values,props)=>{actions.reportAIQueryAccepted();let currentEditorContent=values.suggestedQueryInput;props.editor&&(currentEditorContent="getModifiedEditor"in props.editor?props.editor.getModifiedEditor().getValue():props.editor.getValue()),actions.setQueryInput(currentEditorContent),shouldRunQuery&&actions.runQuery(currentEditorContent)},aiSuggestionOnReject=(actions,values)=>{actions.reportAIQueryRejected();let originalContent=values.suggestionPayload?.originalValue||values.queryInput;actions.setQueryInput(originalContent)};function getTabHash(values){var _values$queryInput;let hash={q:null!==(_values$queryInput=values.queryInput)&&void 0!==_values$queryInput?_values$queryInput:""};return values.activeTab?.view&&(hash.view=values.activeTab.view.id),values.activeTab?.insight&&(hash.insight=values.activeTab.insight.short_id),values.activeTab?.draft&&(hash.draft=values.activeTab.draft.id),hash}let multitabEditorLogic=(0,index_esm.kea)([(0,index_esm.path)(["data-warehouse","editor","multitabEditorLogic"]),(0,index_esm.props)({}),(0,tabAwareScene.P)(),(0,index_esm.connect)(()=>({values:[dataWarehouseViewsLogic.$,["dataWarehouseSavedQueries","dataWarehouseSavedQueryMapById"],userLogic.userLogic,["user"],draftsLogic.s,["drafts"]],actions:[dataWarehouseViewsLogic.$,["loadDataWarehouseSavedQueriesSuccess","deleteDataWarehouseSavedQuerySuccess","createDataWarehouseSavedQuerySuccess","runDataWarehouseSavedQuery","resetDataModelingJobs","loadDataModelingJobs","updateDataWarehouseSavedQuerySuccess","updateDataWarehouseSavedQueryFailure","updateDataWarehouseSavedQuery"],outputPaneLogic.o,["setActiveTab"],editorSceneLogic.h,["reportAIQueryPrompted","reportAIQueryAccepted","reportAIQueryRejected","reportAIQueryPromptOpen"],fixSQLErrorsLogic,["fixErrors","fixErrorsSuccess","fixErrorsFailure"],draftsLogic.s,["saveAsDraft","deleteDraft","saveAsDraftSuccess","deleteDraftSuccess"]]})),(0,index_esm.actions)(()=>({setQueryInput:queryInput=>({queryInput}),runQuery:(queryOverride,switchTab)=>({queryOverride,switchTab}),setActiveQuery:query=>({query}),setTabs:tabs=>({tabs}),createTab:(query,view,insight,draft)=>({query,view,insight,draft}),updateTab:tab=>({tab}),initialize:!0,loadUpstream:modelId=>({modelId}),saveAsView:function(){let materializeAfterSave=arguments.length>0&&void 0!==arguments[0]&&arguments[0],fromDraft=arguments.length>1?arguments[1]:void 0;return{fromDraft,materializeAfterSave}},saveAsViewSubmit:function(name1){let materializeAfterSave=arguments.length>1&&void 0!==arguments[1]&&arguments[1],fromDraft=arguments.length>2?arguments[2]:void 0;return{fromDraft,name:name1,materializeAfterSave}},saveAsInsight:!0,saveAsInsightSubmit:name1=>({name:name1}),updateInsight:!0,setFinishedLoading:loading=>({loading}),setError:error=>({error}),setDataError:error=>({error}),setSourceQuery:sourceQuery=>({sourceQuery}),setMetadata:metadata=>({metadata}),setMetadataLoading:loading=>({loading}),editView:(query,view)=>({query,view}),editInsight:(query,insight)=>({query,insight}),setLastRunQuery:lastRunQuery=>({lastRunQuery}),_setSuggestionPayload:payload=>({payload}),setSuggestedQueryInput:(suggestedQueryInput,source)=>({suggestedQueryInput,source}),onAcceptSuggestedQueryInput:shouldRunQuery=>({shouldRunQuery}),onRejectSuggestedQueryInput:!0,shareTab:!0,openHistoryModal:!0,closeHistoryModal:!0,setInProgressViewEdit:(viewId,historyId)=>({viewId,historyId}),setInProgressViewEdits:inProgressViewEdits=>({inProgressViewEdits}),deleteInProgressViewEdit:viewId=>({viewId}),setInProgressDraftEdit:(draftId,historyId)=>({draftId,historyId}),setInProgressDraftEdits:inProgressDraftEdits=>({inProgressDraftEdits}),deleteInProgressDraftEdit:draftId=>({draftId}),updateView:(view,draftId)=>({view,draftId}),updateViewSuccess:(view,draftId)=>({view,draftId}),setUpstreamViewMode:mode=>({mode}),setHoveredNode:nodeId=>({nodeId}),setTabDraftId:(tabUri,draftId)=>({tabUri,draftId}),saveDraft:(activeTab,queryInput,viewId)=>({activeTab,queryInput,viewId})})),(0,index_esm.propsChanged)((_ref,oldProps)=>{let{actions,props}=_ref;!oldProps.monaco&&!oldProps.editor&&props.monaco&&props.editor&&actions.initialize()}),(0,lib.loaders)(()=>({upstream:[null,{loadUpstream:async payload=>await api.ZP.upstream.get(payload.modelId)}]})),(0,index_esm.reducers)(_ref2=>{let{props}=_ref2;return{finishedLoading:[!0,{setFinishedLoading:(_,_ref3)=>{let{loading}=_ref3;return loading}}],sourceQuery:[{kind:schema_general.OH.DataVisualizationNode,source:{kind:schema_general.OH.HogQLQuery,query:""},display:types.Qb.ActionsLineGraph},{setSourceQuery:(_,_ref4)=>{let{sourceQuery}=_ref4;return sourceQuery}}],lastRunQuery:[null,{setLastRunQuery:(_,_ref5)=>{let{lastRunQuery}=_ref5;return lastRunQuery}}],queryInput:[null,{setQueryInput:(_,_ref6)=>{let{queryInput}=_ref6;return queryInput}}],activeQuery:[null,{setActiveQuery:(_,_ref7)=>{let{query}=_ref7;return query}}],editingInsight:[null,{updateTab:(_,_ref8)=>{var _tab$insight;let{tab}=_ref8;return null!==(_tab$insight=tab.insight)&&void 0!==_tab$insight?_tab$insight:null}}],allTabs:[[],{updateTab:(_,_ref9)=>{let{tab}=_ref9;return[tab]},setTabs:(_,_ref10)=>{let{tabs}=_ref10;return tabs}}],error:[null,{setError:(_,_ref11)=>{let{error}=_ref11;return error}}],metadataLoading:[!0,{setMetadataLoading:(_,_ref12)=>{let{loading}=_ref12;return loading}}],metadata:[null,{setMetadata:(_,_ref13)=>{let{metadata}=_ref13;return metadata}}],editorKey:[`hogql-editor-${props.tabId}`,{}],suggestionPayload:[null,{_setSuggestionPayload:(_,_ref14)=>{let{payload}=_ref14;return payload}}],isHistoryModalOpen:[!1,{openHistoryModal:()=>!0,closeHistoryModal:()=>!1}],inProgressViewEdits:[{},{setInProgressViewEdit:(state,_ref15)=>{let{viewId,historyId}=_ref15;return{...state,[viewId]:historyId}},deleteInProgressViewEdit:(state,_ref16)=>{let{viewId}=_ref16,newInProgressViewEdits={...state};return delete newInProgressViewEdits[viewId],newInProgressViewEdits},setInProgressViewEdits:(_,_ref17)=>{let{inProgressViewEdits}=_ref17;return inProgressViewEdits}}],inProgressDraftEdits:[{},{setInProgressDraftEdit:(state,_ref18)=>{let{draftId,historyId}=_ref18;return{...state,[draftId]:historyId}},deleteInProgressDraftEdit:(state,_ref19)=>{let{draftId}=_ref19,newInProgressDraftEdits={...state};return delete newInProgressDraftEdits[draftId],newInProgressDraftEdits},setInProgressDraftEdits:(_,_ref20)=>{let{inProgressDraftEdits}=_ref20;return inProgressDraftEdits}}],fixErrorsError:[null,{setQueryInput:()=>null,fixErrorsFailure:(_,_ref21)=>{let{error}=_ref21;return error}}],upstreamViewMode:["graph",{setUpstreamViewMode:(_,_ref22)=>{let{mode}=_ref22;return mode}}],hoveredNode:[null,{setHoveredNode:(_,_ref23)=>{let{nodeId}=_ref23;return nodeId}}]}}),(0,index_esm.listeners)(_ref24=>{let{values,props,actions,asyncActions,cache}=_ref24;return{fixErrorsSuccess:_ref25=>{let{response}=_ref25;actions.setSuggestedQueryInput(response.query,"hogql_fixer"),dist_module.ZP.capture("ai-error-fixer-success",{trace_id:response.trace_id})},fixErrorsFailure:()=>{dist_module.ZP.capture("ai-error-fixer-failure")},shareTab:()=>{var _values$queryInput2,_values$queryInput3,_values$queryInput4;let currentTab=values.activeTab;if(currentTab){if(currentTab.insight){let currentUrl=new URL(window.location.href),shareUrl=new URL(currentUrl.origin+currentUrl.pathname);if(shareUrl.searchParams.set("open_insight",currentTab.insight.short_id),currentTab.insight.query?.kind===schema_general.OH.DataVisualizationNode){let query=currentTab.insight.query.source.query;values.queryInput!==query&&shareUrl.searchParams.set("open_query",null!==(_values$queryInput2=values.queryInput)&&void 0!==_values$queryInput2?_values$queryInput2:"")}(0,copyToClipboard.v)(shareUrl.toString(),"share link")}else if(currentTab.view){let currentUrl=new URL(window.location.href),shareUrl=new URL(currentUrl.origin+currentUrl.pathname);shareUrl.searchParams.set("open_view",currentTab.view.id),values.queryInput!=currentTab.view.query.query&&shareUrl.searchParams.set("open_query",null!==(_values$queryInput3=values.queryInput)&&void 0!==_values$queryInput3?_values$queryInput3:""),(0,copyToClipboard.v)(shareUrl.toString(),"share link")}else{let currentUrl=new URL(window.location.href),shareUrl=new URL(currentUrl.origin+currentUrl.pathname);shareUrl.searchParams.set("open_query",null!==(_values$queryInput4=values.queryInput)&&void 0!==_values$queryInput4?_values$queryInput4:""),(0,copyToClipboard.v)(shareUrl.toString(),"share link")}}},setSuggestedQueryInput:_ref26=>{let{suggestedQueryInput,source}=_ref26;if(!values.activeTab){actions.createTab(suggestedQueryInput);return}values.queryInput&&""!==values.queryInput.trim()?actions._setSuggestionPayload({suggestedValue:suggestedQueryInput,originalValue:values.queryInput,acceptText:"Accept",rejectText:"Reject",onAccept:aiSuggestionOnAccept,onReject:aiSuggestionOnReject,source,diffShowRunButton:!0}):actions.setQueryInput(suggestedQueryInput)},onAcceptSuggestedQueryInput:_ref27=>{let{shouldRunQuery}=_ref27;if(values.suggestionPayload?.onAccept(!!shouldRunQuery,actions,values,props),props.monaco&&values.activeTab){let existingModel=props.monaco.editor.getModel(values.activeTab.uri);if(existingModel)props.editor&&"getModifiedEditor"in props.editor?props.editor.getModifiedEditor().setModel(existingModel):props.editor?.setModel(existingModel);else{let newModel=props.monaco.editor.createModel(values.suggestedQueryInput,"hogQL",values.activeTab.uri);cache.createdModels=cache.createdModels||[],cache.createdModels.push(newModel),(0,CodeEditor.Z)(newModel,(0,codeEditorLogic.P)({key:`hogql-editor-${props.tabId}`,query:values.suggestedQueryInput,language:"hogQL"})),props.editor&&"getModifiedEditor"in props.editor?props.editor.getModifiedEditor().setModel(newModel):props.editor?.setModel(newModel)}}dist_module.ZP.capture("sql-editor-accepted-suggestion",{source:values.suggestedSource}),actions._setSuggestionPayload(null)},onRejectSuggestedQueryInput:()=>{if(values.suggestionPayload?.onReject(actions,values,props),props.monaco&&values.activeTab){let existingModel=props.monaco.editor.getModel(values.activeTab.uri);if(existingModel)props.editor&&"getModifiedEditor"in props.editor?props.editor.getModifiedEditor().setModel(existingModel):props.editor?.setModel(existingModel);else{var _values$queryInput5,_values$queryInput6;let newModel=props.monaco.editor.createModel(null!==(_values$queryInput5=values.queryInput)&&void 0!==_values$queryInput5?_values$queryInput5:"","hogQL",values.activeTab.uri);cache.createdModels=cache.createdModels||[],cache.createdModels.push(newModel),(0,CodeEditor.Z)(newModel,(0,codeEditorLogic.P)({key:`hogql-editor-${props.tabId}`,query:null!==(_values$queryInput6=values.queryInput)&&void 0!==_values$queryInput6?_values$queryInput6:"",language:"hogQL"})),props.editor&&"getModifiedEditor"in props.editor?props.editor.getModifiedEditor().setModel(newModel):props.editor?.setModel(newModel)}}dist_module.ZP.capture("sql-editor-rejected-suggestion",{source:values.suggestedSource}),actions._setSuggestionPayload(null)},editView:_ref28=>{let{query,view}=_ref28;actions.createTab(query,view)},editInsight:_ref29=>{let{query,insight}=_ref29;actions.createTab(query,void 0,insight)},createTab:async _ref30=>{let{query="",view,insight,draft}=_ref30,tabName=draft?.name||view?.name||insight?.name||"Untitled";if(props.monaco){let uri=props.monaco.Uri.parse("1"),model=props.monaco.editor.getModel(uri);if(!model){var _values$sourceQuery$s;model=props.monaco.editor.createModel(query,"hogQL",uri),cache.createdModels=cache.createdModels||[],cache.createdModels.push(model),props.editor?.setModel(model),(0,CodeEditor.Z)(model,(0,codeEditorLogic.P)({key:`hogql-editor-${props.tabId}`,query:null!==(_values$sourceQuery$s=values.sourceQuery?.source.query)&&void 0!==_values$sourceQuery$s?_values$sourceQuery$s:"",language:"hogQL"}))}actions.updateTab({uri,view,insight,name:tabName,sourceQuery:insight?.query,draft:draft})}if(query)actions.setQueryInput(query);else if(draft)actions.setQueryInput(draft.query.query);else if(view)actions.setQueryInput(view.query.query);else if(insight){let queryObject=insight.query?.source||insight.query;queryObject&&"query"in queryObject&&actions.setQueryInput(queryObject.query||"")}},setSourceQuery:_ref31=>{let{sourceQuery}=_ref31;if(!values.activeTab)return;let currentTab=values.activeTab;currentTab&&actions.updateTab({...currentTab,sourceQuery})},initialize:async()=>{actions.setFinishedLoading(!1)},setQueryInput:_ref32=>{let{queryInput}=_ref32;values.activeTab?.view&&values.activeTab?.view.query?.query&&(queryInput===values.activeTab.view?.query.query?actions.deleteInProgressViewEdit(values.activeTab.view.id):!values.inProgressViewEdits[values.activeTab.view.id]&&values.activeTab.view.latest_history_id&&actions.setInProgressViewEdit(values.activeTab.view.id,values.activeTab.view.latest_history_id))},saveDraft:async _ref33=>{let{activeTab,queryInput,viewId}=_ref33,latestActiveTab=values.allTabs.find(tab=>tab.uri.toString()===activeTab.uri.toString());latestActiveTab&&actions.saveAsDraft({kind:schema_general.OH.HogQLQuery,query:queryInput},viewId,latestActiveTab)},saveAsDraftSuccess:_ref34=>{let{draft,tab:tabToUpdate}=_ref34;actions.updateTab({...tabToUpdate,name:draft.name,draft:draft})},runQuery:_ref35=>{var _ref36;let{queryOverride,switchTab}=_ref35,query=null!==(_ref36=queryOverride||values.queryInput)&&void 0!==_ref36?_ref36:"",newSource={...values.sourceQuery.source,query};actions.setSourceQuery({...values.sourceQuery,source:newSource}),actions.setLastRunQuery({...values.sourceQuery,source:newSource}),cache.umountDataNode||(cache.umountDataNode=(0,dataNodeLogic.M)({key:values.dataLogicKey,query:newSource}).mount()),(0,dataNodeLogic.M)({key:values.dataLogicKey,query:newSource}).actions.loadData(switchTab?"async":"force_async")},saveAsView:async _ref37=>{let{fromDraft,materializeAfterSave=!1}=_ref37;src.dn.openForm({title:"Save as view",initialValues:{viewName:values.activeTab?.name||""},description:"View names can only contain letters, numbers, '_', or '$'. Spaces are not allowed.",content:isLoading=>isLoading?(0,jsx_runtime.jsx)("div",{className:"h-[37px] flex items-center",children:(0,jsx_runtime.jsx)(ViewEmptyState,{})}):(0,jsx_runtime.jsx)(LemonField.D,{name:"viewName",children:(0,jsx_runtime.jsx)(src.DF,{"data-attr":"sql-editor-input-save-view-name",disabled:isLoading,placeholder:"Please enter the name of the view",autoFocus:!0})}),errors:{viewName:name1=>name1?/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(name1)?void 0:"Name must be valid":"You must enter a name"},onSubmit:async _ref38=>{let{viewName}=_ref38;await asyncActions.saveAsViewSubmit(viewName,materializeAfterSave,fromDraft)},shouldAwaitSubmit:!0})},saveAsViewSubmit:async _ref39=>{var _values$queryInput7,_response$types;let{name:name1,materializeAfterSave=!1,fromDraft}=_ref39,queryToSave={...values.sourceQuery.source,query:null!==(_values$queryInput7=values.queryInput)&&void 0!==_values$queryInput7?_values$queryInput7:""},response=(0,dataNodeLogic.M)({key:values.dataLogicKey,query:queryToSave}).values.response,types=response&&"types"in response&&null!==(_response$types=response.types)&&void 0!==_response$types?_response$types:[];try{await dataWarehouseViewsLogic.$.asyncActions.createDataWarehouseSavedQuery({name:name1,query:queryToSave,types});let savedQuery=dataWarehouseViewsLogic.$.values.dataWarehouseSavedQueries.find(q=>q.name===name1);materializeAfterSave&&savedQuery&&await dataWarehouseViewsLogic.$.asyncActions.updateDataWarehouseSavedQuery({id:savedQuery.id,sync_frequency:"24hour",types:[[]],lifecycle:"create"}),fromDraft&&actions.deleteDraft(fromDraft,savedQuery?.name)}catch{src.UJ.error("Failed to save view")}},saveAsInsight:async()=>{src.dn.openForm({title:"Save as new insight",initialValues:{name:""},content:(0,jsx_runtime.jsx)(LemonField.D,{name:"name",children:(0,jsx_runtime.jsx)(src.DF,{"data-attr":"insight-name",placeholder:"Please enter the new name",autoFocus:!0})}),errors:{name:name1=>name1?void 0:"You must enter a name"},onSubmit:async _ref40=>{let{name:name1}=_ref40;return actions.saveAsInsightSubmit(name1)}})},saveAsInsightSubmit:async _ref41=>{let{name:name1}=_ref41,insight=await utils_api.L.create({name:name1,query:values.sourceQuery,saved:!0}),logic=(0,insightLogic.zm)({dashboardItemId:insight.short_id,doNotLoad:!0}),umount=logic.mount();logic.actions.setInsight(insight,{fromPersistentApi:!0,overrideQuery:!0});let timeoutId=window.setTimeout(()=>umount(),1e4);cache.timeouts=cache.timeouts||[],cache.timeouts.push(timeoutId),src.UJ.info(`You're now viewing ${insight.name||insight.derived_name||name1}`),kea_router_lib.router.actions.push(urls.j.insightView(insight.short_id))},updateInsight:async()=>{if(!values.editingInsight)return;let insightName=values.activeTab?.name,insightRequest={name:null!=insightName?insightName:values.editingInsight.name,query:values.sourceQuery},savedInsight=await utils_api.L.update(values.editingInsight.id,insightRequest);values.activeTab&&actions.updateTab({...values.activeTab,insight:savedInsight});let loadedLogic=insightLogic.zm.findMounted({dashboardItemId:values.editingInsight.short_id,dashboardId:void 0});loadedLogic&&loadedLogic.actions.setInsight(savedInsight,{overrideQuery:!0,fromPersistentApi:!0}),src.UJ.info(`You're now viewing ${savedInsight.name||savedInsight.derived_name||name}`),kea_router_lib.router.actions.push(urls.j.insightView(savedInsight.short_id))},loadDataWarehouseSavedQueriesSuccess:_ref42=>{let{dataWarehouseSavedQueries}=_ref42,tab=values.activeTab,view=dataWarehouseSavedQueries.find(v=>v.id===tab.view?.id);tab&&view&&(actions.setTabs([{...tab,view}]),actions.setQueryInput(view.query.query||""))},deleteDataWarehouseSavedQuerySuccess:_ref43=>{let{payload:viewId}=_ref43;values.allTabs.find(tab=>tab.view?.id===viewId&&!tab.draft)&&(actions.setTabs([]),actions.createTab()),src.UJ.success("View deleted")},createDataWarehouseSavedQuerySuccess:_ref44=>{let{dataWarehouseSavedQueries,payload:view}=_ref44,newView=view&&dataWarehouseSavedQueries.find(v=>v.name===view.name);if(newView){let oldTab=values.activeTab;oldTab&&actions.updateTab({...oldTab,view:newView})}},updateDataWarehouseSavedQuerySuccess:()=>{src.UJ.success("View updated")},updateView:async _ref45=>{let{view,draftId}=_ref45,latestView=await api.ZP.dataWarehouseSavedQueries.get(view.id);view.edited_history_id!==latestView?.latest_history_id&&view.query?.query!==latestView?.query.query?(actions._setSuggestionPayload({originalValue:latestView?.query.query,acceptText:"Confirm changes",rejectText:"Cancel",diffShowRunButton:!1,onAccept:async()=>{var _view$query$query;actions.setQueryInput(null!==(_view$query$query=view.query?.query)&&void 0!==_view$query$query?_view$query$query:""),await dataWarehouseViewsLogic.$.asyncActions.updateDataWarehouseSavedQuery({...view,edited_history_id:latestView?.latest_history_id}),actions.updateViewSuccess(view,draftId)},onReject:()=>{}}),src.UJ.error("View has been edited by another user. Review changes to update.")):(await dataWarehouseViewsLogic.$.asyncActions.updateDataWarehouseSavedQuery(view),actions.updateViewSuccess(view,draftId))},updateViewSuccess:_ref46=>{let{view,draftId}=_ref46;draftId&&actions.deleteDraft(draftId,view?.name)},deleteDraftSuccess:_ref47=>{let{draftId,viewName}=_ref47,newTabs=values.allTabs.map(tab=>({...tab,draft:tab.draft?.id===draftId?void 0:tab.draft,name:tab.draft?.id===draftId&&viewName?viewName:tab.name}));actions.setTabs(newTabs)}}}),(0,kea_subscriptions_lib.Vt)(_ref48=>{let{actions,values}=_ref48;return{showLegacyFilters:showLegacyFilters=>{showLegacyFilters?"object"!=typeof values.sourceQuery.source.filters&&actions.setSourceQuery({...values.sourceQuery,source:{...values.sourceQuery.source,filters:{}}}):void 0!==values.sourceQuery.source.filters&&actions.setSourceQuery({...values.sourceQuery,source:{...values.sourceQuery.source,filters:void 0}})},editingView:editingView=>{editingView&&(actions.resetDataModelingJobs(),actions.loadDataModelingJobs(editingView.id),actions.loadUpstream(editingView.id))},drafts:drafts=>{let newTabs=values.allTabs.map(tab=>{var _ref49,_drafts$find$name;return{...tab,draft:drafts.find(d=>d.id===tab.draft?.id),name:null!==(_ref49=null!==(_drafts$find$name=drafts.find(d=>d.id===tab.draft?.id)?.name)&&void 0!==_drafts$find$name?_drafts$find$name:tab.view?.name)&&void 0!==_ref49?_ref49:tab.name}});actions.setTabs(newTabs)}}}),(0,index_esm.selectors)({activeTab:[s=>[s.allTabs],allTabs=>{var _allTabs$;return null!==(_allTabs$=allTabs?.[0])&&void 0!==_allTabs$?_allTabs$:null}],suggestedSource:[s=>[s.suggestionPayload],suggestionPayload=>{var _suggestionPayload$so;return null!==(_suggestionPayload$so=suggestionPayload?.source)&&void 0!==_suggestionPayload$so?_suggestionPayload$so:null}],diffShowRunButton:[s=>[s.suggestionPayload],suggestionPayload=>suggestionPayload?.diffShowRunButton],acceptText:[s=>[s.suggestionPayload],suggestionPayload=>{var _suggestionPayload$ac;return null!==(_suggestionPayload$ac=suggestionPayload?.acceptText)&&void 0!==_suggestionPayload$ac?_suggestionPayload$ac:"Accept"}],rejectText:[s=>[s.suggestionPayload],suggestionPayload=>{var _suggestionPayload$re;return null!==(_suggestionPayload$re=suggestionPayload?.rejectText)&&void 0!==_suggestionPayload$re?_suggestionPayload$re:"Reject"}],suggestedQueryInput:[s=>[s.suggestionPayload,s.queryInput],(suggestionPayload,queryInput)=>{if(suggestionPayload?.suggestedValue&&suggestionPayload?.suggestedValue!==queryInput){var _suggestionPayload$su;return null!==(_suggestionPayload$su=suggestionPayload?.suggestedValue)&&void 0!==_suggestionPayload$su?_suggestionPayload$su:""}return null!=queryInput?queryInput:""}],originalQueryInput:[s=>[s.suggestionPayload,s.queryInput],(suggestionPayload,queryInput)=>{if(suggestionPayload?.suggestedValue)return suggestionPayload?.originalValue||queryInput}],editingView:[s=>[s.activeTab],activeTab=>activeTab?.view],changesToSave:[s=>[s.editingView,s.queryInput],(editingView,queryInput)=>editingView?.query?.query!==queryInput],exportContext:[s=>[s.sourceQuery],sourceQuery=>({...(0,query.Vp)(sourceQuery.source,void 0,void 0),filename:"export"})],isEditingMaterializedView:[s=>[s.editingView],editingView=>!!editingView?.is_materialized],isSourceQueryLastRun:[s=>[s.queryInput,s.lastRunQuery],(queryInput,lastRunQuery)=>queryInput===lastRunQuery?.source.query],updateInsightButtonEnabled:[s=>[s.sourceQuery,s.activeTab],(sourceQuery,activeTab)=>{if(!activeTab?.insight?.query||!activeTab.sourceQuery)return!1;let updatedName=activeTab.name!==activeTab.insight.name,sourceQueryWithoutUndefinedAndNullKeys=(0,utils.lC)(sourceQuery);return updatedName||!lodash_isequal_default()(sourceQueryWithoutUndefinedAndNullKeys,(0,utils.lC)(activeTab.insight.query))}],showLegacyFilters:[s=>[s.queryInput],queryInput=>queryInput&&(-1!==queryInput.indexOf("{filters}")||-1!==queryInput.indexOf("{filters."))],dataLogicKey:[(_,p)=>[p.tabId],tabId=>`data-warehouse-editor-data-node-${tabId}`],isDraft:[s=>[s.activeTab],activeTab=>!!activeTab&&!!activeTab.draft?.id],currentDraft:[s=>[s.activeTab],activeTab=>activeTab?activeTab.draft:null],breadcrumbs:[s=>[s.activeTab],activeTab=>{let{draft,insight,view}=activeTab||{},first={key:sceneTypes.x.SQLEditor,name:"SQL query",to:urls.j.sqlEditor(),iconType:"sql_editor"};return view?[first,{key:view.id,name:view.name,path:urls.j.sqlEditor(void 0,view.id),iconType:"sql_editor"}]:insight?[first,{key:insight.id,name:insight.name||insight.derived_name||"Untitled",path:urls.j.sqlEditor(void 0,void 0,insight.short_id),iconType:"sql_editor"}]:draft?[first,{key:draft.id,name:draft.name||"Untitled",path:urls.j.sqlEditor(void 0,void 0,void 0,draft.id),iconType:"sql_editor"}]:[first]}]}),(0,tabAwareActionToUrl.N)(_ref50=>{let{values}=_ref50;return{setQueryInput:()=>[urls.j.sqlEditor(),void 0,getTabHash(values),{replace:!0}],createTab:()=>[urls.j.sqlEditor(),void 0,getTabHash(values),{replace:!0}]}}),(0,tabAwareUrlToAction.O)(_ref51=>{let{actions,values,props}=_ref51;return{[urls.j.sqlEditor()]:async(_,searchParams,hashParams)=>{if(!searchParams.open_query&&!searchParams.open_view&&!searchParams.open_insight&&!searchParams.open_draft&&!searchParams.output_tab&&!hashParams.q&&!hashParams.view&&!hashParams.insight)return;let tabAdded=!1,createQueryTab=async()=>{if(searchParams.output_tab&&actions.setActiveTab(searchParams.output_tab),searchParams.open_draft||hashParams.draft&&null===values.queryInput){let draftId=searchParams.open_draft||hashParams.draft,draft=values.drafts.find(draft=>draft.id===draftId);if(!draft){src.UJ.error("Draft not found");return}if(!values.allTabs.find(tab=>tab.draft?.id===draft.id)){let associatedView=draft.saved_query_id?values.dataWarehouseSavedQueryMapById[draft.saved_query_id]:void 0;actions.createTab(draft.query.query,associatedView,void 0,draft);let newTab=values.allTabs[values.allTabs.length-1];newTab&&actions.setTabDraftId(newTab.uri.toString(),draft.id)}return}if(searchParams.open_view||hashParams.view&&null===values.queryInput){let viewId=searchParams.open_view||hashParams.view;0===values.dataWarehouseSavedQueries.length&&await dataWarehouseViewsLogic.$.asyncActions.loadDataWarehouseSavedQueries();let view=values.dataWarehouseSavedQueries.find(n=>n.id===viewId);if(!view){src.UJ.error("View not found");return}let queryToOpen=searchParams.open_query?searchParams.open_query:view.query.query;actions.editView(queryToOpen,view),tabAdded=!0,kea_router_lib.router.actions.replace(urls.j.sqlEditor(),void 0,getTabHash(values))}else if(searchParams.open_insight||hashParams.insight&&null===values.queryInput){let shortId=searchParams.open_insight||hashParams.insight;if("new"===shortId){actions.createTab(),tabAdded=!0,kea_router_lib.router.actions.replace(urls.j.sqlEditor(),void 0,getTabHash(values));return}let insight=await utils_api.L.getByShortId(shortId,void 0,"async");if(!insight){src.UJ.error("Insight not found");return}let query="";insight.query?.kind===schema_general.OH.DataVisualizationNode&&(query=insight.query.source.query);let queryToOpen=searchParams.open_query?searchParams.open_query:query;actions.editInsight(queryToOpen,insight),insight.query&&actions.setSourceQuery(insight.query),actions.setActiveTab(outputPaneLogic.R.Visualization),insight.query?.kind===schema_general.OH.DataVisualizationNode&&insight.query&&!searchParams.open_query?((0,dataNodeLogic.M)({key:values.dataLogicKey,query:insight.query.source}).mount(),(0,dataNodeLogic.M)({key:values.dataLogicKey,query:insight.query.source}).values.response||actions.runQuery()):actions.runQuery(),tabAdded=!0,kea_router_lib.router.actions.replace(urls.j.sqlEditor(),void 0,getTabHash(values))}else searchParams.open_query?(actions.createTab(searchParams.open_query),tabAdded=!0):hashParams.q&&null===values.queryInput&&(actions.createTab(hashParams.q),tabAdded=!0)};if(props.monaco)await createQueryTab();else{let waitUntilMonaco=async()=>await new Promise((resolve,reject)=>{let intervalCount=0,interval=setInterval(()=>{intervalCount++,props.monaco&&!tabAdded?(clearInterval(interval),resolve()):intervalCount>=1e4/300&&(clearInterval(interval),reject())},300)});await waitUntilMonaco().then(async()=>{await createQueryTab()})}}}}),(0,index_esm.beforeUnmount)(_ref52=>{let{cache}=_ref52;cache.umountDataNode?.(),cache.createdModels?.forEach(m=>{try{m.dispose()}catch{}}),cache.createdModels=[];let timeouts=cache.timeouts;timeouts?.forEach(t=>{try{clearTimeout(t)}catch{}}),cache.timeouts=[]})]);function FixErrorButton(_ref){let{type,size,contentOverride,source}=_ref,{queryInput,fixErrorsError,metadata}=(0,index_esm.useValues)(multitabEditorLogic),{fixErrors:fixHogQLErrors}=(0,index_esm.useActions)(multitabEditorLogic),{responseError}=(0,index_esm.useValues)(dataNodeLogic.M),{responseLoading:fixHogQLErrorsLoading}=(0,index_esm.useValues)(fixSQLErrorsLogic),queryError=responseError||metadata?.errors?.map(n=>n.message)?.join(". ")||void 0,icon=(0,react.useMemo)(()=>fixHogQLErrorsLoading?(0,jsx_runtime.jsx)(src.$j,{}):fixErrorsError?(0,jsx_runtime.jsx)(posthog_icons_es.IconWarning,{className:"text-warning"}):(0,jsx_runtime.jsx)(posthog_icons_es.IconMagicWand,{}),[fixHogQLErrorsLoading,fixErrorsError]),disabledReason=(0,react.useMemo)(()=>queryError?!!fixErrorsError&&fixErrorsError:"No query error to fix",[queryError,fixErrorsError]),content=(0,react.useMemo)(()=>fixHogQLErrorsLoading?"Fixing...":fixErrorsError?"Can't fix":null!=contentOverride?contentOverride:"Fix errors",[fixErrorsError,fixHogQLErrorsLoading,contentOverride]);return(0,jsx_runtime.jsx)(LemonButton.J,{type:type,size:size,disabledReason:disabledReason,icon:icon,onClick:()=>{fixHogQLErrors(null!=queryInput?queryInput:"",queryError),dist_module.ZP.capture("sql-editor-fix-error-click",{source})},children:content})}var CodeSnippet=__webpack_require__("../../frontend/src/lib/components/CodeSnippet/index.ts"),projectLogic=__webpack_require__("../../frontend/src/scenes/projectLogic.ts"),endpointLogic=__webpack_require__("../../products/endpoints/frontend/endpointLogic.tsx");let variablesColumns=[{title:"Variable Name",key:"code_name",dataIndex:"code_name"},{title:"Type",key:"type",dataIndex:"type"},{title:"Default Value",key:"default_value",dataIndex:"default_value",render:(_,variable)=>variable.default_value||"-"},{title:"Values",key:"values",render:(_,variable)=>"List"===variable.type&&"values"in variable&&variable.values?variable.values.join(", "):"-"}];function generateVariablesJson(variables){return 0===variables.length?"      // No variables defined":variables.map((variable,index)=>{let isLast=index===variables.length-1,exampleValue="";switch(variable.type){case"String":exampleValue=`"${variable.default_value||"example-string"}"`;break;case"Number":exampleValue=String(variable.default_value||"123");break;case"Boolean":exampleValue=String(variable.default_value||"true");break;case"List":exampleValue="List"===variable.type&&"values"in variable&&variable.values?JSON.stringify(variable.values):'["option1", "option2"]';break;case"Date":exampleValue=`"${variable.default_value||"2024-01-01"}"`;break;default:exampleValue='""'}return`      "${variable.code_name}": ${exampleValue}${isLast?"":","}`}).join("\n")}function getEndpointUrl(projectId,endpointName){return`${window.location.origin}/api/projects/${projectId}/endpoints/${(0,utils.lV)(endpointName||"your-endpoint-name")}`}function generateTerminalExample(endpointName,variables,projectId){return`curl -X POST ${getEndpointUrl(projectId,endpointName)} \\
  -H "Authorization: Bearer $POSTHOG_PERSONAL_API_KEY" \\
  -H "Content-Type: application/json" \\
  -d '{
    "variables_values": {
${generateVariablesJson(variables)}
    }
  }'`}function generatePythonExample(endpointName,variables,projectId){return`import requests
import json

url = "${getEndpointUrl(projectId,endpointName)}"

headers = {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'
}

payload = {
    "variables_values": {
${generateVariablesJson(variables)}
    }
}

response = requests.post(url, headers=headers, data=json.dumps(payload))
print(response.json())`}function generateNodeExample(endpointName,variables,projectId){return`const fetch = require('node-fetch');

const url = '${getEndpointUrl(projectId,endpointName)}';

const headers = {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer {POSTHOG_PERSONAL_API_KEY}'
};

const payload = {
    "variables_values": {
${generateVariablesJson(variables)}
    }
};

fetch(url, {
    method: 'POST',
    headers: headers,
    body: JSON.stringify(payload)
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`}function CodeExamples(_ref){let{endpointName,variables,projectId,tabId}=_ref,{setActiveCodeExampleTab}=(0,index_esm.useActions)((0,endpointLogic.U)({tabId})),{activeCodeExampleTab}=(0,index_esm.useValues)((0,endpointLogic.U)({tabId}));return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Example Usage"}),(0,jsx_runtime.jsx)(src.TP,{activeKey:activeCodeExampleTab,className:"w-2/3",size:"small",onChange:tab=>setActiveCodeExampleTab(tab),tabs:[{key:"terminal",label:"Terminal"},{key:"python",label:"Python"},{key:"nodejs",label:"Node.js"}]}),(0,jsx_runtime.jsx)("div",{className:"mt-2 w-2/3",children:(0,jsx_runtime.jsx)(CodeSnippet.O,{language:(tab=>{switch(tab){case"terminal":default:return CodeSnippet.S.Bash;case"python":return CodeSnippet.S.Python;case"nodejs":return CodeSnippet.S.JavaScript}})(activeCodeExampleTab),wrap:!0,children:(tab=>{switch(tab){case"terminal":default:return generateTerminalExample(endpointName,variables,projectId);case"python":return generatePythonExample(endpointName,variables,projectId);case"nodejs":return generateNodeExample(endpointName,variables,projectId)}})(activeCodeExampleTab)})})]})}function Endpoint(_ref2){let{tabId}=_ref2,{setEndpointName,setEndpointDescription,createEndpoint}=(0,index_esm.useActions)((0,endpointLogic.U)({tabId})),{endpointName,endpointDescription}=(0,index_esm.useValues)((0,endpointLogic.U)({tabId})),{currentProject}=(0,index_esm.useValues)(projectLogic.K),{variablesForInsight}=(0,index_esm.useValues)(variablesLogic.Q),{queryInput}=(0,index_esm.useValues)(multitabEditorLogic);return(0,jsx_runtime.jsxs)("div",{className:"space-y-4",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:"Endpoint"}),(0,jsx_runtime.jsx)(src.oe,{type:"completion",children:"ALPHA"})]}),(0,jsx_runtime.jsxs)("div",{className:"space-y-2",children:[(0,jsx_runtime.jsxs)("p",{className:"text-xs",children:["Endpoints are a way of pre-defining queries that you can query via the API, with additional performance improvements and the benefits of monitoring cost and usage.",(0,jsx_runtime.jsx)("br",{}),"Once created, you will get a URL that you can make an API request to from your own code."]}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Endpoint name",children:(0,jsx_runtime.jsx)(src.DF,{id:`endpoint-name-${tabId}`,type:"text",onChange:setEndpointName,value:endpointName||"",className:"w-1/3"})}),(0,jsx_runtime.jsx)(LemonField.D.Pure,{label:"Endpoint description",children:(0,jsx_runtime.jsx)(src._V,{minRows:1,maxRows:3,onChange:setEndpointDescription,value:endpointDescription||"",className:"w-1/3"})}),(0,jsx_runtime.jsx)(src.Jp,{type:"primary",onClick:()=>{let sqlQuery=queryInput||"";if(!sqlQuery.trim()){src.UJ.error("You are missing a HogQL query.");return}if(!endpointName?.trim()){src.UJ.error("You need to name your endpoint.");return}let transformedVariables=variablesForInsight.length>0?variablesForInsight.reduce((acc,variable,index)=>(acc[`var_${index}`]={variableId:variable.id,code_name:variable.code_name,value:variable.value||variable.default_value},acc),{}):{};createEndpoint({name:endpointName,description:endpointDescription||"",query:{kind:schema_general.OH.HogQLQuery,query:sqlQuery,variables:transformedVariables}})},icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode2,{}),size:"medium",children:"Create endpoint"})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Variables"}),(0,jsx_runtime.jsx)(src.g3,{columns:variablesColumns,dataSource:variablesForInsight,emptyState:"No variables used in the query."})]}),(0,jsx_runtime.jsx)(CodeExamples,{endpointName:endpointName,variables:variablesForInsight,projectId:currentProject?.id,tabId:tabId})]})}var LemonProgress=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonProgress/index.tsx"),LemonSegmentedButton=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSegmentedButton/index.ts"),LemonSelect=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonSelect/index.ts"),LemonTag=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonTag/index.ts");__webpack_require__("../../node_modules/.pnpm/@xyflow+react@12.6.0_@types+react@17.0.52_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@xyflow/react/dist/style.css");var dagre=__webpack_require__("../../node_modules/.pnpm/@dagrejs+dagre@1.1.5/node_modules/@dagrejs/dagre/index.js"),dagre_default=__webpack_require__.n(dagre),esm=__webpack_require__("../../node_modules/.pnpm/@xyflow+react@12.6.0_@types+react@17.0.52_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@xyflow/react/dist/esm/index.js"),dist_esm=__webpack_require__("../../node_modules/.pnpm/@xyflow+system@0.0.57/node_modules/@xyflow/system/dist/esm/index.js");let BRAND_YELLOW="#f9bd2b";function LineageNode(_ref){var type,lastRunAt;let{data,edges,tabId}=_ref,{editView}=(0,index_esm.useActions)(multitabEditorLogic({tabId})),{dataWarehouseSavedQueries}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),hasIncoming=edges.some(edge=>edge.target===data.id),hasOutgoing=edges.some(edge=>edge.source===data.id),isMatView="view"===data.type&&!!data.last_run_at,handleEditView=async()=>{if("view"===data.type){let view=dataWarehouseSavedQueries.find(v=>v.name===data.name);view?.query?.query&&editView(view.query.query,view)}};return(0,jsx_runtime.jsxs)("div",{className:"bg-bg-light border border-border rounded-md p-3 min-w-[300px] shadow-sm",style:{minHeight:isMatView?92:68},children:[hasIncoming&&(0,jsx_runtime.jsx)(esm.HH,{type:"target",position:dist_esm.Ly.Left,className:"w-2 h-2 bg-primary"}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[data.isCurrentView&&(0,jsx_runtime.jsx)(Tooltip.u,{placement:"top",title:"This is the currently viewed query",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconTarget,{className:"text-warning text-sm"})}),(0,jsx_runtime.jsx)(Tooltip.u,{title:data.name,placement:"top",children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center w-full justify-between",children:[(0,jsx_runtime.jsx)("div",{className:"font-medium text-sm truncate max-w-[240px] block",children:data.name}),"view"===data.type&&!data.isCurrentView&&(0,jsx_runtime.jsx)(src.Jp,{size:"xxsmall",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconPencil,{}),onClick:handleEditView})]})})]}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2",children:[(0,jsx_runtime.jsx)(src.oe,{type:"view"===data.type?"primary":"highlight",size:"small",children:(type=data.type,lastRunAt=data.last_run_at,"view"===type?lastRunAt?"Mat. view":"View":"Table")}),data.status&&(0,jsx_runtime.jsx)(src.oe,{type:"Failed"===data.status?"danger":"Running"===data.status?"warning":"success",size:"small",children:data.status})]}),data.last_run_at&&(0,jsx_runtime.jsxs)("div",{className:"text-xs text-muted mt-2",children:["Last run: ",(0,utils.bo)(data.last_run_at)]}),hasOutgoing&&(0,jsx_runtime.jsx)(esm.HH,{type:"source",position:dist_esm.Ly.Right,className:"w-2 h-2 bg-primary"})]})}let getNodeTypes=(edges,tabId)=>({lineageNode:props=>(0,jsx_runtime.jsx)(LineageNode,{...props,tabId:tabId,edges:edges})}),getLayoutedElements=(nodes,edges,currentViewName)=>{let dagreGraph=new(dagre_default()).graphlib.Graph;return dagreGraph.setDefaultEdgeLabel(()=>({})),dagreGraph.setGraph({rankdir:"LR",nodesep:80,ranksep:160}),nodes.forEach(node=>{let isMatView="view"===node.type&&!!node.last_run_at;dagreGraph.setNode(node.id,{width:300,height:isMatView?92:68})}),edges.forEach(edge=>{dagreGraph.setEdge(edge.source,edge.target)}),dagre_default().layout(dagreGraph),{nodes:nodes.map(node=>{let nodeWithPosition=dagreGraph.node(node.id),isMatView="view"===node.type&&!!node.last_run_at;return{id:node.id,type:"lineageNode",position:{x:nodeWithPosition.x-nodeWithPosition.width/2,y:nodeWithPosition.y-nodeWithPosition.height/2},data:{...node,isCurrentView:node.name===currentViewName},width:300,height:isMatView?92:68}}),edges:edges.map((edge,index)=>({id:`edge-${index}`,source:edge.source,target:edge.target,type:"default",animated:!1,markerEnd:{type:dist_esm.QZ.ArrowClosed,width:20,height:20,color:BRAND_YELLOW}}))}};function UpstreamGraphContent(_ref2){let{tabId}=_ref2,{upstream,editingView}=(0,index_esm.useValues)(multitabEditorLogic({tabId})),{fitView}=(0,esm._K)(),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),[hoveredNodeId,setHoveredNodeId]=(0,react.useState)(null),[hoveredEdgeId,setHoveredEdgeId]=(0,react.useState)(null),{nodes,edges}=(0,react.useMemo)(()=>upstream&&0!==upstream.nodes.length?getLayoutedElements(upstream.nodes,upstream.edges,editingView?.name):{nodes:[],edges:[]},[upstream,editingView?.name]),nodeTypes=(0,react.useMemo)(()=>getNodeTypes(edges,tabId),[edges,tabId]),coloredEdges=edges.map(edge=>{let isHighlighted=edge.id===hoveredEdgeId||edge.source===hoveredNodeId||edge.target===hoveredNodeId;return{...edge,style:isHighlighted?{stroke:BRAND_YELLOW}:void 0,markerEnd:{type:dist_esm.QZ.ArrowClosed,width:20,height:20,...isHighlighted?{color:BRAND_YELLOW}:{}}}});return((0,react.useEffect)(()=>{let timeoutId=null;return nodes.length>0&&(timeoutId=setTimeout(()=>fitView({padding:.1}),100)),()=>{timeoutId&&clearTimeout(timeoutId)}},[nodes,fitView]),upstream&&0!==upstream.nodes.length)?(0,jsx_runtime.jsx)("div",{className:"w-full h-full",children:(0,jsx_runtime.jsxs)(esm.x$,{colorMode:isDarkModeOn?"dark":"light",nodes:nodes,edges:coloredEdges,nodeTypes:nodeTypes,fitView:!0,fitViewOptions:{padding:.1},minZoom:.1,maxZoom:2,onNodeMouseEnter:(_e,node)=>setHoveredNodeId(node.id),onNodeMouseLeave:()=>setHoveredNodeId(null),onEdgeMouseEnter:(_e,edge)=>setHoveredEdgeId(edge.id),onEdgeMouseLeave:()=>setHoveredEdgeId(null),children:[(0,jsx_runtime.jsx)(esm.Aq,{variant:esm.T7.Dots,gap:20,size:1}),(0,jsx_runtime.jsx)(esm.ZX,{showInteractive:!1,position:"bottom-right"}),(0,jsx_runtime.jsx)(esm.a9,{zoomable:!0,pannable:!0,position:"bottom-left",nodeStrokeWidth:2,className:"hidden lg:block"})]})}):(0,jsx_runtime.jsxs)("div",{"data-attr":"upstream-graph-empty-state",className:"flex flex-col flex-1 rounded p-4 w-full items-center justify-center",children:[(0,jsx_runtime.jsx)(posthog_icons_es.IconArchive,{className:"text-5xl mb-2 text-tertiary"}),(0,jsx_runtime.jsx)("h2",{className:"text-xl leading-tight",children:"No tables or views found"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-center text-balance text-tertiary",children:"This query doesn't depend on any other tables or views"})]})}function UpstreamGraph(_ref3){let{tabId}=_ref3;return(0,jsx_runtime.jsx)("div",{className:"h-[500px] border border-border rounded-md overflow-hidden",children:(0,jsx_runtime.jsx)(esm.tV,{children:(0,jsx_runtime.jsx)(UpstreamGraphContent,{tabId:tabId})})})}var databaseTableListLogic=__webpack_require__("../../frontend/src/scenes/data-management/database/databaseTableListLogic.ts");let infoTabLogic=(0,index_esm.kea)([(0,index_esm.path)(["data-warehouse","editor","sidebar","infoTabLogic"]),(0,index_esm.props)({}),(0,index_esm.key)(props=>props.tabId),(0,index_esm.connect)(props=>({values:[multitabEditorLogic({tabId:props.tabId}),["metadata"],databaseTableListLogic.A,["posthogTablesMap","dataWarehouseTablesMap"],dataWarehouseViewsLogic.$,["dataWarehouseSavedQueryMap"]]})),(0,index_esm.selectors)({sourceTableItems:[s=>[s.metadata,s.dataWarehouseSavedQueryMap],(metadata,dataWarehouseSavedQueryMap)=>metadata&&metadata.table_names?.map(table_name=>{let view=dataWarehouseSavedQueryMap[table_name];return view?{name:table_name,type:"table",view_id:view.id,status:view.status,last_run_at:view.last_run_at||"never"}:{name:table_name,type:"source",status:void 0,last_run_at:void 0}})||[]]})]);function getMaterializationStatusMessage(rowsMaterialized,progressPercentage,rowsExpected){let percentComplete=Math.round(Math.min(100,rowsMaterialized/rowsExpected*100));switch(!0){case 0===rowsMaterialized:return`Spinning up spikes — starting materialization job... ${percentComplete}% complete.`;case progressPercentage<10:return`Digging into SQL... executing your query now... ${percentComplete}% complete.`;case progressPercentage<25:return`First ${(0,utils.Lc)(rowsMaterialized)} rows tucked away... ${percentComplete}% complete.`;case progressPercentage<50:return`${(0,utils.Lc)(rowsMaterialized)} rows shipped to storage... ${percentComplete}% complete.`;case progressPercentage<90:return`Still going — ${(0,utils.Lc)(rowsMaterialized)} rows written... ${percentComplete}% complete.`;case 100===progressPercentage:return`Wrapping up — ${(0,utils.Lc)(rowsMaterialized)} rows processed... ${percentComplete}% complete.`;default:return`Almost there — ${(0,utils.Lc)(rowsMaterialized)} rows processed... ${percentComplete}% complete.`}}let OPTIONS=[{value:"never",label:" No resync"},{value:"5min",label:" Resync every 5 mins"},{value:"30min",label:" Resync every 30 mins"},{value:"1hour",label:" Resync every 1 hour"},{value:"6hour",label:" Resync every 6 hours"},{value:"12hour",label:" Resync every 12 hours"},{value:"24hour",label:" Resync Daily"},{value:"7day",label:" Resync Weekly"},{value:"30day",label:" Resync Monthly"}];function getMaterializationDisabledReasons(currentJobStatus,startingMaterialization){return{sync:"Running"===currentJobStatus?"Materialization is already running":!!startingMaterialization&&"Materialization is starting",cancel:"Running"!==currentJobStatus&&"Materialization is not running",revert:"Running"===currentJobStatus&&"Cannot revert while materialization is running"}}function QueryInfo(_ref){let{tabId}=_ref,{sourceTableItems}=(0,index_esm.useValues)(infoTabLogic({tabId})),{editingView,upstream,upstreamViewMode}=(0,index_esm.useValues)(multitabEditorLogic),{runDataWarehouseSavedQuery,saveAsView,setUpstreamViewMode}=(0,index_esm.useActions)(multitabEditorLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),isLineageDependencyViewEnabled=featureFlags[constants.y8.LINEAGE_DEPENDENCY_VIEW],{dataWarehouseSavedQueryMapById,updatingDataWarehouseSavedQuery,initialDataWarehouseSavedQueryLoading,dataModelingJobs,hasMoreJobsToLoad,startingMaterialization}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{updateDataWarehouseSavedQuery,loadOlderDataModelingJobs,cancelDataWarehouseSavedQuery,revertMaterialization,setStartingMaterialization}=(0,index_esm.useActions)(dataWarehouseViewsLogic.$),savedQuery=editingView?dataWarehouseSavedQueryMapById[editingView.id]:null,currentJobStatus=dataModelingJobs?.results?.[0]?.status||null,{sync,cancel,revert}=getMaterializationDisabledReasons(currentJobStatus,startingMaterialization);return initialDataWarehouseSavedQueryLoading?(0,jsx_runtime.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,jsx_runtime.jsx)(src.$j,{className:"text-lg"})}):(0,jsx_runtime.jsx)("div",{className:"overflow-auto","data-attr":"sql-editor-sidebar-query-info-pane",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col flex-1 gap-4",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:"Materialization"}),(0,jsx_runtime.jsx)(LemonTag.o,{type:"warning",children:"BETA"}),savedQuery?.latest_error&&"Failed"===savedQuery.status&&(0,jsx_runtime.jsx)(Tooltip.u,{title:savedQuery.latest_error,children:(0,jsx_runtime.jsx)(LemonTag.o,{type:"danger",children:"Error"})})]}),(0,jsx_runtime.jsx)("div",{children:savedQuery?.is_materialized?(0,jsx_runtime.jsxs)("div",{children:[savedQuery?.last_run_at?`Last run at ${(0,utils.bo)(savedQuery?.last_run_at)}`:(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("span",{children:"Materialization scheduled"})}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,jsx_runtime.jsx)(LemonButton.J,{className:"whitespace-nowrap",loading:startingMaterialization||"Running"===currentJobStatus,disabledReason:sync,onClick:()=>{editingView&&(setStartingMaterialization(!0),runDataWarehouseSavedQuery(editingView.id))},type:"secondary",sideAction:{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{fontSize:16}),tooltip:"Cancel materialization",onClick:()=>editingView&&cancelDataWarehouseSavedQuery(editingView.id),disabledReason:cancel},children:startingMaterialization?"Starting...":"Running"===currentJobStatus?"Running...":"Sync now"}),(0,jsx_runtime.jsx)(LemonSelect.Yv,{className:"h-9",disabledReason:sync,value:editingView&&dataWarehouseSavedQueryMapById[editingView.id]?.sync_frequency||"never",onChange:newValue=>{editingView&&newValue&&updateDataWarehouseSavedQuery({id:editingView.id,sync_frequency:newValue,types:[[]],lifecycle:"update"})},loading:updatingDataWarehouseSavedQuery,options:OPTIONS}),editingView&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"secondary",size:"small",tooltip:"Revert materialized view to view",disabledReason:revert,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconRevert,{}),onClick:()=>{src.dn.open({title:"Revert materialization",maxWidth:"30rem",description:"Are you sure you want to revert this materialized view to a regular view? This will stop all future materializations and remove the materialized table. You will always be able to go back to a materialized view at any time.",primaryButton:{status:"danger",children:"Revert materialization",onClick:()=>revertMaterialization(editingView.id)},secondaryButton:{children:"Cancel"}})}})]})]}):(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("p",{className:"text-xs",children:["Materialized views are a way to pre-compute data in your data warehouse. This allows you to run queries faster and more efficiently. Learn more about materialization"," ",(0,jsx_runtime.jsx)(src.rU,{"data-attr":"materializing-help",to:"https://posthog.com/docs/data-warehouse/views#materializing-and-scheduling-a-view",target:"_blank",children:"here"}),"."]}),(0,jsx_runtime.jsx)(LemonButton.J,{size:"small",onClick:()=>{editingView?updateDataWarehouseSavedQuery({id:editingView.id,sync_frequency:"24hour",types:[[]],lifecycle:dataModelingJobs&&dataModelingJobs.results.length>0?"update":"create"}):saveAsView({materializeAfterSave:!0})},type:"primary",loading:updatingDataWarehouseSavedQuery,children:editingView?"Materialize":"Save and materialize"})]})})]}),savedQuery&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Materialization Runs"}),(0,jsx_runtime.jsx)("p",{className:"text-xs",children:"The last runs for this materialized view. These can be scheduled or run on demand."})]}),(0,jsx_runtime.jsx)(src.g3,{size:"small",loading:initialDataWarehouseSavedQueryLoading,dataSource:dataModelingJobs?.results||[],columns:[{title:"Status",dataIndex:"status",render:(_,job)=>{let{status,error,rows_materialized,rows_expected}=job,type={Completed:"success",Failed:"danger",Running:"warning"}[status]||"warning",progressPercentage=rows_expected&&rows_expected>0?Math.min(100,rows_materialized/rows_expected*100):0;return"Running"===status&&progressPercentage>0&&null!==rows_expected?(0,jsx_runtime.jsx)(Tooltip.u,{placement:"right",title:getMaterializationStatusMessage(rows_materialized,progressPercentage,rows_expected),children:(0,jsx_runtime.jsx)("div",{className:"w-[68px]",children:(0,jsx_runtime.jsx)(LemonProgress.b,{percent:progressPercentage})})}):error&&"Completed"!==status?(0,jsx_runtime.jsx)(Tooltip.u,{title:error,children:(0,jsx_runtime.jsx)(LemonTag.o,{type:type,children:status})}):(0,jsx_runtime.jsx)(LemonTag.o,{type:type,children:status})}},{title:"Rows",dataIndex:"rows_materialized",render:(_,_ref2)=>{let{rows_materialized,status}=_ref2;return("Running"===status||"Cancelled"===status)&&0===rows_materialized?"~":(0,utils.Lc)(rows_materialized)}},{title:"Updated",dataIndex:"last_run_at",render:(_,_ref3)=>{let{last_run_at}=_ref3;return(0,utils.bo)(last_run_at)}},{title:"Duration",render:(_,job)=>{if("Running"===job.status)return"In progress";let start=new Date(job.created_at).getTime(),end=new Date(job.last_run_at).getTime();return start>end?"N/A":(0,utils.C7)((end-start)/1e3)}}],nouns:["run","runs"],emptyState:"No runs available",footer:hasMoreJobsToLoad&&(0,jsx_runtime.jsx)("div",{className:"flex items-center m-2",children:(0,jsx_runtime.jsx)(LemonButton.J,{center:!0,fullWidth:!0,onClick:()=>loadOlderDataModelingJobs(),loading:initialDataWarehouseSavedQueryLoading,children:"Load older runs"})})})]}),!isLineageDependencyViewEnabled&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{children:"Dependencies"}),(0,jsx_runtime.jsx)("p",{className:"text-xs",children:"Dependencies are tables that this query uses."})]}),(0,jsx_runtime.jsx)(src.g3,{size:"small",columns:[{key:"Name",title:"Name",render:(_,_ref4)=>{let{name:name1}=_ref4;return name1}},{key:"Type",title:"Type",render:(_,_ref5)=>{let{type}=_ref5;return type}},{key:"Status",title:"Status",render:(_,_ref6)=>{let{type,status,last_run_at}=_ref6;return"source"===type?(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a source table, so it doesn't have a status",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})}):"never"!==last_run_at||status?status:(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a view, so it's always available with the latest data",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"Available"})})}},{key:"Last run at",title:"Last run at",render:(_,_ref7)=>{let{type,last_run_at,status}=_ref7;return"source"===type?(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a source table, so it is never run",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})}):"never"!==last_run_at||status?(0,utils.bo)(last_run_at):(0,jsx_runtime.jsx)(Tooltip.u,{title:"This is a view, so it is never run",children:(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"N/A"})})}}],dataSource:sourceTableItems})]}),upstream&&editingView&&upstream.nodes.length>0&&isLineageDependencyViewEnabled&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)("div",{className:"flex items-center justify-between",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h3",{className:"mb-1",children:"Tables we use"}),(0,jsx_runtime.jsx)("p",{className:"text-xs mb-0",children:"Tables and views that this query relies on."})]}),(0,jsx_runtime.jsx)(LemonSegmentedButton.P,{value:upstreamViewMode,onChange:mode=>setUpstreamViewMode(mode),options:[{value:"graph",label:"Graph"},{value:"table",label:"Table"}],size:"small"})]})}),"table"===upstreamViewMode?(0,jsx_runtime.jsx)(src.g3,{size:"small",columns:[{key:"name",title:"Name",render:(_,_ref8)=>{let{name:name1}=_ref8;return(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-1",children:[name1===editingView?.name&&(0,jsx_runtime.jsx)(Tooltip.u,{placement:"right",title:"This is the currently viewed query",children:(0,jsx_runtime.jsx)(posthog_icons_es.IconTarget,{className:"text-warning"})}),name1]})}},{key:"type",title:"Type",render:(_,_ref9)=>{let{type,last_run_at}=_ref9;return"view"===type?last_run_at?"Mat. View":"View":"Table"}},{key:"upstream",title:"Direct Upstream",render:(_,node)=>{let upstreamNodes=upstream.edges.filter(edge=>edge.target===node.id).map(edge=>upstream.nodes.find(n=>n.id===edge.source)).filter(n=>void 0!==n);return 0===upstreamNodes.length?(0,jsx_runtime.jsx)("span",{className:"text-secondary",children:"None"}):(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap gap-1",children:upstreamNodes.map(upstreamNode=>(0,jsx_runtime.jsx)(LemonTag.o,{type:"primary",children:upstreamNode.name},upstreamNode.id))})}},{key:"last_run_at",title:"Last Run At",render:(_,_ref10)=>{let{last_run_at,sync_frequency}=_ref10;if(!last_run_at)return"On demand";let numericSyncFrequency=Number(sync_frequency),frequencyMap={300:"5 mins",1800:"30 mins",3600:"1 hour",21600:"6 hours",43200:"12 hours",86400:"24 hours",604800:"1 week"};return`${(0,utils.bo)(last_run_at)} ${frequencyMap[numericSyncFrequency]?`every ${frequencyMap[numericSyncFrequency]}`:""}`}}],dataSource:upstream.nodes}):(0,jsx_runtime.jsx)(UpstreamGraph,{tabId:tabId})]})]})})}var AddVariableButton=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/AddVariableButton.tsx"),NewVariableModal=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/NewVariableModal.tsx"),Variables=__webpack_require__("../../frontend/src/queries/nodes/DataVisualization/Components/Variables/Variables.tsx");function QueryVariables(){let{variablesForInsight}=(0,index_esm.useValues)(variablesLogic.Q),{updateVariableValue,removeVariable}=(0,index_esm.useActions)(variablesLogic.Q),{showEditingUI}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{variableOverridesAreSet}=(0,index_esm.useValues)(dataNodeLogic.M),{openExistingVariableModal}=(0,index_esm.useActions)(variableModalLogic.b);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1.5","data-attr":"sql-editor-sidebar-query-variables-pane",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-start",children:[(0,jsx_runtime.jsx)("h3",{className:"mb-0",children:"Query variables"}),(0,jsx_runtime.jsxs)("span",{className:"text-xs",children:["Query variables let you dynamically set values in your SQL query."," ",(0,jsx_runtime.jsx)(src.rU,{to:"https://posthog.com/docs/sql/variables",target:"_blank",children:"Learn more"})]})]}),(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("flex gap-4 flex-col items-start",0===variablesForInsight.length&&"h-full items-center justify-center"),children:variablesForInsight.map(n=>(0,jsx_runtime.jsx)(Variables.LO,{variable:n,showEditingUI:showEditingUI,onChange:updateVariableValue,onRemove:removeVariable,variableOverridesAreSet:variableOverridesAreSet,variableSettingsOnClick:()=>openExistingVariableModal(n)},n.id))}),(0,jsx_runtime.jsx)("div",{className:"self-start",children:(0,jsx_runtime.jsx)(AddVariableButton.u,{buttonProps:{type:"primary",size:"small"},title:"Add variable"})}),(0,jsx_runtime.jsx)(NewVariableModal.f,{})]})}let CLICKHOUSE_TYPES=["UUID","String","Nothing","DateTime64","DateTime32","DateTime","Date","Date32","UInt8","UInt16","UInt32","UInt64","Float8","Float16","Float32","Float64","Int8","Int16","Int32","Int64","Tuple","Array","Map","Bool","Decimal","FixedString"],copyMap={[types.P5.CSV]:{label:"CSV",copyFn:clipboardUtils.T0},[types.P5.JSON]:{label:"JSON",copyFn:clipboardUtils.EU},[types.P5.XLSX]:{label:"Excel",copyFn:clipboardUtils.BG}},createDataTableQuery=()=>({kind:schema_general.OH.DataTableNode,source:{kind:schema_general.OH.HogQLQuery,query:""}}),cleanClickhouseType=type=>{if(type)return(type=type.replace(/\n\s+/,"")).startsWith("Nullable(")&&(type=(type=type.replace("Nullable(","")).substring(0,type.length-1)),type.startsWith("Array(")&&(type=type.split(/(\W)/).filter(n=>!("Nullable"!==n&&(1!==n.length||/^[a-z0-9]+$/i.test(n)))||CLICKHOUSE_TYPES.includes(n)).join("")),type.replace(/\(.+\)+/,"")};function RowDetailsModal(_ref){let{isOpen,onClose,row,columns}=_ref,[showRawJson,setShowRawJson]=(0,react.useState)({}),[wordWrap,setWordWrap]=(0,react.useState)({});if(!row)return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{});let isJsonString=str=>{try{let parsed=JSON.parse(str);return"object"==typeof parsed&&null!==parsed}catch{return!1}},tableData=columns.map(column=>{let value=row[column],isStringifiedJson="string"==typeof value&&isJsonString(value),isJson="object"==typeof value||isStringifiedJson,jsonValue=isStringifiedJson?JSON.parse(value):value;return{column,isJson,rawValue:null===value?"null":"object"==typeof value||isStringifiedJson?JSON.stringify(value,null,2):String(value),value:null===value?(0,jsx_runtime.jsx)("span",{className:"text-muted",children:"null"}):isJson?(0,jsx_runtime.jsx)("div",{className:"flex gap-2 w-full",children:(0,jsx_runtime.jsx)("div",{className:"w-full overflow-hidden",children:showRawJson[column]?(0,jsx_runtime.jsx)("pre",{className:(0,clsx_m.default)("m-0 font-mono",wordWrap[column]?"whitespace-pre-wrap break-all":"overflow-x-auto hide-scrollbar"),children:String(value)}):(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto max-w-full",children:(0,jsx_runtime.jsx)(JSONViewer.C,{src:jsonValue,name:null,collapsed:1})})})}):(0,jsx_runtime.jsx)("div",{className:"overflow-x-auto",children:(0,jsx_runtime.jsx)("span",{className:"whitespace-pre-wrap break-all font-mono",children:String(value)})})}});return(0,jsx_runtime.jsx)(src.fQ,{title:"Row Details",isOpen:isOpen,onClose:onClose,width:800,children:(0,jsx_runtime.jsx)("div",{className:"RowDetailsModal max-h-[70vh] overflow-y-auto px-2 overflow-x-hidden",children:(0,jsx_runtime.jsx)(src.g3,{dataSource:tableData,className:"w-full table-fixed",columns:[{title:"Column",dataIndex:"column",className:"font-semibold",width:"35%",render:(_,record)=>(0,jsx_runtime.jsx)("span",{title:record.column,children:record.column})},{title:"Value",dataIndex:"value",className:"px-4 overflow-hidden",width:"65%",render:(_,record)=>(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1 overflow-x-auto pr-2",children:record.value}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-1 flex-shrink-0 ml-auto",children:[record.isJson&&record.rawValue&&"null"!=record.rawValue&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode,{}),onClick:()=>setShowRawJson(prev=>({...prev,[record.column]:!prev[record.column]})),tooltip:showRawJson[record.column]?"Show formatted":"Show raw"}),showRawJson[record.column]&&(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:wordWrap[record.column]?(0,jsx_runtime.jsx)(posthog_icons_es.IconMinus,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPlus,{}),onClick:()=>setWordWrap(prev=>({...prev,[record.column]:!prev[record.column]})),tooltip:wordWrap[record.column]?"Collapse":"Expand"}),(0,jsx_runtime.jsx)(src.Jp,{size:"small",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCopy,{}),onClick:()=>void(0,copyToClipboard.v)(record.rawValue,"value"),tooltip:"Copy value"})]})]})}]})})})}function OutputPane(_ref2){let{tabId}=_ref2,{activeTab}=(0,index_esm.useValues)(outputPaneLogic.o),{setActiveTab}=(0,index_esm.useActions)(outputPaneLogic.o),{editingView}=(0,index_esm.useValues)(multitabEditorLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),{sourceQuery,exportContext,editingInsight,updateInsightButtonEnabled,showLegacyFilters,queryInput}=(0,index_esm.useValues)(multitabEditorLogic),{saveAsInsight,updateInsight,setSourceQuery,runQuery,shareTab}=(0,index_esm.useActions)(multitabEditorLogic),{isDarkModeOn}=(0,index_esm.useValues)(themeLogic.b),{response:dataNodeResponse,responseLoading,responseError,queryId,pollResponse}=(0,index_esm.useValues)(dataNodeLogic.M),{queryCancelled}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{toggleChartSettingsPanel}=(0,index_esm.useActions)(dataVisualizationLogic.H8),[progressCache,setProgressCache]=(0,react.useState)({}),vizKey=(0,react.useMemo)(()=>"SQLEditorScene",[]),[selectedRow,setSelectedRow]=(0,react.useState)(null),setProgress=(0,react.useCallback)((loadId,progress)=>{setProgressCache(prev=>({...prev,[loadId]:progress}))},[]),columns=(0,react.useMemo)(()=>{var _response$columns$map;let types=dataNodeResponse?.types;return[{key:"__details",name:"",minWidth:30,width:30,renderCell:_ref3=>{let{row}=_ref3;return(0,jsx_runtime.jsx)("div",{className:"hover-actions-cell flex justify-center items-center",children:(0,jsx_runtime.jsx)(src.Jp,{size:"xsmall",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconExpand45,{}),onClick:e=>{e.stopPropagation(),setSelectedRow(row)}})})}},...null!==(_response$columns$map=dataNodeResponse?.columns?.map((column,index)=>{let type=types?.[index]?.[1],maxContentLength=Math.max(column.length,...(dataNodeResponse.results||dataNodeResponse.result).map(row=>{let content=row[index];return"string"==typeof content?content.length:null===content?0:content.toString().length})),baseColumn={key:column,name:jsx_runtime.jsxs(jsx_runtime.Fragment,{children:[column," ",type&&jsx_runtime.jsx("span",{className:"text-[10px] font-medium italic",children:cleanClickhouseType(type)})]}),resizable:!0,sortable:!0,width:maxContentLength>100?600:void 0,headerCellClass:"cursor-pointer",renderHeaderCell:_ref4=>{let{column:col,sortDirection}=_ref4;return jsx_runtime.jsxs("div",{className:"flex items-center justify-between py-2",children:[jsx_runtime.jsx("span",{children:col.name}),jsx_runtime.jsxs("div",{className:"flex flex-col ml-1",children:[jsx_runtime.jsx("span",{className:`text-[7px] leading-none ${"ASC"===sortDirection?"text-black-600":"text-gray-400"}`,children:"▲"}),jsx_runtime.jsx("span",{className:`text-[7px] leading-none ${"DESC"===sortDirection?"text-black-600":"text-gray-400"}`,children:"▼"})]})]})}};return type&&type.indexOf("Bool")!==-1?{...baseColumn,renderCell:props=>null===props.row[column]?null:props.row[column].toString()}:{...baseColumn,renderCell:props=>{let value=props.row[column];if("string"==typeof value&&value.startsWith('["__hx_tag",')&&value.endsWith("]"))try{let parsedHogQLX=JSON.parse(value);return render.E(parsedHogQLX)}catch(e){return console.error("Error parsing HogQLX value:",e),jsx_runtime.jsx("span",{className:"text-red",children:"Error parsing value"})}return value}}}))&&void 0!==_response$columns$map?_response$columns$map:[]]},[dataNodeResponse,setSelectedRow]),rows=(0,react.useMemo)(()=>dataNodeResponse?.results?dataNodeResponse.results.map((row,index)=>{let rowObject={__index:index};return dataNodeResponse.columns?.forEach((column,i)=>{"object"==typeof row[i]&&null!==row[i]?rowObject[column]=JSON.stringify(row[i]):rowObject[column]=row[i]}),rowObject}):[],[dataNodeResponse]),hasColumns=columns.length>1;return(0,jsx_runtime.jsxs)("div",{className:"OutputPane flex flex-col w-full flex-1 bg-white dark:bg-black",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-between align-center w-full min-h-[50px] overflow-y-auto",children:[(0,jsx_runtime.jsx)("div",{className:"flex min-h-[50px] gap-2 ml-4",children:[{key:outputPaneLogic.R.Results,label:"Results",icon:(0,jsx_runtime.jsx)(icons.p$,{})},{key:outputPaneLogic.R.Visualization,label:"Visualization",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGraph,{})},{key:outputPaneLogic.R.Variables,label:(0,jsx_runtime.jsx)(src.u,{title:editingView?"Variables are not allowed in views.":void 0,children:"Variables"}),disabled:editingView,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBrackets,{})},{key:outputPaneLogic.R.Materialization,label:"Materialization",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBolt,{})},{key:outputPaneLogic.R.Endpoint,label:"Endpoint",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode2,{}),flag:constants.y8.ENDPOINTS}].filter(tab=>!tab.flag||featureFlags[tab.flag]).map(tab=>(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("flex-1 flex-row flex items-center bold content-center px-2 pt-[3px] cursor-pointer border-b-[medium] whitespace-nowrap",{"font-semibold !border-brand-yellow":tab.key===activeTab,"border-transparent":tab.key!==activeTab,"opacity-50 cursor-not-allowed":tab.disabled}),onClick:()=>!tab.disabled&&setActiveTab(tab.key),children:[(0,jsx_runtime.jsx)("span",{className:"mr-1",children:tab.icon}),tab.label]},tab.key))}),(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 py-2 px-4 flex-shrink-0",children:[showLegacyFilters&&(0,jsx_runtime.jsx)(DateRange.C,{query:sourceQuery.source,setQuery:query=>{setSourceQuery({...sourceQuery,source:query}),runQuery(query.query)}},"date-range"),activeTab===outputPaneLogic.R.Visualization&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"flex justify-between flex-wrap",children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center"}),(0,jsx_runtime.jsx)("div",{className:"flex items-center",children:(0,jsx_runtime.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[(0,jsx_runtime.jsx)(TableDisplay.V,{disabledReason:hasColumns?void 0:"No results to visualize"}),(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasColumns?void 0:"No results to visualize",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGear,{}),onClick:()=>toggleChartSettingsPanel(),tooltip:"Visualization settings"}),editingInsight&&(0,jsx_runtime.jsx)(src.Jp,{disabledReason:!updateInsightButtonEnabled&&"No updates to save",type:"primary",onClick:()=>updateInsight(),id:"sql-editor-update-insight",sideAction:{dropdown:{placement:"bottom-end",overlay:(0,jsx_runtime.jsx)(LemonMenu.iy,{items:[{label:"Save as...",onClick:()=>saveAsInsight()}]})}},children:"Save insight"}),!editingInsight&&(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasColumns?void 0:"No results to save",type:"primary",onClick:()=>saveAsInsight(),id:"sql-editor-save-insight",children:"Save insight"})]})})]})}),activeTab===outputPaneLogic.R.Results&&(0,jsx_runtime.jsx)(src.Jp,{disabledReason:hasColumns||editingInsight?void 0:"No results to visualize",type:"secondary",onClick:()=>setActiveTab(outputPaneLogic.R.Visualization),id:`sql-editor-${editingInsight?"view":"create"}-insight`,icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconGraph,{}),children:editingInsight?"View insight":"Create insight"}),activeTab===outputPaneLogic.R.Results&&(0,jsx_runtime.jsx)(src.d6,{items:Object.values(copyMap).map(_ref5=>{let{label,copyFn}=_ref5;return{label,onClick:()=>{if(dataNodeResponse?.columns&&rows.length>0){let dataTableRows=transformDataTableToDataTableRows(rows,dataNodeResponse.columns),query=createDataTableQuery();copyFn(dataTableRows,dataNodeResponse.columns,query)}}}}),placement:"bottom-end",children:(0,jsx_runtime.jsx)(src.Jp,{id:"sql-editor-copy-dropdown",disabledReason:dataNodeResponse?.columns&&rows.length?void 0:"No results to copy",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCopy,{})})}),activeTab===outputPaneLogic.R.Results&&exportContext&&(0,jsx_runtime.jsx)(src.u,{title:"Export the table results",className:hasColumns?"":"hidden",children:(0,jsx_runtime.jsx)(ExportButton.j,{id:"sql-editor-export",disabledReason:hasColumns?void 0:"No results to export",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),sideIcon:null,buttonCopy:"",items:[{export_format:types.P5.CSV,export_context:exportContext},{export_format:types.P5.XLSX,export_context:exportContext}]})}),activeTab===outputPaneLogic.R.Results&&(0,jsx_runtime.jsx)(src.u,{title:"Share your current query",children:(0,jsx_runtime.jsx)(src.Jp,{id:"sql-editor-share",disabledReason:!queryInput&&"No query to share",type:"secondary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconShare,{}),onClick:()=>shareTab()})})]})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-1 relative bg-dark",children:(0,jsx_runtime.jsx)(Content,{activeTab:activeTab,responseError:responseError,responseLoading:responseLoading,response:dataNodeResponse,sourceQuery:sourceQuery,queryCancelled:queryCancelled,columns:columns,rows:rows,isDarkModeOn:isDarkModeOn,vizKey:vizKey,setSourceQuery:setSourceQuery,exportContext:exportContext,saveAsInsight:saveAsInsight,queryId:queryId,pollResponse:pollResponse,tabId:tabId,setProgress:setProgress,progress:queryId?progressCache[queryId]:void 0})}),(0,jsx_runtime.jsxs)("div",{className:"flex justify-between px-2 border-t",children:[(0,jsx_runtime.jsx)("div",{children:dataNodeResponse&&!responseError?(0,jsx_runtime.jsx)(LoadNext.D,{localResponse:dataNodeResponse}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})}),(0,jsx_runtime.jsxs)("div",{className:"flex items-center gap-4",children:[(0,jsx_runtime.jsx)(ElapsedTime.W,{}),featureFlags[constants.y8.QUERY_EXECUTION_DETAILS]?(0,jsx_runtime.jsx)(QueryExecutionDetails,{}):null]})]}),(0,jsx_runtime.jsx)(RowDetailsModal,{isOpen:!!selectedRow,onClose:()=>setSelectedRow(null),row:selectedRow,columns:dataNodeResponse?.columns||[]})]})}function InternalDataTableVisualization(props){let{query,visualizationType,showEditingUI,response,responseLoading,isChartSettingsPanelOpen,xData,yData,chartSettings,dashboardId,dataVisualizationProps,presetChartHeight}=(0,index_esm.useValues)(dataVisualizationLogic.H8),{seriesBreakdownData}=(0,index_esm.useValues)((0,seriesBreakdownLogic.h)({key:dataVisualizationProps.key})),{goalLines}=(0,index_esm.useValues)(displayLogic.Y),component=null;if(showEditingUI||response&&!responseLoading){if(visualizationType===types.Qb.ActionsTable)component=(0,jsx_runtime.jsx)(Table.i,{uniqueKey:props.uniqueKey,query:query,context:props.context,cachedResults:props.cachedResults,embedded:!0});else if(visualizationType===types.Qb.ActionsLineGraph||visualizationType===types.Qb.ActionsBar||visualizationType===types.Qb.ActionsAreaGraph||visualizationType===types.Qb.ActionsStackedBar){let _xData=seriesBreakdownData.xData.data.length?seriesBreakdownData.xData:xData,_yData=seriesBreakdownData.xData.data.length?seriesBreakdownData.seriesData:yData;component=(0,jsx_runtime.jsx)(LineGraph.x,{className:"p-2",xData:_xData,yData:_yData,visualizationType:visualizationType,chartSettings:chartSettings,dashboardId:dashboardId,goalLines:goalLines,presetChartHeight:presetChartHeight})}else visualizationType===types.Qb.BoldNumber&&(component=(0,jsx_runtime.jsx)(BoldNumber.w,{}))}else component=(0,jsx_runtime.jsx)("div",{className:"flex flex-col flex-1 justify-center items-center bg-surface-primary h-full",children:(0,jsx_runtime.jsx)(LoadingBar.F,{})});return(0,jsx_runtime.jsx)("div",{className:"DataVisualization h-full hide-scrollbar flex flex-1 gap-2",children:(0,jsx_runtime.jsx)("div",{className:"relative w-full flex flex-col gap-4 flex-1",children:(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 flex-row overflow-auto hide-scrollbar",children:[isChartSettingsPanelOpen&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(SideBar,{}),(0,jsx_runtime.jsx)(src.p2,{vertical:!0,className:"h-full"})]}),(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("w-full h-full flex-1 overflow-auto"),children:component})]})})})}let ErrorState=_ref6=>{let{responseError,sourceQuery,queryCancelled,response}=_ref6,error=queryCancelled?"The query was cancelled":response&&"error"in response&&response.error?response.error:responseError;return(0,jsx_runtime.jsx)("div",{className:(0,clsx_m.default)("flex-1 absolute top-0 left-0 right-0 bottom-0 overflow-auto"),children:(0,jsx_runtime.jsx)(EmptyStates.jC,{query:sourceQuery,excludeDetail:!0,title:error,excludeActions:queryCancelled,fixWithAIComponent:(0,jsx_runtime.jsx)(FixErrorButton,{contentOverride:"Fix error with AI",type:"primary",source:"query-error"})})})},Content=_ref7=>{let{activeTab,responseError,responseLoading,response,sourceQuery,queryCancelled,columns,rows,isDarkModeOn,vizKey,tabId,setSourceQuery,exportContext,saveAsInsight,queryId,pollResponse,setProgress,progress}=_ref7,[sortColumns,setSortColumns]=(0,react.useState)([]),{editingView}=(0,index_esm.useValues)(multitabEditorLogic),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),sortedRows=(0,react.useMemo)(()=>sortColumns.length?[...rows].sort((a,b)=>{for(let{columnKey,direction}of sortColumns){let aVal=a[columnKey],bVal=b[columnKey];if(aVal===bVal)continue;if(null==aVal)return 1;if(null==bVal)return -1;let result=aVal<bVal?-1:1;return"DESC"===direction?-result:result}return 0}):rows,[rows,sortColumns]);if(activeTab===outputPaneLogic.R.Materialization)return(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsx)("div",{className:"px-6 py-4 border-t",children:(0,jsx_runtime.jsx)(QueryInfo,{tabId:tabId})})});if(activeTab===outputPaneLogic.R.Variables)return editingView?(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsx)("div",{className:"px-6 py-4 border-t text-secondary",children:"Variables are not allowed in views."})}):(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsx)("div",{className:"px-6 py-4 border-t max-w-1/2",children:(0,jsx_runtime.jsx)(QueryVariables,{})})});if(featureFlags[constants.y8.ENDPOINTS]&&activeTab===outputPaneLogic.R.Endpoint)return(0,jsx_runtime.jsx)(TabScroller,{children:(0,jsx_runtime.jsx)("div",{className:"px-6 py-4 border-t",children:(0,jsx_runtime.jsx)(Endpoint,{tabId:tabId})})});if(responseLoading)return(0,jsx_runtime.jsx)("div",{className:"flex flex-1 p-2 w-full justify-center items-center border-t",children:(0,jsx_runtime.jsx)(EmptyStates.sX,{queryId:queryId,pollResponse:pollResponse,setProgress:setProgress,progress:progress})});if(responseError)return(0,jsx_runtime.jsx)(ErrorState,{responseError:responseError,sourceQuery:sourceQuery,queryCancelled:queryCancelled,response:response});if(!response){let msg=activeTab===outputPaneLogic.R.Results?"Query results will appear here.":"Query results will be visualized here.";return(0,jsx_runtime.jsx)("div",{className:"flex flex-1 justify-center items-center border-t","data-attr":"sql-editor-output-pane-empty-state",children:(0,jsx_runtime.jsxs)("span",{className:"text-secondary mt-3",children:[msg," Press ",(0,jsx_runtime.jsx)(KeyboardShortcut.e,{command:!0,enter:!0})," to run the query."]})})}return activeTab===outputPaneLogic.R.Results?(0,jsx_runtime.jsx)(TabScroller,{"data-attr":"sql-editor-output-pane-results",children:(0,jsx_runtime.jsx)(bundle.ZP,{className:isDarkModeOn?"rdg-dark h-full":"rdg-light h-full",columns:columns,rows:sortedRows,sortColumns:sortColumns,onSortColumnsChange:setSortColumns})}):activeTab===outputPaneLogic.R.Visualization?(0,jsx_runtime.jsx)("div",{className:"flex-1 absolute inset-0 hide-scrollbar border-t",children:(0,jsx_runtime.jsx)(InternalDataTableVisualization,{uniqueKey:vizKey,query:sourceQuery,setQuery:setSourceQuery,context:{},cachedResults:void 0,exportContext:exportContext,onSaveInsight:saveAsInsight,editMode:!0})}):null};var size_dist_module=__webpack_require__("../../node_modules/.pnpm/@react-hook+size@2.1.2_react@18.2.0/node_modules/@react-hook/size/dist/module/index.js"),ActivityLog=__webpack_require__("../../frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),MonacoDiffEditor=__webpack_require__("../../frontend/src/lib/components/MonacoDiffEditor.tsx"),TZLabel=__webpack_require__("../../frontend/src/lib/components/TZLabel/index.tsx"),PaginationControl=__webpack_require__("../../frontend/src/lib/lemon-ui/PaginationControl/index.ts"),ProfilePicture=__webpack_require__("../../frontend/src/lib/lemon-ui/ProfilePicture/index.ts"),activityLogLogic=__webpack_require__("../../frontend/src/lib/components/ActivityLog/activityLogLogic.tsx");let queryHistoryLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","queryHistoryLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(_ref=>{let{id}=_ref;return{values:[(0,activityLogLogic.DO)({scope:types.jc.DATA_WAREHOUSE_SAVED_QUERY,id:id}),["humanizedActivity","activityLoading","pagination"]]}})]);function QueryHistoryLogRow(_ref){var _logItem$email;let{logItem}=_ref,[isExpanded,setIsExpanded]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("flex flex-col px-1 py-0.5",isExpanded&&"border rounded"),children:[(0,jsx_runtime.jsxs)("div",{className:(0,clsx_m.default)("ActivityLogRow flex deprecated-space-x-2",logItem.unread&&"ActivityLogRow--unread"),children:[(0,jsx_runtime.jsx)(ProfilePicture.Y,{showName:!1,user:{first_name:logItem.isSystem?logItem.name:void 0,email:null!==(_logItem$email=logItem.email)&&void 0!==_logItem$email?_logItem$email:void 0},type:logItem.isSystem?"system":"person",size:"xl"}),(0,jsx_runtime.jsxs)("div",{className:"ActivityLogRow__details flex-grow",children:[(0,jsx_runtime.jsx)("div",{className:"ActivityLogRow__description",children:logItem.description}),logItem.extendedDescription&&(0,jsx_runtime.jsx)("div",{className:"ActivityLogRow__description__extended",children:logItem.extendedDescription}),(0,jsx_runtime.jsx)("div",{className:"text-secondary",children:(0,jsx_runtime.jsx)(TZLabel.w,{time:logItem.created_at})})]}),(0,jsx_runtime.jsx)("div",{className:"flex flex-row gap-2",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCode,{}),onClick:()=>setIsExpanded(!isExpanded),active:isExpanded})})]}),isExpanded&&(0,jsx_runtime.jsx)("div",{className:"px-1 py-0.5",children:(0,jsx_runtime.jsx)(QueryHistoryLogDiff,{logItem:logItem})})]})}function QueryHistoryLogDiff(_ref2){let{logItem}=_ref2,changes=logItem.unprocessed?.detail.changes;return(0,jsx_runtime.jsx)("div",{className:"flex flex-col deprecated-space-y-2 px-2 py-1",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col deprecated-space-y-2",children:changes?.length?changes.map((change,i)=>(0,jsx_runtime.jsx)(QueryDiffViewer,{before:change.before,after:change.after},i)):(0,jsx_runtime.jsx)("div",{className:"text-secondary",children:"This item has no changes to compare"})})})}function QueryDiffViewer(_ref3){var _before$query,_after$query;let{before,after}=_ref3,containerRef=(0,react.useRef)(null),[width]=(0,size_dist_module.Z)(containerRef);return(0,jsx_runtime.jsx)("div",{ref:containerRef,className:"flex flex-col space-y-2 w-full",children:(0,jsx_runtime.jsx)(MonacoDiffEditor.Z,{original:null!==(_before$query=before?.query)&&void 0!==_before$query?_before$query:"",modified:null!==(_after$query=after?.query)&&void 0!==_after$query?_after$query:"",language:"hogQL",width:width,options:{renderOverviewRuler:!1,scrollBeyondLastLine:!1,renderGutterMenu:!1,scrollbar:{alwaysConsumeMouseWheel:!1}}},"diff-viewer")})}function QueryHistoryLog(_ref4){let{id}=_ref4,logic=queryHistoryLogic({id:id}),{humanizedActivity,activityLoading,pagination}=(0,index_esm.useValues)(logic),paginationState=(0,PaginationControl.h)(humanizedActivity||[],pagination);return activityLoading||0!==humanizedActivity.length?(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-4",children:[activityLoading?(0,jsx_runtime.jsxs)("div",{className:"deprecated-space-y-2",children:[(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{}),(0,jsx_runtime.jsx)(ActivityLog.ay,{})]}):(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:humanizedActivity.map((logItem,index)=>(0,jsx_runtime.jsx)(QueryHistoryLogRow,{logItem:logItem},index))}),(0,jsx_runtime.jsx)(PaginationControl.R,{...paginationState,nouns:["activity","activities"]})]}):(0,jsx_runtime.jsx)("div",{className:"deprecated-space-y-2",children:(0,jsx_runtime.jsx)("div",{className:"text-secondary",children:"No history found"})})}function QueryHistoryModal(){let{isHistoryModalOpen}=(0,index_esm.useValues)(multitabEditorLogic),{closeHistoryModal}=(0,index_esm.useActions)(multitabEditorLogic),{editingView}=(0,index_esm.useValues)(multitabEditorLogic);return(0,jsx_runtime.jsx)(src.fQ,{title:"View history",isOpen:isHistoryModalOpen,onClose:closeHistoryModal,width:800,children:(0,jsx_runtime.jsx)("div",{className:"ActivityLog",children:(0,jsx_runtime.jsx)(QueryHistoryLog,{id:editingView?.id})})})}var AutoSizer=__webpack_require__("../../node_modules/.pnpm/react-virtualized@9.22.5_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/react-virtualized/dist/es/AutoSizer/index.js"),Resizer=__webpack_require__("../../frontend/src/lib/components/Resizer/Resizer.tsx"),MaxTool=__webpack_require__("../../frontend/src/scenes/max/MaxTool.tsx"),resizerLogic=__webpack_require__("../../frontend/src/lib/components/Resizer/resizerLogic.ts");let editorSizingLogic=(0,index_esm.kea)([(0,index_esm.path)(["scenes","data-warehouse","editor","editorSizingLogic"]),(0,index_esm.props)({}),(0,index_esm.connect)(props=>({values:[(0,resizerLogic.Z)(props.sourceNavigatorResizerProps),["desiredSize as sourceNavigatorDesiredSize"],(0,resizerLogic.Z)(props.sidebarResizerProps),["desiredSize as sidebarDesiredSize"],(0,resizerLogic.Z)(props.queryPaneResizerProps),["desiredSize as queryPaneDesiredSize"]],actions:[(0,resizerLogic.Z)(props.sidebarResizerProps),["setDesiredSize as sidebarSetDesiredSize"]]})),(0,index_esm.actions)({resetDefaultSidebarWidth:!0}),(0,index_esm.listeners)(_ref=>{let{actions}=_ref;return{resetDefaultSidebarWidth:()=>{actions.sidebarSetDesiredSize(300)}}}),(0,index_esm.selectors)({editorSceneRef:[p=>[p.editorSceneRef],editorSceneRef=>editorSceneRef],sourceNavigatorWidth:[s=>[s.sourceNavigatorDesiredSize],desiredSize=>Math.max(desiredSize||350,100)],queryPaneHeight:[s=>[s.queryPaneDesiredSize],queryPaneDesiredSize=>Math.max(queryPaneDesiredSize||300,100)],queryTabsWidth:[s=>[s.queryPaneDesiredSize],desiredSize=>desiredSize||350],sourceNavigatorResizerProps:[(_,p)=>[p.sourceNavigatorResizerProps],sourceNavigatorResizerProps=>sourceNavigatorResizerProps],queryPaneResizerProps:[(_,p)=>[p.queryPaneResizerProps],queryPaneResizerProps=>queryPaneResizerProps],sidebarWidth:[s=>[s.sidebarDesiredSize],desiredSize=>null!==desiredSize&&desiredSize<75?0:Math.min(Math.max(desiredSize||300,150),550)],sidebarResizerProps:[(_,p)=>[p.sidebarResizerProps],sidebarResizerProps=>sidebarResizerProps]})]);function QueryPane(props){let{queryPaneHeight,queryPaneResizerProps}=(0,index_esm.useValues)(editorSizingLogic),{setSuggestedQueryInput,onAcceptSuggestedQueryInput,onRejectSuggestedQueryInput,reportAIQueryPromptOpen}=(0,index_esm.useActions)(multitabEditorLogic),{acceptText,rejectText,diffShowRunButton}=(0,index_esm.useValues)(multitabEditorLogic);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsxs)("div",{className:"relative flex flex-row w-full bg-primary",style:{height:`${queryPaneHeight}px`},ref:queryPaneResizerProps.containerRef,children:[(0,jsx_runtime.jsxs)("div",{className:"relative flex flex-col w-full",children:[(0,jsx_runtime.jsx)("div",{className:"flex-1","data-attr":"hogql-query-editor",children:(0,jsx_runtime.jsx)(AutoSizer.q,{children:_ref=>{let{height,width}=_ref;return(0,jsx_runtime.jsx)(CodeEditor.p,{language:"hogQL",value:props.queryInput,sourceQuery:props.sourceQuery,height:height,width:width,originalValue:props.originalValue,...props.codeEditorProps,options:{minimap:{enabled:!1},wordWrap:"on",scrollBeyondLastLine:!!props.originalValue,automaticLayout:!0,fixedOverflowWidgets:!0,suggest:{showInlineDetails:!0},quickSuggestionsDelay:300}})}})}),(0,jsx_runtime.jsx)("div",{className:"absolute bottom-6 right-4",children:(0,jsx_runtime.jsx)(MaxTool.Z,{identifier:"generate_hogql_query",context:{current_query:props.queryInput},callback:toolOutput=>{setSuggestedQueryInput(toolOutput,"max_ai")},suggestions:[],onMaxOpen:()=>{reportAIQueryPromptOpen()},introOverride:{headline:"What data do you want to analyze?",description:"Let me help you quickly write SQL, and tweak it."},children:(0,jsx_runtime.jsx)("div",{className:"relative"})})}),props.originalValue&&(0,jsx_runtime.jsxs)("div",{className:"absolute flex gap-1 bg-bg-light rounded border py-1 px-1.5 z-10 left-1/2 -translate-x-1/2 bottom-4 whitespace-nowrap",style:{boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"},children:[!!diffShowRunButton&&(0,jsx_runtime.jsxs)(LemonButton.J,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{color:"var(--success)"}),onClick:()=>{onAcceptSuggestedQueryInput(!0)},tooltipPlacement:"top",size:"small",children:[acceptText," & run"]}),(0,jsx_runtime.jsx)(LemonButton.J,{type:"tertiary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconCheck,{color:"var(--success)"}),onClick:()=>{onAcceptSuggestedQueryInput()},tooltipPlacement:"top",size:"small",children:acceptText}),(0,jsx_runtime.jsx)(LemonButton.J,{status:"danger",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconX,{}),onClick:()=>{onRejectSuggestedQueryInput()},tooltipPlacement:"top",size:"small",children:rejectText})]})]}),(0,jsx_runtime.jsx)(Resizer.w,{...queryPaneResizerProps})]})})}function QueryWindow(_ref){var _ref2;let{onSetMonacoAndEditor,tabId}=_ref,codeEditorKey=`hogql-editor-${tabId}`,{activeTab,queryInput,editingView,editingInsight,sourceQuery,originalQueryInput,suggestedQueryInput,isDraft,currentDraft,changesToSave,inProgressViewEdits}=(0,index_esm.useValues)(multitabEditorLogic),{activePanelIdentifier}=(0,index_esm.useValues)(panelLayoutLogic.ne),{setActivePanelIdentifier}=(0,index_esm.useActions)(panelLayoutLogic.ne),{setQueryInput,runQuery,setError,setMetadata,setMetadataLoading,saveAsView,saveDraft,updateView}=(0,index_esm.useActions)(multitabEditorLogic),{openHistoryModal}=(0,index_esm.useActions)(multitabEditorLogic),{saveOrUpdateDraft}=(0,index_esm.useActions)(draftsLogic.s),{response}=(0,index_esm.useValues)(dataNodeLogic.M),{updatingDataWarehouseSavedQuery}=(0,index_esm.useValues)(dataWarehouseViewsLogic.$),{featureFlags}=(0,index_esm.useValues)(featureFlagLogic.featureFlagLogic),[editingViewDisabledReason,EditingViewButtonIcon]=(0,react.useMemo)(()=>updatingDataWarehouseSavedQuery?["Saving...",src.$j]:response?changesToSave?[void 0,posthog_icons_es.IconDownload]:["No changes to save",posthog_icons_es.IconDownload]:["Run query to update",posthog_icons_es.IconDownload],[updatingDataWarehouseSavedQuery,changesToSave,response]),isMaterializedView=editingView?.is_materialized===!0;return(0,jsx_runtime.jsxs)("div",{className:"flex flex-1 flex-col h-full overflow-hidden",children:[(editingView||editingInsight)&&(0,jsx_runtime.jsx)("div",{className:"h-5 bg-warning-highlight",children:(0,jsx_runtime.jsxs)("span",{className:"pl-2 text-xs",children:[editingView&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Editing ",isDraft?"draft of ":""," ",isMaterializedView?"materialized view":"view"," ",'"',editingView.name,'"']}),editingInsight&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:['Editing insight "',(0,jsx_runtime.jsx)(Link.r,{to:urls.j.insightView(editingInsight.short_id),children:editingInsight.name}),'"']})]})}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-start align-center w-full pl-2 pr-2 bg-white dark:bg-black border-b",children:["Database"!==activePanelIdentifier?(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>setActivePanelIdentifier("Database"),className:"rounded-none",icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconSidebarClose,{}),type:"tertiary",size:"xsmall",children:"Data warehouse"}):null,(0,jsx_runtime.jsx)(RunButton,{}),(0,jsx_runtime.jsx)(src.p2,{vertical:!0}),isDraft&&featureFlags[constants.y8.EDITOR_DRAFTS]&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LemonButton.J,{type:"tertiary",size:"xsmall",id:"sql-editor-query-window-save-as-draft",onClick:()=>{editingView?saveOrUpdateDraft({kind:schema_general.OH.HogQLQuery,query:null!=queryInput?queryInput:""},editingView.id,currentDraft?.id||void 0,activeTab):saveOrUpdateDraft({kind:schema_general.OH.HogQLQuery,query:null!=queryInput?queryInput:""},void 0,currentDraft?.id||void 0,activeTab)},children:"Save"}),(0,jsx_runtime.jsxs)(LemonButton.J,{type:"tertiary",size:"xsmall",id:"sql-editor-query-window-publish-draft",disabledReason:editingViewDisabledReason,onClick:()=>{if(editingView&&currentDraft?.id&&activeTab){var _response$types;updateView({id:editingView.id,query:{...sourceQuery.source,query:null!=queryInput?queryInput:""},name:editingView.name,types:response&&"types"in response&&null!==(_response$types=response?.types)&&void 0!==_response$types?_response$types:[],shouldRematerialize:isMaterializedView,edited_history_id:activeTab.view?.latest_history_id},currentDraft.id)}else saveAsView(!1,currentDraft?.id)},tooltip:editingView?"Publishing will update the view with these changes.":"The view this draft is based on has been deleted. Publishing will create a new view.",children:[!editingView&&(0,jsx_runtime.jsx)(posthog_icons_es.IconInfo,{className:"mr-1",color:"var(--warning)"}),"Publish"]})]}),editingView&&!isDraft&&activeTab&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[featureFlags[constants.y8.EDITOR_DRAFTS]&&(0,jsx_runtime.jsx)(LemonButton.J,{type:"tertiary",size:"xsmall",id:"sql-editor-query-window-save-draft",onClick:()=>{saveDraft(activeTab,null!=queryInput?queryInput:"",editingView.id)},children:"Save draft"}),(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>{var _response$types2;return updateView({id:editingView.id,query:{...sourceQuery.source,query:null!=queryInput?queryInput:""},types:response&&"types"in response&&null!==(_response$types2=response?.types)&&void 0!==_response$types2?_response$types2:[],shouldRematerialize:isMaterializedView,edited_history_id:inProgressViewEdits[editingView.id]})},disabledReason:editingViewDisabledReason,icon:(0,jsx_runtime.jsx)(EditingViewButtonIcon,{}),type:"tertiary",size:"xsmall",id:`sql-editor-query-window-update-${isMaterializedView?"materialize":"view"}`,children:isMaterializedView?"Update and re-materialize view":"Update view"})]}),editingView&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>openHistoryModal(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconBook,{}),type:"tertiary",size:"xsmall",id:"sql-editor-query-window-history",children:"History"})}),!editingInsight&&!editingView&&(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(LemonButton.J,{onClick:()=>saveAsView(),icon:(0,jsx_runtime.jsx)(posthog_icons_es.IconDownload,{}),type:"tertiary",size:"xsmall","data-attr":"sql-editor-save-view-button",id:"sql-editor-query-window-save-as-view",children:"Save as view"})}),(0,jsx_runtime.jsx)(FixErrorButton,{type:"tertiary",size:"xsmall",source:"action-bar"})]}),(0,jsx_runtime.jsx)(QueryPane,{originalValue:null!=originalQueryInput?originalQueryInput:"",queryInput:null!==(_ref2=suggestedQueryInput||queryInput)&&void 0!==_ref2?_ref2:"",sourceQuery:sourceQuery.source,promptError:null,onRun:runQuery,codeEditorProps:{queryKey:codeEditorKey,onChange:v=>{setQueryInput(null!=v?v:"")},onMount:(editor,monaco)=>{onSetMonacoAndEditor(monaco,editor)},onPressCmdEnter:(value,selectionType)=>{value&&"selection"===selectionType?runQuery(value):runQuery()},onError:error=>{setError(error)},onMetadata:metadata=>{setMetadata(metadata)},onMetadataLoading:loading=>{setMetadataLoading(loading)}}}),(0,jsx_runtime.jsx)(InternalQueryWindow,{tabId:tabId}),(0,jsx_runtime.jsx)(QueryHistoryModal,{})]})}function RunButton(){let{runQuery}=(0,index_esm.useActions)(multitabEditorLogic),{cancelQuery}=(0,index_esm.useActions)(dataNodeLogic.M),{responseLoading}=(0,index_esm.useValues)(dataNodeLogic.M),{metadata,queryInput,isSourceQueryLastRun}=(0,index_esm.useValues)(multitabEditorLogic),isUsingIndices=metadata?.isUsingIndices==="yes",[iconColor,tooltipContent]=(0,react.useMemo)(()=>isSourceQueryLastRun?["var(--primary)","No changes to run"]:!metadata||isUsingIndices||queryInput?.trim().length===0?["var(--success)","New changes to run"]:["var(--warning)",isUsingIndices?void 0:"This query is not using indices optimally, which may result in slower performance."],[metadata,isUsingIndices,queryInput,isSourceQueryLastRun]);return(0,jsx_runtime.jsx)(LemonButton.J,{"data-attr":"sql-editor-run-button",onClick:()=>{responseLoading?cancelQuery():runQuery()},icon:responseLoading?(0,jsx_runtime.jsx)(icons.uR,{}):(0,jsx_runtime.jsx)(posthog_icons_es.IconPlayFilled,{color:iconColor}),type:"tertiary",size:"xsmall",tooltip:tooltipContent,children:responseLoading?"Cancel":"Run"})}function InternalQueryWindow(_ref3){let{tabId}=_ref3,{finishedLoading}=(0,index_esm.useValues)(multitabEditorLogic);return finishedLoading?null:(0,jsx_runtime.jsx)(OutputPane,{tabId:tabId})}let scene={logic:multitabEditorLogic,component:EditorScene_EditorScene};function EditorScene_EditorScene(_ref){let{tabId}=_ref,ref=(0,react.useRef)(null),navigatorRef=(0,react.useRef)(null),queryPaneRef=(0,react.useRef)(null),sidebarRef=(0,react.useRef)(null),[monacoAndEditor,setMonacoAndEditor]=(0,react.useState)(null),[monaco,editor]=null!=monacoAndEditor?monacoAndEditor:[],logic=multitabEditorLogic({tabId:tabId||"",monaco,editor}),{queryInput,sourceQuery,dataLogicKey}=(0,index_esm.useValues)(logic),{setSourceQuery}=(0,index_esm.useActions)(logic),dataVisualizationLogicProps={key:dataLogicKey,query:sourceQuery,dashboardId:void 0,dataNodeCollectionId:dataLogicKey,editMode:!0,loadPriority:void 0,cachedResults:void 0,variablesOverride:void 0,setQuery:setter=>setSourceQuery(setter(sourceQuery))},dataNodeLogicProps={query:sourceQuery.source,key:dataLogicKey,cachedResults:void 0,loadPriority:void 0,dataNodeCollectionId:dataLogicKey,variablesOverride:void 0,autoLoad:!1,onError:error=>{let mountedLogic=multitabEditorLogic.findMounted({tabId:tabId||"",monaco,editor});mountedLogic&&mountedLogic.actions.setDataError(error)}},{loadData}=(0,index_esm.useActions)((0,dataNodeLogic.M)(dataNodeLogicProps)),variablesLogicProps={key:dataVisualizationLogicProps.key,readOnly:!1,queryInput:null!=queryInput?queryInput:"",sourceQuery,setQuery:setSourceQuery,onUpdate:query=>{loadData("force_async",void 0,query.source)}};return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:editorSizingLogic,props:{editorSceneRef:ref,navigatorRef,sidebarRef,sourceNavigatorResizerProps:{containerRef:navigatorRef,logicKey:"source-navigator",placement:"right"},sidebarResizerProps:{containerRef:sidebarRef,logicKey:"sidebar-resizer",placement:"right"},queryPaneResizerProps:{containerRef:queryPaneRef,logicKey:"query-pane",placement:"bottom"}},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataNodeLogic.M,props:dataNodeLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:dataVisualizationLogic.H8,props:dataVisualizationLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:displayLogic.Y,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:variablesLogic.Q,props:variablesLogicProps,children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:variableModalLogic.b,props:{key:dataVisualizationLogicProps.key},children:(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:outputPaneLogic.o,props:{tabId},children:(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:multitabEditorLogic,props:{tabId,monaco,editor},children:[(0,jsx_runtime.jsx)("div",{"data-attr":"editor-scene",className:"EditorScene w-full h-[calc(var(--scene-layout-rect-height)-var(--scene-layout-header-height))] flex flex-row overflow-hidden",ref:ref,children:(0,jsx_runtime.jsx)(QueryWindow,{tabId:tabId||"",onSetMonacoAndEditor:(monaco,editor)=>setMonacoAndEditor([monaco,editor])})}),(0,jsx_runtime.jsx)(ViewLinkModal.WI,{})]})})})})})})})})}},"../../frontend/src/scenes/data-warehouse/editor/outputPaneLogic.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{R:()=>OutputTab,o:()=>outputPaneLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js");let OutputTab=function(OutputTab){return OutputTab.Results="results",OutputTab.Visualization="visualization",OutputTab.Variables="variables",OutputTab.Materialization="materialization",OutputTab.Endpoint="endpoint",OutputTab}({}),outputPaneLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["data-warehouse","editor","outputPaneLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.tabId),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setActiveTab:tab=>({tab})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({activeTab:[OutputTab.Results,{setActiveTab:(_,_ref)=>{let{tab}=_ref;return tab}}]})])},"../../products/endpoints/frontend/endpointLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{U:()=>endpointLogic});var kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_router__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-router@3.4.1_kea@3.1.7_react@18.2.0_/node_modules/kea-router/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts"),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../frontend/src/lib/lemon-ui/LemonToast/LemonToast.tsx"),lib_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("../../frontend/src/lib/utils.tsx"),lib_utils_kea_logic_builders__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("../../frontend/src/lib/utils/kea-logic-builders.ts"),scenes_urls__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("../../frontend/src/scenes/urls.ts"),_endpointsLogic__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("../../products/endpoints/frontend/endpointsLogic.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let endpointLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","endpoints","frontend","endpointLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.tabId),(0,kea__WEBPACK_IMPORTED_MODULE_0__.connect)(()=>({actions:[_endpointsLogic__WEBPACK_IMPORTED_MODULE_7__.S,["loadEndpoints"]]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setEndpointName:endpointName=>({endpointName}),setEndpointDescription:endpointDescription=>({endpointDescription}),setActiveCodeExampleTab:tab=>({tab}),createEndpoint:request=>({request}),createEndpointSuccess:response=>({response}),createEndpointFailure:error=>({error}),deleteEndpoint:name1=>({name:name1}),deleteEndpointSuccess:response=>({response}),deleteEndpointFailure:error=>({error}),deactivateEndpoint:name1=>({name:name1}),deactivateEndpointSuccess:response=>({response}),deactivateEndpointFailure:error=>({error})}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({endpointName:[null,{setEndpointName:(_,_ref)=>{let{endpointName}=_ref;return endpointName}}],endpointDescription:[null,{setEndpointDescription:(_,_ref2)=>{let{endpointDescription}=_ref2;return endpointDescription}}],activeCodeExampleTab:["terminal",{setActiveCodeExampleTab:(_,_ref3)=>{let{tab}=_ref3;return tab}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.listeners)(_ref4=>{let{actions}=_ref4;return{createEndpoint:async _ref5=>{let{request}=_ref5;try{request.name&&(request.name=(0,lib_utils__WEBPACK_IMPORTED_MODULE_4__.lV)(request.name));let response=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.endpoint.create(request);actions.createEndpointSuccess(response)}catch(error){console.error("Failed to create endpoint:",error),actions.createEndpointFailure(error)}},createEndpointSuccess:()=>{actions.setEndpointName(""),actions.setEndpointDescription(""),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.Fragment,{children:["Endpoint created successfully!",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("br",{}),"You will be redirected to the endpoints page."]}),{onClose:()=>{kea_router__WEBPACK_IMPORTED_MODULE_1__.router.actions.push(scenes_urls__WEBPACK_IMPORTED_MODULE_6__.j.endpoints())}})},createEndpointFailure:_ref6=>{let{error}=_ref6;console.error("Failed to create endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Failed to create endpoint")},deleteEndpoint:async _ref7=>{let{name:name1}=_ref7;try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.endpoint.delete(name1),actions.deleteEndpointSuccess(name1)}catch(error){console.error("Failed to delete endpoint:",error),actions.deleteEndpointFailure(error)}},deleteEndpointSuccess:()=>{lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success("Endpoint deleted successfully"),actions.loadEndpoints()},deleteEndpointFailure:_ref8=>{let{error}=_ref8;console.error("Failed to delete endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Failed to delete endpoint")},deactivateEndpoint:async _ref9=>{let{name:name1}=_ref9;try{await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.endpoint.update(name1,{is_active:!1}),actions.deactivateEndpointSuccess({})}catch(error){console.error("Failed to deactivate endpoint:",error),actions.deactivateEndpointFailure(error)}},deactivateEndpointSuccess:()=>{lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.success("Endpoint deactivated successfully"),actions.loadEndpoints()},deactivateEndpointFailure:_ref10=>{let{error}=_ref10;console.error("Failed to deactivate endpoint:",error),lib_lemon_ui_LemonToast_LemonToast__WEBPACK_IMPORTED_MODULE_3__.UJ.error("Failed to deactivate endpoint")}}}),(0,lib_utils_kea_logic_builders__WEBPACK_IMPORTED_MODULE_5__.Y)()])},"../../products/endpoints/frontend/endpointsLogic.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{S:()=>endpointsLogic});var fuse_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("../../node_modules/.pnpm/fuse.js@6.6.2/node_modules/fuse.js/dist/fuse.esm.js"),kea__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../node_modules/.pnpm/kea@3.1.7_react@18.2.0/node_modules/kea/lib/index.esm.js"),kea_loaders__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../node_modules/.pnpm/kea-loaders@3.1.1_kea@3.1.7_react@18.2.0_/node_modules/kea-loaders/lib/index.js"),lib_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("../../frontend/src/lib/api.ts");let endpointsLogic=(0,kea__WEBPACK_IMPORTED_MODULE_0__.kea)([(0,kea__WEBPACK_IMPORTED_MODULE_0__.path)(["products","endpoints","frontend","endpointsLogic"]),(0,kea__WEBPACK_IMPORTED_MODULE_0__.props)({}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.key)(props=>props.tabId),(0,kea__WEBPACK_IMPORTED_MODULE_0__.actions)({setFilters:filters=>({filters})}),(0,kea_loaders__WEBPACK_IMPORTED_MODULE_1__.loaders)(()=>({allEndpoints:[[],{loadEndpoints:async()=>{let haystack=(await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.endpoint.list()).results||[];if(haystack.length>0){let names={names:haystack.map(endpoint=>endpoint.name)},lastExecutionTimes=await lib_api__WEBPACK_IMPORTED_MODULE_2__.ZP.endpoint.getLastExecutionTimes(names);haystack=haystack.map(endpoint=>({...endpoint,last_executed_at:lastExecutionTimes[endpoint.name]}))}return haystack}}]})),(0,kea__WEBPACK_IMPORTED_MODULE_0__.reducers)({filters:[{search:""},{setFilters:(state,_ref)=>{let{filters}=_ref;return{...state,...filters}}}]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.selectors)({endpoints:[s=>[s.allEndpoints,s.filters],(allEndpoints,filters)=>filters.search?new fuse_js__WEBPACK_IMPORTED_MODULE_3__.Z(allEndpoints,{keys:["name","description","query.query"],threshold:.3}).search(filters.search).map(result=>result.item):allEndpoints]}),(0,kea__WEBPACK_IMPORTED_MODULE_0__.afterMount)(_ref2=>{let{actions}=_ref2;actions.loadEndpoints()})])},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/queries/nodes/DataVisualization/Components/ConditionalFormatting/ConditionalFormattingTab.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".ConditionalFormattingTab__ColorPicker .LemonButton__chrome{gap:0;padding-left:6px!important}",""]),module.exports=exports},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/DataGrid.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".rdg-cell{border-block-end:1px solid var(--border);font-size:.75rem}.rdg-header-row .rdg-cell:focus,.rdg-header-row .rdg-cell:focus-visible{box-shadow:none!important;outline:none!important}.rdg-cell:focus,.rdg-cell:focus-visible{box-shadow:none!important;outline:none!important}.rdg-row .hover-actions-cell{opacity:0;transition:opacity .2s ease}.rdg-row:hover{cursor:pointer}.rdg-row:hover .hover-actions-cell{opacity:1}.RowDetailsModal .LemonTable__content table td{max-width:0}",""]),module.exports=exports},"../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/cjs.js!../../node_modules/.pnpm/postcss-loader@4.3.0_postcss@8.5.6_webpack@5.88.2/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0_webpack@5.88.2/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[2].use[3]!../../frontend/src/scenes/data-warehouse/editor/EditorScene.scss":(module,exports,__webpack_require__)=>{(exports=__webpack_require__("../../node_modules/.pnpm/css-loader@3.6.0_webpack@5.88.2/node_modules/css-loader/dist/runtime/api.js")(!1)).push([module.id,".EditorScene .LemonTabs__bar{height:39px;margin-bottom:0}",""]),module.exports=exports}}]);
//# sourceMappingURL=92130.519d9cdd.iframe.bundle.js.map