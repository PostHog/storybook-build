"use strict";(self.webpackChunk_posthog_storybook=self.webpackChunk_posthog_storybook||[]).push([[12344],{"../../products/revenue_analytics/frontend/RevenueAnalyticsScene.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{RevenueAnalyticsScene:()=>RevenueAnalyticsScene,scene:()=>scene});var posthog_icons_es=__webpack_require__("../../node_modules/.pnpm/@posthog+icons@0.11.7_react-dom@18.2.0_react@18.2.0__react@18.2.0/node_modules/@posthog/icons/dist/posthog-icons.es.js"),src=__webpack_require__("../../frontend/@posthog/lemon-ui/src/index.ts"),index_esm=__webpack_require__("../../node_modules/.pnpm/kea@3.1.5_react@18.2.0/node_modules/kea/lib/index.esm.js"),lib=__webpack_require__("../../node_modules/.pnpm/kea-router@3.2.1_kea@3.1.5_react@18.2.0_/node_modules/kea-router/lib/index.js"),DateFilter=__webpack_require__("../../frontend/src/lib/components/DateFilter/DateFilter.tsx"),IntervalFilter=__webpack_require__("../../frontend/src/lib/components/IntervalFilter/index.ts"),ProductIntroduction=__webpack_require__("../../frontend/src/lib/components/ProductIntroduction/ProductIntroduction.tsx"),urls=__webpack_require__("../../frontend/src/scenes/urls.ts"),userLogic=__webpack_require__("../../frontend/src/scenes/userLogic.ts"),dataNodeCollectionLogic=__webpack_require__("../../frontend/src/queries/nodes/DataNode/dataNodeCollectionLogic.ts"),Reload=__webpack_require__("../../frontend/src/queries/nodes/DataNode/Reload.tsx"),types=__webpack_require__("../../frontend/src/types.ts"),revenueAnalyticsLogic=__webpack_require__("../../products/revenue_analytics/frontend/revenueAnalyticsLogic.ts"),react=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/index.js"),Query=__webpack_require__("../../frontend/src/queries/Query/Query.tsx"),jsx_runtime=__webpack_require__("../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js");let QUERY_ID=revenueAnalyticsLogic.nf.GROSS_REVENUE,INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(QUERY_ID),loadPriority:QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},GrossRevenueTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),query=queries[QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...INSIGHT_PROPS,query}}),[query]);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)("h3",{className:"text-lg font-semibold",children:"Gross Revenue"}),(0,jsx_runtime.jsx)("p",{className:"text-sm text-gray-500",children:"Gross revenue is the total amount of revenue generated from all sources, including all products and services."}),(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})]})},OverviewTile_QUERY_ID=revenueAnalyticsLogic.nf.OVERVIEW,OverviewTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(OverviewTile_QUERY_ID),loadPriority:OverviewTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},OverviewTile=()=>{let{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),query=queries[OverviewTile_QUERY_ID],context=(0,react.useMemo)(()=>({insightProps:{...OverviewTile_INSIGHT_PROPS,query}}),[query]);return(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})};var Tooltip=__webpack_require__("../../frontend/src/lib/lemon-ui/Tooltip/index.ts"),utils=__webpack_require__("../../frontend/src/lib/utils.tsx"),css_classes=__webpack_require__("../../frontend/src/lib/utils/css-classes.ts"),geography_currency=__webpack_require__("../../frontend/src/lib/utils/geography/currency.ts"),revenueEventsSettingsLogic=__webpack_require__("../../products/revenue_analytics/frontend/settings/revenueEventsSettingsLogic.ts");let RevenueGrowthRateTile_QUERY_ID=revenueAnalyticsLogic.nf.REVENUE_GROWTH_RATE,RevenueGrowthRateTile_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(RevenueGrowthRateTile_QUERY_ID),loadPriority:RevenueGrowthRateTile_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},RevenueGrowthRateTile=()=>{let{baseCurrency}=(0,index_esm.useValues)(revenueEventsSettingsLogic.d),{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),query=queries[RevenueGrowthRateTile_QUERY_ID],columns=(0,react.useMemo)(()=>({month:{title:"Month"},mrr:{title:"MRR",render:_ref=>{let{value}=_ref;return(0,jsx_runtime.jsx)(MRRCell,{value:value,currency:baseCurrency})}},previous_mrr:{title:"Previous MRR",render:_ref2=>{let{value}=_ref2;return(0,jsx_runtime.jsx)(MRRCell,{value:value,currency:baseCurrency})}},mrr_growth_rate:{title:"MRR Growth Rate",render:_ref3=>{let{value,recordIndex,rowCount}=_ref3;return(0,jsx_runtime.jsx)(MRRGrowthRateCell,{value:value,isLast:recordIndex===rowCount-1})}}}),[baseCurrency]),context=(0,react.useMemo)(()=>({columns,insightProps:{...RevenueGrowthRateTile_INSIGHT_PROPS,query}}),[query,columns]);return(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})},MRRCell=_ref4=>{let{value,currency}=_ref4,{symbol,isPrefix}=(0,geography_currency.jK)(currency);return(0,jsx_runtime.jsxs)("span",{children:[isPrefix?symbol:null,(0,utils.Lc)(value,2,2),isPrefix?null:" "+symbol]})},MRRGrowthRateCell=_ref5=>{let{value,isLast}=_ref5,asNumber=Number(value),percentage=(100*asNumber).toFixed(2);return(0,jsx_runtime.jsxs)("span",{className:(0,css_classes.cn)("text-sm",asNumber>0?"text-green-500":"text-red-500"),children:[percentage,"%",isLast&&(0,jsx_runtime.jsx)(Tooltip.u,{title:"Given that the month hasn't finished yet, growth rate is not final",children:(0,jsx_runtime.jsx)(posthog_icons_es.aUG,{className:"ml-1"})})]})},TopCustomers_QUERY_ID=revenueAnalyticsLogic.nf.TOP_CUSTOMERS,TopCustomers_INSIGHT_PROPS={dashboardItemId:(0,revenueAnalyticsLogic.z0)(TopCustomers_QUERY_ID),loadPriority:TopCustomers_QUERY_ID,dataNodeCollectionId:revenueAnalyticsLogic.hP},RevenueChurnTile=()=>{let{baseCurrency}=(0,index_esm.useValues)(revenueEventsSettingsLogic.d),{queries}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),query=queries[TopCustomers_QUERY_ID],columns=(0,react.useMemo)(()=>({name:{title:"Name"},customer_id:{title:"Customer ID"},month:{title:"Month"},amount:{title:"Amount",render:_ref=>{let{value}=_ref;return(0,jsx_runtime.jsx)(AmountCell,{value:value,currency:baseCurrency})}}}),[baseCurrency]),context=(0,react.useMemo)(()=>({columns,insightProps:{...TopCustomers_INSIGHT_PROPS,query}}),[columns,query]);return(0,jsx_runtime.jsx)(Query.A,{query:query,readOnly:!0,context:context})},AmountCell=_ref2=>{let{value,currency}=_ref2,{symbol,isPrefix}=(0,geography_currency.jK)(currency);return(0,jsx_runtime.jsxs)("span",{children:[isPrefix?symbol:null,(0,utils.Lc)(value,2,2),isPrefix?null:" "+symbol]})},scene={component:RevenueAnalyticsScene,logic:revenueAnalyticsLogic.Km};function RevenueAnalyticsScene(){let{hasRevenueTables}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{updateHasSeenProductIntroFor}=(0,index_esm.useActions)(userLogic.userLogic);return(0,jsx_runtime.jsx)(index_esm.BindLogic,{logic:revenueAnalyticsLogic.Km,props:{},children:(0,jsx_runtime.jsxs)(index_esm.BindLogic,{logic:dataNodeCollectionLogic.y,props:{key:revenueAnalyticsLogic.hP},children:[(0,jsx_runtime.jsx)(ProductIntroduction.C,{isEmpty:!hasRevenueTables,productName:"Revenue Analytics",productKey:types.Md.REVENUE_ANALYTICS,titleOverride:"Connect your first revenue source",thingName:"revenue",description:"Track and analyze your revenue metrics to understand your business performance and growth.",actionElementOverride:(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,jsx_runtime.jsx)(src.Jp,{type:"primary",icon:(0,jsx_runtime.jsx)(posthog_icons_es.SC9,{}),onClick:()=>{updateHasSeenProductIntroFor(types.Md.REVENUE_ANALYTICS,!0),lib.router.actions.push(urls.j.pipelineNodeNew(types.We.Source,{kind:"stripe"}))},"data-attr":"create-revenue-source",children:"Connect revenue source"}),(0,jsx_runtime.jsxs)("span",{className:"text-xs text-muted-alt",children:["Only Stripe is supported currently. ",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)(src.rU,{target:"_blank",to:"https://github.com/PostHog/posthog/issues/new?assignees=&labels=enhancement,feature/revenue-analytics%2C+feature&projects=&template=feature_request.yml&title=New%20revenue%20source:%20%3Cinsert%20source%3E",children:"Request more revenue integrations."})]})]})}),hasRevenueTables&&(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,jsx_runtime.jsx)(RevenueAnalyticsFilters,{}),(0,jsx_runtime.jsx)(RevenueAnalyticsTables,{})]})]})})}let RevenueAnalyticsFilters=()=>{let{dateFilter:{dateTo,dateFrom,interval}}=(0,index_esm.useValues)(revenueAnalyticsLogic.Km),{setDates,setInterval,resetDatesAndInterval}=(0,index_esm.useActions)(revenueAnalyticsLogic.Km);return(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,jsx_runtime.jsx)(src.u,{title:"Reset to default",children:(0,jsx_runtime.jsx)(src.Jp,{icon:(0,jsx_runtime.jsx)(posthog_icons_es.A2c,{}),onClick:resetDatesAndInterval})}),(0,jsx_runtime.jsx)(DateFilter.f,{dateFrom:dateFrom,dateTo:dateTo,onChange:setDates}),(0,jsx_runtime.jsx)(IntervalFilter.T,{interval:interval,onIntervalChange:setInterval}),(0,jsx_runtime.jsx)(Reload.H,{iconOnly:!0})]})},RevenueAnalyticsTables=()=>(0,jsx_runtime.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,jsx_runtime.jsx)(OverviewTile,{}),(0,jsx_runtime.jsx)(GrossRevenueTile,{}),(0,jsx_runtime.jsx)(RevenueGrowthRateTile,{}),(0,jsx_runtime.jsx)(RevenueChurnTile,{})]})}}]);