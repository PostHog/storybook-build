(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{5901:function(module,exports,__webpack_require__){(exports=__webpack_require__(50)(!1)).push([module.i,'.mixin-gradient-overlay{width:100%;height:3rem;background:linear-gradient(0deg,#fff,transparent)}.mixin-gradient-overlay,.mixin-gradient-overlay-right{content:"";position:absolute;pointer-events:none;bottom:0}.mixin-gradient-overlay-right{width:3rem;height:100%;background:linear-gradient(270deg,#fff,transparent)}.text-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 8px)}.feature-flag .enabled-switch{margin-right:1rem!important}.feature-flag .enabled-switch .ant-form-item-control-input-content{flex-direction:row;align-items:center;display:flex}.feature-flag .enabled-switch .ant-form-item-label{padding:0 4px 0 0}.variant-form-list .ant-form-item{min-height:32px}.variant-form-list .label-row{margin-bottom:4px;font-weight:700}.variant-form-list .label-row .ant-col{min-height:32px;display:flex;justify-content:space-between;align-items:center}',""]),module.exports=exports},6153:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"scene",(function(){return scene})),__webpack_require__.d(__webpack_exports__,"FeatureFlag",(function(){return FeatureFlag_FeatureFlag}));__webpack_require__(38),__webpack_require__(35),__webpack_require__(64),__webpack_require__(37),__webpack_require__(113);var defineProperty=__webpack_require__(7),defineProperty_default=__webpack_require__.n(defineProperty),slicedToArray=__webpack_require__(14),slicedToArray_default=__webpack_require__.n(slicedToArray),react=__webpack_require__(0),react_default=__webpack_require__.n(react),es_form=__webpack_require__(433),es_switch=__webpack_require__(5629),es_button=__webpack_require__(111),row=__webpack_require__(359),col=__webpack_require__(235),input=__webpack_require__(713),collapse=__webpack_require__(5663),popconfirm=__webpack_require__(5625),es_radio=__webpack_require__(1173),tag=__webpack_require__(871),slider=__webpack_require__(6132),input_number=__webpack_require__(5667),card=__webpack_require__(5666),index_esm=__webpack_require__(1),utils=__webpack_require__(11),PropertyFilters=__webpack_require__(290),DeleteOutlined=__webpack_require__(5643),SaveOutlined=__webpack_require__(5741),ApiFilled=__webpack_require__(5681),MergeCellsOutlined=__webpack_require__(5929),PlusOutlined=__webpack_require__(1805),CodeSnippet=__webpack_require__(48),featureFlagLogic=__webpack_require__(2459),logic_featureFlagLogic=__webpack_require__(68),PageHeader=__webpack_require__(324),injectStylesIntoStyleTag=__webpack_require__(23),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),FeatureFlag=__webpack_require__(5901),FeatureFlag_default=__webpack_require__.n(FeatureFlag),options={insert:"head",singleton:!1},Checkbox=(injectStylesIntoStyleTag_default()(FeatureFlag_default.a,options),FeatureFlag_default.a.locals,__webpack_require__(516)),Checkbox_default=__webpack_require__.n(Checkbox),icons=__webpack_require__(46),teamLogic=__webpack_require__(26),Tooltip=__webpack_require__(55),constants=__webpack_require__(19),types=__webpack_require__(43);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){defineProperty_default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var scene={component:FeatureFlag_FeatureFlag,logic:featureFlagLogic.a},UTM_TAGS="?utm_medium=in-product&utm_campaign=feature-flag";function JSSnippet(_ref){var flagKey=_ref.flagKey;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(CodeSnippet.a,{language:CodeSnippet.b.JavaScript,wrap:!0},"if (posthog.isFeatureEnabled('".concat(null!=flagKey?flagKey:"","')) {\n    // run your activation code here\n}")),react_default.a.createElement("div",{className:"mt"},"Need more information?"," ",react_default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/js-integration".concat(UTM_TAGS,"#feature-flags")},"Check the docs ",react_default.a.createElement(icons.IconExternalLink,null))))}function PythonSnippet(_ref2){var flagKey=_ref2.flagKey;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(CodeSnippet.a,{language:CodeSnippet.b.Python,wrap:!0},'if posthog.feature_enabled("'.concat(flagKey,'", "user_distinct_id"):\n    runAwesomeFeature()\n')),react_default.a.createElement("div",{className:"mt"},"Need more information?"," ",react_default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/integrations/python-integration".concat(UTM_TAGS,"#feature-flags")},"Check the docs ",react_default.a.createElement(icons.IconExternalLink,null))))}function APISnippet(){var currentTeam=Object(index_esm.useValues)(teamLogic.a).currentTeam;return react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(CodeSnippet.a,{language:CodeSnippet.b.Bash,wrap:!0},"curl ".concat(window.location.origin,"/decide/ \\\n-X POST -H 'Content-Type: application/json' \\\n-d '{\n    \"api_key\": \"").concat(currentTeam?currentTeam.api_token:"[project_api_key]",'",\n    "distinct_id": "[user distinct id]"\n}\'\n                ')),react_default.a.createElement("div",{className:"mt"},"Need more information?"," ",react_default.a.createElement("a",{target:"_blank",rel:"noopener",href:"https://posthog.com/docs/api/feature-flags".concat(UTM_TAGS)},"Check the docs ",react_default.a.createElement(icons.IconExternalLink,null))))}function focusVariantKeyField(index){setTimeout((function(){var _document$querySelect;return null===(_document$querySelect=document.querySelector('.variant-form-list input[data-key-index="'.concat(index,'"]')))||void 0===_document$querySelect?void 0:_document$querySelect.focus()}),50)}function FeatureFlag_FeatureFlag(){var _Form$useForm=es_form.a.useForm(),form=slicedToArray_default()(_Form$useForm,1)[0],_useValues2=Object(index_esm.useValues)(featureFlagLogic.a),featureFlag=_useValues2.featureFlag,featureFlagId=_useValues2.featureFlagId,multivariateEnabled=_useValues2.multivariateEnabled,variants=_useValues2.variants,nonEmptyVariants=_useValues2.nonEmptyVariants,areVariantRolloutsValid=_useValues2.areVariantRolloutsValid,variantRolloutSum=_useValues2.variantRolloutSum,_useActions=Object(index_esm.useActions)(featureFlagLogic.a),addMatchGroup=_useActions.addMatchGroup,updateMatchGroup=_useActions.updateMatchGroup,removeMatchGroup=_useActions.removeMatchGroup,saveFeatureFlag=_useActions.saveFeatureFlag,deleteFeatureFlag=_useActions.deleteFeatureFlag,setMultivariateEnabled=_useActions.setMultivariateEnabled,addVariant=_useActions.addVariant,updateVariant=_useActions.updateVariant,removeVariant=_useActions.removeVariant,distributeVariantsEqually=_useActions.distributeVariantsEqually,setFeatureFlag=_useActions.setFeatureFlag,enabledFeatureFlags=Object(index_esm.useValues)(logic_featureFlagLogic.a).featureFlags,_useState=Object(react.useState)(!1),_useState2=slicedToArray_default()(_useState,2),hasKeyChanged=_useState2[0],setHasKeyChanged=_useState2[1],_useState3=Object(react.useState)(!1),_useState4=slicedToArray_default()(_useState3,2),showVariantDiscardWarning=_useState4[0],setShowVariantDiscardWarning=_useState4[1];return Object(react.useEffect)((function(){form.setFieldsValue(_objectSpread({},featureFlag))}),[featureFlag]),react_default.a.createElement("div",{className:"feature-flag"},featureFlag?react_default.a.createElement(es_form.a,{layout:"vertical",form:form,initialValues:{name:featureFlag.name,key:featureFlag.key,active:featureFlag.active},onValuesChange:function onValuesChange(newValues){"new"!==featureFlagId&&newValues.key&&setHasKeyChanged(newValues.key!==featureFlag.key),setFeatureFlag(_objectSpread(_objectSpread({},featureFlag),newValues))},onFinish:function onFinish(values){return saveFeatureFlag(_objectSpread(_objectSpread(_objectSpread({},featureFlag),values),{},{filters:featureFlag.filters}))},requiredMark:!1,scrollToFirstError:!0},react_default.a.createElement(PageHeader.a,{title:"Feature Flag",buttons:react_default.a.createElement("div",{style:{display:"flex"}},react_default.a.createElement(es_form.a.Item,{className:"enabled-switch"},react_default.a.createElement(es_form.a.Item,{shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.active!==currentValues.active},style:{marginBottom:0,marginRight:6}},(function(_ref3){var getFieldValue=_ref3.getFieldValue;return react_default.a.createElement("span",{className:"ant-form-item-label",style:{lineHeight:"1.5rem"}},getFieldValue("active")?react_default.a.createElement("span",{className:"text-success"},"Enabled"):react_default.a.createElement("span",{className:"text-danger"},"Disabled"))})),react_default.a.createElement(es_form.a.Item,{name:"active",noStyle:!0,valuePropName:"checked"},react_default.a.createElement(es_switch.a,null))),"new"!==featureFlagId&&react_default.a.createElement(es_button.a,{"data-attr":"delete-flag",danger:!0,icon:react_default.a.createElement(DeleteOutlined.a,null),onClick:function onClick(){deleteFeatureFlag(featureFlag)},style:{marginRight:16}},"Delete"),react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(SaveOutlined.a,null),type:"primary","data-attr":"feature-flag-submit",htmlType:"submit"},"Save changes"))}),react_default.a.createElement("h3",{className:"l3"},"General configuration"),react_default.a.createElement("div",{className:"text-muted mb"},"General settings for your feature flag and integration instructions."),react_default.a.createElement(row.a,{gutter:16,style:{marginBottom:32}},react_default.a.createElement(col.a,{span:12},react_default.a.createElement(es_form.a.Item,{name:"key",label:"Key (must be unique)",rules:[{required:!0,message:"You need to set a key."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}],validateStatus:hasKeyChanged?"warning":void 0,help:hasKeyChanged?react_default.a.createElement("small",null,react_default.a.createElement("b",null,"Warning! "),"Changing this key will",react_default.a.createElement("a",{href:"https://posthog.com/docs/features/feature-flags".concat(UTM_TAGS,"#feature-flag-persistence"),target:"_blank",rel:"noopener"}," ","affect the persistence of your flag ",react_default.a.createElement(icons.IconExternalLink,null))):void 0},react_default.a.createElement(input.a,{"data-attr":"feature-flag-key",className:"ph-ignore-input",autoFocus:!0,placeholder:"examples: new-landing-page, betaFeature, ab_test_1",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1})),react_default.a.createElement(es_form.a.Item,{name:"name",label:"Description"},react_default.a.createElement(input.a.TextArea,{className:"ph-ignore-input","data-attr":"feature-flag-description",placeholder:"Adding a helpful description can ensure others know what this feature is for."}))),react_default.a.createElement(col.a,{span:12,style:{paddingTop:31}},react_default.a.createElement(collapse.a,null,react_default.a.createElement(collapse.a.Panel,{header:react_default.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},react_default.a.createElement(icons.IconJavascript,{style:{marginRight:6}})," Javascript integration instructions"),key:"js"},react_default.a.createElement(es_form.a.Item,{shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.key!==currentValues.key}},(function(_ref4){var getFieldValue=_ref4.getFieldValue;return react_default.a.createElement(JSSnippet,{flagKey:getFieldValue("key")})}))),react_default.a.createElement(collapse.a.Panel,{header:react_default.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},react_default.a.createElement(icons.IconPython,{style:{marginRight:6}})," Python integration instructions"),key:"python"},react_default.a.createElement(es_form.a.Item,{shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.key!==currentValues.key}},(function(_ref5){var getFieldValue=_ref5.getFieldValue;return react_default.a.createElement(PythonSnippet,{flagKey:getFieldValue("key")})}))),react_default.a.createElement(collapse.a.Panel,{header:react_default.a.createElement("div",{style:{display:"flex",fontWeight:"bold",alignItems:"center"}},react_default.a.createElement(ApiFilled.a,{style:{marginRight:6}})," API integration instructions"),key:"api"},react_default.a.createElement(es_form.a.Item,{shouldUpdate:function shouldUpdate(prevValues,currentValues){return prevValues.key!==currentValues.key}},react_default.a.createElement(APISnippet,null)))))),enabledFeatureFlags[constants.o.MULTIVARIATE_SUPPORT]&&react_default.a.createElement("div",{className:"mb-2"},react_default.a.createElement("h3",{className:"l3"},"Served value"),react_default.a.createElement("div",{className:"mb-05"},react_default.a.createElement(popconfirm.a,{placement:"top",title:"Change value type? The variants below will be lost.",visible:showVariantDiscardWarning,onConfirm:function onConfirm(){setMultivariateEnabled(!1),setShowVariantDiscardWarning(!1)},onCancel:function onCancel(){return setShowVariantDiscardWarning(!1)},okText:"OK",cancelText:"Cancel"},react_default.a.createElement(es_radio.a.Group,{options:[{label:"Boolean value (A/B test)",value:!1},{label:react_default.a.createElement("div",null,"String value (Multivariate test)"," ",react_default.a.createElement(tag.a,{color:"orange",style:{fontSize:12,fontWeight:"bold"}},"ALPHA")),value:!0}],onChange:function onChange(e){var value=e.target.value;!1===value&&nonEmptyVariants.length?setShowVariantDiscardWarning(!0):(setMultivariateEnabled(value),focusVariantKeyField(0))},value:multivariateEnabled,optionType:"button"}))),react_default.a.createElement("div",{className:"text-muted mb"},"Users will be served"," ",multivariateEnabled?react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("strong",null,"a variant key")," according to the below distribution"):react_default.a.createElement("strong",null,react_default.a.createElement("code",null,"true"))," ","if they match one or more release condition groups."),multivariateEnabled&&react_default.a.createElement("div",{className:"variant-form-list"},react_default.a.createElement(row.a,{gutter:8,className:"label-row"},react_default.a.createElement(col.a,{span:7},"Variant key"),react_default.a.createElement(col.a,{span:7},"Description"),react_default.a.createElement(col.a,{span:9},react_default.a.createElement("span",null,"Rollout percentage"),react_default.a.createElement(es_button.a,{type:"link",onClick:distributeVariantsEqually,icon:react_default.a.createElement(MergeCellsOutlined.a,null),style:{padding:"0 0 0 0.5em"},title:"Distribute variants equally"},"Distribute"))),variants.map((function(_ref6,index){var rollout_percentage=_ref6.rollout_percentage;return react_default.a.createElement(es_form.a,{key:index,onValuesChange:function onValuesChange(changedValues){return updateVariant(index,changedValues)},initialValues:variants[index],validateTrigger:["onChange","onBlur"]},react_default.a.createElement(row.a,{gutter:8},react_default.a.createElement(col.a,{span:7},react_default.a.createElement(es_form.a.Item,{name:"key",rules:[{required:!0,message:"Key should not be empty."},{pattern:/^([A-z]|[a-z]|[0-9]|-|_)+$/,message:"Only letters, numbers, hyphens (-) & underscores (_) are allowed."}]},react_default.a.createElement(input.a,{"data-attr":"feature-flag-variant-key","data-key-index":index.toString(),className:"ph-ignore-input",placeholder:"example-variant-".concat(index+1),autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:!1}))),react_default.a.createElement(col.a,{span:7},react_default.a.createElement(es_form.a.Item,{name:"name"},react_default.a.createElement(input.a,{"data-attr":"feature-flag-variant-name",className:"ph-ignore-input",placeholder:"Description"}))),react_default.a.createElement(col.a,{span:7},react_default.a.createElement(slider.a,{tooltipPlacement:"top",value:rollout_percentage,onChange:function onChange(value){return updateVariant(index,{rollout_percentage:value})}})),react_default.a.createElement(col.a,{span:2},react_default.a.createElement(input_number.a,{min:0,max:100,value:rollout_percentage,onChange:function onChange(value){if(null!=value){var valueInt=parseInt(value.toString());isNaN(valueInt)||updateVariant(index,{rollout_percentage:valueInt})}},style:{width:"100%",borderColor:areVariantRolloutsValid?void 0:"var(--danger)"}})),variants.length>1&&react_default.a.createElement(col.a,{span:1},react_default.a.createElement(Tooltip.a,{title:"Delete this variant",placement:"bottomLeft"},react_default.a.createElement(es_button.a,{type:"link",icon:react_default.a.createElement(DeleteOutlined.a,null),onClick:function onClick(){return removeVariant(index)},style:{color:"var(--danger)"}})))))})),variants.length>0&&!areVariantRolloutsValid&&react_default.a.createElement("p",{className:"text-danger"},"Percentage rollouts for variants must sum to 100 (currently"," ",variantRolloutSum,")."),react_default.a.createElement(es_button.a,{type:"dashed",block:!0,icon:react_default.a.createElement(PlusOutlined.a,null),onClick:function onClick(){var newIndex=variants.length;addVariant(),focusVariantKeyField(newIndex)},style:{marginBottom:16}},"Add Variant"))),react_default.a.createElement("h3",{className:"l3"},"Release condition groups (",featureFlag.filters.groups.length,")"),react_default.a.createElement("div",{className:"text-muted mb"},"Specify which users or groups of users to which you want to release this flag."),react_default.a.createElement(es_button.a,{type:"dashed",block:!0,icon:react_default.a.createElement(PlusOutlined.a,null),onClick:addMatchGroup,style:{marginBottom:16}},"Add Group"),react_default.a.createElement(row.a,{gutter:16},featureFlag.filters.groups.map((function(group,index){var _group$properties;return react_default.a.createElement(col.a,{span:24,md:12,key:"".concat(index,"-").concat(featureFlag.filters.groups.length)},react_default.a.createElement(card.a,{style:{position:"relative",marginBottom:32,paddingBottom:16}},index>0&&react_default.a.createElement("div",{className:"stateful-badge pos-center-end or"},"OR"),featureFlag.filters.groups.length>1&&react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement("span",{style:{position:"absolute",top:0,right:0,margin:4}},react_default.a.createElement(Tooltip.a,{title:"Delete this match group",placement:"bottomLeft"},react_default.a.createElement(es_button.a,{type:"link",icon:react_default.a.createElement(DeleteOutlined.a,null),onClick:function onClick(){return removeMatchGroup(index)},style:{color:"var(--danger)"}}))),react_default.a.createElement("div",{className:"mb"},react_default.a.createElement("b",null,"Group",react_default.a.createElement("span",{className:"simple-tag tag-light-lilac",style:{marginLeft:8}},index+1)))),react_default.a.createElement(es_form.a.Item,{style:{position:"relative",marginBottom:16}},(null===(_group$properties=group.properties)||void 0===_group$properties?void 0:_group$properties.length)?react_default.a.createElement("b",null,"Matching users with filters"):react_default.a.createElement("b",null,featureFlag.filters.groups.length>1?"Group will match ":"Match ",react_default.a.createElement("span",{style:{color:"var(--warning)"}},"all users")),react_default.a.createElement(PropertyFilters.a,{pageKey:"feature-flag-".concat(featureFlag.id,"-").concat(index,"-").concat(featureFlag.filters.groups.length),propertyFilters:null==group?void 0:group.properties,onChange:function onChange(properties){return updateMatchGroup(index,void 0,properties)},endpoint:"person",taxonomicGroupTypes:[types.a.PersonProperties,types.a.Cohorts],showConditionBadge:!0})),react_default.a.createElement(es_form.a.Item,{style:{marginBottom:0}},react_default.a.createElement(react_default.a.Fragment,null,react_default.a.createElement(Checkbox_default.a,{checked:!!group.rollout_percentage,onChange:function onChange(e){return e.target.checked?updateMatchGroup(index,30):updateMatchGroup(index,null)},"data-attr":"feature-flag-switch"},react_default.a.createElement("b",null,"Roll out to only a percentage of users",featureFlag.filters.groups.length>1&&" in this group")),null===group.rollout_percentage?react_default.a.createElement("div",{className:"mt"},"Rolling out to ",react_default.a.createElement("b",null,"100%")," of users",featureFlag.filters.groups.length>1&&" in this group"):react_default.a.createElement(slider.a,{tooltipPlacement:"top",tipFormatter:function tipFormatter(value){return value+"%"},tooltipVisible:!0,value:group.rollout_percentage,onChange:function onChange(value){updateMatchGroup(index,value)}})))))}))),react_default.a.createElement(es_form.a.Item,{className:"text-right"},react_default.a.createElement(es_button.a,{icon:react_default.a.createElement(SaveOutlined.a,null),htmlType:"submit",type:"primary","data-attr":"feature-flag-submit-bottom"},"Save changes"))):react_default.a.createElement(utils.d,null))}}}]);