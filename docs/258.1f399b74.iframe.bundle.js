(window.webpackJsonp=window.webpackJsonp||[]).push([[258],{"./frontend/src/scenes/feature-flags/FeatureFlags.tsx":function(ae,L,e){"use strict";e.r(L),e.d(L,"scene",function(){return b}),e.d(L,"FeatureFlags",function(){return p}),e.d(L,"groupFilters",function(){return D});var x=e("./node_modules/core-js/modules/es.array.includes.js"),ne=e.n(x),S=e("./node_modules/core-js/modules/es.array.some.js"),re=e.n(S),V=e("./node_modules/core-js/modules/es.function.name.js"),se=e.n(V),N=e("./node_modules/core-js/modules/es.number.constructor.js"),oe=e.n(N),H=e("./node_modules/react/index.js"),n=e.n(H),O=e("./node_modules/kea/lib/index.esm.js"),A=e("./frontend/src/scenes/feature-flags/featureFlagsLogic.ts"),G=e("./node_modules/antd/es/input/index.js"),I=e("./node_modules/antd/es/tabs/index.js"),Y=e("./frontend/src/lib/components/Link.tsx"),$=e("./frontend/src/lib/utils.tsx"),R=e("./node_modules/@ant-design/icons/es/icons/PlusOutlined.js"),q=e("./frontend/src/lib/components/PageHeader.tsx"),C=e("./frontend/src/lib/components/LinkButton.tsx"),ee=e("./frontend/src/lib/components/Table/utils.tsx"),T=e("./frontend/src/scenes/urls.ts"),te=e("./frontend/src/lib/utils/stringWithWBR.tsx"),z=e("./frontend/src/scenes/teamLogic.ts"),j=e("./frontend/src/lib/components/LemonButton/index.ts"),J=e("./frontend/src/lib/components/LemonRow/index.ts"),W=e("./frontend/src/lib/components/LemonSwitch/LemonSwitch.tsx"),Q=e("./frontend/src/lib/components/LemonTable/index.ts"),B=e("./frontend/src/lib/components/LemonButton/More.tsx"),K=e("./frontend/src/lib/components/LemonTable/columnUtils.tsx"),v=e("./frontend/src/lib/components/PropertyFilters/components/PropertyFiltersDisplay.tsx"),U=e("./frontend/src/lib/logic/featureFlagLogic.ts"),X=e("./frontend/src/lib/constants.tsx"),Z=e("./frontend/src/lib/components/ActivityLog/ActivityLog.tsx"),h=e("./frontend/src/scenes/feature-flags/activityDescriptions.tsx"),w=e("./frontend/src/lib/components/ActivityLog/humanizeActivity.tsx"),b={component:p,logic:A.a};function F(){var d=Object(O.useValues)(z.a),y=d.currentTeamId,u=Object(O.useValues)(A.a),P=u.featureFlagsLoading,c=u.searchedFeatureFlags,f=u.searchTerm,a=Object(O.useActions)(A.a),t=a.updateFeatureFlag,r=a.loadFeatureFlags,s=a.setSearchTerm,l=Object(O.useValues)(U.a),m=l.featureFlags,g=m[X.n.FEATURE_FLAGS_ACTIVITY_LOG],M=[{title:Object(ee.a)("Key"),dataIndex:"key",className:"ph-no-capture",sticky:!0,width:"40%",sorter:function(i,o){return(i.key||"").localeCompare(o.key||"")},render:function(i,o){return n.a.createElement(n.a.Fragment,null,n.a.createElement(Y.a,{to:o.id?T.a.featureFlag(o.id):void 0,className:"row-name"},Object(te.a)(o.key,17)),o.name&&n.a.createElement("span",{className:"row-description"},o.name))}},Object(K.b)(),Object(K.a)(),{title:"Rollout",width:200,render:function(i,o){return D(o.filters.groups)}},{title:"Status",dataIndex:"active",sorter:function(i,o){return Number(i.active)-Number(o.active)},width:100,render:function(i,o){var E="feature-flag-".concat(o.id,"-switch");return n.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},n.a.createElement("label",{htmlFor:E},o.active?"Enabled":"Disabled"),n.a.createElement(W.a,{id:E,checked:o.active,onChange:function(le){return o.id?t({id:o.id,payload:{active:le}}):null},style:{marginLeft:"0.5rem"}}))}},{width:0,render:function(i,o){return n.a.createElement(B.a,{overlay:n.a.createElement(n.a.Fragment,null,n.a.createElement(j.a,{type:"stealth",onClick:function(){Object($.t)(o.key,"feature flag key")},fullWidth:!0},"Copy key"),o.id&&n.a.createElement(j.a,{type:"stealth",to:T.a.featureFlag(o.id),fullWidth:!0},"Edit"),n.a.createElement(j.a,{type:"stealth",to:T.a.insightNew({events:[{id:"$pageview",name:"$pageview",type:"events",math:"dau"}],breakdown_type:"event",breakdown:"$feature/".concat(o.key)}),"data-attr":"usage",fullWidth:!0},"Try out in Insights"),n.a.createElement(J.b,null),o.id&&n.a.createElement(j.a,{type:"stealth",style:{color:"var(--danger)"},onClick:function(){Object($.x)({endpoint:"projects/".concat(y,"/feature_flags"),object:{name:o.key,id:o.id},callback:r})},fullWidth:!0},"Delete feature flag"))})}}];return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,n.a.createElement(G.a.Search,{placeholder:"Search for feature flags",allowClear:!0,enterButton:!0,style:{maxWidth:400,width:"initial",flexGrow:1,marginBottom:"1rem"},value:f,onChange:function(i){s(i.target.value)}}),!g&&n.a.createElement("div",{className:"mb float-right"},n.a.createElement(C.a,{type:"primary",to:T.a.featureFlag("new"),"data-attr":"new-feature-flag",icon:n.a.createElement(R.a,null)},"New Feature Flag"))),n.a.createElement(Q.a,{dataSource:c,columns:M,rowKey:"key",loading:P,defaultSorting:{columnKey:"key",order:1},pagination:{pageSize:100},nouns:["feature flag","feature flags"],"data-attr":"feature-flag-table"}))}function p(){var d=Object(O.useValues)(U.a),y=d.featureFlags,u=y[X.n.FEATURE_FLAGS_ACTIVITY_LOG],P=Object(O.useValues)(A.a),c=P.activeTab,f=P.historyPage,a=Object(O.useActions)(A.a),t=a.setActiveTab;return n.a.createElement("div",{className:"feature_flags"},n.a.createElement(q.a,{title:"Feature Flags",caption:u?"":"Feature Flags are a way of turning functionality in your app on or off, based on user properties.",buttons:u?n.a.createElement(C.a,{type:"primary",to:T.a.featureFlag("new"),"data-attr":"new-feature-flag",icon:n.a.createElement(R.a,null)},"New Feature Flag"):!1}),u?n.a.createElement(I.a,{activeKey:c,destroyInactiveTabPane:!0,onChange:function(s){return t(s)}},n.a.createElement(I.a.TabPane,{tab:"Overview",key:"overview"},n.a.createElement(F,null)),n.a.createElement(I.a.TabPane,{tab:"History",key:"history"},n.a.createElement(Z.a,{scope:w.a.FEATURE_FLAG,describer:h.a,startingPage:f!=null?f:1}))):n.a.createElement(F,null))}function D(d){if(d.length===0||!d.some(function(f){return f.rollout_percentage!==0}))return"No users";if(d.some(function(f){var a;return!(!((a=f.properties)===null||a===void 0)&&a.length)&&[null,void 0,100].includes(f.rollout_percentage)}))return"All users";if(d.length===1){var y=d[0],u=y.properties,P=y.rollout_percentage,c=P===void 0?null:P;return(u==null?void 0:u.length)>0&&c!=null?n.a.createElement("div",{style:{display:"flex",alignItems:"center"}},n.a.createElement("span",{style:{flexShrink:0,marginRight:5}},c,"% of"),n.a.createElement(v.a,{filters:u,style:{margin:0,width:"100%"}})):(u==null?void 0:u.length)>0?n.a.createElement(v.a,{filters:u,style:{margin:0}}):c!==null?"".concat(c,"% of all users"):(console.error("A group with full rollout was not detected early"),"All users")}return"".concat(d.length," groups")}try{D.displayName="groupFilters",D.__docgenInfo={description:"",displayName:"groupFilters",props:{}},typeof STORYBOOK_REACT_CLASSES!="undefined"&&(STORYBOOK_REACT_CLASSES["frontend/src/scenes/feature-flags/FeatureFlags.tsx#groupFilters"]={docgenInfo:D.__docgenInfo,name:"groupFilters",path:"frontend/src/scenes/feature-flags/FeatureFlags.tsx#groupFilters"})}catch(d){}},"./frontend/src/scenes/feature-flags/featureFlagsLogic.ts":function(ae,L,e){"use strict";e.d(L,"a",function(){return f});var x=e("./node_modules/core-js/modules/es.array.concat.js"),ne=e.n(x),S=e("./node_modules/core-js/modules/es.array.filter.js"),re=e.n(S),V=e("./node_modules/core-js/modules/es.array.find.js"),se=e.n(V),N=e("./node_modules/core-js/modules/es.array.includes.js"),oe=e.n(N),H=e("./node_modules/core-js/modules/es.array.iterator.js"),n=e.n(H),O=e("./node_modules/core-js/modules/es.array.map.js"),A=e.n(O),G=e("./node_modules/core-js/modules/es.object.to-string.js"),I=e.n(G),Y=e("./node_modules/core-js/modules/es.object.values.js"),$=e.n(Y),R=e("./node_modules/core-js/modules/es.regexp.exec.js"),q=e.n(R),C=e("./node_modules/core-js/modules/es.string.includes.js"),ee=e.n(C),T=e("./node_modules/core-js/modules/es.string.search.js"),te=e.n(T),z=e("./node_modules/core-js/modules/web.dom-collections.iterator.js"),j=e.n(z),J=e("./node_modules/@babel/runtime/helpers/defineProperty.js"),W=e.n(J),Q=e("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),B=e.n(Q),K=e("./node_modules/@babel/runtime/regenerator/index.js"),v=e.n(K),U=e("./node_modules/regenerator-runtime/runtime.js"),X=e.n(U),Z=e("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),h=e.n(Z),w=e("./node_modules/kea/lib/index.esm.js"),b=e("./frontend/src/lib/api.ts"),F=e("./node_modules/fuse.js/dist/fuse.esm.js"),p=e("./frontend/src/scenes/teamLogic.ts"),D=e("./frontend/src/scenes/urls.ts"),d=e("./node_modules/kea-router/lib/index.js"),y=e.n(d);function u(a,t){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);t&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(a,l).enumerable})),r.push.apply(r,s)}return r}function P(a){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(s){W()(a,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(s){Object.defineProperty(a,s,Object.getOwnPropertyDescriptor(r,s))})}return a}var c;(function(a){a.OVERVIEW="overview",a.HISTORY="history"})(c||(c={}));var f=Object(w.kea)({path:["scenes","feature-flags","featureFlagsLogic"],connect:{values:[p.a,["currentTeamId"]]},actions:{updateFlag:function(t){return{flag:t}},deleteFlag:function(t){return{id:t}},setSearchTerm:function(t){return{searchTerm:t}},setActiveTab:function(t){return{tabKey:t}},setHistoryPage:function(t){return{page:t}}},loaders:function(t){var r=t.values;return{featureFlags:{__default:[],loadFeatureFlags:function(){var s=h()(v.a.mark(function m(){var g;return v.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,b.a.get("api/projects/".concat(r.currentTeamId,"/feature_flags/"));case 2:return g=_.sent,_.abrupt("return",g.results);case 4:case"end":return _.stop()}},m)}));function l(){return s.apply(this,arguments)}return l}(),updateFeatureFlag:function(){var s=h()(v.a.mark(function m(g){var M,_,i;return v.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return M=g.id,_=g.payload,E.next=3,b.a.update("api/projects/".concat(r.currentTeamId,"/feature_flags/").concat(M),_);case 3:return i=E.sent,E.abrupt("return",B()(r.featureFlags).map(function(k){return k.id===i.id?i:k}));case 5:case"end":return E.stop()}},m)}));function l(m){return s.apply(this,arguments)}return l}()}}},selectors:{searchedFeatureFlags:[function(a){return[a.featureFlags,a.searchTerm]},function(a,t){return t?new F.a(a,{keys:["key","name"],threshold:.3}).search(t).map(function(r){return r.item}):a}],breadcrumbs:[function(){return[]},function(){return[{name:"Feature Flags",path:D.a.featureFlags()}]}]},reducers:{searchTerm:{setSearchTerm:function(t,r){var s=r.searchTerm;return s}},featureFlags:{updateFlag:function(t,r){var s=r.flag;return t.find(function(l){var m=l.id;return m===s.id})?t.map(function(l){return l.id===s.id?s:l}):[s].concat(B()(t))},deleteFlag:function(t,r){var s=r.id;return t.filter(function(l){return l.id!==s})}},activeTab:[c.OVERVIEW,{setActiveTab:function(t,r){var s=r.tabKey;return Object.values(c).includes(s)?s:t}}],historyPage:[null,{setHistoryPage:function(t,r){var s=r.page;return s}}]},actionToUrl:function(t){var r=t.values;return{setActiveTab:function(){var l=P({},d.router.values.searchParams),m=!1;return!l.tab&&r.activeTab===c.OVERVIEW&&(m=!0),l.tab=r.activeTab,r.activeTab!==c.HISTORY&&delete l.page,[d.router.values.location.pathname,l,d.router.values.hashParams,{replace:m}]}}},urlToAction:function(t){var r=t.actions,s=t.values;return W()({},D.a.featureFlags(),function(){var l=h()(v.a.mark(function m(g,M){var _,i;return v.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:_=M.tab,_?_!==s.activeTab&&r.setActiveTab(_):s.activeTab!==c.OVERVIEW&&r.setActiveTab(c.OVERVIEW),i=M.page,i&&s.activeTab===c.HISTORY&&r.setHistoryPage(i);case 4:case"end":return E.stop()}},m)}));return function(m,g){return l.apply(this,arguments)}}())},events:function(t){var r=t.actions;return{afterMount:function(){r.loadFeatureFlags()}}}})}}]);
